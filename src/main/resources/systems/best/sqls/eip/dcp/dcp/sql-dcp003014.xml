<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.dcp.dcp.dao.DCP003014PMapper">
 	
 	<select id="DCP003014PMainSelect" parameterType="paramMap" resultType="egovMap">
 		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PMainSelect */
 		SELECT	D2.REQ_DVSN_CD
 				, D2.ACP_YR
 				, D2.CVPT_ACP_NO
 				, D2.SUC_REQ_DVSN_CD
 				, D2.SUC_ACP_YR
 				, D2.SUC_CVPT_ACP_NO
 				, CASE WHEN D1.REQ_DVSN_CD = '9' THEN D1.ACP_YR||'-이해-'||D1.RM_CVPT_ACP_NO
				      ELSE D1.ACP_YR||'-청금-'||D1.RM_CVPT_ACP_NO 
				      END AS ACP_NO
 				, D1.TIT_NM
 				, DECODE(D1.REQR_KND_CD,'1',D1.CVPTR_NM,'2',D1.RPST_PEN_NM,'3',D1.RPST_PEN_NM,'4',D1.CVPTR_NM) AS CVPTR_NM
 		FROM	TBDCPDCP101M D1
 				,TBDCPDCP105L D2
 		WHERE	D2.REQ_DVSN_CD = #{reqDvsnCd}
 		AND		D2.ACP_YR = #{acpYr}
 		AND		D2.CVPT_ACP_NO = #{cvptAcpNo}
 		AND		D1.REQ_DVSN_CD = D2.SUC_REQ_DVSN_CD
 		AND		D1.ACP_YR = D2.SUC_ACP_YR
 		AND		D1.CVPT_ACP_NO = D2.SUC_CVPT_ACP_NO
 	</select>
	
	
	<!-- 강제 취하 처리 한다. -->
	<update id="DCP003014PWdwSaveUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PWdwSaveUpdate */
		UPDATE	TBDCPDCP101M D1
		SET		D1.CVPT_HNDL_STA_CD ='70'
				,D1.CVPT_WDW_DH = SYSDATE
				,D1.CVPT_WDW_RSN = '민원취하요청'
				,D1.FNL_MDF_DH = SYSDATE
				,D1.FNL_USR_ID = #{fnlUsrId}
				,D1.FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				,D1.FNL_MNU_ID = #{fnlMnuId}
		WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
 		AND		D1.ACP_YR = #{acpYr}
 		AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
	</update>
	
	<!-- 강제 취하 처리 한다. -->
	<update id="DCP003014P201SaveUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014P201SaveUpdate */
		UPDATE	TBDCPDCP201M D1
		SET		D1.FNL_HNDL_DH = SYSDATE
				,D1.FNL_USR_ID = #{fnlUsrId}
				,D1.FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				,D1.FNL_MNU_ID = #{fnlMnuId}
		WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
 		AND		D1.ACP_YR = #{acpYr}
 		AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
	</update>
	
	
	<!-- 합건 을 해지한다. -->
	<delete id="DCP003014PSucDelete" parameterType="paramMap">
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PSucDelete */
	<![CDATA[
		DELETE	/*DCP003014PSucDelete*/
		FROM	TBDCPDCP105L D1	
		WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
 		AND		D1.ACP_YR = #{acpYr}
 		AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
	]]>
	
	</delete>
	<!-- 2021-04-16, 접수경로 추가로 쿼리 수정, 김병태 -->
	<!-- 홈페이지로 전송할 데이터인지 체크한다. -->
	<select id="DCP003014PHomeSendSelect" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PHomeSendSelect */
		<![CDATA[
			SELECT	/*DCP003014PHomeSendSelect*/
					COUNT(1)
			FROM	TBDCPDCP101M D1
			WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
	 		AND		D1.ACP_YR = #{acpYr}
	 		AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
	 		AND		D1.ACP_RUT_CD IN ('1','2','3','4','5','6','7')
		]]>
	</select>
	
	<!-- 신문고로 전송할 데이터인지 체크한다. -->
	<select id="DCP003014PSmgSendSelect" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PSmgSendSelect */
		<![CDATA[
			SELECT	/*DCP003014PSmgSendSelect*/
					COUNT(1)
			FROM	TBDCPDCP101M D1
			WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
	 		AND		D1.ACP_YR = #{acpYr}
	 		AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
	 		AND		D1.ACP_RUT_CD = '8'
		]]>
	</select>
	
	<!-- 신문고로 전송한다. -->
	<insert id="DCP003014PSmgInsert" parameterType="paramMap">
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PSmgInsert */
		<![CDATA[
			INSERT INTO	T_IC_TARGET_SRC_INTERFACE
						(	INTERFACE_KEY
							,APP_ORGAN_CODE		/*최초 민원 신청 기관코드(GCC)*/
							,PETI_NO			/*민원신청번호*/
							,REC_SEQ			/*분류이력일련번호*/
							,CIVIL_NO			/*민원접수번호*/
							,PETI_GUBUN			/*민원구분 (500고정,담당자부서지정) */
							,CANCEL_STATUS		/*민원취하여부(Default N)*/
							,PCD_DEPT			/*GCC 부서코드 (접수부서코드)*/
							,PCD_DEPT_NM		/*GCC 부서명 (접수부서명)*/
							,PCD_DUTY_ID		/*접수자명*/
							,PCD_EMAIL			/*접수 이메일 (대표이메일 사용, 감청국, 센터 로 분류)*/
							,PCD_TEL			/*접수자 전화번호 (대표전화 사용: 감청국, 센터로 분류)*/
							,PCD_CONTENTS		/*민원 처리결과 내용*/
							,PCD_REG_DATE		/*처리일자*/
							,PCD_CONTENTS_ATTACH_YN	/*민원처리결과첨부여부*/
							,PCD_GUBUN			/*신문고민원 처리구분코드*/
							,PCD_ORGAN_CODE 	/*실처리기관코드 (감사원 GCC 코드로 고정)*/
							,SRCORGCD			/*소스기관코드 (감사원 GCC 코드로 고정)*/
							,TGTORGCD			/*타겟기관코드 (신문고 GCC 코드로 고정)*/
							,WRITE_TIME			/*등록일자*/
							,SND_RCV_GUBUN		/*송수신구분 (1:송신, 2:수신)*/
							,SND_RCV_TIME		/*송수신일자*/
							,SEND_YN			/*송신여부 (N DEFAULT, EAI 가 송신후 Y로 변경함)*/
						)
				SELECT	TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF2') || LPAD(ROUND(DBMS_RANDOM.VALUE(1, 999999999)), 9, '0')
						,SMG_FRT_CVPT_APL_GCC_ORG_CD
							,SMG_CVPT_APL_NO
							,SMG_CAT_HST_SRNO
							,SMG_CVPT_ACP_NO
							,DECODE(SMG_FRT_HNDL_STA_CD, '161','181', '163','183')
							,'N'
							,F_DPT_INFO(#{fnlDealDptCd},'6')
							,F_DPT_INFO(#{fnlDealDptCd},'7')
							,F_USR_INFO(#{sCnb},'2')
							,''
							,'02-2011-2191'
							,'회신하지 않음'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'N'
							,''
							,'1040000'
							,'1040000'
							,'1140100'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'1'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
							,'N'
				FROM	TBDCPDCP101M
				WHERE	REQ_DVSN_CD = #{reqDvsnCd}
				AND		ACP_YR = #{acpYr}
				AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</insert>
	
	<!-- 강제 취하 처리 한다. -->
	<update id="DCP003014PWdwAllSaveUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PWdwAllSaveUpdate */
		UPDATE	/*DCP003014PWdwAllSaveUpdate*/
				TBDCPDCP101M D1
		SET		D1.CVPT_HNDL_STA_CD ='70'
				,D1.CVPT_WDW_DH = SYSDATE
				,D1.CVPT_WDW_RSN = '민원취하요청'
				,D1.FNL_MDF_DH = SYSDATE
				,D1.FNL_USR_ID = #{fnlUsrId}
				,D1.FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				,D1.FNL_MNU_ID = #{fnlMnuId}
		WHERE	D1.REQ_DVSN_CD = #{sucReqDvsnCd}
 		AND		D1.ACP_YR = #{sucAcpYr}
 		AND		D1.CVPT_ACP_NO = #{sucCvptAcpNo}
	</update>
	
	
	<update id="DCP003014P201AllSaveUpdate" parameterType="paramMap">
		<![CDATA[
		UPDATE	TBDCPDCP201M D1
		SET		D1.FNL_HNDL_DH = SYSDATE
				,D1.FNL_USR_ID = #{fnlUsrId}
				,D1.FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				,D1.FNL_MNU_ID = #{fnlMnuId}
		WHERE	D1.REQ_DVSN_CD = #{sucReqDvsnCd}
 		AND		D1.ACP_YR = #{sucAcpYr}
 		AND		D1.CVPT_ACP_NO = #{sucCvptAcpNo}
 		]]>
	</update>
	
	<!-- 2021-04-16, 접수경로 추가로 쿼리 수정, 김병태 -->
	<!-- 홈페이지로 전송할 데이터인지 체크한다. -->
	<select id="DCP003014PHomeAllSendSelect" parameterType="paramMap" resultType="int">	
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PHomeAllSendSelect */
		<![CDATA[
			SELECT	/*DCP003014PHomeAllSendSelect*/
					COUNT(1)
			FROM	TBDCPDCP101M D1
			WHERE	D1.REQ_DVSN_CD = #{sucReqDvsnCd}
	 		AND		D1.ACP_YR = #{sucAcpYr}
	 		AND		D1.CVPT_ACP_NO = #{sucCvptAcpNo}
	 		AND		D1.ACP_RUT_CD IN ('1','2','3','4','5','6','7')
		]]>
	</select>
	
	<!-- 신문고로 전송할 데이터인지 체크한다. -->
	<select id="DCP003014PSmgAllSendSelect" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PSmgAllSendSelect */
		<![CDATA[
			SELECT	/*DCP003014PSmgAllSendSelect*/
					COUNT(1)
			FROM	TBDCPDCP101M D1
			WHERE	D1.REQ_DVSN_CD = #{sucReqDvsnCd}
	 		AND		D1.ACP_YR = #{sucAcpYr}
	 		AND		D1.CVPT_ACP_NO = #{sucCvptAcpNo}
	 		AND		D1.ACP_RUT_CD = '8'
		]]>
	</select>
	
	<!-- 신문고로 전송한다. -->
	<insert id="DCP003014PSmgAllInsert" parameterType="paramMap">	
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PSmgAllInsert */
		<![CDATA[
			INSERT INTO	T_IC_TARGET_SRC_INTERFACE
						(	INTERFACE_KEY
							,APP_ORGAN_CODE		/*최초 민원 신청 기관코드(GCC)*/
							,PETI_NO			/*민원신청번호*/
							,REC_SEQ			/*분류이력일련번호*/
							,CIVIL_NO			/*민원접수번호*/
							,PETI_GUBUN			/*민원구분 (500고정,담당자부서지정) */
							,CANCEL_STATUS		/*민원취하여부(Default N)*/
							,PCD_DEPT			/*GCC 부서코드 (접수부서코드)*/
							,PCD_DEPT_NM		/*GCC 부서명 (접수부서명)*/
							,PCD_DUTY_ID		/*접수자명*/
							,PCD_EMAIL			/*접수 이메일 (대표이메일 사용, 감청국, 센터 로 분류)*/
							,PCD_TEL			/*접수자 전화번호 (대표전화 사용: 감청국, 센터로 분류)*/
							,PCD_CONTENTS		/*민원 처리결과 내용*/
							,PCD_REG_DATE		/*처리일자*/
							,PCD_CONTENTS_ATTACH_YN	/*민원처리결과첨부여부*/
							,PCD_GUBUN			/*신문고민원 처리구분코드*/
							,PCD_ORGAN_CODE 	/*실처리기관코드 (감사원 GCC 코드로 고정)*/
							,SRCORGCD			/*소스기관코드 (감사원 GCC 코드로 고정)*/
							,TGTORGCD			/*타겟기관코드 (신문고 GCC 코드로 고정)*/
							,WRITE_TIME			/*등록일자*/
							,SND_RCV_GUBUN		/*송수신구분 (1:송신, 2:수신)*/
							,SND_RCV_TIME		/*송수신일자*/
							,SEND_YN			/*송신여부 (N DEFAULT, EAI 가 송신후 Y로 변경함)*/
						)
				SELECT	TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF2') || LPAD(ROUND(DBMS_RANDOM.VALUE(1, 999999999)), 9, '0')
						,SMG_FRT_CVPT_APL_GCC_ORG_CD
							,SMG_CVPT_APL_NO
							,SMG_CAT_HST_SRNO
							,SMG_CVPT_ACP_NO
							,DECODE(SMG_FRT_HNDL_STA_CD, '161','181', '163','183')
							,'N'
							,F_DPT_INFO(#{fnlDealDptCd},'6')
							,F_DPT_INFO(#{fnlDealDptCd},'7')
							,F_USR_INFO(#{sCnb},'2')
							,''
							,'02-2011-2191'
							,'회신하지 않음'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'N'
							,''
							,'1040000'
							,'1040000'
							,'1140100'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'1'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
							,'N'
				FROM	TBDCPDCP101M
				WHERE	REQ_DVSN_CD = #{sucReqDvsnCd}
				AND		ACP_YR = #{sucAcpYr}
				AND		CVPT_ACP_NO = #{sucCvptAcpNo}
		]]>
	</insert>
	
	<insert id="DCP003014P202HInsert" parameterType="paramMap">
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014P202HInsert */
		<![CDATA[
			INSERT INTO TBDCPDCP202H
        				(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,CVPT_DTB_HST_SRNO
        					,DTB_DPT_CD
        					,DTB_PEN_ID
        					,CVPT_HNDL_STA_CD
        					,HNDL_DPT_CD
        					,HNDL_CHGR_ID
        					,RDTB_RQS_RSN
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#{reqDvsnCd}
							,#{acpYr}
							,#{cvptAcpNo}
							,(	SELECT NVL(MAX(CVPT_DTB_HST_SRNO),0)+1
								  FROM TBDCPDCP202H
								 WHERE 1=1
							       AND REQ_DVSN_CD = #{reqDvsnCd}
							       AND ACP_YR = #{acpYr}
							       AND CVPT_ACP_NO = #{cvptAcpNo}
							 )
							,F_USR_INFO(#{sCnb},'5')
							,F_USR_INFO(#{sCnb},'1')
							,'70'
							,''
							,''
							,''
							,F_USR_INFO(#{sCnb},'1')
							,#{fnlUsrId}
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
						)
		]]>
	</insert>
	
	<insert id="DCP003014PSuc202HInsert" parameterType="paramMap">
		/* kr.go.bai.eip.dcp.dcp.dao.CSPDCP420Mapper.DCP003014PSuc202HInsert */
		<![CDATA[
			INSERT INTO	 TBDCPDCP202H
        				(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,CVPT_DTB_HST_SRNO
        					,DTB_DPT_CD
        					,DTB_PEN_ID
        					,CVPT_HNDL_STA_CD
        					,HNDL_DPT_CD
        					,HNDL_CHGR_ID
        					,RDTB_RQS_RSN
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#{sucReqDvsnCd}
							,#{sucAcpYr}
							,#{sucCvptAcpNo}
							,(	SELECT NVL(MAX(CVPT_DTB_HST_SRNO),0)+1
								  FROM TBDCPDCP202H
								 WHERE 1=1
							       AND REQ_DVSN_CD = #{sucReqDvsnCd}
							       AND ACP_YR = #{sucAcpYr}
							       AND CVPT_ACP_NO = #{sucCvptAcpNo}
							 )
							,F_USR_INFO(#{sCnb},'5')
							,F_USR_INFO(#{sCnb},'1')
							,'70'
							,''
							,''
							,''
							,F_USR_INFO(#{sCnb},'1')
							,#{fnlUsrId}
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
						)
		]]>
	</insert>
</mapper> 
