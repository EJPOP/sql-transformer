<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.dcp.dcp.dao.DCP003008PMapper">
 	
 	<select id="DCP003008PSelectInit" parameterType="paramMap" 	resultType="egovMap">
 		/* kr.go.bai.eip.dcp.dcp.dao.DCP003008PMapper.DCP003008PMainSelect */
		<![CDATA[
			 SELECT TO_CHAR(TO_DATE(F_GET_NEXT_WORK_DT(nvl2(T1.BK_HNDL_DDLN_DT, T1.BK_HNDL_DDLN_DT, T1.HNDL_DDLN_DT),DECODE(#{dvsnCd},'1',(#{hndlDdlnCnt}+1+nvl(NTF_EXTN_DCN,0)),(#{hndlDdlnCnt}+1+nvl(SCEN_CFM_EXTN_DCN,0))))),'YYYY-MM-DD') HNDL_DDLN_DT
				  ,TO_CHAR(TO_DATE(nvl2(T1.BK_HNDL_DDLN_DT, T1.BK_HNDL_DDLN_DT, T1.HNDL_DDLN_DT))+1,'YYYY-MM-DD') AS BK_HNDL_DDLN_DT 
			      ,30-NVL(SCEN_CFM_EXTN_DCN,0) AS SCEN_CFM_EXTN_DCN
			      ,14-NVL(NTF_EXTN_DCN,0) AS NTF_EXTN_DCN
			  FROM TBDCPDCP101M T1
			 WHERE REQ_DVSN_CD = #{reqDvsnCd}
			   AND ACP_YR = #{acpYr}
			   AND CVPT_ACP_NO =#{cvptAcpNo}
		]]>
	</select>
	
	
	
	
	<update id="DCP003008PSave" parameterType="paramMap">
	/* kr.go.bai.eip.dcp.dcp.dao.DCP003008PMapper.DCP003008PSave */
		<![CDATA[
			UPDATE TBDCPDCP101M T1
			   SET T1.BK_HNDL_DDLN_DT = nvl2(T1.BK_HNDL_DDLN_DT, T1.BK_HNDL_DDLN_DT, T1.HNDL_DDLN_DT)
		]]>
			<if test='dvsnCd == "1"'>
			     ,T1.HNDL_DDLN_DT = #{hndlDdlnDt}
				  ,T1.SCEN_CFM_EXTN_DCN = #{hndlDdlnCnt}
				  
			</if>
			<if test='dvsnCd == "2"'>
			     ,T1.HNDL_DDLN_DT = #{hndlDdlnDt}			
				  ,T1.NTF_EXTN_DCN = #{hndlDdlnCnt}			  					 
			</if>
		<![CDATA[
			 WHERE T1.REQ_DVSN_CD = #{reqDvsnCd}
			   AND T1.ACP_YR = #{acpYr}
			   AND T1.CVPT_ACP_NO =#{cvptAcpNo}
		]]>
	</update>
	
	<update id="DCP003008PSucSave" parameterType="paramMap">
	/* kr.go.bai.eip.dcp.dcp.dao.DCP003008PMapper.DCP003008PSucSave */
		<![CDATA[
			UPDATE TBDCPDCP101M T1
			   SET T1.HNDL_DDLN_DT = #{hndlDdlnDt}
			   	  ,T1.BK_HNDL_DDLN_DT = nvl2(T1.BK_HNDL_DDLN_DT, T1.BK_HNDL_DDLN_DT, T1.HNDL_DDLN_DT)
			 WHERE (T1.REQ_DVSN_CD, T1.ACP_YR, T1.CVPT_ACP_NO)
			       IN ( SELECT S1.SUC_REQ_DVSN_CD, S1.SUC_ACP_YR, S1.SUC_CVPT_ACP_NO
			              FROM TBDCPDCP105L S1
			             WHERE S1.REQ_DVSN_CD = #{reqDvsnCd}
			               AND S1.ACP_YR = #{acpYr}
			               AND S1.CVPT_ACP_NO = #{cvptAcpNo}
			          )
		]]>
	</update>
	
</mapper> 
