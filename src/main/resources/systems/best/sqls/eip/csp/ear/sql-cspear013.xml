<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.ear.dao.CSPEAR013Mapper">

	<resultMap type="java.util.HashMap" id="CSPEAR013">
 		<result property="reqDvsnCd" column="REQ_DVSN_CD"                   jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="acpYr" column="ACP_YR"                             jdbcType="VARCHAR"  javaType="java.lang.String" /> 
		<result property="cvptAcpNo" column="CVPT_ACP_NO"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="reqDocKndCd" column="REQ_DOC_KND_CD"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="onrDocMngCrdId" column="ONR_DOC_MNG_CRD_ID"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptOpmApvHndlStaCd" column="CVPT_OPM_APV_HNDL_STA_CD"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="opmTxt" column="OPM_TXT"                                 jdbcType="CLOB"  javaType="java.lang.String" />
		<result property="ad" column="AD"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="receiver" column="RECEIVER"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="zcd" column="ZCD"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="cvptrNm" column="CVPTR_NM"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="tel" column="TEL"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="flRutNm" column="FL_RUT_NM"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="sysFlNm" column="SYS_FL_NM"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
 	</resultMap>
 	
 	<select id="CSPEAR013PMainSelect" parameterType="paramMap"
		resultMap="CSPEAR013">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR013Mapper.CSPEAR013PMainSelect */
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,#{reqDocKndCd} AS REQ_DOC_KND_CD
   					,C.ONR_DOC_MNG_CRD_ID
   					,C.CVPT_OPM_APV_HNDL_STA_CD
				   	,C.OPM_TXT
				   	,A.AD||' '||A.DTL_AD AS AD
				   	,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) || ' 귀하 (우'||A.ZCD || ' ' || A.AD || ' ' || A.DTL_AD || ')' AS RECEIVER
   					,A.ZCD
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,DECODE(A.TNB,NULL,A.HPN,A.TNB) AS TEL
   					, D.FL_RUT_NM
					, D.SYS_FL_NM
   			FROM	TBCSPDCP101M A
   					,TBCSPEAR001M B
   					,TBCSPEAR002M C
   					, TBDCMACM103L D
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = #{reqDvsnCd}
			AND		A.ACP_YR = #{acpYr}
			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		C.REQ_DOC_KND_CD(+) = #{reqDocKndCd}
   			AND		C.ONR_DOC_MNG_CRD_ID = D.ONR_DOC_MNG_CRD_ID(+)
		]]>
	</select>
	
	<insert id="CSPEAR013PEAR002OnrInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR013Mapper.CSPEAR013PEAR002OnrInsert */
        <![CDATA[
        	INSERT INTO	TBCSPEAR002M
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, OPM_TXT
        					, REQ_DOC_KND_CD
        					, ONR_DOC_MNG_CRD_ID
        					, CVPT_OPM_APV_HNDL_STA_CD
        					, ADMN_INF_HNDL_NO
        					, ONR_APV_RQS_DH
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#{reqDvsnCd}
        					, #{acpYr}
        					, #{cvptAcpNo}
        					, #{opmTxt}
        					, #{reqDocKndCd}
					   		, #{onrDocMngCrdId}
					   		, '20'
					   		, #{admnInfHndlNo}
					   		, SYSDATE
        					, F_USR_INFO(#{sCnb}, '1')
        					, #{fnlUsrId}
        					, #{fnlDealDptCd}
        					, #{fnlMnuId}
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>
	
	<select id="CSPEAR013POnrUserInfoSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR013Mapper.CSPEAR013POnrUserInfoSelect */
		<![CDATA[
			SELECT	/*CSPDCP418POnrUserInfoSelect*/
					D1.USR_ID, 
					D1.EML_AD,
					(	SELECT	SUBSTR(S1.STND_DPT_CD,9,7)
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = D1.DPT_CD
   					)  AS DEPT_CD,
					D2.FRML_DPT_NM AS DEPT_NM,	
					'CSPDCP' AS BIZ_GUBUN,
					D1.USR_NAM, 
					D1.RANK_NM_2 AS POSITION_NM
			FROM	TBDCMACM001M D1
					,TBDCMACM002M D2
			WHERE 	USR_ID = #{fnlUsrId}
			AND		D1.DPT_CD = D2.DPT_CD
		]]>
	</select>
</mapper> 
