<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper">


	<select id="CSPDCP511QSysDateSelect" resultType="egovMap">
	/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP511QSysDateSelect */
 	<![CDATA[
 	SELECT TO_CHAR(SYSDATE, 'YYYYMMDD') AS ENDDT,
    	   TO_CHAR(TRUNC(ADD_MONTHS(SYSDATE, -12), 'dd'), 'YYYYMMDD') AS STARTDT
  	FROM DUAL
 	]]>
	</select>


	<select id="CSPDCP511QMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP511QMainSelect */
		<include refid="include.pageSelct" />
		<![CDATA[
			SELECT	D1.REQ_DVSN_CD
					,D1.CVPT_KND_CD
			      	,F_CODE_NM('1000047', D1.CVPT_KND_CD) AS CVPT_KND_NM
			      	,TO_CHAR(D1.ACP_DH, 'YYYY-MM-DD') AS ACP_DH
			      	,D1.CVPT_ACP_NO
			      	,D1.ACP_YR
			      	,D1.ACP_YR||'-'|| F_CODE_NM('1000949', D1.RM_ACP_KND_CD) ||'-'||D1.RM_CVPT_ACP_NO AS ACP_YR_NO
			      	,F_CODE_NM('1000754', D3.CVPT_HNDL_DVSN_CD) AS CVPT_HNDL_DVSN_NM
			      	,F_CODE_NM('1000051', D3.T_CVPT_HNDL_DVSN_CD) AS T_CVPT_HNDL_DVSN_NM
			      	,CASE WHEN (	SELECT COUNT(*)
			      					FROM TBCSPDCP105L S1
			      					WHERE S1.REQ_DVSN_CD = D1.REQ_DVSN_CD
			      					AND S1.ACP_YR = D1.ACP_YR
			      					AND S1.CVPT_ACP_NO = D1.CVPT_ACP_NO
			      				) > 0 THEN D1.TIT_NM||'(합건 : '||D1.RM_CVPT_ACP_NO||', '||(	SELECT	AGGR_CONCAT( S3.RM_CVPT_ACP_NO, ', ')||' )'
			      																			FROM	TBCSPDCP105L S2, TBCSPDCP101M S3
			      																			WHERE	D1.REQ_DVSN_CD = S2.REQ_DVSN_CD
			      																			AND		D1.ACP_YR = S2.ACP_YR
			      																			AND		D1.CVPT_ACP_NO = S2.CVPT_ACP_NO
			      																			AND		S2.SUC_REQ_DVSN_CD = S3.REQ_DVSN_CD
			      																			AND		S2.SUC_ACP_YR = S3.ACP_YR
			      																			AND		S2.SUC_CVPT_ACP_NO = S3.CVPT_ACP_NO)
			      		ELSE D1.TIT_NM END AS TIT_NM
			      	,DECODE(D1.REQR_KND_CD,'1',D1.CVPTR_NM,'2',D1.RPST_PEN_NM,'3',D1.RPST_PEN_NM,'4',D1.CVPTR_NM) AS CVPTR_NM
			      	,TO_CHAR(D4.FNL_HNDL_DH, 'YYYY-MM-DD HH24:Mi:SS') AS FNL_HNDL_DH
			      	,F_CODE_NM('1000361',D1.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
			      	,(	SELECT	TO_CHAR(TO_DATE(TO_CHAR(D1.ACP_DH, 'YYYYMMDD'), 'YYYYMMDD') + NVL( S1.USR_DFN_TXT_2, 30), 'YYYY-MM-DD')
                    	FROM	TBDCMACM013C S1
                    	WHERE	S1.CMM_CD_DVSN_CD = '1000051'
                    	AND		S1.CD <> '000000000'
                    	AND     S1.CD  = D3.CVPT_HNDL_DVSN_CD) AS HNDL_LIMIT__DT
                    ,TO_CHAR(D1.ACP_DH + 30 + 
                        DECODE((
                            SELECT NVL(SUM(DECODE(NVL(Z3.APV_STA_CD,'0'), '30', '1', '0')),0)
                             FROM TBCSPDCP603M Z3
                             WHERE Z3.ACP_YR = D1.ACP_YR
                               AND Z3.REQ_DVSN_CD = D1.REQ_DVSN_CD
                               AND Z3.CVPT_ACP_NO = D1.CVPT_ACP_NO
                               AND Z3.RPRT_CD = 'B10200100'),0,0,10),'YYYY-MM-DD')  AS HNDL_LIMIT_DT_PRCS
                  	,D3.SRNO
                  	,D3.CVPT_HNDL_DVSN_CD
			  FROM TBCSPDCP101M D1
			      ,TBCSPDCP102M D2
			      ,TBCSPDCP205L D3
			      ,TBCSPDCP201M D4
			 WHERE 1=1
			   AND D1.REQ_DVSN_CD = '1'
			   AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
			   AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
			   AND D1.ACP_YR      = D2.ACP_YR
			   AND D1.REQ_DVSN_CD = D3.REQ_DVSN_CD
			   AND D1.CVPT_ACP_NO = D3.CVPT_ACP_NO
			   AND D1.ACP_YR      = D3.ACP_YR
			   AND D1.REQ_DVSN_CD = D4.REQ_DVSN_CD
			   AND D1.CVPT_ACP_NO = D4.CVPT_ACP_NO
			   AND D1.ACP_YR      = D4.ACP_YR
			   AND D1.CVPT_HNDL_STA_CD IN ('50','60')
			   AND (D3.REQ_DVSN_CD, D3.CVPT_ACP_NO, D3.ACP_YR, D3.SRNO ) IN (	SELECT	Z.REQ_DVSN_CD, Z.CVPT_ACP_NO, Z.ACP_YR, MIN(Z.SRNO)
			   																	FROM	TBCSPDCP205L Z
			   																	WHERE	D1.REQ_DVSN_CD = Z.REQ_DVSN_CD
			   																	AND		D1.CVPT_ACP_NO = Z.CVPT_ACP_NO
			   																	AND		D1.ACP_YR = Z.ACP_YR
			   																	GROUP BY Z.REQ_DVSN_CD, Z.CVPT_ACP_NO, Z.ACP_YR
			   																)
			   AND ( D3.CVPT_HNDL_DVSN_CD = '60' OR T_CVPT_HNDL_DVSN_CD = '14' )
			   AND (D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO) NOT IN (
	   														SELECT	SUC_REQ_DVSN_CD,SUC_ACP_YR,SUC_CVPT_ACP_NO
	   														FROM	TBCSPDCP105L
	   														)

		]]>
		<if test='usrId != "haahaasch"'>
			AND D4.HNDL_DPT_CD = #{dptCd}
			AND D4.HNDL_CHGR_ID = #{usrId}
		</if>
		<if test='titNm != null and titNm != ""'>
			AND D1.TIT_NM LIKE '%'||#{titNm}||'%'
		</if>

		<if test='acpDhs != null and acpDhs != ""'>
			AND TO_CHAR(D1.ACP_DH, 'YYYYMMDD') BETWEEN #{acpDhs} AND #{acpDhe}
		</if>

		<if test='cvptKndCd != null and cvptKndCd != ""'>
			AND D1.CVPT_KND_CD IN (SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{cvptKndCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<!-- <if test='cvptHndlDvsnCd != null and cvptHndlDvsnCd != ""'>
			AND D3.CVPT_HNDL_DVSN_CD IN (SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{cvptHndlDvsnCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )

		</if> -->
		
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
			AND D1.RM_ACP_KND_CD = #{reqDvsnCd} /* BEST20 접수번호구분 */
		</if>

		<if test='rmCvptAcpNo != null and rmCvptAcpNo != ""'>
			AND D1.RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0)
		</if>

		<if test='cvptrNm != null and cvptrNm != ""'>
			AND D1.CVPTR_NM LIKE '%'||#{cvptrNm}||'%'
		</if>
		AND D1.ACP_YR = NVL(#{acpYr}, D1.ACP_YR)
		AND D1.CVPT_HNDL_STA_CD = NVL(#{cvptHndlStaCd}, D1.CVPT_HNDL_STA_CD)
		ORDER BY D1.ACP_YR DESC
		, D1.RM_CVPT_ACP_NO DESC


		<include refid="include.pageOrder" />
	</select>


	<select id="CSPDCP511QMainCount" resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP511QMainCount */
		SELECT COUNT(1) AS
		TOTCNT
		,SUM(CASE WHEN D1.CVPT_HNDL_STA_CD = '50' THEN 1 ELSE 0 END ) AS NOTCM
		,SUM(CASE WHEN D1.CVPT_HNDL_STA_CD = '60' THEN 1 ELSE 0 END ) AS CM
		FROM TBCSPDCP101M D1
		,TBCSPDCP102M D2
		,TBCSPDCP205L D3
		,TBCSPDCP201M D4
		WHERE 1=1
		AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
		AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
		AND D1.ACP_YR = D2.ACP_YR(+)
		AND D1.REQ_DVSN_CD = D3.REQ_DVSN_CD(+)
		AND D1.CVPT_ACP_NO = D3.CVPT_ACP_NO(+)
		AND D1.ACP_YR = D3.ACP_YR(+)
		AND D1.REQ_DVSN_CD = D4.REQ_DVSN_CD(+)
		AND D1.CVPT_ACP_NO = D4.CVPT_ACP_NO(+)
		AND D1.ACP_YR = D4.ACP_YR(+)
		AND D1.CVPT_HNDL_STA_CD IN ('50', '60')
		AND D1.REQ_DVSN_CD = 1
		AND D3.SRNO = 1
		AND D3.CVPT_HNDL_DVSN_CD IN ('10', '20', '50', '60')
	</select>
	
	<!-- 합건 쿼리 시작 2022.06.29 이해창 -->
	<select id="CSPDCP516PMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516PMainSelect */
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO AS ACP_NO
   					,DECODE(A.PRE_RM_CVPT_ACP_NO,NULL,'-',A.ACP_YR||'-'|| F_CODE_NM('1000949', A.PRE_RM_ACP_KND_CD) ||'-'||A.PRE_RM_CVPT_ACP_NO) AS PRE_ACP_NO /* BEST20 이전접수번호 */
   					,A.CVPT_KND_CD
   					,F_CODE_NM('1000047',A.CVPT_KND_CD) AS CVPT_KND_NM
   					,A.TIT_NM
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
   					,A.CVPT_HNDL_STA_CD
   					,A.ACP_RUT_CD
   					,A.HPN
   					,A.RM_CVPT_ACP_NO
   			FROM	TBCSPDCP101M A
   					,TBCSPDCP102M B
   					,TBCSPDCP201M C
   					,TBCSPDCP205L D
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = '1'
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
   			AND		A.ACP_YR = C.ACP_YR
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = D.REQ_DVSN_CD
   			AND		A.ACP_YR = D.ACP_YR
   			AND		A.CVPT_ACP_NO = D.CVPT_ACP_NO
   			AND     A.CVPT_HNDL_STA_CD IN ('60')   			
   			AND     D.CVPT_HNDL_DVSN_CD IN ('70','100')
   			AND		(A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO) NOT IN (	SELECT 	REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO
   																		FROM	TBCSPDCP203M)
   			AND		(A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO) NOT IN (	SELECT	#{reqDvsnCd},#{acpYr},#{cvptAcpNo}
   																		FROM	DUAL )
   			AND		(A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO) NOT IN (	SELECT	REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO
   																		FROM	TBCSPDCP401H)
   			AND		((A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO) NOT IN (	SELECT 	REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO
   																		FROM	TBCSPDCP953L)
   			AND 	(A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO) NOT IN (	SELECT 	SUC_REQ_DVSN_CD, SUC_ACP_YR, SUC_CVPT_ACP_NO
   																			FROM	TBCSPDCP953L) )
   			AND		((A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO) NOT IN (	SELECT 	REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO
   																		FROM	TBCSPDCP105L)
   			AND 	(A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO) NOT IN (	SELECT 	SUC_REQ_DVSN_CD, SUC_ACP_YR, SUC_CVPT_ACP_NO
   																			FROM	TBCSPDCP105L) )
		]]>
		<if test='acpDhs != null and acpDhs != ""'>
				AND	A.ACP_DH &gt;= #{acpDhs}
			</if>
		<if test='acpDhe != null and acpDhe != ""'>
				AND	TO_CHAR(A.ACP_DH,'YYYYMMDD') &lt;= #{acpDhe}
			</if>
		<if test='titNm != null and titNm != ""'>
					AND	A.TIT_NM LIKE '%'||#{titNm}||'%'
		</if>
		<if test='schAcpYr != null and schAcpYr != ""'>
				AND	A.ACP_YR = #{schAcpYr}
			</if>
		
		<if test='cvptrNm != null and cvptrNm != ""'>
				AND	(A.CVPTR_NM LIKE '%'||#{cvptrNm}||'%' OR A.RPST_PEN_NM LIKE '%'||#{cvptrNm}||'%')
			</if>
			
		<if test='rmAcpKndCd != null and rmAcpKndCd != ""'>
				AND	A.RM_ACP_KND_CD = #{rmAcpKndCd}
			</if>
		/* BEST20 이전접수번호 조회 */
		<choose>
			<when test='srhReqDvsnCd != null and srhReqDvsnCd != "" and rmCvptAcpNo != null and rmCvptAcpNo != ""'>
				 AND ((A.RM_ACP_KND_CD = #{srhReqDvsnCd} AND A.RM_CVPT_ACP_NO = #{rmCvptAcpNo}) OR
				         (A.PRE_RM_ACP_KND_CD = #{srhReqDvsnCd}  AND A.PRE_RM_CVPT_ACP_NO = #{rmCvptAcpNo}))  
			</when>
			<otherwise>
				<if test='srhReqDvsnCd != null and srhReqDvsnCd != ""'>
					AND (A.RM_ACP_KND_CD = #{srhReqDvsnCd})  
				</if>
				<if test='rmCvptAcpNo != null and rmCvptAcpNo != ""'>
					AND (A.RM_CVPT_ACP_NO = #{rmCvptAcpNo} OR A.PRE_RM_CVPT_ACP_NO = #{rmCvptAcpNo})
				</if>
			</otherwise>
		</choose>
		/* 2023-12-13 인력풀제 수정*/
		<choose>
			<when test='hirYn == "Y"'>
				AND	(SELECT HIRK_DPT_CD
					   FROM TBDCMACM002M Z1
				      WHERE Z1.DPT_CD = D.TRNF_DPT_CD 
					) = #{dptCd}				
			</when>
			<otherwise>
				AND D.TRNF_DPT_CD = #{dptCd}
			</otherwise>
		</choose>
		
		
	</select>

	<select id="CSPDCP516PSucSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516PSucSelect */
		<![CDATA[
			SELECT	B.REQ_DVSN_CD
					,B.ACP_YR
   					,B.CVPT_ACP_NO
   					,A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO AS ACP_NO
   					,DECODE(A.PRE_RM_CVPT_ACP_NO,NULL,'-',A.ACP_YR||'-'|| F_CODE_NM('1000949', A.PRE_RM_ACP_KND_CD) ||'-'||A.PRE_RM_CVPT_ACP_NO) AS PRE_ACP_NO /* BEST20 이전접수번호 */
   					,A.CVPT_KND_CD
   					,F_CODE_NM('1000047',A.CVPT_KND_CD) AS CVPT_KND_NM
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
   					,A.TIT_NM
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,B.SUC_REQ_DVSN_CD
   					,B.SUC_ACP_YR
   					,B.SUC_CVPT_ACP_NO
   					,A.CVPT_HNDL_STA_CD
   					,A.ACP_RUT_CD
   					,A.HPN
   			FROM	TBCSPDCP101M A, TBCSPDCP953L B
   			WHERE	B.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		B.ACP_YR = #{acpYr}
   			AND		B.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		B.SUC_REQ_DVSN_CD = A.REQ_DVSN_CD
   			AND		B.SUC_ACP_YR = A.ACP_YR
   			AND		B.SUC_CVPT_ACP_NO = A.CVPT_ACP_NO
   		]]>
   	</select>
   	
   	<select id="CSPDCP516PProcSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516PProcSelect */
		<![CDATA[
			SELECT	REQ_DVSN_CD
					,ACP_YR
   					,CVPT_ACP_NO
   					,DGE
   					,HNDL_DPT_CD
   					,HNDL_PEN_ID
   			FROM	TBCSPDCP401H
   			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
   			AND		ACP_YR = #{acpYr}
   			AND		CVPT_ACP_NO = #{cvptAcpNo}
   		]]>
   	</select>
   	
   	<select id="CSPDCP518ESucSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP518ESucSelect */
		<![CDATA[
			SELECT	B.REQ_DVSN_CD
					,B.ACP_YR
   					,B.CVPT_ACP_NO
   					,A.RM_CVPT_ACP_NO
   					,A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO AS ACP_NO
   					,A.CVPT_KND_CD
   					,F_CODE_NM('1000047',A.CVPT_KND_CD) AS CVPT_KND_NM
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
   					,A.TIT_NM
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,B.SUC_REQ_DVSN_CD
   					,B.SUC_ACP_YR
   					,B.SUC_CVPT_ACP_NO
   					,A.CVPT_HNDL_STA_CD
   			FROM	TBCSPDCP101M A, TBCSPDCP105L B
   			WHERE	B.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		B.ACP_YR = #{acpYr}
   			AND		B.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		B.SUC_REQ_DVSN_CD = A.REQ_DVSN_CD
   			AND		B.SUC_ACP_YR = A.ACP_YR
   			AND		B.SUC_CVPT_ACP_NO = A.CVPT_ACP_NO
   		]]>
   	</select>
   	
   	<select id="CSPDCP518ESubSucSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP518ESubSucSelect */
		<![CDATA[
			SELECT	B.REQ_DVSN_CD
					,B.ACP_YR
   					,B.CVPT_ACP_NO
   					,A.RM_CVPT_ACP_NO
   					,A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO AS ACP_NO
   					,A.CVPT_KND_CD
   					,F_CODE_NM('1000047',A.CVPT_KND_CD) AS CVPT_KND_NM
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
   					,A.TIT_NM
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,B.SUC_REQ_DVSN_CD
   					,B.SUC_ACP_YR
   					,B.SUC_CVPT_ACP_NO
   					,A.CVPT_HNDL_STA_CD
   			FROM	TBCSPDCP101M A, TBCSPDCP953L B
   			WHERE	B.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		B.ACP_YR = #{acpYr}
   			AND		B.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		B.SUC_REQ_DVSN_CD = A.REQ_DVSN_CD
   			AND		B.SUC_ACP_YR = A.ACP_YR
   			AND		B.SUC_CVPT_ACP_NO = A.CVPT_ACP_NO
   		]]>
   	</select>
   	
   	<select id="CSPDCP518ESubSucCheckSelect" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP518ESubSucCheckSelect */
		<![CDATA[
			SELECT	/*CSPDCP518ESubSucCheckSelect*/
					COUNT(*) AS CNT
			FROM	TBCSPDCP953L D1
			WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
			AND		D1.ACP_YR = #{acpYr}
			AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</select>
	
	<insert id="CSPDCP516P105SucInsert" parameterType="paramMap">
   		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516P105SucInsert */
   		<![CDATA[
   			INSERT INTO	TBCSPDCP953L
	   					(	REQ_DVSN_CD
	   						,ACP_YR
	   						,CVPT_ACP_NO
	   						,SUC_REQ_DVSN_CD
	   						,SUC_ACP_YR
	   						,SUC_CVPT_ACP_NO
	   						,FRT_USR_ID
	       					,FNL_USR_ID
	       					,FNL_DEAL_DPT_CD
	       					,FNL_MNU_ID
	       					,FRT_REGI_DH
	       					,FNL_MDF_DH
	       				)
       			VALUES	(	#{reqDvsnCd}
	   						,#{acpYr}
	   						,#{cvptAcpNo}
	   						,#{sucReqDvsnCd}
	   						,#{sucAcpYr}
	   						,#{sucCvptAcpNo}
	   						,#{frtUsrId}
	       					,#{fnlUsrId}
	       					,#{fnlDealDptCd}
	       					,#{fnlMnuId}
	       					,SYSDATE
	       					,SYSDATE
	       				)
   		]]>
   	</insert>

	<update id="CSPDCP516P201SucUpdate" parameterType="paramMap">
   		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516P201SucUpdate */
   		<![CDATA[
   			UPDATE	TBCSPDCP201M A
   			SET		A.CVPT_KND_DVSN_CD = (SELECT 	Z.CVPT_KND_DVSN_CD
   										FROM 	TBCSPDCP201M Z
   										WHERE 	Z.REQ_DVSN_CD = #{reqDvsnCd}
   										AND		Z.ACP_YR = #{acpYr}
   										AND		Z.CVPT_ACP_NO = #{cvptAcpNo})
   					,A.PASV_ADMN_YN = (SELECT 	Z.PASV_ADMN_YN
   										FROM 	TBCSPDCP201M Z
   										WHERE 	Z.REQ_DVSN_CD = #{reqDvsnCd}
   										AND		Z.ACP_YR = #{acpYr}
   										AND		Z.CVPT_ACP_NO = #{cvptAcpNo})
   					,A.REF_YN = (SELECT 	Z.REF_YN
   										FROM 	TBCSPDCP201M Z
   										WHERE 	Z.REQ_DVSN_CD = #{reqDvsnCd}
   										AND		Z.ACP_YR = #{acpYr}
   										AND		Z.CVPT_ACP_NO = #{cvptAcpNo})
   					,A.DOC_ID = (SELECT 	Z.DOC_ID
   										FROM 	TBCSPDCP201M Z
   										WHERE 	Z.REQ_DVSN_CD = #{reqDvsnCd}
   										AND		Z.ACP_YR = #{acpYr}
   										AND		Z.CVPT_ACP_NO = #{cvptAcpNo})
   					,A.DOC_TYP_CD = (SELECT 	Z.DOC_TYP_CD
   										FROM 	TBCSPDCP201M Z
   										WHERE 	Z.REQ_DVSN_CD = #{reqDvsnCd}
   										AND		Z.ACP_YR = #{acpYr}
   										AND		Z.CVPT_ACP_NO = #{cvptAcpNo})
   			WHERE	A.REQ_DVSN_CD = #{sucReqDvsnCd}
   			AND		A.ACP_YR = #{sucAcpYr}
   			AND		A.CVPT_ACP_NO = #{sucCvptAcpNo}
   		]]>
   	</update>
	<update id="CSPDCP516P101Update" parameterType="paramMap">
   		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516P101Update */
		<![CDATA[
			UPDATE	TBCSPDCP101M A
			SET		A.CVPT_HNDL_STA_CD = #{hndlStaCd}
					,A.CVPT_KND_CD = (SELECT	Z.CVPT_KND_CD
									FROM	TBCSPDCP101M Z
									WHERE 	Z.REQ_DVSN_CD = #{reqDvsnCd}
									AND		Z.ACP_YR = #{acpYr}
 									AND		Z.CVPT_ACP_NO = #{cvptAcpNo})
					,A.FNL_USR_ID = #{fnlUsrId}
   					,A.FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,A.FNL_MNU_ID = #{fnlMnuId}
   					,A.FNL_MDF_DH = SYSDATE
			WHERE	A.REQ_DVSN_CD = #{sucReqDvsnCd}
			AND		A.ACP_YR = #{sucAcpYr}
			AND		A.CVPT_ACP_NO = #{sucCvptAcpNo}
		]]>
	</update>

	<update id="CSPDCP516E202DtbInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516E202DtbInsert */
		<![CDATA[
			INSERT INTO	TBCSPDCP202H
        				(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,CVPT_DTB_HST_SRNO
        					,DTB_DPT_CD
        					,DTB_PEN_ID
        					,CVPT_HNDL_STA_CD
        					,HNDL_DPT_CD
        					,HNDL_CHGR_ID
        					,RDTB_RQS_RSN
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#{sucReqDvsnCd}
							,#{sucAcpYr}
							,#{sucCvptAcpNo}
							,(	SELECT NVL(MAX(CVPT_DTB_HST_SRNO),0)+1
								  FROM TBCSPDCP202H
								 WHERE 1=1
							       AND REQ_DVSN_CD = #{sucReqDvsnCd}
							       AND ACP_YR = #{sucAcpYr}
							       AND CVPT_ACP_NO = #{sucCvptAcpNo}
							 )
							,F_USR_INFO(#{sCnb},'5')
							,F_USR_INFO(#{sCnb},'1')
							,#{hndlStaCd}
							,#{hndlDptCd}
							,#{hndlChgrId}
							,#{rdtbRqsRsn}
							,F_USR_INFO(#{sCnb},'1')
							,#{fnlUsrId}
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
						)
		]]>
	</update>

	<insert id="CSPDCP516ESmgInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516ESmgInsert */
		<![CDATA[
			INSERT INTO	T_IC_TARGET_SRC_INTERFACE
						(	INTERFACE_KEY
							,APP_ORGAN_CODE		/*최초 민원 신청 기관코드(GCC)*/
							,PETI_NO			/*민원신청번호*/
							,REC_SEQ			/*분류이력일련번호*/
							,CIVIL_NO			/*민원접수번호*/
							,PETI_GUBUN			/*민원구분 (500고정,담당자부서지정) */
							,CANCEL_STATUS		/*민원취하여부(Default N)*/
							,PCD_DEPT			/*GCC 부서코드 (접수부서코드)*/
							,PCD_DEPT_NM		/*GCC 부서명 (접수부서명)*/
							,PCD_DUTY_ID		/*접수자명*/
							,PCD_EMAIL			/*접수 이메일 (대표이메일 사용, 감청국, 센터 로 분류)*/
							,PCD_TEL			/*접수자 전화번호 (대표전화 사용: 감청국, 센터로 분류)*/
							,PCD_ORGAN_CODE 	/*실처리기관코드 (감사원 GCC 코드로 고정)*/
							,SRCORGCD			/*소스기관코드 (감사원 GCC 코드로 고정)*/
							,TGTORGCD			/*타겟기관코드 (신문고 GCC 코드로 고정)*/
							,WRITE_TIME			/*등록일자*/
							,SND_RCV_GUBUN		/*송수신구분 (1:송신, 2:수신)*/
							,SND_RCV_TIME		/*송수신일자*/
							,SEND_YN			/*송신여부 (N DEFAULT, EAI 가 송신후 Y로 변경함)*/
						)
				SELECT	TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF2') || LPAD(ROUND(DBMS_RANDOM.VALUE(1, 999999999)), 9, '0')
						,SMG_FRT_CVPT_APL_GCC_ORG_CD
							,SMG_CVPT_APL_NO
							,SMG_CAT_HST_SRNO
							,SMG_CVPT_ACP_NO
							,'500'
							,'N'
							,(	SELECT	SUBSTR(STND_DPT_CD,9,7)
		   						FROM 	TBDCMACM002M S1
		   						WHERE 	S1.DPT_CD = #{fnlDealDptCd}
		   						)  
							,(	SELECT	S2.ALL_ORG_NM
		   						FROM 	TBDCMACM002M S1
		   								,TBCSPIIT006M S2
		   						WHERE 	S1.DPT_CD = #{fnlDealDptCd}
		   						AND		S2.GCC_ORG_CD = SUBSTR(S1.STND_DPT_CD,9,7)
		   						AND ROWNUM = 1
		   						) 
							,F_USR_INFO(#{sCnb},'2')
							,''
							,'02-2011-2191'
							,'1040000'
							,'1040000'
							,'1140100'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'1'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
							,'N'
				FROM	TBCSPDCP101M
				WHERE	REQ_DVSN_CD = #{sucReqDvsnCd}
				AND		ACP_YR = #{sucAcpYr}
				AND		CVPT_ACP_NO = #{sucCvptAcpNo}
		]]>
	</insert>

	<delete id="CSPDCP516P206Delete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516P206Delete */
		<![CDATA[
			DELETE	/*CSPDCP516P206Delete*/
			FROM	TBCSPDCP206L
			WHERE	REQ_DVSN_CD = #{sucReqDvsnCd}
			AND		ACP_YR = #{sucAcpYr}
			AND		CVPT_ACP_NO = #{sucCvptAcpNo}
		]]>
	</delete>

	<delete id="CSPDCP516P205Delete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516P205Delete */
		<![CDATA[
			DELETE	/*CSPDCP516P205Delete*/
			FROM	TBCSPDCP205L
			WHERE	REQ_DVSN_CD = #{sucReqDvsnCd}
			AND		ACP_YR = #{sucAcpYr}
			AND		CVPT_ACP_NO = #{sucCvptAcpNo}
		]]>
	</delete>

	<insert id="CSPDCP516P205SucInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516P205SucInsert */
		<![CDATA[
			INSERT INTO	/*CSPDCP516P205SucInsert*/
						TBCSPDCP205L
						(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,SRNO
        					,CVPT_HNDL_DVSN_CD
        					,AUD_RFR_MTRL_TRNF_DPT_CD
        					,TRNF_DPT_CD
        					,DOC_ID
        					,DOC_TYP_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		SELECT	#{sucReqDvsnCd}
	        			,#{sucAcpYr}
	        			,#{sucCvptAcpNo}
       					,SRNO
       					,CVPT_HNDL_DVSN_CD
       					,AUD_RFR_MTRL_TRNF_DPT_CD
       					,TRNF_DPT_CD
       					,DOC_ID
       					,DOC_TYP_CD
       					,FRT_USR_ID
       					,FNL_USR_ID
       					,FNL_DEAL_DPT_CD
       					,FNL_MNU_ID
       					,SYSDATE
       					,SYSDATE
        		FROM	TBCSPDCP205L
        		WHERE	(REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO) IN ( 	SELECT	#{reqDvsnCd},#{acpYr},#{cvptAcpNo}
        														FROM 	DUAL )
		]]>
	</insert>

	<insert id="CSPDCP516P206SucInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516P206SucInsert */
		<![CDATA[
			INSERT INTO	/*CSPDCP516P206SucInsert*/
						TBCSPDCP206L
						(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,HNDL_ORG_SRNO
        					,ORG_HIS_DVSN_CD
        					,SRNO
        					,ORG_CD
        					,PUB_DVSN_CD
        					,COPT_SG_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        					,ORG_NM
        					,OGN_ORG_DVSN_CD
        				)
        	SELECT	#{sucReqDvsnCd}
        			,#{sucAcpYr}
        			,#{sucCvptAcpNo}
        			,HNDL_ORG_SRNO
        			,ORG_HIS_DVSN_CD
        			,SRNO
  					,ORG_CD
  					,PUB_DVSN_CD
  					,COPT_SG_CD
  					,FRT_USR_ID
  					,FNL_USR_ID
  					,FNL_DEAL_DPT_CD
  					,FNL_MNU_ID
  					,SYSDATE
  					,SYSDATE
  					,ORG_NM
  					,OGN_ORG_DVSN_CD
        	FROM	TBCSPDCP206L
        	WHERE	(REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO) IN ( 	SELECT	#{reqDvsnCd},#{acpYr},#{cvptAcpNo}
        													FROM 	DUAL )
		]]>
	</insert>

	<delete id="CSPDCP516P105SucDelete" parameterType="paramMap">
   		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516P105SucDelete */
	   	<![CDATA[
	   		DELETE	/*CSPDCP516P105SucDelete*/
	   		FROM	TBCSPDCP953L
	   		WHERE	REQ_DVSN_CD = #{reqDvsnCd}
	   		AND		ACP_YR = #{acpYr}
	   		AND		CVPT_ACP_NO = #{cvptAcpNo}
	   		AND		SUC_REQ_DVSN_CD = #{sucReqDvsnCd}
	   		AND		SUC_ACP_YR = #{sucAcpYr}
	   		AND		SUC_CVPT_ACP_NO = #{sucCvptAcpNo}
	   	]]>
   	</delete>

	<update id="CSPDCP516PSucHndlDdlnDtUpdate" parameterType="paramMap">
   		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516PSucHndlDdlnDtUpdate */
	   	<![CDATA[
	   		UPDATE TBCSPDCP101M
	   		   SET HNDL_DDLN_DT = F_GET_NEXT_WORK_DT(TO_CHAR(ACP_DH,'YYYYMMDD'),30+NVL(NTF_EXTN_DCN,0)+NVL(SCEN_CFM_EXTN_DCN,0))
	   		      ,BK_HNDL_DDLN_DT = HNDL_DDLN_DT
	   		 WHERE REQ_DVSN_CD = #{sucReqDvsnCd}
	   		   AND ACP_YR = #{sucAcpYr}
	   		   AND CVPT_ACP_NO = #{sucCvptAcpNo}
	   	]]>
   	</update>

	<!-- 접수일자 + 30일 -->
   	<select id="CSPDCP516PSelectMaxAcpDh" parameterType="paramMap" resultType="String">
   		<![CDATA[
   			/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516PSelectMaxAcpDh */
   			SELECT F_GET_NEXT_WORK_DT(TO_CHAR(MAX(ACP_DH),'YYYYMMDD'),30)  FROM (
					SELECT ACP_DH
					  FROM TBCSPDCP101M T1, TBCSPDCP105L T2
					 WHERE T1.REQ_DVSN_CD = T2.SUC_REQ_DVSN_CD
					   AND T1.ACP_YR = T2.SUC_ACP_YR
					   AND T1.CVPT_ACP_NO = T2.SUC_CVPT_ACP_NO
					   AND T2.REQ_DVSN_CD = #{reqDvsnCd}
					   AND T2.ACP_YR = #{acpYr}
					   AND T2.CVPT_ACP_NO = #{cvptAcpNo}
					UNION ALL
					SELECT ACP_DH
					  FROM TBCSPDCP101M T1
					 WHERE T1.REQ_DVSN_CD =#{reqDvsnCd}
					   AND T1.ACP_YR = #{acpYr}
					   AND T1.CVPT_ACP_NO =#{cvptAcpNo}
				)   
   		]]>
   	</select>

	<update id="CSPDCP516PHndlDdlnDtUpdate" parameterType="paramMap">
   		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP511Mapper.CSPDCP516PHndlDdlnDtUpdate */
	   	<![CDATA[
	   		UPDATE TBCSPDCP101M T1
	   		   SET HNDL_DDLN_DT = #{acpDh}
                  , SCEN_CFM_EXTN_DCN = 0
                  , NTF_EXTN_DCN = 0
	   		   	  ,BK_HNDL_DDLN_DT = #{acpDh}
	   		 WHERE T1.REQ_DVSN_CD =#{reqDvsnCd}
			   AND T1.ACP_YR = #{acpYr}
			   AND T1.CVPT_ACP_NO =#{cvptAcpNo}
	   	]]>
   	</update>

	<select id="CSPDCP516PSelectHndlDdlDt" parameterType="paramMap" resultType="String">
   		<![CDATA[
   			SELECT HNDL_DDLN_DT
   			  FROM TBCSPDCP101M T1
   			 WHERE 1=1
   			   AND T1.REQ_DVSN_CD = #{reqDvsnCd}
			   AND T1.ACP_YR = #{acpYr}
			   AND T1.CVPT_ACP_NO = #{cvptAcpNo}
   		]]>
   	</select>
   	
   	<update id="CSPDCP516PSucAllHndlDdlnDtUpdate" parameterType="paramMap">
   		<![CDATA[
   			UPDATE TBCSPDCP101M T1
   			   SET HNDL_DDLN_DT = #{hndlDdlnDt}
   			      ,BK_HNDL_DDLN_DT = HNDL_DDLN_DT
   			 WHERE 1=1
   			   AND (T1.REQ_DVSN_CD, T1.ACP_YR, T1.CVPT_ACP_NO) 
   			      IN (SELECT S1.SUC_REQ_DVSN_CD, S1.SUC_ACP_YR, S1.SUC_CVPT_ACP_NO
   			            FROM TBCSPDCP105L S1
   			           WHERE S1.REQ_DVSN_CD = #{reqDvsnCd} 
   			             AND S1.ACP_YR = #{acpYr}
   			             AND S1.CVPT_ACP_NO = #{cvptAcpNo}
   			        )
   		]]>
   	</update>
	<!-- 합건 끝 2022.06.29 이해창 -->

</mapper>
