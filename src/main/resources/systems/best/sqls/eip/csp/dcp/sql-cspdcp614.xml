<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP614Mapper">
 	
 	<resultMap type="java.util.HashMap" id="mainMap">
	
	<result property="cvPetCateNm" column="CV_PET_CATE_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="cvPetCateCd" column="CV_PET_CATE_CD" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="jubsuno" column="JUBSUNO" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="acctRouteCd" column="ACCT_ROUTE_CD" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="acctRouteNm" column="ACCT_ROUTE_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="cvPeterNm" column="CV_PETER_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="cvPeterRelOrgNm" column="CV_PETER_REL_ORG_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="cvPeterEmail" column="CV_PETER_EMAIL" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="cvPeterTel" column="CV_PETER_TEL" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="cvPeterTel2" column="CV_PETER_TEL2" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="cvPeterTelRmk" column="CV_PETER_TEL_RMK" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="cvPeterAddr" column="CV_PETER_ADDR" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="gwanno" column="GWANNO" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="tranOrgNm" column="TRAN_ORG_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="acctDate" column="ACCT_DATE" jdbcType="VARCHAR"	javaType="java.lang.String" />
	
	<result property="summPsonDeptNm" column="SUMM_PSON_DEPT_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="acctUsrNm" column="ACCT_USR_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="title" column="TITLE" jdbcType="VARCHAR"	javaType="java.lang.String" />
	
	<result property="usrNam" column="USR_NAM" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="relOrgNm" column="REL_ORG_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
     <result property="supOrgNm" column="SUP_ORG_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
    
    <result property="cvPetOriginNm" column="CV_PET_ORIGIN_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="cvPetCauseNm" column="CV_PET_CAUSE_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
    <result property="cvPetHndlDircNm" column="CV_PET_HNDL_DIRC_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
    <result property="frequentOccurYn" column="FREQUENT_OCCUR_YN" jdbcType="VARCHAR"	javaType="java.lang.String" />
    <result property="budgetWasteYn" column="BUDGET_WASTE_YN" jdbcType="VARCHAR"	javaType="java.lang.String" />
    <result property="personalProtectYn" column="PERSONAL_PROTECT_YN" jdbcType="VARCHAR"	javaType="java.lang.String" />
    <result property="hndlOrgNm" column="HNDL_ORG_NM" jdbcType="VARCHAR"	javaType="java.lang.String" />
    <result property="apvDate" column="APV_DATE" jdbcType="VARCHAR"	javaType="java.lang.String" /> 
    <result property="operDate" column="OPER_DATE" jdbcType="VARCHAR"	javaType="java.lang.String" />
    <result property="operDegree" column="OPER_DEGREE" jdbcType="VARCHAR"	javaType="java.lang.String" />
	<result property="operReason" column="OPER_REASON" jdbcType="VARCHAR"	javaType="java.lang.String" />
	
	<result property="cvPetSumm" column="CV_PET_SUMM" jdbcType="CLOB"	javaType="java.lang.String" />
	<result property="smgCvptAplNo" column="SMG_CVPT_APL_NO" jdbcType="VARCHAR"	javaType="java.lang.String" />
			
    </resultMap>
 	
 	
 	<select id="CSPDCP614QSelectMain" parameterType="paramMap"
		resultMap="mainMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP614Mapper.CSPDCP614QSelectMain */
		<![CDATA[
		 SELECT D1.CV_PET_CATE_CD
		       ,(SELECT S1.CD_NM
				  FROM CM_ETCCD S1
				 WHERE S1.CD_TYPE = 'AS09'
				   AND S1.CD      = D1.CV_PET_CATE_CD) CV_PET_CATE_NM
		       ,D1.YEAR||'-'||D1.CV_PET_CATE_CD||'-'||D1.ACCT_NO AS JUBSUNO
		       ,D1.ACCT_ROUTE_CD
		       ,(SELECT S2.CD_NM
		           FROM CM_ETCCD S2
		          WHERE S2.CD_TYPE = 'AS18'
		            AND S2.CD = D1.ACCT_ROUTE_CD) AS ACCT_ROUTE_NM
		       ,D1.CV_PETER_NM
		       ,D1.CV_PETER_REL_ORG_NM
		       ,D1.CV_PETER_EMAIL
		       ,D1.CV_PETER_TEL
		       ,D1.CV_PETER_TEL2
		       ,D1.CV_PETER_TEL_RMK
		       ,D1.CV_PETER_ADDR
		       ,D1.LAST_REPEAT_YEAR||NVL2(D1.LAST_REPEAT_YEAR, '-', '')||D1.LAST_REPEAT_ACCT_NO AS GWANNO
		       ,F_ORG_INFO(D1.TRAN_ORG_CD, '1') AS TRAN_ORG_NM
		       ,TO_CHAR(TO_DATE(D1.ACCT_DATE, 'YYYYMMDD'), 'YYYY.MM.DD') AS ACCT_DATE
		       ,F_DPT_INFO(D1.SUMM_PSON_DEPT_CD, '1') AS SUMM_PSON_DEPT_NM 
		       ,'' AS ACCT_USR_NM
		       ,D1.TITLE
		       ,D1.CV_PET_SUMM
		       ,(SELECT S3.USR_NAM FROM TBDCMACM001M S3 WHERE  S3.CNB = D1.SUMM_PSON_EMPLNUM) AS USR_NAM
		       ,F_ORG_INFO(D1.REL_ORG_CD, '1') AS REL_ORG_NM
		       ,F_ORG_INFO(D1.SUP_ORG_CD, '1') AS SUP_ORG_NM
		       ,(SELECT S6.CD_NM
		           FROM CM_ETCCD S6
		          WHERE S6.CD_TYPE = 'AS11'
		            AND S6.CD = D1.CV_PET_ORIGIN_CD) AS CV_PET_ORIGIN_NM
		       ,(SELECT S4.CD_NM
		           FROM CM_ETCCD S4
		          WHERE S4.CD_TYPE = 'AS12'
		            AND S4.CD = D1.CV_PET_CAUSE_CD)  AS CV_PET_CAUSE_NM
		       ,(SELECT S5.CD_NM
		           FROM CM_ETCCD S5
		          WHERE S5.CD_TYPE = 'AS13'
		            AND S5.CD = D1.CV_PET_HNDL_DIRC_CD)  AS CV_PET_HNDL_DIRC_NM
		       ,D1.FREQUENT_OCCUR_YN
		       ,D1.BUDGET_WASTE_YN
		       ,D1.PERSONAL_PROTECT_YN
		       ,F_ORG_INFO(NVL(D1.HNDL_ORG_CD_1, NVL(D1.HNDL_ORG_CD_2, D1.HNDL_ORG_CD_3)), '1') AS HNDL_ORG_NM
		       /*,TO_CHAR(TO_DATE(D1.APV_DATE,'YYYYMMDD'), 'YYYY.MM.DD') AS APV_DATE*/
		       ,D1.APV_DATE
		       ,TO_CHAR(TO_DATE(D1.OPER_DATE,'YYYYMMDD'), 'YYYY.MM.DD') AS OPER_DATE
		       ,D1.OPER_DEGREE
		       ,D1.OPER_REASON
		       ,D1.SMG_CVPT_APL_NO
		  FROM AM_CV_PET_HNDL_DOC D1
		 WHERE 1=1
		   AND D1.CV_PET_CATE_CD = #{cvPetCateCd}
		   AND D1.YEAR           = #{year}
		   AND D1.ACCT_NO        = #{acctNo}
   ]]>
	</select>
	
	<select id="CSPDCP614QTypeCheck" parameterType="paramMap"
		resultType="int">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP614Mapper.CSPDCP614QTypeCheck */
		<![CDATA[
		 SELECT COUNT(*)
		  FROM AM_CV_PET_HNDL_DOC 
		 WHERE 1=1
		   AND CV_PET_CATE_CD = #{cvPetCateCd}
		   AND YEAR           = #{year}
		   AND ACCT_NO        = #{acctNo}
		]]>
   		<if test='year lt "2006"'>
		   AND CV_PET_SUMM LIKE '%M8%'
		</if>
	</select>
 	
</mapper> 
