<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP121Mapper">
 	
 	<select id="CSPDCP121QMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP121Mapper.CSPDCP121QMainSelect */
		<![CDATA[
			SELECT T1.YM
			     , T1.INF_RPRT_NO
			     , T1.INF_TYP_CD
			     , T1.DOC_ID
			     , T1.TIT_NM
			     , T1.FRT_USR_ID AS USR_ID
			     , T2.USR_NAM
			     , T1.WRIT_STA_CD
			     , T1.SMT_DH
			     , F_CODE_NM('1000606', T1.WRIT_STA_CD) AS WRIT_STA_NM 
			     , '정보' || '-' || SUBSTR(T1.YM, 3, 4) || '-' || LPAD(T1.INF_RPRT_NO, 4, '0') AS INFNO
			     , CASE WHEN SUBSTR(T1.INF_TYP_CD, 0, 2) = '01' THEN F_CODE_NM('1000607', '0100')||' - '||F_CODE_NM('1000607', T1.INF_TYP_CD)
			            WHEN SUBSTR(T1.INF_TYP_CD, 0, 2) = '02' THEN F_CODE_NM('1000607', '0200')||' - '||F_CODE_NM('1000607', T1.INF_TYP_CD) END AS INFNM
			  FROM TBCSPDCP501M T1
                 , TBDCMACM001M T2
			 WHERE 1=1	
   			   AND T1.FRT_USR_ID = T2.USR_ID(+)
		]]>
		<if test='writStaCd != null and writStaCd != ""'>
		    AND T1.WRIT_STA_CD = #{writStaCd}
			</if>
		<if test='infTypCd != null and infTypCd != ""'>
			AND T1.INF_TYP_CD  = #{infTypCd}
			</if>
		<if test='titNm != null and titNm != ""'>
			AND T1.TIT_NM LIKE '%'||#{titNm}||'%'
			</if>
		<if test='startdt != null and startdt != ""'>
		<if test='enddt != null and enddt != ""'>
			    AND TO_CHAR(T1.FRT_REGI_DH, 'YYYYMMDD') BETWEEN #{startdt} AND #{enddt}
				</if>
			</if>
		<if test='startdt != null and startdt != ""'>
		<if test='enddt == null or enddt == ""'>
				AND TO_CHAR(T1.FRT_REGI_DH, 'YYYYMMDD') BETWEEN #{startdt} AND TO_CHAR(SYSDATE, 'YYYYMMDD')
				</if>
			</if>
				 
		ORDER BY T1.YM DESC, T1.INF_RPRT_NO DESC
	</select>
	
	<select id="CSPDCP121QMainCount" resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP121Mapper.CSPDCP121QMainCount */
	 	SELECT  
			   COUNT(T1.YM) AS TOTALCNT ,
		       SUM(
		                       CASE
		                         WHEN SUBSTR(T1.INF_TYP_CD, 0, 2) = '01' THEN 1
		                         ELSE 0
		                       END) AS INFTYP01CNT ,
		       SUM(
		                       CASE
		                         WHEN SUBSTR(T1.INF_TYP_CD, 0, 2) = '02' THEN 1
		                         ELSE 0
		                       END) AS INFTYP02CNT
		  FROM TBCSPDCP501M T1 ,
		       TBDCMACM001M T2
		 WHERE 1=1
		   AND T1.FRT_USR_ID = T2.USR_ID(+)
	</select>
	
	
	<update id="CSPDCP121QWrtStatusUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP121Mapper.CSPDCP121QWrtStatusUpdate */
			UPDATE TBCSPDCP501M
			   SET WRIT_STA_CD     = #{writStaCd}
			      ,SMT_DH          = CASE WHEN #{writStaCd} = '20' THEN SYSDATE ELSE NULL END
			      ,FNL_USR_ID      = #{fnlUsrId}
   				  ,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   				  ,FNL_MNU_ID      = #{fnlMnuId}
   				  ,FNL_MDF_DH      = SYSDATE 
			 WHERE YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
	</update>
	
	<delete id="CSPDCP121QDelete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP121Mapper.CSPDCP121QDelete */
			DELETE 
			  FROM TBCSPDCP501M
			 WHERE YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
	</delete>
</mapper> 
