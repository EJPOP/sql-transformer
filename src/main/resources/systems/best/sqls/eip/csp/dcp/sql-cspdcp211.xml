<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP211Mapper">

	<select id="CSPDCP211EMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP211Mapper.CSPDCP211EMainSelect */
		<include refid="include.pageSelct" />
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.RM_CVPT_ACP_NO
   					,DECODE(A.RM_CVPT_ACP_NO,NULL,'-',A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO) AS ACP_NO
   					,DECODE(A.PRE_RM_CVPT_ACP_NO,NULL,'-',A.ACP_YR||'-'|| F_CODE_NM('1000949', A.PRE_RM_ACP_KND_CD) ||'-'||A.PRE_RM_CVPT_ACP_NO) AS PRE_ACP_NO /* BEST20 이전접수번호 */
   					,A.CVPT_KND_CD
   					,F_CODE_NM('1000047', A.CVPT_KND_CD) AS CVPT_KND_NM
   					,A.TIT_NM
   					,A.REQR_KND_CD
   					,A.ACP_RUT_CD
   					,F_CODE_NM('1000056', A.ACP_RUT_CD) AS ACP_RUT_NM
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
   					,A.CVPT_HNDL_STA_CD
   					,F_CODE_NM('1000361', A.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
   					,A.HPN
   					,TO_CHAR(A.FRT_REGI_DH,'YYYY-MM-DD') AS ACT_DT
   					,NVL2(A.RAL_ACP_DPT_CD, (SELECT	S1.CD_NM FROM TBDCMACM013C S1 WHERE S1.CMM_CD_DVSN_CD = '1000144' AND S1.CD = A.RAL_ACP_DPT_CD)
   					                        ,(SELECT	S1.DPT_NM FROM 	TBDCMACM002M S1 WHERE 	S1.DPT_CD = A.ACP_DPT_CD) 
   					) AS ACP_DPT_NM
   					,(	SELECT	S1.DPT_NM
   						FROM 	TBDCMACM002M S1
   						WHERE 	S1.DPT_CD = C.HNDL_DPT_CD
   						)  AS HNDL_DPT_NM
   					,F_USR_INFO_BY_ID(C.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
   					,TO_CHAR(A.CVPT_WDW_DH,'YYYY-MM-DD HH24:MI') AS CVPT_WDW_DH
   					,(	SELECT	F_CODE_NM('1000754', S3.CVPT_HNDL_DVSN_CD)
			      		FROM	TBCSPDCP205L S3
			      		WHERE	(S3.REQ_DVSN_CD, S3.ACP_YR, S3.CVPT_ACP_NO, S3.SRNO) IN (	SELECT	S4.REQ_DVSN_CD,S4.ACP_YR,S4.CVPT_ACP_NO,MIN(S4.SRNO)
			      																		FROM	TBCSPDCP205L S4
			      																		WHERE	A.REQ_DVSN_CD = S4.REQ_DVSN_CD
			      																		AND		A.ACP_YR = S4.ACP_YR
			      																		AND		A.CVPT_ACP_NO = S4.CVPT_ACP_NO
			      																		GROUP BY S4.REQ_DVSN_CD,S4.ACP_YR,S4.CVPT_ACP_NO
			      																	)
			      ) AS CVPT_HNLD_DVSN_NM
			      ,TO_CHAR(D.ONR_APV_CMPT_DH,'YYYY-MM-DD') AS ONR_APV_CMPT_DH
			      ,(	SELECT	TO_CHAR(TO_DATE(TO_CHAR(S2.ONR_APV_CMPT_DH, 'YYYYMMDD'), 'YYYYMMDD') + NVL( S1.USR_DFN_TXT_2, 30), 'YYYY-MM-DD')
                    	FROM	TBDCMACM013C S1, TBCSPDCP205L D3, TBCSPDCP301M S2
                    	WHERE	S1.CMM_CD_DVSN_CD = '1000754'
                    	AND		S1.CD <> '000000000'
                    	AND     S1.CD  = D3.CVPT_HNDL_DVSN_CD
                    	AND		A.REQ_DVSN_CD = D3.REQ_DVSN_CD
			   			AND		A.ACP_YR = D3.ACP_YR
			   			AND		A.CVPT_ACP_NO = D3.CVPT_ACP_NO
			   			AND		A.REQ_DVSN_CD = S2.REQ_DVSN_CD
			   			AND		A.ACP_YR = S2.ACP_YR
			   			AND		A.CVPT_ACP_NO = S2.CVPT_ACP_NO
			   			AND		S2.CVPT_IFM_DVSN_CD = 'C'
			   			AND		S2.CVPT_OPM_APV_HNDL_STA_CD = '30'
                    	AND (D3.REQ_DVSN_CD, D3.CVPT_ACP_NO, D3.ACP_YR, D3.SRNO ) IN (	SELECT	Z.REQ_DVSN_CD, Z.CVPT_ACP_NO, Z.ACP_YR, MIN(Z.SRNO)
			   																	FROM	TBCSPDCP205L Z
			   																	WHERE	A.REQ_DVSN_CD = Z.REQ_DVSN_CD
			   																	AND		A.CVPT_ACP_NO = Z.CVPT_ACP_NO
			   																	AND		A.ACP_YR = Z.ACP_YR
			   																	GROUP BY Z.REQ_DVSN_CD, Z.CVPT_ACP_NO, Z.ACP_YR
			   																)) AS HNDL_LIMIT__DT
			   		,TO_CHAR(TO_DATE(A.HNDL_DDLN_DT),'YYYY-MM-DD') AS HNDL_LIMIT_DT_PRCS
					, F_CODE_NM('1000599',A.CVPT_KND_DVSN_CD) AS CVPT_KND_DVSN_NM
					, A.RM_ACP_KND_CD 
   			FROM	TBCSPDCP101M A /*민원접수기본*/
   					,TBCSPDCP102M B /*민원접수내용기본*/
   					,TBCSPDCP201M C /*민원처리기본*/
   					,TBCSPDCP301M D /*민원시행문기본*/
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = '1' /*청구구분코드 : 제보*/
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		A.REQ_DVSN_CD = D.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = D.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = D.CVPT_ACP_NO(+)
   			AND		D.CVPT_IFM_DVSN_CD(+) = 'A' /*민원통지구분코드 */
		]]>
		<if test='acpDhs != null and acpDhs != ""'>
			AND TO_CHAR(A.FRT_REGI_DH,'YYYYMMDD') &gt;= #{acpDhs}
		</if>
		<if test='acpDhe != null and acpDhe != ""'>
			AND TO_CHAR(A.FRT_REGI_DH,'YYYYMMDD') &lt;= #{acpDhe}
		</if>
		<if test='cvptHndlStaCd != null and cvptHndlStaCd != ""'>
			AND A.CVPT_HNDL_STA_CD = #{cvptHndlStaCd}
		</if>
		<if test='titNm != null and titNm != ""'>
			AND A.TIT_NM LIKE '%'||#{titNm}||'%'
		</if>
		<if test='hmpAplNo != null and hmpAplNo != ""'>
			AND A.HMP_APL_NO = #{hmpAplNo}
		</if>
		<if test='acpYr != null and acpYr != ""'>
			AND A.ACP_YR = #{acpYr}
		</if>
		/* BEST20 이전접수번호 조회 */
		<choose>
			<when test='reqDvsnCd != null and reqDvsnCd != "" and rmCvptAcpNo != null and rmCvptAcpNo != ""'>
				 AND ((A.RM_ACP_KND_CD = #{reqDvsnCd} AND A.RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0)) OR
				         (A.PRE_RM_ACP_KND_CD = #{reqDvsnCd}  AND A.PRE_RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0)))  
			</when>
			<otherwise>
				<if test='reqDvsnCd != null and reqDvsnCd != ""'>
					AND (A.RM_ACP_KND_CD = #{reqDvsnCd})  
				</if>
				<if test='rmCvptAcpNo != null and rmCvptAcpNo != ""'>
					AND (A.RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0) OR A.PRE_RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0))
				</if>
			</otherwise>
		</choose>
		<if test='smgCvptAplNo != null and smgCvptAplNo != ""'>
			AND A.SMG_CVPT_APL_NO = #{smgCvptAplNo}
		</if>
		<if test='cvptrNm != null and cvptrNm != ""'>
			AND (A.CVPTR_NM LIKE '%'||#{cvptrNm}||'%' OR A.RPST_PEN_NM LIKE
			'%'||#{cvptrNm}||'%')
		</if>
		<if test='reqrKndCd != null and reqrKndCd != ""'>
			AND A.REQR_KND_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{reqrKndCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='cvptKndCd != null and cvptKndCd != ""'>
			AND A.CVPT_KND_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{cvptKndCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='acpRutCd != null and acpRutCd != ""'>
			AND A.ACP_RUT_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{acpRutCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>
		
		<if test='mngTypCd != null and mngTypCd != ""'>
			AND A.MNG_TYP_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{mngTypCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>
		<if test='tgOrgCatCd1 != null and tgOrgCatCd1 != ""'>
			AND (SELECT AA.USR_DFN_TXT_1
			         FROM TBDCMACM013C AA
			        WHERE AA.CD = A.TG_ORG_CAT_CD
		               AND AA.CMM_CD_DVSN_CD = '1000948') = #{tgOrgCatCd1}
		</if>
		<if test='tgOrgCatCd2 != null and tgOrgCatCd2 != ""'>
			AND (SELECT AA.USR_DFN_TXT_2
			         FROM TBDCMACM013C AA
			        WHERE AA.CD = A.TG_ORG_CAT_CD
		               AND AA.CMM_CD_DVSN_CD = '1000948') = #{tgOrgCatCd2}
		</if>
		<if test='tgOrgCatCd3 != null and tgOrgCatCd3 != ""'>
			AND A.TG_ORG_CAT_CD = #{tgOrgCatCd3}
		</if>
		
		<if test='mainFuncCatCd != null and mainFuncCatCd != ""'>
			AND A.MAIN_FUNC_CAT_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{mainFuncCatCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>
		
		<![CDATA[
			ORDER BY A.ACP_DH DESC
		]]>
		<include refid="include.pageOrder" />
	</select>

	<select id="CSPDCP211ECheckSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP211Mapper.CSPDCP211ECheckSelect */
		<![CDATA[
			SELECT  CVPT_HNDL_STA_CD	/*진행상태*/
			         , ACP_YR
			         , REQ_DVSN_CD
			         , CVPT_ACP_NO
			FROM	TBCSPDCP101M
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</select>

	<update id="CSPDCP211EReceiptUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP211Mapper.CSPDCP211EReceiptUpdate */
		<![CDATA[
			UPDATE	TBCSPDCP101M
			SET		CVPT_HNDL_STA_CD = '20'
					,ACP_DPT_CD = F_USR_INFO(#{sCnb},'5')
					,RCEP_ID = F_USR_INFO(#{sCnb},'1')
					,RAL_ACP_DPT_CD = (
   			       		SELECT RAL_BLT_DIV_CD
						  FROM TBDCMACM001M
						 WHERE USR_ID = #{fnlUsrId}
   			         )
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
   					,SCEN_CFM_EXTN_DCN =0
        			,NTF_EXTN_DCN =0
         ]]> 			
         <if test='acpRutCd != "8"'>
        			,ACP_DH = SYSDATE
        			,HNDL_DDLN_DT = F_GET_NEXT_WORK_DT(TO_CHAR(SYSDATE,'YYYYMMDD'),30)
        </if>
         <if test='acpRutCd == "8"'>
        			,HNDL_DDLN_DT = F_GET_NEXT_WORK_DT(REGEXP_REPLACE(SUBSTR(#{acpDh},0,10),'[^[:digit:]]'),30)
        </if>
        <![CDATA[		
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<insert id="CSPDCP211EDCP202ReceiptInsert">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP211Mapper.CSPDCP211EDCP202ReceiptInsert */
		<![CDATA[
			INSERT INTO	TBCSPDCP202H
        				(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,CVPT_DTB_HST_SRNO
        					,DTB_DPT_CD
        					,DTB_PEN_ID
        					,CVPT_HNDL_STA_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#{reqDvsnCd}
							,#{acpYr}
							,#{cvptAcpNo}
							,(	SELECT NVL(MAX(CVPT_DTB_HST_SRNO),0)+1
								  FROM TBCSPDCP202H
								 WHERE 1=1
							       AND REQ_DVSN_CD = #{reqDvsnCd}
							       AND ACP_YR = #{acpYr}
							       AND CVPT_ACP_NO = #{cvptAcpNo}
							 )
							,#{fnlDealDptCd}
							,F_USR_INFO(#{sCnb},'1')
							,#{cvptHndlStaCd}
							,F_USR_INFO(#{sCnb},'1')
							,#{fnlUsrId}
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
						)
		]]>
	</insert>

	<update id="CSPDCP111EReceiptCancleUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP211Mapper.CSPDCP111EReceiptCancleUpdate */
		<![CDATA[
			UPDATE	TBCSPDCP101M
			SET		CVPT_HNDL_STA_CD = '21'
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<select id="CSPDCP211EExcelExportSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP211Mapper.CSPDCP211EExcelExportSelect */
		<![CDATA[
			SELECT	ROWNUM
   					,DECODE(A.RM_CVPT_ACP_NO,NULL,'',A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO) AS ACP_NO
   					,TO_CHAR(A.FRT_REGI_DH,'YYYY.MM.DD') AS ACT_DH
   					,TO_CHAR(A.ACP_DH,'YYYY.MM.DD') AS ACP_DH
   					,A.TIT_NM
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,NVL2(A.RAL_ACP_DPT_CD, (SELECT	S1.CD_NM FROM TBDCMACM013C S1 WHERE S1.CMM_CD_DVSN_CD = '1000144' AND S1.CD = A.RAL_ACP_DPT_CD)
   					                        ,(SELECT	S1.DPT_NM FROM 	TBDCMACM002M S1 WHERE 	S1.DPT_CD = A.ACP_DPT_CD) 
   					) AS ACP_DPT_NM
   					,F_USR_INFO_BY_ID(A.RCEP_ID,'2') AS RCEP_NM
   					,F_CODE_NM('1000056',A.ACP_RUT_CD) AS ACP_RUT_NM
   			FROM	TBCSPDCP101M A
   					,TBCSPDCP102M B
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = '1'
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
		]]>

		<if test='acpDhs != null and acpDhs != ""'>
			AND TO_CHAR(A.FRT_REGI_DH,'YYYYMMDD') &gt;= #{acpDhs}
		</if>
		<if test='acpDhe != null and acpDhe != ""'>
			AND TO_CHAR(A.FRT_REGI_DH,'YYYYMMDD') &lt;= #{acpDhe}
		</if>
		<if test='cvptHndlStaCd != null and cvptHndlStaCd != ""'>
			AND A.CVPT_HNDL_STA_CD = #{cvptHndlStaCd}
		</if>
		<if test='titNm != null and titNm != ""'>
			AND A.TIT_NM LIKE '%'||#{titNm}||'%'
		</if>
		<if test='acpYr != null and acpYr != ""'>
			AND A.ACP_YR = #{acpYr}
		</if>
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
			AND A.CVPT_ACP_NO = #{cvptAcpNo}
		</if>
		<if test='smgCvptAplNo != null and smgCvptAplNo != ""'>
			AND A.SMG_CVPT_APL_NO = #{smgCvptAplNo}
		</if>
		<if test='cvptrNm != null and cvptrNm != ""'>
			AND (A.CVPTR_NM LIKE '%'||#{cvptrNm}||'%' OR A.RPST_PEN_NM LIKE
			'%'||#{cvptrNm}||'%')
		</if>
		<if test='reqrKndCd != null and reqrKndCd != ""'>
			AND A.REQR_KND_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{reqrKndCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='cvptKndCd != null and cvptKndCd != ""'>
			AND A.CVPT_KND_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{cvptKndCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='acpRutCd != null and acpRutCd != ""'>
			AND A.ACP_RUT_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{acpRutCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='mngTypCd != null and mngTypCd != ""'>
			AND A.MNG_TYP_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{mngTypCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>
		<![CDATA[
			ORDER BY A.ACP_DH DESC
		]]>
	</select>

	<insert id="CSPDCP211ESmgInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP211Mapper.CSPDCP211ESmgInsert */
		<![CDATA[
			INSERT INTO	T_IC_TARGET_SRC_INTERFACE
						(	INTERFACE_KEY
							,APP_ORGAN_CODE		/*최초 민원 신청 기관코드(GCC)*/
							,PETI_NO			/*민원신청번호*/
							,REC_SEQ			/*분류이력일련번호*/
							,CIVIL_NO			/*민원접수번호*/
							,PETI_GUBUN			/*민원구분 (500고정,담당자부서지정) */
							,CANCEL_STATUS		/*민원취하여부(Default N)*/
							,PCD_DEPT			/*GCC 부서코드 (접수부서코드)*/
							,PCD_DEPT_NM		/*GCC 부서명 (접수부서명)*/
							,PCD_DUTY_ID		/*접수자명*/
							,PCD_EMAIL			/*접수 이메일 (대표이메일 사용, 감청국, 센터 로 분류)*/
							,PCD_TEL			/*접수자 전화번호 (대표전화 사용: 감청국, 센터로 분류)*/
							,PCD_ORGAN_CODE 	/*실처리기관코드 (감사원 GCC 코드로 고정)*/
							,SRCORGCD			/*소스기관코드 (감사원 GCC 코드로 고정)*/
							,TGTORGCD			/*타겟기관코드 (신문고 GCC 코드로 고정)*/
							,WRITE_TIME			/*등록일자*/
							,SND_RCV_GUBUN		/*송수신구분 (1:송신, 2:수신)*/
							,SND_RCV_TIME		/*송수신일자*/
							,SEND_YN			/*송신여부 (N DEFAULT, EAI 가 송신후 Y로 변경함)*/
							,PETI_END           /*처리기한*/
							,ORGAN_REG_DATE     /*접수일*/ 
						)
				SELECT	TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF2') || LPAD(ROUND(DBMS_RANDOM.VALUE(1, 999999999)), 9, '0')
						,SMG_FRT_CVPT_APL_GCC_ORG_CD
							,SMG_CVPT_APL_NO
							,SMG_CAT_HST_SRNO
							,SMG_CVPT_ACP_NO
							,'500'
							,'N'
							,(	SELECT	SUBSTR(STND_DPT_CD,9,7)
		   						FROM 	TBDCMACM002M S1
		   						WHERE 	S1.DPT_CD = #{fnlDealDptCd}
		   						)  
							,(	SELECT	S2.ALL_ORG_NM
		   						FROM 	TBDCMACM002M S1
		   								,TBCSPIIT006M S2
		   						WHERE 	S1.DPT_CD = #{fnlDealDptCd}
		   						AND		S2.GCC_ORG_CD = SUBSTR(S1.STND_DPT_CD,9,7)
		   						AND ROWNUM = 1
		   						)  
							,F_USR_INFO(#{sCnb},'2')
							,''
							,'02-2011-2191'
							,'1040000'
							,'1040000'
							,'1140100'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'1'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
							,'N'
							,TO_DATE(F_GET_NEXT_WORK_DT(TO_CHAR(ACP_DH,'YYYYMMDD'),30),'yyyy/mm/dd HH24:MI:SS') +1 -1/(24*60*60)
							,SUBSTR(REGEXP_REPLACE(ACP_DH,'[^[:digit:]]'),0,14)
				FROM	TBCSPDCP101M
				WHERE	REQ_DVSN_CD = #{reqDvsnCd}
				AND		ACP_YR = #{acpYr}
				AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</insert>


	<insert id="CSPDCP211E304MsgInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP211Mapper.CSPDCP211E304MsgInsert */
		<![CDATA[
			INSERT INTO	TBCSPDCP304L
						(	REQ_DVSN_CD
							,ACP_YR
							,CVPT_ACP_NO
							,CVPT_SMS_TRNM_HIS_SRNO
							,TRNM_HPN
							,RPL_TNB
							,SMS_TXT
							,TRNM_DH
							,FRT_USR_ID
	       					,FNL_USR_ID
	       					,FNL_DEAL_DPT_CD
	       					,FNL_MNU_ID
	       					,FRT_REGI_DH
	       					,FNL_MDF_DH
	       				)
       			VALUES	(	#{reqDvsnCd}
       						,#{acpYr}
       						,#{cvptAcpNo}
							,(	SELECT NVL(MAX(CVPT_SMS_TRNM_HIS_SRNO),0)+1
								  FROM TBCSPDCP304L
								 WHERE 1=1
							       AND REQ_DVSN_CD = #{reqDvsnCd}
							       AND ACP_YR = #{acpYr}
							       AND CVPT_ACP_NO = #{cvptAcpNo}
							 )
							,'02-2011-2191'
							,#{hpn}
							,#{smsTxt}
							,SYSDATE
							,F_USR_INFO(#{sCnb},'1')
							,F_USR_INFO(#{sCnb},'1')
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
						)

		]]>
	</insert>
</mapper>
