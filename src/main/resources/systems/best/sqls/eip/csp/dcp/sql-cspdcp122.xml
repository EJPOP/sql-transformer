<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper">
 	
 	<select id="CSPDCP122ECodeSelect" parameterType="paramMap" resultType="egovMap">
 		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122ECodeSelect */
		<![CDATA[
			SELECT D1.CD
           		 , D1.USR_DFN_TXT_1
                 , (SELECT S1.CD_NM 
	                  FROM TBDCMACM013C S1 
	                 WHERE 1=1
	                   AND S1.CMM_CD_DVSN_CD = '1000447'
	                   AND S1.CD = D1.USR_DFN_TXT_1) AS CD_NM
              FROM TBDCMACM013C D1 
             WHERE 1=1 
         	   AND D1.CMM_CD_DVSN_CD = '1000128'
		]]>
	</select>
	
	<select id="CSPDCP122InfRprtInfoByInfRprtNoSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122InfRprtInfoByInfRprtNoSelect */
	<![CDATA[
		SELECT	
				D1.YM
				, D1.INF_RPRT_NO
				, '정보' || '-' || SUBSTR(D1.YM, 3, 4) || '-' || LPAD(D1.INF_RPRT_NO, 4, '0') AS INF_RPRT_NO_NM
				, SUBSTR(D1.INF_TYP_CD, 1, 2) || '00' AS INF_TYP_CD_TOP
				, D1.INF_TYP_CD
				, D1.TIT_NM
				, D1.DOC_ID
				, D1.DOC_TYP_CD
				, D1.WRIT_STA_CD
				, TO_CHAR(D1.SMT_DH, 'YYYYMMDD') AS SMT_DH
				, TO_CHAR(D1.SMT_CNL_DH, 'YYYYMMDD') AS SMT_CNL_DH
				, D1.FRT_USR_ID
		FROM	TBCSPDCP501M D1
		WHERE	D1.YM = #{ym}
		AND		D1.INF_RPRT_NO = #{infRprtNo}
	]]>
	</select>
	
	<select id="CSPDCP122InfRprtInfoCntSelect" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122InfRprtInfoCntSelect */
	<![CDATA[
		SELECT	/* CSPDCP122InfRprtInfoCntSelect */
				COUNT(INF_RPRT_NO) AS CNT
		FROM	TBCSPDCP501M D1
		WHERE	D1.YM = #{ym}
		AND		D1.INF_RPRT_NO = #{infRprtNo}
	]]>
	</select>
 	
 	<select id="CSPDCP122EMainSelect" parameterType="paramMap" resultType="egovMap">
 		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EMainSelect */
	<![CDATA[
		SELECT T2.YM
		     , T2.INF_RPRT_NO
		     , T2.APV_RPT_PEN_DVSN_CD
		     , T2.APVR_ID
		     , F_CODE_NM('1000173', T3.RANK_CD) AS RANK_NM
		     , F_DPT_INFO(T3.DPT_CD, '1') AS DPT_NM
		     , T3.USR_NAM
		     , T2.FRT_USR_ID
		     , T2.FNL_USR_ID
		     , T2.FNL_DEAL_DPT_CD
		     , T2.FNL_MNU_ID
		     , T2.FRT_REGI_DH
		     , T2.FNL_MDF_DH
		  FROM TBCSPDCP501M T1
		     , TBCSPDCP503L T2
		     , TBDCMACM001M T3
	     WHERE 1=1
		   AND T1.YM = T2.YM
		   AND T1.INF_RPRT_NO = T2.INF_RPRT_NO
		   AND T2.APVR_ID  = T3.USR_ID(+)
	]]>
		<if test='ym != null and ym != ""'>
		    AND T1.YM = #{ym}
			</if>
		<if test='infRprtNo != null and infRprtNo != ""'>
			AND T1.INF_RPRT_NO  = #{infRprtNo}
			</if>
	</select>
	
	<select id="CSPDCP122ESubSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122ESubSelect */
		<![CDATA[
		SELECT T2.YM
         	  ,T2.INF_RPRT_NO
	          ,T2.ORG_CD
	          ,T3.ORG_NM
	          ,(SELECT ORG_NM 
	              FROM TBDCMACM015M 
	             WHERE ORG_CD LIKE SUBSTR(T3.ORG_CD, 0 , 3)||'000000000') AS SMALL_ORG_NM
	          ,T3.PUB_DVSN_CD
     	  FROM TBCSPDCP501M T1
              ,TBCSPDCP502L T2
              ,TBDCMACM015M T3
   		 WHERE 1=1 
	       AND T1.YM = T2.YM
	       AND T1.INF_RPRT_NO = T2.INF_RPRT_NO
	       AND T2.ORG_CD = T3.ORG_CD(+)
		]]>
		<if test='ym != null and ym != ""'>
		    AND T1.YM = #{ym}
			</if>
		<if test='infRprtNo != null and infRprtNo != ""'>
			AND T1.INF_RPRT_NO  = #{infRprtNo}
			</if>
	</select>
	
	
	<select id="CSPDCP122ESub2Select" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122ESub2Select */
		<![CDATA[
			   SELECT T2.YM
		             ,T2.INF_RPRT_NO
		             ,T2.SRNO
		             ,T2.NAM
		             ,T2.BTDT
		             ,T2.BLT_ORG_NM
		             ,T2.RANK_NM
		             ,T2.PST_NM
		        FROM TBCSPDCP501M T1
		            ,TBCSPDCP504L T2
		       WHERE 1=1 
		         AND T1.YM = T2.YM
		         AND T1.INF_RPRT_NO = T2.INF_RPRT_NO
		]]>
		<if test='ym != null and ym != ""'>
		    AND T1.YM = #{ym}
			</if>
		<if test='infRprtNo != null and infRprtNo != ""'>
			AND T1.INF_RPRT_NO  = #{infRprtNo}
			</if>
	</select>
	
	<update id="CSPDCP122EInfRprtInfoUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRprtInfoUpdate */
	<![CDATA[
		UPDATE /* CSPDCP122EInfRprtInfoUpdate */ TBCSPDCP501M
		   SET FNL_USR_ID      = #{usrId}
  				  ,FNL_DEAL_DPT_CD = #{dptCd}
  				  ,FNL_MNU_ID      = #{mnuId}
  				  ,FNL_MDF_DH      = SYSDATE 
  	]]>
		<if test='writStaCd != null and writStaCd != ""'>
		    		WRIT_STA_CD     = #{writStaCd}
		    	</if>
		<if test='writStaCd == "20"'>
					SMT_DH			= SYSDATE
					, SMT_CNL_DH	= NULL
				</if>
		<if test='writStaCd == "21"'>
					SMT_DH			= NULL
					, SMT_CNL_DH	= SYSDATE
				</if>
		<if test='titNm != null and titNm != ""'>
		   		    TIT_NM          = #{titNm}
		   		</if>
		<if test='infTypCd != null and infTypCd != ""'>
		   		   INF_TYP_CD       = #{infTypCd}
		   		</if>
		<if test='docId != null and docId != ""'>
		   		   DOC_ID           = #{docId}
		   		</if>
	<![CDATA[
		 WHERE YM = #{ym}
		   AND INF_RPRT_NO = #{infRprtNo}
	]]>
	</update>
	
	<select id="CSPDCP122EgetWritStaCd" parameterType="paramMap" resultType="java.lang.String">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EgetWritStaCd */
	<![CDATA[
		SELECT WRIT_STA_CD
		  FROM TBCSPDCP501M
 		 WHERE YM = #{ym}
	       AND INF_RPRT_NO = #{infRprtNo}
	]]>
	</select>
	
	<select id="CSPDCP122EInfRprtNoMaxSelect" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRprtNoMaxSelect */
	<![CDATA[
		SELECT  /* CSPDCP122EInfRprtNoMaxSelect */ NVL(MAX(INF_RPRT_NO), 0) + 1 AS INF_RPRT_NO_MAX
		FROM 	TBCSPDCP501M D1
		WHERE	D1.YM = #{ym}
	]]>
	</select>
	
	
	<select id="CSPDCP122ECurentYmSelect" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122ECurentYmSelect */
	<![CDATA[
		SELECT 	/* CSPDCP122ECurentYmSelect */ TO_CHAR(SYSDATE, 'YYYYMM') AS YM
        FROM 	DUAL
	]]>
	</select>
	
	<insert id="CSPDCP122EInfRprtInfoInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRprtInfoInsert */
	<![CDATA[
		 INSERT INTO /* CSPDCP122EInfRprtInfoInsert */ TBCSPDCP501M(
                            YM
                           ,INF_RPRT_NO
                           ,INF_TYP_CD                           
                           ,TIT_NM
                           ,DOC_ID
                           ,WRIT_STA_CD
                           ,FRT_USR_ID
                           ,FNL_USR_ID
                           ,FNL_DEAL_DPT_CD
                           ,FNL_MNU_ID
                           ,FRT_REGI_DH
                           ,FNL_MDF_DH
                           )
                    VALUES(
                            #{ym}
                           ,#{infRprtNo}
                           ,#{infTypCd}
                           ,#{titNm}
                           ,#{docId}
                           ,'10'     
                           ,#{usrId}
                           ,#{usrId}
                           ,#{dptCd}
                           ,#{mnuId}
                           ,SYSDATE
                           ,SYSDATE
                           )
	]]>
	</insert>
	
	<delete id="CSPDCP122EInfRrptInfoDelete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptInfoDelete */
	<![CDATA[
		DELETE /* CSPDCP122EInfRrptInfoDelete */
		  FROM TBCSPDCP501M
		 WHERE YM = #{ym}
		   AND INF_RPRT_NO = #{infRprtNo}
	]]>
	</delete>
	
	<delete id="CSPDCP122EInfRrptLineInfoAllDelete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptLineInfoAllDelete */
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptLineInfoAllDelete */
			  FROM TBCSPDCP503L
			 WHERE 1=1 
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
	]]>
	</delete>
	
	<delete id="CSPDCP122EInfRrptLineInfoDelete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptLineInfoDelete */
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptLineInfoAllDelete */
			  FROM TBCSPDCP503L
			 WHERE 1=1 
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
			   AND APV_RPT_PEN_DVSN_CD = #{apvRptPenDvsnCd}
			   AND APVR_ID = #{apvrId}
	]]>
	</delete>
	
	<insert id="CSPDCP122EInfRrptLineInfoInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptLineInfoInsert */
	<![CDATA[
		INSERT INTO /* CSPDCP122EInfRrptLineInfoInsert */ TBCSPDCP503L(
								 YM
								,INF_RPRT_NO
								,APV_RPT_PEN_DVSN_CD
								,APVR_ID
								,FRT_USR_ID
								,FNL_USR_ID
								,FNL_DEAL_DPT_CD
								,FNL_MNU_ID
								,FRT_REGI_DH
								,FNL_MDF_DH
								)
						VALUES (
								#{ym}
								,#{infRprtNo}
								,#{apvRptPenDvsnCd}
								,#{apvrId}
								,#{usrId}
								,#{usrId}
								,#{dptCd}
								,#{mnuId}
								,SYSDATE
								,SYSDATE
								)
	]]>
	</insert>
	
	<delete id="CSPDCP122EInfRrptOrgInfoAllDelete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptOrgInfoAllDelete */
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptOrgInfoAllDelete */
			  FROM TBCSPDCP502L
			 WHERE 1=1 
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
	]]>
	</delete>
	
	<delete id="CSPDCP122EInfRrptOrgInfoDelete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptOrgInfoDelete */
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptOrgInfoAllDelete */
			  FROM TBCSPDCP502L
			 WHERE 1=1 
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
			   AND ORG_CD = #{orgCd}
	]]>
	</delete>
	
	<insert id="CSPDCP122EInfRrptOrgInfoInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptOrgInfoInsert */
	<![CDATA[
		INSERT INTO /* CSPDCP122EInfRrptOrgInfoInsert */ TBCSPDCP502L(
								 YM
								,INF_RPRT_NO
								,ORG_CD
								,FRT_USR_ID
								,FNL_USR_ID
								,FNL_DEAL_DPT_CD
								,FNL_MNU_ID
								,FRT_REGI_DH
								,FNL_MDF_DH
								)
						VALUES (
								#{ym}
								,#{infRprtNo}
								,#{orgCd}
								,#{usrId}
								,#{usrId}
								,#{dptCd}
								,#{mnuId}
								,SYSDATE
								,SYSDATE
								)
	]]>
	</insert>
	
	<delete id="CSPDCP122EInfRrptPeopleInfoAllDelete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptPeopleInfoAllDelete */
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptPeopleInfoAllDelete */ 
			  FROM TBCSPDCP504L
			 WHERE 1=1 
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
	]]>
	</delete>
	
	<delete id="CSPDCP122EInfRrptPeopleInfoDelete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptPeopleInfoDelete */
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptPeopleInfoAllDelete */ 
			  FROM TBCSPDCP504L
			 WHERE 1=1 
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
			   AND SRNO = #{srno}
	]]>
	</delete>
	
	<insert id="CSPDCP122EInfRrptPeopleInfoInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptPeopleInfoInsert */
	<![CDATA[
		INSERT INTO /* CSPDCP122EInfRrptPeopleInfoInsert */ TBCSPDCP504L(
								 YM
								,INF_RPRT_NO
								,SRNO
								,NAM
								,BTDT
								,BLT_ORG_NM
								,RANK_NM
								,PST_NM
								,FRT_USR_ID
								,FNL_USR_ID
								,FNL_DEAL_DPT_CD
								,FNL_MNU_ID
								,FRT_REGI_DH
								,FNL_MDF_DH
								)
						VALUES (
								#{ym}
								,#{infRprtNo}
								,(SELECT NVL(MAX(SRNO), 0) + 1
                                     FROM TBCSPDCP504L
                                    WHERE YM = #{ym}
                                      AND INF_RPRT_NO = #{infRprtNo})
								,#{nam}
								,#{btdt}
								,#{bltOrgNm}
								,#{rankNm}
								,#{pstNm}
								,#{usrId}
								,#{usrId}
								,#{dptCd}
								,#{mnuId}
								,SYSDATE
								,SYSDATE
								)
	]]>
	</insert>
	
	<delete id="CSPDCP122EInfRrptDocDelete" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EInfRrptDocDelete */
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptDocDelete */
			  FROM TBCSPDCP505M
			 WHERE 1=1 
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
	]]>
	</delete>
	
	<delete id="CSPDCP122EDeleteTBCSPDCP503L" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EDeleteTBCSPDCP503L */
			DELETE 
			  FROM TBCSPDCP503L
			 WHERE 1=1 
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
			   AND APV_RPT_PEN_DVSN_CD = #{apvRptPenDvsnCd}
			   AND APVR_ID = #{apvrId} 
	</delete>
	
	<!-- <update id="CSPDCP122EUpdateTBCSPDCP503L" parameterType="paramMap">
			UPDATE TBCSPDCP503L
			   SET APV_RPT_PEN_DVSN_CD     = #{apvRptPenDvsnCd}
			      ,APVR_ID                 = #{apvrId} 
			      ,FNL_USR_ID              = #{fnlUsrId}
   				  ,FNL_DEAL_DPT_CD         = #{fnlDealDptCd}
   				  ,FNL_MNU_ID              = #{fnlMnuId}
   				  ,FNL_MDF_DH              = SYSDATE 
			 WHERE 1=1
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
			   AND APV_RPT_PEN_DVSN_CD = #{apvRptPenDvsnCd}
			   AND APVR_ID = #{apvrId}
	</update> -->
	
	<delete id="CSPDCP122EDeleteTBCSPDCP502L"  parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EDeleteTBCSPDCP502L */
		DELETE 
		  FROM TBCSPDCP502L
		 WHERE 1=1
		   AND YM = #{ym}
		   AND INF_RPRT_NO = #{infRprtNo}
		   AND ORG_CD = #{orgCd}
	</delete>
	
	
	<!-- <update id="CSPDCP122EUpdateTBCSPDCP502L" parameterType="paramMap">
			UPDATE TBCSPDCP502L
			   SET ORG_CD = #{orgCd}
			      ,FNL_USR_ID              = #{fnlUsrId}
   				  ,FNL_DEAL_DPT_CD         = #{fnlDealDptCd}
   				  ,FNL_MNU_ID              = #{fnlMnuId}
   				  ,FNL_MDF_DH              = SYSDATE 
			 WHERE 1=1
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
			   AND ORG_CD = #{orgCd}
	</update> -->
	
	<delete id="CSPDCP122EDeleteTBCSPDCP504L"  parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP122Mapper.CSPDCP122EDeleteTBCSPDCP504L */
		DELETE 
		  FROM TBCSPDCP504L
		 WHERE 1=1
		   AND YM = #{ym}
		   AND INF_RPRT_NO = #{infRprtNo}
		   AND SRNO = #{srno}
	</delete>
	
	<!-- <update id="CSPDCP122EUpdateTBCSPDCP504L" parameterType="paramMap">
			UPDATE TBCSPDCP504L
			   SET NAM                     = NVL(#{nam}, '')
			      ,BTDT                    = NVL(#{btdt}, '')
			      ,BLT_ORG_NM              = NVL(#{bltOrgNm}, '')
			      ,RANK_NM                 = NVL(#{rankNm}, '')
			      ,PST_NM                  = NVL(#{pstNm}, '')
			      ,FNL_USR_ID              = #{fnlUsrId}
   				  ,FNL_DEAL_DPT_CD         = #{fnlDealDptCd}
   				  ,FNL_MNU_ID              = #{fnlMnuId}
   				  ,FNL_MDF_DH              = SYSDATE 
			 WHERE 1=1
			   AND YM = #{ym}
			   AND INF_RPRT_NO = #{infRprtNo}
			   AND SRNO = #{srno}
	</update> -->
	
</mapper> 
