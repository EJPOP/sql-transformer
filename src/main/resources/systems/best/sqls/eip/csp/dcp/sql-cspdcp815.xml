<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP815Mapper">

 	<select id="CSPDCP815QMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP815Mapper.CSPDCP815QMainSelect */
		<![CDATA[
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
					,T1.STTM_ACP_NO
					,DECODE(T1.RM_STTM_ACP_NO,NULL,NULL,T1.ACP_YR||'-'||'청금-'||T1.RM_STTM_ACP_NO) AS ACP_NO
					,T1.HMP_APL_NO
					,T1.STTM_KND_CD
					,F_CODE_NM('1000758',T1.STTM_KND_CD) AS STTM_KND_NM
					,T1.STTM_KND_DTL_CD
					,F_CODE_NM('1000759',T1.STTM_KND_DTL_CD) AS STTM_KND_DTL_NM
					,T1.NAM
					,T1.TIT_NM
					,TO_CHAR(T1.ACP_DH,'YYYY.MM.DD HH24:MI') AS ACP_DH
					,TO_CHAR(T1.FRT_REGI_DH,'YYYY.MM.DD HH24:MI') AS FRT_REGI_DH
					,T1.ACP_RUT_CD
					,F_CODE_NM('1000761',T1.ACP_RUT_CD) AS ACP_RUT_NM
					,T1.HNDL_STA_CD
					,F_CODE_NM('1000760',T1.HNDL_STA_CD) AS HNDL_STA_NM
					,T1.RM_STTM_ACP_NO
			FROM	TBCSPDCP811M T1
					,TBCSPDCP813M T2
			WHERE	T1.STTM_DVSN_CD = '1'
			AND		T1.HNDL_STA_CD NOT IN ('1')
			AND		T1.STTM_DVSN_CD = T2.STTM_DVSN_CD(+)
			AND		T1.ACP_YR = T2.ACP_YR(+)
			AND		T1.STTM_ACP_NO = T2.STTM_ACP_NO(+)
		]]>
		<if test='usrId != "haahaasch"'>
				AND		(T1.ACP_DPT_CD = #{dptCd} OR T2.HNDL_DPT_CD = #{dptCd})
			</if>
		<if test='acpYr != null and acpYr != ""'>
				AND	T1.ACP_YR = #{acpYr}
			</if>
		<if test='rmSttmAcpNo != null and rmSttmAcpNo != ""'>
				AND	T1.RM_STTM_ACP_NO = #{rmSttmAcpNo}
			</if>
		<if test='acpDhs != null and acpDhs != ""'>
				AND	TO_CHAR(T1.ACP_DH,'YYYYMMDD') &gt;= #{acpDhs}
			</if>
		<if test='acpDhe != null and acpDhe != ""'>
				AND	TO_CHAR(T1.ACP_DH,'YYYYMMDD') &lt;= #{acpDhe}
			</if>
		<if test='hndlStaCd != null and hndlStaCd != ""'>
				AND	T1.HNDL_STA_CD = #{hndlStaCd}
			</if>
		<if test='titNm != null and titNm != ""'>
				AND	T1.TIT_NM LIKE '%'||#{titNm}||'%'
			</if>

		<if test='nam != null and nam != ""'>
				AND	T1.NAM LIKE '%'||#{nam}||'%'
			</if>

		<if test='dtbYn == "Y"'>
			<![CDATA[
				AND	(	(T2.HNDL_DPT_CD IS NOT NULL AND T2.HNDL_DPT_CD <> #{dptCd})
					OR 	(T2.HNDL_DPT_CD = #{dptCd} AND T2.HNDL_CHGR_ID IS NOT NULL)
					OR	(T1.HNDL_STA_CD IN ('9')))
			]]>
			</if>
		<if test='dtbYn == "N"'>
			<![CDATA[
				AND	(T2.HNDL_DPT_CD IS NULL OR (T2.HNDL_DPT_CD = #{dptCd} AND  T2.HNDL_CHGR_ID IS NULL))
				AND T1.HNDL_STA_CD NOT IN('9','10')
			]]>

			</if>
		<![CDATA[
			ORDER BY T1.ACP_YR DESC,TO_NUMBER(T1.RM_STTM_ACP_NO) DESC
		]]>
	</select>

	<select id="CSPDCP815QSubSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP815Mapper.CSPDCP815QSubSelect */
		<![CDATA[
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
   					,T1.STTM_ACP_NO
   					,T1.RM_STTM_ACP_NO
   					,DECODE(T1.RM_STTM_ACP_NO,NULL,'',T1.ACP_YR||'-청금-'||T1.RM_STTM_ACP_NO) AS ACP_NO
   					,F_CODE_NM('1000758',T1.STTM_KND_CD) AS STTM_KND_NM
					,F_CODE_NM('1000759',T1.STTM_KND_DTL_CD) AS STTM_KND_DTL_NM
   					,T1.TIT_NM
   					,T1.NAM
   					,TO_CHAR(T1.ACP_DH,'YYYY.MM.DD HH24:MI') AS ACP_DH
   					,F_DPT_INFO(T2.HNDL_DPT_CD,'1') AS HNDL_DPT_NM
   					,F_USR_INFO_BY_ID(T2.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
   					,F_CODE_NM('1000760',T1.HNDL_STA_CD) AS HNDL_STA_NM
   					,F_DPT_INFO(T1.ACP_DPT_CD,'1') AS ACP_DPT_NM
   			FROM	TBCSPDCP811M T1
   					,TBCSPDCP813M T2
   					,(	SELECT	S1.EIN
   						FROM	TBCSPDCP811M S1
   						WHERE	S1.STTM_DVSN_CD = #{sttmDvsnCd}
   						AND		S1.ACP_YR = #{acpYr}
   						AND		S1.STTM_ACP_NO = #{sttmAcpNo}
   					) T3
   			WHERE	1=1
   			AND		T1.STTM_DVSN_CD = #{sttmDvsnCd}
   			AND		T1.STTM_DVSN_CD  = T2.STTM_DVSN_CD(+)
   			AND		T1.ACP_YR = T2.ACP_YR(+)
   			AND		T1.STTM_ACP_NO = T2.STTM_ACP_NO(+)
   			AND		NOT EXISTS (
   						SELECT 	''
   						FROM	TBCSPDCP811M S1
   						WHERE	S1.STTM_DVSN_CD = #{sttmDvsnCd}
   						AND		S1.ACP_YR = #{acpYr}
   						AND		S1.STTM_ACP_NO = #{sttmAcpNo}
   						AND 	S1.STTM_DVSN_CD = T1.STTM_DVSN_CD
                        AND 	S1.ACP_YR = T1.ACP_YR
                        AND 	S1.STTM_ACP_NO = T1.STTM_ACP_NO
   					)
   			AND 	T1.EIN = T3.EIN
		]]>
	</select>

	<select id="CSPDCP815QHisSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP815Mapper.CSPDCP815QHisSelect */
		<![CDATA[
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
					,T1.STTM_ACP_NO
					,T2.SRNO
					,DECODE(T1.RM_STTM_ACP_NO,NULL,'',T1.ACP_YR||'-청금-'||T1.RM_STTM_ACP_NO) AS ACP_NO
					,F_DPT_INFO(T2.DTB_DPT_CD,'1') AS DTB_DPT_NM
					,F_USR_INFO_BY_ID(T2.DTB_PEN_ID,'2') AS DTB_PEN_NM
					,F_DPT_INFO(T2.HNDL_DPT_CD,'1') AS HNDL_DPT_NM
   					,F_USR_INFO_BY_ID(T2.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
					,T2.PET_TXT
					,TO_CHAR(T2.FRT_REGI_DH,'YYYY.MM.DD HH24:MI') AS FRT_REGI_DH
			FROM	TBCSPDCP811M T1
					,TBCSPDCP814H T2
			WHERE	T1.STTM_DVSN_CD = #{sttmDvsnCd}
			AND		T1.ACP_YR = #{acpYr}
			AND		T1.STTM_ACP_NO = #{sttmAcpNo}
			AND		T1.STTM_DVSN_CD  = T2.STTM_DVSN_CD
   			AND		T1.ACP_YR = T2.ACP_YR
   			AND		T1.STTM_ACP_NO = T2.STTM_ACP_NO
   			ORDER BY SRNO DESC
		]]>
	</select>
</mapper>
