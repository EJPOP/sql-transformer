<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.ear.dao.CSPEAR006Mapper">
 	<select id="CSPEAR006QMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR006Mapper.CSPEAR006QMainSelect */
		<include refid="include.pageSelct" /> 
		<![CDATA[
		SELECT REQ_DVSN_CD
                , REQ_DVSN_NM
                , ACP_YR
                , CVPT_ACP_NO
                , ACP_NO
                , ACP_DH
                , TIT_NM
                , CVPTR_NM
                , HNDL_CHGR_NM
                , HNDL_DPT_NM
                , REQR_DVSN_CD
                , REQR_DVSN_NM
                , CVPT_HNDL_STA_CD
                , CVPT_HNDL_STA_NM
                , ORG_CD
                , TRNF_DPT_NM
                , TRNF_DT
                , AUD_RSLT_NM
                , AUD_RSLT_RPL_DT
                , replace(PREI_DOC_ID ,  'polaris-exeeditor://approval/', 'polaris-exeeditor://open/') AS PREI_DOC_ID 
                , replace(EXAM_DOC_ID ,  'polaris-exeeditor://approval/', 'polaris-exeeditor://open/') AS EXAM_DOC_ID
                , RTN_DOC_ID
                , RTN_DOC_DOWN
                , RESULT_DOC_ID
                , RESULT_DOC_DOWN
                , PRC_CNT
        		, CASE WHEN ACP_STEP_NM IS NOT NULL AND CVPT_HNDL_STA_CD <> '170' THEN ACP_STEP_NM ELSE CVPT_HNDL_STA_NM END AS ACP_STEP_NM
        		, APV1
        		, APV2
        		, DOC_TYPE
        FROM (
			SELECT	A.REQ_DVSN_CD
					,F_CODE_NM('1000740',A.REQ_DVSN_CD) AS REQ_DVSN_NM
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||substring(A.CVPT_ACP_NO, 3, 3) AS ACP_NO
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD hh24:mi') AS ACP_DH
   					,A.TIT_NM
   					,A.CVPTR_NM
   					,F_USR_INFO_BY_ID(B.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
   					,(	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = B.HNDL_DPT_CD
   					) AS HNDL_DPT_NM
   					,B.REQR_DVSN_CD
   					,F_CODE_NM('1000080',B.REQR_DVSN_CD) AS REQR_DVSN_NM
   					,A.CVPT_HNDL_STA_CD
   					,F_CODE_NM('1000361',A.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
   					, (	SELECT	ACP_STEP_NM
			      		FROM	TBCSPDCP601M S3
			      		WHERE	(S3.REQ_DVSN_CD, S3.ACP_YR, S3.CVPT_ACP_NO, ACP_STEP_CD ) IN (	SELECT	S4.REQ_DVSN_CD,S4.ACP_YR,S4.CVPT_ACP_NO,MAX(ACP_STEP_CD)
			      																		FROM	TBCSPDCP601M S4
			      																		WHERE	A.REQ_DVSN_CD = S4.REQ_DVSN_CD
			      																		AND		A.ACP_YR = S4.ACP_YR
			      																		AND		A.CVPT_ACP_NO = S4.CVPT_ACP_NO
                                                                                        AND     S4.STEP_CMPT_YN = 'P'
			      																		GROUP BY S4.REQ_DVSN_CD,S4.ACP_YR,S4.CVPT_ACP_NO
			      																	))  AS    ACP_STEP_NM
   					,'' AS ORG_CD
   					,(	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = B.TRNF_DPT_CD
   					)  AS TRNF_DPT_NM
   					,B.TRNF_DT
   					,F_CODE_NM('1000380',B.AUD_RSLT_CD) AS AUD_RSLT_NM
   					,TO_CHAR(TO_DATE(B.AUD_RSLT_RPL_DT,'YYYY-MM-DD'),'YYYY-MM-DD') AS AUD_RSLT_RPL_DT
   					,NVL((SELECT LINK_URL
                          FROM TBCSPDCP603M S1
                         WHERE S1.REQ_DVSN_CD =A.REQ_DVSN_CD
                           AND S1.ACP_YR = A.ACP_YR
                           AND S1.CVPT_ACP_NO = A.CVPT_ACP_NO
                           AND S1.RPRT_CD IN ('C10130100',
                                       'C10120100') ) , (SELECT Z.DOC_ID
                          FROM TBCSPEAR004M Z,
                               UBKERAPP.ECM_FILE_LIST_VIEW2 X
                         WHERE A.REQ_DVSN_CD = Z.REQ_DVSN_CD
                           AND A.ACP_YR = Z.ACP_YR
                           AND A.CVPT_ACP_NO = Z.CVPT_ACP_NO
                           AND Z.DOC_ID = X.DOC_ID
                           AND Z.REQ_DOC_KND_CD = '1'
                         GROUP BY Z.DOC_ID)) AS PREI_DOC_ID 
			   		
			   		,NVL((SELECT LINK_URL
                          FROM TBCSPDCP603M S1
                         WHERE S1.REQ_DVSN_CD =A.REQ_DVSN_CD
                           AND S1.ACP_YR = A.ACP_YR
                           AND S1.CVPT_ACP_NO = A.CVPT_ACP_NO
                           AND S1.RPRT_CD IN ('C10220100',
                                       'C10330100') ) ,
                          (	SELECT 	Z.DOC_ID 
	 						FROM	TBCSPEAR004M Z, UBKERAPP.ECM_FILE_LIST_VIEW2 X
	 						WHERE	A.REQ_DVSN_CD = Z.REQ_DVSN_CD
				   			AND		A.ACP_YR = Z.ACP_YR
				   			AND		A.CVPT_ACP_NO = Z.CVPT_ACP_NO 
				   			AND		Z.DOC_ID = X.DOC_ID
				   			AND		Z.REQ_DOC_KND_CD = '2'
		   					GROUP BY Z.DOC_ID)
		   			) AS EXAM_DOC_ID
		   			,(	SELECT 	Z.DOC_ID 
   						FROM	TBBADDED021M Z, UBKERAPP.ECM_FILE_LIST_VIEW2 X
   						WHERE	C.AUD_YR = Z.AUD_YR
			   			AND		C.AUD_NO = Z.AUD_NO
			   			AND		Z.DOC_ID = X.DOC_ID
			   			AND		Z.DOC_TYP_CD = 'AD-AR-003'
			   			GROUP BY Z.DOC_ID) AS RTN_DOC_ID
			   		,DECODE((	SELECT 	Z.DOC_ID 
		   						FROM	TBBADDED021M Z, UBKERAPP.ECM_FILE_LIST_VIEW2 X
		   						WHERE	C.AUD_YR = Z.AUD_YR
					   			AND		C.AUD_NO = Z.AUD_NO
					   			AND		Z.DOC_ID = X.DOC_ID
					   			AND		Z.DOC_TYP_CD = 'AD-AR-003'
					   			GROUP BY Z.DOC_ID),NULL,NULL,'파일다운') AS RTN_DOC_DOWN
					,(	SELECT 	Z.DOC_ID 
   						FROM	TBBADDED021M Z, UBKERAPP.ECM_FILE_LIST_VIEW2 X
   						WHERE	C.AUD_YR = Z.AUD_YR
			   			AND		C.AUD_NO = Z.AUD_NO
			   			AND		Z.DOC_ID = X.DOC_ID
			   			AND		Z.DOC_TYP_CD = 'AD-AR-001'
			   			GROUP BY Z.DOC_ID) AS RESULT_DOC_ID
			   		,DECODE((	SELECT 	Z.DOC_ID 
		   						FROM	TBBADDED021M Z, UBKERAPP.ECM_FILE_LIST_VIEW2 X
		   						WHERE	C.AUD_YR = Z.AUD_YR
					   			AND		C.AUD_NO = Z.AUD_NO
					   			AND		Z.DOC_ID = X.DOC_ID
					   			AND		Z.DOC_TYP_CD = 'AD-AR-001'
					   			GROUP BY Z.DOC_ID),NULL,NULL,'파일다운') AS RESULT_DOC_DOWN
					,(SELECT COUNT(CVPT_ACP_NO)
					   FROM TBCSPDCP601M
					  WHERE ACP_YR = A.ACP_YR
					     AND REQ_DVSN_CD = A.REQ_DVSN_CD
					     AND CVPT_ACP_NO = A.CVPT_ACP_NO) AS PRC_CNT
					,TO_CHAR(TO_DATE(B.PREI_APV_DT),'YYYY-MM-DD')  AS APV1
                     ,TO_CHAR(TO_DATE(B.EXAM_RPT_APV_DT),'YYYY-MM-DD')  AS APV2
                     ,F_CODE_NM('1000894', A.DOC_WRIT_KND_CD) AS DOC_TYPE -- 편집기구분
   			FROM	TBCSPDCP101M A
   					,TBCSPEAR001M B
   					,TBBADDED001M C
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = B.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		A.CVPT_HNDL_STA_CD NOT IN ('21')
		]]>
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
				AND	A.REQ_DVSN_CD = #{reqDvsnCd}
			</if>
		<if test='reqDvsnCd == null or reqDvsnCd == ""'>
				AND	A.REQ_DVSN_CD IN ('2','3')
			</if>
		<if test='acpDhs != null and acpDhs != ""'>
				AND	TO_CHAR(A.ACP_DH,'YYYYMMDD') &gt;= #{acpDhs}
			</if>
		<if test='acpDhe != null and acpDhe != ""'>
				AND	TO_CHAR(A.ACP_DH,'YYYYMMDD') &lt;= #{acpDhe}
		</if>
		<if test='preiApvDts != null and preiApvDts != ""'>
				AND	B.PREI_APV_DT &gt;= #{preiApvDts}
			</if>
		<if test='preiApvDte != null and preiApvDte != ""'>
				AND	B.PREI_APV_DT &lt;= #{preiApvDte}
			</if>
		<if test='examRptApvDts != null and examRptApvDts != ""'>
				AND	B.EXAM_RPT_APV_DT &gt;= #{examRptApvDts}
			</if>
		<if test='examRptApvDte != null and examRptApvDte != ""'>
				AND	B.EXAM_RPT_APV_DT &lt;= #{examRptApvDte}
			</if>
		<if test='titNm != null and titNm != ""'>
				AND	A.TIT_NM LIKE '%'||#{titNm}||'%'
			</if>
		<if test='acpYr != null and acpYr != ""'>
				AND	A.ACP_YR = #{acpYr}
			</if>
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
				AND	A.CVPT_ACP_NO = #{cvptAcpNo}
			</if>
		<if test='reqrDvsnCd != null and reqrDvsnCd != ""'>
				AND	B.REQR_DVSN_CD = #{reqrDvsnCd}
			</if>
		<if test='cvptHndlStaCd != null and cvptHndlStaCd != ""'>
				AND	A.CVPT_HNDL_STA_CD = #{cvptHndlStaCd}
		</if>
		<if test='cvptAudRsltCd != null and cvptAudRsltCd != ""'>
				AND	B.AUD_RSLT_CD = #{cvptAudRsltCd}
		</if>		
		<if test='hndlDptNm != null and hndlDptNm != ""'>
				AND	B.HNDL_DPT_CD IN (SELECT DPT_CD FROM TBDCMACM002M WHERE DPT_NM LIKE '%'||#{hndlDptNm}||'%')
			</if>
		<if test='ognTypCd != null and ognTypCd != ""'>
				AND	B.OGN_TYP_CD = #{ognTypCd}
			</if>
		<if test='acpRutCd != null and acpRutCd != ""'>
				AND	A.ACP_RUT_CD = #{acpRutCd}
			</if>
		<if test='cvptrNm != null and cvptrNm != ""'>
				AND	(A.CVPTR_NM LIKE '%'||#{cvptrNm}||'%' OR A.RPST_PEN_NM LIKE '%'||#{cvptrNm}||'%')
			</if>
			
		<if test='orgCd != null and orgCd != ""'>
				AND     (A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO) IN ( SELECT S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO
   			                                                        FROM TBCSPDCP104L S1
   			                                                       WHERE S1.AUD_TG_ORG_CD = #{orgCd}
   			                                                    )
			</if>
		<![CDATA[
			ORDER BY ACP_DH DESC
		)
		]]>
		<include refid="include.pageOrder" />
	</select>
	
	<select id="CSPEAR006QExcelExportSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR006Mapper.CSPEAR006QExcelExportSelect */
		<![CDATA[
			SELECT  DECODE(D1.REQ_DVSN_CD ,'2','국민','3','공익') AS REQ_DVSN_NM
					,D1.ACP_YR, D1.ACP_YR||'-'||DECODE(D1.REQ_DVSN_CD ,'2','국민','3','공익')||'-'||substring(D1.CVPT_ACP_NO, 3, 3) AS ACP_NO,
					TO_CHAR(D1.ACP_DH,'YYYY-MM-DD') AS ACP_DT
					, D1.TIT_NM
					, CASE WHEN D1.CVPT_HNDL_STA_CD ='170' THEN '완결' ELSE '미결' END YN
					, CASE WHEN D1.CVPT_HNDL_STA_CD = '110' THEN F_CODE_NM('1000361','30')
						WHEN D1.CVPT_HNDL_STA_CD IN ('150','160') AND D3.PRSS_STEP_CD NOT IN ('02','03','04','05','06','07','08','09') THEN '감사실시예정'
						WHEN D1.CVPT_HNDL_STA_CD IN ('150','160') AND D3.PRSS_STEP_CD  ='02' THEN '감사실시중' 
						WHEN D1.CVPT_HNDL_STA_CD IN ('150','160') AND D3.PRSS_STEP_CD = '03' THEN '귀청보고'
						WHEN D1.CVPT_HNDL_STA_CD IN ('150','160') AND D3.PRSS_STEP_CD IN ('04','05','06','07','08','09') THEN '처리안작성중' 
						WHEN D1.CVPT_HNDL_STA_CD ='170' THEN '완결'
						ELSE F_CODE_NM('1000361', D1.CVPT_HNDL_STA_CD) END AS CVPT_HNDL_STA_NM
					, F_CODE_NM('1000610',OGN_TYP_CD) AS OGN_TYP_NM
					, ( SELECT  CASE WHEN COUNT(*) > 1 THEN F_ORG_INFO(MIN(ORG_CD),'1')||'외 '|| TO_CHAR(COUNT(*)-1)||'건' ELSE F_ORG_INFO(MIN(ORG_CD),'1') END 
						FROM	TBBADDED002M Z1,
								TBBADDED008L Z2
						WHERE	D3.AUD_YR = Z1.REL_AUD_YR
						AND		D3.AUD_NO = Z1.REL_AUD_NO
						AND		Z1.BZT_YR = Z2.BZT_YR
						AND		Z1.BZT_SNO = Z2.BZT_SNO) AS ORG_CNT 
					, (	SELECT  F_CODE_NM('1000119',F_ORG_INFO(MIN(ORG_CD),'2'))
						FROM	TBBADDED002M Z1,
								TBBADDED008L Z2
						WHERE	D3.AUD_YR = Z1.REL_AUD_YR
						AND		D3.AUD_NO = Z1.REL_AUD_NO
						AND		Z1.BZT_YR = Z2.BZT_YR
						AND		Z1.BZT_SNO = Z2.BZT_SNO ) AS ORG_DVSN_CD
					, DECODE(D1.REQR_KND_CD,'1',D1.CVPTR_NM || ' 외 ' ||NVL(D2.REQR_CNT,0)||'명',D1.CVPTR_NM) AS CVPTR_NM
					,D1.RPST_PEN_NM
					,F_CODE_NM('1000080',REQR_DVSN_CD) AS REQR_DVSN_NM
					, (	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = D2.HNDL_DPT_CD
   					)  AS HNDL_DPT_NM
					, F_USR_INFO_BY_ID(D2.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
					, TO_CHAR(TO_DATE(D2.PREI_APV_DT),'YYYY-MM-DD') AS PREI_APV_DT
					,(	SELECT	AGGR_CONCAT(X.PCT_NM,',')
						FROM	TBBADDED002M Z
								,TBBADDED005L X
						WHERE	D3.AUD_YR = Z.REL_AUD_YR
						AND		D3.AUD_NO = Z.REL_AUD_NO
						AND		Z.BZT_YR = X.BZT_YR
						AND		Z.BZT_SNO = X.BZT_SNO
						AND		Z.AUD_BZT_KND_CD ='00' 
					) AS MTRL_PCT_NM /*자료수집 출장자*/
					, D2.TRNF_DT
					, (	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = D2.TRNF_DPT_CD
   					)  AS TRNF_DPT_NM
					, (	SELECT	TO_CHAR(TO_DATE(MIN(Z.AUD_STR_DT)),'YYYY-MM-DD')
						FROM	TBBADDED002M Z
						WHERE	D3.AUD_YR = Z.REL_AUD_YR
						AND		D3.AUD_NO = Z.REL_AUD_NO
						AND		Z.AUD_BZT_KND_CD ='00' 
					) AS MTRL_STR_DT /* 자료수집 시작일*/
					, (	SELECT	TO_CHAR(TO_DATE(MAX(Z.AUD_END_DT)),'YYYY-MM-DD')
						FROM	TBBADDED002M Z
						WHERE	D3.AUD_YR = Z.REL_AUD_YR
						AND		D3.AUD_NO = Z.REL_AUD_NO
						AND		Z.AUD_BZT_KND_CD ='00' 
					) AS MTRL_END_DT /*자료수집 종료일*/
					, CASE WHEN D2.CMT_OEN_YN = 'Y' THEN D2.CMT_OEN_YE||'-'||D2.CMT_DGE ELSE '' END CMT_DGE/*위원회*/
					, TO_CHAR(TO_DATE(D2.CMT_OEN_DT),'YYYY-MM-DD') AS CMT_OEN_DT
					
					, CASE
					WHEN D2.AUD_RSLT_CD = '08' THEN TO_CHAR(D1.CVPT_WDW_DH,'YYYY-MM-DD')
					ELSE  
						CASE WHEN D1.REQ_DVSN_CD = '3' 
						THEN NVL(TO_CHAR(TO_DATE(D2.EXAM_RPT_APV_DT),'YYYY-MM-DD'),(
							SELECT TO_CHAR(MAX(C1.APV_DH),'YYYY-MM-DD') 
								FROM TBBADDED030L A1,TBBADDED103M B1, TBDCMACM023L C1  
									WHERE  A1.TSK_KEY1(+)=D1.ACP_YR 
										AND A1.TSK_KEY2(+)=D1.REQ_DVSN_CD 
										AND A1.TSK_KEY3(+) =D1.CVPT_ACP_NO 
										AND A1.AUD_YR=B1.AUD_YR 
										AND A1.AUD_NO=B1.AUD_NO 
										AND B1.APV_RQS_ID = C1.APV_DOC_NO 
										AND B1.RPRT_CD = 'A10300100' 
										AND B1.APV_STA_CD ='30' 
							)
						)
						ELSE (SELECT TO_CHAR(TO_DATE(MAX(B.CMT_OEN_DT)),'YYYY-MM-DD') 
							FROM TBCSPEAR011M A , TBCSPEAR010M B 
								WHERE  A.ACP_YR(+) = D1.ACP_YR 
									AND A.REQ_DVSN_CD(+) = D1.REQ_DVSN_CD  
									AND A.CVPT_ACP_NO(+) = D1.CVPT_ACP_NO 
									AND A.CMT_DVSN_CD = B.CMT_DVSN_CD 
									AND A.CMT_OEN_YE = B.CMT_OEN_YE 
									AND A.CMT_DGE = B.CMT_DGE
									AND A.CMT_RSLT_CD != '09')
						END
					END AS EXAM_RPT_APV_DT /*감사실시결정일*/
					
					,CASE WHEN D2.AUD_RSLT_CD = '08' THEN '취하'
							ELSE
								CASE
								WHEN D1.REQ_DVSN_CD = '3' 
								THEN F_CODE_NM('1000380',D2.REQ_EXAM_RSLT_CD) 
								ELSE (SELECT F_CODE_NM('1000380',A.CMT_RSLT_CD) FROM TBCSPEAR011M A 
                                        WHERE A.ACP_YR(+) = D1.ACP_YR 
                                            AND A.REQ_DVSN_CD(+) = D1.REQ_DVSN_CD  
                                            AND A.CVPT_ACP_NO(+) = D1.CVPT_ACP_NO
                                            AND A.CMT_RSLT_CD != '09')
								END
							END AS REQ_EXAM_RSLT_NM /*검토결과*/
							
					, CASE WHEN D2.AUD_RSLT_CD = '08' THEN TO_CHAR(D1.CVPT_WDW_DH,'YYYY-MM-DD')
						ELSE TO_CHAR(TO_DATE(D2.EXAM_RSLT_RPL_DT),'YYYY-MM-DD') END AS EXAM_RSLT_RPL_DT /*검토결과회신일*/
					, (	SELECT	SUM(X.AUD_DCN)
						FROM	TBBADDED002M Z, TBBADDED006L X
						WHERE	D3.AUD_YR = Z.REL_AUD_YR
						AND		D3.AUD_NO = Z.REL_AUD_NO
						AND		Z.BZT_YR = X.BZT_YR
						AND		Z.BZT_SNO = X.BZT_SNO
						AND		Z.AUD_BZT_KND_CD ='02' 
					) AS AUD_DCN /*감사 연인원*/
					,(	SELECT	AGGR_CONCAT(X.PCT_NM,',')
						FROM	TBBADDED002M Z
								,TBBADDED005L X
						WHERE	D3.AUD_YR = Z.REL_AUD_YR
						AND		D3.AUD_NO = Z.REL_AUD_NO
						AND		Z.BZT_YR = X.BZT_YR
						AND		Z.BZT_SNO = X.BZT_SNO
						AND		Z.AUD_BZT_KND_CD ='02' 
					) AS AUD_PCT_NM /*실지감사 출장자*/ 
					, (	SELECT	TO_CHAR(TO_DATE(MIN(Z.AUD_STR_DT)),'YYYY-MM-DD')
						FROM	TBBADDED002M Z
						WHERE	D3.AUD_YR = Z.REL_AUD_YR
						AND		D3.AUD_NO = Z.REL_AUD_NO
						AND		Z.AUD_BZT_KND_CD ='02' 
					) AS AUD_STR_DT /* 실지감사 시작일*/
					, (	SELECT	TO_CHAR(TO_DATE(MAX(Z.AUD_END_DT)),'YYYY-MM-DD')
						FROM	TBBADDED002M Z
						WHERE	D3.AUD_YR = Z.REL_AUD_YR
						AND		D3.AUD_NO = Z.REL_AUD_NO
						AND		Z.AUD_BZT_KND_CD ='02' 
					) AS AUD_END_DT /*실지감사 종료일*/
					, TO_CHAR(TO_DATE(D4.RTN_RPT_DT),'YYYY-MM-DD') AS RTN_RPT_DT /*귀청보고일*/ 
					, F_USR_INFO(D4.CHF_CMTR_CNB,'2') AS CHF_CMTR_NM /*주심위원성명*/
					, TO_CHAR(TO_DATE(D4.AUD_BRDV_APV_DT),'YYYY-MM-DD') AS AUD_BRDV_APV_DT /*과장결재일*/
					, TO_CHAR(TO_DATE(D4.MDT_OFER_APV_DT),'YYYY-MM-DD') AS MDT_OFER_APV_DT /*조정담당자*/
					, TO_CHAR(TO_DATE(D4.MDT_DDG_APV_DT),'YYYY-MM-DD') AS MDT_DDG_APV_DT /*조정담당관*/
					, TO_CHAR(TO_DATE(D4.JA_JDG_SSEC_APV_DT),'YYYY-MM-DD') AS JA_JDG_SSEC_APV_DT /*심의실장*/
					, TO_CHAR(TO_DATE(D4.OW_DHD_APV_DT),'YYYY-MM-DD') AS OW_DHD_APV_DT /*총.차장*/
					, TO_CHAR(TO_DATE(D4.CHF_CMTR_APV_DT),'YYYY-MM-DD') AS CHF_CMTR_APV_DT /*주심위원*/
					, TO_CHAR(TO_DATE(D4.ENF_APV_DT),'YYYY-MM-DD') AS ENF_APV_DT /*시행일(부의일)*/
					, (	SELECT	AGGR_CONCAT(F_CODE_NM('1000002',Z.DSP_RQ_KND_CD)||' '||COUNT(*),',') 
						FROM 	TBBADEAR001M Z
						WHERE 	D3.AUD_YR = Z.AUD_YR
						AND		D3.AUD_NO = Z.AUD_NO
						GROUP BY DSP_RQ_KND_CD ) AS DSP_RQ_KND_NM /*처분요구종류별건수*/
					, TO_CHAR(TO_DATE(D2.DSP_RQ_ENF_DT),'YYYY-MM-DD') AS DSP_RQ_ENF_DT /*처분요구시행*/
					, CASE WHEN D2.AUD_RSLT_CD IN ('05','07') THEN TO_CHAR(TO_DATE(D2.AUD_RSLT_RPL_DT),'YYYY-MM-DD') ELSE '' END AS AUD_RSLT_DT
					, CASE WHEN D2.AUD_RSLT_CD = '08' THEN TO_CHAR(D1.CVPT_WDW_DH,'YYYY-MM-DD') 
							ELSE TO_CHAR(TO_DATE(D2.AUD_RSLT_RPL_DT),'YYYY-MM-DD') END AS AUD_RSLT_RPL_DT
					, CASE WHEN D2.AUD_RSLT_CD = '08' THEN TO_CHAR(D1.CVPT_WDW_DH,'YYYY') 
							ELSE TO_CHAR(TO_DATE(D2.AUD_RSLT_RPL_DT),'YYYY') END AS AUD_RSLT_RPL_DT
					, F_CODE_NM('1000380',D2.AUD_RSLT_CD) AS AUD_RSLT_NM
					, NULL AS WHY
					, NULL AS ETC
					, CASE WHEN D1.CVPT_HNDL_STA_CD = '170' AND D2.REQ_EXAM_RSLT_CD IN ('01','02','03','04') THEN TO_DATE(D2.EXAM_RPT_APV_DT) - TO_DATE(TO_CHAR(D1.ACP_DH,'YYYYMMDD'))
						WHEN D1.CVPT_HNDL_STA_CD = '170' AND D2.PREI_DMS_YN = 'Y' THEN TO_DATE(D2.PREI_APV_DT) - TO_DATE(TO_CHAR(D1.ACP_DH,'YYYYMMDD')) 
						WHEN D1.CVPT_HNDL_STA_CD = '170' AND D2.AUD_RSLT_CD = '08' THEN TO_DATE(TO_CHAR(D1.CVPT_WDW_DH,'YYYYMMDD')) - TO_DATE(TO_CHAR(D1.ACP_DH,'YYYYMMDD')) 
					ELSE NULL END AS EXAM_ACP_DT
					, CASE WHEN D1.CVPT_HNDL_STA_CD = '170' AND D2.REQ_EXAM_RSLT_CD IN ('01','02','03','04') THEN TO_DATE(D2.EXAM_RSLT_RPL_DT) - TO_DATE(D2.EXAM_RPT_APV_DT)
						WHEN  D1.CVPT_HNDL_STA_CD ='170' AND D2.PREI_DMS_YN = 'Y' THEN TO_DATE(D2.PREI_RPL_DT) - TO_DATE(D2.PREI_APV_DT)
						WHEN D1.CVPT_HNDL_STA_CD ='170' AND D2.AUD_RSLT_CD = '08' THEN TO_DATE(TO_CHAR(D1.CVPT_WDW_DH,'YYYYMMDD')) - TO_DATE(TO_CHAR(D1.CVPT_WDW_DH,'YYYYMMDD'))
					ELSE NULL END AS EXAM_RPL_DT
					, CASE WHEN D1.CVPT_HNDL_STA_CD = '170' AND D2.AUD_RSLT_CD IN ('02','03','04','06','07') THEN TO_DATE(D2.AUD_RSLT_RPL_DT) - TO_DATE(TO_CHAR(D1.ACP_DH,'YYYYMMDD')) 
						WHEN D1.CVPT_HNDL_STA_CD = '170' AND D2.AUD_RSLT_CD = '08'  THEN TO_DATE(TO_CHAR(D1.CVPT_WDW_DH,'YYYYMMDD')) - TO_DATE(TO_CHAR(D1.ACP_DH,'YYYYMMDD'))
					ELSE NULL END AS RESULT_DT
			FROM	TBCSPDCP101M D1
					, TBCSPEAR001M D2
					, TBBADDED001M D3
					, TBBADDED003M D4
			WHERE	D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
			AND		D1.ACP_YR = D2.ACP_YR(+)
			AND		D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
			AND		D1.REQ_DVSN_CD = D3.REQ_DVSN_CD(+)
			AND		D1.ACP_YR = D3.ACP_YR(+)
			AND		D1.CVPT_ACP_NO = D3.CVPT_ACP_NO(+)
			AND		D3.AUD_YR = D4.AUD_YR(+)
			AND		D3.AUD_NO = D4.AUD_NO(+)
			AND		D1.CVPT_HNDL_STA_CD <> ('21')
		]]>
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
				AND	D1.REQ_DVSN_CD = #{reqDvsnCd}
			</if>
		<if test='reqDvsnCd == null or reqDvsnCd == ""'>
				AND	D1.REQ_DVSN_CD IN ('2','3')
			</if>
		<if test='acpDhs != null and acpDhs != ""'>
				AND	TO_CHAR(D1.ACP_DH,'YYYYMMDD') &gt;= #{acpDhs}
			</if>
		<if test='acpDhe != null and acpDhe != ""'>
				AND	TO_CHAR(D1.ACP_DH,'YYYYMMDD') &lt;= #{acpDhe}
			</if>
		<if test='preiApvDts != null and preiApvDts != ""'>
				AND	D2.PREI_APV_DT &gt;= #{preiApvDts}
			</if>
		<if test='preiApvDte != null and preiApvDte != ""'>
				AND	D2.PREI_APV_DT &lt;= #{preiApvDte}
			</if>
		<if test='examRptApvDts != null and examRptApvDts != ""'>
				AND	D2.EXAM_RPT_APV_DT &gt;= #{examRptApvDts}
			</if>
		<if test='examRptApvDte != null and examRptApvDte != ""'>
				AND	D2.EXAM_RPT_APV_DT &lt;= #{examRptApvDte}
			</if>
		<if test='titNm != null and titNm != ""'>
				AND	D1.TIT_NM LIKE '%'||#{titNm}||'%'
			</if>
		<if test='acpYr != null and acpYr != ""'>
				AND	D1.ACP_YR = #{acpYr}
			</if>
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
				AND	D1.CVPT_ACP_NO = #{cvptAcpNo}
			</if>
		<if test='reqrDvsnCd != null and reqrDvsnCd != ""'>
				AND	D2.REQR_DVSN_CD = #{reqrDvsnCd}
			</if>
		<if test='cvptHndlStaCd != null and cvptHndlStaCd != ""'>
				AND	D1.CVPT_HNDL_STA_CD = #{cvptHndlStaCd}
			</if>
		<if test='hndlDptNm != null and hndlDptNm != ""'>
				AND	D2.HNDL_DPT_CD IN (SELECT DPT_CD FROM TBDCMACM002M WHERE DPT_NM LIKE '%'||#{hndlDptNm}||'%')
			</if>
		<if test='ognTypCd != null and ognTypCd != ""'>
				AND	D2.OGN_TYP_CD = #{ognTypCd}
			</if>
		<if test='acpRutCd != null and acpRutCd != ""'>
				AND	D1.ACP_RUT_CD = #{acpRutCd}
			</if>
			<if test='orgCd != null and orgCd != ""'>
				AND     (D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO) IN ( SELECT S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO
   			                                                        FROM TBCSPDCP104L S1
   			                                                       WHERE S1.AUD_TG_ORG_CD = #{orgCd}
   			                                                    )
			</if>
		<![CDATA[
			ORDER BY D1.ACP_YR DESC , D1.CVPT_ACP_NO DESC
		]]>
		
	</select>
	
	
</mapper> 
