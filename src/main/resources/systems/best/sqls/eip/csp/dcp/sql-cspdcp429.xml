<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP429Mapper">
 	
	<select id="CSPDCP429PMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP429Mapper.CSPDCP429PMainSelect */
		<![CDATA[
		
			SELECT A.REQ_DVSN_CD							AS REQ_DVSN_CD
					 ,A.ACP_YR									AS ACP_YR
   					 ,A.CVPT_ACP_NO			 				AS CVPT_ACP_NO
   					 ,TO_CHAR(A.ACP_DH, 'YYYY-MM-DD')	AS ACP_DH
   					 ,A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO AS ACP_NO
   					 ,A.TIT_NM               AS TIT_NM
   					 ,A.CVPTR_NM           AS CVPTR_NM
   					 ,A.HNDL_DDLN_DT     AS HNDL_DDLN_DT
   					 ,A.BK_HNDL_DDLN_DT     AS BK_HNDL_DDLN_DT
   			FROM	TBCSPDCP101M A		
   			WHERE	1=1
   			 AND REQ_DVSN_CD = #{reqDvsnCd}
             AND ACP_YR = #{acpYr}
             AND CVPT_ACP_NO = #{cvptAcpNo}
            
            UNION ALL 
             
			SELECT A.REQ_DVSN_CD							AS REQ_DVSN_CD
					 ,A.ACP_YR									AS ACP_YR
   					 ,A.CVPT_ACP_NO			 				AS CVPT_ACP_NO
   					 ,TO_CHAR(A.ACP_DH, 'YYYY-MM-DD')	AS ACP_DH
   					 ,A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO AS ACP_NO
   					 ,A.TIT_NM               AS TIT_NM
   					 ,A.CVPTR_NM           AS CVPTR_NM
   					 ,A.HNDL_DDLN_DT     AS HNDL_DDLN_DT
   					 ,A.BK_HNDL_DDLN_DT     AS BK_HNDL_DDLN_DT
   			FROM	TBCSPDCP101M A
   					,(
                       SELECT SUC_ACP_YR, SUC_REQ_DVSN_CD, SUC_CVPT_ACP_NO
                         FROM TBCSPDCP105L
                        WHERE REQ_DVSN_CD = #{reqDvsnCd}
                          AND ACP_YR = #{acpYr}
                          AND CVPT_ACP_NO = #{cvptAcpNo}
                     ) B
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = B.SUC_REQ_DVSN_CD
   			AND		A.ACP_YR = B.SUC_ACP_YR
   			AND		A.CVPT_ACP_NO = B.SUC_CVPT_ACP_NO
		]]>
			
	</select>
	
	<update id="CSPDCP429PUpdateHndlDt" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP429Mapper.CSPDCP429PUpdateHndlDt */
		<![CDATA[
			UPDATE TBCSPDCP101M T1
			   SET
			   		T1.HNDL_DDLN_DT = F_GET_NEXT_WORK_DT(#{acpDh},30)
			   	  ,T1.BK_HNDL_DDLN_DT = F_GET_NEXT_WORK_DT(#{acpDh},30)
			 WHERE T1.ACP_YR           = #{acpYr}
			    AND T1.REQ_DVSN_CD  =  #{reqDvsnCd}
			    AND T1.CVPT_ACP_NO  =  #{cvptAcpNo}
		]]>
	</update>
	
	<update id="CSPDCP429PSucAllHndlDdlnDtUpdate" parameterType="paramMap">
   		<![CDATA[
   			UPDATE TBCSPDCP101M T1
			   SET
			   		T1.HNDL_DDLN_DT = F_GET_NEXT_WORK_DT(#{acpDh},30)
   			 WHERE 1=1
   			   AND (T1.REQ_DVSN_CD, T1.ACP_YR, T1.CVPT_ACP_NO) 
   			      IN (SELECT S1.SUC_REQ_DVSN_CD, S1.SUC_ACP_YR, S1.SUC_CVPT_ACP_NO
   			            FROM TBCSPDCP105L S1
   			           WHERE S1.REQ_DVSN_CD = #{reqDvsnCd} 
   			             AND S1.ACP_YR = #{acpYr}
   			             AND S1.CVPT_ACP_NO = #{cvptAcpNo}
   			        )
   		]]>
   	</update>
	
</mapper> 
