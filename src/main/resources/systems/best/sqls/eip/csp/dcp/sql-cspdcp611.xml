<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP611Mapper">

 	<select id="CSPDCP611QDPTSELECT" resultType="egovMap">
 		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP611Mapper.CSPDCP611QDPTSELECT */
 	<![CDATA[
	 	SELECT DPT_CD, DPT_NM,HIRK_DPT_CD
		  FROM TBDCMACM002M
		 WHERE 1=1
		   AND HIRK_DPT_CD = '0L0000'
		   AND USE_YN ='Y'
		   AND DPT_CD NOT IN ('0L0000','0L0200','0L0300')
	]]>
 	</select>

 	<select id="CSPDCP611QUSRSELECT" resultType="egovMap">
 		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP611Mapper.CSPDCP611QUSRSELECT */
 	<![CDATA[
		SELECT	USR_ID, USR_NAM, DPT_CD
       	FROM	TBDCMACM001M
       	WHERE	DPT_CD LIKE '0L0%'
       	AND 	DPT_CD NOT IN ('0L0000','0L0200','0L0300')
       	AND		RSG_DT IS NULL
		AND		RQS_STA_CD = '3'
		AND		BAI_USR_YN = 'Y'
		ORDER BY USR_NAM ASC
    ]]>
 	</select>
 	<select id="CSPDCP611QMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP611Mapper.CSPDCP611QMainSelect */
		<include refid = "include.pageSelct"/>
		<![CDATA[
			SELECT D2.CVPT_KND_DVSN_CD
			      ,F_CODE_NM('1000599', D2.CVPT_KND_DVSN_CD) AS CVPT_KND_DVSN_NM
			      /*,(SELECT SUBSTR(F_CODE_NM('1000599', S1.USR_DFN_TXT_1), 0, 2) FROM TBDCMACM013C S1 WHERE S1.CMM_CD_DVSN_CD = '1000047' AND S1.CD = D1.CVPT_KND_CD) AS CVPT_KND_DVSN_NM*/
			      /*,DECODE(D2.CVPT_KND_DVSN_CD,'1','감사','2','일반','3','기업',NULL) AS CVPT_KND_DVSN_NM*/
			      ,D1.CVPT_KND_CD
			      ,F_CODE_NM('1000047',D1.CVPT_KND_CD) AS CVPT_KND_NM
			      ,TO_CHAR(D1.ACP_DH, 'YYYY-MM-DD HH24:MI') AS ACP_DH
			      ,D1.ACP_YR
			      ,D1.CVPT_ACP_NO
			      ,D1.REQ_DVSN_CD
			      ,D1.RM_CVPT_ACP_NO
			      ,DECODE(D1.RM_CVPT_ACP_NO, NULL,'',D1.ACP_YR ||'-'|| F_CODE_NM('1000949', D1.RM_ACP_KND_CD) ||'-'||D1.RM_CVPT_ACP_NO) AS ACP_YR_NO 
			      ,DECODE(D1.PRE_RM_CVPT_ACP_NO,NULL,'-',D1.ACP_YR||'-'|| F_CODE_NM('1000949', D1.PRE_RM_ACP_KND_CD) ||'-'||D1.PRE_RM_CVPT_ACP_NO) AS PRE_ACP_YR_NO /* BEST20 이전접수번호 */
			      ,CASE WHEN ( SELECT COUNT(*)
							       FROM TBCSPDCP105L S1
							      WHERE S1.REQ_DVSN_CD = D1.REQ_DVSN_CD
							        AND S1.ACP_YR = D1.ACP_YR
							        AND S1.CVPT_ACP_NO = D1.CVPT_ACP_NO ) > 1 
						THEN D1.TIT_NM||'(합건 : '||
						       ( SELECT S3.ACP_YR||'-'|| F_CODE_NM('1000949', S3.RM_ACP_KND_CD)||'-'||S3.RM_CVPT_ACP_NO
                                   FROM TBCSPDCP105L S2, TBCSPDCP101M S3
                                  WHERE D1.REQ_DVSN_CD = S2.REQ_DVSN_CD
                                    AND D1.ACP_YR = S2.ACP_YR
                                    AND D1.CVPT_ACP_NO = S2.CVPT_ACP_NO
                                    AND S2.SUC_REQ_DVSN_CD = S3.REQ_DVSN_CD
                                    AND S2.SUC_ACP_YR = S3.ACP_YR
                                    AND S2.SUC_CVPT_ACP_NO = S3.CVPT_ACP_NO
                                    AND ROWNUM = 1)
                                   || ' 외 '
                                   || (SELECT COUNT(*)-1
                                        FROM TBCSPDCP105L S2, TBCSPDCP101M S3
                                       WHERE D1.REQ_DVSN_CD     = S2.REQ_DVSN_CD
                                         AND D1.ACP_YR          = S2.ACP_YR
                                         AND D1.CVPT_ACP_NO     = S2.CVPT_ACP_NO
                                         AND S2.SUC_REQ_DVSN_CD = S3.REQ_DVSN_CD
                                         AND S2.SUC_ACP_YR      = S3.ACP_YR
                                         AND S2.SUC_CVPT_ACP_NO = S3.CVPT_ACP_NO )
                                   ||'건 )'
						WHEN ( SELECT COUNT(*) 
						         FROM TBCSPDCP105L S1
						        WHERE S1.SUC_REQ_DVSN_CD = D1.REQ_DVSN_CD
						          AND S1.SUC_ACP_YR = D1.ACP_YR
						          AND S1.SUC_CVPT_ACP_NO = D1.CVPT_ACP_NO) = 1
						THEN D1.TIT_NM ||'(합건 : '|| 
						      ( SELECT S3.ACP_YR||'-'|| F_CODE_NM('1000949', S3.RM_ACP_KND_CD) ||'-'||S3.RM_CVPT_ACP_NO
						          FROM TBCSPDCP105L S2, TBCSPDCP101M S3
						         WHERE S2.REQ_DVSN_CD = S3.REQ_DVSN_CD
						           AND S2.ACP_YR = S3.ACP_YR
						           AND S2.CVPT_ACP_NO = S3.CVPT_ACP_NO
						           AND S2.SUC_REQ_DVSN_CD = D1.REQ_DVSN_CD
						           AND S2.SUC_ACP_YR = D1.ACP_YR
						           AND S2.SUC_CVPT_ACP_NO = D1.CVPT_ACP_NO
						       )
						       || ')'
					ELSE D1.TIT_NM END AS TIT_NM
			      ,DECODE(D1.REQR_KND_CD,'1',D1.CVPTR_NM,'2',D1.RPST_PEN_NM,'3',D1.RPST_PEN_NM,'4',D1.CVPTR_NM) AS CVPTR_NM
			      ,(	SELECT	S1.DPT_NM
   						FROM 	TBDCMACM002M S1
   						WHERE 	S1.DPT_CD = D2.HNDL_DPT_CD
   						)  AS HNDL_DPT_NM
 				  ,(	SELECT S1.CD_NM 
						FROM TBDCMACM013C S1
						WHERE CMM_CD_DVSN_CD = '1000144'
						AND S1.CD = D2.RAL_BLT_DIV_CD 
 						)  AS RAL_BLT_DIV_NM
			      ,(SELECT S2.USR_NAM FROM TBDCMACM001M S2 WHERE USR_ID = D2.HNDL_CHGR_ID) AS HNDL_CHGR_NM
			      ,D1.CVPT_HNDL_STA_CD
			      ,F_CODE_NM('1000361',D1.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
			      ,D4.ORG_NMS AS ORG_CD
			      ,F_CODE_NM('1000754', D3.CVPT_HNDL_DVSN_CD) AS CVPT_HNLD_DVSN_NM
			      ,F_CODE_NM('1000051', D3.T_CVPT_HNDL_DVSN_CD) AS T_CVPT_HNLD_DVSN_NM
			      ,CASE WHEN D1.CVPT_HNDL_STA_CD = '70' THEN NVL(TO_CHAR(D1.CVPT_WDW_DH, 'YYYY-MM-DD'),TO_CHAR(D2.FNL_HNDL_DH, 'YYYY-MM-DD'))
			      	  ELSE TO_CHAR(D2.FNL_HNDL_DH, 'YYYY-MM-DD') END AS FNL_HNDL_DH
			      ,TO_CHAR(D2.FNL_DTB_DH, 'YYYY-MM-DD') AS FNL_DTB_DH
			      ,CASE WHEN D6.CNT > 0 THEN 'O' 
                        WHEN D9.DOC_ID IS NOT NULL THEN 'O'
                        ELSE 'X' END AS HNDL_YN
			      ,CASE WHEN D7.CNT > 0 THEN 'O' 
                        WHEN D10.DOC_ID IS NOT NULL THEN 'O'
                        ELSE 'X' END AS BOGO_YN
			      ,NVL2(D1.RAL_ACP_DPT_CD, (SELECT	S1.CD_NM FROM TBDCMACM013C S1 WHERE S1.CMM_CD_DVSN_CD = '1000144' AND S1.CD = D1.RAL_ACP_DPT_CD)
   					                        ,(SELECT	S1.DPT_NM FROM 	TBDCMACM002M S1 WHERE 	S1.DPT_CD = D1.ACP_DPT_CD) 
   					)  AS ACP_DPT_NM
   				  ,F_CODE_NM('1000056',D1.ACP_RUT_CD) AS ACP_RUT_NM
   				  ,D1.REQR_KND_CD
   				  ,(SELECT 	F_CODE_NM('1000053',S1.RSLT_RPRT_HNDL_RSLT_CD)
   				  	FROM	TBCSPDCP402L S1
   				  	WHERE	(S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO, S1.DGE) IN	(SELECT	S2.REQ_DVSN_CD, S2.ACP_YR, S2.CVPT_ACP_NO, MIN(S2.DGE) AS DGE
   				  																	FROM	TBCSPDCP402L S2
   				  																	WHERE	S2.REQ_DVSN_CD = D1.REQ_DVSN_CD
   				  																	AND		S2.ACP_YR = D2.ACP_YR
   				  																	AND		S2.CVPT_ACP_NO = D2.CVPT_ACP_NO
   				  																	GROUP BY S2.REQ_DVSN_CD, S2.ACP_YR, S2.CVPT_ACP_NO
   				  																	)
   				  ) AS RSLT_RPRT_HNDL_RSLT_NM
   				  ,D1.CPNM_NM
   				  ,F_USR_INFO_BY_ID(D2.BAI_CHGR_ID,'2') AS BAI_CHGR_NM
   				  ,TO_CHAR(TO_DATE(D1.HNDL_DDLN_DT),'YYYY-MM-DD') AS HNDL_DDLN_DT
   				  , F_CODE_NM('1000894', D1.DOC_WRIT_KND_CD) AS DOC_TYPE -- 편집기구분
   				  ,(	SELECT	S1.DPT_NM
   						FROM 	TBDCMACM002M S1
   						WHERE 	S1.DPT_CD = D3.TRNF_DPT_CD
   						)  AS TRNF_DPT_NM
                  ,(	SELECT	S1.DPT_Cd
   						FROM 	TBDCMACM002M S1
   						WHERE 	S1.DPT_CD = D3.TRNF_DPT_CD
   						)  AS TRNF_DPT_CD
				  ,F_CODE_NM('1000946', SUBSTR(D1.TG_ORG_CAT_CD, '0', '1')) AS TG_ORG_CAT_NM
				  ,D1.TG_ORG_CAT_CD
				  ,D11.CLM_NM
			  FROM TBCSPDCP101M D1
			      ,TBCSPDCP201M D2
			      ,TBCSPDCP205L D3
                  ,(SELECT	S1.REQ_DVSN_CD
                            , S1.ACP_YR
                            , S1.CVPT_ACP_NO
                            , AGGR_CONCAT( DECODE(S1.OGN_ORG_DVSN_CD,'10',S2.ORG_NM,'20',S1.ORG_NM), '/') AS ORG_NMS
                    FROM	TBCSPDCP206L S1
                           ,TBDCMACM015M S2
                    WHERE	S1.ORG_CD = S2.ORG_CD(+)
                    AND		S1.REQ_DVSN_CD = '1'
                    AND		S1.ORG_HIS_DVSN_CD = '1'
                    GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO
                    ) D4
			      ,TBCSPDCP102M D5
			      ,(SELECT	S5.REQ_DVSN_CD
                            , S5.ACP_YR
                            , S5.CVPT_ACP_NO
                            , COUNT(*) AS CNT
			      	FROM	TBCSPDCP203M S5
			      	WHERE	S5.DGE IS NULL
			      	AND		S5.CVPT_DOC_DVSN_CD = 'A1'
			      	GROUP BY S5.REQ_DVSN_CD, S5.ACP_YR, S5.CVPT_ACP_NO ) D6
			      ,(SELECT	S6.REQ_DVSN_CD
                            , S6.ACP_YR
                            , S6.CVPT_ACP_NO
                            , COUNT(*) AS CNT
			      	FROM	TBCSPDCP203M S6
			      	WHERE	S6.DGE IS NOT NULL
			      	AND		S6.CVPT_DOC_DVSN_CD = 'B1'
			      	GROUP BY S6.REQ_DVSN_CD, S6.ACP_YR, S6.CVPT_ACP_NO) D7
			      ,(SELECT REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO, MIN(DOC_ID) AS DOC_ID
                    FROM TBCSPDCP603M 
                    WHERE RPRT_CD IN ('B10200400','B10200600')
                    GROUP BY REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO
                    ) D9
                  ,(SELECT REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO, MIN(DOC_ID) AS DOC_ID
                    FROM TBCSPDCP603M 
                    WHERE RPRT_CD = 'B20200400'
                    GROUP BY REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO
                    ) D10
                   ,TBCSPDCP103M D11
			 WHERE 1=1
			   AND D1.REQ_DVSN_CD = '1'
			   AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D2.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D4.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D4.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D4.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D5.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D5.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D5.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D6.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D6.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D6.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D7.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D7.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D7.ACP_YR(+)
			    AND D1.REQ_DVSN_CD = D3.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D3.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D3.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D9.REQ_DVSN_CD(+)
               AND D1.CVPT_ACP_NO = D9.CVPT_ACP_NO(+)
               AND D1.ACP_YR = D9.ACP_YR(+)
               AND D1.REQ_DVSN_CD = D10.REQ_DVSN_CD(+)
               AND D1.CVPT_ACP_NO = D10.CVPT_ACP_NO(+)
               AND D1.ACP_YR = D10.ACP_YR(+)
               AND D1.REQ_DVSN_CD = D11.REQ_DVSN_CD(+)
               AND D1.CVPT_ACP_NO = D11.CVPT_ACP_NO(+)
               AND D1.ACP_YR = D11.ACP_YR(+)
			   AND D3.SRNO(+) = 1

		  ]]>
         <if test='cvptKndDvsnCd != null and cvptKndDvsnCd != ""'>
				AND D2.CVPT_KND_DVSN_CD = #{cvptKndDvsnCd}
		</if>
			
		<if test='acpYr == null or acpYr == "" or rmCvptAcpNo == null or rmCvptAcpNo == ""'>
			<if test='searchDtKey == "A"'>
				   AND TO_CHAR(ACP_DH, 'YYYYMMDD') BETWEEN #{acpDhs} AND #{acpDhe}
			</if>
			<if test='searchDtKey == "B"'>
				   AND CASE WHEN D1.CVPT_HNDL_STA_CD = '70' THEN NVL(TO_CHAR(D1.CVPT_WDW_DH, 'YYYYMMDD'),TO_CHAR(D2.FNL_HNDL_DH, 'YYYYMMDD'))
				      	  ELSE TO_CHAR(D2.FNL_HNDL_DH, 'YYYYMMDD') END BETWEEN #{acpDhs} AND #{acpDhe}
			</if>
			<if test='searchDtKey == "C"'>
				   AND TO_CHAR(D1.FRT_REGI_DH, 'YYYYMMDD') BETWEEN #{acpDhs} AND #{acpDhe}
			</if>
		</if>

		<if test='titNm != null and titNm != ""'>
			AND (D1.TIT_NM LIKE '%'||#{titNm}||'%' OR D1.KYWD_NM_1 like '%' || #{titNm} || '%' OR D1.KYWD_NM_2 like '%' || #{titNm} || '%' OR D1.KYWD_NM_3 like '%' || #{titNm} || '%' OR D1.KYWD_NM_4 like '%' || #{titNm} || '%' OR D1.KYWD_NM_5 like '%' || #{titNm} || '%')
		</if>
		
		<if test='shcKeyWord != null and shcKeyWord != ""'>
			AND (D1.KYWD_NM_1 like '%' || #{shcKeyWord} || '%' OR D1.KYWD_NM_2 like '%' || #{shcKeyWord} || '%' OR D1.KYWD_NM_3 like '%' || #{shcKeyWord} || '%' OR D1.KYWD_NM_4 like '%' || #{shcKeyWord} || '%' OR D1.KYWD_NM_5 like '%' || #{shcKeyWord} || '%')
		</if>

		<if test='acpYr != null and acpYr != ""'>
			AND D1.ACP_YR = #{acpYr}
		</if>
		
		/* BEST20 이전접수번호 조회 */
		<choose>
			<when test='reqDvsnCd != null and reqDvsnCd != "" and rmCvptAcpNo != null and rmCvptAcpNo != ""'>
				 AND ((D1.RM_ACP_KND_CD = #{reqDvsnCd} AND D1.RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0)) OR
				         (D1.PRE_RM_ACP_KND_CD = #{reqDvsnCd}  AND D1.PRE_RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0)))  
			</when>
			<otherwise>
				<if test='reqDvsnCd != null and reqDvsnCd != ""'>
					AND (D1.RM_ACP_KND_CD = #{reqDvsnCd})  
				</if>
				<if test='rmCvptAcpNo != null and rmCvptAcpNo != ""'>
					AND (D1.RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0) OR D1.PRE_RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0))
				</if>
			</otherwise>
		</choose>

		<if test='cvptrNm != null and cvptrNm != ""'>
			AND	(D1.CVPTR_NM LIKE '%'||#{cvptrNm}||'%' OR D1.RPST_PEN_NM LIKE '%'||#{cvptrNm}||'%')
		</if>

		<if test='cpnmNm != null and cpnmNm != ""'>
			AND D1.CPNM_NM LIKE '%'||#{cpnmNm}||'%'
		</if>

		<if test='tnb1 != null and tnb1 != "" or tnb2 != null and tnb2 != "" or tnb3 != null and tnb3 != ""'>
			AND REPLACE(D1.TNB, '-', '') LIKE '%'||#{tnb1}||#{tnb2}||#{tnb3}||'%'
		</if>

		<if test='hpn1 != null and hpn1 != "" or hpn2 != null and hpn2 != "" or hpn3 != null and hpn3 != ""'>
			AND REPLACE(D1.HPN, '-', '') LIKE '%'||#{hpn1}||#{hpn2}||#{hpn3}||'%'
		</if>

		<if test='cvptHndlStaCd != null and cvptHndlStaCd != ""'>
			AND D1.CVPT_HNDL_STA_CD = #{cvptHndlStaCd}
		</if>

		<if test='cvptKndCd != null and cvptKndCd != ""'>
			AND D1.CVPT_KND_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #{cvptKndCd} ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='reqrKndCd != null and reqrKndCd != ""'>
			AND D1.REQR_KND_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #{reqrKndCd} ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='acpRutCd != null and acpRutCd != ""'>
			AND D1.ACP_RUT_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #{acpRutCd} ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
   		</if>

		<if test='mngTypCd != null and mngTypCd != ""'>
			AND D1.MNG_TYP_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #{mngTypCd} ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='hndlChgrId == null or hndlChgrId == ""'>
			<if test='hndlChgrNm != null and hndlChgrNm != ""'>
				AND D2.HNDL_CHGR_ID IN (SELECT USR_ID FROM TBDCMACM001M WHERE USR_NAM LIKE '%'||#{hndlChgrNm}||'%')
			</if>
		</if>
		
		<if test='hndlChgrId != null and hndlChgrId != ""'>
			AND D2.HNDL_CHGR_ID = #{hndlChgrId}
		</if>
		
		<if test='pasvAdmnYn != null and pasvAdmnYn != ""'>
					AND NVL(D2.PASV_ADMN_YN,'N') = #{pasvAdmnYn}
		</if>
		<if test='ad != null and ad != ""'>
					AND (D1.AD LIKE '%'||#{ad}||'%' OR D1.DTL_AD LIKE '%'||#{ad}||'%')
		</if>
		<if test='orgCd != null and orgCd != ""'>
			<if test='subOrgCd == null or subOrgCd == ""'>
					AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD = '1'
																	AND		ORG_CD = #{orgCd}
																 )
			</if>
		</if>	
		<if test='orgCd != null and orgCd != ""'>
			<if test='subOrgCd != null and subOrgCd != ""'>
					AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD = '1'
																	AND		ORG_CD BETWEEN #{orgCd} AND #{subOrgCd}
																 )
			</if>
		</if>
		
<!--		<if test='orgCd == null or orgCd == ""'>
			<if test='orgNm != null and orgNm != ""'>
 				AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD = '1'
																	AND		ORG_CD IN (SELECT ORG_CD FROM TBDCMACM015M WHERE ORG_NM LIKE '%'||#{orgNm}||'%')
																	) 
			</if>
		</if> -->
		
		    <!-- 1차기관 from ~ to에서 1개로만 수정 - 2016.05.04 yyh -->         
<!--     <isNotEmpty property="strCoptOfiCdSt">
        <isEqual property="strCoptOfiCdInClude" compareValue="N">
            /* 소속기관 불포함 */
            AND COPT.ORG_CD = #strCoptOfiCdSt#
        </isEqual>
        <isEqual property="strCoptOfiCdInClude" compareValue="Y">
            /* 소속기관 포함 */
            AND COPT.COPT_OFI_CD LIKE  REPLACE(#strCoptOfiCdSt#,'000','')  || '%'
        </isEqual>
    </isNotEmpty> -->
    
		<if test='trnfOrgCd != null and trnfOrgCd != ""'>
					AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD IN ('2','3')
																	AND		ORG_CD = #{trnfOrgCd}
																 )
		</if>
		
		<if test='trnfOrgCd == null or trnfOrgCd == ""'>
			<if test='trnfOrgNm != null and trnfOrgNm != ""'>
						AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																		FROM	TBCSPDCP206L
																		WHERE	ORG_HIS_DVSN_CD IN ('2','3')
																		AND		ORG_CD IN (SELECT ORG_CD FROM TBDCMACM015M WHERE ORG_NM LIKE '%'||#{trnfOrgNm}||'%')
																	 )
			</if>
		</if>
		
			<if test='trnfDptCd != null and trnfDptCd != ""'>
					AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP205L
																	WHERE	TRNF_DPT_CD = #{trnfDptCd}
																	AND		SRNO=1
																 )
		</if>
		
		<if test='trnfDptCd == null or trnfDptCd == ""'>
			<if test='trnfDptNm != null and trnfDptNm != ""'>
					AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP205L
																	WHERE	TRNF_DPT_CD IN (SELECT DPT_CD FROM TBDCMACM002M WHERE DPT_NM LIKE '%'||#{trnfDptNm}||'%')
																	AND		SRNO=1 )
			  </if>
		    </if>
		    <if test='hndlDptCd == null or hndlDptCd == ""'>
			   <if test='hndlDptNm != null and hndlDptNm != ""'>
				AND D2.RAL_BLT_DIV_CD IN (SELECT DPT_CD FROM TBDCMACM002M WHERE DPT_NM LIKE '%'||#{hndlDptNm}||'%')
			   </if>
		    </if>
		    
		    <if test='hndlChgrId == null or hndlChgrId == ""'>
			  <if test='hndlDptCd != null and hndlDptCd != ""'>
				AND NVL(D2.RAL_BLT_DIV_CD,D1.ACP_DPT_CD) = #{hndlDptCd}
			  </if>
			</if>
		
		/*감찰부서5명 및 중앙민원사무소3명 제외한 조회*/

		<if test='hmpAplNo != null and hmpAplNo != ""'>
			   AND D1.HMP_APL_NO = #{hmpAplNo}
			</if>

		<if test='smgCvptAplNo != null and smgCvptAplNo != ""'>
			   AND D1.SMG_CVPT_APL_NO = #{smgCvptAplNo}
			</if>
		<if test='cvptHndlDvsnCd != null and cvptHndlDvsnCd != ""'>
			   AND D3.CVPT_HNDL_DVSN_CD = #{cvptHndlDvsnCd}
			</if>
			
			<if test='tgOrgCatCd1 != null and tgOrgCatCd1 != ""'>
			AND (SELECT AA.USR_DFN_TXT_1
			         FROM TBDCMACM013C AA
			        WHERE AA.CD = D1.TG_ORG_CAT_CD
		               AND AA.CMM_CD_DVSN_CD = '1000948') = #{tgOrgCatCd1}
		</if>
		<if test='tgOrgCatCd2 != null and tgOrgCatCd2 != ""'>
			AND (SELECT AA.USR_DFN_TXT_2
			         FROM TBDCMACM013C AA
			        WHERE AA.CD = D1.TG_ORG_CAT_CD
		               AND AA.CMM_CD_DVSN_CD = '1000948') = #{tgOrgCatCd2}
		</if>
		<if test='tgOrgCatCd3 != null and tgOrgCatCd3 != ""'>
			AND D1.TG_ORG_CAT_CD = #{tgOrgCatCd3}
		</if>
		
		<if test='mainFuncCatCd != null and mainFuncCatCd != ""'>
			AND D1.MAIN_FUNC_CAT_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{mainFuncCatCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>
		<if test='clmNm != null and clmNm != ""'>
			AND D11.CLM_NM LIKE '%'||#{clmNm}||'%'
		</if>
		
			    <include refid = "include.pageOrder"/>
	</select>



	<select id="CSPDCP611QExcelDownLoadSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP611Mapper.CSPDCP611QExcelDownLoadSelect */
		<![CDATA[
			SELECT CASE WHEN (SELECT COUNT(*)
                    FROM TBCSPDCP105L D13
                   WHERE D1.REQ_DVSN_CD = D13.REQ_DVSN_CD
                     AND D1.CVPT_ACP_NO = D13.CVPT_ACP_NO
                     AND D1.ACP_YR      = D13.ACP_YR
                   GROUP BY D13.REQ_DVSN_CD, D13.ACP_YR, D13.CVPT_ACP_NO) >= 1 
                    THEN D1.ACP_YR||'-'|| F_CODE_NM('1000949', D1.RM_ACP_KND_CD)||'-'||D1.RM_CVPT_ACP_NO 
                    WHEN D14.SUC_CVPT_ACP_NO IS NOT NULL
                    THEN ( SELECT S3.ACP_YR||'-'|| F_CODE_NM('1000949', S3.RM_ACP_KND_CD) ||'-'||S3.RM_CVPT_ACP_NO
                             FROM TBCSPDCP101M S3
                            WHERE S3.REQ_DVSN_CD = D14.REQ_DVSN_CD
                              AND S3.ACP_YR = D14.ACP_YR
                              AND S3.CVPT_ACP_NO = D14.CVPT_ACP_NO
                          )    
                   ELSE '' END AS HAP_NM
			      ,F_CODE_NM('1000599', D2.CVPT_KND_DVSN_CD) AS CVPT_KND_DVSN_NM
			      ,TO_CHAR(D1.ACP_DH, 'YYYY-MM-DD HH:MM') AS ACP_DH
			      ,D1.ACP_YR ||'-'|| F_CODE_NM('1000949', D1.RM_ACP_KND_CD) ||'-'|| D1.RM_CVPT_ACP_NO AS ACP_YR_NO
                  ,D1.SMG_CVPT_APL_NO   
			      ,D1.TIT_NM
			      ,D1.CVPTR_NM
                  ,F_CODE_NM('1000144', D2.RAL_BLT_DIV_CD) AS RAL_BLT_DIV_CD
                  ,F_USR_INFO_BY_ID(D2.HNDL_CHGR_ID, '2') AS USR_NAM
			      ,F_CODE_NM('1000361',D1.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
			      ,D4.ORG_NMS AS ORG_CD
			      ,REPLACE(F_CODE_NM('1000754', D3.CVPT_HNDL_DVSN_CD),'·','') AS CVPT_HNLD_DVSN_NM
			      ,CASE WHEN D1.CVPT_HNDL_STA_CD = '70' THEN NVL(TO_CHAR(D1.CVPT_WDW_DH, 'YYYY-MM-DD'),TO_CHAR(D2.FNL_HNDL_DH, 'YYYY-MM-DD'))
			      	  ELSE TO_CHAR(D2.FNL_HNDL_DH, 'YYYY-MM-DD') END AS FNL_HNDL_DH
                  ,(	SELECT	DECODE(COUNT(*),0,1,COUNT(*))
   						FROM	TBCSPDCP101M S1
   						WHERE	S1.REQ_DVSN_CD = '1'
   						AND		S1.CVPTR_NM = D1.CVPTR_NM
   						AND		S1.HPN = D1.HPN
   					) AS JEBOCNT
   				  ,F_CODE_NM('1000056',D1.ACP_RUT_CD) AS ACP_RUT_NM
   				  ,D4.COPT_ORG_NM
                  ,F_DPT_INFO(D3.AUD_RFR_MTRL_TRNF_DPT_CD,'1') AS AUD_RFR_MTRL_TRNF_DPT_NM
                  ,F_DPT_INFO(D3.TRNF_DPT_CD,'1') AS TRNF_DPT_NM
   				  ,NVL2(D1.RAL_ACP_DPT_CD, F_CODE_NM('1000144',D1.RAL_ACP_DPT_CD)
   					                        ,F_DPT_INFO(D1.ACP_DPT_CD,'1') 
   					) AS ACP_DPT_NM
   				  ,D1.CPNM_NM
   				  ,F_USR_INFO_BY_ID(D2.BAI_CHGR_ID,'2') AS BAI_CHGR_NM
   				  ,NVL(D4.PUB_DVSN_NM,'미분류') AS PUB_DVSN_NM
   				  ,F_CODE_NM('1000358',D1.REQR_KND_CD) AS REQR_KND_NM
   				  ,DECODE(D1.ZCD,NULL,'','(우)'||D1.ZCD||' '||D1.AD||' '||D1.DTL_AD) AS AD
                  ,CASE WHEN (SELECT S5.CVPT_ACP_NO
                            FROM TBCSPDCP203M S5
                           WHERE S5.DGE IS NULL
                             AND S5.CVPT_DOC_DVSN_CD = 'A1'
                             AND D1.REQ_DVSN_CD = S5.REQ_DVSN_CD
                             AND D1.CVPT_ACP_NO = S5.CVPT_ACP_NO
                             AND D1.ACP_YR      = S5.ACP_YR) IS NOT NULL THEN 'O' 
                    WHEN (SELECT MIN(D9.DOC_ID) AS DOC_ID
                            FROM TBCSPDCP603M D9
                           WHERE D9.RPRT_CD IN ('B10200400','B10200600')
                             AND D1.REQ_DVSN_CD = D9.REQ_DVSN_CD
                             AND D1.CVPT_ACP_NO = D9.CVPT_ACP_NO
                             AND D1.ACP_YR      = D9.ACP_YR
                           GROUP BY D9.REQ_DVSN_CD, D9.ACP_YR, D9.CVPT_ACP_NO) IS NOT NULL THEN 'O'
                    ELSE 'X' END AS HNDL_YN
   				  ,TO_CHAR(TO_DATE(D1.HNDL_DDLN_DT),'YYYY-MM-DD') AS HNDL_DDLN_DT 
                  ,F_CODE_NM('1000946', SUBSTR(D1.TG_ORG_CAT_CD, '0', '1')) AS TG_ORG_CAT_NM
                  ,F_CODE_NM('1000947', SUBSTR(D1.TG_ORG_CAT_CD, '0', '3')) AS TG_ORG_CAT_NM2
                  ,F_CODE_NM('1000948', D1.TG_ORG_CAT_CD) AS TG_ORG_CAT_NM3 
				  ,D1.INNER_YN
				  ,D1.INNER_ORG_NM  
				  ,CASE WHEN D1.AUD_INF_TRF_DVSN_CD = 'T' THEN 'O' 
                        ELSE 'X' END AS AUD_INF_TRF_YN
			  FROM TBCSPDCP101M D1
			      ,TBCSPDCP201M D2
			      ,TBCSPDCP205L D3
                  ,(SELECT	S1.REQ_DVSN_CD
                            , S1.ACP_YR
                            , S1.CVPT_ACP_NO
                            , AGGR_CONCAT( DECODE(S1.OGN_ORG_DVSN_CD,'10',S2.ORG_NM,'20',S1.ORG_NM), '/') AS ORG_NMS
                            , AGGR_CONCAT((SELECT ORG_NM FROM TBDCMACM015M WHERE  ORG_CD = S1.COPT_SG_CD||'000000000'),'/') AS COPT_ORG_NM
                            , AGGR_CONCAT(CASE WHEN S1.PUB_DVSN_CD = '10' THEN '국가기관'
                            	WHEN S1.PUB_DVSN_CD IN ('20', '21','22', '23') THEN '지방자치단체'
                            	WHEN S1.PUB_DVSN_CD IN ('30', '31', '32', '33') THEN '공공기관'
                            	WHEN S1.PUB_DVSN_CD = '40'  THEN '기타단체'
                            	ELSE '미분류' END ,'/')AS PUB_DVSN_NM
                    FROM	TBCSPDCP206L S1
                           ,TBDCMACM015M S2
                    WHERE	S1.ORG_CD = S2.ORG_CD(+)
                    AND		S1.REQ_DVSN_CD = '1'
                    AND		S1.ORG_HIS_DVSN_CD = '1'
                    GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO
                    ) D4
                    ,TBCSPDCP103M D12
                    ,(SELECT SUC_REQ_DVSN_CD, SUC_ACP_YR, SUC_CVPT_ACP_NO, REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO
                    FROM TBCSPDCP105L
                    ) D14  
			 WHERE D1.REQ_DVSN_CD = '1'
			   AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D2.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D3.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D3.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D3.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D4.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D4.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D4.ACP_YR(+)
               AND D1.REQ_DVSN_CD = D12.REQ_DVSN_CD(+)
               AND D1.CVPT_ACP_NO = D12.CVPT_ACP_NO(+)
               AND D1.ACP_YR      = D12.ACP_YR(+)
               AND D1.REQ_DVSN_CD = D14.SUC_REQ_DVSN_CD(+)
               AND D1.CVPT_ACP_NO = D14.SUC_CVPT_ACP_NO(+)
               AND D1.ACP_YR = D14.SUC_ACP_YR(+)
			   AND D3.SRNO(+) = '1'
			   ]]>
		<if test='cvptKndDvsnCd != null and cvptKndDvsnCd != ""'>
				AND D2.CVPT_KND_DVSN_CD = #{cvptKndDvsnCd}
		</if>
		<!-- <if test='searchChk != "Y"'> 
			   AND  (D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO) NOT  IN ( SELECT ST.REQ_DVSN_CD, ST.ACP_YR, ST.CVPT_ACP_NO
			   						  FROM  TBCSPDCP105L ST, TBCSPDCP205L TT
			   						  WHERE 1=1
			   						  AND TT.REQ_DVSN_CD = '1'
			   						  AND ST.SUC_REQ_DVSN_CD =TT.REQ_DVSN_CD
			   						  AND ST.SUC_ACP_YR = TT.ACP_YR
			   						  AND ST.SUC_CVPT_ACP_NO = TT.CVPT_ACP_NO   
			   						  AND (TT.AUD_RFR_MTRL_TRNF_DPT_CD IN ('100000','100100') 
			   						  OR   TT.TRNF_DPT_CD  IN ('100000','100100'))
			   )
               
		 	   AND  (D3.AUD_RFR_MTRL_TRNF_DPT_CD NOT IN ('100000','100100') OR  D3.AUD_RFR_MTRL_TRNF_DPT_CD IS NULL)
			   AND  (D3.TRNF_DPT_CD NOT IN ('100000','100100') OR D3.TRNF_DPT_CD IS NULL)
		</if> -->	
		<if test='acpYr == null or acpYr == "" or rmCvptAcpNo == null or rmCvptAcpNo == ""'>
			<if test='searchDtKey == "A"'>
				   AND TO_CHAR(D1.ACP_DH, 'YYYYMMDD') BETWEEN #{acpDhs} AND #{acpDhe}
				</if>
			<if test='searchDtKey == "B"'>
				   AND CASE WHEN D1.CVPT_HNDL_STA_CD = '70' THEN NVL(TO_CHAR(D1.CVPT_WDW_DH, 'YYYYMMDD'),TO_CHAR(D2.FNL_HNDL_DH, 'YYYYMMDD'))
				      	  ELSE TO_CHAR(D2.FNL_HNDL_DH, 'YYYYMMDD') END BETWEEN #{acpDhs} AND #{acpDhe}
				</if>
			<if test='searchDtKey == "C"'>
				   AND TO_CHAR(D1.FRT_REGI_DH, 'YYYYMMDD') BETWEEN #{acpDhs} AND #{acpDhe}
			</if>
		</if>
		
		<if test='titNm != null and titNm != ""'>
			AND (D1.TIT_NM LIKE '%'||#{titNm}||'%' OR D1.KYWD_NM_1 like '%' || #{titNm} || '%' OR D1.KYWD_NM_2 like '%' || #{titNm} || '%' OR D1.KYWD_NM_3 like '%' || #{titNm} || '%' OR D1.KYWD_NM_4 like '%' || #{titNm} || '%' OR D1.KYWD_NM_5 like '%' || #{titNm} || '%')
		</if>
		
		<if test='shcKeyWord != null and shcKeyWord != ""'>
			AND (D1.KYWD_NM_1 like '%' || #{shcKeyWord} || '%' OR D1.KYWD_NM_2 like '%' || #{shcKeyWord} || '%' OR D1.KYWD_NM_3 like '%' || #{shcKeyWord} || '%' OR D1.KYWD_NM_4 like '%' || #{shcKeyWord} || '%' OR D1.KYWD_NM_5 like '%' || #{shcKeyWord} || '%')
		</if>

		<if test='acpYr != null and acpYr != ""'>
			AND D1.ACP_YR = #{acpYr}
		</if>
		
		/* BEST20 이전접수번호 조회 */
		<choose>
			<when test='reqDvsnCd != null and reqDvsnCd != "" and rmCvptAcpNo != null and rmCvptAcpNo != ""'>
				 AND ((D1.RM_ACP_KND_CD = #{reqDvsnCd} AND D1.RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0)) OR
				         (D1.PRE_RM_ACP_KND_CD = #{reqDvsnCd}  AND D1.PRE_RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0)))  
			</when>
			<otherwise>
				<if test='reqDvsnCd != null and reqDvsnCd != ""'>
					AND (D1.RM_ACP_KND_CD = #{reqDvsnCd})  
				</if>
				<if test='rmCvptAcpNo != null and rmCvptAcpNo != ""'>
					AND (D1.RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0) OR D1.PRE_RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0))
				</if>
			</otherwise>
		</choose>

		<if test='cvptrNm != null and cvptrNm != ""'>
			AND	(D1.CVPTR_NM LIKE '%'||#{cvptrNm}||'%' OR D1.RPST_PEN_NM LIKE '%'||#{cvptrNm}||'%')
		</if>

		<if test='cpnmNm != null and cpnmNm != ""'>
			AND D1.CPNM_NM LIKE '%'||#{cpnmNm}||'%'
		</if>

		<if test='tnb1 != null and tnb1 != "" or tnb2 != null and tnb2 != "" or tnb3 != null and tnb3 != ""'>
			AND REPLACE(D1.TNB, '-', '') LIKE '%'||#{tnb1}||#{tnb2}||#{tnb3}||'%'
		</if>

		<if test='hpn1 != null and hpn1 != "" or hpn2 != null and hpn2 != "" or hpn3 != null and hpn3 != ""'>
			AND REPLACE(D1.HPN, '-', '') LIKE '%'||#{hpn1}||#{hpn2}||#{hpn3}||'%'
		</if>

		<if test='cvptHndlStaCd != null and cvptHndlStaCd != ""'>
			AND D1.CVPT_HNDL_STA_CD = #{cvptHndlStaCd}
		</if>

		<if test='cvptKndCd != null and cvptKndCd != ""'>
			AND D1.CVPT_KND_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #{cvptKndCd} ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='reqrKndCd != null and reqrKndCd != ""'>
			AND D1.REQR_KND_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #{reqrKndCd} ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='acpRutCd != null and acpRutCd != ""'>
			AND D1.ACP_RUT_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #{acpRutCd} ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
   		</if>

		<if test='mngTypCd != null and mngTypCd != ""'>
			AND D1.MNG_TYP_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #{mngTypCd} ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>

		<if test='hndlChgrId == null or hndlChgrId == ""'>
			<if test='hndlChgrNm != null and hndlChgrNm != ""'>
				AND D2.HNDL_CHGR_ID IN (SELECT USR_ID FROM TBDCMACM001M WHERE USR_NAM LIKE '%'||#{hndlChgrNm}||'%')
			</if>
		</if>
		
		<if test='hndlChgrId != null and hndlChgrId != ""'>
			AND D2.HNDL_CHGR_ID = #{hndlChgrId}
		</if>
		
		<if test='pasvAdmnYn != null and pasvAdmnYn != ""'>
					AND NVL(D2.PASV_ADMN_YN,'N') = #{pasvAdmnYn}
		</if>
		<if test='ad != null and ad != ""'>
					AND (D1.AD LIKE '%'||#{ad}||'%' OR D1.DTL_AD LIKE '%'||#{ad}||'%')
		</if>
		<if test='orgCd != null and orgCd != ""'>
			<if test='subOrgCd == null or subOrgCd == ""'>
					AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD = '1'
																	AND		ORG_CD = #{orgCd}
																 )
			</if>
		</if>	
		<if test='orgCd != null and orgCd != ""'>
			<if test='subOrgCd != null and subOrgCd != ""'>
					AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD = '1'
																	AND		ORG_CD BETWEEN #{orgCd} AND #{subOrgCd}
																 )
			</if>
		</if>
		
<!--		<if test='orgCd == null or orgCd == ""'>
			<if test='orgNm != null and orgNm != ""'>
 				AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD = '1'
																	AND		ORG_CD IN (SELECT ORG_CD FROM TBDCMACM015M WHERE ORG_NM LIKE '%'||#{orgNm}||'%')
																	) 
			</if>
		</if> -->
		
		    <!-- 1차기관 from ~ to에서 1개로만 수정 - 2016.05.04 yyh -->         
<!--     <isNotEmpty property="strCoptOfiCdSt">
        <isEqual property="strCoptOfiCdInClude" compareValue="N">
            /* 소속기관 불포함 */
            AND COPT.ORG_CD = #strCoptOfiCdSt#
        </isEqual>
        <isEqual property="strCoptOfiCdInClude" compareValue="Y">
            /* 소속기관 포함 */
            AND COPT.COPT_OFI_CD LIKE  REPLACE(#strCoptOfiCdSt#,'000','')  || '%'
        </isEqual>
    </isNotEmpty> -->
    
		<if test='trnfOrgCd != null and trnfOrgCd != ""'>
					AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD IN ('2','3')
																	AND		ORG_CD = #{trnfOrgCd}
																 )
		</if>
		
		<if test='trnfOrgCd == null or trnfOrgCd == ""'>
			<if test='trnfOrgNm != null and trnfOrgNm != ""'>
						AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																		FROM	TBCSPDCP206L
																		WHERE	ORG_HIS_DVSN_CD IN ('2','3')
																		AND		ORG_CD IN (SELECT ORG_CD FROM TBDCMACM015M WHERE ORG_NM LIKE '%'||#{trnfOrgNm}||'%')
																	 )
			</if>
		</if>
		
			<if test='trnfDptCd != null and trnfDptCd != ""'>
					AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP205L
																	WHERE	TRNF_DPT_CD = #{trnfDptCd}
																	AND		SRNO=1
																 )
		</if>
		
		<if test='trnfDptCd == null or trnfDptCd == ""'>
			<if test='trnfDptNm != null and trnfDptNm != ""'>
					AND (D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP205L
																	WHERE	TRNF_DPT_CD IN (SELECT DPT_CD FROM TBDCMACM002M WHERE DPT_NM LIKE '%'||#{trnfDptNm}||'%')
																	AND		SRNO=1 )
			</if>
		</if>
		<if test='hndlDptCd == null or hndlDptCd == ""'>
			<if test='hndlDptNm != null and hndlDptNm != ""'>
				AND D2.RAL_BLT_DIV_CD IN (SELECT DPT_CD FROM TBDCMACM002M WHERE DPT_NM LIKE '%'||#{hndlDptNm}||'%')
			</if>
		</if>
		    
		    <if test='hndlChgrId == null or hndlChgrId == ""'>
			  <if test='hndlDptCd != null and hndlDptCd != ""'>
				AND NVL(D2.RAL_BLT_DIV_CD,D1.ACP_DPT_CD) = #{hndlDptCd}
			  </if>
			</if>
		

		<if test='hmpAplNo != null and hmpAplNo != ""'>
			   AND D1.HMP_APL_NO = #{hmpAplNo}
			</if>

		<if test='smgCvptAplNo != null and smgCvptAplNo != ""'>
			   AND D1.SMG_CVPT_APL_NO = #{smgCvptAplNo}
			</if>
		<if test='cvptHndlDvsnCd != null and cvptHndlDvsnCd != ""'>
			   AND D3.CVPT_HNDL_DVSN_CD = #{cvptHndlDvsnCd}
			</if>
			
			<if test='tgOrgCatCd1 != null and tgOrgCatCd1 != ""'>
			AND (SELECT AA.USR_DFN_TXT_1
			         FROM TBDCMACM013C AA
			        WHERE AA.CD = D1.TG_ORG_CAT_CD
		               AND AA.CMM_CD_DVSN_CD = '1000948') = #{tgOrgCatCd1}
		</if>
		<if test='tgOrgCatCd2 != null and tgOrgCatCd2 != ""'>
			AND (SELECT AA.USR_DFN_TXT_2
			         FROM TBDCMACM013C AA
			        WHERE AA.CD = D1.TG_ORG_CAT_CD
		               AND AA.CMM_CD_DVSN_CD = '1000948') = #{tgOrgCatCd2}
		</if>
		<if test='tgOrgCatCd3 != null and tgOrgCatCd3 != ""'>
			AND D1.TG_ORG_CAT_CD = #{tgOrgCatCd3}
		</if>
		<if test='clmNm != null and clmNm != ""'>
			AND D12.CLM_NM LIKE '%'||#{clmNm}||'%'
		</if>
		<if test='mainFuncCatCd != null and mainFuncCatCd != ""'>
			AND D1.MAIN_FUNC_CAT_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{mainFuncCatCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>
		ORDER BY D1.ACP_YR DESC, D1.CVPT_ACP_NO DESC

	</select>

</mapper>
