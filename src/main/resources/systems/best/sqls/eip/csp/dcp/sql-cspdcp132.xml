<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP132Mapper">


	<select id="CSPDCP132QMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP132Mapper.CSPDCP132QMainSelect */
		<include refid="include.pageSelct" />
		<![CDATA[
			SELECT D1.CVPT_KND_CD
			      ,F_CODE_NM('1000047', D1.CVPT_KND_CD) AS CVPT_KND_NM
			      ,D1.ACP_YR
			      ,D1.CVPT_ACP_NO
			      ,D1.ACP_YR||'-'|| F_CODE_NM('1000949', D1.RM_ACP_KND_CD) ||'-'||D1.RM_CVPT_ACP_NO AS ACP_YR_NO
			      ,D1.TIT_NM
			      ,F_DPT_INFO(D3.HNDL_DPT_CD, '1') AS HNDL_DPT_NM
			      ,(SELECT S1.USR_NAM FROM TBDCMACM001M S1 WHERE S1.USR_ID = D3.HNDL_CHGR_ID) AS USR_NAM
			      ,D4.ORG_NM
			      ,D1.CVPTR_NM
			  FROM TBCSPDCP101M D1
			      ,TBCSPDCP102M D2
			      ,TBCSPDCP201M D3
			      ,(SELECT	S1.REQ_DVSN_CD
                            , S1.ACP_YR
                            , S1.CVPT_ACP_NO
                            , AGGR_CONCAT( DECODE(S1.OGN_ORG_DVSN_CD,'10',S2.ORG_NM,'20',S1.ORG_NM), ' , ') AS ORG_NM
                    FROM	TBCSPDCP206L S1
                           ,TBDCMACM015M S2
                    WHERE	S1.ORG_CD = S2.ORG_CD(+)
                    AND		S1.REQ_DVSN_CD = '1'
                    AND		S1.ORG_HIS_DVSN_CD = '1'
                    GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO
                    ) D4
			 WHERE 1=1
			   AND D1.REQ_DVSN_CD = '1'
			   AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
			   AND D1.ACP_YR      = D2.ACP_YR
			   AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
			   AND D1.REQ_DVSN_CD = D3.REQ_DVSN_CD(+)
			   AND D1.ACP_YR      = D3.ACP_YR(+)
			   AND D1.CVPT_ACP_NO = D3.CVPT_ACP_NO(+)
			   AND D1.REQ_DVSN_CD = D4.REQ_DVSN_CD(+)
			   AND D1.ACP_YR      = D4.ACP_YR(+)
			   AND D1.CVPT_ACP_NO = D4.CVPT_ACP_NO(+)
			   AND D1.RM_CVPT_ACP_NO IS NOT NULL
			   ]]>
		<if test='titNm != null and titNm != ""'>
			AND D1.TIT_NM LIKE '%'||#{titNm}||'%'
		</if>
		<if test='hndlOrgCd != null and hndlOrgCd != ""'>
			AND ( D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO ) IN (
			SELECT D5.REQ_DVSN_CD, D5.ACP_YR, D5.CVPT_ACP_NO
			FROM TBCSPDCP206L D5
			WHERE D5.REQ_DVSN_CD = '1'
			AND D5.ORG_HIS_DVSN_CD = '1'
			AND D5.ORG_CD = #{hndlOrgCd}
			)
		</if>
		<if test='cvptrNm != null and cvptrNm != ""'>
			AND D1.CVPTR_NM LIKE #{cvptrNm}||'%'
		</if>
		ORDER BY D1.ACP_YR DESC
		,D1.RM_CVPT_ACP_NO DESC
		<include refid="include.pageOrder" />
	</select>



	<select id="CSPDCP132QExcelSelectList" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP132Mapper.CSPDCP132QExcelSelectList */
		<![CDATA[
			SELECT D1.CVPT_KND_CD
			      ,F_CODE_NM('1000047', D1.CVPT_KND_CD) AS CVPT_KND_NM
			      ,D1.ACP_YR
			      ,D1.CVPT_ACP_NO
			      ,D1.ACP_YR||'-'|| F_CODE_NM('1000949', D1.RM_ACP_KND_CD) ||'-'||D1.RM_CVPT_ACP_NO AS ACP_YR_NO
			      ,D1.TIT_NM
			      ,F_DPT_INFO(D3.HNDL_DPT_CD, '1') AS HNDL_DPT_NM
			      ,(SELECT S1.USR_NAM FROM TBDCMACM001M S1 WHERE S1.USR_ID = D3.HNDL_CHGR_ID) AS USR_NAM
			      ,D4.ORG_NM
			      ,D1.CVPTR_NM
			  FROM TBCSPDCP101M D1
			      ,TBCSPDCP102M D2
			      ,TBCSPDCP201M D3
			      ,(SELECT	S1.REQ_DVSN_CD
                            , S1.ACP_YR
                            , S1.CVPT_ACP_NO
                            , AGGR_CONCAT( DECODE(S1.OGN_ORG_DVSN_CD,'10',S2.ORG_NM,'20',S1.ORG_NM), ',') AS ORG_NM
                    FROM	TBCSPDCP206L S1
                           ,TBDCMACM015M S2
                    WHERE	S1.ORG_CD = S2.ORG_CD(+)
                    AND		S1.REQ_DVSN_CD = '1'
                    AND		S1.ORG_HIS_DVSN_CD = '1'
                    GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO
                    ) D4
			 WHERE 1=1
			   AND D1.REQ_DVSN_CD = '1'
			   AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
			   AND D1.ACP_YR      = D2.ACP_YR
			   AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
			   AND D1.REQ_DVSN_CD = D3.REQ_DVSN_CD(+)
			   AND D1.ACP_YR      = D3.ACP_YR(+)
			   AND D1.CVPT_ACP_NO = D3.CVPT_ACP_NO(+)
			   AND D1.REQ_DVSN_CD = D4.REQ_DVSN_CD(+)
			   AND D1.ACP_YR      = D4.ACP_YR(+)
			   AND D1.CVPT_ACP_NO = D4.CVPT_ACP_NO(+)
			   ]]>
		<if test='searchtitkey == "1"'>
			<if test='titNm != null and titNm != ""'>
				AND D1.TIT_NM LIKE '%'||#{titNm}||'%'
			</if>
		</if>
		<if test='searchtitkey == "2"'>
			<if test='titNm != null and titNm != ""'>

				AND D2.CVPT_SBT LIKE '%'||#{titNm}||'%'
			</if>
		</if>
		<if test='hndlOrgCd != null and hndlOrgCd != ""'>
			AND ( D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO ) IN (
			SELECT D5.REQ_DVSN_CD, D5.ACP_YR, D5.CVPT_ACP_NO
			FROM TBCSPDCP206L D5
			WHERE D5.REQ_DVSN_CD = '1'
			AND D5.ORG_HIS_DVSN_CD = '1'
			AND D5.ORG_CD = #{hndlOrgCd}
			)
		</if>
		<if test='cvptrNm != null and cvptrNm != ""'>
			AND D1.CVPTR_NM LIKE #{cvptrNm}||'%'
		</if>
		ORDER BY D1.ACP_YR DESC
		,D1.RM_CVPT_ACP_NO DESC

	</select>

</mapper>
