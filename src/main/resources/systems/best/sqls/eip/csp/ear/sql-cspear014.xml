<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.ear.dao.CSPEAR014Mapper">
	
	<select id="CSPEAR014PInitSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR014Mapper.CSPEAR014PInitSelect */
		<![CDATA[
			SELECT	C.TNB AS SEN_TNB
					,A.HPN AS RCPT_TNB
			FROM	TBCSPDCP101M A
					,TBCSPEAR001M B
					,TBDCMACM002M C
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
			AND		A.ACP_YR = #{acpYr}
			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		B.HNDL_DPT_CD = C.DPT_CD
		]]>
	</select>
	
 	<select id="CSPEAR014PMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR014Mapper.CSPEAR014PMainSelect */
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.HPN
   					,C.SRNO
   					,C.SEN_DT
   					,C.SMS_TXT
   					,C.SEN_TNB
   					,C.RCPT_TNB
   			FROM	TBCSPDCP101M A
   					,TBCSPEAR001M B
   					,TBCSPEAR008H C
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = #{reqDvsnCd}
			AND		A.ACP_YR = #{acpYr}
			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
   			AND		A.ACP_YR = C.ACP_YR
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
   			ORDER BY C.SRNO DESC
		]]>
	</select>
	
	<insert id="CSPEAR014PMmsMsgInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR014Mapper.CSPEAR014PMmsMsgInsert */
		<![CDATA[
			INSERT INTO MMS_CONTENTS_INFO 
				 	(	CONT_SEQ
				 		, FILE_CNT
				 		, MMS_BODY
				 		, MMS_SUBJECT
				 	) 
			VALUES (	#{contSeq}
						, 1
						, #{smsTxt}
						, '감사원 감사청구 문자통보'
					)
		]]>
	</insert>
	
	<insert id="CSPEAR014PMsgInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR014Mapper.CSPEAR014PMsgInsert */
		<![CDATA[
			INSERT INTO MSG_DATA
				 	(	MSG_SEQ
				 		, CUR_STATE
				 		, REQ_DATE
				 		, CALL_TO
				 		, CALL_FROM
				 		, SMS_TXT
				 		, MSG_TYPE
				 		, CONT_SEQ
				 		, USERDATA
				 	) 
			VALUES (	MSG_DATA_SEQ.NEXTVAL
						, 0
						, SYSDATE
						, REPLACE(TRIM(#{rcptTnb}),'-','')
						, REPLACE(TRIM(#{senTnb}),'-','')
						, ''
						, 6
						, #{contSeq}
						, #{reqDvsnCd}||#{acpYr}||#{cvptAcpNo}
					)
		]]>
	</insert>
	
	<insert id="CSPEAR014PSmsSendInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR014Mapper.CSPEAR014PSmsSendInsert */
		<![CDATA[
			INSERT INTO	TBCSPEAR008H
					(	REQ_DVSN_CD
						,ACP_YR
						,CVPT_ACP_NO
						,SRNO
						,SEN_DT
						,SMS_TXT
						,SEN_TNB
						,RCPT_TNB
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
					)
			VALUES	(	#{reqDvsnCd}
						,#{acpYr}
						,#{cvptAcpNo}
						,(	SELECT	NVL(MAX(SRNO),0)+1
							FROM	TBCSPEAR008H
							WHERE	REQ_DVSN_CD = #{reqDvsnCd}
							AND		ACP_YR = #{acpYr}
							AND		CVPT_ACP_NO = #{cvptAcpNo}
						)
						,TO_CHAR(SYSDATE,'YYYYMMDD')
						,#{smsTxt}
						,#{senTnb}
						,#{rcptTnb}
						,#{frtUsrId}
						,#{fnlUsrId}
						,#{fnlDealDptCd}
						,#{fnlMnuId}
						,SYSDATE
						,SYSDATE
					)
			
		]]>
	</insert>
</mapper> 
