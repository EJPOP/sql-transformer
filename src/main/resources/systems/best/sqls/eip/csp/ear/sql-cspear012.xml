<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.ear.dao.CSPEAR012Mapper">
 	<select id="CSPEAR012PMainSelect" parameterType="paramMap" resultType="egovMap">
 		/* kr.go.bai.eip.csp.ear.dao.CSPEAR012Mapper.CSPEAR012PMainSelect */
 		<include refid="include.pageSelct" />
 	
		<![CDATA[
		SELECT T1.DVSN_CD
		      ,T1.SRNO
		      ,T1.KEY1
		      ,T1.KEY2
		      ,T1.KEY3
		      ,T1.KEY4
		      ,T1.TITLE
		  FROM (
		  
			    SELECT A.REQ_DVSN_CD                                                             AS DVSN_CD
					  ,A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||A.RM_CVPT_ACP_NO  AS SRNO
					  ,A.ACP_YR                                                                  AS KEY1
					  ,A.REQ_DVSN_CD                                                             AS KEY2
	   				  ,A.CVPT_ACP_NO                                                             AS KEY3
	   				  ,''                                                                        AS KEY4
	   				  ,A.TIT_NM                                                                  AS TITLE
	   			  FROM TBCSPDCP101M A
	   			 WHERE 1 = 1
	   			   AND A.CVPT_HNDL_STA_CD NOT IN ('10')
	   			   AND A.RM_CVPT_ACP_NO IS NOT NULL
	   			   AND TO_CHAR(A.ACP_DH,'YYYYMMDD') BETWEEN NVL(#{acpDhs},'19000101') AND NVL(#{acpDhe},'99991231')
			]]>
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
	               AND 1 = CASE WHEN #{reqDvsnCd} IN ('1','2','3') THEN 1
	   			                ELSE 0
	   			            END 		
				   AND A.REQ_DVSN_CD = #{reqDvsnCd} 
			</if>		
	
		<if test='yr != null and yr != ""'>
					AND A.ACP_YR = #{yr}
				</if>
	
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
					AND A.RM_CVPT_ACP_NO = #{cvptAcpNo}
				</if>
						
		<if test='cvptrNm != null and cvptrNm != ""'>
				    AND A.CVPTR_NM LIKE '%' || #{cvptrNm} || '%'	
				</if>
					
		<if test='titNm != null and titNm != ""'>
					AND A.TIT_NM LIKE '%' || #{titNm} || '%'
				</if>
				
				UNION ALL
			
			<![CDATA[
				SELECT A.REQ_DVSN_CD                              AS DVSN_CD
					  ,A.ACP_YR||'-국회-'||A.CVPT_ACP_NO          AS SRNO
					  ,A.ACP_YR                                   AS KEY1
					  ,A.REQ_DVSN_CD                              AS KEY2
	   				  ,A.CVPT_ACP_NO                              AS KEY3
	   				  ,''                                         AS KEY4
	   				  ,A.AUD_REQ_TIT_NM                           AS TITLE
				  FROM TBCSPEAR007M A
				 WHERE 1=1
				  AND A.REQ_DT BETWEEN NVL(#{acpDhs},'19000101') AND NVL(#{acpDhe},'99991231')
			]]>
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
	              AND A.REQ_DVSN_CD = #{reqDvsnCd} 
			</if>			
		<if test='yr != null and yr != ""'>
				  AND A.ACP_YR = #{yr}
				</if>
			
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
				 AND A.CVPT_ACP_NO = #{cvptAcpNo}
			</if>		
			
		<if test='cvptrNm != null and cvptrNm != ""'>
			     AND A.CHGR_NM LIKE '%' || #{cvptrNm} || '%'	
			</if>		
			
		<if test='titNm != null and titNm != ""'>
				 AND A.AUD_REQ_TIT_NM LIKE '%' || #{titNm} || '%'
			</if>
						
			UNION ALL
			
			<!-- 정보추가 - 2016.04.21 yyh -->
			<![CDATA[
				SELECT '0'                                        AS DVSN_CD
					  ,A.YE||'-정보-'||A.SRNO                      AS SRNO
					  ,A.YE                                       AS KEY1
					  ,TO_CHAR(A.SRNO)                            AS KEY2
	   				  ,''                                         AS KEY3
	   				  ,''                                         AS KEY4
	   				  ,A.TIT_TXT                                  AS TITLE
				  FROM TBCSPBII100M A
				 WHERE 1=1
				  AND A.ACP_DT BETWEEN NVL(#{acpDhs},'19000101') AND NVL(#{acpDhe},'99991231')
			]]>
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
	              AND '0' = #{reqDvsnCd} 
			</if>			
		<if test='yr != null and yr != ""'>
				  AND A.YE = #{yr}
				</if>
			
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
				 AND A.SRNO = #{cvptAcpNo}
			</if>		
			
		<if test='titNm != null and titNm != ""'>
				 AND A.TIT_TXT LIKE '%' || #{titNm} || '%'
			</if>				
			
			UNION ALL
			
			<![CDATA[		
			    SELECT CASE WHEN ACP_DVSN_CD = '1' THEN '5'
	                        WHEN ACP_DVSN_CD = '2' THEN '6'
	                        WHEN ACP_DVSN_CD = '3' THEN '7'
	                    END                                                                      AS DVSN_CD
	                  ,CASE WHEN ACP_YR >= '2016' 
	                             THEN ACP_YR || '-' || DECODE(ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || ACP_SRNO
	                        ELSE 
	                                  ACP_YR || '-' || ACP_DVSN_CD || '-' || ACP_SRNO
	                    END                                                                                                       
	                                                                                             AS SRNO
					  ,ACP_YR                                                                    AS KEY1
					  ,ACP_DVSN_CD                                                               AS KEY2
	   				  ,TO_CHAR(ACP_SRNO)                                                         AS KEY3
	   				  ,DPT_CD                                                                    AS KEY4
	   	              ,TIT_NM                                                                    AS TITLE
	             FROM TBBADFRE012M
	            WHERE 1 = 1
	   			  AND ACP_DT BETWEEN NVL(#{acpDhs},'19000101') AND NVL(#{acpDhe},'99991231')
			]]>
			
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
	               AND 1 = CASE WHEN #{reqDvsnCd} IN ('5','6','7') THEN 1
	   			                ELSE 0
	   			            END 		
				   AND ACP_DVSN_CD = CASE WHEN #{reqDvsnCd} = '5' THEN '1'
	                                      WHEN #{reqDvsnCd} = '6' THEN '2'
	                                      WHEN #{reqDvsnCd} = '7' THEN '3'
	                                  END 
			</if>	
					
		<if test='yr != null and yr != ""'>
				  AND ACP_YR = #{yr}
			</if>
			
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
				  AND ACP_SRNO = #{cvptAcpNo}
			</if>
						
		<if test='cvptrNm != null and cvptrNm != ""'>
				  AND REQR_NM LIKE '%' || #{cvptrNm} || '%'	
			</if>
			
		<if test='titNm != null and titNm != ""'>
				  AND TIT_NM LIKE '%' || #{titNm} || '%'
			</if>
	
			UNION ALL
			
			<![CDATA[
				SELECT '8'                                 AS DVSN_CD
					  ,T1.YR||'-손망-'||T1.ACP_NO         AS SRNO
					  ,T1.ORG_CD                           AS KEY1
					  ,T1.NTF_DVSN_CD                      AS KEY2
	   				  ,T1.NNB                              AS KEY3
	   				  ,''                                  AS KEY4
	   				  ,T1.TIT_NM                           AS TITLE
				  FROM TBBADGDA001M T1
				 WHERE 1=1
				  AND T1.ACP_DT BETWEEN NVL(#{acpDhs},'19000101') AND NVL(#{acpDhe},'99991231')
	              AND T1.NTF_DVSN_CD = '2'           
	              AND T1.OGN_DVSN_CD IN ('3','4','5')			  
			]]>
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
	              AND '8' = #{reqDvsnCd} 
			</if>			
		<if test='yr != null and yr != ""'>
				  AND T1.YR = #{yr}
				</if>
			
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
				 AND T1.ACP_NO = #{cvptAcpNo}
			</if>		
			
		<if test='cvptrNm != null and cvptrNm != ""'>
			     AND EXISTS (SELECT 1
			                   FROM TBBADGDA001L
			                  WHERE ORG_CD      = T1.ORG_CD
			                    AND NTF_DVSN_CD = T1.NTF_DVSN_CD
			                    AND NNB         = T1.NNB
			                    AND DFNT_NM LIKE '%' || #{cvptrNm} || '%')
			</if>		
			
		<if test='titNm != null and titNm != ""'>
				 AND T1.TIT_NM LIKE '%' || #{titNm} || '%'
			</if>
			
			
			UNION ALL
			
			<![CDATA[
				SELECT '9'                                 AS DVSN_CD
					  ,T1.YR||'-판청-'||T1.ACP_NO       AS SRNO
					  ,T1.ORG_CD                           AS KEY1
					  ,T1.NTF_DVSN_CD                      AS KEY2
	   				  ,T1.NNB                              AS KEY3
	   				  ,''                                  AS KEY4
	   				  ,T1.TIT_NM                           AS TITLE
				  FROM TBBADGDA001M T1
				 WHERE 1=1
				  AND T1.ACP_DT BETWEEN NVL(#{acpDhs},'19000101') AND NVL(#{acpDhe},'99991231')
	              AND T1.NTF_DVSN_CD = '2'           
	              AND T1.OGN_DVSN_CD = '6'	  
			]]>
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
	              AND '9' = #{reqDvsnCd} 
			</if>			
		<if test='yr != null and yr != ""'>
				  AND T1.YR = #{yr}
				</if>
			
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
				 AND T1.ACP_NO = #{cvptAcpNo}
			</if>		
			
		<if test='cvptrNm != null and cvptrNm != ""'>
			     AND EXISTS (SELECT 1
			                   FROM TBBADGDA001L
			                  WHERE ORG_CD      = T1.ORG_CD
			                    AND NTF_DVSN_CD = T1.NTF_DVSN_CD
			                    AND NNB         = T1.NNB
			                    AND DFNT_NM LIKE '%' || #{cvptrNm} || '%')
			</if>		
			
		<if test='titNm != null and titNm != ""'>
				 AND T1.TIT_NM LIKE '%' || #{titNm} || '%'
			</if>		
				
			UNION ALL
			
			<!-- 특수관리추가 - 2016.04.21 yyh -->
			<![CDATA[
				SELECT 'A'                                        AS DVSN_CD
					  ,F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, C.AUD_KND_CD, '-') ||'-'|| A.DSP_RQ_SNO ||'-'|| F_ORG_INFO(B.RLTN_ORG_CD,'1') 
					                                              AS SRNO
					  ,A.AUD_YR                                   AS KEY1
					  ,A.AUD_NO                                   AS KEY2
	   				  ,TO_CHAR(A.DSP_RQ_SNO)                      AS KEY3
	   				  ,B.RLTN_ORG_CD                              AS KEY4
	   				  ,A.TIT_TXT                                  AS TITLE
				  FROM  TBBADEAR001M A
				       ,TBBADFRE011M B
				       ,TBBADDED001M C
				 WHERE 1=1
				  AND A.AUD_YR     = B.AUD_YR 
				  AND A.AUD_NO     = B.AUD_NO
				  AND A.DSP_RQ_SNO = B.DSP_RQ_SNO
				  AND B.MNG_SNO    = (SELECT MIN(MNG_SNO)
				                        FROM TBBADFRE011M
				                       WHERE AUD_YR      = B.AUD_YR 
				                         AND AUD_NO      = B.AUD_NO
				                         AND DSP_RQ_SNO  = B.DSP_RQ_SNO
				                         AND RLTN_ORG_CD = B.RLTN_ORG_CD)			  
				  AND A.AUD_YR     = C.AUD_YR
				  AND A.AUD_NO     = C.AUD_NO 
				  
				  AND NVL(B.ASG_DT,'19000101') BETWEEN NVL(#{acpDhs},'19000101') AND NVL(#{acpDhe},'99991231')
			]]>
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
	              AND 'A' = #{reqDvsnCd} 
			</if>			
		<if test='yr != null and yr != ""'>
				  AND A.AUD_YR = #{yr}
				</if>
			
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
				 AND A.DSP_RQ_SNO = #{cvptAcpNo}
			</if>		
			
		<if test='titNm != null and titNm != ""'>
				 AND A.TIT_TXT LIKE '%' || #{titNm} || '%'
				</if>
				
			) T1
			 ,TBDCMACM013C T2
	    WHERE T2.CMM_CD_DVSN_CD = '1000742'
	      AND T2.CD            != '000000000'
	      AND T1.DVSN_CD        = T2.CD
	      
		<if test='tskDvsnCd == "1"'>
	      AND T2.USR_DFN_TXT_3 IN ('10','11')  
	    </if>
		<if test='tskDvsnCd == "2"'>
	      AND T2.USR_DFN_TXT_3 IN ('01','11')  
	    </if>	      

		<include refid="include.pageOrder" />
	</select>
</mapper> 
