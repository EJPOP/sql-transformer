<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper">

	<select id="CSPEAR005ECodeSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005ECodeSelect */
		<![CDATA[
			SELECT	CD, CD_NM, USR_DFN_TXT_1, USR_DFN_TXT_2, USR_DFN_TXT_3
			FROM	TBDCMACM013C A
			WHERE	A.CMM_CD_DVSN_CD = '1000379'
			AND		A.CD <> '000000000'
		]]>
	</select>

	<select id="CSPEAR005ECodeSelect2" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005ECodeSelect2 */
		<![CDATA[
			SELECT	CD, CD_NM, USR_DFN_TXT_1, USR_DFN_TXT_2, USR_DFN_TXT_3
			FROM	TBDCMACM013C A
			WHERE	A.CMM_CD_DVSN_CD = '1000746'
			AND		A.CD <> '000000000'
		]]>
	</select>

 	<select id="CSPEAR004EMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR004EMainSelect */
		<include refid = "include.pageSelct"/>
		<![CDATA[
		SELECT REQ_DVSN_CD
		        , REQ_DVSN_NM
		        , ACP_YR
		        , CVPT_ACP_NO
		        , ACP_NO
		        , CASE WHEN ACP_STEP_NM IS NOT NULL AND CVPT_HNDL_STA_CD <> '170' THEN ACP_STEP_NM ELSE CVPT_HNDL_STA_NM END AS ACP_STEP_NM
		        , CVPTR_NM
		        , TIT_NM
		        , ACP_DH
		        , REQR_DVSN_CD
		        , CVPT_HNDL_STA_CD
		        , CVPT_HNDL_STA_NM
		        , HNDL_CHGR_NM
		        , HNDL_DPT_NM
		        , HNDL_CHGR_ID
		        , HNDL_DPT_CD
		        , HNDL_DDLN_DT
		        , DLAY_CNT
		        , PRC_CNT
		        , DOC_TYPE
		FROM (
			SELECT	A.REQ_DVSN_CD
					,F_CODE_NM('1000740',A.REQ_DVSN_CD) AS REQ_DVSN_NM
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||substring(A.CVPT_ACP_NO, 3, 3) AS ACP_NO
   					,A.CVPTR_NM
   					,A.TIT_NM
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
   					,B.REQR_DVSN_CD
   					,F_CODE_NM('1000080',B.REQR_DVSN_CD) AS REQR_DVSN_NM
   					,A.CVPT_HNDL_STA_CD
   					,F_CODE_NM('1000361',A.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
   					, (	SELECT	ACP_STEP_NM
			      		FROM	TBCSPDCP601M S3
			      		WHERE	(S3.REQ_DVSN_CD, S3.ACP_YR, S3.CVPT_ACP_NO, ACP_STEP_CD ) IN (	SELECT	S4.REQ_DVSN_CD,S4.ACP_YR,S4.CVPT_ACP_NO,MAX(ACP_STEP_CD)
			      																		FROM	TBCSPDCP601M S4
			      																		WHERE	A.REQ_DVSN_CD = S4.REQ_DVSN_CD
			      																		AND		A.ACP_YR = S4.ACP_YR
			      																		AND		A.CVPT_ACP_NO = S4.CVPT_ACP_NO
                                                                                        AND     S4.STEP_CMPT_YN = 'P'
			      																		GROUP BY S4.REQ_DVSN_CD,S4.ACP_YR,S4.CVPT_ACP_NO
			      																	))  AS    ACP_STEP_NM
   					,F_USR_INFO_BY_ID(B.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
   					,(	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = B.HNDL_DPT_CD
   					) AS HNDL_DPT_NM
   					,B.HNDL_CHGR_ID
   					,B.HNDL_DPT_CD
   					,CASE
				         WHEN A.REQ_DVSN_CD IN ('2','3') AND EXAM_RPT_APV_DT IS NULL  
				         THEN 
				         		CASE WHEN A.REQ_DVSN_CD = '2'
				         				THEN TO_CHAR(A.ACP_DH+30+F_SPMT_RQ_DAY_COUNT(A.REQ_DVSN_CD,A.ACP_YR,A.CVPT_ACP_NO)+NVL(C.BZT_DCN,0),'YYYY-MM-DD')
                            		ELSE TO_CHAR(ADD_MONTHS(A.ACP_DH ,1)+F_SPMT_RQ_DAY_COUNT(A.REQ_DVSN_CD,A.ACP_YR,A.CVPT_ACP_NO)+NVL(C.BZT_DCN,0),'YYYY-MM-DD') 
                            	END
				         WHEN A.REQ_DVSN_CD = '2' THEN TO_CHAR(TO_DATE(EXAM_RPT_APV_DT)+60, 'YYYY-MM-DD')
				         ELSE TO_CHAR(ADD_MONTHS(TO_DATE(EXAM_RPT_APV_DT) , 6), 'YYYY-MM-DD')
				       END AS HNDL_DDLN_DT
				    ,CASE WHEN B.AUD_RSLT_CD = '08' THEN NULL ELSE
                        CASE WHEN
                             CASE
                                 WHEN A.REQ_DVSN_CD IN ('2','3') AND EXAM_RPT_APV_DT IS NULL  
                                 THEN 
                                        CASE WHEN A.REQ_DVSN_CD = '2'
                                                THEN A.ACP_DH+30+F_SPMT_RQ_DAY_COUNT(A.REQ_DVSN_CD,A.ACP_YR,A.CVPT_ACP_NO)+NVL(C.BZT_DCN,0)
                                            ELSE ADD_MONTHS(A.ACP_DH ,1)+F_SPMT_RQ_DAY_COUNT(A.REQ_DVSN_CD,A.ACP_YR,A.CVPT_ACP_NO)+NVL(C.BZT_DCN,0)
                                        END
                                 WHEN A.REQ_DVSN_CD = '2' THEN TO_DATE(EXAM_RPT_APV_DT)+60
                                 ELSE ADD_MONTHS(TO_DATE(EXAM_RPT_APV_DT) , 6)
                             END < NVL(TO_DATE(B.AUD_RSLT_RPL_DT), SYSDATE)
                         THEN 
                            ROUND(
                                 NVL(TO_DATE(B.AUD_RSLT_RPL_DT), SYSDATE) - 
                                 CASE
                                 WHEN A.REQ_DVSN_CD IN ('2','3') AND EXAM_RPT_APV_DT IS NULL  
                                 THEN 
                                        CASE WHEN A.REQ_DVSN_CD = '2'
                                                THEN A.ACP_DH+30+F_SPMT_RQ_DAY_COUNT(A.REQ_DVSN_CD,A.ACP_YR,A.CVPT_ACP_NO)+NVL(C.BZT_DCN,0)
                                            ELSE ADD_MONTHS(A.ACP_DH ,1)+F_SPMT_RQ_DAY_COUNT(A.REQ_DVSN_CD,A.ACP_YR,A.CVPT_ACP_NO)+NVL(C.BZT_DCN,0)
                                        END
                                 WHEN A.REQ_DVSN_CD = '2' THEN TO_DATE(EXAM_RPT_APV_DT)+60
                                 ELSE ADD_MONTHS(TO_DATE(EXAM_RPT_APV_DT) , 6)
                                END)
                         ELSE NULL END 
                     END AS DLAY_CNT
                    ,(SELECT COUNT(CVPT_ACP_NO)
					   FROM TBCSPDCP601M
					  WHERE ACP_YR = A.ACP_YR
					     AND REQ_DVSN_CD = A.REQ_DVSN_CD
					     AND CVPT_ACP_NO = A.CVPT_ACP_NO) AS PRC_CNT
					, F_CODE_NM('1000894', A.DOC_WRIT_KND_CD) AS DOC_TYPE /* 편집기 구분  */
   			FROM	TBCSPDCP101M A
   					,TBCSPEAR001M B 
				   ,( SELECT sum(nvl(AUD_DCN,0)) BZT_DCN, D.TSK_KEY1, D.TSK_KEY2, D.TSK_KEY3
						FROM TBBADDED001M A
					    LEFT OUTER JOIN TBBADDED101L B
					            ON A.AUD_YR = B.AUD_YR
					           AND A.AUD_NO = B.AUD_NO
					           AND B.AUD_STEP_CD != 'A1030'                          
					    INNER JOIN TBBADDED002M C
					            ON A.AUD_YR  = C.REL_AUD_YR
					           AND A.AUD_NO = C.REL_AUD_NO
					    INNER JOIN TBBADDED030L D ON A.AUD_YR = D.AUD_YR AND A.AUD_NO = D.AUD_NO  
					    LEFT OUTER JOIN TBCSPDCP101M E
                                ON D.TSK_KEY1 = E.ACP_YR
                                AND D.TSK_KEY2 = E.REQ_DVSN_CD
                                AND D.TSK_KEY3 = E.CVPT_ACP_NO
                        LEFT OUTER JOIN TBCSPEAR001M F
                                ON E.ACP_YR = F.ACP_YR
                                AND E.REQ_DVSN_CD = F.REQ_DVSN_CD
                                AND E.CVPT_ACP_NO = F.CVPT_ACP_NO
                        WHERE 
                             NVL(CASE WHEN F.AUD_RSLT_CD = '08' THEN TO_CHAR(E.CVPT_WDW_DH,'YYYY-MM-DD')        
                                ELSE  
                                    CASE WHEN E.REQ_DVSN_CD = '3' 
                                         THEN NVL(TO_CHAR(TO_DATE(F.EXAM_RPT_APV_DT),'YYYY-MM-DD'),( 
                                            SELECT TO_CHAR(MAX(C1.APV_DH),'YYYY-MM-DD') 
                                                FROM TBBADDED030L A1,TBBADDED103M B1, TBDCMACM023L C1
                                                 WHERE A1.TSK_KEY1(+)=E.ACP_YR 
                                                    AND A1.TSK_KEY2(+)=E.REQ_DVSN_CD 
                                                    AND A1.TSK_KEY3(+) =E.CVPT_ACP_NO
                                                    AND A1.AUD_YR=B1.AUD_YR 
                                                    AND A1.AUD_NO=B1.AUD_NO 
                                                    AND B1.APV_RQS_ID = C1.APV_DOC_NO 
                                                    AND B1.RPRT_CD = 'A10300100' 
                                                    AND B1.APV_STA_CD ='30' 
                                            )
                                         )    
                                     ELSE (SELECT TO_CHAR(TO_DATE(MAX(B.CMT_OEN_DT)),'YYYY-MM-DD') 
                                                FROM TBCSPEAR011M A , TBCSPEAR010M B 
                                                    WHERE A.ACP_YR(+) = E.ACP_YR 
                                                        AND A.REQ_DVSN_CD(+) = E.REQ_DVSN_CD  
                                                        AND A.CVPT_ACP_NO(+) = E.CVPT_ACP_NO 
                                                        AND A.CMT_DVSN_CD = B.CMT_DVSN_CD 
                                                        AND A.CMT_OEN_YE = B.CMT_OEN_YE 
                                                        AND A.CMT_DGE = B.CMT_DGE
                                                        AND A.CMT_RSLT_CD != '09'
                                                        )  
                                    END
                                END,'9999-99-99') > TO_CHAR(TO_DATE(C.AUD_STR_DT),'YYYY-MM-DD')
					    GROUP BY D.TSK_KEY1, D.TSK_KEY2, D.TSK_KEY3 ) C
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = B.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)
   			AND		A.CVPT_HNDL_STA_CD NOT IN ('10','20','21')
            AND		A.REQ_DVSN_CD = C.TSK_KEY2(+) 
            AND		A.ACP_YR = C.TSK_KEY1(+) 
            AND		A.CVPT_ACP_NO = C.TSK_KEY3(+)   			
		]]>
		<if test='auth != null and auth != ""'>
    			AND		(#{auth} = 'ALL' OR B.HNDL_CHGR_ID = #{usrId} OR B.AUD_EXEC_DCS_CHGR_ID = #{usrId} OR B.AUD_CHGR_ID = #{usrId})
  			</if>
		<if test='reqDvsnCd != null and reqDvsnCd != ""'>
				AND	A.REQ_DVSN_CD = #{reqDvsnCd}
			</if>
		<if test='reqDvsnCd == null or reqDvsnCd == ""'>
				AND	A.REQ_DVSN_CD IN ('2','3')
			</if>
		<if test='acpDhs != null and acpDhs != ""'>
				AND	TO_CHAR(A.ACP_DH,'YYYYMMDD') &gt;= #{acpDhs}
			</if>
		<if test='acpDhe != null and acpDhe != ""'>
				AND	TO_CHAR(A.ACP_DH,'YYYYMMDD') &lt;= #{acpDhe}
			</if>
		<if test='titNm != null and titNm != ""'>
				AND	A.TIT_NM LIKE '%'||#{titNm}||'%'
			</if>
		<if test='acpYr != null and acpYr != ""'>
				AND	A.ACP_YR = #{acpYr}
			</if>
		<if test='cvptAcpNo != null and cvptAcpNo != ""'>
				AND	A.CVPT_ACP_NO = #{cvptAcpNo}
			</if>
		<if test='cvptHndlStaCd != null and cvptHndlStaCd != ""'>
				AND	A.CVPT_HNDL_STA_CD = #{cvptHndlStaCd}
			</if>
		<if test='cvptrNm != null and cvptrNm != ""'>
				AND	(A.CVPTR_NM LIKE '%'||#{cvptrNm}||'%' OR A.RPST_PEN_NM LIKE '%'||#{cvptrNm}||'%')
			</if>
		<![CDATA[
			ORDER BY A.ACP_YR DESC, A.CVPT_ACP_NO DESC
		)
		]]>
		<include refid = "include.pageOrder"/>
	</select>

	<resultMap type="java.util.HashMap" id="CSPEAR005">
 		<result property="reqDvsnCd" column="REQ_DVSN_CD"                   jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="acpYr" column="ACP_YR"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptAcpNo" column="CVPT_ACP_NO"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="acpNo" column="ACP_NO"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="reqrKndCd" column="REQR_KND_CD"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptrNm" column="CVPTR_NM"                         jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="btdt" column="BTDT"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="jbNm" column="JB_NM"                               jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="rpstPenNm" column="RPST_PEN_NM"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="bzn" column="BZN"                                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cpnmNm" column="CPNM_NM"                           jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="zcd" column="ZCD"                                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="ad" column="AD"                                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="dtlAd" column="DTL_AD"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="tnb" column="TNB"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="tnb1" column="TNB1"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="tnb2" column="TNB2"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="tnb3" column="TNB3"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="hpn" column="HPN"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="hpn1" column="HPN1"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="hpn2" column="HPN2"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="hpn3" column="HPN3"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="emlId" column="EML_ID"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="emlDmiNm" column="EML_DMI_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="titNm" column="TIT_NM"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="acpDptCd" column="ACP_DPT_CD"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="acpDptNm" column="ACP_DPT_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="rcepId" column="RCEP_ID"                           jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="rcepNm" column="RCEP_NM"                           jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="acpDh" column="ACP_DH"                             jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="cvptHndlStaCd" column="CVPT_HNDL_STA_CD"         jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptTxt" column="CVPT_TXT"                         jdbcType="CLOB"      javaType="java.lang.String" />
		<result property="cvptSbt" column="CVPT_SBT"                         jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="docId" column="DOC_ID"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="reqrCnt" column="REQR_CNT"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="reqrDvsnCd" column="REQR_DVSN_CD"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="ognzPsoCnt" column="OGNZ_PSO_CNT"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="acpDt" column="ACP_DT"                     jdbcType="VARCHAR"  javaType="java.lang.String" />

		<result property="audExecDcsDptNm" column="AUD_EXEC_DCS_DPT_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="audExecDcsDptCd" column="AUD_EXEC_DCS_DPT_CD"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="audExecDcsChgrNm" column="AUD_EXEC_DCS_CHGR_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="audExecDcsChgrId" column="AUD_EXEC_DCS_CHGR_ID"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="audDptCd" column="AUD_DPT_CD"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="audDptNm" column="AUD_DPT_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="audChgrNm" column="AUD_CHGR_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="audChgrId" column="AUD_CHGR_ID"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="audExecDcsDdln" column="AUD_EXEC_DCS_DDLN"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="audRsltHndlDdln" column="AUD_RSLT_HNDL_DDLN"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="acpRutNm" column="ACP_RUT_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="vrfYn" column="VRF_YN"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="reqDvsnNm" column="REQ_DVSN_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="reqrDvsnCd" column="REQR_DVSN_CD"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="reqrDvsnNm" column="REQR_DVSN_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptHndlStaNm" column="CVPT_HNDL_STA_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="homeStaCd" column="HOME_STA_CD"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="homeStaNm" column="HOME_STA_NM"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="sndApvDocNo" column="SND_APV_DOC_NO"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="sndStaCd" column="SND_STA_CD"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="examRptNtfSta" column="EXAM_RPT_NTF_STA"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="audrsltNtfSta" column="AUD_RSLT_NTF_STA"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
 	</resultMap>
	<select id="CSPEAR005EDtlSelect" parameterType="paramMap"
		resultMap="CSPEAR005">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EDtlSelect */
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,F_CODE_NM('1000740',A.REQ_DVSN_CD)||'감사청구' AS REQ_DVSN_NM
                    ,A.HPN AS HPN
                    ,A.TNB AS TNB
                    ,C.REQR_DVSN_CD
                    ,F_CODE_NM('1000080',C.REQR_DVSN_CD) AS REQR_DVSN_NM
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||substring(A.CVPT_ACP_NO, 3, 3) AS ACP_NO
   					,F_CODE_NM('1000361',A.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
   					,A.REQR_KND_CD
   					,A.CVPTR_NM
   					,A.BTDT
   					,A.JB_NM
   					,A.RPST_PEN_NM
   					,A.BZN
   					,A.CPNM_NM
   					,A.ZCD
   					,A.AD
   					,A.DTL_AD
   					,A.TNB
   					,A.HPN
   					,DECODE(A.TNB,NULL,'',SUBSTR(A.TNB,1,INSTR(A.TNB,'-',1,1)-1)) TNB1
   					,DECODE(A.TNB,NULL,'',SUBSTR(A.TNB,INSTR(A.TNB,'-',1,1)+1,INSTR(A.TNB,'-',1,2)-INSTR(A.TNB,'-',1,1)-1)) AS TNB2
   					,DECODE(A.TNB,NULL,'',SUBSTR(A.TNB,INSTR(A.TNB,'-',1,2)+1)) TNB3
   					,DECODE(A.HPN,NULL,'',SUBSTR(HPN,1,INSTR(HPN,'-',1,1)-1)) HPN1
   					,DECODE(A.HPN,NULL,'',SUBSTR(A.HPN,INSTR(A.HPN,'-',1,1)+1,INSTR(A.HPN,'-',1,2)-INSTR(A.HPN,'-',1,1)-1)) AS HPN2
   					,DECODE(A.HPN,NULL,'',SUBSTR(A.HPN,INSTR(A.HPN,'-',1,2)+1)) HPN3
   					,A.EML_ID
   					,A.EML_DMI_NM
   					,A.TIT_NM
   					,A.ACP_DPT_CD
   					,(	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = A.ACP_DPT_CD
   					) AS ACP_DPT_NM
   					,A.RCEP_ID
   					,F_USR_INFO_BY_ID(A.RCEP_ID,'2') AS RCEP_NM
   					,A.ACP_DH
   					,A.CVPT_HNDL_STA_CD
   					,A.CVPT_HNDL_STA_CD AS HOME_STA_CD
   					,F_CODE_NM('1000361',A.CVPT_HNDL_STA_CD) AS HOME_STA_NM
   					,B.CVPT_TXT
   					,B.CVPT_SBT
   					,A.DOC_ID
   					,C.REQR_CNT
   					,C.REQR_DVSN_CD
   					,C.OGNZ_PSO_CNT
   					,TO_CHAR(A.ACP_DH,'YYYYMMDD') AS ACP_DT
   					,DECODE(C.AUD_EXEC_DCS_DPT_CD,NULL,
	   					(	SELECT	S1.DPT_NM
	   						FROM	TBDCMACM002M S1
	   						WHERE	S1.DPT_CD = C.HNDL_DPT_CD
	   					)
	   					,(	SELECT	S1.DPT_NM
	   						FROM	TBDCMACM002M S1
	   						WHERE	S1.DPT_CD = C.AUD_EXEC_DCS_DPT_CD
	   					)
   					) AS AUD_EXEC_DCS_DPT_NM
   					,NVL(C.AUD_EXEC_DCS_DPT_CD,C.HNDL_DPT_CD) AS AUD_EXEC_DCS_DPT_CD
   					,DECODE(C.AUD_EXEC_DCS_CHGR_ID,NULL,F_USR_INFO_BY_ID(C.HNDL_CHGR_ID,'2'),F_USR_INFO_BY_ID(C.AUD_EXEC_DCS_CHGR_ID,'2')) AS AUD_EXEC_DCS_CHGR_NM
   					,NVL(C.AUD_EXEC_DCS_CHGR_ID,C.HNDL_CHGR_ID) AS AUD_EXEC_DCS_CHGR_ID
   					,C.AUD_DPT_CD
   					,(	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = C.AUD_DPT_CD
   					)  AS AUD_DPT_NM
   					,F_USR_INFO_BY_ID(C.AUD_CHGR_ID,'2') AS AUD_CHGR_NM
   					,C.AUD_CHGR_ID
   					,CASE WHEN C.REQ_DVSN_CD = '2' THEN TO_CHAR(A.ACP_DH+30+F_SPMT_RQ_DAY_COUNT(C.REQ_DVSN_CD,C.ACP_YR,C.CVPT_ACP_NO)+NVL(D.BZT_DCN,0),'YYYY-MM-DD')
   						ELSE TO_CHAR(ADD_MONTHS(A.ACP_DH ,1)+F_SPMT_RQ_DAY_COUNT(C.REQ_DVSN_CD,C.ACP_YR,C.CVPT_ACP_NO)+NVL(D.BZT_DCN,0),'YYYY-MM-DD') END AUD_EXEC_DCS_DDLN
   					,CASE
				         WHEN C.REQ_DVSN_CD IN ('2','3') AND EXAM_RPT_APV_DT IS NULL  THEN '해당사항 없음'
				         WHEN C.REQ_DVSN_CD = '2' THEN TO_CHAR(TO_DATE(EXAM_RPT_APV_DT)+60, 'YYYY-MM-DD')
				         ELSE TO_CHAR(ADD_MONTHS(TO_DATE(EXAM_RPT_APV_DT) , 6), 'YYYY-MM-DD')
				       END AS AUD_RSLT_HNDL_DDLN
				    ,TO_CHAR(A.CVPT_WDW_DH,'YYYYMMDD') AS CVPT_WDW_DH
				    ,F_CODE_NM('1000056', A.ACP_RUT_CD) AS ACP_RUT_NM
				    ,C.VRF_YN AS VRF_YN
				    ,C.SND_APV_DOC_NO
				    ,C.SND_STA_CD
				    ,DECODE(C.EXAM_RPT_NTF_YN,'Y','게재완료','미게재') AS EXAM_RPT_NTF_STA
				    ,DECODE(C.AUD_RSLT_NTF_YN,'Y','게재완료','미게재') AS AUD_RSLT_NTF_STA
   			FROM	TBCSPDCP101M A
   				   ,TBCSPDCP102M B
   				   ,TBCSPEAR001M C
				   ,( SELECT sum(nvl(AUD_DCN,0)) BZT_DCN, D.TSK_KEY1, D.TSK_KEY2, D.TSK_KEY3
						FROM TBBADDED001M A
					    LEFT OUTER JOIN TBBADDED101L B
					            ON A.AUD_YR = B.AUD_YR
					           AND A.AUD_NO = B.AUD_NO
					           AND B.AUD_STEP_CD != 'A1030'                          
					    INNER JOIN TBBADDED002M C
					            ON A.AUD_YR  = C.REL_AUD_YR
					           AND A.AUD_NO = C.REL_AUD_NO
					    INNER JOIN TBBADDED030L D ON A.AUD_YR = D.AUD_YR AND A.AUD_NO = D.AUD_NO  
                        LEFT OUTER JOIN TBCSPDCP101M E
                                ON D.TSK_KEY1 = E.ACP_YR
                                AND D.TSK_KEY2 = E.REQ_DVSN_CD
                                AND D.TSK_KEY3 = E.CVPT_ACP_NO
                        LEFT OUTER JOIN TBCSPEAR001M F
                                ON E.ACP_YR = F.ACP_YR
                                AND E.REQ_DVSN_CD = F.REQ_DVSN_CD
                                AND E.CVPT_ACP_NO = F.CVPT_ACP_NO
                        WHERE 
                             NVL(CASE WHEN F.AUD_RSLT_CD = '08' THEN TO_CHAR(E.CVPT_WDW_DH,'YYYY-MM-DD')        
                                ELSE  
                                    CASE WHEN E.REQ_DVSN_CD = '3' 
                                         THEN NVL(TO_CHAR(TO_DATE(F.EXAM_RPT_APV_DT),'YYYY-MM-DD'),( 
                                            SELECT TO_CHAR(MAX(C1.APV_DH),'YYYY-MM-DD') 
                                                FROM TBBADDED030L A1,TBBADDED103M B1, TBDCMACM023L C1
                                                 WHERE A1.TSK_KEY1(+)=E.ACP_YR 
                                                    AND A1.TSK_KEY2(+)=E.REQ_DVSN_CD 
                                                    AND A1.TSK_KEY3(+) =E.CVPT_ACP_NO
                                                    AND A1.AUD_YR=B1.AUD_YR 
                                                    AND A1.AUD_NO=B1.AUD_NO 
                                                    AND B1.APV_RQS_ID = C1.APV_DOC_NO 
                                                    AND B1.RPRT_CD = 'A10300100' 
                                                    AND B1.APV_STA_CD ='30' 
                                            )
                                         )    
                                     ELSE (SELECT TO_CHAR(TO_DATE(MAX(B.CMT_OEN_DT)),'YYYY-MM-DD') 
                                                FROM TBCSPEAR011M A , TBCSPEAR010M B 
                                                    WHERE A.ACP_YR(+) = E.ACP_YR 
                                                        AND A.REQ_DVSN_CD(+) = E.REQ_DVSN_CD  
                                                        AND A.CVPT_ACP_NO(+) = E.CVPT_ACP_NO 
                                                        AND A.CMT_DVSN_CD = B.CMT_DVSN_CD 
                                                        AND A.CMT_OEN_YE = B.CMT_OEN_YE 
                                                        AND A.CMT_DGE = B.CMT_DGE
                                                        AND A.CMT_RSLT_CD != '09'
                                                        )  
                                    END
                                END,'9999-99-99') > TO_CHAR(TO_DATE(C.AUD_STR_DT),'YYYY-MM-DD')
					    GROUP BY D.TSK_KEY1, D.TSK_KEY2, D.TSK_KEY3 ) D
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
            AND		A.ACP_YR = D.TSK_KEY1(+) 
            AND		A.REQ_DVSN_CD = D.TSK_KEY2(+) 
            AND		A.CVPT_ACP_NO = D.TSK_KEY3(+)  			
		]]>

	</select>

	<select id="CSPEAR004EPreiApvYn" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR004EPreiApvYn */
			SELECT  A.ACP_STEP_CD
			       ,A.STEP_CMPT_YN /*단계완료여부*/
			       ,B.APV_STA_CD   /*결재상태코드 */
			  FROM	TBCSPDCP601M A, TBCSPDCP603M B
			 WHERE	A.REQ_DVSN_CD = B.REQ_DVSN_CD
               AND  A.ACP_YR = B.ACP_YR
               AND  A.CVPT_ACP_NO = B.CVPT_ACP_NO
			   AND  A.REQ_DVSN_CD = #{reqDvsnCd}
   			   AND	A.ACP_YR = #{acpYr}
   			   AND	A.CVPT_ACP_NO = #{cvptAcpNo}
   			   AND  B.RPRT_CD IN
               <foreach collection="rpRtCd" item="item" index="index" separator="," open="(" close=")">
				    #{item}
			   </foreach>   			   
               AND  A.ACP_STEP_CD IN 
               <foreach collection="acpStepCd" item="item" index="index" separator="," open="(" close=")">
				    #{item}
			   </foreach>
               AND  B.ACP_STEP_CD IN 
               <foreach collection="acpStepCd" item="item" index="index" separator="," open="(" close=")">
				    #{item}
			   </foreach>  

	</select>	

	<select id="CSPEAR005EPreiSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EPreiSelect */
		<![CDATA[
			SELECT	NVL(A.PREI_DMS_YN,'N') AS PREI_DMS_YN
					,to_char(to_date(A.PREI_APV_DT), 'YYYY-MM-DD') AS PREI_APV_DT
					,A.PREI_DMS_RSN_CD
					,NVL(A.TRNF_YN,'N') AS TRNF_YN
					,A.TRNF_DPT_CD
					,(	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = A.TRNF_DPT_CD
   					)  AS TRNF_DPT_NM
					,to_char(to_date(A.TRNF_DT), 'YYYY-MM-DD') AS TRNF_DT
					,TO_CHAR(B.CVPT_WDW_DH,'YYYYMMDD') AS CVPT_WDW_DH
					,DECODE(B.CVPT_WDW_DH,NULL,'','취하') AS CVPT_WDW_NM
					,A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.CVPT_HNDL_STA_CD
   					,to_char(to_date(A.PREI_RPL_DT), 'YYYY-MM-DD') AS PREI_RPL_DT
   					,(	SELECT 	DOC_ID
   						FROM	TBCSPEAR004M Z
   						WHERE	A.REQ_DVSN_CD = Z.REQ_DVSN_CD
			   			AND		A.ACP_YR = Z.ACP_YR
			   			AND		A.CVPT_ACP_NO = Z.CVPT_ACP_NO
			   			AND		Z.REQ_DOC_KND_CD = '1') AS PREI_DOC_ID
			   		,C.ONR_DOC_MNG_CRD_ID
			   		,NVL(C.REQ_DOC_KND_CD,'1') AS REQ_DOC_KND_CD
			   		,C.CVPT_OPM_APV_HNDL_STA_CD
			   		,B.TIT_NM
			FROM	TBCSPEAR001M A
					,TBCSPDCP101M B
					,TBCSPEAR002M C
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		C.REQ_DOC_KND_CD(+) = '1'
		]]>
	</select>

	<select id="CSPEAR005ESpmtSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005ESpmtSelect */
		<![CDATA[
			SELECT	B.SPMT_RQ_SLN
					,TO_CHAR(TO_DATE(B.SPMT_RQ_DT), 'YYYY-MM-DD') AS SPMT_RQ_DT
					,B.SPMT_RQ_TXT
					,TO_CHAR(TO_DATE(B.SPMT_CMPT_DT), 'YYYY-MM-DD') AS SPMT_CMPT_DT
					,A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.SPMT_DVSN_CD
   					,F_CODE_NM('1000746',B.SPMT_DVSN_CD) AS SPMT_DVSN_NM
   					,B.TG_ORG_NM
   					,B.SPMT_RQ_STA_CD
   					,F_CODE_NM('1000747',B.SPMT_RQ_STA_CD) AS SPMT_RQ_STA_NM
   					,B.SPMT_RQ_RT
   					,B.SPMT_DOC_ID
   					,B.ONR_DOC_NO
   					,B.EVI_DCMB_SNO
			FROM	TBCSPEAR001M A
					,TBCSPEAR003L B
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			ORDER BY TO_NUMBER(B.SPMT_RQ_SLN) ASC
		]]>
	</select>

	<select id="CSPEAR005EPreiApvSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EPreiApvSelect */
		<![CDATA[
			SELECT	D1.REQ_DVSN_CD
					,D1.ACP_YR
					,D1.CVPT_ACP_NO
					,NVL(D2.APV_DOC_DVSN_CD,'1') AS APV_DOC_DVSN_CD
					,D2.APV_VLE_PEN_DVSN_CD AS PREI_APV_VLE_PEN_DVSN_CD
					,F_CODE_NM('1000748',D2.APV_VLE_PEN_DVSN_CD) AS PREI_APV_VLE_PEN_DVSN_NM
					,to_char(to_date(D2.DVCHF_APV_DT), 'YYYY-MM-DD') AS DVCHF_APV_DT
					,to_char(to_date(D2.LDR_APV_DT), 'YYYY-MM-DD') AS LDR_APV_DT
					,to_char(to_date(D2.HQ_CHIF_APV_DT), 'YYYY-MM-DD') AS HQ_CHIF_APV_DT
					,to_char(to_date(D2.OW_PSD_APV_DT), 'YYYY-MM-DD') AS OW_PSD_APV_DT
					,to_char(to_date(D2.LEDG_APV_DT), 'YYYY-MM-DD') AS LEDG_APV_DT
			FROM	TBCSPEAR001M D1
					,TBCSPEAR009M D2
			WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		D1.ACP_YR = #{acpYr}
   			AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
			AND		D1.ACP_YR = D2.ACP_YR(+)
			AND		D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
			AND		D2.APV_DOC_DVSN_CD(+) = '1'
		]]>
	</select>


	<update id="CSPEAR005EEAR001PreiUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001PreiUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		PREI_APV_DT = #{preiApvDt}
					,PREI_DMS_YN = #{preiDmsYn}
					,PREI_DMS_RSN_CD = #{preiDmsRsnCd}
					,PREI_RPL_DT = #{preiRplDt}
					,TRNF_YN = #{trnfYn}
					,TRNF_DT = #{trnfDt}
					,TRNF_DPT_CD = #{trnfDptCd}
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<insert id="CSPEAR005EEAR006PreiInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR006PreiInsert */
        <![CDATA[
        	INSERT INTO	TBCSPEAR006H
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, SRNO
        					, DTB_DPT_CD
        					, DTB_PEN_ID
        					, CVPT_HNDL_STA_CD
        					, HNDL_DPT_CD
        					, HNDL_CHGR_ID
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#{reqDvsnCd}
        					, #{acpYr}
        					, #{cvptAcpNo}
        					, (	SELECT 	NVL(MAX(SRNO),0)+1
        						FROM	TBCSPEAR006H
        						WHERE	REQ_DVSN_CD = #{reqDvsnCd}
					   			AND		ACP_YR = #{acpYr}
					   			AND		CVPT_ACP_NO = #{cvptAcpNo} )
					   		, F_USR_INFO(#{sCnb}, '5')
					   		, F_USR_INFO(#{sCnb}, '1')
        					, DECODE(#{preiDmsYn},'Y','170','120')
        					, #{hndlDptCd}
        					, #{hndlChgrId}
        					, F_USR_INFO(#{sCnb}, '1')
        					, #{fnlUsrId}
        					, #{fnlDealDptCd}
        					, #{fnlMnuId}
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>

	<insert id="CSPEAR005EEAR004PreiFileInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR004PreiFileInsert */
        <![CDATA[
        	INSERT INTO	TBCSPEAR004M
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, REQ_DOC_KND_CD
        					, DOC_ID
        					, DOC_TYP_CD
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#{reqDvsnCd}
        					, #{acpYr}
        					, #{cvptAcpNo}
        					, '1'
					   		, #{preiDocId}
					   		, #{docTypCd}
        					, F_USR_INFO(#{sCnb}, '1')
        					, #{fnlUsrId}
        					, #{fnlDealDptCd}
        					, #{fnlMnuId}
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>

	<update id="CSPEAR005EEAR004PreiFileMerge" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR004PreiFileMerge */
		<![CDATA[
			MERGE INTO	TBCSPEAR004M D1
			USING	(	SELECT	#{reqDvsnCd} AS REQ_DVSN_CD
								,#{acpYr} AS ACP_YR
								,#{cvptAcpNo} AS CVPT_ACP_NO
								,#{preiDocId} AS DOC_ID
						FROM	DUAL
					) D2
			ON		(		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
						AND	D1.ACP_YR = D2.ACP_YR
						AND	D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
						AND	D1.REQ_DOC_KND_CD = '1'
					)
			WHEN MATCHED THEN
				UPDATE
				SET		DOC_ID = #{preiDocId}
						,FNL_USR_ID = #{fnlUsrId}
	  					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
	  					,FNL_MNU_ID = #{fnlMnuId}
	  					,FNL_MDF_DH = SYSDATE
	  		WHEN NOT MATCHED THEN
	  			INSERT	(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, REQ_DOC_KND_CD
        					, DOC_ID
        					, DOC_TYP_CD
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#{reqDvsnCd}
        					, #{acpYr}
        					, #{cvptAcpNo}
        					, '1'
					   		, #{preiDocId}
					   		, #{docTypCd}
        					, F_USR_INFO(#{sCnb}, '1')
        					, #{fnlUsrId}
        					, #{fnlDealDptCd}
        					, #{fnlMnuId}
        					, SYSDATE
        					, SYSDATE
        				)
	  	]]>
	</update>
	
	<insert id="CSPEAR005EEAR004ExamFileMerge" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR004ExamFileMerge */
        <![CDATA[
        	MERGE INTO	TBCSPEAR004M D1
			USING	(	SELECT	#{reqDvsnCd} AS REQ_DVSN_CD
								,#{acpYr} AS ACP_YR
								,#{cvptAcpNo} AS CVPT_ACP_NO
								,#{examDocId} AS DOC_ID
						FROM	DUAL
					) D2
			ON		(		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
						AND	D1.ACP_YR = D2.ACP_YR
						AND	D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
						AND	D1.REQ_DOC_KND_CD = '2'
					)
			WHEN MATCHED THEN
				UPDATE
				SET		DOC_ID = #{examDocId}
						,FNL_USR_ID = #{fnlUsrId}
	  					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
	  					,FNL_MNU_ID = #{fnlMnuId}
	  					,FNL_MDF_DH = SYSDATE
	  		WHEN NOT MATCHED THEN
	  			INSERT	(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, REQ_DOC_KND_CD
        					, DOC_ID
        					, DOC_TYP_CD
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#{reqDvsnCd}
        					, #{acpYr}
        					, #{cvptAcpNo}
        					, '2'
					   		, #{examDocId}
					   		, #{docTypCd}
        					, F_USR_INFO(#{sCnb}, '1')
        					, #{fnlUsrId}
        					, #{fnlDealDptCd}
        					, #{fnlMnuId}
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>
	
	<insert id="CSPEAR005EDCP101PreiUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EDCP101PreiUpdate */
		<![CDATA[
			UPDATE	TBCSPDCP101M
			SET		CVPT_HNDL_STA_CD = DECODE(#{preiDmsYn},'Y','170',DECODE(#{cvptHndlStaCd},'110','120',#{cvptHndlStaCd}))
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</insert>

	<insert id="CSPEAR005EEAR003PreiInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR003PreiInsert */
        <![CDATA[
        	INSERT INTO	TBCSPEAR003L
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, SPMT_RQ_SLN
        					, SPMT_RQ_DT
        					, SPMT_RQ_TXT
        					, SPMT_CMPT_DT
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        					, SPMT_DVSN_CD
        					, TG_ORG_NM
        					, SPMT_RQ_STA_CD
        					, SPMT_RQ_RT
        					, SPMT_DOC_ID
        					, ONR_DOC_NO
        					, EVI_DCMB_SNO
        				)
        		VALUES	(	#{reqDvsnCd}
        					, #{acpYr}
        					, #{cvptAcpNo}
        					, (	SELECT 	NVL(MAX(TO_NUMBER(SPMT_RQ_SLN)),0)+1
        						FROM	TBCSPEAR003L
        						WHERE	REQ_DVSN_CD = #{reqDvsnCd}
					   			AND		ACP_YR = #{acpYr}
					   			AND		CVPT_ACP_NO = #{cvptAcpNo} )
					   		, #{spmtRqDt}
					   		, #{spmtRqTxt}
        					, #{spmtCmptDt}
        					, F_USR_INFO(#{sCnb}, '1')
        					, #{fnlUsrId}
        					, #{fnlDealDptCd}
        					, #{fnlMnuId}
        					, SYSDATE
        					, SYSDATE
        					, #{spmtDvsnCd}
        					, #{tgOrgNm}
        					, #{spmtRqStaCd}
        					, #{spmtRqRt}
        					, #{spmtDocId}
        					, #{onrDocNo}
        					, (	SELECT 	NVL(MAX(TO_NUMBER(SPMT_RQ_SLN)),0)+1
        						FROM	TBCSPEAR003L
        						WHERE	REQ_DVSN_CD = #{reqDvsnCd}
					   			AND		ACP_YR = #{acpYr}
					   			AND		CVPT_ACP_NO = #{cvptAcpNo} )
        				)
       	]]>
	</insert>

	<update id="CSPEAR005EEAR003PreiUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR003PreiUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR003L
			SET		SPMT_RQ_DT = #{spmtRqDt}
					,SPMT_RQ_TXT = #{spmtRqTxt}
					,SPMT_CMPT_DT = #{spmtCmptDt}
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
   					,SPMT_DVSN_CD = #{spmtDvsnCd}
   					,TG_ORG_NM = #{tgOrgNm}
   					,SPMT_RQ_STA_CD = #{spmtRqStaCd}
   					,SPMT_RQ_RT = #{spmtRqRt}
  					,SPMT_DOC_ID = #{spmtDocId}
  					,ONR_DOC_NO = #{onrDocNo}
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
			AND		SPMT_RQ_SLN = #{spmtRqSln}
		]]>
	</update>

	<delete id="CSPEAR005EEAR003PreiDelete" parameterType = "paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR003PreiDelete */
		<![CDATA[
			DELETE
			FROM	TBCSPEAR003L
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
			AND		SPMT_RQ_SLN = #{spmtRqSln}
		]]>
	</delete>

	<delete id="CSPEAR005EDCP608PreiDelete" parameterType = "paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EDCP608PreiDelete */
		<![CDATA[
			DELETE
			FROM	TBCSPDCP608D
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
			AND		EVI_DCMB_SNO = #{eviDcmbSno}
		]]>
	</delete>


	<update id="CSPEAR005EPreiApvMerge" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EPreiApvMerge */
		<![CDATA[
			MERGE INTO	TBCSPEAR009M D1
			USING	(	SELECT	#{reqDvsnCd} AS REQ_DVSN_CD
								,#{acpYr} AS ACP_YR
								,#{cvptAcpNo} AS CVPT_ACP_NO
								,#{apvDocDvsnCd} AS APV_DOC_DVSN_CD
						FROM	DUAL
					) D2
			ON		(		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
						AND	D1.ACP_YR = D2.ACP_YR
						AND	D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
						AND	D1.APV_DOC_DVSN_CD = D2.APV_DOC_DVSN_CD
					)
			WHEN MATCHED THEN
				UPDATE
				SET		APV_VLE_PEN_DVSN_CD = #{preiApvVlePenDvsnCd}
						,DVCHF_APV_DT = #{dvchfApvDt}
						,LDR_APV_DT = #{ldrApvDt}
						,HQ_CHIF_APV_DT = #{hqChifApvDt}
						,OW_PSD_APV_DT = #{owPsdApvDt}
						,LEDG_APV_DT = #{ledgApvDt}
						,FNL_USR_ID = #{fnlUsrId}
	  					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
	  					,FNL_MNU_ID = #{fnlMnuId}
	  					,FNL_MDF_DH = SYSDATE
	  		WHEN NOT MATCHED THEN
	  			INSERT	(	REQ_DVSN_CD
	  					,	ACP_YR
	  					,	CVPT_ACP_NO
	  					,	APV_DOC_DVSN_CD
	  					,	APV_VLE_PEN_DVSN_CD
	  					,	DVCHF_APV_DT
	  					,	LDR_APV_DT
	  					,	HQ_CHIF_APV_DT
	  					,	OW_PSD_APV_DT
	  					,	LEDG_APV_DT
	  					,	FRT_USR_ID
	  					,	FNL_USR_ID
	  					,	FNL_DEAL_DPT_CD
	  					,	FNL_MNU_ID
	  					,	FRT_REGI_DH
	  					,	FNL_MDF_DH
	  					)
	  			VALUES	(	#{reqDvsnCd}
	  					,	#{acpYr}
	  					,	#{cvptAcpNo}
	  					,	#{apvDocDvsnCd}
	  					,	#{preiApvVlePenDvsnCd}
	  					,	#{dvchfApvDt}
	  					,	#{ldrApvDt}
	  					,	#{hqChifApvDt}
	  					,	#{owPsdApvDt}
	  					,	#{ledgApvDt}
	  					,	#{fnlUsrId}
	  					,	#{fnlUsrId}
	  					,	#{fnlDealDptCd}
	  					,	#{fnlMnuId}
	  					,	SYSDATE
	  					,	SYSDATE
	  					)
	  	]]>
	</update>


	<select id="CSPEAR005EMtrlSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EMtrlSelect */
		<![CDATA[
			SELECT	A.MTRL_CLC_BZT_DVSN_CD
					,A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.AUD_YR
   					,B.AUD_NO
   					,DECODE(B.AUD_YR,NULL,'',B.AUD_YR||'-'||B.AUD_NO) AS AUD_YR_NO
   					,C.CVPT_HNDL_STA_CD
   					,A.PREI_DMS_YN
   					,TO_CHAR(C.CVPT_WDW_DH,'YYYYMMDD') AS CVPT_WDW_DH
					,DECODE(C.CVPT_WDW_DH,NULL,'','취하') AS CVPT_WDW_NM
			FROM	TBCSPEAR001M A, TBBADDED001M B, TBCSPDCP101M C
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = B.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
		]]>
	</select>

	<!-- <select id="CSPEAR005EBztSelect" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			select  D3.AUD_YR
			        ,D3.AUD_NO
			        , F_MNG_KND_AUDYRNO(D3.AUD_YR, D3.AUD_NO, D3.AUD_KND_CD, '-') AS AUD_YR_N0
			        ,D3.AUD_SBJ_NM
			        , F_CODE_NM_YEAR('1000007', D3.AUD_KND_CD, D3.AUD_YR) AS AUD_KND_NM
			        , F_DPT_INFO(D3.SPV_BRDV_CD,'1')	AS SPV_BRDV_NM  /*주관국과명*/
			from    TBCSPEAR001M D1
			        ,TBBADDED030L D2
			        ,TBBADDED001M D3
			WHERE   D1.ACP_YR = D2.TSK_KEY1
			AND     D1.REQ_DVSN_CD = D2.TSK_KEY2
			AND     D1.CVPT_ACP_NO = D2.TSK_KEY3
			AND     D2.AUD_YR = D3.AUD_YR
			AND     D2.AUD_NO = D3.AUD_NO
			AND		D1.ACP_YR = #{acpYr}
			AND		D1.REQ_DVSN_CD = #{reqDvsnCd}
			AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</select> -->
	<select id="CSPEAR005EBztSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EBztSelect */
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.AUD_YR
   					,B.AUD_NO
   					,DECODE(B.AUD_YR,NULL,'',B.AUD_YR||'-'||B.AUD_NO) AS AUD_YR_NO
   					,C.BZT_YR
   					,C.BZT_SNO
   					,C.BZT_DVSN_CD
   					,TO_CHAR(TO_DATE(C.AUD_STR_DT),'YYYY-MM-DD')||'~'|| TO_CHAR(TO_DATE(C.AUD_END_DT),'YYYY-MM-DD')    AS AUD_STR_END_DT        /*실시기간*/
   					,C.AUD_BZT_KND_CD
   					,C.AUD_DCN
   					,F_ORG_CNT_NM(C.BZT_YR,C.BZT_SNO) AS ORG_CNT_NM
			FROM	TBCSPEAR001M A, TBBADDED001M B, TBBADDED002M C
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND 	B.AUD_YR = C.REL_AUD_YR
   			AND		B.AUD_NO = C.REL_AUD_NO
   			AND		C.AUD_BZT_KND_CD = '00'
		]]>
	</select>
	<update id="CSPEAR005EEAR001MtrlUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001MtrlUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		MTRL_CLC_BZT_DVSN_CD = #{mtrlClcBztDvsnCd}
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<insert id="CSPEAR005EEAR006MtrlInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR006MtrlInsert */
        <![CDATA[
        	INSERT INTO	TBCSPEAR006H
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, SRNO
        					, DTB_DPT_CD
        					, DTB_PEN_ID
        					, CVPT_HNDL_STA_CD
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#{reqDvsnCd}
        					, #{acpYr}
        					, #{cvptAcpNo}
        					, (	SELECT 	NVL(MAX(SRNO),0)+1
        						FROM	TBCSPEAR006H
        						WHERE	REQ_DVSN_CD = #{reqDvsnCd}
					   			AND		ACP_YR = #{acpYr}
					   			AND		CVPT_ACP_NO = #{cvptAcpNo} )
					   		, F_USR_INFO(#{sCnb}, '5')
					   		, F_USR_INFO(#{sCnb}, '1')
        					, '130'
        					, F_USR_INFO(#{sCnb}, '1')
        					, #{fnlUsrId}
        					, #{fnlDealDptCd}
        					, #{fnlMnuId}
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>

	<insert id="CSPEAR005EDCP101MtrlUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EDCP101MtrlUpdate */
		<![CDATA[
			UPDATE	TBCSPDCP101M
			SET		CVPT_HNDL_STA_CD = '130'
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</insert>

	<select id="CSPEAR005EExamSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EExamSelect */
		<![CDATA[
			SELECT	NVL(A.CMT_OEN_YN,'N') AS CMT_OEN_YN
					,DECODE(A.CMT_OEN_YN,'Y', A.REQ_DVSN_CD) AS CMT_CD
					,A.CMT_OEN_YE
					,A.CMT_DGE
					,to_char(to_date(A.CMT_OEN_DT), 'YYYY-MM-DD') AS CMT_OEN_DT
					,A.REQ_EXAM_RSLT_CD
					,A.CMT_PRVS_CD
					,A.OGN_TYP_CD
					,to_char(to_date(A.EXAM_RPT_APV_DT), 'YYYY-MM-DD') AS EXAM_RPT_APV_DT /*결정일자*/
					,to_char(to_date(A.EXAM_RSLT_RPL_DT), 'YYYY-MM-DD') AS EXAM_RSLT_RPL_DT
					,to_char(to_date(A.TON_DT), 'YYYY-MM-DD') AS TON_DT
					,A.TON_ORG_CD
					,(	SELECT	Z.USR_DFN_TXT_1
   						FROM	TBDCMACM013C Z
   						WHERE	Z.CMM_CD_DVSN_CD ='1000128'
   						AND		Z.CD = D.PUB_DVSN_CD) AS TON_DVSN_CD
   					,F_ORG_HRK_NM(D.COPT_SG_CD) AS COPT_SG_NM
   					,D.ORG_NM AS TON_ORG_NM
   					,A.KYWD_NM_1
   					,A.KYWD_NM_2
   					,A.KYWD_NM_3
					,TO_CHAR(B.CVPT_WDW_DH,'YYYYMMDD') AS CVPT_WDW_DH
					,DECODE(B.CVPT_WDW_DH,NULL,'','취하') AS CVPT_WDW_NM
					,A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.CVPT_HNDL_STA_CD
   					,(	SELECT 	DOC_ID
   						FROM	TBCSPEAR004M Z
   						WHERE	A.REQ_DVSN_CD = Z.REQ_DVSN_CD
			   			AND		A.ACP_YR = Z.ACP_YR
			   			AND		A.CVPT_ACP_NO = Z.CVPT_ACP_NO
			   			AND		Z.REQ_DOC_KND_CD = '2') AS EXAM_DOC_ID
			   		,C.ONR_DOC_MNG_CRD_ID
			   		,NVL(REQ_DOC_KND_CD,'2') AS REQ_DOC_KND_CD
			   		,A.EXAM_RPT_NTF_YN
			   		,B.TIT_NM
			   		,C.CVPT_OPM_APV_HNDL_STA_CD
			   		,A.AUD_EXEC_DCS_DDLN_EXMP_CD
			   		,A.CMT_RSLT_CD
			   		,to_char(to_date(A.CMT_DCS_CSL_DT), 'YYYY-MM-DD') AS CMT_DCS_CSL_DT
			   		,NVL(A.AUD_RFR_MTRL_YN,'N') AS AUD_RFR_MTRL_YN
			   		,A.CMT_COPT_DPT_CD
			   		,(	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = A.CMT_COPT_DPT_CD
   					)  AS CMT_COPT_DPT_NM
			   		,to_char(to_date(A.CMT_SEN_DT), 'YYYY-MM-DD') AS CMT_SEN_DT
			   		,A.CMT_DOC_NO_1
			   		,A.CMT_DOC_NO_2
			   		,(SELECT	COUNT(*)
			   			FROM	TBCSPDCP603M S1
			   			WHERE	A.REQ_DVSN_CD = S1.REQ_DVSN_CD
			   			AND		A.ACP_YR = S1.ACP_YR
			   			AND		A.CVPT_ACP_NO = S1.CVPT_ACP_NO
			   			AND		S1.ACP_STEP_CD IN ('C1033','C1022')
			   			AND		S1.RPRT_CD IN ('C10330100', 'C10220100')
			   			AND		S1.APV_STA_CD = '30'
			   		) AS EXAM_REPORT_YN
			   	    ,B.CVPT_HNDL_STA_CD
			FROM	TBCSPEAR001M A
					,TBCSPDCP101M B
					,TBDCMACM015M D
					,TBCSPEAR002M C
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.TON_ORG_CD = D.ORG_CD(+)
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		C.REQ_DOC_KND_CD(+) = '2'
		]]>
	</select>


	<select id="CSPEAR005EExamApvSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EExamApvSelect */
		<![CDATA[
			SELECT	MAX(REQ_DVSN_CD) AS REQ_DVSN_CD
			        ,MAX(ACP_YR) AS ACP_YR
			        ,MAX(CVPT_ACP_NO) AS CVPT_ACP_NO
			        ,MAX(APV_VLE_PEN_DVSN_CD) AS EXAM_APV_VLE_PEN_DVSN_CD
			        ,to_char(to_date(MAX(DVCHF_APV_DT)), 'YYYY-MM-DD') AS EXAM_DVCHF_APV_DT
			        ,to_char(to_date(MAX(LDR_APV_DT)), 'YYYY-MM-DD') AS EXAM_LDR_APV_DT
			        ,to_char(to_date(MAX(HQ_CHIF_APV_DT)), 'YYYY-MM-DD') AS EXAM_HQ_CHIF_APV_DT
			        ,to_char(to_date(MAX(OW_PSD_APV_DT)), 'YYYY-MM-DD') AS EXAM_OW_PSD_APV_DT
			        ,to_char(to_date(MAX(LEDG_APV_DT)), 'YYYY-MM-DD') AS EXAM_LEDG_APV_DT
			        ,to_char(to_date(MAX(EXAM_DVCHF_APV_DT)), 'YYYY-MM-DD') AS EXAM_DVCHF_APV_DT2
			        ,to_char(to_date(MAX(EXAM_LDR_APV_DT)), 'YYYY-MM-DD') AS EXAM_LDR_APV_DT2
			        ,to_char(to_date(MAX(EXAM_HQ_CHIF_APV_DT)), 'YYYY-MM-DD') AS EXAM_HQ_CHIF_APV_DT2
			        ,to_char(to_date(MAX(EXAM_OW_PSD_APV_DT)), 'YYYY-MM-DD') AS EXAM_OW_PSD_APV_DT2
			        ,to_char(to_date(MAX(EXAM_LEDG_APV_DT)), 'YYYY-MM-DD') AS EXAM_LEDG_APV_DT2
			FROM	(
						SELECT	D1.REQ_DVSN_CD
								,D1.ACP_YR
								,D1.CVPT_ACP_NO
								,D2.APV_VLE_PEN_DVSN_CD
								,D2.DVCHF_APV_DT
								,D2.LDR_APV_DT
								,D2.HQ_CHIF_APV_DT
								,D2.OW_PSD_APV_DT
								,D2.LEDG_APV_DT
								,'' EXAM_DVCHF_APV_DT
			                    ,'' EXAM_LDR_APV_DT
			                    ,'' EXAM_HQ_CHIF_APV_DT
			                    ,'' EXAM_OW_PSD_APV_DT
			                    ,'' EXAM_LEDG_APV_DT
						FROM	TBCSPEAR001M D1
								,TBCSPEAR009M D2
						WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
			   			AND		D1.ACP_YR = #{acpYr}
			   			AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
			   			AND		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
						AND		D1.ACP_YR = D2.ACP_YR(+)
						AND		D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
						AND		D2.APV_DOC_DVSN_CD(+) = '2'
						UNION ALL
						SELECT	D1.REQ_DVSN_CD
								,D1.ACP_YR
								,D1.CVPT_ACP_NO
								,D2.APV_VLE_PEN_DVSN_CD
								,'' DVCHF_APV_DT
			                    ,'' LDR_APV_DT
			                    ,'' HQ_CHIF_APV_DT
			                    ,'' OW_PSD_APV_DT
			                    ,'' LEDG_APV_DT
								,D2.DVCHF_APV_DT  AS EXAM_DVCHF_APV_DT
								,D2.LDR_APV_DT AS EXAM_LDR_APV_DT
								,D2.HQ_CHIF_APV_DT AS EXAM_HQ_CHIF_APV_DT
								,D2.OW_PSD_APV_DT AS EXAM_OW_PSD_APV_DT
								,D2.LEDG_APV_DT AS EXAM_LEDG_APV_DT
						FROM	TBCSPEAR001M D1
								,TBCSPEAR009M D2
						WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
			   			AND		D1.ACP_YR = #{acpYr}
			   			AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
			   			AND		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
						AND		D1.ACP_YR = D2.ACP_YR(+)
						AND		D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
						AND		D2.APV_DOC_DVSN_CD(+) = '3'
					)
		]]>
	</select>

	<update id="CSPEAR005EEAR001ExamUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001ExamUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		CMT_OEN_YN = #{cmtOenYn}
					,CMT_OEN_YE = #{cmtOenYe}
					,CMT_DGE = #{cmtDge}
					,CMT_OEN_DT = #{cmtOenDt}
					,OGN_TYP_CD = #{ognTypCd}
					,EXAM_RPT_APV_DT = #{examRptApvDt}
					,REQ_EXAM_RSLT_CD = #{reqExamRsltCd}
					,CMT_PRVS_CD = #{cmtPrvsCd}
					,EXAM_RSLT_RPL_DT = #{examRsltRplDt}
					,TON_DT = #{tonDt}
					,KYWD_NM_1 = #{kywdNm1}
					,KYWD_NM_2 = #{kywdNm2}
					,KYWD_NM_3 = #{kywdNm3}
					,TON_ORG_CD = #{tonOrgCd}
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
   					,AUD_EXEC_DCS_DDLN_EXMP_CD = #{audExecDcsDdlnExmpCd} /*감사실시결정기한제외코드*/
   					,CMT_RSLT_CD = #{cmtRsltCd} /*위원회 결과*/
   					,CMT_DCS_CSL_DT = #{cmtDcsCslDt} /*감사실시여부결정자문일*/
   					,AUD_RFR_MTRL_YN = #{audRfrMtrlYn} /*감사참고자료 여부*/
   					,CMT_COPT_DPT_CD = #{cmtCoptDptCd} /*위원회 소관부서*/
   					,CMT_SEN_DT = #{cmtSenDt} /*위원회 발송일*/
   					,CMT_DOC_NO_1 = #{cmtDocNo1}
   					,CMT_DOC_NO_2 = #{cmtDocNo2}
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<insert id="CSPEAR005EEAR004ExamFileInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR004ExamFileInsert */
        <![CDATA[
        	INSERT INTO	TBCSPEAR004M
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, REQ_DOC_KND_CD
        					, DOC_ID
        					, DOC_TYP_CD
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#{reqDvsnCd}
        					, #{acpYr}
        					, #{cvptAcpNo}
        					, '2'
					   		, #{examDocId}
					   		, #{docTypCd}
        					, F_USR_INFO(#{sCnb}, '1')
        					, #{fnlUsrId}
        					, #{fnlDealDptCd}
        					, #{fnlMnuId}
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>

	<insert id="CSPEAR005EEAR002OnrInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR002OnrInsert */
        <![CDATA[
        	INSERT INTO	TBCSPEAR002M
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, REQ_DOC_KND_CD
        					, ONR_DOC_MNG_CRD_ID
        					, CVPT_OPM_APV_HNDL_STA_CD
        					, ADMN_INF_HNDL_NO
        					, ONR_APV_RQS_DH
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#{reqDvsnCd}
        					, #{acpYr}
        					, #{cvptAcpNo}
        					, #{reqDocKndCd}
					   		, #{onrDocMngCrdId}
					   		, '20'
					   		, #{admnInfHndlNo}
					   		, SYSDATE
        					, F_USR_INFO(#{sCnb}, '1')
        					, #{fnlUsrId}
        					, #{fnlDealDptCd}
        					, #{fnlMnuId}
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>

	<select id="CSPEAR005ERtnSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005ERtnSelect */
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,to_char(to_date(NVL(G.RTN_DT, A.RTN_DT)), 'YYYY-MM-DD') AS RTN_DT
   					,to_char(NVL((SELECT 
                              MAX(APV_DH)
                         FROM TBDCMACM023L
                         WHERE APVR_PST_CD = '0013600'
                         AND APV_DOC_NO = F.APV_RQS_ID)
                         ,to_date(A.DVCHF_APV_DT)), 'YYYY-MM-DD') AS RTN_DVCHF_APV_DT
   					,to_char(NVL((SELECT 
                              MAX(APV_DH)
                         FROM TBDCMACM023L
                         WHERE APVR_PST_CD = '0015800'
                         AND APV_DOC_NO = F.APV_RQS_ID)
                         ,to_date(A.BRUCHF_APV_DT)), 'YYYY-MM-DD') AS RTN_BRUCHF_APV_DT
   					,to_char(NVL((SELECT 
                              MAX(APV_DH)
                         FROM TBDCMACM023L
                         WHERE APVR_PST_CD = '0055600'
                         AND APV_DOC_NO = F.APV_RQS_ID)
                         ,to_date(A.HQ_CHIF_APV_DT)), 'YYYY-MM-DD') AS RTN_HQ_CHIF_APV_DT
   					,to_char(NVL((SELECT 
                              MAX(APV_DH)
                         FROM TBDCMACM023L
                         WHERE APVR_PST_CD = '0055700'
                         AND APV_DOC_NO = F.APV_RQS_ID)
                         ,to_date(A.OW_PSD_APV_DT)), 'YYYY-MM-DD') AS RTN_OW_PSD_APV_DT
   					,to_char(NVL((SELECT 
                              MAX(APV_DH)
                         FROM TBDCMACM023L
                         WHERE APVR_PST_CD = '0067400'
                         AND APV_DOC_NO = F.APV_RQS_ID)
                         ,to_date(A.LEDG_APV_DT)), 'YYYY-MM-DD') AS RTN_LEDG_APV_DT
   					,D.ONR_DOC_MNG_CRD_ID
   					/*,B.AUD_YR
   					,B.AUD_NO
   					,DECODE(B.AUD_YR,NULL,'',B.AUD_YR||'-'||B.AUD_NO) AS AUD_YR_NO*/
   					,C.CVPT_HNDL_STA_CD
   					/*,B.PRSS_STEP_CD*/
   					,A.EXAM_RPT_NTF_YN
			FROM	TBCSPEAR001M A
					/*, TBBADDED001M B*/
					, TBCSPDCP101M C
                    , TBCSPEAR002M D
                    , (SELECT TSK_KEY1 AS ACP_YR
                       , TSK_KEY2 AS REQ_DVSN_CD
                       , TSK_KEY3 AS CVPT_ACP_NO
                       , AUD_YR
                       , AUD_NO
                       FROM TBBADDED030L) E
                    , TBBADDED103M F
                    , TBBADDED003M G
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			/*AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = B.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)*/
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
   			AND		A.ACP_YR = C.ACP_YR
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = D.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = D.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = D.CVPT_ACP_NO(+)
            AND		A.REQ_DVSN_CD = E.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = E.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = E.CVPT_ACP_NO(+)
            AND		E.AUD_YR= F.AUD_YR(+)
   			AND		E.AUD_NO= F.AUD_NO(+)
            AND		E.AUD_YR= G.AUD_YR(+)
   			AND		E.AUD_NO= G.AUD_NO(+)
   			AND		D.REQ_DOC_KND_CD(+) = '2' 
            AND     F.RPRT_CD = 'A10500200'
		]]>
	</select>

	<!-- <select id="CSPEAR005EAudBztSelect" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.AUD_YR
   					,B.AUD_NO
   					,DECODE(B.AUD_YR,NULL,'',B.AUD_YR||'-'||B.AUD_NO) AS AUD_YR_NO
   					,C.BZT_YR
   					,C.BZT_SNO
   					,C.BZT_DVSN_CD
   					,TO_CHAR(TO_DATE(C.AUD_STR_DT),'YYYY-MM-DD')||'~'|| TO_CHAR(TO_DATE(C.AUD_END_DT),'YYYY-MM-DD')    AS AUD_STR_END_DT        /*실시기간*/
   					,C.AUD_BZT_KND_CD
   					,C.AUD_DCN
   					,F_ORG_CNT_NM(C.BZT_YR,C.BZT_SNO) AS ORG_CNT_NM
			FROM	TBCSPEAR001M A, TBBADDED001M B, TBBADDED002M C
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND 	B.AUD_YR = C.REL_AUD_YR
   			AND		B.AUD_NO = C.REL_AUD_NO
		]]>
	</select> -->

	<select id="CSPEAR005EAudBztSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EAudBztSelect */
		<![CDATA[
			 SELECT  D1.AUD_YR
			        ,D1.AUD_NO
			        ,D1.AUD_SBJ_NM
			        , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-') AS AUD_YR_NO
			        , D1.AUD_KND_CD
			        , F_CODE_NM_YEAR('1000007', D1.AUD_KND_CD, D1.AUD_YR) AS AUD_KND_NM
			        , (	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = D1.SPV_BRDV_CD
   					) AS SPV_BRDV_NM  /*주관국과명*/
                    , (	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = D1.MNG_DPT_CD
   					) AS SPV_BRDV_NM  /*주관국과명*/
			FROM    TBBADDED001M D1
			        ,TBBADDED030L D2
			WHERE   D1.AUD_YR = D2.AUD_YR
			AND     D1.AUD_NO = D2.AUD_NO
			AND		D2.TSK_KEY2 = #{reqDvsnCd}
			AND		D2.TSK_KEY1 = #{acpYr}
			AND		D2.TSK_KEY3 = #{cvptAcpNo}
		]]>
	</select>

	<select id="CSPEAR005EHndlSituSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EHndlSituSelect */
		<![CDATA[
			SELECT	to_char(to_date(NVL(C.EXTN_RPT_DDLN_DT, C.RPT_DDLN_DT)), 'YYYY-MM-DD') AS RPT_DDLN_DT
					,to_char(to_date(NVL(C.EXTN_BRDV_HNDL_DDLN_DT, C.BRDV_HNDL_DDLN_DT)), 'YYYY-MM-DD') AS BRDV_HNDL_DDLN_DT
					,to_char(to_date(NVL(C.EXTN_MDT_CHGR_APV_DDLN_DT, C.MDT_CHGR_APV_DDLN_DT)), 'YYYY-MM-DD') AS MDT_CHGR_APV_DDLN_DT
					,to_char(to_date(NVL(C.EXTN_MDT_OFER_APV_DDLN_DT, C.MDT_OFER_APV_DDLN_DT)), 'YYYY-MM-DD') AS MDT_OFER_APV_DDLN_DT
					,to_char(to_date(NVL(C.EXTN_RVW_RM_APV_DDLN_DT, C.RVW_RM_APV_DDLN_DT)), 'YYYY-MM-DD') AS RVW_RM_APV_DDLN_DT
					,to_char(to_date(NVL(C.EXTN_TOT_DHD_APV_DDLN_DT, C.TOT_DHD_APV_DDLN_DT)), 'YYYY-MM-DD') AS TOT_DHD_APV_DDLN_DT
					,to_char(to_date(NVL(C.EXTN_DHD_APV_DDLN_DT, C.DHD_APV_DDLN_DT)), 'YYYY-MM-DD') AS DHD_APV_DDLN_DT	-- 2019.04.18 LSR 추가
					,to_char(to_date(NVL(C.EXTN_PSD_APV_DDLN_DT, C.PSD_APV_DDLN_DT)), 'YYYY-MM-DD') AS PSD_APV_DDLN_DT	-- 2019.04.18 LSR 추가
					,to_char(to_date(NVL(C.EXTN_CHF_CMTR_APV_DDLN_DT, C.CHF_CMTR_APV_DDLN_DT)), 'YYYY-MM-DD') AS CHF_CMTR_APV_DDLN_DT
					,to_char(to_date(NVL(C.EXTN_ENF_APV_DDLN_DT, C.ENF_APV_DDLN_DT)), 'YYYY-MM-DD') AS ENF_APV_DDLN_DT
					,to_char(to_date(C.RTN_RPT_DT), 'YYYY-MM-DD') AS RTN_RPT_DT
					,to_char(to_date(C.AUD_BRDV_APV_DT), 'YYYY-MM-DD') AS AUD_BRDV_APV_DT
					,to_char(to_date(C.MDT_OFER_APV_DT), 'YYYY-MM-DD') AS MDT_OFER_APV_DT
					,to_char(to_date(C.MDT_DDG_APV_DT), 'YYYY-MM-DD') AS MDT_DDG_APV_DT
					,to_char(to_date(C.JA_JDG_SSEC_APV_DT), 'YYYY-MM-DD') AS JA_JDG_SSEC_APV_DT
--					,to_char(to_date(C.OW_DHD_APV_DT), 'YYYY-MM-DD') AS OW_DHD_APV_DT
					,to_char(to_date(C.OW_DHD_APV_DT), 'YYYY-MM-DD') AS OW_TOT_DHD_APV_DT	-- 2019.04.18 LSR 수정
					,to_char(to_date(C.OW_DHD_APV_DT), 'YYYY-MM-DD') AS OW_DHD_APV_DT	-- 2019.04.18 LSR 추가
					,to_char(to_date(C.OW_PSD_APV_DT), 'YYYY-MM-DD') AS OW_PSD_APV_DT	-- 2019.04.18 LSR 추가
					,to_char(to_date(C.CHF_CMTR_APV_DT), 'YYYY-MM-DD') AS CHF_CMTR_APV_DT
					,to_char(to_date(C.ENF_APV_DT), 'YYYY-MM-DD') AS ENF_APV_DT
					,(CASE WHEN TRIM(C.RTN_RPT_DT) IS NOT NULL THEN /*귀청보고일이 있는 경우*/
				       			CASE WHEN TRIM(NVL(C.EXTN_RPT_DDLN_DT, C.RPT_DDLN_DT)) IS NULL THEN '0'
				           			ELSE TO_CHAR(TO_DATE(C.RTN_RPT_DT) - TO_DATE(NVL(C.EXTN_RPT_DDLN_DT, C.RPT_DDLN_DT)))
				         			END
				         	ELSE CASE
				           		WHEN TRIM(NVL(C.EXTN_RPT_DDLN_DT, C.RPT_DDLN_DT)) IS NULL THEN '0'
				           		ELSE TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(NVL(C.EXTN_RPT_DDLN_DT, C.RPT_DDLN_DT)))
							END
					 END) AS DIFF_REPORT /*귀청보고지연일수*/
					, CASE
			         WHEN TRIM(RTN_RPT_DT) IS NOT NULL AND TRIM(NVL(EXTN_BRDV_HNDL_DDLN_DT, BRDV_HNDL_DDLN_DT)) IS NOT NULL
			         THEN /*귀청보고일이 있는 */
			              CASE WHEN TRIM(AUD_BRDV_APV_DT) IS NULL
			                   THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(NVL(EXTN_BRDV_HNDL_DDLN_DT, BRDV_HNDL_DDLN_DT)))
			                   ELSE TO_CHAR(TO_DATE(AUD_BRDV_APV_DT) - TO_DATE(NVL(EXTN_BRDV_HNDL_DDLN_DT, BRDV_HNDL_DDLN_DT)))
			               END
			         ELSE '-'
			        END DIFF_BRDV /*감사국과지연일수*/


					,(CASE WHEN TRIM(C.AUD_BRDV_APV_DT) IS NOT NULL
						THEN /*감사국과결재일이 있는 경우*/
		                	CASE WHEN TRIM(C.MDT_OFER_APV_DT) IS NULL
								THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(NVL(C.EXTN_MDT_CHGR_APV_DDLN_DT, C.MDT_CHGR_APV_DDLN_DT)))
							ELSE TO_CHAR(TO_DATE(C.MDT_OFER_APV_DT) - TO_DATE(NVL(C.EXTN_MDT_CHGR_APV_DDLN_DT, C.MDT_CHGR_APV_DDLN_DT)))
							END
						ELSE '-'
			       	END) AS DIFF_MDT_CHGR /*조정담당자지연일수*/
			       	,(CASE WHEN TRIM(C.MDT_OFER_APV_DT) IS NOT NULL /*조정담당자결재일이 있는 경우*/
						THEN
							CASE WHEN TRIM(C.MDT_DDG_APV_DT) IS NULL
		                   		THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(NVL(C.EXTN_MDT_OFER_APV_DDLN_DT, C.MDT_OFER_APV_DDLN_DT)))
		                  	ELSE TO_CHAR(TO_DATE(C.MDT_DDG_APV_DT) - TO_DATE(NVL(C.EXTN_MDT_OFER_APV_DDLN_DT, C.MDT_OFER_APV_DDLN_DT)))
		                   	END
			     		ELSE '-'
			        END) AS DIFF_MDT_OFER /*조정담당관지연일수 */
			        , CASE
			         WHEN TRIM(AUD_BRDV_APV_DT) IS NOT NULL AND TRIM(NVL(EXTN_RVW_RM_APV_DDLN_DT, RVW_RM_APV_DDLN_DT)) IS NOT NULL THEN /*조정담당관결재일이 있는 경우*/
			       CASE
			           WHEN TRIM(JA_JDG_SSEC_APV_DT) IS NULL THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(NVL(EXTN_RVW_RM_APV_DDLN_DT, RVW_RM_APV_DDLN_DT)))
			           ELSE TO_CHAR(TO_DATE(JA_JDG_SSEC_APV_DT) - TO_DATE(NVL(EXTN_RVW_RM_APV_DDLN_DT, RVW_RM_APV_DDLN_DT)))
			         END
			         ELSE '-'
			       END DIFF_RVW_RM /*심의실장지연일수*/
			       ,CASE
			         WHEN TRIM(JA_JDG_SSEC_APV_DT) IS NOT NULL AND TRIM(NVL(EXTN_TOT_DHD_APV_DDLN_DT, TOT_DHD_APV_DDLN_DT)) IS NOT NULL THEN /*법무심사관(심의실장)결재일이 있는 경우*/
			       CASE
			           WHEN TRIM(OW_DHD_APV_DT) IS NULL THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(NVL(EXTN_TOT_DHD_APV_DDLN_DT, TOT_DHD_APV_DDLN_DT)))
			           ELSE TO_CHAR(TO_DATE(OW_DHD_APV_DT) - TO_DATE(NVL(EXTN_TOT_DHD_APV_DDLN_DT, TOT_DHD_APV_DDLN_DT)))
			         END
			         ELSE '-'
			       END DIFF_TOT_DHD /*총차장지연일수*/
			       ,CASE
			         WHEN TRIM(JA_JDG_SSEC_APV_DT) IS NOT NULL AND TRIM(NVL(EXTN_DHD_APV_DDLN_DT, DHD_APV_DDLN_DT)) IS NOT NULL THEN /*법무심사관(심의실장)결재일이 있는 경우*/
			       CASE
			           WHEN TRIM(OW_DHD_APV_DT) IS NULL THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(NVL(EXTN_DHD_APV_DDLN_DT, DHD_APV_DDLN_DT)))
			           ELSE TO_CHAR(TO_DATE(OW_DHD_APV_DT) - TO_DATE(NVL(EXTN_DHD_APV_DDLN_DT, DHD_APV_DDLN_DT)))
			         END
			         ELSE '-'
			       END DIFF_DHD /*차장지연일수 2019.04.18 LSR 추가 */
			       ,CASE
			         WHEN TRIM(OW_DHD_APV_DT) IS NOT NULL AND TRIM(NVL(EXTN_PSD_APV_DDLN_DT, PSD_APV_DDLN_DT)) IS NOT NULL THEN /*사무차장결재일이 있는 경우*/
			       CASE
			           WHEN TRIM(OW_PSD_APV_DT) IS NULL THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(NVL(EXTN_PSD_APV_DDLN_DT, PSD_APV_DDLN_DT)))
			           ELSE TO_CHAR(TO_DATE(OW_PSD_APV_DT) - TO_DATE(NVL(EXTN_PSD_APV_DDLN_DT, PSD_APV_DDLN_DT)))
			         END
			         ELSE '-'
			       END DIFF_PSD /*총장지연일수 2019.04.18 LSR 추가 */
			       	,CASE
			         WHEN TRIM(OW_DHD_APV_DT) IS NOT NULL AND TRIM(NVL(EXTN_CHF_CMTR_APV_DDLN_DT, CHF_CMTR_APV_DDLN_DT)) IS NOT NULL THEN /*사무차장결재일이 있는경우*/
			       CASE
			           WHEN TRIM(CHF_CMTR_APV_DT) IS NULL THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(NVL(EXTN_CHF_CMTR_APV_DDLN_DT, CHF_CMTR_APV_DDLN_DT)))
			           ELSE TO_CHAR(TO_DATE(CHF_CMTR_APV_DT) - TO_DATE(NVL(EXTN_CHF_CMTR_APV_DDLN_DT, CHF_CMTR_APV_DDLN_DT)))
			         END
			         ELSE '-'
			       END DIFF_CHF_CMTR /*주심위원지연일수*/
			       	,CASE
			         WHEN TRIM(CHF_CMTR_APV_DT) IS NOT NULL THEN /*주심위원결재일이 있는 경우*/
			       CASE
			           WHEN TRIM(ENF_APV_DT) IS NULL THEN CASE
			             WHEN TRIM(NVL(EXTN_ENF_APV_DDLN_DT, ENF_APV_DDLN_DT)) IS NULL THEN '0'
			             ELSE TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(NVL(EXTN_ENF_APV_DDLN_DT, ENF_APV_DDLN_DT)))
			           END
			           ELSE CASE
			             WHEN TRIM(NVL(EXTN_ENF_APV_DDLN_DT, ENF_APV_DDLN_DT)) IS NULL THEN '0'
			             ELSE TO_CHAR(TO_DATE(ENF_APV_DT) - TO_DATE(NVL(EXTN_ENF_APV_DDLN_DT, ENF_APV_DDLN_DT)))
			           END
			         END
			         ELSE '-'
			       END DIFF_ENF /*시행지연일수*/
				   , DECODE(PSD_APV_DDLN_DT, NULL, 'N', 'Y') AS TOT_DHD_DVS_CD	/* 총장결재기한일 DATA로 총차장 컬럼 분리 구분 20190418 LSR 추가 */
			FROM	TBBADDED030L D2, TBBADDED001M B, TBBADDED003M C
			WHERE	D2.TSK_KEY2 = #{reqDvsnCd}
			AND		D2.TSK_KEY1 = #{acpYr}
			AND		D2.TSK_KEY3 = #{cvptAcpNo}
   			AND		B.AUD_YR = D2.AUD_YR
			AND     B.AUD_NO = D2.AUD_NO
   			AND		B.AUD_YR = C.AUD_YR
   			AND		B.AUD_NO = C.AUD_NO
   			AND		SUBSTR(B.AUD_KND_CD,'3','1') <> '5'
   			]]>
	</select>

	<update id="CSPEAR005EEAR001RtnUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001RtnUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		RTN_DT = #{rtnDt}
					,DVCHF_APV_DT = #{rtnDvchfApvDt}
					,BRUCHF_APV_DT = #{rtnBruchfApvDt}
					,HQ_CHIF_APV_DT = #{rtnHqChifApvDt}
					,OW_PSD_APV_DT = #{rtnOwPsdApvDt}
					,LEDG_APV_DT = #{rtnLedgApvDt}
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<select id="CSPEAR005EAudResultSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EAudResultSelect */
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,to_char(to_date(A.AUD_CMT_OEN_DT), 'YYYY-MM-DD') AS AUD_CMT_OEN_DT
   					,to_char(to_date(A.DSP_RQ_ENF_DT), 'YYYY-MM-DD') AS DSP_RQ_ENF_DT
   					,to_char(to_date(A.AUD_RSLT_RPL_DT), 'YYYY-MM-DD') AS AUD_RSLT_RPL_DT
   					,A.AUD_RSLT_CD
   					,D.ONR_DOC_MNG_CRD_ID
   					,B.AUD_YR
   					,B.AUD_NO
   					,DECODE(B.AUD_YR,NULL,'',B.AUD_YR||'-'||B.AUD_NO) AS AUD_YR_NO
   					,C.CVPT_HNDL_STA_CD
   					,B.PRSS_STEP_CD
   					,NVL(D.REQ_DOC_KND_CD,'3') AS REQ_DOC_KND_CD
   					,C.TIT_NM
   					,D.CVPT_OPM_APV_HNDL_STA_CD
			FROM	TBCSPEAR001M A, TBBADDED001M B, TBCSPDCP101M C, TBCSPEAR002M D
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = B.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
   			AND		A.ACP_YR = C.ACP_YR
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = D.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = D.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = D.CVPT_ACP_NO(+)
   			AND		D.REQ_DOC_KND_CD(+) = '3'
		]]>
	</select>

	<!-- <select id="CSPEAR005EAudResultBztSelect" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT D1.AUD_YR                         AS AUD_YR                          /*감사년도*/
			     , D1.AUD_NO                         AS AUD_NO                          /*감사번호*/
			     , D1.AUD_YR||D1.AUD_NO              AS AUD_YR_NO
			     , D3.SPV_BRDV_NM                    AS SPV_BRDV_NM                     /*주관국과명*/
			     , D3.AUD_SBJ_NM                     AS AUD_SBJ_NM                      /*감사사항*/
			     , D3.AUD_ORG_CNT                    AS AUD_ORG_CNT                     /*기관명*/
			     , D1.DSP_RQ_SNO                     AS DSP_RQ_SNO                      /*처분요구순번*/
			     , D1.AUD_YR||'-'||D1.AUD_NO||'-'||D1.DSP_RQ_SNO AS DSP_RQ_SNO_NM       /*처분요구순번DISP*/
			     , D1.FRM_NO                         AS FRM_NO                          /*서식번호*/
			     , D1.RPRT_NO                     AS RPRT_NO                      /*보고서식번호*/
			     /*, D1.JUDG_NO                        AS JUDG_NO                         /*판결번호*/
			     , D1.TIT_TXT                        AS TIT_TXT                         /*제목내용*/
			     /*, D1.HND_SBJ_TXT                    AS HND_SBJ_TXT                     /*조치사항내용*/
			     /*, D1.HNDL_PLAN_DVSN_CD                 AS HNDL_PLAN_DVSN_CD                  /*처리방안구분*/
			     , D1.DSP_RQ_KND_CD                  AS DSP_RQ_KND_CD                   /*처분요구종류코드*/
			     , D1.ORG_DVSN_CD                    AS ORG_DVSN_CD                     /*기관구분코드*/
			     , D1.AUD_EPS_CD                     AS AUD_EPS_CD                      /*감사중점코드*/
			     , D2.DSP_RQ_SRNO                    AS DSP_RQ_SRNO                     /*처분요구일련번호*/
			     , D2.ENF_DT                         AS ENF_DT                          /*시행일*/
			     , D2.HNDL_DDLN_DT                   AS HNDL_DDLN_DT                    /*처리기한일*/
			     , D2.ENF_BRDV_CD                    AS ENF_BRDV_CD                     /*시행국과코드*/
			     , F_DPT_INFO(D2.ENF_BRDV_CD,'1')	 AS ENF_BRDV_NM                     /*시행국과명*/
			     /*, D2.CHGR_NM                        AS CHGR_NM                         /*담당자명*/
			     , D2.DOC_SEN_NO                     AS DOC_SEN_NO                      /*문서발송코드*/
			     /*, D2.DSP_RQ_IPT_DT                  AS DSP_RQ_IPT_DT                   /*처분요구입력일*/
			     /*, D2.PSC_RQT_NOP_CNT                AS PSC_RQT_NOP_CNT                 /*고발의뢰인원수*/
			     /*, D2.PNL_DRIN_PSVT_AM               AS PNL_DRIN_PSVT_AM                /*추징회수보전금액*/
			     /*, D2.RSR_AM                         AS RSR_AM                          /*환급금액*/
			     /*, D2.SPLP_AM                        AS SPLP_AM                         /*추급금액*/
			     /*, D2.BGT_RDC_AM                     AS BGT_RDC_AM                      /*예산절감금액*/
			     /*, D2.INC_ICR_AM                     AS INC_ICR_AM                      /*수입증대금액*/
			     /*, D2.PPL_BDN_RDT_AM                 AS PPL_BDN_RDT_AM                  /*국민부담경감금액*/
			     /*, D2.FRTN_INCR_AM                   AS FRTN_INCR_AM                    /*재산증가금액*/
			     /*, D2.EXPN_RTNL_AM                   AS EXPN_RTNL_AM                    /*지출합리화금액*/
			     /*, D2.IJS_AM                         AS IJS_AM                          /*부당금액*/
			     /*, D2.SLF_HNDL_RQ_AM                 AS SLF_HNDL_RQ_AM                  /*자체처리요구금액*/
			     , D2.WRDO_CAU_CD                    AS WRDO_CAU_CD                     /*비위원인코드*/
			     , D2.ENFM_MNG_BRDV_CD               AS ENFM_MNG_BRDV_CD                /*집행관리국과코드*/
			     , D2.DTM_YN                         AS DTM_YN                          /*확정여부*/
			     , D2.DTM_STA_CD                     AS DTM_STA_CD                      /*확정상태코드*/
			     /*, D2.ENFM_HST_IPT_DT                AS ENFM_HST_IPT_DT                 /*집행이력입력일*/
			     /*, D2.ACNT_INSP_CD                   AS ACNT_INSP_CD                    /*회계감찰코드*/
			     /*, D2.CPLT_DT                        AS CPLT_DT                         /*완견일*/
			     , D2.HMP_OPEN_YN                    AS HMP_OPEN_YN                     /*홈페이지공개여부*/
			     , D2.DTY_OBV_UTL_YN                 AS DTY_OBV_UTL_YN                  /*직무관철활용여부*/
			     /*, D2.AM                             AS AM                              /*금액*/
			     /*, D2.NOP_CNT                        AS NOP_CNT                         /*인원수*/
			     /*, D2.HNDL_PLAN_RPT_NO               AS HNDL_PLAN_RPT_NO                /*처리방안보고번호*/
			     /*, D2.EVI_CNT                        AS EVI_CNT                         /*증거수*/
			     /*, D2.TOT_EVI_CNT                    AS TOT_EVI_CNT                     /*총증거수*/
			     , D2.WRDO_TYP_CD                    AS WRDO_TYP_CD                     /*비위유형코드*/
			     /*, D2.DTY_INSP_MTRL_TXT              AS DTY_INSP_MTRL_TXT               /*직무감찰자료내용*/
			     /*, D2.AUD_POLI_CD                    AS AUD_POLI_CD                     /*감사방침코드*/
			     /*, D2.AUD_SPH_CD                     AS AUD_SPH_CD                      /*감사분야코드*/
			     /*, D2.AUD_RPT_YR                     AS AUD_RPT_YR                      /*감사보고년도*/
			     /*, D2.ENFM_CPLT_IPT_DT               AS ENFM_CPLT_IPT_DT                /*집행완결입력일*/
			     /*, D2.EPT_EFCT_AM_STA_CD             AS EPT_EFCT_AM_STA_CD              /*기대효과금액상태코드*/
			     /*, D2.EPT_EFCT_DT                    AS EPT_EFCT_DT                     /*기대효과일*/
			     /*, D2.ENFM_WHLS_DTM_DT               AS ENFM_WHLS_DTM_DT                /*집행전말확정일*/
			     /*, D2.SLF_HNDL_TXT                   AS SLF_HNDL_TXT                    /*자체처리내용*/
			     /*, D2.STF_SMT_INF_TXT                AS STF_SMT_INF_TXT                 /*직원제출정보내용*/
			     /*, D2.COPT_OFI_CD                    AS COPT_OFI_CD                     /*소관청코드*/
			     /*, D2.RLTN_ORG_CD                    AS RLTN_ORG_CD                     /*관계기관코드*/
			     /*, D2.COPT_CNT                       AS COPT_CNT                        /*소관수*/
			     /*, D2.ORG_CNT                        AS ORG_CNT                         /*기관수*/
			     /*, D2.DSP_RQ_DTM_DT                  AS DSP_RQ_DTM_DT                   /*처분요구확정일*/
			     /*, D2.DSP_RQ_DTM_PEN_ID              AS DSP_RQ_DTM_PEN_ID               /*처분요구확정자ID*/
			     /*, D2.ENFM_CPLT_IPT_PEN_ID           AS ENFM_CPLT_IPT_PEN_ID            /*집행완결입력자ID*/
			     /*, D2.ENFM_WHLS_DTM_PEN_ID           AS ENFM_WHLS_DTM_PEN_ID            /*집행전말확정자ID*/
			     , D2.DSP_RQ_APV_STA_CD              AS DSP_RQ_APV_STA_CD               /*처분요구결재상태코드*/
			     /*, D2.APV_REF_ID                     AS APV_REF_ID                      /*결재참조ID*/
			     /*, D2.DSP_RQ_APV_STA_DT              AS DSP_RQ_APV_STA_DT               /*처분요구결재상태일*/
			     /*, D2.CPLT_PEN_ID                    AS CPLT_PEN_ID                     /*완결자ID*/
			     , D2.TSK_CAT_CD                     AS TSK_CAT_CD                      /*업무분류코드*/
			     /*, D2.APV_REF_GRP_ID                 AS APV_REF_GRP_ID                  /*결재참조그룹ID*/
			     /*, D2.EXPOT_Y_EFCT_AM                AS EXPOT_Y_EFCT_AM                 /*사후적효과금액*/
			     /*, D2.EXPOT_Y_EFCT_AM_CALC_BAS_TXT   AS EXPOT_Y_EFCT_AM_CALC_BAS_TXT    /*사후적효과금액계산근거내용*/
			     /*, D2.ENFM_WHLS_APV_KND_CD           AS ENFM_WHLS_APV_KND_CD            /*집행전말결재종류코드*/
			     /*, D2.EXAM_RPRT_DSP_RQ_SBT           AS EXAM_RPRT_DSP_RQ_SBT            /*검토보고서처분요구요지*/
			     /*, D2.EXAM_RPRT_UNENFM_RTWR_TXT      AS EXAM_RPRT_UNENFM_RTWR_TXT       /*검토보고서미집행경위내용*/
			     /*, D2.EXAM_RPRT_UNENFM_RSN_EXAM_TXT  AS EXAM_RPRT_UNENFM_RSN_EXAM_TXT   /*검토보고서미집행사유검토내용*/
			     /*, D2.EXAM_RPRT_APV_STA_DT           AS EXAM_RPRT_APV_STA_DT            /*검토보고서결재상태일*/
			     /*, D2.EXAM_RPRT_APV_REF_ID           AS EXAM_RPRT_APV_REF_ID            /*검토보고서결재참조ID*/
			     /*, D2.EXAM_RPRT_APV_STA_CD           AS EXAM_RPRT_APV_STA_CD            /*검토보고서결재상태코드*/
			     /*, D2.CLSG_PRSS_STA_CD               AS CLSG_PRSS_STA_CD                /*결산진행상태코드*/
			     , F_CODE_NM('1000121',D2.WRDO_TYP_CD) AS WRDO_TYP_NM                   /*비위유형코드명*/
			     , F_CODE_NM('1000120',D2.TSK_CAT_CD)  AS TSK_CAT_NM                    /*업무분류명*/
			     , F_CODE_NM('1000002',D1.DSP_RQ_KND_CD )  AS DSP_RQ_KND_NM                    /*처분요구종류명*/
			     , F_CODE_NM('1000017',D2.DTM_STA_CD )  AS DTM_STA_NM                    /*결재상태명*/
			  FROM TBBADEAR001M D1
			     , TBBADEAR002D D2
			     , (
			           SELECT D1.AUD_YR
			                , D1.AUD_NO
			                , F_DPT_INFO(D1.SPV_BRDV_CD,'1')||'(반장 : '||F_USR_INFO(D1.AUD_TOT_DRTR_CNB,'2')||', 주관 : '||F_USR_INFO(D1.SPVR_CNB,'2')||')' AS SPV_BRDV_NM
			                , '<'||F_CODE_NM('1000007',D1.AUD_KND_CD) ||'>'||D1.AUD_SBJ_NM AS AUD_SBJ_NM
			                , F_ORG_CNT_NM_AUD(D1.AUD_YR,D1.AUD_NO,'1') AS AUD_ORG_CNT
			            FROM TBBADDED001M D1
			            	, TBCSPEAR001M A
			             WHERE 1=1
		            	AND		A.REQ_DVSN_CD = #{reqDvsnCd}
					 	AND		A.ACP_YR = #{acpYr}
		   				AND		A.CVPT_ACP_NO = #{cvptAcpNo}
		   				AND		A.REQ_DVSN_CD = D1.REQ_DVSN_CD
		   				AND		A.ACP_YR = D1.ACP_YR
		   				AND		A.CVPT_ACP_NO = D1.CVPT_ACP_NO
			       ) D3
			 WHERE 1=1
			   	AND 	D1.AUD_YR     = D2.AUD_YR
			   	AND 	D1.AUD_NO     = D2.AUD_NO
			   	AND 	D1.DSP_RQ_SNO = D2.DSP_RQ_SNO
			   	AND 	D1.AUD_YR     = D3.AUD_YR
			   	AND 	D1.AUD_NO     = D3.AUD_NO
		]]>
	</select> -->

	<select id="CSPEAR005EAudResultBztSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EAudResultBztSelect */
		<![CDATA[
			SELECT  D1.AUD_YR
				        ,D1.AUD_NO
				        ,D1.DSP_RQ_SNO
				        ,D3.AUD_SBJ_NM
				        ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-') ||'-'|| D1.DSP_RQ_SNO AS DSP_RQ_SNO_NM
				        , D1.TIT_TXT
				        , F_CODE_NM('1000002',D1.DSP_RQ_KND_CD )  AS DSP_RQ_KND_NM
				FROM    TBBADEAR001M D1
				        ,TBBADEAR035L D2
				        ,TBBADDED001M D3
				WHERE   D1.AUD_YR = D2.AUD_YR
				AND     D1.AUD_NO = D2.AUD_NO
				AND     D1.DSP_RQ_SNO = D2.DSP_RQ_SNO
				AND     D1.AUD_YR = D3.AUD_YR
				AND     D1.AUD_NO = D3.AUD_NO
				AND		D2.TSK_KEY2 = #{reqDvsnCd}
				AND		D2.TSK_KEY1 = #{acpYr}
				AND		D2.TSK_KEY3 = #{cvptAcpNo}
		]]>
	</select>

	<update id="CSPEAR005EEAR001AudResultUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001AudResultUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		AUD_CMT_OEN_DT = #{audCmtOenDt}
					,DSP_RQ_ENF_DT = #{dspRqEnfDt}
					,AUD_RSLT_RPL_DT = #{audRsltRplDt}
					,AUD_RSLT_CD = #{audRsltCd}
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<update id="CSPEAR005EEAR001WdwUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001WdwUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		AUD_RSLT_CD = '08'
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<update id="CSPEAR005EDCP101WdwUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EDCP101WdwUpdate */
        <![CDATA[
        	UPDATE	TBCSPDCP101M
        	SET		CVPT_HNDL_STA_CD = #{cvptHndlStaCd}
        			,CVPT_WDW_DH  = SYSDATE
   					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
   			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
   			AND		ACP_YR = #{acpYr}
   			AND		CVPT_ACP_NO = #{cvptAcpNo}
       	]]>
	</update>

	<update id="CSPEAR005EEAR001TrnfUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001TrnfUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		HNDL_DPT_CD = ''
					,HNDL_CHGR_ID = ''
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<update id="CSPEAR005EEAR001PreiNtfUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001PreiNtfUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		AUD_RSLT_RPL_DT = #{preiRplDt}
					,AUD_RSLT_CD = '03'
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<update id="CSPEAR005EEAR001ExamNtfUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001ExamNtfUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		EXAM_RPT_NTF_YN = 'Y'
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
		]]>
		<if test='reqExamRsltCd == "02"'>
						,AUD_RSLT_RPL_DT = #{examRsltRplDt}
						,AUD_RSLT_CD = #{reqExamRsltCd}
					</if>
		<if test='reqExamRsltCd == "03"'>
						,AUD_RSLT_RPL_DT = #{examRsltRplDt}
						,AUD_RSLT_CD = #{reqExamRsltCd}
					</if>
		<if test='reqExamRsltCd == "04"'>
						,AUD_RSLT_RPL_DT = #{examRsltRplDt}
						,AUD_RSLT_CD = #{reqExamRsltCd}
					</if>
		<if test='reqExamRsltCd == "05"'>
						,AUD_RSLT_RPL_DT = #{examRsltRplDt}
						,AUD_RSLT_CD = #{reqExamRsltCd}
					</if>
		<![CDATA[
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>
	
	<update id="CSPEAR005EEAR001ResultNtfUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001ResultNtfUpdate */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		AUD_RSLT_NTF_YN = 'Y'
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
					,AUD_RSLT_RPL_DT = #{audRsltRplDt}
					,AUD_RSLT_CD = #{audRsltCd}
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>

	<resultMap type="java.util.HashMap" id="CSPEAR013">
 		<result property="reqDvsnCd" column="REQ_DVSN_CD"                   jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="acpYr" column="ACP_YR"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptAcpNo" column="CVPT_ACP_NO"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="reqDocKndCd" column="REQ_DOC_KND_CD"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="onrDocMngCrdId" column="ONR_DOC_MNG_CRD_ID"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptOpmApvHndlStaCd" column="CVPT_OPM_APV_HNDL_STA_CD"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="opmTxt" column="OPM_TXT"                                 jdbcType="CLOB"  javaType="java.lang.String" />
		<result property="ad" column="AD"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="receiver" column="RECEIVER"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="zcd" column="ZCD"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="cvptrNm" column="CVPTR_NM"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="tel" column="TEL"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="flRutNm" column="FL_RUT_NM"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="sysFlNm" column="SYS_FL_NM"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
 	</resultMap>

 	<select id="CSPEAR013PMainSelect2" parameterType="paramMap"
		resultMap="CSPEAR013">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR013PMainSelect2 */
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,#{reqDocKndCd} AS REQ_DOC_KND_CD
   					,C.ONR_DOC_MNG_CRD_ID
   					,C.CVPT_OPM_APV_HNDL_STA_CD
				   	,C.OPM_TXT
				   	,A.AD||' '||A.DTL_AD AS AD
				   	,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM)
				   	||' 귀하 (우'||A.ZCD||' '||A.AD||' '||A.DTL_AD||') AS RECEIVER
   					,A.ZCD
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,DECODE(A.TNB,NULL,A.HPN,A.TNB) AS TEL
   					, D.FL_RUT_NM
					, D.SYS_FL_NM
   			FROM	TBCSPDCP101M A
   					,TBCSPEAR001M B
   					,TBCSPEAR002M C
   					, TBDCMACM103L D
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = #{reqDvsnCd}
			AND		A.ACP_YR = #{acpYr}
			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		C.REQ_DOC_KND_CD(+) = #{reqDocKndCd}
   			AND		C.ONR_DOC_MNG_CRD_ID = D.ONR_DOC_MNG_CRD_ID(+)
		]]>
	</select>

	<insert id="CSPEAR005EMmsMsgInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EMmsMsgInsert */
		<![CDATA[
			INSERT INTO MMS_CONTENTS_INFO
				 	(	CONT_SEQ
				 		, FILE_CNT
				 		, MMS_BODY
				 		, MMS_SUBJECT
				 	)
			VALUES (	#{contSeq}
						, 1
						, #{smsTxt}||#{acpYr}||'-'||DECODE(#{reqDvsnCd},'2','국민','공익')||'-'||#{cvptAcpNo}
						, '감사원 감사청구 문자 통보'
					)
		]]>
	</insert>

	<insert id="CSPEAR005EMsgInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EMsgInsert */
		<![CDATA[
			INSERT INTO MSG_DATA
				 	(	MSG_SEQ
				 		, CUR_STATE
				 		, REQ_DATE
				 		, CALL_TO
				 		, CALL_FROM
				 		, SMS_TXT
				 		, MSG_TYPE
				 		, CONT_SEQ
				 	)
			VALUES (	MSG_DATA_SEQ.NEXTVAL
						, 0
						, SYSDATE
						, REPLACE(#{hpn},'-','')
						, '0220112751'
						, ''
						, 6
						, #{contSeq}
					)
		]]>
	</insert>

	<update id="CSPEAR005EDCP101MainUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EDCP101MainUpdate */
        <![CDATA[
        	UPDATE	TBCSPDCP101M
        	SET		CVPTR_NM = #{cvptrNm}
   					,BTDT = REPLACE(#{btdt},'-','')
   					,JB_NM = #{jbNm}
   					,RPST_PEN_NM = #{rpstPenNm}
   					,BZN = #{bzn}
   					,ZCD = #{zcd}
   					,AD = #{ad}
   					,DTL_AD = #{dtlAd}
   					,TNB = DECODE(#{tnb1},NULL,'',#{tnb1}||'-'||#{tnb2}||'-'||#{tnb3})
   					,HPN = DECODE(#{hpn1},NULL,'',#{hpn1}||'-'||#{hpn2}||'-'||#{hpn3})
   					,TIT_NM = #{titNm}
   					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
   			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
   			AND		ACP_YR = #{acpYr}
   			AND		CVPT_ACP_NO = #{cvptAcpNo}
       	]]>
	</update>

	<update id="CSPEAR005EDCP102Update" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EDCP102Update */
        <![CDATA[
        	UPDATE	TBCSPDCP102M
        	SET		CVPT_TXT = #{cvptTxt}
   					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
   			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
   			AND		ACP_YR = #{acpYr}
   			AND		CVPT_ACP_NO = #{cvptAcpNo}
       	]]>
	</update>

	<update id="CSPEAR005EEAR001Update" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EEAR001Update */
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		REQR_DVSN_CD = #{reqrDvsnCd}
   					,REQR_CNT = #{reqrCnt}
   					,AUD_EXEC_DCS_DPT_CD = #{audExecDcsDptCd}
   					,AUD_EXEC_DCS_CHGR_ID = #{audExecDcsChgrId}
   					,HNDL_DPT_CD = #{audExecDcsDptCd}
   					,HNDL_CHGR_ID = #{audExecDcsChgrId}
   					,AUD_DPT_CD = #{audDptCd}
   					,AUD_CHGR_ID = #{audChgrId}
   					,VRF_YN = #{vrfYn}
   					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
   			AND		ACP_YR = #{acpYr}
   			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>


	<select id="CSPEAR005EExamFileSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EExamFileSelect */
		<![CDATA[
			SELECT	A.ACP_YR
					,A.CVPT_ACP_NO
					,A.REQ_DVSN_CD
					,C.DOC_ID AS EXAM_DOC_ID
					/*,(SELECT 	X.FILE_NAME
						FROM	UBKERAPP.ECM_FILE_LIST_VIEW2 X
						WHERE	C.DOC_ID = X.DOC_ID
						AND		ROWNUM = 1
					) AS FILE_NAME*/
					,'' AS FILE_NAME
			FROM	TBCSPEAR001M A
					,TBCSPDCP101M B
					,TBCSPEAR004M C
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		C.REQ_DOC_KND_CD(+) = '2'
		]]>
	</select>

	<select id="CSPEAR005ECmtFileSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005ECmtFileSelect */
		<![CDATA[
			WITH BASE AS  (
				SELECT 	REQ_DVSN_CD
	                      , ACP_YR
	                      , CVPT_ACP_NO
	                      ,(SELECT    DOC_ID
	                      FROM      TBCSPEAR004M
	                      WHERE     REQ_DOC_KND_CD = '3'
	                      AND       ROWNUM = 1) AS CMT_DOC_ID_1
	                    ,(SELECT    DOC_ID
	                      FROM      TBCSPEAR004M
	                      WHERE     REQ_DOC_KND_CD = '4'
	                      AND       ROWNUM = 1) AS CMT_DOC_ID_2
	                    ,(SELECT    DOC_ID
	                      FROM      TBCSPEAR004M
	                      WHERE     REQ_DOC_KND_CD = '5'
	                      AND       ROWNUM = 1) AS CMT_DOC_ID_3
				FROM    (SELECT #{reqDvsnCd} AS REQ_DVSN_CD
				                      ,#{acpYr} AS ACP_YR
				                      ,#{cvptAcpNo} AS CVPT_ACP_NO
				         FROM DUAL ) )
				SELECT	A.ACP_YR
						,A.CVPT_ACP_NO
						,A.REQ_DVSN_CD
						,C.CMT_DOC_ID_1
	                    ,C.CMT_DOC_ID_2
	                    ,C.CMT_DOC_ID_3
						/*,(SELECT 	X.FILE_NAME
							FROM	UBKERAPP.ECM_FILE_LIST_VIEW2 X
							WHERE	C.CMT_DOC_ID_1 = X.DOC_ID
							AND		ROWNUM = 1
						) AS FILE_NAME_1
	                    ,(SELECT 	X.FILE_NAME
							FROM	UBKERAPP.ECM_FILE_LIST_VIEW2 X
							WHERE	C.CMT_DOC_ID_2 = X.DOC_ID
							AND		ROWNUM = 1
						) AS FILE_NAME_2
	                    ,(SELECT 	X.FILE_NAME
							FROM	UBKERAPP.ECM_FILE_LIST_VIEW2 X
							WHERE	C.CMT_DOC_ID_3 = X.DOC_ID
							AND		ROWNUM = 1
						) AS FILE_NAME_3*/
					,'' AS FILE_NAME_1
					,'' AS FILE_NAME_2
					,'' AS FILE_NAME_3
			FROM	TBCSPEAR001M A
					,TBCSPDCP101M B
					,BASE C
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
		]]>
	</select>


	<update id="CSPEAR005EExamApvMerge1" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EExamApvMerge1 */
		<![CDATA[
			MERGE INTO	TBCSPEAR009M D1
			USING	(	SELECT	#{reqDvsnCd} AS REQ_DVSN_CD
								,#{acpYr} AS ACP_YR
								,#{cvptAcpNo} AS CVPT_ACP_NO
								,'2' AS APV_DOC_DVSN_CD
						FROM	DUAL
					) D2
			ON		(		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
						AND	D1.ACP_YR = D2.ACP_YR
						AND	D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
						AND	D1.APV_DOC_DVSN_CD = D2.APV_DOC_DVSN_CD
					)
			WHEN MATCHED THEN
				UPDATE
				SET		APV_VLE_PEN_DVSN_CD = #{examApvVlePenDvsnCd}
						,DVCHF_APV_DT = NULL
						,LDR_APV_DT = #{examLdrApvDt}
						,HQ_CHIF_APV_DT = #{examHqChifApvDt}
						,OW_PSD_APV_DT = #{examOwPsdApvDt}
						,LEDG_APV_DT = #{examLedgApvDt}
						,FNL_USR_ID = #{fnlUsrId}
	  					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
	  					,FNL_MNU_ID = #{fnlMnuId}
	  					,FNL_MDF_DH = SYSDATE
	  		WHEN NOT MATCHED THEN
	  			INSERT	(	REQ_DVSN_CD
	  					,	ACP_YR
	  					,	CVPT_ACP_NO
	  					,	APV_DOC_DVSN_CD
	  					,	APV_VLE_PEN_DVSN_CD
	  					,	DVCHF_APV_DT
	  					,	LDR_APV_DT
	  					,	HQ_CHIF_APV_DT
	  					,	OW_PSD_APV_DT
	  					,	LEDG_APV_DT
	  					,	FRT_USR_ID
	  					,	FNL_USR_ID
	  					,	FNL_DEAL_DPT_CD
	  					,	FNL_MNU_ID
	  					,	FRT_REGI_DH
	  					,	FNL_MDF_DH
	  					)
	  			VALUES	(	#{reqDvsnCd}
	  					,	#{acpYr}
	  					,	#{cvptAcpNo}
	  					,	'2'
	  					,	#{examApvVlePenDvsnCd}
	  					,	NULL
	  					,	#{examLdrApvDt}
	  					,	#{examHqChifApvDt}
	  					,	#{examOwPsdApvDt}
	  					,	#{examLedgApvDt}
	  					,	#{fnlUsrId}
	  					,	#{fnlUsrId}
	  					,	#{fnlDealDptCd}
	  					,	#{fnlMnuId}
	  					,	SYSDATE
	  					,	SYSDATE
	  					)
	  	]]>
	</update>

	<update id="CSPEAR005EExamApvMerge2" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EExamApvMerge2 */
		<![CDATA[
			MERGE INTO	TBCSPEAR009M D1
			USING	(	SELECT	#{reqDvsnCd} AS REQ_DVSN_CD
								,#{acpYr} AS ACP_YR
								,#{cvptAcpNo} AS CVPT_ACP_NO
								,'3' AS APV_DOC_DVSN_CD
						FROM	DUAL
					) D2
			ON		(		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
						AND	D1.ACP_YR = D2.ACP_YR
						AND	D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
						AND	D1.APV_DOC_DVSN_CD = D2.APV_DOC_DVSN_CD
					)
			WHEN MATCHED THEN
				UPDATE
				SET		APV_VLE_PEN_DVSN_CD = #{examApvVlePenDvsnCd}
						,DVCHF_APV_DT = #{examDvchfApvDt2}
						,LDR_APV_DT = #{examLdrApvDt2}
						,HQ_CHIF_APV_DT = #{examHqChifApvDt2}
						,OW_PSD_APV_DT = #{examOwPsdApvDt2}
						,LEDG_APV_DT = #{examLedgApvDt2}
						,FNL_USR_ID = #{fnlUsrId}
	  					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
	  					,FNL_MNU_ID = #{fnlMnuId}
	  					,FNL_MDF_DH = SYSDATE
	  		WHEN NOT MATCHED THEN
	  			INSERT	(	REQ_DVSN_CD
	  					,	ACP_YR
	  					,	CVPT_ACP_NO
	  					,	APV_DOC_DVSN_CD
	  					,	APV_VLE_PEN_DVSN_CD
	  					,	DVCHF_APV_DT
	  					,	LDR_APV_DT
	  					,	HQ_CHIF_APV_DT
	  					,	OW_PSD_APV_DT
	  					,	LEDG_APV_DT
	  					,	FRT_USR_ID
	  					,	FNL_USR_ID
	  					,	FNL_DEAL_DPT_CD
	  					,	FNL_MNU_ID
	  					,	FRT_REGI_DH
	  					,	FNL_MDF_DH
	  					)
	  			VALUES	(	#{reqDvsnCd}
	  					,	#{acpYr}
	  					,	#{cvptAcpNo}
	  					,	'3'
	  					,	#{examApvVlePenDvsnCd}
	  					,	#{examDvchfApvDt2}
	  					,	#{examLdrApvDt2}
	  					,	#{examHqChifApvDt2}
	  					,	#{examOwPsdApvDt2}
	  					,	#{examLedgApvDt2}
	  					,	#{fnlUsrId}
	  					,	#{fnlUsrId}
	  					,	#{fnlDealDptCd}
	  					,	#{fnlMnuId}
	  					,	SYSDATE
	  					,	SYSDATE
	  					)
	  	]]>
	</update>
	
	
	<select id="CSPEAR005EPreiSelectPrcs" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR005EPreiSelectPrcs */
		<![CDATA[
			SELECT	NVL(A.PREI_DMS_YN,'N') AS PREI_DMS_YN
					,to_char(to_date(A.PREI_APV_DT), 'YYYY-MM-DD') AS PREI_APV_DT
					,A.PREI_DMS_RSN_CD
					,NVL(A.TRNF_YN,'N') AS TRNF_YN
					,A.TRNF_DPT_CD
					,(	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = A.TRNF_DPT_CD
   					)  AS TRNF_DPT_NM
					,to_char(to_date(A.TRNF_DT), 'YYYY-MM-DD') AS TRNF_DT
					,TO_CHAR(B.CVPT_WDW_DH,'YYYY-MM-DD') AS CVPT_WDW_DH
					,DECODE(B.CVPT_WDW_DH,NULL,'','취하') AS CVPT_WDW_NM
					,A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.CVPT_HNDL_STA_CD
   					,to_char(to_date(A.PREI_RPL_DT), 'YYYY-MM-DD') AS PREI_RPL_DT   /*선람전 회신일*/
   					,E.DOC_ID AS PREI_DOC_ID  /*선람전문서ID*/
			   		,C.ONR_DOC_MNG_CRD_ID
			   		,NVL(C.REQ_DOC_KND_CD,'1') AS REQ_DOC_KND_CD
			   		,C.CVPT_OPM_APV_HNDL_STA_CD
			   		,B.TIT_NM
			FROM	TBCSPEAR001M A
			INNER JOIN TBCSPDCP101M B ON(   A.REQ_DVSN_CD = B.REQ_DVSN_CD
                                            AND		A.ACP_YR = B.ACP_YR
                                            AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
                                        )
		    LEFT OUTER JOIN TBCSPEAR002M C ON(  A.REQ_DVSN_CD = C.REQ_DVSN_CD
                                                AND		A.ACP_YR = C.ACP_YR
                                                AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
                                                AND		C.REQ_DOC_KND_CD = '1'
                                             )
            LEFT OUTER JOIN TBCSPDCP603M E ON( A.REQ_DVSN_CD = E.REQ_DVSN_CD
                                                AND		A.ACP_YR = E.ACP_YR
                                                AND		A.CVPT_ACP_NO = E.CVPT_ACP_NO
                                                AND		(E.RPRT_CD = 'C10120100' OR E.RPRT_CD = 'C10130100')
                                            )
			WHERE	A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</select>
	
	
	<update id="CSPEAR010E001PreiUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR010E001PreiUpdate */
		<![CDATA[
			UPDATE TBCSPEAR001M 
            SET PREI_DMS_YN = #{preiDmsYn}
                , PREI_DMS_RSN_CD = #{preiDmsRsnCd}
                , PREI_APV_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
                , PREI_RPL_DT = #{preiRplDt}
                ,FNL_USR_ID = #{fnlUsrId}
				,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				,FNL_MNU_ID = #{fnlMnuId}
				,FNL_MDF_DH = SYSDATE
            WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>
	
	
		<update id="CSPEAR010E001ExamUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR010E001ExamUpdate */
		<![CDATA[
			UPDATE TBCSPEAR001M 
            SET EXAM_RPT_APV_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
                ,FNL_USR_ID = #{fnlUsrId}
				,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				,FNL_MNU_ID = #{fnlMnuId}
				,FNL_MDF_DH = SYSDATE
            WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>
	
	<update id="CSPEAR010E001ExamUpdate2" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR010E001ExamUpdate2 */
		<![CDATA[
			UPDATE TBCSPEAR001M 
            SET EXAM_RPT_APV_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
                ,FNL_USR_ID = #{fnlUsrId}
				,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				,FNL_MNU_ID = #{fnlMnuId}
				,FNL_MDF_DH = SYSDATE
            WHERE	REQ_DVSN_CD = #{upReqDvsnCd}
			AND		ACP_YR = #{upAcpYr}
			AND		CVPT_ACP_NO = #{upCvptAcpNo}
		]]>
	</update>
	
	<update id="CSPEAR010EPreiTrnfApvUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR010EPreiTrnfApvUpdate */
		<![CDATA[
			UPDATE TBCSPEAR001M 
            SET TRNF_DT = #{fnlApvDh}
            	,TRNF_YN = #{trnfYn}
                ,FNL_USR_ID = #{fnlUsrId}
				,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				,FNL_MNU_ID = #{fnlMnuId}
				,FNL_MDF_DH = SYSDATE
            WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>
	
	<update id="CSPEAR010EExamTonApvUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.ear.dao.CSPEAR004Mapper.CSPEAR010EExamTonApvUpdate */
		<![CDATA[
			UPDATE TBCSPEAR001M 
            SET TON_DT = #{fnlApvDh}
                ,FNL_USR_ID = #{fnlUsrId}
				,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				,FNL_MNU_ID = #{fnlMnuId}
				,FNL_MDF_DH = SYSDATE
            WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>
</mapper>
