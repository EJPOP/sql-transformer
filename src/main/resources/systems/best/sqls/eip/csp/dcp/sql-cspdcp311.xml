<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper">

    <select id="CSPDCP311QMainSelect" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP311QMainSelect */

        <include refid="include.pageSelct" />
        <![CDATA[
            SELECT  A.REQ_DVSN_CD
                    ,A.ACP_YR
                    ,A.CVPT_ACP_NO
                    ,A.RM_CVPT_ACP_NO
                    ,A.RM_ACP_KND_CD
                    ,DECODE(A.RM_ACP_KND_CD, NULL, '-', A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO) AS ACP_NO
                    ,DECODE(A.PRE_RM_CVPT_ACP_NO,NULL,'-',A.ACP_YR||'-'|| F_CODE_NM('1000949', A.PRE_RM_ACP_KND_CD) ||'-'||A.PRE_RM_CVPT_ACP_NO) AS PRE_ACP_NO /* BEST20 이전접수번호 */
                    ,A.CVPT_KND_CD
                    ,F_CODE_NM('1000047', A.CVPT_KND_CD) AS CVPT_KND_NM
                    ,A.TIT_NM
                    ,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
                    ,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
                    ,TO_CHAR(C.FNL_DTB_DH,'YYYY-MM-DD') AS FNL_DTB_DH
                    ,A.CVPT_HNDL_STA_CD
                    ,F_CODE_NM('1000361',A.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
                    ,A.REQR_KND_CD
                    ,C.HNDL_DPT_CD AS OLD_HNDL_DPT_CD --BEST20 이전처리부서 추가
                    ,(  SELECT  S1.DPT_NM
                        FROM    TBDCMACM002M S1
                        WHERE   S1.DPT_CD = C.HNDL_DPT_CD
                        )  AS HNDL_DPT_NM
                    ,F_USR_INFO_BY_ID(C.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
                    ,NVL2(A.RAL_ACP_DPT_CD, (SELECT	S1.CD_NM FROM TBDCMACM013C S1 WHERE S1.CMM_CD_DVSN_CD = '1000144' AND S1.CD = A.RAL_ACP_DPT_CD)
   					                        ,(SELECT	S1.DPT_NM FROM 	TBDCMACM002M S1 WHERE 	S1.DPT_CD = A.ACP_DPT_CD) 
   					) AS ACP_DPT_NM
                    ,F_CODE_NM('1000056',A.ACP_RUT_CD) AS ACP_RUT_NM
                    ,TO_CHAR(A.CVPT_WDW_DH,'YYYY-MM-DD HH24:MI') AS CVPT_WDW_DH
                    ,A.CVPT_KND_DVSN_CD
                    , F_CODE_NM('1000599',A.CVPT_KND_DVSN_CD) AS CVPT_KND_DVSN_NM
                    ,(  SELECT  F_CODE_NM('1000754', S3.CVPT_HNDL_DVSN_CD)
                        FROM    TBCSPDCP205L S3
                        WHERE   (S3.REQ_DVSN_CD, S3.ACP_YR, S3.CVPT_ACP_NO, S3.SRNO) IN (   SELECT  S4.REQ_DVSN_CD,S4.ACP_YR,S4.CVPT_ACP_NO,MIN(S4.SRNO)
                                                                                        FROM    TBCSPDCP205L S4
                                                                                        WHERE   A.REQ_DVSN_CD = S4.REQ_DVSN_CD
                                                                                        AND     A.ACP_YR = S4.ACP_YR
                                                                                        AND     A.CVPT_ACP_NO = S4.CVPT_ACP_NO
                                                                                        GROUP BY S4.REQ_DVSN_CD,S4.ACP_YR,S4.CVPT_ACP_NO
                                                                                    )
                  ) AS CVPT_HNLD_DVSN_NM
                  ,(    SELECT  TO_CHAR(TO_DATE(TO_CHAR(S2.ONR_APV_CMPT_DH, 'YYYYMMDD'), 'YYYYMMDD') + NVL( S1.USR_DFN_TXT_2, 30), 'YYYY-MM-DD')
                        FROM    TBDCMACM013C S1, TBCSPDCP205L D3, TBCSPDCP301M S2
                        WHERE   S1.CMM_CD_DVSN_CD = '1000754'
                        AND     S1.CD <> '000000000'
                        AND     S1.CD  = D3.CVPT_HNDL_DVSN_CD
                        AND     A.REQ_DVSN_CD = D3.REQ_DVSN_CD
                        AND     A.ACP_YR = D3.ACP_YR
                        AND     A.CVPT_ACP_NO = D3.CVPT_ACP_NO
                        AND     A.REQ_DVSN_CD = S2.REQ_DVSN_CD
                        AND     A.ACP_YR = S2.ACP_YR
                        AND     A.CVPT_ACP_NO = S2.CVPT_ACP_NO
                        AND     S2.CVPT_IFM_DVSN_CD = 'C'
                        AND     S2.CVPT_OPM_APV_HNDL_STA_CD = '30'
                        AND (D3.REQ_DVSN_CD, D3.CVPT_ACP_NO, D3.ACP_YR, D3.SRNO ) IN (  SELECT  Z.REQ_DVSN_CD, Z.CVPT_ACP_NO, Z.ACP_YR, MIN(Z.SRNO)
                                                                                FROM    TBCSPDCP205L Z
                                                                                WHERE   A.REQ_DVSN_CD = Z.REQ_DVSN_CD
                                                                                AND     A.CVPT_ACP_NO = Z.CVPT_ACP_NO
                                                                                AND     A.ACP_YR = Z.ACP_YR
                                                                                GROUP BY Z.REQ_DVSN_CD, Z.CVPT_ACP_NO, Z.ACP_YR
                                                                            )) AS HNDL_LIMIT__DT
                    ,TO_CHAR(TO_DATE(A.HNDL_DDLN_DT),'YYYY-MM-DD') AS HNDL_LIMIT_DT_PRCS
                    ,F_USR_INFO_BY_ID(C.BAI_CHGR_ID,'2') AS BAI_CHGR_NM
                    ,CASE WHEN (SELECT COUNT(AUD_STEP_SNO) FROM TBCSPDCP207L
                                  WHERE ACP_YR = A.ACP_YR
                                     AND REQ_DVSN_CD = A.REQ_DVSN_CD
                                     AND CVPT_ACP_NO = A.CVPT_ACP_NO) > 0
                          THEN 
                                (SELECT COUNT(AUD_STEP_SNO) FROM TBCSPDCP207L
                                  WHERE ACP_YR = A.ACP_YR
                                    AND REQ_DVSN_CD = A.REQ_DVSN_CD
                                    AND CVPT_ACP_NO = A.CVPT_ACP_NO) || '회' 
                          END AS BZT_CNT
                    ,(
                    	SELECT S1.CD_NM
						  FROM TBDCMACM013C S1
						 WHERE S1.CMM_CD_DVSN_CD = '1000144' 
						   AND S1.CD = C.RAL_BLT_DIV_CD
                    ) AS RAL_BLT_DIV_NM
                    ,C.RAL_BLT_DIV_CD
            FROM    TBCSPDCP101M A
                    ,TBCSPDCP102M B
                    ,TBCSPDCP201M C
            WHERE   1=1
            AND     A.REQ_DVSN_CD = '1'
            AND     A.REQ_DVSN_CD = B.REQ_DVSN_CD
            AND     A.ACP_YR = B.ACP_YR
            AND     A.CVPT_ACP_NO = B.CVPT_ACP_NO
            AND     A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
            AND     A.ACP_YR = C.ACP_YR(+)
            AND     A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)

            AND     A.CVPT_HNDL_STA_CD NOT IN ('10','21')
        ]]>
        <if test='usrId != null and hndlUsrIdChk != "Y"'>
                AND     (A.ACP_DPT_CD = #{dptCd} OR C.RAL_BLT_DIV_CD = #{ralBltDivCd}
                		)
        </if>
        <if test='acpDhs != null and acpDhs != ""'>
                AND TO_CHAR(A.ACP_DH,'YYYYMMDD') &gt;= #{acpDhs}
            </if>
        <if test='acpDhe != null and acpDhe != ""'>
                AND TO_CHAR(A.ACP_DH,'YYYYMMDD') &lt;= #{acpDhe}
            </if>
        <if test='cvptHndlStaCd != null and cvptHndlStaCd != ""'>
                AND A.CVPT_HNDL_STA_CD = #{cvptHndlStaCd}
            </if>
        <if test='titNm != null and titNm != ""'>
            AND A.TIT_NM LIKE '%'||#{titNm}||'%'
        </if>
        <if test='acpYr != null and acpYr != ""'>
            AND A.ACP_YR = #{acpYr}
        </if>
        <if test='acpRutCd != null and acpRutCd != ""'>
			AND A.ACP_RUT_CD IN
			(SELECT
			SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL)
			-1) merge_col
			FROM DUAL A
			CROSS JOIN(SELECT ','|| #{acpRutCd} ||',' AS CODE FROM DUAL) B
			CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
		</if>
        /* BEST20 이전접수번호 조회 */
		<choose>
			<when test='reqDvsnCd != null and reqDvsnCd != "" and rmCvptAcpNo != null and rmCvptAcpNo != ""'>
				 AND ((A.RM_ACP_KND_CD = #{reqDvsnCd} AND A.RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0)) OR
				         (A.PRE_RM_ACP_KND_CD = #{reqDvsnCd}  AND A.PRE_RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0)))  
			</when>
			<otherwise>
				<if test='reqDvsnCd != null and reqDvsnCd != ""'>
					AND (A.RM_ACP_KND_CD = #{reqDvsnCd} )  
				</if>
				<if test='rmCvptAcpNo != null and rmCvptAcpNo != ""'>
					AND (A.RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0) OR A.PRE_RM_CVPT_ACP_NO = LPAD(#{rmCvptAcpNo}, 5, 0))
				</if>
			</otherwise>
		</choose>
        <if test='cvptrNm != null and cvptrNm != ""'>
                AND (A.CVPTR_NM LIKE '%'||#{cvptrNm}||'%' OR A.RPST_PEN_NM LIKE '%'||#{cvptrNm}||'%')
            </if>
        <if test='dtbYn == "Y"'>
            <![CDATA[
                AND (   (C.HNDL_DPT_CD IS NOT NULL AND C.RAL_BLT_DIV_CD <> #{ralBltDivCd})
                    OR  (C.RAL_BLT_DIV_CD = #{ralBltDivCd} AND C.HNDL_CHGR_ID IS NOT NULL)
                    OR  (A.CVPT_HNDL_STA_CD IN ('70','80')))
            ]]>
            </if>
        <if test='dtbYn == "N"'>
            <![CDATA[
                AND (C.HNDL_DPT_CD IS NULL OR (C.RAL_BLT_DIV_CD = #{ralBltDivCd} AND  C.HNDL_CHGR_ID IS NULL))
                AND A.CVPT_HNDL_STA_CD NOT IN('70','80')
            ]]>

            </if>
        <if test='smgCvptAplNo != null and smgCvptAplNo != ""'>
                AND A.SMG_CVPT_APL_NO = #{smgCvptAplNo}
            </if>

        <![CDATA[
            ORDER BY A.ACP_YR DESC,A.CVPT_ACP_NO DESC
        ]]>
        <include refid="include.pageOrder" />
    </select>

    <select id="CSPDCP311QSubSelect" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP311QSubSelect */
        <![CDATA[
            SELECT  A.REQ_DVSN_CD
                    ,A.ACP_YR
                    ,A.CVPT_ACP_NO
                    ,A.RM_CVPT_ACP_NO
                    ,DECODE(A.RM_CVPT_ACP_NO,NULL,'',A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO) AS ACP_NO
                    ,A.CVPT_KND_CD
                    ,F_CODE_NM('1000047', A.CVPT_KND_CD) AS CVPT_KND_NM
                    ,A.TIT_NM
                    ,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
                    ,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
                    ,(  SELECT S1.CD_NM
						  FROM TBDCMACM013C S1
						 WHERE S1.CMM_CD_DVSN_CD = '1000144'
						   AND S1.CD = B.RAL_BLT_DIV_CD  
                        )  AS HNDL_DPT_NM
                    ,B.HNDL_DPT_CD
                    ,F_USR_INFO_BY_ID(B.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
                    ,B.HNDL_CHGR_ID
                    ,A.CVPT_HNDL_STA_CD
                    ,F_CODE_NM('1000361',A.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
                    ,(  SELECT  S1.DPT_NM
                        FROM    TBDCMACM002M S1
                        WHERE   S1.DPT_CD = A.ACP_DPT_CD
                        )  AS ACP_DPT_NM
                    , F_CODE_NM('1000894', A.DOC_WRIT_KND_CD) AS DOC_TYPE /* 편집기 구분  */
            FROM    TBCSPDCP101M A
                    ,TBCSPDCP201M B
                    ,(  SELECT  A.CVPTR_NM, A.RPST_PEN_NM, A.HPN, A.TNB
                        FROM    TBCSPDCP101M A
                        WHERE   A.REQ_DVSN_CD = #{reqDvsnCd}
                        AND     A.ACP_YR = #{acpYr}
                        AND     A.CVPT_ACP_NO = #{cvptAcpNo}
                    ) C
            WHERE   1=1
            AND     A.REQ_DVSN_CD = '1'
            AND     A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
            AND     A.ACP_YR = B.ACP_YR(+)
            AND     A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)
            AND     A.REQR_KND_CD <> '4'
            AND     NOT EXISTS (
                        SELECT  ''
                        FROM    TBCSPDCP101M Z
                        WHERE   Z.REQ_DVSN_CD = #{reqDvsnCd}
                        AND     Z.ACP_YR = #{acpYr}
                        AND     Z.CVPT_ACP_NO = #{cvptAcpNo}
                        AND     Z.REQ_DVSN_CD = A.REQ_DVSN_CD
                        AND     Z.ACP_YR = A.ACP_YR
                        AND     Z.CVPT_ACP_NO = A.CVPT_ACP_NO
                    )
        ]]>
               <if test='reqrKndCd == "4"'>
                AND ( A.HPN = C.HPN 
                OR A.TNB =  C.TNB
                OR A.HPN = C.TNB
                 OR A.TNB = C.HPN
                ) 
            </if> 
            <![CDATA[
                AND(
                       (A.CVPTR_NM = C.CVPTR_NM AND A.HPN = C.HPN )
                     OR(A.CVPTR_NM = C.CVPTR_NM AND A.TNB = C.TNB)
                     OR(A.RPST_PEN_NM = C.RPST_PEN_NM AND A.HPN = C.HPN )
                     OR(A.RPST_PEN_NM = C.RPST_PEN_NM AND A.TNB = C.TNB )
                 )
                ORDER BY A.ACP_YR ASC
      ]]>
    </select>

    <select id="CSPDCP311QHisSelect" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP311QHisSelect */
        <![CDATA[
            SELECT  A.REQ_DVSN_CD
                    ,A.ACP_YR
                    ,A.CVPT_ACP_NO
                    ,TO_CHAR(B.FRT_REGI_DH,'YYYY-MM-DD') AS DTB_DT
                    ,B.DTB_DPT_CD
                    ,(  SELECT  S1.DPT_NM
                        FROM    TBDCMACM002M S1
                        WHERE   S1.DPT_CD = B.DTB_DPT_CD
                        )  AS DTB_DPT_NM
                    ,B.DTB_PEN_ID
                    ,F_USR_INFO_BY_ID(B.DTB_PEN_ID,'2') AS DTB_PEN_NM
                    ,B.CVPT_HNDL_STA_CD
                    ,B.HNDL_DPT_CD
                    ,(  SELECT  S1.DPT_NM
                        FROM    TBDCMACM002M S1
                        WHERE   S1.DPT_CD = B.HNDL_DPT_CD
                        )  AS HNDL_DPT_NM
                    ,B.HNDL_CHGR_ID
                    ,F_USR_INFO_BY_ID(B.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
                    ,B.RDTB_RQS_RSN
                    ,B.CVPT_DTB_HST_SRNO
                    ,B.BAI_CHGR_ID
                    ,F_USR_INFO_BY_ID(B.BAI_CHGR_ID,'2') AS BAI_CHGR_NM
                    ,(SELECT    Z.USR_DFN_TXT_1
                        FROM    TBDCMACM013C Z
                        WHERE   Z.CMM_CD_DVSN_CD ='1000948'
                        AND     Z.CD = A.TG_ORG_CAT_CD) AS TG_ORG_CAT_CD1
                    ,(SELECT    Z.USR_DFN_TXT_2
                        FROM    TBDCMACM013C Z
                        WHERE   Z.CMM_CD_DVSN_CD ='1000948'
                        AND     Z.CD = A.TG_ORG_CAT_CD) AS TG_ORG_CAT_CD2
                    ,A.TG_ORG_CAT_CD  AS TG_ORG_CAT_CD3
                    ,A.MAIN_FUNC_CAT_CD
            FROM    TBCSPDCP101M A
                    ,TBCSPDCP202H B
            WHERE   1=1
            AND     A.REQ_DVSN_CD = '1'
            AND     A.REQ_DVSN_CD = B.REQ_DVSN_CD
            AND     A.ACP_YR = B.ACP_YR
            AND     A.CVPT_ACP_NO = B.CVPT_ACP_NO
            AND     A.REQ_DVSN_CD = #{reqDvsnCd}
            AND     A.ACP_YR = #{acpYr}
            AND     A.CVPT_ACP_NO = #{cvptAcpNo}
            ORDER BY CVPT_DTB_HST_SRNO ASC
        ]]>
    </select>



    <resultMap type="java.util.HashMap" id="cspdcpMap">
        <result property="reqDvsnCd" column="REQ_DVSN_CD"                   jdbcType="VARCHAR" javaType="java.lang.String" />
        <result property="acpYr" column="ACP_YR"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="cvptAcpNo" column="CVPT_ACP_NO"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="acpNo" column="ACP_NO"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="cvptKndNm" column="CVPT_KND_NM"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="cvptKndCd" column="CVPT_KND_CD"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="acpNm" column="ACP_NM"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="acpDptCd" column="ACP_DPT_CD"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="acpDh" column="ACP_DH"                     jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="acpRutCd" column="ACP_RUT_CD"             jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="acpRutNm" column="ACP_RUT_NM"             jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="reqrKndNm" column="REQR_KND_NM"                         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="cvptrNm" column="CVPTR_NM"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="openYn" column="OPEN_YN"                               jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="widwYn" column="WIDW_YN"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="ad" column="AD"                                   jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="tnb" column="TNB"                           jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="hpn" column="HPN"                                   jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="rsltNtfWayNm" column="RSLT_NTF_WAY_NM"                                     jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="clmNm" column="CLM_NM"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="wrkPlacNm" column="WRK_PLAC_NM"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="clmTnb" column="CLM_TNB"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="clmAd" column="CLM_AD"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="cvptTxt" column="CVPT_TXT"                         jdbcType="CLOB"      javaType="java.lang.String" />
        <result property="hndlDptCd" column="HNDL_DPT_CD"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="chkHndlDptCd" column="CHK_HNDL_DPT_CD"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="ralBltDivCd" column="RAL_BLT_DIV_CD"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="hndlChgrId" column="HNDL_CHGR_ID"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="cvptHndlStaCd" column="CVPT_HNDL_STA_CD"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="docId" column="DOC_ID"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="titNm" column="TIT_NM"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="smgCvptAplNo" column="SMG_CVPT_APL_NO"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="smgFrtCvptAplGccOrgCd" column="SMG_FRT_CVPT_APL_GCC_ORG_CD"         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="cvptWdwDh" column="CVPT_WDW_DH"         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="cvptWdwRsn" column="CVPT_WDW_RSN"         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="atchYn" column="ATCH_YN"         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="baiChgrId" column="BAI_CHGR_ID"         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="oldHndlDptCd" column="OLD_HNDL_DPT_CD"         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="innerYn" column="INNER_YN"         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="innerOrgNm" column="INNER_ORG_NM"         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="rmCvptAcpNo" column="RM_CVPT_ACP_NO"         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="rmAcpKndCd" column="RM_ACP_KND_CD"         jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="tgOrgCatCd1"      column="TG_ORG_CAT_CD1"     jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result property="tgOrgCatCd2"      column="TG_ORG_CAT_CD2"     jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result property="tgOrgCatCd3"      column="TG_ORG_CAT_CD3"     jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result property="mainFuncCatCd"        column="MAIN_FUNC_CAT_CD"       jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result property="cvptKndDvsnCd"        column="CVPT_KND_DVSN_CD"       jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result property="cvptRsltYn"        column="CVPT_RSLT_YN"       jdbcType="VARCHAR" javaType="java.lang.String"/>
    </resultMap>

    <select id="CSPDCP314EMainSelect" parameterType="paramMap"
        resultMap="cspdcpMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314EMainSelect */
        <![CDATA[
            SELECT  A.REQ_DVSN_CD
                    ,A.ACP_YR
                    ,A.CVPT_ACP_NO
                    ,DECODE(A.RM_ACP_KND_CD, NULL, '-', A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO) AS ACP_NO
                    ,F_CODE_NM('1000047',A.CVPT_KND_CD) AS CVPT_KND_NM
                    ,A.CVPT_KND_CD
                    ,(  SELECT  S1.DPT_NM
                        FROM    TBDCMACM002M S1
                        WHERE   S1.DPT_CD = A.ACP_DPT_CD
                        ) ||'/'||F_USR_INFO_BY_ID(A.RCEP_ID,'2') AS ACP_NM
                    ,ACP_DPT_CD
                    ,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
                    ,A.ACP_RUT_CD
                    ,F_CODE_NM('1000056',A.ACP_RUT_CD) AS ACP_RUT_NM
                    ,F_CODE_NM('1000358',A.REQR_KND_CD) AS REQR_KND_NM
                    ,DECODE(#{reqrKndCd},'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
                    ,A.OPEN_YN
                    ,DECODE(A.CVPT_WDW_DH,NULL,'N','Y') AS WIDW_YN
                    ,DECODE(A.ZCD,NULL,'','(우)'||A.ZCD||' '||A.AD||' '||A.DTL_AD) AS AD
                    ,A.TNB
                    ,A.HPN
                    ,CASE WHEN A.ACP_RUT_CD = '8' THEN F_CODE_NM('1000089',A.RSLT_NTF_WAY_CD)
                        WHEN A.ACP_RUT_CD <> '8' AND A.RSLT_NTF_WAY_CD = '003' THEN F_CODE_NM('1000089',A.RSLT_NTF_WAY_CD)
                        ELSE '홈페이지+'||F_CODE_NM('1000089',A.RSLT_NTF_WAY_CD)  END AS RSLT_NTF_WAY_NM
                    ,C.CLM_NM
                    ,C.WRK_PLAC_NM
                    ,C.TNB AS CLM_TNB
                    ,DECODE(C.ZCD,NULL,'','(우)'||C.ZCD||' '||C.AD||' '||C.DTL_AD) AS CLM_AD
                    ,B.CVPT_TXT
                    ,D.RAL_BLT_DIV_CD AS HNDL_DPT_CD 
                    ,D.RAL_BLT_DIV_CD AS RAL_BLT_DIV_CD
                    ,D.HNDL_DPT_CD AS CHK_HNDL_DPT_CD 
                    ,D.HNDL_CHGR_ID
                    ,A.CVPT_HNDL_STA_CD
                    ,A.DOC_ID
                    ,A.TIT_NM
                    ,A.SMG_CVPT_APL_NO
                    ,A.SMG_FRT_CVPT_APL_GCC_ORG_CD
                    ,TO_CHAR(A.CVPT_WDW_DH,'YYYY-MM-DD HH24:MI') AS CVPT_WDW_DH
                    ,A.CVPT_WDW_RSN
                    ,CASE WHEN  (   SELECT  COUNT(FILE_ID)
                                    FROM    ECM_FILE_LIST_VIEW2 X
                                    WHERE   A.DOC_ID = X.DOC_ID
                                ) > 0 THEN '첨부파일 있음'
                    ELSE '첨부파일 없음' END AS ATCH_YN
                    ,D.BAI_CHGR_ID
                    ,D.HNDL_DPT_CD AS OLD_HNDL_DPT_CD
                    ,NVL(A.INNER_YN,'N') AS INNER_YN
                    ,A.INNER_ORG_NM
                    ,A.RM_CVPT_ACP_NO
                    ,A.RM_ACP_KND_CD
                    ,(SELECT    Z.USR_DFN_TXT_1
                        FROM    TBDCMACM013C Z
                        WHERE   Z.CMM_CD_DVSN_CD ='1000948'
                        AND     Z.CD = A.TG_ORG_CAT_CD) AS TG_ORG_CAT_CD1
                    ,(SELECT    Z.USR_DFN_TXT_2
                        FROM    TBDCMACM013C Z
                        WHERE   Z.CMM_CD_DVSN_CD ='1000948'
                        AND     Z.CD = A.TG_ORG_CAT_CD) AS TG_ORG_CAT_CD2
                    ,A.TG_ORG_CAT_CD  AS TG_ORG_CAT_CD3
                    ,A.MAIN_FUNC_CAT_CD
                    ,A.CVPT_KND_DVSN_CD
                    ,(SELECT (CASE WHEN COUNT(1) > 0 THEN 'Y' ELSE 'N' END )
                       FROM TBCSPDCP205L AA
                      WHERE AA.REQ_DVSN_CD = A.REQ_DVSN_CD
                        AND AA.ACP_YR = A.ACP_YR 
                        AND AA.CVPT_ACP_NO = A.CVPT_ACP_NO ) AS CVPT_RSLT_YN /* BEST20 처리결과생성여부 */
            FROM    TBCSPDCP101M A
                    ,TBCSPDCP102M B
                    ,TBCSPDCP103M C
                    ,TBCSPDCP201M D
            WHERE   1=1
            AND     A.REQ_DVSN_CD = #{reqDvsnCd}
            AND     A.ACP_YR = #{acpYr}
            AND     A.CVPT_ACP_NO = #{cvptAcpNo}
            AND     A.REQ_DVSN_CD = B.REQ_DVSN_CD
            AND     A.ACP_YR = B.ACP_YR
            AND     A.CVPT_ACP_NO = B.CVPT_ACP_NO
            AND     A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
            AND     A.ACP_YR = C.ACP_YR(+)
            AND     A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
            AND     A.REQ_DVSN_CD = D.REQ_DVSN_CD(+)
            AND     A.ACP_YR = D.ACP_YR(+)
            AND     A.CVPT_ACP_NO = D.CVPT_ACP_NO(+)
        ]]>

    </select>

    <select id="CSPDCP314EDptSelect" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314EDptSelect */
        <![CDATA[
            SELECT  DPT_CD, DPT_NM
            FROM    TBDCMACM002M
            WHERE   DPT_CD LIKE '0L0%'
            AND     USE_YN ='Y'
            AND     DPT_CD NOT IN ('0L0000')
            UNION
            SELECT CD AS DPT_CD, CD_NM AS DPT_NM
			FROM TBDCMACM013C
			WHERE CMM_CD_DVSN_CD = '1000144'
			AND CD IN ('0L0205','0L0315','0L0325','0L0335')
        ]]>

    </select>

    <select id="CSPDCP314EUsrSelect" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314EUsrSelect */
        <![CDATA[
            SELECT  USR_ID,USR_NAM
                   ,CASE WHEN SUB_DPT_CD LIKE '0L0%' THEN SUB_DPT_CD
                         ELSE DPT_CD
                          END DPT_CD
                   ,RAL_BLT_DIV_CD 
            FROM    TBDCMACM001M
            WHERE   (DPT_CD LIKE '0L0%' OR SUB_DPT_CD LIKE '0L0%')
            AND     DPT_CD NOT IN ('0L0000')
            AND     RSG_DT IS NULL
            AND     RQS_STA_CD = '3'
            AND     BAI_USR_YN = 'Y'
            ORDER BY USR_NAM ASC
        ]]>

    </select>

    <select id="CSPDCP314EBaiUsrSelect" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314EBaiUsrSelect */
        <![CDATA[
            SELECT  USR_ID,USR_NAM
                   ,CASE WHEN SUB_DPT_CD LIKE '0L0%' THEN SUB_DPT_CD
                         ELSE DPT_CD
                          END DPT_CD
                   ,RAL_BLT_DIV_CD
            FROM    TBDCMACM001M
            WHERE   (DPT_CD LIKE '0L0%' OR SUB_DPT_CD LIKE '0L0%')
            AND     DPT_CD NOT IN ('0L0000')
            AND     RSG_DT IS NULL
            AND     RQS_STA_CD = '3'
            AND     BAI_USR_YN = 'Y'
            AND     CNB < '7000' 
            ORDER BY USR_NAM ASC
        ]]>

    </select>


    <select id="CSPDCP314ECheckSelect" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314ECheckSelect */
        <![CDATA[
            SELECT  CVPT_HNDL_STA_CD    /*진행상태*/
            FROM    TBCSPDCP101M
            WHERE   REQ_DVSN_CD = #{reqDvsnCd}
            AND     ACP_YR = #{acpYr}
            AND     CVPT_ACP_NO = #{cvptAcpNo}
        ]]>

    </select>

    <update id="CSPDCP314E101NewDtpUpdate" parameterType="paramMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314E101NewDtpUpdate */

            UPDATE  TBCSPDCP101M
            SET     CVPT_HNDL_STA_CD = #{hndlStaCd}
            		<if test='cvptKndCd != null and cvptKndCd != ""'>
                    ,CVPT_KND_CD = #{cvptKndCd}
                    </if>
                     <if test='mainFuncCatCd != null and mainFuncCatCd != ""'>
                    ,MAIN_FUNC_CAT_CD = #{mainFuncCatCd}          /* BEST20 주요기능별 분류  */
                    </if>
                     <if test='tgOrgCatCd3 != null and tgOrgCatCd3 != ""'>
                    ,TG_ORG_CAT_CD = #{tgOrgCatCd3}          /* BEST20 대상기관별 분류   */
                   </if>
                  <if test='cvptKndDvsnCd != null and cvptKndDvsnCd != ""'>
                    ,CVPT_KND_DVSN_CD = #{cvptKndDvsnCd}     /* BEST20 민원종류구분코드  */
                  </if>
                <if test='newRmCvptAcpNo != null and newRmCvptAcpNo == "Y"'>
                    ,RM_ACP_KND_CD = #{rmAcpKndCd}                      /* BEST20 실민원접수구분  */
                    ,RM_CVPT_ACP_NO = #{rmCvptAcpNo}             /* BEST20 실민원접수번호  */
                    
                    ,PRE_RM_ACP_KND_CD = RM_ACP_KND_CD          /* BEST20 이전 실민원접수구분   */
                    ,PRE_RM_CVPT_ACP_NO = RM_CVPT_ACP_NO          /* BEST20 이전실민원접수번호  */
                </if>

                    ,FNL_USR_ID = #{fnlUsrId}
                    ,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
                    ,FNL_MNU_ID = #{fnlMnuId}
                    ,FNL_MDF_DH = SYSDATE
            WHERE   REQ_DVSN_CD = #{reqDvsnCd}
            AND     ACP_YR = #{acpYr}
            AND     CVPT_ACP_NO = #{cvptAcpNo}

    </update>
    
    <!-- BEST20 정부기능별 분류, 주요기능별 분류 수정용 -->
    <update id="CSPDCP314E101NewDtpUpdate2" parameterType="paramMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314E101NewDtpUpdate2 */

            UPDATE  TBCSPDCP101M
            SET     CVPT_HNDL_STA_CD = #{hndlStaCd}
            	    <if test='mainFuncCatCd != null and mainFuncCatCd != ""'>
                    ,MAIN_FUNC_CAT_CD = #{mainFuncCatCd}          /* BEST20 주요기능별 분류  */
                    </if>
                     <if test='tgOrgCatCd3 != null and tgOrgCatCd3 != ""'>
                    ,TG_ORG_CAT_CD = #{tgOrgCatCd3}          /* BEST20 정부기능별 분류   */
                   </if>
                    ,FNL_USR_ID = #{fnlUsrId}
                    ,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
                    ,FNL_MNU_ID = #{fnlMnuId}
                    ,FNL_MDF_DH = SYSDATE
            WHERE   REQ_DVSN_CD = #{reqDvsnCd}
            AND     ACP_YR = #{acpYr}
            AND     CVPT_ACP_NO = #{cvptAcpNo}

    </update>

   <update id="CSPDCP314E101CvptHndlStaCdUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314E101CvptHndlStaCdUpdate */
		<![CDATA[
			UPDATE	TBCSPDCP101M
			SET		CVPT_HNDL_STA_CD = #{hndlStaCd}
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</update>
    
    <!-- BEST20 일괄배부용 업데이트 -->
     <update id="CSPDCP314E101CvptHndlStaCdUpdateNew" parameterType="paramMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314E101CvptHndlStaCdUpdateNew */
        <![CDATA[
            UPDATE  TBCSPDCP101M
            SET     CVPT_HNDL_STA_CD = #{hndlStaCd}
            ]]>
                <if test='cvptKndDvsnCd != null and cvptKndDvsnCd != ""'>
                    ,CVPT_KND_DVSN_CD = #{cvptKndDvsnCd}     /* BEST20 민원종류구분코드  */
                </if>
                <if test='tgOrgCatCd3 != null and tgOrgCatCd3 != ""'>
                    ,TG_ORG_CAT_CD = #{tgOrgCatCd3}     /* BEST20 대상기관별분류코드   */
                </if>
                <if test='mainFuncCatCd != null and mainFuncCatCd != ""'>
                    ,MAIN_FUNC_CAT_CD  = #{mainFuncCatCd}     /* BEST20 주요기능별분류코드  */
                </if>
                <if test='newRmCvptAcpNo != null and newRmCvptAcpNo == "Y"'>
                    ,RM_ACP_KND_CD = #{rmAcpKndCd}                      /* BEST20 실민원접수구분  */
                    ,RM_CVPT_ACP_NO = #{rmCvptAcpNo}             /* BEST20 실민원접수번호  */
                    
                    ,PRE_RM_ACP_KND_CD = RM_ACP_KND_CD          /* BEST20 이전 실민원접수구분   */
                    ,PRE_RM_CVPT_ACP_NO = RM_CVPT_ACP_NO          /* BEST20 이전실민원접수번호  */
                </if>
        <![CDATA[
                    ,FNL_USR_ID = #{fnlUsrId}
                    ,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
                    ,FNL_MNU_ID = #{fnlMnuId}
                    ,FNL_MDF_DH = SYSDATE
            WHERE   REQ_DVSN_CD = #{reqDvsnCd}
            AND     ACP_YR = #{acpYr}
            AND     CVPT_ACP_NO = #{cvptAcpNo}
        ]]>
    </update>


    <update id="CSPDCP314E202DtbInsert" parameterType="paramMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314E202DtbInsert */
        <![CDATA[
            INSERT INTO TBCSPDCP202H
                        (   REQ_DVSN_CD
                            ,ACP_YR
                            ,CVPT_ACP_NO
                            ,CVPT_DTB_HST_SRNO
                            ,DTB_DPT_CD
                            ,DTB_PEN_ID
                            ,CVPT_HNDL_STA_CD
                            ,HNDL_DPT_CD
                            ,HNDL_CHGR_ID
                            ,RDTB_RQS_RSN
                            ,FRT_USR_ID
                            ,FNL_USR_ID
                            ,FNL_DEAL_DPT_CD
                            ,FNL_MNU_ID
                            ,FRT_REGI_DH
                            ,FNL_MDF_DH
                            ,BAI_CHGR_ID
                        )
                VALUES  (   #{reqDvsnCd}
                            ,#{acpYr}
                            ,#{cvptAcpNo}
                            ,(  SELECT NVL(MAX(CVPT_DTB_HST_SRNO),0)+1
                                  FROM TBCSPDCP202H
                                 WHERE 1=1
                                   AND REQ_DVSN_CD = #{reqDvsnCd}
                                   AND ACP_YR = #{acpYr}
                                   AND CVPT_ACP_NO = #{cvptAcpNo}
                             )
                            ,F_USR_INFO(#{sCnb},'5')
                            ,F_USR_INFO(#{sCnb},'1')
                            ,#{hndlStaCd}
                            ,#{hndlDptCd}
                            ,#{hndlChgrId}
                            ,#{rdtbRqsRsn}
                            ,F_USR_INFO(#{sCnb},'1')
                            ,#{fnlUsrId}
                            ,#{fnlDealDptCd}
                            ,#{fnlMnuId}
                            ,SYSDATE
                            ,SYSDATE
                            ,#{baiChgrId}
                        )
        ]]>
    </update>


    <insert id="CSPDCP314E201DtbMerge" parameterType="paramMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314E201DtbMerge */
        <![CDATA[
            MERGE INTO  TBCSPDCP201M A
            USING   (   SELECT  #{reqDvsnCd} AS REQ_DVSN_CD
                                ,#{acpYr} AS ACP_YR
                                ,#{cvptAcpNo} AS CVPT_ACP_NO
                        FROM DUAL
                    ) B
            ON      (   A.REQ_DVSN_CD = B.REQ_DVSN_CD
                        AND A.ACP_YR = B.ACP_YR
                        AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
                    )
            WHEN MATCHED THEN
                    UPDATE
                    SET     FNL_DTB_DPT_CD = F_USR_INFO(#{sCnb},'5')
                            ,FNL_DTB_PEN_ID = F_USR_INFO(#{sCnb},'1')
                            ,FNL_DTB_DH = SYSDATE
                            ,HNDL_DPT_CD = #{hndlDptCd}
                            ,HNDL_CHGR_ID = #{hndlChgrId}
                            ,BAI_CHGR_ID = #{baiChgrId}
                             ,CVPT_KND_DVSN_CD = #{cvptKndDvsnCd}     /* BEST20 민원종류구분코드  */
                            ,FNL_USR_ID = #{fnlUsrId}
                            ,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
                            ,FNL_MNU_ID = #{fnlMnuId}
                            ,FNL_MDF_DH = SYSDATE
                            ,RAL_BLT_DIV_CD = #{ralBltDivCd}
            WHEN NOT MATCHED THEN
                    INSERT      (   REQ_DVSN_CD
                                    ,ACP_YR
                                    ,CVPT_ACP_NO
                                    ,FNL_DTB_DPT_CD
                                    ,FNL_DTB_PEN_ID
                                    ,FNL_DTB_DH
                                    ,HNDL_DPT_CD
                                    ,HNDL_CHGR_ID
                                    ,CVPT_KND_DVSN_CD
                                    ,FRT_USR_ID
                                    ,FNL_USR_ID
                                    ,FNL_DEAL_DPT_CD
                                    ,FNL_MNU_ID
                                    ,FRT_REGI_DH
                                    ,FNL_MDF_DH
                                    ,BAI_CHGR_ID
                                    ,RAL_BLT_DIV_CD
                                )
                        VALUES  (   #{reqDvsnCd}
                                    ,#{acpYr}
                                    ,#{cvptAcpNo}
                                    ,F_USR_INFO(#{sCnb},'5')
                                    ,F_USR_INFO(#{sCnb},'1')
                                    ,SYSDATE
                                    ,#{hndlDptCd}
                                    ,#{hndlChgrId}
                                    ,#{cvptKndDvsnCd}
                                    ,F_USR_INFO(#{sCnb},'1')
                                    ,#{fnlUsrId}
                                    ,#{fnlDealDptCd}
                                    ,#{fnlMnuId}
                                    ,SYSDATE
                                    ,SYSDATE
                                    ,#{baiChgrId}
                                    ,#{ralBltDivCd}
                                )
        ]]>
    </insert>


    <select id="CSPDCP313PUsrSelect" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP313PUsrSelect */
        <![CDATA[
            SELECT  RANK_NM_2 AS PST_NM,USR_NAM
                    ,USR_ID
            FROM    TBDCMACM001M
            WHERE   RAL_BLT_DIV_CD = #{dptCd}
            AND     RSG_DT IS NULL
            AND     RQS_STA_CD = '3'
            AND     BAI_USR_YN = 'Y'			
            ORDER BY USR_NAM ASC
        ]]>

    </select>

    <select id="CSPDCP316P202DtpSelect" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP316P202DtpSelect */
        <![CDATA[
            SELECT  FNL_DTB_DPT_CD, FNL_DTB_PEN_ID
            FROM    TBCSPDCP201M
            WHERE   REQ_DVSN_CD = #{reqDvsnCd}
            AND     ACP_YR = #{acpYr}
            AND     CVPT_ACP_NO = #{cvptAcpNo}
        ]]>
    </select>

    <update id="CSPDCP314E201ReDtbUpdate" parameterType="paramMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314E201ReDtbUpdate */
        <![CDATA[
            UPDATE  TBCSPDCP201M
            SET     HNDL_DPT_CD = #{hndlDptCd}
                    ,HNDL_CHGR_ID =''
                    ,FNL_USR_ID = #{fnlUsrId}
                    ,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
                    ,FNL_MNU_ID = #{fnlMnuId}
                    ,FNL_MDF_DH = SYSDATE
            WHERE   REQ_DVSN_CD = #{reqDvsnCd}
            AND     ACP_YR = #{acpYr}
            AND     CVPT_ACP_NO = #{cvptAcpNo}
        ]]>
    </update>

    <select id="CSPDCP311EDTBCheckSelect" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP311EDTBCheckSelect */
        <![CDATA[
            SELECT  A.CVPT_HNDL_STA_CD /*진행상태*/
                    , B.HNDL_DPT_CD
                    , B.HNDL_CHGR_ID
                    ,F_CODE_NM('1000361',A.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
            FROM    TBCSPDCP101M A, TBCSPDCP201M B
            WHERE   A.REQ_DVSN_CD = #{reqDvsnCd}
            AND     A.ACP_YR = #{acpYr}
            AND     A.CVPT_ACP_NO = #{cvptAcpNo}
            AND     A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
            AND     A.ACP_YR = B.ACP_YR(+)
            AND     A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)
        ]]>
    </select>

    <select id="CSPDCP311QExcelType1" parameterType="paramMap"  resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP311QExcelType1 */
        <![CDATA[
            SELECT  D2.RM_CVPT_ACP_NO AS CVPT_ACP_NO
                    ,NVL((  SELECT  S1.DPT_NM
                        FROM    TBDCMACM002M S1
                        WHERE   S1.DPT_CD = D1.HNDL_DPT_CD
                        ) ,' ') AS HNDL_DPT_NM
                    ,TO_CHAR(D2.ACP_DH, 'YYYY.MM.DD') AS ACP_DT
                    ,D2.TIT_NM
                    ,NVL(DECODE(D2.REQR_KND_CD,'1',D2.CVPTR_NM,'2',D2.RPST_PEN_NM,'3',D2.RPST_PEN_NM,'4',D2.CVPTR_NM),' ') AS CVPTR_NM
                    ,NVL2(D2.RAL_ACP_DPT_CD, (SELECT	S1.CD_NM FROM TBDCMACM013C S1 WHERE S1.CMM_CD_DVSN_CD = '1000144' AND S1.CD = D2.RAL_ACP_DPT_CD)
   					                        ,(SELECT	S1.DPT_NM FROM 	TBDCMACM002M S1 WHERE 	S1.DPT_CD = D2.ACP_DPT_CD) 
   					)  AS ACP_DPT_NM
                    ,NVL(F_USR_INFO_BY_ID (D1.HNDL_CHGR_ID, '2'),' ') AS HNDL_CHGR_NM
                    ,' ' AS RMK
                    ,' ' AS U
                    ,F_CODE_NM ('1000056', D2.ACP_RUT_CD) AS ACP_RUT_NM
                    ,' ' AS AA
            FROM    TBCSPDCP101M D2
                    ,(SELECT * FROM TBCSPDCP202H D1 WHERE HNDL_DPT_CD IS NOT NULL AND       (D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO,D1.CVPT_DTB_HST_SRNO) IN (SELECT S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO,MIN(CVPT_DTB_HST_SRNO)
                        FROM    TBCSPDCP202H S1
                        WHERE   S1.HNDL_DPT_CD IS NOT NULL
                        GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO) ) D1
            WHERE   D2.REQ_DVSN_CD ='1'
            AND     D2.REQ_DVSN_CD = D1.REQ_DVSN_CD
            AND     D2.ACP_YR = D1.ACP_YR
            AND     D2.CVPT_ACP_NO = D1.CVPT_ACP_NO
            AND     TO_CHAR(D1.FRT_REGI_DH, 'YYYYMMDD') = #{dipDt}
            AND     D1.HNDL_DPT_CD IS NOT NULL
            ]]>
        <if test='dptCd == "0L0100" or dptCd =="0L0200" or dptCd =="071110"'>
            AND (D2.ACP_DPT_CD IN ('0L0100','0L0200','071110')
            OR    D1.HNDL_DPT_CD IN ('0L0100','0L0200','071110'))
        </if>
		<if test='dptCd != "0L0100" and dptCd != "0L0200" and dptCd != "071110"'>
            AND (D2.ACP_DPT_CD = #{dptCd}
            OR    D1.HNDL_DPT_CD = #{dptCd})
        </if>
        <![CDATA[
            AND     (D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO,D1.CVPT_DTB_HST_SRNO) IN (SELECT S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO,MIN(CVPT_DTB_HST_SRNO)
                        FROM    TBCSPDCP202H S1
                        WHERE   S1.CVPT_HNDL_STA_CD IN ('20','30')
                        AND     TO_CHAR(S1.FRT_REGI_DH, 'YYYYMMDD') = #{dipDt}
                        AND     S1.HNDL_DPT_CD IS NOT NULL
         ]]>
        <if test='dptCd == "0L0100" or dptCd =="0L0200" or dptCd =="071110"'>
            AND S1.DTB_DPT_CD IN ('0L0100','0L0200','071110')
        </if>
        <if test='dptCd != "0L0100" and dptCd != "0L0200" and dptCd != "071110"'>
            AND S1.DTB_DPT_CD = #{dptCd}
        </if>
        <![CDATA[
        GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO)
        ORDER BY D1.CVPT_ACP_NO DESC
        ]]>
    </select>
    
    
    <select id="CSPDCP311QExcelType2" parameterType="paramMap"  resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP311QExcelType2 */
        <![CDATA[
            SELECT  D2.RM_CVPT_ACP_NO AS CVPT_ACP_NO
                    ,NVL((  SELECT  S1.DPT_NM
                        FROM    TBDCMACM002M S1
                        WHERE   S1.DPT_CD = D1.HNDL_DPT_CD
                        ) ,' ') AS HNDL_DPT_NM
                    ,TO_CHAR(D2.ACP_DH, 'YYYY.MM.DD') AS ACP_DT
                    ,D2.TIT_NM
                    ,NVL(DECODE(D2.REQR_KND_CD,'1',D2.CVPTR_NM,'2',D2.RPST_PEN_NM,'3',D2.RPST_PEN_NM,'4',D2.CVPTR_NM),' ') AS CVPTR_NM
                    ,NVL2(D2.RAL_ACP_DPT_CD, (SELECT	S1.CD_NM FROM TBDCMACM013C S1 WHERE S1.CMM_CD_DVSN_CD = '1000144' AND S1.CD = D2.RAL_ACP_DPT_CD)
   					                        ,(SELECT	S1.DPT_NM FROM 	TBDCMACM002M S1 WHERE 	S1.DPT_CD = D2.ACP_DPT_CD) 
   					)  AS ACP_DPT_NM
                    ,NVL(F_USR_INFO_BY_ID (D1.HNDL_CHGR_ID, '2'),' ') AS HNDL_CHGR_NM
                    ,' ' AS RMK
                    ,' ' AS U
                    ,F_CODE_NM ('1000056', D2.ACP_RUT_CD) AS ACP_RUT_NM
                    ,' ' AS AA
            FROM    TBCSPDCP101M D2
                    ,(SELECT * FROM TBCSPDCP202H D1 
                    WHERE HNDL_DPT_CD IS NOT NULL                        
                        AND     TO_CHAR(D1.FRT_REGI_DH, 'YYYYMMDD') = #{dipDt}
                        AND     D1.HNDL_DPT_CD IS NOT NULL
                        AND D1.CVPT_HNDL_STA_CD = '30'
                        ) D1
            WHERE   D2.REQ_DVSN_CD ='1'
            AND     D2.REQ_DVSN_CD = D1.REQ_DVSN_CD
            AND     D2.ACP_YR = D1.ACP_YR
            AND     D2.CVPT_ACP_NO = D1.CVPT_ACP_NO
            ]]>
         <if test='dptCd == "0L0100" or dptCd =="0L0200" or dptCd =="071110"'>
            AND (D2.ACP_DPT_CD IN ('0L0100','0L0200','071110')
            OR    D1.HNDL_DPT_CD IN ('0L0100','0L0200','071110'))
        </if>
        <if test='dptCd != "0L0100" and dptCd != "0L0200" and dptCd != "071110"'>
            AND (D2.ACP_DPT_CD = #{dptCd}
            OR    D1.HNDL_DPT_CD = #{dptCd})
        </if>
        <![CDATA[
            AND     (D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO,D1.CVPT_DTB_HST_SRNO) IN (SELECT S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO,MAX(CVPT_DTB_HST_SRNO)
                        FROM    TBCSPDCP202H S1
                        WHERE   S1.CVPT_HNDL_STA_CD ='30'
                        AND     TO_CHAR(S1.FRT_REGI_DH, 'YYYYMMDD') = #{dipDt}
                        AND     S1.HNDL_DPT_CD IS NOT NULL
         ]]>
         <if test='dptCd == "0L0100" or dptCd =="0L0200" or dptCd =="071110"'>
            AND S1.DTB_DPT_CD IN ('0L0100','0L0200','071110')
        </if>
		<if test='dptCd != "0L0100" and dptCd != "0L0200" and dptCd != "071110"'>
            AND S1.DTB_DPT_CD = #{dptCd}
        </if>
        <![CDATA[
        GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO)
        ORDER BY D1.CVPT_ACP_NO DESC
        ]]>
    </select>

    <select id="CSPDCP311QExcel2Type1" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
             SELECT '대전사무소 : '||CNT1||', '||'광주사무소 : '||CNT2||', '
                    ||'부산사무소 : '||CNT3||', '||'서울센터 : '||CNT4||', '
                    ||'국민제안감사2국제1과 : '||CNT5||', '||'국민제안감사2국제2과 : '||CNT6||', '
                    ||'국민제안감사2국제3과 : '||CNT7 AS CNT
                    , CNT1, CNT2, CNT3, CNT4, CNT5, CNT6, CNT7
                    ,(CNT1+ CNT2+ CNT3 + CNT4) as SUM_CNT
                    ,(CNT1+ CNT2+ CNT3+ CNT4+ CNT5+ CNT6+ CNT7) AS TOTAL_CNT
                    , TO_CHAR(TO_DATE(#{dipDt}), 'MM') AS MM
                    , TO_CHAR(TO_DATE(#{dipDt}), 'DD') AS DD
             FROM (SELECT
                     NVL(SUM(CASE WHEN HNDL_DPT_CD = '062500' THEN 1 ELSE 0 END),0) AS CNT1
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '062800' THEN 1 ELSE 0 END),0) AS CNT2
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '062600' THEN 1 ELSE 0 END),0) AS CNT3
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '071110' THEN 1 ELSE 0 END),0) AS CNT4
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '0L0100' THEN 1 ELSE 0 END),0) AS CNT5
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '0L0200' THEN 1 ELSE 0 END),0) AS CNT6
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '0L0300' THEN 1 ELSE 0 END),0) AS CNT7
               FROM     TBCSPDCP101M D2
                        ,(SELECT * FROM TBCSPDCP202H D1 WHERE HNDL_DPT_CD IS NOT NULL AND       (D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO,D1.CVPT_DTB_HST_SRNO) IN (SELECT S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO,MIN(CVPT_DTB_HST_SRNO)
                        FROM    TBCSPDCP202H S1
                        WHERE   S1.HNDL_DPT_CD IS NOT NULL
                        GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO) ) D1
                WHERE   D2.REQ_DVSN_CD = '1'
                AND     D2.REQ_DVSN_CD = D1.REQ_DVSN_CD
                AND     D2.ACP_YR = D1.ACP_YR
                AND     D2.CVPT_ACP_NO = D1.CVPT_ACP_NO
                AND     TO_CHAR(D1.FRT_REGI_DH, 'YYYYMMDD') = #{dipDt}
                AND     D1.HNDL_DPT_CD IS NOT NULL
                ]]>
         <if test='dptCd == "0L0100" or dptCd =="0L0200" or dptCd =="071110"'>
            AND (D2.ACP_DPT_CD IN ('0L0100','0L0200','071110')
            OR    D1.HNDL_DPT_CD IN ('0L0100','0L0200','071110'))
        </if>
		<if test='dptCd != "0L0100" and dptCd != "0L0200" and dptCd != "071110"'>
            AND (D2.ACP_DPT_CD = #{dptCd}
            OR    D1.HNDL_DPT_CD = #{dptCd})
        </if>
        <![CDATA[
            AND (D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO,D1.CVPT_DTB_HST_SRNO) IN (SELECT S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO,MIN(CVPT_DTB_HST_SRNO)
                    FROM    TBCSPDCP202H S1
                    WHERE   S1.CVPT_HNDL_STA_CD IN ('20','30')
                    AND     TO_CHAR(S1.FRT_REGI_DH, 'YYYYMMDD') = #{dipDt}
                    AND     S1.HNDL_DPT_CD IS NOT NULL
        ]]>
        <if test='dptCd == "0L0100" or dptCd =="0L0200" or dptCd =="071110"'>
            AND S1.DTB_DPT_CD IN ('0L0100','0L0200','071110')
        </if>
		<if test='dptCd != "0L0100" and dptCd != "0L0200" and dptCd != "071110"'>
            AND S1.DTB_DPT_CD = #{dptCd}
        </if>
        <![CDATA[
            GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO)
                )
        ]]>
    </select>
    
    <select id="CSPDCP311QExcel2Type2" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
             SELECT '대전사무소 : '||CNT1||', '||'광주사무소 : '||CNT2||', '
                    ||'부산사무소 : '||CNT3||', '||'서울센터 : '||CNT4||', '
                    ||'국민제안감사2국제1과 : '||CNT5||', '||'국민제안감사2국제2과 : '||CNT6||', '
                    ||'국민제안감사2국제3과 : '||CNT7 AS CNT
                    , CNT1, CNT2, CNT3, CNT4, CNT5, CNT6, CNT7
                    ,(CNT1+ CNT2+ CNT3 + CNT4) as SUM_CNT
                    ,(CNT1+ CNT2+ CNT3+ CNT4+ CNT5+ CNT6+ CNT7) AS TOTAL_CNT
                    , TO_CHAR(TO_DATE(#{dipDt}), 'MM') AS MM
                    , TO_CHAR(TO_DATE(#{dipDt}), 'DD') AS DD
             FROM (SELECT
                     NVL(SUM(CASE WHEN HNDL_DPT_CD = '062500' THEN 1 ELSE 0 END),0) AS CNT1
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '062800' THEN 1 ELSE 0 END),0) AS CNT2
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '062600' THEN 1 ELSE 0 END),0) AS CNT3
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '071110' THEN 1 ELSE 0 END),0) AS CNT4
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '0L0100' THEN 1 ELSE 0 END),0) AS CNT5
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '0L0200' THEN 1 ELSE 0 END),0) AS CNT6
                    ,NVL(SUM(CASE WHEN HNDL_DPT_CD = '0L0300' THEN 1 ELSE 0 END),0) AS CNT7
               FROM     TBCSPDCP101M D2
                    ,(SELECT * FROM TBCSPDCP202H D1 
                    WHERE HNDL_DPT_CD IS NOT NULL                        
                        AND     TO_CHAR(D1.FRT_REGI_DH, 'YYYYMMDD') = #{dipDt}
                        AND     D1.HNDL_DPT_CD IS NOT NULL
                        AND D1.CVPT_HNDL_STA_CD = '30'
                        ) D1
            WHERE   D2.REQ_DVSN_CD ='1'
            AND     D2.REQ_DVSN_CD = D1.REQ_DVSN_CD
            AND     D2.ACP_YR = D1.ACP_YR
            AND     D2.CVPT_ACP_NO = D1.CVPT_ACP_NO
                ]]>
         <if test='dptCd == "0L0100" or dptCd =="0L0200" or dptCd =="071110"'>
            AND (D2.ACP_DPT_CD IN ('0L0100','0L0200','071110')
            OR    D1.HNDL_DPT_CD IN ('0L0100','0L0200','071110'))
        </if>
		<if test='dptCd != "0L0100" and dptCd != "0L0200" and dptCd != "071110"'>
            AND (D2.ACP_DPT_CD = #{dptCd}
            OR    D1.HNDL_DPT_CD = #{dptCd})
        </if>
        <![CDATA[
             AND        (D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO,D1.CVPT_DTB_HST_SRNO) IN (SELECT S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO,MAX(CVPT_DTB_HST_SRNO)
                        FROM    TBCSPDCP202H S1
                        WHERE   S1.CVPT_HNDL_STA_CD ='30'
                        AND     TO_CHAR(S1.FRT_REGI_DH, 'YYYYMMDD') = #{dipDt}
                        AND     S1.HNDL_DPT_CD IS NOT NULL
        ]]>
        <if test='dptCd == "0L0100" or dptCd =="0L0200" or dptCd =="071110"'>
            AND S1.DTB_DPT_CD IN ('0L0100','0L0200','071110')
        </if>
		<if test='dptCd != "0L0100" and dptCd != "0L0200" and dptCd != "071110"'>
            AND S1.DTB_DPT_CD = #{dptCd}
        </if>
        <![CDATA[
            GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO)
                )
        ]]>
    </select>

    <select id="CSPDCP315PMainSelect" parameterType="paramMap"  resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP315PMainSelect */
        <![CDATA[
            SELECT  '파일다운' AS FILE_DOWN
                    ,D1.ATT_FL_URL_AD
            FROM    TBCSPDCP106L D1
            WHERE   D1.REQ_DVSN_CD = #{reqDvsnCd}
            AND     D1.ACP_YR = #{acpYr}
            AND     D1.CVPT_ACP_NO = #{cvptAcpNo}
            AND     TRIM(D1.ATT_FL_URL_AD) IS NOT NULL
        ]]>
    </select>


    <insert id="CSPDCP314ESmgInsert" parameterType="paramMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP314ESmgInsert */
        <![CDATA[
            INSERT INTO T_IC_TARGET_SRC_INTERFACE
                        (   INTERFACE_KEY
                            ,APP_ORGAN_CODE     /*최초 민원 신청 기관코드(GCC)*/
                            ,PETI_NO            /*민원신청번호*/
                            ,REC_SEQ            /*분류이력일련번호*/
                            ,CIVIL_NO           /*민원접수번호*/
                            ,PETI_GUBUN         /*민원구분 (500고정,담당자부서지정) */
                            ,CANCEL_STATUS      /*민원취하여부(Default N)*/
                            ,PCD_DEPT           /*GCC 부서코드 (접수부서코드)*/
                            ,PCD_DEPT_NM        /*GCC 부서명 (접수부서명)*/
                            ,PCD_DUTY_ID        /*접수자명*/
                            ,PCD_EMAIL          /*접수 이메일 (대표이메일 사용, 감청국, 센터 로 분류)*/
                            ,PCD_TEL            /*접수자 전화번호 (대표전화 사용: 감청국, 센터로 분류)*/
                            ,PCD_ORGAN_CODE     /*실처리기관코드 (감사원 GCC 코드로 고정)*/
                            ,SRCORGCD           /*소스기관코드 (감사원 GCC 코드로 고정)*/
                            ,TGTORGCD           /*타겟기관코드 (신문고 GCC 코드로 고정)*/
                            ,WRITE_TIME         /*등록일자*/
                            ,SND_RCV_GUBUN      /*송수신구분 (1:송신, 2:수신)*/
                            ,SND_RCV_TIME       /*송수신일자*/
                            ,SEND_YN            /*송신여부 (N DEFAULT, EAI 가 송신후 Y로 변경함)*/
                        )
                SELECT  TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF2') || LPAD(ROUND(DBMS_RANDOM.VALUE(1, 999999999)), 9, '0')
                        ,SMG_FRT_CVPT_APL_GCC_ORG_CD
                            ,SMG_CVPT_APL_NO
                            ,SMG_CAT_HST_SRNO
                            ,SMG_CVPT_ACP_NO
                            ,'500'
                            ,'N'
                            ,(  SELECT  SUBSTR(STND_DPT_CD,9,7)
                                FROM    TBDCMACM002M S1
                                WHERE   S1.DPT_CD = #{hndlDptCd}
                                ) 
                            ,(  SELECT  S2.ALL_ORG_NM
                                FROM    TBDCMACM002M S1
                                        ,TBCSPIIT006M S2
                                WHERE   S1.DPT_CD = #{hndlDptCd}
                                AND     S2.GCC_ORG_CD = SUBSTR(S1.STND_DPT_CD,9,7)
                                AND ROWNUM = 1
                                )  
                            ,F_USR_INFO_BY_ID(#{hndlChgrId},'2')
                            ,''
                            ,'02-2011-2191'
                            ,'1040000'
                            ,'1040000'
                            ,'1140100'
                            ,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
                            ,'1'
                            ,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
                            ,'N'
                FROM    TBCSPDCP101M
                WHERE   REQ_DVSN_CD = #{reqDvsnCd}
                AND     ACP_YR = #{acpYr}
                AND     CVPT_ACP_NO = #{cvptAcpNo}
        ]]>
    </insert>
    
   <!-- 배부 시 SMS 내용애 부서 전화번호 추가 --> 
    	
    <select id="CSPDCP311QSelectHpn" parameterType="paramMap"   resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP311QSelectHpn */
        <![CDATA[
            SELECT  D1.HPN
            ,(SELECT CASE WHEN S1.CD ='0L0100' THEN '국민제안감사2국1과'
                          WHEN S1.CD ='0L0200' THEN '국민제안감사2국2과'
                          WHEN S1.CD ='0L0205' THEN '국민제안감사2국2과 수원센터'
                          WHEN S1.CD ='0L0300' THEN '국민제안감사2국3과'
                          WHEN S1.CD ='0L0315' THEN '국민제안감사2국3과 부산센터'
                          WHEN S1.CD ='0L0325' THEN '국민제안감사2국3과 대구센터'
                          WHEN S1.CD ='0L0335' THEN '국민제안감사2국3과 광주센터'
                          ELSE S1.CD_NM
                          END
			    FROM TBDCMACM013C S1
			   WHERE S1.CMM_CD_DVSN_CD = '1000144'
			     AND S1.CD = #{ralBltDivCd} 
            ) AS DPT_NM
            , (SELECT USR_DFN_TXT_1
		     FROM TBDCMACM013C S1
		     WHERE S1.CMM_CD_DVSN_CD = '1000144'
		     AND S1.CD = #{ralBltDivCd} 
		    ) AS DPT_TEL
            FROM    TBCSPDCP101M D1
            WHERE   D1.REQ_DVSN_CD = #{reqDvsnCd}
            AND     D1.ACP_YR = #{acpYr}
            AND     D1.CVPT_ACP_NO = #{cvptAcpNo}
        ]]>
    </select>
    
    
    <insert id="CSPDCP311EMsgInsert" parameterType="paramMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP111Mapper.CSPDCP111EMsgInsert */
        <![CDATA[
            INSERT INTO MSG_DATA
                    (   MSG_SEQ
                        , CUR_STATE
                        , REQ_DATE
                        , CALL_TO
                        , CALL_FROM
                        , SMS_TXT
                        , MSG_TYPE
                        , CONT_SEQ
                        , USERDATA
                    )
            VALUES (    MSG_DATA_SEQ.NEXTVAL
                        , 0
                        , SYSDATE
                        , REPLACE(#{hpn},'-','')
                        , NVL((	SELECT S1.USR_DFN_TXT_1
   						FROM 	TBDCMACM013C S1
   						WHERE S1.CMM_CD_DVSN_CD = '1000144'
   						AND   S1.CD = #{ralBltDivCd}
   						) ,'02-2011-2191') 
                        , ''
                        , 6
                        , #{contSeq}
                        , #{reqDvsnCd}||#{acpYr}||#{cvptAcpNo}
                    )
        ]]>
    </insert>
    
    <!-- BEST20 감사제보 메인정보 조회 -->
    <select id="CSPDCP311EMainInfo" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP311Mapper.CSPDCP311EMainInfo */
        <![CDATA[
            SELECT  CVPT_HNDL_STA_CD    /*진행상태*/
                   ,  RM_ACP_KND_CD /* 실민원접수구분 */
                   ,  RM_CVPT_ACP_NO  /* 실민원접수번호 */
            FROM    TBCSPDCP101M
            WHERE   REQ_DVSN_CD = #{reqDvsnCd}
            AND     ACP_YR = #{acpYr}
            AND     CVPT_ACP_NO = #{cvptAcpNo}
        ]]>

    </select>
    
    <!-- BEST20 2020.09.25 실민원접수구분 조회  -->
    <select id="selectRmAcpKndCd" parameterType="paramMap" resultType="String">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP111Mapper.selectRmAcpKndCd */
        <![CDATA[
             SELECT USR_DFN_TXT_1 AS RM_ACP_KND_CD
              FROM TBDCMACM013C
             WHERE 1 = 1
                AND CMM_CD_DVSN_CD     = '1000599'
                AND CD = #{cvptKndDvsnCd}
                AND USE_YN ='Y'
        ]]>
    </select>
    
    <!-- BEST20 2020.09.25 실민원접수번호 채번  -->
    <select id="selectRmCvptAcpNo" parameterType="paramMap" resultType="String">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP111Mapper.selectRmCvptAcpNo */
        <![CDATA[
            SELECT F_GET_RM_CVPT_ACP_NO(#{acpYr},#{rmAcpKndCd}) AS RM_CVPT_ACP_NO
             FROM DUAL
        ]]>
    </select>
    
    <!-- BEST20 이전 실민원접수번호 조회  -->
    <select id="selectPreRmCvptAcpNo" parameterType="paramMap" resultType="String">
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP111Mapper.selectPreRmCvptAcpNo */
        <![CDATA[
            SELECT A.PRE_RM_CVPT_ACP_NO 
             FROM TBCSPDCP101M A
            WHERE A.REQ_DVSN_CD = #{reqDvsnCd}
               AND A.ACP_YR = #{acpYr}
               AND A.CVPT_ACP_NO   = #{cvptAcpNo}
        ]]>
    </select>
    
    <!-- BEST20 실민원접수번호 채번테이블 업데이트  -->
    <update id="updateRmCvptAcpNoSeq" parameterType="paramMap" >
        /* kr.go.bai.eip.csp.dcp.dao.CSPDCP111Mapper.updateRmCvptAcpNoSeq */
                    MERGE INTO TBCSPDCP108M T1
                 USING DUAL
                    ON (    T1.ACP_YR = #{acpYr}
                        AND T1.RM_ACP_KND_CD = #{rmAcpKndCd}
                       )
                  WHEN MATCHED THEN
            UPDATE SET T1.RM_CVPT_ACP_NO = #{rmCvptAcpNo}
                      ,T1.FNL_USR_ID       = #{fnlUsrId}
                      ,T1.FNL_DEAL_DPT_CD  = #{fnlDealDptCd}
                      ,T1.FNL_MNU_ID       = #{fnlMnuId}
                      ,T1.FNL_MDF_DH       = SYSDATE
             WHEN NOT MATCHED THEN   
                INSERT( 
                      ACP_YR
                     ,RM_ACP_KND_CD
                     ,RM_CVPT_ACP_NO
                     ,FRT_USR_ID
                     ,FNL_USR_ID
                     ,FNL_DEAL_DPT_CD
                     ,FNL_MNU_ID
                     ,FRT_REGI_DH
                     ,FNL_MDF_DH
                ) VALUES ( 
                      #{acpYr}
                     ,#{rmAcpKndCd}
                     ,#{rmCvptAcpNo}
                     ,#{fnlUsrId}
                     ,#{fnlUsrId}
                     ,#{fnlDealDptCd}
                     ,#{fnlMnuId}
                     ,SYSDATE
                     ,SYSDATE
                ) 
    </update>
    
</mapper>
