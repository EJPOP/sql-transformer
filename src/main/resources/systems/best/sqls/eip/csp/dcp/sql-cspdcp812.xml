<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper">

 	<resultMap type="java.util.HashMap" id="CSPDCP812EMainSelect">
			<result property="sttmDvsnCd" 			 column="STTM_DVSN_CD" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="acpYr" 						 column="ACP_YR" 						     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="sttmAcpNo" 			 column="STTM_ACP_NO" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="acpNo" 			 column="ACP_NO" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="hmpAplNo" 				 column="HMP_APL_NO" 				     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="sttmKndCd" 			 column="STTM_KND_CD" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="sttmKndDtlCd" 	 column="STTM_KND_DTL_CD" 	     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="sttmKndDtlNm" 	 column="STTM_KND_DTL_NM" 	     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="nam" 							 column="NAM" 							     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="ein" 							 column="EIN" 							     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="jbNm" 						 column="JB_NM" 						     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="ad" 								 column="AD" 								     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="tnb" 							 column="TNB" 							     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="emlAd" 						 column="EML_AD" 						     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="titNm" 						 column="TIT_NM" 						     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="docId" 						 column="DOC_ID" 						     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="sttmExcuTxt" 		 column="STTM_EXCU_TXT" 		     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="sttmTxtDh" 			 column="STTM_TXT_DH" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="sttmPlcNm" 			 column="STTM_PLC_NM" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="sttmTxt" 					 column="STTM_TXT" 					     jdbcType="CLOB" javaType="java.lang.String" />
			<result property="rtrnWayTxt" 			 column="RTRN_WAY_TXT" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="rmkTxt" 					 column="RMK_TXT" 					     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="otrOrgNm" 				 column="OTR_ORG_NM" 				     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="inspcAgrYn" 			 column="INSPC_AGR_YN" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="otrInspcAgrYn" 	 column="OTR_INSPC_AGR_YN" 	     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="acpDh" 						 column="ACP_DH" 						     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="acpRutCd" 				 column="ACP_RUT_CD" 				     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="hndlStaCd" 			 column="HNDL_STA_CD" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="hndlStaNm" 			 column="HNDL_STA_NM" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="hndlDh" 					 column="HNDL_DH" 					     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="ansTxt" 					 column="ANS_TXT" 					     jdbcType="CLOB" javaType="java.lang.String" />
			<result property="frtRegiDh" 			 column="FRT_REGI_DH" 			     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="resNam" 					 column="RES_NAM" 					     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="resTnb" 					 column="RES_TNB" 					     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="resJbNm" 				 column="RES_JB_NM" 				     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="resAd" 						 column="RES_AD" 						     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="crpNm" 						 column="CRP_NM" 						     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="frtUsrId" 				 column="FRT_USR_ID" 				     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="rmSttmAcpNo" 				 column="RM_STTM_ACP_NO" 				     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="acpDptCd" 				 column="ACP_DPT_CD" 				     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="acpDptNm" 				 column="ACP_DPT_NM" 				     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="acpPenCnb" 				 column="ACP_PEN_CNB" 				     jdbcType="VARCHAR" javaType="java.lang.String" />
			<result property="acpPenNam" 				 column="ACP_PEN_NAM" 				     jdbcType="VARCHAR" javaType="java.lang.String" />

	</resultMap>
 	<select id="CSPDCP812EMainSelect" parameterType="paramMap" resultMap="CSPDCP812EMainSelect">
 	/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812EMainSelect */
		<![CDATA[
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
					,T1.STTM_ACP_NO
					,DECODE(T1.RM_STTM_ACP_NO,NULL,NULL,T1.ACP_YR||'-'||'청금-'||T1.RM_STTM_ACP_NO) AS ACP_NO
					,T1.HMP_APL_NO
					,T1.STTM_KND_CD
					,T1.STTM_KND_DTL_CD
					,F_CODE_NM('1000759',T1.STTM_KND_DTL_CD) AS STTM_KND_DTL_NM
					,T1.NAM
					,T1.EIN
					,T1.JB_NM
					,T1.AD
					,T1.TNB
					,T1.EML_AD
					,T1.TIT_NM
					,T1.DOC_ID
					,T1.STTM_EXCU_TXT
					,T1.STTM_TXT_DH
					,T1.STTM_PLC_NM
					,T1.STTM_TXT
					,T1.RTRN_WAY_TXT
					,T1.RMK_TXT
					,T1.OTR_ORG_NM
					,T1.INSPC_AGR_YN
					,T1.OTR_INSPC_AGR_YN
					,TO_CHAR(T1.ACP_DH,'YYYY.MM.DD HH24:MI') AS ACP_DH
					,T1.ACP_RUT_CD
					,T1.HNDL_STA_CD
					,F_CODE_NM('1000760',T1.HNDL_STA_CD) AS HNDL_STA_NM
					,T1.HNDL_DH
					,T1.ANS_TXT
					,T1.FRT_REGI_DH
					,T2.RES_NAM
					,T2.RES_TNB
					,T2.RES_JB_NM
					,T2.RES_AD
					,T2.CRP_NM
					,T1.FRT_USR_ID
					,T1.RM_STTM_ACP_NO
					,T1.ACP_DPT_CD
					,F_DPT_INFO(ACP_DPT_CD,'1') AS ACP_DPT_NM
					,T1.ACP_PEN_CNB
					,F_USR_INFO(T1.ACP_PEN_CNB,'2') AS ACP_PEN_NAM
			FROM	TBCSPDCP811M T1
					,TBCSPDCP812M T2
			WHERE	T1.STTM_DVSN_CD = T2.STTM_DVSN_CD
			AND		T1.ACP_YR = T2.ACP_YR
			AND		T1.STTM_ACP_NO = T2.STTM_ACP_NO
			AND		T1.STTM_DVSN_CD = '1'
			AND		T1.ACP_YR = #{acpYr}
		]]>
		<if test='rmSttmAcpNo == null or rmSttmAcpNo == ""'>
				AND	T1.STTM_ACP_NO = #{sttmAcpNo}
			</if>
		<if test='rmSttmAcpNo != null and rmSttmAcpNo != ""'>
				AND	T1.RM_STTM_ACP_NO = #{rmSttmAcpNo}
			</if>
	</select>

	<select id="CSPDCP812ERM_STTM_ACP_NOSelect" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812ERM_STTM_ACP_NOSelect */
 		<![CDATA[
 			SELECT	TO_CHAR(NVL(MAX(TO_NUMBER(RM_STTM_ACP_NO)),0)+1) AS RM_STTM_ACP_NO
			FROM	TBCSPDCP811M
			WHERE	STTM_DVSN_CD = #{sttmDvsnCd}
			AND		ACP_YR = #{acpYr}
 		]]>
 	</select>

 	<update id="CSPDCP812E811MUpdate" parameterType="paramMap">
 		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812E811MUpdate */
 		<![CDATA[
 			UPDATE 	TBCSPDCP811M
			SET		STTM_KND_CD = #{sttmKndCd}
					,STTM_KND_DTL_CD = #{sttmKndDtlCd}
					,NAM = #{nam}
					,EIN = #{ein}
					,JB_NM = #{jbNm}
					,AD = #{ad}
					,TNB = #{tnb}
					,EML_AD = #{emlAd}
					,TIT_NM = #{titNm}
					,STTM_EXCU_TXT = #{sttmExcuTxt}
					,STTM_TXT_DH = #{sttmTxtDh}
					,STTM_PLC_NM = #{sttmPlcNm}
					,RTRN_WAY_TXT = #{rtrnWayTxt}
					,RMK_TXT = #{rmkTxt}
					,OTR_ORG_NM = #{otrOrgNm}
					,INSPC_AGR_YN = #{inspcAgrYn}
					,OTR_INSPC_AGR_YN = #{otrInspcAgrYn}
					,HNDL_STA_CD = CASE WHEN HNDL_STA_CD ='1' THEN '2' ELSE HNDL_STA_CD END
					,ACP_DH = CASE WHEN HNDL_STA_CD ='1' THEN TO_TIMESTAMP(SYSDATE) ELSE TO_TIMESTAMP(ACP_DH) END
					,ACP_RUT_CD = #{acpRutCd}
					,ACP_DPT_CD = CASE WHEN HNDL_STA_CD ='1' THEN #{fnlDealDptCd} ELSE ACP_DPT_CD END
					,ACP_PEN_CNB = CASE WHEN HNDL_STA_CD ='1' THEN  F_USR_INFO_BY_ID(#{fnlUsrId},'1') ELSE ACP_PEN_CNB END
					,RM_STTM_ACP_NO = #{rmSttmAcpNo}
					,FNL_USR_ID = #{fnlUsrId}
   					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
   					,FNL_MNU_ID = #{fnlMnuId}
   					,FNL_MDF_DH=SYSDATE
			WHERE	STTM_DVSN_CD = #{sttmDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		STTM_ACP_NO = #{sttmAcpNo}
 		]]>
 	</update>

 	<update id="CSPDCP812E811MSTT_TXTUpdate" parameterType="paramMap">
 		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812E811MSTT_TXTUpdate */
 		<![CDATA[
 			UPDATE 	TBCSPDCP811M
			SET		STTM_TXT = #{sttmTxt}
			WHERE	STTM_DVSN_CD = #{sttmDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		STTM_ACP_NO = #{sttmAcpNo}
 		]]>
 	</update>


 	<update id="CSPDCP812E812MUpdate" parameterType="paramMap">
 		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812E812MUpdate */
 		<![CDATA[
 			UPDATE 	TBCSPDCP812M
			SET		RES_NAM = #{resNam}
					,RES_TNB = #{resTnb}
					,RES_JB_NM = #{resJbNm}
					,RES_AD = #{resAd}
					,CRP_NM = #{crpNm}
			WHERE	STTM_DVSN_CD = #{sttmDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		STTM_ACP_NO = #{sttmAcpNo}
 		]]>
 	</update>

 	<update id="CSPDCP812EMmsMsgInsert" parameterType="paramMap">
 		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812EMmsMsgInsert */
		<![CDATA[
			INSERT INTO MMS_CONTENTS_INFO
				 	(	CONT_SEQ
				 		, FILE_CNT
				 		, MMS_BODY
				 		, MMS_SUBJECT
				 	)
			VALUES (	#{contSeq}
						, 1
						, #{smsTxt}||'접수번호 : '||(	SELECT	ACP_YR||'-청금-'||RM_STTM_ACP_NO
													FROM	TBCSPDCP811M
													WHERE	STTM_DVSN_CD = #{sttmDvsnCd}
													AND		ACP_YR = #{acpYr}
													AND		STTM_ACP_NO = #{sttmAcpNo})
						, '감사원 청탁금지법 위반 신고 문자통보'
					)
		]]>
	</update>

	<update id="CSPDCP812EMmsMsgInsert2" parameterType ="paramMap">
			INSERT INTO MMS_CONTENTS_INFO
				 	(	CONT_SEQ
				 		, FILE_CNT
				 		, MMS_BODY
				 		, MMS_SUBJECT
				 	)
			VALUES (	#CONT_SEQ#
						, 1
						, #SMS_TXT#
						, '감사원 청탁금지법 위반 신고 문자통보'
					)
	</update>

	<insert id="CSPDCP812EMsgInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812EMsgInsert */
		<![CDATA[
			INSERT INTO MSG_DATA
				 	(	MSG_SEQ
				 		, CUR_STATE
				 		, REQ_DATE
				 		, CALL_TO
				 		, CALL_FROM
				 		, SMS_TXT
				 		, MSG_TYPE
				 		, CONT_SEQ
				 	)
			VALUES (	MSG_DATA_SEQ.NEXTVAL
						, 0
						, SYSDATE
						, REPLACE(#{hpn},'-','')
						, '0220112191'
						, ''
						, 6
						, #{contSeq}
					)
		]]>
	</insert>

	<select id="CSPDCP812EKeySelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812EKeySelect */
        <![CDATA[
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(STTM_ACP_NO)),0)+1) AS STTM_ACP_NO
				  FROM TBCSPDCP811M
				 WHERE 1=1
			       AND STTM_DVSN_CD = #{sttmDvsnCd}
			       AND ACP_YR = #{acpYr}
		]]>
	</select>

	<insert id="CSPDCP812E811MInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812E811MInsert */
		<![CDATA[
			INSERT INTO	TBCSPDCP811M
					(	STTM_DVSN_CD
						,ACP_YR
						,STTM_ACP_NO
						,STTM_KND_CD
						,STTM_KND_DTL_CD
						,NAM
						,EIN
						,JB_NM
						,AD
						,TNB
						,EML_AD
						,TIT_NM
						,DOC_ID
						,STTM_EXCU_TXT
						,STTM_TXT_DH
						,STTM_PLC_NM
						,STTM_TXT
						,RTRN_WAY_TXT
						,RMK_TXT
						,OTR_ORG_NM
						,INSPC_AGR_YN
						,OTR_INSPC_AGR_YN
						,ACP_DH
						,ACP_RUT_CD
						,HNDL_STA_CD
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
						,ACP_DPT_CD
						,ACP_PEN_CNB
						,RM_STTM_ACP_NO
					)
				VALUES	(	#{sttmDvsnCd}
							,#{acpYr}
							,#{sttmAcpNo}
							,#{sttmKndCd}
							,#{sttmKndDtlCd}
							,#{nam}
							,#{ein}
							,#{jbNm}
							,#{ad}
							,#{tnb}
							,#{emlAd}
							,#{titNm}
							,#{docId}
							,#{sttmExcuTxt}
							,#{sttmTxtDh}
							,#{sttmPlcNm}
							,#{sttmTxt}
							,#{rtrnWayTxt}
							,#{rmkTxt}
							,#{otrOrgNm}
							,#{inspcAgrYn}
							,#{otrInspcAgrYn}
							,SYSDATE
							,#{acpRutCd}	/*접수경로*/
							,'2'
							,#{frtUsrId}
							,#{fnlUsrId}
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
							,#{acpDptCd}
							,#{acpPenCnb}
							,#{rmSttmAcpNo}
						)
		]]>
	</insert>

	<insert id="CSPDCP812E812MInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812E812MInsert */
		<![CDATA[
			INSERT INTO	TBCSPDCP812M
					(	STTM_DVSN_CD
						,ACP_YR
						,STTM_ACP_NO
						,SRNO
						,RES_NAM
						,RES_TNB
						,RES_JB_NM
						,RES_AD
						,CRP_NM
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
					)
				VALUES	(	#{sttmDvsnCd}
							,#{acpYr}
							,#{sttmAcpNo}
							,1
							,#{resNam}
							,#{resTnb}
							,#{resJbNm}
							,#{resAd}
							,#{crpNm}
							,#{frtUsrId}
							,#{fnlUsrId}
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
						)
		]]>
	</insert>

	<insert id="CSPDCP812E814HInsert" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP812Mapper.CSPDCP812E814HInsert */
		<![CDATA[
			INSERT INTO	TBCSPDCP814H
					(	STTM_DVSN_CD
						,ACP_YR
						,STTM_ACP_NO
						,SRNO
						,DTB_DPT_CD
						,DTB_PEN_ID
						,PET_TXT
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
					)
				VALUES	(	#{sttmDvsnCd}
							,#{acpYr}
							,#{sttmAcpNo}
							,(	SELECT	NVL(MAX(SRNO),0)+1
								FROM	TBCSPDCP814H
								WHERE	STTM_DVSN_CD = #{sttmDvsnCd}
								AND		ACP_YR = #{acpYr}
								AND		STTM_ACP_NO = #{sttmAcpNo}
							)
							,#{fnlDealDptCd}
							,#{fnlUsrId}
							,#{petTxt}
							,#{fnlUsrId}
							,#{fnlUsrId}
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
						)
		]]>
	</insert>
</mapper>
