<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.csp.dcp.dao.CSPDCP517Mapper">
	
	
	<resultMap type="java.util.HashMap" id="CSPDCP517">
 		<result property="reqDvsnCd" column="REQ_DVSN_CD"                   jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="acpYr" column="ACP_YR"                             jdbcType="VARCHAR"  javaType="java.lang.String" /> 
		<result property="cvptAcpNo" column="CVPT_ACP_NO"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="acpNo" column="ACP_NO"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="acpDt" column="ACP_DT"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptrNm" column="CVPTR_NM"             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="reqrKndNm" column="REQR_KND_NM"                         jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="ad" column="AD"                                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="tnb" column="TNB"                           jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="titNm" column="TIT_NM"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptDocDvsnCd" column="CVPT_DOC_DVSN_CD"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptDocDvsnCd2" column="CVPT_DOC_DVSN_CD2"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptDocDvsnCd3" column="CVPT_DOC_DVSN_CD3"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptDocDvsnCd4" column="CVPT_DOC_DVSN_CD4"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="orgNm" column="ORG_NM"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="coptSgNm" column="COPT_SG_NM"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="dge" column="DGE"                                 jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptDocTxt" column="CVPT_DOC_TXT"                         jdbcType="CLOB"      javaType="java.lang.String" />
		<result property="cvptDocTxt2" column="CVPT_DOC_TXT2"                         jdbcType="CLOB"      javaType="java.lang.String" />
		<result property="cvptDocTxt3" column="CVPT_DOC_TXT3"                         jdbcType="CLOB"      javaType="java.lang.String" />
		<result property="cvptDocTxt4" column="CVPT_DOC_TXT4"                         jdbcType="CLOB"      javaType="java.lang.String" />
		<result property="cvptOpmApvHndlStaCd" column="CVPT_OPM_APV_HNDL_STA_CD"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="opmTxt" column="OPM_TXT"                         jdbcType="CLOB"      javaType="java.lang.String" />
		<result property="cvptOpmSrno" column="CVPT_OPM_SRNO"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="flRutNm" column="FL_RUT_NM"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="sysFlNm" column="SYS_FL_NM"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="title" column="TITLE"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
		<result property="rsltRprtHndlRsltCd" column="RSLT_RPRT_HNDL_RSLT_CD"                         jdbcType="VARCHAR"      javaType="java.lang.String" />
 	</resultMap>
 	
	<select id="CSPDCP517PMainSelect" parameterType="paramMap"
		resultMap="CSPDCP517">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP517Mapper.CSPDCP517PMainSelect */
        <![CDATA[     	
			SELECT	A.REQ_DVSN_CD
					, A.ACP_YR
					, A.CVPT_ACP_NO
					, A.ACP_YR||'-'|| F_CODE_NM('1000949', C.RM_ACP_KND_CD) ||'-'||C.RM_CVPT_ACP_NO AS ACP_NO
					, TO_CHAR(C.ACP_DH,'YYYY.MM.DD') AS ACP_DT
					, DECODE(C.REQR_KND_CD,'1',C.CVPTR_NM,'2',C.RPST_PEN_NM,'3',C.RPST_PEN_NM,'4',C.CVPTR_NM) AS CVPTR_NM
					, DECODE(C.REQR_KND_CD,'2','(기업)','') AS REQR_KND_NM
					, DECODE(C.ZCD,NULL,'','(우)'||C.ZCD||' '||C.AD||' '||C.DTL_AD) AS AD
   					, DECODE(C.TNB,NULL,C.HPN,C.TNB) AS TNB
   					, C.TIT_NM
   					, 'B1' AS CVPT_DOC_DVSN_CD
   					, 'B2' AS CVPT_DOC_DVSN_CD2
   					, 'B3' AS CVPT_DOC_DVSN_CD3
   					, 'B4' AS CVPT_DOC_DVSN_CD4
   					, Z.ORG_NM
   					, Z.COPT_SG_NM
   					, #{dge} AS DGE
   					, CASE WHEN ( 	SELECT 	COUNT(1)
   									FROM	TBCSPDCP203M S1
   									WHERE	1=1
   									AND 	S1.CVPT_DOC_DVSN_CD = 'B1'
				                    AND 	S1.ACP_YR = A.ACP_YR
				                    AND 	S1.REQ_DVSN_CD = A.REQ_DVSN_CD
				                    AND		S1.DGE = #{dge}
				                    AND		S1.CVPT_ACP_NO = A.CVPT_ACP_NO ) = 0
						THEN	( SELECT S2.CVPT_DOC_TXT
                                    FROM TBCSPDCP203M S2
                                   WHERE 1=1
                                     AND S2.CVPT_DOC_DVSN_CD = 'A1'
                                     AND S2.ACP_YR = A.ACP_YR
                                     AND S2.REQ_DVSN_CD = A.REQ_DVSN_CD
                                     AND S2.CVPT_ACP_NO = A.CVPT_ACP_NO) 
						ELSE	(	SELECT 	D1.CVPT_DOC_TXT
			   						FROM	TBCSPDCP203M D1
			   						WHERE	A.REQ_DVSN_CD = D1.REQ_DVSN_CD
									AND		A.ACP_YR = D1.ACP_YR
									AND		A.CVPT_ACP_NO = D1.CVPT_ACP_NO 
									AND		D1.CVPT_DOC_DVSN_CD = 'B1'
									AND		D1.DGE = #{dge}) END AS CVPT_DOC_TXT
					, (	SELECT 	D1.CVPT_DOC_TXT
   						FROM	TBCSPDCP203M D1
   						WHERE	A.REQ_DVSN_CD = D1.REQ_DVSN_CD
						AND		A.ACP_YR = D1.ACP_YR
						AND		A.CVPT_ACP_NO = D1.CVPT_ACP_NO 
						AND		D1.CVPT_DOC_DVSN_CD = 'B2'
						AND		D1.DGE = #{dge}) AS CVPT_DOC_TXT2
					, (	SELECT 	D1.CVPT_DOC_TXT
   						FROM	TBCSPDCP203M D1
   						WHERE	A.REQ_DVSN_CD = D1.REQ_DVSN_CD
						AND		A.ACP_YR = D1.ACP_YR
						AND		A.CVPT_ACP_NO = D1.CVPT_ACP_NO 
						AND		D1.CVPT_DOC_DVSN_CD = 'B3'
						AND		D1.DGE = #{dge}) AS CVPT_DOC_TXT3
					, (	SELECT 	D1.CVPT_DOC_TXT
   						FROM	TBCSPDCP203M D1
   						WHERE	A.REQ_DVSN_CD = D1.REQ_DVSN_CD
						AND		A.ACP_YR = D1.ACP_YR
						AND		A.CVPT_ACP_NO = D1.CVPT_ACP_NO 
						AND		D1.CVPT_DOC_DVSN_CD = 'B4'
						AND		D1.DGE = #{dge}) AS CVPT_DOC_TXT4
					, D.CVPT_OPM_APV_HNDL_STA_CD
					, E.OPM_TXT
					, D.CVPT_OPM_SRNO
					, F.FL_RUT_NM
					, F.SYS_FL_NM
					, F_CODE_NM('1000370','E')||' (제'||C.ACP_YR||'-'|| F_CODE_NM('1000949', C.RM_ACP_KND_CD) ||'-'||C.RM_CVPT_ACP_NO||'호) 보고' AS TITLE
					,H.RSLT_RPRT_HNDL_RSLT_CD
			FROM	TBCSPDCP201M A
					, TBCSPDCP101M C
					,(	SELECT	Z.REQ_DVSN_CD, Z.ACP_YR, Z.CVPT_ACP_NO
								,CASE WHEN Z.OGN_ORG_DVSN_CD = '10' THEN F_ORG_INFO(ORG_CD,'1') 
								ELSE Z.ORG_NM END AS ORG_NM
								, CASE WHEN Z.OGN_ORG_DVSN_CD = '10' THEN F_ORG_HRK_NM(COPT_SG_CD)
								ELSE NULL END AS COPT_SG_NM
   						FROM	TBCSPDCP206L Z
   						WHERE	Z.REQ_DVSN_CD = #{reqDvsnCd}
   						AND		Z.ACP_YR = #{acpYr}
   						AND		Z.CVPT_ACP_NO = #{cvptAcpNo}
   						AND		Z.ORG_HIS_DVSN_CD ='1'
   						AND		Z.HNDL_ORG_SRNO = (SELECT	MIN(S1.HNDL_ORG_SRNO)
   													FROM	TBCSPDCP206L S1
   													WHERE	S1.REQ_DVSN_CD = #{reqDvsnCd}
							   						AND		S1.ACP_YR = #{acpYr}
							   						AND		S1.CVPT_ACP_NO = #{cvptAcpNo}
							   						AND		S1.ORG_HIS_DVSN_CD ='1'
							   						)
   					) Z
   					, TBCSPDCP301M D
   					, TBCSPDCP302M E
   					, TBDCMACM103L F
   					, TBCSPDCP401H G
   					, TBCSPDCP402L H
			WHERE	1=1
			AND		A.REQ_DVSN_CD = #{reqDvsnCd}
			AND		A.ACP_YR = #{acpYr}
			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
			AND		A.ACP_YR = C.ACP_YR
			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
			AND		A.REQ_DVSN_CD = Z.REQ_DVSN_CD(+)
			AND		A.ACP_YR = Z.ACP_YR(+)
			AND		A.CVPT_ACP_NO = Z.CVPT_ACP_NO(+)
			AND		A.REQ_DVSN_CD = D.REQ_DVSN_CD(+)
			AND		A.ACP_YR = D.ACP_YR(+)
			AND		A.CVPT_ACP_NO = D.CVPT_ACP_NO(+)
			AND		D.REQ_DVSN_CD = E.REQ_DVSN_CD(+)
			AND		D.ACP_YR = E.ACP_YR(+)
			AND		D.CVPT_ACP_NO = E.CVPT_ACP_NO(+)
			AND		D.CVPT_OPM_SRNO = E.CVPT_OPM_SRNO(+)
			AND		D.CVPT_IFM_DVSN_CD(+) = 'E'
			AND		D.DGE(+) = #{dge}
			AND		D.ONR_DOC_MNG_CRD_ID = F.ONR_DOC_MNG_CRD_ID(+)
			AND	A.REQ_DVSN_CD = G.REQ_DVSN_CD
		   AND	A.ACP_YR = G.ACP_YR
		   AND	A.CVPT_ACP_NO = G.CVPT_ACP_NO
		   AND	G.REQ_DVSN_CD = H.REQ_DVSN_CD
		   AND	G.ACP_YR = H.ACP_YR
		   AND	G.CVPT_ACP_NO = H.CVPT_ACP_NO
		   AND G.DGE = H.DGE
		]]>
	</select>
	
	
	<insert id="CSPDCP517P203Merge" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP517Mapper.CSPDCP517P203Merge */
        <![CDATA[
        	MERGE INTO /*CSPDCP517P203Merge*/	TBCSPDCP203M A
        	USING 	(	SELECT 	#{reqDvsnCd} AS REQ_DVSN_CD 
        						,#{acpYr} AS ACP_YR
        						,#{cvptAcpNo} AS CVPT_ACP_NO
        						,#{cvptDocDvsnCd} AS CVPT_DOC_DVSN_CD
        						,#{dge} AS DGE
        				FROM DUAL
        			) B
        	ON		(	A.REQ_DVSN_CD = B.REQ_DVSN_CD
        				AND	A.ACP_YR = B.ACP_YR
        				AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
        				AND A.CVPT_DOC_DVSN_CD = B.CVPT_DOC_DVSN_CD
        				AND A.DGE = B.DGE
        			)
        	WHEN MATCHED THEN
        			UPDATE	
        			SET		CVPT_DOC_TXT = #{cvptDocTxt}
        					,FNL_USR_ID = #{fnlUsrId}
        					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
        					,FNL_MNU_ID = #{fnlMnuId}
        					,FNL_MDF_DH = SYSDATE
        	WHEN NOT MATCHED THEN
		        	INSERT 		(	REQ_DVSN_CD
		        					,ACP_YR
		        					,CVPT_ACP_NO
		        					,DOC_SRNO
		        					,CVPT_DOC_DVSN_CD
		        					,CVPT_DOC_TXT
		        					,DGE
		        					,FRT_USR_ID
		        					,FNL_USR_ID
		        					,FNL_DEAL_DPT_CD
		        					,FNL_MNU_ID
		        					,FRT_REGI_DH
		        					,FNL_MDF_DH
		        				)
		        		VALUES	(	#{reqDvsnCd}
									,#{acpYr}
									,#{cvptAcpNo}
									,(	SELECT	NVL(MAX(DOC_SRNO),0)+1
										FROM	TBCSPDCP203M
										WHERE	REQ_DVSN_CD = #{reqDvsnCd}
										AND		ACP_YR = #{acpYr}
										AND		CVPT_ACP_NO = #{cvptAcpNo}
									)
		        					,#{cvptDocDvsnCd}
		        					,#{cvptDocTxt}
		        					,#{dge}
									,#{frtUsrId}
									,#{fnlUsrId}
									,#{fnlDealDptCd}
									,#{fnlMnuId}
									,SYSDATE
									,SYSDATE
								)
        ]]>
	</insert>
	
	<insert id="CSPDCP517P203Merge2" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP517Mapper.CSPDCP517P203Merge2 */
        <![CDATA[
        	MERGE INTO /*CSPDCP517P203Merge2*/	TBCSPDCP203M A
        	USING 	(	SELECT 	#{reqDvsnCd} AS REQ_DVSN_CD 
        						,#{acpYr} AS ACP_YR
        						,#{cvptAcpNo} AS CVPT_ACP_NO
        						,#{cvptDocDvsnCd} AS CVPT_DOC_DVSN_CD
        						,#{dge} AS DGE
        				FROM DUAL
        			) B
        	ON		(	A.REQ_DVSN_CD = B.REQ_DVSN_CD
        				AND	A.ACP_YR = B.ACP_YR
        				AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
        				AND A.CVPT_DOC_DVSN_CD = B.CVPT_DOC_DVSN_CD
        				AND A.DGE = B.DGE
        			)
        	WHEN MATCHED THEN
        			UPDATE	
        			SET		CVPT_DOC_TXT = #{cvptDocTxt2}
        					,FNL_USR_ID = #{fnlUsrId}
        					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
        					,FNL_MNU_ID = #{fnlMnuId}
        					,FNL_MDF_DH = SYSDATE
        	WHEN NOT MATCHED THEN
		        	INSERT 		(	REQ_DVSN_CD
		        					,ACP_YR
		        					,CVPT_ACP_NO
		        					,DOC_SRNO
		        					,CVPT_DOC_DVSN_CD
		        					,CVPT_DOC_TXT
		        					,DGE
		        					,FRT_USR_ID
		        					,FNL_USR_ID
		        					,FNL_DEAL_DPT_CD
		        					,FNL_MNU_ID
		        					,FRT_REGI_DH
		        					,FNL_MDF_DH
		        				)
		        		VALUES	(	#{reqDvsnCd}
									,#{acpYr}
									,#{cvptAcpNo}
									,(	SELECT	NVL(MAX(DOC_SRNO),0)+1
										FROM	TBCSPDCP203M
										WHERE	REQ_DVSN_CD = #{reqDvsnCd}
										AND		ACP_YR = #{acpYr}
										AND		CVPT_ACP_NO = #{cvptAcpNo}
									)
		        					,#{cvptDocDvsnCd}
		        					,#{cvptDocTxt2}
		        					,#{dge}
									,#{frtUsrId}
									,#{fnlUsrId}
									,#{fnlDealDptCd}
									,#{fnlMnuId}
									,SYSDATE
									,SYSDATE
								)
        ]]>
	</insert>
	
	<insert id="CSPDCP517P203Merge3" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP517Mapper.CSPDCP517P203Merge3 */
        <![CDATA[
        	MERGE INTO /*CSPDCP517P203Merge3*/	TBCSPDCP203M A
        	USING 	(	SELECT 	#{reqDvsnCd} AS REQ_DVSN_CD 
        						,#{acpYr} AS ACP_YR
        						,#{cvptAcpNo} AS CVPT_ACP_NO
        						,#{cvptDocDvsnCd} AS CVPT_DOC_DVSN_CD
        						,#{dge} AS DGE
        				FROM DUAL
        			) B
        	ON		(	A.REQ_DVSN_CD = B.REQ_DVSN_CD
        				AND	A.ACP_YR = B.ACP_YR
        				AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
        				AND A.CVPT_DOC_DVSN_CD = B.CVPT_DOC_DVSN_CD
        				AND A.DGE = B.DGE
        			)
        	WHEN MATCHED THEN
        			UPDATE	
        			SET		CVPT_DOC_TXT = #{cvptDocTxt3}
        					,FNL_USR_ID = #{fnlUsrId}
        					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
        					,FNL_MNU_ID = #{fnlMnuId}
        					,FNL_MDF_DH = SYSDATE
        	WHEN NOT MATCHED THEN
		        	INSERT 		(	REQ_DVSN_CD
		        					,ACP_YR
		        					,CVPT_ACP_NO
		        					,DOC_SRNO
		        					,CVPT_DOC_DVSN_CD
		        					,CVPT_DOC_TXT
		        					,DGE
		        					,FRT_USR_ID
		        					,FNL_USR_ID
		        					,FNL_DEAL_DPT_CD
		        					,FNL_MNU_ID
		        					,FRT_REGI_DH
		        					,FNL_MDF_DH
		        				)
		        		VALUES	(	#{reqDvsnCd}
									,#{acpYr}
									,#{cvptAcpNo}
									,(	SELECT	NVL(MAX(DOC_SRNO),0)+1
										FROM	TBCSPDCP203M
										WHERE	REQ_DVSN_CD = #{reqDvsnCd}
										AND		ACP_YR = #{acpYr}
										AND		CVPT_ACP_NO = #{cvptAcpNo}
									)
		        					,#{cvptDocDvsnCd}
		        					,#{cvptDocTxt3}
		        					,#{dge}
									,#{frtUsrId}
									,#{fnlUsrId}
									,#{fnlDealDptCd}
									,#{fnlMnuId}
									,SYSDATE
									,SYSDATE
								)
        ]]>
	</insert>
	
	<insert id="CSPDCP517P203Merge4" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP517Mapper.CSPDCP517P203Merge4 */
        <![CDATA[
        	MERGE INTO /*CSPDCP517P203Merge4*/	TBCSPDCP203M A
        	USING 	(	SELECT 	#{reqDvsnCd} AS REQ_DVSN_CD 
        						,#{acpYr} AS ACP_YR
        						,#{cvptAcpNo} AS CVPT_ACP_NO
        						,#{cvptDocDvsnCd} AS CVPT_DOC_DVSN_CD
        						,#{dge} AS DGE
        				FROM DUAL
        			) B
        	ON		(	A.REQ_DVSN_CD = B.REQ_DVSN_CD
        				AND	A.ACP_YR = B.ACP_YR
        				AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
        				AND A.CVPT_DOC_DVSN_CD = B.CVPT_DOC_DVSN_CD
        				AND A.DGE = B.DGE
        			)
        	WHEN MATCHED THEN
        			UPDATE	
        			SET		CVPT_DOC_TXT = #{cvptDocTxt4}
        					,FNL_USR_ID = #{fnlUsrId}
        					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
        					,FNL_MNU_ID = #{fnlMnuId}
        					,FNL_MDF_DH = SYSDATE
        	WHEN NOT MATCHED THEN
		        	INSERT 		(	REQ_DVSN_CD
		        					,ACP_YR
		        					,CVPT_ACP_NO
		        					,DOC_SRNO
		        					,CVPT_DOC_DVSN_CD
		        					,CVPT_DOC_TXT
		        					,DGE
		        					,FRT_USR_ID
		        					,FNL_USR_ID
		        					,FNL_DEAL_DPT_CD
		        					,FNL_MNU_ID
		        					,FRT_REGI_DH
		        					,FNL_MDF_DH
		        				)
		        		VALUES	(	#{reqDvsnCd}
									,#{acpYr}
									,#{cvptAcpNo}
									,(	SELECT	NVL(MAX(DOC_SRNO),0)+1
										FROM	TBCSPDCP203M
										WHERE	REQ_DVSN_CD = #{reqDvsnCd}
										AND		ACP_YR = #{acpYr}
										AND		CVPT_ACP_NO = #{cvptAcpNo}
									)
		        					,#{cvptDocDvsnCd}
		        					,#{cvptDocTxt4}
		        					,#{dge}
									,#{frtUsrId}
									,#{fnlUsrId}
									,#{fnlDealDptCd}
									,#{fnlMnuId}
									,SYSDATE
									,SYSDATE
								)
        ]]>
	</insert>
	
	
	<!-- 처리전 온나라 결재시 시행문 테이블 Merge -->
	<insert id="CSPDCP517POnr301Merge" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP517Mapper.CSPDCP517POnr301Merge */
		<![CDATA[
			MERGE INTO /*CSPDCP517POnr301Merge*/	TBCSPDCP301M A
        	USING 	(	SELECT 	#{reqDvsnCd} AS REQ_DVSN_CD 
        						,#{acpYr} AS ACP_YR
        						,#{cvptAcpNo} AS CVPT_ACP_NO
        						,#{cvptOpmSrno} AS CVPT_OPM_SRNO
        						,#{dge} AS DGE
        				FROM DUAL
        			) B
        	ON		(	A.REQ_DVSN_CD = B.REQ_DVSN_CD
        				AND	A.ACP_YR = B.ACP_YR
        				AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
        				AND A.CVPT_OPM_SRNO = B.CVPT_OPM_SRNO
        				AND	A.DGE = B.DGE
        			)
        	WHEN MATCHED THEN
        			UPDATE	
        			SET		CVPT_OPM_APV_HNDL_STA_CD = '20'
        					,ADMN_INF_HNDL_NO = #{admnInfHndlNo}
        					,ONR_DOC_MNG_CRD_ID = #{onrDocMngCrdId}
        					,ONR_APV_RQS_DH = SYSDATE
        					,FNL_USR_ID = #{fnlUsrId}
        					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
        					,FNL_MNU_ID = #{fnlMnuId}
        					,FNL_MDF_DH = SYSDATE
        	WHEN NOT MATCHED THEN
				INSERT 	(	REQ_DVSN_CD
							,ACP_YR
							,CVPT_ACP_NO
							,CVPT_OPM_SRNO
							,DGE
							,CVPT_IFM_DVSN_CD
	       					,CVPT_OPM_APV_HNDL_STA_CD
	       					,ADMN_INF_HNDL_NO
	       					,ONR_DOC_MNG_CRD_ID
	       					,ONR_APV_RQS_DH
	       					,FRT_USR_ID
	       					,FNL_USR_ID
	       					,FNL_DEAL_DPT_CD
	       					,FNL_MNU_ID
	       					,FRT_REGI_DH
	       					,FNL_MDF_DH
	       				)
	       		VALUES	(	#{reqDvsnCd}
							,#{acpYr}
							,#{cvptAcpNo}
							,#{cvptOpmSrno}
							,#{dge}
							,'E'
	       					,'20'
	       					,#{admnInfHndlNo}
	       					,#{onrDocMngCrdId}
	       					,SYSDATE
	       					,#{frtUsrId}
	       					,#{fnlUsrId}
	       					,#{fnlDealDptCd}
	       					,#{fnlMnuId}
	       					,SYSDATE
	       					,SYSDATE
	       				)
		]]>
	</insert>
	
	<insert id="CSPDCP517POnr302Merge" parameterType="paramMap">
		/* kr.go.bai.eip.csp.dcp.dao.CSPDCP517Mapper.CSPDCP517POnr302Merge */
		<![CDATA[
			MERGE INTO 	TBCSPDCP302M A
        	USING 	(	SELECT 	#{reqDvsnCd} AS REQ_DVSN_CD 
        						,#{acpYr} AS ACP_YR
        						,#{cvptAcpNo} AS CVPT_ACP_NO
        						,#{cvptOpmSrno} AS CVPT_OPM_SRNO
        				FROM DUAL
        			) B
        	ON		(	A.REQ_DVSN_CD = B.REQ_DVSN_CD
        				AND	A.ACP_YR = B.ACP_YR
        				AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
        				AND A.CVPT_OPM_SRNO = B.CVPT_OPM_SRNO
        			)
        	WHEN MATCHED THEN
        			UPDATE	
        			SET		OPM_TXT = #{opmTxt}
        					,FNL_USR_ID = #{fnlUsrId}
        					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
        					,FNL_MNU_ID = #{fnlMnuId}
        					,FNL_MDF_DH = SYSDATE
        	WHEN NOT MATCHED THEN
				INSERT 	(	REQ_DVSN_CD
							,ACP_YR
							,CVPT_ACP_NO
							,CVPT_OPM_SRNO
	       					,OPM_TXT
	       					,FRT_USR_ID
	       					,FNL_USR_ID
	       					,FNL_DEAL_DPT_CD
	       					,FNL_MNU_ID
	       					,FRT_REGI_DH
	       					,FNL_MDF_DH
		       				)
		       		VALUES	(	#{reqDvsnCd}
								,#{acpYr}
								,#{cvptAcpNo}
								,#{cvptOpmSrno}
								,#{opmTxt}
		       					,#{frtUsrId}
		       					,#{fnlUsrId}
		       					,#{fnlDealDptCd}
		       					,#{fnlMnuId}
		       					,SYSDATE
		       					,SYSDATE
		       				)
		]]>
	</insert>
</mapper> 
