<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.bai.eip.faa.cav.dao.FAACAV018QMapper">
    
    <select id="selectLoadSttcList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.faa.cav.dao.FAACAV018QMapper.selectLoadSttcList */
        <![CDATA[
                SELECT AUD_YR
                	   ,CASE WHEN SUBSTR(ADD_MONTHS(#{proStadDt}, -1),0,4)-1 > AUD_YR  THEN 'N'
							WHEN AUD_YR IS NULL THEN 'N'
							ELSE 'Y'
						END																AS VIEW_YN
					   ,DECODE(ROWNUM, 1, '0' , 2, '1', 3, '2', 4, '3', 5, '4'
                					, 6, '0', 7, '1', 8, '2', 9, '3', 10, '4'
                					, 11, '0', 12, '1', 13, '2', 14, '3', 15, '4'
                					, 16, '0', 17, '1', 18, '2', 19, '3', 20, '4'
                					, 21, '0', 22, '1', 23, '2', 24, '3', 25, '4') AS ROW_KND_CD
                	   ,DECODE(ROWNUM, 1, (AUD_YR || '년 합계') , 2, '엄무상 횡령·배임', 3, '공문서 위조·변조와 동행사', 4, '증·수뢰', 5, '기타'
                					, 6, (AUD_YR || '년 합계'), 7, '엄무상 횡령·배임', 8, '공문서 위조·변조와 동행사', 9, '증·수뢰', 10, '기타'
                					, 11, (AUD_YR || '년 합계'), 12, '엄무상 횡령·배임', 13, '공문서 위조·변조와 동행사', 14, '증·수뢰', 15, '기타'
                					, 16, (AUD_YR || '년 합계'), 17, '엄무상 횡령·배임', 18, '공문서 위조·변조와 동행사', 19, '증·수뢰', 20, '기타'
                					, 21, (AUD_YR || '년 합계'), 22, '엄무상 횡령·배임', 23, '공문서 위조·변조와 동행사', 24, '증·수뢰', 25, '기타') AS STTC_TIT1 
                  	   ,DECODE(ROWNUM, 1, STTC_COL1, 2, '0', 3, '0', 4, '0', 5, '0'
                  	   				 , 6, STTC_COL1, 7, '0', 8, '0', 9, '0', 10, '0'
                  	   				 , 11, STTC_COL1, 12, '0', 13, '0', 14, '0', 15, '0'
                  	   				 , 16, STTC_COL1, 17, '0', 18, '0', 19, '0', 20, '0'
                  	   				 , 21, STTC_COL1, 22, '0', 23, '0', 24, '0', 25, '0') AS STTC_COL1
                  	   ,DECODE(ROWNUM, 1, STTC_COL2, 2, '0', 3, '0', 4, '0', 5, '0'
                  	   				 , 6, STTC_COL2, 7, '0', 8, '0', 9, '0', 10, '0'
                  	   				 , 11, STTC_COL2, 12, '0', 13, '0', 14, '0', 15, '0'
                  	   				 , 16, STTC_COL2, 17, '0', 18, '0', 19, '0', 20, '0'
                  	   				 , 21, STTC_COL2, 22, '0', 23, '0', 24, '0', 25, '0') AS STTC_COL2
                  	   ,DECODE(ROWNUM, 1, STTC_COL3, 2, '0', 3, '0', 4, '0', 5, '0'
                  	   				 , 6, STTC_COL3, 7, '0', 8, '0', 9, '0', 10, '0'
                  	   				 , 11, STTC_COL3, 12, '0', 13, '0', 14, '0', 15, '0'
                  	   				 , 16, STTC_COL3, 17, '0', 18, '0', 19, '0', 20, '0'
                  	   				 , 21, STTC_COL3, 22, '0', 23, '0', 24, '0', 25, '0') AS STTC_COL3
                  	   ,DECODE(ROWNUM, 1, STTC_COL4, 2, '0', 3, '0', 4, '0', 5, '0'
                  	   				 , 6, STTC_COL4, 7, '0', 8, '0', 9, '0', 10, '0'
                  	   				 , 11, STTC_COL4, 12, '0', 13, '0', 14, '0', 15, '0'
                  	   				 , 16, STTC_COL4, 17, '0', 18, '0', 19, '0', 20, '0'
                  	   				 , 21, STTC_COL4, 22, '0', 23, '0', 24, '0', 25, '0') AS STTC_COL4
                  	   ,DECODE(ROWNUM, 1, STTC_COL5, 2, '0', 3, '0', 4, '0', 5, '0'
                  	   				 , 6, STTC_COL5, 7, '0', 8, '0', 9, '0', 10, '0'
                  	   				 , 11, STTC_COL5, 12, '0', 13, '0', 14, '0', 15, '0'
                  	   				 , 16, STTC_COL5, 17, '0', 18, '0', 19, '0', 20, '0'
                  	   				 , 21, STTC_COL5, 22, '0', 23, '0', 24, '0', 25, '0') AS STTC_COL5
                  	   ,DECODE(ROWNUM, 1, STTC_COL6, 2, '0', 3, '0', 4, '0', 5, '0'
                  	   				 , 6, STTC_COL6, 7, '0', 8, '0', 9, '0', 10, '0'
                  	   				 , 11, STTC_COL6, 12, '0', 13, '0', 14, '0', 15, '0'
                  	   				 , 16, STTC_COL6, 17, '0', 18, '0', 19, '0', 20, '0'
                  	   				 , 21, STTC_COL6, 22, '0', 23, '0', 24, '0', 25, '0') AS STTC_COL6
                  	   ,DECODE(ROWNUM, 1, STTC_COL7, 2, '0', 3, '0', 4, '0', 5, '0'
                  	   				 , 6, STTC_COL7, 7, '0', 8, '0', 9, '0', 10, '0'
                  	   				 , 11, STTC_COL7, 12, '0', 13, '0', 14, '0', 15, '0'
                  	   				 , 16, STTC_COL7, 17, '0', 18, '0', 19, '0', 20, '0'
                  	   				 , 21, STTC_COL7, 22, '0', 23, '0', 24, '0', 25, '0') AS STTC_COL7
                  	   ,DECODE(ROWNUM, 1, STTC_COL8, 2, '0', 3, '0', 4, '0', 5, '0'
                  	   				 , 6, STTC_COL8, 7, '0', 8, '0', 9, '0', 10, '0'
                  	   				 , 11, STTC_COL8, 12, '0', 13, '0', 14, '0', 15, '0'
                  	   				 , 16, STTC_COL8, 17, '0', 18, '0', 19, '0', 20, '0'
                  	   				 , 21, STTC_COL8, 22, '0', 23, '0', 24, '0', 25, '0') AS STTC_COL8
                  FROM (
	                SELECT ENF_YR														AS AUD_YR
	                      ,COUNT(1)                                                     AS STTC_COL1
	                      ,SUM(NOP_CNT)                                                 AS STTC_COL2
	                      ,SUM(CASE WHEN ORG_DVSN_CD = '1' THEN 1       ELSE 0 END)     AS STTC_COL3
	                      ,SUM(CASE WHEN ORG_DVSN_CD = '1' THEN NOP_CNT ELSE 0 END)     AS STTC_COL4
	                      ,SUM(CASE WHEN ORG_DVSN_CD = '2' THEN 1       ELSE 0 END)     AS STTC_COL5
	                      ,SUM(CASE WHEN ORG_DVSN_CD = '2' THEN NOP_CNT ELSE 0 END)     AS STTC_COL6
	                      ,SUM(CASE WHEN ORG_DVSN_CD = '3' THEN 1       ELSE 0 END)     AS STTC_COL7
	                      ,SUM(CASE WHEN ORG_DVSN_CD = '3' THEN NOP_CNT ELSE 0 END)     AS STTC_COL8                  
	                 FROM (
	                        SELECT SUBSTR(DETAIL.ENF_DT, 0, 4)        AS ENF_YR
	                              ,CASE WHEN SUBSTR(MASTER.ORG_DVSN_CD, 1, 1) = '1' THEN '1'
	                                    WHEN SUBSTR(MASTER.ORG_DVSN_CD, 1, 1) = '2' THEN '2'
	                                    ELSE                                             '3' 
	                                END                               AS ORG_DVSN_CD
	                              ,NVL(DETAIL.NOP_CNT, 0)             AS NOP_CNT                                                                      
	                          FROM TBBADEAR001M MASTER
	                              ,TBBADEAR002D DETAIL
	                         WHERE MASTER.AUD_YR        = DETAIL.AUD_YR
	                           AND MASTER.AUD_NO        = DETAIL.AUD_NO
	                           AND MASTER.DSP_RQ_SNO    = DETAIL.DSP_RQ_SNO
	                           AND DETAIL.ENF_DT        BETWEEN TO_DATE(TO_CHAR(ADD_MONTHS(#{proStadDt}, -1), 'YYYY')||'-01-01') AND  LAST_DAY(ADD_MONTHS(#{proStadDt}, -1))
	                           AND MASTER.DSP_RQ_KND_CD IN ('710','720','730')
	                           AND DETAIL.DTM_STA_CD    != '0'                            
	                      )     
	                  GROUP BY ENF_YR
	                  ORDER BY ENF_YR DESC )
                  , (SELECT ROWNUM FROM DUAL CONNECT BY ROWNUM <= 5)
 UNION ALL
 			SELECT T2.AUD_YR
                  ,CASE WHEN SUBSTR(ADD_MONTHS(#{proStadDt}, -1),6,2) = '01' AND T2.AUD_YR = (SELECT TO_CHAR(MAX(T2.AUD_YR)-1) 
              																		FROM TWFAACAV200D T2
																					WHERE T2.STTC_CLSF_CD = '018' 
																					 AND T2.STTC_TYP_SEQ = (SELECT MAX(T3.STTC_TYP_SEQ) 
																												FROM TWFAACAV200M T3
																												WHERE T3.STTC_CLSF_CD = '018' 
																													AND T3.STTC_DTM_DY IS NOT NULL)) THEN 'N' 
	                    WHEN T1.STTC_YR > T2.AUD_YR THEN 'N' 	
	                    ELSE 'Y'
	                END VIEW_YN 
	              ,T2.ROW_KND_CD  		
                  ,T2.STTC_TIT1
                  ,T2.STTC_COL1
                  ,T2.STTC_COL2
                  ,T2.STTC_COL3
                  ,T2.STTC_COL4
                  ,T2.STTC_COL5
                  ,T2.STTC_COL6
                  ,T2.STTC_COL7
                  ,T2.STTC_COL8
              FROM TWFAACAV200M T1
             INNER JOIN TWFAACAV200D T2 ON (
                        T1.STTC_TYP_CD = T2.STTC_TYP_CD
                    AND T1.STTC_CLSF_CD = T2.STTC_CLSF_CD
                    AND T1.STTC_TYP_SEQ = T2.STTC_TYP_SEQ )
			 WHERE T1.STTC_CLSF_CD = '018'
				               AND T2.STTC_TYP_SEQ = (SELECT MAX(T3.STTC_TYP_SEQ) 
														FROM TWFAACAV200M T3
														WHERE T3.STTC_CLSF_CD = '018' 
															AND T3.STTC_DTM_DY IS NOT NULL)
							   AND T2.AUD_YR BETWEEN SUBSTR(ADD_MONTHS(#{proStadDt}, -49),0,4) AND SUBSTR(ADD_MONTHS(#{proStadDt},-13),0,4)		
        ]]>
    </select>
    
    <select id="selectComboList" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        /* kr.go.bai.eip.aep.arp.dao.FAACAV018QMapper.selectAffComboList */
            SELECT STTC_TYP_SEQ AS CD,
                   STTC_YR || '년 ' || STTC_STR_MON || '월' || DECODE(STTC_END_MON, '01', '', ' ~ ' || STTC_END_MON || '월') AS CD_NM
              FROM TWFAACAV200M 
             WHERE STTC_TYP_CD = '10'
               AND STTC_CLSF_CD = '018'
        ]]>
        <if test='mngDptYn != "Y"'>
               AND STTC_DTM_DY IS NOT NULL
        </if>
        <![CDATA[
        	ORDER BY STTC_TYP_SEQ DESC
        ]]>
    </select>
    
    <select id="selectSttcList" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        /* kr.go.bai.eip.aep.arp.dao.FAACAV018QMapper.selectSttcList */
            SELECT T1.RMK
                  ,T1.ADM_OPIN
                  ,TO_CHAR(T1.STTC_PROD_STAD_DY,'YYYY-MM-DD') AS STTC_PROD_STAD_DY
                  ,CASE WHEN T1.STTC_DTM_DY IS NULL THEN 'N'
                        ELSE 'Y'
                   END AS STTC_DTM_YN
                  ,T2.STTC_TYP_CD
                  ,T2.STTC_CLSF_CD
                  ,T2.STTC_TYP_SEQ
                  ,T2.STTC_DATA_SNO
                  ,T2.STTC_TIT1
                  ,T2.STTC_COL1
                  ,T2.STTC_COL2
                  ,T2.STTC_COL3
                  ,T2.STTC_COL4
                  ,T2.STTC_COL5
                  ,T2.STTC_COL6
                  ,T2.STTC_COL7
                  ,T2.STTC_COL8
                  ,CASE WHEN T1.STTC_YR - 1 > T2.AUD_YR THEN 'N'
                        ELSE 'Y'
                   END AS VIEW_YN
                  ,T2.AUD_YR
                  ,T2.ROW_KND_CD
                  ,NVL(TO_CHAR(T1.STTC_DTM_DY,'YYYY"-"MM"-"DD'),'미확정') AS STTC_DTM_DY
              FROM TWFAACAV200M T1
             INNER JOIN TWFAACAV200D T2 ON (
                        T1.STTC_TYP_CD = T2.STTC_TYP_CD
                    AND T1.STTC_CLSF_CD = T2.STTC_CLSF_CD
                    AND T1.STTC_TYP_SEQ = T2.STTC_TYP_SEQ )
             WHERE T1.STTC_CLSF_CD = '018'
               AND T1.STTC_TYP_SEQ = #{sttcTypSeq}
             ORDER BY STTC_DATA_SNO
        ]]>
    </select>
    
    <insert id="insertMaster">
        /* kr.go.bai.eip.faa.cav.dao.FAACAV018QMapper.insertMaster */
        <![CDATA[
            INSERT INTO TWFAACAV200M (
                 STTC_TYP_CD
                ,STTC_CLSF_CD
                ,STTC_TYP_SEQ
                ,STTC_YR
                ,STTC_STR_MON
                ,STTC_END_MON
                ,STTC_PROD_STAD_DY
                ,STTC_DTM_DY
                ,RMK
                ,ADM_OPIN
                ,FRT_USR_ID
                ,FNL_USR_ID
                ,FNL_DEAL_DPT_CD
                ,FNL_MNU_ID
                ,FRT_REGI_DH
                ,FNL_MDF_DH )
            VALUES (
                 '10'
                ,'018'
                ,( SELECT NVL(MAX(STTC_TYP_SEQ), 0) + 1
                     FROM TWFAACAV200M
                    WHERE STTC_TYP_CD = '10'
                      AND STTC_CLSF_CD = '018' )
                ,SUBSTR(ADD_MONTHS(#{proStadDt}, -1), 0, 4)
                ,'01'
                ,TO_CHAR(TO_DATE(ADD_MONTHS(#{proStadDt}, -1)), 'MM')
                ,#{proStadDt}
                ,''
                ,#{rmk}
                ,#{admOpin}
                ,#{usrId}
                ,#{usrId}
                ,#{dptCd}
                ,#{mnuId}
                ,SYSDATE
                ,SYSDATE )
        ]]>
    </insert>
    
    <insert id="insertDetail">
        /* kr.go.bai.eip.faa.cav.dao.FAACAV018QMapper.insertDetail */
        <![CDATA[
            INSERT INTO TWFAACAV200D (
                 STTC_TYP_CD
                ,STTC_CLSF_CD
                ,STTC_TYP_SEQ
                ,STTC_DATA_SNO
                ,STTC_TIT1
                ,STTC_COL1
                ,STTC_COL2
                ,STTC_COL3
                ,STTC_COL4
                ,STTC_COL5
                ,STTC_COL6
                ,STTC_COL7
                ,STTC_COL8
                ,AUD_YR
                ,ROW_KND_CD
                ,FRT_USR_ID
                ,FNL_USR_ID
                ,FNL_DEAL_DPT_CD
                ,FNL_MNU_ID
                ,FRT_REGI_DH
                ,FNL_MDF_DH )
            VALUES (
                 '10'
                ,'018'
                ,( SELECT NVL(MAX(STTC_TYP_SEQ), 0)
                     FROM TWFAACAV200M
                    WHERE STTC_TYP_CD = '10'
                      AND STTC_CLSF_CD = '018' )
                ,( SELECT NVL(MAX(STTC_DATA_SNO), 0) + 1
                     FROM TWFAACAV200D
                    WHERE STTC_TYP_CD = '10'
                      AND STTC_CLSF_CD = '018' 
                      AND STTC_TYP_SEQ = ( SELECT NVL(MAX(STTC_TYP_SEQ), 0)
                                             FROM TWFAACAV200M
                                            WHERE STTC_TYP_CD = '10'
                                              AND STTC_CLSF_CD = '018' ))
                ,#{sttcTit1}
                ,#{sttcCol1}
                ,#{sttcCol2}
                ,#{sttcCol3}
                ,#{sttcCol4}
                ,#{sttcCol5}
                ,#{sttcCol6}
                ,#{sttcCol7}
                ,#{sttcCol8}
                ,#{audYr}
                ,#{rowKndCd}
                ,#{usrId}
                ,#{usrId}
                ,#{dptCd}
                ,#{mnuId}
                ,SYSDATE
                ,SYSDATE )
        ]]>
    </insert>
    
    <insert id="updateMaster">
        /* kr.go.bai.eip.faa.cav.dao.FAACAV018QMapper.updateMaster */
        <![CDATA[
            UPDATE TWFAACAV200M
               SET RMK = #{rmk}
                  ,ADM_OPIN = #{admOpin}
                  ,FNL_USR_ID = #{usrId}
                  ,FNL_DEAL_DPT_CD = #{dptCd}
                  ,FNL_MDF_DH = SYSDATE
             WHERE STTC_TYP_CD = #{sttcTypCd}
               AND STTC_CLSF_CD = #{sttcClsfCd}
               AND STTC_TYP_SEQ = #{sttcTypSeq}
        ]]>
    </insert>
    
    <insert id="updateDetail">
        /* kr.go.bai.eip.faa.cav.dao.FAACAV018QMapper.updateDetail */
        <![CDATA[
            UPDATE TWFAACAV200D
               SET STTC_COL1 = #{sttcCol1}
                  ,STTC_COL2 = #{sttcCol2}
                  ,STTC_COL3 = #{sttcCol3}
                  ,STTC_COL4 = #{sttcCol4}
                  ,STTC_COL5 = #{sttcCol5}
                  ,STTC_COL6 = #{sttcCol6}
                  ,STTC_COL7 = #{sttcCol7}
                  ,STTC_COL8 = #{sttcCol8}
                  ,FNL_USR_ID = #{usrId}
                  ,FNL_DEAL_DPT_CD = #{dptCd}
                  ,FNL_MDF_DH = SYSDATE
             WHERE STTC_TYP_CD = #{sttcTypCd}
               AND STTC_CLSF_CD = #{sttcClsfCd}
               AND STTC_TYP_SEQ = #{sttcTypSeq}
               AND STTC_DATA_SNO = #{sttcDataSno}
        ]]>
    </insert>
    
    <insert id="updateMasterDtmDy">
        /* kr.go.bai.eip.faa.cav.dao.FAACAV018QMapper.updateMasterDtmDy */
        <![CDATA[
            UPDATE TWFAACAV200M
               SET STTC_DTM_DY = SYSDATE
                  ,FNL_USR_ID = #{usrId}
                  ,FNL_DEAL_DPT_CD = #{dptCd}
                  ,FNL_MDF_DH = SYSDATE
             WHERE STTC_TYP_CD = #{sttcTypCd}
               AND STTC_CLSF_CD = #{sttcClsfCd}
               AND STTC_TYP_SEQ = #{sttcTypSeq}
        ]]>
    </insert>
    
</mapper>