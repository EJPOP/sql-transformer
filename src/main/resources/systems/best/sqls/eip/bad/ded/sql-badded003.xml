<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.bad.ded.dao.BADDED003EMapper">
    
    <select id="selectMainList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectMainList*/
        <include refid="include.pageSelct" />
            <![CDATA[
            SELECT * 
            FROM (    
            SELECT D1.REL_AUD_YR||'-'||D1.REL_AUD_NO||'-'||D1.AUD_STEP_SNO   AS ORDER_AUD_YR_NO
                 , F_MNG_KND_AUDYRNO(D1.REL_AUD_YR, D1.REL_AUD_NO, D2.AUD_KND_CD, '-') ||'(' ||D1.AUD_STEP_SNO || ')'
                                                            AS AUD_YR_NO            /*감사연번호*/
                 , D1.BZT_YR                                AS BZT_YR                /*출장년도*/
                 , D1.BZT_SNO                               AS BZT_SNO              /*출장순번*/
                 ,(SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000007' AND CD = D2.AUD_KND_CD)  AS AUD_KND_NM    /*감사종류명 2017.04.14 EUNOK 속도개선을 위한 수정*/
                 , D1.BZT_DVSN_CD                           AS BZT_DVSN_CD          /*출장구분코드*/
                 , D1.AUD_BZT_KND_CD                        AS AUD_BZT_KND_CD       /*감사출장종류코드*/
                 ,(SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000030' AND CD = D1.AUD_BZT_KND_CD)  AS AUD_BZT_KND_NM    /*감사출장종류명 2017.04.14 EUNOK 속도개선을 위한 수정*/
                 , D1.TIT_TXT                               AS TIT_TXT              /*출장사항명*/
                 , D1.BZT_BRDV_CD                           AS BZT_BRDV_CD          /*출장국과코드*/
                 ,(SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = D1.BZT_BRDV_CD)  AS BZT_BRDV_NM    /*출장국과명 2017.04.14 EUNOK 속도개선을 위한 수정*/
                 ,(SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = D2.MNG_DPT_CD)  AS MNG_DPT_NM    /*관리국과명 2017.04.14 EUNOK 속도개선을 위한 수정*/
                 , D2.MNG_DPT_CD                            AS MNG_DPT_CD           /*관리국코드 - 2017.01.25 EUNOK*/
                 , D2.SPV_BRDV_CD                           AS SPV_BRDV_NM          /*주관부서명*/
                 , TO_CHAR(TO_DATE(D1.AUD_STR_DT),'YYYY-MM-DD') AS AUD_STR_DT
                 , TO_CHAR(TO_DATE(D1.AUD_END_DT),'YYYY-MM-DD') AS AUD_END_DT
                 , TO_CHAR(TO_DATE(D1.AUD_STR_DT),'YYYY-MM-DD')||' ~ '
                 || TO_CHAR(TO_DATE(D1.AUD_END_DT),'YYYY-MM-DD') AS AUD_ST_END_DT      /*실시기간*/
                 , D3.PCT_CNB_CNT                            AS PCT_CNB_CNT            /*인원*/
                 , D3.EXP_CNT                                AS EXP_CNT                /*전문가 인원*/
                 , D4.CNT                                    AS AJT_CNT                /*수령자*/
                 , CASE WHEN D4.CALC_CNT>0 THEN 'Y' ELSE 'N' END  AS AJT_YN_N          /*계산여부*/
                 , CASE WHEN D4.ADJ_CNT>0 THEN 'Y' ELSE 'N' END   AS AJT_YN_Y          /*정산여부*/
                 , CASE WHEN D1.CALC_DTM_YN = 'Y' THEN '계산확정' ELSE CASE WHEN D4.CALC_CNT > 0 THEN '계산' ELSE '미계산' END END AS CALC_YN          /*계산여부*/
                 , CASE WHEN D1.AJT_DTM_YN = 'Y' THEN '정산확정' ELSE CASE WHEN  D4.ADJ_CNT > 0 THEN '정산' ELSE '미정산' END END AS AJT_YN          /*정산여부*/
                 , D1.LEAD_EXS_PMT_YN                        AS LEAD_EXS_PMT_YN        /*지휘비지급여부*/
                 , D1.REL_AUD_YR   /*관련감사년도*/
                 , D1.REL_AUD_NO   /*관련감사번호*/
                 , D1.AUD_STEP_SNO /*감사단계순번*/
                 , D1.HLDY_ACTV_DVSN_CD
                 , NVL(D1.CTRL_YN,'N')                         AS CTRL_YN              /*통제여부*/
                 , NVL(D1.SND_YN,'N')                         AS SND_YN                /*송부여부*/
                 , D1.CALC_DTM_YN                           AS CALC_DTM_YN          /*계산확정여부*/ 
                 , D1.AJT_DTM_YN                            AS AJT_DTM_YN           /*정산확정여부*/
                 , D2.AUD_YR
                 , D2.AUD_NO
                 , D2.BZT_BGT_DVSN_CD           AS BZT_BGT_DVSN_CD  /* 예산구분 추가 - 2021.05.11 yyh */
                 , SUBSTR(D2.AUD_KND_CD,-1)    AS AUD_KND_LAST_CD /* 감사종류 마지막 값 - 2021.05.11 yyh */ 
                 , (SELECT SUBSTR(EXTRACT(XMLAGG(XMLELEMENT(A,', '|| YE||MD) ORDER BY  YE||MD), '//text()'),3)
                    FROM TBBADDED013B
                   WHERE YE||MD BETWEEN D1.AUD_STR_DT AND D1.AUD_END_DT) AS HOILDAY   /* 출장기간내 휴일 - 2021.06.01 yyh */
                 ,(SELECT COUNT(*)
                     FROM TBBADDED180B C
                    WHERE EXISTS (SELECT A.*
                                    FROM UBWASAPP.TBBADDED018B A
                                   WHERE 1=1
                                     AND A.TREXP_CLU_CD IN ('05','07')
                                     AND A.DT_EXS_DVSN_CD IS NOT NULL
                                     AND A.BZT_SRNO = (SELECT B.BZT_SRNO
                                                         FROM UBWASAPP.TBBADDED180B B
                                                        WHERE B.BZT_DVSN_CD = '1'
                                                          AND B.STAD_STR_DT <= (SELECT AUD_STR_DT
                                                                                 FROM TBBADDED002M
                                                                                WHERE BZT_YR  = D1.BZT_YR
                                                                                  AND BZT_SNO = D1.BZT_SNO
                                                                               )
                                                          AND B.STAD_END_DT >= (SELECT AUD_STR_DT
                                                                                 FROM TBBADDED002M
                                                                                WHERE BZT_YR  = D1.BZT_YR
                                                                                  AND BZT_SNO = D1.BZT_SNO
                                                                               )
                                                       )
                                     AND A.BZT_SRNO = C.BZT_SRNO
                                )) AS SEL_CNT
              FROM TBBADDED002M AS D1
        INNER JOIN TBBADDED001M AS D2 ON D1.REL_AUD_YR = D2.AUD_YR AND D1.REL_AUD_NO = D2.AUD_NO
   LEFT OUTER JOIN (SELECT BZT_YR
                         , BZT_SNO 
                         , COUNT(DISTINCT PCT_CNB) PCT_CNB_CNT
                         , SUM( DECODE(STF_DVSN_CD,'3',1,0)) EXP_CNT 
                      FROM TBBADDED005L
                     WHERE 1=1
                       AND BZT_YR =  #{schAudYr}
                  GROUP BY BZT_YR, BZT_SNO
                   ) AS D3 ON D1.BZT_YR = D3.BZT_YR AND D1.BZT_SNO = D3.BZT_SNO
   LEFT OUTER JOIN (SELECT BZT_YR
                         , BZT_SNO
                         , COUNT(DISTINCT PCT_CNB)        AS CNT
                         , SUM(DECODE(CALC_YN,'N',1,0)) AS CALC_CNT
                         , SUM(DECODE(CALC_YN,'Y',1,0)) AS ADJ_CNT
                      FROM TBBADDED011L
                     WHERE 1=1
                       AND BZT_YR =  #{schAudYr}
                  GROUP BY BZT_YR, BZT_SNO
                   ) AS D4 ON D1.BZT_YR = D4.BZT_YR AND D1.BZT_SNO = D4.BZT_SNO
            WHERE 1=1
              AND D1.BZT_DVSN_CD = '1' /*감사출장*/
             ]]>

            <if test='otherDptBzt != "Y"'>              
	              AND (        D2.MNG_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, #{dptAuth}, '', #{schSpvBrdvCd})))
	                        OR  (#{schSpvBrdvCd}  = (SELECT D4.HIRK_DPT_CD FROM TBDCMACM002M D4 WHERE D4.DPT_CD  = D2.MNG_DPT_CD AND D4.USE_YN = 'Y') 
	                              AND D2.AUD_SCL_CD =  2  )
	                     )
            </if>
            /* 참여한 타부서 출장상황 조회 수정 - 2021.04.30 yyh */
            <if test='otherDptBzt == "Y"'>      
	               AND D2.MNG_DPT_CD NOT IN (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = #{cnb})           
                   AND EXISTS (
			                        SELECT 1
			                          FROM TBBADDED002M ST4
			                   INNER JOIN TBBADDED010L ST5
			                             ON ST4.BZT_YR    = ST5.BZT_YR
			                            AND ST4.BZT_SNO = ST5.BZT_SNO
			                         WHERE D1.BZT_YR    = ST4.BZT_YR
			                            AND D1.BZT_SNO  = ST4.BZT_SNO
			                            AND ST5.PCT_CNB = #{cnb}
                             )                           
            </if>

            /*20170202 EUNOK 관리부셔 != 감찰담당관, 감찰관,재무행정, 유지보수,구축용역이 아니면 감찰관부서의 데이터는 검색되지 않음*/
            <if test='searchChk != "Y"'>
               AND D2.MNG_DPT_CD NOT IN ('100000','100100')
            </if>
            
            <if test="schAudYr != null and schAudYr != ''">
               AND D1.REL_AUD_YR = #{schAudYr}
            </if>
            <if test="schAudYrKndNoCd != null and schAudYrKndNoCd != ''">
               AND SUBSTR(D2.AUD_KND_CD,3,1) = #{schAudYrKndNoCd}
            </if>
            <if test="schAudYrNoKndCd != null and schAudYrNoKndCd != ''">
               AND D2.AUD_KND_CD = #{schAudYrNoKndCd}
            </if>
            <if test="schAudGrnNo != null and schAudGrnNo != ''">
               AND D2.AUD_GRN_NO = #{schAudGrnNo}
            </if>
            <if test="schAudNo != null and schAudNo != ''">
               AND D1.REL_AUD_NO = #{schAudNo}
            </if>
            <if test="schAudSbjNm != null and schAudSbjNm != ''">
               AND D2.AUD_SBJ_NM LIKE '%'||#{schAudSbjNm}||'%'
            </if>
            <if test="schCtrlYn != null and schCtrlYn != '' and schCtrlYn eq 'Y'.toString()">
               AND D1.CTRL_YN = 'Y'
            </if>
            <if test="schCtrlYn != null and schCtrlYn != '' and schCtrlYn eq 'N'.toString()">
               AND NVL(D1.CTRL_YN,'N') = 'N'
            </if>
            <if test="schSndYn != null and schSndYn != '' and schSndYn eq 'Y'.toString()">
               AND D1.SND_YN = 'Y'
            </if>
            <if test="schSndYn != null and schSndYn != '' and schSndYn eq 'N'.toString()">
               AND NVL(D1.SND_YN,'N') = 'N'
            </if>
            <if test="schDeptCd != null and schDeptCd != ''">
               AND D2.MNG_DPT_CD  = #{schDeptCd}
            </if>
            <if test="schAudKndCd != null and schAudKndCd != ''">
               AND D2.AUD_KND_CD = #{schAudKndCd}
            </if>
            <if test="schBztKndCd != null and schBztKndCd != ''">
               AND D1.AUD_BZT_KND_CD  = #{schBztKndCd}
            </if>
            <if test="schBztDvsnCd != null and schBztDvsnCd != ''">
               AND D1.BZT_DVSN_CD = #{schBztDvsnCd}
            </if>
            <if test="schBztSno != null and schBztSno != ''">
               AND D1.BZT_SNO = #{schBztSno}
            </if>
            <if test="schBztYr != null and schBztYr != ''">
               AND D1.BZT_YR = #{schBztYr}
            </if>
            <if test="schMasterYN != null and schMasterYN != '' and schMasterYN eq 'MASTER'.toString()">
               AND D1.CTRL_TG_YN = 'Y'
               AND D1.SND_YN = 'Y'
            </if>
             <if test="rankCd == '004' and pstCd == '0067400'">
              <![CDATA[
                   AND SUBSTR(D2.AUD_KND_CD, 3, 1) <> '5'
                ]]>
            </if>
            <if test="rankCd == '007' and pstCd == '0055700'">
             <![CDATA[
                   AND SUBSTR(D2.AUD_KND_CD, 3, 1) <> '5'
                ]]>
            </if>
            <if test="schTitTxt != null and schTitTxt != ''">
               AND D1.TIT_TXT LIKE #{schTitTxt}||'%'
            </if>
            <if test="callPageYn != null and callPageYn != '' and callPageYn eq 'Y'.toString()">
                <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1010'.toString()">
                    AND D1.AUD_BZT_KND_CD IN ('00','15') /*서면감사인 경우 확인출장(15) 조회 되도록 수정*/
                </if>
                <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1020'.toString()">
                    AND D1.AUD_BZT_KND_CD = '01'
                </if>
                <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1030'.toString()">
                    AND D1.AUD_BZT_KND_CD IN ('02','03')
                </if>
                <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1040'.toString()">
                    AND D1.AUD_BZT_KND_CD IN ('02','03')
                </if>
            </if>
            )
            WHERE 1=1
            <if test="schAjtYnN != null and schAjtYnN !='' and schAjtYnN eq 'Y'.toString()">
            AND AJT_YN_N = 'Y'
            AND CALC_DTM_YN != 'Y'
            </if>
            <if test="schAjtYnN != null and schAjtYnN !='' and schAjtYnN eq 'N'.toString()">
            AND AJT_YN_N = 'N'
            </if>
            <if test="schAjtYnN != null and schAjtYnN !='' and schAjtYnN eq 'X'.toString()">
            AND CALC_DTM_YN = 'Y'
            </if>
            <if test="schAjtYnY != null and schAjtYnY !='' and schAjtYnY eq 'Y'.toString()">
            AND AJT_YN_Y = 'Y'
            AND AJT_DTM_YN != 'Y'
            </if>
            <if test="schAjtYnY != null and schAjtYnY !='' and schAjtYnY eq 'N'.toString()">
            AND AJT_YN_Y = 'N'
            </if>
            <if test="schAjtYnY != null and schAjtYnY !='' and schAjtYnY eq 'X'.toString()">
            AND AJT_DTM_YN = 'Y'
            </if>
            ORDER BY AUD_STR_DT DESC /* 20170721 EUNOK 수정 ORDER BY AUD_YR, AUD_NO DESC, AUD_BZT_KND_CD DESC */
        <include refid="include.pageOrder" />
    </select>
    
    <select id="selectSubOneList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectSubOneList*/
        <include refid="include.pageSelct" />
            <![CDATA[
                SELECT D1.BZT_YR                        AS BZT_YR                 /*출장년도*/
                 , D1.BZT_SNO                           AS BZT_SNO                /*출장순번*/
                 , D1.PCT_CNB                           AS PCT_CNB                /*출장자전산번호*/
                 , D1.PCT_NM                            AS PCT_NM                 /*출장자명*/
                 , D1.PCT_NM||'('||D1.PCT_CNB||')'      AS PCT_NM_DISP            /*출장자명*/
                 , D1.PCT_RANK_CD                       AS PCT_RANK_CD            /*직급코드*/
                 , F_CODE_NM('1000173', D1.PCT_RANK_CD) AS RANK_NM                /*직급명*/
                 , D1.STF_DVSN_CD                       AS STF_DVSN_CD            /*직원구분코드*/
                 , D1.DEP_RGN_CD                        AS DEP_RGN_CD             /*출발지역코드*/
                 , D1.BLT_BRDV_CD                       AS BLT_BRDV_CD            /*소속국과코드*/
                 , F_DPT_INFO(D1.BLT_BRDV_CD,'1')       AS BLT_BRDV_NM            /*소속국과명*/
                 , D1.BNK_CD                            AS BNK_CD                 /*은행코드*/
                 , D1.EAN                               AS EAN                    /*계좌번호*/
                 , D1.LEAD_EXS_RCV_EXS_RCIT_PEN_YN      AS LEAD_EXS_RCV_EXS_RCIT_PEN_YN    /*지휘비및 수용비수령자여부*/
                 , NVL(D3.DT_EXS,0)                            AS DT_EXS                 /*일비*/
                 , NVL(D3.LDC,0)                               AS LDC                    /*숙박비*/
                 , NVL(D3.FDEX,0)                              AS FDEX                   /*식비*/
                 , NVL(D3.SPM_XPN,0)                           AS SPM_XPN                /*보충경비*/
                 , NVL(D3.BZT_DCN,0)                           AS BZT_DCN                /*출장일수*/
                 , NVL(D5.RL_FR_EXS,0) + NVL(D3.CPRG_FR_EXS,0) AS RL_FR_EXS       /*철도운임비 + 수도권운임비 - 2015.05.11 yyh*/
                 , CASE WHEN D2.BZT_TL_CNB = D1.PCT_CNB 
                        THEN D4.LEAD_EXS ELSE 0 
                    END                                 AS LEAD_EXS               /*지휘비*/
                 , CASE WHEN D2.BZT_TL_CNB = D1.PCT_CNB 
                          THEN D4.AUD_ACTV_RCV_EXS ELSE 0 
                      END                               AS AUD_ACTV_RCV_EXS       /*감사활동수용비*/
                 , NVL(D3.SUM_COST,0)                          AS SUM_COST               /*국내여비*/
                 , NVL(D3.SUM_COST,0) + NVL(D5.RL_FR_EXS,0) + NVL(D3.SPM_XPN,0) + NVL(D3.CPRG_FR_EXS,0) /* 수도권운임비 추가 */
                   + CASE WHEN D2.BZT_TL_CNB = D1.PCT_CNB THEN NVL(D4.AUD_ACTV_RCV_EXS,0)
                   + NVL(D4.LEAD_EXS,0) ELSE 0 END AS ALL_COST                 /*합계*/
                   , D1.PCT_OCP_CD
                   , D1.EXTL_ORG_CD
                   , D1.EXTL_ORG_NM
                   , CASE WHEN D6.AJT_DGE IS NOT NULL THEN D6.AJT_DGE||'차' ELSE '' END  AS AJT_DGE
                   , CASE WHEN D7.PCT_CNB IS NULL THEN 'Y' ELSE 'N' END AS DEL_YN    /*수정가능여부*/
                   
                   /* 연료비,연비추가 - 2021.01.29 yyh */
                   ,FUEL_EFFENY_1    /* 휘발유 연비 */
                   ,FUEL_AM_1        /* 휘발유 연료비 */
                   ,FUEL_EFFENY_2    /* 경유 연비 */
                   ,FUEL_AM_2        /* 경유 연료비 */                   
                   ,FUEL_EFFENY_3    /* LPG 연비 */
                   ,FUEL_AM_3        /* LPG 연료비 */                   
                   ,FUEL_EFFENY_4    /* 전기차 연비 */
                   ,FUEL_AM_4        /* 전기차 연료비 */
                   ,FUEL_EFFENY_5    /* 자차(수소차) 연비 */
                   ,FUEL_AM_5        /* 자차(수소차) 연료비 */
                   ,FUEL_EFFENY_6    /* 자차(하이브리드(일반)) 연비 */
                   ,FUEL_AM_6        /* 자차(하이브리드(일반)) 연료비 */                   
                   ,FUEL_EFFENY_7    /* 자차(하이브리드(플러그인_유류)) 연비 */
                   ,FUEL_AM_7        /* 자차(하이브리드(플러그인_유류)) 연료비 */                   
                   ,FUEL_EFFENY_8    /* 자차(하이브리드(플러그인_전기)) 연비 */
                   ,FUEL_AM_8        /* 자차(하이브리드(플러그인_전기)) 연료비 */
                   ,NVL(D1.PSN_AJT_YN, 'N') AS PSN_AJT_YN /* 개인별정산여부 */      
              FROM TBBADDED010L D1 /*출장수령자내역*/
                 , (
                    SELECT #{bztYr} AS BZT_YR
                         , #{bztSno} AS BZT_SNO
                         , F_LEAD_EXS_RCV_EXS_RCIT_CNB(#{bztYr},#{bztSno}) AS BZT_TL_CNB
                      FROM DUAL
                  ) D2 /*지휘비수령자를 확인하기 위함.*/
                , (
                    SELECT D1.BZT_YR
                         , D1.BZT_SNO
                         , D1.PCT_CNB
                         , SUM(NVL(D1.DT_EXS,0))                                              AS DT_EXS       /*일비*/
                         , SUM(NVL(D1.LDC,0)) + SUM(NVL(D1.LODG_GVM_PUR_CRD_EXMP_AM,0))       AS LDC          /*숙박비.  숙박정부구매카드외금액 추가 - 2021.02.02 yyh */
                         , SUM(NVL(D1.FDEX,0))                                                AS FDEX         /*식비*/
                         , SUM(NVL(D1.DT_EXS,0)) + SUM(NVL(D1.LDC,0)) + SUM(NVL(D1.FDEX,0)) +  
                           SUM(NVL(D1.LODG_GVM_PUR_CRD_EXMP_AM,0))                            AS SUM_COST     /*합계*/
                         , SUM(NVL(D1.SPM_XPN,0))                                             AS SPM_XPN      /*보충경비*/
                         , SUM(NVL(D1.BZT_DCN,0))                                             AS BZT_DCN      /*출장일수*/
                         , SUM(NVL(D1.CPRG_FR_EXS,0))                                         AS CPRG_FR_EXS  /*수도권운임비*/
                      FROM TBBADDED011L D1
                     WHERE BZT_YR = #{bztYr}
                       AND BZT_SNO = #{bztSno}
                       AND CALC_YN = #{calcYn}
                    GROUP BY BZT_YR
                           , BZT_SNO
                           , PCT_CNB 
                  ) D3  /*일반경비*/
                , (
                     SELECT D1.BZT_YR
                         , D1.BZT_SNO
                         , SUM(NVL(D1.LEAD_EXS,0))           AS LEAD_EXS             /*지휘비*/
                         , SUM(NVL(D1.AUD_ACTV_RCV_EXS,0))     AS AUD_ACTV_RCV_EXS  /*감사활동수용비*/
                      FROM TBBADDED011L D1
                     WHERE D1.BZT_YR = #{bztYr}
                       AND D1.BZT_SNO = #{bztSno}
                       AND D1.CALC_YN = #{calcYn}
                    GROUP BY D1.BZT_YR
                           , D1.BZT_SNO
                  ) D4 /*지휘비, 감사활동비*/
                , (
                    SELECT D1.BZT_YR
                         , D1.BZT_SNO
                         , D1.PCT_CNB
                         , SUM(NVL(D1.RL_FR_EXS,0))   + 
                           SUM(NVL(D1.TOLL,0))        + 
                           SUM(NVL(D1.PARKING_FEE,0)) + 
                           SUM(NVL(D1.RL_GVM_PUR_CRD_EXMP_AM,0)) AS RL_FR_EXS /* 기존운임비에 통행료,주차비,철도정부구매카드외 금액 추가 - 2021.02.02 yyh */ 
                      FROM TBBADDED017L D1
                     WHERE 1=1
                       AND D1.BZT_YR = #{bztYr}
                       AND D1.BZT_SNO = #{bztSno}
                       AND D1.CALC_YN = #{calcYn}
                    GROUP BY D1.BZT_YR
                           , D1.BZT_SNO
                           , D1.PCT_CNB
                  ) D5 /*철도운임비*/
                 , (
                     SELECT BZT_YR
                          , BZT_SNO
                          , PCT_CNB
                          , MAX(AJT_DGE) AS AJT_DGE
                       FROM TBBADDED019H
                      GROUP BY BZT_YR
                             , BZT_SNO
                             , PCT_CNB 
                  ) D6    
                 , (
                     SELECT DISTINCT BZT_YR ,BZT_SNO, PCT_CNB
                         FROM (
                               SELECT BZT_YR
                                    , BZT_SNO 
                                    , BZT_TL_CNB AS PCT_CNB
                                 FROM TBBADDED002M
                                WHERE 1=1
                                  AND BZT_YR  = #{bztYr}
                                  AND BZT_SNO = #{bztSno}
                                UNION ALL
                                SELECT BZT_YR
                                     , BZT_SNO 
                                     , PCT_CNB 
                                  FROM TBBADDED005L
                                 WHERE BZT_YR  = #{bztYr}
                                   AND BZT_SNO = #{bztSno}
                              )
                  ) D7
                ,(SELECT MAX(CASE WHEN FUEL_DVSN_CD = '1' THEN FUEL_EFFENY END) AS FUEL_EFFENY_1
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '1' THEN FUEL_AM     END) AS FUEL_AM_1
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '2' THEN FUEL_EFFENY END) AS FUEL_EFFENY_2
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '2' THEN FUEL_AM     END) AS FUEL_AM_2
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '3' THEN FUEL_EFFENY END) AS FUEL_EFFENY_3
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '3' THEN FUEL_AM     END) AS FUEL_AM_3
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '4' THEN FUEL_EFFENY END) AS FUEL_EFFENY_4
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '4' THEN FUEL_AM     END) AS FUEL_AM_4
						,MAX(CASE WHEN FUEL_DVSN_CD = '5' THEN FUEL_EFFENY END) AS FUEL_EFFENY_5
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '5' THEN FUEL_AM     END) AS FUEL_AM_5
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '6' THEN FUEL_EFFENY END) AS FUEL_EFFENY_6
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '6' THEN FUEL_AM     END) AS FUEL_AM_6
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '7' THEN FUEL_EFFENY END) AS FUEL_EFFENY_7
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '7' THEN FUEL_AM     END) AS FUEL_AM_7
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '8' THEN FUEL_EFFENY END) AS FUEL_EFFENY_8
                        ,MAX(CASE WHEN FUEL_DVSN_CD = '8' THEN FUEL_AM     END) AS FUEL_AM_8 
                    FROM TBBADDED201B A
                        ,TBBADDED202H B
                   WHERE A.SRNO = B.SRNO
                     AND A.BZT_DVSN_CD = '1'
                     AND (SELECT AUD_STR_DT
                           FROM TBBADDED002M 
                          WHERE BZT_YR    = #{bztYr}
                            AND BZT_SNO   = #{bztSno}) BETWEEN STAD_STR_DT AND STAD_END_DT) D8
                  ,TBDCMACM001M D9  /* 정렬를 위해 추가 - 2021.06.18 yyh */ 
             WHERE D1.BZT_YR  = D2.BZT_YR
               AND D1.BZT_SNO = D2.BZT_SNO
               AND D1.BZT_YR  = D3.BZT_YR(+)
               AND D1.BZT_SNO = D3.BZT_SNO(+)
               AND D1.PCT_CNB = D3.PCT_CNB(+)
               AND D1.BZT_YR  = D4.BZT_YR(+)
               AND D1.BZT_SNO = D4.BZT_SNO(+)
               AND D1.BZT_YR  = D5.BZT_YR(+)
               AND D1.BZT_SNO = D5.BZT_SNO(+)
               AND D1.PCT_CNB = D5.PCT_CNB(+)
               AND D1.BZT_YR  = D6.BZT_YR(+)
               AND D1.BZT_SNO = D6.BZT_SNO(+)
               AND D1.PCT_CNB = D6.PCT_CNB(+)
               AND D1.BZT_YR  = D7.BZT_YR(+)
               AND D1.BZT_SNO = D7.BZT_SNO(+)
               AND D1.PCT_CNB = D7.PCT_CNB(+)
               AND D1.PCT_CNB = D9.CNB(+) 
               AND D1.BZT_YR  = #{bztYr}
               AND D1.BZT_SNO = #{bztSno}
          ORDER BY D9.OCP_CD
                       ,NVL(D9.INN_RANK_CD, '50') ASC 
                       ,D9.RANK_SRT_SEQ_NM
                       ,D9.CRNT_RANK_APM_DT
                       ,D9.SRT_KY_NO
                       ,D9.CRNT_DPT_APM_DT
                       ,D9.EIN 
            ]]>
        <include refid="include.pageOrder" />
    </select>
    
    <select id="selectSubOneList2" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectSubOneList2*/
            <![CDATA[
                SELECT D1.BZT_YR                        AS BZT_YR                 /*출장년도*/
                 , D1.BZT_SNO                           AS BZT_SNO                /*출장순번*/
                 , D1.PCT_CNB                           AS PCT_CNB                /*출장자전산번호*/
                 , D1.PCT_NM                            AS PCT_NM                 /*출장자명*/
                 , D1.PCT_NM||'('||D1.PCT_CNB||')'      AS PCT_NM_DISP            /*출장자명*/
                 , D1.PCT_RANK_CD                       AS PCT_RANK_CD            /*직급코드*/
                 , F_CODE_NM('1000173', D1.PCT_RANK_CD) AS RANK_NM                /*직급명*/
                 , D1.STF_DVSN_CD                       AS STF_DVSN_CD            /*직원구분코드*/
                 , D1.DEP_RGN_CD                        AS DEP_RGN_CD             /*출발지역코드*/
                 , D1.BLT_BRDV_CD                       AS BLT_BRDV_CD            /*소속국과코드*/
                 , F_DPT_INFO(D1.BLT_BRDV_CD,'1')       AS BLT_BRDV_NM            /*소속국과명*/
                 , D1.BNK_CD                            AS BNK_CD                 /*은행코드*/
                 , D1.EAN                               AS EAN                    /*계좌번호*/
                 , D1.LEAD_EXS_RCV_EXS_RCIT_PEN_YN      AS LEAD_EXS_RCV_EXS_RCIT_PEN_YN    /*지휘비및 수용비수령자여부*/
                 , NVL(D3.DT_EXS,0)                            AS DT_EXS                 /*일비*/
                 , NVL(D3.LDC,0)                               AS LDC                    /*숙박비*/
                 , NVL(D3.FDEX,0)                              AS FDEX                   /*식비*/
                 , NVL(D3.SPM_XPN,0)                           AS SPM_XPN                /*보충경비*/
                 , NVL(D3.BZT_DCN,0)                           AS BZT_DCN                /*출장일수*/
                 , NVL(D5.RL_FR_EXS,0) + NVL(D3.CPRG_FR_EXS,0) AS RL_FR_EXS       /*철도운임비 + 수도권운임비 - 2015.05.11 yyh*/
                 , CASE WHEN D2.BZT_TL_CNB = D1.PCT_CNB 
                        THEN D4.LEAD_EXS ELSE 0 
                    END                                 AS LEAD_EXS               /*지휘비*/
                 , CASE WHEN D2.BZT_TL_CNB = D1.PCT_CNB 
                          THEN D4.AUD_ACTV_RCV_EXS ELSE 0 
                      END                               AS AUD_ACTV_RCV_EXS       /*감사활동수용비*/
                 , NVL(D3.SUM_COST,0)                          AS SUM_COST               /*국내여비*/
                 , NVL(D3.SUM_COST,0) + NVL(D5.RL_FR_EXS,0) + NVL(D3.SPM_XPN,0) + NVL(D3.CPRG_FR_EXS,0) /* 수도권운임비 추가 */
                   + CASE WHEN D2.BZT_TL_CNB = D1.PCT_CNB THEN NVL(D4.AUD_ACTV_RCV_EXS,0)
                   + NVL(D4.LEAD_EXS,0) ELSE 0 END AS ALL_COST                 /*합계*/
                   , D1.PCT_OCP_CD
                   , D1.EXTL_ORG_CD
                   , D1.EXTL_ORG_NM
                   , CASE WHEN D6.AJT_DGE IS NOT NULL THEN D6.AJT_DGE||'차' ELSE '' END  AS AJT_DGE
                   , CASE WHEN D7.PCT_CNB IS NULL THEN 'Y' ELSE 'N' END AS DEL_YN    /*수정가능여부*/
              FROM TBBADDED010L D1 /*출장수령자내역*/
                 , (
                    SELECT #{bztYr} AS BZT_YR
                         , #{bztSno} AS BZT_SNO
                         , F_LEAD_EXS_RCV_EXS_RCIT_CNB(#{bztYr},#{bztSno}) AS BZT_TL_CNB
                      FROM DUAL
                  ) D2 /*지휘비수령자를 확인하기 위함.*/
                , (
                    SELECT D1.BZT_YR
                         , D1.BZT_SNO
                         , D1.PCT_CNB
                         , SUM(NVL(D1.DT_EXS,0))      AS DT_EXS       /*일비*/
                         , SUM(NVL(D1.LDC,0))         AS LDC          /*숙박비*/
                         , SUM(NVL(D1.FDEX,0))        AS FDEX         /*식비*/
                         , SUM(NVL(D1.DT_EXS,0)) + SUM(NVL(D1.LDC,0)) + SUM(NVL(D1.FDEX,0)) AS SUM_COST /*합계*/
                         , SUM(NVL(D1.SPM_XPN,0))     AS SPM_XPN      /*보충경비*/
                         , SUM(NVL(D1.BZT_DCN,0))     AS BZT_DCN      /*출장일수*/
                         , SUM(NVL(D1.CPRG_FR_EXS,0)) AS CPRG_FR_EXS  /*수도권운임비*/
                      FROM TBBADDED011L D1
                     WHERE BZT_YR = #{bztYr}
                       AND BZT_SNO = #{bztSno}
                       AND CALC_YN = #{calcYn}
                    GROUP BY BZT_YR
                           , BZT_SNO
                           , PCT_CNB 
                  ) D3  /*일반경비*/
                , (
                     SELECT D1.BZT_YR
                         , D1.BZT_SNO
                         , SUM(NVL(D1.LEAD_EXS,0))           AS LEAD_EXS             /*지휘비*/
                         , SUM(NVL(D1.AUD_ACTV_RCV_EXS,0))     AS AUD_ACTV_RCV_EXS  /*감사활동수용비*/
                      FROM TBBADDED011L D1
                     WHERE D1.BZT_YR = #{bztYr}
                       AND D1.BZT_SNO = #{bztSno}
                       AND D1.CALC_YN = #{calcYn}
                    GROUP BY D1.BZT_YR
                           , D1.BZT_SNO
                  ) D4 /*지휘비, 감사활동비*/
                , (
                    SELECT D1.BZT_YR
                         , D1.BZT_SNO
                         , D1.PCT_CNB
                         , SUM(NVL(D1.RL_FR_EXS,0)) AS RL_FR_EXS
                      FROM TBBADDED017L D1
                     WHERE 1=1
                       AND D1.BZT_YR = #{bztYr}
                       AND D1.BZT_SNO = #{bztSno}
                       AND D1.CALC_YN = #{calcYn}
                    GROUP BY D1.BZT_YR
                           , D1.BZT_SNO
                           , D1.PCT_CNB
                  ) D5 /*철도운임비*/
                 , (
                     SELECT BZT_YR
                          , BZT_SNO
                          , PCT_CNB
                          , MAX(AJT_DGE) AS AJT_DGE
                       FROM TBBADDED019H
                      GROUP BY BZT_YR
                             , BZT_SNO
                             , PCT_CNB 
                  ) D6    
                 , (
                     SELECT DISTINCT BZT_YR ,BZT_SNO, PCT_CNB
                         FROM (
                               SELECT BZT_YR
                                    , BZT_SNO 
                                    , BZT_TL_CNB AS PCT_CNB
                                 FROM TBBADDED002M
                                WHERE 1=1
                                  AND BZT_YR  = #{bztYr}
                                  AND BZT_SNO = #{bztSno}
                                UNION ALL
                                SELECT BZT_YR
                                     , BZT_SNO 
                                     , PCT_CNB 
                                  FROM TBBADDED005L
                                 WHERE BZT_YR  = #{bztYr}
                                   AND BZT_SNO = #{bztSno}
                              )
                  ) D7
             WHERE D1.BZT_YR  = D2.BZT_YR
               AND D1.BZT_SNO = D2.BZT_SNO
               AND D1.BZT_YR  = D3.BZT_YR(+)
               AND D1.BZT_SNO = D3.BZT_SNO(+)
               AND D1.PCT_CNB = D3.PCT_CNB(+)
               AND D1.BZT_YR  = D4.BZT_YR(+)
               AND D1.BZT_SNO = D4.BZT_SNO(+)
               AND D1.BZT_YR  = D5.BZT_YR(+)
               AND D1.BZT_SNO = D5.BZT_SNO(+)
               AND D1.PCT_CNB = D5.PCT_CNB(+)
               AND D1.BZT_YR  = D6.BZT_YR(+)
               AND D1.BZT_SNO = D6.BZT_SNO(+)
               AND D1.PCT_CNB = D6.PCT_CNB(+)
               AND D1.BZT_YR  = D7.BZT_YR(+)
               AND D1.BZT_SNO = D7.BZT_SNO(+)
               AND D1.PCT_CNB = D7.PCT_CNB(+)
               AND D1.BZT_YR  = #{bztYr}
               AND D1.BZT_SNO = #{bztSno}
          ORDER BY D1.PCT_CNB
            ]]>
    </select>
    
    <select id="selectSubTwoList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectSubTwoList*/
        <include refid="include.pageSelct" />
            <![CDATA[
            SELECT D1.BZT_YR                        AS BZT_YR               /*출장년도*/
                 , D1.BZT_SNO                       AS BZT_SNO              /*출장순번*/
                 , D1.PCT_CNB                       AS PCT_CNB              /*출장자전산번호*/
                 , D1.BZT_EXS_SNO                   AS BZT_EXS_SNO          /*출장비순번*/
                 , D1.CALC_YN                       AS CALC_YN              /*계산여부*/
                 , D1.ORG_CD                        AS ORG_CD               /*기관코드*/
                 , F_ORG_INFO(D1.ORG_CD,'1')        AS ORG_NM               /*기관명*/
                 , F_ORG_INFO(D1.ORG_CD,'1')||'('||D1.ORG_CD||')'           AS ORG_NM_CD               /*기관명*/
                 , D1.RGN_CD                        AS RGN_CD               /*지역코드*/
                 , F_CODE_NM('1000001',D1.RGN_CD)   AS RGN_NM               /*지역명*/
                 , D1.RGN_DVSN_CD                       AS RGN_DVSN_CD      /*지역구분코드*/
                 , F_CODE_NM('1000023',D1.RGN_DVSN_CD)  AS RGN_DVSN_NM      /*지역구분명*/
                 , TO_CHAR(TO_DATE(D1.BZT_STR_DT),'YYYY-MM-DD')             AS BZT_STR_DT           /*출장시작일*/
                 , TO_CHAR(TO_DATE(D1.BZT_END_DT),'YYYY-MM-DD')             AS BZT_END_DT           /*출장종료일*/
                 , TO_CHAR(TO_DATE(D1.BZT_STR_DT),'YYYY-MM-DD')||' ~ '
                 || TO_CHAR(TO_DATE(D1.BZT_END_DT),'YYYY-MM-DD')    AS BZT_DT_NM        /*출장기간*/
                 , NVL(D1.BZT_DCN,0)                       AS BZT_DCN              /*출장일수*/
                 , NVL(D1.AUD_DCN,0)                       AS AUD_DCN              /*감사일수*/
                 , NVL(D1.LODG_DCN,0)                      AS LODG_DCN             /*숙박일수*/
                 , NVL(D1.DT_EXS,0)                        AS DT_EXS               /*일비*/
                 , (SELECT CASE WHEN (NVL(D1.LDC,0) - NVL(SUM(DECODE(B.GPC_DEAL_APV_STA_CD, '00', NVL(B.GPC_USE_AM, 0), NVL(-B.GPC_USE_AM, 0))), 0) = 0)
	                       THEN '증빙불필요' ELSE '증빙필요' ||'('|| (NVL(D1.LDC, 0) - NVL(SUM(DECODE(B.GPC_DEAL_APV_STA_CD, '00', NVL(B.GPC_USE_AM, 0), NVL(-B.GPC_USE_AM, 0))),0)) ||'원)'
	                        END MGN
                      FROM TBBADDED036D A
                          ,TBBADDED036L B
                     WHERE A.CON_TRNSC_ID = B.CON_TRNSC_ID
                       AND A.GPC_TRNSC_GRAM_NO = B.GPC_TRNSC_GRAM_NO
                       AND A.CON_SRNO = B.CON_SRNO
                       AND A.BZT_YR  = D1.BZT_YR
                       AND A.BZT_SNO = D1.BZT_SNO
                       AND A.PCT_CNB = D1.PCT_CNB
                       AND A.SNO = D1.BZT_EXS_SNO
                       AND A.AJT_RFC_YN = 'Y'
                       AND D1.CALC_YN = 'Y'
                       AND A.XPN_DVSN_CD = 'LDC')          AS EVD_NCSY_YN          /*숙박비-정부구매카드 사용금액=(수기입력 금액)*/
                 , NVL(D1.LDC,0)                           AS LDC                  /*숙박비*/
                 , NVL(D1.FDEX,0)                          AS FDEX                 /*식비*/
                 , NVL(D1.SPM_XPN,0)                       AS SPM_XPN              /*보충경비*/
                 , NVL(D1.LEAD_EXS,0)                      AS LEAD_EXS             /*지휘비*/
                 , D1.FNL_YN                               AS FNL_YN               /*최종여부*/
                 , D1.AUD_ACTV_RCV_EXS                     AS AUD_ACTV_RCV_EXS     /*감사활동수용비*/
                 , D2.PCT_RANK_CD                          AS PCT_RANK_CD          /*출장자직급*/
                 , D2.STF_DVSN_CD                          AS STF_DVSN_CD          /*직원구분코드 */
                 , NVL(D1.CPRG_FR_EXS,0)                   AS CPRG_FR_EXS          /*수도권운임비 - 2015.05.04 yyh */
                 , D1.LODG_TYP_CD                          AS LODG_TYP_CD          /*숙박유형코드 - 2021.01.25 yyh */
                 , NVL(D1.LODG_GVM_PUR_CRD_EXMP_AM,0)      AS LODG_GVM_PUR_CRD_EXMP_AM /* 숙박정부구매카드외금액 - 2021.01.25 yyh */    
                 ,F_CODE_NM('1000001', D2.DEP_RGN_CD)          AS DEP_RGN_NM  /*출발지역명*/  
              FROM TBBADDED011L AS D1
        INNER JOIN TBBADDED010L AS D2 ON D1.BZT_YR = D2.BZT_YR AND D1.BZT_SNO = D2.BZT_SNO AND D1.PCT_CNB = D2.PCT_CNB
             WHERE 1=1 
               AND D1.BZT_YR  = #{bztYr}
               AND D1.BZT_SNO = #{bztSno}
               AND D1.PCT_CNB = #{pctCnb}
               AND D1.CALC_YN = #{calcYn}
          ORDER BY D1.BZT_EXS_SNO
            ]]>
        <include refid="include.pageOrder" />
    </select>
    
    <select id="selectSubThreeList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectSubThreeList*/
        <include refid="include.pageSelct" />
            <![CDATA[
            SELECT D1.PCT_CNB                                AS PCT_CNB                  /*출장자전산번호*/
                 , D1.BZT_EXS_SNO                            AS BZT_EXS_SNO              /*출장비순번*/
                 , D1.CALC_YN                                AS CALC_YN                  /*계산여부*/
                 , D1.RL_SCO_SNO                             AS RL_SCO_SNO               /*철도구간순번*/
                 , D1.BZT_SNO                                AS BZT_SNO                  /*출장순번*/
                 , D1.BZT_YR                                 AS BZT_YR                   /*출장년도*/
                 , TO_CHAR(TO_DATE(D1.RID_DT),'YYYY-MM-DD')  AS RID_DT                   /*승차일*/
                 , D1.TRIN_KND_CD                            AS TRIN_KND_CD              /*열차종류코드*/
                 , F_CODE_NM('1000025',D1.TRIN_KND_CD)       AS TRAIN_TYPE_NM            /*열차종류명*/
                 , D1.CHRG_DVSN_CD                           AS CHRG_DVSN_CD             /*요금구분코드*/
                 , F_CODE_NM('1000026',D1.CHRG_DVSN_CD)      AS CHRG_DVSN_NM             /*요금구분명*/
                 , D1.DEP_STN_NM                             AS DEP_STN_NM               /*출발역명*/
                 , D1.ARV_STN_NM                             AS ARV_STN_NM               /*도착역명*/
                 , D1.FNL_YN                                 AS FNL_YN                   /*최종여부*/
                 , (SELECT CASE WHEN (NVL(D1.RL_FR_EXS, 0) - NVL(SUM(DECODE(B.GPC_DEAL_APV_STA_CD, '00', NVL(B.GPC_USE_AM, 0), NVL(-B.GPC_USE_AM, 0))), 0) = 0)
	                       THEN '증빙불필요' ELSE '증빙필요' ||'('|| (NVL(D1.RL_FR_EXS,0) - NVL(SUM(DECODE(B.GPC_DEAL_APV_STA_CD, '00', NVL(B.GPC_USE_AM, 0), NVL(-B.GPC_USE_AM, 0))),0)) ||'원)'
	                        END MGN
                      FROM TBBADDED036D A
                          ,TBBADDED036L B
                     WHERE A.CON_TRNSC_ID = B.CON_TRNSC_ID
                       AND A.GPC_TRNSC_GRAM_NO = B.GPC_TRNSC_GRAM_NO
                       AND A.CON_SRNO = B.CON_SRNO
                       AND A.BZT_YR  = D1.BZT_YR
                       AND A.BZT_SNO = D1.BZT_SNO
                       AND A.PCT_CNB = D1.PCT_CNB
                       AND A.SNO = D1.RL_SCO_SNO
                       AND A.AJT_RFC_YN = 'Y'
                       AND D1.CALC_YN = 'Y'
                       AND A.XPN_DVSN_CD = 'TREP')           AS EVD_NCSY_YN              /*교통비-정부구매카드 사용금액=(수기입력 금액)*/
                 , NVL(D1.RL_FR_EXS,0)                       AS RL_FR_EXS                /*철도운임비*/
                 , D1.STND_CHRG_YN                           AS STND_CHRG_YN             /*표준요금여부*/
                 , D2.ORG_CD                                 AS ORG_CD
                 , F_ORG_INFO(D2.ORG_CD,'1')                 AS ORG_NM
                 , F_ORG_INFO(D2.ORG_CD,'1')||'('||D2.ORG_CD||')'                 AS ORG_NM_CD
                 , D2.RGN_CD                                 AS RGN_CD                   /*지역코드*/
                 , F_CODE_NM('1000001',D2.RGN_CD)            AS RGN_NM                   /*지역코드명*/
                 , NVL(D1.MILEAGE,0)                         AS MILEAGE                  /* 주행거리 - 2021.01.26 yyh */
                 , NVL(D1.TOLL,0)                            AS TOLL                     /* 통행료 - 2021.01.26 yyh */
                 , NVL(D1.PARKING_FEE,0)                     AS PARKING_FEE              /* 주차비 - 2021.01.26 yyh */
                 , NVL(D1.RL_GVM_PUR_CRD_EXMP_AM,0)          AS RL_GVM_PUR_CRD_EXMP_AM   /* 철도정부구매카드외금액 - 2021.02.01 yyh */
              FROM TBBADDED017L AS D1
        INNER JOIN TBBADDED011L AS D2 ON D1.BZT_YR = D2.BZT_YR AND D1.BZT_SNO = D2.BZT_SNO AND D1.PCT_CNB = D2.PCT_CNB AND D1.BZT_EXS_SNO = D2.BZT_EXS_SNO AND D1.CALC_YN = D2.CALC_YN
             WHERE 1=1
               AND D1.BZT_YR        = #{bztYr}
               AND D1.BZT_SNO       = #{bztSno}
               AND D1.PCT_CNB       = #{pctCnb}
               AND D1.CALC_YN       = #{calcYn}
          ORDER BY D1.RID_DT, D1.RL_SCO_SNO
            ]]>
        <include refid="include.pageOrder" />
    </select>
    
    
    <!-- 출장자예외내역 조회 - 2017.10.23 yyh --> 
    <select id="selectSubFourList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectSubFourList*/
        <include refid="include.pageSelct" />    
        <![CDATA[
                
                SELECT BZT_YR                                       AS BZT_YR       
                      ,BZT_SNO                                      AS BZT_SNO 
                      ,TEAM_SNO                                     AS TEAM_SNO
                      ,PCT_ALC_SNO                                  AS PCT_ALC_SNO
                      ,PCT_CNB                                      AS PCT_CNB
                      ,PCT_NM                                       AS PCT_NM     
                      ,STF_DVSN_CD                                  AS STF_DVSN_CD
                      ,EX_SNO                                       AS EX_SNO     
                      ,TO_CHAR(TO_DATE(BZT_EX_STR_DT),'YYYY-MM-DD') AS BZT_EX_STR_DT
                      ,TO_CHAR(TO_DATE(BZT_EX_END_DT),'YYYY-MM-DD') AS BZT_EX_END_DT
                      ,BZT_EX_DCN                                   AS BZT_EX_DCN
                      ,BZT_EX_KND_CD                                AS BZT_EX_KND_CD           
                      ,F_CODE_NM('1000833', BZT_EX_KND_CD)          AS BZT_EX_KND_NM
                      ,BZT_EX_RSN_TXT                               AS BZT_EX_RSN_TXT      
                  FROM TBBADDED032L            
                 WHERE BZT_YR      = #{bztYr}
                   AND BZT_SNO     = #{bztSno}
                   AND IPT_DVSN_CD = '2'
                   AND PCT_CNB     = #{pctCnb}
                 ORDER BY BZT_EX_STR_DT
                         ,BZT_EX_END_DT
        ]]>
        <include refid="include.pageOrder" />        
    </select>        
    
    <select id="selectSubSixList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectSubSixList*/
        <include refid="include.pageSelct" />
            <![CDATA[
                    SELECT T1.AUD_SBJ_NM                                                              AS AUD_SBJ_NM    /* 감사사항명 */
				          ,F_DPT_INFO(T2.BZT_BRDV_CD, '1')                                            AS BZT_BRDV_NM   /* 국과 */   
				          ,T1.BZT_BGT_DVSN_CD                                                         AS BZT_BGT_DVSN_CD
				          ,CASE WHEN T1.BZT_BGT_DVSN_CD IN ('2','3') THEN F_CODE_NM('1000751',T1.BZT_BGT_DVSN_CD)      /* 실국배정, 차장배정*/  
				                ELSE F_CODE_NM('1000030',T2.AUD_BZT_KND_CD)                                            /* 원배정 */
				            END                                                                       AS BZT_STEP_NM   /* 출장단계 */
				          ,F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, '', '-') || '(' || T2.AUD_STEP_SNO || ')' AS AUD_YR_NO     /* 감사연번호 */
				          ,TO_CHAR(TO_DATE(T2.AUD_STR_DT), 'YYYY-MM-DD')                              AS AUD_STR_DT    /* 출장시작일 */
				          ,TO_CHAR(TO_DATE(T2.AUD_END_DT), 'YYYY-MM-DD')                              AS AUD_END_DT    /* 출장종료일 */
				          ,AUD_NO
				          ,SUM(NVL(D1.BZT_DCN,0))  			  				  		  AS BZT_DCN 	   /* 최종정산 연인원 */
				          ,NVL(SUM(NVL(D1.LEAD_EXS,0) - NVL(D2.LEAD_EXS,0))
				          - (SELECT SUM(NVL(LODG_DCN,0)* NVL(LDC_STAD_AM,0)) AS LDC
                               FROM TBBADDED011L
                              WHERE BZT_YR = #{bztYr}
                                AND BZT_SNO = #{bztSno}
                                AND CALC_YN = 'Y'
                              GROUP BY BZT_YR, BZT_SNO)
				          + (NVL(T2.LEAD_EXS_AJT_EX_DCN, 0) * (SELECT NVL(BZT_STAD_AM, 0)
										 				         FROM TBBADDED018B A
										 				        WHERE A.TREXP_CLU_CD = '05'
											 			          AND A.AUD_BZT_KND_CD = #{audBztKndCd}
											 			          ]]>
                                                                  <if test="selectImproveYnChkCnt != 0">
										                             AND A.BZT_BGT_DVSN_CD = #{bztBgtDvsnCd}
                                                                     AND A.DT_EXS_DVSN_CD = 'BZT'
                                                                     AND A.RGN_DVSN_CD = '3'
										                          </if>
                                                                  <![CDATA[
											 			          AND A.BZT_SRNO = (SELECT BZT_SRNO
                                                                                      FROM TBBADDED180B
                                                                                     WHERE STAD_STR_DT <= (SELECT AUD_STR_DT
                                                                                                             FROM TBBADDED002M
                                                                                                            WHERE BZT_YR = #{bztYr}
                                                                                                              AND BZT_SNO = #{bztSno})
                                                                                       AND STAD_END_DT >= (SELECT AUD_STR_DT
                                                                                                             FROM TBBADDED002M
                                                                                                            WHERE BZT_YR = #{bztYr}
                                                                                                              AND BZT_SNO = #{bztSno})
                                                                                        AND BZT_DVSN_CD = '1'))),0)  AS LEAD_EXS /* 문답예외일수 변동 금액: 원배정:15,000원, 실국배정:12,000원, 차장배정:15,000원(2024.1.11. 재무행정팀 이시형 감사관 확인 */
				          ,NVL((SELECT SUM(NVL(LEAD_EXS,0))
				              FROM TBBADDED011L
				             WHERE BZT_YR = #{bztYr}
				               AND BZT_SNO = #{bztSno}
				               AND CALC_YN = 'N'), 0)                                                     AS ORIGIN_LEAD_EXS /* 감사현장조사활동비 당초 수령액 */
				          ,T3.ENFM_DVSN_TXT
				          ,T3.ENFM_WAY_CD
                          ,TO_CHAR(TO_DATE(T3.ENFM_DT), 'YYYY-MM-DD') AS ENFM_DT
                          ,T3.ENFM_PLC
                          ,T3.ENFM_TG
                          ,NVL(T3.ENFM_AM, 0) AS ENFM_AM
                          ,T3.CCN
                          ,T3.RMK
                          ,T2.BZT_YR
                          ,T2.BZT_SNO
                          ,T3.SNO
                          ,T3.FRT_REGI_DH
                          ,T3.ENFM_HIS
                          ,T3.REL_INDC_SBJ
                          ,NVL(T2.LEAD_EXS_AJT_EX_DCN, 0) AS AJT_EX_DCN
                          ,NVL((SELECT NVL(BZT_STAD_AM, 0)
                                  FROM TBBADDED018B A
                                 WHERE A.TREXP_CLU_CD = '05'
                                   AND A.AUD_BZT_KND_CD = #{audBztKndCd}
                                   ]]>
                                   <if test="selectImproveYnChkCnt != 0">
                                      AND A.BZT_BGT_DVSN_CD = #{bztBgtDvsnCd}
                                      AND A.DT_EXS_DVSN_CD = 'BZT'
                                      AND A.RGN_DVSN_CD = '3'
                                   </if>
                                   <![CDATA[
                                   AND A.BZT_SRNO = (SELECT BZT_SRNO
                                                       FROM TBBADDED180B
                                                      WHERE STAD_STR_DT <= (SELECT AUD_STR_DT
                                                                              FROM TBBADDED002M
                                                                             WHERE BZT_YR = #{bztYr}
                                                                               AND BZT_SNO = #{bztSno})
                                                        AND STAD_END_DT >= (SELECT AUD_STR_DT
                                                                              FROM TBBADDED002M
                                                                             WHERE BZT_YR = #{bztYr}
                                                                               AND BZT_SNO = #{bztSno})
                                                         AND BZT_DVSN_CD = '1')),0) AS AJT_EX_BZT_STAD_AM
				      FROM  TBBADDED001M T1   /* 감사사항기본 */
				           ,TBBADDED002M T2   /* 출장상황기본 */
				           ,TBBADDED033M T3   /* 감사현장조사수용비집행기본 */
				           ,(SELECT D2.*
                                  , MAX_SNO
                                  , AJT_CHG_RSN 
                               FROM (    SELECT BZT_YR
                                              , BZT_SNO
                                              , PCT_CNB
                                              , MAX(BZT_AJT_SNO) MAX_SNO
                                              , MAX(AJT_CHG_RSN) AJT_CHG_RSN
                                           FROM TBBADDED019H
                                          WHERE BZT_YR  = #{bztYr}
                                            AND BZT_SNO = #{bztSno}
                                            AND NVL(AJT_YN,'N') = 'N'
                                          GROUP BY BZT_YR , BZT_SNO , PCT_CNB ) D1
                                 , VADED001 D2
                              WHERE 1=1
                                AND D1.BZT_YR  = D2.BZT_YR
                                AND D1.BZT_SNO = D2.BZT_SNO
                                AND D1.PCT_CNB = D2.PCT_CNB
                                AND D1.MAX_SNO = D2.BZT_AJT_SNO
                                AND D1.BZT_YR  = #{bztYr}
                                AND D1.BZT_SNO = #{bztSno}
                           ) D1
                         , (
                             SELECT D2.* 
                               FROM (    SELECT BZT_YR
                                              , BZT_SNO
                                              , PCT_CNB
                                              , MAX(BZT_AJT_SNO) MAX_SNO
                                           FROM TBBADDED019H
                                          WHERE BZT_YR  = #{bztYr}
                                            AND BZT_SNO = #{bztSno}
                                            AND NVL(AJT_YN,'N') = 'Y'
                                          GROUP BY BZT_YR , BZT_SNO , PCT_CNB ) D1
                                 , VADED001 D2
                              WHERE 1=1
                                AND D1.BZT_YR  = D2.BZT_YR
                                AND D1.BZT_SNO = D2.BZT_SNO
                                AND D1.PCT_CNB = D2.PCT_CNB
                                AND D1.MAX_SNO = D2.BZT_AJT_SNO 
                                AND D1.BZT_YR  = #{bztYr}
                                AND D1.BZT_SNO = #{bztSno}
                           ) D2
				     WHERE 1=1
				       AND T1.AUD_YR       = T2.REL_AUD_YR
				       AND T1.AUD_NO       = T2.REL_AUD_NO 
				       AND T1.AUD_YR       = #{audYr}
				       AND T1.AUD_NO       = #{audNo}
				       AND T2.AUD_STEP_SNO = #{audStepSno}
				       AND T2.BZT_YR 	   = T3.BZT_YR(+)
                       AND T2.BZT_SNO 	   = T3.BZT_SNO(+)
                       AND T2.BZT_YR       = D1.BZT_YR(+)
                       AND T2.BZT_SNO      = D1.BZT_SNO(+)
                       AND D1.BZT_YR       = D2.BZT_YR(+)
                       AND D1.BZT_SNO      = D2.BZT_SNO(+)
                       AND D1.PCT_CNB      = D2.PCT_CNB(+)
                     GROUP BY AUD_SBJ_NM, BZT_BRDV_CD, BZT_BGT_DVSN_CD, AUD_BZT_KND_CD, AUD_YR, AUD_NO, AUD_STEP_SNO
                     		, AUD_STR_DT, AUD_END_DT, AUD_NO, ENFM_DVSN_TXT, ENFM_WAY_CD, ENFM_DT, ENFM_PLC, ENFM_TG
                       		, ENFM_AM, CCN, RMK, T2.BZT_YR, T2.BZT_SNO, SNO, T3.FRT_REGI_DH, T2.LEAD_EXS_AJT_EX_DCN,T3.ENFM_HIS,T3.REL_INDC_SBJ
                     ORDER BY T3.ENFM_DT, T3.FRT_REGI_DH, T3.SNO
            ]]>
        <include refid="include.pageOrder" />
    </select>
    
    <select id="selectSubSevenList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectSubSevenList*/
        <include refid="include.pageSelct" />
            <![CDATA[
                    SELECT T1.AUD_SBJ_NM                                                              AS AUD_SBJ_NM    /* 감사사항명 */
				          ,F_DPT_INFO(T2.BZT_BRDV_CD, '1')                                            AS BZT_BRDV_NM   /* 국과 */    
				          ,CASE WHEN T1.BZT_BGT_DVSN_CD IN ('2','3') THEN F_CODE_NM('1000751',T1.BZT_BGT_DVSN_CD)      /* 실국배정, 차장배정*/  
				                ELSE F_CODE_NM('1000030',T2.AUD_BZT_KND_CD)                                            /* 원배정 */
				            END                                                                       AS BZT_STEP_NM   /* 출장단계 */
				          ,F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, '', '-') || '(' || T2.AUD_STEP_SNO || ')' AS AUD_YR_NO     /* 감사연번호 */
				          ,TO_CHAR(TO_DATE(T2.AUD_STR_DT), 'YYYY-MM-DD')                              AS AUD_STR_DT    /* 출장시작일 */
				          ,TO_CHAR(TO_DATE(T2.AUD_END_DT), 'YYYY-MM-DD')                              AS AUD_END_DT    /* 출장종료일 */
				          ,AUD_NO
				          ,SUM(NVL(D1.BZT_DCN,0))  			  				  		  AS BZT_DCN 	   /* 최종정산 연인원 */
				          ,NVL((SELECT NVL(SUM(NVL(NOW, 0)) - SUM(NVL(PRE, 0)), 0)
						         FROM (SELECT DECODE(A.CALC_YN, 'Y', NVL(A.AUD_ACTV_RCV_EXS, 0), NULL) NOW
							                , DECODE(A.CALC_YN, 'N', NVL(A.AUD_ACTV_RCV_EXS, 0), NULL) PRE
							             FROM TBBADDED011L A
						                WHERE A.BZT_YR = #{bztYr}
						                  AND A.BZT_SNO = #{bztSno})) + (NVL(T2.RCV_EXS_AJT_EX_DCN, 0) * (SELECT NVL(BZT_STAD_AM, 0)
                                                                                                            FROM TBBADDED018B A
                                                                                                           WHERE A.TREXP_CLU_CD = '07'
                                                                                                             AND A.RGN_DVSN_CD = '0'
                                                                                                             AND A.AUD_BZT_KND_CD = #{audBztKndCd}
                                                                                                             ]]>
											                                                                  <if test="selectImproveYnChkCnt != 0">
																					                             AND A.BZT_BGT_DVSN_CD = #{bztBgtDvsnCd}
											                                                                     AND A.DT_EXS_DVSN_CD = 'BZT'
																					                          </if>
											                                                                  <![CDATA[
                                                                                                             AND A.BZT_SRNO = (SELECT BZT_SRNO
                                                                                                                                 FROM TBBADDED180B
                                                                                                                                WHERE STAD_STR_DT <= (SELECT AUD_STR_DT
                                                                                                                                                        FROM TBBADDED002M
                                                                                                                                                       WHERE BZT_YR = #{bztYr}
                                                                                                                                                         AND BZT_SNO = #{bztSno})
                                                                                                                                  AND STAD_END_DT >= (SELECT AUD_STR_DT
                                                                                                                                                        FROM TBBADDED002M
                                                                                                                                                       WHERE BZT_YR = #{bztYr}
                                                                                                                                                         AND BZT_SNO = #{bztSno})
                                                                                                                                   AND BZT_DVSN_CD = '1'))),0) AS  AUD_ACTV_RCV_EXS /* 원배정:7,000원, 실국배정:0원, 차장배정:5,000원 */
				          ,NVL((SELECT SUM(NVL(AUD_ACTV_RCV_EXS,0))
				              FROM TBBADDED011L
				             WHERE BZT_YR = #{bztYr}
				               AND BZT_SNO = #{bztSno}
				               AND CALC_YN = 'N'), 0)                                                     AS ORIGIN_AUD_ACTV_RCV_EXS /* 감사현장조사수용비 당초 수령액 */
				          ,T3.ENFM_DVSN_TXT
                          ,TO_CHAR(TO_DATE(T3.ENFM_DT), 'YYYY-MM-DD') AS ENFM_DT
                          ,T3.ENFM_TG
                          ,T3.GDS_NM
                          ,T3.AUD_UTL_TXT
                          ,T3.EVD_NO
                          ,NVL(T3.ENFM_AM, 0) AS ENFM_AM
                          ,T2.BZT_YR
                          ,T2.BZT_SNO
                          ,T3.SNO
                          ,T3.FRT_REGI_DH
                          ,NVL(T2.RCV_EXS_AJT_EX_DCN, 0) AS AJT_EX_DCN
                          ,NVL((SELECT NVL(BZT_STAD_AM, 0)
				 				  FROM TBBADDED018B A
				 				 WHERE A.TREXP_CLU_CD = '07'
				 				   AND A.RGN_DVSN_CD = '0'
					 			   AND A.AUD_BZT_KND_CD = #{audBztKndCd}
					 			   ]]>
                                   <if test="selectImproveYnChkCnt != 0">
				                       AND A.BZT_BGT_DVSN_CD = #{bztBgtDvsnCd}
                                       AND A.DT_EXS_DVSN_CD = 'BZT'
				                   </if>
                                   <![CDATA[
					 			   AND A.BZT_SRNO = (SELECT BZT_SRNO
                                                       FROM TBBADDED180B
                                                      WHERE STAD_STR_DT <= (SELECT AUD_STR_DT
                                                                              FROM TBBADDED002M
                                                                             WHERE BZT_YR = #{bztYr}
                                                                               AND BZT_SNO = #{bztSno})
                                                        AND STAD_END_DT >= (SELECT AUD_STR_DT
                                                                              FROM TBBADDED002M
                                                                             WHERE BZT_YR = #{bztYr}
                                                                               AND BZT_SNO = #{bztSno})
                                                         AND BZT_DVSN_CD = '1')),0) AS AJT_EX_BZT_STAD_AM
				      FROM  TBBADDED001M T1   /* 감사사항기본 */
				           ,TBBADDED002M T2   /* 출장상황기본 */
				           ,TBBADDED034M T3   /* 감사현장조사수용비집행기본 */
				           ,(SELECT D2.*
                                  , MAX_SNO
                                  , AJT_CHG_RSN 
                               FROM (    SELECT BZT_YR
                                              , BZT_SNO
                                              , PCT_CNB
                                              , MAX(BZT_AJT_SNO) MAX_SNO
                                              , MAX(AJT_CHG_RSN) AJT_CHG_RSN
                                           FROM TBBADDED019H
                                          WHERE BZT_YR  = #{bztYr}
                                            AND BZT_SNO = #{bztSno}
                                            AND NVL(AJT_YN,'N') = 'N'
                                          GROUP BY BZT_YR , BZT_SNO , PCT_CNB ) D1
                                 , VADED001 D2
                              WHERE 1=1
                                AND D1.BZT_YR  = D2.BZT_YR
                                AND D1.BZT_SNO = D2.BZT_SNO
                                AND D1.PCT_CNB = D2.PCT_CNB
                                AND D1.MAX_SNO = D2.BZT_AJT_SNO
                                AND D1.BZT_YR  = #{bztYr}
                                AND D1.BZT_SNO = #{bztSno}
                           ) D1
	                         , (
	                             SELECT D2.* 
	                               FROM (    SELECT BZT_YR
	                                              , BZT_SNO
	                                              , PCT_CNB
	                                              , MAX(BZT_AJT_SNO) MAX_SNO
	                                           FROM TBBADDED019H
	                                          WHERE BZT_YR  = #{bztYr}
	                                            AND BZT_SNO = #{bztSno}
	                                            AND NVL(AJT_YN,'N') = 'Y'
	                                          GROUP BY BZT_YR , BZT_SNO , PCT_CNB ) D1
	                                 , VADED001 D2
	                              WHERE 1=1
	                                AND D1.BZT_YR  = D2.BZT_YR
	                                AND D1.BZT_SNO = D2.BZT_SNO
	                                AND D1.PCT_CNB = D2.PCT_CNB
	                                AND D1.MAX_SNO = D2.BZT_AJT_SNO 
	                                AND D1.BZT_YR  = #{bztYr}
	                                AND D1.BZT_SNO = #{bztSno}
	                           ) D2
					     WHERE 1=1
					       AND T1.AUD_YR       = T2.REL_AUD_YR
					       AND T1.AUD_NO       = T2.REL_AUD_NO 
					       AND T1.AUD_YR       = #{audYr}
					       AND T1.AUD_NO       = #{audNo}
					       AND T2.AUD_STEP_SNO = #{audStepSno}
					       AND T2.BZT_YR 	   = T3.BZT_YR(+)
					       AND T2.BZT_SNO 	   = T3.BZT_SNO(+)
	                       AND T2.BZT_YR       = D1.BZT_YR(+)
	                       AND T2.BZT_SNO      = D1.BZT_SNO(+)
	                       AND D1.BZT_YR       = D2.BZT_YR(+)
	                       AND D1.BZT_SNO      = D2.BZT_SNO(+)
	                       AND D1.PCT_CNB      = D2.PCT_CNB(+)
	                     GROUP BY AUD_SBJ_NM, BZT_BRDV_CD, BZT_BGT_DVSN_CD, AUD_BZT_KND_CD, AUD_YR, AUD_NO, AUD_STEP_SNO
	                     		, AUD_STR_DT, AUD_END_DT, AUD_NO, ENFM_DVSN_TXT, ENFM_DT, ENFM_TG, GDS_NM, AUD_UTL_TXT
	                       		, EVD_NO, ENFM_AM, T2.BZT_YR, T2.BZT_SNO, SNO, T3.FRT_REGI_DH, T2.RCV_EXS_AJT_EX_DCN
	                     ORDER BY T3.ENFM_DT, T3.FRT_REGI_DH, T3.SNO
            ]]>
        <include refid="include.pageOrder" />
    </select>
    
    <select id="selectExcelList6" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectExcelList6*/
            <![CDATA[
                    SELECT T1.AUD_SBJ_NM                                                              AS AUD_SBJ_NM    /* 감사사항명 */
				          ,F_DPT_INFO(SUBSTR(T2.BZT_BRDV_CD,1,3) || '000', '1') AS SCH_SPV_BRDV_NM  /* 국 */
      					  ,F_DPT_INFO(T2.BZT_BRDV_CD, '1')                      AS SCH_DEPT_NM      /* 과 */
      					  ,(SELECT USR_NAM
						      FROM TBDCMACM001M
						     WHERE DPT_CD = T2.BZT_BRDV_CD
						       AND PST_CD = '0035100')  AS USR_NAM /* 단장명 */
						  ,T1.BZT_BGT_DVSN_CD                                                         AS BZT_BGT_DVSN_CD
				          ,CASE WHEN T1.BZT_BGT_DVSN_CD IN ('2','3') THEN F_CODE_NM('1000751',T1.BZT_BGT_DVSN_CD)      /* 실국배정, 차장배정*/  
				                ELSE F_CODE_NM('1000030',T2.AUD_BZT_KND_CD)                                            /* 원배정 */
				            END                                                                       AS BZT_STEP_NM   /* 출장단계 */
				          ,F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, '', '-') || '(' || T2.AUD_STEP_SNO || ')' AS AUD_YR_NO     /* 감사연번호 */
				          ,TO_CHAR(TO_DATE(T2.AUD_STR_DT), 'YYYY-MM-DD')                              AS AUD_STR_DT    /* 출장시작일 */
				          ,TO_CHAR(TO_DATE(T2.AUD_END_DT), 'YYYY-MM-DD')                              AS AUD_END_DT    /* 출장종료일 */
				          ,T1.AUD_YR
				          ,T1.AUD_NO
				          ,T2.AUD_STEP_SNO
				          ,SUM(NVL(D1.BZT_DCN,0))  			  				  		  	  AS BZT_DCN 	   /* 최종정산 연인원 */
                          ,NVL(SUM(NVL(D1.LEAD_EXS,0) - NVL(D2.LEAD_EXS,0))
				          - (SELECT SUM(NVL(LODG_DCN,0)* NVL(LDC_STAD_AM,0)) AS LDC
                               FROM TBBADDED011L
                              WHERE BZT_YR = #{bztYr}
                                AND BZT_SNO = #{bztSno}
                                AND CALC_YN = 'Y'
                              GROUP BY BZT_YR, BZT_SNO)
				          + (NVL(T2.LEAD_EXS_AJT_EX_DCN, 0) * (SELECT NVL(BZT_STAD_AM, 0)
										 				         FROM TBBADDED018B A
										 				        WHERE A.TREXP_CLU_CD = '05'
											 			          AND A.AUD_BZT_KND_CD = #{audBztKndCd}
											 			          ]]>
                                                                  <if test="selectImproveYnChkCnt != 0">
										                             AND A.BZT_BGT_DVSN_CD = #{bztBgtDvsnCd}
                                                                     AND A.DT_EXS_DVSN_CD = 'BZT'
                                                                     AND A.RGN_DVSN_CD = '3'
										                          </if>
                                                                  <![CDATA[
											 			          AND A.BZT_SRNO = (SELECT BZT_SRNO
                                                                                      FROM TBBADDED180B
                                                                                     WHERE STAD_STR_DT <= (SELECT AUD_STR_DT
                                                                                                             FROM TBBADDED002M
                                                                                                            WHERE BZT_YR = #{bztYr}
                                                                                                              AND BZT_SNO = #{bztSno})
                                                                                       AND STAD_END_DT >= (SELECT AUD_STR_DT
                                                                                                             FROM TBBADDED002M
                                                                                                            WHERE BZT_YR = #{bztYr}
                                                                                                              AND BZT_SNO = #{bztSno})
                                                                                        AND BZT_DVSN_CD = '1'))),0)  AS LEAD_EXS /* 문답예외일수 변동 금액: 원배정:15,000원, 실국배정:12,000원, 차장배정:15,000원(2024.1.11. 재무행정팀 이시형 감사관 확인 */
				          ,NVL((SELECT SUM(NVL(LEAD_EXS,0))
				              FROM TBBADDED011L
				             WHERE BZT_YR = #{bztYr}
				               AND BZT_SNO = #{bztSno}
				               AND CALC_YN = 'N'), 0)                                                     AS ORIGIN_LEAD_EXS /* 감사현장조사활동비 당초 수령액 */
				          ,T3.ENFM_DVSN_TXT
				          ,DECODE(T3.ENFM_WAY_CD , 'A', '정부구매카드', 'B', '개인카드', 'C', '현금') AS ENFM_WAY_CD
                          ,TO_CHAR(TO_DATE(T3.ENFM_DT), 'YYYY-MM-DD') AS ENFM_DT
                          ,T3.ENFM_PLC
                          ,T3.ENFM_TG
                          ,NVL(T3.ENFM_AM, 0) AS ENFM_AM
                          ,T3.CCN
                          ,T3.RMK
                          ,T2.BZT_YR
                          ,T2.BZT_SNO
                          ,T3.SNO
                          ,T3.ENFM_HIS
                          ,T3.REL_INDC_SBJ
				      FROM  TBBADDED001M T1   /* 감사사항기본 */
				           ,TBBADDED002M T2   /* 출장상황기본 */
				           ,TBBADDED033M T3   /* 감사현장조사수용비집행기본 */
				           ,(SELECT D2.*
                                  , MAX_SNO
                                  , AJT_CHG_RSN 
                               FROM (    SELECT BZT_YR
                                              , BZT_SNO
                                              , PCT_CNB
                                              , MAX(BZT_AJT_SNO) MAX_SNO
                                              , MAX(AJT_CHG_RSN) AJT_CHG_RSN
                                           FROM TBBADDED019H
                                          WHERE BZT_YR  = #{bztYr}
                                            AND BZT_SNO = #{bztSno}
                                            AND NVL(AJT_YN,'N') = 'N'
                                          GROUP BY BZT_YR , BZT_SNO , PCT_CNB ) D1
                                 , VADED001 D2
                              WHERE 1=1
                                AND D1.BZT_YR  = D2.BZT_YR
                                AND D1.BZT_SNO = D2.BZT_SNO
                                AND D1.PCT_CNB = D2.PCT_CNB
                                AND D1.MAX_SNO = D2.BZT_AJT_SNO
                                AND D1.BZT_YR  = #{bztYr}
                                AND D1.BZT_SNO = #{bztSno}
                           ) D1
                         , (
                             SELECT D2.* 
                               FROM (    SELECT BZT_YR
                                              , BZT_SNO
                                              , PCT_CNB
                                              , MAX(BZT_AJT_SNO) MAX_SNO
                                           FROM TBBADDED019H
                                          WHERE BZT_YR  = #{bztYr}
                                            AND BZT_SNO = #{bztSno}
                                            AND NVL(AJT_YN,'N') = 'Y'
                                          GROUP BY BZT_YR , BZT_SNO , PCT_CNB ) D1
                                 , VADED001 D2
                              WHERE 1=1
                                AND D1.BZT_YR  = D2.BZT_YR
                                AND D1.BZT_SNO = D2.BZT_SNO
                                AND D1.PCT_CNB = D2.PCT_CNB
                                AND D1.MAX_SNO = D2.BZT_AJT_SNO 
                                AND D1.BZT_YR  = #{bztYr}
                                AND D1.BZT_SNO = #{bztSno}
                           ) D2
				     WHERE 1=1
				       AND T1.AUD_YR       = T2.REL_AUD_YR
				       AND T1.AUD_NO       = T2.REL_AUD_NO 
				       AND T1.AUD_YR       = #{audYr}
				       AND T1.AUD_NO       = #{audNo}
				       AND T2.AUD_STEP_SNO = #{audStepSno}
				       AND T2.BZT_YR 	   = T3.BZT_YR(+)
                       AND T2.BZT_SNO 	   = T3.BZT_SNO(+)
                       AND T2.BZT_YR       = D1.BZT_YR(+)
                       AND T2.BZT_SNO      = D1.BZT_SNO(+)
                       AND D1.BZT_YR       = D2.BZT_YR(+)
                       AND D1.BZT_SNO      = D2.BZT_SNO(+)
                       AND D1.PCT_CNB      = D2.PCT_CNB(+)
                     GROUP BY AUD_SBJ_NM, BZT_BRDV_CD, BZT_BGT_DVSN_CD, AUD_BZT_KND_CD, AUD_YR, AUD_NO, AUD_STEP_SNO
                     		, AUD_STR_DT, AUD_END_DT, AUD_NO, ENFM_DVSN_TXT, ENFM_WAY_CD, ENFM_DT, ENFM_PLC, ENFM_TG
                       		, ENFM_AM, CCN, RMK, T2.BZT_YR, T2.BZT_SNO, SNO, T3.FRT_REGI_DH, T2.LEAD_EXS_AJT_EX_DCN,T3.ENFM_HIS,T3.REL_INDC_SBJ
                     ORDER BY T3.ENFM_DT, T3.FRT_REGI_DH, T3.SNO
            ]]>
    </select>
    
    <select id="selectUseRqsStaCd" parameterType="paramMap" resultType="String">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectUseRqsStaCd*/
            <![CDATA[
            	SELECT USE_RQS_STA_CD 
				  FROM (SELECT B.USE_RQS_STA_CD
				          FROM TBDCMACM001M A
				              ,TBBADDED035M B
				         WHERE A.CNB     = B.PCT_CNB
				           AND A.GPC_NO  = B.GPC_NO
				           AND B.PCT_CNB = #{pctCnb}
				           ORDER BY B.SNO DESC, B.FRT_REGI_DH DESC )
				 WHERE ROWNUM = 1
            ]]>
    </select>
    
    <select id="selectRcdbPbsvtNam" parameterType="paramMap" resultType="String">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectRcdbPbsvtNam*/
            <![CDATA[
            	SELECT LISTAGG(A.USR_NAM||'('||F_DPT_INFO(A.DPT_CD,'1')||')', ', ') WITHIN GROUP(ORDER BY A.USR_NAM) AS RCDB_PBSVT_NAM
				  FROM TBDCMACM001M A
				 WHERE A.RCDB_PBSVT_YN = 'Y'
				   AND A.DPT_CD LIKE SUBSTR(#{bltBrdvCd}, 0,3)||'%'
            ]]>
    </select>
    
    <select id="selectLocalLodgAdtExs" parameterType="paramMap" resultType="integer">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectLocalLodgAdtExs*/
            <![CDATA[
                    SELECT CASE WHEN SUM(NVL(D.LODG_DCN,0)* NVL(D.LDC_STAD_AM,0)) IS NULL THEN (SELECT NVL(B.BZT_STAD_AM, 0)
													                                            FROM TBBADDED180B A
													                                                ,TBBADDED018B B
													                                         WHERE 1=1
													                                           AND A.BZT_SRNO = B.BZT_SRNO
													                                           AND B.TREXP_CLU_CD = '03'
													                                           AND A.BZT_DVSN_CD <> '2'
													                                           AND B.TREXP_CLU_SEQ = #{bztBgtDvsnCd}
													                                           AND A.STAD_STR_DT <= (SELECT AUD_STR_DT
													                                                                   FROM TBBADDED002M
													                                                                  WHERE BZT_YR  = #{bztYr}
													                                                                    AND BZT_SNO = #{bztSno}
													                                                                 )
													                                           AND A.STAD_END_DT >= (SELECT AUD_STR_DT
													                                                                   FROM TBBADDED002M
													                                                                  WHERE BZT_YR  = #{bztYr}
													                                                                    AND BZT_SNO = #{bztSno}
													                                                                 )
													                                              ) * SUM(NVL(D.LODG_DCN,0))
					
					       ELSE SUM(NVL(D.LODG_DCN,0)* NVL(D.LDC_STAD_AM,0))
					       END LDC
                      FROM TBBADDED002M C
                           LEFT OUTER JOIN TBBADDED011L D ON (C.BZT_YR = D.BZT_YR AND C.BZT_SNO = D.BZT_SNO)
                     WHERE C.BZT_YR = #{bztYr}
                       AND C.BZT_SNO = #{bztSno}
                     GROUP BY C.BZT_YR, C.BZT_SNO
            ]]>
    </select>
    
    <select id="selectSumEnfmAm01" parameterType="paramMap" resultType="integer">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectSumEnfmAm01*/
            <![CDATA[
                    SELECT NVL(SUM(ENFM_AM), 0) AS ENFM_AM
		              FROM TBBADDED033M
		             WHERE BZT_YR  = #{bztYr}
		               AND BZT_SNO = #{bztSno}
            ]]>
    </select>
    
    <select id="selectSumEnfmAm02" parameterType="paramMap" resultType="integer">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectSumEnfmAm02*/
            <![CDATA[
                    SELECT NVL(SUM(ENFM_AM), 0) AS ENFM_AM
		              FROM TBBADDED034M
		             WHERE BZT_YR  = #{bztYr}
		               AND BZT_SNO = #{bztSno}
            ]]>
    </select>
    
    <select id="selectExcelList7" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectExcelList7*/
            <![CDATA[
                    SELECT T1.AUD_SBJ_NM                                                              AS AUD_SBJ_NM    /* 감사사항명 */
				          ,F_DPT_INFO(SUBSTR(T2.BZT_BRDV_CD,1,3) || '000', '1') AS SCH_SPV_BRDV_NM  /* 국 */
      					  ,F_DPT_INFO(T2.BZT_BRDV_CD, '1')                      AS SCH_DEPT_NM      /* 과 */
      					  ,(SELECT USR_NAM
						      FROM TBDCMACM001M
						     WHERE DPT_CD = T2.BZT_BRDV_CD
						       AND PST_CD = '0035100')  AS USR_NAM /* 단장명 */    
				          ,CASE WHEN T1.BZT_BGT_DVSN_CD IN ('2','3') THEN F_CODE_NM('1000751',T1.BZT_BGT_DVSN_CD)      /* 실국배정, 차장배정*/  
				                ELSE F_CODE_NM('1000030',T2.AUD_BZT_KND_CD)                                            /* 원배정 */
				            END                                                                       AS BZT_STEP_NM   /* 출장단계 */
				          ,F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, '', '-') || '(' || T2.AUD_STEP_SNO || ')' AS AUD_YR_NO     /* 감사연번호 */
				          ,TO_CHAR(TO_DATE(T2.AUD_STR_DT), 'YYYY-MM-DD')                              AS AUD_STR_DT    /* 출장시작일 */
				          ,TO_CHAR(TO_DATE(T2.AUD_END_DT), 'YYYY-MM-DD')                              AS AUD_END_DT    /* 출장종료일 */
				          ,T1.AUD_YR
				          ,T1.AUD_NO
				          ,T2.AUD_STEP_SNO
				          ,SUM(NVL(D1.BZT_DCN,0))  			  				  		  AS BZT_DCN 	   /* 최종정산 연인원 */
				          ,NVL((SELECT NVL(SUM(NVL(NOW, 0)) - SUM(NVL(PRE, 0)), 0)
						         FROM (SELECT DECODE(A.CALC_YN, 'Y', NVL(A.AUD_ACTV_RCV_EXS, 0), NULL) NOW
							                , DECODE(A.CALC_YN, 'N', NVL(A.AUD_ACTV_RCV_EXS, 0), NULL) PRE
							             FROM TBBADDED011L A
						                WHERE A.BZT_YR = #{bztYr}
						                  AND A.BZT_SNO = #{bztSno})) + (NVL(T2.RCV_EXS_AJT_EX_DCN, 0) * (SELECT NVL(BZT_STAD_AM, 0)
                                                                                                            FROM TBBADDED018B A
                                                                                                           WHERE A.TREXP_CLU_CD = '07'
                                                                                                             AND A.RGN_DVSN_CD = '0'
                                                                                                             AND A.AUD_BZT_KND_CD = #{audBztKndCd}
                                                                                                             ]]>
                                                                                                             <if test="selectImproveYnChkCnt != 0">
																					                         AND A.BZT_BGT_DVSN_CD = #{bztBgtDvsnCd}
                                                                                                             AND A.DT_EXS_DVSN_CD = 'BZT'
																					                        </if>
                                                                                                             <![CDATA[
                                                                                                             AND A.BZT_SRNO = (SELECT BZT_SRNO
                                                                                                                                 FROM TBBADDED180B
                                                                                                                                WHERE STAD_STR_DT <= (SELECT AUD_STR_DT
                                                                                                                                                        FROM TBBADDED002M
                                                                                                                                                       WHERE BZT_YR = #{bztYr}
                                                                                                                                                         AND BZT_SNO = #{bztSno})
                                                                                                                                  AND STAD_END_DT >= (SELECT AUD_STR_DT
                                                                                                                                                        FROM TBBADDED002M
                                                                                                                                                       WHERE BZT_YR = #{bztYr}
                                                                                                                                                         AND BZT_SNO = #{bztSno})
                                                                                                                                   AND BZT_DVSN_CD = '1'))),0) AS  AUD_ACTV_RCV_EXS /* 원배정:7,000원, 실국배정:0원, 차장배정:5,000원 */
				          ,NVL((SELECT SUM(NVL(AUD_ACTV_RCV_EXS,0))
				              FROM TBBADDED011L
				             WHERE BZT_YR = #{bztYr}
				               AND BZT_SNO = #{bztSno}
				               AND CALC_YN = 'N'), 0)                                                     AS ORIGIN_AUD_ACTV_RCV_EXS /* 감사현장조사수용비 당초 수령액 */
				          ,T3.ENFM_DVSN_TXT
                          ,TO_CHAR(TO_DATE(T3.ENFM_DT), 'YYYY-MM-DD') AS ENFM_DT
                          ,T3.ENFM_TG
                          ,T3.GDS_NM 								/* 품명 */
                          ,T3.AUD_UTL_TXT 							/* 감사활동내용 */
                          ,T3.EVD_NO 								/* 증빙번호 */
                          ,NVL(T3.ENFM_AM, 0) AS ENFM_AM
                          ,T2.BZT_YR
                          ,T2.BZT_SNO
                          ,T3.SNO
                          ,T3.FRT_REGI_DH
				      FROM  TBBADDED001M T1   /* 감사사항기본 */
				           ,TBBADDED002M T2   /* 출장상황기본 */
				           ,TBBADDED034M T3   /* 감사현장조사수용비집행기본 */
				           ,(SELECT D2.*
                                  , MAX_SNO
                                  , AJT_CHG_RSN 
                               FROM (    SELECT BZT_YR
                                              , BZT_SNO
                                              , PCT_CNB
                                              , MAX(BZT_AJT_SNO) MAX_SNO
                                              , MAX(AJT_CHG_RSN) AJT_CHG_RSN
                                           FROM TBBADDED019H
                                          WHERE BZT_YR  = #{bztYr}
                                            AND BZT_SNO = #{bztSno}
                                            AND NVL(AJT_YN,'N') = 'N'
                                          GROUP BY BZT_YR , BZT_SNO , PCT_CNB ) D1
                                 , VADED001 D2
                              WHERE 1=1
                                AND D1.BZT_YR  = D2.BZT_YR
                                AND D1.BZT_SNO = D2.BZT_SNO
                                AND D1.PCT_CNB = D2.PCT_CNB
                                AND D1.MAX_SNO = D2.BZT_AJT_SNO
                                AND D1.BZT_YR  = #{bztYr}
                                AND D1.BZT_SNO = #{bztSno}
                           ) D1
	                         , (
	                             SELECT D2.* 
	                               FROM (    SELECT BZT_YR
	                                              , BZT_SNO
	                                              , PCT_CNB
	                                              , MAX(BZT_AJT_SNO) MAX_SNO
	                                           FROM TBBADDED019H
	                                          WHERE BZT_YR  = #{bztYr}
	                                            AND BZT_SNO = #{bztSno}
	                                            AND NVL(AJT_YN,'N') = 'Y'
	                                          GROUP BY BZT_YR , BZT_SNO , PCT_CNB ) D1
	                                 , VADED001 D2
	                              WHERE 1=1
	                                AND D1.BZT_YR  = D2.BZT_YR
	                                AND D1.BZT_SNO = D2.BZT_SNO
	                                AND D1.PCT_CNB = D2.PCT_CNB
	                                AND D1.MAX_SNO = D2.BZT_AJT_SNO 
	                                AND D1.BZT_YR  = #{bztYr}
	                                AND D1.BZT_SNO = #{bztSno}
	                           ) D2
					     WHERE 1=1
					       AND T1.AUD_YR       = T2.REL_AUD_YR
					       AND T1.AUD_NO       = T2.REL_AUD_NO 
					       AND T1.AUD_YR       = #{audYr}
					       AND T1.AUD_NO       = #{audNo}
					       AND T2.AUD_STEP_SNO = #{audStepSno}
					       AND T2.BZT_YR 	   = T3.BZT_YR(+)
					       AND T2.BZT_SNO 	   = T3.BZT_SNO(+)
	                       AND T2.BZT_YR       = D1.BZT_YR(+)
	                       AND T2.BZT_SNO      = D1.BZT_SNO(+)
	                       AND D1.BZT_YR       = D2.BZT_YR(+)
	                       AND D1.BZT_SNO      = D2.BZT_SNO(+)
	                       AND D1.PCT_CNB      = D2.PCT_CNB(+)
	                     GROUP BY AUD_SBJ_NM, BZT_BRDV_CD, BZT_BGT_DVSN_CD, AUD_BZT_KND_CD, AUD_YR, AUD_NO, AUD_STEP_SNO
	                     		, AUD_STR_DT, AUD_END_DT, AUD_NO, ENFM_DVSN_TXT, ENFM_DT, ENFM_TG, GDS_NM, AUD_UTL_TXT
	                       		, EVD_NO, ENFM_AM, T2.BZT_YR, T2.BZT_SNO, SNO, T3.FRT_REGI_DH, T2.RCV_EXS_AJT_EX_DCN
	                     ORDER BY T3.ENFM_DT, T3.FRT_REGI_DH, T3.SNO
            ]]>
    </select>
    
    <insert id="insertTBBADDED033M" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.insertTBBADDED033M*/
        INSERT INTO TBBADDED033M(  BZT_YR
                                 , BZT_SNO
                                 , SNO
                                 , ENFM_DVSN_TXT
                                 , ENFM_WAY_CD
                                 , ENFM_DT
                                 , ENFM_PLC
                                 , ENFM_TG
                                 , ENFM_AM
                                 , CCN
                                 , RMK
                                 , FRT_USR_ID
                                 , FNL_USR_ID
                                 , FNL_DEAL_DPT_CD
                                 , FNL_MNU_ID
                                 , FRT_REGI_DH
                                 , FNL_MDF_DH
                                 , ENFM_HIS
                                 , REL_INDC_SBJ )
                          VALUES ( #{bztYr}
                                 , #{bztSno}
                                 , TBBADDED033M_SEQ.NEXTVAL
                                 , #{enfmDvsnTxt}
                                 , #{enfmWayCd}
                                 , TO_CHAR(TO_DATE(#{enfmDt}), 'YYYYMMDD')
                                 , #{enfmPlc}
                                 , #{enfmTg}
                                 , #{enfmAm}
                                 , #{ccn}
                                 , #{rmk}
                                 , #{frtUsrId}
                                 , #{fnlUsrId}
                                 , #{fnlDealDptCd}
                                 , #{fnlMnuId}
                                 , SYSDATE
                                 , SYSDATE
                                 , #{enfmHis}
                                 , #{relIndcSbj} )
    </insert>
    
    
    <update id="updateTBBADDED033M" parameterType="paramMap">
	/*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.updateTBBADDED033M */
		UPDATE TBBADDED033M
		   SET ENFM_DVSN_TXT = #{enfmDvsnTxt}
		     , ENFM_HIS   	 = #{enfmHis}
		     , REL_INDC_SBJ  = #{relIndcSbj}
		     , ENFM_WAY_CD   = #{enfmWayCd}
		     , ENFM_DT		 = TO_CHAR(TO_DATE(#{enfmDt}), 'YYYYMMDD')
             , ENFM_PLC		 = #{enfmPlc}
             , ENFM_TG		 = #{enfmTg}
             , ENFM_AM		 = #{enfmAm}
             , CCN			 = #{ccn}
             , RMK			 = #{rmk}
             , FNL_USR_ID    = #{fnlUsrId}
             , FNL_MDF_DH    = SYSDATE
         WHERE BZT_YR  = #{bztYr}
           AND BZT_SNO = #{bztSno}
           AND SNO     = #{sno}
	</update>
    
    
     <select id="selectEnfmWayList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectEnfmWayList*/
        <![CDATA[
               SELECT CD
                    , CD_NM
                 FROM TBDCMACM013C
                WHERE CD <> '000000000'
			      AND CMM_CD_DVSN_CD = #{cmmCdDvsnCd}
        ]]>
    </select>
    
    
    <delete id="deleteTBBADDED033M" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.deleteTBBADDED033M*/
        DELETE FROM TBBADDED033M WHERE BZT_YR  = #{bztYr}
                                   AND BZT_SNO = #{bztSno}
                                   AND SNO     = #{sno}
    </delete>
    
    
    <insert id="insertTBBADDED034M" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.insertTBBADDED034M*/
        INSERT INTO TBBADDED034M(  BZT_YR
                                 , BZT_SNO
                                 , SNO
                                 , ENFM_DVSN_TXT
                                 , ENFM_DT
                                 , ENFM_TG
                                 , GDS_NM
                                 , AUD_UTL_TXT
                                 , EVD_NO
                                 , ENFM_AM
                                 , FRT_USR_ID
                                 , FNL_USR_ID
                                 , FNL_DEAL_DPT_CD
                                 , FNL_MNU_ID
                                 , FRT_REGI_DH
                                 , FNL_MDF_DH )
                          VALUES ( #{bztYr}
                                 , #{bztSno}
                                 , TBBADDED034M_SEQ.NEXTVAL
                                 , #{enfmDvsnTxt}
                                 , TO_CHAR(TO_DATE(#{enfmDt}), 'YYYYMMDD')
                                 , #{enfmTg}
                                 , #{gdsNm}
                                 , #{audUtlTxt}
                                 , #{evdNo}
                                 , #{enfmAm}
                                 , #{frtUsrId}
                                 , #{fnlUsrId}
                                 , #{fnlDealDptCd}
                                 , #{fnlMnuId}
                                 , SYSDATE
                                 , SYSDATE )
    </insert>
    
    
    <update id="updateTBBADDED034M" parameterType="paramMap">
	/*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.updateTBBADDED034M */
		UPDATE TBBADDED034M
		   SET ENFM_DVSN_TXT = #{enfmDvsnTxt}
		     , ENFM_DT		 = TO_CHAR(TO_DATE(#{enfmDt}), 'YYYYMMDD')
             , ENFM_TG		 = #{enfmTg}
             , GDS_NM		 = #{gdsNm}
             , AUD_UTL_TXT	 = #{audUtlTxt}
             , EVD_NO		 = #{evdNo}
             , ENFM_AM		 = #{enfmAm}
             , FNL_USR_ID    = #{fnlUsrId}
             , FNL_MDF_DH    = SYSDATE
         WHERE BZT_YR  = #{bztYr}
           AND BZT_SNO = #{bztSno}
           AND SNO     = #{sno}
	</update>
    
    
    <delete id="deleteTBBADDED034M" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.deleteTBBADDED034M*/
        DELETE FROM TBBADDED034M WHERE BZT_YR  = #{bztYr}
                                   AND BZT_SNO = #{bztSno}
                                   AND SNO     = #{sno}
    </delete>
    
    <insert id="insertExcelTBBADDED033M" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.insertExcelTBBADDED033M*/
        INSERT INTO TBBADDED033M(  BZT_YR
                                 , BZT_SNO
                                 , SNO
                                 , ENFM_DVSN_TXT
                                 , ENFM_WAY_CD
                                 , ENFM_DT
                                 , ENFM_PLC
                                 , ENFM_TG
                                 , ENFM_AM
                                 , CCN
                                 , RMK
                                 , FRT_USR_ID
                                 , FNL_USR_ID
                                 , FNL_DEAL_DPT_CD
                                 , FNL_MNU_ID
                                 , FRT_REGI_DH
                                 , FNL_MDF_DH
                                 , REL_INDC_SBJ
                                 , ENFM_HIS )
                          VALUES ( #{bztYr}
                                 , #{bztSno}
                                 , TBBADDED033M_SEQ.NEXTVAL
                                 , #{enfmDvsnTxt}
                                 , #{enfmWayCd}
                                 , TO_CHAR(TO_DATE(#{enfmDt}), 'YYYYMMDD')
                                 , #{enfmPlc}
                                 , #{enfmTg}
                                 , #{enfmAm}
                                 , #{ccn}
                                 , #{rmk}
                                 , #{frtUsrId}
                                 , #{fnlUsrId}
                                 , #{fnlDealDptCd}
                                 , #{fnlMnuId}
                                 , SYSDATE
                                 , SYSDATE
                                 , #{relIndcSbj}
                                 , #{enfmHis} )
    </insert>
    
    <insert id="insertExcelTBBADDED034M" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.insertExcelTBBADDED034M*/
        INSERT INTO TBBADDED034M(  BZT_YR
                                 , BZT_SNO
                                 , SNO
                                 , ENFM_DVSN_TXT
                                 , ENFM_DT
                                 , ENFM_TG
                                 , GDS_NM
                                 , AUD_UTL_TXT
                                 , EVD_NO
                                 , ENFM_AM
                                 , FRT_USR_ID
                                 , FNL_USR_ID
                                 , FNL_DEAL_DPT_CD
                                 , FNL_MNU_ID
                                 , FRT_REGI_DH
                                 , FNL_MDF_DH )
                          VALUES ( #{bztYr}
                                 , #{bztSno}
                                 , TBBADDED034M_SEQ.NEXTVAL
                                 , #{enfmDvsnTxt}
                                 , TO_CHAR(TO_DATE(#{enfmDt}), 'YYYYMMDD')
                                 , #{enfmTg}
                                 , #{gdsNm}
                                 , #{audUtlTxt}
                                 , #{evdNo}
                                 , #{enfmAm}
                                 , #{frtUsrId}
                                 , #{fnlUsrId}
                                 , #{fnlDealDptCd}
                                 , #{fnlMnuId}
                                 , SYSDATE
                                 , SYSDATE )
    </insert>
    
    <select id="doAdjustChk" parameterType="paramMap" resultType="Integer">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.doAdjustChk*/
        SELECT COUNT(*)
          FROM TBBADDED011L
         WHERE 1=1
           AND BZT_YR  = #{bztYr}
           AND BZT_SNO = #{bztSno}
           AND CALC_YN = 'Y'
    </select>
    
    <update id="updateFnlYnCost" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.updateFnlYnCost*/
        UPDATE TBBADDED011L SET FNL_YN = #{fnlYn}
                              , FNL_USR_ID = #{usrId}
                              , FNL_DEAL_DPT_CD = #{dptCd}
                              , FNL_MNU_ID = #{menuNo}
                              , FNL_MDF_DH = SYSDATE
                          WHERE BZT_YR = #{bztYr}
                            AND BZT_SNO = #{bztSno}
                            AND CALC_YN = 'N'
    </update>
    
    <update id="updateFnlYnKtx" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.updateFnlYnCost*/
        UPDATE TBBADDED017L SET FNL_YN = #{fnlYn}
                              , FNL_USR_ID = #{usrId}
                              , FNL_DEAL_DPT_CD = #{dptCd}
                              , FNL_MNU_ID = #{menuNo}
                              , FNL_MDF_DH = SYSDATE
                          WHERE BZT_YR = #{bztYr}
                            AND BZT_SNO = #{bztSno}
                            AND CALC_YN = 'N'
    </update>
    
    <update id="saveAjtExDcn01" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.saveAjtExDcn01*/
        UPDATE TBBADDED002M 
           SET LEAD_EXS_AJT_EX_DCN = #{ajtExDcn}
         WHERE BZT_YR     = #{bztYr}
           AND BZT_SNO    = #{bztSno}
    </update>
    
    <update id="saveAjtExDcn02" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.saveAjtExDcn02*/
        UPDATE TBBADDED002M 
           SET RCV_EXS_AJT_EX_DCN = #{ajtExDcn}
         WHERE BZT_YR     = #{bztYr}
           AND BZT_SNO    = #{bztSno}
    </update>
    
    <select id="getistoryMax" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.getistoryMax*/
        SELECT TO_CHAR(NVL(MAX(TO_NUMBER(BZT_AJT_SNO )),0)+1) AS MAX_BZT_AJT_SNO 
              FROM ( SELECT BZT_AJT_SNO 
                       FROM TBBADDED019H
                      WHERE BZT_YR = #{bztYr}
                        AND BZT_SNO = #{bztSno}
                        <if test="pctCnb != null and pctCnb != ''">
                        AND PCT_CNB = #{pctCnb}
                        </if>
                     UNION ALL
                     SELECT BZT_AJT_SNO
                       FROM TBBADDED020H
                      WHERE BZT_YR = #{bztYr}
                        AND BZT_SNO = #{bztSno}
                        <if test="pctCnb != null and pctCnb != ''">
                        AND PCT_CNB = #{pctCnb}
                        </if>
                    )
    </select>
    
    <insert id="insertTravelExpInsertHistory" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.insertTravelExpInsertHistory*/
        INSERT INTO TBBADDED019H(  BZT_YR
                                 , BZT_SNO
                                 , PCT_CNB
                                 , BZT_EXS_SNO
                                 , BZT_AJT_SNO
                                 , AJT_YN
                                 , AJT_DGE
                                 , AJT_DT
                                 , ORG_CD
                                 , RGN_CD
                                 , RGN_DVSN_CD
                                 , BZT_STR_DT
                                 , BZT_END_DT
                                 , BZT_DCN
                                 , AUD_DCN
                                 , LODG_DCN
                                 , DT_EXS
                                 , LDC
                                 , FDEX
                                 , SPM_XPN
                                 , LEAD_EXS
                                 , FNL_YN
                                 , AUD_ACTV_RCV_EXS
                                 , CPRG_FR_EXS
                                 , LODG_TYP_CD
                                 , LODG_GVM_PUR_CRD_EXMP_AM
                                 , FRT_USR_ID
                                 , FNL_USR_ID
                                 , FNL_DEAL_DPT_CD
                                 , FNL_MNU_ID
                                 , FRT_REGI_DH
                                 , FNL_MDF_DH )
                            SELECT D1.BZT_YR
                                 , D1.BZT_SNO
                                 , D1.PCT_CNB
                                 , D1.BZT_EXS_SNO
                                 , #{bztAjtSno}
                                 , NVL(#{ajtYn},'N')
                                 , CASE WHEN #{ajtYn} IS NOT NULL THEN '1' ELSE '' END
                                 , CASE WHEN #{ajtYn} IS NOT NULL THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE NULL END
                                 , D1.ORG_CD
                                 , D1.RGN_CD
                                 , D1.RGN_DVSN_CD
                                 , D1.BZT_STR_DT
                                 , D1.BZT_END_DT
                                 , D1.BZT_DCN
                                 , D1.AUD_DCN
                                 , D1.LODG_DCN
                                 , D1.DT_EXS
                                 , D1.LDC
                                 , D1.FDEX
                                 , D1.SPM_XPN
                                 , D1.LEAD_EXS
                                 , D1.FNL_YN
                                 , D1.AUD_ACTV_RCV_EXS
                                 , D1.CPRG_FR_EXS
                                 , D1.LODG_TYP_CD
                                 , D1.LODG_GVM_PUR_CRD_EXMP_AM
                                 , #{usrId}
                                 , #{usrId}
                                 , #{dptCd}
                                 , #{menuNo}
                                 , SYSDATE
                                 , SYSDATE
                              FROM TBBADDED011L D1
                             WHERE D1.BZT_YR  = #{bztYr}
                               AND D1.BZT_SNO = #{bztSno}
                               AND D1.CALC_YN = 'Y'
                              <if test="pctCnb != null and pctCnb != ''">
                              AND D1.PCT_CNB = #{pctCnb}
                              </if>
                            UNION ALL
                            SELECT D1.BZT_YR
                                 , D1.BZT_SNO
                                 , D1.PCT_CNB
                                 , 0
                                 , #{bztAjtSno}
                                 , NVL(#{ajtYn},'N')
                                 , CASE WHEN #{ajtYn} IS NOT NULL THEN '1' ELSE '' END
                                 , CASE WHEN #{ajtYn} IS NOT NULL THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE NULL END
                                 , ''
                                 , ''
                                 , ''
                                 , ''
                                 , ''
                                 , 0
                                 , 0
                                 , 0
                                 , 0
                                 , 0
                                 , 0
                                 , 0
                                 , 0
                                 , 'Y'
                                 , 0
                                 , 0
                                 , ''
                                 , 0
                                 , #{usrId}
                                 , #{usrId}
                                 , #{dptCd}
                                 , #{menuNo}
                                 , SYSDATE
                                 , SYSDATE
                              FROM (SELECT BZT_YR
                                         , BZT_SNO
                                         , PCT_CNB
                                      FROM  TBBADDED011L D1
                                     WHERE D1.BZT_YR  = #{bztYr}
                                       AND D1.BZT_SNO = #{bztSno}
                                       AND D1.CALC_YN = 'N'
                                       <if test="pctCnb != null and pctCnb != ''">
                                       AND D1.PCT_CNB = #{pctCnb}
                                       </if>
                                    MINUS
                                    SELECT BZT_YR
                                         , BZT_SNO
                                         , PCT_CNB
                                      FROM  TBBADDED011L D1
                                     WHERE D1.BZT_YR  = #{bztYr}
                                       AND D1.BZT_SNO = #{bztSno}
                                       AND D1.CALC_YN = 'Y'
                                       <if test="pctCnb != null and pctCnb != ''">
                                       AND D1.PCT_CNB = #{pctCnb}
                                       </if>
                                    ) D1
    </insert>
    
    <insert id="insertTrainFareDescInsertHistory" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.insertTrainFareDescInsertHistory*/
        INSERT INTO TBBADDED020H(  PCT_CNB
                                 , BZT_EXS_SNO
                                 , BZT_AJT_SNO
                                 , AJT_YN
                                 , AJT_DGE
                                 , AJT_DT
                                 , RL_SCO_SNO
                                 , BZT_SNO
                                 , BZT_YR
                                 , RID_DT
                                 , TRIN_KND_CD
                                 , CHRG_DVSN_CD
                                 , DEP_STN_NM
                                 , ARV_STN_NM
                                 , FNL_YN
                                 , RL_FR_EXS
                                 , STND_CHRG_YN
                                 , FRT_USR_ID
                                 , FNL_USR_ID
                                 , FNL_DEAL_DPT_CD
                                 , FNL_MNU_ID
                                 , FRT_REGI_DH
                                 , FNL_MDF_DH 
                                 , MILEAGE
                                 , TOLL
                                 , PARKING_FEE
                                 , RL_GVM_PUR_CRD_EXMP_AM )
                            SELECT D1.PCT_CNB
                                 , D1.BZT_EXS_SNO
                                 , #{bztAjtSno}
                                 , NVL(#{ajtYn},'N')
                                    , CASE WHEN #{ajtYn} IS NOT NULL THEN '1' ELSE '' END
                                 , CASE WHEN #{ajtYn} IS NOT NULL THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE NULL END
                                 , D1.RL_SCO_SNO
                                 , D1.BZT_SNO
                                 , D1.BZT_YR
                                 , D1.RID_DT
                                 , D1.TRIN_KND_CD
                                 , D1.CHRG_DVSN_CD
                                 , D1.DEP_STN_NM
                                 , D1.ARV_STN_NM
                                 , D1.FNL_YN
                                 , D1.RL_FR_EXS
                                 , D1.STND_CHRG_YN 
                                 , #{usrId}
                                 , #{usrId}
                                 , #{dptCd}
                                 , #{menuNo}
                                 , SYSDATE
                                 , SYSDATE
                                 , D1.MILEAGE
                                 , D1.TOLL
                                 , D1.PARKING_FEE     
                                 , D1.RL_GVM_PUR_CRD_EXMP_AM                                                                                       
                              FROM TBBADDED017L D1
                             WHERE D1.BZT_YR  = #{bztYr}
                               AND D1.BZT_SNO = #{bztSno}
                               AND D1.CALC_YN = 'Y'
                               <if test="pctCnb != null and pctCnb != ''">
                               AND D1.PCT_CNB = #{pctCnb}
                               </if>
    </insert>
    
    <delete id="deleteBADDED013E19" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.deleteBADDED013E19*/
        DELETE FROM TBBADDED019H WHERE BZT_YR = #{bztYr}
                                   AND BZT_SNO = #{bztSno}
                                   <if test="bztExsSno != null and bztExsSno != ''">
                                   AND BZT_EXS_SNO = #{bztExsSno}
                                   </if>
                                   <if test="pctCnb != null and pctCnb != ''">
                                   AND PCT_CNB = #{pctCnb}
                                   </if>
    </delete>
    
    <delete id="deleteBADDED013E20" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.deleteBADDED013E20*/
        DELETE FROM TBBADDED020H WHERE BZT_YR = #{bztYr}
                                   AND BZT_SNO = #{bztSno}
                                   <if test="bztExsSno != null and bztExsSno != ''">
                                   AND BZT_EXS_SNO = #{bztExsSno}
                                   </if>
                                   <if test="pctCnb != null and pctCnb != ''">
                                   AND PCT_CNB = #{pctCnb}
                                   </if>
    </delete>
    
    <delete id="deleteBADDED013E17" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.deleteBADDED013E17*/
        DELETE FROM TBBADDED017L WHERE BZT_YR = #{bztYr}
                                   AND BZT_SNO = #{bztSno}
                                   <if test="calcYn != null and calcYn != ''">
                                   AND CALC_YN = #{calcYn}
                                   </if>
                                   <if test="bztExsSno != null and bztExsSno != ''">
                                   AND BZT_EXS_SNO = #{bztExsSno}
                                   </if>
                                   <if test="pctCnb != null and pctCnb != ''">
                                   AND PCT_CNB = #{pctCnb}
                                   </if>
                                   <if test="rlScoSno != null and rlScoSno != ''">
                                   ANd RL_SCO_SNO = #{rlScoSno}
                                   </if>
    </delete>
    
    <delete id="deleteBADDED013E11" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.deleteBADDED013E11*/
        DELETE FROM TBBADDED011L WHERE BZT_YR = #{bztYr}
                                   AND BZT_SNO = #{bztSno}
                                   <if test="calcYn != null and calcYn != ''">
                                   AND CALC_YN = #{calcYn}
                                   </if>
                                   <if test="bztExsSno != null and bztExsSno != ''">
                                   AND BZT_EXS_SNO = #{bztExsSno}
                                   </if>
                                   <if test="pctCnb != null and pctCnb != ''">
                                   AND PCT_CNB = #{pctCnb}
                                   </if>
    </delete>
    
    <delete id="deleteCnb" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.deleteCnb*/
        DELETE FROM TBBADDED010L WHERE BZT_YR = #{bztYr}
                                   AND BZT_SNO = #{bztSno}
                                   AND PCT_CNB NOT IN ( SELECT BZT_TL_CNB
                                                          FROM TBBADDED002M
                                                         WHERE BZT_YR  = #{bztYr}
                                                             AND BZT_SNO = #{bztSno}
                                                        UNION ALL
                                                        SELECT PCT_CNB
                                                          FROM TBBADDED005L
                                                         WHERE BZT_YR  = #{bztYr}
                                                           AND BZT_SNO = #{bztSno} )
    </delete>
    
    <insert id="insertTrainFareDesc" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.insertTrainFareDesc*/
        INSERT INTO TBBADDED017L(  PCT_CNB
                                 , BZT_EXS_SNO
                                 , CALC_YN
                                 , RL_SCO_SNO
                                 , BZT_SNO
                                 , BZT_YR
                                 , RID_DT
                                 , TRIN_KND_CD
                                 , CHRG_DVSN_CD
                                 , DEP_STN_NM
                                 , ARV_STN_NM
                                 , FNL_YN
                                 , RL_FR_EXS
                                 , STND_CHRG_YN
                                 , FRT_USR_ID
                                 , FNL_USR_ID
                                 , FNL_DEAL_DPT_CD
                                 , FNL_MNU_ID
                                 , FRT_REGI_DH
                                 , FNL_MDF_DH 
                                 , MILEAGE
                                 , TOLL
                                 , PARKING_FEE 
                                 , RL_GVM_PUR_CRD_EXMP_AM )
                          VALUES ( #{pctCnb}
                                 , #{bztExsSno}
                                 , #{calcYn}
                                 , #{rlScoSno}
                                 , #{bztSno}
                                 , #{bztYr}
                                 , REPLACE(#{ridDt},'-','')
                                 , #{trinKndCd}
                                 , #{chrgDvsnCd}
                                 , #{depStnNm}
                                 , #{arvStnNm}
                                 , #{fnlYn}
                                 , #{rlFrExs}
                                 , #{stndChrgYn}
                                 , #{usrId}
                                 , #{usrId}
                                 , #{dptCd}
                                 , #{menuNo}
                                 , SYSDATE
                                 , SYSDATE 
                                 , #{mileage}
                                 , #{toll}
                                 , #{parkingFee} 
                                 , #{rlGvmPurCrdExmpAm} )
    </insert>
    
    <select id="getHighMember" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.getHighMember*/
        SELECT TEAM_SNO
             , PCT_ALC_SNO
             , BZT_SNO
             , BZT_YR
             , STF_DVSN_CD
             , PCT_CNB
             , PCT_NM
             , BLT_BRDV_CD
             , PCT_RANK_CD
             , DEP_RGN_CD
             , BZT_STR_DT
             , BZT_END_DT
             , TEAM_CHIF_YN
             , PCT_OCP_CD
             , EXTL_ORG_CD
             , EXTL_ORG_NM
          FROM TBBADDED005L
         WHERE 1=1 
           AND BZT_YR      = #{bztYr}
           AND BZT_SNO     = #{bztSno}
           AND TEAM_SNO    = #{teamSno}
           AND PCT_ALC_SNO = #{pctAlcSno}
           AND PCT_CNB     = #{pctCnb}
           AND PCT_RANK_CD IN ('115','116','187')
           AND ROWNUM      = 1
    </select>
    
    <update id="doAjtDtmInitUpdate" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.doAjtDtmInitUpdate*/
        UPDATE TBBADDED002M SET AJT_DTM_YN = #{ajtDtmYn} WHERE BZT_YR = #{bztYr}
                                                           AND BZT_SNO = #{bztSno}
    </update>
    
    <update id="doAjtDtm" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.doAjtDtm*/
        UPDATE TBBADDED002M SET AJT_DTM_YN = 'Y'
                              , FNL_USR_ID = #{usrId}
                              , FNL_DEAL_DPT_CD = #{dptCd}
                              , FNL_MNU_ID = #{menuNo}
                              , FNL_MDF_DH = SYSDATE
                          WHERE BZT_YR = #{bztYr}
                            AND BZT_SNO = #{bztSno}
    </update>
    
    <update id="doCancelAjtDtm" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.doCancelAjtDtm*/
        UPDATE TBBADDED002M SET AJT_DTM_YN = 'N'
                              , FNL_USR_ID = #{usrId}
                              , FNL_DEAL_DPT_CD = #{dptCd}
                              , FNL_MNU_ID = #{menuNo}
                              , FNL_MDF_DH = SYSDATE
                          WHERE BZT_YR = #{bztYr}
                            AND BZT_SNO = #{bztSno}
    </update>
    
    <select id="getMaxBztAjtSno" parameterType="paramMap" resultType="String">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.getMaxBztAjtSno*/
        SELECT TO_CHAR(NVL(MAX(TO_NUMBER(BZT_AJT_SNO )),0)+1) AS MAX_BZT_AJT_SNO 
              FROM ( 
                    SELECT BZT_AJT_SNO 
                      FROM TBBADDED019H
                     WHERE BZT_YR = #{bztYr}
                       AND BZT_SNO = #{bztSno}
                       <if test="pctCnb != null and pctCnb != ''">
                       AND PCT_CNB = #{pctCnb}
                       </if>
                     UNION ALL 
                    SELECT BZT_AJT_SNO
                      FROM TBBADDED020H
                     WHERE BZT_YR = #{bztYr}
                       AND BZT_SNO = #{bztSno}
                       <if test="pctCnb != null and pctCnb != ''">
                       AND PCT_CNB = #{pctCnb}
                       </if>
                   )
    </select>
    
    <select id="selectTripMstList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectTripMstList*/
        <![CDATA[
        SELECT F_MNG_KND_AUDYRNO(D2.AUD_YR, D2.AUD_NO, D2.AUD_KND_CD, '-') 
                   ||'('|| D1.AUD_STEP_SNO || ')'       AS AUD_YR_NO            /*감사년번호 - 수정(2015.12.17-yyh)*/
                 , CASE WHEN D2.AUD_YR >= '2016' 
                             THEN SUBSTR(D2.AUD_KND_CD,3,1)
                        ELSE '' 
                    END                                 AS AUD_YR_NO_KND_CD     /*감사연번호종류코드 추가 - 2015.12.18 yyh*/
                 , D1.BZT_YR                            AS BZT_YR                /*출장년도*/
                 , D1.BZT_SNO                           AS BZT_SNO              /*출장순번*/
                 , D2.AUD_KND_CD                        AS AUD_KND_CD           /*감사종류코드*/
                 , F_CODE_NM('1000007',D2.AUD_KND_CD)   AS AUD_KND_NM           /*감사종류명*/
                 , D1.BZT_DVSN_CD                       AS BZT_DVSN_CD          /*출장구분코드*/
                 , D1.AUD_BZT_KND_CD                    AS AUD_BZT_KND_CD       /*감사출장종류코드*/
                 , F_CODE_NM('1000030',D1.AUD_BZT_KND_CD) AS AUD_BZT_KND_NM     /*감사출장종류코드*/
                 , D1.BZT_TL_CNB                        AS BZT_TL_CNB           /*출장반장전산번호*/
                 , D1.BZT_TL_BRDV_CD                    AS BZT_TL_BRDV_CD       /*출장반장국과코드*/
                 , D1.BZT_TL_RANK_CD                    AS BZT_TL_RANK_CD       /*출장반장직급코드*/
                 , F_USR_INFO(D1.BZT_TL_CNB,'2')        AS BZT_TL_CNB_NM        /*출장반장명*/
                 , F_DPT_INFO(D1.BZT_TL_BRDV_CD,'1')    AS BZT_TL_BRDV_NM       /*출장반장국과명*/
                 , F_CODE_NM('1000173',D1.BZT_TL_RANK_CD)   AS BZT_TL_RANK_NM   /*출장반장직급명*/
                 , D1.TIT_TXT                           AS TIT_TXT              /*제목내용*/
                 , D1.BZT_BRDV_CD                       AS BZT_BRDV_CD          /*출장국과코드*/
                 , F_DPT_INFO(D1.BZT_BRDV_CD,'1')       AS BZT_BRDV_NM          /*출장국과명*/
                 , D1.HLDY_ACTV_DVSN_CD                 AS HLDY_ACTV_DVSN_CD    /*휴일활동구분코드*/
                 , F_CODE_NM('1000019',D1.HLDY_ACTV_DVSN_CD)                 AS HLDY_ACTV_DVSN_NM    /*휴일활동구분코드*/
                 , D1.REL_AUD_YR                        AS REL_AUD_YR           /*관련감사년도*/
                 , D1.REL_AUD_NO                        AS REL_AUD_NO           /*관련감사번호*/
                 , D2.AUD_GRN_NO                        AS AUD_GRN_NO           /*감사부여번호 - 2016.05.27 yyh*/
                 , D1.AUD_STEP_SNO                      AS AUD_STEP_SNO         /*감사단계순번*/
                 , D1.BZT_TXT                           AS BZT_TXT              /*출장내용*/
                 , D1.CTRL_YN                           AS CTRL_YN              /*통제여부*/
                 , D1.BZT_YR ||'-'||D1.SPRT_NO          AS SPRT_NM              /*지원번호*/
                 , D1.SPRT_NO                           AS SPRT_NO              /*지원번호*/
                 , D1.GEN_BZT_KND_CD                    AS GEN_BZT_KND_CD       /*일반출장구분코드*/
                 , D1.REGI_DT                           AS REGI_DT              /*등록일*/
                 , D1.AUD_STR_DT                        AS AUD_STR_DT           /*감사시작일*/
                 , D1.AUD_END_DT                        AS AUD_END_DT           /*감사종료일*/
                 , D1.AUD_DCN                           AS AUD_DCN              /*감사일수*/
                 , D1.LEAD_EXS_PMT_YN                   AS LEAD_EXS_PMT_YN      /*지휘비지급여부*/
                 , D1.CTRL_TG_YN                        AS CTRL_TG_YN           /*통제대상여부*/
                 , D1.CTRL_DT                           AS CTRL_DT              /*통제일*/
                 , D1.SND_YN                            AS SND_YN               /*송부여부*/
                 , D1.SND_DT                            AS SND_DT               /*송부일*/
                 , D1.FLD_AUD_STEP_NO                   AS FLD_AUD_STEP_NO      /*실지감사단계번호*/
                 , D2.AUD_YR                            AS AUD_YR               /*감사년도*/
                 , D2.AUD_NO                            AS AUD_NO               /*감사번호*/
                 , F_DPT_INFO(D2.SPV_BRDV_CD,'1')       AS SPV_BRDV_NM          /*주관부서명*/
                 , F_DPT_INFO(D2.MNG_DPT_CD,'1')        AS MNG_DPT_NM           /*관리부서명*/
                 , F_DPT_INFO((SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = D2.SPV_BRDV_CD), '1') AS SPV_BRDV_UP_NM  /*주관부서명(국)*/
                 , TO_CHAR(TO_DATE(D1.AUD_STR_DT),'YYYY-MM-DD')||' ~ '|| TO_CHAR(TO_DATE(D1.AUD_END_DT),'YYYY-MM-DD')    AS AUD_ST_END_DT        /*실시기간*/
                 , D2.AUD_SBJ_NM                       AS AUD_SBJ_NM            /*감사사항명*/
                 , CASE WHEN NVL(D1.CTRL_TG_YN,'N') = 'N' THEN '-'
                        WHEN NVL(D1.CTRL_TG_YN,'N') = 'Y' AND NVL(D1.CTRL_YN,'N') = 'Y' THEN 'O' 
                        WHEN NVL(D1.CTRL_TG_YN,'N') = 'Y' AND NVL(D1.CTRL_YN,'N') = 'N' THEN 'X'
                    END AS CTRL_YN_DISP
                 , CASE WHEN NVL(D1.SND_YN,'N') = 'Y' THEN 'O' ELSE 'X' END AS SND_YN_DISP
                 , (SELECT CASE WHEN D1.CALC_DTM_YN = 'Y'  THEN '확정'
                                ELSE  CASE WHEN COUNT(1)>0 THEN 'Y' ELSE 'N' END
                            END   
                      FROM TBBADDED011L
                     WHERE 1=1
                       AND BZT_YR  = D1.BZT_YR
                       AND BZT_SNO = D1.BZT_SNO
                    )      AS EXP_YN         /*수정가능여부를 판단하기 위함.*/
                 , ''     AS SEL_YN        /*선택여부를 판단하기위함.(통제화면)*/
                 , NVL(D3.IN_PSON_CNT,0)    AS IN_PSON_CNT
                 , NVL(D3.EXT_PSON_CNT,0)   AS EXT_PSON_CNT
                 , NVL(D3.IN_PSON_CNT,0)+ NVL(D3.EXT_PSON_CNT,0) AS PSON_CNT
                 , NVL(D3.IN_PSON_CNT,0)||'/'||NVL(D3.EXT_PSON_CNT,0)||'/'||(NVL(D3.IN_PSON_CNT,0)+ NVL(D3.EXT_PSON_CNT,0)) AS ALL_PSON_CNT 
                 , F_ORG_CNT_NM_AUD(D1.BZT_YR,D1.BZT_SNO,'BZT') AS ORG_CNT_NM
                 , (SELECT CASE WHEN COUNT(1)>0 THEN 'Y' ELSE 'N' END  
                      FROM TBBADDED004L
                     WHERE 1=1
                       AND BZT_YR  = D1.BZT_YR
                       AND BZT_SNO = D1.BZT_SNO
                    )      AS TEAM_YN
                
                , TO_CHAR(TO_DATE(D1.AUD_STR_DT),'YYYY-MM-DD')||' ~ '|| TO_CHAR(TO_DATE(D1.AUD_END_DT),'YYYY-MM-DD') 
                  || '(' || D1.AUD_DCN || ')'                                                                      AS AUD_ST_END_DT_DCN  /*실시기간+일수 - 2015.06.02 yyh*/
                
                /* 출장예산구분 추가 - 2016.05.27 yyh */
                , D2.BZT_BGT_DVSN_CD                      AS BZT_BGT_DVSN_CD
                , F_CODE_NM('1000751',D2.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM 
           FROM TBBADDED002M AS D1
     INNER JOIN TBBADDED001M AS D2 ON D1.REL_AUD_YR = D2.AUD_YR AND D1.REL_AUD_NO = D2.AUD_NO
LEFT OUTER JOIN (SELECT BZT_YR
                      , BZT_SNO
                      , SUM( CASE WHEN A.STF_DVSN_CD = '0' THEN 1 ELSE 0 END) AS IN_PSON_CNT  /*내부인원*/
                      , SUM( CASE WHEN A.STF_DVSN_CD = '0' THEN 0 ELSE 1 END) AS EXT_PSON_CNT /*외부인원*/
                   FROM (SELECT DISTINCT BZT_YR
                              , BZT_SNO
                              , PCT_CNB
                              , STF_DVSN_CD
                           FROM TBBADDED005L) A
               GROUP BY BZT_YR, BZT_SNO
             ) AS D3 ON D1.BZT_YR = D3.BZT_YR AND D1.BZT_SNO = D3.BZT_SNO
         WHERE 1=1
           AND D1.BZT_DVSN_CD = '1' /*감사출장*/
           AND D1.BZT_YR = #{bztYr}
           AND D1.BZT_SNO = #{bztSno}
        ]]>
    </select>
    
    <select id="selectOrgSelectAuto" parameterType="paramMap" resultType="egovMap">
        SELECT BZT_YR
             , BZT_SNO 
             , PCT_CNB
             , BZT_EXS_SNO
             , ORG_CD
             , RGN_CD
             , RGN_DVSN_CD
             , BZT_STR_DT      AS AUD_STR_DT
             , BZT_END_DT      AS AUD_END_DT
          FROM TBBADDED011L
         WHERE CALC_YN = 'Y' 
           AND BZT_YR  = #{bztYr}
           AND BZT_SNO = #{bztSno}
           AND PCT_CNB = #{pctCnb}
          ORDER BY BZT_STR_DT
    </select>
    
    <select id="selectPerSelectAuto" parameterType="paramMap" resultType="egovMap">
        SELECT BZT_YR
             , BZT_SNO 
             , PCT_CNB
             , DEP_RGN_CD
          FROM TBBADDED010L
         WHERE BZT_YR  = #{bztYr}
           AND BZT_SNO = #{bztSno}
           AND PCT_CNB = #{pctCnb}
    </select>
    
    <delete id="deleteBADDED017L" parameterType="paramMap">
        DELETE FROM TBBADDED017L WHERE BZT_YR  = #{bztYr}
                                   AND BZT_SNO = #{bztSno}
                                   <if test="calcYn != null and calcYn !=''">
                                   AND CALC_YN = #{calcYn}
                                   </if>
                                   <if test="pctCnb != null and pctCnb !=''">
                                   AND PCT_CNB = #{pctCnb}
                                   </if>
                                   <if test="bztExsSno != null and bztExsSno !=''">
                                   AND BZT_EXS_SNO = #{bztExsSno}
                                   </if>
    </delete>
    
    <select id="selectLdcBndRlsYn" parameterType="paramMap" resultType="String">
        SELECT LDC_BND_RLS_YN
          FROM TBBADDED010L
         WHERE 1=1
           AND BZT_YR  = #{bztYr}
           AND BZT_SNO = #{bztSno}
           AND PCT_CNB = #{pctCnb}
    </select>
    
    <select id="getMaxBztExsSno" parameterType="paramMap" resultType="String">
        SELECT TO_CHAR(NVL(MAX(BZT_EXS_SNO),0) + 1) AS MAX_BZT_EXS_SNO
         FROM TBBADDED011L
        WHERE 1=1
          AND BZT_YR  = #{bztYr}
          AND BZT_SNO = #{bztSno}
          AND CALC_YN = 'Y'
    </select>
    
    <select id="getMaxRlScoSno" parameterType="paramMap" resultType="String">
        SELECT TO_CHAR(NVL(MAX(RL_SCO_SNO),0) + 1) AS MAX_RL_SCO_SNO
         FROM TBBADDED017L
        WHERE 1=1
          AND BZT_YR  = #{bztYr}
          AND BZT_SNO = #{bztSno}
          AND CALC_YN = 'Y'
    </select>
    
    <select id="getAddTransInfo" parameterType="paramMap" resultType="egovMap">
        SELECT DEP_STAD_STN_NM      /*출발기준역명*/
                 , ARV_STAD_STN_NM  /*도착기준역명*/
                 , CHRG_DVSN_CD     /*요금구분코드*/
                 , F_CODE_NM('1000026',CHRG_DVSN_CD) AS CHRG_DVSN_NM
                 , TFE_KND_CD       /*교통편종류코드*/
                 , F_CODE_NM('1000025',TFE_KND_CD) AS TFE_KND_NM
                 , CHRG             /*요금*/
                 , CHRG_STAD_RMK    /*요금기준비고*/
                 , MDF_DT           /*수정일*/
                 , SPE_RM_CHRG      /*특별실요금*/
              FROM TBBADDED016B 
             WHERE 1=1
                AND BZT_DVSN_CD = '1' /* 감사출장 조건 추가 - 2017.02.06 */
                AND DEP_STAD_STN_NM LIKE #{depStadStnNm}||'%'
                AND ARV_STAD_STN_NM LIKE #{arvStadStnNm}||'%'
                AND F_CODE_NM('1000026',CHRG_DVSN_CD) LIKE '기본%'
                /*AND F_CODE_NM('1000025',TFE_KND_CD) LIKE 'KTX%'*/
                AND ROWNUM = 1
              ORDER BY DEP_STAD_STN_NM
    </select>
    
    <!-- 출장자예외내역 조회 - 2017.10.24 yyh --> 
    <select id="selectPctExAjtList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectPctExAjtList*/    
        <![CDATA[
                
                SELECT BZT_YR                  
                      ,BZT_SNO           
                      ,TEAM_SNO         
                      ,PCT_ALC_SNO      
                      ,PCT_CNB 
                      ,PCT_NM
                      ,STF_DVSN_CD                                    
                      ,EX_SNO  
                      ,BZT_EX_STR_DT    
                      ,BZT_EX_END_DT    
                      ,BZT_EX_DCN       
                      ,BZT_EX_KND_CD               
                      ,BZT_EX_RSN_TXT         
                  FROM TBBADDED032L            
                 WHERE BZT_YR      = #{bztYr}
                   AND BZT_SNO     = #{bztSno}
                   AND IPT_DVSN_CD = '2'
                   AND PCT_CNB     = #{pctCnb}
                 ORDER BY BZT_EX_STR_DT
                         ,BZT_EX_END_DT
        ]]>     
    </select>   
        
    <!-- 정산기초자료 생성시 출장자예외내역 입력 - 2017.10.23 yyh -->
    <insert id="insertInitPctExAjt" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.insertInitPctExAjt*/
		DECLARE
			BEGIN	
			  FOR CS IN ( 
		                   SELECT BZT_YR
		                         ,BZT_SNO
		                         ,PCT_CNB
		                         ,PCT_NM
		                         ,STF_DVSN_CD
		                         ,EX_SNO                         
		                         ,TEAM_SNO
		                         ,PCT_ALC_SNO
		                         ,BZT_EX_STR_DT
		                         ,BZT_EX_END_DT
		                         ,BZT_EX_DCN 
		                         ,BZT_EX_KND_CD
		                         ,BZT_EX_RSN_TXT
			                 FROM TBBADDED032L
			                WHERE BZT_YR   = #{bztYr}
			                  AND BZT_SNO  = #{bztSno}
			                  AND IPT_DVSN_CD = '1'
			                ORDER BY PCT_CNB
			                        ,EX_SNO
			)
			LOOP 		
	    		   INSERT INTO TBBADDED032L (BZT_YR
					                        ,BZT_SNO
					                        ,IPT_DVSN_CD		                        					                        
					                        ,PCT_CNB
					                        ,PCT_NM
					                        ,STF_DVSN_CD
					                        ,EX_SNO					                        
					                        ,TEAM_SNO
					                        ,PCT_ALC_SNO
					                        ,BZT_EX_STR_DT
					                        ,BZT_EX_END_DT
					                        ,BZT_EX_DCN
					                        ,BZT_EX_KND_CD
					                        ,BZT_EX_RSN_TXT                                    
					                        ,FRT_USR_ID
					                        ,FNL_USR_ID
					                        ,FNL_DEAL_DPT_CD
					                        ,FNL_MNU_ID
					                        ,FRT_REGI_DH
					                        ,FNL_MDF_DH )
					                VALUES (
					                         CS.BZT_YR
					                        ,CS.BZT_SNO
					                        ,'2'				                        
					                        ,CS.PCT_CNB
					                        ,CS.PCT_NM
					                        ,CS.STF_DVSN_CD
					                        ,(SELECT NVL(MAX(EX_SNO),0) + 1 
					                            FROM TBBADDED032L
					                           WHERE BZT_YR       = #{bztYr}
					                             AND BZT_SNO      = #{bztSno}
			                                     AND IPT_DVSN_CD  = '2')					                        					                        
					                        ,''
					                        ,''
					                        ,CS.BZT_EX_STR_DT
					                        ,CS.BZT_EX_END_DT
					                        ,CS.BZT_EX_DCN
					                        ,CS.BZT_EX_KND_CD
					                        ,CS.BZT_EX_RSN_TXT                          
					                        ,#{usrId}
					                        ,#{usrId}
					                        ,#{dptCd}
					                        ,#{menuNo}
					                        ,SYSDATE
					                        ,SYSDATE );
			END LOOP;			
		END;		
    </insert>    
       
    <!-- 출장자예외내역 전체 삭제 - 2017.10.23 yyh --> 
    <delete id="deleteInitPctExAjt" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.deleteInitPctExAjt*/
        DELETE FROM TBBADDED032L
         WHERE BZT_YR      = #{bztYr}
           AND BZT_SNO     = #{bztSno}
           AND IPT_DVSN_CD = '2'           
    </delete>   
    
    <!-- 출장자예외내역 삭제 - 2017.10.24 yyh --> 
    <delete id="deletePctExAjt" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.deletePctExAjt*/
        DELETE FROM TBBADDED032L
         WHERE BZT_YR      = #{bztYr}
           AND BZT_SNO     = #{bztSno}
           AND IPT_DVSN_CD = '2'     
           AND PCT_CNB     = #{pctCnb}
    </delete>       
        
    <select id="selectChkLdcAm" parameterType="paramMap" resultType="String">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectChkLdcAm*/
    	<![CDATA[
                    SELECT CASE 
					        WHEN B1.LDC_BND_APC_YN = 'Y' THEN TO_CHAR(MAX(B2.BZT_STAD_AM)*B1.LDC_BND_APC_RTS) 
					        ELSE TO_CHAR(MAX(B2.BZT_STAD_AM)) 
					       END BZT_STAD_AM         /*3월2일 이후 한도해제로 인해 TBBADDED180B 에 새로운 컬럼을 추가하여 관리되도록 수정*/
                      FROM TBBADDED180B B1
                          ,TBBADDED018B B2  
                     WHERE 1=1 
                       AND B1.BZT_SRNO     = B2.BZT_SRNO
                       AND B1.BZT_DVSN_CD  = '1'
                       AND B2.TREXP_CLU_CD = '03'
                       AND B1.STAD_STR_DT <= REPLACE(#{bztStrDt},'-','') AND B1.STAD_END_DT >= REPLACE(#{bztStrDt},'-','')
                       AND B2.RGN_DVSN_CD  = (SELECT CASE WHEN #{rgnCd}      = '2000'  THEN '5' /* 세종특별자치시는 지방이지만 광역시 기준으로 계산한다(재무행정팀 박순호감사관 요청) - 2021.03.03 yyh */
                                                          WHEN USR_DFN_TXT_1 = '1'     THEN '4' /* 서울 */
                                                          WHEN USR_DFN_TXT_1 = '2'     THEN '5' /* 광역시 */
                                                          WHEN USR_DFN_TXT_1 = '3'     THEN '6' /* 지방 */
                                                      END 
                                                FROM TBDCMACM013C
                                               WHERE CMM_CD_DVSN_CD = '1000001'
                                                 AND USE_YN         = 'Y'
                                                 AND CD             = #{rgnCd})  /* TBBADDED011L - D1.RGN_CD */  		
                     GROUP BY B1.LDC_BND_APC_YN, B1.LDC_BND_APC_RTS
     	]]>
    </select>
    
	<select id="selectHighRankChk" parameterType="paramMap" resultType="int">
		/*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectHighRankChk*/
		<![CDATA[
			SELECT COUNT(*) AS CNT
              FROM TBDCMACM001M 
             WHERE 1=1
               AND INN_RANK_CD <= 20
               AND CNB NOT LIKE '9%'
               AND CNB = #{pctCnb}               
		]]>

	</select>
	
    <update id="updatePsnAjt" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.updatePsnAjt*/
        UPDATE TBBADDED010L 
             SET PSN_AJT_YN        = #{psnAjtYn}
                , FNL_USR_ID         = #{usrId}
                , FNL_DEAL_DPT_CD = #{dptCd}
                , FNL_MNU_ID        = #{menuNo}
                , FNL_MDF_DH        = SYSDATE
         WHERE BZT_YR              = #{bztYr}
            AND BZT_SNO            = #{bztSno}
            AND PCT_CNB            = #{pctCnb}
    </update>	
    
    <select id="selectRlFrExs" parameterType="paramMap"
        resultType="int">
        /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectRlFrExs */
        <![CDATA[
        SELECT RL_FR_EXS
		  FROM TBBADDED017L
		 WHERE BZT_YR  	  = #{bztYr}
           AND BZT_SNO    = #{bztSno}
           AND PCT_CNB    = #{pctCnb}
           AND RL_SCO_SNO = #{rlScoSno}
           AND CALC_YN    = 'Y'
        ]]>
    </select>
    
    <select id="selectDis" parameterType="paramMap" resultType="egovMap">
        SELECT DEP_PLC_CD
        	  ,DEP_PLC_NM
        	  ,ARV_PLC_CD
        	  ,ARV_PLC_NM
        	  ,FRE_DIS
        	  ,MIN_DIS
          FROM TBBADDED037L 
         WHERE 1=1
           AND DEP_PLC_NM = #{depStnNm}
           AND ARV_PLC_NM = #{arvStnNm}
    </select>
    
    <select id="selectTBBADDED017L" parameterType="paramMap" resultType="egovMap">
        SELECT DEP_STN_NM
        	  ,ARV_STN_NM
          FROM TBBADDED017L 
         WHERE 1=1
           AND BZT_YR     = #{bztYr}
		   AND BZT_SNO    = #{bztSno}
		   AND PCT_CNB    = #{pctCnb}
		   AND CALC_YN    = #{calcYn}
		   AND RL_SCO_SNO = #{rlScoSno}
    </select>
    
    <delete id="delRegiList">
     /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.delRegiList */
    <![CDATA[
    DELETE TBBADDED036D
     WHERE BZT_YR  = #{bztYr}
       AND BZT_SNO = #{bztSno}
       AND PCT_CNB = #{pctCnb}
       AND SNO 	   = #{rlScoSno}
       AND XPN_DVSN_CD = 'TREP'
        ]]>
    </delete>
    
    <delete id="delTrepRegiList">
     /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.delTrepRegiList */
    <![CDATA[
    DELETE TBBADDED036D
     WHERE BZT_YR  = #{bztYr}
       AND BZT_SNO = #{bztSno}
       AND PCT_CNB = #{pctCnb}
       AND SNO 	   IN (SELECT DISTINCT(RL_SCO_SNO)
         				 FROM TBBADDED017L
         				WHERE BZT_YR = #{bztYr}
         				  AND BZT_SNO = #{bztSno}
         				  AND PCT_CNB = #{pctCnb}
         				  and BZT_EXS_SNO = #{bztExsSno})
       AND XPN_DVSN_CD = 'TREP'
        ]]>
    </delete>
    
    <delete id="delRegiLdcList">
     /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.delRegiLdcList */
    <![CDATA[
    DELETE TBBADDED036D
     WHERE BZT_YR  = #{bztYr}
       AND BZT_SNO = #{bztSno}
       AND PCT_CNB = #{pctCnb}
       AND SNO 	   = #{bztExsSno}
       AND XPN_DVSN_CD = 'LDC'
        ]]>
    </delete>
    
    <delete id="delRegiAllList">
     /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.delRegiAllList */
    <![CDATA[
    DELETE TBBADDED036D
     WHERE BZT_YR  = #{bztYr}
       AND BZT_SNO = #{bztSno}
        ]]>
    </delete>
    
    <select id="selectGpcInfo" parameterType="paramMap" resultType="egovMap">
    /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectGpcInfo */
        SELECT CON_TRNSC_ID
			  ,GPC_TRNSC_GRAM_NO
			  ,CON_SRNO
			  ,GPC_NO
          FROM TBBADDED036D 
         WHERE 1=1
           AND BZT_YR  	   = #{bztYr}
	       AND BZT_SNO 	   = #{bztSno}
	       AND PCT_CNB 	   = #{pctCnb}
	       AND SNO 	   	   IN (SELECT DISTINCT(RL_SCO_SNO)
	       					     FROM TBBADDED017L
	       					    WHERE BZT_YR  = #{bztYr}
						          AND BZT_SNO = #{bztSno}
						          AND PCT_CNB = #{pctCnb}
						          AND BZT_EXS_SNO = #{bztExsSno}
	       					   )			
	       AND XPN_DVSN_CD = 'TREP'
    </select>
    
    <select id="selectGpcTrepInfo" parameterType="paramMap" resultType="egovMap">
    /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectGpcTrepInfo */
        SELECT CON_TRNSC_ID
			  ,GPC_TRNSC_GRAM_NO
			  ,CON_SRNO
			  ,GPC_NO
          FROM TBBADDED036D 
         WHERE 1=1
           AND BZT_YR  	   = #{bztYr}
	       AND BZT_SNO 	   = #{bztSno}
	       AND PCT_CNB 	   = #{pctCnb}
	       AND SNO 	   	   = #{rlScoSno}	
	       AND XPN_DVSN_CD = 'TREP'
    </select>
    
    <select id="selectGpcLdcInfo" parameterType="paramMap" resultType="egovMap">
    /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectGpcLdcInfo */
        SELECT CON_TRNSC_ID
			  ,GPC_TRNSC_GRAM_NO
			  ,CON_SRNO
			  ,GPC_NO
          FROM TBBADDED036D 
         WHERE 1=1
           AND BZT_YR  	   = #{bztYr}
	       AND BZT_SNO 	   = #{bztSno}
	       AND PCT_CNB 	   = #{pctCnb}
	       AND SNO 	   	   = #{bztExsSno}
	       AND XPN_DVSN_CD = 'LDC'
    </select>
    
    <select id="selectGpcAllInfo" parameterType="paramMap" resultType="egovMap">
    /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectGpcAllInfo */
        SELECT CON_TRNSC_ID
			  ,GPC_TRNSC_GRAM_NO
			  ,CON_SRNO
			  ,GPC_NO
          FROM TBBADDED036D 
         WHERE 1=1
           AND BZT_YR  	   = #{bztYr}
	       AND BZT_SNO 	   = #{bztSno}
    </select>
    
    <update id="updateAjtCnl" parameterType="paramMap">
    /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.updateAjtCnl */
        UPDATE TBBADDED036L 
           SET AJT_RFC_YN  = 'N'
         WHERE CON_TRNSC_ID		 = #{conTrnscId}
           AND GPC_TRNSC_GRAM_NO = #{gpcTrnscGramNo}
           AND CON_SRNO 		 = #{conSrno}
           AND GPC_NO 			 = #{gpcNo}
    </update>
    
    <select id="selectGpcUseAm" parameterType="paramMap"
        resultType="int">
        /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectGpcUseAm */
        <![CDATA[
        SELECT GPC_USE_AM
		  FROM TBBADDED036L
		 WHERE CON_TRNSC_ID		 = #{conTrnscId}
           AND GPC_TRNSC_GRAM_NO = #{gpcTrnscGramNo}
           AND CON_SRNO 		 = #{conSrno}
           AND GPC_NO 			 = #{gpcNo}
           AND AJT_RFC_YN        = 'Y'
        ]]>
    </select>
    
    <update id="updateRlFrExs" parameterType="paramMap">
    /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.updateRlFrExs */
        UPDATE TBBADDED017L 
           SET TRIN_KND_CD = #{trinKndCd}
           	  ,RL_FR_EXS   = #{sumUseAm}
         WHERE BZT_YR      = #{bztYr}
           AND BZT_SNO     = #{bztSno}
           AND PCT_CNB 	   = #{pctCnb}
           AND RL_SCO_SNO  = #{rlScoSno}
           AND CALC_YN     = 'Y'
    </update>
    
    <insert id="doBztTrexpHisCp" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.doBztTrexpHisCp*/
		INSERT INTO TBBADDED011L( BZT_YR
								,BZT_SNO
								,PCT_CNB
								,BZT_EXS_SNO
								,CALC_YN
								,ORG_CD
								,RGN_CD
								,RGN_DVSN_CD
								,BZT_STR_DT
								,BZT_END_DT
								,BZT_DCN
								,AUD_DCN
								,LODG_DCN
								,DT_EXS
								,LDC
								,FDEX
								,SPM_XPN
								,LEAD_EXS
								,FNL_YN
								,AUD_ACTV_RCV_EXS
								,FRT_USR_ID
								,FNL_USR_ID
								,FNL_DEAL_DPT_CD
								,FNL_MNU_ID
								,FRT_REGI_DH
								,FNL_MDF_DH
								,CPRG_FR_EXS
								,LODG_TYP_CD
								,LODG_GVM_PUR_CRD_EXMP_AM
								)
							   (
						SELECT BZT_YR
							  ,BZT_SNO
						  	  ,#{CpPctCnb}
							  ,#{objSno}
							  ,CALC_YN
							  ,ORG_CD
							  ,RGN_CD
							  ,RGN_DVSN_CD
							  ,BZT_STR_DT
							  ,BZT_END_DT
							  ,BZT_DCN
							  ,AUD_DCN
							  ,LODG_DCN
							  ,DT_EXS
							  ,LDC
							  ,FDEX
							  ,SPM_XPN
							  ,LEAD_EXS
							  ,FNL_YN
							  ,AUD_ACTV_RCV_EXS
							  ,#{usrId}
							  ,#{usrId}
							  ,FNL_DEAL_DPT_CD
							  ,FNL_MNU_ID
							  ,SYSDATE
							  ,SYSDATE
							  ,CPRG_FR_EXS
							  ,LODG_TYP_CD
							  ,LODG_GVM_PUR_CRD_EXMP_AM
						  FROM TBBADDED011L
						 WHERE BZT_YR  = #{bztYr}
						   AND BZT_SNO = #{bztSno}
						   AND PCT_CNB = #{pctCnb}
						   AND CALC_YN = 'Y'
						   AND BZT_EXS_SNO = #{bztExsSno}
							   )
    </insert>
    
     <insert id="doTfpCp" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.doTfpCp*/
		INSERT INTO TBBADDED017L( BZT_YR
								,BZT_SNO
								,RL_SCO_SNO
								,PCT_CNB
								,BZT_EXS_SNO
								,CALC_YN
								,RID_DT
								,TRIN_KND_CD
								,CHRG_DVSN_CD
								,DEP_STN_NM
								,ARV_STN_NM
								,FNL_YN
								,RL_FR_EXS
								,STND_CHRG_YN
								,FRT_USR_ID
								,FNL_USR_ID
								,FNL_DEAL_DPT_CD
								,FNL_MNU_ID
								,FRT_REGI_DH
								,FNL_MDF_DH
								,MILEAGE
								,TOLL
								,PARKING_FEE
								,RL_GVM_PUR_CRD_EXMP_AM
								)
							   (
						SELECT BZT_YR
							  ,BZT_SNO
							  ,#{maxRlScoSno}
							  ,#{CpPctCnb}
							  ,#{objSno}
							  ,CALC_YN
							  ,RID_DT
							  ,TRIN_KND_CD
							  ,CHRG_DVSN_CD
							  ,DEP_STN_NM
							  ,ARV_STN_NM
							  ,FNL_YN
							  ,RL_FR_EXS
							  ,STND_CHRG_YN
							  ,#{usrId}
							  ,#{usrId}
							  ,FNL_DEAL_DPT_CD
							  ,FNL_MNU_ID
							  ,SYSDATE
							  ,SYSDATE
							  ,MILEAGE
							  ,TOLL
							  ,PARKING_FEE
							  ,RL_GVM_PUR_CRD_EXMP_AM
						  FROM TBBADDED017L
						 WHERE BZT_YR  = #{bztYr}
						   AND BZT_SNO = #{bztSno}
						   AND PCT_CNB = #{pctCnb}
						   AND CALC_YN = 'Y'
						   AND BZT_EXS_SNO = #{bztExsSno}
						   AND RL_SCO_SNO = #{rlScoSno}
							   )
    </insert>
    
    <select id="getTakeDtStadMaxBztExsSno" parameterType="paramMap" resultType="String">
        SELECT MAX(BZT_EXS_SNO)
		  FROM TBBADDED011L
		 WHERE 1=1
		   AND BZT_YR = #{bztYr}
		   AND BZT_SNO = #{bztSno}
		   AND CALC_YN = 'Y'
		   AND ORG_CD = #{orgCd} --복사하려는 ORG_CD
		   AND PCT_CNB = #{CpPctCnb} --본인 전산번호
		   AND TO_CHAR(TO_DATE(#{ridDt}), 'YYYYMMDD') BETWEEN BZT_STR_DT AND BZT_END_DT
    </select>
    
    <select id="getBztOrgStadMaxBztExsSno" parameterType="paramMap" resultType="String">
        SELECT MAX(BZT_EXS_SNO)
		  FROM TBBADDED011L
		 WHERE 1=1
		   AND BZT_YR = #{bztYr}
		   AND BZT_SNO = #{bztSno}
		   AND CALC_YN = 'Y'
		   AND ORG_CD = #{orgCd} --복사하려는 ORG_CD
		   AND PCT_CNB = #{CpPctCnb} --본인 전산번호
    </select>
    
    <select id="selectRcdbPbsvtYn" parameterType="paramMap" resultType="String">
        SELECT NVL(RCDB_PBSVT_YN, 'N')
		  FROM TBDCMACM001M
	     WHERE 1=1
	       AND USR_ID = #{usrId}
		   AND CNB    = #{cnb}
    </select>
    
    <select id="selectBztStadLodgAm" parameterType="paramMap" resultType="String">
        /* kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectBztStadLodgAm */
        <![CDATA[
            SELECT NVL(B.BZT_STAD_AM, 0) AS BZT_STAD_AM
		      FROM TBBADDED180B A
			      ,TBBADDED018B B
			 WHERE 1=1
			   AND A.BZT_SRNO = B.BZT_SRNO
			   AND B.TREXP_CLU_CD = '05'
			   AND B.RGN_DVSN_CD = '1'
			   AND B.BZT_BGT_DVSN_CD = #{bztBgtDvsnCd}
	           AND B.AUD_BZT_KND_CD = #{audBztKndCd}
	           AND B.DT_EXS_DVSN_CD = 'LDC'
			   AND A.STAD_STR_DT <= (SELECT AUD_STR_DT
			                           FROM TBBADDED002M
			                          WHERE BZT_YR  = #{bztYr}
			                            AND BZT_SNO = #{bztSno}
			                         )
			   AND A.STAD_END_DT >= (SELECT AUD_STR_DT
			                           FROM TBBADDED002M
			                          WHERE BZT_YR  = #{bztYr}
			                            AND BZT_SNO = #{bztSno}
			                         )
        ]]>
    </select>

    <select id="selectBztStadAm" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED003EMapper.selectBztStadAm*/
            <![CDATA[
					SELECT SUM(BZT_STAD_AM1) AS DT_EXS
					      ,SUM(BZT_STAD_AM2) AS FDEX
					  FROM (SELECT 0 AS BZT_STAD_AM1
					              ,NVL(B2.BZT_STAD_AM,0) AS BZT_STAD_AM2
					          FROM TBBADDED180B B1
					        INNER JOIN TBBADDED018B B2 ON B1.BZT_SRNO = B2.BZT_SRNO
					         WHERE 1=1
					           /* 출장비단가기준을 감사출장과 일반출장으로 분리 */
					           AND B1.BZT_DVSN_CD = '1'
					           AND B2.TREXP_CLU_CD = '01'
					           AND B1.STAD_STR_DT <= REPLACE(#{bztStrDt},'-','') AND B1.STAD_END_DT >= REPLACE(#{bztStrDt},'-','')
					           AND B2.RANK_DVSN_CD = '69' /*기준금액설정(6-9급)*/
					           AND B2.RGN_DVSN_CD = CASE 
												      WHEN (#{rgnDvsnCd} = 1 OR #{rgnDvsnCd} = 7) THEN 1
												      WHEN (#{rgnDvsnCd} = 2 OR #{rgnDvsnCd} = 8 OR #{rgnDvsnCd} = 9) THEN 2
												      ELSE 3
												    END                              /*식비: 지역구분 1, 7 > '1' 이고, 지역구분 2, 8, 9 > '2' 이고, 나머지 '3', [2023-431] 이시형 감사관 요청*/
					        UNION ALL
					        SELECT NVL(B2.BZT_STAD_AM,0) AS BZT_STAD_AM1
					              ,0 AS BZT_STAD_AM2
					          FROM TBBADDED180B B1
					        INNER JOIN TBBADDED018B B2 ON B1.BZT_SRNO = B2.BZT_SRNO
					         WHERE 1=1
					           /* 출장비단가기준을 감사출장과 일반출장으로 분리 */
					           AND B1.BZT_DVSN_CD = '1'
					           AND B2.TREXP_CLU_CD = '02'
					           AND B1.STAD_STR_DT <= REPLACE(#{bztStrDt},'-','') AND B1.STAD_END_DT >= REPLACE(#{bztStrDt},'-','')
					           AND B2.RGN_DVSN_CD = CASE 
											          WHEN (#{rgnDvsnCd} = 1 OR #{rgnDvsnCd} = 7) THEN 1
											          ELSE 0
											        END                              /*일비: 지역구분 1, 7 > '1' 아니면 '0', [2023-431] 이시형 감사관 요청*/
					         )
            ]]>
    </select>
    
</mapper>