<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--   -->
<mapper namespace="kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper">
	<!-- 부의사항처리부 요청 등록 -->
	<insert id="BADFRE112MInsert">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE112MInsert */
        <![CDATA[
        INSERT INTO TBBADFRE112M(
                                 ACP_YR,
                                 ACP_DVSN_CD,
                                 ACP_SRNO,
                                 TIT_NM,
                                 SBCN_TRTM_REQ_DT,
                                 SHARE_YN,
                                 FRT_USR_ID,
                                 FNL_USR_ID,
                                 FNL_DEAL_DPT_CD,
                                 FNL_MNU_ID,
                                 FRT_REGI_DH,
                                 FNL_MDF_DH)
                          VALUES(#{acpYr},
                                 #{acpDvsnCd},
                                 #{acpSrno},
                                 #{titNm},
                                 TO_CHAR(SYSDATE,'YYYYMMDD'),
                                 'N',
                                 #{frtUsrId},
                                 #{fnlUsrId},
                                 #{fnlDealDptCd},
                                 'BADFRE313E',
                                 SYSDATE,
                                 SYSDATE)
        ]]>
    </insert>

	<!-- 저장할 부의사항 처리부 상세 조회 -->
	<select id="BADFRE112DNewSelect" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE112DNewSelect */
        SELECT  A.ACP_YR
			      ,A.ACP_DVSN_CD
			      ,A.ACP_SRNO
			      ,B.DOC_ID
			      ,CASE WHEN (A.ACP_YR = A.MG_ACP_YR AND A.ACP_DVSN_CD = A.MG_ACP_DVSN_CD AND A.ACP_SRNO = A.MG_ACP_SRNO) THEN '대표'
					  	  WHEN A.MG_DIV_CD IS NULL AND A.MG_ACP_YR IS NULL THEN '대표'
						  WHEN A.MG_DIV_CD IS NULL THEN '대표'
						  WHEN A.MG_DIV_CD = '10' THEN '병합'
					 	  WHEN A.MG_DIV_CD = '20' THEN '병행'
					END AS MG_DIV_NM /* 병합병행구분명 */
	     FROM TBBADFRE012M A
			     ,TBBADFRE103M B
	    WHERE A.ACP_YR = B.ACP_YR
		   AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		   AND A.ACP_SRNO = B.ACP_SRNO
		 <if test='acpYr != null and acpYr != ""'>
           AND A.ACP_YR = #{acpYr}
        </if>
        <if test='acpDvsnCd != null and acpDvsnCd != ""'>
           AND A.ACP_DVSN_CD = #{acpDvsnCd}
        </if>
        <if test='acpSrno != null and acpSrno != ""'>
           AND A.ACP_SRNO = #{acpSrno}
        </if>
		<if test='acpStepCd == "D1030"'> <!-- 심사 요약문 -->
		   AND B.ACP_STEP_CD = 'D1020'
		   AND B.RPRT_CD = 'D10200200'
		 </if>
		 <if test='acpStepCd == "E1030"'> <!-- 재심 심의안 -->
		   AND B.ACP_STEP_CD = 'E1020'
		   AND B.RPRT_CD = 'E10200200'
		 </if>
		 <if test='acpStepCd == "E1050"'> <!-- 재심 결정문 -->
		   AND B.ACP_STEP_CD = 'E1040'
		   AND B.RPRT_CD = 'E10400200'
		 </if>
		ORDER BY MG_DIV_NM
    </select>

	<!-- 부의사항 처리부 상세 등록 -->
    <insert id="BADFRE112DInsert">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE112DInsert */
        <![CDATA[
        INSERT INTO TBBADFRE112D(
        						ACP_YR,
        						ACP_DVSN_CD,
        						ACP_SRNO,
        						SBCN_TRTM_DTL_SNO,
        						DOC_ID,
        						SORT_SNO,
        						FRT_USR_ID,
        						FNL_USR_ID,
        						FNL_DEAL_DPT_CD,
        						FNL_MNU_ID,
								FRT_REGI_DH,
								FNL_MDF_DH
								)
                         VALUES(#{acpYr},
                                   #{acpDvsnCd},
                                   #{acpSrno},
                                   (SELECT LPAD(NVL(MAX(TO_NUMBER(SBCN_TRTM_DTL_SNO)),0)+1,3,0)
                                     FROM TBBADFRE112D
                                    WHERE ACP_YR = #{acpYr}
                                       AND ACP_DVSN_CD = #{acpDvsnCd}
                                       AND ACP_SRNO = #{acpSrno} ),
                                   #{docId},
                                   (SELECT LPAD(NVL(MAX(TO_NUMBER(SBCN_TRTM_DTL_SNO)),0)+1,3,0)
                                     FROM TBBADFRE112D
                                    WHERE ACP_YR = #{acpYr}
                                       AND ACP_DVSN_CD = #{acpDvsnCd}
                                       AND ACP_SRNO = #{acpSrno} ),
                                   #{fnlUsrId},
                                   #{fnlUsrId},
                                   #{fnlDealDptCd},
                                   'BADFRE313E',
                                   SYSDATE,
                                   SYSDATE)
        ]]>
    </insert>

	<!-- 부의사항 처리부 목록 -->
    <select id="BADFRE112MSelect" parameterType="paramMap" resultType="egovMap">
         /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE112MSelect */
        <![CDATA[
            SELECT
                    ACP_YR || '-' || DECODE(ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || ACP_SRNO AS ACP_NO /* 분류번호 */
                   ,ACP_YR
                   ,ACP_DVSN_CD
                   ,ACP_SRNO
                   ,TIT_NM
                   ,(SELECT F_DPT_INFO (DPT_CD, '1') AS DPT_NM /* 처리과 */
                    FROM TBBADFRE012M ST
                    WHERE ST.ACP_YR = A.ACP_YR
		               AND ST.ACP_DVSN_CD = A.ACP_DVSN_CD
		               AND ST.ACP_SRNO = A.ACP_SRNO)        AS MNG_DPT_NM
                   ,REGI_NO
                   , (SELECT DECODE(CHF_CMTR_CNB, NULL, '', F_USR_INFO(ST1.CHF_CMTR_CNB, '2')||DECODE(DECODE(ST1.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR5_CNB, NULL, 0, 1), 0, '', ' 외 ' || TO_CHAR(DECODE(ST1.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR5_CNB, NULL, 0, 1))) )
                       FROM TBBADDED116L ST1
                      WHERE ST1.AUD_YR = A.ACP_YR AND ST1.AUD_NO = TO_CHAR(A.ACP_SRNO) AND ST1.TASK_DVSN_CD = A.ACP_DVSN_CD
                        AND ST1.SRNO = (SELECT MAX(ST2.SRNO) FROM TBBADDED116L ST2 WHERE ST2.AUD_YR = A.ACP_YR AND ST2.AUD_NO = TO_CHAR(A.ACP_SRNO) AND TASK_DVSN_CD = A.ACP_DVSN_CD)) AS CHF_CMTR_NM
                   ,(SELECT ST1.CHF_CMTR_CNB
                       FROM TBBADDED116L ST1
                      WHERE ST1.AUD_YR = A.ACP_YR AND ST1.AUD_NO = TO_CHAR(A.ACP_SRNO) AND ST1.TASK_DVSN_CD = A.ACP_DVSN_CD
                      AND ST1.SRNO = (SELECT MAX(ST2.SRNO) FROM TBBADDED116L ST2 WHERE ST2.AUD_YR = A.ACP_YR AND ST2.AUD_NO = TO_CHAR(A.ACP_SRNO) AND TASK_DVSN_CD = A.ACP_DVSN_CD)) AS CHF_CMTR_ID
                   ,(SELECT DECODE(COUNT(1),0,1,COUNT(1))
                    FROM TBBADFRE012M ST
                    WHERE ST.MG_ACP_YR = A.ACP_YR
		               AND ST.MG_ACP_DVSN_CD = A.ACP_DVSN_CD
		               AND ST.MG_ACP_SRNO = A.ACP_SRNO
		               AND ST.DEL_YN IS NULL) AS TOT_SBCN_CNT  /* 전체부의건수 */
                   ,(SELECT COUNT(ST2.ACP_YR)
	                  FROM TBBADFRE012M ST1
                      LEFT OUTER JOIN TBBADFRE113M ST2 ON (ST1.ACP_YR = ST2.ACP_YR AND ST1.ACP_DVSN_CD = ST2.ACP_DVSN_CD AND ST1.ACP_SRNO = ST2.ACP_SRNO)
	                 WHERE NVL(ST1.MG_ACP_YR, ST1.ACP_YR) = A.ACP_YR
	                    AND NVL(ST1.MG_ACP_DVSN_CD, ST1.ACP_DVSN_CD) = A.ACP_DVSN_CD
	                    AND NVL(ST1.MG_ACP_SRNO, ST1.ACP_SRNO) = A.ACP_SRNO
                        AND ST2.SBCN_VT_CD <> '90'
	                    ) AS HNDL_SBCN_CNT /*  부의 처리건수 */
            FROM TBBADFRE112M A
            WHERE A.ACP_YR = #{acpYr}
               AND A.ACP_DVSN_CD = #{acpDvsnCd}
               AND A.ACP_SRNO = #{acpSrno}
        ]]>
    </select>

	<!-- 부의사항 처리부 상세 목록 -->
    <select id="BADFRE112DSelect" parameterType="paramMap" resultType="egovMap">
       /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE112DSelect */
       <![CDATA[
	         SELECT T1.ACP_YR,
			        T1.ACP_DVSN_CD,
			        T1.ACP_SRNO,
			        T2.RPRT_NM AS RPRT_NM,
			        T2.DOC_ID AS DOC_ID,
			        T2.REF_ID AS REF_ID,
			        T1.SBCN_TRTM_DTL_SNO,
	 				(SELECT TO_CHAR(MAX(FNL_APV_DH),'YYYY"-"MM"-"DD" "HH24:MI')
	                 FROM TBDCMACM022L ST1
	                 INNER JOIN TBBADFRE103M ST2 ON (ST2.APV_RQS_ID = ST1.APV_DOC_NO)
	                 WHERE ST2.ACP_YR = T1.ACP_YR
	                 AND ST2.ACP_DVSN_CD = T1.ACP_DVSN_CD
                     AND ST2.ACP_SRNO = T1.ACP_SRNO
                     AND ST2.RPRT_CD IN ('D10200200', 'E10400200')
                     AND ST2.APV_STA_CD = '30'
                     AND ST1.APV_STA_CD = '3'
	                ) AS PSD_APV_DY, /* 사무처 결재일자: 결정문 결재일자 */
	                (SELECT DECODE(COUNT(1),0,1,COUNT(1))
	                  FROM TBBADFRE012M
	                 WHERE MG_ACP_YR = T1.ACP_YR
	                    AND MG_ACP_DVSN_CD = T1.ACP_DVSN_CD
	                    AND MG_ACP_SRNO = T1.ACP_SRNO
	                    AND DEL_YN IS NULL) AS TOT_DSVN_CNT, /*  사무처 부의건수 */
	                (SELECT TO_CHAR(MAX(APV_DH),'YYYY"-"MM"-"DD" "HH24:MI')
	                  FROM TBDCMACM023L ST1 
                      JOIN TBBADFRE103M ST2 ON (ST1.APV_DOC_NO = ST2.APV_RQS_ID)
	                WHERE ST2.ACP_YR = T1.ACP_YR
                       AND ST2.ACP_DVSN_CD = T1.ACP_DVSN_CD
	                   AND ST2.ACP_SRNO = T1.ACP_SRNO
	                   AND ST2.APV_STA_CD = '30'
	                   AND ST2.REF_DOC_ID = T1.DOC_ID
	                   AND ST2.ACP_STEP_CD IN ('D1030', 'E1050')
	                   AND ST2.RPRT_CD IN ('D10300200', 'E10500200')
	                   group by ST2.apv_sta_cd
	                   ) AS CHF_APV_DY, /* 주심위원 결재일자: 주심위원 설명자료 결재일자 */
	                (SELECT DECODE(A.PRE_REFER_ENT,'N',DECODE(COUNT(1),0,1,COUNT(1)),0)
	                  FROM TBBADFRE012M A
	                 WHERE NVL(A.MG_ACP_YR, A.ACP_YR) = T1.ACP_YR
	                    AND NVL(A.MG_ACP_DVSN_CD, A.ACP_DVSN_CD) = T1.ACP_DVSN_CD
	                    AND NVL(A.MG_ACP_SRNO, ACP_SRNO) = T1.ACP_SRNO
	                    AND A.DEL_YN IS NULL
	                    GROUP BY A.PRE_REFER_ENT) AS PRE_DSVN_CNT, /*  사무처 부의건수 */
	                (SELECT DECODE(A.PRE_REFER_ENT,'Y',DECODE(COUNT(1),0,1,COUNT(1)),0)
	                  FROM TBBADFRE012M A
	                 WHERE NVL(A.MG_ACP_YR, A.ACP_YR) = T1.ACP_YR
	                    AND NVL(A.MG_ACP_DVSN_CD, A.ACP_DVSN_CD) = T1.ACP_DVSN_CD
	                    AND NVL(A.MG_ACP_SRNO, ACP_SRNO) = T1.ACP_SRNO
	                    AND A.DEL_YN IS NULL
	                    GROUP BY A.PRE_REFER_ENT) AS PRE_REFER_CNT, /* 사무처 위임건수 */
	                (SELECT DECODE(A.REFER_ENT,'N',DECODE(COUNT(1),0,1,COUNT(1)),0)
	                  FROM TBBADFRE012M A
	                 WHERE NVL(A.MG_ACP_YR, A.ACP_YR) = T1.ACP_YR
	                    AND NVL(A.MG_ACP_DVSN_CD, A.ACP_DVSN_CD) = T1.ACP_DVSN_CD
	                    AND NVL(A.MG_ACP_SRNO, ACP_SRNO) = T1.ACP_SRNO
	                    AND A.DEL_YN IS NULL
	                    GROUP BY A.REFER_ENT) AS HNDL_DSVN_CNT, /*  주심위원 부의건수 */
	                (SELECT DECODE(A.REFER_ENT,'Y',DECODE(COUNT(1),0,1,COUNT(1)),0)
	                  FROM TBBADFRE012M A
	                 WHERE NVL(A.MG_ACP_YR, A.ACP_YR) = T1.ACP_YR
	                    AND NVL(A.MG_ACP_DVSN_CD, A.ACP_DVSN_CD) = T1.ACP_DVSN_CD
	                    AND NVL(A.MG_ACP_SRNO, ACP_SRNO) = T1.ACP_SRNO
	                    AND A.DEL_YN IS NULL
	                    GROUP BY A.REFER_ENT) AS HNDL_REFER_CNT, /*  주심위원 위임건수 */
	                CASE
	                    WHEN T3.SBCN_DY IS NULL THEN ''
	                    ELSE TO_CHAR(TO_DATE(NVL(SBCN_DY,'99991231')),'YYYY"-"MM"-"DD" "HH24:MI')
	                END  AS SBCN_DY, /* 감사위원회의 부의: 결재일자 */
	                (SELECT COUNT(B.ACP_YR)
	                  FROM TBBADFRE012M A
                      LEFT OUTER JOIN TBBADFRE113M B ON (A.ACP_YR = B.ACP_YR AND A.ACP_DVSN_CD = B.ACP_DVSN_CD AND A.ACP_SRNO = B.ACP_SRNO)
	                 WHERE NVL(A.MG_ACP_YR, A.ACP_YR) = T1.ACP_YR
	                    AND NVL(A.MG_ACP_DVSN_CD, A.ACP_DVSN_CD) = T1.ACP_DVSN_CD
	                    AND NVL(A.MG_ACP_SRNO, A.ACP_SRNO) = T1.ACP_SRNO
	                    AND T3.DOC_ID = B.DOC_ID
                        AND B.SBCN_VT_CD  <>  '90'
	                    ) AS VT_CNT, /*  의결건수 */
                    (SELECT COUNT(B.ACP_YR)
	                  FROM TBBADFRE113M B
                      INNER JOIN TBBADFRE012M A ON (A.ACP_YR = B.ACP_YR AND A.ACP_DVSN_CD = B.ACP_DVSN_CD AND A.ACP_SRNO = B.ACP_SRNO)
	                 WHERE  NVL(A.MG_ACP_YR, A.ACP_YR) = T1.ACP_YR
	                    AND NVL(A.MG_ACP_DVSN_CD, A.ACP_DVSN_CD) = T1.ACP_DVSN_CD
	                    AND NVL(A.MG_ACP_SRNO, A.ACP_SRNO) = T1.ACP_SRNO
	                    AND T3.DOC_ID = B.DOC_ID
                        AND B.SBCN_VT_CD = '90'
	                    ) AS DF_CNT, /*  보류건수 */
	                T2.RPRT_CD,
	                T2.ACP_RPRT_DVSN_CD,
	                T1.RVW_REQ_DT,
	                T1.REGI_NO,
                    T4.CHF_CMTR_CNB,
                    DECODE(T4.CHF_CMTR_CNB, NULL, '', F_USR_INFO(T4.CHF_CMTR_CNB, '2')||DECODE(DECODE(T4.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR5_CNB, NULL, 0, 1), 0, '', ' 외 ' || TO_CHAR(DECODE(T4.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR5_CNB, NULL, 0, 1)))) AS CHF_CMTR_NM
                  , F_OPEN_EDIT(T2.LINK_URL) AS DOC_TYPE
       FROM TBBADFRE112D T1 
       INNER JOIN TBBADFRE103M T2 ON (T2.ACP_YR = T1.ACP_YR 
                                     AND T2.ACP_DVSN_CD = T1.ACP_DVSN_CD 
                                     AND T2.ACP_SRNO = T1.ACP_SRNO 
                                     AND T2.DOC_ID = T1.DOC_ID 
                                     AND T2.APV_STA_CD = '30' 
                                     AND T2.RPRT_CD NOT IN ('E10200200','E10300150') 
                                     AND T2.ACP_STEP_CD = (SELECT MAX(ACP_STEP_CD) 
                                                        FROM TBBADFRE103M 
                                                        WHERE ACP_YR = T1.ACP_YR 
                                                        AND ACP_DVSN_CD = T1.ACP_DVSN_CD 
                                                        AND ACP_SRNO = T1.ACP_SRNO 
                                                        AND DOC_ID = T1.DOC_ID 
                                                        AND APV_STA_CD = '30' 
                                                        AND RPRT_CD NOT IN ('E10200200','E10300150')))
       LEFT JOIN TBBADFRE113M T3 ON (T3.ACP_YR = T1.ACP_YR
	                                         AND T3.ACP_DVSN_CD = T1.ACP_DVSN_CD
                                             AND T3.ACP_SRNO = T1.ACP_SRNO
	                                         AND T3.DOC_ID = T1.DOC_ID)
	   LEFT OUTER JOIN TBBADDED116L T4 ON (T4.AUD_YR = T1.ACP_YR
	                                         AND T4.TASK_DVSN_CD = T1.ACP_DVSN_CD
                                             AND T4.AUD_NO = T1.ACP_SRNO
                                             AND T4.DOC_ID = T1.DOC_ID
                                             AND T4.SRNO = (SELECT MAX(SRNO) FROM TBBADDED116L WHERE AUD_YR = T1.ACP_YR AND AUD_NO = T1.ACP_SRNO AND TASK_DVSN_CD = T1.ACP_DVSN_CD AND DOC_ID = T1.DOC_ID))
	   WHERE 1=1
	   AND T1.ACP_DVSN_CD = #{acpDvsnCd}
	   AND T1.ACP_YR = #{acpYr}
	   AND T1.ACP_SRNO = #{acpSrno}
	   ORDER BY T1.SBCN_TRTM_DTL_SNO
    ]]>
    </select>

	<!-- 부의사항 처리부 상세 목록(재심의소위) -->
    <select id="BADFRE112DSelect2" parameterType="paramMap" resultType="egovMap">
       /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE112DSelect2 */
	       SELECT T1.ACP_YR,
			        T1.ACP_DVSN_CD,
			        T1.ACP_SRNO,
			        T2.RPRT_NM,
			        T2.DOC_ID,
			        T2.REF_ID,
			        T1.SBCN_TRTM_DTL_SNO,
	 				(SELECT TO_CHAR(MAX(APV_DH),'YYYY"-"MM"-"DD" "HH24:MI')
	                FROM TBDCMACM023L ST1
	                WHERE ST1.APV_DOC_NO = T2.APV_RQS_ID
                    AND T2.APV_STA_CD = '30'
	                   ) AS PSD_APV_DY, /* 사무처 결재일자: 결정문 결재일자 */
	                (SELECT DECODE(COUNT(1),0,1,COUNT(1))
	                  FROM TBBADFRE012M
	                 WHERE MG_ACP_YR = T1.ACP_YR
	                    AND MG_ACP_DVSN_CD = T1.ACP_DVSN_CD
	                    AND MG_ACP_SRNO = T1.ACP_SRNO
	                    AND DEL_YN IS NULL) AS TOT_DSVN_CNT, /*  사무처 부의건수 */
	                (SELECT TO_CHAR(MAX(APV_DH),'YYYY"-"MM"-"DD" "HH24:MI')
	                  FROM TBDCMACM023L ST1 
                      JOIN TBBADFRE103M ST2 ON (ST1.APV_DOC_NO = ST2.APV_RQS_ID)
	                WHERE ST2.ACP_YR = T1.ACP_YR
                       AND ST2.ACP_DVSN_CD = T1.ACP_DVSN_CD
	                   AND ST2.ACP_SRNO = T1.ACP_SRNO
	                   AND ST2.APV_STA_CD = '30'
	                   AND ST2.ACP_STEP_CD = 'E1030'
	                   AND ST2.RPRT_CD = 'E10300150'
	                   group by ST2.apv_sta_cd
	                   ) AS CHF_APV_DY, /* 주심위원 결재일자: 주심위원 설명자료 결재일자 */
	                (SELECT DECODE(COUNT(1),0,1,COUNT(1))
	                  FROM TBBADFRE012M
	                 WHERE MG_ACP_YR = T1.ACP_YR
	                    AND MG_ACP_DVSN_CD = T1.ACP_DVSN_CD
	                    AND MG_ACP_SRNO = T1.ACP_SRNO
	                    AND DEL_YN IS NULL) AS HNDL_DSVN_CNT, /*  주심의원 부의건수 */
	                CASE
	                    WHEN MIN(T3.SBCN_DY) IS NULL THEN ''
	                    ELSE TO_CHAR(TO_DATE(MIN(NVL(SBCN_DY,'99991231'))),'YYYY"-"MM"-"DD" "HH24:MI')
	                END  AS SBCN_DY, /* 감사위원회의 부의: 결재일자 */
	                (SELECT COUNT(B.ACP_YR)
	                  FROM TBBADFRE012M A
                      LEFT OUTER JOIN TBBADFRE113M B ON (A.ACP_YR = B.ACP_YR AND A.ACP_DVSN_CD = B.ACP_DVSN_CD AND A.ACP_SRNO = B.ACP_SRNO)
	                 WHERE NVL(A.MG_ACP_YR, A.ACP_YR) = T1.ACP_YR
	                    AND NVL(A.MG_ACP_DVSN_CD, A.ACP_DVSN_CD) = T1.ACP_DVSN_CD
	                    AND NVL(A.MG_ACP_SRNO, A.ACP_SRNO) = T1.ACP_SRNO
	                    AND T1.DOC_ID = B.DOC_ID
                        AND B.SBCN_VT_CD <![CDATA[<>]]> '90'
	                    ) AS VT_CNT, /*  의결건수 */
                    (SELECT COUNT(B.ACP_YR)
	                  FROM TBBADFRE012M A
                      LEFT OUTER JOIN TBBADFRE113M B ON (A.ACP_YR = B.ACP_YR AND A.ACP_DVSN_CD = B.ACP_DVSN_CD AND A.ACP_SRNO = B.ACP_SRNO)
	                 WHERE  NVL(A.MG_ACP_YR, A.ACP_YR) = T1.ACP_YR
	                    AND NVL(A.MG_ACP_DVSN_CD, A.ACP_DVSN_CD) = T1.ACP_DVSN_CD
	                    AND NVL(A.MG_ACP_SRNO, A.ACP_SRNO) = T1.ACP_SRNO
	                    AND T1.DOC_ID = B.DOC_ID
                        AND B.SBCN_VT_CD = '90'
	                    ) AS DF_CNT, /*  보류건수 */
	                T2.RPRT_CD,
	                T2.ACP_RPRT_DVSN_CD,
	                T1.RVW_REQ_DT,
	                T1.REGI_NO,
                    T4.CHF_CMTR_CNB,
                    DECODE(T4.CHF_CMTR_CNB, NULL, '', F_USR_INFO(T4.CHF_CMTR_CNB, '2')||DECODE(DECODE(T4.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR5_CNB, NULL, 0, 1), 0, '', ' 외 ' || TO_CHAR(DECODE(T4.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(T4.CHF_CMTR5_CNB, NULL, 0, 1)))) AS CHF_CMTR_NM
               , F_OPEN_EDIT(T2.LINK_URL) AS DOC_TYPE
	        FROM TBBADFRE112D T1
	        LEFT OUTER JOIN TBBADFRE103M T2 ON (T1.ACP_YR = T2.ACP_YR
	                                         AND T1.ACP_DVSN_CD = T2.ACP_DVSN_CD
                                             AND T1.ACP_SRNO = T2.ACP_SRNO
                                             AND T1.DOC_ID = T2.DOC_ID)
	    LEFT JOIN TBBADFRE113M T3 ON (T3.ACP_YR = T2.ACP_YR
	                                         AND T2.ACP_DVSN_CD = T3.ACP_DVSN_CD
                                             AND T2.ACP_SRNO = T3.ACP_SRNO
	                                         AND T3.DOC_ID = T2.DOC_ID)
	    LEFT OUTER JOIN TBBADDED116L T4 ON (T4.AUD_YR = T1.ACP_YR
	                                         AND T4.TASK_DVSN_CD = T1.ACP_DVSN_CD
                                             AND T4.AUD_NO = TO_CHAR(T1.ACP_SRNO)
                                             AND T4.DOC_ID = T1.DOC_ID
                                             AND T4.SRNO = (SELECT MAX(SRNO) FROM TBBADDED116L WHERE AUD_YR = T1.ACP_YR AND AUD_NO = TO_CHAR(T1.ACP_SRNO) AND TASK_DVSN_CD = T1.ACP_DVSN_CD AND DOC_ID = T1.DOC_ID))
	       WHERE 1=1
	          AND T1.ACP_DVSN_CD = #{acpDvsnCd}
	          AND T1.ACP_YR = #{acpYr}
	          AND T1.ACP_SRNO = #{acpSrno}
              AND T2.RPRT_CD IN ('E10200200')
	   GROUP BY T1.ACP_YR, T2.apv_sta_cd,T1.ACP_DVSN_CD, T1.ACP_SRNO, T2.RPRT_NM, T2.DOC_ID, T2.REF_ID, T1.SBCN_TRTM_DTL_SNO, T2.APV_RQS_ID
	   		    , T2.RPRT_CD, T2.ACP_RPRT_DVSN_CD, T1.DOC_ID, T1.RVW_REQ_DT, T1.REGI_NO, T4.CHF_CMTR_CNB, T4.CHF_CMTR1_CNB, T4.CHF_CMTR2_CNB, T4.CHF_CMTR3_CNB, T4.CHF_CMTR4_CNB, T4.CHF_CMTR5_CNB, T2.LINK_URL
	   ORDER BY T1.SBCN_TRTM_DTL_SNO
    </select>
    
    
    <!-- 소위원회 안건등록 -->
    <insert id="BADFRE114MInsert" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE114MInsert */
        <![CDATA[
			INSERT INTO TBBADFRE114M(
					             ACP_YR
					            ,ACP_DVSN_CD
					            ,ACP_SRNO
					            ,ACP_STEP_CD
					            ,DOC_ID
					            ,APVR_CD /* 직급:과장 */
					            ,AFF_SNO
					            ,SBMT_SEQ
					            ,TITLE_NM
					            ,SBMT_DVSN_CD
					            ,SBMT_STA_CD
					            ,FRT_USR_ID
					            ,FNL_USR_ID
					            ,FNL_DEAL_DPT_CD
					            ,FNL_MNU_ID
					            ,FRT_REGI_DH
					            ,FNL_MDF_DH
					            )
					    VALUES(
					             #{acpYr}
					            , #{acpDvsnCd}
					            , #{acpSrno}
					            , #{acpStepCd}
					            , (SELECT DOC_ID
					                FROM TBBADFRE103M
					              WHERE ACP_YR = #{acpYr}
					                 AND ACP_DVSN_CD = #{acpDvsnCd}
					                 AND ACP_SRNO = #{acpSrno}
		]]>
                                 <if test='acpDvsnCd == "1"'>
								    AND ACP_STEP_CD = 'D1020'
								    AND RPRT_CD = 'D10200200')
								 </if>
								 <if test='acpDvsnCd == "2"'>
								    AND ACP_STEP_CD = 'E1020'
								    AND RPRT_CD = 'E10200200')
								 </if>
		<![CDATA[
					            , '0013600'
					            , (SELECT NVL((SELECT MAX(NVL(AFF_SNO,0))
					                                      FROM TBBADFRE114M
					                                     WHERE ACP_YR = #{acpYr}),0) + 1
					                  FROM DUAL)
					            , (SELECT NVL((SELECT MAX(NVL(SBMT_SEQ,0))
					                                      FROM TBBADFRE114M
					                                     WHERE ACP_YR = #{acpYr}),0) + 1
					                  FROM DUAL)
					            , #{titleNm}
					            , DECODE(#{acpDvsnCd},'1','D10','2','E10')
					            ,'10'
					            , #{frtUsrId}
					            , #{fnlUsrId}
					            , #{fnlDealDptCd}
					            , 'BADFRE313E'
					            , SYSDATE
					            , SYSDATE
					            )
		]]>
    </insert>


    <!-- 소위원회 안건 목록 -->
    <select id="BADFRE114MSelect" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE114MSelect */
            SELECT  T1.ACP_YR || '-' || DECODE(T1.ACP_DVSN_CD, '1', '심사', '2', '재심', '3', '재심판정') || '-' || T1.ACP_SRNO AS ACP_NO /* 분류번호 */,
			        NVL(T2.TIT_NM, T1.TIT_NM) AS TITLE_NM,
			        ( SELECT DECODE(CHF_CMTR_CNB, NULL, '', F_USR_INFO (ST1.CHF_CMTR_CNB, '2') || DECODE(DECODE(ST1.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR5_CNB, NULL, 0, 1),
						                  0,
						                  '',
						                  ' 외 ' || TO_CHAR(DECODE(ST1.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR5_CNB, NULL, 0, 1) ) ) )
						             FROM TBBADDED116L ST1
						            WHERE ST1.AUD_YR = DECODE(T1.MG_DIV_CD,'20',T1.MG_ACP_YR,T1.ACP_YR)
						              AND ST1.AUD_NO = DECODE(T1.MG_DIV_CD,'20',T1.MG_ACP_SRNO,T1.ACP_SRNO)
						              AND ST1.TASK_DVSN_CD = DECODE(T1.MG_DIV_CD,'20',T1.MG_ACP_DVSN_CD,T1.ACP_DVSN_CD)
						              AND ST1.DOC_ID IN (SELECT DISTINCT DOC_ID FROM TBBADFRE103M WHERE REF_ID = T1.DOC_ID AND ACP_STEP_CD IN ('D1020','E1020'))
						              AND ST1.SRNO = ( SELECT MAX(SRNO)
						                                 FROM TBBADDED116L
						                                WHERE AUD_YR = DECODE(T1.MG_DIV_CD,'20',T1.MG_ACP_YR,T1.ACP_YR)
						                                  AND AUD_NO = DECODE(T1.MG_DIV_CD,'20',T1.MG_ACP_SRNO,T1.ACP_SRNO)
						                                  AND DOC_ID IN (SELECT DISTINCT DOC_ID FROM TBBADFRE103M WHERE REF_ID = T1.DOC_ID AND ACP_STEP_CD IN ('D1020','E1020'))
						                                  AND TASK_DVSN_CD = DECODE(T1.MG_DIV_CD,'20',T1.MG_ACP_DVSN_CD,T1.ACP_DVSN_CD)) ) AS CHF_CMTR_NM,
						        T2.SBMT_DVSN_NO || '소위' AS SBMT_DVSN_NM,
			        TO_CHAR(TO_DATE(T1.SBMT_PLAN_DT),
			        'YYYY"-"MM"-"DD') AS SBMT_PLAN_DT,
			        T1.SBMT_REL_CON,
			        (SELECT NVL(SUM(DECODE(ATTEN_NAME,NULL,0,1)+DECODE(AGT_NAME,NULL,0,1)),0)
			                     FROM TBBADDED114D ST1
			                    WHERE ST1.AUD_YR = T1.ACP_YR
			                      AND ST1.AUD_NO = TO_CHAR(T1.ACP_SRNO)
			                      AND ST1.AUD_STEP_CD = T1.ACP_STEP_CD
			                      AND ST1.DOC_ID = T1.DOC_ID
			                      AND ST1.APVR_CD = T1.APVR_CD
			                      AND ST1.AFF_SNO = T1.AFF_SNO
			                      AND ST1.SBMT_SEQ = T1.SBMT_SEQ
			                      AND ST1.SBMT_DTL_DVSN NOT IN ('90')) AS SBMT_REL_PER,
			        NVL(TO_CHAR(T1.SBMT_REQ_DT,
			        'YYYY"-"MM"-"DD'),
			        '미요청') AS SBMT_REQ_DT,
			        T1.SBMT_NO,
			        NVL(TO_CHAR(TO_DATE(T1.SBMT_FIX_DT),
			        'YYYY"-"MM"-"DD'),
			        '미확정') AS SBMT_FIX_DT,
			        F_CODE_NM ('1000808',
			        T1.SBMT_STA_CD) AS SBMT_STA_NM,
			        T1.ACP_YR,
			        T1.ACP_DVSN_CD,
			        T1.ACP_SRNO,
			        T1.ACP_STEP_CD,
			        T1.DOC_ID,
			        T1.APVR_CD,
			        T1.AFF_SNO,
			        T1.SBMT_SEQ,
			        T1.ACP_MAIN_STEP_SNO,
			        DECODE(T1.SBMT_REQ_DT, NULL, 'N', 'Y') AS SBMT_REQ_YN,
			        T1.MG_ACP_YR,
			        T1.MG_ACP_SRNO,
			        T1.MG_ACP_DVSN_CD,
			        T1.MG_DIV_CD
			   FROM (
			   				SELECT ST1.SBMT_SEQ AS SBMT_SEQ,
			                      ST2.MG_DIV_CD,
			                      DECODE(ST2.MG_DIV_CD, NULL, ST1.ACP_YR, ST2.MG_ACP_YR) AS RF_ACP_YR,
			                      DECODE(ST2.MG_DIV_CD, NULL, ST1.ACP_SRNO, ST2.MG_ACP_SRNO) AS RF_ACP_SRNO,
			                      DECODE(ST2.MG_DIV_CD, NULL, ST1.ACP_DVSN_CD, ST2.MG_ACP_DVSN_CD) AS RF_ACP_DVSN_CD,
			                      ST1.ACP_YR,
			                      ST1.ACP_SRNO,
			                      ST1.ACP_DVSN_CD,
			                      ST1.ACP_STEP_CD,
			                      ST1.DOC_ID,
			                      ST2.DPT_CD,
			                      ST1.SBMT_PLAN_DT,
			                      ST1.SBMT_REL_CON,
			                      ST1.SBMT_REL_PER,
			                      ST1.SBMT_REQ_DT,
			                      ST1.SBMT_NO,
			                      ST1.SBMT_FIX_DT,
			                      ST1.SBMT_STA_CD,
			                      ST1.APVR_CD,
			                      ST1.AFF_SNO,
			                      ST1.ACP_MAIN_STEP_SNO,
			                      ST2.TIT_NM,
			                      F_CODE_NM('1000045', ST2.VT_KND_CD) AS DSP_RQ_NM,
			                      ST2.MG_ACP_YR,
							      ST2.MG_ACP_SRNO,
							      ST2.MG_ACP_DVSN_CD
			                 FROM TBBADFRE114M ST1 INNER JOIN TBBADFRE012M ST2 ON (ST1.ACP_YR=ST2.ACP_YR
			                  AND ST1.ACP_SRNO = ST2.ACP_SRNO
			                  AND ST1.ACP_DVSN_CD = ST2.ACP_DVSN_CD)
			                
			   		) T1 LEFT OUTER JOIN TBBADFRE112M T2 ON (T1.RF_ACP_YR = T2.ACP_YR
			    AND T1.RF_ACP_DVSN_CD = T2.ACP_DVSN_CD
			    AND T1.RF_ACP_SRNO = T2.ACP_SRNO) 
			  WHERE 1=1
		    
			    	 <if test='mgDivCd == "10" or mgDivCd == "20" '>
					    AND T1.MG_ACP_YR = #{acpYr}
					    AND T1.MG_ACP_DVSN_CD = #{acpDvsnCd}
					    AND T1.MG_ACP_SRNO = #{acpSrno}
					 </if>
					 <if test='mgDivCd != "10" and mgDivCd != "20" '>
					    AND T1.ACP_YR = #{acpYr}
					    AND T1.ACP_DVSN_CD = #{acpDvsnCd}
					    AND T1.ACP_SRNO = #{acpSrno}
					 </if>
					 <if test='acpMainStepSno != "0" and acpMainStepSno != null'>
					    AND T1.ACP_MAIN_STEP_SNO = #{acpMainStepSno}
					 </if>
					 
					 GROUP BY T1.ACP_YR, T1.ACP_DVSN_CD, T1.ACP_SRNO, T1.ACP_STEP_CD,T1.TIT_NM, T2.SBMT_DVSN_NO, T1.SBMT_PLAN_DT, T1.SBMT_REL_CON
					         ,T1.DOC_ID, T1.APVR_CD,T1.AFF_SNO,T1.SBMT_SEQ,T1.SBMT_REQ_DT,T1.SBMT_FIX_DT,T1.SBMT_STA_CD,T1.ACP_MAIN_STEP_SNO,T1.MG_ACP_YR
					         ,T1.MG_ACP_SRNO,T1.MG_ACP_DVSN_CD,T1.MG_DIV_CD,T1.SBMT_NO, T2.TIT_NM
					 
			    ORDER BY SBMT_FIX_DT DESC, SBMT_NO, SBMT_SEQ
    </select>

    <!-- 소위원회 안건 업데이트 -->
    <update id="BADFRE114MUpdate" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE114MUpdate */
        UPDATE TBBADFRE114M
              SET SBMT_PLAN_DT = REPLACE(#{sbmtPlanDt},'-'),
                    SBMT_REL_CON = #{sbmtRelCon},
             	    SBMT_REL_PER = #{sbmtRelPer},
             		FNL_USR_ID  = #{fnlUsrId},
             		FNL_DEAL_DPT_CD = #{fnlDealDptCd},
             		FNL_MDF_DH = SYSDATE,
             		FNL_MNU_ID = 'BADFRE313E'
          WHERE ACP_YR = #{acpYr}
             AND ACP_DVSN_CD = #{acpDvsnCd}
	         AND ACP_SRNO = #{acpSrno}
	         AND ACP_STEP_CD = #{acpStepCd}
	         AND DOC_ID = #{docId}
	         AND APVR_CD = #{apvrCd}
	         AND AFF_SNO = #{affSno}
	         AND SBMT_SEQ = #{sbmtSeq}
    </update>
    
    <!-- 소위원회 안건 안건명 업데이트 -->
    <update id="BADFRE114MTitleUpdate" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE114MTitleUpdate */
        UPDATE TBBADFRE114M
              SET SBMT_PLAN_DT = REPLACE(#{sbmtPlanDt},'-'),
                    TITLE_NM = #{acpSbjNm},
             		FNL_USR_ID  = #{fnlUsrId},
             		FNL_DEAL_DPT_CD = #{fnlDealDptCd},
             		FNL_MDF_DH = SYSDATE,
             		FNL_MNU_ID = 'AEPOSM001E'
          WHERE ACP_YR = #{acpYr}
             AND ACP_DVSN_CD = #{acpDvsnCd}
	         AND ACP_SRNO = #{acpSrno}
	         AND ACP_STEP_CD = #{acpStepCd}
	         AND SBMT_SEQ = #{sbmtSeq}
	         AND ACP_MAIN_STEP_SNO = #{acpMainStepSno}
    </update>

    <!-- 등재요청 등록 -->
    <insert id="BADFRE113MInsert" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE113MInsert */
        <![CDATA[
			INSERT INTO TBBADFRE113M (
                        SELECT A.ACP_YR AS ACP_YR
                            , A.ACP_DVSN_CD AS ACP_DVSN_CD
                            , A.ACP_SRNO AS ACP_SRNO
		]]>
                                 <if test='acpDvsnCd == "1"'>
								    , CASE WHEN MG_DIV_CD IS NOT NULL THEN
		                              (SELECT DOC_ID
		                               FROM TBBADFRE103M
		                               WHERE ACP_YR = A.MG_ACP_YR
		                               AND ACP_DVSN_CD = A.MG_ACP_DVSN_CD
		                               AND ACP_SRNO = A.MG_ACP_SRNO
		                               AND ACP_STEP_CD = 'D1020'
		                               AND RPRT_CD = 'D10200200')
		                               ELSE
		                               (SELECT DOC_ID
		                               FROM TBBADFRE103M
		                               WHERE ACP_YR = A.ACP_YR
		                               AND ACP_DVSN_CD = A.ACP_DVSN_CD
		                               AND ACP_SRNO = A.ACP_SRNO
		                               AND ACP_STEP_CD = 'D1020'
		                               AND RPRT_CD = 'D10200200')
		                               END AS DOC_ID
								 </if>
								 <if test='acpDvsnCd == "2"'>
									, CASE WHEN MG_DIV_CD IS NOT NULL THEN
		                              (SELECT DOC_ID
		                               FROM TBBADFRE103M
		                               WHERE ACP_YR = A.MG_ACP_YR
		                               AND ACP_DVSN_CD = A.MG_ACP_DVSN_CD
		                               AND ACP_SRNO = A.MG_ACP_SRNO
		                               AND ACP_STEP_CD = 'E1040'
		                               AND RPRT_CD = 'E10400200')
		                               ELSE
		                               (SELECT DOC_ID
		                               FROM TBBADFRE103M
		                               WHERE ACP_YR = A.ACP_YR
		                               AND ACP_DVSN_CD = A.ACP_DVSN_CD
		                               AND ACP_SRNO = A.ACP_SRNO
		                               AND ACP_STEP_CD = 'E1040'
		                               AND RPRT_CD = 'E10400200')
		                               END AS DOC_ID
								 </if>
		<![CDATA[
					        , '0013600' AS APVR_CD
                            , (SELECT NVL((SELECT MAX(NVL(AFF_SNO,0))
                                           FROM TBBADFRE113M
                                           WHERE ACP_YR = A.ACP_YR),0) + 1
                               FROM DUAL) AS AFF_SNO
                            , (SELECT NVL((SELECT MAX(NVL(DSP_RQ_SNO,0))
                                           FROM TBBADFRE113M
                                           WHERE ACP_YR = A.ACP_YR),0) + 1
                               FROM DUAL) AS DSP_RQ_SNO
                            , to_char(to_date(SYSDATE), 'YYYYMMDD') AS SBCN_REGI_REQ_DT
                            , '' AS AFF_DSP_CD
                            , '' AS DSP_RQ_CD
                            , 'Y' AS SBCN_REGI_REQ_YN
                            , '' AS SBCN_NBC
                            , '' AS SBCN_DY
                            , '' AS SBCN_PAGE_CNT
                            , '' AS SBCN_NO
                            , '' AS SBCN_VT_CD
                            , '' AS SBCN_VT_TXT
                            , '' AS ACP_MAIN_STEP_SNO
                            , (SELECT NVL((SELECT MAX(NVL(SORT_SNO,0))
                                           FROM TBBADFRE113M
                                           WHERE ACP_YR = A.ACP_YR),0) + 1
                               FROM DUAL) AS SORT_SNO
                            , '' AS SBCN_RPTR
                            , 'frtUsrId' AS FRT_USR_ID
                            , 'fnlUsrId' AS FNL_USR_ID
                            , 'fnlDealDptCd' AS FNL_DEAL_DPT_CD
                            , 'BADFRE313E' AS FNL_MNU_ID
                            , SYSDATE AS FRT_REGI_DH
                            , SYSDATE AS FNL_MDF_DH
                            , '' AS ENF_JA_CPR_DT
                            , '' AS SBCN_PRSS_DPT_NM
                         FROM TBBADFRE012M A
                         WHERE NVL(A.MG_ACP_YR, A.ACP_YR) = #{acpYr}
                         AND NVL(A.MG_ACP_DVSN_CD, A.ACP_DVSN_CD) = #{acpDvsnCd}
                         AND NVL(A.MG_ACP_SRNO, A.ACP_SRNO) = #{acpSrno}
                     )
		]]>
    </insert>

    <!-- 등재요청 보고자 업데이트 -->
    <update id="BADFRE113MUpdate" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE113MUpdate */
        UPDATE TBBADFRE113M
             SET SBCN_RPTR = #{sbcnRptr},
                 SBCN_PRSS_DPT_NM = #{sbcnPrssDptNm},
                  FNL_USR_ID  = #{fnlUsrId},
                  FNL_DEAL_DPT_CD = #{fnlDealDptCd},
                  FNL_MDF_DH = SYSDATE,
                  FNL_MNU_ID = 'BADFRE313E'
        WHERE ACP_YR = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
	       AND ACP_SRNO = #{acpSrno}
           AND SBCN_REGI_REQ_DT = REPLACE(#{sbcnRegiReqDt},'-')
    </update>

    <!-- 등재요청 목록 -->
    <select id="BADFRE113MSelect" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE113MSelect */
                        SELECT
                             T1.ACP_YR || '-' || DECODE(T1.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || T1.ACP_SRNO AS ACP_NO /* 분류번호 */
                            ,T1.ACP_YR
                            ,T1.ACP_DVSN_CD
                            ,T1.ACP_SRNO
                            ,T1.APVR_CD
                            ,NVL(T3.TIT_NM, ' ') AS TIT_NM
                            ,F_DPT_INFO(DPT_CD,'1') AS MNG_DPT_NM
                            ,T4.REGI_NO
                            , (SELECT DECODE(ST1.CHF_CMTR_CNB, NULL, '', F_USR_INFO(ST1.CHF_CMTR_CNB, '2')||DECODE(DECODE(ST1.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR5_CNB, NULL, 0, 1), 0, '', ' 외 ' || TO_CHAR(DECODE(ST1.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR5_CNB, NULL, 0, 1))) )
	                           FROM TBBADDED116L ST1
	                           WHERE ST1.AUD_YR = T1.ACP_YR AND ST1.AUD_NO = TO_CHAR( T1.ACP_SRNO) AND ST1.TASK_DVSN_CD = T1.ACP_DVSN_CD AND ST1.DOC_ID = T1.DOC_ID
	                    	   AND ST1.SRNO = (SELECT MAX(SRNO) FROM TBBADDED116L WHERE AUD_YR = T1.ACP_YR AND AUD_NO = TO_CHAR(T1.ACP_SRNO) AND TASK_DVSN_CD = T1.ACP_DVSN_CD AND DOC_ID = T1.DOC_ID)) AS CHF_CMTR_NM
	                        ,TO_CHAR(TO_DATE(SBCN_REGI_REQ_DT),'YYYY"-"MM"-"DD') AS SBCN_REGI_REQ_DT
                            ,SBCN_NBC
                            ,TO_CHAR(TO_DATE(SBCN_DY),'YYYY"-"MM"-"DD') AS SBCN_DY
                            ,SBCN_PAGE_CNT
                            ,(SELECT DECODE(COUNT(1),0,1,COUNT(1))
			                  FROM TBBADFRE012M
			                 WHERE MG_ACP_YR = T1.ACP_YR
			                    AND MG_ACP_DVSN_CD = T1.ACP_DVSN_CD
			                    AND MG_ACP_SRNO = T1.ACP_SRNO
			                    AND DEL_YN IS NULL) AS TOT_SBCN_CNT
			                ,(SELECT COUNT(ST1.ACP_YR)
				              FROM TBBADFRE113M ST1
                              INNER JOIN TBBADFRE012M ST2 ON (ST2.ACP_YR = ST1.ACP_YR AND ST2.ACP_DVSN_CD = ST1.ACP_DVSN_CD AND ST2.ACP_SRNO = ST1.ACP_SRNO)
				              WHERE NVL(ST2.MG_ACP_YR, ST2.ACP_YR) = T1.ACP_YR
				              AND NVL(ST2.MG_ACP_SRNO, ST2.ACP_SRNO) = T1.ACP_SRNO
				              AND NVL(ST2.MG_ACP_DVSN_CD, ST2.ACP_DVSN_CD) = T1.ACP_DVSN_CD
                              AND ST1.DOC_ID = T1.DOC_ID) AS SBCN_REGI_REQ_CNT
                            ,ACP_MAIN_STEP_SNO
                            ,T1.SBCN_RPTR
                            ,CASE WHEN T2.MG_DIV_CD = '10' THEN '병합'
					                WHEN T2.MG_DIV_CD = '20' THEN '병행'
					         ELSE ''
					         END AS MG_DIV_NM /* 병합병행구분명 */
                            ,(SELECT COUNT(MG_ACP_YR)
		                      FROM TBBADFRE012M
		     				 WHERE MG_ACP_YR = T2.MG_ACP_YR
		                        AND MG_ACP_DVSN_CD = T2.MG_ACP_DVSN_CD
		                        AND MG_ACP_SRNO = T2.MG_ACP_SRNO) AS MG_CNT
		                    ,T1.SBCN_PRSS_DPT_NM
		                    ,T4.RVW_REQ_DT
                        FROM
                            TBBADFRE113M T1
                            JOIN
                            TBBADFRE012M T2
                            ON (T1.ACP_YR = T2.ACP_YR AND T1.ACP_DVSN_CD = T2.ACP_DVSN_CD AND T1.ACP_SRNO = T2.ACP_SRNO)
                            JOIN
                            TBBADFRE112M T3
                            ON (T1.ACP_YR = T3.ACP_YR AND T1.ACP_DVSN_CD = T3.ACP_DVSN_CD AND T1.ACP_SRNO = T3.ACP_SRNO)
                            JOIN TBBADFRE112D T4
                            ON (T4.ACP_YR = T1.ACP_YR AND T4.ACP_DVSN_CD = T1.ACP_DVSN_CD AND T4.ACP_SRNO = T1.ACP_SRNO AND T4.DOC_ID = T1.DOC_ID)
                        WHERE T1.ACP_YR = #{acpYr}
                              AND T1.ACP_DVSN_CD = #{acpDvsnCd}
                              AND T1.ACP_SRNO = #{acpSrno}
                        ORDER BY T1.SBCN_REGI_REQ_DT 
    </select>

    <update id="BADFRE111MUpdate" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.BADFRE111MUpdate */
    	UPDATE TBBADFRE111M
    	     SET RCPT_DH = SYSDATE,
    	          DOC_STA_CD = '20',
    	          FNL_USR_ID  = #{fnlUsrId},
              	  FNL_DEAL_DPT_CD = #{fnlDealDptCd},
             	  FNL_MDF_DH = SYSDATE,
             	  FNL_MNU_ID = 'BADFRE313E'
          WHERE ACP_YR = #{acpYr}
             AND ACP_DVSN_CD = #{acpDvsnCd}
	         AND ACP_SRNO = #{acpSrno}
	         AND ACP_STEP_CD = #{acpStepCd}
	         AND DOC_ID = #{docId}
	         AND SR_DOC_SNO = #{srDocSno}
    </update>
    
    <delete id="deleteSbmtList">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.deleteSbmtList */
                DELETE TBBADFRE114M
                WHERE 
                        ACP_YR = #{acpYr}
                AND ACP_SRNO = #{acpSrno}
                AND ACP_STEP_CD = #{acpStepCd}
                AND DOC_ID = #{docId} 
                AND APVR_CD = #{apvrCd}
                AND AFF_SNO = #{affSno}
                AND SBMT_SEQ = #{sbmtSeq};
    </delete>
    
    <update id="saveSbmtReq" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.saveSbmtReq */
        <![CDATA[
        UPDATE TBBADFRE114M
        SET 
            SBMT_REQ_DT = SYSDATE,
            SBMT_STA_CD = 20,
            FNL_USR_ID  = #{usrId},
            FNL_DEAL_DPT_CD = #{dptCd},
            FNL_MDF_DH = SYSDATE,
            FNL_MNU_ID = #{menuNo},
            SBMT_DVSN_NO=(SELECT SBMT_DVSN_NO
                  FROM TBBADDED116M
                 WHERE CMTR_CNB =(SELECT CHF_CMTR_CNB AS CHF_CMTR_ID
                                                       FROM TBBADDED116L ST1
                                                      WHERE ST1.AUD_YR = #{rlAcpYr} AND ST1.AUD_NO = #{rlAcpSrno} AND ST1.TASK_DVSN_CD = #{rlAcpDvsnCd}
                                                        AND ST1.SRNO = (SELECT MAX(SRNO) FROM TBBADDED116L WHERE AUD_YR = #{rlAcpYr} AND AUD_NO = #{rlAcpSrno} AND TASK_DVSN_CD = #{rlAcpDvsnCd})) 
              )
        WHERE 
                ACP_YR = #{acpYr}
        AND ACP_SRNO = #{acpSrno}
        AND ACP_STEP_CD = #{acpStepCd}
        AND DOC_ID = #{docId} 
        AND APVR_CD = #{apvrCd}
        AND AFF_SNO = #{affSno}
        AND SBMT_SEQ = #{sbmtSeq}
        ]]>
    </update>
    
    
    <update id="saveSbmtList" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.saveSbmtList */
        <![CDATA[
        UPDATE TBBADFRE114M
        SET 
            SBMT_PLAN_DT = REPLACE(#{sbmtPlanDt},'-'),
            SBMT_REL_CON = #{sbmtRelCon},
            SBMT_PLAN_DH = #{sbmtPlanDh},
            
            FNL_USR_ID  = #{usrId},
            FNL_DEAL_DPT_CD = #{dptCd},
            FNL_MDF_DH = SYSDATE,
            FNL_MNU_ID = #{menuNo}
        WHERE 
                ACP_YR = #{acpYr}
        AND ACP_SRNO = #{acpSrno}
        AND ACP_STEP_CD = #{acpStepCd}
        AND DOC_ID = #{docId} 
        AND APVR_CD = #{apvrCd}
        AND AFF_SNO = #{affSno}
        AND SBMT_SEQ = #{sbmtSeq}
        ]]>
    </update>
    
    
    <select id="selectPreviousSbcnDoc" parameterType="paramMap" resultType="egovMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.selectPreviousSbcnDoc */
    	SELECT
    		B.ACP_YR, B.ACP_DVSN_CD, B.ACP_SRNO, B.ACP_STEP_CD, B.DOC_ID, B.ACP_KND_CD, B.ACP_GRN_NO, B.RPRT_NM
    		, B.LINK_URL
    		, B.NECES_YN, B.APV_STA_CD, B.RPRT_CD, B.APV_RQS_ID, B.SND_DOC_YN, B.DOC_KND_CD, B.ACP_RPRT_DVSN_CD
    		, B.REF_ID, B.REF_DY, B.RLTN_ORG_CD, B.SORT_SNO, B.ACP_DOC_KND_CD, B.CON_PGM_CD, B.APV_WAY_CD, B.DOC_WRT_ID
    		, B.ONR_HNDL_NO, B.EDT_AUTH, B.FRT_USR_ID, B.FNL_USR_ID, B.FNL_DEAL_DPT_CD, B.FNL_MNU_ID, B.FRT_REGI_DH, B.FNL_MDF_DH
            , (SELECT MG_DIV_CD FROM TBBADFRE012M ST WHERE ST.ACP_YR = A.ACP_YR AND ST.ACP_DVSN_CD = A.ACP_DVSN_CD AND ST.ACP_SRNO = A.ACP_SRNO) AS MG_DIV_CD
        FROM TBBADFRE112D A
        INNER JOIN TBBADFRE103M B ON (B.ACP_YR = A.ACP_YR AND B.ACP_DVSN_CD = A.ACP_DVSN_CD AND B.ACP_SRNO = A.ACP_SRNO AND B.DOC_ID = A.DOC_ID AND B.RPRT_CD IN('D10300200', 'E10500200'))
        WHERE (A.ACP_YR, A.ACP_DVSN_CD, A.ACP_SRNO, A.SBCN_TRTM_DTL_SNO) IN (
            SELECT A.ACP_YR, A.ACP_DVSN_CD, A.ACP_SRNO, MAX(SBCN_TRTM_DTL_SNO) AS SBCN_TRTM_DTL_SNO 
            FROM TBBADFRE112D A
            WHERE ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO = #{acpSrno}
            GROUP BY ACP_YR, ACP_DVSN_CD, ACP_SRNO
        )
     </select>
     
     <select id="selectPreviousSbcnRefDoc" parameterType="paramMap" resultType="egovMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.selectPreviousSbcnDoc */
     	SELECT C.ACP_YR, C.ACP_DVSN_CD, C.ACP_SRNO, C.ACP_STEP_CD, C.DOC_ID, C.ACP_KND_CD, C.ACP_GRN_NO, C.RPRT_NM, C.LINK_URL/*만들어야함*/ , C.NECES_YN, C.APV_STA_CD, C.RPRT_CD, C.APV_RQS_ID, C.SND_DOC_YN, C.DOC_KND_CD, C.ACP_RPRT_DVSN_CD, C.REF_ID, C.REF_DY, C.RLTN_ORG_CD, C.SORT_SNO, C.ACP_DOC_KND_CD, C.CON_PGM_CD, C.APV_WAY_CD, C.DOC_WRT_ID, C.ONR_HNDL_NO, C.EDT_AUTH, C.FRT_USR_ID, C.FNL_USR_ID, C.FNL_DEAL_DPT_CD, C.FNL_MNU_ID, C.FRT_REGI_DH, C.FNL_MDF_DH
               , (SELECT MG_DIV_CD FROM TBBADFRE012M ST WHERE ST.ACP_YR = A.ACP_YR AND ST.ACP_DVSN_CD = A.ACP_DVSN_CD AND ST.ACP_SRNO = A.ACP_SRNO) AS MG_DIV_CD
        FROM TBBADFRE112D A
        INNER JOIN TBBADFRE103M B ON (B.ACP_YR = A.ACP_YR AND B.ACP_DVSN_CD = A.ACP_DVSN_CD AND B.ACP_SRNO = A.ACP_SRNO AND B.DOC_ID = A.DOC_ID AND B.RPRT_CD IN('D10300200', 'E10500200'))
        INNER JOIN TBBADFRE103M C ON (C.ACP_YR = B.ACP_YR AND C.ACP_DVSN_CD = B.ACP_DVSN_CD AND C.ACP_SRNO = B.ACP_SRNO AND C.DOC_ID = B.REF_ID AND C.ACP_STEP_CD = B.ACP_STEP_CD)
        WHERE (A.ACP_YR, A.ACP_DVSN_CD, A.ACP_SRNO, A.SBCN_TRTM_DTL_SNO) IN (
            SELECT A.ACP_YR, A.ACP_DVSN_CD, A.ACP_SRNO, MAX(SBCN_TRTM_DTL_SNO) AS SBCN_TRTM_DTL_SNO 
            FROM TBBADFRE112D A
            WHERE ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO = #{acpSrno}
            GROUP BY ACP_YR, ACP_DVSN_CD, ACP_SRNO
        )
     </select>
     
     
     
     <insert id="insertSbcnDoc" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.insertSbcnDoc */
        INSERT INTO TBBADFRE103M (
        	ACP_YR
        	, ACP_DVSN_CD
        	, ACP_SRNO
        	, ACP_STEP_CD
        	, DOC_ID
        	, ACP_KND_CD
        	, ACP_GRN_NO
        	, RPRT_NM
        	, LINK_URL 
        	, NECES_YN
        	, APV_STA_CD
        	, RPRT_CD
        	, APV_RQS_ID
        	, SND_DOC_YN
        	, DOC_KND_CD
        	, ACP_RPRT_DVSN_CD
        	, REF_ID
        	, REF_DY
        	, RLTN_ORG_CD
        	, SORT_SNO
        	, ACP_DOC_KND_CD
        	, CON_PGM_CD
        	, APV_WAY_CD
        	, DOC_WRT_ID
        	, ONR_HNDL_NO
        	, EDT_AUTH
        	, FRT_USR_ID
        	, FNL_USR_ID
        	, FNL_DEAL_DPT_CD
        	, FNL_MNU_ID
        	, FRT_REGI_DH
        	, FNL_MDF_DH
        ) 
        VALUES (
        	#{acpYr}
        	, #{acpDvsnCd}
        	, #{acpSrno}
        	, #{acpStepCd}
        	, #{newDocId}
        	, #{acpKndCd}
        	, #{acpGrnNo}
        	, #{rprtNm}
        	, #{linkUrl} 
        	, #{necesYn}
        	, #{apvStaCd}
        	, #{rprtCd}
        	, #{apvRqsId}
        	, #{sndDocYn}
        	, #{docKndCd}
        	, #{acpRprtDvsnCd}
        	, #{newRefId}
        	, #{refDy}
        	, #{rltnOrgCd}
        	, #{sortSno}
        	, #{acpDocKndCd}
        	, #{conPgmCd}
        	, #{apvWayCd}
        	, #{docWrtId}
        	, #{onrHndlNo}
        	, #{edtAuth}
        	, #{frtUsrId}
        	, #{fnlUsrId}
        	, #{fnlDealDptCd}
        	, #{fnlMnuId}
        	, #{frtRegiDh}
        	, #{fnlMdfDh}
        )
     </insert>
     
     
     <insert id="copyTBBADFRE112D" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.copyTBBADFRE112D */
        INSERT INTO TBBADFRE112D (
              SELECT ACP_YR
                    , ACP_DVSN_CD
                    , ACP_SRNO
                    , SBCN_TRTM_DTL_SNO
                    , #{newDocId} AS DOC_ID
                    , TO_CHAR(SYSDATE,'YYYYMMDD') AS RVW_REQ_DT
                    , RVW_CMPT_YN
                    , RVW_CMPT_DT
                    , SORT_SNO
                    , FRT_USR_ID
                    , FNL_USR_ID
                    , FNL_DEAL_DPT_CD
                    , FNL_MNU_ID
                    , FRT_REGI_DH
                    , FNL_MDF_DH 
                    , REGI_NO
                    , RMK_SBJ
                    , SHARE_CMTR_ID
                    , SHARE_DT
                    , SHARE_YN
              FROM TBBADFRE112D 
              WHERE ACP_YR = #{acpYr}
             AND ACP_DVSN_CD = #{acpDvsnCd}
             AND ACP_SRNO = #{acpSrno}
             AND DOC_ID = #{docId})
     </insert>
     
     <delete id="deleteTBBADFRE112D" parameterType="paramMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.deleteTBBADFRE112D */
          DELETE FROM TBBADFRE112D 
          WHERE ACP_YR = #{acpYr}
          AND ACP_DVSN_CD = #{acpDvsnCd}
          AND ACP_SRNO = #{acpSrno}
          AND DOC_ID = #{docId}
     </delete>
     
     <insert id="copyTBBADFRE113M" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.copyTBBADFRE113M */
        INSERT INTO TBBADFRE113M (
             SELECT A.ACP_YR
                    , A.ACP_DVSN_CD
                    , A.ACP_SRNO
                    , #{newDocId}
                    , A.APVR_CD
                    , A.AFF_SNO
                    , A.DSP_RQ_SNO
                    , A.SBCN_REGI_REQ_DT
                    , A.AFF_DSP_CD
                    , A.DSP_RQ_CD
                    , A.SBCN_REGI_REQ_YN
                    , A.SBCN_NBC
                    , A.SBCN_DY
                    , A.SBCN_PAGE_CNT
                    , A.SBCN_NO
                    , A.SBCN_VT_CD
                    , A.SBCN_VT_TXT
                    , A.ACP_MAIN_STEP_SNO
                    , A.SORT_SNO
                    , A.SBCN_RPTR
                    , A.FRT_USR_ID
                    , A.FNL_USR_ID
                    , A.FNL_DEAL_DPT_CD
                    , A.FNL_MNU_ID
                    , A.FRT_REGI_DH
                    , A.FNL_MDF_DH
                    , A.ENF_JA_CPR_DT
                    , A.SBCN_PRSS_DPT_NM
              FROM TBBADFRE113M A
              INNER JOIN TBBADFRE012M B ON (A.ACP_YR = B.ACP_YR AND A.ACP_DVSN_CD = B.ACP_DVSN_CD AND A.ACP_SRNO = B.ACP_SRNO)
              WHERE NVL(B.MG_ACP_YR, B.ACP_YR) = #{acpYr}
             AND NVL(B.MG_ACP_DVSN_CD, B.ACP_DVSN_CD) = #{acpDvsnCd}
             AND NVL(B.MG_ACP_SRNO, B.ACP_SRNO) = #{acpSrno}
             AND A.DOC_ID = #{docId})
     </insert>
     
     <delete id="deleteTBBADFRE113M" parameterType="paramMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.deleteTBBADFRE113M */
          DELETE FROM TBBADFRE113M 
          WHERE (ACP_YR, ACP_DVSN_CD, ACP_SRNO) IN (SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO FROM TBBADFRE012M WHERE NVL(MG_ACP_YR, ACP_YR) = #{acpYr}
             AND NVL(MG_ACP_DVSN_CD, ACP_DVSN_CD) = #{acpDvsnCd}
             AND NVL(MG_ACP_SRNO, ACP_SRNO) = #{acpSrno}
          )
          AND DOC_ID = #{docId}
     </delete>
     
     
     <update id="updateSbcnDoc" parameterType="paramMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.updateSbcnDoc */
     	<![CDATA[
	     UPDATE TBBADFRE103M A
		 SET A.REF_ID = #{newRefId}
		    , A.LINK_URL = (
		                      SELECT 'polaris-exeeditor://open/' || '?' || 'acpYr=' || B.ACP_YR || '&' || 'acpStepCd=' || B.ACP_STEP_CD || '&' || 'acpDvsnCd=' || B.ACP_DVSN_CD || '&' || 'acpSrno=' || B.ACP_SRNO ||
		                             '&' || 'mgDivCd=' || (SELECT ST.MG_DIV_CD FROM TBBADFRE012M ST WHERE ST.ACP_YR = B.ACP_YR AND ST.ACP_DVSN_CD = B.ACP_DVSN_CD AND ST.ACP_SRNO = B.ACP_SRNO) || '&' || 'edit=Y' || '&' || 'refId=' || 
		                              #{newRefId} || '&' || 'rprtCd=' || B.RPRT_CD || '&' || 'docId=' || B.DOC_ID
		                      FROM TBBADFRE103M B
		                      WHERE B.ACP_YR = #{acpYr}
		                      AND B.ACP_DVSN_CD = #{acpDvsnCd}
		                      AND B.ACP_SRNO = #{acpSrno}
		                      AND B.ACP_STEP_CD IN ('D1030', 'E1050')
		                      AND B.RPRT_CD IN ('D10301100','D10301110','D10301120','E10500600','E10500610','E10500620')
		                      AND B.DOC_ID = A.DOC_ID
		                 )
	 	 WHERE A.ACP_YR = #{acpYr}
	     AND A.ACP_DVSN_CD = #{acpDvsnCd}
	     AND A.ACP_SRNO = #{acpSrno}
		 AND A.ACP_STEP_CD IN ('D1030', 'E1050')
		 AND A.RPRT_CD IN ('D10301100','D10301110','D10301120','E10500600','E10500610','E10500620')
		 AND A.REF_ID = #{refId}
		 ]]>
     </update>
     
     <insert id="copyTBBADFRE111M" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.copyTBBADFRE111M */
        INSERT INTO TBBADFRE111M (ACP_YR
                                , ACP_DVSN_CD
                                , ACP_SRNO
                                , ACP_STEP_CD
                                , DOC_ID
                                , SR_DOC_SNO
                                , ACP_KND_CD
                                , ACP_GRN_NO
                                , RPRT_NM
                                , RPRT_CD
                                , LINK_URL
                                , DOC_STA_CD
                                , SND_DPT_CD
                                , SNDR_ID
                                , SND_DH
                                , RCPT_DPT_CD
                                , RCNT_ID
                                , RCPT_DH
                                , ACP_RPRT_DVSN_CD
                                , DOC_KND_CD
                                , REF_ID
                                , REF_DY
                                , SORT_SNO
                                , FRT_USR_ID
                                , FNL_USR_ID
                                , FNL_DEAL_DPT_CD
                                , FNL_MNU_ID
                                , FRT_REGI_DH
                                , FNL_MDF_DH
                                , ORGN_DOC_ID
                                , SUPPLM_REQ)(
			SELECT ACP_YR
				   ,ACP_DVSN_CD
				   ,ACP_SRNO
				   ,ACP_STEP_CD
				   ,#{newDocId}
				   ,SR_DOC_SNO
				   ,ACP_KND_CD
				   ,ACP_GRN_NO
				   ,RPRT_NM
				   ,RPRT_CD
				   ,#{linkUrl}
				   ,DOC_STA_CD
				   ,SND_DPT_CD
				   ,SNDR_ID
				   ,SND_DH
				   ,RCPT_DPT_CD
				   ,RCNT_ID
				   ,RCPT_DH
				   ,ACP_RPRT_DVSN_CD
				   ,DOC_KND_CD
				   ,#{newRefId}
				   ,REF_DY
				   ,SORT_SNO
				   ,FRT_USR_ID
				   ,FNL_USR_ID
				   ,FNL_DEAL_DPT_CD
				   ,FNL_MNU_ID
				   ,FRT_REGI_DH
				   ,FNL_MDF_DH
				   ,ORGN_DOC_ID
                   ,SUPPLM_REQ
			FROM TBBADFRE111M 
			WHERE ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO = #{acpSrno}
			AND ACP_STEP_CD = #{acpStepCd}
			AND DOC_ID = #{docId}
		)
     </insert>
     
     <delete id="deleteTBBADFRE111M" parameterType="paramMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.deleteTBBADFRE111M */
          DELETE FROM TBBADFRE111M 
          WHERE ACP_YR = #{acpYr}
          AND ACP_DVSN_CD = #{acpDvsnCd}
          AND ACP_SRNO = #{acpSrno}
          AND ACP_STEP_CD = #{acpStepCd}
          AND DOC_ID = #{docId}
     </delete>

    <update id="updateTBBADDED116L" parameterType="paramMap">
        UPDATE TBBADDED116L 
        SET DOC_ID = #{newDocId}
        WHERE AUD_YR = #{acpYr}
        AND TASK_DVSN_CD = #{acpDvsnCd}
        AND AUD_NO = #{acpSrno}
        AND DOC_ID = #{docId}
    </update>

	<update id="updateSbcnSndDocId" parameterType="paramMap">
	/* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.updateSbcnSndDocId */
        UPDATE TBBADFRE111M 
        SET REF_ID = #{newRefId}
        WHERE ACP_YR = #{acpYr}
        AND ACP_DVSN_CD = #{acpDvsnCd}
        AND ACP_SRNO = #{acpSrno}
        AND ACP_STEP_CD = #{acpStepCd}
        AND REF_ID = #{refId}
    </update>
    
    <delete id="deleteOldSbcnDoc" parameterType="paramMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.deleteOldSbcnDoc */
          DELETE FROM TBBADFRE103M 
          WHERE ACP_YR = #{acpYr}
          AND ACP_DVSN_CD = #{acpDvsnCd}
          AND ACP_SRNO = #{acpSrno}
          AND ACP_STEP_CD = #{acpStepCd}
          AND DOC_ID = #{docId}
     </delete>
     
     <update id="resetSbcnProcess">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.resetSbcnProcess */
     	UPDATE TBBADFRE102M 
     	SET CMPT_YN = ''
     	WHERE ACP_YR = #{acpYr}
     	AND ACP_DVSN_CD = #{acpDvsnCd}
     	AND ACP_SRNO = #{acpSrno}
     	AND ((ACP_STEP_CD = 'D1030' AND SUBSTR(ACP_MAIN_STEP_ID,0,2) IN ('30','32') AND ACP_MAIN_STEP_ID <![CDATA[<>]]> '300301') OR ACP_STEP_CD IN ('D1020','E1040','E1050'))
     </update>
     
     
     <update id="saveTrtmTitle" parameterType="paramMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.saveTrtmTitle */
     	UPDATE TBBADFRE112M 
     	SET TIT_NM = #{titNm}
            , FNL_USR_ID = #{usrId}
            , FNL_DEAL_DPT_CD = #{dptCd}
            , FNL_MNU_ID = #{menuNo}
     	WHERE ACP_YR = #{acpYr}
     	AND ACP_DVSN_CD = #{acpDvsnCd}
     	AND ACP_SRNO = #{acpSrno}
     </update>
     
     
     
     <update id="updateRprtCdReSbcn" parameterType="paramMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE313Mapper.saveTrtmTitle */
     	UPDATE TBBADFRE103M 
     	SET RPRT_CD = DECODE(RPRT_CD,'D10200100','D10200101','D10200200','D10200201','E10400100','E10400101','E10400200','E10400201')
            , FNL_USR_ID = #{usrId}
            , FNL_DEAL_DPT_CD = #{dptCd}
            , FNL_MNU_ID = #{menuNo}
     	WHERE ACP_YR = #{acpYr}
     	AND ACP_DVSN_CD = #{acpDvsnCd}
     	AND ACP_SRNO = #{acpSrno}
     	AND RPRT_CD IN ('D10200100','D10200200','E10400100','E10400200')
     </update>
</mapper>
