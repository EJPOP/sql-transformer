<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.bad.ear.dao.BADEAR044Mapper">
	<!--처분요구관리 조회-->
	<select id="BADEAR044PMainSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.bad.ear.dao.BADEAR044Mapper.BADEAR044PMainSelect */
		<include refid = "include.pageSelct"/>
        <![CDATA[
			SELECT D1.AUD_YR                         AS AUD_YR                          /*감사년도*/
			     , D1.AUD_NO                         AS AUD_NO                          /*감사번호*/
			     , T1.AUD_GRN_NO                     AS AUD_GRN_NO                      /*감사부여번호 - 2016.06.01 yyh*/
			     , D1.AUD_YR||D1.AUD_NO              AS AUD_YR_NO
			     , (SELECT F_ORG_CNT_NM_AUD(D1.AUD_YR,D1.AUD_NO,'AUD') FROM DUAL )  AS AUD_ORG_CNT /*기관명*/
			     , D1.DSP_RQ_SNO                     AS DSP_RQ_SNO                      /*처분요구순번*/
                 , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO
                                                     AS DSP_RQ_SNO_NM       /*처분요구순번DISP*/
 		     	 , CASE WHEN T1.AUD_YR >= '2016'
			                 THEN T1.AUD_KND_CD
			            ELSE ''
			        END                              AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.24 yyh*/
 		     	 , CASE WHEN T1.AUD_YR >= '2016'
			                 THEN F_CODE_NM('1000739',T1.AUD_KND_CD)
			            ELSE ''
			        END                              AS AUD_YR_NO_KND_NM /*감사연번호종류코드 추가 - 2015.12.24 yyh*/
			     , D1.FRM_NO                         AS FRM_NO                          /*서식번호*/
			     , D1.RPRT_NO                        AS RPRT_NO                      /*보고서식번호*/
			     , D1.TIT_TXT                        AS TIT_TXT                         /*제목내용*/
			     , D1.DSP_RQ_KND_CD                  AS DSP_RQ_KND_CD                   /*처분요구종류코드*/
			     , D1.ORG_DVSN_CD                    AS ORG_DVSN_CD                     /*기관구분코드*/
			     , D1.AUD_EPS_CD                     AS AUD_EPS_CD                      /*감사중점코드*/
			     , D2.DSP_RQ_SRNO                    AS DSP_RQ_SRNO                     /*처분요구일련번호*/
			     , TO_CHAR(TO_DATE(D2.ENF_DT),'YYYY-MM-DD')   AS ENF_DT                 /*시행일*/
			     , D2.HNDL_DDLN_DT                   AS HNDL_DDLN_DT                    /*처리기한일*/
			     , D2.ENF_BRDV_CD                    AS ENF_BRDV_CD                     /*시행국과코드*/
			     , F_DPT_INFO(D2.ENF_BRDV_CD,'1')	 AS ENF_BRDV_NM                     /*시행국과명*/
			     , D2.DOC_SEN_NO                     AS DOC_SEN_NO                      /*문서발송코드*/
			     , D2.WRDO_CAU_CD                    AS WRDO_CAU_CD                     /*비위원인코드*/
			     , D2.ENFM_MNG_BRDV_CD               AS ENFM_MNG_BRDV_CD                /*집행관리국과코드*/
			     , D2.DTM_YN                         AS DTM_YN                          /*확정여부*/
			     , D2.DTM_STA_CD                     AS DTM_STA_CD                      /*확정상태코드*/
			     , D2.HMP_OPEN_YN                    AS HMP_OPEN_YN                     /*홈페이지공개여부*/
			     , D2.DTY_OBV_UTL_YN                 AS DTY_OBV_UTL_YN                  /*직무관철활용여부*/
			     , D2.WRDO_TYP_CD                    AS WRDO_TYP_CD                     /*비위유형코드*/
			     , D2.DSP_RQ_APV_STA_CD              AS DSP_RQ_APV_STA_CD               /*처분요구결재상태코드*/
			     , D2.TSK_CAT_CD                     AS TSK_CAT_CD                      /*업무분류코드*/
			     , T2.DFNT_NAM                       AS DFNT_NAM                        /*관련자*/
			     , F_CODE_NM('1000121',D2.WRDO_TYP_CD) AS WRDO_TYP_NM                   /*비위유형코드명*/
			     , F_CODE_NM('1000120',D2.TSK_CAT_CD)  AS TSK_CAT_NM                    /*업무분류명*/
			     , F_CODE_NM('1000002',D1.DSP_RQ_KND_CD )  AS DSP_RQ_KND_NM                    /*처분요구종류명*/
			     , F_CODE_NM('1000017',D2.DTM_STA_CD )  AS DTM_STA_NM                    /*결재상태명*/
			  FROM TBBADEAR001M D1
					INNER JOIN TBBADEAR002D D2 ON (D2.AUD_YR     = D1.AUD_YR
											   AND D2.AUD_NO     = D1.AUD_NO
											   AND D2.DSP_RQ_SNO = D1.DSP_RQ_SNO )
					INNER JOIN TBBADDED001M T1 ON (T1.AUD_YR     = D1.AUD_YR
			   								   AND T1.AUD_NO     = D1.AUD_NO)
			  		LEFT OUTER JOIN TBBADEAR007M T2 ON (T2.AUD_YR     = D1.AUD_YR
												    AND T2.AUD_NO     = D1.AUD_NO
												    AND T2.DSP_RQ_SNO  = D1.DSP_RQ_SNO )	
			 WHERE 1=1
		]]>
		<if test='dspRqKndCd != null and dspRqKndCd != ""'>
			<![CDATA[
			   AND D1.DSP_RQ_KND_CD     = #{dspRqKndCd}
			]]>
		</if>
		<if test='enfDtSt != null and enfDtSt != ""'>
			<![CDATA[
			   AND D2.ENF_DT     >= #{enfDtSt}
			]]>
		</if>
		<if test='enfDtEnd != null and enfDtEnd != ""'>
        	<![CDATA[
			   AND D2.ENF_DT     <= #{enfDtEnd}
			]]>
		</if>
		<if test='audYrSt != null and audYrSt != ""'>
        	<![CDATA[
			   AND D1.AUD_YR   >= #{audYrSt}
			]]>
		</if>
		<if test='audGrnNoSt != null and audGrnNoSt != ""'>
        	<![CDATA[
			    AND T1.AUD_GRN_NO      >= #{audGrnNoSt}
			]]>
		</if>
		<if test='audYrEnd != null and audYrEnd != ""'>
        	<![CDATA[
			   AND D1.AUD_YR  <= #{audYrEnd}
			]]>
		</if>
		<if test='audGrnNoEnd != null and audGrnNoEnd != ""'>
        	<![CDATA[
			   AND T1.AUD_GRN_NO      <= #{audGrnNoEnd}
			]]>
		</if>
		<if test='enfBrdvNm != null and enfBrdvNm != ""'>
			   AND D2.ENF_BRDV_CD IN (SELECT DPT_CD FROM TBDCMACM002M WHERE DPT_NM like '%' || #{enfBrdvNm} || '%')
		</if>
		<if test='enfBrdvCd != null and enfBrdvCd != ""'>
			   AND D2.ENF_BRDV_CD  = #{enfBrdvCd}
		</if>
		<if test='titTxt != null and titTxt != ""'>
			    AND D1.TIT_TXT LIKE '%'||#{titTxt}||'%'
		</if>
		<if test='rltnOrgNm != null and rltnOrgNm != ""'>
			   AND (SELECT ORG_NM
			          FROM TBDCMACM015M
			         WHERE ORG_CD = D2.RLTN_ORG_CD) LIKE #{rltnOrgNm}||'%'
		</if>
		<if test='dfntNam != null and dfntNam != ""'>
			   AND T2.DFNT_NAM LIKE '%'||#{dfntNam}||'%'
		</if>

		<if test='audYrNoKndCdSt != null and audYrNoKndCdSt != ""'>
        		AND SUBSTR(T1.AUD_KND_CD,3,1) = NVL(#{audYrNoKndCdSt},'0')
       	</if>

		<if test='audYrNoKndCd != null and audYrNoKndCd != ""'>
        		AND SUBSTR(T1.AUD_KND_CD,3,1) =  SUBSTR(#{audYrNoKndCd},3,1) 
       	</if>
       	
        <![CDATA[
			  ORDER BY D2.ENF_DT DESC, D1.AUD_YR , D1.AUD_NO DESC, D1.DSP_RQ_SNO DESC
        ]]>
        <include refid = "include.pageOrder"/>
	</select>



<!--처분요구관리 조회-->
	<select id="BADEAR044PMainSelectType1" parameterType="paramMap"
		resultType="egovMap">
        <![CDATA[
			SELECT MASTER.AUD_YR AUD_YR
			     , MASTER.AUD_NO AUD_NO
			     , T1.AUD_GRN_NO                     AS AUD_GRN_NO          /*감사부여번호 - 2016.06.01 yyh*/
			     , MASTER.DSP_RQ_SNO DSP_RQ_SNO
                 , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') || '-' || MASTER.DSP_RQ_SNO
                                                     AS DSP_RQ_SNO_NM       /*처분요구순번DISP*/
 		     	 , CASE WHEN T1.AUD_YR >= '2016'
			                 THEN SUBSTR(T1.AUD_KND_CD,3,1)
			            ELSE ''
			        END                              AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.24 yyh*/
 		     	 , CASE WHEN T1.AUD_YR >= '2016'
			                 THEN F_CODE_NM('1000739', T1.AUD_KND_CD)
			            ELSE ''
			        END                              AS AUD_YR_NO_KND_NM /*감사연번호종류코드 추가 - 2015.12.24 yyh*/
			     , RELORG.RLTN_ORG_CD                           AS RLTN_ORG_CD
			     , (SELECT ORG_NM
			          FROM TBDCMACM015M
			          WHERE ORG_CD = RELORG.RLTN_ORG_CD)        AS AUD_ORG_CNT
			     , MASTER.DSP_RQ_KND_CD                         AS DSP_RQ_KND_CD
			     , (SELECT CD_NM
			          FROM TBDCMACM013C
			         WHERE CMM_CD_DVSN_CD = '1000002'
			           AND CD = MASTER.DSP_RQ_KND_CD)           AS DSP_RQ_KND_NM
			     , DETAIL.ENF_BRDV_CD ENF_BRDV_CD
			     , (SELECT DPT_NM
			          FROM TBDCMACM002M
			         WHERE DPT_CD = DETAIL.ENF_BRDV_CD)         AS OPER_BURDIV_NM
			     , DETAIL.ENFM_MNG_BRDV_CD                      AS ENFM_MNG_BRDV_CD
			     , (SELECT DPT_NM
			          FROM TBDCMACM002M
			         WHERE DPT_CD = DETAIL.ENFM_MNG_BRDV_CD)    AS ENFM_MNG_BRDV_NM
			     , DETAIL.PNL_DRIN_PSVT_AM                      AS PNL_DRIN_PSVT_AM
			     , DETAIL.ENF_DT                                AS ENF_DT
			     , RELPSN.DFNT_NAM                              AS DETAILUSR_NAM
			     , RELPSN.AD                                    AS AD
			     , RELPSN.AM                                    AS AM
			     , DETAIL.ENF_DT                                AS ENF_DT                          /*시행일*/
			     , DETAIL.ENF_BRDV_CD                           AS ENF_BRDV_CD                     /*시행국과코드*/
			     , F_DPT_INFO(DETAIL.ENF_BRDV_CD,'1')	        AS ENF_BRDV_NM                     /*시행국과명*/
			     , MASTER.TIT_TXT                               AS TIT_TXT                         /*제목내용*/
			     , DETAIL.EXAM_RPRT_DSP_RQ_SBT                  AS EXAM_RPRT_DSP_RQ_SBT            /*검토보고서처분요구요지*/
			  FROM TBBADEAR001M MASTER
			     , TBBADEAR002D DETAIL
			     , TBBADEAR006M RELORG
			     , TBBADEAR007M RELPSN
			     , TBBADDED001M T1
			 WHERE 1=1
			   AND MASTER.AUD_YR 		= DETAIL.AUD_YR
			   AND MASTER.AUD_NO 		= DETAIL.AUD_NO
			   AND MASTER.DSP_RQ_SNO 	= DETAIL.DSP_RQ_SNO
			   AND MASTER.AUD_YR 		= RELORG.AUD_YR
			   AND MASTER.AUD_NO 		= RELORG.AUD_NO
			   AND MASTER.DSP_RQ_SNO 	= RELORG.DSP_RQ_SNO
			   AND RELORG.AUD_YR 		= RELPSN.AUD_YR
			   AND RELORG.AUD_NO 		= RELPSN.AUD_NO
			   AND RELORG.DSP_RQ_SNO 	= RELPSN.DSP_RQ_SNO
			   AND RELORG.RLTN_ORG_CD 	= RELPSN.RLTN_ORG_CD
			   AND MASTER.AUD_YR 		= T1.AUD_YR
			   AND MASTER.AUD_NO 		= T1.AUD_NO
		]]>
		<if test='enfDtSt != null and enfDtSt != ""'>
			<![CDATA[
			   AND DETAIL.ENF_DT     >= #{enfDtSt}
			]]>
		</if>
		<if test='enfDtEnd != null and enfDtEnd != ""'>
        	<![CDATA[
			   AND DETAIL.ENF_DT     <= #{enfDtEnd}
			]]>
		</if>
		<if test='audYrSt != null and audYrSt != ""'>
        	<![CDATA[
			   AND MASTER.AUD_YR   >= #{audYrSt}
			]]>
		</if>
		<if test='audGrnNoSt != null and audGrnNoSt != ""'>
        	<![CDATA[
			    AND T1.AUD_GRN_NO      >= #{audGrnNoSt}
			]]>
		</if>
		<if test='audYrEnd != null and audYrEnd != ""'>
        	<![CDATA[
			   AND MASTER.AUD_YR  <= #{audYrEnd}
			]]>
		</if>
		<if test='audGrnNoEnd != null and audGrnNoEnd != ""'>
        	<![CDATA[
			   AND T1.AUD_GRN_NO      <= #{audGrnNoEnd}
			]]>
		</if>
		<if test='enfBrdvNm != null and enfBrdvNm != ""'>
			   AND DETAIL.ENF_BRDV_CD IN (SELECT DPT_CD FROM TBDCMACM002M WHERE DPT_NM like '%' || #{enfBrdvNm} || '%')
		</if>
		<if test='enfBrdvCd != null and enfBrdvCd != ""'>
			   AND DETAIL.ENF_BRDV_CD  = #{enfBrdvCd}
		</if>
		<if test='titTxt != null and titTxt != ""'>
			    AND MASTER.TIT_TXT LIKE '%'||#{titTxt}||'%'
		</if>
		<if test='rltnOrgNm != null and rltnOrgNm != ""'>
			   AND (SELECT ORG_NM
			          FROM TBDCMACM015M
			         WHERE ORG_CD = RELORG.RLTN_ORG_CD) LIKE #{rltnOrgNm}||'%'
		</if>
		<if test='dfntNam != null and dfntNam != ""'>
			   AND RELPSN.DFNT_NAM LIKE #{dfntNam}||'%'
		</if>

		/* 감사연번종류코드 추가 - 2015.12.24 yyh */
		<if test='audYrNoKndCdSt != null and audYrNoKndCdSt != ""'>
        		AND SUBSTR(T1.AUD_KND_CD,3,1) = NVL(#{audYrNoKndCdSt},'0')
       	</if>

        <![CDATA[
			  ORDER BY MASTER.AUD_YR , MASTER.AUD_NO DESC, MASTER.DSP_RQ_SNO DESC
        ]]>
	</select>


</mapper>
