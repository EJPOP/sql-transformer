<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.bad.ded.dao.BADDED006EMapper">
    
    <select id="selectMainList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED006EMapper.selectMainList*/
    <include refid="include.pageSelct" />
    <![CDATA[
           SELECT     T1.AUD_YR
                     ,T1.AUD_NO
                     ,T1.AUD_KND_CD
                     ,T1.AUD_GRN_NO
                     ,T1.AUD_CTRL_NM
                     ,T1.AUD_YR_N0
                     ,T1.AUD_YR_NO_KND_NM
                     ,T1.SPV_BRDV_NM
                     ,T1.AUD_KND_NM
                     ,T1.BZT_BGT_DVSN_NM
                     ,T1.BZT_BGT_DVSN_CD
                     ,T1.AUD_SBJ_NM
                     ,T1.AUD_RPST_ORG_NM
                     ,T1.MNG_DPT_NM
                     ,T1.MNG_DPT_CD
                     ,T1.TOT_DRTR_NM
                     ,T1.AUD_TOT_DRTR_CNB
                     ,T1.TOT_DRTR_BRDV_NM
                     ,T1.TOT_DRTR_BRDV_CD
                     ,T1.TOT_DRTR_RANK_NM
                     ,T1.TOT_DRTR_RANK_CD
                     ,T1.REQ_DVSN_NM
                     ,T1.PRSS_STEP_NM
                     ,T1.PRSS_STEP_CD
                     ,T1.DOC_TYPE /* 편집기 구분  */
            FROM (
                      SELECT D1.AUD_YR AS AUD_YR
                              , D1.AUD_NO AS AUD_NO
                              , D1.AUD_KND_CD AS AUD_KND_CD
                              , D1.AUD_GRN_NO AS AUD_GRN_NO
                              , (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000753' AND CD = D1.AUD_CTRL_CD) AS AUD_CTRL_NM
                              , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-') AS AUD_YR_N0
                              , CASE WHEN D1.AUD_YR >= '2016' 
                                       THEN D1.AUD_KND_CD
                                        ELSE '' END AS AUD_YR_NO_KND_CD /*감사연번호종류코드*/
                              , CASE WHEN D1.AUD_YR >= '2016' 
                                       THEN F_CODE_NM('1000739', D1.AUD_KND_CD) 
                                        ELSE '-' END AS AUD_YR_NO_KND_NM /*감사연번호종류코드명*/
                              , D1.AUD_YR||'-'||SUBSTR(D1.AUD_TASK_CD,-1)||'-'||D1.ORG_DVSN_CD||'-'||SUBSTR(D1.AUD_KND_CD,-1)||'-'||SUBSTR(D1.SPV_BRDV_CD,1,2)||SUBSTR(D1.SPV_BRDV_CD,4,2)||'-'||SUBSTR(D1.AUD_WAY_CD,-1)||'-'||D1.AUD_NO AS AUD_DTL_NO /*세부연번호*/
                              , D1.AUD_YR||'-'||D1.AUD_KND_CD||'-'||D1.AUD_NO AS AUD_YR_KND_NO_CD
                              , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = D1.SPV_BRDV_CD) AS SPV_BRDV_NM
                              , (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000007' AND CD = D1.AUD_KND_CD) AS AUD_KND_NM
                              , D1.BZT_BGT_DVSN_CD
                              , (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000751' AND CD = D1.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM
                              , D1.AUD_SBJ_NM                        AS AUD_SBJ_NM
                              , (SELECT ORG_NM FROM TBDCMACM015M WHERE ORG_CD = D1.AUD_RPST_ORG_CD) AS AUD_RPST_ORG_NM
                              , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = D1.MNG_DPT_CD) AS MNG_DPT_NM
                              , D1.MNG_DPT_CD                         AS MNG_DPT_CD
                              , (SELECT USR_NAM FROM TBDCMACM001M WHERE CNB = D1.AUD_TOT_DRTR_CNB) AS TOT_DRTR_NM
                              , D1.AUD_TOT_DRTR_CNB                    AS AUD_TOT_DRTR_CNB
                              , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = D1.TOT_DRTR_BRDV_CD) AS TOT_DRTR_BRDV_NM
                              , D1.TOT_DRTR_BRDV_CD                    AS TOT_DRTR_BRDV_CD
                              , (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000173' AND CD = D1.TOT_DRTR_RANK_CD)    AS TOT_DRTR_RANK_NM
                              , D1.TOT_DRTR_RANK_CD                    AS TOT_DRTR_RANK_CD
                              , (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000742' AND CD = D1.REQ_DVSN_CD)    AS REQ_DVSN_NM  /* 관련업무 코드 변경 1000740 -> 1000742  2017.07.13 EUNOK */
                              , CASE WHEN D1.PRSS_STEP_CD LIKE 'A10%' THEN (SELECT AUD_STEP_NM 
                                                                                              FROM TBBADDED101M 
                                                                                             WHERE AUD_YR = D1.AUD_YR
                                                                                                AND AUD_NO = D1.AUD_NO
                                                                                                AND AUD_STEP_CD = D1.PRSS_STEP_CD)
                                       ELSE (SELECT CD_NM 
                                               FROM TBDCMACM013C 
                                              WHERE CMM_CD_DVSN_CD = '1000475' 
                                                 AND CD = CASE WHEN SUBSTR(D1.AUD_KND_CD,3) = '55' THEN '' 
                                                                      WHEN D3.AUD_EXEC_HNDL_STA_CD = '9'  THEN '10'
                                                                ELSE
                                                               CASE WHEN TRIM(D3.ENF_APV_DT) IS NOT NULL THEN '10'
                                                                      WHEN TRIM(D3.CHF_CMTR_APV_DT)IS NOT NULL THEN '09'
                                                                      WHEN TRIM(D3.OW_DHD_APV_DT)  IS NOT NULL THEN '08'
                                                                      WHEN TRIM(D3.JA_JDG_SSEC_APV_DT) IS NOT NULL THEN '07'
                                                                      WHEN TRIM(D3.MDT_DDG_APV_DT) IS NOT NULL THEN '06'
                                                                      WHEN TRIM(D3.MDT_OFER_APV_DT)IS NOT NULL THEN '05'
                                                                      WHEN TRIM(D3.AUD_BRDV_APV_DT)IS NOT NULL THEN '04'
                                                                      WHEN TRIM(D3.RTN_RPT_DT) IS NOT NULL THEN '03'
                                                                ELSE
                                                                 (CASE WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                                WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(NVL(D3.EXTN_HNDL_DDLN_DT, D3.HNDL_DDLN_DT)) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(NVL(D3.EXTN_HNDL_DDLN_DT, D3.HNDL_DDLN_DT)),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                                WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(NVL(D3.EXTN_HNDL_DDLN_DT, D3.HNDL_DDLN_DT)),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                                WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                                WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                                  ELSE '8' END) = '8' AND D3.RTN_RPT_DT IS NULL AND D3.FLD_AUD_END_DT IS NULL THEN '02'
                                                                  WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(NVL(D3.EXTN_HNDL_DDLN_DT, D3.HNDL_DDLN_DT)) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(NVL(D3.EXTN_HNDL_DDLN_DT, D3.HNDL_DDLN_DT)),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(NVL(D3.EXTN_HNDL_DDLN_DT, D3.HNDL_DDLN_DT)),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8' END) = '8' AND D3.RTN_RPT_DT IS NULL THEN '11'
                                                                  WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(NVL(D3.EXTN_HNDL_DDLN_DT, D3.HNDL_DDLN_DT)) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(NVL(D3.EXTN_HNDL_DDLN_DT, D3.HNDL_DDLN_DT)),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(NVL(D3.EXTN_HNDL_DDLN_DT, D3.HNDL_DDLN_DT)),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8' END) = '7' THEN '02'
                                                                   END)
                                                        END
                                         END) END    AS PRSS_STEP_NM
                              , (CASE D1.PRSS_STEP_CD WHEN 'A1000' THEN 'A1010' ELSE D1.PRSS_STEP_CD END) AS PRSS_STEP_CD
                              , F_CODE_NM('1000894', D1.DOC_WRIT_KND_CD) AS DOC_TYPE
                      FROM TBBADDED001M AS D1
                              LEFT OUTER JOIN TBBADDED003M AS D3 ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO
                               ]]>  
                         AND D1.AUD_YR  = #{schAudYr}
                      WHERE 1=1
                        AND D1.AUD_YR  = #{schAudYr}
                        AND D1.MNG_DPT_CD NOT IN ('100000','100100')
                         AND D1.PRSS_STEP_CD LIKE 'A10%'
                     <if test="callTypeYN == null or callTypeYN == '' or callTypeYN eq 'null'.toString() or callTypeYN eq 'NULL'.toString()">
                         AND D1.AUD_CTRL_CD NOT IN ('3')
                     </if>
                     <if test="!@kr.go.bai.common.Utility@isEmpty(resourceName) and ( resourceName eq 'EI_006_005_000_000' or resourceName eq 'EI_002_006_000_000' or resourceName eq 'EI_003_004_000_000' or resourceName eq 'EI_005_006_000_000' ) ">
                         /* 확인출장관리 > 감사사항선택 */
                         AND (D1.AUD_CTRL_CD = '1' OR (D1.AUD_CTRL_CD = '2' AND SUBSTR(D1.AUD_KND_CD, -1, 1) = '5'))
                     </if>
                         /* 실지감사관리 > 감사사항선택 (확인출장 제외)*/
                         AND D1.AUD_CTRL_CD != '1' AND D1.AUD_KND_CD NOT LIKE '%5'
                     <if test="schAudYrStrt != null and schAudYrStrt != ''">
                         AND D1.AUD_YR <![CDATA[>=]]> #{schAudYrStrt}
                     </if>
                     <if test="schAudYrEnd != null and schAudYrEnd != ''">
                         AND D1.AUD_YR <![CDATA[<=]]> #{schAudYrEnd}
                     </if>
                     <if test="srchIttNm != null and srchIttNm != ''">
                         AND F_ORG_INFO(D1.AUD_RPST_ORG_CD,'1') like #{srchIttNm} || '%' 
            		 </if>
            		 <if test="schAudSbjNm != null and schAudSbjNm != ''">
                         AND D1.AUD_SBJ_NM LIKE '%'||#{schAudSbjNm}||'%'
            		 </if>
                     <if test="schAudKndCd != null and schAudKndCd != ''">
                         AND SUBSTR(D1.AUD_KND_CD, 3, 1) =  SUBSTR( #{schAudKndCd} ,3,1)
                     </if>
                     <if test="enfYn != null and enfYn != '' and !@kr.go.bai.common.Utility@isEmpty(resourceName) and ( resourceName neq 'EI_006_005_000_000' and resourceName neq 'EI_002_006_000_000' and resourceName neq 'EI_003_004_000_000' and resourceName neq 'EI_005_006_000_000' ) " >
                         /* 실지감사관리 > 감사사항선택 (확인출장 제외) > 결산부서, all_resultreport_view Role이 있는 경우 시행된 감사사항만 조회 */
                         AND ( EXISTS (SELECT 'X' 
                                            FROM  TBBADEAR002D AS ST1
                                          WHERE ST1.AUD_YR = D1.AUD_YR
                                             AND ST1.AUD_NO = D1.AUD_NO) 
                                 OR EXISTS ( SELECT 1
                                                  FROM TBBADDED002M ST4
                                                          INNER JOIN TBBADDED005L ST5
                                                                    ON ST4.BZT_YR = ST5.BZT_YR
                                                                   AND ST4.BZT_SNO = ST5.BZT_SNO
                                                WHERE D1.AUD_YR = ST4.REL_AUD_YR
                                                   AND D1.AUD_NO = ST4.REL_AUD_NO
                                                   AND ST5.PCT_CNB = #{cnb} ) 
                                 OR D1.AUD_TOT_DRTR_CNB = #{cnb})
                     </if>
                     <if test="enfYn != null and enfYn != '' and !@kr.go.bai.common.Utility@isEmpty(resourceName) and ( resourceName eq 'EI_006_005_000_000' or resourceName eq 'EI_002_006_000_000' or resourceName eq 'EI_003_004_000_000' or resourceName eq 'EI_005_006_000_000' ) ">
                         /* 확인출장관리 > 감사사항선택 > 결산부서, all_resultreport_view Role이 있는 경우 본인과, 출장배정자로 등록된 확인출장 조회 */
                         AND (  EXISTS (SELECT 1
                                                    FROM TBBADDED002M ST4 
                                                             INNER JOIN TBBADDED005L ST5
                                                                        ON ST4.BZT_YR = ST5.BZT_YR
                                                                       AND ST4.BZT_SNO = ST5.BZT_SNO
                                                   WHERE D1.AUD_YR = ST4.REL_AUD_YR
                                                      AND D1.AUD_NO = ST4.REL_AUD_NO
                                                      AND ST5.PCT_CNB =  #{cnb} )
                                     OR EXISTS (SELECT 1
                                                     FROM TBBADDED002M ST4
                                                             INNER JOIN TBBADDED010L ST6
                                                                        ON ST4.BZT_YR = ST6.BZT_YR
                                                                       AND ST4.BZT_SNO = ST6.BZT_SNO
                                                    WHERE D1.AUD_YR = ST4.REL_AUD_YR
                                                       AND D1.AUD_NO = ST4.REL_AUD_NO
                                                       AND ST6.PCT_CNB = #{cnb} ) 
                                     OR     D1.AUD_TOT_DRTR_CNB = #{cnb} )
                     </if>
                     
                     <if test=" chiefYn == 'Y'.toString() ">
                     <![CDATA[
                         AND SUBSTR(D1.AUD_KND_CD, 3, 1) <> '5'
                     ]]>
                     </if>
                     <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
                         AND D1.REQ_DVSN_CD = #{schReqDvsnCd}
                     </if>
                     <if test="loadCfmBztPopYN != null and loadCfmBztPopYN != '' and loadCfmBztPopYN eq 'Y'.toString()">
                         AND D1.PRSS_STEP_CD LIKE 'A10%'
                         AND D1.AUD_YR||D1.AUD_NO NOT IN (SELECT ST1.REL_AUD_YR||ST1.REL_AUD_NO 
                                                                         FROM TBBADDED101L ST1
                                                                        WHERE ST1.AUD_YR = #{loadAudYr}
                                                                           AND ST1.AUD_NO = #{loadAudNo})
                     </if>
		             <if test="enfMngYn != null and enfMngYn != '' and enfMngYn eq 'Y'.toString()">
		             <![CDATA[
		                     AND D1.PRSS_STEP_CD >= 'A1080'
		             ]]>
		             </if>
		             <if test="enfMngYn != null and enfMngYn != '' and enfMngYn eq 'N'.toString()">
		             <![CDATA[
		                     AND D1.PRSS_STEP_CD < 'A1080'
		             ]]>                     
                     </if>
                         AND ( EXISTS (SELECT 1
                                                 FROM TBBADDED002M ST4 
                                                          INNER JOIN TBBADDED005L ST5
                                                                    ON ST4.BZT_YR = ST5.BZT_YR
                                                                   AND ST4.BZT_SNO = ST5.BZT_SNO
                                                 WHERE D1.AUD_YR = ST4.REL_AUD_YR
                                                    AND D1.AUD_NO = ST4.REL_AUD_NO
                                                    AND ST5.PCT_CNB =  #{cnb} ) 
                                    OR EXISTS (SELECT 1
                                                 FROM TBBADDED031L ST6
                                                 WHERE D1.AUD_YR = ST6.AUD_YR
                                                    AND D1.AUD_NO = ST6.AUD_NO
                                                    AND ST6.CNB =  #{cnb}  )
                                    OR EXISTS (SELECT 1
                                                   FROM TBBADDED002M ST4
                                                           INNER JOIN TBBADDED010L ST6
                                                                     ON ST4.BZT_YR = ST6.BZT_YR
                                                                   AND ST4.BZT_SNO = ST6.BZT_SNO
                                                   WHERE D1.AUD_YR = ST4.REL_AUD_YR
                                                       AND D1.AUD_NO = ST4.REL_AUD_NO
                                                       AND ST6.PCT_CNB = #{cnb} )  
                                     OR D1.AUD_TOT_DRTR_CNB = #{cnb} )
                   ) T1
              WHERE 1=1
             <if test="schSpvBrdvCd != null and schSpvBrdvCd != ''">
                 AND T1.MNG_DPT_CD  IN (SELECT T2.DPT_CD
                                                   FROM TBDCMACM002M T2
                                                  WHERE 1=1
                                                    AND T2.USE_YN = 'Y'
                                                  <if test="schDeptCd != null and schDeptCd != ''">
                                                       AND T2.DPT_CD = #{schDeptCd}
                                                   </if>
                                                   CONNECT BY PRIOR T2.DPT_CD = T2.HIRK_DPT_CD START WITH T2.DPT_CD = #{schSpvBrdvCd} )
            </if>
              ORDER BY T1.AUD_YR DESC, T1.AUD_KND_CD, T1.AUD_GRN_NO DESC
             <include refid="include.pageOrder" />

    </select>

    <select id="selectChartList" parameterType="paramMap" resultType="egovMap">
      <![CDATA[
SELECT AUD_YR
			, NVL(DSP_RQ_NM, '기타') AS DSP_RQ_NM /* 처분요구명 */
            , NVL(SUM( CASE WHEN DSP_RQ_KND_CD IN ('610', '620', '621', '623', '625') THEN 1
		                    WHEN DSP_RQ_KND_CD IN ('410', '490', '495') THEN 1
		                    WHEN DSP_RQ_KND_CD IN ('310', '320', '390', '391', '395', '396') THEN 1
		                    WHEN DSP_RQ_KND_CD = 210 THEN 1
		                    WHEN DSP_RQ_KND_CD = '730' THEN 1
		                    WHEN DSP_RQ_KND_CD IN ('710', '720') THEN 1
		                    WHEN DSP_RQ_KND_CD IN ('110', '120') THEN 1
		                    WHEN DSP_RQ_KND_CD IN ('390', '391', '410', '490') THEN 1
		                    WHEN DSP_RQ_KND_CD IN ('395', '396', '495') THEN 1
		                    WHEN DSP_RQ_KND_CD IN ('810', '820', '830', '840', '850') THEN 1
		                    WHEN DSP_RQ_KND_CD = '611' THEN 1
		                    WHEN DSP_RQ_KND_CD = '' THEN 1
                            ELSE 1 
                             END ), 0) AS DSP_RQ 	/* 처분요구 */
         FROM
             (
              SELECT AUD_YR
		           , AUD_NO
				   , DSP_RQ_KND_CD
		           , CASE WHEN DSP_RQ_KND_CD IN ('610', '620', '621', '623', '625') THEN '통보' 
		                  WHEN DSP_RQ_KND_CD IN ('410', '490', '495') THEN '주의'
		                  WHEN DSP_RQ_KND_CD IN ('310', '320', '390', '391', '395', '396') THEN '시정' 
		                  WHEN DSP_RQ_KND_CD = 210 THEN '징계' 
		                  WHEN DSP_RQ_KND_CD = '730' THEN '수사' 
		                  WHEN DSP_RQ_KND_CD IN ('710', '720') THEN '고발' 
		                  WHEN DSP_RQ_KND_CD IN ('110', '120') THEN '판정' 
		                  WHEN DSP_RQ_KND_CD IN ('390', '391', '410', '490') THEN '현지조치' 
		                  WHEN DSP_RQ_KND_CD IN ('395', '396', '495') THEN '국장전결' 
		                  WHEN DSP_RQ_KND_CD IN ('810', '820', '830', '840', '850') THEN '모범' 
		                  WHEN DSP_RQ_KND_CD = '611' THEN '사실통보' 			  
		                  ELSE '' 
		                   END AS DSP_RQ_NM 								 
		        FROM 
                    ( 
     

  
        SELECT T1.AUD_YR
             , T1.AUD_NO
             , T1.DSP_RQ_SNO
             , T1.DSP_RQ_CD                                                   AS  DSP_RQ_KND_CD       /* 처분요구코드 */
       FROM (
                 SELECT NVL(T4.DSP_RQ_SNO, T1.DSP_RQ_SNO) AS DSP_RQ_SNO
                     , T1.AUD_YR
                     , T1.AUD_NO
                     , T1.DSP_RQ_SNO AS DSP_RQ_SRNO
                     , T1.DSP_RQ_CD
                   FROM TBBADDED146M T1
                  INNER JOIN TBBADDED145M T2 
                     ON T1.AUD_YR = T2.AUD_YR
                    AND T1.AUD_NO = T2.AUD_NO
                    AND T1.AUD_STEP_CD = T2.AUD_STEP_CD
                    AND T1.DOC_ID = T2.DOC_ID
                    AND T1.APVR_CD = T2.APVR_CD
                    AND T1.AFF_SNO = T2.AFF_SNO
                    AND T1.FNL_YN = T2.FNL_YN
                   LEFT OUTER JOIN (SELECT A.AUD_YR
                             , A.AUD_NO
                             , DECODE(SUM(DECODE(A.REFER_DVSN_CD,'E10',0,1)),0,'N','Y') AS CMT_YN
                        FROM TBBADDED145M A 
                       WHERE A.AUD_YR = #{srchYear}
                         AND A.AUD_NO = #{srchAudNo}
                         AND A.FNL_YN = 'Y'
                    GROUP BY A.AUD_YR, A.AUD_NO) T3
                     ON T1.AUD_YR = T3.AUD_YR
                    AND T1.AUD_NO = T3.AUD_NO
                  LEFT OUTER JOIN TBBADEAR001M T4 
                   ON T1.AUD_YR = T4.AUD_YR
                    AND T1.AUD_NO = T4.AUD_NO
                    /*AND T1.AFF_DSP_CD = T4.AFF_DSP_CD*/
                    AND T1.DSP_RQ_SNO = T4.AUD_DSP_RQ_SNO
                    /*AND T2.AFF_CD = T4.AFF_CD*/
                  WHERE 1=1
                    AND T1.AUD_YR = #{srchYear}
                    AND T1.AUD_NO = #{srchAudNo}
                    AND T1.FNL_YN = 'Y'
                    AND (T1.APVR_CD IN ('A1070', '0010600') OR T3.CMT_YN = 'N')
                 
                 
                 
                 
                 
                 
                  
                 ) T1 
      INNER JOIN TBBADDED001M T4 ON (T1.AUD_YR     = T4.AUD_YR
                                AND T1.AUD_NO     = T4.AUD_NO)
       INNER JOIN TBBADEAR001M T5 ON (T1.AUD_YR     = T5.AUD_YR   /* 처분요구사항기본 */
                                      AND T1.AUD_NO     = T5.AUD_NO
                                      AND T1.DSP_RQ_SNO = T5.DSP_RQ_SNO)
      INNER JOIN TBBADEAR004M T12 ON (T5.AUD_YR = T12.AUD_YR
			                          AND T5.AUD_NO = T12.AUD_NO
			                          AND T5.DSP_RQ_SNO = T12.DSP_RQ_SNO)
			                          AND T12.ETR_PEN_ID = #{schPctCnb}                           
       LEFT OUTER JOIN TBBADDED103M T6 ON (T1.AUD_YR = T6.AUD_YR
                                      AND T1.AUD_NO = T6.AUD_NO
                                      AND TO_CHAR(T1.DSP_RQ_SRNO) = T6.REF_ID 
                                      AND T6.RPRT_CD = 'A10800500')    /* A10800500 : 공개문 */
       LEFT OUTER JOIN TBBADEAR002D T8 ON (T5.AUD_YR     = T8.AUD_YR  /*처분요구사항상세*/ 
                                      AND T5.AUD_NO     = T8.AUD_NO
                                      AND T5.DSP_RQ_SNO = T8.DSP_RQ_SNO)
       LEFT OUTER JOIN TBBADEAR030M T9 ON (T5.AUD_YR     = T9.AUD_YR  /*홍보제출기본*/
                                      AND T5.AUD_NO     = T9.AUD_NO
                                      AND T5.DSP_RQ_SNO = T9.DSP_RQ_SNO)
       LEFT OUTER JOIN TBDCMACM013C T10 ON (T5.DSP_RQ_KND_CD = T10.CD
                                       AND T10.CMM_CD_DVSN_CD = '1000002' 
                                       AND T10.CD <> '000000000')
       ORDER BY T1.DSP_RQ_SNO, T1.DSP_RQ_SRNO ASC 
       )
       )
       GROUP BY AUD_YR, DSP_RQ_NM 
   
     ]]>

    
    </select> 
    
	<!-- 처분요구 시행 목록 시행번호 생성전 -->
	<select id="selectMainNewList" parameterType="paramMap" resultType="egovMap" >
	    /*kr.go.bai.eip.bad.ded.dao.BADDED006EMapper.selectMainNewList*/
        <![CDATA[
        SELECT T1.AUD_YR
             , T1.AUD_NO
             , T1.REF_DOC_ID AS DOC_ID
             , T1.APVR_CD
             , T1.AFF_SNO
             , T1.DSP_RQ_SNO
             , T4.AUD_SBJ_NM                                                  AS AUD_SBJ_NM            /*감사사항*/
             , T1.DSP_RQ_CD                                                   AS  DSP_RQ_KND_CD       /* 처분요구코드 */
             , (SELECT CD_NM
                   FROM TBDCMACM013C
                  WHERE CMM_CD_DVSN_CD = '1000002' 
                    AND CD = T1.DSP_RQ_CD)                                        AS DSP_RQ_KND_NM         /*처분요구종류명*/
             , T1.RLTN_ORG_CD                                                                  /*관계기관*/
             , F_ORG_INFO(T1.RLTN_ORG_CD, '1') AS RLTN_ORG_NM
             , T1.HND_ORG_CD                                                                  /*조치기관*/
             , F_ORG_INFO(T1.HND_ORG_CD, '1') AS HND_ORG_NM
             , T1.REF_ORG_CD                                                                  /*참고기관*/
             , F_ORG_INFO(T1.REF_ORG_CD, '1') AS REF_ORG_NM
             , (SELECT CASE WHEN COUNT(DISTINCT ORG_CD)>1 
                              THEN F_ORG_INFO(MIN(ORG_CD),'1')||'외 '||TO_CHAR(COUNT(DISTINCT ORG_CD)-1)||'' 
                             ELSE F_ORG_INFO(MIN(ORG_CD),'1') 
                        END
                  FROM TBBADDED008L     /*조별출장대상기관내역*/
                 WHERE 1 = 1
                   AND (BZT_YR, BZT_SNO) IN (SELECT BZT_YR
                                                   ,BZT_SNO
                                               FROM TBBADDED002M   /* 출장상황기본 */
                                              WHERE 1=1
                                                AND REL_AUD_YR = T1.AUD_YR
                                                AND REL_AUD_NO = T1.AUD_NO )) AS AUD_ORG_CNT           /*기관명*/
              , T1.TITLE_NM                                                     AS TIT_Txt  /*제목명 */
              , T1.AUD_STEP_CD   /*스텝*/
             /* , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-')  || '-' || T1.AFF_CD || '-' ||  T1.AFF_DSP_CD AS ACT_DSP_NM */  /*  사건번호 */
              , (SELECT MAX(TT1.AFF_NO) 
	              FROM TBBADDED147M TT1 
	             WHERE TT1.AUD_YR = T1.AUD_YR
	                AND TT1.AUD_NO = T1.AUD_NO 
	                AND TT1.APVR_CD IN ('A1070', '0010600') 
	                AND TT1.AFF_SNO = T1.AFF_SNO 
	                AND TT1.DSP_RQ_SNO = T1.DSP_RQ_SRNO)   AS ACT_DSP_NM      /*  사건번호 */    
              
              , T5.EXEC_DSP_NM                                                  AS EXEC_DSP_NM                                                 /* 시행번호  예 :2016-특정-001-시01*/
              , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') ||'-'|| T1.DSP_RQ_SNO   AS DSP_RQ_SNO_NM
              , 'TBBADDED146M'                                              AS TABLE_TYPE
              , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-')                  AS AUD_YR_GRNNO
              , F_ORG_CNT_NM_AUD(T1.AUD_YR,T1.AUD_NO,'AUD') AS AUD_ORG_CNT
              , (SELECT F_DPT_INFO(ENF_BRDV_CD,'1') FROM TBBADEAR002D WHERE AUD_YR = T1.AUD_YR  AND AUD_NO  = T1.AUD_NO AND DSP_RQ_SNO = T1.DSP_RQ_SNO) AS MNG_DPT_CD
              , T1.AFF_CD
              , T6.RPRT_NM                                                 /*보고서명 */
              , T6.APV_STA_CD                                              /*결재상태코드 */
              , F_CODE_NM('1000773',NVL(T6.APV_STA_CD,'10')) AS APV_STA_NM /*결재상태명 */
              , T6.SORT_SNO                                                /*보고서순번  */
              , T6.DOC_ID AS OPEN_DOC_ID                                                 /*결재문서번호 */
              , T6.REF_ID                                                  /*참조ID */
              , T6.REF_DY                                                  /*참조일자 */
              , T6.APV_RQS_ID                                              /*결재요청ID */
              , T6.AUD_RPRT_DVSN_CD                                        /*감사보고서구분코드 */
              , T6.RPRT_CD                                                 /*문서종류코드 */
              , F_USR_INFO_BY_ID(T6.DOC_WRT_ID,'2') AS MAKTER_USER
              , DECODE(T6.APV_RQS_ID, NULL, 'Y', 'N') AS APV_YN
              , (SELECT APV_USR_NM 
                   FROM 
                   (
                       SELECT 
                          F_USR_INFO(APVR_CNB,'2') || 
                          DECODE(APV_DH,NULL,'','('||TO_CHAR(APV_DH,'YYYY-MM-DD')||')') AS APV_USR_NM,
                          APV_DOC_NO
                       FROM TBDCMACM023L
                       WHERE  
                        APVR_KND_CD = '3'
                       ORDER BY APV_SNO DESC
                   )
                   WHERE ROWNUM = 1
                   AND APV_DOC_NO = T6.APV_RQS_ID) AS APV_USR_NM
              , T1.CMT_YN                                                  /*부의 여부 : Y:부의, N:전부위임*/
              , NVL(T9.PRL_SMT_YN,'N') AS PRL_SMT_YN                       /*홍보제출여부*/
              , T10.USR_DFN_TXT_1                           AS DSP_RQ_KND_CD2                  /*홈페이지 공개용 처분요구종류코드*/
              , CASE WHEN T8.DTM_STA_CD = '1' THEN '처분확정'
            WHEN T8.DTM_STA_CD = '2' THEN '집행확정' 
            ELSE '미확정'
          END                                    AS DTM_STA_NM                      /*처분확정여부*/
              , NVL(T8.DTM_STA_CD,0) AS DTM_STA_CD
              , CASE WHEN T9.HMP_OPEN_YN IS NOT NULL THEN T9.HMP_OPEN_YN
             WHEN T8.HMP_OPEN_YN IN ('1','N') THEN 'N'
             WHEN T8.HMP_OPEN_YN IS NULL THEN 'N'
            ELSE 'Y'
            END                                    AS OPEN_YN                         /*공개여부*/
              , CASE WHEN T8.HMP_OPEN_YN IN ('1','N') THEN '비공개'
             WHEN T8.HMP_OPEN_YN IS NULL THEN '비공개'
            ELSE '공개'
            END                                    AS HMP_OPEN_YN   
          , NVL(T9.OPEN_TIT_TXT,T5.TIT_TXT)                         AS OPEN_TIT_TXT
          , DECODE(T9.OPEN_TXT, NULL, 'N','Y') AS OPEN_TXT_EDIT_YN
          , T1.AFF_DSP_CD  
          , T1.DSP_RQ_SRNO
          , T8.SND_STA_CD
          , CASE WHEN T8.SND_RET_RSN_TXT IS NOT NULL THEN '결산반려' 
                 ELSE F_CODE_NM('1000333',NVL(T8.SND_STA_CD,'10'))
             END  AS SND_STA_NM
          , T8.SND_RET_RSN_TXT 
          , T8.SND_APV_DOC_NO
       FROM (
                 SELECT nvl(T4.DSP_RQ_SNO, '') AS DSP_RQ_SNO
                     , T1.AUD_YR
                     , T1.AUD_KND_CD
                     , T1.AUD_NO
                     , T1.AUD_STEP_CD
                     , T1.REF_DOC_ID
                     , T1.APVR_CD
                     , T1.AFF_SNO
                     , T2.AFF_CD
                     , T1.DSP_RQ_CD
                     , T1.RLTN_ORG_CD
                     , T1.HND_ORG_CD
                     , T1.REF_ORG_CD
                     , T1.AFF_DSP_CD
                     , T2.TITLE_NM
                     , T3.CMT_YN
                     , T1.DSP_RQ_SNO AS DSP_RQ_SRNO
                   FROM TBBADDED146M T1
                  INNER JOIN TBBADDED145M T2 
                     ON T1.AUD_YR = T2.AUD_YR
                    AND T1.AUD_NO = T2.AUD_NO
                    AND T1.AUD_STEP_CD = T2.AUD_STEP_CD
                    AND T1.REF_DOC_ID = T2.REF_DOC_ID
                    AND T1.APVR_CD = T2.APVR_CD
                    AND T1.AFF_SNO = T2.AFF_SNO
                    AND T1.FNL_YN = T2.FNL_YN
                   LEFT OUTER JOIN (SELECT A.AUD_YR
                             , A.AUD_NO
                             , DECODE(SUM(DECODE(A.REFER_DVSN_CD,'E10',0,1)),0,'N','Y') AS CMT_YN
                        FROM TBBADDED145M A 
                       WHERE A.AUD_YR = #{audYr}
                         AND A.AUD_NO = #{audNo}
                         AND A.FNL_YN = 'Y'
                    GROUP BY A.AUD_YR, A.AUD_NO) T3
                     ON T1.AUD_YR = T3.AUD_YR
                    AND T1.AUD_NO = T3.AUD_NO
                    LEFT OUTER JOIN TBBADEAR001M T4 
                   ON T1.AUD_YR = T4.AUD_YR
                    AND T1.AUD_NO = T4.AUD_NO
                    AND T1.DSP_RQ_SNO = T4.AUD_DSP_RQ_SNO
                  WHERE 1=1
                    AND T1.AUD_YR = #{audYr}
                    AND T1.AUD_NO = #{audNo}
                    AND T1.FNL_YN = 'Y'
                    AND (T1.APVR_CD IN ('A1070', '0010600') OR T3.CMT_YN = 'N')
                ]]>
                <if test='audGrnNo != null and audGrnNo != ""'>
                       /* AND T1.AUD_GRN_NO = audGrnNo */
                </if>
                <if test='dspRqCd != null and dspRqCd != ""'>
                       AND T1.DSP_RQ_CD = #{dspRqCd}
                </if>
                <if test='docId != null and docId != ""'>
                       AND T1.REF_DOC_ID = #{docId}
                </if>
                <if test='affSno != null and affSno != ""'>
                       AND T1.AFF_SNO = #{affSno}
                </if>
                <if test='dspRqSno != null and dspRqSno != ""'>
                       AND T1.DSP_RQ_SNO = #{dspRqSno}      /* 처분요구정보의 순번*/
                </if>
                 <![CDATA[
                 ) T1 
      INNER JOIN TBBADDED001M T4 ON (T1.AUD_YR     = T4.AUD_YR
                                AND T1.AUD_NO     = T4.AUD_NO)
       LEFT OUTER JOIN TBBADEAR001M T5 ON (T1.AUD_YR     = T5.AUD_YR   /* 처분요구사항기본 */
                                      AND T1.AUD_NO     = T5.AUD_NO
                                      AND T1.DSP_RQ_SNO = T5.DSP_RQ_SNO)
       LEFT OUTER JOIN TBBADDED103M T6 ON (T1.AUD_YR = T6.AUD_YR
                                      AND T1.AUD_NO = T6.AUD_NO
                                      AND TO_CHAR(T1.DSP_RQ_SRNO) = T6.REF_ID 
                                      AND T6.RPRT_CD = 'A10800500')    /* A10800500 : 공개문 */
       LEFT OUTER JOIN TBBADEAR002D T8 ON (T5.AUD_YR     = T8.AUD_YR  /*처분요구사항상세*/ 
                                      AND T5.AUD_NO     = T8.AUD_NO
                                      AND T5.DSP_RQ_SNO = T8.DSP_RQ_SNO)
       LEFT OUTER JOIN TBBADEAR030M T9 ON (T5.AUD_YR     = T9.AUD_YR  /*홍보제출기본*/
                                      AND T5.AUD_NO     = T9.AUD_NO
                                      AND T5.DSP_RQ_SNO = T9.DSP_RQ_SNO)
       LEFT OUTER JOIN TBDCMACM013C T10 ON (T5.DSP_RQ_KND_CD = T10.CD
                                       AND T10.CMM_CD_DVSN_CD = '1000002' 
                                       AND T10.CD <> '000000000')
       ORDER BY T1.DSP_RQ_SNO, T1.AFF_SNO, T1.DSP_RQ_SRNO ASC
        ]]>

    </select>

	<!-- 처분요구 시행 목록 시행번호 생성전 -->
	<select id="selectMainNewList2" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.bad.ded.dao.BADDED006EMapper.selectMainNewList2*/
        <![CDATA[
        SELECT T1.AUD_YR
             , T1.AUD_NO
             , T1.DOC_ID
             , T1.APVR_CD
             , T1.AFF_SNO
             , T1.DSP_RQ_SNO
             , T4.AUD_SBJ_NM                                                  AS AUD_SBJ_NM            /*감사사항*/
             , T1.DSP_RQ_CD                                                   AS  DSP_RQ_KND_CD       /* 처분요구코드 */
             , (SELECT CD_NM
                   FROM TBDCMACM013C
                  WHERE CMM_CD_DVSN_CD = '1000002' 
                    AND CD = T1.DSP_RQ_CD)                                        AS DSP_RQ_KND_NM         /*처분요구종류명*/
             , T1.RLTN_ORG_CD                                                                  /*관계기관*/
             , F_ORG_INFO(T1.RLTN_ORG_CD, '1') AS RLTN_ORG_NM
             , T1.HND_ORG_CD                                                                  /*조치기관*/
             , F_ORG_INFO(T1.HND_ORG_CD, '1') AS HND_ORG_NM
             , T1.REF_ORG_CD                                                                  /*참고기관*/
             , F_ORG_INFO(T1.REF_ORG_CD, '1') AS REF_ORG_NM
             , (SELECT CASE WHEN COUNT(DISTINCT ORG_CD)>1 
                              THEN F_ORG_INFO(MIN(ORG_CD),'1')||'외 '||TO_CHAR(COUNT(DISTINCT ORG_CD)-1)||'' 
                             ELSE F_ORG_INFO(MIN(ORG_CD),'1') 
                        END
                  FROM TBBADDED008L     /*조별출장대상기관내역*/
                 WHERE 1 = 1
                   AND (BZT_YR, BZT_SNO) IN (SELECT BZT_YR
                                                   ,BZT_SNO
                                               FROM TBBADDED002M   /* 출장상황기본 */
                                              WHERE 1=1
                                                AND REL_AUD_YR = T1.AUD_YR
                                                AND REL_AUD_NO = T1.AUD_NO )) AS AUD_ORG_CNT           /*기관명*/
              , T1.TITLE_NM                                                     AS TIT_Txt  /*제목명 */
              , T1.AUD_STEP_CD   /*스텝*/
             /* , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-')  || '-' || T1.AFF_CD || '-' ||  T1.AFF_DSP_CD AS ACT_DSP_NM*/   /*  사건번호 */
              , (SELECT MAX(TT1.AFF_NO) 
	              FROM TBBADDED147M TT1 
	             WHERE TT1.AUD_YR = T1.AUD_YR
	                AND TT1.AUD_NO = T1.AUD_NO 
	                AND TT1.APVR_CD IN ('A1070', '0010600') 
	                AND TT1.AFF_SNO = T1.AFF_SNO 
	                AND TT1.DSP_RQ_SNO = T1.DSP_RQ_SNO)   AS ACT_DSP_NM      /*  사건번호 */    
             
              , T5.EXEC_DSP_NM                                                  AS EXEC_DSP_NM                                                 /* 시행번호  예 :2016-특정-001-시01*/
              , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') ||'-'|| T1.DSP_RQ_SNO   AS DSP_RQ_SNO_NM
              , 'TBBADDED146M'                                              AS TABLE_TYPE
              , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-')                  AS AUD_YR_GRNNO
              , F_ORG_CNT_NM_AUD(T1.AUD_YR,T1.AUD_NO,'AUD') AS AUD_ORG_CNT
              , (SELECT F_DPT_INFO(ENF_BRDV_CD,'1') FROM TBBADEAR002D WHERE AUD_YR = T1.AUD_YR  AND AUD_NO  = T1.AUD_NO AND DSP_RQ_SNO = T1.DSP_RQ_SNO) AS MNG_DPT_CD
              , T1.AFF_CD
              , T6.RPRT_NM                                                 /*보고서명 */
              , T6.APV_STA_CD                                              /*결재상태코드 */
              , F_CODE_NM('1000773',NVL(T6.APV_STA_CD,'10')) AS APV_STA_NM /*결재상태명 */
              , T6.SORT_SNO                                                /*보고서순번  */
              , T6.DOC_ID AS OPEN_DOC_ID                                                 /*결재문서번호 */
              , T6.REF_ID                                                  /*참조ID */
              , T6.REF_DY                                                  /*참조일자 */
              , T6.APV_RQS_ID                                              /*결재요청ID */
              , T6.AUD_RPRT_DVSN_CD                                        /*감사보고서구분코드 */
              , T6.RPRT_CD                                                 /*문서종류코드 */
              , F_USR_INFO_BY_ID(T6.DOC_WRT_ID,'2') AS MAKTER_USER
              , DECODE(T6.APV_RQS_ID, NULL, 'Y', 'N') AS APV_YN
              , (SELECT APV_USR_NM 
                   FROM 
                   (
                       SELECT 
                          F_USR_INFO(APVR_CNB,'2') || 
                          DECODE(APV_DH,NULL,'','('||TO_CHAR(APV_DH,'YYYY-MM-DD')||')') AS APV_USR_NM,
                          APV_DOC_NO
                       FROM TBDCMACM023L
                       WHERE  
                        APVR_KND_CD = '3'
                       ORDER BY APV_SNO DESC
                   )
                   WHERE ROWNUM = 1
                   AND APV_DOC_NO = T6.APV_RQS_ID) AS APV_USR_NM
              , T1.CMT_YN                                                  /*부의 여부 : Y:부의, N:전부위임*/
              , (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y'
                    ELSE 'N'
                END  
          FROM TBBADEAR030M T11
         WHERE T11.AUD_YR     = T8.AUD_YR
           AND T11.AUD_NO     = T8.AUD_NO
           AND T11.DSP_RQ_SNO     = T8.DSP_RQ_SNO
           AND T11.PRL_SMT_YN = 'Y')       AS PRL_SMT_YN                      /*홍보제출여부*/
              , T10.USR_DFN_TXT_1                           AS DSP_RQ_KND_CD2                  /*홈페이지 공개용 처분요구종류코드*/
              , CASE WHEN T8.DTM_STA_CD = '1' THEN '처분확정'
            WHEN T8.DTM_STA_CD = '2' THEN '집행확정' 
            ELSE '미확정'
          END                                    AS DTM_STA_NM                      /*처분확정여부*/
              , NVL(T8.DTM_STA_CD,0) AS DTM_STA_CD
              , CASE WHEN T9.HMP_OPEN_YN IS NOT NULL THEN T9.HMP_OPEN_YN
             WHEN T8.HMP_OPEN_YN IN ('1','N') THEN 'N'
             WHEN T8.HMP_OPEN_YN IS NULL THEN 'N'
            ELSE 'Y'
            END                                    AS OPEN_YN                         /*공개여부*/
              , CASE WHEN T8.HMP_OPEN_YN IN ('1','N') THEN '비공개'
             WHEN T8.HMP_OPEN_YN IS NULL THEN '비공개'
            ELSE '공개'
            END                                    AS HMP_OPEN_YN   
          , NVL(T9.OPEN_TIT_TXT,T5.TIT_TXT)                         AS OPEN_TIT_TXT
          , T1.AFF_DSP_CD  
          , T1.DSP_RQ_SRNO
          , T8.SND_STA_CD
          , CASE WHEN T8.SND_RET_RSN_TXT IS NOT NULL THEN '결산반려' 
                 ELSE F_CODE_NM('1000333',NVL(T8.SND_STA_CD,'10'))
             END  AS SND_STA_NM
          , T8.SND_RET_RSN_TXT           
          , T8.SND_APV_DOC_NO
       FROM (
                 SELECT NVL(T4.DSP_RQ_SNO, T1.DSP_RQ_SNO) AS DSP_RQ_SNO
                     , T1.AUD_YR
                     , T1.AUD_KND_CD
                     , T1.AUD_NO
                     , T1.AUD_STEP_CD
                     , T1.DOC_ID
                     , T1.APVR_CD
                     , T1.AFF_SNO
                     , T2.AFF_CD
                     --, T1.DSP_RQ_SNO
                     , T1.DSP_RQ_CD
                     , T1.RLTN_ORG_CD
                     , T1.HND_ORG_CD
                     , T1.REF_ORG_CD
                     , T1.AFF_DSP_CD
                     , T2.TITLE_NM
                     , T3.CMT_YN
                     , T1.DSP_RQ_SNO AS DSP_RQ_SRNO
                   FROM TBBADDED146M T1
                  INNER JOIN TBBADDED145M T2 
                     ON T1.AUD_YR = T2.AUD_YR
                    AND T1.AUD_NO = T2.AUD_NO
                    AND T1.AUD_STEP_CD = T2.AUD_STEP_CD
                    AND T1.DOC_ID = T2.DOC_ID
                    AND T1.APVR_CD = T2.APVR_CD
                    AND T1.AFF_SNO = T2.AFF_SNO
                    AND T1.FNL_YN = T2.FNL_YN
                   LEFT OUTER JOIN (SELECT A.AUD_YR
                             , A.AUD_NO
                             , DECODE(SUM(DECODE(A.REFER_DVSN_CD,'E10',0,1)),0,'N','Y') AS CMT_YN
                        FROM TBBADDED145M A 
                       WHERE A.AUD_YR = #{audYr}
                         AND A.AUD_NO = #{audNo}
                         AND A.FNL_YN = 'Y'
                    GROUP BY A.AUD_YR, A.AUD_NO) T3
                     ON T1.AUD_YR = T3.AUD_YR
                    AND T1.AUD_NO = T3.AUD_NO
                  LEFT OUTER JOIN TBBADEAR001M T4 
                   ON T1.AUD_YR = T4.AUD_YR
                    AND T1.AUD_NO = T4.AUD_NO
                    /*AND T1.AFF_DSP_CD = T4.AFF_DSP_CD*/
                    AND T1.DSP_RQ_SNO = T4.AUD_DSP_RQ_SNO
                    /*AND T2.AFF_CD = T4.AFF_CD*/
                  WHERE 1=1
                    AND T1.AUD_YR = #{audYr}
                    AND T1.AUD_NO = #{audNo}
                    AND T1.FNL_YN = 'Y'
                    AND (T1.APVR_CD IN ('A1070', '0010600') OR T3.CMT_YN = 'N')
                ]]>
                <if test='audGrnNo != null and audGrnNo != ""'>
                       /* AND T1.AUD_GRN_NO = audGrnNo */
                </if>
                <if test='dspRqCd != null and dspRqCd != ""'>
                       AND T1.DSP_RQ_CD = #{dspRqCd}
                </if>
                <if test='docId != null and docId != ""'>
                       AND T1.DOC_ID = #{docId}
                </if>
                <if test='affSno != null and affSno != ""'>
                       AND T1.AFF_SNO = #{affSno}
                </if>
                <if test='dspRqSno != null and dspRqSno != ""'>
                       AND T1.DSP_RQ_SNO = #{dspRqSno}      /* 처분요구정보의 순번*/
                </if>
                 <![CDATA[
                 ) T1 
      INNER JOIN TBBADDED001M T4 ON (T1.AUD_YR     = T4.AUD_YR
                                AND T1.AUD_NO     = T4.AUD_NO)
       INNER JOIN TBBADEAR001M T5 ON (T1.AUD_YR     = T5.AUD_YR   /* 처분요구사항기본 */
                                      AND T1.AUD_NO     = T5.AUD_NO
                                      AND T1.DSP_RQ_SNO = T5.DSP_RQ_SNO)
      INNER JOIN TBBADEAR004M T12 ON (T5.AUD_YR = T12.AUD_YR
			                          AND T5.AUD_NO = T12.AUD_NO
			                          AND T5.DSP_RQ_SNO = T12.DSP_RQ_SNO)
			                          AND T12.ETR_PEN_ID = #{schPctCnb}                                      
       LEFT OUTER JOIN TBBADDED103M T6 ON (T1.AUD_YR = T6.AUD_YR
                                      AND T1.AUD_NO = T6.AUD_NO
                                      AND TO_CHAR(T1.DSP_RQ_SRNO) = T6.REF_ID 
                                      AND T6.RPRT_CD = 'A10800500')    /* A10800500 : 공개문 */
       LEFT OUTER JOIN TBBADEAR002D T8 ON (T5.AUD_YR     = T8.AUD_YR  /*처분요구사항상세*/ 
                                      AND T5.AUD_NO     = T8.AUD_NO
                                      AND T5.DSP_RQ_SNO = T8.DSP_RQ_SNO)
       LEFT OUTER JOIN TBBADEAR030M T9 ON (T5.AUD_YR     = T9.AUD_YR  /*홍보제출기본*/
                                      AND T5.AUD_NO     = T9.AUD_NO
                                      AND T5.DSP_RQ_SNO = T9.DSP_RQ_SNO)
       LEFT OUTER JOIN TBDCMACM013C T10 ON (T5.DSP_RQ_KND_CD = T10.CD
                                       AND T10.CMM_CD_DVSN_CD = '1000002' 
                                       AND T10.CD <> '000000000')
       ORDER BY T1.DSP_RQ_SNO, T1.AFF_SNO, T1.DSP_RQ_SRNO ASC
        ]]>

    </select>	

</mapper> 