<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper">
	<select id="BADFRE101BSelect" parameterType="paramMap" resultType="egovMap">
   		/*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE101BSelect */
        SELECT ACP_STEP_CD
             , ACP_STEP_NM
             , NECES_YN
             , STAD_DT
             , TSK_DESC
             , LINK_URL
             , SORT_SNO
          FROM TBBADFRE101B
         WHERE ACP_KND_CD = #{acpDvsnCd}
         <if test='acpStepNm != null and acpStepNm != ""'>
            AND ACP_STEP_NM like '%' || #{acpStepNm} || '%' /* PARAM : 단계명 */
         </if>
      ORDER BY SORT_SNO
    </select>

	<insert id="BADFRE101MInsert" parameterType="paramMap">
   	 	/*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE101MInsert*/
        INSERT INTO TBBADFRE101M(ACP_YR
                               , ACP_SRNO
                               , ACP_STEP_CD
                               , ACP_DVSN_CD
                               , ACP_GRN_NO
                               , ACP_STEP_NM
                               , NECES_YN
                               , CMPT_CLSNG_DY
                               , TSK_DESC
                               , LINK_URL
                               <if test="stepCmptYn != '' and stepCmptYn eq 'P'.toString()">
                               , STEP_CMPT_YN
                               , STEP_CMPT_DH
                               </if>
                               , SORT_SNO
                               , FRT_USR_ID
                               , FNL_USR_ID
                               , FNL_DEAL_DPT_CD
                               , FNL_MNU_ID
                               , FRT_REGI_DH
                               , FNL_MDF_DH )
                          VALUES(#{acpYr}
                               , #{acpSrno}
                               , #{acpStepCd}
                               , #{acpDvsnCd}
                               , #{acpSrno}
                               , #{acpStepNm}
                               , #{necesYn}
                               , #{cmptClsngDy}
                               , #{tskDesc}
                               , #{linkUrl}
                               <if test="stepCmptYn != '' and stepCmptYn eq 'P'.toString()">
                               , #{stepCmptYn}
                               , SYSDATE
                               </if>
                               , #{sortSno}
                               , #{usrId}
                               , #{usrId}
                               , #{dptCd}
                               , #{menuNo}
                               , SYSDATE
                               , SYSDATE )
    </insert>

    <update id="BADFRE101MUpdate" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE101MUpdate*/
    	UPDATE TBBADFRE101M
    	     SET NECES_YN = #{necesYn}
    	<if test='stepCmptYn != null and stepCmptYn != ""'>
        	     , STEP_CMPT_YN = #{stepCmptYn}
        </if>
        <if test='stepCmptYn == "Y"'>
                 , STEP_CMPT_DH = SYSDATE
        </if>
    	 WHERE ACP_YR = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO = #{acpSrno}
        <if test='acpStepCd != null and acpStepCd != ""'>
        	AND ACP_STEP_CD = #{acpStepCd}
        </if>
        <if test='acpStepCdList != null and acpStepCdList != ""'>
		   AND ACP_STEP_CD IN
			 <foreach item="item" index="index" collection="acpStepCdList" open="(" close=")" separator=",">
		            #{item}
		    </foreach>
		</if>
    </update>
    
    <update id="BADFRE103MUpdateSbcnDocEdtAuth" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MUpdateSbcnDocEdtAuth*/
		<![CDATA[  
		 UPDATE TBBADFRE103M
			SET EDT_AUTH 		 = #{edtAuth},
			    APV_STA_CD		 = '30'
			WHERE DOC_ID 		 = #{docId}
		]]>
	</update>
	
	<update id="BADFRE112DsaveRvwRsq" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE112DsaveRvwRsq*/
		<![CDATA[
			UPDATE  TBBADFRE112D
				SET     
							RVW_REQ_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
							,RVW_CMPT_YN = 'N'
							, FNL_USR_ID = #{usrId}
							, FNL_MDF_DH = SYSDATE
							, FNL_MNU_ID = decode(#{acpStepCd},'E1030','BADFRE319E','BADFRE313E')
							, FNL_DEAL_DPT_CD = #{dptCd}
				WHERE   
							ACP_YR = #{acpYr}
				AND     ACP_SRNO  = #{acpSrno}
				AND     ACP_DVSN_CD  = #{acpDvsnCd}
				AND     SBCN_TRTM_DTL_SNO  = (SELECT MAX(SBCN_TRTM_DTL_SNO) AS SBCN_TRTM_DTL_SNO
											FROM TBBADFRE112D T2
											WHERE 
												ACP_YR = #{acpYr}
											AND ACP_SRNO = #{acpSrno}
											AND ACP_DVSN_CD = #{acpDvsnCd}
											)
			]]>
	</update>
	
	<update id="BADFRE111MRcptDhUpdate" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE111MRcptDhUpdate*/
    	UPDATE TBBADFRE111M
    	     SET RCPT_DH = SYSDATE,
    	          DOC_STA_CD = '20',
    	          FNL_USR_ID  = #{usrId},
              	  FNL_DEAL_DPT_CD = #{dptCd},
             	  FNL_MDF_DH = SYSDATE,
             	  FNL_MNU_ID = #{menuId}
          WHERE ACP_YR = #{acpYr}
             AND ACP_DVSN_CD = #{acpDvsnCd}
	         AND ACP_SRNO = #{acpSrno}
	         AND ACP_STEP_CD = #{acpStepCd}
	         AND RPRT_CD = #{rprtCd}
	</update>

    <delete id="BADFRE101MDelete" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE101MDelete*/
    	DELETE FROM TBBADFRE101M
        WHERE ACP_YR = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO = #{acpSrno}
        <if test='acpDvsnCdList != null and acpDvsnCdList != ""'>
		   AND ACP_STEP_CD IN
			 <foreach item="item" index="index" collection="acpDvsnCdList" open="(" close=")" separator=",">
		            #{item}
		    </foreach>
		</if>
    </delete>

	<select id="BADFRE102BSelect" parameterType="paramMap" resultType="egovMap">
    	/*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE102BSelect*/
        SELECT ACP_STEP_CD
             , ACP_MAIN_STEP_ID
             , ACP_MAIN_STEP_NM
             , ACP_MAIN_STEP_SNO
             , ACP_MAIN_SEQ_W
             , ACP_MAIN_SEQ_H
             , LINK_TYPE
             , LINK_URL
             , ACP_DOC_CD
          FROM TBBADFRE102B
         WHERE ACP_KND_CD = #{acpDvsnCd}
      ORDER BY ACP_STEP_CD, ACP_MAIN_STEP_SNO
    </select>

    <insert id="BADFRE102MInsert" parameterType="paramMap">
   	 	/*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE102MInsert*/
        INSERT INTO TBBADFRE102M(ACP_YR
                               , ACP_DVSN_CD
                               , ACP_SRNO
                               , ACP_STEP_CD
                               , ACP_MAIN_STEP_ID
                               , ACP_MAIN_STEP_SNO
                               , ACP_MAIN_SEQ_W
                               , ACP_MAIN_SEQ_H
                               , ACP_KND_CD
                               , ACP_GRN_NO
                               , MAIN_JOB_NM
                               , LINK_TYPE
                               , LINK_URL
                               , ACP_DOC_CD
                               , FRT_USR_ID
                               , FNL_USR_ID
                               , FNL_DEAL_DPT_CD
                               , FNL_MNU_ID
                               , FRT_REGI_DH
                               , FNL_MDF_DH
                               , USE_YN )
                          VALUES(#{acpYr}
                               , #{acpDvsnCd}
                               , #{acpSrno}
                               , #{acpStepCd}
                               , #{acpMainStepId}
                               , #{acpMainStepSno}
                               , #{acpMainSeqW}
                               , #{acpMainSeqH}
                               , #{acpKndCd}
                               , #{acpGrnNo}
                               , #{acpMainStepNm}
                               , #{linkType}
                               , #{linkUrl}
                               , #{acpDocCd}
                               , #{usrId}
                               , #{usrId}
                               , #{dptCd}
                               , #{menuNo}
                               , SYSDATE
                               , SYSDATE
                               , 'Y' )
    </insert>
    
    <insert id="BADFRE103MInsertCopySbmtRptRprt" parameterType="paramMap">
   	 	/*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MInsertCopySbmtRptRprt*/
        INSERT INTO TBBADFRE103M(
        						
			       ACP_YR
			      ,ACP_SRNO
			      ,ACP_STEP_CD
			      ,DOC_ID 
			      ,ACP_DVSN_CD
			      ,ACP_GRN_NO
			      ,RPRT_NM
			      ,LINK_URL
			      ,NECES_YN
			      ,APV_STA_CD
			      ,RPRT_CD
			      ,APV_RQS_ID
			      ,SND_DOC_YN
			      ,DOC_KND_CD   
			      ,ACP_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,SORT_SNO
			      /*,SYT_TRTM_DVSN_YN*/
			      ,ACP_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,FRT_REGI_DH
			      ,FNL_MDF_DH
			      /*,REF_DOC_ID*/
			      ,OPEN_DOC_NTCE_DH,DLV_RMK,DLV_DT,DLV_CNT,AUD_DOC_ID,AUD_RPRT_CD,TEMPLATE_DOC_ID
			)
			SELECT ACP_YR
			      ,ACP_SRNO
			      ,ACP_STEP_CD
			      ,#{copySbmtRptId}
			      ,ACP_DVSN_CD
			      ,ACP_GRN_NO
			      ,DECODE(RPRT_CD,'D10300600',REPLACE(RPRT_NM,' 및',''),'E10300300',REPLACE(RPRT_NM,' 및',''),REPLACE(RPRT_NM,' 및 부의안','')) || '(보고자용)'
			      ,LINK_URL
			      ,NECES_YN
			      ,'10'
			      ,DECODE(#{rprtCd},'D10300600','D10300610','E10300300','E10300310','D10301100','D10301110','E10500600','E10500610')
			      ,''
			      ,'N'
			      ,DOC_KND_CD   
			      ,ACP_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,(SELECT MAX(SORT_SNO)+1 FROM TBBADFRE103M B  WHERE ACP_YR = #{acpYr} AND ACP_SRNO = #{acpSrno} AND ACP_STEP_CD = #{acpStepCd} AND ACP_DVSN_CD = #{acpDvsnCd}) AS SORT_SNO
			      /*,SYT_TRTM_DVSN_YN*/
			      ,ACP_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,#{fnlUsrId}
			      ,#{fnlUsrId}
			      ,#{fnlDealDptCd}
			      ,#{menuNo}
			      ,SYSDATE
			      ,SYSDATE
			      ,OPEN_DOC_NTCE_DH,DLV_RMK,DLV_DT,DLV_CNT,AUD_DOC_ID,AUD_RPRT_CD,TEMPLATE_DOC_ID
			FROM TBBADFRE103M A
			WHERE ACP_YR = #{acpYr}
			 AND ACP_SRNO = #{acpSrno}
			 AND ACP_DVSN_CD = #{acpDvsnCd}
			 AND ACP_STEP_CD = #{acpStepCd}
			 AND RPRT_CD = #{rprtCd}
			 AND DOC_ID = #{docId}
    </insert>
    
    <insert id="BADFRE103MInsertCopySbmtCapRprt" parameterType="paramMap">
   	 	/*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MInsertCopySbmtCapRprt*/
        INSERT INTO TBBADFRE103M(
        						
			       ACP_YR
			      ,ACP_SRNO
			      ,ACP_STEP_CD
			      ,DOC_ID 
			      ,ACP_DVSN_CD
			      ,ACP_GRN_NO
			      ,RPRT_NM
			      ,LINK_URL
			      ,NECES_YN
			      ,APV_STA_CD
			      ,RPRT_CD
			      ,APV_RQS_ID
			      ,SND_DOC_YN
			      ,DOC_KND_CD   
			      ,ACP_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,SORT_SNO
			      /*,SYT_TRTM_DVSN_YN*/
			      ,ACP_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,FRT_REGI_DH
			      ,FNL_MDF_DH
			      /*,REF_DOC_ID*/
			      ,OPEN_DOC_NTCE_DH,DLV_RMK,DLV_DT,DLV_CNT,AUD_DOC_ID,AUD_RPRT_CD,TEMPLATE_DOC_ID
			)
			SELECT ACP_YR
			      ,ACP_SRNO
			      ,ACP_STEP_CD
			      ,#{copySbmtRptId}
			      ,ACP_DVSN_CD
			      ,ACP_GRN_NO
			      ,DECODE(RPRT_CD,'D10300600',REPLACE(RPRT_NM,' 및',''),'E10300300',REPLACE(RPRT_NM,' 및',''),REPLACE(RPRT_NM,' 및 부의안','')) || '(회의용)'
			      ,LINK_URL
			      ,NECES_YN
			      ,'10'
			      ,DECODE(#{rprtCd},'D10300600','D10300620','E10300300','E10300320','D10301100','D10301120','E10500600','E10500620')
			      ,''
			      ,'N'
			      ,DOC_KND_CD   
			      ,ACP_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,(SELECT MAX(SORT_SNO)+1 FROM TBBADFRE103M B  WHERE ACP_YR = #{acpYr} AND ACP_SRNO = #{acpSrno} AND ACP_STEP_CD = #{acpStepCd} AND ACP_DVSN_CD = #{acpDvsnCd}) AS SORT_SNO
			      /*,SYT_TRTM_DVSN_YN*/
			      ,ACP_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,#{fnlUsrId}
			      ,#{fnlUsrId}
			      ,#{fnlDealDptCd}
			      ,#{menuNo}
			      ,SYSDATE
			      ,SYSDATE
			      ,OPEN_DOC_NTCE_DH,DLV_RMK,DLV_DT,DLV_CNT,AUD_DOC_ID,AUD_RPRT_CD,TEMPLATE_DOC_ID
			FROM TBBADFRE103M A
			WHERE ACP_YR = #{acpYr}
			 AND ACP_SRNO = #{acpSrno}
			 AND ACP_DVSN_CD = #{acpDvsnCd}
			 AND ACP_STEP_CD = #{acpStepCd}
			 AND RPRT_CD = #{rprtCd}
			 AND DOC_ID = #{docId}
    </insert>
	
	<!-- 사무처위임처리 시 '심리결과 시행'의 '회람' 마스터 프로세스 조회 -->
	<select id="BADFRE101BproSelect" parameterType="paramMap" resultType="egovMap">
    	/*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE101BproSelect*/
        SELECT ACP_STEP_CD
             , ACP_MAIN_STEP_ID
             , ACP_MAIN_STEP_NM
             , ACP_MAIN_STEP_SNO
             , ACP_MAIN_SEQ_W
             , ACP_MAIN_SEQ_H
             , LINK_TYPE
             , LINK_URL
             , ACP_DOC_CD
          FROM TBBADFRE102B
         WHERE ACP_KND_CD = #{acpDvsnCd}
         	AND ACP_STEP_CD = #{acpStepCd}
          	AND ACP_MAIN_STEP_ID = #{acpMainStepId}
    </select>
    
    <!-- 사무처위임처리 시 '심리결과 시행'의 '회람' 메인 프로세스 삭제 -->
    <delete id="deleteMpro" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.deleteMpro*/
        DELETE FROM TBBADFRE102M
        WHERE ACP_YR  = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO  =#{acpSrno}
           AND ACP_MAIN_STEP_ID  = #{acpMainStepId}
           AND ACP_STEP_CD  = #{acpStepCd}
    </delete>
	

    <select id="selectPrcsList" parameterType="paramMap" resultType="egovMap" >
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectPrcsList*/
            SELECT A.ACP_YR        /* 접수년도 */
                  ,A.ACP_SRNO        /* 접수연번 */
                  ,A.ACP_STEP_CD   /* 단계코드 */
                  ,A.ACP_STEP_NM   /* 단계명 */
                  ,A.STEP_CMPT_YN  /* 단계완료상태 : NULL:미진행, P:진행 Y:완료 */
                <if test='acpStepCd != null and acpStepCd != ""'>
                  ,TO_CHAR(TO_DATE(A.CMPT_CLSNG_DY, 'YYYY-MM-DD'), 'YYYY-MM-DD') CMPT_CLSNG_DY  /*완료기한일자 */
                  ,A.TSK_DESC       /*업무설명 */
                </if>
                  ,A.LINK_URL       /* 링크주소 */
                  ,A.NECES_YN       /* 필수 여부 */
             FROM TBBADFRE101M A
              WHERE NECES_YN = 'Y'
                <if test='acpYr != null and acpYr != ""'>
                    AND A.ACP_YR = #{acpYr} /* PARAM : 접수년도 */
                </if>
                <if test='acpSrno != null and acpSrno != ""'>
                    AND A.ACP_SRNO = #{acpSrno}/* PARAM : 접수연번(내부  pk 번호) */
                </if>
                <if test='acpDvsnCd != null and acpDvsnCd != ""'>
                    AND A.ACP_DVSN_CD = #{acpDvsnCd}
                    /* PARAM : 접수종류코드 실지접수일 경우  A10, 확인출장(접수종류 코드 165)일 경우  B10 */
                </if>
                <![CDATA[
            ORDER BY ACP_STEP_CD ASC
            ]]>
    </select>
    
    <select id="GetApvrInfoByAudRprt" parameterType="paramMap" resultType="egovMap" >
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.GetApvrInfoByAudRprt*/
            <![CDATA[
            SELECT ACP_RPRT_DVSN_CD, DOC_ID, APVR_PST_CD 
			  FROM (
			  		SELECT A.ACP_RPRT_DVSN_CD, A.DOC_ID, B.APVR_PST_CD
			  		  FROM TBBADFRE103M A
					     , TBDCMACM023L B
					 WHERE B.APV_DOC_NO = #{apvRqsId}
					   AND A.APV_RQS_ID = B.APV_DOC_NO
					   AND B.APV_SNO = (
					   					SELECT D.APV_SNO+1
									  	  FROM TBBADFRE103M C
										  	 , TBDCMACM023L D
					 					 WHERE D.APV_DOC_NO = B.APV_DOC_NO
										   AND C.APV_RQS_ID = D.APV_DOC_NO
										   AND D.APV_SNO = NVL(#{rApvSno},0)
										   AND C.RPRT_CD = #{rprtCd}
										   AND D.APVR_CNB = #{rFnlApvCnb}
										)
					   AND A.RPRT_CD = #{rprtCd}
					   AND B.APVR_KND_CD IN('2','3','4','9') /* 공석자 추가. 2017.08.02 sk손힘찬*/
				   )
			]]>
    </select>
    
    <select id="BADFRE111MSelectRvwRsqDoc" parameterType="paramMap" resultType="egovMap">
    /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE111MSelectRvwRsqDoc*/
		<![CDATA[
    			SELECT 
	                T1.ACP_YR
	                ,T1.ACP_SRNO
	                ,T1.ACP_DVSN_CD
	                ,T1.DOC_ID
	                ,T1.RPRT_NM
	                ,T1.RPRT_CD
	                ,T1.REF_ID
	            FROM 
	                TBBADFRE111M T1
	            WHERE 
	                T1.ACP_YR = #{acpYr}
	            AND T1.ACP_SRNO = #{acpSrno}
	            AND T1.ACP_DVSN_CD = #{acpDvsnCd}
	            AND T1.DOC_ID = #{docId}
	            AND T1.RPRT_CD = #{rprtCd}
       	]]>
    </select>
    <select id="BADFRE103MSelectRvwRsqDoc" parameterType="paramMap" resultType="egovMap">
    /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MSelectRvwRsqDoc*/
		<![CDATA[
	        SELECT 
	                T1.ACP_YR
	                ,T1.ACP_SRNO
	                ,T1.ACP_DVSN_CD
	                ,T1.ACP_STEP_CD
	                ,T1.DOC_ID
	                ,T1.ACP_KND_CD
	                ,T1.ACP_GRN_NO
	                ,T1.RPRT_NM
	                ,T1.RPRT_CD
	                ,T1.LINK_URL
	                ,T1.REF_ID
	                ,T1.REF_DY
	            FROM 
	                TBBADFRE103M T1
	            WHERE 
	                T1.ACP_YR = #{acpYr}
	            AND T1.ACP_SRNO = #{acpSrno}
	            AND T1.ACP_DVSN_CD = #{acpDvsnCd}
	            AND T1.DOC_ID = #{docId}
	            AND T1.RPRT_CD = #{rprtCd}
			]]>

	</select>

    <select id="selectMainTskPrcsList" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectMainTskPrcsList */
        SELECT A.ACP_MAIN_STEP_ID  /*주요업무코드*/
             , A.ACP_STEP_CD /*접수단계코드*/
             , A.ACP_MAIN_STEP_SNO  /*주요업무순번 */
             , A.ACP_MAIN_SEQ_W /*주요업무순서_가로 */
             , A.ACP_MAIN_SEQ_H /*주요업무순서_세로 */
             , A.CMPT_YN /*완료여부*/
             , A.ACP_DOC_CD /*문서ID*/
             , TRIM(A.MAIN_JOB_NM) AS MAIN_JOB_NM /*주요업무명*/
             , TRIM(A.LINK_TYPE) AS LINK_TYPE/*링크유형*/
             , DECODE(TRIM(A.LINK_TYPE), 'NAN', ''
                                 , 'POP', A.LINK_URL
                                 , 'FNC', A.LINK_URL
                                 , (CASE WHEN A.ACP_DOC_CD = 'D10200200' 
                                 		THEN (SELECT DOC_ID
                                      		  FROM TBFDMADM002M B
		                                     WHERE A.ACP_DOC_CD = B.AUD_DOC_CD
		                                       AND B.DOC_KND_CD = DECODE(A.LINK_TYPE, 'DOC', '10', '20')
		                                       AND B.DTIL_AUD_DOC_NO =   
                                             DECODE((SELECT MG_DIV_CD
                                                    FROM TBBADFRE012M S1
                                                    WHERE S1.ACP_YR = A.ACP_YR
                                                    AND S1.ACP_SRNO = A.ACP_SRNO
                                                    AND S1.ACP_DVSN_CD = A.ACP_DVSN_CD),NULL,'310','10','407','20','406','407')
                                       				)
                                         WHEN A.ACP_DOC_CD = 'D10301100' 
                                 		THEN (SELECT DOC_ID
                                      		  FROM TBFDMADM002M B
		                                     WHERE A.ACP_DOC_CD = B.AUD_DOC_CD
		                                       AND B.DOC_KND_CD = DECODE(A.LINK_TYPE, 'DOC', '10', '20')
		                                       AND B.DTIL_AUD_DOC_NO =   
                                             DECODE((SELECT MG_DIV_CD
                                                    FROM TBBADFRE012M S1
                                                    WHERE S1.ACP_YR = A.ACP_YR
                                                    AND S1.ACP_SRNO = A.ACP_SRNO
                                                    AND S1.ACP_DVSN_CD = A.ACP_DVSN_CD),NULL,'320','10','414','20','413','414')
                                       				)
                                       	/*WHEN A.ACP_DOC_CD = 'E10500600' 
                                 		THEN (SELECT DOC_ID
                                      		  FROM TBFDMADM002M B
		                                     WHERE A.ACP_DOC_CD = B.AUD_DOC_CD
		                                       AND B.DOC_KND_CD = DECODE(A.LINK_TYPE, 'DOC', '10', '20')
		                                       AND B.DTIL_AUD_DOC_NO =   
                                             DECODE((SELECT MG_DIV_CD
                                                    FROM TBBADFRE012M S1
                                                    WHERE S1.ACP_YR = A.ACP_YR
                                                    AND S1.ACP_SRNO = A.ACP_SRNO
                                                    AND S1.ACP_DVSN_CD = A.ACP_DVSN_CD),NULL,'320','10','414','20','413','414')
                                       				)*/
			                             ELSE (SELECT DOC_ID
			                                      FROM TBFDMADM002M B
			                                     WHERE A.ACP_DOC_CD = B.AUD_DOC_CD
			                                       AND B.DOC_KND_CD = DECODE(A.LINK_TYPE, 'DOC', '10', '20') )
			                                       END )
                    ) AS LINK_URL /*링크주소*/
               , USE_YN
          FROM TBBADFRE102M A
         WHERE 1=1
        <if test='acpYr != null and acpYr != ""'>
           AND A.ACP_YR = #{acpYr} /* PARAM : 접수년도 */
        </if>
        <if test='acpSrno != null and acpSrno != ""'>
           AND A.ACP_SRNO = #{acpSrno}/* PARAM : 접수연번(내부  pk 번호) */
        </if>
        <if test='acpDvsnCd != null and acpDvsnCd != ""'>
           AND A.ACP_DVSN_CD = #{acpDvsnCd}
        </if>
        <if test='acpStepCd != null and acpStepCd != ""'>
           AND A.ACP_STEP_CD = #{acpStepCd}
        </if>
        <if test='acpMainStepIdType != null and acpMainStepIdType != ""'>
           AND A.ACP_MAIN_STEP_ID like #{acpMainStepIdType} || '%'
           <if test='acpMainStepSno != null and acpMainStepSno != "" and acpMainStepSno != "0"'>
           AND A.ACP_MAIN_STEP_SNO = #{acpMainStepSno} /* PARAM : 주요업무 순번  */
           </if>
           AND USE_YN = 'Y'
        </if>
         ORDER BY A.ACP_MAIN_STEP_SNO, A.ACP_MAIN_SEQ_W ASC
    </select>

    <update id="updateStepCmpt" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.updateStepCmpt*/
        UPDATE TBBADFRE101M
            SET
            FNL_MDF_DH = SYSDATE
            ,STEP_CMPT_YN = #{stepCmptYn}
            <if test='stepCmptYn == "Y"'>
                ,STEP_CMPT_DH = SYSDATE
            </if>
            ,FNL_USR_ID = #{fnlUsrId}
            ,FNL_DEAL_DPT_CD =#{fnlDealDptCd}
            WHERE 1=1
            AND ACP_YR = #{acpYr}
            AND ACP_SRNO = #{acpSrno}
            AND ACP_STEP_CD = #{acpStepCd}
    </update>

    <update id="updateCmptYn" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.updateCmptYn*/
        UPDATE TBBADFRE102M
            SET
            FNL_MDF_DH = SYSDATE
            ,CMPT_YN  = #{cmptYn}
            ,FNL_USR_ID = #{fnlUsrId}
            ,FNL_DEAL_DPT_CD =#{fnlDealDptCd}
            WHERE 1=1
            AND ACP_YR = #{acpYr}
            AND ACP_SRNO = #{acpSrno}
            AND ACP_STEP_CD = #{acpStepCd}
            AND ACP_MAIN_STEP_ID  = #{acpMainStepId}
            <if test='acpMainStepSno != null and acpMainStepSno != ""'>
            AND ACP_MAIN_STEP_SNO   = #{acpMainStepSno}
            </if>
    </update>

    <select id="selectDocumentList" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectDocumentList*/
        /*문서함(결재정보)*/
        <![CDATA[
        SELECT
            RPRT_NM,
           APV_STA_CD,
           APV_RQS_ID,
           DOC_ID,
           APV_SRNO,
           PST_NM,
           APVR_NM,
           APV_DH ,
           CASE
                WHEN ROW_NUMBER() OVER(PARTITION BY DOC_ID ORDER BY APV_SRNO) = 1 THEN COUNT(*) OVER(PARTITION BY DOC_ID)
                ELSE 0
           END ROWSPAN_CNT
      FROM (
           SELECT
                  A.RPRT_NM ,       /*보고서명 */
                  A.APV_STA_CD ,    /*결재상태코드 */
                  A.DOC_ID ,        /*결재문서번호 */
                  A.APV_RQS_ID,     /*결재요청ID */
                  B.APV_SRNO ,      /*결재순번 */
                  B.PST_NM ,        /*결재자직위코드 */
                  B.APVR_NM ,       /*결재자전산번호 */
                  B.APV_DH          /*결재일시 */
             FROM TBBADFRE103M A,
                  (
                  SELECT T1.APV_DOC_NO AS APV_RQS_ID ,
                         T1.APV_SNO AS APV_SRNO ,
                         CASE WHEN T1.APVR_PST_CD IS NULL
                              THEN T1.ONR_PST_NM
                              ELSE F_CODE_NM('1000176', T1.APVR_PST_CD)
                         END  AS PST_NM ,
                         DECODE(T1.APVR_STA_CD, '206', (
                                                     SELECT '(代)' || F_USR_INFO(T2.APVR_CNB, '2')
                                                       FROM TBDCMACM023L T2
                                                      WHERE T2.APV_DOC_NO = T1.APV_DOC_NO
                                                        AND T2.APV_SNO = T1.APV_SNO
                                                        AND T2.APVR_STA_CD = '203'
                                                    ), F_USR_INFO(T1.APVR_CNB, '2')) AS APVR_NM ,
                         CASE WHEN SUBSTR(T1.APVR_STA_CD,0,1) = '2' THEN TO_CHAR(T1.APV_DH, 'YYYY-MM-DD')
                                  ELSE ''
                         END  AS APV_DH
                    FROM TBDCMACM023L T1
                   WHERE T1.APV_SNO <> '1'
                   AND T1.APVR_KND_CD NOT IN ('4','6','7')
                   UNION ALL
                  SELECT DH1.APV_RQS_ID,
                         DH1.APV_SRNO,
                         (SELECT H2.PST_NM AS PST_NM
                            FROM TBDCMACM111H H1,
                                 TBDCMACM112H H2
                           WHERE 1=1
                             AND H1.RCPT_DT = H2.RCPT_DT
                             AND H1.RCPT_ID = H2.RCPT_ID
                             AND H1.ONR_DOC_MNG_CRD_ID = DH1.APV_RQS_ID
                             AND H2.APVR_ID = DH1.APVR_ID
                           GROUP BY H2.PST_NM ) AS PST_NM,
                         DH1.APVR_NM,
                         DH1.APV_DH
                    FROM
                         (SELECT ONR_DOC_MNG_CRD_ID AS APV_RQS_ID,
                                 APV_HIS_SRNO AS APV_SRNO,
                                 APVR_ID,
                                 APVR_NM AS APVR_NM,
                                 TO_CHAR(APV_DH, 'YYYY-MM-DD') AS APV_DH
                            FROM TBDCMACM102L D2
                           WHERE 1=1
                             AND ONR_APV_DVSN_CD <> '10' --(기안자 제외)
                              AND NVL(ONR_APV_RSLT_CD,'hh') <>'50'
                           ORDER BY APV_RQS_ID,APV_SRNO
                         ) DH1
                  ) B
            WHERE A.ACP_YR = #{acpYr}
              AND A.ACP_DVSN_CD = #{acpDvsnCd}
              AND A.ACP_SRNO = #{acpSrno}
        ]]>
        <choose>
        	<when test='acpStepCd == "D1000" or acpStepCd == "D1001" or acpStepCd == "D1002"'> <!-- 심사 선람전 -->
              AND A.RPRT_CD IN ('D10100001', 'D10100002')
            </when>
            <when test='acpStepCd == "E1000" or acpStepCd == "E1001" or acpStepCd == "E1002"'> <!-- 재심 선람전 -->
              AND A.RPRT_CD IN ('E10100001', 'E10100002')
            </when>
            <otherwise>
              AND A.ACP_STEP_CD = #{acpStepCd}
            </otherwise>
        </choose>
              AND B.APV_RQS_ID = A.APV_RQS_ID
        <if test='acpStepCd == "D1020"'> <!-- 심사 본안심리 -->
              AND A.RPRT_CD NOT IN ('D10200100', 'D10200300')
        </if>
        <if test='acpStepCd == "D1030" and tabIndex == "1"'> <!-- 심사 부의준비 -->
              AND A.RPRT_CD  IN ('D10300200', 'D10300300', 'D10300310')
       	</if>
       	<if test='acpStepCd == "D1030" and tabIndex == "2"'> <!-- 심사 소위원회 -->
              AND A.RPRT_CD  IN ('D10300600','D10300610','D10300620')
       	</if>
       	<if test='acpStepCd == "D1030" and tabIndex == "3"'> <!-- 심사 부의실시 -->
              AND A.RPRT_CD  IN ('D10301100', 'D10301200','D10301110','D10301120')
       	</if>
        <if test='acpStepCd == "D1040"'> <!-- 심사 심리결과 시행 -->
              AND A.RPRT_CD  NOT IN ('D10400300', 'D10400400', 'D10400600', 'D10400100')
       	</if>
       	<if test='acpStepCd == "E1040"'> <!-- 재심 본안심리 -->
              AND A.RPRT_CD NOT IN ('E10400100', 'E10400300')
        </if>
        <if test='acpStepCd == "E1020"'> <!-- 재심 소위원회 심의안 작성 -->
              AND A.RPRT_CD NOT IN ('E10200100')
        </if>
        <if test='acpStepCd == "E1030" and tabIndex == "1"'> <!-- 재심 심의준비 -->
              AND A.RPRT_CD  IN ('E10300150', 'E10900200')
       	</if>
       	<if test='acpStepCd == "E1030" and tabIndex == "2"'> <!-- 재심 심의실시 -->
              AND A.RPRT_CD  IN ('E10300300','E10300310','E10300320')
       	</if>
        <if test='acpStepCd == "E1050" and tabIndex == "1"'> <!-- 재심 부의준비 -->
              AND A.RPRT_CD  IN ('E10500200', 'E10500300')
       	</if>
       	<if test='acpStepCd == "E1050" and tabIndex == "3"'> <!-- 재심 부의실시 -->
              AND A.RPRT_CD  IN ('E10500600', 'E10500700','E10500610','E10500620')
       	</if>
        <if test='acpStepCd == "E1060"'> <!-- 재심 심리결과 시행 -->
               AND A.RPRT_CD  NOT IN ('E10600200', 'E10600300', 'E10600400', 'E10600050', 'E10600600')
        </if>
        <if test="refId != null and refId != ''">
               AND A.REF_ID = #{refId}
        </if>
        
        <if test="sbmtSeq != null and sbmtSeq != ''">
               AND A.REF_ID = (select doc_Id from tbbadfre103m where 1=1
					              and  ACP_YR = #{acpYr}
					              AND ACP_DVSN_CD = #{acpDvsnCd}
					              AND ACP_SRNO = #{acpSrno}
					              AND acp_Step_Cd = #{acpStepCd}
					              AND rprt_Cd = decode(#{acpStepCd},'D1030','D10300500','E1030','E10300200')
 					              and ref_id = #{sbmtSeq}
					              )
        </if>
        
        <if test="sbcnRegiReqDt != null and sbcnRegiReqDt != ''">
               AND A.REF_DY  = #{sbcnRegiReqDt}
        </if>
        <if test="rprtCd != null and rprtCd != ''">
               AND A.RPRT_CD  = #{rprtCd}
               AND A.RPRT_CD NOT IN ('A10700600')  /*부의안 요약 + 부의안 한줄로 처리 */
        </if>
        <if test="rprtCd != null and rprtCd != ''">
                <if test="rprtCd == 'D10300600'">
        	   		AND A.RPRT_CD IN ( #{rprtCd},'D10300610','D10300620')
        	   </if>
        	   <if test="rprtCd == 'E10300300'">
        	   		AND A.RPRT_CD IN ( #{rprtCd},'E10300310','E10300320')
        	   </if>
        	   <if test="rprtCd == 'D10301100'">
        	   		AND A.RPRT_CD IN ( #{rprtCd},'D10301110','D10301120')
        	   </if>
        	   <if test="rprtCd == 'E10500600'">
        	   		AND A.RPRT_CD IN ( #{rprtCd},'E10500610',,'E10500620')
        	   </if>
        	   <if test="rprtCd != 'E10300300' and rprtCd != 'D10300600' and rprtCd != 'D10301110' and rprtCd != 'E10500610'">
        	   		AND A.RPRT_CD  = #{rprtCd}
        	   </if>
        </if>
        ORDER BY A.SORT_SNO
        )
    </select>

    <select id="selectDocumentList2" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectDocumentList2*/
        /*문서함(문서자체정보)*/
        <![CDATA[
          SELECT
                  CASE WHEN A.RPRT_CD = 'A10700500'     /*부의안 요약 + 부의안 한줄로 처리 */
                    THEN  A.RPRT_NM ||'<br>'|| (SELECT RPRT_NM
                                        FROM TBBADFRE103M ST1
                                        WHERE ST1.ACP_YR = A.ACP_YR
                                        AND ST1.ACP_SRNO = A.ACP_SRNO
                                        AND ST1.ACP_STEP_CD = A.ACP_STEP_CD
                                        AND ST1.ACP_DVSN_CD = A.ACP_DVSN_CD
                                        AND ST1.REF_DY  = A.REF_DY
                                        AND RPRT_CD = 'A10700600')
                    ELSE A.RPRT_NM
               END AS RPRT_NM ,       /*보고서명 */
               A.RPRT_CD ,       /*보고서코드*/
               A.REF_ID ,
               A.APV_STA_CD,    /*결재상태코드 */
               F_CODE_NM('1000773',A.APV_STA_CD) AS APV_STA_NM ,    /*결재상태코드 */
               A.SORT_SNO ,      /*보고서순번  */
               A.DOC_ID,         /*결재문서번호 */
               A.APV_RQS_ID,      /*결재ID*/
               CASE WHEN A.RPRT_CD IN ('D30100100','E30100100','D10200200','D10300600','D10301100','E10200100','E10500600','E10300300')
               /* 문서함에서 발신하는 문서 : 감사보고서, 처리안검토보고서, 부의안, 부의안요약문, 소위원회 심의안 */
                   THEN DECODE(1, (
                                  SELECT 1
                                    FROM DUAL
                                   WHERE EXISTS (
                                                SELECT 1
                                                  FROM TBBADFRE111M B
                                                 WHERE A.ACP_YR = B.ACP_YR
                                                   AND A.ACP_SRNO = B.ACP_SRNO
                                                   AND A.ACP_STEP_CD = B.ACP_STEP_CD
                                                   AND A.DOC_ID = B.DOC_ID
                                                )
                                  ), 'N', 'Y')
                   ELSE 'N'
               END AS APV_YN            /*결재여부 */
               , (SELECT MIN(ST2.USR_DFN_TXT_5)
                       FROM TBDCMACM023L ST
                       INNER JOIN TBDCMACM013C ST2 ON (ST2.USR_DFN_TXT_1 = ST.APVR_PST_CD AND ST2.CMM_CD_DVSN_CD = '1000659')
                      WHERE ST.APV_DOC_NO = A.APV_RQS_ID 
                        AND ST.APVR_KND_CD IN ('2','3') 
                        AND ST.APV_DH IS NOT NULL 
                        AND ST.APV_SNO = (SELECT MAX(APV_SNO) 
                                         FROM TBDCMACM023L 
                                        WHERE APV_DOC_NO = A.APV_RQS_ID 
                                          AND APVR_KND_CD IN ('2','3') 
                                          AND APV_DH IS NOT NULL)) AS APVR_INN_RANK_CD
               , CON_PGM_CD    /*연계프로그램코드*/
               , A.NECES_YN   /*필수여부*/
               , A.APV_WAY_CD /*결재방법코드*/
               , A.SND_DOC_YN /*문서발송여부*/
               , A.EDITOR_WRK_APPL_YN /*에디팅결과반영여부*/
               , (SELECT (CASE WHEN COUNT(DOC_ID) > 0 THEN 'Y' ELSE 'N' END) FROM TBBADFRE111M WHERE ACP_YR = A.ACP_YR AND ACP_DVSN_CD = A.ACP_DVSN_CD AND ACP_SRNO = A.ACP_SRNO AND ACP_STEP_CD = 'D1020' AND DOC_ID = A.REF_ID AND RPRT_CD = 'D10200100') AS QLT_YN
               , (SELECT DECODE(COUNT(1), 0, 'N', 'Y') FROM TBDCMACM023H ST1 WHERE ST1.APV_DOC_NO = A.APV_RQS_ID AND ST1.APVR_STA_CD NOT IN ('301', '201')) AS APV_HIS_YN
               , A.ACP_YR
               , A.ACP_DVSN_CD
               , A.ACP_SRNO
               , F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE
               , B.WT_VT_YN
               , A.WRIT_CMPT_YN
          FROM TBBADFRE103M AS A
             , TBBADFRE012M AS B
          WHERE 1=1
            AND A.ACP_YR = B.ACP_YR
            AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
            AND A.ACP_SRNO = B.ACP_SRNO
            AND A.ACP_YR = #{acpYr}
            AND A.ACP_DVSN_CD = #{acpDvsnCd}
            AND A.ACP_SRNO = #{acpSrno}
         ]]>
         <choose>
        	<when test='acpStepCd == "D1000" or acpStepCd == "D1001" or acpStepCd == "D1002"'> <!-- 심사 선람전 -->
              AND A.RPRT_CD IN ('D10100001', 'D10100002')
            </when>
            <when test='acpStepCd == "E1000" or acpStepCd == "E1001" or acpStepCd == "E1002"'> <!-- 재심 선람전 -->
              AND A.RPRT_CD IN ('E10100001', 'E10100002')
            </when>
            <otherwise>
              AND A.ACP_STEP_CD = #{acpStepCd}
            </otherwise>
        </choose>
        <if test='acpStepCd == "D1010" or acpStepCd == "E1010"'> <!-- 청구사항 검토, 원처분조회-->
	        <if test="dspDoc == null or dspDoc == ''">
	        	AND A.RPRT_CD  NOT IN ('E10100100', 'D10100100')
	        </if>
	        AND A.RPRT_CD  NOT IN ('E10100300','E10100310','E10100311','E10100320','E10100321','E10100330','E10100331','E10100332', 'E10100340','E10100341','E10100350'
									,'E10100351','E10100352','E10100360','E10100361','E10100370','E10100315', 'E10100380',
									'D10100300','D10100310','D10100311','D10100320','D10100321','D10100330','D10100331','D10100332', 'D10100340','D10100341','D10100350'
									,'D10100351','D10100352','D10100360','D10100361','D10100370','D10100315','D10100380')
        </if>
        <if test='acpStepCd == "D1020"'> <!-- 심사 본안심리 -->
              AND A.RPRT_CD NOT IN ('D10200100', 'D10200101', 'D10200300', 'D10200500', 'D10200600', 'D10200700', 'D10200800', 'D10200900')
        </if>
        <if test='acpStepCd == "D1030" and tabIndex == "1"'> <!-- 심사 부의준비 -->
              AND A.RPRT_CD  IN ('D10300200', 'D10300300', 'D10300310')
       	</if>
       	<if test='acpStepCd == "D1030" and tabIndex == "2"'> <!-- 심사 소위원회 -->
              AND A.RPRT_CD  IN ('D10300600','D10300610','D10300620')
       	</if>
       	<if test='acpStepCd == "D1030" and tabIndex == "3"'> <!-- 심사 부의실시 -->
              AND A.RPRT_CD  IN ('D10301100', 'D10301200','D10301110','D10301120')
       	</if>
        <if test='acpStepCd == "D1040"'> <!-- 심사 심리결과 시행 -->
              AND A.RPRT_CD  NOT IN ('D10400300', 'D10400400', 'D10400600', 'D10400100')
       	</if>
       	<if test='acpStepCd == "E1040"'> <!-- 재심 본안심리 -->
              AND A.RPRT_CD NOT IN ('E10400100', 'E10400101', 'E10400300', 'E10400400', 'E10400500', 'E10400600', 'E10400700')
        </if>
        <if test='acpStepCd == "E1020"'> <!-- 재심 소위원회 심의안 작성 -->
              AND A.RPRT_CD NOT IN ('E10200100')
        </if>
        <if test='acpStepCd == "E1030" and tabIndex == "1"'> <!-- 재심 심의준비 -->
              AND A.RPRT_CD  IN ('E10300150', 'E10900200')
       	</if>
       	<if test='acpStepCd == "E1030" and tabIndex == "2"'> <!-- 재심 심의실시 -->
              AND A.RPRT_CD  IN ('E10300300','E10300310','E10300320')
       	</if>
        <if test='acpStepCd == "E1050" and tabIndex == "1"'> <!-- 재심 부의준비 -->
              AND A.RPRT_CD  IN ('E10500200', 'E10500300')
       	</if>
       	<if test='acpStepCd == "E1050" and tabIndex == "3"'> <!-- 재심 부의실시 -->
              AND A.RPRT_CD  IN ('E10500600', 'E10500700','E10500610','E10500620')
       	</if>
        <if test='acpStepCd == "E1060"'> <!-- 재심 심리결과 시행 -->
              AND A.RPRT_CD  NOT IN ('E10600200', 'E10600300', 'E10600400', 'E10600050', 'E10600600')
        </if>
        <if test="refId != null and refId != ''">
               AND A.REF_ID = #{refId}
        </if>
        <if test="sbmtSeq != null and sbmtSeq != ''">
               AND A.REF_ID in (select doc_Id from tbbadfre103m where 1=1
					              and  ACP_YR = #{acpYr}
					              AND ACP_DVSN_CD = #{acpDvsnCd}
					              AND ACP_SRNO = #{acpSrno}
					              AND acp_Step_Cd = #{acpStepCd}
					              AND rprt_Cd = decode(#{acpStepCd},'D1030','D10300500','E1030','E10300200')
 					              and ref_id = #{sbmtSeq}
					              )
        </if>
        <if test="sbcnRegiReqDt != null and sbcnRegiReqDt != ''">
               AND A.REF_DY  = #{sbcnRegiReqDt}
               AND A.RPRT_CD NOT IN ('A10700600')  /*부의안 요약 + 부의안 한줄로 처리 */
        </if>
        <if test="rprtCd != null and rprtCd != ''">
        	   <if test="rprtCd == 'D10300600'">
        	   		AND A.RPRT_CD IN ( #{rprtCd},'D10300610','D10300620')
        	   </if>
        	   <if test="rprtCd == 'E10300300'">
        	   		AND A.RPRT_CD IN ( #{rprtCd},'E10300310','E10300320')
        	   </if>
        	   <if test="rprtCd == 'D10301100'">
        	   		AND A.RPRT_CD IN ( #{rprtCd},'D10301110','D10301120')
        	   </if>
        	   <if test="rprtCd == 'E10500600'">
        	   		AND A.RPRT_CD IN ( #{rprtCd},'E10500610','E10500210')
        	   </if>
        	   <if test="rprtCd != 'E10300300' and rprtCd != 'D10300600' and rprtCd != 'D10301110' and rprtCd != 'E10500610'">
        	   		AND A.RPRT_CD  = #{rprtCd}
        	   </if>
               
        </if>
        
        ORDER BY A.SORT_SNO ASC, A.FRT_REGI_DH ASC
    </select>
    
    <select id="SelectMgInfo" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.SelectMgInfo*/
          SELECT NVL(MG_ACP_YR,'') AS MG_ACP_YR, NVL(MG_ACP_SRNO,'') AS MG_ACP_SRNO, NVL(MG_ACP_DVSN_CD,'') AS MG_ACP_DVSN_CD, NVL(MG_DIV_CD,'') AS  MG_DIV_CD
		    FROM TBBADFRE012M    
		   WHERE 1=1
		     AND ACP_YR=#{acpYr}
             AND ACP_SRNO=#{acpSrno}  
             AND ACP_DVSN_CD=#{acpDvsnCd}
    </select>
    
    <select id="SelectMgCntInfo" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.SelectMgCntInfo*/
          SELECT B.DOC_ID,A.MG_DIV_CD,NVL(A.AUD_YR,'') AS AUD_YR
		  FROM (
		  	  SELECT ST1.ACP_YR,
		  	         ST1.ACP_SRNO,
		  	         ST1.ACP_DVSN_CD,
		             NVL(ST1.MG_DIV_CD,'') AS MG_DIV_CD ,
		             ST1.AUD_YR,
		             ST1.MG_ACP_YR,MG_ACP_SRNO,MG_ACP_DVSN_CD
		  	   FROM  TBBADFRE012M ST1    
		      ) A, TBBADFRE103M B
		WHERE A.ACP_YR = B.ACP_YR
		  AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		  AND A.ACP_SRNO = B.ACP_SRNO
		  <if test='mgGubun != null and mgGubun != ""'>
		      AND A.MG_ACP_YR=#{mgAcpYr}
              AND A.MG_ACP_SRNO=#{mgAcpSrno}
              AND A.MG_ACP_DVSN_CD=#{mgAcpDvsnCd}
		  </if>
		  
		  <if test='mgGubun == null or mgGubun == ""'>
		      AND A.ACP_YR=#{acpYr}
              AND A.ACP_SRNO=#{acpSrno}
              AND A.ACP_DVSN_CD=#{acpDvsnCd}
		  </if>
		  
		  AND B.APV_STA_CD = '30'
		  AND B.RPRT_CD IN('D10400600','E10600300')
    </select>
    
    <select id="CountMgCntInfo" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.CountMgCntInfo*/
          SELECT B.DOC_ID,A.MG_DIV_CD,NVL(A.AUD_YR,'') AS AUD_YR
		  FROM (
		  	  SELECT ST1.ACP_YR,
		  	         ST1.ACP_SRNO,
		  	         ST1.ACP_DVSN_CD,
		             NVL(ST1.MG_DIV_CD,'') AS MG_DIV_CD ,
		             ST1.AUD_YR,
		             ST1.MG_ACP_YR,MG_ACP_SRNO,MG_ACP_DVSN_CD
		  	   FROM  TBBADFRE012M ST1    
		      ) A, TBBADFRE103M B
		WHERE A.ACP_YR = B.ACP_YR
		  AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		  AND A.ACP_SRNO = B.ACP_SRNO
		  <if test='mgGubun != null and mgGubun != ""'>
		      AND A.MG_ACP_YR=#{mgAcpYr}
              AND A.MG_ACP_SRNO=#{mgAcpSrno}
              AND A.MG_ACP_DVSN_CD=#{mgAcpDvsnCd}
		  </if>
		  
		  <if test='mgGubun == null or mgGubun == ""'>
		      AND A.ACP_YR=#{acpYr}
              AND A.ACP_SRNO=#{acpSrno}
              AND A.ACP_DVSN_CD=#{acpDvsnCd}
		  </if>
		       
		  AND B.RPRT_CD IN('D10200100','E10200100')
    </select>
    
    <select id="SelectBadfre112mInfo" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.SelectBadfre112mInfo*/
          SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO
            FROM TBBADFRE112M 
           WHERE 1=1
             AND ACP_YR=#{acpYr}
             AND ACP_SRNO=#{acpSrno}
             AND ACP_DVSN_CD=#{acpDvsnCd}
    </select>
    
    <select id="SelectBadfre112dInfo" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.SelectBadfre112dInfo*/
          SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO
            FROM TBBADFRE112D
           WHERE 1=1
             AND ACP_YR=#{acpYr}
             AND ACP_SRNO=#{acpSrno}
             AND ACP_DVSN_CD=#{acpDvsnCd}
             AND DOC_ID = #{docId}
    </select>

    <select id="selectPrcsDocCmptYn" parameterType="paramMap" resultType="egovMap">
    	/*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectPrcsDocCmptYn*/
        SELECT COUNT(1) AS RPRT_CNT,
                NVL(MAX(
                   (SELECT CMPT_YN
                      FROM TBBADFRE102M ST1
                     WHERE ST1.ACP_YR = T1.ACP_YR
                       AND ST1.ACP_DVSN_CD = T1.ACP_DVSN_CD
                       AND ST1.ACP_SRNO = T1.ACP_SRNO
                       AND ST1.ACP_STEP_CD = T1.ACP_STEP_CD
                       AND ST1.ACP_DOC_CD = T1.RPRT_CD
                       <if test='acpMainStepSno != null and acpMainStepSno != "" and acpMainStepSno != "undefined"'>
                        AND ST1.ACP_MAIN_STEP_SNO   = #{acpMainStepSno}
                        </if>
                       )
                       ),'N') AS CMPT_YN,
                  NVL(MAX(
                   (SELECT ACP_MAIN_STEP_ID
                      FROM TBBADFRE102M ST1
                     WHERE ST1.ACP_YR = T1.ACP_YR
                       AND ST1.ACP_DVSN_CD = T1.ACP_DVSN_CD
                       AND ST1.ACP_SRNO = T1.ACP_SRNO
                       AND ST1.ACP_STEP_CD = T1.ACP_STEP_CD
                       AND ST1.ACP_DOC_CD = T1.RPRT_CD
                       <if test='acpMainStepSno != null and acpMainStepSno != "" and acpMainStepSno != "undefined"'>
                        AND ST1.ACP_MAIN_STEP_SNO   = #{acpMainStepSno}
                        </if>
                       )
                       ),'N') AS ACP_MAIN_STEP_ID
          FROM TBBADFRE103M T1
         WHERE T1.ACP_YR = #{acpYr}
            AND T1.ACP_DVSN_CD = #{acpDvsnCd}
            AND T1.ACP_SRNO = #{acpSrno}
            AND T1.ACP_STEP_CD = #{acpStepCd}
            AND T1.RPRT_CD = #{rprtCd}
    </select>

    <update id="deleteDoc" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.deleteDoc*/
        DELETE FROM TBBADFRE103M
        WHERE ACP_YR  = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO  =#{acpSrno}
           AND ACP_STEP_CD  = #{acpStepCd}
           AND DOC_ID  = #{docId}
    </update>
    
    <update id="BADFRE111MDeleteSendRvwRsqDoc" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE111MDeleteSendRvwRsqDoc*/
        DELETE FROM TBBADFRE111M 
								 WHERE 
										ACP_YR = #{acpYr} 
								 AND ACP_SRNO = #{acpSrno}
								 AND ACP_DVSN_Cd = #{acpDvsnCd}
								 AND ACP_STEP_CD =#{acpStepCd}
								 AND DOC_ID = #{docId}
								 AND RPRT_CD = #{rprtCd}
    </update>
    
    <update id="deleteRefDoc" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.deleteRefDoc*/
        DELETE FROM TBBADFRE103M A
        WHERE A.ACP_YR  = #{acpYr}
           AND A.ACP_DVSN_CD = #{acpDvsnCd}
           AND A.ACP_SRNO  =#{acpSrno}
           AND A.ACP_STEP_CD  = #{acpStepCd}
           AND A.DOC_ID  = (SELECT B.REF_ID FROM TBBADFRE103M B WHERE ACP_YR  = #{acpYr}
					           AND B.ACP_DVSN_CD = #{acpDvsnCd}
					           AND B.ACP_SRNO  =#{acpSrno}
					           AND B.ACP_STEP_CD  = #{acpStepCd}
					           AND B.DOC_ID  = #{docId}
					        )
    </update>
    
    <update id="deleteRef" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.deleteRef*/
        DELETE FROM TBBADFRE103M
        WHERE ACP_YR  = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO  =#{acpSrno}
           AND ACP_STEP_CD  = #{acpStepCd}
           AND REF_ID  = #{docId}
    </update>

    <select id="BADFRE101MStepCdMinSelect"  parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE101MStepCdMinSelect */
		SELECT CASE WHEN A.ACP_STEP_CD IS NOT NULL THEN A.ACP_STEP_CD
                  ELSE (SELECT MAX(ACP_STEP_CD) AS ACP_STEP_CD
                           FROM TBBADFRE101M
                          WHERE ACP_YR = #{acpYr} /* PARAM : 접수년도 */
					         AND ACP_DVSN_CD = #{acpDvsnCd} /* PARAM : 구분코드 */
					         AND ACP_SRNO = #{acpSrno} /* PARAM : 접수번호 */
					         AND NECES_YN = 'Y')
				  END AS ACP_STEP_CD
		 FROM (SELECT  MIN(ACP_STEP_CD) AS ACP_STEP_CD /* 제보청구 단계코드 */
			       FROM TBBADFRE101M A
			      WHERE 1=1
			         AND (STEP_CMPT_YN IS NULL OR STEP_CMPT_YN = 'P')
			         AND A.ACP_YR = #{acpYr} /* PARAM : 접수년도 */
			         AND A.ACP_DVSN_CD = #{acpDvsnCd} /* PARAM : 구분코드 */
			         AND A.ACP_SRNO = #{acpSrno} /* PARAM : 접수번호 */
			         AND A.NECES_YN = 'Y'
		          ORDER BY SORT_SNO) A
	</select>
	
	<select id="BADFRE101MCkImpleSelect"  parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE101MCkImpleSelect */
		   SELECT CASE WHEN NVL(REFER_ENT,'N') = 'Y' AND REFER_ENT_RSN = '1' THEN 'N'
                       ELSE NVL(REFER_ENT,'N')
                        END AS REFER_ENT
            FROM TBBADFRE012M
            WHERE 1=1
            AND ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO = #{acpSrno}
	</select>
	
	<select id="CheakAbleYnByAfterProcess"  parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.CheakAbleYnByAfterProcess */
		<![CDATA[
		SELECT DECODE(CNT,0,'Y','N') AS AFTER_PRCS_YN
		  FROM (SELECT COUNT(1) AS CNT
		          FROM 
		                (SELECT APV_DOC_NO, 
		                        DECODE(APVR_PST_CD, '0035100', '0015800', '0058100', '0015800', '0045900', '0055600', APVR_PST_CD) AS APVR_PST_CD, 
		                        APV_DH
		                   FROM (
		                        SELECT APV_DOC_NO, APVR_PST_CD, APV_DH
		                          FROM TBDCMACM023L
		                         WHERE APV_DOC_NO = #{apvRqsId}
		                           AND SUBSTR(APVR_STA_CD,0,1) >= '2'
		                           AND SUBSTR(APVR_STA_CD,0,1) <> '3'
		                         ORDER BY APV_DH DESC, APVR_KND_CD DESC
		                         ) 
		                 WHERE ROWNUM = 1 ) APVR
		                ,(SELECT APV_DOC_NO,
		                         DECODE(APVR_PST_CD, '0035100', '0015800', '0058100', '0015800', '0045900', '0055600', APVR_PST_CD) AS APVR_PST_CD, 
		                         APV_DH
		                    FROM TBDCMACM023H
		                   WHERE APV_DOC_NO = #{apvRqsId}
		                     AND SUBSTR(APVR_STA_CD,0,1) = '2') HIST
		          WHERE APVR.APV_DOC_NO = HIST.APV_DOC_NO
		            AND APVR.APVR_PST_CD = HIST.APVR_PST_CD
		            AND APVR.APV_DH <> HIST.APV_DH)
		]]>
	</select>

   	<update id="BADFRE101MStepCmptUpdate" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE101MStepCmptUpdate */
        UPDATE TBBADFRE101M
            SET
            FNL_MDF_DH = SYSDATE
            ,STEP_CMPT_YN = #{stepCmptYn}
            <if test='stepCmptYn == "Y"'>
                ,STEP_CMPT_DH = SYSDATE
            </if>
            ,FNL_USR_ID = #{fnlUsrId}
            ,FNL_DEAL_DPT_CD =#{fnlDealDptCd}
          WHERE (ACP_YR, ACP_DVSN_CD, ACP_SRNO) 
             IN (SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO 
                   FROM TBBADFRE012M B 
                  WHERE 1 = 1
                    AND ACP_YR	    = #{acpYr}
                    AND ACP_DVSN_CD = #{acpDvsnCd}
                    AND ACP_SRNO    = #{acpSrno}
                  )
              AND ACP_STEP_CD       = #{acpStepCd}
    </update>

	<select id="BADFRE102MCmptYnSelect" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE102MCmptYnSelect */
		SELECT CMPT_YN
		 FROM TBBADFRE102M
	    WHERE ACP_YR = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO = #{acpSrno}
           AND ACP_STEP_CD = #{acpStepCd}
           AND ACP_MAIN_STEP_ID  = #{acpMainStepId}
           AND ACP_MAIN_STEP_SNO   = #{acpMainStepSno}
	</select>

    <update id="BADFRE102MCmptYnUpdate" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE102MCmptYnUpdate */
        UPDATE TBBADFRE102M
            SET
            FNL_MDF_DH = SYSDATE
            ,CMPT_YN  = #{cmptYn}
            ,FNL_USR_ID = #{usrId}
            ,FNL_DEAL_DPT_CD =#{dptCd}
            WHERE ACP_YR = #{acpYr}
               AND ACP_DVSN_CD = #{acpDvsnCd}
               AND ACP_SRNO = #{acpSrno}
               AND ACP_STEP_CD = #{acpStepCd}
               AND ACP_MAIN_STEP_ID  = #{acpMainStepId}
    </update>
<!-- 시행법무협조일자  업데이트-->
    <update id="BADFRE113MEnfCprDtUpdate" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE113MEnfCprDtUpdate */
         UPDATE TBBADFRE113M
            SET
             ENF_JA_CPR_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
            ,FNL_MDF_DH = SYSDATE
            ,FNL_USR_ID = #{usrId}
            ,FNL_DEAL_DPT_CD = #{dptCd}
            WHERE ACP_YR = #{acpYr}
              AND ACP_DVSN_CD = #{acpDvsnCd}
              AND ACP_SRNO = #{acpSrno}
			  AND ENF_JA_CPR_DT IS NULL
    </update>
    
	<!-- 템플릿 문서 ID 가져오기 -->
	<select id="FDMADM002MDocIdSelect" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.FDMADM002MDocIdSelect */
		SELECT DOC_ID
		 FROM TBFDMADM002M
		WHERE AUD_DOC_CD = #{acpDocCd}
		<if test='dtilAudDocNo != null and dtilAudDocNo != ""'>
           AND DTIL_AUD_DOC_NO   = #{dtilAudDocNo}
        </if>
	</select>

	<!-- 보고서코드 조회 -->
	<select id="BADFRE112MgInfoSelect" parameterType="paramMap" resultType="egovMap">
		 /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE112MgInfoSelect */
        <![CDATA[
            SELECT 
                 NVL(T1.TIT_NM, DECODE(#{acpDvsnCd},'1','심사청구','재심의청구')) AS TIT_NM,
                 (CASE WHEN T1.MG_ACP_YR IS NULL THEN ''
                          WHEN T1.MG_DIV_CD = '10' THEN '병합(' || (SELECT COUNT(MG_ACP_YR)
                                                                                FROM TBBADFRE012M
                                                              				   WHERE MG_ACP_YR = T1.MG_ACP_YR
                                                                                  AND MG_ACP_DVSN_CD = T1.MG_ACP_DVSN_CD
                                                                                  AND MG_ACP_SRNO = T1.MG_ACP_SRNO) || ')'
                          WHEN T1.MG_DIV_CD = '20' THEN '병행(' || (SELECT COUNT(MG_ACP_YR)
                                                                                FROM TBBADFRE012M
                                                                               WHERE MG_ACP_YR = T1.MG_ACP_YR
                                                                                  AND MG_ACP_DVSN_CD = T1.MG_ACP_DVSN_CD
                                                                                  AND MG_ACP_SRNO = T1.MG_ACP_SRNO) || ')'
                  ELSE '병합(' || (SELECT COUNT(D.MG_ACP_YR)
                                     FROM TBBADFRE012M D
                                    WHERE D.MG_ACP_YR = T1.MG_ACP_YR
                                       AND D.MG_ACP_DVSN_CD = T1.MG_ACP_DVSN_CD
                                       AND D.MG_ACP_SRNO = T1.MG_ACP_SRNO
                                       AND D.MG_DPT_CD = T1.MG_DPT_CD) || ')' END) AS MG_COUNT
                 ,(SELECT COUNT(MG_ACP_YR)
                    FROM TBBADFRE012M
 				  WHERE MG_ACP_YR = T1.MG_ACP_YR
                     AND MG_ACP_DVSN_CD = T1.MG_ACP_DVSN_CD
                     AND MG_ACP_SRNO = T1.MG_ACP_SRNO) AS MG_CNT
                 ,CASE WHEN T1.MG_DIV_CD = '10' THEN '병합'
				 	     WHEN T1.MG_DIV_CD = '20' THEN '병행'
				  ELSE ''
				  END AS MG_DIV_NM /* 병합병행구분명 */
                
              FROM  TBBADFRE012M T1
                     ,  TBBADFRE013D T3
             WHERE  1=1
               AND  T1.ACP_YR         = T3.ACP_YR(+)
               AND  T1.ACP_DVSN_CD    = T3.ACP_DVSN_CD(+)
               AND  T1.ACP_SRNO       = T3.ACP_SRNO(+)
	 ]]>
               AND  T1.ACP_YR         = #{acpYr}
               AND  T1.ACP_DVSN_CD    = #{acpDvsnCd}
               AND  T1.ACP_SRNO       = #{acpSrno}
	</select>
	
	<select id="BADFRE103MRprtCdSelect" parameterType="paramMap" resultType="egovMap">
		 /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MRprtCdSelect */
        SELECT  ACP_YR
                , ACP_DVSN_CD
                , ACP_SRNO
                , DOC_ID
                , RPRT_CD /* 보고서코드 */
                , ACP_STEP_CD /* 단계코드 */
                , APV_RQS_ID /* 결재요청ID */
                , APV_STA_CD
                , REF_ID
		 FROM TBBADFRE103M
        WHERE ACP_YR = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO = #{acpSrno}
           AND ACP_STEP_CD = #{acpStepCd}
           AND DOC_ID = #{docId}
	</select>
	
	<!-- 기안자 정보 조회 -->
	<select id="BADFRE103getApprSbmInfo" parameterType="paramMap" resultType="egovMap">
		 /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103getApprSbmInfo */
        SELECT USR.USR_ID AS USER_ID,
		       USR.USR_NAM AS USER_NM,
		       USR.DPT_CD AS DEPT_CD,
		       (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = USR.DPT_CD) AS DEPT_NM,
		       USR.CNB
		  FROM TBDCMACM022L APPR
		     , TBDCMACM001M USR
		 WHERE APPR.SBM_CNB = USR.CNB
		   AND APPR.APV_DOC_NO = #{apvRqsId}
	</select>
	

	<!-- 결재요청ID 업데이트 -->
	<update id="BADFRE103MApvRqsIdUpdate" parameterType="paramMap">
		 /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MApvRqsIdUpdate */
        UPDATE TBBADFRE103M
            SET APV_RQS_ID = #{apvRqsId} /* 결재요청ID */
                ,APV_STA_CD = DECODE(#{apvStaCd}, '20', DECODE(#{rApvSno},0,'20',1,'20','25') , #{apvStaCd}) /* 결재상태코드 */
                ,FNL_MDF_DH = SYSDATE
                ,FNL_USR_ID = #{fnlUsrId}
                ,FNL_DEAL_DPT_CD =#{fnlDealDptCd}
            WHERE ACP_YR = #{acpYr}
               AND ACP_DVSN_CD = #{acpDvsnCd}
               AND ACP_SRNO = #{acpSrno}
               AND ACP_STEP_CD = #{acpStepCd}
               AND DOC_ID = #{docId}
	</update>

	<!-- 결재요청 ID 조건으로 문서함조회 -->
	<select id="BADFRE103MParentKeySelect" parameterType="String" resultType="egovMap">
		 /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MParentKeySelect */
        SELECT ACP_YR /* 접수년도 */
                , ACP_DVSN_CD /* 접수구분 */
                , ACP_SRNO /* 접수번호 */
                , ACP_STEP_CD /* 단계코드 */
                , DOC_ID /* 문서ID */
		 FROM TBBADFRE103M
        WHERE APV_RQS_ID = #{apvRqsId} /* 결재요청ID */
	</select>

	<!-- 결재정보 저장 -->
	<insert id="BADFRE109MInsert" parameterType="paramMap">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE109MInsert */
		<![CDATA[
		INSERT INTO	TBBADFRE109M
							(	 APV_RQS_ID        /* 결재요청ID */
								,ACP_YR              /* 접수년도 */
								,ACP_DVSN_CD     /* 접수구분코드 */
								,ACP_SRNO          /* 접수번호 */
								,ACP_STEP_CD       /* 단계코드 */
								,DOC_ID              /* 문서ID */
								,APV_DVSN_CD     /* 결재구분코드 */
								,APV_DOC_DVSN_CD /* 결재문서구분코드 */
								,SORT_SNO         /* 정렬순번 */
								,FRT_USR_ID        /* 최초사용자ID */
								,FNL_USR_ID        /* 최종사용자ID */
								,FNL_DEAL_DPT_CD/* 최종거래부서코드 */
								,FNL_MNU_ID       /* 최종메뉴ID */
								,FRT_REGI_DH       /* 최초등록일시 */
								,FNL_MDF_DH       /* 최종수정일시 */
							)
					VALUES	(
					             #{apvRqsId}
								,#{acpYr}
								,#{acpDvsnCd}
								,#{acpSrno}
								,#{acpStepCd}
								,#{docId}
								,#{apvDvsnCd}
								,#{apvDocDvsnCd}
								,#{sortSno}
								,#{frtUsrId}
								,#{fnlUsrId}
								,#{fnlDealDptCd}
								,#{fnlMnuId}
								,SYSDATE
								,SYSDATE
							)
		]]>
	</insert>
	
	<insert id="BADFRE111MSaveSendRvwRsqDoc" parameterType="paramMap">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE111MSaveSendRvwRsqDoc */
		<![CDATA[
			INSERT INTO TBBADFRE111M (ACP_YR,ACP_SRNO,ACP_STEP_CD,ACP_DVSN_CD
				,DOC_ID,SR_DOC_SNO,ACP_KND_CD,ACP_GRN_NO,RPRT_NM,RPRT_CD,
				LINK_URL,DOC_STA_CD,SND_DPT_CD,SNDR_ID,SND_DH,RCPT_DPT_CD,
				RCNT_ID,RCPT_DH,DOC_KND_CD,REF_ID,REF_DY,SORT_SNO,
				FRT_USR_ID,FNL_USR_ID,FNL_DEAL_DPT_CD,FNL_MNU_ID,FRT_REGI_DH,FNL_MDF_DH)
			VALUES (#{acpYr},#{acpSrno},#{acpStepCd},#{acpDvsnCd},
				#{docId}, (SELECT 
									LPAD(NVL(MAX(TO_NUMBER(SR_DOC_SNO)),0)+1,3,0) 
								 FROM TBBADFRE111M 
								 WHERE 
										ACP_YR = #{acpYr} 
								 AND ACP_SRNO = #{acpSrno}
								 AND ACP_DVSN_Cd = #{acpDvsnCd}
								 AND ACP_STEP_CD =#{acpStepCd}
								 AND DOC_ID = #{docId} ),
				#{acpKndCd},#{acpGbnNo},#{rprtNm},#{rprtCd},
				#{linkUrl},'10',#{dptCd},#{usrId},SYSDATE,'510000',
				NULL,NULL,NULL,#{refId},#{refDy},(SELECT 
									LPAD(NVL(MAX(TO_NUMBER(SR_DOC_SNO)),0)+1,3,0) 
								 FROM TBBADFRE111M 
								 WHERE 
										ACP_YR = #{acpYr} 
								 AND ACP_SRNO = #{acpSrno}
								 AND ACP_DVSN_CD = #{acpDvsnCd}
								 AND ACP_STEP_CD =#{acpStepCd}
								 AND DOC_ID = #{docId} ),
				#{usrId},#{usrId},#{dptCd},decode(#{acpStepCd},'E1030','BADFRE319E','BADFRE313E'),SYSDATE,SYSDATE)
		]]>
	</insert>
	
	<insert id="BADFRE112MInfoInsert" parameterType="paramMap">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE112MInfoInsert */
		<![CDATA[
        INSERT INTO TBBADFRE112M(
                                 ACP_YR,
                                 ACP_DVSN_CD,
                                 ACP_SRNO,
                                 TIT_NM,
                                 SBCN_TRTM_REQ_DT,
                                 SHARE_YN,
                                 FRT_USR_ID,
                                 FNL_USR_ID,
                                 FNL_DEAL_DPT_CD,
                                 FNL_MNU_ID,
                                 FRT_REGI_DH,
                                 FNL_MDF_DH)
                          VALUES(#{acpYr},
                                 #{acpDvsnCd},
                                 #{acpSrno},
                                 #{titNm},
                                 TO_CHAR(SYSDATE,'YYYYMMDD'),
                                 'N',
                                 #{fnlUsrId},
                                 #{fnlUsrId},
                                 #{fnlDealDptCd},
                                 #{menuId},
                                 SYSDATE,
                                 SYSDATE)
        ]]>
	</insert>
	
	
	<insert id="BADFRE112DInfoInsert" parameterType="paramMap">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE112DInfoInsert */
		<![CDATA[
        INSERT INTO TBBADFRE112D(
        						ACP_YR,
        						ACP_DVSN_CD,
        						ACP_SRNO,
        						SBCN_TRTM_DTL_SNO,
        						DOC_ID,
        						SORT_SNO,
        						FRT_USR_ID,
        						FNL_USR_ID,
        						FNL_DEAL_DPT_CD,
        						FNL_MNU_ID,
								FRT_REGI_DH,
								FNL_MDF_DH,
								REGI_NO,
              					RMK_SBJ)
                         VALUES(#{acpYr},
                                   #{acpDvsnCd},
                                   #{acpSrno},
                                   (SELECT LPAD(NVL(MAX(TO_NUMBER(SBCN_TRTM_DTL_SNO)),0)+1,3,0)
                                     FROM TBBADFRE112D
                                    WHERE ACP_YR = #{acpYr}
                                       AND ACP_DVSN_CD = #{acpDvsnCd}
                                       AND ACP_SRNO = #{acpSrno} ),
                                   (
                                   		SELECT  B.DOC_ID
										 FROM TBBADFRE012M A
												 ,TBBADFRE103M B
										WHERE A.ACP_YR = B.ACP_YR
										   AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
										   AND A.ACP_SRNO = B.ACP_SRNO
										   AND A.ACP_YR = #{acpYr}
										   AND A.ACP_DVSN_CD = #{acpDvsnCd}
										   AND A.ACP_SRNO = #{acpSrno}
										   AND B.ACP_STEP_CD = #{acpStepCd}
										   AND B.RPRT_CD = #{rprtCd}
                                   ),
                                   (SELECT LPAD(NVL(MAX(TO_NUMBER(SBCN_TRTM_DTL_SNO)),0)+1,3,0)
                                     FROM TBBADFRE112D
                                    WHERE ACP_YR = #{acpYr}
                                       AND ACP_DVSN_CD = #{acpDvsnCd}
                                       AND ACP_SRNO = #{acpSrno} ),
                                   #{fnlUsrId},
                                   #{fnlUsrId},
                                   #{fnlDealDptCd},
                                   #{menuId},
                                   SYSDATE,
                                   SYSDATE,
                                   NVL(#{regiNo}, (SELECT REGI_NO 
                                                   FROM TBBADFRE112M WHERE ACP_YR = #{acpYr}
                                                   AND ACP_DVSN_CD = #{acpDvsnCd}
                                       AND ACP_SRNO = #{acpSrno}
                                   )),
                                   NVL(#{rmkSbj}, (SELECT RMK_SBJ 
                                                   FROM TBBADFRE112M WHERE ACP_YR = #{acpYr}
                                                   AND ACP_DVSN_CD = #{acpDvsnCd}
                                       AND ACP_SRNO = #{acpSrno}
                                   ))
                                   )
        ]]>
	</insert>
	

	<!-- 결재정보 삭제 -->
	<delete id="BADFRE109MDelete" parameterType="paramMap">
    	/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE109MDelete*/
    	DELETE FROM TBBADFRE109M
        WHERE APV_RQS_ID = #{apvRqsId}
           AND ACP_YR = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO = #{acpSrno}
           AND ACP_STEP_CD = #{acpStepCd}
           AND DOC_ID = #{docId}
    </delete>

    <select id="selectSendDocInfo" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectSendDocInfo */
        <![CDATA[
            SELECT
                ACP_YR
                ,ACP_DVSN_CD
                ,ACP_SRNO
                ,ACP_STEP_CD
                ,DOC_ID
                ,ACP_KND_CD
                ,ACP_GRN_NO
                ,RPRT_NM
                ,RPRT_CD
                ,LINK_URL
                ,ACP_RPRT_DVSN_CD
                ,DOC_KND_CD
                ,REF_ID
                ,REF_DY
            FROM TBBADFRE103M
            WHERE ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO = #{acpSrno}
            AND ACP_STEP_CD = #{acpStepCd}
            AND DOC_ID = #{docId}
        ]]>
    </select>
    
    <select id="selectSendDocEtcInfo" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectSendDocEtcInfo */
        <![CDATA[
            SELECT
                ACP_YR
                ,ACP_DVSN_CD
                ,ACP_SRNO
                ,ACP_STEP_CD
                ,DOC_ID
                ,ACP_KND_CD
                ,ACP_GRN_NO
                ,RPRT_NM
                ,RPRT_CD
                ,LINK_URL
                ,ACP_RPRT_DVSN_CD
                ,DOC_KND_CD
                ,REF_ID
                ,REF_DY
            FROM TBBADFRE103M
            WHERE ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO = #{acpSrno}
            AND ACP_STEP_CD = #{acpStepCd}
            AND REF_ID = #{refId}
            AND RPRT_CD = DECODE(#{rprtCd},'D10300600','D10300610','D10301100','D10301110','E10300300','E10300310','E10500600','E10500610')
        ]]>
    </select>
    
    <select id="selectSendDocCapInfo" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectSendDocCapInfo */
        <![CDATA[
            SELECT
                ACP_YR
                ,ACP_DVSN_CD
                ,ACP_SRNO
                ,ACP_STEP_CD
                ,DOC_ID
                ,ACP_KND_CD
                ,ACP_GRN_NO
                ,RPRT_NM
                ,RPRT_CD
                ,LINK_URL
                ,ACP_RPRT_DVSN_CD
                ,DOC_KND_CD
                ,REF_ID
                ,REF_DY
            FROM TBBADFRE103M
            WHERE ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO = #{acpSrno}
            AND ACP_STEP_CD = #{acpStepCd}
            AND REF_ID = #{refId}
            AND RPRT_CD = DECODE(#{rprtCd},'D10300600','D10300620','D10301100','D10301120','E10300300','E10300320','E10500600','E10500620')
        ]]>
    </select>

	<!-- 문서함 발신 등록 -->
	<insert id="BADFRE111MInsert" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE111MInsert*/
        <![CDATA[
            INSERT INTO TBBADFRE111M (
                   ACP_YR
                  ,ACP_DVSN_CD
                  ,ACP_SRNO
                  ,ACP_STEP_CD
                  ,DOC_ID
                  ,SR_DOC_SNO
                  ,ACP_KND_CD
                  ,ACP_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,DOC_STA_CD
                  ,SND_DPT_CD
                  ,SNDR_ID
                  ,SND_DH
                  ,RCPT_DPT_CD
                  ,RCNT_ID
                  ,RCPT_DH
                  ,ACP_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH)
            VALUES (
                   #{acpYr}
                   ,#{acpDvsnCd}
                   ,#{acpSrno}
                   ,#{acpStepCd}
                   ,#{docId}
                   ,(SELECT LPAD(NVL(MAX(TO_NUMBER(SR_DOC_SNO)),0)+1,3,0)
                       FROM TBBADFRE111M
                      WHERE ACP_YR = #{acpYr}
                        AND ACP_DVSN_CD = #{acpDvsnCd}
                        AND ACP_SRNO =#{acpSrno}
                        AND ACP_STEP_CD = #{acpStepCd}
                        AND DOC_ID = #{docId} )
                   ,#{acpKndCd}
                   ,#{acpGrnNo}
                   ,#{rprtNm}
                   ,#{rprtCd}
                   ,#{linkUrl}
                   ,'10'
                   ,#{dptCd}
                   ,#{usrId}
                   ,SYSDATE
                   ,#{rcptDptCd}
                   ,NULL
                   ,NULL
                   ,#{acpRprtDvsnCd}
                   ,#{docKndCd}
                   ,#{refId}
                   ,#{refDy}
                   ,(SELECT LPAD(NVL(MAX(TO_NUMBER(SR_DOC_SNO)),0)+1,3,0)
                       FROM TBBADFRE111M
                       WHERE ACP_YR = #{acpYr}
                        AND ACP_DVSN_CD = #{acpDvsnCd}
                        AND ACP_SRNO =#{acpSrno}
                        AND ACP_STEP_CD = #{acpStepCd}
                        AND DOC_ID = #{docId} )
                   ,#{frtUsrId}
                   ,#{fnlUsrId}
                   ,#{fnlDealDptCd}
                   ,'BADFRE313E'
                   ,SYSDATE
                   ,SYSDATE)
        ]]>
    </insert>
    
    <!-- 문서함 발신 등록 -->
	<insert id="BADFRE111MEtcInsert" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE111MEtcInsert*/
        <![CDATA[
            INSERT INTO TBBADFRE111M (
                   ACP_YR
                  ,ACP_DVSN_CD
                  ,ACP_SRNO
                  ,ACP_STEP_CD
                  ,DOC_ID
                  ,SR_DOC_SNO
                  ,ACP_KND_CD
                  ,ACP_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,DOC_STA_CD
                  ,SND_DPT_CD
                  ,SNDR_ID
                  ,SND_DH
                  ,RCPT_DPT_CD
                  ,RCNT_ID
                  ,RCPT_DH
                  ,ACP_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH)
            VALUES (
                   #{acpYr}
                   ,#{acpDvsnCd}
                   ,#{acpSrno}
                   ,#{acpStepCd}
                   ,#{docId}
                   ,(SELECT LPAD(NVL(MAX(TO_NUMBER(SR_DOC_SNO)),0)+1,3,0)
                       FROM TBBADFRE111M
                      WHERE ACP_YR = #{acpYr}
                        AND ACP_DVSN_CD = #{acpDvsnCd}
                        AND ACP_SRNO =#{acpSrno}
                        AND ACP_STEP_CD = #{acpStepCd}
                        AND DOC_ID = #{docId} )
                   ,#{acpKndCd}
                   ,#{acpGrnNo}
                   ,#{rprtNm}
                   ,#{rprtCd}
                   ,#{linkUrl}
                   ,'10'
                   ,#{dptCd}
                   ,#{usrId}
                   ,SYSDATE
                   ,#{rcptDptCd}
                   ,NULL
                   ,NULL
                   ,#{acpRprtDvsnCd}
                   ,#{docKndCd}
                   ,#{refId}
                   ,#{refDy}
                   ,(SELECT LPAD(NVL(MAX(TO_NUMBER(SR_DOC_SNO)),0)+1,3,0)
                       FROM TBBADFRE111M
                       WHERE ACP_YR = #{acpYr}
                        AND ACP_DVSN_CD = #{acpDvsnCd}
                        AND ACP_SRNO =#{acpSrno}
                        AND ACP_STEP_CD = #{acpStepCd}
                        AND DOC_ID = #{docId} )
                   ,#{frtUsrId}
                   ,#{fnlUsrId}
                   ,#{fnlDealDptCd}
                   ,'BADFRE313E'
                   ,SYSDATE
                   ,SYSDATE)
        ]]>
    </insert>

	<!-- 문서함 발신,수신 조회 -->
	<select id="BADFRE111MSelect" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE111MSelect */
        SELECT
                  ACP_YR
                , ACP_DVSN_CD
                , ACP_SRNO
                , ACP_STEP_CD
                , DOC_ID
                , SR_DOC_SNO
                , ACP_GRN_NO
                , RPRT_NM
                , RPRT_CD
                , DOC_STA_CD
                , F_CODE_NM('1000780',DOC_STA_CD) DOC_STA_NM
                , SND_DPT_CD
                , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = SND_DPT_CD) SND_DPT_NM
                , to_char(SND_DH, 'YYYY-MM-DD') AS SND_DH
                , RCPT_DPT_CD
                , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = RCPT_DPT_CD) RCPT_DPT_NM
                , to_char(RCPT_DH, 'YYYY-MM-DD') AS RCPT_DH
                , DOC_KND_CD
                , REF_ID
                , F_OPEN_EDIT(LINK_URL) AS DOC_TYPE
            FROM TBBADFRE111M
            WHERE 1=1
            <if test='acpYr != null and acpYr != ""'>
            AND ACP_YR = #{acpYr}
            </if>
            <if test='acpDvsnCd != null and acpDvsnCd != ""'>
            AND ACP_DVSN_CD = #{acpDvsnCd}
            </if>
            <if test='mgAcpYr != null and mgAcpYr != ""'>
            AND ACP_YR = #{mgAcpYr}
            </if>
            <if test='mgAcpDvsnCd != null and mgAcpDvsnCd != ""'>
            AND ACP_DVSN_CD = #{mgAcpDvsnCd}
            </if>
           <if test='mgDivCd == "" or mgDivCd == null'>
	        AND ACP_SRNO = #{acpSrno}
	       </if>
	       <if test='mgDivCd == "10" or mgDivCd == "20"'>
	        AND ACP_SRNO IN (SELECT ACP_SRNO
	                                   FROM TBBADFRE012M
	                                  WHERE MG_ACP_YR = #{acpYr}
	                                     AND MG_ACP_DVSN_CD = #{acpDvsnCd}
	                                     AND MG_ACP_SRNO = #{acpSrno})
	       </if>
            <if test='rprtCd != null and rprtCd != ""'>
            AND RPRT_CD = #{rprtCd}
            </if>
            <if test='acpStepCd == "D1040" or acpStepCd == "E1060"'>
            AND RPRT_CD IN ('D10400300', 'D10400400', 'E10600200')
            </if>
            <if test='(acpStepCd == "D1030" and type == "1") or (acpStepCd == "E1050" and type == "1")'>
            AND RPRT_CD IN ('D10300200', 'E10500200')
            </if>
            <if test='(acpStepCd == "D1030" and type == "3") or (acpStepCd == "E1050" and type == "3")'>
            AND RPRT_CD IN ('E10500600', 'E10500610', 'E10500620', 'D10301100', 'D10301110', 'D10301120')
            </if>
            <if test='acpStepCd != "D1040" and acpStepCd != "E1060"'>
            	<if test='rprtCdList != null and rprtCdList != ""'>
	            	AND RPRT_CD IN
					<foreach item="item" index="index" collection="rprtCdList" open="(" close=")" separator=",">
				            #{item}
				    </foreach>
			    </if>
            </if>
            <if test='acpStepCd == "E1030"'>
            AND RPRT_CD IN ('E10300150')
            </if>
            <if test='acpStepCd == "D1020" or acpStepCd == "E1040"'>
            AND RPRT_CD IN ('D10200100','E10400100')
            AND RCPT_DPT_CD = '160200'
            </if>
    </select>
    
    <!-- 문서함 발신,수신 조회 소위원회 법무 수신-->
	<select id="BADFRE111MSoSelect" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE111MSoSelect */
        SELECT
                  ACP_YR
                , ACP_DVSN_CD
                , ACP_SRNO
                , ACP_STEP_CD
                , DOC_ID
                , SR_DOC_SNO
                , ACP_GRN_NO
                , RPRT_NM
                , RPRT_CD
                , DOC_STA_CD
                , F_CODE_NM('1000780',DOC_STA_CD) AS DOC_STA_NM
                , SND_DPT_CD
                , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = SND_DPT_CD) AS SND_DPT_NM
                , to_char(SND_DH, 'YYYY-MM-DD') AS SND_DH
                , RCPT_DPT_CD
                , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = RCPT_DPT_CD) AS RCPT_DPT_NM
                , to_char(RCPT_DH, 'YYYY-MM-DD') AS RCPT_DH
                , DOC_KND_CD
                , REF_ID
                , F_OPEN_EDIT(LINK_URL) AS DOC_TYPE
            FROM TBBADFRE111M
            WHERE 1=1
            AND ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO=#{acpSrno}
            AND RPRT_CD NOT IN ('D10300600','E10300300')
            AND REF_ID = TO_CHAR(#{sbmtSeq})
            
    </select>
    
    <!-- 문서함 발신,수신 조회 (소위원회 결과보고서) -->
	<select id="BADFRE111MfinalSelect" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE111MfinalSelect */
        SELECT
                  ACP_YR
                , ACP_DVSN_CD
                , ACP_SRNO
                , ACP_STEP_CD
                , DOC_ID
                , SR_DOC_SNO
                , ACP_GRN_NO
                , RPRT_NM
                , RPRT_CD
                , DOC_STA_CD
                , F_CODE_NM('1000780',DOC_STA_CD) DOC_STA_NM
                , SND_DPT_CD
                , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = SND_DPT_CD) SND_DPT_NM
                , to_char(SND_DH, 'YYYY-MM-DD') AS SND_DH
                , RCPT_DPT_CD
                , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = RCPT_DPT_CD) RCPT_DPT_NM
                , to_char(RCPT_DH, 'YYYY-MM-DD') AS RCPT_DH
                , DOC_KND_CD
                , REF_ID
            FROM TBBADFRE111M
            WHERE 1=1
            AND ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_STEP_CD = #{acpStepCd}
            AND RPRT_CD = #{rprtCd}
            AND refId = #{sbmtSeq}
    </select>
    
    <!-- 문서함 발신,수신 조회 (소위원회)-->
	<select id="BADFRE111MSelectMainSno" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE111MSelectMainSno */
        SELECT
                  ACP_YR
                , ACP_DVSN_CD
                , ACP_SRNO
                , ACP_STEP_CD
                , DOC_ID
                , SR_DOC_SNO
                , ACP_GRN_NO
                , RPRT_NM
                , RPRT_CD
                , DOC_STA_CD
                , F_CODE_NM('1000780',DOC_STA_CD) DOC_STA_NM
                , SND_DPT_CD
                , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = SND_DPT_CD) SND_DPT_NM
                , to_char(SND_DH, 'YYYY-MM-DD') AS SND_DH
                , RCPT_DPT_CD
                , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = RCPT_DPT_CD) RCPT_DPT_NM
                , to_char(RCPT_DH, 'YYYY-MM-DD') AS RCPT_DH
                , DOC_KND_CD
                , REF_ID
            FROM TBBADFRE111M
            WHERE 1=1
            AND ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO = #{acpSrno}
			AND REF_ID = (SELECT 	DOC_ID 
						FROM 	TBBADFRE103M 
						WHERE 	1=1
								AND ACP_YR=#{acpYr}
								AND ACP_DVSN_CD=#{acpDvsnCd}
								AND ACP_SRNO=#{acpSrno}
								AND REF_ID=TO_CHAR(#{sbmtSeq})
								AND RPRT_CD IN (DECODE(#{acpDvsnCd},'1','D10300500','2','E10300200'))
						)
		    ORDER BY RPRT_CD
    </select>

	<update id="AEPAFU001SaveEAuditAttachFileInfo" parameterType="paramMap">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.AEPAFU001SaveEAuditAttachFileInfo */
		MERGE INTO TBAEPAFU001I
		    USING DUAL
			   ON (
				    APV_RQS_ID  = #{apvDocNo}
			  	   )
			WHEN MATCHED  THEN
				UPDATE
				SET		ATTACH_FILE_ID 	= #{newAttachFileId}
					   ,FNL_USR_ID  	= #{fnlUsrId}
				       ,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				       ,FNL_MNU_ID 		= #{fnlMnuId}
				       ,FNL_MDF_DH 		= SYSDATE
		    WHEN NOT MATCHED THEN
		        INSERT
				     ( APV_RQS_ID
				      ,ATTACH_FILE_ID
				      ,FRT_USR_ID
				      ,FNL_USR_ID
				      ,FNL_DEAL_DPT_CD
				      ,FNL_MNU_ID
				      ,FRT_REGI_DH
				      ,FNL_MDF_DH
				     )
				  VALUES
				     ( #{apvDocNo}					/* 결재문서코드 */
				      ,#{newAttachFileId}         /* ECM DOC_ID */
				      ,#{fnlUsrId}                 /* 최초사용자ID */
				      ,#{fnlUsrId}                 /* 최종사용자ID */
				      ,#{fnlDealDptCd}            /* 최종거래부서코드 */
				      ,#{fnlMnuId}                 /* 최종메뉴ID */
				      ,SYSDATE                      /* 최초등록일시 */
				      ,SYSDATE                      /* 최종수정일시 */
				     )
	</update>



























































































	<!-- 결재 후 처리 테스트를 하기 위해 결재요청ID 생성 -->
	<select id="ApvRqsIdCreate" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.ApvRqsIdCreate */
		SELECT TO_CHAR(SYSDATE,'yyyymmddhh24miss')||LPAD(NVL(MAX(SUBSTR(APV_DOC_NO,15,20)), 0) + 1, 6, 0) AS APV_DOC_NO
		 FROM TBDCMACM022L
	</select>

	<!-- 문서함 목록 -->
	<select id="BADFRE103MSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MSelect */
		SELECT ACP_YR || '-' || DECODE(ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || ACP_SRNO AS ACP_NO /* 분류번호 */
		         ,ACP_YR
		         ,ACP_DVSN_CD
		         ,ACP_SRNO
		         ,ACP_STEP_CD
		         ,RPRT_NM
		         ,DOC_ID
		         ,CASE WHEN APV_STA_CD = '10' THEN '작성중'
		                 WHEN APV_STA_CD = '20' THEN '결재요청'
		                 WHEN APV_STA_CD = '25' THEN '결재중'
		                 WHEN APV_STA_CD = '30' THEN '결재완료'
		          END AS APV_STA_NM
		 FROM TBBADFRE103M
	   WHERE ACP_YR = #{acpYr}
	      AND ACP_DVSN_CD = #{acpDvsnCd}
	      AND ACP_SRNO = #{acpSrno}
	</select>

	<!-- 문서함 테스트를 하기 위해 추가 -->
	<insert id="BADFRE103MInsert" parameterType="paramMap">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MInsert */
		<![CDATA[
		INSERT INTO	TBBADFRE103M
							(	 ACP_YR              /* 접수년도 */
								,ACP_DVSN_CD      /* 접수구분 */
								,ACP_SRNO          /* 접수번호 */
								,ACP_STEP_CD       /* 단계코드 */
								,DOC_ID              /* 문서ID */
								,RPRT_CD            /* 보고서코드 */
								,RPRT_NM           /* 보고서명 */
								,APV_STA_CD	       /* 결재상태코드 */
								,APV_WAY_CD      /* 결재타입 */
								,SND_DOC_YN      /* 송신문서여부 */
								,APV_RQS_ID       /* 결재요청ID */
								,NECES_YN         /* 필수여부 */
								,CON_PGM_CD     /* 연계프로그램코드 */
								,FRT_USR_ID        /* 최초사용자ID */
								,FNL_USR_ID        /* 최종사용자ID */
								,FNL_DEAL_DPT_CD/* 최종거래부서코드 */
								,FNL_MNU_ID       /* 최종메뉴ID */
								,FRT_REGI_DH       /* 최초등록일시 */
								,FNL_MDF_DH       /* 최종수정일시 */
							)
					VALUES	(
								 #{acpYr}
								,#{acpDvsnCd}
								,#{acpSrno}
								,#{acpStepCd}
								,#{docId}
								,#{rprtCd}
								,#{rprtNm}
								,#{apvStaCd}
								,#{apvWayCd}
								,#{sndDocYn}
								,'20150313160533014414'
								,'Y'
								,'10'
								,#{frtUsrId}
								,#{fnlUsrId}
								,#{fnlDealDptCd}
								,#{fnlMnuId}
								,SYSDATE
								,SYSDATE
							)
		]]>
	</insert>
    
    <select id="selectBadfreChfInfo" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectBadfreChfInfo */
        <![CDATA[
             SELECT ST1.CHF_CMTR_CNB AS CHF_CMTR_ID,
			        DECODE(ST1.CHF_CMTR_CNB, NULL, '', F_USR_INFO (ST1.CHF_CMTR_CNB, '2') || DECODE(DECODE(ST1.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR5_CNB, NULL, 0, 1),
			        0,
			        '',
			        ' 외 ' || TO_CHAR(DECODE(ST1.CHF_CMTR1_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR2_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR3_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR4_CNB, NULL, 0, 1) + DECODE(ST1.CHF_CMTR5_CNB, NULL, 0, 1) ) ) 
			        ) AS CHF_CMTR_NM
			   FROM TBBADDED116L ST1
			   INNER JOIN TBBADFRE112D ST2 ON (ST2.ACP_YR = ST1.AUD_YR 
                                               AND ST2.ACP_DVSN_CD = ST1.TASK_DVSN_CD 
                                               AND ST2.ACP_SRNO = ST1.AUD_NO 
                                               AND ST2.DOC_ID = ST1.DOC_ID
                                               AND ST2.SBCN_TRTM_DTL_SNO = (SELECT MAX(SBCN_TRTM_DTL_SNO) 
                                                                            FROM TBBADFRE112D 
                                                                            WHERE ACP_YR = ST1.AUD_YR 
                                                                            AND ACP_DVSN_CD = ST1.TASK_DVSN_CD 
                                                                            AND ACP_SRNO = ST1.AUD_NO 
                                                                            ))
			  WHERE ST1.AUD_YR = #{acpYr}
			    AND ST1.AUD_NO = #{acpSrno}
			    AND ST1.TASK_DVSN_CD = #{acpDvsnCd}
			    AND ST1.SRNO = ( SELECT MAX(ST2.SRNO)
			                       FROM TBBADDED116L ST2
			                      WHERE ST2.AUD_YR = #{acpYr}
			                        AND ST2.AUD_NO = #{acpSrno}
			                        AND TASK_DVSN_CD = #{acpDvsnCd}) 
        ]]>
    </select>
    
	
    <!-- 심의안작성 체크(소위원회)-->
    <select id="selectCkDocInfo" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectCkDocInfo */
		SELECT
               'Y' as DOC_YN
            FROM TBBADFRE103M
            WHERE 1=1
            AND ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO = #{acpSrno}
			AND REF_ID = (SELECT 	DOC_ID 
						FROM 	TBBADFRE103M 
						WHERE 	1=1
								AND ACP_YR=#{acpYr}
								AND ACP_DVSN_CD=#{acpDvsnCd}
								AND ACP_SRNO=#{acpSrno}
								AND REF_ID=#{sbmtSeq}
						)
	</select>
		<!-- 시행일 업데이트 -->
	<update id="TBBADFRE013DEnfDtUpdate" parameterType="paramMap">
		 /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.TBBADFRE013DEnfDtUpdate */
        UPDATE TBBADFRE013D
           SET ENF_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
         WHERE ACP_YR = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO = #{acpSrno}
	</update>
	
	
	
	<update id="BADFRE103MUpdate" parameterType="paramMap">
		 /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MUpdate */
        UPDATE TBBADFRE103M
           SET SND_DOC_YN = 'Y'
         WHERE ACP_YR = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO = #{acpSrno}
           AND RPRT_CD = #{rprtCd}
           AND DOC_ID = #{docId}
           
	</update>
	
	    
    <!-- 결정일자 -->
    <update id="BADFRE012MDcsDtUpdate" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE012MDcsDtUpdate */
			UPDATE TBBADFRE012M
	            SET
	             DCS_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
	            ,FNL_MDF_DH = SYSDATE
	            ,FNL_USR_ID = #{usrId}
	            ,FNL_DEAL_DPT_CD = #{dptCd}
            WHERE (ACP_YR, ACP_DVSN_CD, ACP_SRNO) IN ( SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO 
                                                       FROM TBBADFRE012M 
                                                       WHERE (MG_ACP_YR = #{acpYr}
                                                       AND MG_ACP_DVSN_CD = #{acpDvsnCd}
                                                       AND MG_ACP_SRNO = #{acpSrno}
                                                       AND MG_DIV_CD = '10') OR 
                                                       (ACP_YR = #{acpYr}
                                                       AND ACP_DVSN_CD = #{acpDvsnCd}
                                                       AND ACP_SRNO = #{acpSrno}
                                                       AND (MG_DIV_CD IS NULL OR MG_DIV_CD = '20')))
            AND DCS_DT IS NULL
    </update>
    
    <!-- 시행일자 -->
     <update id="BADFRE013DEnfDtUpdate" parameterType="paramMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE013DEnfDtUpdate */
			UPDATE TBBADFRE013D
			          SET
			           ENF_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
			          ,FNL_MDF_DH = SYSDATE
			          ,FNL_USR_ID = #{usrId}
			          ,FNL_DEAL_DPT_CD = #{dptCd}
			         WHERE (ACP_YR, ACP_DVSN_CD, ACP_SRNO) IN ( SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO 
			                                                    FROM TBBADFRE012M 
			                                                    WHERE (MG_ACP_YR = #{acpYr}
			                                                    AND MG_ACP_DVSN_CD = #{acpDvsnCd}
			                                                    AND MG_ACP_SRNO = #{acpSrno}
			                                                    AND MG_DIV_CD = '10') OR 
			                                                    (ACP_YR = #{acpYr}
			                                                    AND ACP_DVSN_CD = #{acpDvsnCd}
			                                                    AND ACP_SRNO = #{acpSrno}
			                                                    AND (MG_DIV_CD IS NULL OR MG_DIV_CD = '20')))
			         AND ENF_DT IS NULL
	 </update>
	 
	 <update id="BADFRE013DSimsaEnfDtUpdate" parameterType="paramMap">
     /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE013DSimsaEnfDtUpdate */
			UPDATE TBBADFRE013D
			          SET
			           ENF_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
			          ,FNL_MDF_DH = SYSDATE
			          ,FNL_USR_ID = #{usrId}
			          ,FNL_DEAL_DPT_CD = #{dptCd}
			         WHERE (ACP_YR, ACP_DVSN_CD, ACP_SRNO) IN ( SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO 
			                                                    FROM TBBADFRE012M 
			                                                   WHERE (MG_ACP_YR = #{acpYr}
			                                                     AND MG_ACP_DVSN_CD = #{acpDvsnCd}
			                                                     AND MG_ACP_SRNO = #{acpSrno}
			                                                     AND MG_DIV_CD = '10') 
			                                                     OR (ACP_YR = #{acpYr}
					                                             AND ACP_DVSN_CD = #{acpDvsnCd}
					                                             AND ACP_SRNO IN (SELECT ACP_SRNO
					                                                                FROM TBBADFRE103M
					                                                               WHERE (ACP_YR, ACP_DVSN_CD, ACP_SRNO) IN ( SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO 
					                                                                                                            FROM TBBADFRE012M 
					                                                                                                           WHERE (MG_ACP_YR = #{acpYr}
					                                                                                                             AND MG_ACP_DVSN_CD = #{acpDvsnCd}
					                                                                                                             AND MG_ACP_SRNO = #{acpSrno}
					                                                                                                             AND MG_DIV_CD = '20')
					                                                                                                             
					                                                                AND RPRT_CD = 'D10400100')
					                                                             ) /* 병행은 최종결정서가 생성된 분류번호를 들고옴*/
					                                                 )
			                                                     
			                                                     
			                                                     OR (ACP_YR = #{acpYr}
			                                                     AND ACP_DVSN_CD = #{acpDvsnCd}
			                                                     AND ACP_SRNO = #{acpSrno}
			                                                     AND MG_DIV_CD IS NULL)
			                                                  )
			         AND ENF_DT IS NULL
	 </update>
	 
    <update id="updatePrcsList" parameterType="paramMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.updatePrcsList */
        <![CDATA[
        	UPDATE TBBADFRE101M 
			SET STEP_CMPT_YN = (CASE WHEN ACP_STEP_CD < #{acpStepCd} THEN 'Y' 
                                     WHEN ACP_STEP_CD = #{acpStepCd} THEN 'P' 
                                     ELSE '' END)
            	, FNL_MDF_DH = SYSDATE
            	, FNL_USR_ID = #{fnlUsrId}
            	, FNL_DEAL_DPT_CD = #{fnlDealDptCd}
            WHERE NECES_YN = 'Y'
            AND ACP_YR = #{acpYr}
            AND ACP_SRNO = #{acpSrno}
            AND ACP_DVSN_CD = #{acpDvsnCd}
        ]]>
    </update>
    
    <update id="BADFRE103MSndYnUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.BADFRE103MSndYnUpdate */
		   UPDATE TBBADFRE103M
		      SET 
		      	 SND_DOC_YN      ='Y', /* 심사청구의결종류코드 */
			     FNL_USR_ID     = #{fnlUsrId},  /*최종사용자ID*/
                 FNL_MDF_DH     = SYSDATE      /*최종수정일시*/
         WHERE (ACP_YR, ACP_DVSN_CD, ACP_SRNO) IN (
         		SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO 
         		FROM TBBADFRE012M B 
         		WHERE NVL(B.MG_ACP_YR, B.ACP_YR) = #{acpYr} AND NVL(B.MG_ACP_DVSN_CD, B.ACP_DVSN_CD) = #{acpDvsnCd} AND NVL(B.MG_ACP_SRNO, B.ACP_SRNO) = #{acpSrno})
		   AND RPRT_CD = #{rprtCd}
	</update>
	
	<select id="selectReceiveCptList" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectReceiveCptList*/
          SELECT B.DOC_ID,A.ACP_YR,A.ACP_DVSN_CD, A.ACP_SRNO
		  FROM (
		  	  SELECT ST1.ACP_YR,
		  	         ST1.ACP_SRNO,
		  	         ST1.ACP_DVSN_CD,
		             NVL(ST1.MG_DIV_CD,'') AS MG_DIV_CD ,
		             ST1.AUD_YR,
		             ST1.MG_ACP_YR,MG_ACP_SRNO,MG_ACP_DVSN_CD
		  	   FROM  TBBADFRE012M ST1    
		      ) A, TBBADFRE111M B
		WHERE A.ACP_YR = B.ACP_YR
		  AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		  AND A.ACP_SRNO = B.ACP_SRNO
		  AND NVL(A.MG_ACP_YR, A.ACP_YR) = #{acpYr} AND NVL(A.MG_ACP_DVSN_CD, A.ACP_DVSN_CD) = #{acpDvsnCd} AND NVL(A.MG_ACP_SRNO, A.ACP_SRNO) = #{acpSrno}
		  
		  AND B.DOC_STA_CD = '20' /*접수*/
		  AND B.RPRT_CD IN('D10300700','E10300400')
    </select>
    
    
    
    <insert id="BADDED116LCopy" parameterType="paramMap">
	    INSERT INTO TBBADDED116L (
	         SELECT 
	              AUD_YR
	              , AUD_NO
	              , TASK_DVSN_CD
	              , (SELECT MAX(SRNO)+1 FROM TBBADDED116L WHERE AUD_YR = #{acpYr} AND AUD_NO = #{acpSrno} AND TASK_DVSN_CD = #{acpDvsnCd}) AS SRNO
	              , CHF_CMTR_CNB
	              , CHF_CMTR1_CNB
	              , CHF_CMTR2_CNB
	              , CHF_CMTR3_CNB
	              , CHF_CMTR4_CNB
	              , CHF_CMTR5_CNB
	              , ALC_RMK
	              , ALC_USR_CNB
	              , ALC_DH
	              , FRT_USR_ID
	              , FNL_USR_ID
	              , FNL_DEAL_DPT_CD
	              , FNL_MNU_ID
	              , FRT_REGI_DH
	              , FNL_MDF_DH
	              , (SELECT  B.DOC_ID
										 FROM TBBADFRE012M A
												 ,TBBADFRE103M B
										WHERE A.ACP_YR = B.ACP_YR
										   AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
										   AND A.ACP_SRNO = B.ACP_SRNO
										   AND A.ACP_YR = #{acpYr}
										   AND A.ACP_DVSN_CD = #{acpDvsnCd}
										   AND A.ACP_SRNO = #{acpSrno}
										   AND B.ACP_STEP_CD = #{acpStepCd}
										   AND B.RPRT_CD = #{rprtCd})    AS DOC_ID
	              , MAIN_AUD_RPRT_YN
	         FROM TBBADDED116L
	         WHERE AUD_YR = #{acpYr}
	         AND AUD_NO = #{acpSrno}
	         AND TASK_DVSN_CD = #{acpDvsnCd}
	         AND SRNO = (SELECT MAX(SRNO) FROM TBBADDED116L WHERE AUD_YR = #{acpYr} AND AUD_NO = #{acpSrno} AND TASK_DVSN_CD = #{acpDvsnCd})
	    )
    </insert>
    
    
    <insert id="updateRefDyByBADFRE103M" parameterType="paramMap">
        UPDATE TBBADFRE103M SET REF_DY = TO_CHAR(SYSDATE, 'YYYYMMDD')
           WHERE 1=1
           AND ACP_YR = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO = #{acpSrno}
           AND ACP_STEP_CD = #{acpStepCd}
           AND DOC_ID = #{docId}
           AND APV_RQS_ID = #{apvRqsId}
    </insert>
    
    
    
    <select id="selectCommonPstCdOfApvUsr" parameterType="paramMap" resultType="String" >
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectCommonPstCdOfApvUsr*/
          SELECT (CASE WHEN COUNT(1) > 0 
                       THEN '' 
                       ELSE (SELECT USR_DFN_TXT_2
                               FROM TBDCMACM013C
                              WHERE CMM_CD_DVSN_CD = '1000855'
                                AND CD = (SELECT INN_RANK_CD 
                                            FROM TBDCMACM001M 
                                           WHERE CNB = #{rFnlApvCnb})) END) AS PST_CD
            FROM TBBADFRE111M 
           WHERE ACP_YR = #{acpYr}
             AND ACP_DVSN_CD = #{acpDvsnCd}
             AND ACP_SRNO = #{acpSrno}
             AND RPRT_CD IN ('D10200100','E10400100')
    </select>
    
    <insert id="copyAndSendDoc" parameterType="paramMap">
    /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.copyAndSendDoc*/
        INSERT INTO TBBADFRE111M (ACP_YR
                                , ACP_DVSN_CD
                                , ACP_SRNO
                                , ACP_STEP_CD
                                , DOC_ID
                                , SR_DOC_SNO
                                , ACP_KND_CD
                                , ACP_GRN_NO
                                , RPRT_NM
                                , RPRT_CD
                                , LINK_URL
                                , DOC_STA_CD
                                , SND_DPT_CD
                                , SNDR_ID
                                , SND_DH
                                , RCPT_DPT_CD
                                , RCNT_ID
                                , RCPT_DH
                                , ACP_RPRT_DVSN_CD
                                , DOC_KND_CD
                                , REF_ID
                                , REF_DY
                                , SORT_SNO
                                , FRT_USR_ID
                                , FNL_USR_ID
                                , FNL_DEAL_DPT_CD
                                , FNL_MNU_ID
                                , FRT_REGI_DH
                                , FNL_MDF_DH
                                , ORGN_DOC_ID
                                , SUPPLM_REQ) (
	         SELECT 
                  ACP_YR
                  , ACP_DVSN_CD
                  , ACP_SRNO
                  , ACP_STEP_CD
                  , #{copyDocId}
                  , (SELECT NVL(MAX(T1.SR_DOC_SNO),0)+1
                       FROM TBBADFRE111M T1 
                      WHERE T1.ACP_YR = #{acpYr} 
                        AND T1.ACP_DVSN_CD = #{acpDvsnCd} 
                        AND T1.ACP_SRNO = #{acpSrno} 
                        AND T1.ACP_STEP_CD = #{acpStepCd}
                        AND T1.DOC_ID = #{copyDocId}) AS SR_DOC_SNO
                  , ACP_KND_CD
                  , ACP_GRN_NO
                  , RPRT_NM
                  , RPRT_CD
                  , LINK_URL
                  , '20' AS DOC_STA_CD
                  , (SELECT T1.DPT_CD 
                       FROM TBBADFRE012M T1 
                      WHERE T1.ACP_YR = #{acpYr} 
                        AND T1.ACP_DVSN_CD = #{acpDvsnCd} 
                        AND T1.ACP_SRNO = #{acpSrno}) AS SND_DPT_CD
                  , FRT_USR_ID AS SNDR_ID
                  , SYSDATE AS SND_DH
                  , #{rcptDptCd}
                  , NULL AS RCNT_ID
                  , SYSDATE AS RCPT_DH
                  , ACP_RPRT_DVSN_CD
                  , DOC_KND_CD
                  , #{copyRefId} AS REF_ID
                  , REF_DY
                  , SORT_SNO
                  , FRT_USR_ID
                  , FNL_USR_ID
                  , FNL_DEAL_DPT_CD
                  , FNL_MNU_ID
                  , FRT_REGI_DH
                  , FNL_MDF_DH
                  , #{orgnDocId} AS ORGN_DOC_ID
                  , '' AS SUPPLM_REQ
	         FROM TBBADFRE103M
	        WHERE ACP_YR = #{acpYr} 
              AND ACP_DVSN_CD = #{acpDvsnCd} 
              AND ACP_SRNO = #{acpSrno} 
              AND ACP_STEP_CD = #{acpStepCd}
              AND DOC_ID = #{docId}
        )
    </insert>
    
    
    <select id="selectRcptUsrInfo" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selectRcptUsrInfo*/
        <![CDATA[
          SELECT USR_DFN_TXT_2 AS RCPT_USR_CNB
                  ,USR_DFN_TXT_3 AS RCPT_USR_CNT
         FROM TBDCMACM013C
        WHERE CMM_CD_DVSN_CD = '1000917'
          AND CD <> '000000000'
          AND USE_YN = 'Y'
          ]]>
    </select>
    
    
    
    <update id="deleteDocApvData" parameterType="paramMap">
    /* kr.go.bai.eip.dcm.acm.dao.BADFRE101Mapper.deleteDocApvData*/
    DECLARE
         BEGIN
            DELETE 
              FROM PTL_ORDER_NOTI
              WHERE seq in (SELECT SEQ
                          FROM PTL_ORDER_LIST
                         WHERE DOC_No  = #{apvRqsId}) 
            ;
            DELETE
              FROM PTL_ORDER_RECEIVE_LIST
             WHERE seq in (SELECT SEQ
                          FROM PTL_ORDER_LIST
                         WHERE DOC_No  = #{apvRqsId})
            ;
            DELETE
              from PTL_ORDER_LIST
             where seq in (SELECT SEQ
            			  FROM PTL_ORDER_LIST
            			 WHERE DOC_No  = #{apvRqsId})
            ;
            delete
              FROM TBBADFRE109M A
             WHERE A.APV_RQS_ID = #{apvRqsId}
            ;
            delete
              from TBDCMACM023H
             where apv_doc_no = #{apvRqsId}
             and apv_dvsn_cd in ('requestAudit5', 'requestAudit6')
             ; 
            delete
              from TBDCMACM022H
             where apv_doc_no = #{apvRqsId}
            and apv_dvsn_cd in ('requestAudit5', 'requestAudit6')
             ;
            delete
              from TBDCMACM023L
             where apv_doc_no = #{apvRqsId}
             ;
            delete
              from TBDCMACM022L
             where apv_doc_no = #{apvRqsId}
             ;
         END;
    </update>
    
    
    <update id="updateDmsRsnCd" parameterType="paramMap">
    /* kr.go.bai.eip.dcm.acm.dao.BADFRE101Mapper.updateDmsRsnCd*/
       UPDATE TBBADFRE013D
          SET DMS_RSN_CD = #{dmsRsnCd}
              , FNL_USR_ID     = #{fnlUsrId}      /*최종사용자ID*/
              , FNL_MDF_DH     = SYSDATE          /*최종수정일시*/
        WHERE (ACP_YR, ACP_DVSN_CD, ACP_SRNO) IN (SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO 
                                                    FROM TBBADFRE012M 
                                                   WHERE NVL(MG_ACP_YR, ACP_YR) = #{acpYr}
                                                     AND NVL(MG_ACP_DVSN_CD, ACP_DVSN_CD) = #{acpDvsnCd}
                                                     AND NVL(MG_ACP_SRNO, ACP_SRNO) = #{acpSrno})
    </update>
    
    
    <select id="referEntRsnSelect" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.referEntRsnSelect*/
          SELECT NVL(PRE_REFER_ENT, 'N') AS PRE_REFER_ENT
               , DECODE(PRE_REFER_ENT,'Y','', NVL(REFER_ENT, 'N')) AS REFER_ENT
               , REFER_ENT_RSN
            FROM TBBADFRE012M
           WHERE ACP_YR = #{acpYr} 
              AND ACP_DVSN_CD = #{acpDvsnCd} 
              AND ACP_SRNO = #{acpSrno} 
    </select>
    
    <select id="validFnRprt" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.validFnRprt */
        SELECT 
            MIN(NVL(APV_STA_CD,0)) AS APV_STA_CD
          FROM TBBADFRE103M
         WHERE ACP_YR  = #{acpYr}
           AND ACP_SRNO = #{acpSrno}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND RPRT_CD IN ('D10301100', 'D10301110', 'D10301120', 'E10500600', 'E10500610', 'E10500620')
    </select>
    
    <select id="selDcmNm"  parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE101Mapper.selDcmNm */
		SELECT LISTAGG(CD_NM, ', ') WITHIN GROUP (ORDER BY CD) AS VALUE
		  FROM TBDCMACM013C
		 WHERE CMM_CD_DVSN_CD = '1000810'
		   AND USR_DFN_TXT_1 = 'DCM'
		   AND CD NOT IN (SELECT DISTINCT(EVI_DCM_DVSN_CD)
		                    FROM TBBADFRE108D
		                   WHERE ACP_YR = #{acpYr}
		                     AND ACP_DVSN_CD = #{acpDvsnCd}
		                     AND ACP_SRNO = #{acpSrno})
	</select>
    
</mapper>
