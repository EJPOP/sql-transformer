<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.bad.ded.dao.BADDED021PMapper">
   
    <select id="selectGpcStlHisList" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.bad.ded.dao.BADDED021PMapper.selectGpcStlHisList */
        <![CDATA[
        SELECT CON_TRNSC_ID
		     , GPC_TRNSC_GRAM_NO
		     , CON_SRNO
		     , GPC_NO
		     , EXPN_CLU_DVSN_CD
		     , GPC_TSK_DVSN_CD
		     , GPC_DEAL_APV_NO
		     , GPC_DEAL_APV_STA_CD
		     , DECODE(GPC_DEAL_APV_STA_CD, '00', '승인', '승인취소') AS GPC_DEAL_APV_STA_NM
		     , TO_CHAR(TO_DATE(GPC_USE_DT), 'YYYY-MM-DD') ||' '|| SUBSTR(GPC_USE_DH,1,2) || ':' || SUBSTR(GPC_USE_DH,3,2) || ':' || SUBSTR(GPC_USE_DH,5) AS GPC_USE_DH
		     , GPC_USE_AM
		     , APV_CNL_DH
		     , AFL_BZN
		     , AFL_TOB_CD
		     , AFL_TOB_NM
		     , AFL_CPNM_NM
		     , AFL_TNB
		     , AFL_ZCD
		     , AFL_AD
		     , DEPSTR_NM
		     , COPT_CD
		     , GOV_CD
		     , GOV_NM
		     , GPC_DVSN_NO
		     , GPC_HNDL_RSLT_MID_CAT_CD
		     , CMN
		     , AJT_RFC_YN
		  FROM TBBADDED036L
		 WHERE GPC_NO = #{gpcNo}
		   AND GPC_USE_DT BETWEEN #{gpcUseStrDt} AND #{gpcUseEndDt}
		   AND (AJT_RFC_YN IS NULL OR AJT_RFC_YN = 'N')
		 ORDER BY GPC_USE_DT DESC, GPC_USE_DH DESC
        ]]>
    </select>
    
    <select id="selectRfcStlList" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.bad.ded.dao.BADDED021PMapper.selectRfcStlList */
        <![CDATA[
        SELECT A.CON_TRNSC_ID
		     , A.GPC_TRNSC_GRAM_NO
		     , A.CON_SRNO
		     , SUBSTR(A.GPC_NO,1,4) || '-' || SUBSTR(A.GPC_NO,5,4) || '-' || SUBSTR(A.GPC_NO,9,4) || '-' || SUBSTR(A.GPC_NO,13,4) AS GPC_NO
		     , A.EXPN_CLU_DVSN_CD
		     , A.GPC_TSK_DVSN_CD
		     , A.GPC_DEAL_APV_NO
		     , GPC_DEAL_APV_STA_CD
		     , DECODE(A.GPC_DEAL_APV_STA_CD, '00', '승인', '승인취소') AS GPC_DEAL_APV_STA_NM
		     , TO_CHAR(TO_DATE(A.GPC_USE_DT), 'YYYY-MM-DD') ||' '|| SUBSTR(A.GPC_USE_DH,1,2) || ':' || SUBSTR(A.GPC_USE_DH,3,2) || ':' || SUBSTR(A.GPC_USE_DH,5) AS GPC_USE_DH
		     , A.GPC_USE_AM
		     , A.APV_CNL_DH
		     , A.AFL_BZN
		     , A.AFL_TOB_CD
		     , A.AFL_TOB_NM
		     , A.AFL_CPNM_NM
		     , A.AFL_TNB
		     , A.AFL_ZCD
		     , A.AFL_AD
		     , A.DEPSTR_NM
		     , A.COPT_CD
		     , A.GOV_CD
		     , A.GOV_NM
		     , A.GPC_DVSN_NO
		     , A.GPC_HNDL_RSLT_MID_CAT_CD
		     , A.CMN
		     , A.AJT_RFC_YN
		  FROM TBBADDED036L A
		      ,TBBADDED036D B
		 WHERE A.CON_TRNSC_ID = B.CON_TRNSC_ID
		   AND A.GPC_TRNSC_GRAM_NO = B.GPC_TRNSC_GRAM_NO
		   AND A.CON_SRNO = B.CON_SRNO
		   AND A.GPC_NO = B.GPC_NO
		   AND B.BZT_YR = #{bztYr}
		   AND B.BZT_SNO = #{bztSno}
		   AND B.PCT_CNB = #{pctCnb}
		   AND B.XPN_DVSN_CD = 'LDC'
		   AND B.SNO = #{sno}
		 ORDER BY A.GPC_USE_DT DESC, GPC_USE_DH DESC
        ]]>
    </select>
    
    <select id="selectGpcCofmCmptHisList" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.bad.ded.dao.BADDED021PMapper.selectGpcCofmCmptHisList */
        <![CDATA[
        SELECT GPC_NO
		      ,PCT_CNB
		      ,GPC_USE_STR_DT
		  FROM TBBADDED035M
		 WHERE PCT_CNB = #{cnb}
		   AND USE_RQS_STA_CD = 'COFM'
		 GROUP BY GPC_NO, PCT_CNB, GPC_USE_STR_DT
        ]]>
    </select>
    
     <select id="selectOtherUserInfo" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.bad.ded.dao.BADDED021PMapper.selectOtherUserInfo */
        <![CDATA[
        SELECT GPC_NO
        	  ,PCT_CNB
        	  ,GPC_USE_END_DT
          FROM (SELECT GPC_NO
	  		          ,PCT_CNB
		  	          ,TO_CHAR(TO_DATE(GPC_USE_STR_DT)-1, 'YYYYMMDD') AS GPC_USE_END_DT 
			      FROM TBBADDED035M
			     WHERE GPC_NO = #{gpcNo}
			       AND GPC_USE_STR_DT > #{gpcUseStrDt}
			       AND PCT_CNB <> #{pctCnb}
			       AND USE_RQS_STA_CD = 'COFM'
			     ORDER BY GPC_USE_STR_DT)
         WHERE ROWNUM <=1    
        ]]>
    </select>

    <insert id="insertAgdList">
        /* kr.go.bai.eip.bad.ded.dao.BADDED021PMapper.insertAgdList */
	<![CDATA[
	INSERT INTO TBBADDED036D(
             CON_TRNSC_ID
            ,GPC_TRNSC_GRAM_NO
            ,CON_SRNO
            ,GPC_NO
            ,BZT_YR
            ,BZT_SNO
            ,PCT_CNB
            ,SNO
            ,AJT_RFC_YN
            ,AJT_RFC_ID
            ,AJT_RFC_DH
            ,XPN_DVSN_CD 
            ,RMK
            )
    VALUES(
              #{conTrnscId}
            , #{gpcTrnscGramNo}
            , #{conSrno}
            , REPLACE(#{gpcNo}, '-', '')
            , #{bztYr}
            , #{bztSno}
            , #{pctCnb}
            , #{sno}
            , 'Y'
            , #{usrId}
            , SYSDATE
            , #{xpnDvsnCd}
            , #{rmk}
            )
		]]>
    </insert>
    
    <select id="selectLdc" parameterType="paramMap"
        resultType="int">
        /* kr.go.bai.eip.bad.ded.dao.BADDED021PMapper.selectLdc */
        <![CDATA[
        SELECT LDC
		  FROM TBBADDED011L
		 WHERE BZT_YR  	  = #{bztYr}
           AND BZT_SNO    = #{bztSno}
           AND PCT_CNB    = #{pctCnb}
           AND BZT_EXS_SNO = #{sno}
           AND CALC_YN    = 'Y'
        ]]>
    </select>

	<delete id="delRegiList">
     /* kr.go.bai.eip.bad.ded.dao.BADDED021PMapper.delRegiList */
    <![CDATA[
    DELETE TBBADDED036D
     WHERE CON_TRNSC_ID		 = #{conTrnscId}
       AND GPC_TRNSC_GRAM_NO = #{gpcTrnscGramNo}
       AND CON_SRNO 		 = #{conSrno}
       AND GPC_NO 			 = REPLACE(#{gpcNo}, '-', '')
        ]]>
    </delete>
    
	<update id="updateAjtRfc" parameterType="paramMap">
    /* kr.go.bai.eip.bad.ded.dao.BADDED021PMapper.updateAjtRfc */
        UPDATE TBBADDED036L 
           SET AJT_RFC_YN  = 'Y'
         WHERE CON_TRNSC_ID		 = #{conTrnscId}
           AND GPC_TRNSC_GRAM_NO = #{gpcTrnscGramNo}
           AND CON_SRNO 		 = #{conSrno}
           AND GPC_NO 			 = REPLACE(#{gpcNo}, '-', '')
    </update>
    
    <update id="updateLdc" parameterType="paramMap">
    /* kr.go.bai.eip.bad.ded.dao.BADDED021PMapper.updateLdc */
        UPDATE TBBADDED011L 
           SET LDC         = #{sumUseAm}
         WHERE BZT_YR      = #{bztYr}
           AND BZT_SNO     = #{bztSno}
           AND PCT_CNB 	   = #{pctCnb}
           AND BZT_EXS_SNO = #{sno}
           AND CALC_YN     = 'Y'
    </update>
    
    <update id="updateAjtCnl" parameterType="paramMap">
    /* kr.go.bai.eip.bad.ded.dao.BADDED021PMapper.updateAjtCnl */
        UPDATE TBBADDED036L 
           SET AJT_RFC_YN  = 'N'
         WHERE CON_TRNSC_ID		 = #{conTrnscId}
           AND GPC_TRNSC_GRAM_NO = #{gpcTrnscGramNo}
           AND CON_SRNO 		 = #{conSrno}
           AND GPC_NO 			 = REPLACE(#{gpcNo}, '-', '')
    </update>
    
</mapper> 
