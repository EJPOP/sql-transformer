<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--   -->
<mapper namespace="kr.go.bai.eip.bad.fre.dao.BADFRE611Mapper">

	<select id="BADFRE611QMainselect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.bad.fre.dao.BADFRE611Mapper.BADFRE611QMainselect */
		<include refid="include.pageSelct" />
		SELECT A.ACP_YR || '-' || DECODE(A.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || A.ACP_SRNO AS ACP_NO /* 분류번호 */
			     ,NVL(C.RCPT_NM, CASE WHEN C.RPRT_CD = 'D10400300' THEN NVL(B.DSPTCH_INSTT_NAM, B.CNTR_ADMNSTMACH_NAM)
                         WHEN C.RPRT_CD = 'D10400400' THEN NVL(B.AGT_NM, B.REQR_NM)
                         WHEN C.RPRT_CD = 'E10600200' THEN B.REQR_NM
                   END) AS REQR_NM /* 청구인명 */
                 ,CASE WHEN C.RPRT_CD = 'D10400300' THEN C.RCPT_AD
                       ELSE NVL(C.RCPT_AD, CASE WHEN B.AGT_NM IS NOT NULL AND B.AGT_AD IS NOT NULL THEN  B.AGT_AD || ' ' || B.AGT_DTL_AD ELSE B.AD || ' ' || B.DTL_AD END) END AS AD /* 주소 */ 
			     ,(SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = SUBSTR(B.DPT_CD,0,3) || '000') AS RANK_DPT_NM /* 국 */
			     ,F_DPT_INFO (B.DPT_CD, '1') AS DPT_NM /* 처리과 */
			     ,F_CODE_NM('1000043', B.JDG_REQ_DVSN_CD) AS JDG_REQ_DVSN_NM /* 청구분류명 */
			     ,C.DOC_ID /* 문서ID */
			     ,C.RPRT_CD /* 보고서코드 */
			     ,C.RPRT_NM /* 보고서명 */
		  	     ,TO_CHAR(TO_DATE(C.DLV_DT),'YYYY-MM-DD') AS DLV_DT  /* 교부일자 */
			     ,C.DLV_CNT /* 등본 교부통수 */
			     ,C.ACP_YR /* 접수년도 */
			     ,C.ACP_DVSN_CD /* 접수구분 */
			     ,C.ACP_SRNO /* 접수번호 */
			     ,A.ACP_STEP_CD /* 접수단계 */
			     ,A.SND_DH /* 청구일*/
			     ,C.DLV_RMK /*교부비고 */
			     ,C.CPS_JUD_REL_BLT /*변상판정관련소속*/
			     ,C.CPS_JUD_REL_RANK /*변상판정관련직명*/
			     ,C.CPS_JUD_REL_NAME /*변상판정관련성명*/	
			     , (SELECT DOC_ID FROM TBBADFRE103M D WHERE A.ACP_YR = D.ACP_YR AND A.ACP_DVSN_CD = D.ACP_DVSN_CD AND A.ACP_SRNO = D.ACP_SRNO AND D.RPRT_CD IN ('D10400100','E10600050')) AS FINAL_DOC_ID	/*최종결정서 DOC_ID*/
			     , F_USR_INFO_BY_ID(C.FNL_USR_ID, '2') AS FNL_USR_NM		/*최종사용자명*/
			     , F_OPEN_EDIT(C.LINK_URL) AS DOC_TYPE /* 편집기 구분  */
			     , (SELECT TO_CHAR(FNL_APV_DH,'YYYY-MM-DD') FROM TBDCMACM022L ST WHERE ST.APV_DOC_NO = C.APV_RQS_ID AND ST.APV_STA_CD = '3') AS FNL_APV_DH
	     FROM TBBADFRE111M A,
			     TBBADFRE012M B,
			     TBBADFRE103M C
		WHERE 1=1
		   AND A.ACP_YR = B.ACP_YR
		   AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		   AND A.ACP_SRNO = B.ACP_SRNO
		   AND A.ACP_YR = C.ACP_YR
		   AND A.ACP_DVSN_CD = C.ACP_DVSN_CD
		   AND A.ACP_SRNO = C.ACP_SRNO
		   AND A.ACP_STEP_CD = C.ACP_STEP_CD
		   AND A.DOC_ID = C.DOC_ID
		<if test='acpDvsnCd == "1"'>
		   AND A.ACP_STEP_CD = 'D1040'
		</if>
		<if test='acpDvsnCd == "2"'>
		   AND A.ACP_STEP_CD = 'E1060'
		    <if test='fnlMnuId == "EI_007_003_006_000"'>
		   		AND B.JDG_REQ_DVSN_CD IN ('41','43','49')
		   </if>
		   <if test='fnlMnuId == "EI_007_003_008_000"'>
		   		AND B.JDG_REQ_DVSN_CD IN ('42')
		   </if>
		</if>
		<!-- 교부일자 -->
		<if test='dlvDts != null and dlvDts != ""'>
			AND TO_CHAR(TO_DATE(NVL(C.DLV_DT, SYSDATE)),'YYYYMMDD') &gt;= #{dlvDts}
		</if>
		<if test='dlvDte != null and dlvDte != ""'>
			AND TO_CHAR(TO_DATE(NVL(C.DLV_DT, SYSDATE)),'YYYYMMDD') &lt;= #{dlvDte}
		</if>
		<if test='acpYr != null and acpYr != ""'>
         	AND A.ACP_YR = #{acpYr}
         </if>
         <if test='acpDvsnCd != null and acpDvsnCd != ""'>
         	AND A.ACP_DVSN_CD = #{acpDvsnCd}
         </if>
         <if test='acpSrno != null and acpSrno != ""'>
         	AND A.ACP_SRNO = #{acpSrno}
         </if>
         <if test='acpStepCd != null and acpStepCd != ""'>
         	AND A.ACP_STEP_CD = #{acpStepCd}
         </if>
         <if test='docId != null and docId != ""'>
         	AND A.DOC_ID = #{docId}
         </if>
         <if test='reqrNm != null and reqrNm != ""'>
         	AND B.REQR_NM LIKE '%' || #{reqrNm} || '%'
         </if>
         <if test='dlvYn != null and dlvYn != ""'>
         	AND (CASE WHEN NVL(C.DLV_DT, 0) = 0 THEN 'N'
                    ELSE 'Y' END) = #{dlvYn}
         </if>
         ORDER BY SND_DH DESC
		<include refid="include.pageOrder" />
	</select>
</mapper>
