<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.bad.ded.dao.BADDED005PMapper">
    
    <select id="selectList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED005PMapper.selectList*/
        <include refid="include.pageSelct" />
            SELECT D1.BZT_YR                                                                     AS BZT_YR
                 , D1.BZT_SNO                                                                    AS BZT_SNO
                 , D1.PCT_CNB                                                                    AS PCT_CNB
                 , D1.PCT_NM                                                                     AS PCT_NM
                 , D1.PCT_RANK_CD                                                                AS PCT_RANK_CD
                 , F_CODE_NM('1000173', D1.PCT_RANK_CD)                                          AS PCT_RANK_NM
                 , NVL(D1.BNK_CD, NVL(D3.BZT_TREXP_RCIT_BNK_CD,D2.BNK_CD))                       AS BNK_CD
                 , F_CODE_NM('1000166',NVL(D1.BNK_CD, NVL(D3.BZT_TREXP_RCIT_BNK_CD,D2.BNK_CD)) ) AS BNK_NM /* 은행 - 2017.04.12 EUNOK 변경  D2.BZT_TREXP_RCIT_BNK_CD -> D3.BZT_TREXP_RCIT_BNK_CD */	
                 , DGUARD.DECRYPT('TB_ENC','EAN',NVL(D1.EAN , NVL(D3.BZT_TREXP_RCIT_EAN, D2.EAN))) AS EAN  /* 계좌 - 2017.04.12 EUNOK 변경  D2.BZT_TREXP_RCIT_EAN -> D3.BZT_TREXP_RCIT_EAN */
                 , D1.LEAD_EXS_RCV_EXS_RCIT_PEN_YN                                               AS LEAD_EXS_RCV_EXS_RCIT_PEN_YN
              FROM TBBADDED010L AS D1
   LEFT OUTER JOIN TBCSPLFI103M AS D2 ON D1.PCT_CNB = D2.CNB
   LEFT OUTER JOIN TBDCMACM001M AS D3 ON D1.PCT_CNB = D3.CNB /* 사용자정보기본 - 2017.04.12 EUNOK */	
             WHERE 1=1
               AND BZT_YR = #{bztYr}
               AND BZT_SNO = #{bztSno}
          ORDER BY D1.PCT_RANK_CD, D1.PCT_CNB
        <include refid="include.pageOrder" />
    </select>
    
    <update id="updateBADDED010L" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED005PMapper.updateBADDED010L*/
        UPDATE TBBADDED010L SET FNL_USR_ID = #{usrId}
                              , FNL_DEAL_DPT_CD = #{dptCd}
                              , FNL_MNU_ID = #{menuNo}
                              , FNL_MDF_DH = SYSDATE
                                <if test="bnkCd != null and bnkCd != ''">
                              , BNK_CD = #{bnkCd}
                                </if>
                                <if test="ean != null and ean != ''">
                              , EAN = #{ean}
                                </if>
                              , DEP_RGN_CD = #{depRgnCd}
                          WHERE BZT_YR = #{bztYr}
                            AND BZT_SNO = #{bztSno}
                            AND PCT_CNB = #{pctCnb}
    </update>
    
    
    <update id="updateCSPLFI103M" parameterType="paramMap">
    /*kr.go.bai.eip.bad.ded.dao.BADDED005PMapper.updateCSPLFI103M*/
    /*20170412 EUNOK 업데이트 테이블 변경 TBCSPLFI103M  ->TBDCMACM001M */
        UPDATE TBDCMACM001M SET FNL_USR_ID = #{usrId}
                              , FNL_DEAL_DPT_CD = #{dptCd}
                              , FNL_MNU_ID = #{menuNo}
                              , FNL_MDF_DH             = SYSDATE
                                <if test="bnkCd != null and bnkCd != ''">
                              , BZT_TREXP_RCIT_BNK_CD = #{bnkCd}
                                </if>
                                <if test="ean != null and ean != ''">
                              , BZT_TREXP_RCIT_EAN = #{ean}
                                </if>
                          WHERE 1=1
                            AND CNB = #{pctCnb}
    </update>
    
</mapper> 