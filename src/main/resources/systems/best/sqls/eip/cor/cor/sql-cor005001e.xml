<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.cor.cor.dao.COR005001EMapper">


	<select id="COR005001EDeptBureauSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005001EDeptBureauSelect */
        <![CDATA[
          SELECT DPT_CD, DPT_NM,HIRK_DPT_CD
            FROM TBDCMACM002M
           WHERE 1=1
            AND DPT_CD  LIKE '%000'
            AND USE_YN = 'Y'
           ORDER BY DPT_CD
		]]>
	</select>

	<!-- 부서 과 리스트 조회 -->
	<select id="COR005001EDeptSectSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005001EDeptSectSelect */
        <![CDATA[
           SELECT DPT_CD, DPT_NM, HIRK_DPT_CD
             FROM TBDCMACM002M
            WHERE 1=1

                 ]]>
		<if test='dptauth != null and dptauth != ""'>
              DPT_CD IN ( SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, #{dptAuth}, 'Y')))
        </if>

		<if test='hirkDptCd != null and hirkDptCd != ""'>
			<if test='dptCd == null or dptCd == ""'>
				AND SUBSTR(DPT_CD, 0, 3) = SUBSTR(#{hirkDptCd}, 0, 3)
        	</if>
			<if test='dptCd != null and dptCd != ""'>
	        	OR SUBSTR(DPT_CD, 0, 3) = SUBSTR(#{hirkDptCd}, 0, 3)
       		</if>
		</if>
		<![CDATA[
			  AND DPT_CD NOT LIKE '%000'
			  AND DPT_CD <> '880880'
              AND USE_YN = 'Y'
            ORDER BY DPT_CD
         ]]>
	</select>

 	<select id="COR005001EMainSelect" parameterType="paramMap"  resultType="egovMap">
 		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005001EMainSelect */
 		<include refid="include.pageSelct" />
		<![CDATA[
			SELECT 	C.REQ_DVSN_CD
					,C.ACP_YR
					,C.CVPT_ACP_NO
					,C.ACP_YR || '-부감-' || A.RM_CVPT_ACP_NO AS ACP_NO_NM
					,C.SRNO
					,TO_CHAR(A.ACP_DH, 'YYYY.MM.DD HH24:MM') AS ACP_DH
					/*부패행위 민원 종류 한가지*/
					/*,DECODE(B.CVPT_KND_DVSN_CD,'1','감사부감','2','일반민원','3','기업감사부감') AS CVPT_DVSN_NM*/ 
					,CASE WHEN ( SELECT COUNT(*)
							       FROM TBCORCOR105L S1
							      WHERE S1.REQ_DVSN_CD = A.REQ_DVSN_CD
							        AND S1.ACP_YR = A.ACP_YR
							        AND S1.CVPT_ACP_NO = A.CVPT_ACP_NO ) > 0 
						THEN A.TIT_NM||'(합건 : '||
						       ( SELECT AGGR_CONCAT(S3.ACP_YR||'-부감-'||S3.RM_CVPT_ACP_NO, ', ')||' )'
						           FROM TBCORCOR105L S2, TBCORCOR101M S3
						          WHERE A.REQ_DVSN_CD = S2.REQ_DVSN_CD
						            AND A.ACP_YR = S2.ACP_YR
						            AND A.CVPT_ACP_NO = S2.CVPT_ACP_NO
						            AND S2.SUC_REQ_DVSN_CD = S3.REQ_DVSN_CD
						            AND S2.SUC_ACP_YR = S3.ACP_YR
						            AND S2.SUC_CVPT_ACP_NO = S3.CVPT_ACP_NO
						        )
						WHEN ( SELECT COUNT(*) 
						         FROM TBCORCOR105L S1
						        WHERE S1.SUC_REQ_DVSN_CD = A.REQ_DVSN_CD
						          AND S1.SUC_ACP_YR = A.ACP_YR
						          AND S1.SUC_CVPT_ACP_NO = A.CVPT_ACP_NO) > 0
						THEN A.TIT_NM ||'(합건 : '|| 
						      ( SELECT S3.ACP_YR||'-부감-'||S3.RM_CVPT_ACP_NO
						          FROM TBCORCOR105L S2, TBCORCOR101M S3
						         WHERE S2.REQ_DVSN_CD = S3.REQ_DVSN_CD
						           AND S2.ACP_YR = S3.ACP_YR
						           AND S2.CVPT_ACP_NO = S3.CVPT_ACP_NO
						           AND S2.SUC_REQ_DVSN_CD = A.REQ_DVSN_CD
						           AND S2.SUC_ACP_YR = A.ACP_YR
						           AND S2.SUC_CVPT_ACP_NO = A.CVPT_ACP_NO
						       ) ||
						       ( SELECT AGGR_CONCAT(', '||S4.ACP_YR||'-부감-'||S4.RM_CVPT_ACP_NO, '')
						           FROM TBCORCOR105L S2, TBCORCOR105L S3, TBCORCOR101M S4
						          WHERE S2.SUC_REQ_DVSN_CD = A.REQ_DVSN_CD
						            AND S2.SUC_ACP_YR = A.ACP_YR
						            AND S2.SUC_CVPT_ACP_NO = A.CVPT_ACP_NO
						            AND S2.REQ_DVSN_CD = S3.REQ_DVSN_CD
						            AND S2.ACP_YR = S3.ACP_YR
						            AND S2.CVPT_ACP_NO = S3.CVPT_ACP_NO
						            AND S3.SUC_REQ_DVSN_CD = S4.REQ_DVSN_CD
						            AND S3.SUC_ACP_YR = S4.ACP_YR
						            AND S3.SUC_CVPT_ACP_NO = S4.CVPT_ACP_NO
						            AND (S4.REQ_DVSN_CD, S4.ACP_YR, S4.CVPT_ACP_NO) <> (A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO) )||')'
					ELSE A.TIT_NM END AS TIT_NM
					,D.CVPT_SBT
					,A.CVPTR_NM
					,F_DPT_INFO(C.TRNF_DPT_CD, '1') AS TRNF_DPT_NM
					,F_CODE_NM('1000755' ,E.RSLT_RPRT_HNDL_RSLT_CD) AS RSLT_RPRT_HNDL_RSLT_NM
					,E.RSLT_RPRT_HNDL_RSLT_CD
					,(SELECT COUNT(CVPT_ACP_NO)
					   FROM TBCORCOR601M
					  WHERE ACP_YR = A.ACP_YR
					     AND REQ_DVSN_CD = A.REQ_DVSN_CD
					     AND CVPT_ACP_NO = A.CVPT_ACP_NO
					     AND ACP_STEP_CD LIKE '%F2%') AS PRC_CNT
					,TO_CHAR(A.ACP_DH + 30 + 
                        DECODE((
                            SELECT NVL(SUM(DECODE(NVL(Z3.APV_STA_CD,'0'), '30', '1', '0')),0)
                             FROM TBCORCOR603M Z3
                             WHERE Z3.ACP_YR = A.ACP_YR
                               AND Z3.REQ_DVSN_CD = A.REQ_DVSN_CD
                               AND Z3.CVPT_ACP_NO = A.CVPT_ACP_NO
                               AND Z3.RPRT_CD = 'F10200100'),0,0,10),'YYYY.MM.DD')  AS HNDL_LIMIT_DT_PRCS
                     , TO_CHAR(B.FNL_HNDL_DH,'YYYY.MM.DD') AS FNL_HNDL_DH
                     ,NVL(F.HNDL_RSLT_NTF_YN,'N') AS HNDL_RSLT_NTF_YN
                     , F_CODE_NM('1000894', A.DOC_WRIT_KND_CD) AS DOC_TYPE /* --편집기 구분  */
			FROM 	TBCORCOR101M A
					,TBCORCOR201M B
					,(SELECT REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO, TRNF_DPT_CD, SRNO
					    FROM TBCORCOR205L
					   WHERE 1=1
					     AND REQ_DVSN_CD = '5'
					     AND CVPT_HNDL_DVSN_CD IN ('20')
					 )  C
					,TBCORCOR102M D
					,TBCORCOR402L E
					, TBCORCOR401H F
			WHERE	1=1
			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
			AND		A.ACP_YR = B.ACP_YR
			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
			AND		A.ACP_YR = C.ACP_YR
			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
			AND		A.REQ_DVSN_CD = D.REQ_DVSN_CD
			AND		A.ACP_YR = D.ACP_YR
			AND		A.CVPT_ACP_NO = D.CVPT_ACP_NO
			AND		A.REQ_DVSN_CD = '5'
			AND     A.CVPT_HNDL_STA_CD IN ('60')
			AND		C.REQ_DVSN_CD = E.REQ_DVSN_CD(+)
			AND		C.ACP_YR = E.ACP_YR(+)
			AND		C.CVPT_ACP_NO = E.CVPT_ACP_NO(+)
			AND		C.SRNO = E.DGE(+)
			AND		C.REQ_DVSN_CD = F.REQ_DVSN_CD(+)
			AND		C.ACP_YR = F.ACP_YR(+)
			AND		C.CVPT_ACP_NO = F.CVPT_ACP_NO(+)
			AND		C.SRNO = F.DGE(+)
			AND		(A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO)
   					NOT IN (
   						SELECT	SUC_REQ_DVSN_CD,SUC_ACP_YR,SUC_CVPT_ACP_NO
   						FROM	TBCORCOR105L
   					)
		]]>
		<if test='acpDhs != null and acpDhs != ""'>
			AND		TO_CHAR(A.ACP_DH,'YYYYMMDD') &gt;= #{acpDhs}
			</if>
		<if test='acpDhe != null and acpDhe != ""'>
			AND		TO_CHAR(A.ACP_DH,'YYYYMMDD') &lt;= #{acpDhe}
			</if>
		<if test='acpYr != null and acpYr != ""'>
			AND		A.ACP_YR = #{acpYr}
			</if>

		<if test='rmCvptAcpNo != null and rmCvptAcpNo != ""'>
			AND		A.RM_CVPT_ACP_NO = #{rmCvptAcpNo}
			</if>

		<if test='hirkDptCd != null and hirkDptCd != ""'>
			AND		C.TRNF_DPT_CD IN ( SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, 'DEPTLW','', #{hirkDptCd})))
			
			</if>

		<if test='dptCd != null and dptCd != ""'>
			AND		C.TRNF_DPT_CD = #{dptCd}
			</if>

		<if test='cvptrNm != null and cvptrNm != ""'>
			AND		A.CVPTR_NM LIKE #{cvptrNm} ||'%'
			</if>

		<if test='titNm != null and titNm != ""'>
			AND	A.TIT_NM LIKE '%'||#{titNm}||'%'
		</if>
		
		<![CDATA[
			ORDER BY A.ACP_DH DESC, TO_NUMBER(A.RM_CVPT_ACP_NO) DESC
		]]>
		<include refid="include.pageOrder" />
	</select>

	<select id="COR005001EExcelExportSelect" parameterType="paramMap"  resultType="egovMap">
 		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005001EExcelExportSelect */
		<![CDATA[
			SELECT 	C.REQ_DVSN_CD
					,C.ACP_YR
					,C.CVPT_ACP_NO
					,C.ACP_YR || '-부감-' || A.RM_CVPT_ACP_NO AS ACP_NO_NM
					,C.SRNO
					,TO_CHAR(A.ACP_DH, 'YYYY.MM.DD HH24:MM') AS ACP_DH
					,A.TIT_NM
					,D.CVPT_SBT
					,A.CVPTR_NM
					,F_DPT_INFO(C.TRNF_DPT_CD, '1') AS TRNF_DPT_NM
					,F_CODE_NM('1000755' ,E.RSLT_RPRT_HNDL_RSLT_CD) AS RSLT_RPRT_HNDL_RSLT_NM
					,E.RSLT_RPRT_HNDL_RSLT_CD
			FROM 	TBCORCOR101M A
					,TBCORCOR201M B
					,(SELECT REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO, TRNF_DPT_CD, SRNO
					    FROM TBCORCOR205L
					   WHERE 1=1
					     AND REQ_DVSN_CD = '5'
					     AND CVPT_HNDL_DVSN_CD ='70'
					 )  C
					,TBCORCOR102M D
					,TBCORCOR402L E
			WHERE	1=1
			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
			AND		A.ACP_YR = B.ACP_YR
			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
			AND		A.ACP_YR = C.ACP_YR
			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
			AND		A.REQ_DVSN_CD = D.REQ_DVSN_CD
			AND		A.ACP_YR = D.ACP_YR
			AND		A.CVPT_ACP_NO = D.CVPT_ACP_NO
			AND		A.REQ_DVSN_CD = '5'
			AND     A.CVPT_HNDL_STA_CD = '60'
			AND		C.REQ_DVSN_CD = E.REQ_DVSN_CD(+)
			AND		C.ACP_YR = E.ACP_YR(+)
			AND		C.CVPT_ACP_NO = E.CVPT_ACP_NO(+)
			AND		C.SRNO = E.DGE(+)
		]]>
		<if test='acpDhs != null and acpDhs != ""'>
			AND		TO_CHAR(A.ACP_DH,'YYYYMMDD') &gt;= #{acpDhs}
			</if>
		<if test='acpDhe != null and acpDhe != ""'>
			AND		TO_CHAR(A.ACP_DH,'YYYYMMDD') &lt;= #{acpDhe}
			</if>
		<if test='acpYr != null and acpYr != ""'>
			AND		A.ACP_YR = #{acpYr}
			</if>

		<if test='rmCvptAcpNo != null and rmCvptAcpNo != ""'>
			AND		A.RM_CVPT_ACP_NO = #{rmCvptAcpNo}
			</if>

		<if test='hirkDptCd != null and hirkDptCd != ""'>
			AND		C.TRNF_DPT_CD IN ( SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, 'DEPTLW','', #{hirkDptCd})))
			</if>

		<if test='dptCd != null and dptCd != ""'>
			AND		C.TRNF_DPT_CD = #{dptCd}
			</if>

		<if test='cvptrNm != null and cvptrNm != ""'>
			AND		A.CVPTR_NM LIKE #{cvptrNm} ||'%'
			</if>

		<if test='searchCd == "1"'>
		<if test='titNm != null and titNm != ""'>
					AND	A.TIT_NM LIKE '%'||#{titNm}||'%'
				</if>
			</if>
		<if test='searchCd == "2"'>
		<if test='titNm != null and titNm != ""'>
					AND	D.CVPT_SBT LIKE '%'||#{titNm}||'%'
				</if>
			</if>
		<![CDATA[
			ORDER BY A.ACP_DH DESC
		]]>
	</select>

	<select id="COR005007ESelectRsltRprt" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007ESelectRsltRprt */
        <![CDATA[
			/* 조사결과보고 조회 */
			SELECT	C.REQ_DVSN_CD
					,C.ACP_YR
					,C.CVPT_ACP_NO
					,NVL(A.DGE,#{srno}) AS DGE
					,NVL(A.RPL_DT, TO_CHAR(SYSDATE, 'YYYYMMDD')) AS RPL_DT
					,B.RSLT_RPRT_HNDL_RSLT_CD
					,A.INSPC_RSLT_UNQ_TXT
					,A.DOC_ID                           AS HNDL_DOC_ID
					,A.DOC_TYP_CD
					,F_DPT_INFO(C.TRNF_DPT_CD,'1') AS TRNF_DPT_NM
					,(SELECT 	COUNT(*)
				      	FROM	TBCORCOR203M S1
				      	WHERE	A.REQ_DVSN_CD = S1.REQ_DVSN_CD
					   	AND		A.ACP_YR      = S1.ACP_YR
					   	AND		A.CVPT_ACP_NO = S1.CVPT_ACP_NO
					   	AND		S1.DGE = #{srno}
				       ) AS REPORT_YN
				    ,CASE WHEN E.APV_STA_CD = '30' THEN 'Y' ELSE 'N' END AS REPORT_YN2
					,CASE WHEN D.CVPT_OPM_APV_HNDL_STA_CD = '30' THEN 'Y'
					     WHEN E.APV_STA_CD = '30' THEN 'Y' 
						ELSE 'N' END AS REPORT_RESULT_YN
					, NVL(TO_CHAR(D.ONR_APV_RQS_DH, 'YYYY/MM/DD HH24:MI:SS'), (SELECT TO_CHAR(SBM_DH, 'YYYY/MM/DD HH24:MI:SS') FROM TBDCMACM022L WHERE APV_DOC_NO = E.APV_RQS_ID)) AS ONR_APV_RQS_DH
                    , NVL(TO_CHAR(D.ONR_APV_CMPT_DH, 'YYYY/MM/DD HH24:MI:SS'), (SELECT TO_CHAR(APV_DH, 'YYYY/MM/DD HH24:MI:SS') FROM TBDCMACM023L WHERE APV_DOC_NO = E.APV_RQS_ID AND APVR_KND_CD = '3')) AS ONR_APV_CMPT_DH
                    ,B.AUD_RFR_MTRL_TRNF_DPT_CD
                    ,F_DPT_INFO(B.AUD_RFR_MTRL_TRNF_DPT_CD,'1') AS  AUD_RFR_MTRL_TRNF_DPT_NM
                    ,B.TRNF_ORG_CD
                    ,F_ORG_INFO(B.TRNF_ORG_CD,'1') AS TRNF_ORG_NM
			  FROM	TBCORCOR205L C
              LEFT OUTER JOIN TBCORCOR401H A ON (C.REQ_DVSN_CD = A.REQ_DVSN_CD
                                                 AND C.ACP_YR = A.ACP_YR
                                                 AND C.CVPT_ACP_NO = A.CVPT_ACP_NO
                                                 AND A.DGE = #{srno})
			  LEFT OUTER JOIN TBCORCOR402L B ON (A.REQ_DVSN_CD = B.REQ_DVSN_CD
                                                 AND A.ACP_YR = B.ACP_YR
                                                 AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
                                                 AND A.DGE = B.DGE)
			  LEFT OUTER JOIN TBCORCOR301M D ON (A.REQ_DVSN_CD = D.REQ_DVSN_CD
                                                 AND A.ACP_YR = D.ACP_YR
                                                 AND A.CVPT_ACP_NO = D.CVPT_ACP_NO
                                                 AND A.DGE = D.DGE
                                                 AND D.CVPT_IFM_DVSN_CD = 'E')
			  LEFT OUTER JOIN TBCORCOR603M E ON (NVL(C.REQ_DVSN_CD, A.REQ_DVSN_CD) = E.REQ_DVSN_CD
                                                 AND NVL(C.ACP_YR, A.REQ_DVSN_CD) = E.ACP_YR
                                                 AND NVL(C.CVPT_ACP_NO, A.REQ_DVSN_CD) = E.CVPT_ACP_NO
                                                 AND E.RPRT_CD = 'F20100400')
              WHERE	1=1
			  AND	C.REQ_DVSN_CD = #{reqDvsnCd}
			  AND	C.ACP_YR = #{acpYr}
			  AND	C.CVPT_ACP_NO = #{cvptAcpNo}
			  AND  C.SRNO = #{srno}

        ]]>
	</select>

	<select id="COR005007ESelecLawList" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007ESelecLawList */
        <![CDATA[
			/* 관련법령조회 */
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
					,A.CVPT_ACP_NO
					,NVL(A.DGE,#{srno}) AS DGE
					,B.LAW_HIS_SRNO
					,B.LAW_LNK_ID
					, (	SELECT	Z.LAW_NM
						FROM	TBBADCMR013M Z
						WHERE	B.LAW_LNK_ID = Z.LAW_LNK_ID) AS LAW_NM
					,B.LAW_DTL_TXT
			  FROM	TBCORCOR401H A
			  		,TBCORCOR204L B
			 WHERE	1=1
			   AND	A.REQ_DVSN_CD = B.REQ_DVSN_CD
			   AND	A.ACP_YR = B.ACP_YR
			   AND	A.CVPT_ACP_NO = B.CVPT_ACP_NO
			   AND	A.DGE = B.DGE
			   AND	A.DGE = #{srno}
			   AND	A.REQ_DVSN_CD = #{reqDvsnCd}
			   AND	A.ACP_YR = #{acpYr}
			   AND	A.CVPT_ACP_NO = #{cvptAcpNo}
        ]]>
	</select>

	<insert id="COR005007E401MERGE" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007E401MERGE */
        <![CDATA[
			MERGE INTO TBCORCOR401H A
			USING (SELECT #{reqDvsnCd} AS REQ_DVSN_CD, #{acpYr} AS ACP_YR, #{cvptAcpNo} AS CVPT_ACP_NO, #{dge} AS DGE FROM DUAL) B
			ON (A.REQ_DVSN_CD = B.REQ_DVSN_CD
			    AND A.ACP_YR = B.ACP_YR
			    AND A.DGE = B.DGE
			    AND A.CVPT_ACP_NO = B.CVPT_ACP_NO)
			WHEN MATCHED THEN
			UPDATE SET
					 A.HNDL_DPT_CD = #{fnlDealDptCd}
					,A.HNDL_PEN_ID = #{fnlUsrId}
					,A.DOC_ID = #{docId}
					,A.INSPC_RSLT_UNQ_TXT = #{inspcRsltUnqTxt}
					,A.RPL_DT = #{rplDt}
				   	,A.FNL_USR_ID = #{fnlUsrId}
					,A.FNL_DEAL_DPT_CD = #{fnlDealDptCd}
					,A.FNL_MNU_ID = #{fnlMnuId}
					,A.FNL_MDF_DH = SYSDATE
			WHEN NOT MATCHED THEN
			INSERT (REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO, DGE,
			        HNDL_DPT_CD, HNDL_PEN_ID, INSPC_RSLT_UNQ_TXT, DOC_ID, DOC_TYP_CD, RPL_DT,
			        FRT_USR_ID, FNL_USR_ID, FNL_DEAL_DPT_CD, FNL_MNU_ID, FRT_REGI_DH, FNL_MDF_DH)
			VALUES (#{reqDvsnCd},#{acpYr},#{cvptAcpNo},#{dge},
			        #{fnlDealDptCd},#{fnlUsrId},#{inspcRsltUnqTxt},#{docId},#{docTypCd},#{rplDt},
			        #{fnlUsrId},#{fnlUsrId},#{fnlDealDptCd},#{fnlMnuId},SYSDATE,SYSDATE)
        ]]>
	</insert>

	<insert id="COR005007E402MERGE" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007E402MERGE */
        <![CDATA[
			MERGE INTO TBCORCOR402L A
			USING (SELECT #{reqDvsnCd} AS REQ_DVSN_CD, #{acpYr} AS ACP_YR, #{cvptAcpNo} AS CVPT_ACP_NO, #{dge} AS DGE FROM DUAL) B
			ON (A.REQ_DVSN_CD = B.REQ_DVSN_CD
			    AND A.ACP_YR = B.ACP_YR
			    AND A.DGE = B.DGE
			    AND A.CVPT_ACP_NO = B.CVPT_ACP_NO)
			WHEN MATCHED THEN
			UPDATE SET
					 A.RSLT_RPRT_HNDL_RSLT_CD = #{rsltRprtHndlRsltCd}
				   	,A.FNL_USR_ID = #{fnlUsrId}
					,A.FNL_DEAL_DPT_CD = #{fnlDealDptCd}
					,A.FNL_MNU_ID = #{fnlMnuId}
					,A.FNL_MDF_DH = SYSDATE
					,A.AUD_RFR_MTRL_TRNF_DPT_CD = CASE WHEN #{rsltRprtHndlRsltCd} = '80' THEN #{audRfrMtrlTrnfDptCd} ELSE NULL END
					,A.TRNF_ORG_CD = CASE WHEN #{rsltRprtHndlRsltCd} = '60' THEN #{trnfOrgCd} ELSE NULL END
			WHEN NOT MATCHED THEN
			INSERT (REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO, DGE,
			        RSLT_RPRT_HNDL_RSLT_CD,
			        FRT_USR_ID, FNL_USR_ID, FNL_DEAL_DPT_CD, FNL_MNU_ID, FRT_REGI_DH, FNL_MDF_DH
			        ,AUD_RFR_MTRL_TRNF_DPT_CD, TRNF_ORG_CD)
			VALUES (#{reqDvsnCd},#{acpYr},#{cvptAcpNo},#{dge},
			        #{rsltRprtHndlRsltCd},
			        #{fnlUsrId},#{fnlUsrId},#{fnlDealDptCd},#{fnlMnuId},SYSDATE,SYSDATE
			        ,CASE WHEN #{rsltRprtHndlRsltCd} = '80' THEN #{audRfrMtrlTrnfDptCd} ELSE NULL END
			        ,CASE WHEN #{rsltRprtHndlRsltCd} = '60' THEN #{trnfOrgCd} ELSE NULL END)
        ]]>
	</insert>

	<insert id="COR005007E204MERGE" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007E204MERGE */
        <![CDATA[
			MERGE INTO TBCORCOR204L A
			USING (SELECT #{reqDvsnCd} AS REQ_DVSN_CD,
			              #{acpYr} AS ACP_YR,
			              #{cvptAcpNo} AS CVPT_ACP_NO,
			              #{dge} AS DGE,
			              #{lawHisSrno} AS LAW_HIS_SRNO,
			              #{lawLnkId} AS LAW_LNK_ID
			              FROM DUAL) B
			ON (A.REQ_DVSN_CD = B.REQ_DVSN_CD AND
			    A.ACP_YR = B.ACP_YR AND
			    A.DGE = B.DGE AND
			    A.CVPT_ACP_NO = B.CVPT_ACP_NO AND
			    A.LAW_HIS_SRNO = B.LAW_HIS_SRNO AND
			    A.LAW_LNK_ID = B.LAW_LNK_ID)
			WHEN MATCHED THEN
			UPDATE SET
					 A.LAW_DTL_TXT = #{lawDtlTxt}
				   	,A.FNL_USR_ID = #{fnlUsrId}
					,A.FNL_DEAL_DPT_CD = #{fnlDealDptCd}
					,A.FNL_MNU_ID = #{fnlMnuId}
					,A.FNL_MDF_DH = SYSDATE
			WHEN NOT MATCHED THEN
			INSERT (REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO, DGE, LAW_HIS_SRNO, LAW_LNK_ID,
			        LAW_DTL_TXT,
			        FRT_USR_ID, FNL_USR_ID, FNL_DEAL_DPT_CD, FNL_MNU_ID, FRT_REGI_DH, FNL_MDF_DH)
			VALUES (#{reqDvsnCd},#{acpYr},#{cvptAcpNo},#{dge}, (SELECT NVL(MAX(LAW_HIS_SRNO), 0) +1
																FROM TBCORCOR204L
																WHERE REQ_DVSN_CD = #{reqDvsnCd}
																AND ACP_YR  = #{acpYr}
																AND CVPT_ACP_NO = #{cvptAcpNo})
					, #{lawLnkId},
			        #{lawDtlTxt},
			        #{fnlUsrId},#{fnlUsrId},#{fnlDealDptCd},#{fnlMnuId},SYSDATE,SYSDATE)
        ]]>
	</insert>

	<delete id="COR005007E204Delete" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007E204Delete */
        <![CDATA[
			DELETE FROM TBCORCOR204L
			 WHERE REQ_DVSN_CD = #{reqDvsnCd}
			   AND ACP_YR = #{acpYr}
			   AND DGE = #{dge}
			   AND CVPT_ACP_NO = #{cvptAcpNo}
			   AND LAW_HIS_SRNO = #{lawHisSrno}
			   AND LAW_LNK_ID = #{lawLnkId}
        ]]>
	</delete>


	<resultMap type="java.util.HashMap" id="CSPDCP516AnsMap">
 		<result property="reqDvsnCd" column="REQ_DVSN_CD"                   jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="acpYr" column="ACP_YR"                             jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptAcpNo" column="CVPT_ACP_NO"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="rmCvptAcpNo" column="RM_CVPT_ACP_NO"                   jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="smgCvptHndlDvsnCd" column="SMG_CVPT_HNDL_DVSN_CD"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="opmNtfDvsnCd" column="OPM_NTF_DVSN_CD"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptHndlStaCd" column="CVPT_HNDL_STA_CD"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="ansTxt" column="ANS_TXT"       jdbcType="CLOB"  javaType="java.lang.String" />
		<result property="acpRutCd" column="ACP_RUT_CD"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="rsltNtfWayCd" column="RSLT_NTF_WAY_CD"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="sucCvptHndlStaCd" column="SUC_CVPT_HNDL_STA_CD"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="sucTxt" column="SUC_TXT"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="ansDocId" column="ANS_DOC_ID"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="emlId" column="EML_ID"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptOpmApvHndlStaCd" column="CVPT_OPM_APV_HNDL_STA_CD"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="hpn" column="HPN"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="dge" column="DGE"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="cvptOpmSrno" column="CVPT_OPM_SRNO"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="onrDocMngCrdId" column="ONR_DOC_MNG_CRD_ID"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="onrApvCmptDh" column="ONR_APV_CMPT_DH"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="hndlRsltNtfYn" column="HNDL_RSLT_NTF_YN"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="ansYn" column="ANS_YN"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="hndlYn" column="HNDL_YN"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		<result property="rOpmNtfDvsnCd" column="R_OPM_NTF_DVSN_CD"       jdbcType="VARCHAR"  javaType="java.lang.String" />
		
 	</resultMap>
	<select id="COR005007EAnsSelect" parameterType="paramMap"
		resultMap="CSPDCP516AnsMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007EAnsSelect */
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					, A.ACP_YR
					, A.CVPT_ACP_NO
					, A.RM_CVPT_ACP_NO
					, D.SMG_CVPT_HNDL_DVSN_CD
					, NVL(D.OPM_NTF_DVSN_CD,'N') AS OPM_NTF_DVSN_CD
					, A.CVPT_HNDL_STA_CD
					, CASE WHEN D.ANS_TXT IS NULL THEN ( SELECT	CVPT_DOC_TXT
														 FROM	TBCORCOR203M Z
														 WHERE	A.REQ_DVSN_CD = Z.REQ_DVSN_CD
														 AND	A.ACP_YR = Z.ACP_YR
														 AND	A.CVPT_ACP_NO = Z.CVPT_ACP_NO
														 AND	Z.DGE =  #{srno}
														 AND	Z.CVPT_DOC_DVSN_CD  = 'B3' )
						ELSE D.ANS_TXT END ANS_TXT
					, A.ACP_RUT_CD
					, A.RSLT_NTF_WAY_CD
					, (	SELECT	Z.CVPT_HNDL_STA_CD
						FROM 	TBCORCOR101M Z
						WHERE 	Z.REQ_DVSN_CD = #{sucReqDvsnCd}
						AND		Z.ACP_YR = #{sucAcpYr}
						AND		Z.CVPT_ACP_NO = #{sucCvptAcpNo}
					  ) AS SUC_CVPT_HNDL_STA_CD
					, '해당감사부감는 [ '||A.ACP_YR||'-부감-'||A.CVPT_ACP_NO||' ] 와 합건처리되었습니다.' AS SUC_TXT
					,D.ANS_DOC_ID
					,A.EML_ID
					,C.CVPT_OPM_APV_HNDL_STA_CD
					,A.HPN
					,D.DGE
					,C.CVPT_OPM_SRNO
					,C.ONR_DOC_MNG_CRD_ID
					,TO_CHAR(C.ONR_APV_CMPT_DH,'YYYY.MM.DD HH24:MI') AS ONR_APV_CMPT_DH
					,D.HNDL_RSLT_NTF_YN
					,CASE WHEN D.OPM_NTF_DVSN_CD ='Y' AND C.CVPT_OPM_APV_HNDL_STA_CD = '30' THEN 'Y'
						WHEN D.OPM_NTF_DVSN_CD = 'N' THEN 'Y'
		       			ELSE 'N' END AS ANS_YN
			FROM	TBCORCOR101M A
			INNER JOIN TBCORCOR201M B ON (A.REQ_DVSN_CD = B.REQ_DVSN_CD
                                          AND	A.ACP_YR = B.ACP_YR
                                          AND A.CVPT_ACP_NO = B.CVPT_ACP_NO)
			LEFT OUTER JOIN TBCORCOR301M C ON (A.REQ_DVSN_CD = C.REQ_DVSN_CD
                                            AND	A.ACP_YR = C.ACP_YR
                                            AND	A.CVPT_ACP_NO = C.CVPT_ACP_NO
                                            AND	C.DGE = #{srno}
                                            AND C.CVPT_IFM_DVSN_CD = 'F')
			LEFT OUTER JOIN TBCORCOR401H D ON (A.REQ_DVSN_CD = D.REQ_DVSN_CD
                                            AND A.ACP_YR = D.ACP_YR
                                            AND A.CVPT_ACP_NO = D.CVPT_ACP_NO
                                            AND	D.DGE = #{srno})
			WHERE	1=1
			AND		A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</select>
	
	<select id="COR005007EAnsPrcsSelect" parameterType="paramMap"
		resultMap="CSPDCP516AnsMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007EAnsSelect */
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					, A.ACP_YR
					, A.CVPT_ACP_NO
					, A.RM_CVPT_ACP_NO
					, D.SMG_CVPT_HNDL_DVSN_CD
					, NVL(D.OPM_NTF_DVSN_CD,'N') AS OPM_NTF_DVSN_CD
					, A.CVPT_HNDL_STA_CD
					, CASE WHEN D.ANS_TXT IS NULL THEN ( SELECT	CVPT_DOC_TXT
														 FROM	TBCORCOR203M Z
														 WHERE	A.REQ_DVSN_CD = Z.REQ_DVSN_CD
														 AND	A.ACP_YR = Z.ACP_YR
														 AND	A.CVPT_ACP_NO = Z.CVPT_ACP_NO
														 AND	Z.DGE =  #{srno}
														 AND	Z.CVPT_DOC_DVSN_CD  = 'B3' )
						ELSE D.ANS_TXT END ANS_TXT
					, A.ACP_RUT_CD
					, A.RSLT_NTF_WAY_CD
					, (	SELECT	Z.CVPT_HNDL_STA_CD
						FROM 	TBCORCOR101M Z
						WHERE 	Z.REQ_DVSN_CD = #{sucReqDvsnCd}
						AND		Z.ACP_YR = #{sucAcpYr}
						AND		Z.CVPT_ACP_NO = #{sucCvptAcpNo}
					  ) AS SUC_CVPT_HNDL_STA_CD
					, '해당감사부감는 [ '||A.ACP_YR||'-부감-'||A.CVPT_ACP_NO||' ] 와 합건처리되었습니다.' AS SUC_TXT
					,D.ANS_DOC_ID
					,A.EML_ID
					,A.HPN
					,D.DGE
					,CASE WHEN C.APV_STA_CD = '30' THEN TO_CHAR(G.FNL_APV_DH,'YYYY.MM.DD HH24:MI') ELSE '' END AS ONR_APV_CMPT_DH
					,D.HNDL_RSLT_NTF_YN
					,CASE WHEN C.APV_STA_CD = '30' THEN '2' ELSE '1' END AS ANS_YN
					,CASE WHEN E.APV_STA_CD = '30' THEN 'Y' ELSE 'N' END AS HNDL_YN
					,D.OPM_NTF_DVSN_CD AS R_OPM_NTF_DVSN_CD
			FROM	TBCORCOR101M A
			INNER JOIN TBCORCOR201M B ON (A.REQ_DVSN_CD = B.REQ_DVSN_CD
                                          AND	A.ACP_YR = B.ACP_YR
                                          AND A.CVPT_ACP_NO = B.CVPT_ACP_NO)
			LEFT OUTER JOIN TBCORCOR603M C ON (A.REQ_DVSN_CD = C.REQ_DVSN_CD
                                            AND	A.ACP_YR = C.ACP_YR
                                            AND	A.CVPT_ACP_NO = C.CVPT_ACP_NO
                                            AND	C.RPRT_CD = 'F20300100')
			LEFT OUTER JOIN TBCORCOR401H D ON (A.REQ_DVSN_CD = D.REQ_DVSN_CD
                                            AND A.ACP_YR = D.ACP_YR
                                            AND A.CVPT_ACP_NO = D.CVPT_ACP_NO
                                            AND	D.DGE = #{srno})
            LEFT OUTER JOIN TBDCMACM101M G ON (C.APV_RQS_ID = G.ONR_DOC_MNG_CRD_ID)
            LEFT OUTER JOIN TBCORCOR603M E ON (A.REQ_DVSN_CD = E.REQ_DVSN_CD
                                            AND	A.ACP_YR = E.ACP_YR
                                            AND	A.CVPT_ACP_NO = E.CVPT_ACP_NO
                                            AND	E.RPRT_CD = 'F20100400')
			WHERE	1=1
			AND		A.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		A.ACP_YR = #{acpYr}
   			AND		A.CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</select>

	<update id="COR005007E401AnsUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007E401AnsUpdate */
		<![CDATA[
			UPDATE	/*COR005007E401AnsUpdate*/ TBCORCOR401H
			SET		SMG_CVPT_HNDL_DVSN_CD = #{smgCvptHndlDvsnCd}
					,OPM_NTF_DVSN_CD = #{opmNtfDvsnCd}
					,ANS_DOC_ID = #{ansDocId}
					,ANS_DOC_TYP_CD = #{ansDocTypCd}
					,ANS_TXT = #{ansTxt}
					,FNL_USR_ID = #{fnlUsrId}
					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
					,FNL_MNU_ID = #{fnlMnuId}
					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
			AND		DGE = #{dge}
		]]>
	</update>

	<update id="COR005007EHoseSendUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007EHoseSendUpdate */
		<![CDATA[
			UPDATE	TBCORCOR401H D1
			SET		HNDL_RSLT_NTF_YN = 'Y'
					,FNL_USR_ID = #{fnlUsrId}
					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
					,FNL_MNU_ID = #{fnlMnuId}
					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #{reqDvsnCd}
			AND		ACP_YR = #{acpYr}
			AND		CVPT_ACP_NO = #{cvptAcpNo}
			AND		DGE = #{dge}
		]]>
	</update>


	<insert id="COR005007ESmgNtfInsert" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007ESmgNtfInsert */
		<![CDATA[
			INSERT INTO	T_IC_TARGET_SRC_INTERFACE
						(	INTERFACE_KEY
							,APP_ORGAN_CODE		/*최초 민원 신청 기관코드(GCC)*/
							,PETI_NO			/*민원신청번호*/
							,REC_SEQ			/*분류이력일련번호*/
							,CIVIL_NO			/*민원접수번호*/
							,PETI_GUBUN			/*민원구분 (500고정,담당자부서지정) */
							,CANCEL_STATUS		/*민원취하여부(Default N)*/
							,PCD_DEPT			/*GCC 부서코드 (접수부서코드)*/
							,PCD_DEPT_NM		/*GCC 부서명 (접수부서명)*/
							,PCD_DUTY_ID		/*접수자명*/
							,PCD_EMAIL			/*접수 이메일 (대표이메일 사용, 감청국, 센터 로 분류)*/
							,PCD_TEL			/*접수자 전화번호 (대표전화 사용: 감청국, 센터로 분류)*/
							,PCD_CONTENTS		/*민원 처리결과 내용*/
							,PCD_REG_DATE		/*처리일자*/
							,PCD_CONTENTS_ATTACH_YN	/*민원처리결과첨부여부*/
							,PCD_GUBUN			/*신문고민원 처리구분코드*/
							,PCD_ORGAN_CODE 	/*실처리기관코드 (감사원 GCC 코드로 고정)*/
							,SRCORGCD			/*소스기관코드 (감사원 GCC 코드로 고정)*/
							,TGTORGCD			/*타겟기관코드 (신문고 GCC 코드로 고정)*/
							,WRITE_TIME			/*등록일자*/
							,SND_RCV_GUBUN		/*송수신구분 (1:송신, 2:수신)*/
							,SND_RCV_TIME		/*송수신일자*/
							,SEND_YN			/*송신여부 (N DEFAULT, EAI 가 송신후 Y로 변경함)*/
						)
				SELECT	TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF2') || LPAD(ROUND(DBMS_RANDOM.VALUE(1, 999999999)), 9, '0')
						,SMG_FRT_CVPT_APL_GCC_ORG_CD
							,SMG_CVPT_APL_NO
							,SMG_CAT_HST_SRNO
							,SMG_CVPT_ACP_NO
							,DECODE(SMG_FRT_HNDL_STA_CD, '161','181', '163','183')
							,'N'
							,F_DPT_INFO(#{fnlDealDptCd},'6')
							,F_DPT_INFO(#{fnlDealDptCd},'7')
							,F_USR_INFO(#{sCnb},'2')
							,''
							,'02-2011-2191'
							,#{ansTxt}
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'N'
							,#{smgCvptHndlDvsnCd}
							,'1040000'
							,'1040000'
							,'1140100'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'1'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
							,'N'
				FROM	TBCORCOR101M
				WHERE	REQ_DVSN_CD = #{reqDvsnCd}
				AND		ACP_YR = #{acpYr}
				AND		CVPT_ACP_NO = #{cvptAcpNo}
		]]>
	</insert>
	
	<!-- 2021-04-16, 접수경로 추가로 쿼리 수정, 김병태 -->
	<!-- 홈페이지로 전송할 데이터인지 체크한다. -->
	<select id="COR005007EHomeSendSelect" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007EHomeSendSelect */
		<![CDATA[
			SELECT	/*COR005007EHomeSendSelect*/
					COUNT(1)
			FROM	TBCORCOR101M D1
			WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
	 		AND		D1.ACP_YR = #{acpYr}
	 		AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
	 		AND		D1.ACP_RUT_CD IN ('1','2','3','4','5','6','9')
		]]>
	</select>

	<!-- 신문고로 전송할 데이터인지 체크한다. -->
	<select id="COR005007ESmgSendSelect" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007ESmgSendSelect */
		<![CDATA[
			SELECT	/*COR005007ESmgSendSelect*/
					COUNT(1)
			FROM	TBCORCOR101M D1
			WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
	 		AND		D1.ACP_YR = #{acpYr}
	 		AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
	 		AND		D1.ACP_RUT_CD = '8'
		]]>
	</select>
	
	<select id="COR005001ESucSelect" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005001ESucSelect */
		<![CDATA[
			SELECT	B.REQ_DVSN_CD
					,B.ACP_YR
   					,B.CVPT_ACP_NO
   					,A.RM_CVPT_ACP_NO
   					,A.ACP_YR||'-부감-'||A.RM_CVPT_ACP_NO AS ACP_NO
   					,A.CVPT_KND_CD
   					,F_CODE_NM('1000939',A.CVPT_KND_CD) AS CVPT_KND_NM
   					,TO_CHAR(A.ACP_DH,'YYYY.MM.DD HH24:MI') AS ACP_DH
   					,A.TIT_NM
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,B.SUC_REQ_DVSN_CD
   					,B.SUC_ACP_YR
   					,B.SUC_CVPT_ACP_NO
   					,A.CVPT_HNDL_STA_CD
   			FROM	TBCORCOR101M A, TBCORCOR105L B
   			WHERE	B.REQ_DVSN_CD = #{reqDvsnCd}
   			AND		B.ACP_YR = #{acpYr}
   			AND		B.CVPT_ACP_NO = #{cvptAcpNo}
   			AND		B.SUC_REQ_DVSN_CD = A.REQ_DVSN_CD
   			AND		B.SUC_ACP_YR = A.ACP_YR
   			AND		B.SUC_CVPT_ACP_NO = A.CVPT_ACP_NO
   		]]>
   	</select>
   	
   	
   	<insert id="COR005007E401SUCMERGE" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007E401SUCMERGE */
        <![CDATA[
			MERGE INTO TBCORCOR401H A
			USING (SELECT SUC_REQ_DVSN_CD, SUC_ACP_YR, SUC_CVPT_ACP_NO,  #{dge} AS DGE
					FROM TBCORCOR105L 
				   WHERE REQ_DVSN_CD =#{reqDvsnCd} AND ACP_YR = #{acpYr} AND CVPT_ACP_NO =#{cvptAcpNo}
				   ) B
			ON (A.REQ_DVSN_CD = B.SUC_REQ_DVSN_CD
			    AND A.ACP_YR = B.SUC_ACP_YR
			    AND A.DGE = B.DGE
			    AND A.CVPT_ACP_NO = B.SUC_CVPT_ACP_NO)
			WHEN MATCHED THEN
			UPDATE SET
					 A.HNDL_DPT_CD = #{fnlDealDptCd}
					,A.HNDL_PEN_ID = #{fnlUsrId}
					,A.DOC_ID = #{docId}
					,A.INSPC_RSLT_UNQ_TXT = #{inspcRsltUnqTxt}
					,A.RPL_DT = #{rplDt}
				   	,A.FNL_USR_ID = #{fnlUsrId}
					,A.FNL_DEAL_DPT_CD = #{fnlDealDptCd}
					,A.FNL_MNU_ID = #{fnlMnuId}
					,A.FNL_MDF_DH = SYSDATE
			WHEN NOT MATCHED THEN
			INSERT (REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO, DGE,
			        HNDL_DPT_CD, HNDL_PEN_ID, INSPC_RSLT_UNQ_TXT, DOC_ID, DOC_TYP_CD, RPL_DT,
			        FRT_USR_ID, FNL_USR_ID, FNL_DEAL_DPT_CD, FNL_MNU_ID, FRT_REGI_DH, FNL_MDF_DH)
			VALUES (B.SUC_REQ_DVSN_CD,B.SUC_ACP_YR,B.SUC_CVPT_ACP_NO,#{dge},
			        #{fnlDealDptCd},#{fnlUsrId},#{inspcRsltUnqTxt},#{docId},#{docTypCd},#{rplDt},
			        #{fnlUsrId},#{fnlUsrId},#{fnlDealDptCd},#{fnlMnuId},SYSDATE,SYSDATE)
        ]]>
	</insert>
	
	<insert id="COR005007E402SUCMERGE" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007E402SUCMERGE */
        <![CDATA[
			MERGE INTO TBCORCOR402L A
			USING (SELECT SUC_REQ_DVSN_CD, SUC_ACP_YR, SUC_CVPT_ACP_NO,  #{dge} AS DGE
					FROM TBCORCOR105L 
				   WHERE REQ_DVSN_CD =#{reqDvsnCd} AND ACP_YR = #{acpYr} AND CVPT_ACP_NO =#{cvptAcpNo}
				   ) B
			ON (A.REQ_DVSN_CD = B.SUC_REQ_DVSN_CD
			    AND A.ACP_YR = B.SUC_ACP_YR
			    AND A.DGE = B.DGE
			    AND A.CVPT_ACP_NO = B.SUC_CVPT_ACP_NO)
			WHEN MATCHED THEN
			UPDATE SET
					 A.RSLT_RPRT_HNDL_RSLT_CD = #{rsltRprtHndlRsltCd}
				   	,A.FNL_USR_ID = #{fnlUsrId}
					,A.FNL_DEAL_DPT_CD = #{fnlDealDptCd}
					,A.FNL_MNU_ID = #{fnlMnuId}
					,A.FNL_MDF_DH = SYSDATE
			WHEN NOT MATCHED THEN
			INSERT (REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO, DGE,
			        RSLT_RPRT_HNDL_RSLT_CD,
			        FRT_USR_ID, FNL_USR_ID, FNL_DEAL_DPT_CD, FNL_MNU_ID, FRT_REGI_DH, FNL_MDF_DH)
			VALUES (B.SUC_REQ_DVSN_CD,B.SUC_ACP_YR, B.SUC_CVPT_ACP_NO,#{dge},
			        #{rsltRprtHndlRsltCd},
			        #{fnlUsrId},#{fnlUsrId},#{fnlDealDptCd},#{fnlMnuId},SYSDATE,SYSDATE)
        ]]>
	</insert>
	
	<update id="COR005007E401SucAnsUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007E401SucAnsUpdate */
		<![CDATA[
			UPDATE	/*COR005007E401AnsUpdate*/ TBCORCOR401H
			SET		SMG_CVPT_HNDL_DVSN_CD = #{smgCvptHndlDvsnCd}
					,OPM_NTF_DVSN_CD = #{opmNtfDvsnCd}
					,ANS_DOC_ID = #{ansDocId}
					,ANS_DOC_TYP_CD = #{ansDocTypCd}
					,ANS_TXT = #{ansTxt}
					,FNL_USR_ID = #{fnlUsrId}
					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
					,FNL_MNU_ID = #{fnlMnuId}
					,FNL_MDF_DH = SYSDATE
			WHERE	(REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO ) IN (SELECT	SUC_REQ_DVSN_CD
																	,SUC_ACP_YR
																	,SUC_CVPT_ACP_NO
															FROM	TBCORCOR105L
															WHERE	REQ_DVSN_CD = #{reqDvsnCd}
															AND		ACP_YR = #{acpYr}
															AND		CVPT_ACP_NO = #{cvptAcpNo}
															)
			AND		DGE = #{dge}
		]]>
	</update>
	
	<update id="COR005007ESucHoseSendUpdate" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007ESucHoseSendUpdate */
		<![CDATA[
			UPDATE	TBCORCOR401H D1
			SET		HNDL_RSLT_NTF_YN = 'Y'
					,FNL_USR_ID = #{fnlUsrId}
					,FNL_DEAL_DPT_CD = #{fnlDealDptCd}
					,FNL_MNU_ID = #{fnlMnuId}
					,FNL_MDF_DH = SYSDATE
			WHERE	(REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO ) IN (SELECT	SUC_REQ_DVSN_CD
																	,SUC_ACP_YR
																	,SUC_CVPT_ACP_NO
															FROM	TBCORCOR105L
															WHERE	REQ_DVSN_CD = #{reqDvsnCd}
															AND		ACP_YR = #{acpYr}
															AND		CVPT_ACP_NO = #{cvptAcpNo}
															)
			AND		DGE = #{dge}
		]]>
	</update>
	
	<insert id="CSPDCP515ESucSmgInsert" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.CSPDCP515ESucSmgInsert */
		<![CDATA[
			INSERT INTO	T_IC_TARGET_SRC_INTERFACE
						(	INTERFACE_KEY
							,APP_ORGAN_CODE		/*최초 민원 신청 기관코드(GCC)*/
							,PETI_NO			/*민원신청번호*/
							,REC_SEQ			/*분류이력일련번호*/
							,CIVIL_NO			/*민원접수번호*/
							,PETI_GUBUN			/*민원구분 (500고정,담당자부서지정) */
							,CANCEL_STATUS		/*민원취하여부(Default N)*/
							,PCD_DEPT			/*GCC 부서코드 (접수부서코드)*/
							,PCD_DEPT_NM		/*GCC 부서명 (접수부서명)*/
							,PCD_DUTY_ID		/*접수자명*/
							,PCD_EMAIL			/*접수 이메일 (대표이메일 사용, 감청국, 센터 로 분류)*/
							,PCD_TEL			/*접수자 전화번호 (대표전화 사용: 감청국, 센터로 분류)*/
							,PCD_ORGAN_CODE 	/*실처리기관코드 (감사원 GCC 코드로 고정)*/
							,SRCORGCD			/*소스기관코드 (감사원 GCC 코드로 고정)*/
							,TGTORGCD			/*타겟기관코드 (신문고 GCC 코드로 고정)*/
							,WRITE_TIME			/*등록일자*/
							,SND_RCV_GUBUN		/*송수신구분 (1:송신, 2:수신)*/
							,SND_RCV_TIME		/*송수신일자*/
							,SEND_YN			/*송신여부 (N DEFAULT, EAI 가 송신후 Y로 변경함)*/
						)
				SELECT	TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF2') || LPAD(ROUND(DBMS_RANDOM.VALUE(1, 999999999)), 9, '0')
						,SMG_FRT_CVPT_APL_GCC_ORG_CD
							,SMG_CVPT_APL_NO
							,SMG_CAT_HST_SRNO
							,SMG_CVPT_ACP_NO
							,'500'
							,'N'
							,(	SELECT	SUBSTR(STND_DPT_CD,9,7)
		   						FROM 	TBDCMACM002M S1
		   						WHERE 	S1.DPT_CD = #{fnlDealDptCd}
		   						) 
							,(	SELECT	S2.ALL_ORG_NM
		   						FROM 	TBDCMACM002M S1
		   								,TBCSPIIT006M S2
		   						WHERE 	S1.DPT_CD = #{fnlDealDptCd}
		   						AND		S2.GCC_ORG_CD = SUBSTR(S1.STND_DPT_CD,9,7)
		   						AND ROWNUM = 1
		   						)  
							,F_USR_INFO(#{sCnb},'2')
							,''
							,'02-2011-2191'
							,'1040000'
							,'1040000'
							,'1140100'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'1'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
							,'N'
				FROM	TBCORCOR101M A
				WHERE	(REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO ) IN (SELECT	SUC_REQ_DVSN_CD
																	,SUC_ACP_YR
																	,SUC_CVPT_ACP_NO
															FROM	TBCORCOR105L
															WHERE	REQ_DVSN_CD = #{reqDvsnCd}
															AND		ACP_YR = #{acpYr}
															AND		CVPT_ACP_NO = #{cvptAcpNo}
															)
				AND		A.ACP_RUT_CD = '8'
		]]>
	</insert>
	
	<insert id="COR005007ESucSmgNtfInsert" parameterType="paramMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.COR005007ESmgNtfInsert */
		<![CDATA[
			INSERT INTO	T_IC_TARGET_SRC_INTERFACE
						(	INTERFACE_KEY
							,APP_ORGAN_CODE		/*최초 민원 신청 기관코드(GCC)*/
							,PETI_NO			/*민원신청번호*/
							,REC_SEQ			/*분류이력일련번호*/
							,CIVIL_NO			/*민원접수번호*/
							,PETI_GUBUN			/*민원구분 (500고정,담당자부서지정) */
							,CANCEL_STATUS		/*민원취하여부(Default N)*/
							,PCD_DEPT			/*GCC 부서코드 (접수부서코드)*/
							,PCD_DEPT_NM		/*GCC 부서명 (접수부서명)*/
							,PCD_DUTY_ID		/*접수자명*/
							,PCD_EMAIL			/*접수 이메일 (대표이메일 사용, 감청국, 센터 로 분류)*/
							,PCD_TEL			/*접수자 전화번호 (대표전화 사용: 감청국, 센터로 분류)*/
							,PCD_CONTENTS		/*민원 처리결과 내용*/
							,PCD_REG_DATE		/*처리일자*/
							,PCD_CONTENTS_ATTACH_YN	/*민원처리결과첨부여부*/
							,PCD_GUBUN			/*신문고민원 처리구분코드*/
							,PCD_ORGAN_CODE 	/*실처리기관코드 (감사원 GCC 코드로 고정)*/
							,SRCORGCD			/*소스기관코드 (감사원 GCC 코드로 고정)*/
							,TGTORGCD			/*타겟기관코드 (신문고 GCC 코드로 고정)*/
							,WRITE_TIME			/*등록일자*/
							,SND_RCV_GUBUN		/*송수신구분 (1:송신, 2:수신)*/
							,SND_RCV_TIME		/*송수신일자*/
							,SEND_YN			/*송신여부 (N DEFAULT, EAI 가 송신후 Y로 변경함)*/
						)
				SELECT	TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF2') || LPAD(ROUND(DBMS_RANDOM.VALUE(1, 999999999)), 9, '0')
						,SMG_FRT_CVPT_APL_GCC_ORG_CD
							,SMG_CVPT_APL_NO
							,SMG_CAT_HST_SRNO
							,SMG_CVPT_ACP_NO
							,DECODE(SMG_FRT_HNDL_STA_CD, '161','181', '163','183')
							,'N'
							,F_DPT_INFO(#{fnlDealDptCd},'6')
							,F_DPT_INFO(#{fnlDealDptCd},'7')
							,F_USR_INFO(#{sCnb},'2')
							,''
							,'02-2011-2191'
							,#{ansTxt}
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'N'
							,#{smgCvptHndlDvsnCd}
							,'1040000'
							,'1040000'
							,'1140100'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'1'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
							,'N'
				FROM	TBCORCOR101M A
				WHERE	(REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO ) IN (SELECT	SUC_REQ_DVSN_CD
																	,SUC_ACP_YR
																	,SUC_CVPT_ACP_NO
															FROM	TBCORCOR105L
															WHERE	REQ_DVSN_CD = #{reqDvsnCd}
															AND		ACP_YR = #{acpYr}
															AND		CVPT_ACP_NO = #{cvptAcpNo}
															)
				AND		A.ACP_RUT_CD = '8'
		]]>
	</insert>
	
	<select id="CSPDCP515EAudInfTrfDvsnCdCheckSelect" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.cor.cor.dao.COR005001EMapper.CSPDCP515EAudInfTrfDvsnCdCheckSelect */
		<![CDATA[
			SELECT	D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO
			FROM	TBCORCOR402L D1
			WHERE	D1.REQ_DVSN_CD = #{reqDvsnCd}
			AND		D1.ACP_YR = #{acpYr}
			AND		D1.CVPT_ACP_NO = #{cvptAcpNo}
			AND		D1.RSLT_RPRT_HNDL_RSLT_CD = '80'
		]]>
	</select>
</mapper>
