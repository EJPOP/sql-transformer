<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.osm.dao.AEPOSM001PMapper">
    
    <select id="selectPageCnt" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM001PMapper.selectPageCnt*/
         SELECT CASE WHEN MAX(A.SBCN_SNO) IS NULL THEN (SELECT NVL(MAX(SBCN_PAGE_CNT)+1,'1') AS CNT
                                                          FROM TBBADDED113M
                                                         WHERE SUBSTR(SBCN_DY,1,4) = SUBSTR(REPLACE(#{cmtDy},'-'),1,4))
                     WHEN (MAX(A.CMT_SBJ_SNO) IS NOT NULL AND MAX(A.SBCN_SNO) <![CDATA[<]]> (SELECT NVL(MAX(SBCN_PAGE_CNT)+1,'1') AS CNT
                                                                                                FROM TBBADDED113M
                                                                                               WHERE SUBSTR(SBCN_DY,1,4) = SUBSTR(REPLACE(#{cmtDy},'-'),1,4))) THEN (SELECT NVL(MAX(SBCN_PAGE_CNT)+1,'1') AS CNT
                                                                                                                                                                       FROM TBBADDED113M
                                                                                                                                                                      WHERE SUBSTR(SBCN_DY,1,4) = SUBSTR(REPLACE(#{cmtDy},'-'),1,4))
                     ELSE MAX(A.SBCN_SNO)+1 END AS SBCN_PAGE_CNT
           FROM TBBADDED121M AS A
          WHERE A.CMT_DY = REPLACE(#{cmtDy},'-')
            AND A.CMT_DVSN_CD = #{cmtDvsnCd}
            AND A.CMT_SQ = #{cmtSq}
    </select>
    
    <insert id="insertBADDED121M" parameterType="paramMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM001PMapper.insertBADDED121M*/
        INSERT INTO TBBADDED121M(CMT_DY,
                                 CMT_DVSN_CD,
                                 CMT_SQ,
                                 CMT_SBJ_DVSN_CD,
                                 CMT_SBJ_SNO,
                                 CMT_SBJ_TIT,
                                 REL_DPT_CD,
                                 CMT_ADD_YN,
                                 FRT_USR_ID,
                                 FNL_USR_ID,
                                 FNL_DEAL_DPT_CD,
                                 FNL_MNU_ID,
                                 FRT_REGI_DH,
                                 FNL_MDF_DH,
                                 WORK_DVSN_CD,
                                 PRSS_DPT_NM,
                                 REGI_NO,
                                 SBCN_RPTR)
                          VALUES(REPLACE(#{cmtDy},'-'),
                                 #{cmtDvsnCd},
                                 #{cmtSq},
                                 '90',
                                 (SELECT NVL(MAX(CMT_SBJ_SNO)+1,'1') FROM TBBADDED121M WHERE CMT_DY = REPLACE(#{cmtDy},'-') AND CMT_DVSN_CD = #{cmtDvsnCd} AND CMT_SQ = #{cmtSq}),
                                 #{cmtSbjTit},
                                 #{relDptCd},
                                 'Y',
                                 #{usrId},
                                 #{usrId},
                                 #{dptCd},
                                 #{menuNo},
                                 SYSDATE,
                                 SYSDATE,
                                 'Z90',
                                 #{prssDptNm},
                                 #{regiNo},
                                 #{sbcnRptr})
    </insert>
    
</mapper>