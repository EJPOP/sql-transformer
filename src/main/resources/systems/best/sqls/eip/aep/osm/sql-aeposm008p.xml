<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.osm.dao.AEPOSM008PMapper">
    
    <select id="selectMainInfo" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM008PMapper.selectMainInfo*/
   <![CDATA[       
     SELECT C.NO
                    ,C.CMT_DY
                    ,C.CMT_SQ
                    ,C.CMT_DVSN_CD
                    ,C.CMT_SBJ_DVSN_CD
                    ,C.CMT_SBJ_SNO
                    ,C.CMT_SBJ_DTL_SNO
                    ,C.CMT_SBJ_DTL_TIT
                    ,F_CODE_NM('1000176' ,F_USR_INFO_BY_ID(C.ID, '4')) AS CNB_NM /*직급먕*/
                    ,F_USR_INFO_BY_ID(C.ID, '2') AS CMTR_NM   /*성원명*/
                    ,D.CMTR_SBCN_YN
                    ,DECODE(D.CMTR_SBCN_YN, 'Y', '가', 'N', '부', '미정') AS CMTR_SBCN_NM /*의결여부 명*/
                    ,C.ID
                    ,D.CMTR_SNO
                    ,D.SBCN_VT_TXT    /*비고*/
                    ,c.DOC_ID
               FROM
             (SELECT A.NO
                   ,A.CMT_DY
                   ,A.CMT_DVSN_CD
                   ,A.CMT_SQ
                   ,A.ID
                   ,B.CMT_SBJ_DVSN_CD
                   ,B.CMT_SBJ_SNO
                   ,B.CMT_SBJ_DTL_SNO
                   ,B.CMT_SBJ_DTL_TIT
                   ,NVL(B.DOC_ID,'-') AS DOC_ID
             FROM (SELECT N.NO
                          ,T.CMT_SQ
                          ,T.CMT_DY
                          ,T.CMT_DVSN_CD
                          ,DECODE(N.NO,1,T.CHF_CMTR_ID, 2, T.CMTR1_ID, 3, T.CMTR2_ID, 4, T.CMTR3_ID, 5, T.CMTR4_ID, 6, T.CMTR5_ID, 7, T.CMTR6_ID) AS  ID
                      FROM TBBADDED120M AS T,
                      (SELECT LEVEL NO FROM DUAL CONNECT BY LEVEL <= 7) N
                     WHERE 1=1
                       AND T.CMT_DVSN_CD = '30'
                       AND T.CMT_SQ = 2) A INNER JOIN TBBADDED122M B
                      ON A.CMT_DY  =B.CMT_DY
                     AND A.CMT_DVSN_CD = B.CMT_DVSN_CD
                     AND A.CMT_SQ = B.CMT_SQ
             WHERE A.ID IS NOT NULL ) C LEFT OUTER JOIN TBBADDED123M D
                ON C.CMT_DY = D.CMT_DY                  
               AND C.CMT_DVSN_CD = D.CMT_DVSN_CD        
               AND C.CMT_SQ = D.CMT_SQ                  
               AND C.ID = D.CMTR_ID                          
               AND C.CMT_SBJ_DVSN_CD = D.CMT_SBJ_DVSN_CD
               AND C.CMT_SBJ_SNO = D.CMT_SBJ_SNO        
               AND C.CMT_SBJ_DTL_SNO = D.CMT_SBJ_DTL_SNO
             WHERE C.CMT_DY =  REPLACE(#{cmtDy},'-') /*PARAM 회의일자*/
             AND C.CMT_DVSN_CD = #{cmtDvsnCd}  /*PARAM 회의구분코드*/
               AND C.CMT_SQ = #{cmtSq}  /*PARAM 회의회차*/
               AND C.CMT_SBJ_DVSN_CD = #{cmtSbjDvsnCd}  /*PARAM 안건구분코드*/
               AND C.CMT_SBJ_SNO = #{cmtSbjSno}    /*PARAM 회의안건순번*/
               AND C.CMT_SBJ_DTL_SNO = #{cmtSbjDtlSno}    /*PARAM 회의상세안건 순번*/
               AND C.ID = #{id}    /*PARAM 아이디 */
             ORDER BY C.NO
              ]]>
    </select>
    
    <select id="selectBADDED123M" parameterType="paramMap" resultType="java.lang.Integer">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM008PMapper.selectBADDED123M*/
       <![CDATA[       
                         SELECT COUNT(CMTR_SNO) AS CNT
                         FROM TBBADDED123M
                         WHERE CMT_DY = REPLACE(#{cmtDy},'-')
                         AND CMT_DVSN_CD = #{cmtDvsnCd}
                         AND CMT_SQ = ${cmtSq}
                         AND CMT_SBJ_DVSN_CD = #{cmtSbjDvsnCd}
                         AND CMT_SBJ_SNO = #{cmtSbjSno}
                         AND CMT_SBJ_DTL_SNO = #{cmtSbjDtlSno}
                         AND CMTR_SNO = #{cmtrSno}
              ]]>
    </select>
    
    <update id="updateBADDED123M" parameterType="paramMap" >
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM008PMapper.updateBADDED123M*/
          <![CDATA[
                       UPDATE TBBADDED123M 
                       SET CMTR_SBCN_YN = #{cmtrSbcnYn},
                             SBCN_VT_TXT = #{sbcnVtTxt},
                             FNL_USR_ID = #{usrId},
                             FNL_DEAL_DPT_CD = #{dptCd},
                             FNL_MNU_ID = #{menuNo},
                             FNL_MDF_DH = SYSDATE
                       WHERE CMT_DY = REPLACE(#{cmtDy},'-')
                         AND CMT_DVSN_CD = #{cmtDvsnCd}
                         AND CMT_SQ = ${cmtSq}
                         AND CMT_SBJ_DVSN_CD = #{cmtSbjDvsnCd}
                         AND CMT_SBJ_SNO = ${cmtSbjSno}
                         AND CMT_SBJ_DTL_SNO = ${cmtSbjDtlSno}
                         AND CMTR_SNO = #{cmtrSno}
          ]]>
    </update>
    
      <insert id="insertBADDED123M" parameterType="paramMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM008PMapper.insertBADDED123M*/
          <![CDATA[
                     INSERT INTO TBBADDED123M( 
                          CMT_DY
                         ,CMT_DVSN_CD
                         ,CMT_SQ
                         ,CMT_SBJ_DVSN_CD
                         ,CMT_SBJ_SNO
                         ,CMT_SBJ_DTL_SNO
                         ,CMTR_SNO
                         ,CMTR_ID
                         ,CMTR_SBCN_YN
                         ,SBCN_VT_TXT
                         ,FRT_USR_ID
                         ,FNL_USR_ID
                         ,FNL_DEAL_DPT_CD
                         ,FNL_MNU_ID
                         ,FRT_REGI_DH
                         ,FNL_MDF_DH 
                         )
                     VALUES (
                         #{cmtDy}        /*TBBADDED122 TABLE 의 CMT_DY*/
                         ,#{cmtDvsnCd}    /*TBBADDED122 TABLE 의 CMT_DVSN_CD*/
                         ,${cmtSq}        /*TBBADDED122 TABLE 의 CMT_SQ*/
                         ,#{cmtSbjDvsnCd} /*TBBADDED122 TABLE 의 CMT_SBJ_DVSN_CD */
                         ,${cmtSbjSno}    /*TBBADDED122 TABLE 의 CMT_SBJ_SNO*/
                         ,${cmtSbjDtlSno} /*TBBADDED122 TABLE 의 CMT_SBJ_DTL_SNO */
                         ,#{no}           /*CMTR_SNO*/
                         ,#{id}       /*CMTR_ID*/
                         ,#{cmtrSbcnYn}   /*CMTR_SBCN_YN*/
                         ,#{sbcnVtTxt}    /*SBCN_VT_TXT*/
                         ,#{usrId} /*FRT_USR_ID*/
                         ,#{usrId} /*FNL_USR_ID*/
                         ,#{dptCd} /*FNL_DEAL_DPT_CD*/
                         ,#{menuNo}/*FNL_MNU_ID*/
                         ,SYSDATE         /*FRT_REGI_DH*/
                         ,SYSDATE         /*FNL_MDF_DH*/
                        )
           ]]>
    </insert>
    
</mapper>