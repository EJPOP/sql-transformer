<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.asb.dao.AEPASB004QMapper">

    <select id="selectAsbList" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB004QMapper.selectAsbList */
		<![CDATA[
			SELECT 
				A.AUD_YR,
				A.AUD_NO,
                F_MNG_KND_AUDYRNO(M.AUD_YR, M.AUD_NO, M.AUD_KND_CD, '-')    AS AUD_YR_NO,    /*감사연번호*/
                AUD_SBJ_NM,
			    A.DCS_SNO, 
			    A.DCS_DSVN_CD, 
			    CASE 
			        WHEN A.DCS_DSVN_CD = '1' THEN '부의'
			        WHEN A.DCS_DSVN_CD = '2' THEN '분리부의'
			        WHEN A.DCS_DSVN_CD = '3' THEN '재부의'
			    END AS DCS_DSVN_NM,
			    TO_CHAR(to_date(A.DCS_DATE),'YYYY"-"MM"-"DD') AS DCS_DATE, 
			    F_USR_INFO(A.CHF_MB_CNB,'2') AS CHF_MB_NM, 
			    A.CHF_MB_CNB,
			    A.DCS_STATE,
			    CASE 
			        WHEN DCS_STATE = '001' THEN '부의사항접수대장 작성'
			        WHEN DCS_STATE = '002' THEN '주심위원 설명자료 작성'
			        WHEN DCS_STATE = '003' THEN '주심위원 검토'
			        WHEN DCS_STATE = '004' THEN '처리안변경 검토보고서 작성'
			        WHEN DCS_STATE = '005' THEN '감사보고서 작성'
			        WHEN DCS_STATE = '006' THEN '부의번호등재대장 작성'
			        WHEN DCS_STATE = '007' THEN '감사위원회 심의'
			        WHEN DCS_STATE = '008' THEN '부의사항처리부 및 보류사항정리부 작성'
			        WHEN DCS_STATE = '009' THEN '변경의결사항대조표 작성'
			        WHEN DCS_STATE = '010' THEN '부의 완료'
			    END AS DCS_STATE_NM,
			    (SELECT COUNT(1) 
                FROM TBAEPASB002D B, tbbadear001m C
                WHERE B.AUD_YR = A.AUD_YR
                AND B.AUD_NO = A.AUD_NO
                AND B.DCS_SNO = A.DCS_SNO
                AND B.AUD_YR = C.AUD_YR
                AND B.AUD_NO = C.AUD_NO
                AND B.DSP_RQ_SNO = C.DSP_RQ_SNO
                AND C.DSP_RQ_KND_CD IN ('610','611','620','621','623','630','904','905','914')
                )
                AS ADV_CNT,
			    (SELECT COUNT(1) 
                FROM TBAEPASB002D B, tbbadear001m C
                WHERE B.AUD_YR = A.AUD_YR
                AND B.AUD_NO = A.AUD_NO
                AND B.DCS_SNO = A.DCS_SNO
                AND B.AUD_YR = C.AUD_YR
                AND B.AUD_NO = C.AUD_NO
                AND B.DSP_RQ_SNO = C.DSP_RQ_SNO
                AND C.DSP_RQ_KND_CD NOT IN ('610','611','620','621','623','630','904','905','914')
                ) AS DSP_RQ_CNT,
                A.DCS_RCD_NO,																/*등재번호*/
                A.DCS_PAGE_NO,															/*부의면수*/
                A.DCS_TOT_NO,																/*부의회수*/
                F_DPT_INFO(M.MNG_DPT_CD,'1') 		AS MNG_DPT_NM
			FROM TBAEPASB001M A, TBBADDED001M M
            WHERE A.AUD_YR = M.AUD_YR
            AND A.AUD_NO = M.AUD_NO
            ]]>
        <if test='iptAudYr != null and iptAudYr != ""'>
            AND M.AUD_YR = #{iptAudYr}
        </if>
        <if test='iptAudGrnNo != null and iptAudGrnNo != ""'>
            AND M.AUD_GRN_NO = #{iptAudGrnNo}
        </if>
        <if test='cbAudKndCd != null and cbAudKndCd != ""'>
            AND M.AUD_KND_CD = #{cbAudKndCd}
        </if>
        <if test='iptAudSbjNm != null and iptAudSbjNm != ""'>
            AND M.AUD_SBJ_NM LIKE '%'||#{iptAudSbjNm}||'%'
        </if>
        <if test='dipEnfDtFrom != null and dipEnfDtFrom != ""'>
            AND TO_DATE(A.DCS_DATE) &gt;= TO_DATE(#{dipEnfDtFrom})
        </if>
        <if test='dipEnfDtTo != null and dipEnfDtTo != ""'>
            AND TO_DATE(A.DCS_DATE) &lt;= TO_DATE(#{dipEnfDtTo})
        </if>
        <if test="schSpvBrdvCd != null and schSpvBrdvCd != ''">
            AND (SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = M.MNG_DPT_CD) =
            #{schSpvBrdvCd}
        </if>
        <if test="schDeptCd != null and schDeptCd != ''">
            AND M.MNG_DPT_CD = #{schDeptCd}
        </if>
        <if test='cbDcsDsvnCd != null and cbDcsDsvnCd != ""'>
            AND A.DCS_DSVN_CD = #{cbDcsDsvnCd}
        </if>
        <if test='iptDcsTotNo != null and iptDcsTotNo != ""'>
            AND A.DCS_TOT_NO = #{iptDcsTotNo}
        </if>
        <if test='iptChfMbCnb != null and iptChfMbCnb != ""'>
            AND A.CHF_MB_CNB = #{iptChfMbCnb}
        </if>
        <if test='cbDcsState != null and cbDcsState != ""'>
            AND A.DCS_STATE = #{cbDcsState}
        </if>
			<![CDATA[
			order by A.DCS_TOT_NO, A.AUD_YR, A.AUD_NO, A.DCS_SNO asc
			]]>

    </select>

    <select id="selectNowDate" resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB004QMapper.selectNowDate */
 		<![CDATA[
 		SELECT 
 			TO_CHAR(SYSDATE,'YYYY-MM-DD') AS NOW_DATE
 		FROM DUAL
 		]]>
    </select>

</mapper> 
