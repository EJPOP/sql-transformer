<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.afu.dao.AEPAFU003PMapper">

    <select id="selectMainList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.afu.dao.AEPAFU003PMapper.selectMainList*/
        <include refid="include.pageSelct" />
            <![CDATA[
            SELECT T1.DVSN_CD,
                   F_CODE_NM('1000740',T1.DVSN_CD) AS DVSN_NM,
                   T1.SRNO,
                   T1.KEY1 AS TSK_KEY1,
                   T1.KEY2 AS TSK_KEY2,
                   T1.KEY3 AS TSK_KEY3,
                   T1.KEY4 AS TSK_KEY4,
                   T1.KEY1||'-'||T1.KEY2||'-'||T1.KEY3 AS SUM_KEY,
                   T1.TITLE AS TIT_NM
             FROM ( SELECT A.REQ_DVSN_CD AS DVSN_CD,
                           A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||A.RM_CVPT_ACP_NO  AS SRNO,
                           A.ACP_YR AS KEY1,
                           A.REQ_DVSN_CD AS KEY2,
                           A.CVPT_ACP_NO AS KEY3,
                           '' AS KEY4,
                           A.TIT_NM AS TITLE
                      FROM TBCSPDCP101M A
                     WHERE 1 = 1
                       AND A.CVPT_HNDL_STA_CD NOT IN ('10')
                       AND A.RM_CVPT_ACP_NO IS NOT NULL
                       AND TO_CHAR(A.ACP_DH,'YYYYMMDD') BETWEEN NVL(REPLACE(#{schStartDt},'-',''),'19000101') AND NVL(REPLACE(#{schEndDt},'-',''),'99991231')
                    ]]>
                    <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
                        AND '1' = CASE WHEN #{schReqDvsnCd} IN ('1','2','3') THEN '1'
                                    ELSE '0' END
                        AND A.REQ_DVSN_CD = #{schReqDvsnCd}
                    </if>
                    <if test="schYr != null and schYr != ''">
                        AND A.ACP_YR = #{schYr}
                    </if>
                    <if test="schCvptAcpNo != null and schCvptAcpNo != ''">
                    	<if test="schReqDvsnCd == '2' or schReqDvsnCd == '3'">
                        	AND A.CVPT_ACP_NO = #{schCvptAcpNo}
                        </if>
                        <if test="schReqDvsnCd != null and schReqDvsnCd != '2' and schReqDvsnCd != '3'">
                        	AND A.RM_CVPT_ACP_NO = #{schCvptAcpNo}
                        </if>
                        <if test="schReqDvsnCd == null">
                            AND (A.RM_CVPT_ACP_NO = #{schCvptAcpNo} OR A.CVPT_ACP_NO = #{schCvptAcpNo})
                        </if>
                    </if>
                    <if test="schCvptrNm != null and schCvptrNm != ''">
                        AND A.CVPTR_NM LIKE '%' || #{schCvptrNm} || '%'    
                    </if>
                    <if test="schTitNm != null and schTitNm != ''">
                        AND A.TIT_NM LIKE '%' || #{schTitNm} || '%'
                    </if>
                    <![CDATA[
                    UNION ALL
                    SELECT A.REQ_DVSN_CD AS DVSN_CD,
                           A.ACP_YR||'-국회-'||A.CVPT_ACP_NO AS SRNO,
                           A.ACP_YR AS KEY1,
                           A.REQ_DVSN_CD AS KEY2,
                           A.CVPT_ACP_NO AS KEY3,
                           '' AS KEY4,
                           A.AUD_REQ_TIT_NM AS TITLE
                      FROM TBCSPEAR007M A
                     WHERE 1=1
                      AND A.REQ_DT BETWEEN NVL(REPLACE(#{schStartDt},'-',''),'19000101') AND NVL(REPLACE(#{schEndDt},'-',''),'99991231')
                    ]]>
                    <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
                        AND A.REQ_DVSN_CD = #{schReqDvsnCd}
                    </if>
                    <if test="schYr != null and schYr != ''">
                        AND A.ACP_YR = #{schYr}
                    </if>
                    <if test="schCvptAcpNo != null and schCvptAcpNo != ''">
                        AND A.CVPT_ACP_NO = #{schCvptAcpNo}
                    </if>
                    <if test="schCvptrNm != null and schCvptrNm != ''">
                        AND A.CHGR_NM LIKE '%' || #{schCvptrNm} || '%'    
                    </if>
                    <if test="schTitNm != null and schTitNm != ''">
                        AND A.AUD_REQ_TIT_NM LIKE '%' || #{schTitNm} || '%'
                    </if>
                    <![CDATA[
                    UNION ALL
                        SELECT '0' AS DVSN_CD,
                               A.YE||'-정보-'||A.SRNO AS SRNO,
                               A.YE AS KEY1,
                               TO_CHAR(A.SRNO) AS KEY2,
                               '' AS KEY3,
                               '' AS KEY4,
                               A.TIT_TXT AS TITLE
                          FROM TBCSPBII100M A
                         WHERE 1=1
                          AND A.ACP_DT BETWEEN NVL(REPLACE(#{schStartDt},'-',''),'19000101') AND NVL(REPLACE(#{schEndDt},'-',''),'99991231')
                    ]]>
                    <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
                        AND '0' = #{schReqDvsnCd}
                    </if>
                    <if test="schYr != null and schYr != ''">
                        AND A.YE = #{schYr}
                    </if>
                    <if test="schCvptAcpNo != null and schCvptAcpNo != ''">
                         AND A.SRNO = #{schCvptAcpNo}
                    </if>
                    <if test="schTitNm != null and schTitNm != ''">
                        AND A.TIT_TXT LIKE '%' || #{schTitNm} || '%'
                    </if>
                    <![CDATA[
                    UNION ALL
                        SELECT CASE WHEN ACP_DVSN_CD = '1' THEN '5'
                                    WHEN ACP_DVSN_CD = '2' THEN '6'
                                    WHEN ACP_DVSN_CD = '3' THEN '7'
                                    END AS DVSN_CD,
                               CASE WHEN ACP_YR >= '2016'
                                    THEN ACP_YR || '-' || DECODE(ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || ACP_SRNO
                                    ELSE ACP_YR || '-' || ACP_DVSN_CD || '-' || ACP_SRNO
                                    END AS SRNO,
                               ACP_YR AS KEY1,
                               ACP_DVSN_CD AS KEY2,
                               TO_CHAR(ACP_SRNO) AS KEY3,
                               DPT_CD AS KEY4,
                               TIT_NM AS TITLE
                          FROM TBBADFRE012M
                         WHERE 1 = 1
                           AND ACP_DT BETWEEN NVL(REPLACE(#{schStartDt},'-',''),'19000101') AND NVL(REPLACE(#{schEndDt},'-',''),'99991231')
                    ]]>
                    <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
                        AND '1' = CASE WHEN #{schReqDvsnCd} IN ('5','6','7') THEN '1'
                                     ELSE '0' END
                        AND ACP_DVSN_CD = CASE WHEN #{schReqDvsnCd}= '5' THEN '1'
                                               WHEN #{schReqDvsnCd} = '6' THEN '2'
                                               WHEN #{schReqDvsnCd} = '7' THEN '3'
                                               END
                    </if>
                    <if test="schYr != null and schYr != ''">
                        AND ACP_YR = #{schYr}
                    </if>
                    <if test="schCvptAcpNo != null and schCvptAcpNo != ''">
                        AND ACP_SRNO = #{schCvptAcpNo}
                    </if>
                    <if test="schCvptrNm != null and schCvptrNm != ''">
                        AND REQR_NM LIKE '%' || #{schCvptrNm} || '%'    
                    </if>
                    <if test="schTitNm != null and schTitNm != ''">
                        AND TIT_NM LIKE '%' || #{schTitNm} || '%'
                    </if>
                    <![CDATA[
                    UNION ALL
                        SELECT '8' AS DVSN_CD,
                               T1.YR||'-손망-'||T1.ACP_NO AS SRNO,
                               T1.ORG_CD AS KEY1,
                               T1.NTF_DVSN_CD AS KEY2,
                               T1.NNB AS KEY3,
                               '' AS KEY4,
                               T1.TIT_NM AS TITLE
                          FROM TBBADGDA001M T1
                         WHERE 1=1
                          AND T1.ACP_DT BETWEEN NVL(REPLACE(#{schStartDt},'-',''),'19000101') AND NVL(REPLACE(#{schEndDt},'-',''),'99991231')
                          AND T1.NTF_DVSN_CD = '2'
                          AND T1.OGN_DVSN_CD IN ('3','4','5')
                    ]]>
                    <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
                        AND '8' = #{schReqDvsnCd}
                    </if>
                    <if test="schYr != null and schYr != ''">
                        AND T1.YR = #{schYr}
                    </if>
                    <if test="schCvptAcpNo != null and schCvptAcpNo != ''">
                        AND T1.ACP_NO = #{schCvptAcpNo}
                    </if>
                    <if test="schCvptrNm != null and schCvptrNm != ''">
                        AND EXISTS (SELECT 1
                                      FROM TBBADGDA001L
                                     WHERE ORG_CD = T1.ORG_CD
                                       AND NTF_DVSN_CD = T1.NTF_DVSN_CD
                                       AND NNB = T1.NNB
                                       AND DFNT_NM LIKE '%' || #{schCvptrNm} || '%')
                    </if>
                    <if test="schTitNm != null and schTitNm != ''">
                        AND T1.TIT_NM LIKE '%' || #{schTitNm} || '%'
                    </if>
                    <![CDATA[
                    UNION ALL
                        SELECT '9' AS DVSN_CD,
                               T1.YR||'-판청-'||T1.ACP_NO AS SRNO, 
                               T1.ORG_CD AS KEY1,
                               T1.NTF_DVSN_CD AS KEY2,
                               T1.NNB AS KEY3,
                               '' AS KEY4,
                               T1.TIT_NM AS TITLE
                          FROM TBBADGDA001M T1
                         WHERE 1=1
                          AND T1.ACP_DT BETWEEN NVL(REPLACE(#{schStartDt},'-',''),'19000101') AND NVL(REPLACE(#{schEndDt},'-',''),'99991231')
                          AND T1.NTF_DVSN_CD = '2'
                          AND T1.OGN_DVSN_CD = '6'
                    ]]>
                    <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
                        AND '9' = #{schReqDvsnCd}
                    </if>
                    <if test="schYr != null and schYr != ''">
                        AND T1.YR = #{schYr}
                    </if>
                    <if test="schCvptAcpNo != null and schCvptAcpNo != ''">
                        AND T1.ACP_NO = #{schCvptAcpNo}
                    </if>
                    <if test="schCvptrNm != null and schCvptrNm != ''">
                        AND EXISTS (SELECT 1
                                      FROM TBBADGDA001L
                                     WHERE ORG_CD = T1.ORG_CD
                                       AND NTF_DVSN_CD = T1.NTF_DVSN_CD
                                       AND NNB = T1.NNB
                                       AND DFNT_NM LIKE '%' || #{schCvptrNm} || '%')
                    </if>
                    <if test="schTitNm != null and schTitNm != ''">
                        AND T1.TIT_NM LIKE '%' || #{schTitNm} || '%'
                    </if>
                    <![CDATA[
                    UNION ALL
                        SELECT 'A' AS DVSN_CD,
                               F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, C.AUD_KND_CD, '-') ||'-'|| A.DSP_RQ_SNO ||'-'|| F_ORG_INFO(B.RLTN_ORG_CD,'1') AS SRNO,
                               A.AUD_YR AS KEY1,
                               A.AUD_NO AS KEY2,
                               TO_CHAR(A.DSP_RQ_SNO) AS KEY3,
                               B.RLTN_ORG_CD AS KEY4,
                               A.TIT_TXT AS TITLE
                          FROM  TBBADEAR001M A,
                                TBBADFRE011M B,
                                TBBADDED001M C
                         WHERE 1=1
                          AND A.AUD_YR = B.AUD_YR 
                          AND A.AUD_NO = B.AUD_NO
                          AND A.DSP_RQ_SNO = B.DSP_RQ_SNO
                          AND B.MNG_SNO = (SELECT MIN(MNG_SNO)
                                             FROM TBBADFRE011M
                                            WHERE AUD_YR = B.AUD_YR 
                                              AND AUD_NO = B.AUD_NO
                                              AND DSP_RQ_SNO = B.DSP_RQ_SNO
                                              AND RLTN_ORG_CD = B.RLTN_ORG_CD)
                          AND A.AUD_YR = C.AUD_YR
                          AND A.AUD_NO = C.AUD_NO 
                          AND NVL(B.ASG_DT,'19000101') BETWEEN NVL(REPLACE(#{schStartDt},'-',''),'19000101') AND NVL(REPLACE(#{schEndDt},'-',''),'99991231')
                    ]]>
                    <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
                        AND 'A' = #{schReqDvsnCd}
                    </if>
                    <if test="schYr != null and schYr != ''">
                        AND A.AUD_YR = #{schYr}
                    </if>
                    <if test="schCvptAcpNo != null and schCvptAcpNo != ''">
                        AND A.DSP_RQ_SNO = #{schCvptAcpNo}
                    </if>
                    
                    
            
            <![CDATA[
                UNION ALL
               /* 2020.12.04 (신)청탁금지법 추가 - 하범용 */
               SELECT 'C'          AS DVSN_CD
                    , ACP_YR || '-청금-' || RM_CVPT_ACP_NO
				                   AS SRNO
				    , ACP_YR       AS KEY1
				    , REQ_DVSN_CD  AS KEY2
				    , CVPT_ACP_NO  AS KEY3
				    , ''           AS KEY4
				    , TIT_NM       AS TITLE
                 FROM TBDCPDCP101M
                WHERE 1=1
			   AND REQ_DVSN_CD     = '6'
			   AND RM_CVPT_ACP_NO IS NOT NULL
			   AND CVPT_WDW_DH    IS NULL
			   AND TO_CHAR(ACP_DH, 'YYYYMMDD')
			                 BETWEEN NVL(REPLACE(#{schStartDt}, '-', ''), '19000101')
                                 AND NVL(REPLACE(#{schEndDt},   '-', ''), '99991231')
			   AND ACP_YR          = #{schYr}
                    
            ]]>
            <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
               AND 'C'             = #{schReqDvsnCd}
            </if>
            
            
            
            <![CDATA[
                UNION ALL
               /* 2020.12.04 (신)부패행위법 추가 - 하범용 */
               SELECT 'D'          AS DVSN_CD
                    , ACP_YR || '-부감-' || RM_CVPT_ACP_NO
                                   AS SRNO
                    , ACP_YR       AS KEY1
                    , REQ_DVSN_CD  AS KEY2
                    , CVPT_ACP_NO  AS KEY3
                    , ''           AS KEY4
                    , TIT_NM       AS TITLE
                 FROM TBCORCOR101M
                WHERE 1=1
                  AND REQ_DVSN_CD     = '5'
                  AND RM_CVPT_ACP_NO IS NOT NULL
                  AND CVPT_WDW_DH    IS NULL
                  AND TO_CHAR(ACP_DH, 'YYYYMMDD')
                                BETWEEN NVL(REPLACE(#{schStartDt}, '-', ''), '19000101')
                                    AND NVL(REPLACE(#{schEndDt},   '-', ''), '99991231')
                  AND ACP_YR          = #{schYr}
                    
            ]]>
            <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
               AND 'D'             = #{schReqDvsnCd}
            </if>
            
            <![CDATA[
                UNION ALL
               /* 2022.10.25 이해충돌 - 전성일 */
               SELECT 'E'          AS DVSN_CD
                    , ACP_YR || '-이해-' || RM_CVPT_ACP_NO
				                   AS SRNO
				    , ACP_YR       AS KEY1
				    , REQ_DVSN_CD  AS KEY2
				    , CVPT_ACP_NO  AS KEY3
				    , ''           AS KEY4
				    , TIT_NM       AS TITLE
                 FROM TBDCPDCP101M
                WHERE 1=1
			   AND REQ_DVSN_CD     = '9'
			   AND RM_CVPT_ACP_NO IS NOT NULL
			   AND CVPT_WDW_DH    IS NULL
			   AND TO_CHAR(ACP_DH, 'YYYYMMDD')
			                 BETWEEN NVL(REPLACE(#{schStartDt}, '-', ''), '19000101')
                                 AND NVL(REPLACE(#{schEndDt},   '-', ''), '99991231')
			   AND ACP_YR          = #{schYr}
                    
            ]]>
            <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
               AND 'E'             = #{schReqDvsnCd}
            </if>
            
                         
            <![CDATA[
                    ) T1,
                      TBDCMACM013C T2
            WHERE T2.CMM_CD_DVSN_CD = '1000742'
              AND T2.CD <> '000000000'
              AND T1.DVSN_CD = T2.CD
              AND T2.USR_DFN_TXT_3 LIKE '1%'
              AND T2.USR_DFN_TXT_3 LIKE '%1'
              ]]>
            <if test="schTitNm != null and schTitNm != ''">
                AND T1.TITLE LIKE '%' || #{schTitNm} || '%'
            </if>
            <if test="schTskDvsnCd != null and schTskDvsnCd != '' and schTskDvsnCd eq '1'.toString()">
              AND T2.USR_DFN_TXT_3 IN ('10','11')
            </if>
            <if test="schTskDvsnCd != null and schTskDvsnCd != '' and schTskDvsnCd eq '2'.toString()">
              AND T2.USR_DFN_TXT_3 IN ('01','11')
            </if>
        <include refid="include.pageOrder" />
    </select>
    
    <insert id="insertMain" parameterType="paramMap">
    /*kr.go.bai.eip.aep.afu.dao.AEPAFU003PMapper.insertMain*/
        INSERT INTO TBBADDED030L(AUD_YR,
                                 AUD_NO,
                                 SRNO,
                                 DVSN_CD,
                                 TSK_KEY1,
                                 TSK_KEY2,
                                 TSK_KEY3,
                                 TSK_KEY4,
                                 FRT_USR_ID,     /*세션정보*/
                                 FRT_REGI_DH,
                                 FNL_USR_ID,
                                 FNL_DEAL_DPT_CD,
                                 FNL_MNU_ID,
                                 FNL_MDF_DH)
                         VALUES (#{audYr},
                                 #{audNo},
                                 (SELECT NVL(MAX(SRNO),0) + 1
                                    FROM TBBADDED030L
                                   WHERE AUD_YR = #{audYr}
                                     AND AUD_NO = #{audNo}),
                                 #{dvsnCd},
                                 #{tskKey1},
                                 #{tskKey2},
                                 #{tskKey3},
                                 #{tskKey4},
                                 #{usrId},
                                 SYSDATE,
                                 #{usrId},
                                 #{dptCd},
                                 #{menuNo},
                                 SYSDATE) 
    </insert>
    
    <update id="updateMain" parameterType="paramMap">
        UPDATE TBBADDED001M SET REQ_DVSN_CD = #{dvsnCd} WHERE AUD_YR = #{audYr} AND AUD_NO = #{audNo}
    </update>
    
</mapper>