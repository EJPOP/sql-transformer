<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.fer.dao.AEPFER002QMapper">
    
    
    <select id="selectAudList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.fer.dao.AEPFER002QMapper.selectAudList*/
        <include refid="include.pageSelct" />
            <![CDATA[
            SELECT D1.AUD_YR AS AUD_YR
                 , D1.AUD_NO AS AUD_NO
                 , D1.AUD_KND_CD AS AUD_KND_CD
                 , D1.AUD_GRN_NO AS AUD_GRN_NO
                 , F_CODE_NM('1000753',D1.AUD_CTRL_CD) AS AUD_CTRL_NM
                 , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-') AS AUD_YR_N0
                 , CASE WHEN D1.AUD_YR >= '2016' 
                        THEN SUBSTR(D1.AUD_KND_CD,3,1)
                        ELSE '' END AS AUD_YR_NO_KND_CD /*감사연번호종류코드*/
                 , CASE WHEN D1.AUD_YR >= '2016' 
                        THEN F_CODE_NM('1000739',D1.AUD_KND_CD)
                        ELSE '-' END AS AUD_YR_NO_KND_NM /*감사연번호종류코드명*/
                 , D1.AUD_YR||'-'||SUBSTR(D1.AUD_TASK_CD,-1)||'-'||D1.ORG_DVSN_CD||'-'||SUBSTR(D1.AUD_KND_CD,-1)
                    ||'-'||SUBSTR(D1.SPV_BRDV_CD,1,2)||SUBSTR(D1.SPV_BRDV_CD,4,2)||'-'||SUBSTR(D1.AUD_WAY_CD,-1)||'-'||D1.AUD_NO AS AUD_DTL_NO /*세부연번호*/
                 , D1.AUD_YR||'-'||D1.AUD_KND_CD||'-'||D1.AUD_NO AS AUD_YR_KND_NO_CD
                 , F_DPT_INFO(D1.SPV_BRDV_CD,'1')        AS SPV_BRDV_NM
                 , F_CODE_NM('1000007', D1.AUD_KND_CD) AS AUD_KND_NM
                 , F_CODE_NM('1000751',D1.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM
                 , D1.AUD_SBJ_NM        AS AUD_SBJ_NM
                 , F_ORG_INFO(D1.AUD_RPST_ORG_CD,'1')  AS AUD_RPST_ORG_NM
                 , F_DPT_INFO(D1.MNG_DPT_CD,'1')         AS MNG_DPT_NM
                 , D1.MNG_DPT_CD         AS  MNG_DPT_CD  /*관리국코드 - 2017.02.01 EUNOK */
                 , F_CODE_NM('1000742',D1.REQ_DVSN_CD) AS REQ_DVSN_NM /*관련업무 코드 변경 1000337 -> 1000742  2017.07.07 EUNOK */
                 , CASE WHEN D1.PRSS_STEP_CD LIKE 'A10%' THEN (SELECT AUD_STEP_NM 
                                                                 FROM TBBADDED101M 
                                                                WHERE AUD_YR = D1.AUD_YR
                                                                  AND AUD_NO = D1.AUD_NO
                                                                  AND AUD_STEP_CD = D1.PRSS_STEP_CD)
                        ELSE F_CODE_NM('1000475',CASE WHEN SUBSTR(D1.AUD_KND_CD,3) = '55' THEN '' 
                                                      WHEN D3.AUD_EXEC_HNDL_STA_CD = '9'  THEN '10'
                                                      ELSE
                                                        CASE WHEN TRIM(D3.ENF_APV_DT) IS NOT NULL THEN '10'
                                                             WHEN TRIM(D3.CHF_CMTR_APV_DT)IS NOT NULL THEN '09'
                                                             WHEN TRIM(D3.OW_DHD_APV_DT)  IS NOT NULL THEN '08'
                                                             WHEN TRIM(D3.JA_JDG_SSEC_APV_DT) IS NOT NULL THEN '07'
                                                             WHEN TRIM(D3.MDT_DDG_APV_DT) IS NOT NULL THEN '06'
                                                             WHEN TRIM(D3.MDT_OFER_APV_DT)IS NOT NULL THEN '05'
                                                             WHEN TRIM(D3.AUD_BRDV_APV_DT)IS NOT NULL THEN '04'
                                                             WHEN TRIM(D3.RTN_RPT_DT) IS NOT NULL THEN '03'
                                                        ELSE
                                                            (CASE WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8' END) = '8' AND D3.RTN_RPT_DT IS NULL AND D3.FLD_AUD_END_DT IS NULL THEN '02'
                                                                  WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8' END) = '8' AND D3.RTN_RPT_DT IS NULL THEN '11'
                                                                  WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8' END) = '7' THEN '02'
                                                                   END)
                                                        END
                                                      END)
                        END    AS PRSS_STEP_NM
                 , D1.PRSS_STEP_CD
                 , TO_CHAR(TO_DATE(D3.RSV_INSPC_LUNH_DT), 'YYYY-MM-DD') AS MTRL_CLC_STRT_DT
                 , TO_CHAR(TO_DATE(D3.RTN_DT), 'YYYY-MM-DD') AS RTN_DT
                 , TO_CHAR(TO_DATE(D3.HNDL_DDLN_DT), 'YYYY-MM-DD') AS STAD_HNDL_DT
                 , (SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = D1.MNG_DPT_CD) as SPV_BRDV_CD
            FROM TBBADDED001M AS D1
 LEFT OUTER JOIN TBBADDED003M AS D3 ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO
           WHERE 1=1
           AND SUBSTR(D1.AUD_KND_CD, 3, 1) <> '5'
            ]]>
            <if test="schAudYr != null and schAudYr != ''">
                    AND D1.AUD_YR  = #{schAudYr}
            </if>
            <if test="schAudYrNoKndCd != null and schAudYrNoKndCd != ''">
                    AND D1.AUD_KND_CD = #{schAudYrNoKndCd}
            </if>
            <if test="schAudNo != null and schAudNo != ''">
                    AND D1.AUD_GRN_NO = #{schAudNo}
            </if>
            <if test="schAudSbjNm != null and schAudSbjNm != ''">
                    AND D1.AUD_SBJ_NM LIKE '%'||#{schAudSbjNm}||'%'
            </if>
            <if test="schAudKndCd != null and schAudKndCd != ''">
                    AND D1.AUD_KND_CD  = #{schAudKndCd}
            </if>
            <if test="schSpvBrdvCd != null and schSpvBrdvCd != ''">
                   AND (SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = D1.MNG_DPT_CD) = #{schSpvBrdvCd}
               </if>
            <if test="schDeptCd != null and schDeptCd != ''">
                    AND D1.MNG_DPT_CD = #{schDeptCd}
            </if>
            <if test="schPrssStepCd != null and schPrssStepCd != ''">
                <![CDATA[
                AND (
                CASE WHEN #{schAudYr} < 2017 THEN (CASE WHEN SUBSTR(D1.AUD_KND_CD,3) = '55' THEN ''
                                                        WHEN D3.AUD_EXEC_HNDL_STA_CD = '9'  THEN '10'
                                                   ELSE 
                                                        CASE WHEN TRIM(D3.ENF_APV_DT) IS NOT NULL THEN '10'
                                                             WHEN TRIM(D3.CHF_CMTR_APV_DT)IS NOT NULL THEN '09'
                                                             WHEN TRIM(D3.OW_DHD_APV_DT)  IS NOT NULL THEN '08'
                                                             WHEN TRIM(D3.JA_JDG_SSEC_APV_DT) IS NOT NULL THEN '07'
                                                             WHEN TRIM(D3.MDT_DDG_APV_DT) IS NOT NULL THEN '06'
                                                             WHEN TRIM(D3.MDT_OFER_APV_DT)IS NOT NULL THEN '05'
                                                             WHEN TRIM(D3.AUD_BRDV_APV_DT)IS NOT NULL THEN '04'
                                                             WHEN TRIM(D3.RTN_RPT_DT) IS NOT NULL THEN '03'
                                                        ELSE 
                                                            (CASE WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8'
                                                                              END) = '8' AND D3.RTN_RPT_DT IS NULL AND D3.FLD_AUD_END_DT IS NULL THEN '02'
                                                                  WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8'
                                                                              END) = '8' AND D3.RTN_RPT_DT IS NULL THEN '11'
                                                                  WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8'
                                                                              END) = '7' THEN '02'
                                                                  END)
                                                        END
                                                   END)
                     ELSE (SELECT AUD_STEP_CD FROM TBBADDED101M WHERE AUD_YR = D1.AUD_YR AND AUD_NO = D1.AUD_NO AND AUD_STEP_CD = D1.PRSS_STEP_CD)
                     END    
                  ) = #{schPrssStepCd}
                ]]>
            </if>
            <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
                    /* 관련업무 조건 수정 - 2017.02.13 yyh */
                    AND EXISTS (SELECT 1
                                  FROM TBBADDED030L 
                                 WHERE AUD_YR  = D1.AUD_YR
                                   AND AUD_NO  = D1.AUD_NO
                                   AND DVSN_CD = #{schReqDvsnCd})        
            </if>
            ORDER BY D1.FRT_REGI_DH DESC /* 20170721 EUNOK 수정 ORDER BY D1.AUD_YR DESC, D1.AUD_KND_CD, D1.AUD_GRN_NO DESC */
               
        <include refid="include.pageOrder" />
    </select>

    <select id="selectExcelExportList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.afu.dao.AEPAFU001EMapper.selectExcelExportList*/
            <![CDATA[
            WITH AUTH_DEPT AS (
                SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, #{dptAuth}, '', #{schSpvBrdvCd}))
            )
            SELECT D1.AUD_YR||'-'||F_CODE_NM('1000739', D1.AUD_KND_CD)||'-'||D1.AUD_GRN_NO AS AUD_YR_NO /* 감사연번호 추가 - 2017.02.13 yyh*/
                 , F_CODE_NM('1000753',D1.AUD_CTRL_CD) AS AUD_CTRL_NM
                 , CASE WHEN D1.AUD_YR >= '2016' 
                        THEN F_CODE_NM('1000739',D1.AUD_KND_CD)   
                        ELSE '-' END AS AUD_YR_NO_KND_NM /*감사연번호종류코드명*/
                 , F_CODE_NM('1000007', D1.AUD_KND_CD) AS AUD_KND_NM
                 , F_CODE_NM('1000751',D1.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM
                 , D1.AUD_SBJ_NM        AS AUD_SBJ_NM
                 , F_ORG_INFO(D1.AUD_RPST_ORG_CD,'1')  AS AUD_RPST_ORG_NM
                 , F_DPT_INFO(D1.MNG_DPT_CD,'1')         AS MNG_DPT_NM
                 , D1.MNG_DPT_CD         AS  MNG_DPT_CD  /*관리국코드 - 2017.02.01 EUNOK */
                 , CASE WHEN D1.PRSS_STEP_CD LIKE 'A10%' THEN (SELECT AUD_STEP_NM 
                                                                 FROM TBBADDED101M 
                                                                WHERE AUD_YR = D1.AUD_YR
                                                                  AND AUD_NO = D1.AUD_NO
                                                                  AND AUD_STEP_CD = D1.PRSS_STEP_CD)
                        ELSE F_CODE_NM('1000475',CASE WHEN SUBSTR(D1.AUD_KND_CD,3) = '55' THEN '' 
                                                      WHEN D3.AUD_EXEC_HNDL_STA_CD = '9'  THEN '10'
                                                      ELSE
                                                        CASE WHEN TRIM(D3.ENF_APV_DT) IS NOT NULL THEN '10'
                                                             WHEN TRIM(D3.CHF_CMTR_APV_DT)IS NOT NULL THEN '09'
                                                             WHEN TRIM(D3.OW_DHD_APV_DT)  IS NOT NULL THEN '08'
                                                             WHEN TRIM(D3.JA_JDG_SSEC_APV_DT) IS NOT NULL THEN '07'
                                                             WHEN TRIM(D3.MDT_DDG_APV_DT) IS NOT NULL THEN '06'
                                                             WHEN TRIM(D3.MDT_OFER_APV_DT)IS NOT NULL THEN '05'
                                                             WHEN TRIM(D3.AUD_BRDV_APV_DT)IS NOT NULL THEN '04'
                                                             WHEN TRIM(D3.RTN_RPT_DT) IS NOT NULL THEN '03'
                                                        ELSE
                                                            (CASE WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8' END) = '8' AND D3.RTN_RPT_DT IS NULL AND D3.FLD_AUD_END_DT IS NULL THEN '02'
                                                                  WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8' END) = '8' AND D3.RTN_RPT_DT IS NULL THEN '11'
                                                                  WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8' END) = '7' THEN '02'
                                                                   END)
                                                        END
                                                      END)
                        END    AS PRSS_STEP_NM
            FROM TBBADDED001M AS D1
 LEFT OUTER JOIN TBBADDED003M AS D3 ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO
           WHERE 1=1
           AND
                (
                     ( EXISTS (SELECT ST1.DPT_CD FROM AUTH_DEPT ST1 WHERE D1.MNG_DPT_CD = ST1.DPT_CD)
                        OR  (#{schSpvBrdvCd}  = (SELECT D4.HIRK_DPT_CD FROM TBDCMACM002M D4 WHERE D4.DPT_CD  = D1.MNG_DPT_CD AND D4.USE_YN = 'Y') 
                            AND D1.AUD_SCL_CD =  2  )
                     )
                   /* 부서권한은 없으나 출장 배정자로 등록 된 경우 감사사항 조회 가능하도록 수정 MJ */
                   OR EXISTS (
                        SELECT 1
                          FROM TBBADDED002M ST4
                         INNER JOIN TBBADDED005L ST5
                            ON ST4.BZT_YR = ST5.BZT_YR
                           AND ST4.BZT_SNO = ST5.BZT_SNO
                         WHERE D1.AUD_YR = ST4.REL_AUD_YR
                           AND D1.AUD_NO = ST4.REL_AUD_NO
                           AND ST5.PCT_CNB = #{cnb}
                   )
                )
            ]]>
            
            /*20170202 EUNOK 관리부셔 != 감찰담당관, 감찰관, 유지보수,구축용역이 아니면 감찰관부서의 데이터는 검색되지 않음*/
            <if test='searchChk != "Y"'>
               AND D1.MNG_DPT_CD NOT IN ('100000','100100')
            </if>
            <if test="schAudYr != null and schAudYr != ''">
                    AND D1.AUD_YR  = #{schAudYr}
            </if>
            <if test="schAudYrNoKndCd != null and schAudYrNoKndCd != ''">
                    AND D1.AUD_KND_CD = #{schAudYrNoKndCd}
            </if>
            <if test="schAudNo != null and schAudNo != ''">
                    AND D1.AUD_GRN_NO = #{schAudNo}
            </if>
            <if test="schAudSbjNm != null and schAudSbjNm != ''">
                    AND D1.AUD_SBJ_NM LIKE '%'||#{schAudSbjNm}||'%'
            </if>
            <if test="rankCd == '004' and pstCd == '0067400'">
             <![CDATA[
                   AND SUBSTR(D1.AUD_KND_CD, 3, 1) <> '5'
                ]]>
            </if>
            <if test="rankCd == '007' and pstCd == '0055700'">
             <![CDATA[
                    AND SUBSTR(D1.AUD_KND_CD, 3, 1) <> '5'
                  ]]>
            </if>
            <if test="schPrssStepCd != null and schPrssStepCd != ''">
                <![CDATA[
                AND (
                CASE WHEN #{schAudYr} < 2017 THEN (CASE WHEN SUBSTR(D1.AUD_KND_CD,3) = '55' THEN ''
                                                        WHEN D3.AUD_EXEC_HNDL_STA_CD = '9'  THEN '10'
                                                   ELSE 
                                                        CASE WHEN TRIM(D3.ENF_APV_DT) IS NOT NULL THEN '10'
                                                             WHEN TRIM(D3.CHF_CMTR_APV_DT)IS NOT NULL THEN '09'
                                                             WHEN TRIM(D3.OW_DHD_APV_DT)  IS NOT NULL THEN '08'
                                                             WHEN TRIM(D3.JA_JDG_SSEC_APV_DT) IS NOT NULL THEN '07'
                                                             WHEN TRIM(D3.MDT_DDG_APV_DT) IS NOT NULL THEN '06'
                                                             WHEN TRIM(D3.MDT_OFER_APV_DT)IS NOT NULL THEN '05'
                                                             WHEN TRIM(D3.AUD_BRDV_APV_DT)IS NOT NULL THEN '04'
                                                             WHEN TRIM(D3.RTN_RPT_DT) IS NOT NULL THEN '03'
                                                        ELSE 
                                                            (CASE WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8'
                                                                              END) = '8' AND D3.RTN_RPT_DT IS NULL AND D3.FLD_AUD_END_DT IS NULL THEN '02'
                                                                  WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8'
                                                                              END) = '8' AND D3.RTN_RPT_DT IS NULL THEN '11'
                                                                  WHEN
                                                                        (CASE WHEN (D3.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(D3.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                                              WHEN ((D3.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(D3.HNDL_DDLN_DT) IS NULL) OR D3.AUD_EXEC_HNDL_STA_CD = '3') OR (D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(D3.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                                              WHEN D3.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                                              ELSE '8'
                                                                              END) = '7' THEN '02'
                                                                  END)
                                                        END
                                                   END)
                     ELSE (SELECT AUD_STEP_CD FROM TBBADDED101M WHERE AUD_YR = D1.AUD_YR AND AUD_NO = D1.AUD_NO AND AUD_STEP_CD = D1.PRSS_STEP_CD)
                     END    
                  ) = #{schPrssStepCd}
                ]]>
            </if>
            <if test="schAudKndCd != null and schAudKndCd != ''">
                    AND D1.AUD_KND_CD  = #{schAudKndCd}
            </if>
            <if test="schDeptCd != null and schDeptCd != ''">
                    AND D1.MNG_DPT_CD = #{schDeptCd}
            </if>
            <if test="schReqDvsnCd != null and schReqDvsnCd != ''">
                    /* 관련업무 조건 수정 - 2017.02.13 yyh */
                    AND EXISTS (SELECT 1
                                  FROM TBBADDED030L 
                                 WHERE AUD_YR  = D1.AUD_YR
                                   AND AUD_NO  = D1.AUD_NO
                                   AND DVSN_CD = #{schReqDvsnCd})  
            </if>
               ORDER BY D1.AUD_YR DESC, D1.AUD_KND_CD, D1.AUD_GRN_NO DESC
    </select>
    <select id="selectMainList" parameterType="paramMap" resultType="egovMap" >
            /* kr.go.bai.eip.aep.fer.dao.AEPFER002QMapper.selectMainList */
            <![CDATA[
            SELECT AUD_YR_NO
                , AUD_KND_NM
                , AUD_SBJ_NM
                , MNG_DPT_NM
                , TO_CHAR(TO_DATE(RSV_INSPC_LUNH_DT), 'YYYY-MM-DD') AS MTRL_CLC_STRT_DT
                , TO_CHAR(TO_DATE(RTN_DT), 'YYYY-MM-DD') AS RTN_DT
                , TO_CHAR(TO_DATE(HNDL_DDLN_DT), 'YYYY-MM-DD') AS STAD_HNDL_DT
                , AUD_STR_DT
                , PRSS_STEP_CD
                , CASE
                      WHEN PRSS_STEP_CD = '02' THEN '출장'
                      WHEN PRSS_STEP_CD = '03' THEN '종료보고'
                      WHEN PRSS_STEP_CD = '04' THEN '과장'
                      WHEN PRSS_STEP_CD = '07' THEN '국장'
--                      WHEN PRSS_STEP_CD = '08' THEN '총차장'
--                      WHEN PRSS_STEP_CD = '09' THEN '주심위원'
--                      WHEN PRSS_STEP_CD = '10' THEN '시행'
-- 총,차장 단계 분리로 인하여 코드 재정의 (2019.04.18 LSR 수정)
                      WHEN PRSS_STEP_CD = '08' THEN '차장'
                      WHEN PRSS_STEP_CD = '09' THEN '총장'
                      WHEN PRSS_STEP_CD = '10' THEN '주심위원'
                      WHEN PRSS_STEP_CD = '11' THEN '시행'
                  END AS NOW_STEP_NM
                , CASE
                      WHEN PRSS_STEP_CD = '03' 
                      THEN TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD')) - TO_DATE(RPT_DDLN_DT)
                      WHEN PRSS_STEP_CD = '04' 
                      THEN TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD')) - TO_DATE(BRDV_HNDL_DDLN_DT)
                      WHEN PRSS_STEP_CD = '07' 
                      THEN TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD')) - TO_DATE(RVW_RM_APV_DDLN_DT)
--                      WHEN PRSS_STEP_CD = '08' 
--                      THEN TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD')) - TO_DATE(TOT_DHD_APV_DDLN_DT)
--                      WHEN PRSS_STEP_CD = '09' 
--                      THEN TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD')) - TO_DATE(CHF_CMTR_APV_DDLN_DT)
--                      WHEN PRSS_STEP_CD = '10' 
-- 총,차장 단계 분리로 인하여 코드 재정의 (2019.04.18 LSR 수정)
                      WHEN PRSS_STEP_CD = '08' 
                      THEN TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD')) - TO_DATE(DHD_APV_DDLN_DT)
                      WHEN PRSS_STEP_CD = '09' 
                      THEN TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD')) - TO_DATE(PSD_APV_DDLN_DT)
                      WHEN PRSS_STEP_CD = '10' 
                      THEN TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD')) - TO_DATE(CHF_CMTR_APV_DDLN_DT)
                      WHEN PRSS_STEP_CD = '11' 
                      THEN CASE 
                               WHEN ENF_APV_DT IS NULL
                               THEN TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD')) - TO_DATE(ENF_APV_DDLN_DT)
                               ELSE TO_DATE(ENF_APV_DDLN_DT) - TO_DATE(ENF_APV_DT)
                           END
                     ELSE 0
                 END AS DLAY_DCN
            FROM (
                  SELECT T1.AUD_YR
                       , T1.AUD_NO
                       , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') AS AUD_YR_NO
                       , F_CODE_NM('1000007', T1.AUD_KND_CD) AS AUD_KND_NM
                       , T1.AUD_SBJ_NM
                       , F_DPT_INFO(T1.MNG_DPT_CD,'1') AS MNG_DPT_NM
                       , T2.RSV_INSPC_LUNH_DT
                       , T2.RTN_RPT_DT
                       , T2.HNDL_DDLN_DT
                       , T2.RTN_DT
                       , T4.AUD_STR_DT
                       , CASE 
                             WHEN T1.PRSS_STEP_CD = 'A1010' 
                                OR T1.PRSS_STEP_CD = 'A1020' 
                                OR T1.PRSS_STEP_CD = 'A1030' 
                                OR T1.PRSS_STEP_CD = 'A1040' THEN '02'                                      /* 자료수집, 확인출장, 감사실시 */
                             WHEN T1.PRSS_STEP_CD = 'A1050' THEN '03'                                         /* 종료보고 */
                             WHEN T1.PRSS_STEP_CD = 'A1060' AND T3.GWA_APV IS NOT NULL THEN '04'         /* 과장 */
                             WHEN T1.PRSS_STEP_CD = 'A1060' AND T3.GUK_APV IS NOT NULL THEN '07'    /* 국장 */
--                             WHEN T1.PRSS_STEP_CD = 'A1060' AND T3.CHONG_APV IS NOT NULL THEN '08'       /* 총장 */
--                             WHEN T1.PRSS_STEP_CD = 'A1070' AND T2.SBCN_DT IS NULL AND T3.WI_APV IS NULL THEN '09'       /* 주심위원 */
--                             WHEN T1.PRSS_STEP_CD = 'A1070' AND T3.WI_APV IS NOT NULL THEN '10'            /* 부의 */
--                             WHEN T1.PRSS_STEP_CD = 'A1080' THEN '11'            /* 부의 */      
-- 총,차장 단계 분리로 인하여 코드 재정의 (2019.04.18 LSR 수정)
                             WHEN T1.PRSS_STEP_CD = 'A1060' AND T3.CHA_APV IS NOT NULL THEN '08'       /* 차장 */
                             WHEN T1.PRSS_STEP_CD = 'A1060' AND T3.CHONG_APV IS NOT NULL THEN '09'       /* 총장 */
                             WHEN T1.PRSS_STEP_CD = 'A1070' AND T2.SBCN_DT IS NULL AND T3.WI_APV IS NULL THEN '10'       /* 주심위원 */
                             WHEN T1.PRSS_STEP_CD = 'A1070' AND T3.WI_APV IS NOT NULL THEN '11'            /* 부의 */
                             WHEN T1.PRSS_STEP_CD = 'A1080' THEN '12'            /* 시행 */    
                             ELSE T1.PRSS_STEP_CD
                         END AS PRSS_STEP_CD
                       , '1' AS DLAY_DCN
                       , RPT_DDLN_DT
                       , BRDV_HNDL_DDLN_DT
                       , RVW_RM_APV_DDLN_DT
--                       , TOT_DHD_APV_DDLN_DT 
                       , NVL(DHD_APV_DDLN_DT, DHD_APV_DDLN_DT) AS DHD_APV_DDLN_DT			-- (2019.04.18 LSR 수정)
                       , NVL(PSD_APV_DDLN_DT, PSD_APV_DDLN_DT) AS PSD_APV_DDLN_DT			-- (2019.04.18 LSR 수정)
                       , CHF_CMTR_APV_DDLN_DT
                       , ENF_APV_DDLN_DT
                       , ENF_APV_DT
                    FROM TBBADDED001M T1
                   INNER JOIN TBBADDED003M T2 ON T1.AUD_YR = T2.AUD_YR
                                             AND T1.AUD_NO = T2.AUD_NO
                   LEFT JOIN (
                                SELECT D3.AUD_YR
                                      ,D3.AUD_NO
                                      ,TO_CHAR(MAX(D3.GWA_APV), 'YYYY-MM-DD')          AS GWA_APV
                                      ,TO_CHAR(MAX(D3.GUK_APV), 'YYYY-MM-DD')          AS GUK_APV
                                      ,TO_CHAR(MAX(D3.CHA_APV), 'YYYY-MM-DD')          AS CHA_APV
                                      ,TO_CHAR(MAX(D3.CHONG_APV), 'YYYY-MM-DD')        AS CHONG_APV
                                      ,TO_CHAR(MAX(D3.WI_APV), 'YYYY-MM-DD')           AS WI_APV
                                  FROM (
                                        SELECT D1.AUD_YR
                                              ,D1.AUD_NO
                                              ,CASE WHEN D2.APVR_KND_CD IN ('2','3','4') THEN DECODE(D2.APVR_PST_CD,'0013600',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB),'') END          AS GWA_APV
                                              ,CASE WHEN D2.APVR_KND_CD IN ('2','3','4') THEN DECODE(D2.APVR_PST_CD,'0015800',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB)
                                                                        ,DECODE(D2.APVR_PST_CD,'0035100',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB)
                                                                        ,DECODE(D2.APVR_PST_CD,'0058100',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB),''))) END                             AS GUK_APV   --국단실장결재일
		                                      ,CASE WHEN D2.APVR_KND_CD IN ('2','3','4') THEN DECODE(D2.APVR_PST_CD,'0045900',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB)
		                                                                ,DECODE(D2.APVR_PST_CD,'0055600',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB),'')) END                              AS CHA_APV   --사무차장결재일
                                              ,CASE WHEN D2.APVR_KND_CD IN ('2','3','4') THEN DECODE(D2.APVR_PST_CD,'0045900',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB)
                                                                        ,DECODE(D2.APVR_PST_CD,'0055700',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB),''))  END                             AS CHONG_APV --사무총장결재일
                                              ,CASE WHEN D2.APVR_KND_CD IN ('2','3','4') THEN DECODE(D2.APVR_PST_CD,'0010600',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB),'') END          AS WI_APV    --주심위원결재일
                                              ,D1.SYT_TRTM_DVSN_YN
                                          FROM TBBADDED103M D1
                                              ,TBDCMACM023L D2
                                         WHERE D1.APV_RQS_ID       = D2.APV_DOC_NO
                                           AND D1.RPRT_CD          IN ('A10600200','A10700100') --감사보고서,주심위원설명자료
                                           AND D1.AUD_RPRT_DVSN_CD = '10'   --TEST (10:본안,20:우선,30:별도,40:재부의)
                                         ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D2.APV_SNO,D2.APVR_SEQ
                                       ) D3
                                 GROUP BY D3.AUD_YR,D3.AUD_NO ) T3 ON (
                                            T3.AUD_YR = #{audYr}
                                        AND T3.AUD_NO = #{audNo} )
                INNER JOIN (
                            SELECT MIN(TO_CHAR(TO_DATE(AUD_STR_DT),'YYYY-MM-DD')) AS AUD_STR_DT
                              FROM TBBADDED002M
                             WHERE REL_AUD_YR = #{audYr}
                               AND REL_AUD_NO = #{audNo}
                               AND AUD_BZT_KND_CD = '00' ) T4 ON ( 1=1 )
                   WHERE 1=1
                     AND SUBSTR(T1.AUD_KND_CD, 3, 1) <> 5
                     AND EXISTS (
                                 SELECT 1
                                   FROM TBDCMACM002M S
                                  WHERE S.DPT_CD = T1.MNG_DPT_CD
                                    AND S.USE_YN = 'Y'
                                )
            AND T1.AUD_YR  = #{audYr}
            AND T1.AUD_NO = #{audNo} )
        ]]>
    </select>
    
    <select id="selectSubList1" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.aep.fer.dao.AEPFER002QMapper.selectSubList1 */
            <![CDATA[
            SELECT DECODE(T2.NO,1,'귀청보고건수',2,'증감건수',3,'현재건수',4,'전체',5,'처리안작성',6,'의결완료') AS CNT_NM --구분
                  ,DECODE(T2.NO,1,NVL(T1.A1050_D10_CNT,0)
                               ,2,NVL(T1.AFF_MPP_CNT_D10,0)
                               ,3,NVL(T1.A1050_D10_CNT,0) + NVL(T1.AFF_MPP_CNT_D10,0)
                               ,4,NVL(T1.A1050_D10_CNT,0) + NVL(T1.AFF_MPP_CNT_D10,0)
                               ,5,NVL(T1.RPRT_D10_CNT,0)
                               ,6,NVL(T1.SBCN_D10_CNT,0)) AS D10_CNT
                  ,DECODE(T2.NO,1,NVL(T1.A1050_E10_CNT,0)
                               ,2,NVL(T1.AFF_MPP_CNT_E10,0)
                               ,3,NVL(T1.A1050_E10_CNT,0) + NVL(T1.AFF_MPP_CNT_E10,0)
                               ,4,NVL(T1.A1050_E10_CNT,0) + NVL(T1.AFF_MPP_CNT_E10,0)
                               ,5,NVL(T1.RPRT_E10_CNT,0)
                               ,6,NVL(T1.SBCN_E10_CNT,0))||' ('||DECODE(T2.NO,1,NVL(T1.A1050_ETC_CNT,0)
                                                                             ,2,NVL(T1.AFF_MPP_CNT_ETC,0)
                                                                             ,3,NVL(T1.A1050_ETC_CNT,0) + NVL(T1.AFF_MPP_CNT_ETC,0)
                                                                             ,4,NVL(T1.A1050_ETC_CNT,0) + NVL(T1.AFF_MPP_CNT_ETC,0)
                                                                             ,5,NVL(T1.RPRT_ETC_CNT,0)
                                                                             ,6,NVL(T1.SBCN_ETC_CNT,0))||')' AS E10_CNT
                  ,DECODE(T2.NO,1,NVL(T1.A1050_SUM_CNT,0)
                               ,2,NVL(T1.AFF_MPP_CNT_SUM,0)
                               ,3,NVL(T1.A1050_D10_CNT,0) + NVL(T1.AFF_MPP_CNT_D10,0) + NVL(T1.A1050_E10_CNT,0) + NVL(T1.AFF_MPP_CNT_E10,0)
                               ,4,NVL(T1.A1050_D10_CNT,0) + NVL(T1.AFF_MPP_CNT_D10,0) + NVL(T1.A1050_E10_CNT,0) + NVL(T1.AFF_MPP_CNT_E10,0)
                               ,5,NVL(T1.RPRT_D10_CNT,0) + NVL(T1.RPRT_E10_CNT,0)
                               ,6,NVL(T1.SBCN_D10_CNT,0) + NVL(T1.SBCN_E10_CNT,0)) AS SUM_CNT
                  ,CASE WHEN (NVL(T1.A1050_D10_CNT,0) + NVL(T1.AFF_MPP_CNT_D10,0)+NVL(T1.A1050_E10_CNT,0)+NVL(T1.AFF_MPP_CNT_E10,0)) = 0 --귀청보고 부의+위임 , 증감 부의+위임의 합
                        THEN '-'
                       	ELSE
		                DECODE(T2.NO,1,'-'
		                            ,2,'-'
		                            ,3,'-'
		                            ,4,'-'
		                            ,5,ROUND((NVL(T1.RPRT_D10_CNT,0) + NVL(T1.RPRT_E10_CNT,0))/(NVL(T1.A1050_D10_CNT,0) + NVL(T1.AFF_MPP_CNT_D10,0)+NVL(T1.A1050_E10_CNT,0)+NVL(T1.AFF_MPP_CNT_E10,0)),2)*100||'%'
		                            ,6,ROUND((NVL(T1.SBCN_D10_CNT,0) + NVL(T1.SBCN_E10_CNT,0))/(NVL(T1.A1050_D10_CNT,0) + NVL(T1.AFF_MPP_CNT_D10,0)+NVL(T1.A1050_E10_CNT,0)+NVL(T1.AFF_MPP_CNT_E10,0)),2)*100||'%' )
		                END AS RATE
              FROM (SELECT G1.*
                          ,G2.*
                          ,G3.*
                      FROM (-- 종료보고 건수
                            SELECT A.AUD_YR
                                  ,A.AUD_NO
                                  ,SUM(CASE WHEN A.AUD_STEP_CD = 'A1050' AND B.REFER_DVSN_CD = 'D10' THEN 1 ELSE 0 END) AS A1050_D10_CNT --귀청보고 부의
                                  ,SUM(CASE WHEN A.AUD_STEP_CD = 'A1050' AND B.REFER_DVSN_CD = 'E10' THEN 1 ELSE 0 END) AS A1050_E10_CNT --귀청보고 위임
                                  ,SUM(CASE WHEN A.AUD_STEP_CD = 'A1050'
                                             AND A.DSP_RQ_CD NOT IN ('110','120','210','310','320','410'
                                                                    ,'510','520','530'
                                                                    ,'611','610','620','623','625'
                                                                    ,'810','820','830','840','850'
                                                                    ,'710','720','730') THEN 1 ELSE 0 END)              AS A1050_ETC_CNT --귀청보고 기타
                                  ,SUM(CASE WHEN A.AUD_STEP_CD = 'A1050' THEN 1 ELSE 0 END)                             AS A1050_SUM_CNT --귀청보고 합계
                              FROM TBBADDED146M A
                                  ,TBBADDED145M B
                             WHERE A.AUD_YR      = B.AUD_YR
                               AND A.AUD_NO      = B.AUD_NO
                               AND A.AUD_STEP_CD = B.AUD_STEP_CD
                               AND A.APVR_CD     = B.APVR_CD
                               AND A.AFF_SNO     = B.AFF_SNO
                               AND A.AUD_YR      = #{audYr} --PARAM
                               AND A.AUD_NO      = #{audNo}  --PARAM
                             GROUP BY A.AUD_YR,A.AUD_NO
                           ) G1
                          ,(--증감건수
                            SELECT E.AUD_YR
                                  ,E.AUD_NO
                                  ,SUM(E.AFF_MPP_CNT_D10)                        AS AFF_MPP_CNT_D10 --증감부의
                                  ,SUM(E.AFF_MPP_CNT_E10)                        AS AFF_MPP_CNT_E10 --증감위임
                                  ,SUM(E.AFF_MPP_CNT_ETC)                        AS AFF_MPP_CNT_ETC --증감기타
                                  ,SUM(E.AFF_MPP_CNT_D10)+SUM(E.AFF_MPP_CNT_E10) AS AFF_MPP_CNT_SUM --증감합계
                              FROM (SELECT D.AUD_YR
                                          ,D.AUD_NO
                                          ,DECODE(D.HH_REFER_DVSN_CD,'D10',SUM(D.AFF_MPP_CNT)) AS AFF_MPP_CNT_D10
                                          ,DECODE(D.HH_REFER_DVSN_CD,'E10',SUM(D.AFF_MPP_CNT)) AS AFF_MPP_CNT_E10
                                          ,DECODE(D.AFF_MPP_CNT_ETC,'ETC', SUM(D.AFF_MPP_CNT)) AS AFF_MPP_CNT_ETC
                                      FROM (WITH AFF_DSP_INFO AS (SELECT Z.AUD_YR
                                                                        ,Z.AUD_NO
                                                                        ,Z.AUD_STEP_CD
                                                                        ,Z.DOC_ID
                                                                        ,Z.APVR_CD
                                                                        ,Z.AFF_SNO
                                                                        ,Y.DSP_RQ_SNO
                                                                        ,Z.AFF_CD
                                                                        ,Y.AFF_DSP_CD
                                                                        ,Z.AFF_CD||'-'||Y.AFF_DSP_CD AS AFF_DSP_JOIN
                                                                        ,Y.DSP_RQ_CD
                                                                        ,Z.REFER_DVSN_CD
                                                                        ,F_MNG_KND_AUDYRNO(Y.AUD_YR, Y.AUD_NO, Y.AUD_KND_CD, '-')||'-'||Z.AFF_CD||'-'||Y.AFF_DSP_CD AS AUD_AFF_NO
                                                                        ,DECODE(Z.APVR_CD,'0010200','종료보고'
                                                                                         ,'0013600','과장'
                                                                                         ,'0015800','국장','0035100','국장','0058100','국장'
                                                                                         ,'0055600','차장','0045900','차장'
                                                                                         ,'0055700','총장'
                                                                                         ,'0010600','위원'
                                                                                         ,'A1070','부의결과'
                                                                                         ,Z.APVR_CD) AS APVR_RNAME
                                                                    FROM TBBADDED145M Z
                                                                        ,TBBADDED146M Y
                                                                   WHERE 1=1
                                                                     AND Z.AUD_YR      = #{audYr} --PARAM
                                                                     AND Z.AUD_NO      = #{audNo}  --PARAM
                                                                     AND Z.AUD_YR      = Y.AUD_YR
                                                                     AND Z.AUD_NO      = Y.AUD_NO
                                                                     AND Z.AUD_STEP_CD = Y.AUD_STEP_CD
                                                                     AND Z.DOC_ID      = Y.DOC_ID
                                                                     AND Z.APVR_CD     = Y.APVR_CD
                                                                     AND Z.AFF_SNO     = Y.AFF_SNO
                                                                 )
                                            SELECT C.AUD_YR
                                                  ,C.AUD_NO
                                                  ,C.AUD_STEP_CD
                                                  ,C.APVR_CD
                                                  ,C.AFF_MPP_DVSN_CD
                                                  ,F_CODE_NM('1000777',C.AFF_MPP_DVSN_CD) AS AFF_MPP_DVSN_NM
                                                  ,CASE WHEN C.AFF_MPP_DVSN_CD = 'D30' THEN C.PRE_AFF_NO
                                                        WHEN C.AFF_MPP_DVSN_CD = 'D40' THEN C.AFF_NO
                                                        WHEN C.AFF_MPP_DVSN_CD = 'D50' THEN C.AFF_NO
                                                        WHEN C.AFF_MPP_DVSN_CD = 'D90' THEN C.PRE_AFF_NO
                                                        WHEN C.AFF_MPP_DVSN_CD = 'D99' THEN C.PRE_AFF_NO
                                                   ELSE ''
                                                    END AS HH_AFF_NO
                                                  ,CASE WHEN C.AFF_MPP_DVSN_CD = 'D30' THEN (SELECT S1.REFER_DVSN_CD FROM AFF_DSP_INFO S1
                                                                                              WHERE S1.AUD_AFF_NO  = C.PRE_AFF_NO
                                                                                                AND S1.AUD_YR      = C.AUD_YR
                                                                                                AND S1.AUD_NO      = C.AUD_NO
                                                                                                AND S1.AUD_STEP_CD = C.AUD_STEP_CD
                                                                                                AND S1.AFF_SNO     = C.AFF_SNO
                                                                                                AND S1.DSP_RQ_SNO  = C.DSP_RQ_SNO
                                                                                                AND S1.APVR_CD     = C.APVR_CD   
                                                                                                AND S1.APVR_RNAME = DECODE(C.APVR_CD,'0013600','종료보고'
                                                                                                                                    ,'0015800','과장'
                                                                                                                                    ,'0035100','과장'
                                                                                                                                    ,'0058100','과장'
                                                                                                                                    ,'0055600','국장'
                                                                                                                                    ,'0045900','국장'
                                                                                                                                    ,'0055700','차장'
                                                                                                                                    ,'0010600','총장'
                                                                                                                                    ,'A1070'  ,'위원'))
                                                        WHEN C.AFF_MPP_DVSN_CD = 'D40' THEN (SELECT S2.REFER_DVSN_CD FROM AFF_DSP_INFO S2
                                                                                              WHERE S2.AUD_AFF_NO  = C.AFF_NO
                                                                                                AND S2.AUD_YR      = C.AUD_YR
                                                                                                AND S2.AUD_NO      = C.AUD_NO
                                                                                                AND S2.AUD_STEP_CD = C.AUD_STEP_CD
                                                                                                AND S2.AFF_SNO     = C.AFF_SNO
                                                                                                AND S2.DSP_RQ_SNO  = C.DSP_RQ_SNO
                                                                                                AND S2.APVR_CD     = C.APVR_CD                                                                                                 
                                                                                                AND S2.APVR_RNAME = DECODE(C.APVR_CD,'0013600','과장'
                                                                                                                                    ,'0015800','국장'
                                                                                                                                    ,'0035100','국장'
                                                                                                                                    ,'0058100','국장'
                                                                                                                                    ,'0055600','차장'
                                                                                                                                    ,'0045900','차장'
                                                                                                                                    ,'0055700','총장'
                                                                                                                                    ,'0010600','위원'
                                                                                                                                    ,'A1070'  ,'부의결과'))
                                                        WHEN C.AFF_MPP_DVSN_CD = 'D50' THEN (SELECT S3.REFER_DVSN_CD FROM AFF_DSP_INFO S3
                                                                                              WHERE S3.AUD_AFF_NO  = C.AFF_NO
                                                                                                AND S3.AUD_YR      = C.AUD_YR
                                                                                                AND S3.AUD_NO      = C.AUD_NO
                                                                                                AND S3.AUD_STEP_CD = C.AUD_STEP_CD
                                                                                                AND S3.AFF_SNO     = C.AFF_SNO
                                                                                                AND S3.DSP_RQ_SNO  = C.DSP_RQ_SNO
                                                                                                AND S3.APVR_CD     = C.APVR_CD                                                                                                 
                                                                                                AND S3.APVR_RNAME = DECODE(C.APVR_CD,'0013600','과장'
                                                                                                                                    ,'0015800','국장'
                                                                                                                                    ,'0035100','국장'
                                                                                                                                    ,'0058100','국장'
                                                                                                                                    ,'0055600','차장'
                                                                                                                                    ,'0045900','차장'
                                                                                                                                    ,'0055700','총장'
                                                                                                                                    ,'0010600','위원'
                                                                                                                                    ,'A1070'  ,'부의결과'))
                                                        WHEN C.AFF_MPP_DVSN_CD = 'D90' THEN (SELECT S4.REFER_DVSN_CD FROM AFF_DSP_INFO S4
                                                                                              WHERE S4.AUD_AFF_NO  = C.PRE_AFF_NO
                                                                                                AND S4.AUD_YR      = C.AUD_YR
                                                                                                AND S4.AUD_NO      = C.AUD_NO
                                                                                                AND S4.AUD_STEP_CD = C.AUD_STEP_CD
                                                                                                AND S4.AFF_SNO     = C.AFF_SNO
                                                                                                AND S4.DSP_RQ_SNO  = C.DSP_RQ_SNO
                                                                                                AND S4.APVR_CD     = C.APVR_CD                                                                                                 
                                                                                                AND S4.APVR_RNAME = DECODE(C.APVR_CD,'0013600','종료보고'
                                                                                                                                    ,'0015800','과장'
                                                                                                                                    ,'0035100','과장'
                                                                                                                                    ,'0058100','과장'
                                                                                                                                    ,'0055600','국장'
                                                                                                                                    ,'0045900','국장'
                                                                                                                                    ,'0055700','차장'
                                                                                                                                    ,'0010600','총장'
                                                                                                                                    ,'A1070'  ,'위원'))
                                                        WHEN C.AFF_MPP_DVSN_CD = 'D99' THEN (SELECT S5.REFER_DVSN_CD FROM AFF_DSP_INFO S5
                                                                                              WHERE S5.AUD_AFF_NO  = C.PRE_AFF_NO
                                                                                                AND S5.AUD_YR      = C.AUD_YR
                                                                                                AND S5.AUD_NO      = C.AUD_NO
                                                                                                AND S5.AUD_STEP_CD = C.AUD_STEP_CD
                                                                                                AND S5.AFF_SNO     = C.AFF_SNO
                                                                                                AND S5.DSP_RQ_SNO  = C.DSP_RQ_SNO
                                                                                                AND S5.APVR_CD     = C.APVR_CD                                                                                                 
                                                                                                AND S5.APVR_RNAME = DECODE(C.APVR_CD,'0013600','종료보고'
                                                                                                                                    ,'0015800','과장'
                                                                                                                                    ,'0035100','과장'
                                                                                                                                    ,'0058100','과장'
                                                                                                                                    ,'0055600','국장'
                                                                                                                                    ,'0045900','국장'
                                                                                                                                    ,'0055700','차장'
                                                                                                                                    ,'0010600','총장'
                                                                                                                                    ,'A1070'  ,'위원'))
                                                   ELSE ''
                                                    END AS HH_REFER_DVSN_CD
                                                  ,DECODE(C.AFF_MPP_DVSN_CD,'D30',-1,'D40',1,'D50',1,'D90',-1,'D99',-1,0) AS AFF_MPP_CNT
                                                  ,CASE WHEN (CASE WHEN C.AFF_MPP_DVSN_CD = 'D30' THEN (SELECT S1.DSP_RQ_CD FROM AFF_DSP_INFO S1
                                                                                                         WHERE S1.AUD_AFF_NO  = C.PRE_AFF_NO
		                                                                                                   AND S1.AUD_YR      = C.AUD_YR
		                                                                                                   AND S1.AUD_NO      = C.AUD_NO
		                                                                                                   AND S1.AUD_STEP_CD = C.AUD_STEP_CD
		                                                                                                   AND S1.AFF_SNO     = C.AFF_SNO
		                                                                                                   AND S1.DSP_RQ_SNO  = C.DSP_RQ_SNO
		                                                                                                   AND S1.APVR_CD     = C.APVR_CD                                                                                                            
                                                                                                           AND S1.APVR_RNAME = DECODE(C.APVR_CD,'0013600','종료보고'
                                                                                                                                               ,'0015800','과장'
                                                                                                                                               ,'0035100','과장'
                                                                                                                                               ,'0058100','과장'
                                                                                                                                               ,'0055600','국장'
                                                                                                                                               ,'0045900','국장'
                                                                                                                                               ,'0055700','차장'
                                                                                                                                               ,'0010600','총장'
                                                                                                                                               ,'A1070'  ,'위원'))
                                                                   WHEN C.AFF_MPP_DVSN_CD = 'D40' THEN (SELECT S2.DSP_RQ_CD FROM AFF_DSP_INFO S2
                                                                                                         WHERE S2.AUD_AFF_NO  = C.AFF_NO
		                                                                                                   AND S2.AUD_YR      = C.AUD_YR
		                                                                                                   AND S2.AUD_NO      = C.AUD_NO
		                                                                                                   AND S2.AUD_STEP_CD = C.AUD_STEP_CD
		                                                                                                   AND S2.AFF_SNO     = C.AFF_SNO
		                                                                                                   AND S2.DSP_RQ_SNO  = C.DSP_RQ_SNO
		                                                                                                   AND S2.APVR_CD     = C.APVR_CD                                                                                                             
                                                                                                           AND S2.APVR_RNAME = DECODE(C.APVR_CD,'0013600','과장'
                                                                                                                                               ,'0015800','국장'
                                                                                                                                               ,'0035100','국장'
                                                                                                                                               ,'0058100','국장'
                                                                                                                                               ,'0055600','차장'
                                                                                                                                               ,'0045900','차장'
                                                                                                                                               ,'0055700','총장'
                                                                                                                                               ,'0010600','위원'
                                                                                                                                               ,'A1070'  ,'부의결과'))
                                                                   WHEN C.AFF_MPP_DVSN_CD = 'D50' THEN (SELECT S3.DSP_RQ_CD FROM AFF_DSP_INFO S3
                                                                                                         WHERE S3.AUD_AFF_NO  = C.AFF_NO
		                                                                                                   AND S3.AUD_YR      = C.AUD_YR
		                                                                                                   AND S3.AUD_NO      = C.AUD_NO
		                                                                                                   AND S3.AUD_STEP_CD = C.AUD_STEP_CD
		                                                                                                   AND S3.AFF_SNO     = C.AFF_SNO
		                                                                                                   AND S3.DSP_RQ_SNO  = C.DSP_RQ_SNO
		                                                                                                   AND S3.APVR_CD     = C.APVR_CD                                                                                                             
                                                                                                           AND S3.APVR_RNAME = DECODE(C.APVR_CD,'0013600','과장'
                                                                                                                                               ,'0015800','국장'
                                                                                                                                               ,'0035100','국장'
                                                                                                                                               ,'0058100','국장'
                                                                                                                                               ,'0055600','차장'
                                                                                                                                               ,'0045900','차장'
                                                                                                                                               ,'0055700','총장'
                                                                                                                                               ,'0010600','위원'
                                                                                                                                               ,'A1070'  ,'부의결과'))
                                                                   WHEN C.AFF_MPP_DVSN_CD = 'D90' THEN (SELECT S4.DSP_RQ_CD FROM AFF_DSP_INFO S4
                                                                                                         WHERE S4.AUD_AFF_NO  = C.PRE_AFF_NO
 		                                                                                                   AND S4.AUD_YR      = C.AUD_YR
		                                                                                                   AND S4.AUD_NO      = C.AUD_NO
		                                                                                                   AND S4.AUD_STEP_CD = C.AUD_STEP_CD
		                                                                                                   AND S4.AFF_SNO     = C.AFF_SNO
		                                                                                                   AND S4.DSP_RQ_SNO  = C.DSP_RQ_SNO
		                                                                                                   AND S4.APVR_CD     = C.APVR_CD                                                                                                            
                                                                                                           AND S4.APVR_RNAME = DECODE(C.APVR_CD,'0013600','종료보고'
                                                                                                                                               ,'0015800','과장'
                                                                                                                                               ,'0035100','과장'
                                                                                                                                               ,'0058100','과장'
                                                                                                                                               ,'0055600','국장'
                                                                                                                                               ,'0045900','국장'
                                                                                                                                               ,'0055700','차장'
                                                                                                                                               ,'0010600','총장'
                                                                                                                                               ,'A1070'  ,'위원'))
                                                                   WHEN C.AFF_MPP_DVSN_CD = 'D99' THEN (SELECT S5.DSP_RQ_CD FROM AFF_DSP_INFO S5
                                                                                                         WHERE S5.AUD_AFF_NO  = C.PRE_AFF_NO
  		                                                                                                   AND S5.AUD_YR      = C.AUD_YR
		                                                                                                   AND S5.AUD_NO      = C.AUD_NO
		                                                                                                   AND S5.AUD_STEP_CD = C.AUD_STEP_CD
		                                                                                                   AND S5.AFF_SNO     = C.AFF_SNO
		                                                                                                   AND S5.DSP_RQ_SNO  = C.DSP_RQ_SNO
		                                                                                                   AND S5.APVR_CD     = C.APVR_CD                                                                                                           
                                                                                                           AND S5.APVR_RNAME = DECODE(C.APVR_CD,'0013600','종료보고'
                                                                                                                                               ,'0015800','과장'
                                                                                                                                               ,'0035100','과장'
                                                                                                                                               ,'0058100','과장'
                                                                                                                                               ,'0055600','국장'
                                                                                                                                               ,'0045900','국장'
                                                                                                                                               ,'0055700','차장'
                                                                                                                                               ,'0010600','총장'
                                                                                                                                               ,'A1070'  ,'위원'))
                                                               ELSE ''
                                                                END
                                                             ) NOT IN ('110','120','210','310','320','410'
                                                                      ,'510','520','530'
                                                                      ,'611','610','620','623','625'
                                                                      ,'810','820','830','840','850'
                                                                      ,'710','720','730') THEN 'ETC' ELSE '-' END
                                                    AS AFF_MPP_CNT_ETC
                                              FROM TBBADDED148M C
                                             WHERE C.AUD_YR      = #{audYr} --PARAM
                                               AND C.AUD_NO      = #{audNo}  --PARAM
                                               AND C.AUD_STEP_CD IN ('A1060','A1070')
                                               AND NVL(C.PRE_AFF_NO,'H1') <> NVL(C.AFF_NO,'H2')
                                           ) D
                                     GROUP BY D.AUD_YR,D.AUD_NO,D.HH_REFER_DVSN_CD,D.AFF_MPP_CNT_ETC
                                   ) E
                             GROUP BY E.AUD_YR,E.AUD_NO
                           ) G2
                          ,(--처리안작성건수,의결완료건수
                            SELECT F.AUD_YR
                                  ,F.AUD_NO
                                  ,SUM(CASE WHEN F.AUD_STEP_CD > 'A1050' AND F.FNL_YN = 'Y' AND G.REFER_DVSN_CD = 'D10' THEN 1 ELSE 0 END) AS RPRT_D10_CNT --처리안부의
                                  ,SUM(CASE WHEN F.AUD_STEP_CD > 'A1050' AND F.FNL_YN = 'Y' AND G.REFER_DVSN_CD = 'E10' THEN 1 ELSE 0 END) AS RPRT_E10_CNT --처리안위임
                                  ,SUM(CASE WHEN F.AUD_STEP_CD > 'A1050' AND F.FNL_YN = 'Y'
                                                                         AND F.DSP_RQ_CD NOT IN ('110','120','210','310','320','410'
                                                                                                 ,'510','520','530'
                                                                                                 ,'611','610','620','623','625'
                                                                                                 ,'810','820','830','840','850'
                                                                                                 ,'710','720','730') THEN 1 ELSE 0 END)    AS RPRT_ETC_CNT --처리안기타건수
                                  ,SUM(CASE WHEN F.APVR_CD = 'A1070' AND F.FNL_YN = 'Y' AND G.REFER_DVSN_CD = 'D10' AND H.SBCN_VT_CD IS NOT NULL THEN 1 ELSE 0 END) AS SBCN_D10_CNT --의결완료부의
                                  ,SUM(CASE WHEN F.APVR_CD = 'A1070' AND F.FNL_YN = 'Y' AND G.REFER_DVSN_CD = 'E10'                              THEN 1 ELSE 0 END) AS SBCN_E10_CNT --의결완료위임
                                  ,SUM(CASE WHEN F.APVR_CD = 'A1070' AND F.FNL_YN = 'Y' AND F.DSP_RQ_CD NOT IN ('110','120','210','310','320','410'
                                                                                                               ,'510','520','530'
                                                                                                               ,'611','610','620','623','625'
                                                                                                               ,'810','820','830','840','850'
                                                                                                               ,'710','720','730') THEN 1 ELSE 0 END)               AS SBCN_ETC_CNT --의결완료기타
                              FROM TBBADDED146M F
                                  ,TBBADDED145M G
                                  ,TBBADDED113M H
                             WHERE F.AUD_YR      = G.AUD_YR
                               AND F.AUD_NO      = G.AUD_NO
                               AND F.AUD_STEP_CD = G.AUD_STEP_CD
                               AND F.APVR_CD     = G.APVR_CD
                               AND F.FNL_YN      = G.FNL_YN
                               AND F.AFF_SNO     = G.AFF_SNO
                               AND F.AUD_YR      = H.AUD_YR(+)
                               AND F.AUD_NO      = H.AUD_NO(+)
                               AND F.AFF_SNO     = H.AFF_SNO(+)
                               AND F.DSP_RQ_SNO  = H.DSP_RQ_SNO(+) --LHH
                               AND F.AUD_YR      = #{audYr} --PARAM
                               AND F.AUD_NO      = #{audNo}  --PARAM
                               AND F.FNL_YN      = 'Y'
                             GROUP BY F.AUD_YR,F.AUD_NO
                           ) G3
                     WHERE G1.AUD_YR = G2.AUD_YR(+)
                       AND G1.AUD_NO = G2.AUD_NO(+)
                       AND G1.AUD_YR = G3.AUD_YR(+)
                       AND G1.AUD_NO = G3.AUD_NO(+)
                   ) T1,(SELECT LEVEL NO FROM DUAL CONNECT BY LEVEL <= 6) T2
             WHERE 1=1
               --AND T2.NO IN ('1','2','3') --종료보고 대비 건수
               --AND T2.NO IN ('4','5','6') --처분요구 처리율
            ]]>
    </select>
    
    
    
    <select id="selectSubList2" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.aep.fer.dao.AEPFER002QMapper.selectSubList2 */
            <![CDATA[
            SELECT DECODE(T2.NO, 1, '전체', 2, '처리안작성', '의결완료' ) AS CNT_NM
                  ,NVL(DECODE(T2.NO ,1, T1.FNL_D10_CNT
                                    ,2, T1.RPRT_D10_CNT
                                    ,T1.SBCN_D10_CNT
                                ), 0) AS D10_CNT
                  ,NVL(DECODE(T2.NO ,1, T1.FNL_E10_CNT
                                    ,2, T1.RPRT_E10_CNT
                                    ,T1.FNL_E10_CNT
                                 ), 0) AS E10_CNT
                  ,NVL(DECODE(T2.NO ,1, T1.FNL_D10_CNT+T1.FNL_E10_CNT
                                    ,2, T1.RPRT_D10_CNT+T1.RPRT_E10_CNT
                                    ,T1.SBCN_D10_CNT + T1.SBCN_E10_CNT
                                 ), 0) AS TOTAL_CNT
                  ,NVL(DECODE(T2.NO ,1, ' '
                                    ,2, ROUND((T1.RPRT_D10_CNT+T1.RPRT_E10_CNT)/(T1.FNL_D10_CNT+T1.FNL_E10_CNT), 2)*100 || '%'
                                    ,ROUND((T1.SBCN_D10_CNT + T1.SBCN_E10_CNT)/(T1.FNL_D10_CNT+T1.FNL_E10_CNT), 2)*100 || '%'
                                 ), 0) AS RATE
            FROM 
            (
                SELECT SUM(CASE WHEN A.AUD_STEP_CD > 'A1050' AND B.REFER_DVSN_CD = 'D10' AND A.FNL_YN = 'Y' THEN 1 
                             ELSE 0 END) AS FNL_D10_CNT
                      ,SUM(CASE  WHEN A.AUD_STEP_CD > 'A1050' AND B.REFER_DVSN_CD = 'E10' AND A.FNL_YN = 'Y'  THEN 1 
                             ELSE 0 END) AS FNL_E10_CNT    
                      ,SUM(CASE WHEN A.AUD_STEP_CD > 'A1050' AND B.REFER_DVSN_CD = 'D10' AND A.FNL_YN = 'Y' THEN 1 
                             ELSE 0 END) AS RPRT_D10_CNT
                      ,SUM(CASE  WHEN A.AUD_STEP_CD > 'A1050' AND B.REFER_DVSN_CD = 'E10' AND A.FNL_YN = 'Y'  THEN 1 
                             ELSE 0 END) AS RPRT_E10_CNT
                      ,SUM(CASE WHEN A.AUD_STEP_CD >= 'A1070' AND B.REFER_DVSN_CD = 'D10' AND A.FNL_YN = 'Y' AND C.SBCN_VT_CD  IS NOT NULL THEN 1 
                             ELSE 0 END) AS SBCN_D10_CNT
                      ,SUM(CASE  WHEN A.AUD_STEP_CD >= 'A1070' AND B.REFER_DVSN_CD = 'E10' THEN 1 
                             ELSE 0 END) AS SBCN_E10_CNT  
                  FROM TBBADDED146M A INNER JOIN TBBADDED145M B
                        ON A.AUD_YR  = B.AUD_YR
                       AND A.AUD_NO  = B.AUD_NO
                       AND A.AUD_STEP_CD = B.AUD_STEP_CD
                       AND A.APVR_CD = B.APVR_CD
                       AND A.FNL_YN = B.FNL_YN
                       AND A.AFF_SNO = B.AFF_SNO LEFT OUTER JOIN TBBADDED113M C
                        ON A.AUD_YR  = C.AUD_YR
                       AND A.AUD_NO  = C.AUD_NO
                       AND A.AFF_SNO = C.AFF_SNO 
                       AND A.DSP_RQ_CD = C.DSP_RQ_CD
                 WHERE A.AUD_YR = #{audYr}
                   AND A.AUD_NO = #{audNo}
                   AND A.AUD_STEP_CD > 'A1050' 
                   AND A.FNL_YN = 'Y' 
            ) T1, (SELECT LEVEL NO FROM DUAL CONNECT BY LEVEL < =3) T2
            ORDER BY T2.NO
            ]]>
    </select>
    
    
    <select id="selectSubList3" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.aep.fer.dao.AEPFER002QMapper.selectSubList3 */
            <![CDATA[
            WITH AFF_DSP_INFO AS (
                                  SELECT Z.AUD_YR
                                        ,Z.AUD_NO
                                        ,Z.AUD_STEP_CD
                                        ,Z.DOC_ID
                                        ,Z.APVR_CD
                                        ,Z.AFF_SNO
                                        ,Y.DSP_RQ_SNO
                                        ,Z.AFF_CD
                                        ,Y.AFF_DSP_CD
                                        ,Z.AFF_CD||'-'||Y.AFF_DSP_CD AS AFF_DSP_JOIN
                                        ,Y.DSP_RQ_CD
                                        ,DECODE(Z.APVR_CD,'0010200','종료보고'
                                                         ,'0013600','과장'
                                                         ,'0015800','국장','0035100','국장','0058100','국장'
                                                         ,'0055600','차장','0045900','차장'
                                                         ,'0055700','총장'
                                                         ,'0010600','위원'
                                                         ,'A1070'  ,'부의결과'
                                                         ,Z.APVR_CD) AS APVR_RNAME
                                    FROM TBBADDED145M Z
                                        ,TBBADDED146M Y
                                   WHERE 1=1
                                     AND Z.AUD_YR      = #{audYr} --PARAM
                                     AND Z.AUD_NO      = #{audNo}  --PARAM
                                     AND Z.AUD_YR      = Y.AUD_YR
                                     AND Z.AUD_NO      = Y.AUD_NO
                                     AND Z.AUD_STEP_CD = Y.AUD_STEP_CD
                                     AND Z.DOC_ID      = Y.DOC_ID
                                     AND Z.APVR_CD     = Y.APVR_CD
                                     AND Z.AFF_SNO     = Y.AFF_SNO
                                 )
            SELECT DECODE(DSP_RQ_GR_CD, NULL, '계', MAX(DSP_RQ_GR)) AS DSP_RQ_GR
                 , DECODE(SUM(END_RPT), 0, '', SUM(END_RPT)) AS END_RPT
                 , DECODE(SUM(IC_D50), 0, '', SUM(IC_D50)) AS IC_D50
                 , DECODE(SUM(IC_D20), 0, '', SUM(IC_D20)) AS IC_D20
                 , DECODE(SUM(IC_D40), 0, '', SUM(IC_D40)) AS IC_D40
                 , DECODE(SUM(DC_D90), 0, '', SUM(DC_D90)) AS DC_D90
                 , DECODE(SUM(DC_D20), 0, '', SUM(DC_D20)) AS DC_D20
                 , DECODE(SUM(DC_D30), 0, '', SUM(DC_D30)) AS DC_D30
                 , DECODE(SUM(RE_SBCN_DSP_CNT), 0, '', SUM(RE_SBCN_DSP_CNT)) AS RE_SBCN_DSP_CNT
                 , DECODE(SUM(GWA_DSP_CNT), 0, '', SUM(GWA_DSP_CNT)) AS GWA_DSP_CNT
                 , DECODE(SUM(ENF_DSP_CNT), 0, '', SUM(ENF_DSP_CNT)) AS ENF_DSP_CNT
              FROM (
            SELECT E6.DSP_RQ_GR AS DSP_RQ_GR_CD
                  ,DECODE(E6.DSP_RQ_GR,'DSP_01','판정'
                                      ,'DSP_02','징계'
                                      ,'DSP_03','시정'
                                      ,'DSP_04','주의'
                                      ,'DSP_05','개선'
                                      ,'DSP_06','권고'
                                      ,'DSP_07','통보'
                                      ,'DSP_08','통보(인사자료)'
                                      ,'DSP_09','통보(비위)'
                                      ,'DSP_10','통보(시정완료)'
                                      ,'DSP_11','모범사례'
                                      ,'DSP_12','고발'
                                      ,'DSP_13','수사요청'
                                      ,'DSP_99','기타','계') AS DSP_RQ_GR --처분요구종류
                  ,SUM(E6.END_RPT) AS END_RPT  --종료보고건수
                  ,SUM(XY.IC_D50) AS IC_D50    --증가_새로추가
                  ,SUM(XY.IC_D20) AS IC_D20    --증가_종류변경
                  ,SUM(XY.IC_D40) AS IC_D40    --증가_분건
                  ,SUM(XY.DC_D90) AS DC_D90    --감소_불문
                  ,SUM(XY.DC_D20) AS DC_D20    --감소_종류변경
                  ,SUM(XY.DC_D30) AS DC_D30    --감소_합건
                  --,XY.ICDC_SUM  --건수합계
                  ,0 AS RE_SBCN_DSP_CNT --재부의건수
                  ,SUM(E6.GWA_DSP_CNT) AS GWA_DSP_CNT   --품질접수건수=과장접수건수
                  ,SUM(E6.ENF_DSP_CNT) AS ENF_DSP_CNT   --시행건수=부의결과건수
              FROM (
                    SELECT E5.DSP_RQ_GR
                          ,SUM(E5.END_RPT)      AS END_RPT      --종료보고건수
                          ,SUM(E5.GWA_DSP_CNT)  AS GWA_DSP_CNT  --품질접수건수
                          ,SUM(E5.ENF_DSP_CNT)  AS ENF_DSP_CNT  --시행건수
                      FROM (
                            SELECT DECODE(E4.LV ,1   ,'DSP_01'
                                                ,2   ,'DSP_02'
                                                ,3   ,'DSP_03'
                                                ,4   ,'DSP_04'
                                                ,5   ,'DSP_05'
                                                ,6   ,'DSP_06'
                                                ,7   ,'DSP_07'
                                                ,8   ,'DSP_08'
                                                ,9   ,'DSP_09'
                                                ,10  ,'DSP_10'
                                                ,11  ,'DSP_11'
                                                ,12  ,'DSP_12'
                                                ,13  ,'DSP_13'
                                                ,14  ,'DSP_99') AS DSP_RQ_GR --처분요구종료
                                  ,CASE WHEN E4.LV = 1  AND E3.APVR_CD = '0010200' THEN E3.DSP_01
                                        WHEN E4.LV = 2  AND E3.APVR_CD = '0010200' THEN E3.DSP_02
                                        WHEN E4.LV = 3  AND E3.APVR_CD = '0010200' THEN E3.DSP_03
                                        WHEN E4.LV = 4  AND E3.APVR_CD = '0010200' THEN E3.DSP_04
                                        WHEN E4.LV = 5  AND E3.APVR_CD = '0010200' THEN E3.DSP_05
                                        WHEN E4.LV = 6  AND E3.APVR_CD = '0010200' THEN E3.DSP_06
                                        WHEN E4.LV = 7  AND E3.APVR_CD = '0010200' THEN E3.DSP_07
                                        WHEN E4.LV = 8  AND E3.APVR_CD = '0010200' THEN E3.DSP_08
                                        WHEN E4.LV = 9  AND E3.APVR_CD = '0010200' THEN E3.DSP_09
                                        WHEN E4.LV = 10 AND E3.APVR_CD = '0010200' THEN E3.DSP_10
                                        WHEN E4.LV = 11 AND E3.APVR_CD = '0010200' THEN E3.DSP_11
                                        WHEN E4.LV = 12 AND E3.APVR_CD = '0010200' THEN E3.DSP_12
                                        WHEN E4.LV = 13 AND E3.APVR_CD = '0010200' THEN E3.DSP_13
                                        WHEN E4.LV = 14 AND E3.APVR_CD = '0010200' THEN E3.DSP_99
                                    END AS END_RPT                                                  --종료보고건수
                                  ,CASE WHEN E4.LV = 1  AND E3.APVR_CD = '0013600' THEN E3.DSP_01
                                        WHEN E4.LV = 2  AND E3.APVR_CD = '0013600' THEN E3.DSP_02
                                        WHEN E4.LV = 3  AND E3.APVR_CD = '0013600' THEN E3.DSP_03
                                        WHEN E4.LV = 4  AND E3.APVR_CD = '0013600' THEN E3.DSP_04
                                        WHEN E4.LV = 5  AND E3.APVR_CD = '0013600' THEN E3.DSP_05
                                        WHEN E4.LV = 6  AND E3.APVR_CD = '0013600' THEN E3.DSP_06
                                        WHEN E4.LV = 7  AND E3.APVR_CD = '0013600' THEN E3.DSP_07
                                        WHEN E4.LV = 8  AND E3.APVR_CD = '0013600' THEN E3.DSP_08
                                        WHEN E4.LV = 9  AND E3.APVR_CD = '0013600' THEN E3.DSP_09
                                        WHEN E4.LV = 10 AND E3.APVR_CD = '0013600' THEN E3.DSP_10
                                        WHEN E4.LV = 11 AND E3.APVR_CD = '0013600' THEN E3.DSP_11
                                        WHEN E4.LV = 12 AND E3.APVR_CD = '0013600' THEN E3.DSP_12
                                        WHEN E4.LV = 13 AND E3.APVR_CD = '0013600' THEN E3.DSP_13
                                        WHEN E4.LV = 14 AND E3.APVR_CD = '0013600' THEN E3.DSP_99
                                    END AS GWA_DSP_CNT                                              --과장결재건수=품질접수건수
                                  ,CASE WHEN E4.LV = 1  AND E3.APVR_CD = 'A1070' THEN E3.DSP_01
                                        WHEN E4.LV = 2  AND E3.APVR_CD = 'A1070' THEN E3.DSP_02
                                        WHEN E4.LV = 3  AND E3.APVR_CD = 'A1070' THEN E3.DSP_03
                                        WHEN E4.LV = 4  AND E3.APVR_CD = 'A1070' THEN E3.DSP_04
                                        WHEN E4.LV = 5  AND E3.APVR_CD = 'A1070' THEN E3.DSP_05
                                        WHEN E4.LV = 6  AND E3.APVR_CD = 'A1070' THEN E3.DSP_06
                                        WHEN E4.LV = 7  AND E3.APVR_CD = 'A1070' THEN E3.DSP_07
                                        WHEN E4.LV = 8  AND E3.APVR_CD = 'A1070' THEN E3.DSP_08
                                        WHEN E4.LV = 9  AND E3.APVR_CD = 'A1070' THEN E3.DSP_09
                                        WHEN E4.LV = 10 AND E3.APVR_CD = 'A1070' THEN E3.DSP_10
                                        WHEN E4.LV = 11 AND E3.APVR_CD = 'A1070' THEN E3.DSP_11
                                        WHEN E4.LV = 12 AND E3.APVR_CD = 'A1070' THEN E3.DSP_12
                                        WHEN E4.LV = 13 AND E3.APVR_CD = 'A1070' THEN E3.DSP_13
                                        WHEN E4.LV = 14 AND E3.APVR_CD = 'A1070' THEN E3.DSP_99
                                    END AS ENF_DSP_CNT                                              --부의종료건수=시행건수
                              FROM (
                                    SELECT E2.APVR_CD
                                          ,SUM(E2.DSP_01) AS DSP_01
                                          ,SUM(E2.DSP_02) AS DSP_02
                                          ,SUM(E2.DSP_03) AS DSP_03
                                          ,SUM(E2.DSP_04) AS DSP_04
                                          ,SUM(E2.DSP_05) AS DSP_05
                                          ,SUM(E2.DSP_06) AS DSP_06
                                          ,SUM(E2.DSP_07) AS DSP_07
                                          ,SUM(E2.DSP_08) AS DSP_08
                                          ,SUM(E2.DSP_09) AS DSP_09
                                          ,SUM(E2.DSP_10) AS DSP_10
                                          ,SUM(E2.DSP_11) AS DSP_11
                                          ,SUM(E2.DSP_12) AS DSP_12
                                          ,SUM(E2.DSP_13) AS DSP_13
                                          ,SUM(E2.DSP_99) AS DSP_99
                                      FROM (
                                            SELECT DISTINCT
                                                   E1.APVR_CD
                                                  ,E1.DSP_RQ_CD
                                                  ,DECODE(E1.DSP_RQ_CD,'110',1,'120',1                                   ,0) AS DSP_01 --판정
                                                  ,DECODE(E1.DSP_RQ_CD,'210',1                                           ,0) AS DSP_02 --징계
                                                  ,DECODE(E1.DSP_RQ_CD,'310',1,'320',1                                   ,0) AS DSP_03 --시정
                                                  ,DECODE(E1.DSP_RQ_CD,'410',1                                           ,0) AS DSP_04 --주의
                                                  ,DECODE(E1.DSP_RQ_CD,'510',1,'520',1,'530',1                           ,0) AS DSP_05 --개선
                                                  ,DECODE(E1.DSP_RQ_CD,'611',1                                           ,0) AS DSP_06 --권고
                                                  ,DECODE(E1.DSP_RQ_CD,'610',1                                           ,0) AS DSP_07 --통보
                                                  ,DECODE(E1.DSP_RQ_CD,'620',1                                           ,0) AS DSP_08 --통보(인사자료)
                                                  ,DECODE(E1.DSP_RQ_CD,'623',1                                           ,0) AS DSP_09 --통보(비위)
                                                  ,DECODE(E1.DSP_RQ_CD,'625',1                                           ,0) AS DSP_10 --통보(시정완료)
                                                  ,DECODE(E1.DSP_RQ_CD,'810',1,'820',1,'830',1,'840',1,'850',1           ,0) AS DSP_11 --모범사례
                                                  ,DECODE(E1.DSP_RQ_CD,'710',1,'720',1                                   ,0) AS DSP_12 --고발
                                                  ,DECODE(E1.DSP_RQ_CD,'730',1                                           ,0) AS DSP_13 --수사요청
                                                  ,DECODE(E1.DSP_RQ_CD,'110',0,'120',0,'210',0,'310',0,'320',0,'410',0
                                                                      ,'510',0,'520',0,'530',0
                                                                      ,'611',0,'610',0,'620',0,'623',0,'625',0
                                                                      ,'810',0,'820',0,'830',0,'840',0,'850',0
                                                                      ,'710',0,'720',0,'730',0                           ,1) AS DSP_99 --기타
                                                  ,ST1.AFF_CD
                                                  ,E1.AFF_DSP_CD
                                              FROM TBBADDED146M E1
                                             INNER JOIN TBBADDED145M ST1 ON (    E1.AUD_YR = ST1.AUD_YR
                                                                             AND E1.AUD_NO = ST1.AUD_NO
                                                                             AND E1.DOC_ID = ST1.DOC_ID
                                                                             AND E1.APVR_CD = ST1.APVR_CD
                                                                             AND E1.AUD_STEP_CD = ST1.AUD_STEP_CD 
                                                                             AND E1.AFF_SNO = ST1.AFF_SNO)
                                                                         ]]>
                                                                         <if test="docId != null and docId != '' "> 
                                                                             AND E1.DOC_ID = #{docId}
                                                                         </if>
                                                                         <![CDATA[
                                             WHERE 1=1
                                               AND E1.AUD_YR          = #{audYr}    --PARAM
                                               AND E1.AUD_NO          = #{audNo}    --PARAM
                                               AND E1.AUD_STEP_CD     = 'A1050' 
                                               AND E1.APVR_CD         = '0010200'
                                               AND E1.DOC_ID          = #{endDocId}        --종료보고서 DOC_ID
                                     
                                             UNION ALL
                                     
                                            SELECT E1.APVR_CD
                                                  ,E1.DSP_RQ_CD
                                                  ,DECODE(E1.DSP_RQ_CD,'110',1,'120',1                                   ,0) AS DSP_01 --판정
                                                  ,DECODE(E1.DSP_RQ_CD,'210',1                                           ,0) AS DSP_02 --징계
                                                  ,DECODE(E1.DSP_RQ_CD,'310',1,'320',1                                   ,0) AS DSP_03 --시정
                                                  ,DECODE(E1.DSP_RQ_CD,'410',1                                           ,0) AS DSP_04 --주의
                                                  ,DECODE(E1.DSP_RQ_CD,'510',1,'520',1,'530',1                           ,0) AS DSP_05 --개선
                                                  ,DECODE(E1.DSP_RQ_CD,'611',1                                           ,0) AS DSP_06 --권고
                                                  ,DECODE(E1.DSP_RQ_CD,'610',1                                           ,0) AS DSP_07 --통보
                                                  ,DECODE(E1.DSP_RQ_CD,'620',1                                           ,0) AS DSP_08 --통보(인사자료)
                                                  ,DECODE(E1.DSP_RQ_CD,'623',1                                           ,0) AS DSP_09 --통보(비위)
                                                  ,DECODE(E1.DSP_RQ_CD,'625',1                                           ,0) AS DSP_10 --통보(시정완료)
                                                  ,DECODE(E1.DSP_RQ_CD,'810',1,'820',1,'830',1,'840',1,'850',1           ,0) AS DSP_11 --모범사례
                                                  ,DECODE(E1.DSP_RQ_CD,'710',1,'720',1                                   ,0) AS DSP_12 --고발
                                                  ,DECODE(E1.DSP_RQ_CD,'730',1                                           ,0) AS DSP_13 --수사요청
                                                  ,DECODE(E1.DSP_RQ_CD,'110',0,'120',0,'210',0,'310',0,'320',0,'410',0
                                                                      ,'510',0,'520',0,'530',0
                                                                      ,'611',0,'610',0,'620',0,'623',0,'625',0
                                                                      ,'810',0,'820',0,'830',0,'840',0,'850',0
                                                                      ,'710',0,'720',0,'730',0                           ,1) AS DSP_99 --기타
                                                  ,''
                                                  ,''
                                              FROM TBBADDED146M E1
                                             WHERE 1=1
                                               AND E1.AUD_YR          = #{audYr}    --PARAM
                                               AND E1.AUD_NO          = #{audNo}     --PARAM
                                           ]]>
                                           <if test="docId != null and docId != '' "> 
                                               AND E1.DOC_ID = #{docId}       --DOC_ID
                                           </if>
                                           <![CDATA[
                                               AND (   (E1.APVR_CD     = '0013600' AND 1=1) --과장본결재완료
                                                    OR (E1.APVR_CD     = 'A1070'   AND 1=1) --부의결과
                                                   )
                                               AND E1.APVR_CD <> '0010200'
                                           ) E2
                                     GROUP BY E2.APVR_CD
                                   ) E3
                                  ,(SELECT LEVEL LV FROM DUAL CONNECT BY LEVEL <=14) E4
                           ) E5
                     GROUP BY E5.DSP_RQ_GR
                   ) E6
                  ,(
                    SELECT CC.DSP_RQ_GR
                          ,SUM(CC.IC_D50)    AS IC_D50
                          ,SUM(CC.IC_D20)    AS IC_D20
                          ,SUM(CC.IC_D40)    AS IC_D40
                          ,SUM(CC.DC_D90)    AS DC_D90
                          ,SUM(CC.DC_D20)    AS DC_D20
                          ,SUM(CC.DC_D30)    AS DC_D30
                          ,SUM(CC.ICDC_SUM)  AS ICDC_SUM
                      FROM (
                            SELECT BB.DSP_RQ_DVSN
                                  ,CASE WHEN BB.DSP_RQ_DVSN='110' THEN 'DSP_01'
                                        WHEN BB.DSP_RQ_DVSN='120' THEN 'DSP_01'
                                        WHEN BB.DSP_RQ_DVSN='210' THEN 'DSP_02'
                                        WHEN BB.DSP_RQ_DVSN='310' THEN 'DSP_03'
                                        WHEN BB.DSP_RQ_DVSN='320' THEN 'DSP_03'
                                        --WHEN BB.DSP_RQ_DVSN='390' THEN 'DSP_03'
                                        --WHEN BB.DSP_RQ_DVSN='391' THEN 'DSP_03'
                                        WHEN BB.DSP_RQ_DVSN='410' THEN 'DSP_04'
                                        --WHEN BB.DSP_RQ_DVSN='490' THEN 'DSP_04'
                                        WHEN BB.DSP_RQ_DVSN='510' THEN 'DSP_05'
                                        WHEN BB.DSP_RQ_DVSN='520' THEN 'DSP_05'
                                        WHEN BB.DSP_RQ_DVSN='530' THEN 'DSP_05'
                                        WHEN BB.DSP_RQ_DVSN='610' THEN 'DSP_07'
                                        WHEN BB.DSP_RQ_DVSN='611' THEN 'DSP_06'
                                        WHEN BB.DSP_RQ_DVSN='620' THEN 'DSP_08'
                                        --WHEN BB.DSP_RQ_DVSN='621' THEN 'DSP_07'
                                        WHEN BB.DSP_RQ_DVSN='623' THEN 'DSP_09'
                                        WHEN BB.DSP_RQ_DVSN='625' THEN 'DSP_10'
                                        --WHEN BB.DSP_RQ_DVSN='630' THEN 'DSP_07'
                                        WHEN BB.DSP_RQ_DVSN='710' THEN 'DSP_12'
                                        WHEN BB.DSP_RQ_DVSN='720' THEN 'DSP_12'
                                        WHEN BB.DSP_RQ_DVSN='730' THEN 'DSP_13'
                                        WHEN BB.DSP_RQ_DVSN='810' THEN 'DSP_11'
                                        WHEN BB.DSP_RQ_DVSN='820' THEN 'DSP_11'
                                        WHEN BB.DSP_RQ_DVSN='830' THEN 'DSP_11'
                                        WHEN BB.DSP_RQ_DVSN='840' THEN 'DSP_11'
                                        WHEN BB.DSP_RQ_DVSN='850' THEN 'DSP_11'
                                   ELSE 'DSP_99'
                                    END AS DSP_RQ_GR
                                  ,BB.IC_D50
                                  ,BB.IC_D20
                                  ,BB.IC_D40
                                  ,BB.DC_D90
                                  ,BB.DC_D20
                                  ,BB.DC_D30
                                  ,BB.ICDC_SUM
                              FROM (
            
            
                                    SELECT AA.DATA_GUBN         --데이터구분
                                          ,AA.AFF_MPP_DVSN_CD   --매핑정보
                                          ,CASE WHEN AA.AFF_MPP_DVSN_CD = 'D20M'                                                      THEN 'D20'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D30M'                                                      THEN 'D20'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D40M'                                                      THEN 'D20'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D30' AND AA.BEFO_AFF_DSP_JOIN_CD = AA.CURR_AFF_DSP_JOIN_CD THEN 'D20'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D40' AND AA.BEFO_AFF_DSP_JOIN_CD = AA.CURR_AFF_DSP_JOIN_CD THEN 'D20'
                                                ELSE AA.AFF_MPP_DVSN_CD
                                            END AS T_AFF_MPP_DVSN_CD --변환매핑정보
                                          ,AA.BEFO_DSP_RQ_CD         --이전 처분요구
                                          ,AA.CURR_DSP_RQ_CD         --이후 처분요구
                                          ,AA.BEFO_AFF_DSP_JOIN_CD   --이전 사건처분요구코드
                                          ,AA.CURR_AFF_DSP_JOIN_CD   --이후 사건처분요구코드
                                          ,AA.APVR_CD                --결재자코드
                                          ,CASE WHEN AA.AFF_MPP_DVSN_CD = 'D20'  THEN AA.CURR_DSP_RQ_CD  --종류변경
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D30'  THEN AA.BEFO_DSP_RQ_CD  --합건
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D40'  THEN AA.CURR_DSP_RQ_CD  --분건
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D50'  THEN AA.CURR_DSP_RQ_CD  --신규
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D90'  THEN AA.BEFO_DSP_RQ_CD  --불문
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D20M' THEN AA.BEFO_DSP_RQ_CD  --종류변경(감소용)
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D30M' THEN AA.CURR_DSP_RQ_CD  --합건(종류변경용)
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D40M' THEN AA.BEFO_DSP_RQ_CD  --분건(종류변경용)
                                                ELSE ''
                                            END AS DSP_RQ_DVSN --COUNT용 처분요구
            
                                          ,CASE WHEN AA.AFF_MPP_DVSN_CD = 'D50'                                                         THEN 1 END AS IC_D50 --증가_새로추가
                                          ,CASE WHEN AA.AFF_MPP_DVSN_CD = 'D20'
                                                  OR (AA.AFF_MPP_DVSN_CD = 'D40' AND AA.BEFO_AFF_DSP_JOIN_CD = AA.CURR_AFF_DSP_JOIN_CD)
                                                  OR AA.AFF_MPP_DVSN_CD = 'D30M'                                                        THEN 1 END AS IC_D20 --증가_종류변경
                                          ,CASE WHEN AA.AFF_MPP_DVSN_CD = 'D40'
                                                 AND AA.BEFO_AFF_DSP_JOIN_CD <> AA.CURR_AFF_DSP_JOIN_CD                                 THEN 1 END AS IC_D40 --증가_분건
                                          ,CASE WHEN AA.AFF_MPP_DVSN_CD = 'D90'                                                         THEN 1 END AS DC_D90 --감소_불문
                                          ,CASE WHEN AA.AFF_MPP_DVSN_CD = 'D20M'
                                                  OR (AA.AFF_MPP_DVSN_CD = 'D30' AND AA.BEFO_AFF_DSP_JOIN_CD = AA.CURR_AFF_DSP_JOIN_CD)
                                                  OR AA.AFF_MPP_DVSN_CD = 'D40M'                                                        THEN 1 END AS DC_D20 --감소_종류변경
                                          ,CASE WHEN AA.AFF_MPP_DVSN_CD = 'D30'
                                                 AND AA.BEFO_AFF_DSP_JOIN_CD <> AA.CURR_AFF_DSP_JOIN_CD                                 THEN 1 END AS DC_D30 --감소_합건
                                          ,1 AS ICDC_SUM
            
                                          ,CASE WHEN AA.AFF_MPP_DVSN_CD = 'D20'  THEN F_CODE_NM('1000002',AA.CURR_DSP_RQ_CD) || F_CODE_NM('1000777',AA.AFF_MPP_DVSN_CD) ||' 증가'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D30'  THEN F_CODE_NM('1000002',AA.BEFO_DSP_RQ_CD) || F_CODE_NM('1000777',AA.AFF_MPP_DVSN_CD) ||' 감소'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D40'  THEN F_CODE_NM('1000002',AA.CURR_DSP_RQ_CD) || F_CODE_NM('1000777',AA.AFF_MPP_DVSN_CD) ||' 증가'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D50'  THEN F_CODE_NM('1000002',AA.CURR_DSP_RQ_CD) || F_CODE_NM('1000777',AA.AFF_MPP_DVSN_CD) ||' 증가'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D90'  THEN F_CODE_NM('1000002',AA.BEFO_DSP_RQ_CD) || F_CODE_NM('1000777',AA.AFF_MPP_DVSN_CD) ||' 감소'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D20M' THEN F_CODE_NM('1000002',AA.BEFO_DSP_RQ_CD) || F_CODE_NM('1000777',SUBSTR(AA.AFF_MPP_DVSN_CD,0,3)) ||' 감소'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D30M' THEN F_CODE_NM('1000002',AA.CURR_DSP_RQ_CD) || F_CODE_NM('1000777',SUBSTR(AA.AFF_MPP_DVSN_CD,0,3)) ||' 감소'
                                                WHEN AA.AFF_MPP_DVSN_CD = 'D40M' THEN F_CODE_NM('1000002',AA.BEFO_DSP_RQ_CD) || F_CODE_NM('1000777',SUBSTR(AA.AFF_MPP_DVSN_CD,0,3)) ||' 감소'
                                                ELSE ''
                                            END AS QQQQQQQQQQQQQQQQQQQQQQQQQQQ
                                      FROM (    --▶▶▶▶▶▶ 1.매핑정보중 유지를 제외하고 조회 ◀◀◀◀◀
                                                SELECT 1 AS DATA_GUBN
                                                      ,A.AFF_MPP_DVSN_CD AS AFF_MPP_DVSN_CD
                                                      ,F_CODE_NM('1000777',A.AFF_MPP_DVSN_CD) AS AFF_MPP_DVSN_NM
                                                      ,(SELECT A1.DSP_RQ_CD
                                                          FROM AFF_DSP_INFO A1
                                                         WHERE A1.AUD_YR      = A.AUD_YR
                                                           AND A1.AUD_NO      = A.AUD_NO
                                                           AND A1.AUD_STEP_CD = A.AUD_STEP_CD
                                                           AND A1.AFF_SNO     = A.AFF_SNO
                                                           AND A1.DSP_RQ_SNO  = A.DSP_RQ_SNO
                                                           AND A1.APVR_CD     = A.APVR_CD  
                                                           AND A1.APVR_RNAME  = DECODE(A.APVR_CD ,'0013600','종료보고'
                                                                                                 ,'0015800','과장'
                                                                                                 ,'0035100','과장'
                                                                                                 ,'0058100','과장'
                                                                                                 ,'0055600','국장'
                                                                                                 ,'0045900','국장'
                                                                                                 ,'0055700','차장'
                                                                                                 ,'0010600','총장'
                                                                                                 ,'A1070'  ,'위원')
                                                           AND A1.AFF_DSP_JOIN = SUBSTR(A.PRE_AFF_NO,13)
                                                       ) AS BEFO_DSP_RQ_CD
                                                      ,(SELECT A2.DSP_RQ_CD
                                                          FROM AFF_DSP_INFO A2
                                                         WHERE A2.AUD_YR       = A.AUD_YR
                                                           AND A2.AUD_NO       = A.AUD_NO
                                                           AND A2.APVR_CD      = A.APVR_CD
                                                           AND A2.AUD_STEP_CD  = A.AUD_STEP_CD
                                                           AND A2.AFF_SNO      = A.AFF_SNO
                                                           AND A2.DSP_RQ_SNO   = A.DSP_RQ_SNO
                                                           AND A2.AFF_DSP_JOIN = SUBSTR(A.AFF_NO,13)
                                                       ) AS CURR_DSP_RQ_CD
                                                      ,A.APVR_CD
                                                      ,(SELECT A3.AFF_DSP_JOIN
                                                          FROM AFF_DSP_INFO A3
                                                         WHERE A3.AUD_YR       = A.AUD_YR
                                                           AND A3.AUD_NO       = A.AUD_NO
                                                           AND A3.AUD_STEP_CD  = A.AUD_STEP_CD
                                                           AND A3.AFF_SNO      = A.AFF_SNO
                                                           AND A3.DSP_RQ_SNO   = A.DSP_RQ_SNO
                                                           AND A3.APVR_CD      = A.APVR_CD   
                                                           AND A3.APVR_RNAME   = DECODE(A.APVR_CD,'0013600','종료보고'
                                                                                                 ,'0015800','과장'
                                                                                                 ,'0035100','과장'
                                                                                                 ,'0058100','과장'
                                                                                                 ,'0055600','국장'
                                                                                                 ,'0045900','국장'
                                                                                                 ,'0055700','차장'
                                                                                                 ,'0010600','총장'
                                                                                                 ,'A1070'  ,'위원')
                                                           AND A3.AFF_DSP_JOIN = SUBSTR(A.PRE_AFF_NO,13)
                                                       ) AS BEFO_AFF_DSP_JOIN_CD
                                                      ,(SELECT A4.AFF_DSP_JOIN
                                                          FROM AFF_DSP_INFO A4
                                                         WHERE A4.AUD_YR       = A.AUD_YR
                                                           AND A4.AUD_NO       = A.AUD_NO
                                                           AND A4.APVR_CD      = A.APVR_CD
                                                           AND A4.AUD_STEP_CD  = A.AUD_STEP_CD
                                                           AND A4.AFF_SNO      = A.AFF_SNO
                                                           AND A4.DSP_RQ_SNO   = A.DSP_RQ_SNO
                                                           AND A4.AFF_DSP_JOIN = SUBSTR(A.AFF_NO,13)
                                                       ) AS CURR_AFF_DSP_JOIN_CD
                                                  FROM TBBADDED148M A
                                                 WHERE 1=1
                                                   AND A.AUD_YR = #{audYr}    --PARAM
                                                   AND A.AUD_NO = #{audNo}     --PARAM
                                                   ]]>
                                                        <if test="docId != null and docId != '' "> 
                                                             AND A.DOC_ID = #{docId}        --PARAM
                                                        </if>
                                                   <![CDATA[
                                                   AND A.AFF_MPP_DVSN_CD LIKE 'D%'
                                                   AND A.AFF_MPP_DVSN_CD <> 'D10'
                                                --▶▶▶▶▶▶ 2.종류변경건 추가 조회 ◀◀◀◀◀
                                                 UNION ALL
                                                SELECT 2 AS DATA_GUBN
                                                      ,B.AFF_MPP_DVSN_CD||'M' AS AFF_MPP_DVSN_CD
                                                      ,F_CODE_NM('1000777',B.AFF_MPP_DVSN_CD) AS AFF_MPP_DVSN_NM
                                                      ,(SELECT B1.DSP_RQ_CD
                                                          FROM AFF_DSP_INFO B1
                                                         WHERE B1.AUD_YR       = B.AUD_YR
                                                           AND B1.AUD_NO       = B.AUD_NO
                                                           AND B1.AUD_STEP_CD  = B.AUD_STEP_CD
                                                           AND B1.AFF_SNO      = B.AFF_SNO
                                                           AND B1.DSP_RQ_SNO   = B.DSP_RQ_SNO
                                                           AND B1.APVR_CD      = B.APVR_CD         
                                                           AND B1.APVR_RNAME   = DECODE(B.APVR_CD,'0013600','종료보고'
                                                                                                 ,'0015800','과장'
                                                                                                 ,'0035100','과장'
                                                                                                 ,'0058100','과장'
                                                                                                 ,'0055600','국장'
                                                                                                 ,'0045900','국장'
                                                                                                 ,'0055700','차장'
                                                                                                 ,'0010600','총장'
                                                                                                 ,'A1070'  ,'위원')
                                                           AND B1.AFF_DSP_JOIN = SUBSTR(B.PRE_AFF_NO,13)
                                                       ) AS BEFO_DSP_RQ_CD
                                                      ,(SELECT B2.DSP_RQ_CD
                                                          FROM AFF_DSP_INFO B2
                                                         WHERE B2.AUD_YR       = B.AUD_YR
                                                           AND B2.AUD_NO       = B.AUD_NO
                                                           AND B2.APVR_CD      = B.APVR_CD
                                                           AND B2.AUD_STEP_CD  = B.AUD_STEP_CD
                                                           AND B2.AFF_SNO      = B.AFF_SNO
                                                           AND B2.DSP_RQ_SNO   = B.DSP_RQ_SNO                                       
                                                           AND B2.AFF_DSP_JOIN = SUBSTR(B.AFF_NO,13)
                                                       ) AS CURR_DSP_RQ_CD
                                                      ,B.APVR_CD
                                                      ,(SELECT B3.AFF_DSP_JOIN
                                                          FROM AFF_DSP_INFO B3
                                                         WHERE B3.AUD_YR       = B.AUD_YR
                                                           AND B3.AUD_NO       = B.AUD_NO
                                                           AND B3.AUD_STEP_CD  = B.AUD_STEP_CD
                                                           AND B3.AFF_SNO      = B.AFF_SNO
                                                           AND B3.DSP_RQ_SNO   = B.DSP_RQ_SNO
                                                           AND B3.APVR_CD      = B.APVR_CD 
                                                           AND B3.APVR_RNAME   = DECODE(B.APVR_CD,'0013600','종료보고'
                                                                                                 ,'0015800','과장'
                                                                                                 ,'0035100','과장'
                                                                                                 ,'0058100','과장'
                                                                                                 ,'0055600','국장'
                                                                                                 ,'0045900','국장'
                                                                                                 ,'0055700','차장'
                                                                                                 ,'0010600','총장'
                                                                                                 ,'A1070'  ,'위원')
                                                           AND B3.AFF_DSP_JOIN = SUBSTR(B.PRE_AFF_NO,13)
                                                       ) AS BEFO_AFF_DSP_JOIN_CD
                                                      ,(SELECT B4.AFF_DSP_JOIN
                                                          FROM AFF_DSP_INFO B4
                                                         WHERE B4.AUD_YR       = B.AUD_YR
                                                           AND B4.AUD_NO       = B.AUD_NO
                                                           AND B4.APVR_CD      = B.APVR_CD
                                                           AND B4.AUD_STEP_CD  = B.AUD_STEP_CD
                                                           AND B4.AFF_SNO      = B.AFF_SNO
                                                           AND B4.DSP_RQ_SNO   = B.DSP_RQ_SNO                                   
                                                           AND B4.AFF_DSP_JOIN = SUBSTR(B.AFF_NO,13)
                                                       ) AS CURR_AFF_DSP_JOIN_CD
                                                  FROM TBBADDED148M B
                                                 WHERE 1=1
                                                   AND B.AUD_YR = #{audYr}    --PARAM
                                                   AND B.AUD_NO = #{audNo}     --PARAM
                                                   ]]>
                                                        <if test="docId != null and docId != '' "> 
                                                             AND B.DOC_ID = #{docId}        --PARAM
                                                        </if>
                                                   <![CDATA[
                                                   AND B.AFF_MPP_DVSN_CD = 'D20'
                                                --▶▶▶▶▶▶ 3.합건,분건만 조회 ◀◀◀◀◀
                                                 UNION ALL
                                                SELECT 3 AS DATA_GUBN
                                                      ,C.AFF_MPP_DVSN_CD||'M' AS AFF_MPP_DVSN_CD
                                                      ,F_CODE_NM('1000777',C.AFF_MPP_DVSN_CD) AS AFF_MPP_DVSN_NM
                                                      ,(SELECT C1.DSP_RQ_CD
                                                          FROM AFF_DSP_INFO C1
                                                         WHERE C1.AUD_YR       = C.AUD_YR
                                                           AND C1.AUD_NO       = C.AUD_NO
                                                           AND C1.AUD_STEP_CD  = C.AUD_STEP_CD
                                                           AND C1.AFF_SNO      = C.AFF_SNO
                                                           AND C1.DSP_RQ_SNO   = C.DSP_RQ_SNO
                                                           AND C1.APVR_CD      = C.APVR_CD 
                                                           AND C1.APVR_RNAME   = DECODE(C.APVR_CD,'0013600','종료보고'
                                                                                                 ,'0015800','과장'
                                                                                                 ,'0035100','과장'
                                                                                                 ,'0058100','과장'
                                                                                                 ,'0055600','국장'
                                                                                                 ,'0045900','국장'
                                                                                                 ,'0055700','차장'
                                                                                                 ,'0010600','총장'
                                                                                                 ,'A1070'  ,'위원')
                                                           AND C1.AFF_DSP_JOIN = SUBSTR(C.PRE_AFF_NO,13)
                                                       ) AS BEFO_DSP_RQ_CD
                                                      ,(SELECT C2.DSP_RQ_CD
                                                          FROM AFF_DSP_INFO C2
                                                         WHERE C2.AUD_YR       = C.AUD_YR
                                                           AND C2.AUD_NO       = C.AUD_NO
                                                           AND C2.APVR_CD      = C.APVR_CD
                                                           AND C2.AUD_STEP_CD  = C.AUD_STEP_CD
                                                           AND C2.AFF_SNO      = C.AFF_SNO
                                                           AND C2.DSP_RQ_SNO   = C.DSP_RQ_SNO
                                                           AND C2.AFF_DSP_JOIN = SUBSTR(C.AFF_NO,13)
                                                       ) AS CURR_DSP_RQ_CD
                                                      ,C.APVR_CD
                                                      ,(SELECT C3.AFF_DSP_JOIN
                                                          FROM AFF_DSP_INFO C3
                                                         WHERE C3.AUD_YR       = C.AUD_YR
                                                           AND C3.AUD_NO       = C.AUD_NO
                                                           AND C3.AUD_STEP_CD  = C.AUD_STEP_CD
                                                           AND C3.AFF_SNO      = C.AFF_SNO
                                                           AND C3.DSP_RQ_SNO   = C.DSP_RQ_SNO
                                                           AND C3.APVR_CD      = C.APVR_CD 
                                                           AND C3.APVR_RNAME   = DECODE(C.APVR_CD,'0013600','종료보고'
                                                                                                 ,'0015800','과장'
                                                                                                 ,'0035100','과장'
                                                                                                 ,'0058100','과장'
                                                                                                 ,'0055600','국장'
                                                                                                 ,'0045900','국장'
                                                                                                 ,'0055700','차장'
                                                                                                 ,'0010600','총장'
                                                                                                 ,'A1070'  ,'위원')
                                                           AND C3.AFF_DSP_JOIN = SUBSTR(C.PRE_AFF_NO,13)
                                                       ) AS BEFO_AFF_DSP_JOIN_CD
                                                      ,(SELECT C4.AFF_DSP_JOIN
                                                          FROM AFF_DSP_INFO C4
                                                         WHERE C4.AUD_YR       = C.AUD_YR
                                                           AND C4.AUD_NO       = C.AUD_NO
                                                           AND C4.APVR_CD      = C.APVR_CD
                                                           AND C4.AUD_STEP_CD  = C.AUD_STEP_CD
                                                           AND C4.AFF_SNO      = C.AFF_SNO
                                                           AND C4.DSP_RQ_SNO   = C.DSP_RQ_SNO                                     
                                                           AND C4.AFF_DSP_JOIN = SUBSTR(C.AFF_NO,13)
                                                       ) AS CURR_AFF_DSP_JOIN_CD
                                                  FROM TBBADDED148M C
                                                 WHERE 1=1
                                                   AND C.AUD_YR = #{audYr}    --PARAM
                                                   AND C.AUD_NO = #{audNo}     --PARAM
                                                   ]]>
                                                        <if test="docId != null and docId != '' "> 
                                                             AND C.DOC_ID = #{docId}        --PARAM
                                                        </if>
                                                   <![CDATA[
                                                   AND C.AFF_MPP_DVSN_CD IN ('D30','D40')
                                                   AND (SELECT C5.AFF_DSP_JOIN
                                                          FROM AFF_DSP_INFO C5
                                                         WHERE C5.AUD_YR       = C.AUD_YR
                                                           AND C5.AUD_NO       = C.AUD_NO
                                                           AND C5.AUD_STEP_CD  = C.AUD_STEP_CD
                                                           AND C5.AFF_SNO      = C.AFF_SNO
                                                           AND C5.DSP_RQ_SNO   = C.DSP_RQ_SNO
                                                           AND C5.APVR_CD      = C.APVR_CD 
                                                           AND C5.APVR_RNAME   = DECODE(C.APVR_CD,'0013600','종료보고'
                                                                                                 ,'0015800','과장'
                                                                                                 ,'0035100','과장'
                                                                                                 ,'0058100','과장'
                                                                                                 ,'0055600','국장'
                                                                                                 ,'0045900','국장'
                                                                                                 ,'0055700','차장'
                                                                                                 ,'0010600','총장'
                                                                                                 ,'A1070'  ,'위원')
                                                           AND C5.AFF_DSP_JOIN = SUBSTR(C.PRE_AFF_NO,13)) = (SELECT C6.AFF_DSP_JOIN
                                                                                                              FROM AFF_DSP_INFO C6
                                                                                                             WHERE C6.AUD_YR       = C.AUD_YR
                                                                                                               AND C6.AUD_NO       = C.AUD_NO
                                                                                                               AND C6.DOC_ID       = C.DOC_ID
                                                                                                               AND C6.APVR_CD      = C.APVR_CD
                                                                                                               AND C6.DSP_RQ_SNO   = C.DSP_RQ_SNO
                                                                                                               AND C6.AFF_DSP_JOIN = SUBSTR(C.AFF_NO,13))
                                           ) AA
                                     WHERE 1=1
                                       AND (NVL(AA.BEFO_AFF_DSP_JOIN_CD,'X') <> NVL(AA.CURR_AFF_DSP_JOIN_CD,'X') OR AA.AFF_MPP_DVSN_CD = 'D20' OR AA.AFF_MPP_DVSN_CD = 'D20M')
                                       --AND AA.APVR_CD = '0013600' --과장검증용
                                       --AND AA.APVR_CD = '0035100' --국장검증용
                                     ORDER BY AA.APVR_CD,AA.BEFO_AFF_DSP_JOIN_CD,AA.CURR_AFF_DSP_JOIN_CD
                                     ) BB
            
                           ) CC
                     GROUP BY CC.DSP_RQ_GR
                   ) XY
             WHERE 1=1
               AND E6.DSP_RQ_GR = XY.DSP_RQ_GR(+)
             GROUP BY E6.DSP_RQ_GR
            
            UNION ALL
        
                    SELECT DECODE(ROWNUM, 1,  'DSP_01'
                                        , 2 , 'DSP_02'
                                        , 3 , 'DSP_03'
                                        , 4 , 'DSP_04'
                                        , 5 , 'DSP_05'
                                        , 6 , 'DSP_06'
                                        , 7 , 'DSP_07'
                                        , 8 , 'DSP_08'
                                        , 9 , 'DSP_09'
                                        , 10, 'DSP_10'
                                        , 11, 'DSP_11'
                                        , 12, 'DSP_12'
                                        , 13, 'DSP_13'
                                        , 14, 'DSP_99') --처분요구종류
                         , DECODE(ROWNUM, 1,  '판정'
                                        , 2,  '징계'
                                        , 3,  '시정'
                                        , 4,  '주의'
                                        , 5,  '개선'
                                        , 6,  '권고'
                                        , 7,  '통보'
                                        , 8,  '통보(인사자료)'
                                        , 9,  '통보(비위)'
                                        , 10, '통보(시정완료)'
                                        , 11, '모범사례'
                                        , 12, '고발'
                                        , 13, '수사요청'
                                        , 14, '기타','계') --처분요구종류
                         , 0
                         , 0
                         , 0
                         , 0
                         , 0
                         , 0
                         , 0
                         , 0
                         , 0
                         , 0
                      FROM DUAL
                   CONNECT BY ROWNUM <=14 )
             GROUP BY ROLLUP (DSP_RQ_GR_CD)
            
             ORDER BY DSP_RQ_GR_CD
         ]]>
    </select>
    
      
    <select id="selectSubList4" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.aep.fer.dao.AEPFER002QMapper.selectSubList4 */
        <![CDATA[
        --H1 LHH ADD
		SELECT H1.AUD_YR
		      ,H1.AUD_NO
		      ,H1.DOC_ID
		      ,H1.END_DOC_ID
		      ,H1.AUD_RPRT_DVSN_CD
		      ,H1.TYPE1
		      ,(CASE WHEN H1.CNT > 1 THEN NVL(H1.M1,'-') ELSE H1.M1 END) AS M1
		      ,(CASE WHEN H1.CNT > 2 THEN NVL(H1.M2,'-') ELSE H1.M2 END) AS M2
		      ,(CASE WHEN H1.CNT > 3 THEN NVL(H1.M3,'-') ELSE H1.M3 END) AS M3
		      ,(CASE WHEN H1.CNT > 4 THEN NVL(H1.M4,'-') ELSE H1.M4 END) AS M4
		      ,(CASE WHEN H1.CNT > 5 THEN NVL(H1.M5,'-') ELSE H1.M5 END) AS M5
		      ,(CASE WHEN H1.CNT > 6 THEN NVL(H1.M6,'-') ELSE H1.M6 END) AS M6
		      ,(CASE WHEN H1.CNT > 7 THEN NVL(H1.M7,'-') ELSE H1.M7 END) AS M7
		      ,H1.RSLT
		      ,H1.RSLT2
		      ,H1.CNT
		  FROM (
            SELECT G1.AUD_YR
                  ,G1.AUD_NO
                  ,G1.DOC_ID
                  ,(
                    SELECT MAX(T2.DOC_ID)
                      FROM TBBADDED103M T2
                     WHERE T2.AUD_YR = G1.AUD_YR
                       AND T2.AUD_NO = G1.AUD_NO
                       AND T2.RPRT_CD = 'A10500200'
                   ) AS END_DOC_ID
                  ,G1.AUD_RPRT_DVSN_CD
                  ,G1.TYPE1
                  ,G1.M1
                  ,G1.M2
                  ,G1.M3
                  ,G1.M4
                  ,G1.M5
                  ,G1.M6
                  ,G1.M7
                  ,G1.RSLT
                  ,G1.RSLT2
                  ,DECODE(M7,NULL,DECODE(M6, NULL, DECODE(M5, NULL, DECODE(M4, NULL, DECODE(M3, NULL, DECODE(M2, NULL, DECODE(M1, NULL, 0, 2), 3), 4), 5), 6), 6) ,7)
                    AS CNT
              FROM (
                SELECT D3.AUD_YR
                      ,D3.AUD_NO
                      ,D3.AUD_RPRT_DVSN_CD
                      ,MIN(DECODE(D3.RPRT_CD, 'A10600200', D3.DOC_ID)) AS DOC_ID
                      ,MIN(DECODE(RPRT_CD, 'A10600200', D3.RPRT_NM)) AS TYPE1
                      ,TO_CHAR(TO_DATE(MIN(D3.GWA_APV)), 'MM-DD')           AS M1
                      ,TO_CHAR(TO_DATE(MIN(D3.GUK_APV)), 'MM-DD')           AS M2
                      ,TO_CHAR(TO_DATE(MIN(D3.CHA_APV)), 'MM-DD')           AS M3
                      ,TO_CHAR(TO_DATE(MIN(D3.CHONG_APV)), 'MM-DD')         AS M4
                      ,TO_CHAR(TO_DATE(MIN(D3.WI_APV)), 'MM-DD')            AS M5
                      ,TO_CHAR(TO_DATE(MIN(D5.SBCN_DY)), 'MM-DD')           AS M6 --LHH ADD
                      ,TO_CHAR(TO_DATE(MIN(D4.ENF_DT)),'MM-DD')             AS M7
                      ,'부의'||NVL(MAX(T1.RPRT_D10_CNT),0) AS RSLT	--LHH ADD
                      ,'위임'||NVL(MAX(T1.RPRT_E10_CNT),0) AS RSLT2	--LHH ADD
                  FROM (
                        SELECT D1.AUD_YR
                              ,D1.AUD_NO
                              ,D1.AUD_RPRT_DVSN_CD
                              ,D1.RPRT_NM
                              ,DECODE(D1.RPRT_CD, 'A10600200', D1.DOC_ID, 'A10700100', D1.REF_ID) AS DOC_ID
                              ,D1.RPRT_CD
                              ,CASE WHEN D2.APVR_KND_CD IN ('2','3','4') THEN DECODE(D2.APVR_PST_CD,'0013600',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB ),'') END AS GWA_APV   --과장결재일
                              ,CASE WHEN D2.APVR_KND_CD IN ('2','3','4') THEN DECODE(D2.APVR_PST_CD,'0015800',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB )
                                                        ,DECODE(D2.APVR_PST_CD,'0035100',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB )
                                                        ,DECODE(D2.APVR_PST_CD,'0058100',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB ),''))) END AS GUK_APV   --국단실장결재일
                              ,CASE WHEN D2.APVR_KND_CD IN ('2','3','4') THEN DECODE(D2.APVR_PST_CD,'0055600',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB )
                                                        ,DECODE(D2.APVR_PST_CD,'0045900',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB ),'')) END AS CHA_APV   --사무차장결재일(본부장)
                              ,CASE WHEN D2.APVR_KND_CD IN ('2','3','4') THEN DECODE(D2.APVR_PST_CD,'0055700',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB ),'') END  AS CHONG_APV --사무총장결재일
                              ,CASE WHEN D2.APVR_KND_CD IN ('2','3','4') AND D1.RPRT_CD = 'A10700100' THEN DECODE(D2.APVR_PST_CD,'0010600',F_GET_FIRST_APVR_DH(D1.DOC_ID,D2.APVR_CNB ),'') END  AS WI_APV    --주심위원결재일
                          FROM TBBADDED103M D1
                              ,TBDCMACM023L D2
                         WHERE D1.APV_RQS_ID       = D2.APV_DOC_NO
                           AND D1.AUD_YR           = #{audYr} --PARAM
                           AND D1.AUD_NO           = #{audNo}
                           AND D1.RPRT_CD          IN ('A10600200','A10700100') --감사보고서,주심위원설명자료
                           AND D1.AUD_RPRT_DVSN_CD IN ('10','20','30','40')   --(10:본안,20:우선,30:별도,40:재부의) 최종보고서 제외 LHH ADD
                         ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D2.APV_SNO,D2.APVR_SEQ
                        ) D3
                        ,(SELECT 
                            T1.AUD_YR
                            , T1.AUD_NO
                            , T1.DSP_RQ_SNO
                            , T1.ENF_DT
                            , (SELECT MIN(ST1.DOC_ID) 
                                 FROM TBBADDED146M ST1
                                WHERE ST1.AUD_YR = T1.AUD_YR
                                  AND ST1.AUD_NO = T1.AUD_NO
                                  AND ST1.AUD_STEP_CD = 'A1070'
                                  AND ST1.DSP_RQ_SNO = T2.AUD_DSP_RQ_SNO) AS DOC_ID
                          FROM TBBADEAR002D T1
                               INNER JOIN TBBADEAR001M T2
                               ON (T1.AUD_YR = T2.AUD_YR
                                  AND T1.AUD_NO = T2.AUD_NO
                                  AND T1.DSP_RQ_SNO = T2.DSP_RQ_SNO)
                         WHERE T1.AUD_YR = #{audYr}
                           AND T1.AUD_NO = #{audNo}) D4
                        , TBBADDED113M D5
                        , (
                            SELECT SUM(CASE WHEN A.AUD_STEP_CD > 'A1050' AND B.REFER_DVSN_CD = 'D10' AND A.FNL_YN = 'Y' THEN 1 
                                         ELSE 0 END) AS RPRT_D10_CNT
                                  ,SUM(CASE  WHEN A.AUD_STEP_CD > 'A1050' AND B.REFER_DVSN_CD = 'E10' AND A.FNL_YN = 'Y'  THEN 1 
                                         ELSE 0 END) AS RPRT_E10_CNT
                                  ,MAX(A.AUD_YR) AS AUD_YR
                                  ,MAX(A.AUD_NO) AS AUD_NO
                                  ,A.DOC_ID         -- LHH ADD
                              FROM TBBADDED146M A INNER JOIN TBBADDED145M B
                                    ON A.AUD_YR  = B.AUD_YR
                                   AND A.AUD_NO  = B.AUD_NO
                                   AND A.AUD_STEP_CD = B.AUD_STEP_CD
                                   AND A.APVR_CD = B.APVR_CD
                                   AND A.FNL_YN = B.FNL_YN
                                   AND A.AFF_SNO = B.AFF_SNO /*LEFT OUTER JOIN TBBADDED113M C
                                    ON A.AUD_YR  = C.AUD_YR
                                   AND A.AUD_NO  = C.AUD_NO
                                   AND A.AFF_SNO = C.AFF_SNO 
                                   AND A.DSP_RQ_CD = C.DSP_RQ_CD*/ --LHH ADD
                             WHERE A.AUD_YR = #{audYr}
                               AND A.AUD_NO = #{audNo}
                               AND A.AUD_STEP_CD > 'A1050' 
                               AND A.FNL_YN = 'Y' 
                             GROUP BY A.DOC_ID-- LHH ADD
                            ) T1
                 WHERE D3.AUD_YR = D4.AUD_YR(+)
                   AND D3.AUD_NO = D4.AUD_NO(+)
                   AND D3.DOC_ID = D4.DOC_ID(+)
                   AND D3.AUD_YR = D5.AUD_YR(+)
                   AND D3.AUD_NO = D5.AUD_NO(+)
                   AND D3.DOC_ID = D5.DOC_ID(+)-- LHH ADD
                   AND D3.AUD_YR = T1.AUD_YR(+)-- LHH ADD
                   AND D3.AUD_NO = T1.AUD_NO(+)-- LHH ADD
                   AND D3.DOC_ID = T1.DOC_ID(+)-- LHH ADD
                 GROUP BY D3.AUD_YR,D3.AUD_NO,D3.DOC_ID,D3.AUD_RPRT_DVSN_CD
                 ORDER BY D3.AUD_RPRT_DVSN_CD
             ) G1 
         ) H1
         ]]>
    </select>
    
</mapper> 
