<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.asb.dao.AEPASB011PMapper">

    <select id="selectSendDoc" 
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB011PMapper.selectSendDoc */
        <![CDATA[
            SELECT 
                A.SORT_SNO AS DOC_STA_CD,
                B.RPRT_NM,
                AUD_YR,
                AUD_NO,
                A.AUD_STEP_CD,
                RPRT_CD,
                DOC_ID,
                A.RCPT_DPT_CD,
                CASE 
                    WHEN C.RCNT_ID IS NULL THEN '미접수'
                    ELSE
                        F_USR_INFO(C.RCNT_ID,'2')||'('||TO_CHAR(C.RCPT_DH,'YYYY"-"MM"-"DD')||')'
                END DOC_STA_CD_JA,
                '추후조인' AS CHF_NM,
                F_USR_INFO(C.FRT_USR_ID,'2')||'('||TO_CHAR(C.FRT_REGI_DH,'YYYY"-"MM"-"DD')||')' AS WRIT_NM
            FROM 
                TBBADDED111M A
                JOIN
                TBBADDED103M B
                USING(AUD_YR, AUD_NO, DOC_ID, RPRT_CD)
                JOIN
                TBBADDED111M C
                USING(AUD_YR, AUD_NO, DOC_ID, RPRT_CD)
            WHERE 
                AUD_YR = #{audYr}
            AND AUD_NO = #{audNo}
            AND A.AUD_STEP_CD = '70'
            AND RPRT_CD = 'AUD_REPORT'
            AND A.RCPT_DPT_CD = '510000'
            AND C.RCPT_DPT_CD = '160100'
        ]]>
    </select>

    <insert id="saveCmptAudDoc" parameterType="paramMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB001EMapper.saveCmptAudDoc */
        <![CDATA[
        UPDATE TBBADDED111M
        SET 
            SORT_SNO = '1',
            FNL_MDF_DH = SYSDATE
        WHERE 
                AUD_YR = #{audYr}
        AND AUD_NO = #{audNo}
        AND AUD_STEP_CD = '70'
        AND RPRT_CD = 'AUD_REPORT'
        AND RCPT_DPT_CD = '510000'
        AND DOC_ID = #{docId}
        ]]>
    </insert>
    
        <update id="cancelCmptAudDoc" parameterType="paramMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB001EMapper.cancelCmptAudDoc */
        <![CDATA[
        UPDATE TBBADDED111M
        SET 
            SORT_SNO = null,
            FNL_MDF_DH = SYSDATE
        WHERE 
                AUD_YR = #{audYr}
        AND AUD_NO = #{audNo}
        AND AUD_STEP_CD = '70'
        AND RPRT_CD = 'AUD_REPORT'
        AND RCPT_DPT_CD = '510000'
        AND DOC_ID = #{docId}
        ]]>
    </update>
</mapper> 
