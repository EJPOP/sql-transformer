<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.rla.dao.AEPRLA004PMapper">
    <select id="selectDefdtList" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA0004PMapper.selectDefdtList */
        <![CDATA[
	        SELECT WRK_DVSN_CD
					,WRK_YR
					,WRK_NO
					,AUD_STEP_CD
					,LEGAL_REQ_DVSN_CD
					,LEGAL_REQ_SRNO
					,INV_ACC_PRSN_SRNO
					,LEGAL_DPT_CD
					,DEFDT_NAM
					,SUBSTR(DGUARD.DECRYPT('TB_ENC','EIN',DEFDT_EIN),0,6)  AS DEFDT_EIN_F
					,SUBSTR(DGUARD.DECRYPT('TB_ENC','EIN',DEFDT_EIN),7,13) AS DEFDT_EIN_B
	        	FROM TBBADDED126L
	        	 WHERE WRK_YR = #{wrkYr}
	           		AND WRK_NO = #{wrkNo}
	          	 	AND AUD_STEP_CD = #{audStepCd}
	           		AND WRK_DVSN_CD = #{wrkDvsnCd}
	           		AND LEGAL_REQ_DVSN_CD = #{legalReqDvsnCd}
	           		AND LEGAL_REQ_SRNO = #{legalReqSrno}
    ]]>
    </select>
    
    <insert id="insertDefdtList">
    /* kr.go.bai.eip.aep.rla.dao.AEPRLA0004PMapper.insertDefdtList */
    <![CDATA[
		INSERT INTO TBBADDED126L(
					WRK_DVSN_CD
					,WRK_YR
					,WRK_NO
					,AUD_STEP_CD
					,LEGAL_REQ_DVSN_CD
					,LEGAL_REQ_SRNO
					,INV_ACC_PRSN_SRNO
					,LEGAL_DPT_CD
					,DEFDT_NAM
					,DEFDT_EIN
					,FRT_USR_ID
					,FNL_USR_ID
					,FNL_DEAL_DPT_CD
					,FNL_MNU_ID
					,FRT_REGI_DH
					,FNL_MDF_DH
		 )
		 VALUES(
         	#{wrkDvsnCd}
            , #{wrkYr}
            , #{wrkNo}
            , #{audStepCd}
            , #{legalReqDvsnCd}
            , #{legalReqSrno}
            , (SELECT NVL(MAX(INV_ACC_PRSN_SRNO),0)+1 
            	FROM TBBADDED126L
            	WHERE WRK_YR = #{wrkYr}
	           		AND WRK_NO = #{wrkNo}
	          	 	AND AUD_STEP_CD = #{audStepCd}
	           		AND WRK_DVSN_CD = #{wrkDvsnCd}
	           		AND LEGAL_REQ_DVSN_CD = #{legalReqDvsnCd}
	           		AND LEGAL_REQ_SRNO = #{legalReqSrno})
	        , #{regalDptCd} 		
            , #{defdtNam}
            , DGUARD.ENCRYPT('TB_ENC','EIN',#{defdtEinF}||#{defdtEinB})
            , #{usrId}
            , #{usrId}
            , #{dptCd}
            , 'AEPRLA004P'
            , SYSDATE
            , SYSDATE
        )
    ]]>
    </insert>
    
    <delete id="deleteDefdtList">
    /* kr.go.bai.eip.aep.rla.dao.AEPRLA0004PMapper.deleteDefdtList */
    <![CDATA[
         DELETE TBBADDED126L
        	 WHERE WRK_YR = #{wrkYr}
           		AND WRK_NO = #{wrkNo}
          	 	AND AUD_STEP_CD = #{audStepCd}
           		AND WRK_DVSN_CD = #{wrkDvsnCd}
           		AND LEGAL_REQ_DVSN_CD = #{legalReqDvsnCd}
           		AND LEGAL_REQ_SRNO = #{legalReqSrno}
           		AND INV_ACC_PRSN_SRNO = #{invAccPrsnSrno}
    ]]>
    </delete>

    <update id="updateDefdtList" parameterType="paramMap">
    /* kr.go.bai.eip.aep.rla.dao.AEPRLA0004PMapper.updateDefdtList */
    <![CDATA[
        UPDATE TBBADDED126L
        SET 
			DEFDT_NAM          = #{defdtNam}
			,DEFDT_EIN          = (DGUARD.ENCRYPT('TB_ENC','EIN',#{defdtEinF}||#{defdtEinB}))
			,FRT_USR_ID         = #{usrId}
			,FNL_USR_ID         = #{usrId}
			,FNL_DEAL_DPT_CD    = #{dptCd}
			,FNL_MNU_ID         = 'AEPRLA004P'
			,FRT_REGI_DH        = SYSDATE
			,FNL_MDF_DH         = SYSDATE
        WHERE WRK_YR = #{wrkYr}
        	AND WRK_NO = #{wrkNo}
       	 	AND AUD_STEP_CD = #{audStepCd}
        	AND WRK_DVSN_CD = #{wrkDvsnCd}
        	AND LEGAL_REQ_DVSN_CD = #{legalReqDvsnCd}
        	AND LEGAL_REQ_SRNO = #{legalReqSrno}
        	AND INV_ACC_PRSN_SRNO = #{invAccPrsnSrno}
    ]]>
    </update>

</mapper> 