<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper">
	
	
	<!-- 처분요구 목록  BADEAR003EMainSelectPage -->
	<select id="selectMainList" parameterType="paramMap" resultType="egovMap" >
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.selectMainList */
        <![CDATA[
        SELECT Z.* ,ROWNUM AS NUM ,COUNT(*) OVER ( ) AS TOT_CNT
        FROM (       
			SELECT D1.AUD_YR                         AS AUD_YR                          /*감사년도*/
			     , D1.AUD_NO                         AS AUD_NO                          /*감사번호*/
			     , D3.AUD_GRN_NO                     AS AUD_GRN_NO                      /*감사부여번호 - 2016.05.31 yyh*/
			     , D1.AUD_YR||D1.AUD_NO              AS AUD_YR_NO   
			     , D3.SPV_BRDV_NM                    AS SPV_BRDV_NM                     /*주관국과명*/
			     , F_DPT_INFO(D3.SPV_BRDV_CD,'1')    AS SPV_BRDV_CD
			     , F_DPT_INFO(D3.MNG_DPT_CD,'1')     AS MNG_DPT_CD                      /*관리부서 - 2016.03.08 yyh*/
			     , D3.AUD_SBJ_NM                     AS AUD_SBJ_NM                      /*감사사항*/
			     , D3.AUD_ORG_CNT                    AS AUD_ORG_CNT                     /*기관명*/
			     , D1.DSP_RQ_SNO                     AS DSP_RQ_SNO                      /*처분요구순번*/
			     , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-') ||'-'|| D1.DSP_RQ_SNO 
			                                         AS DSP_RQ_SNO_NM                   /*처분요구순번DISP*/
			     , CASE WHEN D1.AUD_YR >= '2016' 
			                 THEN SUBSTR(D3.AUD_KND_CD,3,1)
			            ELSE '' 
			        END                              AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.18 yyh*/				                                         
			     , D1.FRM_NO                         AS FRM_NO                          /*서식번호*/
			     , D1.RPRT_NO                        AS RPRT_NO                         /*보고서식번호*/
			     , D1.TIT_TXT                        AS TIT_TXT                         /*제목내용*/    
			     , D1.DSP_RQ_KND_CD                  AS DSP_RQ_KND_CD                   /*처분요구종류코드*/
			     , D1.ORG_DVSN_CD                    AS ORG_DVSN_CD                     /*기관구분코드*/
			     , D1.AUD_EPS_CD                     AS AUD_EPS_CD                      /*감사중점코드*/
			     , D2.DSP_RQ_SRNO                    AS DSP_RQ_SRNO                     /*처분요구일련번호*/
			     , TO_CHAR(TO_DATE(D2.ENF_DT),'YYYY-MM-DD')                         AS ENF_DT                          /*시행일*/
			     , TO_CHAR(TO_DATE(D2.HNDL_DDLN_DT),'YYYY-MM-DD')                   AS HNDL_DDLN_DT                    /*처리기한일*/
			     , D2.ENF_BRDV_CD                    AS ENF_BRDV_CD                     /*시행국과코드*/
			     , F_DPT_INFO(D2.ENF_BRDV_CD,'1')	 AS ENF_BRDV_NM                     /*시행국과명*/
			     , D2.DOC_SEN_NO                     AS DOC_SEN_NO                      /*문서발송코드*/
			     , D2.WRDO_CAU_CD                    AS WRDO_CAU_CD                     /*비위원인코드*/
			     , D2.ENFM_MNG_BRDV_CD               AS ENFM_MNG_BRDV_CD                /*집행관리국과코드*/    
			     , D2.DTM_YN                         AS DTM_YN                          /*확정여부*/
			     , D2.DTM_STA_CD                     AS DTM_STA_CD                      /*확정상태코드*/
			     , D2.HMP_OPEN_YN                    AS HMP_OPEN_YN                     /*홈페이지공개여부*/
			     , D2.DTY_OBV_UTL_YN                 AS DTY_OBV_UTL_YN                  /*직무관철활용여부*/
			     , CASE WHEN SUBSTR(D2.WRDO_TYP_CD,1,1) = '1' THEN '100000000'
			            WHEN SUBSTR(D2.WRDO_TYP_CD,1,1) = '2' THEN '200000000'    
			            ELSE ''
			         END                             AS WRDO_TYP_CD                     /*비위유형코드 - 수정 2016.05.11 yyh*/
			     , D2.DSP_RQ_APV_STA_CD              AS DSP_RQ_APV_STA_CD               /*처분요구결재상태코드*/
			     , D2.TSK_CAT_CD                     AS TSK_CAT_CD                      /*업무분류코드*/
			     , F_CODE_NM('1000121',D2.WRDO_TYP_CD) AS WRDO_TYP_NM                   /*비위유형코드명*/      
			     , F_CODE_NM('1000120',D2.TSK_CAT_CD)  AS TSK_CAT_NM                    /*업무분류명*/
			     , F_CODE_NM('1000002',D1.DSP_RQ_KND_CD )  AS DSP_RQ_KND_NM                    /*처분요구종류명*/
			     , F_CODE_NM('1000017',D2.DTM_STA_CD )  AS DTM_STA_NM                   /*결재상태명*/
			     , CASE WHEN NVL(D4.CNT,0)>0 THEN 'Y' ELSE 'N' END  AS FRE_CNT			/*집행전말입력여부*/
				 , D2.PSC_RQT_NOP_CNT													/*고발인원*/
			     , D2.NOP_CNT 															/*인원*/
			     , CASE WHEN RLTN_ORG_CD IS NOT NULL THEN F_ORG_INFO(D2.RLTN_ORG_CD,'1')||'외 '||D5.CNT  ELSE '' END RLTN_ORG_NM /*관계기관*/
			     , CASE WHEN COPT_OFI_CD IS NOT NULL THEN F_ORG_INFO(D2.COPT_OFI_CD,'1')|| DECODE(D7.CNT,0,'','외 '||D7.CNT) ELSE '' END COPT_OFI_NM /*소관청*/
			     , D8.HND_ORG_CD                                                                  /*조치기관*/
                 , F_ORG_INFO(D8.HND_ORG_CD, '1') AS HND_ORG_NM
                 , D8.REF_ORG_CD                                                                  /*참고기관*/
                 , F_ORG_INFO(D8.REF_ORG_CD, '1') AS REF_ORG_NM
			     , COPT_OFI_CD AS COPT_OFI_CD /* 추가 - 2016.04.28 yyh*/
			     
			     /* 처분요구사항실시내역 추가 - 2016.02.24 yyh */
			     , Z1.DVSN_CD                AS DVSN_CD    /* 구분코드 */
			     , Z1.TSK_KEY1               AS TSK_KEY1   /* 업무키1 */
			     , Z1.TSK_KEY2               AS TSK_KEY2   /* 업무키2 */
			     , Z1.TSK_KEY3               AS TSK_KEY3   /* 업무키3 */
			     , Z1.TSK_KEY4               AS TSK_KEY4   /* 업무키4 */
			     , CASE WHEN Z1.DVSN_CD IN ('1','2','3') THEN (SELECT S1.ACP_YR||'-'||F_CODE_NM('1000740',S1.REQ_DVSN_CD)||'-'||S1.RM_CVPT_ACP_NO
			     									  		     FROM TBCSPDCP101M S1
			      											    WHERE Z1.TSK_KEY1 = S1.ACP_YR
			      									  		      AND Z1.TSK_KEY2 = S1.REQ_DVSN_CD
			      											      AND Z1.TSK_KEY3 = S1.CVPT_ACP_NO)
			      												
			            WHEN Z1.DVSN_CD = '4'            THEN ''
			            WHEN Z1.DVSN_CD IN ('5','6','7') THEN (SELECT CASE WHEN S1.ACP_YR >= '2016' 
		 	                                                                 THEN S1.ACP_YR || '-' || DECODE(S1.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || S1.ACP_SRNO
		 	                                                            ELSE 
		 	                                                                      S1.ACP_YR || '-' || S1.ACP_DVSN_CD || '-' || S1.ACP_SRNO
		 	                                                             END
			                                                  FROM TBBADFRE012M S1 
			                                                 WHERE Z1.TSK_KEY1 = S1.ACP_YR   
			                                                   AND Z1.TSK_KEY2 = S1.ACP_DVSN_CD
			                                                   AND Z1.TSK_KEY3 = S1.ACP_SRNO
			                                                   AND Z1.TSK_KEY4 = S1.DPT_CD)
                        WHEN Z1.DVSN_CD IN ('8','9')     THEN (SELECT CASE WHEN S1.OGN_DVSN_CD = '6' 
					                                                                 THEN S1.YR||'-판청-'||S1.ACP_NO
					                                                            ELSE S1.YR||'-손망-'||S1.ACP_NO
					                                                        END 
					                                                  FROM TBBADGDA001M S1
					                                                 WHERE Z1.TSK_KEY1 = S1.ORG_CD   
					                                                   AND Z1.TSK_KEY2 = S1.NTF_DVSN_CD
					                                                   AND Z1.TSK_KEY3 = S1.NNB)	
					    WHEN Z1.DVSN_CD = '0'            THEN Z1.TSK_KEY1 ||'-정보-'|| Z1.TSK_KEY2
					    WHEN Z1.DVSN_CD = 'A'            THEN F_MNG_KND_AUDYRNO(Z1.TSK_KEY1, Z1.TSK_KEY2, (SELECT AUD_KND_CD 
					                                                                                         FROM TBBADDED001M 
					                                                                                        WHERE AUD_YR = Z1.TSK_KEY1 
					                                                                                          AND AUD_NO = Z1.TSK_KEY2), '-')  ||'-'|| 
					                                          Z1.TSK_KEY3                                                                      ||'-'|| 
					                                          F_ORG_INFO(Z1.TSK_KEY4,'1')
			            ELSE ''
			        END                      AS TSK_KEY_NO /* 실시번호 */
			      ,D2.AUD_YR || '-' || D2.AUD_NO || '-' || D2.DSP_RQ_SNO AS AUD_YR_NO_FOCUS /* 저장 후 ROW위치 지정 */
			      ,D1.EXEC_DSP_NM
			      ,D1.ACT_DSP_NM
			      ,'TBBADEAR002D'                                              AS TABLE_TYPE
			  FROM TBBADEAR001M D1
				INNER JOIN TBBADEAR002D D2 ON D1.AUD_YR     = D2.AUD_YR
									   AND D1.AUD_NO     = D2.AUD_NO
									   AND D1.DSP_RQ_SNO = D2.DSP_RQ_SNO
			    INNER JOIN  (
		           SELECT D1.AUD_YR
		                , D1.AUD_NO
		                , D1.AUD_GRN_NO
		                , D1.AUD_KND_CD 
		                , F_DPT_INFO(D1.SPV_BRDV_CD,'1')||'(단장 : '||F_USR_INFO(D1.AUD_TOT_DRTR_CNB,'2')||', 주관 : '||F_USR_INFO(D1.SPVR_CNB,'2')||')' AS SPV_BRDV_NM               
		                , '<'||F_CODE_NM('1000007',D1.AUD_KND_CD) ||'>'||D1.AUD_SBJ_NM AS AUD_SBJ_NM
		                , F_ORG_CNT_NM_AUD(D1.AUD_YR,D1.AUD_NO,'AUD') AS AUD_ORG_CNT
		            	, D1.SPV_BRDV_CD
		            	, D1.MNG_DPT_CD
		            FROM TBBADDED001M D1
		            WHERE 1=1
		             AND D1.MNG_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{upSpvBrdvCd})))   /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/
        ]]>			             
					<if test='audYrNoKndCd != null and audYrNoKndCd != ""'>
			             /* 감사연번종류코드 - 2015.12.18 yyh */
						 AND SUBSTR(D1.AUD_KND_CD,3,1) = #{audYrNoKndCd} 
					</if>		
			
					<if test='spvBrdvCd != null and spvBrdvCd != ""'>
						 AND D1.MNG_DPT_CD = #{spvBrdvCd}
					</if>
			
					<!-- 감사부여번호 조건 추가 - 2016.05.31 yyh -->
					<if test='audGrnNo != null and audGrnNo != ""'>
						AND D1.AUD_GRN_NO = #{audGrnNo}
					</if>
			        <![CDATA[       
			     ) D3 ON     D1.AUD_YR     = D3.AUD_YR
			             AND D1.AUD_NO     = D3.AUD_NO
						 AND D3.MNG_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{upSpvBrdvCd})))   --직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅   */
			     LEFT OUTER JOIN TBBADEAR035L Z1 ON  D1.AUD_YR     = Z1.AUD_YR
			                                     AND D1.AUD_NO     = Z1.AUD_NO
			                                     AND D1.DSP_RQ_SNO = Z1.DSP_RQ_SNO
			     LEFT OUTER JOIN (
					         SELECT AUD_YR
						          , AUD_NO
						          , DSP_RQ_SNO 
						          , COUNT(1) CNT 
						       FROM TBBADFRE001M
						      GROUP BY AUD_YR
						             , AUD_NO
						             , DSP_RQ_SNO    
			     ) D4 ON  D1.AUD_YR     = D4.AUD_YR
			           AND D1.AUD_NO     = D4.AUD_NO
			           AND D1.DSP_RQ_SNO = D4.DSP_RQ_SNO
			     LEFT OUTER JOIN (/*관계기관*/
			        SELECT AUD_YR, AUD_NO, DSP_RQ_SNO , COUNT(1)-1 CNT 
			          FROM TBBADEAR006M
			         GROUP BY AUD_YR, AUD_NO, DSP_RQ_SNO 
			       ) D5 ON  D1.AUD_YR     = D5.AUD_YR
					   AND D1.AUD_NO     = D5.AUD_NO
					   AND D1.DSP_RQ_SNO = D5.DSP_RQ_SNO
			     LEFT OUTER JOIN (/*소관청*/
			        SELECT AUD_YR, AUD_NO, DSP_RQ_SNO , COUNT(1)-1 CNT 
			          FROM TBBADEAR008M
			         GROUP BY AUD_YR, AUD_NO, DSP_RQ_SNO 
			       ) D7  ON  D1.AUD_YR     = D7.AUD_YR
			             AND D1.AUD_NO     = D7.AUD_NO
			             AND D1.DSP_RQ_SNO = D7.DSP_RQ_SNO  			     
	             LEFT OUTER JOIN (/*소관청*/
			        SELECT AUD_YR, AUD_NO, DSP_RQ_SNO , COUNT(1)-1 CNT, HND_ORG_CD, REF_ORG_CD
			          FROM TBBADDED146M
			         GROUP BY AUD_YR, AUD_NO, DSP_RQ_SNO, HND_ORG_CD, REF_ORG_CD
			       ) D8  ON  D1.AUD_YR     = D8.AUD_YR
			             AND D1.AUD_NO     = D8.AUD_NO
			             AND D1.DSP_RQ_SNO = D8.DSP_RQ_SNO  
			 WHERE 1=1
			   
			   
		]]>

		<if test='dspRqKndCd != null and dspRqKndCd != ""'>
			   AND D1.DSP_RQ_KND_CD = #{dspRqKndCd}
		</if>
		<if test='audYr != null and audYr != ""'>
			   AND D1.AUD_YR      = #{audYr}
		</if>
		<if test='audNo != null and audNo != ""'>
			   AND D1.AUD_NO      = #{audNo}
		</if>
		
		<!-- 감사부여번호 조건 추가 - 2016.05.31 yyh -->

		<if test='audgrnno != null and audgrnno != ""'>
			   AND D3.AUD_GRN_NO = #{audgrnno}
			</if>
		
		<if test='audYr != null and audYr != ""'>
			   AND D1.AUD_YR      = #{audYr}
		</if>
		<if test='audNo != null and audNo != ""'>
			   AND D1.AUD_NO      = #{audNo}
		</if>	
		<if test='dspRqSno != null and dspRqSno != ""'>
			   AND D1.DSP_RQ_SNO      = #{dspRqSno}
		</if>			
		) Z
	</select>	
	
	
	

	<!-- 최초 처분요구 보고서 조회  -->
	<select id="selectDspRqList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.selectDspRqList */     	
		<![CDATA[ 	
			SELECT
			        T1.AUD_YR
			      , T1.AUD_NO
			      , T1.DOC_ID
			      , T1.RPRT_NM
			      , T1.ORG_CNT
			      , T1.AUD_KND_CD
			      , T1.RPRT_CD
			      , T1.AUD_RPRT_DVSN_CD
			      , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') AS AUD_YR_NO
			      , COUNT(T2.REF_ID) AS REF_ID_CNT
                  , (CASE WHEN T1.ORG_CNT = 0 THEN 'N' 
                          WHEN T1.ORG_CNT = COUNT(T2.REF_ID) THEN 'Y'
                          ELSE 'N' END) AS PROSESS_YN
			      , (SELECT 	
                        (   SELECT B.DOC_ID 
                            FROM TBBADDED103M B 
                            WHERE D1.AUD_YR = B.AUD_YR AND D1.AUD_NO = B.AUD_NO AND B.RPRT_CD = 'A10800500' AND D1.DOC_ID = B.REF_ID
                         ) 
                     FROM TBBADDED103M D1
                     INNER JOIN TBBADDED146M D2 ON(D1.AUD_YR = D2.AUD_YR
                                                   AND D1.AUD_NO = D2.AUD_NO
                                                   AND D1.DOC_ID = D2.REF_DOC_ID
                                                   AND D2.FNL_YN = 'Y'
                                                   )
                            LEFT OUTER JOIN (SELECT A.AUD_YR
                                             , A.AUD_NO
                                             , DECODE(SUM(DECODE(A.REFER_DVSN_CD,'E10',0,1)),0,'N','Y') AS CMT_YN
                                      FROM TBBADDED145M A
                                              WHERE A.AUD_YR = #{audYr}
                                                AND A.AUD_NO = #{audNo}
                                                AND A.FNL_YN = 'Y'
                                           GROUP BY A.AUD_YR, A.AUD_NO) D3 ON (D1.AUD_YR     = D3.AUD_YR
                                                                          AND D1.AUD_NO     = D3.AUD_NO)
                            WHERE D1.AUD_YR = #{audYr}
                            AND D1.AUD_NO = #{audNo}
                            AND D1.RPRT_CD = 'A10600200'
                            AND D1.AUD_STEP_CD = 'A1070'
                            AND D1.DOC_ID = T1.DOC_ID   /* DOC_ID : 최종보고서*/
                            AND ((D2.APVR_CD IN ('A1070', '0010600')) OR (D3.CMT_YN = 'N'))
                            GROUP BY D1.AUD_YR		
                                    ,D1.AUD_NO		
                                    ,D1.DOC_ID		
                                    ,D1.AUD_KND_CD 		
                                    ,D1.RPRT_NM ) AS DOC_ID_NO
                 , T3.AUD_SBJ_NM  /*감사사항명*/
                 , F_DPT_INFO(T3.SPV_BRDV_CD, '1') AS SPV_BRDV_NM  /*주관국과명*/
                 , F_ORG_INFO(T3.AUD_RPST_ORG_CD, '1') AS AUD_RPST_ORG_NM /*대표기관명*/ 
                 , (SELECT max(DOC_ID) FROM TBBADDED102M  WHERE AUD_YR = T1.AUD_YR AND AUD_NO = T1.AUD_NO AND DOC_ID = T1.DOC_ID AND AUD_STEP_CD = 'A1080'
                                                                                   AND SUBSTR(AUD_MAIN_STEP_ID,0,2) = #{audMainStepDsvnCd}
                   ) AS PRCS_DOC_ID
			     , T1.FNL_RPRT_CRE_YN
			     , T3.DOC_WRIT_KND_CD
			     , T1.ENF_DOC_ID
			     , T1.APV_STA_CD
			FROM 
			(
			    SELECT ROW_NUMBER() OVER(PARTITION BY AUD_YR, AUD_NO, DOC_ID, AUD_KND_CD, RPRT_NM, AUD_RPRT_DVSN_CD ORDER BY 1) AS RNUM
			    	 , AUD_YR, AUD_NO, DOC_ID,AUD_KND_CD, RPRT_NM, RPRT_CD, AUD_RPRT_DVSN_CD, FNL_RPRT_CRE_YN, ENF_DOC_ID, APV_STA_CD
			    	 , COUNT(DISTINCT DECODE(RNUM, 1, RLTN_ORG_CD, 2, HND_ORG_CD, 3, REF_ORG_CD) ) AS ORG_CNT
			    FROM(
			        SELECT D1.AUD_YR
			            ,D1.AUD_NO
			            ,D1.DOC_ID
			            ,D1.AUD_KND_CD 
			            ,D1.RPRT_NM 
			            ,D1.RPRT_CD
			            ,D1.AUD_RPRT_DVSN_CD
			            ,D1.FNL_RPRT_CRE_YN
			            ,D2.RLTN_ORG_CD 
			            ,D2.HND_ORG_CD  
			            ,D2.REF_ORG_CD  
			            ,(SELECT ST.DOC_ID FROM TBBADDED103M ST WHERE ST.AUD_YR = D1.AUD_YR AND ST.AUD_NO = D1.AUD_NO AND ST.REF_ID = D1.DOC_ID AND ST.RPRT_CD = 'A10800150') AS ENF_DOC_ID
			            ,D1.APV_STA_CD
			            FROM TBBADDED103M D1
			            INNER JOIN (SELECT A.AUD_YR
                                            , A.AUD_NO
                                            , A.DOC_ID
                                            , A.RLTN_ORG_CD
                                            , A.HND_ORG_CD
                                            , A.REF_ORG_CD
                                            , A.FNL_YN
                                            , A.APVR_CD
                                            , A.REF_DOC_ID
                                            , (SELECT DECODE(SUM(DECODE(REFER_DVSN_CD,'E10',0,1)),0,'N','Y')
                                                FROM TBBADDED145M
                                                WHERE AUD_YR = A.AUD_YR 
                                                AND AUD_NO = A.AUD_NO
                                                AND FNL_YN = 'Y') AS CMT_YN
                                     FROM TBBADDED146M A
                                     WHERE A.AUD_YR = #{audYr}
			                         AND A.AUD_NO = #{audNo}
                                     AND A.FNL_YN = 'Y') D2 ON (D1.AUD_YR =D2.AUD_YR 
                                                                AND D1.AUD_NO = D2.AUD_NO 
                                                                AND D1.DOC_ID = D2.REF_DOC_ID
                                                                AND D2.FNL_YN = 'Y'
                                                                AND  (( D2.APVR_CD IN ('A1070', '0010600')) OR (D2.CMT_YN = 'N'))
                                                                )
			        WHERE 1=1
			        AND D1.AUD_YR = #{audYr}
			        AND D1.AUD_NO = #{audNo}
			        AND D1.AUD_STEP_CD = 'A1070'
			        /* AND D1.FNL_RPRT_CRE_YN = 'Y' */
			        /* AND D1.RPRT_CD = 'A10600200'    보고서코드 */
			        
			    )
			    INNER JOIN
			    (
					SELECT ROWNUM AS RNUM
					  FROM DUAL
				   CONNECT BY LEVEL <= 3
				) D3 ON 1=1
			    GROUP BY AUD_YR, AUD_NO, DOC_ID, AUD_KND_CD, RPRT_NM, RPRT_CD, AUD_RPRT_DVSN_CD, FNL_RPRT_CRE_YN, ENF_DOC_ID, APV_STA_CD
			) T1 
			LEFT OUTER JOIN TBBADDED103M T2 ON T1.AUD_YR = T2.AUD_YR AND  T1.AUD_NO = T2.AUD_NO AND T1.ENF_DOC_ID =T2.REF_ID
			                                AND T2.RPRT_CD = 'A10800200'  /* 시행문코드     */
			INNER JOIN TBBADDED001M T3 ON T1.AUD_YR = T3.AUD_YR AND T1.AUD_NO = T3.AUD_NO 
			GROUP BY T1.AUD_YR, T1.AUD_NO, T1.DOC_ID, T1.AUD_KND_CD, T1.RPRT_NM, T1.ORG_CNT, T1.RNUM, T1.RPRT_CD, T1.AUD_RPRT_DVSN_CD, T1.FNL_RPRT_CRE_YN,
			         T3.AUD_SBJ_NM, T3.SPV_BRDV_CD, T3.AUD_RPST_ORG_CD, T3.DOC_WRIT_KND_CD, T1.ENF_DOC_ID, T1.APV_STA_CD
			
			/* A10601200   수사요청서 시행문, A10601400   현지조치사항 시행문, A10601600   사실통보서 시행문, A10601800   수사참고자료 시행문 */
            UNION ALL 
            SELECT
			        T1.AUD_YR
			      , T1.AUD_NO
			      , T1.DOC_ID
			      , T1.RPRT_NM
			      , 0 AS ORG_CNT
			      , T1.AUD_KND_CD
			      , T1.RPRT_CD
			      , T1.AUD_RPRT_DVSN_CD
			      , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') AS AUD_YR_NO
			      , (SELECT COUNT(AUD_YR) FROM TBBADDED103M WHERE AUD_YR = #{audYr} AND AUD_NO = #{audNo} AND RPRT_CD IN ('A10800201','A10800202') AND REF_ID = T1.DOC_ID) AS REF_ID_CNT
			      , 'N' AS PROSESS_YN
			      , (SELECT ST.DOC_ID FROM TBBADDED103M ST WHERE ST.AUD_YR = T1.AUD_YR AND ST.AUD_NO = T1.AUD_NO AND ST.RPRT_CD = 'A10800500' AND ST.REF_ID = T1.DOC_ID)  AS DOC_ID_NO
                  , T2.AUD_SBJ_NM  /*감사사항명*/
                  , F_DPT_INFO(T2.SPV_BRDV_CD, '1') AS SPV_BRDV_NM  /*주관국과명*/
                  , F_ORG_INFO(T2.AUD_RPST_ORG_CD, '1') AS AUD_RPST_ORG_NM /*대표기관명*/ 
                  , (SELECT max(DOC_ID) FROM TBBADDED102M  WHERE AUD_YR = T1.AUD_YR AND AUD_NO = T1.AUD_NO AND DOC_ID = T1.DOC_ID) AS PRCS_DOC_ID
                  , FNL_RPRT_CRE_YN
                  , DOC_WRIT_KND_CD
                  , T1.DOC_ID AS ENF_DOC_ID
                  , T1.APV_STA_CD
              FROM TBBADDED103M T1
        INNER JOIN TBBADDED001M T2 ON T1.AUD_YR = T2.AUD_YR AND T1.AUD_NO = T2.AUD_NO 
             WHERE T1.AUD_YR = #{audYr}
			 AND T1.AUD_NO = #{audNo}
			 AND T1.RPRT_CD IN ('A10601300', 'A10601320', 'A10601330', 'A10601340', 'A10601100')
             AND T1.APV_STA_CD = '30'
    ]]>         
	</select>
	
	<!-- 최초 처분요구 보고서 기관 조회  -->
	<select id="selectDspRqOrgList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.selectDspRqOrgList */
        <![CDATA[     	
        	SELECT 
                A.AUD_YR
                    , A.AUD_NO
                    , A.ORG_TYPE_NM
                    , A.ORG_CODE
                    , A.ORG_NM
                    , A.RPRT_NM
                    , A.APV_STA_CD
                    , A.APV_STA_NM
                    , A.SORT_SNO
                    , A.DOC_ID
                    , A.REF_ID
                    , A.REF_DY
                    , A.APV_RQS_ID
                    , (SELECT COUNT(A.APV_RQS_ID) FROM TBBADDED103M WHERE APV_RQS_ID = A.APV_RQS_ID) AS APV_RQS_CNT
                    , A.AUD_RPRT_DVSN_CD
                    , A.RPRT_CD
                    , A.MAKTER_USER
                    , (SELECT APV_USR_NM 
                     FROM (
                         SELECT 
                            F_USR_INFO(APVR_CNB,'2') || 
                            DECODE(APV_DH,NULL,'(결재대기중)','('||TO_CHAR(APV_DH,'YYYY-MM-DD')||')') AS APV_USR_NM,
                            APV_DOC_NO
                         FROM TBDCMACM023L
                         WHERE  
                          APVR_KND_CD = '3'
                         ORDER BY APV_SNO DESC)
                     WHERE ROWNUM = 1
                     AND APV_DOC_NO = A.APV_RQS_ID) AS APV_USR_NM
                    , ( CASE WHEN A.RPRT_CD = 'A10800200' THEN '대상기관 시행문' 
                    		WHEN A.RPRT_CD = 'A10800201' THEN '수사요청 시행문' 
                    		WHEN A.RPRT_CD = 'A10800202' THEN '현지조치 시행문'
                    		WHEN A.RPRT_CD = 'A10800150' THEN '시행문 전문' 
                            WHEN A.RPRT_CD = 'A10600200' THEN '시행문 전문'
                            WHEN A.RPRT_CD = 'A10601300' THEN '현지조치'
                            WHEN A.RPRT_CD = 'A10601320' THEN '시정요구(약식)안-회보 불필요'
                            WHEN A.RPRT_CD = 'A10601330' THEN '시정요구(약식)안-회보 필요'
                            WHEN A.RPRT_CD = 'A10601340' THEN '주의요구(약식)안'
                            WHEN A.RPRT_CD = 'A10601100' THEN '수사요청서'
                            WHEN A.RPRT_CD = 'A10601500' THEN '사실통보서'
                            WHEN A.RPRT_CD = 'A10601700' THEN '수사참고자료'
                            ELSE '' END ) AS DOC_TYP
                    , (SELECT DECODE(COUNT(1), 0, 'N', 'Y') FROM TBDCMACM023H ST1 WHERE ST1.APV_DOC_NO = A.APV_RQS_ID AND ST1.APVR_STA_CD NOT IN ('301', '201')) AS APV_HIS_YN
                    , AUD_STEP_CD
                    , DOC_TYPE
			FROM (
			    SELECT  A.AUD_YR
                    , A.AUD_NO
                    , '' AS ORG_TYPE_NM
                    , '' AS ORG_CODE
                    , '' AS ORG_NM
                    , A.RPRT_NM
                    , A.APV_STA_CD
                    , F_CODE_NM('1000773',NVL(A.APV_STA_CD,'10')) AS APV_STA_NM
                    , A.SORT_SNO
                    , A.DOC_ID
                    , A.REF_ID
                    , A.REF_DY
                    , A.APV_RQS_ID
                    , A.AUD_RPRT_DVSN_CD
                    , A.RPRT_CD
                    , F_USR_INFO_BY_ID(A.DOC_WRT_ID,'2') AS MAKTER_USER
                    , DECODE(A.APV_RQS_ID, NULL, 'Y', 'N') AS APV_YN
                    , A.AUD_STEP_CD
                    , F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE
	            FROM TBBADDED103M A
				WHERE A.RPRT_CD = 'A10800150' 
	              AND A.DOC_ID = #{refId}
	            UNION ALL
				SELECT 
					A.AUD_YR
	                , A.AUD_NO
	                , B.ORG_TYPE_NM
	                , B.ORG_CODE
	                , B.ORG_NM
	                 , A.RPRT_NM                                                 /*보고서명 */
	                 , A.APV_STA_CD                                              /*결재상태코드 */
	                 , F_CODE_NM('1000773',NVL(A.APV_STA_CD,'10')) AS APV_STA_NM /*결재상태명 */
	                 , A.SORT_SNO                                                /*보고서순번  */
	                 , A.DOC_ID                                                  /*결재문서번호 */
	                 , A.REF_ID                                                  /*참조ID */
	                 , A.REF_DY                                                  /*참조일자 */
	                 , A.APV_RQS_ID                                              /*결재요청ID */
	                 , A.AUD_RPRT_DVSN_CD                                        /*감사보고서구분코드 */
	                 , A.RPRT_CD                                                 /*문서종류코드 */
	                 , F_USR_INFO_BY_ID(A.DOC_WRT_ID,'2') AS MAKTER_USER
	                 , DECODE(A.APV_RQS_ID, NULL, 'Y', 'N') AS APV_YN          
	                 , A.AUD_STEP_CD
	                 , F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE
	              FROM TBBADDED103M A
	              INNER JOIN (
	                  SELECT A.AUD_YR, A.AUD_NO, A.REF_DOC_ID, A.ORG_CODE, AGGR_CONCAT(A.ORG_TYPE, ',' ORDER BY A.ORG_TYPE) || '기관' AS ORG_TYPE_NM, A.ORG_NM
	                    FROM (
	                        SELECT 
	                            DISTINCT 
	                                AUD_YR
	                                , AUD_NO 
	                                , REF_DOC_ID
	                                , SUBSTR(ORG_CODE,0,12) AS ORG_CODE
	                                , CASE WHEN SUBSTR(ORG_CODE,13,13) = 'T' THEN '대상' 
	                                       WHEN SUBSTR(ORG_CODE,13,13) = 'H' THEN '조치' 
	                                       ELSE '참조기관' END AS ORG_TYPE
	                                , F_ORG_INFO(SUBSTR(ORG_CODE,0,12),'1') AS ORG_NM 
	                        FROM ( 
	                            SELECT AUD_YR
	                                , AUD_NO
	                                , AUD_STEP_CD
	                                , REF_DOC_ID
	                                , APVR_CD 
	                                , ORG_CODE
	                                , CMT_YN
	                            FROM (
	                                SELECT AUD_YR
	                                        , AUD_NO
	                                        , AUD_STEP_CD
	                                        , REF_DOC_ID
	                                        , APVR_CD 
	                                        , (CASE Y.NUM WHEN 1 THEN HND_ORG_CD WHEN 2 THEN REF_ORG_CD WHEN 3 THEN RLTN_ORG_CD END ) AS ORG_CODE
	                                        , CMT_YN
	                                FROM (
	                                    SELECT 
	                                        T1.AUD_YR
	                                        , T1.AUD_NO
	                                        , T1.AUD_STEP_CD
	                                        , T4.DOC_ID AS REF_DOC_ID
	                                        , T1.APVR_CD 
	                                        , DECODE(T1.HND_ORG_CD ,'','', T1.HND_ORG_CD || 'H') AS HND_ORG_CD
	                                        , DECODE(T1.RLTN_ORG_CD,'','', T1.RLTN_ORG_CD || 'T') AS RLTN_ORG_CD
	                                        , DECODE(T1.REF_ORG_CD ,'','', T1.REF_ORG_CD || 'H') AS REF_ORG_CD
	                                        , T3.CMT_YN
	                                    FROM TBBADDED146M T1
	                                    INNER JOIN TBBADDED146M T2 ON( T1.AUD_YR = T2.AUD_YR
	                                                                AND T1.AUD_NO = T2.AUD_NO)
	                                    LEFT OUTER JOIN (SELECT A.AUD_YR
	                                                    , A.AUD_NO
	                                                    , DECODE(SUM(DECODE(A.REFER_DVSN_CD,'E10',0,1)),0,'N','Y') AS CMT_YN
	                                               FROM TBBADDED145M A 
	                                              WHERE A.AUD_YR = #{audYr} 
	                                                AND A.AUD_NO = #{audNo} 
	                                                AND A.FNL_YN = 'Y'
	                                           GROUP BY A.AUD_YR, A.AUD_NO) T3 ON (T3.AUD_YR     = T1.AUD_YR
	                                                                               AND T3.AUD_NO     = T1.AUD_NO)
	                                    INNER JOIN TBBADDED103M T4 ON (T4.AUD_YR = T1.AUD_YR
	                                                                   AND T4.AUD_NO = T1.AUD_NO
	                                                                   AND T4.REF_ID = T1.REF_DOC_ID
	                                                                   AND T4.RPRT_CD = 'A10800150')
	                                    WHERE 1=1 
	                                    AND T1.AUD_YR = #{audYr} 
	                                    AND T1.AUD_NO = #{audNo} 
	                                    AND T1.FNL_YN = 'Y' 
	                                    AND ((T1.APVR_CD IN ('A1070', '0010600') ) OR (T3.CMT_YN = 'N'))        /*부의가 있거나 모두 위임인경우(CMT_YN : N)*/
	                                    GROUP BY T1.AUD_YR, T1.AUD_NO, T1.AUD_STEP_CD, T4.DOC_ID, T1.APVR_CD, T1.RLTN_ORG_CD, T1.HND_ORG_CD, T1.REF_ORG_CD, T3.CMT_YN
	                                ) X, (SELECT 1 NUM FROM DUAL UNION ALL SELECT 2 FROM DUAL UNION ALL SELECT 3 FROM DUAL) Y
	                            ) T3
	                            WHERE ORG_CODE IS NOT NULL
	                        )  
	                   ) A
	                   GROUP BY A.AUD_YR, A.AUD_NO, A.REF_DOC_ID, A.ORG_CODE, A.ORG_NM
	              ) B ON (
	                A.AUD_YR = B.AUD_YR
	                AND A.AUD_NO = B.AUD_NO
	                AND A.REF_ID = B.REF_DOC_ID
	                AND A.RLTN_ORG_CD = B.ORG_CODE
	              )
	             WHERE A.AUD_YR = #{audYr} 
	               AND A.AUD_NO = #{audNo} 
	               AND A.RPRT_CD IN ('A10800200', 'A10800202', 'A10800201')
	               AND A.REF_ID = #{refId} 
			]]>
			<if test='docId != null and docId != ""'>
				AND A.DOC_ID = #{docId} 
			</if>
			<![CDATA[
				) A
            	ORDER BY A.RPRT_CD ASC, A.SORT_SNO ASC
			]]>
	</select>
	
	
	
	<!-- 최초 처분요구 보고서 기관 조회  -->
	<select id="selectDspRqOrgList2" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.selectDspRqOrgList2 */
        <![CDATA[     	
        	SELECT 
                A.AUD_YR
                    , A.AUD_NO
                    , A.AUD_STEP_CD
                    , A.RPRT_AUD_STEP_CD
                    , A.ORG_TYPE_NM
                    , A.ORG_CODE
                    , A.ORG_NM
                    , A.RPRT_NM
                    , A.APV_STA_CD
                    , A.APV_STA_NM
                    , A.SORT_SNO
                    , A.DOC_ID
                    , A.REF_ID
                    , A.REF_DY
                    , A.APV_RQS_ID
                    , A.AUD_RPRT_DVSN_CD
                    , A.RPRT_CD
                    , A.MAKTER_USER
                    , (SELECT APV_USR_NM 
                     FROM (
                         SELECT 
                            F_USR_INFO(APVR_CNB,'2') || 
                            DECODE(APV_DH,NULL,'(결재대기중)','('||TO_CHAR(APV_DH,'YYYY-MM-DD')||')') AS APV_USR_NM,
                            APV_DOC_NO
                         FROM TBDCMACM023L
                         WHERE  
                          APVR_KND_CD = '3'
                         ORDER BY APV_SNO DESC)
                     WHERE ROWNUM = 1
                     AND APV_DOC_NO = A.APV_RQS_ID) AS APV_USR_NM
                    , ( CASE WHEN A.RPRT_CD = 'A10800200' THEN '대상기관 시행문' 
                    		WHEN A.RPRT_CD = 'A10800201' THEN '수사요청 시행문' 
                    		WHEN A.RPRT_CD = 'A10800202' THEN '현지조치 시행문' 
                            WHEN A.RPRT_CD = 'A10600200' THEN '시행문 전문'
                            WHEN A.RPRT_CD = 'A10601300' THEN '현지조치 전문'
                            WHEN A.RPRT_CD IN ('A10601320', 'A10601330', 'A10601340') THEN '국장전결 전문'
                            WHEN A.RPRT_CD = 'A10601100' THEN '수사요청 전문'
                            WHEN A.RPRT_CD = 'A10601500' THEN '사실통보서 전문'
                            WHEN A.RPRT_CD = 'A10601700' THEN '수사참고자료 전문'
                            ELSE '' END ) AS DOC_TYP
                    , DOC_TYPE
			FROM (
			    SELECT  A.AUD_YR
                    , A.AUD_NO
                    , CASE WHEN A.RPRT_CD IN ('A10601100','A10601300','A10601320','A10601330','A10601340','A10601100') THEN 'A1080' 
                           ELSE A.AUD_STEP_CD END AS AUD_STEP_CD
                    , A.AUD_STEP_CD AS RPRT_AUD_STEP_CD
                    , '' AS ORG_TYPE_NM
                    , '' AS ORG_CODE
                    , '' AS ORG_NM
                    , A.RPRT_NM
                    , A.APV_STA_CD
                    , F_CODE_NM('1000773',NVL(A.APV_STA_CD,'10')) AS APV_STA_NM
                    , A.SORT_SNO
                    , A.DOC_ID
                    , A.REF_ID
                    , A.REF_DY
                    , A.APV_RQS_ID
                    , A.AUD_RPRT_DVSN_CD
                    , A.RPRT_CD
                    , F_USR_INFO_BY_ID(A.DOC_WRT_ID,'2') AS MAKTER_USER
                    , DECODE(A.APV_RQS_ID, NULL, 'Y', 'N') AS APV_YN
                    , F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE
	            FROM TBBADDED103M A
				WHERE A.DOC_ID = #{refId} 
	            UNION ALL
				SELECT 
					A.AUD_YR
	                , A.AUD_NO
	                , A.AUD_STEP_CD
	                , A.AUD_STEP_CD AS RPRT_AUD_STEP_CD
	                , B.ORG_TYPE_NM
	                , B.ORG_CODE
	                , B.ORG_NM
	                 , A.RPRT_NM                                                 /*보고서명 */
	                 , A.APV_STA_CD                                              /*결재상태코드 */
	                 , F_CODE_NM('1000773',NVL(A.APV_STA_CD,'10')) AS APV_STA_NM /*결재상태명 */
	                 , A.SORT_SNO                                                /*보고서순번  */
	                 , A.DOC_ID                                                  /*결재문서번호 */
	                 , A.REF_ID                                                  /*참조ID */
	                 , A.REF_DY                                                  /*참조일자 */
	                 , A.APV_RQS_ID                                              /*결재요청ID */
	                 , A.AUD_RPRT_DVSN_CD                                        /*감사보고서구분코드 */
	                 , A.RPRT_CD                                                 /*문서종류코드 */
	                 , F_USR_INFO_BY_ID(A.DOC_WRT_ID,'2') AS MAKTER_USER
	                 , DECODE(A.APV_RQS_ID, NULL, 'Y', 'N') AS APV_YN
	                 , F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE          
	              FROM TBBADDED103M A
	              INNER JOIN (
	                  SELECT A.AUD_YR, A.AUD_NO, A.DOC_ID, A.ORG_CODE, AGGR_CONCAT(A.ORG_TYPE, ',' ORDER BY A.ORG_TYPE) || '기관' AS ORG_TYPE_NM, A.ORG_NM
	                    FROM (
	                        SELECT 
	                            DISTINCT 
	                                AUD_YR
	                                , AUD_NO 
	                                , DOC_ID
	                                , SUBSTR(ORG_CODE,0,12) AS ORG_CODE
	                                , CASE WHEN SUBSTR(ORG_CODE,13,13) = 'T' THEN '대상' 
	                                       WHEN SUBSTR(ORG_CODE,13,13) = 'H' THEN '조치' 
	                                       ELSE '참조기관' END AS ORG_TYPE
	                                , F_ORG_INFO(SUBSTR(ORG_CODE,0,12),'1') AS ORG_NM 
	                        FROM ( 
	                            SELECT AUD_YR
	                                , AUD_NO
	                                , AUD_STEP_CD
	                                , DOC_ID
	                                , APVR_CD 
	                                , ORG_CODE
	                                , CMT_YN
	                            FROM (
	                                SELECT AUD_YR
	                                        , AUD_NO
	                                        , AUD_STEP_CD
	                                        , DOC_ID
	                                        , APVR_CD 
	                                        , (CASE Y.NUM WHEN 1 THEN HND_ORG_CD WHEN 2 THEN REF_ORG_CD WHEN 3 THEN RLTN_ORG_CD END ) AS ORG_CODE
	                                        , CMT_YN
	                                FROM (
	                                    SELECT 
	                                        T1.AUD_YR
	                                        , T1.AUD_NO
	                                        , T1.AUD_STEP_CD
	                                        , T1.DOC_ID
	                                        , T1.APVR_CD 
	                                        , DECODE(T1.HND_ORG_CD ,'','', T1.HND_ORG_CD || 'H') AS HND_ORG_CD
	                                        , DECODE(T1.RLTN_ORG_CD,'','', T1.RLTN_ORG_CD || 'T') AS RLTN_ORG_CD
	                                        , DECODE(T1.REF_ORG_CD ,'','', T1.REF_ORG_CD || 'H') AS REF_ORG_CD
	                                        , T3.CMT_YN
	                                    FROM TBBADDED146M T1
	                                    INNER JOIN TBBADDED146M T2 ON( T1.AUD_YR = T2.AUD_YR
	                                                                AND T1.AUD_NO = T2.AUD_NO)
	                                    LEFT OUTER JOIN (SELECT A.AUD_YR
	                                                    , A.AUD_NO
	                                                    , DECODE(SUM(DECODE(A.REFER_DVSN_CD,'E10',0,1)),0,'N','Y') AS CMT_YN
	                                               FROM TBBADDED145M A 
	                                              WHERE A.AUD_YR = #{audYr} 
	                                                AND A.AUD_NO = #{audNo} 
	                                                AND A.FNL_YN = 'Y'
	                                           GROUP BY A.AUD_YR, A.AUD_NO) T3 ON (T3.AUD_YR     = T1.AUD_YR
	                                                                               AND T3.AUD_NO     = T1.AUD_NO)
	                                    WHERE 1=1 
	                                    AND T1.AUD_YR = #{audYr} 
	                                    AND T1.AUD_NO = #{audNo} 
	                                    AND T1.FNL_YN = 'Y' 
	                                    AND ((T1.APVR_CD IN ('A1070', '0010600') ) OR (T3.CMT_YN = 'N'))        /*부의가 있거나 모두 위임인경우(CMT_YN : N)*/
	                                    GROUP BY T1.AUD_YR, T1.AUD_NO, T1.AUD_STEP_CD, T1.DOC_ID, T1.APVR_CD, T1.RLTN_ORG_CD, T1.HND_ORG_CD, T1.REF_ORG_CD, T3.CMT_YN
	                                ) X, (SELECT 1 NUM FROM DUAL UNION ALL SELECT 2 FROM DUAL UNION ALL SELECT 3 FROM DUAL) Y
	                            ) T3
	                            WHERE ORG_CODE IS NOT NULL
	                        )  
	                   ) A
	                   GROUP BY A.AUD_YR, A.AUD_NO, A.DOC_ID, A.ORG_CODE, A.ORG_NM
	              ) B ON (
	                A.AUD_YR = B.AUD_YR
	                AND A.AUD_NO = B.AUD_NO
	                AND A.REF_ID = B.DOC_ID
	                AND A.RLTN_ORG_CD = B.ORG_CODE
	              )
	             WHERE A.AUD_YR = #{audYr} 
	               AND A.AUD_NO = #{audNo} 
	               AND A.RPRT_CD IN ('A10800200', 'A10800202', 'A10800201')
			]]>
			<if test='docId != null and docId != ""'>
				AND A.DOC_ID = #{docId} 
			</if>
			<if test='refId != null and refId != ""'>
				AND A.REF_ID = #{refId} 
			</if>
			<![CDATA[
				) A
            	ORDER BY A.RPRT_CD ASC, A.SORT_SNO ASC
			]]>
	</select>
	
	
	
	
	
	<!-- 처분요구 시행 목록 시행번호 생성전 -->
	<select id="selectMainNewList" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.selectMainNewList */
        <![CDATA[
        SELECT T1.AUD_YR
             , T1.AUD_NO
             , T1.REF_DOC_ID AS DOC_ID
             , T1.APVR_CD
             , T1.AFF_SNO
             , T1.DSP_RQ_SNO
             , T4.AUD_SBJ_NM                                                  AS AUD_SBJ_NM            /*감사사항*/
             , T1.DSP_RQ_CD                                                   AS  DSP_RQ_KND_CD       /* 처분요구코드 */
             , (SELECT CD_NM
                   FROM TBDCMACM013C
                  WHERE CMM_CD_DVSN_CD = '1000002' 
                    AND CD = T1.DSP_RQ_CD)                                        AS DSP_RQ_KND_NM         /*처분요구종류명*/
             , T1.RLTN_ORG_CD                                                                  /*관계기관*/
             , F_ORG_INFO(T1.RLTN_ORG_CD, '1') AS RLTN_ORG_NM
             , T1.HND_ORG_CD                                                                  /*조치기관*/
             , F_ORG_INFO(T1.HND_ORG_CD, '1') AS HND_ORG_NM
             , T1.REF_ORG_CD                                                                  /*참고기관*/
             , F_ORG_INFO(T1.REF_ORG_CD, '1') AS REF_ORG_NM
             , (SELECT CASE WHEN COUNT(DISTINCT ORG_CD)>1 
                              THEN F_ORG_INFO(MIN(ORG_CD),'1')||'외 '||TO_CHAR(COUNT(DISTINCT ORG_CD)-1)||'' 
                             ELSE F_ORG_INFO(MIN(ORG_CD),'1') 
                        END
                  FROM TBBADDED008L     /*조별출장대상기관내역*/
                 WHERE 1 = 1
                   AND (BZT_YR, BZT_SNO) IN (SELECT BZT_YR
                                                   ,BZT_SNO
                                               FROM TBBADDED002M   /* 출장상황기본 */
                                              WHERE 1=1
                                                AND REL_AUD_YR = T1.AUD_YR
                                                AND REL_AUD_NO = T1.AUD_NO )) AS AUD_ORG_CNT           /*기관명*/
              , T1.TITLE_NM                                                     AS TIT_Txt  /*제목명 */
              , T1.AUD_STEP_CD   /*스텝*/
             /* , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-')  || '-' || T1.AFF_CD || '-' ||  T1.AFF_DSP_CD AS ACT_DSP_NM */  /*  사건번호 */
              , (SELECT MAX(TT1.AFF_NO) 
	              FROM TBBADDED147M TT1 
	             WHERE TT1.AUD_YR = T1.AUD_YR
	                AND TT1.AUD_NO = T1.AUD_NO 
	                AND TT1.APVR_CD IN ('A1070', '0010600') 
	                AND TT1.AFF_SNO = T1.AFF_SNO 
	                AND TT1.DSP_RQ_SNO = T1.DSP_RQ_SRNO)   AS ACT_DSP_NM      /*  사건번호 */    
              
              , T5.EXEC_DSP_NM                                                  AS EXEC_DSP_NM                                                 /* 시행번호  예 :2016-특정-001-시01*/
              , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') ||'-'|| T1.DSP_RQ_SNO   AS DSP_RQ_SNO_NM
              , 'TBBADDED146M'                                              AS TABLE_TYPE
              , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-')                  AS AUD_YR_GRNNO
              , F_ORG_CNT_NM_AUD(T1.AUD_YR,T1.AUD_NO,'AUD') AS AUD_ORG_CNT
              , (SELECT F_DPT_INFO(ENF_BRDV_CD,'1') FROM TBBADEAR002D WHERE AUD_YR = T1.AUD_YR  AND AUD_NO  = T1.AUD_NO AND DSP_RQ_SNO = T1.DSP_RQ_SNO) AS MNG_DPT_CD
              , T1.AFF_CD
              , T6.RPRT_NM                                                 /*보고서명 */
              , T6.APV_STA_CD                                              /*결재상태코드 */
              , F_CODE_NM('1000773',NVL(T6.APV_STA_CD,'10')) AS APV_STA_NM /*결재상태명 */
              , T6.SORT_SNO                                                /*보고서순번  */
              , T6.DOC_ID AS OPEN_DOC_ID                                                 /*결재문서번호 */
              , T6.REF_ID                                                  /*참조ID */
              , T6.REF_DY                                                  /*참조일자 */
              , T6.APV_RQS_ID                                              /*결재요청ID */
              , T6.AUD_RPRT_DVSN_CD                                        /*감사보고서구분코드 */
              , T6.RPRT_CD                                                 /*문서종류코드 */
              , F_USR_INFO_BY_ID(T6.DOC_WRT_ID,'2') AS MAKTER_USER
              , DECODE(T6.APV_RQS_ID, NULL, 'Y', 'N') AS APV_YN
              , (SELECT APV_USR_NM 
                   FROM 
                   (
                       SELECT 
                          F_USR_INFO(APVR_CNB,'2') || 
                          DECODE(APV_DH,NULL,'','('||TO_CHAR(APV_DH,'YYYY-MM-DD')||')') AS APV_USR_NM,
                          APV_DOC_NO
                       FROM TBDCMACM023L
                       WHERE  
                        APVR_KND_CD = '3'
                       ORDER BY APV_SNO DESC
                   )
                   WHERE ROWNUM = 1
                   AND APV_DOC_NO = T6.APV_RQS_ID) AS APV_USR_NM
              , T1.CMT_YN                                                  /*부의 여부 : Y:부의, N:전부위임*/
              , NVL(T9.PRL_SMT_YN,'N') AS PRL_SMT_YN                       /*홍보제출여부*/
              , T10.USR_DFN_TXT_1                           AS DSP_RQ_KND_CD2                  /*홈페이지 공개용 처분요구종류코드*/
              , CASE WHEN T8.DTM_STA_CD = '1' THEN '처분확정'
            WHEN T8.DTM_STA_CD = '2' THEN '집행확정' 
            ELSE '미확정'
          END                                    AS DTM_STA_NM                      /*처분확정여부*/
              , NVL(T8.DTM_STA_CD,0) AS DTM_STA_CD
              , CASE WHEN T9.HMP_OPEN_YN IS NOT NULL THEN T9.HMP_OPEN_YN
             WHEN T8.HMP_OPEN_YN IN ('1','N') THEN 'N'
             WHEN T8.HMP_OPEN_YN IS NULL THEN 'N'
            ELSE 'Y'
            END                                    AS OPEN_YN                         /*공개여부*/
              , CASE WHEN T8.HMP_OPEN_YN IN ('1','N') THEN '비공개'
             WHEN T8.HMP_OPEN_YN IS NULL THEN '비공개'
            ELSE '공개'
            END                                    AS HMP_OPEN_YN   
          , NVL(T9.OPEN_TIT_TXT,T5.TIT_TXT)                         AS OPEN_TIT_TXT
          , DECODE(T9.OPEN_TXT, NULL, 'N','Y') AS OPEN_TXT_EDIT_YN
          , T1.AFF_DSP_CD  
          , T1.DSP_RQ_SRNO
          , T8.SND_STA_CD
          , CASE WHEN T8.SND_RET_RSN_TXT IS NOT NULL THEN '결산반려' 
                 ELSE F_CODE_NM('1000333',NVL(T8.SND_STA_CD,'10'))
             END  AS SND_STA_NM
          , T8.SND_RET_RSN_TXT 
          , T8.SND_APV_DOC_NO
       FROM (
                 SELECT nvl(T4.DSP_RQ_SNO, '') AS DSP_RQ_SNO
                     , T1.AUD_YR
                     , T1.AUD_KND_CD
                     , T1.AUD_NO
                     , T1.AUD_STEP_CD
                     , T1.REF_DOC_ID
                     , T1.APVR_CD
                     , T1.AFF_SNO
                     , T2.AFF_CD
                     , T1.DSP_RQ_CD
                     , T1.RLTN_ORG_CD
                     , T1.HND_ORG_CD
                     , T1.REF_ORG_CD
                     , T1.AFF_DSP_CD
                     , T2.TITLE_NM
                     , T3.CMT_YN
                     , T1.DSP_RQ_SNO AS DSP_RQ_SRNO
                   FROM TBBADDED146M T1
                  INNER JOIN TBBADDED145M T2 
                     ON T1.AUD_YR = T2.AUD_YR
                    AND T1.AUD_NO = T2.AUD_NO
                    AND T1.AUD_STEP_CD = T2.AUD_STEP_CD
                    AND T1.REF_DOC_ID = T2.REF_DOC_ID
                    AND T1.APVR_CD = T2.APVR_CD
                    AND T1.AFF_SNO = T2.AFF_SNO
                    AND T1.FNL_YN = T2.FNL_YN
                   LEFT OUTER JOIN (SELECT A.AUD_YR
                             , A.AUD_NO
                             , DECODE(SUM(DECODE(A.REFER_DVSN_CD,'E10',0,1)),0,'N','Y') AS CMT_YN
                        FROM TBBADDED145M A 
                       WHERE A.AUD_YR = #{audYr}
                         AND A.AUD_NO = #{audNo}
                         AND A.FNL_YN = 'Y'
                    GROUP BY A.AUD_YR, A.AUD_NO) T3
                     ON T1.AUD_YR = T3.AUD_YR
                    AND T1.AUD_NO = T3.AUD_NO
                    LEFT OUTER JOIN TBBADEAR001M T4 
                   ON T1.AUD_YR = T4.AUD_YR
                    AND T1.AUD_NO = T4.AUD_NO
                    AND T1.DSP_RQ_SNO = T4.AUD_DSP_RQ_SNO
                  WHERE 1=1
                    AND T1.AUD_YR = #{audYr}
                    AND T1.AUD_NO = #{audNo}
                    AND T1.FNL_YN = 'Y'
                    AND (T1.APVR_CD IN ('A1070', '0010600') OR T3.CMT_YN = 'N')
                ]]>
                <if test='audGrnNo != null and audGrnNo != ""'>
                       /* AND T1.AUD_GRN_NO = audGrnNo */
                </if>
                <if test='dspRqCd != null and dspRqCd != ""'>
                       AND T1.DSP_RQ_CD = #{dspRqCd}
                </if>
                <if test='docId != null and docId != ""'>
                       AND T1.REF_DOC_ID = #{docId}
                </if>
                <if test='affSno != null and affSno != ""'>
                       AND T1.AFF_SNO = #{affSno}
                </if>
                <if test='dspRqSno != null and dspRqSno != ""'>
                       AND T1.DSP_RQ_SNO = #{dspRqSno}      /* 처분요구정보의 순번*/
                </if>
                 <![CDATA[
                 ) T1 
      INNER JOIN TBBADDED001M T4 ON (T1.AUD_YR     = T4.AUD_YR
                                AND T1.AUD_NO     = T4.AUD_NO)
       LEFT OUTER JOIN TBBADEAR001M T5 ON (T1.AUD_YR     = T5.AUD_YR   /* 처분요구사항기본 */
                                      AND T1.AUD_NO     = T5.AUD_NO
                                      AND T1.DSP_RQ_SNO = T5.DSP_RQ_SNO)
       LEFT OUTER JOIN TBBADDED103M T6 ON (T1.AUD_YR = T6.AUD_YR
                                      AND T1.AUD_NO = T6.AUD_NO
                                      AND TO_CHAR(T1.DSP_RQ_SRNO) = T6.REF_ID 
                                      AND T6.RPRT_CD = 'A10800500')    /* A10800500 : 공개문 */
       LEFT OUTER JOIN TBBADEAR002D T8 ON (T5.AUD_YR     = T8.AUD_YR  /*처분요구사항상세*/ 
                                      AND T5.AUD_NO     = T8.AUD_NO
                                      AND T5.DSP_RQ_SNO = T8.DSP_RQ_SNO)
       LEFT OUTER JOIN TBBADEAR030M T9 ON (T5.AUD_YR     = T9.AUD_YR  /*홍보제출기본*/
                                      AND T5.AUD_NO     = T9.AUD_NO
                                      AND T5.DSP_RQ_SNO = T9.DSP_RQ_SNO)
       LEFT OUTER JOIN TBDCMACM013C T10 ON (T5.DSP_RQ_KND_CD = T10.CD
                                       AND T10.CMM_CD_DVSN_CD = '1000002' 
                                       AND T10.CD <> '000000000')
       ORDER BY T1.DSP_RQ_SNO, T1.AFF_SNO, T1.DSP_RQ_SRNO ASC
        ]]>

    </select>

	<!-- 처분요구 시행 목록 시행번호 생성전 -->
	<select id="selectMainNewList2" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.selectMainNewList2 */
        <![CDATA[
        SELECT T1.AUD_YR
             , T1.AUD_NO
             , T1.DOC_ID
             , T1.APVR_CD
             , T1.AFF_SNO
             , T1.DSP_RQ_SNO
             , T4.AUD_SBJ_NM                                                  AS AUD_SBJ_NM            /*감사사항*/
             , T1.DSP_RQ_CD                                                   AS  DSP_RQ_KND_CD       /* 처분요구코드 */
             , (SELECT CD_NM
                   FROM TBDCMACM013C
                  WHERE CMM_CD_DVSN_CD = '1000002' 
                    AND CD = T1.DSP_RQ_CD)                                        AS DSP_RQ_KND_NM         /*처분요구종류명*/
             , T1.RLTN_ORG_CD                                                                  /*관계기관*/
             , F_ORG_INFO(T1.RLTN_ORG_CD, '1') AS RLTN_ORG_NM
             , T1.HND_ORG_CD                                                                  /*조치기관*/
             , F_ORG_INFO(T1.HND_ORG_CD, '1') AS HND_ORG_NM
             , T1.REF_ORG_CD                                                                  /*참고기관*/
             , F_ORG_INFO(T1.REF_ORG_CD, '1') AS REF_ORG_NM
             , (SELECT CASE WHEN COUNT(DISTINCT ORG_CD)>1 
                              THEN F_ORG_INFO(MIN(ORG_CD),'1')||'외 '||TO_CHAR(COUNT(DISTINCT ORG_CD)-1)||'' 
                             ELSE F_ORG_INFO(MIN(ORG_CD),'1') 
                        END
                  FROM TBBADDED008L     /*조별출장대상기관내역*/
                 WHERE 1 = 1
                   AND (BZT_YR, BZT_SNO) IN (SELECT BZT_YR
                                                   ,BZT_SNO
                                               FROM TBBADDED002M   /* 출장상황기본 */
                                              WHERE 1=1
                                                AND REL_AUD_YR = T1.AUD_YR
                                                AND REL_AUD_NO = T1.AUD_NO )) AS AUD_ORG_CNT           /*기관명*/
              , T1.TITLE_NM                                                     AS TIT_Txt  /*제목명 */
              , T1.AUD_STEP_CD   /*스텝*/
             /* , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-')  || '-' || T1.AFF_CD || '-' ||  T1.AFF_DSP_CD AS ACT_DSP_NM*/   /*  사건번호 */
              , (SELECT MAX(TT1.AFF_NO) 
	              FROM TBBADDED147M TT1 
	             WHERE TT1.AUD_YR = T1.AUD_YR
	                AND TT1.AUD_NO = T1.AUD_NO 
	                AND TT1.APVR_CD IN ('A1070', '0010600') 
	                AND TT1.AFF_SNO = T1.AFF_SNO 
	                AND TT1.DSP_RQ_SNO = T1.DSP_RQ_SNO)   AS ACT_DSP_NM      /*  사건번호 */    
             
              , T5.EXEC_DSP_NM                                                  AS EXEC_DSP_NM                                                 /* 시행번호  예 :2016-특정-001-시01*/
              , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') ||'-'|| T1.DSP_RQ_SNO   AS DSP_RQ_SNO_NM
              , 'TBBADDED146M'                                              AS TABLE_TYPE
              , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-')                  AS AUD_YR_GRNNO
              , F_ORG_CNT_NM_AUD(T1.AUD_YR,T1.AUD_NO,'AUD') AS AUD_ORG_CNT
              , (SELECT F_DPT_INFO(ENF_BRDV_CD,'1') FROM TBBADEAR002D WHERE AUD_YR = T1.AUD_YR  AND AUD_NO  = T1.AUD_NO AND DSP_RQ_SNO = T1.DSP_RQ_SNO) AS MNG_DPT_CD
              , T1.AFF_CD
              , T6.RPRT_NM                                                 /*보고서명 */
              , T6.APV_STA_CD                                              /*결재상태코드 */
              , F_CODE_NM('1000773',NVL(T6.APV_STA_CD,'10')) AS APV_STA_NM /*결재상태명 */
              , T6.SORT_SNO                                                /*보고서순번  */
              , T6.DOC_ID AS OPEN_DOC_ID                                                 /*결재문서번호 */
              , T6.REF_ID                                                  /*참조ID */
              , T6.REF_DY                                                  /*참조일자 */
              , T6.APV_RQS_ID                                              /*결재요청ID */
              , T6.AUD_RPRT_DVSN_CD                                        /*감사보고서구분코드 */
              , T6.RPRT_CD                                                 /*문서종류코드 */
              , F_USR_INFO_BY_ID(T6.DOC_WRT_ID,'2') AS MAKTER_USER
              , DECODE(T6.APV_RQS_ID, NULL, 'Y', 'N') AS APV_YN
              , (SELECT APV_USR_NM 
                   FROM 
                   (
                       SELECT 
                          F_USR_INFO(APVR_CNB,'2') || 
                          DECODE(APV_DH,NULL,'','('||TO_CHAR(APV_DH,'YYYY-MM-DD')||')') AS APV_USR_NM,
                          APV_DOC_NO
                       FROM TBDCMACM023L
                       WHERE  
                        APVR_KND_CD = '3'
                       ORDER BY APV_SNO DESC
                   )
                   WHERE ROWNUM = 1
                   AND APV_DOC_NO = T6.APV_RQS_ID) AS APV_USR_NM
              , T1.CMT_YN                                                  /*부의 여부 : Y:부의, N:전부위임*/
              , (SELECT CASE WHEN COUNT(*) > 0 THEN 'Y'
                    ELSE 'N'
                END  
          FROM TBBADEAR030M T11
         WHERE T11.AUD_YR     = T8.AUD_YR
           AND T11.AUD_NO     = T8.AUD_NO
           AND T11.DSP_RQ_SNO     = T8.DSP_RQ_SNO
           AND T11.PRL_SMT_YN = 'Y')       AS PRL_SMT_YN                      /*홍보제출여부*/
              , T10.USR_DFN_TXT_1                           AS DSP_RQ_KND_CD2                  /*홈페이지 공개용 처분요구종류코드*/
              , CASE WHEN T8.DTM_STA_CD = '1' THEN '처분확정'
            WHEN T8.DTM_STA_CD = '2' THEN '집행확정' 
            ELSE '미확정'
          END                                    AS DTM_STA_NM                      /*처분확정여부*/
              , NVL(T8.DTM_STA_CD,0) AS DTM_STA_CD
              , CASE WHEN T9.HMP_OPEN_YN IS NOT NULL THEN T9.HMP_OPEN_YN
             WHEN T8.HMP_OPEN_YN IN ('1','N') THEN 'N'
             WHEN T8.HMP_OPEN_YN IS NULL THEN 'N'
            ELSE 'Y'
            END                                    AS OPEN_YN                         /*공개여부*/
              , CASE WHEN T8.HMP_OPEN_YN IN ('1','N') THEN '비공개'
             WHEN T8.HMP_OPEN_YN IS NULL THEN '비공개'
            ELSE '공개'
            END                                    AS HMP_OPEN_YN   
          , NVL(T9.OPEN_TIT_TXT,T5.TIT_TXT)                         AS OPEN_TIT_TXT
          , T1.AFF_DSP_CD  
          , T1.DSP_RQ_SRNO
          , T8.SND_STA_CD
          , CASE WHEN T8.SND_RET_RSN_TXT IS NOT NULL THEN '결산반려' 
                 ELSE F_CODE_NM('1000333',NVL(T8.SND_STA_CD,'10'))
             END  AS SND_STA_NM
          , T8.SND_RET_RSN_TXT           
          , T8.SND_APV_DOC_NO
       FROM (
                 SELECT NVL(T4.DSP_RQ_SNO, '') AS DSP_RQ_SNO
                     , T1.AUD_YR
                     , T1.AUD_KND_CD
                     , T1.AUD_NO
                     , T1.AUD_STEP_CD
                     , T1.DOC_ID
                     , T1.APVR_CD
                     , T1.AFF_SNO
                     , T2.AFF_CD
                     --, T1.DSP_RQ_SNO
                     , T1.DSP_RQ_CD
                     , T1.RLTN_ORG_CD
                     , T1.HND_ORG_CD
                     , T1.REF_ORG_CD
                     , T1.AFF_DSP_CD
                     , T2.TITLE_NM
                     , T3.CMT_YN
                     , T1.DSP_RQ_SNO AS DSP_RQ_SRNO
                   FROM TBBADDED146M T1
                  INNER JOIN TBBADDED145M T2 
                     ON T1.AUD_YR = T2.AUD_YR
                    AND T1.AUD_NO = T2.AUD_NO
                    AND T1.AUD_STEP_CD = T2.AUD_STEP_CD
                    AND T1.DOC_ID = T2.DOC_ID
                    AND T1.APVR_CD = T2.APVR_CD
                    AND T1.AFF_SNO = T2.AFF_SNO
                    AND T1.FNL_YN = T2.FNL_YN
                   LEFT OUTER JOIN (SELECT A.AUD_YR
                             , A.AUD_NO
                             , DECODE(SUM(DECODE(A.REFER_DVSN_CD,'E10',0,1)),0,'N','Y') AS CMT_YN
                        FROM TBBADDED145M A 
                       WHERE A.AUD_YR = #{audYr}
                         AND A.AUD_NO = #{audNo}
                         AND A.FNL_YN = 'Y'
                    GROUP BY A.AUD_YR, A.AUD_NO) T3
                     ON T1.AUD_YR = T3.AUD_YR
                    AND T1.AUD_NO = T3.AUD_NO
                  LEFT OUTER JOIN TBBADEAR001M T4 
                   ON T1.AUD_YR = T4.AUD_YR
                    AND T1.AUD_NO = T4.AUD_NO
                    /*AND T1.AFF_DSP_CD = T4.AFF_DSP_CD*/
                    AND T1.DSP_RQ_SNO = T4.AUD_DSP_RQ_SNO
                    /*AND T2.AFF_CD = T4.AFF_CD*/
                  WHERE 1=1
                    AND T1.AUD_YR = #{audYr}
                    AND T1.AUD_NO = #{audNo}
                    AND T1.FNL_YN = 'Y'
                    AND (T1.APVR_CD IN ('A1070', '0010600') OR T3.CMT_YN = 'N')
                ]]>
                <if test='audGrnNo != null and audGrnNo != ""'>
                       /* AND T1.AUD_GRN_NO = audGrnNo */
                </if>
                <if test='dspRqCd != null and dspRqCd != ""'>
                       AND T1.DSP_RQ_CD = #{dspRqCd}
                </if>
                <if test='docId != null and docId != ""'>
                       AND T1.DOC_ID = #{docId}
                </if>
                <if test='affSno != null and affSno != ""'>
                       AND T1.AFF_SNO = #{affSno}
                </if>
                <if test='dspRqSno != null and dspRqSno != ""'>
                       AND T1.DSP_RQ_SNO = #{dspRqSno}      /* 처분요구정보의 순번*/
                </if>
                 <![CDATA[
                 ) T1 
      INNER JOIN TBBADDED001M T4 ON (T1.AUD_YR     = T4.AUD_YR
                                AND T1.AUD_NO     = T4.AUD_NO)
       LEFT OUTER JOIN TBBADEAR001M T5 ON (T1.AUD_YR     = T5.AUD_YR   /* 처분요구사항기본 */
                                      AND T1.AUD_NO     = T5.AUD_NO
                                      AND T1.DSP_RQ_SNO = T5.DSP_RQ_SNO)
       LEFT OUTER JOIN TBBADDED103M T6 ON (T1.AUD_YR = T6.AUD_YR
                                      AND T1.AUD_NO = T6.AUD_NO
                                      AND TO_CHAR(T1.DSP_RQ_SRNO) = T6.REF_ID 
                                      AND T6.RPRT_CD = 'A10800500')    /* A10800500 : 공개문 */
       LEFT OUTER JOIN TBBADEAR002D T8 ON (T5.AUD_YR     = T8.AUD_YR  /*처분요구사항상세*/ 
                                      AND T5.AUD_NO     = T8.AUD_NO
                                      AND T5.DSP_RQ_SNO = T8.DSP_RQ_SNO)
       LEFT OUTER JOIN TBBADEAR030M T9 ON (T5.AUD_YR     = T9.AUD_YR  /*홍보제출기본*/
                                      AND T5.AUD_NO     = T9.AUD_NO
                                      AND T5.DSP_RQ_SNO = T9.DSP_RQ_SNO)
       LEFT OUTER JOIN TBDCMACM013C T10 ON (T5.DSP_RQ_KND_CD = T10.CD
                                       AND T10.CMM_CD_DVSN_CD = '1000002' 
                                       AND T10.CD <> '000000000')
       ORDER BY T1.DSP_RQ_SNO, T1.AFF_SNO, T1.DSP_RQ_SRNO ASC
        ]]>

    </select>
    
	<!--처분요구기본   조치기관, 참고기관 update -->
	<update id="updateHndOrgs" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.updateHndOrgs */
		<![CDATA[ 	
			 UPDATE TBBADDED146M
			    SET HND_ORG_CD = REPLACE(#{hndOrgCd}, ' ', '')
			    , REF_ORG_CD = REPLACE(#{refOrgCd}, ' ', '')
			 WHERE 1=1
			   AND AUD_YR 		= #{audYr}
			   AND AUD_NO  		= #{audNo}
			   AND DSP_RQ_SNO 	= #{dspRqSrno}
		]]>
	</update>
	
	
	<select id="selectOpenDocMainList" parameterType="paramMap" resultType="egovMap" >
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.selectOpenDocMainList */

		<![CDATA[  
					SELECT A.AUD_YR
                           , A.AUD_NO
                           , A.AUD_STEP_CD
                           , A.DOC_ID
                           , A.AUD_KND_CD
                           , A.RPRT_NM
                           , A.APV_STA_CD
                           , A.RPRT_CD
                           , A.APV_RQS_ID
                           , A.REF_ID
                           , B.RPRT_CD AS RPRT_CD_ORG
                           , (SELECT RPRT_NM FROM TBBADDED103M WHERE AUD_YR = A.AUD_YR AND AUD_NO = A.AUD_NO AND DOC_ID = A.REF_ID) AS AUD_RPRT_NM
                    FROM TBBADDED103M A
                    INNER JOIN TBBADDED103M B ON (A.AUD_YR = B.AUD_YR AND A.AUD_NO = B.AUD_NO AND A.REF_ID = B.DOC_ID)
                    WHERE A.RPRT_CD = 'A10800500' 
                    AND A.AUD_YR = #{audYr}
                    AND A.AUD_NO = #{audNo}
        ]]>
	</select>
	
	<select id="selectDocumentList" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.selectDocumentList*/
        /*문서함(결재정보)*/
        <![CDATA[
        SELECT
            RPRT_NM,
           APV_STA_CD,
           APV_RQS_ID,
           DOC_ID,
           APV_SRNO,
           PST_NM,
           APVR_NM,
           APV_DH ,
           CASE
                WHEN ROW_NUMBER() OVER(PARTITION BY DOC_ID ORDER BY APV_SRNO) = 1 THEN COUNT(*) OVER(PARTITION BY DOC_ID)
                ELSE 0
           END ROWSPAN_CNT,
           APVR_CNB
      FROM (
           SELECT
                  A.RPRT_NM ,       /*보고서명 */
                  A.APV_STA_CD ,    /*결재상태코드 */
                  A.DOC_ID ,        /*결재문서번호 */
                  A.APV_RQS_ID,     /*결재요청ID */
                  B.APV_SRNO ,      /*결재순번 */
                  B.PST_NM ,        /*결재자직위코드 */
                  B.APVR_NM ,       /*결재자전산번호 */
                  B.APVR_STA_CD,
                  /* 문서 반려시 재상신하므로 최초결재일을 History 테이블에서 가져오도록 수정 MJ */
                  CASE
                  WHEN B.APV_DH IS NULL
                        THEN
                        CASE WHEN (SELECT MIN(TO_CHAR(APV_DH, 'YYYY-MM-DD'))
                                          FROM TBDCMACM023H ST1
                                         WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
                                           AND ST1.APVR_CNB = B.APVR_CNB
                                           AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') IS NULL
                                    THEN B.APV_DH
                                  ELSE (SELECT MIN(TO_CHAR(APV_DH, 'YYYY-MM-DD'))
                                          FROM TBDCMACM023H ST1
                                         WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
                                           AND ST1.APVR_CNB = B.APVR_CNB
                                           AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') END
                       WHEN B.APV_DH IS NOT NULL
                        THEN CASE WHEN (SELECT MIN(TO_CHAR(APV_DH, 'YYYY-MM-DD'))
                                          FROM TBDCMACM023H ST1
                                         WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
                                           AND ST1.APVR_CNB = B.APVR_CNB
                                           AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') IS NULL
                                    THEN B.APV_DH
                                  ELSE (SELECT MIN(TO_CHAR(APV_DH, 'YYYY-MM-DD'))
                                          FROM TBDCMACM023H ST1
                                         WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
                                           AND ST1.APVR_CNB = B.APVR_CNB
                                           AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') END
                  END AS APV_DH /*결재일시 */
                  , B.APVR_CNB
             FROM TBBADDED103M A,
                  (
                  SELECT T1.APV_DOC_NO AS APV_RQS_ID ,
                         T1.APV_SNO AS APV_SRNO ,
                         CASE WHEN T1.APVR_PST_CD IS NULL
                              THEN T1.ONR_PST_NM
                              ELSE F_CODE_NM('1000176', T1.APVR_PST_CD)
                         END  AS PST_NM ,
                         T1.APVR_STA_CD,
                         DECODE(T1.APVR_STA_CD, '206', (
                                                     SELECT '(代)' || F_USR_INFO(T2.APVR_CNB, '2')
                                                       FROM TBDCMACM023L T2
                                                      WHERE T2.APV_DOC_NO = T1.APV_DOC_NO
                                                        AND T2.APV_SNO = T1.APV_SNO
                                                        AND T2.APVR_STA_CD = '203'
                                                    ), F_USR_INFO(T1.APVR_CNB, '2')) AS APVR_NM ,
                         CASE WHEN SUBSTR(APVR_STA_CD,0,1) = '2' THEN TO_CHAR(APV_DH, 'YYYY-MM-DD')
                                  ELSE ''
                         END  AS APV_DH,
                         T1.APVR_CNB
                    FROM TBDCMACM023L T1
                   WHERE T1.APV_SNO <> '1'
                   AND T1.APVR_KND_CD NOT IN ('4','6','7')
                   UNION ALL
                  SELECT DH1.APV_RQS_ID,
                         DH1.APV_SRNO,
                         (SELECT H2.PST_NM AS PST_NM
                            FROM TBDCMACM111H H1,
                                 TBDCMACM112H H2
                           WHERE 1=1
                             AND H1.RCPT_DT = H2.RCPT_DT
                             AND H1.RCPT_ID = H2.RCPT_ID
                             AND H1.ONR_DOC_MNG_CRD_ID = DH1.APV_RQS_ID
                             AND H2.APVR_ID = DH1.APVR_ID
                           GROUP BY H2.PST_NM ) AS PST_NM,
                         '' as APVR_STA_CD,
                         DH1.APVR_NM,
                         DH1.APV_DH,
                         DH1.APVR_ID AS APVR_CNB
                    FROM
                         (SELECT ONR_DOC_MNG_CRD_ID AS APV_RQS_ID,
                                 APV_HIS_SRNO AS APV_SRNO,
                                 APVR_ID,
                                 APVR_NM AS APVR_NM,
                                 TO_CHAR(APV_DH, 'YYYY-MM-DD') AS APV_DH
                            FROM TBDCMACM102L D2
                           WHERE 1=1
                             AND ONR_APV_DVSN_CD <> '10' --(기안자 제외)
                             AND NVL(ONR_APV_RSLT_CD,'hh') <>'50'
                           ORDER BY APV_RQS_ID,APV_SRNO
                         ) DH1
                  ) B
             WHERE A.AUD_YR = #{audYr}
              AND A.AUD_NO = #{audNo}
              AND A.APV_RQS_ID = B.APV_RQS_ID
        ]]>
        	<if test="enfDocYn != null and enfDocYn != '' and enfDocYn eq 'Y'.toString()">
              /* A10601200   수사요청서 시행문, A10601400   현지조치사항 시행문, A10601600   사실통보서 시행문, A10601800   수사참고자료 시행문 */
           	  AND A.RPRT_CD IN ('A10601200', 'A10601400', 'A10601600', 'A10601800')
           	</if>
	        <if test="rprtCd != null and rprtCd != '' and rprtCd eq 'A10800300'.toString()">
	          AND A.REF_ID = #{refId}
	          AND A.RPRT_CD IN ('A10800300')
	        </if>
	        <if test="rprtCd != null and rprtCd != '' and rprtCd eq 'A10800600'.toString()">
	          /* A10601200   수사요청서 시행문, A10601400   현지조치사항 시행문, A10601600   사실통보서 시행문, A10601800   수사참고자료 시행문 */
	          AND A.RPRT_CD = 'A10800600'
	        </if>
	        <if test="rprtCd != null and rprtCd != '' and rprtCd eq 'A10800700'.toString()">
	          /* A10800700   감사원장표창 통보문 */
	          AND A.RPRT_CD = 'A10800700'
	        </if>
        ORDER BY A.SORT_SNO
        )
    </select>
    
	<select id="selectDocumentList2" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.dcm.acm.dao.AEPDRE001EMapper.selectDocumentList2*/
        /*문서함(문서자체정보)*/
        <![CDATA[
          SELECT RPRT_NM
             , RPRT_CD
             , APV_STA_CD
             , APV_STA_NM
             , SORT_SNO
             , DECODE(CON_PGM_CD, '20', TEMPLATE_DOC_ID, DOC_ID) AS DOC_ID   /* 온나라결제인경우 TEMPLATE_DOC_ID 로 변경 */
             , DOC_ID                                            AS DOC_ID2  /* 삭제를 위한 DOC_ID */
             , APV_RQS_ID
             , APV_YN
             , CON_PGM_CD
             , NECES_YN
             , APV_WAY_CD
             , DOC_WRT_ID
             , AUD_RPRT_DVSN_CD
             , RLTN_ORG_CD
             , F_ORG_INFO(MIN(RLTN_ORG_CD),'1') AS RLTN_ORG_NM
             , GRT_WRT_YN
             , (SELECT DECODE(MAX(AUD_DOC_CD), 'A10500200', MIN(DTIL_AUD_DOC_NM), MAX(DTIL_AUD_DOC_NM)) FROM TBFDMADM002M WHERE AUD_DOC_CD = RPRT_CD) AS RPRT_KND_NM
             , DECODE((SELECT COUNT(1) FROM TBDCMACM023H ST1 WHERE ST1.APV_DOC_NO = APV_RQS_ID), 0, 'N', 'Y') AS EXISTS_APV_HIS_YN
             , FNL_BAI_RPRT_APV_YN
             , DOC_TYPE
       	  FROM (
	          SELECT
	              CASE WHEN A.RPRT_CD = 'A10700500'     /*부의안 요약 + 부의안 한줄로 처리 */
	                    THEN  A.RPRT_NM ||'<br>'|| (SELECT RPRT_NM
	                                        FROM TBBADDED103M ST1
	                                        WHERE ST1.AUD_YR = A.AUD_YR
	                                        AND ST1.AUD_NO = A.AUD_NO
	                                        AND ST1.AUD_STEP_CD = A.AUD_STEP_CD
	                                        AND ST1.AUD_KND_CD = A.AUD_KND_CD
	                                        AND ST1.REF_DY  = A.REF_DY
                                            AND ST1.REF_DOC_ID = A.REF_DOC_ID
                                            AND ST1.REF_ID = A.DOC_ID
	                                        AND ST1.RPRT_CD = 'A10700600')
                        WHEN A.RPRT_CD = 'A10700200'     /*소위원회 심의안, 소위원회 심의안 요약 */
	                    THEN  A.RPRT_NM ||'<br>'|| (SELECT RPRT_NM
	                                        FROM TBBADDED103M ST1
	                                        WHERE ST1.AUD_YR = A.AUD_YR
	                                        AND ST1.AUD_NO = A.AUD_NO
	                                        AND ST1.AUD_STEP_CD = A.AUD_STEP_CD
	                                        AND ST1.AUD_KND_CD = A.AUD_KND_CD
	                                        AND ST1.RPRT_CD = 'A10700210'
                                            AND ST1.REF_DOC_ID = A.DOC_ID)
	                    ELSE A.RPRT_NM
	               END AS RPRT_NM ,       /*보고서명 */
	               A.RPRT_CD ,       /*보고서코드*/
	               A.APV_STA_CD,    /*결재상태코드 */
	               F_CODE_NM('1000773',A.APV_STA_CD) AS APV_STA_NM ,    /*결재상태코드 */
	               A.SORT_SNO ,      /*보고서순번  */
	               A.DOC_ID,         /*결재문서번호 */
	               A.APV_RQS_ID,      /*결재ID*/
	               CASE WHEN A.RPRT_CD IN ('A10600200','A10600410','A10700500','A10700600','A10700200','A10600900','A10700900')
	                   THEN DECODE(1, (
	                                  SELECT 1
	                                    FROM DUAL
	                                   WHERE EXISTS (
	                                                SELECT 1
	                                                  FROM TBBADDED111M B
	                                                 WHERE A.AUD_YR = B.AUD_YR
	                                                   AND A.AUD_NO = B.AUD_NO
	                                                   AND A.AUD_STEP_CD = B.AUD_STEP_CD
	                                                   AND A.DOC_ID = B.DOC_ID
	                                                )
	                                  ), 'N', 'Y')
	                   ELSE 'N'
	               END AS APV_YN ,           /*결재여부 */
	               CON_PGM_CD    /*연계프로그램코드*/
	                  /*필수여부*/
	                  ,A.NECES_YN
	                  ,A.APV_WAY_CD /*결재방법코드*/
	                  , A.DOC_WRT_ID
	               ,A.AUD_RPRT_DVSN_CD
	               ,A.RLTN_ORG_CD
	               ,(
	                 SELECT CASE WHEN (
                                    CASE WHEN COUNT(T1.DOC_ID) <> 0 
                                         THEN DECODE(COUNT(T1.DOC_ID), SUM(DECODE(T2.REFLECT_YN, 'Y', 1, 'N', 1, 'PY', 1, 0)), 'Y', 'N' )
                                         ELSE 'N'
                                    END ) = 'Y'
                                THEN MAX((
                                      SELECT DECODE(COUNT(1), 0, 'Y', 'D')
                                        FROM TBBADDED103M T3
                                       WHERE T3.AUD_YR = T1.AUD_YR
                                         AND T3.AUD_NO = T1.AUD_NO
                                         AND T3.RPRT_CD = 'A10600410'
                                         AND T3.REF_ID = T1.DOC_ID
                                     ))
                                ELSE 'N'
                           END AS GRT_WRT_YN
                       FROM TBBADDED145M T1
                       LEFT OUTER JOIN TBBADDED118M T2 ON (
		                        T1.AUD_YR = T2.AUD_YR
		                    AND T1.AUD_NO = T2.AUD_NO
		                    AND T1.AUD_STEP_CD = T2.AUD_STEP_CD
		                    AND T1.DOC_ID = T2.DOC_ID 
		                    AND T1.AFF_SNO = T2.AFF_SNO )
		              WHERE T1.APVR_CD = '0013600'
		                AND T1.AUD_YR = A.AUD_YR
		                AND T1.AUD_NO = A.AUD_NO
		                AND T1.DOC_ID = A.DOC_ID
	                ) AS GRT_WRT_YN
                    , (SELECT DECODE(MAX(APV_STA_CD),'30','Y','N') 
                         FROM TBBADDED103M ST1
                        WHERE ST1.AUD_YR = A.AUD_YR
                          AND ST1.AUD_NO = A.AUD_NO
                          AND ST1.RPRT_CD = 'A10600200'
                          AND ST1.FNL_BAI_RPRT_YN = 'Y'
                          AND ST1.AUD_RPRT_DVSN_CD = '11') AS FNL_BAI_RPRT_APV_YN
                 , A.TEMPLATE_DOC_ID
                 , F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE
	          FROM TBBADDED103M AS A
	          WHERE A.AUD_YR = #{audYr}
	          AND A.AUD_NO = #{audNo}
	          AND A.AUD_KND_CD = #{audKndCd}
           	]]>
            <if test="enfDocYn != null and enfDocYn != '' and enfDocYn eq 'Y'.toString()">
              /* A10601200   수사요청서 시행문, A10601400   현지조치사항 시행문, A10601600   사실통보서 시행문, A10601800   수사참고자료 시행문 */
           	  AND A.RPRT_CD IN ('A10601200', 'A10601400', 'A10601600', 'A10601800')
           	</if>
	        <if test="rprtCd != null and rprtCd != '' and rprtCd eq 'A10800300'.toString()">
	          AND A.REF_ID = #{refId}
	          AND A.RPRT_CD IN ('A10800300')
	        </if>
	        <if test="rprtCd != null and rprtCd != '' and rprtCd eq 'A10800600'.toString()">
	          /* A10601200   수사요청서 시행문, A10601400   현지조치사항 시행문, A10601600   사실통보서 시행문, A10601800   수사참고자료 시행문 */
	          AND A.RPRT_CD = 'A10800600'
	        </if>
	        <if test="rprtCd != null and rprtCd != '' and rprtCd eq 'A10800700'.toString()">
	          /* A10800700   감사원장표창 통보문 */
	          AND A.RPRT_CD = 'A10800700'
	        </if>
        )
         GROUP BY RPRT_NM, RPRT_CD, APV_STA_CD, APV_STA_NM, SORT_SNO, DOC_ID, APV_RQS_ID, APV_YN, CON_PGM_CD, NECES_YN, APV_WAY_CD
             , DOC_WRT_ID, AUD_RPRT_DVSN_CD, RLTN_ORG_CD, GRT_WRT_YN, FNL_BAI_RPRT_APV_YN, TEMPLATE_DOC_ID, DOC_TYPE
         ORDER BY SORT_SNO
    </select>
	
	<select id="selectOrgModifyInfo" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectOrgModifyInfo*/
        <![CDATA[
          SELECT RPRT_NM
                 , F_CODE_NM('1000773',NVL(APV_STA_CD,'10')) AS APV_STA_NM
            FROM TBBADDED103M 
           WHERE AUD_YR = #{audYr}
             AND AUD_NO = #{audNo}
             AND RPRT_CD IN ('A10800200', 'A10800202', 'A10800201')
             AND APV_STA_CD IN ('20','25','30') 
             AND REF_ID = #{docId}
             AND RLTN_ORG_CD IN 
        ]]>
          <foreach collection="orgList" item="item" index="index" separator="," open="(" close=")">
              #{item}
          </foreach>
             AND ROWNUM = 1
    </select>
    
    <select id="selectMainTskPrcsList" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectMainTskPrcsList */
        /*실지감사 주요업무 프로세스 sql*/
        SELECT A.AUD_MAIN_STEP_ID  /*주요업무코드*/
             , A.AUD_STEP_CD /*감사단계코드*/
             , A.AUD_MAIN_STEP_SNO  /*주요업무순번 */
             , A.AUD_MAIN_SEQ_W /*주요업무순서_가로 */
             , A.AUD_MAIN_SEQ_H /*주요업무순서_세로 */
             , A.CMPT_YN /*완료여부*/
             , A.AUD_GRN_NO  /*감사부여번호*/
             , A.AUD_DOC_CD /*문서ID*/
             , TRIM(A.MAIN_JOB_NM) AS MAIN_JOB_NM /*주요업무명*/
             , TRIM(A.LINK_TYPE) AS LINK_TYPE/*링크유형*/
             , DECODE(TRIM(A.LINK_TYPE), 'NAN', ''
                                 , 'POP', A.LINK_URL
                                 , (SELECT DOC_ID
                                      FROM TBFDMADM002M B
                                    WHERE A.AUD_DOC_CD = B.AUD_DOC_CD
                                       AND B.DOC_KND_CD = DECODE(A.LINK_TYPE, 'DOC', '10', '20')
                                       AND NVL(AUD_RPRT_TYPE_CD, SUBSTR(A.AUD_KND_CD, 3, 3)) = SUBSTR(A.AUD_KND_CD, 3, 3)
                                   <if test='audStepCd == "A1050"'>
                                       AND (
                                                -- 종료보고서의 경우 공익/국민감사사항 템플릿ID 분리, 나머지의 경우 동일한 템플릿ID 가져옴 
                                                (B.AUD_DOC_CD = 'A10500200' AND B.DTIL_AUD_DOC_NO = (SELECT CASE WHEN T1.REQ_DVSN_CD IN ('2', '3') THEN '394' ELSE '163' END
                                                                                                                                                  FROM TBBADDED001M T1
                                                                                                                                                 WHERE T1.AUD_YR = #{audYr}
                                                                                                                                                   AND T1.AUD_NO = #{audNo}))
                                                OR B.AUD_DOC_CD != 'A10500200'
                                               )
                                   </if>
                                   )
                     ) AS LINK_URL /*링크주소*/
          FROM TBBADDED102M A
         WHERE 1=1
        <if test='audYr != null and audYr != ""'>
           AND A.AUD_YR = #{audYr} /* PARAM : 감사년도 */
        </if>
        <if test='audNo != null and audNo != ""'>
           AND A.AUD_NO = #{audNo}/* PARAM : 감사연번(내부  pk 번호) */
        </if>
        <if test='audKndCd != null and audKndCd != ""'>
           AND A.AUD_KND_CD = #{audKndCd}
        </if>
        <if test='audStepCd != null and audStepCd != ""'>
           AND A.AUD_STEP_CD = #{audStepCd} /* PARAM : 감사단계코드  */
        </if>
	    <if test='audMainStepDsvnCd != null and audMainStepDsvnCd != ""'>
	        AND SUBSTR(A.AUD_MAIN_STEP_ID,0,2) = #{audMainStepDsvnCd} /* PARAM : 주요업무구분코드(AUD_MAIN_STEP_ID 앞 2자리) */
	    </if> 
	    <if test='prcsDocId != null and prcsDocId != ""'>
	        AND DOC_ID = #{prcsDocId}
	    </if>	            
        <if test='bztBgtDvsnCd != "3" '>
        <![CDATA[
           AND A.AUD_MAIN_STEP_ID <> '100601'  /*2018.07.17 CJLEE 차장배정일때만 결정회의 보여줌*/
         ]]> 
        </if>
         ORDER BY A.AUD_MAIN_STEP_SNO, A.AUD_MAIN_SEQ_W ASC
    </select>    
    

	<select id="selectSndRetRsnTxtInfo" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.selectSndRetRsnTxtInfo */
        <![CDATA[
						SELECT AUD_YR
						      ,AUD_NO
						      ,DSP_RQ_SNO
						      ,SND_STA_CD
						      ,SND_APV_DOC_NO
						      ,SND_RET_RSN_TXT
						  FROM TBBADEAR002D
						 WHERE AUD_YR       = #{audYr} 
						    AND AUD_NO      = #{audNo}
						    AND DSP_RQ_SNO = #{dspRqSno}
        ]]>
    </select>
    
    <!-- 최종보고서 생성 여부 체크 -->
	<select id="selectFnlRprtCreYn" parameterType="paramMap" resultType="String" >
        /*kr.go.bai.eip.aep.dre.dao.AEPDRE001EMapper.selectFnlRprtCreYn */
        <![CDATA[
			SELECT (SELECT DECODE(FNL_RPRT_CRE_YN,'','N','Y') AS FNL_RPRT_CRE_YN 
			          FROM TBBADDED103M
				     WHERE AUD_YR = #{audYr} 
				       AND AUD_NO = #{audNo}
				       AND DOC_ID = #{docId}
				   ) AS FNL_RPRT_CRE_YN
			  FROM DUAL
        ]]>
    </select>
    
</mapper> 
