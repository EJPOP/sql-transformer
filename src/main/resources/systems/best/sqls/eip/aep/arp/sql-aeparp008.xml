<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.arp.dao.AEPARP008PMapper">

    <select id="selectTeam1List" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.arp.dao.AEPARP008PMapper.selectTeam1List */
        <![CDATA[
            SELECT G1.TRTM_EXAMR_CNB
                 , G1.DPT_NM
                 , G1.RANK_NM
                 , G1.USR_NAM
              FROM (SELECT ROWNUM AS RNUM
                           FROM DUAL
                        CONNECT BY ROWNUM <= 5) T3
              LEFT JOIN (
                    SELECT ROWNUM AS RNUM
                         , T3.*
                      FROM (
                            SELECT T1.TRTM_EXAMR_CNB
                                 , F_DPT_INFO(MAX(T2.DPT_CD), '1') AS DPT_NM
                                 , F_CODE_NM('1000173', MAX(T2.RANK_CD)) AS RANK_NM
                                 , MAX(T2.USR_NAM) AS USR_NAM
                              FROM TBBADDED124M T1
                             INNER JOIN TBDCMACM001M T2 ON (
                                        T1.TRTM_EXAMR_CNB = T2.CNB )
                             WHERE T1.TEAM_DVSN = 1
                             GROUP BY T1.DTB_SNO, T1.TEAM_SNO, T1.TRTM_EXAMR_CNB
                            HAVING T1.DTB_SNO = (SELECT MAX(T4.DTB_SNO) FROM TBBADDED124M T4)
                             ORDER BY T1.TEAM_SNO ) T3
                    ) G1 ON ( G1.RNUM = T3.RNUM )
            ]]>
    </select>

    <select id="selectTeam2List" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.arp.dao.AEPARP008PMapper.selectTeam2List */
        <![CDATA[
            SELECT G1.TRTM_EXAMR_CNB
                 , G1.DPT_NM
                 , G1.RANK_NM
                 , G1.USR_NAM
              FROM (SELECT ROWNUM AS RNUM
                           FROM DUAL
                        CONNECT BY ROWNUM <= 5) T3
              LEFT JOIN (
                    SELECT ROWNUM AS RNUM
                         , T3.*
                      FROM (
                            SELECT T1.TRTM_EXAMR_CNB
                                 , F_DPT_INFO(MAX(T2.DPT_CD), '1') AS DPT_NM
                                 , F_CODE_NM('1000173', MAX(T2.RANK_CD)) AS RANK_NM
                                 , MAX(T2.USR_NAM) AS USR_NAM
                              FROM TBBADDED124M T1
                             INNER JOIN TBDCMACM001M T2 ON (
                                        T1.TRTM_EXAMR_CNB = T2.CNB )
                             WHERE T1.TEAM_DVSN = 2
                             GROUP BY T1.DTB_SNO, T1.TEAM_SNO, T1.TRTM_EXAMR_CNB
                            HAVING T1.DTB_SNO = (SELECT MAX(T4.DTB_SNO) FROM TBBADDED124M T4)
                             ORDER BY T1.TEAM_SNO ) T3
                    ) G1 ON ( G1.RNUM = T3.RNUM )
            ]]>
    </select>

    <select id="selectChgrChgHstList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.arp.dao.AEPARP008PMapper.selectChgrChgHstList */
        <include refid="include.pageSelct" />
        <![CDATA[
            SELECT MAX(DTB_MDF_DH) AS DTB_MDF_DH
                 , MAX(DTB_MDF_NM) AS DTB_MDF_NM
                 , NVL(MAX(DECODE(TEAM_DVSN, 1, TRTM_EXAMR_NM1)), '-') AS TRTM_EXAMRT101
                 , NVL(MAX(DECODE(TEAM_DVSN, 1, TRTM_EXAMR_NM2)), '-') AS TRTM_EXAMRT102
                 , NVL(MAX(DECODE(TEAM_DVSN, 1, TRTM_EXAMR_NM3)), '-') AS TRTM_EXAMRT103
                 , NVL(MAX(DECODE(TEAM_DVSN, 1, TRTM_EXAMR_NM4)), '-') AS TRTM_EXAMRT104
                 , NVL(MAX(DECODE(TEAM_DVSN, 1, TRTM_EXAMR_NM5)), '-') AS TRTM_EXAMRT105
                 , NVL(MAX(DECODE(TEAM_DVSN, 2, TRTM_EXAMR_NM1)), '-') AS TRTM_EXAMRT201
                 , NVL(MAX(DECODE(TEAM_DVSN, 2, TRTM_EXAMR_NM2)), '-') AS TRTM_EXAMRT202
                 , NVL(MAX(DECODE(TEAM_DVSN, 2, TRTM_EXAMR_NM3)), '-') AS TRTM_EXAMRT203
                 , NVL(MAX(DECODE(TEAM_DVSN, 2, TRTM_EXAMR_NM4)), '-') AS TRTM_EXAMRT204
                 , NVL(MAX(DECODE(TEAM_DVSN, 2, TRTM_EXAMR_NM5)), '-') AS TRTM_EXAMRT205
              FROM (
                    SELECT TO_CHAR(MAX(DTB_MDF_DH), 'YYYY-MM-DD') AS DTB_MDF_DH
                         , F_USR_INFO(MAX(DTB_MDF_CNB), '2') AS DTB_MDF_NM
                         , DTB_SNO
                         , TEAM_DVSN
                         , F_USR_INFO(MAX(DECODE(TEAM_SNO, 1, TRTM_EXAMR_CNB)), '2') AS TRTM_EXAMR_NM1
                         , F_USR_INFO(MAX(DECODE(TEAM_SNO, 2, TRTM_EXAMR_CNB)), '2') AS TRTM_EXAMR_NM2
                         , F_USR_INFO(MAX(DECODE(TEAM_SNO, 3, TRTM_EXAMR_CNB)), '2') AS TRTM_EXAMR_NM3
                         , F_USR_INFO(MAX(DECODE(TEAM_SNO, 4, TRTM_EXAMR_CNB)), '2') AS TRTM_EXAMR_NM4
                         , F_USR_INFO(MAX(DECODE(TEAM_SNO, 5, TRTM_EXAMR_CNB)), '2') AS TRTM_EXAMR_NM5
                      FROM TBBADDED124M
                     GROUP BY DTB_SNO, TEAM_DVSN
                   )
              GROUP BY DTB_SNO
              ORDER BY DTB_SNO DESC
            ]]>
        <include refid="include.pageOrder" />
    </select>
    
    <select id="selectMaxDtbSno" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.arp.dao.AEPARP008PMapper.selectMaxDtbSno */
        <![CDATA[
            SELECT NVL(MAX(DTB_SNO), 0) + 1 AS DTB_SNO
              FROM TBBADDED124M
            ]]>
    </select>
    
    <update id="insertChgrChgHst" parameterType="paramMap">
        /* kr.go.bai.eip.aep.arp.dao.AEPARP008PMapper.insertChgrChgHst */
        <![CDATA[
            INSERT 
              INTO TBBADDED124M
                   (
                    DTB_SNO 
                  , TRTM_EXAMR_CNB
                  , DTB_MDF_DH
                  , DTB_MDF_CNB
                  , TEAM_DVSN
                  , TEAM_SNO
                  , FRT_USR_ID
                  , FNL_USR_ID
                  , FNL_DEAL_DPT_CD
                  , FNL_MNU_ID
                  , FRT_REGI_DH
                  , FNL_MDF_DH
                   )
            VALUES (
                    #{dtbSno}
                  , #{trtmExamrCnb}
                  , SYSDATE
                  , #{dtbMdfCnb}
                  , #{teamDvsn}
                  , #{teamSno}
                  , #{usrId}
                  , #{usrId}
                  , #{dptCd}
                  , #{mnuId}
                  , SYSDATE
                  , SYSDATE
                   )
        ]]>
    </update>
</mapper> 
