<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.bai.eip.aep.cam.dao.AEPCAM012PMapper">
    
    <select id="selectMainList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cam.dao.AEPCAM012PMapper.selectMainList*/
           select 
                NVL(F_CODE_NM('1000348', APVR_STA_CD), SUBSTR(F_CODE_NM('1000350', APVR_KND_CD), 1, 2) ||'대기') AS APVR_STA_NM,
                F_DPT_INFO(APVR_DPT_CD, '1') AS DPT_NM,
                NVL(F_CODE_NM('1000176', APVR_PST_CD), F_CODE_NM('1000173', APVR_RANK_CD)) AS PST_NM ,
                F_USR_INFO(APVR_CNB, '2') AS APVR_NM ,
                TO_CHAR(APV_DH, 'YYYY-MM-DD HH24:MI') AS APV_DH
           from TBDCMACM023l 
           where APV_DOC_NO = #{apvRqsId}
           order by APVR_SEQ desc
    </select>
    
    
    <select id="selectMainForm" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cam.dao.AEPCAM012PMapper.selectMainForm*/
          SELECT B.AUD_SBJ_NM, AGGR_CONCAT(A.RPRT_NM, ', ') AS RPRT_NM, APV_TIT_NM
           FROM TBBADDED103M A 
           INNER JOIN TBBADDED001M B ON (B.AUD_YR = A.AUD_YR AND B.AUD_NO = A.AUD_NO)
           INNER JOIN TBDCMACM022L C ON (C.APV_DOC_NO = A.APV_RQS_ID AND C.APV_DVSN_CD = 'fieldAudit')
           WHERE A.APV_RQS_ID = #{apvRqsId}
           GROUP BY B.AUD_SBJ_NM, APV_TIT_NM
           UNION ALL
           SELECT B.TIT_NM AS AUD_SBJ_NM, AGGR_CONCAT(A.RPRT_NM, ', ') AS RPRT_NM, APV_TIT_NM
           FROM TBBADFRE103M A 
           LEFT OUTER JOIN TBBADFRE012M B ON (B.ACP_YR = A.ACP_YR AND B.ACP_DVSN_CD = A.ACP_DVSN_CD AND B.ACP_SRNO = A.ACP_SRNO)
           LEFT OUTER JOIN TBDCMACM022L C ON (C.APV_DOC_NO = A.APV_RQS_ID AND C.APV_DVSN_CD IN ('requestAudit5','requestAudit6'))
           WHERE A.APV_RQS_ID = #{apvRqsId}
           GROUP BY B.TIT_NM, APV_TIT_NM
    </select>
</mapper> 