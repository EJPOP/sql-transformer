<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.pln.dao.AEPPLN002PMapper">

    <!-- 과별 감사계획목록 조회 -->
    <select id="selectAudExecPlanListByDptCd" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.pln.dao.AEPPLN002PMapper.selectAudExecPlanListByDptCd */
        <![CDATA[
            SELECT 
			       F_DPT_INFO(A.DPT_CD, 4) AS DPT_NM
			      ,A.AUD_SBJ_NM AS AUD_PLAN_SBJ_NM
			      ,F_CODE_NM('1000739', A.AUD_KND_CD) AS AUD_KND_NM
			      ,F_USR_INFO_BY_ID(A.FRT_USR_ID,'2') AS WRIT_NM
			      ,F_MNG_KND_AUDYRNO(A.MPP_AUD_YR, A.MPP_AUD_NO, A.AUD_KND_CD, '-') AS AUD_YR_NO
			      ,B.AUD_SBJ_NM
			      ,DECODE(A.MPP_AUD_YN,'Y','연결','미연결') AS MPP_AUD_YN_NM
			      ,A.AUD_PLAN_YR
			      ,A.DPT_CD
			      ,A.AUD_PLAN_SNO
			      ,A.AUD_KND_CD
			      ,A.MPP_AUD_YR
			      ,A.MPP_AUD_NO
			      ,A.MPP_AUD_YN
			  FROM TBBADDED128M A
			      ,TBBADDED001M B
			 WHERE 1=1
			   AND A.MPP_AUD_YR = B.AUD_YR(+)
			   AND A.MPP_AUD_NO = B.AUD_NO(+)
			   AND A.AUD_PLAN_YR = #{srhAudPlanYr}
			   AND A.DPT_CD = #{dptCd}
			 ORDER BY A.DPT_CD,A.AUD_PLAN_SNO
        ]]>
    </select>

	<update id="updateMppAudInfo" parameterType="paramMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN002PMapper.updateMppAudInfo */
        <![CDATA[
        	UPDATE TBBADDED128M
			   SET MPP_AUD_YR 	= #{mppAudYr}
			     , MPP_AUD_NO 	= #{mppAudNo}
			     , MPP_AUD_YN 	= #{mppAudYn}
			 WHERE AUD_PLAN_YR 	= #{audPlanYr}
			   AND DPT_CD 		= #{dptCd}
			   AND AUD_PLAN_SNO = #{audPlanSno}
        ]]>
	</update>
	
	<update id="deleteMppaudInfo" parameterType="paramMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN002PMapper.deleteMppaudInfo */
        <![CDATA[
			UPDATE TBBADDED128M
			   SET MPP_AUD_YR = NULL
			     , MPP_AUD_NO = NULL
			     , MPP_AUD_YN = NULL
			 WHERE MPP_AUD_YR = #{mppAudYr}
			   AND MPP_AUD_NO = #{mppAudNo}
        ]]>
	</update>
</mapper>