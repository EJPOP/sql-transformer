<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.asb.dao.AEPASB009PMapper">

    <update id="updateRcptDoc" parameterType="paramMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB009PMapper.updateRcptDoc */
		<![CDATA[
		UPDATE	TBAEPASB100M
			SET		STAT_CD = 'RCPT'
					,RCPT_USR_CD = #{rcptUsrCd}
   					,RCPT_DT = #{rcptDt}
			WHERE	AUD_YR = #{audYr}
			AND		AUD_NO	= #{audNo}
			AND TASK_CD = 'ASB001'
            AND DOC_CD = #{docCd}
		]]>
    </update>

    <select id="selectRcptDoc" 
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB009PMapper.selectRcptDoc */
        <![CDATA[
            SELECT 
                AUD_YR,
                AUD_NO,
                TASK_CD,
                DOC_CD,
                CASE 
                    WHEN DOC_CD = 'AUD_REPORT' THEN '감사보고서'
                    WHEN DOC_CD = 'DCS_REPORT' THEN '부의안'
                END DOC_NM,
                DOC_SNO,
                STAT_CD,
                CASE
                    WHEN STAT_CD = 'SEND' THEN '송신'
                    WHEN STAT_CD = 'RCPT' THEN '접수'
                END STAT_NM,
                SEND_USR_CD,
                F_USR_INFO(SEND_USR_CD,'2') AS SEND_USR_NM,
                SEND_DT,
                RCPT_USR_CD,
                F_USR_INFO(RCPT_USR_CD,'2') AS RCPT_USR_NM,
                RCPT_DT,
                RCPT_DPT_CD,
                CANCEL_YN
            FROM TBAEPASB100M
            WHERE
                AUD_YR = #{audYr}
            AND AUD_NO = #{audNo}
            AND TASK_CD = 'ASB001'
            AND DOC_CD = #{docId}
        ]]>
    </select>

<insert id="insertSendDoc">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB001EMapper.insertSendDoc */
        <![CDATA[
        INSERT INTO TBAEPASB100M(
                                AUD_YR,
                                 AUD_NO,
                                 TASK_CD,
                                 DOC_CD,
                                 DOC_SNO,
                                 STAT_CD,
                                 SEND_USR_CD,
                                 SEND_DT,
                                 CANCEL_YN
                                 )
                          VALUES(#{audYr},
                                 #{audNo},
                                 #{taskCd},
                                 #{docCd},
                                 (SELECT 
                                    LPAD(NVL(MAX(TO_NUMBER(DOC_SNO)),0)+1,3,0) 
                                 FROM TBAEPASB100M 
                                 WHERE 
                                        AUD_YR = #{audYr} 
                                 AND AUD_NO =#{audNo}
                                 AND    TASK_CD = #{taskCd}
                                 AND    DOC_CD = #{docCd} ),
                                 'SEND',
                                 #{sendUsrCd},
                                 #{sendDt},
                                 'N')
        ]]>
    </insert>
</mapper> 
