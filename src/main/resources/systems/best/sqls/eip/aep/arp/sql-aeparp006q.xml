<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.arp.dao.AEPARP006QMapper">
    
    <select id="selectMainList1" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.arp.dao.AEPARP006QMapper.selectMainList1*/
        <include refid="include.pageSelct" />
			<![CDATA[
			SELECT A.AUD_YR         --감사연도
			      ,A.AUD_NO         --감사번호
			      ,A.DOC_ID         --문서ID
			      ,F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-') AS AUD_YR_NO    --분류번호
			      ,TO_CHAR(B.RCPT_DH,'YY-MM-DD') AS RCPT_DH        --접수일
			      ,(SELECT S1.TEAM_DVSN || '팀' AS TEAM_DVSN
			          FROM TBBADDED124M S1
			         WHERE S1.DTB_SNO = (SELECT MAX(S2.DTB_SNO) FROM TBBADDED124M S2 WHERE S2.DTB_MDF_DH < B.RCPT_DH)
			           AND S1.TRTM_EXAMR_CNB = A.REF_ID
			       ) AS TEAM_DVSN   --팀구분
			       ,((SELECT T1.USR_NAM
						FROM TBDCMACM001M T1
						WHERE T1.CNB = A.REF_ID
						  AND ROWNUM = 1)||DECODE(C.TRTM_EXAMER_CNT,1,'','등'||C.TRTM_EXAMER_CNT)) AS TRTM_LEADER_EXAMER_NM    --조정관
			      ,C.SBCN_CNT + C.DLG_CNT AS SBCN_TOT_CNT   --전체
			      ,C.SBCN_CNT       --부의
			      ,C.DLG_CNT        --위임
			      ,DECODE(A.AUD_RPRT_DVSN_CD,'10','',(SELECT T1.CD_NM
														 FROM TBDCMACM013C T1
														WHERE T1.CMM_CD_DVSN_CD = '1000788'
														  AND T1.CD = A.AUD_RPRT_DVSN_CD
														  AND ROWNUM = 1)) AS AUD_RPRT_DVSN_NM   --보고서구분
			      ,D.AUD_SBJ_NM     --감사명
			      ,(SELECT S3.DPT_NM
			          FROM TBDCMACM002M S3
			         WHERE S3.DPT_CD = D.SPV_BRDV_CD) AS AUD_DPT_FULL_NM        --주관국과명
			      ,DECODE(A.SYT_TRTM_DVSN_YN,'Y','종합','') AS SYT_TRTM_DVSN_YN --처리안구분
			      , (SELECT T1.CD_NM
						 FROM TBDCMACM013C T1
						WHERE T1.CMM_CD_DVSN_CD = '1000007'
						  AND T1.CD = D.AUD_KND_CD
						  AND ROWNUM = 1) AS AUD_KND_NM              --감사분류	  
			      ,(SELECT (SELECT T1.CD_NM
								 FROM TBDCMACM013C T1
								WHERE T1.CMM_CD_DVSN_CD = '1000742'
								  AND T1.CD = S4.DVSN_CD
								  AND ROWNUM = 1) 
						FROM TBBADDED030L S4
				         WHERE S4.AUD_YR = D.AUD_YR
				           AND S4.AUD_NO = D.AUD_NO
				           AND S4.SRNO = 1) AS AUD_KND_CD2                          --종류코드2(1:민원2:국민3:공익4:국회5:심사6:재심8:손망9:판청)
			      ,DECODE(E.COL1, '0', '-', E.COL1) AS COL1
			      ,DECODE(E.COL2, '0', '-', E.COL2) AS COL2
			      ,DECODE(E.COL3, '0', '-', E.COL3) AS COL3
			      ,DECODE(E.COL4, '0', '-', E.COL4) AS COL4
			      ,DECODE(E.COL5, '0', '-', E.COL5) AS COL5
			      ,DECODE(E.COL6, '0', '-', E.COL6) AS COL6
			      ,DECODE(E.COL7, '0', '-', E.COL7) AS COL7
			      ,DECODE(E.COL8, '0', '-', E.COL8) AS COL8
			      ,DECODE(E.COL9, '0', '-', E.COL9) AS COL9
			      ,DECODE(E.COL10, '0', '-', E.COL10) AS COL10
			      ,DECODE(E.COL11, '0', '-', E.COL11) AS COL11
			      ,DECODE(E.COL12, '0', '-', E.COL12) AS COL12
			      ,DECODE(E.COL13, '0', '-', E.COL13) AS COL13
			      ,DECODE(E.COL14, '0', '-', E.COL14) AS COL14
			      ,DECODE(E.COL15, '0', '-', E.COL15) AS COL15
			      ,DECODE(E.COL16, '0', '-', E.COL16) AS COL16
			 ]]>
			 <if test="selectCol != null and selectCol != ''">
                 ${selectCol}
             </if>
             <![CDATA[
			  FROM TBBADDED103M A --문서함
			      ,TBBADDED111M B --송수신문서함
			      ,(SELECT T1.AUD_YR
			              ,T1.AUD_NO
			              ,T1.DOC_ID
			              ,SUM(DECODE(T1.REFER_DVSN_CD,'D10',1,0)) AS SBCN_CNT
			              ,SUM(DECODE(T1.REFER_DVSN_CD,'E10',1,0)) AS DLG_CNT
			              ,COUNT(DISTINCT(T1.TRTM_EXAMER_CNB)) AS TRTM_EXAMER_CNT
			          FROM TBBADDED145M T1
			         WHERE T1.AUD_YR  = #{schAudYr} --PARAM
			           AND T1.APVR_CD = '0013600'
			        GROUP BY T1.AUD_YR,T1.AUD_NO,T1.DOC_ID
			       ) C --사건
			      ,TBBADDED001M D
			      ,(WITH TRTM_EXAMR_SNO AS (SELECT ROW_NUMBER() OVER (ORDER BY MAX(T2.DTB_SNO) DESC
			                                                                  ,T2.TEAM_DVSN
			                                                                  ,T2.TEAM_SNO
			                                                                  ,T2.TRTM_EXAMR_CNB) AS RN
			                                      ,MAX(T2.DTB_SNO)   AS DTB_SNO
			                                      ,T2.TEAM_DVSN      AS TEAM_DVSN
			                                      ,T2.TEAM_SNO       AS TEAM_SNO
			                                      ,T2.TRTM_EXAMR_CNB AS TRTM_EXAMR_CNB
			                                  FROM TBBADDED124M T2
			                                 WHERE 1=1
			                                 GROUP BY T2.TEAM_DVSN,T2.TEAM_SNO,T2.TRTM_EXAMR_CNB
			                               )
			        SELECT Z.AUD_YR
			              ,Z.AUD_NO
			              ,Z.DOC_ID
			              ,SUM(Z.COL1)  AS COL1
			              ,SUM(Z.COL2)  AS COL2
			              ,SUM(Z.COL3)  AS COL3
			              ,SUM(Z.COL4)  AS COL4
			              ,SUM(Z.COL5)  AS COL5
			              ,SUM(Z.COL6)  AS COL6
			              ,SUM(Z.COL7)  AS COL7
			              ,SUM(Z.COL8)  AS COL8
			              ,SUM(Z.COL9)  AS COL9
			              ,SUM(Z.COL10) AS COL10
			              ,SUM(Z.COL11) AS COL11
			              ,SUM(Z.COL12) AS COL12
			              ,SUM(Z.COL13) AS COL13
			              ,SUM(Z.COL14) AS COL14
			              ,SUM(Z.COL15) AS COL15
			              ,SUM(Z.COL16) AS COL16
			          FROM (SELECT T3.AUD_YR
			                      ,T3.AUD_NO
			                      ,T3.DOC_ID
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 1)  THEN COUNT(*) ELSE 0 END AS COL1
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 2)  THEN COUNT(*) ELSE 0 END AS COL2
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 3)  THEN COUNT(*) ELSE 0 END AS COL3
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 4)  THEN COUNT(*) ELSE 0 END AS COL4
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 5)  THEN COUNT(*) ELSE 0 END AS COL5
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 6)  THEN COUNT(*) ELSE 0 END AS COL6
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 7)  THEN COUNT(*) ELSE 0 END AS COL7
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 8)  THEN COUNT(*) ELSE 0 END AS COL8
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 9)  THEN COUNT(*) ELSE 0 END AS COL9
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 10) THEN COUNT(*) ELSE 0 END AS COL10
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 11) THEN COUNT(*) ELSE 0 END AS COL11
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 12) THEN COUNT(*) ELSE 0 END AS COL12
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 13) THEN COUNT(*) ELSE 0 END AS COL13
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 14) THEN COUNT(*) ELSE 0 END AS COL14
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 15) THEN COUNT(*) ELSE 0 END AS COL15
			                      ,CASE WHEN T3.TRTM_EXAMER_CNB = (SELECT TRTM_EXAMR_CNB FROM TRTM_EXAMR_SNO WHERE RN = 16) THEN COUNT(*) ELSE 0 END AS COL16
			                  FROM TBBADDED145M T3
			                 WHERE T3.AUD_YR  = #{schAudYr} --PARAM
			                   AND T3.APVR_CD = '0013600'
			                   AND T3.TRTM_EXAMER_CNB IS NOT NULL
			                 GROUP BY T3.AUD_YR,T3.AUD_NO,T3.DOC_ID,T3.TRTM_EXAMER_CNB
			                 ORDER BY T3.AUD_YR,T3.AUD_NO,T3.DOC_ID,T3.TRTM_EXAMER_CNB
			               ) Z
			         GROUP BY Z.AUD_YR,Z.AUD_NO,Z.DOC_ID
			       ) E
			 WHERE 1=1
			   AND A.AUD_YR      = #{schAudYr} --PARAM
			   AND A.AUD_YR      = B.AUD_YR
			   AND A.AUD_NO      = B.AUD_NO
			   AND A.AUD_STEP_CD = B.AUD_STEP_CD
			   AND A.DOC_ID      = B.DOC_ID
			   AND B.RPRT_CD     = 'A10600200' --감사보고서
			   AND B.RCPT_DPT_CD = '160200'    --수신부서:품질부서
			   AND A.AUD_YR      = C.AUD_YR
			   AND A.AUD_NO      = C.AUD_NO
			   AND A.DOC_ID      = C.DOC_ID
			   AND A.AUD_YR      = D.AUD_YR
			   AND A.AUD_NO      = D.AUD_NO
			]]>
			<if test="schAudSbjNm != null and schAudSbjNm != ''">
			   AND D.AUD_SBJ_NM LIKE '%'||#{schAudSbjNm}||'%'
			</if>
			<![CDATA[  
			   AND A.AUD_YR      = E.AUD_YR(+)
			   AND A.AUD_NO      = E.AUD_NO(+)
			   AND A.DOC_ID      = E.DOC_ID(+)
			 ORDER BY B.RCPT_DH
			]]>
       <include refid="include.pageOrder" />
    </select>
    
    <select id="selectMainList2" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.arp.dao.AEPARP006QMapper.selectMainList2*/
        <include refid="include.pageSelct" />
        <![CDATA[
		SELECT ROWNUM
		      ,AUD_YR_NO
		      ,AUD_DPT_FULL_NM
		      ,AUD_SBJ_NM
		      ,RCPT_DH
		      ,SBCN_CNT
		      ,DLG_CNT
		      ,SBCN_TOT_CNT
		      ,TRTM_LEADER_EXAMER_NM
		      ,AUD_YR_NO2
		      ,AUD_DPT_FULL_NM2
		      ,AUD_SBJ_NM2
		      ,RCPT_DH2
		      ,SBCN_CNT2
		      ,DLG_CNT2
		      ,SBCN_TOT_CNT2
		      ,TRTM_LEADER_EXAMER_NM2
		FROM(
			SELECT TM1.AUD_YR_NO                --분류번호
			      ,TM1.AUD_DPT_FULL_NM          --국과
			      ,TM1.AUD_SBJ_NM               --감사명
			      ,TO_CHAR(TM1.RCPT_DH,'YYYY.MM.DD') AS RCPT_DH       --접수일
			      ,TM1.SBCN_CNT                 --부의
			      ,TM1.DLG_CNT                  --위임
			      ,TM1.SBCN_TOT_CNT             --전체
			      ,TM1.TRTM_LEADER_EXAMER_NM    --담당자
			      ,TM2.AUD_YR_NO    AS AUD_YR_NO2               				--분류번호2
			      ,TM2.AUD_DPT_FULL_NM    AS AUD_DPT_FULL_NM2          			--국과2
			      ,TM2.AUD_SBJ_NM    AS AUD_SBJ_NM2               				--감사명2
			      ,TO_CHAR(TM2.RCPT_DH,'YYYY.MM.DD') AS RCPT_DH2                --접수일2
			      ,TM2.SBCN_CNT    AS SBCN_CNT2                 				--부의2
			      ,TM2.DLG_CNT    AS DLG_CNT2                  					--위임2
			      ,TM2.SBCN_TOT_CNT    AS SBCN_TOT_CNT2             			--전체2
			      ,TM2.TRTM_LEADER_EXAMER_NM    AS TRTM_LEADER_EXAMER_NM2    	--담당자2
			  FROM (
			        SELECT ROW_NUMBER() OVER (ORDER BY B.RCPT_DH) AS RN
			              ,A.AUD_YR         --감사연도
			              ,A.AUD_NO         --감사번호
			              ,A.DOC_ID         --문서ID
			              ,F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-') AS AUD_YR_NO    --분류번호
			              ,B.RCPT_DH        --접수일
			              ,(SELECT S1.TEAM_DVSN AS TEAM_DVSN
			                  FROM TBBADDED124M S1
			                 WHERE S1.DTB_SNO = (SELECT MAX(S2.DTB_SNO) FROM TBBADDED124M S2 WHERE S2.DTB_MDF_DH < B.RCPT_DH)
			                   AND S1.TRTM_EXAMR_CNB = A.REF_ID
			               ) AS TEAM_DVSN   --팀구분
			              ,F_USR_INFO(A.REF_ID,'2')||DECODE(C.TRTM_EXAMER_CNT,1,'','등'||C.TRTM_EXAMER_CNT) AS TRTM_LEADER_EXAMER_NM    --조정관
			              ,C.SBCN_CNT + C.DLG_CNT AS SBCN_TOT_CNT   --전체
			              ,C.SBCN_CNT       --부의
			              ,C.DLG_CNT        --위임
			              ,DECODE(A.AUD_RPRT_DVSN_CD,'10','',F_CODE_NM('1000788',A.AUD_RPRT_DVSN_CD)) AS AUD_RPRT_DVSN_NM   --보고서구분
			              ,D.AUD_SBJ_NM     --감사명
			              ,(SELECT S3.DPT_NM
			                  FROM TBDCMACM002M S3
			                 WHERE S3.DPT_CD = D.SPV_BRDV_CD) AS AUD_DPT_FULL_NM        --주관국과명
			              ,DECODE(A.SYT_TRTM_DVSN_YN,'Y','종합','') AS SYT_TRTM_DVSN_YN --처리안구분
			              ,F_CODE_NM('1000007',D.AUD_KND_CD) AS AUD_KND_NM              --감사분류
			              ,(SELECT F_CODE_NM('1000742', S4.DVSN_CD) FROM TBBADDED030L S4
			                 WHERE S4.AUD_YR = D.AUD_YR
			                   AND S4.AUD_NO = D.AUD_NO
			                   AND S4.SRNO = 1) AS AUD_KND_CD2                          --종류코드2(1:민원2:국민3:공익4:국회5:심사6:재심8:손망9:판청)
			          FROM TBBADDED103M A --문서함
			              ,TBBADDED111M B --송수신문서함
			              ,(SELECT T1.AUD_YR
			                      ,T1.AUD_NO
			                      ,T1.DOC_ID
			                      ,SUM(DECODE(T1.REFER_DVSN_CD,'D10',1,0)) AS SBCN_CNT
			                      ,SUM(DECODE(T1.REFER_DVSN_CD,'E10',1,0)) AS DLG_CNT
			                      ,COUNT(DISTINCT(T1.TRTM_EXAMER_CNB)) AS TRTM_EXAMER_CNT
			                  FROM TBBADDED145M T1
			                 WHERE T1.AUD_YR  = #{schAudYr} --PARAM
			                   AND T1.APVR_CD = '0013600'
			                GROUP BY T1.AUD_YR,T1.AUD_NO,T1.DOC_ID
			               ) C --사건
			              ,TBBADDED001M D
			         WHERE 1=1
			           AND A.AUD_YR      = #{schAudYr} --PARAM
			           AND A.AUD_YR      = B.AUD_YR
			           AND A.AUD_NO      = B.AUD_NO
			           AND A.AUD_STEP_CD = B.AUD_STEP_CD
			           AND A.DOC_ID      = B.DOC_ID
			           AND B.RPRT_CD     = 'A10600200' --감사보고서
			           AND B.RCPT_DPT_CD = '160200'    --수신부서:품질부서
			           AND A.AUD_YR      = C.AUD_YR
			           AND A.AUD_NO      = C.AUD_NO
			           AND A.DOC_ID      = C.DOC_ID
			           AND A.AUD_YR      = D.AUD_YR
			           AND A.AUD_NO      = D.AUD_NO
			           AND (SELECT S1.TEAM_DVSN AS TEAM_DVSN
			                  FROM TBBADDED124M S1
			                 WHERE S1.DTB_SNO = (SELECT MAX(S2.DTB_SNO) FROM TBBADDED124M S2 WHERE S2.DTB_MDF_DH < B.RCPT_DH)
			                   AND S1.TRTM_EXAMR_CNB = A.REF_ID
			               )             = '1'           	
			         ORDER BY B.RCPT_DH
			       ) TM1
			      ,(
			        SELECT ROW_NUMBER() OVER (ORDER BY B.RCPT_DH) AS RN
			              ,A.AUD_YR         --감사연도
			              ,A.AUD_NO         --감사번호
			              ,A.DOC_ID         --문서ID
			              ,F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-') AS AUD_YR_NO    --분류번호
			              ,B.RCPT_DH        --접수일
			              ,(SELECT S1.TEAM_DVSN AS TEAM_DVSN
			                  FROM TBBADDED124M S1
			                 WHERE S1.DTB_SNO = (SELECT MAX(S2.DTB_SNO) FROM TBBADDED124M S2 WHERE S2.DTB_MDF_DH < B.RCPT_DH)
			                   AND S1.TRTM_EXAMR_CNB = A.REF_ID
			               ) AS TEAM_DVSN   --팀구분
			              ,F_USR_INFO(A.REF_ID,'2')||DECODE(C.TRTM_EXAMER_CNT,1,'','등'||C.TRTM_EXAMER_CNT) AS TRTM_LEADER_EXAMER_NM    --조정관
			              ,C.SBCN_CNT + C.DLG_CNT AS SBCN_TOT_CNT   --전체
			              ,C.SBCN_CNT       --부의
			              ,C.DLG_CNT        --위임
			              ,DECODE(A.AUD_RPRT_DVSN_CD,'10','',F_CODE_NM('1000788',A.AUD_RPRT_DVSN_CD)) AS AUD_RPRT_DVSN_NM   --보고서구분
			              ,D.AUD_SBJ_NM     --감사명
			              ,(SELECT S3.DPT_NM
			                  FROM TBDCMACM002M S3
			                 WHERE S3.DPT_CD = D.SPV_BRDV_CD) AS AUD_DPT_FULL_NM        --주관국과명
			              ,DECODE(A.SYT_TRTM_DVSN_YN,'Y','종합','') AS SYT_TRTM_DVSN_YN --처리안구분
			              ,F_CODE_NM('1000007',D.AUD_KND_CD) AS AUD_KND_NM              --감사분류
			              ,(SELECT F_CODE_NM('1000742', S4.DVSN_CD) FROM TBBADDED030L S4
			                 WHERE S4.AUD_YR = D.AUD_YR
			                   AND S4.AUD_NO = D.AUD_NO
			                   AND S4.SRNO = 1) AS AUD_KND_CD2                          --종류코드2(1:민원2:국민3:공익4:국회5:심사6:재심8:손망9:판청)
			          FROM TBBADDED103M A --문서함
			              ,TBBADDED111M B --송수신문서함
			              ,(SELECT T1.AUD_YR
			                      ,T1.AUD_NO
			                      ,T1.DOC_ID
			                      ,SUM(DECODE(T1.REFER_DVSN_CD,'D10',1,0)) AS SBCN_CNT
			                      ,SUM(DECODE(T1.REFER_DVSN_CD,'E10',1,0)) AS DLG_CNT
			                      ,COUNT(DISTINCT(T1.TRTM_EXAMER_CNB)) AS TRTM_EXAMER_CNT
			                  FROM TBBADDED145M T1
			                 WHERE T1.AUD_YR  = #{schAudYr} --PARAM
			                   AND T1.APVR_CD = '0013600'
			                GROUP BY T1.AUD_YR,T1.AUD_NO,T1.DOC_ID
			               ) C --사건
			              ,TBBADDED001M D
			         WHERE 1=1
			           AND A.AUD_YR      = #{schAudYr} --PARAM
			           AND A.AUD_YR      = B.AUD_YR
			           AND A.AUD_NO      = B.AUD_NO
			           AND A.AUD_STEP_CD = B.AUD_STEP_CD
			           AND A.DOC_ID      = B.DOC_ID
			           AND B.RPRT_CD     = 'A10600200' --감사보고서
			           AND B.RCPT_DPT_CD = '160200'    --수신부서:품질부서
			           AND A.AUD_YR      = C.AUD_YR
			           AND A.AUD_NO      = C.AUD_NO
			           AND A.DOC_ID      = C.DOC_ID
			           AND A.AUD_YR      = D.AUD_YR
			           AND A.AUD_NO      = D.AUD_NO
			           AND (SELECT S1.TEAM_DVSN AS TEAM_DVSN
			                  FROM TBBADDED124M S1
			                 WHERE S1.DTB_SNO = (SELECT MAX(S2.DTB_SNO) FROM TBBADDED124M S2 WHERE S2.DTB_MDF_DH < B.RCPT_DH)
			                   AND S1.TRTM_EXAMR_CNB = A.REF_ID
			               )             = '2'			               
			         ORDER BY B.RCPT_DH
			       ) TM2
			]]>
		<if test="team1 != null and team1 != '' and team2 != null and team2 != ''">
			<if test= "team1 == team2 " >
				 WHERE TM1.RN = TM2.RN
			</if>
			<if test= "team1 gt team2 " >
				 WHERE TM1.RN(+) = TM2.RN
			</if>
			<if test= "team1 lt team2 " >
				 WHERE TM1.RN = TM2.RN(+)
			</if>
		</if>
	   	<if test="schAudSbjNm != null and schAudSbjNm != ''">
             		AND (TM1.AUD_SBJ_NM LIKE '%'||#{schAudSbjNm}||'%' or TM2.AUD_SBJ_NM LIKE '%'||#{schAudSbjNm}||'%')
        </if>
        )LTB		
        <include refid="include.pageOrder" />
    </select>
       
    <select id="selectTrtmExamerList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.arp.dao.AEPARP006QMapper.selectTrtmExamerList*/
		SELECT ROW_NUMBER() OVER (ORDER BY MAX(T2.DTB_SNO) DESC
		                                  ,T2.TEAM_DVSN
		                                  ,T2.TEAM_SNO
		                                  ,T2.TRTM_EXAMR_CNB) AS RN
		      ,MAX(T2.DTB_SNO)   AS DTB_SNO
		      ,T2.TEAM_DVSN      AS TEAM_DVSN
		      ,T2.TEAM_SNO       AS TEAM_SNO
		      ,T2.TRTM_EXAMR_CNB AS CNB
		      ,(SELECT T1.USR_NAM
					FROM TBDCMACM001M T1
					WHERE T1.CNB = T2.TRTM_EXAMR_CNB
					  AND ROWNUM = 1) AS TRTM_EXAMR_NAME
		  FROM TBBADDED124M T2
		 WHERE 1=1
		 GROUP BY T2.TEAM_DVSN,T2.TEAM_SNO,T2.TRTM_EXAMR_CNB
    </select>
    
    <select id="selectTeamCompareList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.arp.dao.AEPARP006QMapper.selectTeamCompareList*/
    <![CDATA[
	SELECT NVL(SUM(DECODE((SELECT S1.TEAM_DVSN AS TEAM_DVSN
	                     FROM TBBADDED124M S1
	                    WHERE S1.DTB_SNO = (SELECT MAX(S2.DTB_SNO) FROM TBBADDED124M S2 WHERE S2.DTB_MDF_DH < B.RCPT_DH)
	                      AND S1.TRTM_EXAMR_CNB = A.REF_ID
	                   ),'1',1,0)
	          ),0) AS TM1 --1팀
	      ,NVL(SUM(DECODE((SELECT S1.TEAM_DVSN AS TEAM_DVSN
	                     FROM TBBADDED124M S1
	                    WHERE S1.DTB_SNO = (SELECT MAX(S2.DTB_SNO) FROM TBBADDED124M S2 WHERE S2.DTB_MDF_DH < B.RCPT_DH)
	                      AND S1.TRTM_EXAMR_CNB = A.REF_ID
	                   ),'2',1,0)
	          ),0) AS TM2 --2팀
	  FROM TBBADDED103M A --문서함
	      ,TBBADDED111M B --송수신문서함
	 WHERE 1=1
	   AND A.AUD_YR      = #{schAudYr} --PARAM
	   AND A.AUD_YR      = B.AUD_YR
	   AND A.AUD_NO      = B.AUD_NO
	   AND A.AUD_STEP_CD = B.AUD_STEP_CD
	   AND A.DOC_ID      = B.DOC_ID
	   AND B.RPRT_CD     = 'A10600200' --감사보고서
	   AND B.RCPT_DPT_CD = '160200'    --수신부서:품질부서
	 ORDER BY B.RCPT_DH
	 ]]>
    </select>    

</mapper>