<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.ewm.dao.AEPEWM010EMapper">
	
	<!-- 소송관리 처분종류 조건 조회  BADFRE010ESrchOption-->
	<select id="srchDspRqKndNmOption" parameterType="paramMap" resultType="egovMap" >
		<![CDATA[ 
		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM010EMapper.srchDspRqKndNmOption */
			SELECT CD,CD_NM 
				FROM TBDCMACM013C 
				WHERE 1=1
				 AND CMM_CD_DVSN_CD='1000002' 
				 AND USE_YN='Y' 
				 AND CD != '000000000'
	    ]]>
	</select>
	
	<!-- 소송관리 조회  BADFRE010ESelectLiGaList-->
	<select id="selectLiGaList" parameterType="paramMap" resultType="egovMap" >
		<include refid="include.pageSelct" />
	<![CDATA[ 
	
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM010EMapper.selectLiGaList */
			      SELECT T1.AUD_YR                                    AS AUD_YR       
                  ,T1.AUD_NO                                    AS AUD_NO       
                  ,T1.DSP_RQ_SNO                                AS DSP_RQ_SNO   
                  ,F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, '', '-') ||'-'|| T1.DSP_RQ_SNO     
                                                                AS AUD_YR_NO     
                  ,T2.ENF_DT                                    AS ENF_DT        
                  ,F_DPT_INFO(T4.MNG_DPT_CD,'1' )               AS MNG_DPT_NM    
                  ,F_CODE_NM('1000007',T4.AUD_KND_CD)           AS AUD_KND_NM    
                  ,T4.AUD_SBJ_NM                                AS AUD_SBJ_NM    
                  ,T1.TIT_TXT                                   AS TIT_TXT           
                  ,F_CODE_NM('1000002',T1.DSP_RQ_KND_CD)        AS DSP_RQ_KND_NM 
                  ,F_ORG_INFO(T2.COPT_OFI_CD,'1')               AS COPT_OFI_NM   
                  ,T3.LWS_PRSS_CD                               AS LWS_PRSS_CD   
                  ,T3.LWS_RSLT_CD                               AS LWS_RSLT_CD   
                  ,T3.LOSE_RSN                                  AS LOSE_RSN      
                  
                  ,T4.AUD_KND_CD                                AS AUD_KND_CD   
              FROM TBBADEAR001M T1  
                  ,TBBADEAR002D T2  
                  ,TBBADEAR038M T3 
                  ,TBBADDED001M T4  
              WHERE 1=1                                                            
                AND T1.AUD_YR     	= T2.AUD_YR                              
                AND T1.AUD_NO     	= T2.AUD_NO                               
                AND T1.DSP_RQ_SNO 	= T2.DSP_RQ_SNO   
                AND T2.AUD_YR     	= T3.AUD_YR(+) 
                AND T2.AUD_NO     	= T3.AUD_NO(+) 
                AND T2.DSP_RQ_SNO 	= T3.DSP_RQ_SNO(+) 
                AND T1.AUD_YR     	= T4.AUD_YR                                 
                AND T1.AUD_NO     	= T4.AUD_NO 
                ]]>
                <if test='audYr != null and audYr != ""'>
					<![CDATA[  		
			   		AND T1.AUD_YR       = #{audYr}
					]]>
				</if>
                <if test='schAudYrNoKndCd != null and schAudYrNoKndCd != ""'>
					<![CDATA[  		
			   		AND SUBSTR(T4.AUD_KND_CD,3,1) = SUBSTR(#{schAudYrNoKndCd},3,1)
					]]>
				</if>
				<if test='audNo != null and audNo != ""'>
			   		<![CDATA[ 
                	AND T4.AUD_GRN_NO   = #{audNo}
                	]]>
                </if>
                <if test='audSbjNm != null and audSbjNm != ""'>
			   		<![CDATA[ 
                	AND T4.AUD_SBJ_NM   LIKE '%' || #{audSbjNm} || '%'
                	]]>
                </if>
                <if test='titTxt != null and titTxt != ""'>
			   		<![CDATA[ 
                	AND T1.TIT_TXT      LIKE '%' || #{titTxt} || '%'
                	]]>
                </if>
                

                <if test='schSpvBrdvCd != null and schSpvBrdvCd != ""'>
			   		<![CDATA[ 
                	AND T4.MNG_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, #{dptAuth}, '', #{schSpvBrdvCd})))
                	]]>
                </if>
                <if test='schDeptCd != null and schDeptCd != ""'>
			   		<![CDATA[ 
                	AND T4.MNG_DPT_CD =#{schDeptCd}
                	]]>
                </if>

                <if test='lwsPrssCd != null and lwsPrssCd != ""'>
			   		<![CDATA[ 
                	AND T3.LWS_PRSS_CD   = #{lwsPrssCd}
                	]]>
                </if>
                <if test='dspRqKndNm != null and dspRqKndNm != ""'>
			   		<![CDATA[ 
                	AND T1.DSP_RQ_KND_CD = #{dspRqKndNm}
                	]]>
                </if>
                <if test='lwsRsltCd != null and lwsRsltCd != ""'>
			   		<![CDATA[ 
                	AND T3.LWS_RSLT_CD = #{lwsRsltCd}
                	]]>
                </if>
                
              ORDER BY T1.AUD_YR DESC
                      ,T1.AUD_NO
                      ,T1.DSP_RQ_SNO
		  <include refid="include.pageOrder" />
	</select>

	<select id="countLitiga" parameterType="paramMap" resultType="Integer" >
		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM010EMapper.selectLiGaList */
				        SELECT COUNT(*)
	              FROM 
	                
	                  TBBADEAR038M T3  /* 소송관리기본 */
	                 
	              WHERE 1=1                                                            
	                
	                
	                /* 분류번호 조건 */
	                AND AUD_YR       = #{audYr}
	                AND AUD_NO   =  #{audNo}
	                AND DSP_RQ_SNO =   #{dspRqSno}
	
	</select>
	
	<insert id="insertLitigaList" parameterType="paramMap">
   /*kr.go.bai.eip.aep.ewm.dao.AEPEWM010EMapper.insertHndlDdlnExlList*/
		INSERT INTO TBBADEAR038M
			(
				  AUD_YR 
				, AUD_NO  
				, DSP_RQ_SNO 
				, LWS_PRSS_CD 
				, LWS_RSLT_CD 
				, LOSE_RSN
				 
				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
			)
		VALUES( #{audYr}
			 , #{audNo}
			 , #{dspRqSno}
			 , #{lwsPrssCd}
			 , #{lwsRsltCd}
			 , #{loseRsn}
			 
			 , #{frtUsrId}
			 , #{fnlUsrId}
			 , #{fnlDealDptCd}
			 , #{fnlMnuId}
			 , SYSDATE
			 , SYSDATE     )
    </insert>
	
	<!--소송관리 저장  BADFRE010EUpdateLiGa -->
	<update id="updateLitigaList" parameterType="paramMap">
   /*kr.go.bai.eip.aep.ewm.dao.AEPEWM010EMapper.updateHndlDdlnList*/
		<if test='lwsPrssCd != null and lwsPrssCd != ""'>
			<![CDATA[ 
				UPDATE TBBADEAR038M
					SET LWS_PRSS_CD = #{lwsPrssCd}
				   , LWS_RSLT_CD = #{lwsRsltCd}
				   , LOSE_RSN	= #{loseRsn}
					
				WHERE 1=1
				AND	  AUD_YR = #{audYr}
				AND	  AUD_NO = #{audNo}
				AND	  DSP_RQ_SNO = #{dspRqSno}
    	    ]]>
		</if>
		<if test='lwsPrssCd == null or lwsPrssCd == ""'>
			<![CDATA[ 
				DELETE TBBADEAR038M
				WHERE 1=1
				AND   AUD_YR = #{audYr}
				AND	  AUD_NO = #{audNo}
				AND	  DSP_RQ_SNO = #{dspRqSno}
	        ]]>
		</if>
    </update>
</mapper> 
