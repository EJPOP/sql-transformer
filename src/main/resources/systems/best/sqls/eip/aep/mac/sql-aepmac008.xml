<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.mac.dao.AEPMAC008PMapper">
    <select id="selectCfmBztRfcList" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.aep.mac.dao.AEPMAC008PMapper.selectCfmBztRfcList */
        <![CDATA[
        SELECT F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-') AS AUD_YR_N0
                 , (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000751' AND CD = D1.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM
                 , D1.AUD_SBJ_NM
                 , (SELECT ORG_NM FROM TBDCMACM015M WHERE ORG_CD = D1.AUD_RPST_ORG_CD) AS AUD_RPST_ORG_NM
                 , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = D1.MNG_DPT_CD) AS MNG_DPT_NM
                 , (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000742' AND CD = D1.REQ_DVSN_CD)    AS REQ_DVSN_NM
                 , D2.AUD_YR
                 , D2.AUD_NO
                 , D2.AUD_STEP_CD 
                 , D2.REL_AUD_SNO
            FROM TBBADDED001M AS D1
                 INNER JOIN TBBADDED101L AS D2
                 ON (D1.AUD_YR = D2.REL_AUD_YR AND D1.AUD_NO = D2.REL_AUD_NO)
                 LEFT OUTER JOIN TBBADDED003M AS D3 ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO
           WHERE D2.AUD_YR = #{audYr}
             AND D2.AUD_NO = #{audNo}
             AND D2.AUD_STEP_CD =  #{audStepCd}
               ORDER BY D1.AUD_YR DESC, D1.AUD_KND_CD, D1.AUD_GRN_NO DESC
        ]]>
    </select>

    <insert id="insertCfmBztRfcList">
        /* kr.go.bai.eip.aep.mac.dao.AEPMAC008PMapper.insertCfmBztRfcList */
	<![CDATA[
	INSERT INTO TBBADDED101L(
            AUD_YR,
            AUD_NO,
            AUD_STEP_CD,
            REL_AUD_SNO,
            REL_AUD_YR,
            REL_AUD_NO,
            REL_AUD_STEP_CD,
            REGI_DH,
            REGI_CNB,
            FRT_USR_ID,
            FNL_USR_ID,
            FNL_DEAL_DPT_CD,
            FNL_MNU_ID,
            FRT_REGI_DH,
            FNL_MDF_DH 
            )
    VALUES(
    ]]>
    <if test='audStepCd == "A1010"'>
             #{audYr}
            , #{audNo}
            , #{audStepCd}
            , (SELECT NVL(MAX(REL_AUD_SNO),0)+1 
                 FROM TBBADDED101L
                WHERE AUD_YR = #{audYr}
                   AND AUD_NO = #{audNo}
                   AND AUD_STEP_CD = #{audStepCd})
            , #{relAudYr}
            , #{relAudNo}
            , 'A1019'
    </if>
    <if test='audStepCd == "A1030"'>
              #{relAudYr}
            , #{relAudNo}
            , #{audStepCd}
            , (SELECT NVL(MAX(REL_AUD_SNO),0)+1 
                 FROM TBBADDED101L
                WHERE AUD_YR = #{relAudYr}
                   AND AUD_NO = #{relAudNo}
                   AND AUD_STEP_CD = #{audStepCd})
            , #{audYr}
            , #{audNo}
            , 'A1019'
    </if>
    <![CDATA[
            , SYSDATE
            , #{cnb}
            , #{usrId}
            , #{usrId}
            , #{dptCd}
            , 'AEPMAC008P'
            , SYSDATE
            , SYSDATE
            )
		]]>
    </insert>

    <delete id="deleteCfmBztRfcList">
        /* kr.go.bai.eip.aep.mac.dao.AEPMAC008PMapper.deleteCfmBztRfcList */
    <![CDATA[
    DELETE TBBADDED101L
    WHERE 
        AUD_YR = #{audYr}
    AND AUD_NO =  #{audNo}
    AND AUD_STEP_CD =  #{audStepCd}
    AND REL_AUD_SNO =  #{relAudSno}
        ]]>
    </delete>

    <update id="updateNoExecRsnClear" parameterType="paramMap">
    /* kr.go.bai.eip.aep.mac.dao.AEPMAC008PMapper.updateNoExecRsnClear */
        UPDATE TBBADDED001M 
           SET MTRL_CLC_NO_EXEC_RSN  = ''
         WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
    </update>

    <update id="updateBADDED102M">
    /* kr.go.bai.eip.aep.mac.dao.AEPMAC008PMapper.updateBADDED102M */
        UPDATE TBBADDED102M 
           SET MAIN_JOB_NM  = #{mainJobNm}
         WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
    	   AND AUD_STEP_CD =  'A1010'
    	   AND AUD_MAIN_STEP_ID =  '100401'
    </update>
    
</mapper> 
