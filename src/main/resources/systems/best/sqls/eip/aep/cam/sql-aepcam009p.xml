<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.bai.eip.aep.cam.dao.AEPCAM009PMapper">
    
    <select id="selectMainInfo" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cam.dao.AEPCAM009PMapper.selectMainInfo*/
            SELECT A.AUD_YR,
                   F_CODE_NM('1000739', D.AUD_KND_CD) AS AUD_KND_NM,
                   D.AUD_GRN_NO,
                   D.AUD_KND_CD,
                   A.AUD_NO,
                   D.AUD_SBJ_NM,
                   A.AUD_YR AS AUD_YR2,
                   F_CODE_NM('1000739', D.AUD_KND_CD) AS AUD_KND_NM2,
                   D.AUD_GRN_NO AS AUD_GRN_NO2,
                   A.AFF_SNO,
                   A.TITLE_NM,
                   A.SCRT_YN,
                   A.PRSR,
                   TO_CHAR(TO_DATE(A.SMT_DT),'YYYY-MM-DD') AS SMT_DT,
                   A.RLTN_ORG_CD,
                   F_ORG_INFO(A.RLTN_ORG_CD, 1) AS RLTN_ORG_NM,
                   A.SRNO,
                   A.AFF_SNO,
                   A.SMT_NOC,
                   A.INVST_RQS_YN,
                   A.INVST_RQS_CMPT_YN,
                   A.CLSNG_YN,
                   CASE A.CLSNG_YN WHEN 'Y' THEN '마감' ELSE '진행중' END AS CLSNG_YN_NM,
                   A.AUD_STEP_CD,
                   A.SPV_DPT_OM_YN,
                   A.PRCT_SPV_DPT_OM_YN,
                   A.MFEX_HNDL_STEP_CD,
                   A.MFEX_SMT_AIM_YN1,
                   A.MFEX_SMT_AIM_YN2,
                   A.MFEX_SMT_AIM_YN3,
                   A.MFEX_SMT_AIM_YN4,
                   A.MFEX_SMT_AIM_YN5,
                   A.AGT_YN_CD,
                   A.AGRS_ADMN_EXET_APL_YN,
                   A.INDC_SBJ,
                   A.FTFT_APL_YN,
                   A.FTFT_EXEC_YN_CD,
                   TO_CHAR(TO_DATE(A.ENF_DT),'YYYY-MM-DD') AS ENF_DT,
                   A.RCGT_YN,
                   A.RMK_SBJ
              FROM TBCSPKDE103M AS A 
        INNER JOIN TBBADDED001M AS D ON D.AUD_YR  = A.AUD_YR
                                    AND D.AUD_NO  = A.AUD_NO
             WHERE A.AUD_YR  = #{audYr}
               AND A.AUD_NO  = #{audNo}
               <if test="affSno != null and affSno != '' and affSno != 'null'">
               AND A.AFF_SNO = #{affSno}
               </if>
               AND A.SRNO    = #{srno}
    </select>
    
    <update id="updateMain" parameterType="paramMap">
    /*kr.go.bai.eip.aep.cam.dao.AEPCAM009PMapper.updateMain*/
        UPDATE TBCSPKDE103M SET FTFT_APL_YN = #{ftftAplYn},
                                FTFT_EXEC_YN_CD = #{ftftExecYnCd},
                                ENF_DT = REPLACE(#{enfDt},'-'),
                                RCGT_YN = #{rcgtYn},
                                RMK_SBJ = #{rmkSbj},
                                FNL_USR_ID = #{usrId},
                                FNL_DEAL_DPT_CD = #{dptCd},
                                FNL_MNU_ID = #{menuNo},
                                FNL_MDF_DH = SYSDATE
                          WHERE AUD_YR = #{audYr}
                            AND AUD_NO = #{audNo}
                            AND AFF_SNO = #{affSno}
                            AND SRNO = #{srno}
    </update>
    
    <update id="deadline" parameterType="paramMap">
    /*kr.go.bai.eip.aep.cam.dao.AEPCAM009PMapper.deadline*/
        UPDATE TBCSPKDE103M SET CLSNG_YN = 'Y',
                                FNL_USR_ID = #{usrId},
                                FNL_DEAL_DPT_CD = #{dptCd},
                                FNL_MNU_ID = #{menuNo},
                                FNL_MDF_DH = SYSDATE
                          WHERE AUD_YR = #{audYr}
                            AND AUD_NO = #{audNo}
                            AND AFF_SNO = #{affSno}
                            AND SRNO = #{srno}
    </update>
    
</mapper> 