<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.ewm.dao.AEPEWM401PMapper">

	<select id="selectMainList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM401PMapper.selectMainList */ 
		<![CDATA[		
			SELECT D1.AUD_YR                                                                 AS AUD_YR
			     , D1.AUD_NO                                                                 AS AUD_NO
			     , D1.DSP_RQ_SNO                                                             AS DSP_RQ_SNO
                 , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, '', '-') || '-' || D1.DSP_RQ_SNO  AS AUD_YR_NO_DSP
                 , D4.AUD_SBJ_NM                                                             AS AUD_SBJ_NM   
			     , D1.TIT_TXT                                                                AS TIT_TXT         
			     , (SELECT CD_NM
			          FROM TBDCMACM013C
			         WHERE CMM_CD_DVSN_CD = '1000002'
			           AND CD             = D1.DSP_RQ_KND_CD)                                AS DSP_RQ_KND_NM
			     , D2.ENF_DT                                                                 AS ENF_DT
			     , D3.RLTN_ORG_CD                                                            AS RLTN_ORG_CD
			     , (SELECT ORG_NM
			          FROM TBDCMACM015M
			          WHERE ORG_CD = D3.RLTN_ORG_CD)                                         AS RLTN_ORG_NM
			     , D3.ENFM_MNG_ORG_CD                                                        AS ENFM_MNG_ORG_CD
			     , (SELECT ORG_NM
			          FROM TBDCMACM015M
			          WHERE ORG_CD = D3.ENFM_MNG_ORG_CD)                                     AS ENFM_MNG_ORG_NM 
			  FROM TBBADEAR001M D1
			      ,TBBADEAR002D D2
			      ,TBBADEAR006M D3
			      ,TBBADDED001M D4
			 WHERE 1=1
			   AND D1.AUD_YR 		= D2.AUD_YR
			   AND D1.AUD_NO 		= D2.AUD_NO
			   AND D1.DSP_RQ_SNO 	= D2.DSP_RQ_SNO
			   AND D1.AUD_YR 		= D3.AUD_YR
			   AND D1.AUD_NO 		= D3.AUD_NO
			   AND D1.DSP_RQ_SNO 	= D3.DSP_RQ_SNO			   
               AND D1.AUD_YR 		= D4.AUD_YR
			   AND D1.AUD_NO 		= D4.AUD_NO

		       AND (D3.AUD_YR, D3.AUD_NO, D3.DSP_RQ_SNO, D3.RLTN_ORG_CD) IN 
		]]>	
					
		 <foreach collection="chkKeyList" item="item" index="index"  separator="," open="(" close=")">
		 		(#{item.audYr}, #{item.audNo}, #{item.dspRqSno}, #{item.rltnOrgCd})
		 </foreach>
		
	<![CDATA[			   
		ORDER BY D3.AUD_YR
		        ,D3.AUD_NO
		        ,D3.DSP_RQ_SNO
		        ,D3.ENFM_MNG_ORG_CD
	]]>			        
	</select>

    <resultMap type="java.util.HashMap" id="enfmPrsuMap">
        <result property="audYr"       column="AUD_YR"        jdbcType="VARCHAR" javaType="java.lang.String" />
        <result property="audNo"       column="AUD_NO"        jdbcType="VARCHAR" javaType="java.lang.String" />
        <result property="dspRqSno"    column="DSP_RQ_SNO"    jdbcType="VARCHAR" javaType="java.lang.String" />
        <result property="rltnOrgCd"   column="RLTN_ORG_CD"   jdbcType="VARCHAR" javaType="java.lang.String" />
        <result property="enfmPrsuSno" column="ENFM_PRSU_SNO" jdbcType="VARCHAR" javaType="java.lang.String" />
        <result property="opmTxt"      column="OPM_TXT"       jdbcType="CLOB"    javaType="java.lang.String" />
    </resultMap> 
	
	<select id="selectOnrDocTxt" parameterType="paramMap" resultMap="enfmPrsuMap" >
		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM003EMapper.selectOnrDocTxt */
        <![CDATA[
			SELECT AUD_YR
				  ,AUD_NO
				  ,DSP_RQ_SNO
				  ,RLTN_ORG_CD
				  ,ENFM_PRSU_SNO
				  ,OPM_TXT
			  FROM TBBADFRE009M T1
			 WHERE 1 = 1
			   AND AUD_YR        = #{audYr} 	
			   AND AUD_NO        = #{audNo} 	   
			   AND DSP_RQ_SNO    = #{dspRqSno} 	   
			   AND RLTN_ORG_CD   = #{rltnOrgCd}
			   AND ENFM_PRSU_SNO = #{enfmPrsuSno}
        ]]>
	</select>	
	
   	<insert id="insertEnfmPrsuHis" parameterType="paramMap">
   		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM401PMapper.insertEnfmPrsuHis */
   		<![CDATA[
		 		INSERT INTO TBBADFRE009M
				(
					  AUD_YR
				    , AUD_NO
				    , DSP_RQ_SNO
				    , RLTN_ORG_CD
				    , ENFM_PRSU_SNO
				    , ENFM_PRSU_DT
				    , ENFM_PRSU_PEN_ID	
				    , SLF_ACP_STA_CD			    
				    , ONR_SEN_DT
				    , ONR_SEN_PEN_ID
				    , OPM_TXT
				    , ONR_DOC_MNG_CRD_ID
				    , ADMN_INF_HNDL_NO
				    , FRT_USR_ID
				    , FNL_USR_ID
				    , FNL_DEAL_DPT_CD
				    , FNL_MNU_ID
				    , FRT_REGI_DH
				    , FNL_MDF_DH
				  )
				  VALUES
				  (
				      #{audYr}
				    , #{audNo}
				    , #{dspRqSno}
				    , #{rltnOrgCd}
				    , (SELECT NVL(MAX(ENFM_PRSU_SNO),0) + 1
		                    FROM TBBADFRE009M
		                   WHERE 1 = 1
		                     AND AUD_YR      = #{audYr}
		                     AND AUD_NO      = #{audNo}
		                     AND DSP_RQ_SNO  = #{dspRqSno}
		                     AND RLTN_ORG_CD = #{rltnOrgCd})
				    , TO_CHAR(SYSDATE,'YYYYMMDD')
				    , #{enfmPrsuPenId}	
				    , '10'			    
				    , TO_CHAR(SYSDATE,'YYYYMMDD')
				    , #{enfmPrsuPenId}
				    , #{opmTxt}
				    , #{onrDocMngCrdId}
				    , #{admnInfHndlNo}
		   			, #{frtUsrId}
		       		, #{fnlUsrId}
		       		, #{fnlDealDptCd}
		       		, #{fnlMnuId}
		       		, SYSDATE
		       		, SYSDATE
			  ) 		
   		]]>
   	</insert>	
   	
   	 
	<select id="selectUserInfo" parameterType="String" resultType="egovMap">
		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM401PMapper.selectUserInfo */
		<![CDATA[
			SELECT  D1.USR_ID                 AS USR_ID
				  , D1.EML_AD                 AS EML_AD
				  , F_DPT_INFO(D1.DPT_CD,'6') AS DEPT_CD
				  , D2.FRML_DPT_NM            AS DEPT_NM
				  ,'AEPEWM'                   AS BIZ_GUBUN
				  , D1.USR_NAM                AS USR_NAM
				  , D1.RANK_NM_2              AS POSITION_NM
			  FROM  TBDCMACM001M D1
				  , TBDCMACM002M D2
			 WHERE USR_ID     = #{usrId}
			   AND D1.DPT_CD  = D2.DPT_CD
		]]>
	</select>
	
</mapper> 
