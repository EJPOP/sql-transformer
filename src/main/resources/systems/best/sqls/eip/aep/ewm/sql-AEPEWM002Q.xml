<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.ewm.dao.AEPEWM002QMapper">
	
	<select id="selectMainList" parameterType="paramMap" resultType="egovMap" >
	
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM002QMapper.selectMainList */
		<!--  include refid="include.pageSelct" / -->
        <![CDATA[
        
		SELECT TT.*,
        T2.AUD_STEP_CD,
        T2.DOC_ID,
        T2.APVR_CD,
        T2.AFF_SNO,
        T3.AFF_CD,
		(SELECT ORG_NM
		   FROM TBDCMACM015M
		  WHERE ORG_CD = TT.COPT_OFI_CD
		    AND ROWNUM = 1) AS COPT_OFI_NM,
		(SELECT ABR_DPT_NM_1
		  FROM TBDCMACM002M
		 WHERE DPT_CD = TT.ENFM_MNG_BRDV_CD
		   AND ROWNUM = 1) AS ENFM_MNG_BRDV_NM,   
        (SELECT ABR_DPT_NM_1
           FROM TBDCMACM002M
          WHERE DPT_CD = TT.OD_ENFM_MNG_BRDV_CD
            AND ROWNUM = 1) AS OD_ENFM_MNG_BRDV_NM,
        (SELECT ABR_DPT_NM_1
           FROM TBDCMACM002M
          WHERE DPT_CD = TT.ENF_BRDV_CD
            AND ROWNUM = 1) AS ENF_BRDV_NM,            /* 시행국과 추가 - 2018.01.31 yyh */            
		F_CODE_NM('1000002', TT.DSP_RQ_KND_CD) AS DSP_RQ_KND_NM,
		F_CODE_NM('1000333', TT.DSP_RQ_APV_STA_CD) AS DSP_RQ_APV_STA_NM,
		(
		SELECT ST1.ENFM_WHLS_CHGR_CNB FROM TBDCMACM002M ST1
		WHERE ST1.DPT_CD LIKE '0%'
		  AND ST1.USE_YN = 'Y'
		  AND ST1.ORZT_DVSN_CD = '30'
		  AND ST1.DPT_CD = TT.ENFM_MNG_BRDV_CD
		  AND ROWNUM = 1
		) AS ENFM_WHLS_CHGR_CNB,
		(SELECT MIN(ST2.ORG_NM) || DECODE((COUNT(DISTINCT ST1.RLTN_ORG_CD) - 1),0,'',' 외 ' || (COUNT(DISTINCT ST1.RLTN_ORG_CD) - 1))			       
		           FROM TBBADEAR006M ST1, TBDCMACM015M ST2
		          WHERE ST1.RLTN_ORG_CD = ST2.ORG_CD
		            AND ST1.AUD_YR = TT.AUD_YR
		            AND ST1.AUD_NO = TT.AUD_NO
		            AND ST1.DSP_RQ_SNO = TT.DSP_RQ_SNO
		          GROUP BY ST1.AUD_YR, ST1.AUD_NO, ST1.DSP_RQ_SNO 
		) AS RLTN_ORG_NM,
		TT.NUM AS STATUS_CONF_FLAG,   /* 상황확인표 */
		TT.NUM AS STATUS_FLAG,   /* 상황표 */
		TT.NUM AS APV_FLAG   /* 상황표 */
		,'TBBADDED146M'                                              AS TABLE_TYPE
		  FROM (SELECT T.* ,
		               ROW_NUMBER() OVER(
		                 ORDER BY AUD_YR DESC, AUD_NO DESC, DSP_RQ_SNO DESC ) AS NUM
		          FROM (SELECT DT.* ,
		                       COUNT(1) OVER() AS TOT_CNT
		                  FROM (
		                  
		        
					SELECT
					       T1.AUD_YR,
					       T1.AUD_NO,
					       T1.AUD_GRN_NO,
					       T2.DSP_RQ_SNO,
					       T3.DSP_RQ_SRNO,
					       F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') ||'-'||T2.DSP_RQ_SNO AS TOT_DSP_RQ_NO, 
					       T1.AUD_SBJ_NM,
					       T2.TIT_TXT,
					       TO_CHAR(TO_DATE(T3.HNDL_DDLN_DT,'YYYY-MM-DD') , 'YYYY-MM-DD') AS HNDL_DDLN_DT,
					       T3.COPT_OFI_CD,
		                   T3.ENFM_MNG_BRDV_CD,
		                   T3.DSP_RQ_APV_STA_CD,
		                   T3.DTM_YN,
		                   /* DECODE(T3.DTM_STA_CD, '2', '확정', '1', DECODE(T3.DSP_RQ_APV_STA_CD, '3', '완결', '미결') , '') AS DTM_YN_NM, */
		
		                   CASE WHEN T3.DTM_STA_CD = '2'                                
		                             THEN '확정'
		                        WHEN T3.DTM_STA_CD = '1' AND  T3.DSP_RQ_APV_STA_CD  = '3'                                   
		                             THEN '완결' || CASE WHEN T3.CPLT_STA_DVSN_CD IS NOT NULL     THEN '(' || DECODE(T3.CPLT_STA_DVSN_CD,'1','완결','종결') || ')' 
		                                                     ELSE '' 
		                                            END
		                        WHEN T3.DTM_STA_CD = '1' AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD <> '3') 
		                             THEN '미결' || CASE WHEN T3.NOT_CPLT_STA_DVSN_CD IS NOT NULL THEN '(' || DECODE(T3.NOT_CPLT_STA_DVSN_CD,'1','정상','집중') || ')' 
		                                                     ELSE '' 
		                                            END
		                        ELSE ''
		                    END  AS DTM_YN_NM, 
		                   	DECODE((SELECT DECODE(COUNT(ST.DOC_ID),0,'N','Y')
										FROM TBBADDED111M ST
							           WHERE 1=1
							           AND T2.AUD_YR = ST.AUD_YR
									   AND T2.AUD_NO = ST.AUD_NO
							           AND ST.RPRT_CD = 'A10900900'
							           AND T2.DSP_RQ_SNO = ST.REF_ID),'N','-','작성')  AS RPRT_YN,
							CASE WHEN (SELECT COUNT(1)
										    FROM TBBADFRE012M ST1
										    WHERE ST1.AUD_YR = T3.AUD_YR
										    AND ST1.AUD_NO = T3.AUD_NO
										    AND ST1.ACP_DVSN_CD = '2'
										    AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO)< 1
								THEN '-'
								ELSE '재심' END AS JESIM_YN, 
		                   T1.AUD_KND_CD,
		                   F_CODE_NM('1000007', T1.AUD_KND_CD) AS AUD_KND_NM,
		                   T3.ENF_DT,
		                   T3.ENFM_WHLS_DTM_DT,
		                   T2.DSP_RQ_KND_CD,
		                   T3.EXAM_RPRT_DSP_RQ_SBT,
						   T3.EXAM_RPRT_UNENFM_RTWR_TXT, 
						   T3.EXAM_RPRT_UNENFM_RSN_EXAM_TXT,
						   T3.APV_DOC_NO,
						   T2.EXEC_DSP_NM,
						   T3.OD_ENFM_MNG_BRDV_CD,
						   T3.ENF_BRDV_CD 
					  FROM TBBADDED001M T1,
					       TBBADEAR001M T2,
					       TBBADEAR002D T3
					 WHERE 1 = 1
					   AND T1.AUD_YR = T2.AUD_YR
					   AND T1.AUD_NO = T2.AUD_NO
					   AND T2.AUD_YR = T3.AUD_YR
					   AND T2.AUD_NO = T3.AUD_NO
					   AND T2.DSP_RQ_SNO = T3.DSP_RQ_SNO
					   	/*
					   	  % 아래 6개는 감사결과 처분요구 입력시 바로 집행확정 처리함
							1000002	390	현지시정
							1000002	410	주의
							1000002	490	현지주의
							1000002	710	직접고발
							1000002	720	자체고발
							1000002	730	수사요청
						  % 아래 18개가 집행전말 처리 대상 종류
							1000002	110	변상판정
							1000002	210	징계문책
							1000002	310	시정(금액)
							1000002	320	시정(기타)
							1000002	391	현지시정회
							1000002	396 시정(국장전결)회
							1000002	510	법령상개선
							1000002	520	제도상개선
							1000002	530	행정상개선
							1000002	610	통보
							1000002	611	권고
							1000002	620	통보(인사)
							1000002	621	통보(징계)
							1000002	623	통보(비위)
							1000002	630	통보개선
							1000002	810	모범(예산절감)
							1000002	820	모범(업무개선)
							1000002	830	모범(성실근무)
							1000002	840	모범(민원해소)
							1000002	850	모범(기타)				
						*/
					   AND T2.DSP_RQ_KND_CD IN ('110','210','310','320','391','396','620','621','623','630','510','520','530','610','611','810','820','830','840','850')
					   /* 집행전말 대상은 처분요구확정 이후 상태 건 들임. */
					   AND T3.DTM_STA_CD IN ('1','2')
				]]>
				
				<if test='dptSrchYn == "N"'>		
					/* 권한이 없는 일선 과 */
					
					/* 모든 국과선택이 전체일 경우 */
					<if test="enfBrdvCd_1 eq '' and enfBrdvCd_2 eq '' and upSpvBrdvCd eq '' and enfmMngBrdvCd eq ''">
						AND (
						         T3.ENF_BRDV_CD          IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', '')))
						      OR 
						      	 T3.ENFM_MNG_BRDV_CD     IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', '')))
							  OR 
							   	 T3.OD_ENFM_MNG_BRDV_CD  IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', '')))						      	 
						    )
					</if>
					<if test='rprtYn == "1"'>
							AND (SELECT DECODE(COUNT(ST.DOC_ID),0,'N','Y')
									FROM TBBADDED111M ST
							        WHERE 1=1
							        AND ST.AUD_YR = T2.AUD_YR
									AND ST.AUD_NO = T2.AUD_NO
									AND ST.REF_ID = T2.DSP_RQ_SNO
							        AND ST.RPRT_CD = 'A10900900'
							           ) = 'Y'				
				</if>
				<if test='rprtYn == "2"'>
							AND (SELECT DECODE(COUNT(ST.DOC_ID),0,'N','Y')
									FROM TBBADDED111M ST
							        WHERE 1=1
							        AND ST.AUD_YR = T2.AUD_YR
									AND ST.AUD_NO = T2.AUD_NO
									AND ST.REF_ID = T2.DSP_RQ_SNO
							        AND ST.RPRT_CD = 'A10900900'
							           ) = 'N'				
				</if>
				<if test='jesimYn == "1"'>
							AND (SELECT COUNT(1)
								   FROM TBBADFRE012M ST1
							       WHERE ST1.AUD_YR = T3.AUD_YR
							       AND ST1.AUD_NO = T3.AUD_NO
							       AND ST1.ACP_DVSN_CD = '2'
							       AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO) >= 1
				</if>
				<if test='jesimYn == "2"'>
							AND (SELECT COUNT(1)
								   FROM TBBADFRE012M ST1
							       WHERE ST1.AUD_YR = T3.AUD_YR
							       AND ST1.AUD_NO = T3.AUD_NO
							       AND ST1.ACP_DVSN_CD = '2'
							       AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO) = 0
				</if>
					
					<if test='enfBrdvCd_1 != "" or upSpvBrdvCd != "" or odUpSpvBrdvCd != ""'>
					
						<!-- 시행국과 -->
						<if test='enfBrdvCd_1 != null and enfBrdvCd_1 != ""'>
							AND T3.ENF_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{enfBrdvCd_1})))
						</if>
						<if test='enfBrdvCd_2 != null and enfBrdvCd_2 != ""'>
							AND T3.ENF_BRDV_CD = #{enfBrdvCd_2}
						</if>
				
						<!-- 이행국과 -->
						<if test='upSpvBrdvCd != null and upSpvBrdvCd != ""'>
							AND T3.ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{upSpvBrdvCd})))
						</if>
						<if test='enfmMngBrdvCd != null and enfmMngBrdvCd != ""'>
							AND T3.ENFM_MNG_BRDV_CD     = #{enfmMngBrdvCd}
						</if>
												
						<!-- 이전국과 -->
						<if test='odUpSpvBrdvCd != null and odUpSpvBrdvCd != ""'>
							AND T3.OD_ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{odUpSpvBrdvCd})))
						</if>
						<if test='odEnfmMngBrdvCd != null and odEnfmMngBrdvCd != ""'>
							AND T3.OD_ENFM_MNG_BRDV_CD     = #{odEnfmMngBrdvCd}
						</if>						
						
					</if>
				</if>
		
				<if test='dptSrchYn == "Y"'>
					/* 이행관리과 등 권한이 있는 과*/
			
					<!-- 시행국과 -->
					<if test='enfBrdvCd_1 != null and enfBrdvCd_1 != ""'>
						AND T3.ENF_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{enfBrdvCd_1})))
					</if>			
					<if test='enfBrdvCd_2 != null and enfBrdvCd_2 != ""'>
						AND T3.ENF_BRDV_CD = #{enfBrdvCd_2}
					</if>
			
					<!-- 이행국과 -->
							AND T3.ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{upSpvBrdvCd})))
			
					<if test='enfmMngBrdvCd != null and enfmMngBrdvCd != ""'> 	   
						AND T3.ENFM_MNG_BRDV_CD     = #{enfmMngBrdvCd}
					</if>
					
					<!-- 이전국과 -->
					<if test='odUpSpvBrdvCd != null and odUpSpvBrdvCd != ""'>
						AND T3.OD_ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{odUpSpvBrdvCd})))
					</if>
					<if test='odEnfmMngBrdvCd != null and odEnfmMngBrdvCd != ""'>
						AND T3.OD_ENFM_MNG_BRDV_CD     = #{odEnfmMngBrdvCd}
					</if>		
					<if test='rprtYn == "1"'>
							AND (SELECT DECODE(COUNT(ST.DOC_ID),0,'N','Y')
									FROM TBBADDED111M ST
							        WHERE 1=1
							        AND ST.AUD_YR = T2.AUD_YR
									AND ST.AUD_NO = T2.AUD_NO
									AND ST.REF_ID = T2.DSP_RQ_SNO
							        AND ST.RPRT_CD = 'A10900900'
							           ) = 'Y'				
				</if>
				<if test='rprtYn == "2"'>
							AND (SELECT DECODE(COUNT(ST.DOC_ID),0,'N','Y')
									FROM TBBADDED111M ST
							        WHERE 1=1
							        AND ST.AUD_YR = T2.AUD_YR
									AND ST.AUD_NO = T2.AUD_NO
									AND ST.REF_ID = T2.DSP_RQ_SNO
							        AND ST.RPRT_CD = 'A10900900'
							           ) = 'N'				
				</if>
				<if test='jesimYn == "1"'>
							AND (SELECT COUNT(1)
								   FROM TBBADFRE012M ST1
							       WHERE ST1.AUD_YR = T3.AUD_YR
							       AND ST1.AUD_NO = T3.AUD_NO
							       AND ST1.ACP_DVSN_CD = '2'
							       AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO) >= 1
				</if>
				<if test='jesimYn == "2"'>
							AND (SELECT COUNT(1)
								   FROM TBBADFRE012M ST1
							       WHERE ST1.AUD_YR = T3.AUD_YR
							       AND ST1.AUD_NO = T3.AUD_NO
							       AND ST1.ACP_DVSN_CD = '2'
							       AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO) = 0
				</if>				
			</if>
				
				<if test='audYr != null and audYr != ""'>
					   AND T1.AUD_YR               = #{audYr}
				</if>
				<if test='audKndCd != null and audKndCd != ""'>
					   AND T1.AUD_KND_CD               = #{audKndCd}
				</if>
				<!-- 검색조건을 감사번호에서 감사부여번호로 변경 - 2016.06.02 yyh -->
				<if test='audGrnNo != null and audGrnNo != ""'>
					   AND T1.AUD_GRN_NO           = #{audGrnNo}
				</if>
				<if test='dspRqSno != null and dspRqSno != ""'>
					   AND T2.DSP_RQ_SNO           = #{dspRqSno}
				</if>
				<if test='titTxt != null and titTxt != ""'>
					   AND T2.TIT_TXT              LIKE '%'||#{titTxt}||'%'
				</if>
				<!-- isNotEmpty property="coptoficd">	 	   
					   AND T3.COPT_OFI_CD          = #{coptoficd} 
				</isNotEmpty -->
				<!--  isNotEmpty property="rltnorgcd">	 	   
					   AND T3.RLTN_ORG_CD          = #{rltnorgcd} 
				</isNotEmpty -->
				<if test='rltnOrgCd != null and rltnOrgCd != ""'>
					   AND EXISTS (
					   	SELECT ST1.RLTN_ORG_CD
					   	FROM TBBADEAR006M ST1
					   	WHERE 1 = 1
					   	AND ST1.AUD_YR = T1.AUD_YR
					   	AND ST1.AUD_NO = T1.AUD_NO
					   	AND ST1.DSP_RQ_SNO = T2.DSP_RQ_SNO
					   	AND ST1.RLTN_ORG_CD = #{rltnOrgCd}
					   )
					   
				</if>
				<if test='enfDtFrom != null and enfDtFrom != ""'>
					   AND T3.ENF_DT               >= REPLACE(#{enfDtFrom},'-','')
				</if>
				<if test='enfDtTo != null and enfDtTo != ""'>
					   AND REPLACE(#{enfDtTo},'-','')            >= T3.ENF_DT 
				</if>
				<if test='dspRqDtmDtFrom != null and dspRqDtmDtFrom != ""'>
					   AND T3.ENFM_WHLS_DTM_DT        >= REPLACE(#{dspRqDtmDtFrom},'-','')
				</if>
				<if test='dspRqDtmDtTo != null and dspRqDtmDtTo != ""'>
					   AND REPLACE(#{dspRqDtmDtTo},'-','')       >= T3.ENFM_WHLS_DTM_DT 
				</if>
				
				<if test='notEnfmStaCd == "1"'>
					   <!-- 고위험 관리 지정 -->
					<![CDATA[
					   /* 주석처리 - 2016.05.13 yyh   
					   AND T3.HRK_MNG_ASG_YN = 'Y' */
					]]>   
				</if>
				<if test='notEnfmStaCd == "2"'>
				    <!-- 미집행(확정이아닌것) + 처리기한내 -->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
				       AND TO_CHAR(SYSDATE, 'YYYYMMDD') <= T3.HNDL_DDLN_DT
				    ]]>   
				</if>
				<if test='notEnfmStaCd == "3"'>
				    <!-- 미집행(확정이아닌것) + 처리기한경과 -->
				    <![CDATA[
				       AND T3.DTM_STA_CD = '1'
					   AND TO_CHAR(SYSDATE, 'YYYYMMDD') > T3.HNDL_DDLN_DT
					]]>
				</if>
				
				<if test='dspRqKndCd != null and dspRqKndCd != "" and dspRqKndCd != "000"'>
					<if test='dspRqKndCd != "300"'>
						<if test='dspRqKndCd != "500"'>
							<if test='dspRqKndCd != "800"'>
								<!-- 
								     전체, 시정전체, 개선전체, 모범전체가 아닌경우는 해당 코드로 바로 조회 
								-->
								AND T2.DSP_RQ_KND_CD = #{dspRqKndCd}	
							</if>
						</if>
					</if>	
					
					<if test='dspRqKndCd == "300"'>
						<!-- 
						     300(시정) = 시정(금액)+시정(기타)+현지시정회 +시정(국장전결)회
						-->
						AND T2.DSP_RQ_KND_CD IN ('310','320','391','396')
					</if>
					<if test='dspRqKndCd == "500"'>
						<!-- 
						     500(개선) = 법령상개선+제도상개선+행정상개선 
						-->
						AND T2.DSP_RQ_KND_CD IN ('510','520','530')
					</if>
					<if test='dspRqKndCd == "800"'>
						<!-- 
						     800(모범) = 예산절감+업무개선+성실근무+민원해소+기타 
						-->
						AND T2.DSP_RQ_KND_CD IN ('810','820','830','840','850')
					</if>
				</if>
				<if test='enfmGubunCd == "1"'>
					<!-- 
					     처분요구
					-->
					AND T2.DSP_RQ_KND_CD IN ('110', '210', '310', '320', '391', '396','810', '820', '830', '840', '850')
				</if>
				<if test='enfmGubunCd == "2"'>
					<!-- 
					     권고.통보 
					-->
					AND T2.DSP_RQ_KND_CD IN ('510','520','530','610','611', '620', '621', '623', '630')
				</if>
				<if test='dtmStaCd == "1"'>
					<!-- 
					     미결
					     1(처분요구확정) + 처분요구결재상태  <> 3(결재완료)
					     
					-->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
					   AND NVL(T3.DSP_RQ_APV_STA_CD,'0') <> '3'
					   
					]]>
				</if>
				<if test='dtmStaCd == "2"'>
					<!-- 
					     완결
					     1(처분요구확정) + 처분요구결재상태  = 3(결재완료)
					     
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND NVL(T3.DSP_RQ_APV_STA_CD,'0') = '3'
					   
				</if>
				<if test='dtmStaCd == "3"'>
						<!-- 
						     집행확정
						     2(처분요구확정) 
						-->
					   AND T3.DTM_STA_CD = '2'
				</if>
				<if test='notCpltStaDvsnCd != null and notCpltStaDvsnCd != ""'>
					<!-- 미결구분 - 2016.05.19 yyh  -->
					AND T3.NOT_CPLT_STA_DVSN_CD = #{notCpltStaDvsnCd}
				</if>
				<if test='cpltStaDvsnCd != null and cpltStaDvsnCd != ""'>
					<!-- 완결구분 - 2016.05.19 yyh  -->
					AND T3.CPLT_STA_DVSN_CD = #{cpltStaDvsnCd}
				</if>
				<!--  isNotEqual property="clsgprssstacd" compareValue="0">
					   AND T3.CLSG_PRSS_STA_CD = #{clsgprssstacd}
				</isNotEqual -->
				<if test='dspRqApvStaCd != "0" and dspRqApvStaCd != null and  dspRqApvStaCd != "" '>
						<!-- 
						             조회조건
							결재상태코드 : 2 (결재중) / 3 (승인) / 4(반려)
							                       나머지 1(상신전),5(상신취소),null -> (상신전) 
						-->
					   AND DECODE(T3.DSP_RQ_APV_STA_CD,'2','2','3','3','4','4','1') = #{dspRqApvStaCd}
					   
				</if>
				<!-- isNotEqual property="dsprqkndcd" compareValue="000">
					   AND T2.DSP_RQ_KND_CD = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000002'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{dsprqkndcd}
											       AND ROWNUM = 1
										       )
				</if>
				<if test='dtmstacd != "0"'>
					   AND T3.DTM_STA_CD    = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000017'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{dtmstacd}
											       AND ROWNUM = 1
										       )
				</if>
				<if test='clsgprssstacd != "0"'>
					   AND T3.CLSG_PRSS_STA_CD = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000336'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{clsgprssstacd}
											       AND ROWNUM = 1
										       )
				</if>
				<if test='dsprqapvstacd != "0"'>
					   AND T3.DSP_RQ_APV_STA_CD = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000333'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{dsprqapvstacd}
											       AND ROWNUM = 1
										       )
				</isNotEqual -->
				<!--  isNotEqual property="dtmyn" compareValue="0">
					   AND T3.DTM_YN = #{dtmyn}
				</isNotEqual -->
				<if test='selectedtab == "1"'>
				<!-- 
					집행전말관리 집행회보접수 탭 선택시 추가되는 WHERE절
				 	: 접수일 IS NULL
				-->
					   AND EXISTS (
						   SELECT AUD_YR FROM TBBADFRE001H ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND ST1.BAI_CHGD_ACP_DT IS NULL
					   )
				</if>
				<if test='selectedtab == "2"'>
				<!-- 
					집행전말관리 검토의견작성 탭 선택시 추가되는 WHERE절 
					: 검토결과가 없는 건
				-->
					   AND EXISTS (
						   SELECT AUD_YR FROM TBBADFRE001H ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND (
		             	       ST1.ENFM_WHLS_APV_STA_CD IS NULL
		                       OR ST1.ENFM_WHLS_APV_STA_CD NOT IN ('3')
		           		   )
					   )
				</if>
				<if test='selectedtab == "3"'>
				<!-- 
					집행전말관리 집행완결처리 탭 선택시 추가되는 WHERE절 
					: 확정상태코드 : 처분확정(1) & 확정여부 : 미확정(N)
					  & 관계기관 완결 : 전부Y & 관계자 완결 : 전부Y
				-->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
					   AND NVL(T3.DTM_YN,'N') <> 'Y' 
					   AND NOT EXISTS (
						   SELECT AUD_YR FROM TBBADEAR006M ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND (
		                       ST1.CPLT_YN IS NULL
		                       OR ST1.CPLT_YN = 'N'
		                   )
					   )
					   AND NOT EXISTS (
						   SELECT AUD_YR FROM TBBADEAR007M ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND (
		                       ST1.CPLT_YN IS NULL
		                       OR ST1.CPLT_YN = 'N'
		                   )
					   )
					]]> 
				</if>
				<if test='selectedtab == "4"'>
					<if test='selectedtab2 == "0"'>
					<!-- 
						집행전말관리 집행상황 결재&결산송부 탭 + 권고통보사항(국장전결)
						선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 확정여부 : 확정(Y) 
						  & 집행전말결재종류코드 : 권고통보사항(국장전결)(1) & 처분요구결재상태코드 : 승인(3) 이 아닌것
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.ENFM_WHLS_APV_KND_CD = '1'
					   AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD NOT IN ('3'))
					</if>
					<if test='selectedtab2 == "1"'>
					<!-- 
						집행전말관리 집행상황 결재&결산송부 탭 + 권고통보외처분요구사항(과장전결)
						선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 확정여부 : 확정(Y) 
						  & 집행전말결재종류코드 : 권고통보외처분요구사항(과장전결)(2) & 처분요구결재상태코드 : 승인(3) 이 아닌것
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.ENFM_WHLS_APV_KND_CD = '2'
					   AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD NOT IN ('3'))
					</if>
					<if test='selectedtab2 == "2"'>
					<!-- 
						집행전말관리 집행상황 결재&결산송부 탭 + 처분요구대로집행되지아니한사항
						선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 확정여부 : 확정(Y) 
						  & 집행전말결재종류코드 : 처분요구대로집행되지아니한사항(3) & 처분요구결재상태코드 : 승인(3) 이 아닌것
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.ENFM_WHLS_APV_KND_CD = '3'
					   AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD NOT IN ('3'))
					</if>
				</if>
				<if test='selectedtab == "5"'>
					<if test='selectedtab3 == "0"'>
					<!-- 
						집행전말관리 집행전말 확정처리 탭(확정할사항 탭) 선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 완결여부 : 완결(Y) & 처분요구결재상태코드 : 결재완료(3)
						
						- 검토할사항으로 변경 - 2016.05.17 yyh 
					-->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.DSP_RQ_APV_STA_CD = '3'
					   AND (T3.DTM_APV_STA_CD IS NULL OR T3.DTM_APV_STA_CD <> '2')
					 ]]>
					</if>
					
					<if test='selectedtab3 == "1"'>
					<!-- 
						- 검토한사항 추가 - 2016.05.17 yyh
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.DSP_RQ_APV_STA_CD = '3'
					   AND T3.DTM_APV_STA_CD = '2' 			
					</if>			
					<if test='selectedtab3 == "2"'>
					<!-- 
						집행전말관리 집행전말 확정처리 탭(확정한사항 탭) 선택시 추가되는 WHERE절 
						: 확정상태코드 : 집행확정(2)
					-->
					   AND T3.DTM_STA_CD = '2'
					</if>
				</if>
				/* 감사연번종류코드 - 2015.12.22 yyh */
					<if test='audYrNoKndCd != null and audYrNoKndCd != ""'>
						  AND SUBSTR(T1.AUD_KND_CD,1,3) =  SUBSTR(#{audYrNoKndCd} ,1,3)
					</if>		
				
				/* 관련자명, 조치요구 추가 - 2016.05.16 yyh */
				<if test='dfntNam != null and dfntNam != ""'>
					   AND EXISTS (
						           SELECT 1 
						             FROM TBBADEAR007M Y
						            WHERE 1=1
						              AND Y.AUD_YR     = T3.AUD_YR
						              AND Y.AUD_NO     = T3.AUD_NO
						              AND Y.DSP_RQ_SNO = T3.DSP_RQ_SNO
						              AND Y.DFNT_NAM LIKE '%' || #{dfntNam} || '%' 
						          )		
				</if>
				<if test='hndRqKndCd != null and hndRqKndCd != ""'>
					   AND EXISTS (
						           SELECT 1 
						             FROM TBBADEAR007M Y
						            WHERE 1=1
						              AND Y.AUD_YR        = T3.AUD_YR
						              AND Y.AUD_NO        = T3.AUD_NO
						              AND Y.DSP_RQ_SNO    = T3.DSP_RQ_SNO
						              AND Y.HND_RQ_KND_CD = SUBSTR(#{hndRqKndCd}, 4) 
						          )			
				</if>
				
				<if test='mainEnfmMngTgYn != null and mainEnfmMngTgYn != ""'>
			           AND NVL(T3.MAIN_ENFM_MNG_TG_YN,'N') = #{mainEnfmMngTgYn}
				</if>
						
				<if test='enfmStepCd != null and enfmStepCd != ""'>
                       AND (SELECT MAX(ENFM_STEP_CD)
		                      FROM TBBADFRE001H Z1
		                     WHERE Z1.AUD_YR     = T3.AUD_YR
		                       AND Z1.AUD_NO     = T3.AUD_NO
		                       AND Z1.DSP_RQ_SNO = T3.DSP_RQ_SNO
		                       AND Z1.HST_NO     = (SELECT MAX(HST_NO)
		                                              FROM TBBADFRE001H Z2
      		                                         WHERE Z2.AUD_YR     = T3.AUD_YR
		                                               AND Z2.AUD_NO     = T3.AUD_NO
		                                               AND Z2.DSP_RQ_SNO = T3.DSP_RQ_SNO))  = #{enfmStepCd}  				
				</if>					
				
				) DT
		                 ORDER BY AUD_YR DESC,
		                       AUD_NO DESC,
		                       DSP_RQ_SNO DESC ) T ) TT
         LEFT OUTER JOIN TBBADDED146M T2 ON (TT.AUD_YR = T2.AUD_YR
                                                   AND TT.AUD_NO = T2.AUD_NO
                                                   AND TT.DSP_RQ_SNO = T2.DSP_RQ_SNO
                                                   AND T2.FNL_YN = 'Y')
         LEFT OUTER JOIN TBBADDED145M T3 ON (T2.AUD_YR = T3.AUD_YR
                                                   AND T2.AUD_NO = T3.AUD_NO
                                                   AND T2.AUD_STEP_CD = T3.AUD_STEP_CD
                                                   AND T2.APVR_CD = T3.APVR_CD
                                                   AND T2.DOC_ID = T3.DOC_ID
                                                   AND T2.AFF_SNO = T3.AFF_SNO
                                                   AND T2.FNL_YN = 'Y')
		 <!--   WHERE NUM BETWEEN (((#{currpage}- 1) * #{pagingcnt}) + 1) AND (#{currpage} * #{pagingcnt})-->
		 WHERE NUM BETWEEN (((#{currPage}- 1) * #{pageSize}) + 1) AND (#{currPage} * #{pageSize})		
		<!--  include refid="include.pageOrder" / -->
	</select>
	
	<!--집행회보 일괄접수 update  BADFRE001EBatchAcceptupdate -->
	<update id="updateBatchAccept" parameterType="paramMap">
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM002QMapper.updateBatchAccept */
		  UPDATE TBBADFRE001H
			 SET
			 	BAI_CHGD_ACP_DT = TO_CHAR(SYSDATE, 'YYYYMMDD'),
			 	EXAM_STA_CD = '1',
			 	FNL_USR_ID                    = #{fnlUsrId},
			 	FNL_DEAL_DPT_CD               = #{fnlDealDptCd},
			 	FNL_MNU_ID                    = #{fnlMnuId},
			 	FNL_MDF_DH                    = SYSDATE
 		   WHERE 1 = 1
			 AND AUD_YR = #{audYr}
			 AND AUD_NO = #{audNo}
			 AND DSP_RQ_SNO = #{dspRqSno} 	
			 
		<!-- 상세화면(AEPEWM003E)에서 접수처리 할 경우 -->	    
		<if test='rltnOrgCd != null and rltnOrgCd != ""'>
			 AND RLTN_ORG_CD = #{rltnOrgCd}
		</if>
		<if test='hstNo != null and hstNo != ""'>
			 AND HST_NO=#{hstNo}
		</if>
			 
		<!-- 목록조회화면(AEPEWM002Q)에서 접수처리 할 경우 - 2017.07.14 yyh -->
		<if test='hstNo == null or hstNo == ""'>
			 AND BAI_CHGD_ACP_DT IS NULL	 
		</if>
	</update>
	
	<!-- 접수시 나의 할일 완료 처리 BADFRE001EBatchAcceptToDoListComplete" -->
	<update id="updateBatchAcceptToDoListComplete" parameterType="paramMap">
		UPDATE PTL_ORDER_RECEIVE_LIST
		   SET COMP_DT = TO_CHAR(SYSDATE,'YYYYMMDDHH24MMSS')
		      ,COMP_CMMT = '[접수처리완료]'
 		 WHERE 1 = 1
		   AND SEQ IN (
				        SELECT ENFM_WHLS_CON_NO FROM TBBADFRE001H WHERE 1 = 1
				           AND AUD_YR = #{audYr}
				           AND AUD_NO = #{audNo}
				           AND DSP_RQ_SNO = #{dspRqSno}
					
					   <!-- 상세화면(AEPEWM003E)에서 접수처리 할 경우 -->
			           <if test='rltnOrgCd != null and rltnOrgCd != ""'>
			               AND RLTN_ORG_CD = #{rltnOrgCd}
			           </if>
			           <if test='hstNo != null and hstNo != ""'>
			               AND HST_NO=#{hstNo}
			           </if>
			           
					   <!-- 목록조회화면(AEPEWM002Q)에서 접수처리 할 경우 - 2017.07.14 yyh -->
					   <if test='hstNo == null or hstNo == ""'>
							 AND BAI_CHGD_ACP_DT IS NULL	 
					   </if>			           
			 )
	</update>
	
	<!-- 집행회보 일괄접수취소     BADFRE001EBatchAcceptCanceldelete -->
	<update id="deleteBatchAcceptCancel" parameterType="paramMap">
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM002QMapper.deleteBatchAcceptCancel" */
        
		     DELETE FROM TBBADFRE001H
 			 WHERE 1 = 1
			 AND AUD_YR = #{audNo}
			 AND AUD_NO = #{audNo}
			 AND DSP_RQ_SNO = #{dspRqSno}	
	</update>
	
	<!-- 집행회보 일괄접수취소 이력 저장 BADFRE001EEnfmDelHisinsert -->
	<insert id="insertEnfmDelHis" parameterType="paramMap">
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM002QMapper.insertEnfmDelHis" */
        
			  INSERT INTO TBBADFRE022H
			  (
				AUD_YR            
				,AUD_NO        
				,DSP_RQ_SNO       
				,RLTN_ORG_CD     
				,HST_NO
				,CON_HNDL_CD
				,USE_YN
				,CON_RTRN_CD      
				,FRT_USR_ID
				,FNL_USR_ID
				,FNL_DEAL_DPT_CD
				,FNL_MNU_ID
				,FRT_REGI_DH
				,FNL_MDF_DH
			  )
			  VALUES
			  (
                 #{audYr}             /* 감사년도          */ 
                ,#{audNo}             /* 감사번호          */ 
                ,#{dspRqSno}         /* 처분요구순번      */ 
				,#{rltnOrgCd}        /* 관계기관코드      */
				,#{hstNo}
				,'D'
				,'N'
				,'900'
				,#{frtUsrId}         
				,#{fnlUsrId}         /* 최종사용자ID */
				,#{fnlDealDptCd}
				,#{fnlMnuId}
				,SYSDATE
				,SYSDATE
			  )	
	</insert>
	
		<!-- 레포트  BADFRE001ERep51select -->
		<select id="selectConfFlagRep" parameterType="paramMap" resultType="resultMap" >
        <![CDATA[
			SELECT '처분요구' as TITLE ,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '1' then 1 else 0 end, 0)),0) as ITEM1,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '2' then 1 else 0 end, 0)),0) as ITEM2,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '310' 
			                         or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) <> 0 ) then 1 else 0 end, 0)),0) as ITEM3,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '320' 
			                         or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) = 0 ) then 1 else 0 end, 0)),0) as ITEM4,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '5' or master.DSP_RQ_KND_CD = '630' then 1 else 0 end, 0)),0) as ITEM5,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '611' then 1 else 0 end, 0)),0) as ITEM6,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 2) = '62' then 1 else 0 end, 0)),0) as ITEM7,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '610' then 1 else 0 end, 0)),0) as ITEM8,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '7' then 1 else 0 end, 0)),0) as ITEM9,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '8' then 1 else 0 end, 0)),0) as ITEM10,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '1' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '2' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '310' or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) <> 0 ) then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '320' or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) = 0 ) then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '5' or master.DSP_RQ_KND_CD = '630' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '611' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 2) = '62' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '610' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '7' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '8' then 1 else 0 end, 0)),0) as ITEM11
			  FROM TBBADEAR001M master,
			       TBBADEAR002D detail
			 WHERE 1=1
			   AND master.AUD_YR = detail.AUD_YR
			   AND master.AUD_NO = detail.AUD_NO
			   AND master.DSP_RQ_SNO = detail.DSP_RQ_SNO
			   AND SUBSTR(master.DSP_RQ_KND_CD, 1, 1) NOT IN ('4','9')
			   AND detail.AUD_YR = #{audYr}
			   AND detail.AUD_NO = #{audno}
			   AND detail.ENFM_MNG_BRDV_CD = #{enfmMngBrdvCd}   
			   
			UNION ALL
			
			SELECT '금번이행' as TITLE ,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '1' then 1 else 0 end, 0)),0) as ITEM1,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '2' then 1 else 0 end, 0)),0) as ITEM2,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '310' 
			                         or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) <> 0 ) then 1 else 0 end, 0)),0) as ITEM3,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '320' 
			                         or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) = 0 ) then 1 else 0 end, 0)),0) as ITEM4,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '5' or master.DSP_RQ_KND_CD = '630' then 1 else 0 end, 0)),0) as ITEM5,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '611' then 1 else 0 end, 0)),0) as ITEM6,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 2) = '62' then 1 else 0 end, 0)),0) as ITEM7,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '610' then 1 else 0 end, 0)),0) as ITEM8,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '7' then 1 else 0 end, 0)),0) as ITEM9,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '8' then 1 else 0 end, 0)),0) as ITEM10,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '1' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '2' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '310' or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) <> 0 ) then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '320' or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) = 0 ) then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '5' or master.DSP_RQ_KND_CD = '630' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '611' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 2) = '62' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '610' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '7' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '8' then 1 else 0 end, 0)),0) as ITEM11
			  FROM TBBADEAR001M master,
			       TBBADEAR002D detail
			 WHERE 1=1
			   AND master.AUD_YR = detail.AUD_YR
			   AND master.AUD_NO = detail.AUD_NO
			   AND master.DSP_RQ_SNO = detail.DSP_RQ_SNO
			   AND SUBSTR(master.DSP_RQ_KND_CD, 1, 1) NOT IN ('4','9')
			   AND detail.AUD_YR = #{audYr}
			   AND detail.AUD_NO = #{audNo}
			   AND detail.ENFM_MNG_BRDV_CD = #{enfmMngBrdvCd}   
			   AND detail.DTM_STA_CD = '1'
			   AND detail.DTM_YN = 'Y'
			   AND NVL(detail.DSP_RQ_APV_STA_CD,'1') IN ('','1','4','5')
			   
			UNION ALL
			
			SELECT '전번까지 이행' as TITLE ,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '1' then 1 else 0 end, 0)),0) as ITEM1,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '2' then 1 else 0 end, 0)),0) as ITEM2,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '310' 
			                         or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) <> 0 ) then 1 else 0 end, 0)),0) as ITEM3,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '320' 
			                         or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) = 0 ) then 1 else 0 end, 0)),0) as ITEM4,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '5' or master.DSP_RQ_KND_CD = '630' then 1 else 0 end, 0)),0) as ITEM5,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '611' then 1 else 0 end, 0)),0) as ITEM6,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 2) = '62' then 1 else 0 end, 0)),0) as ITEM7,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '610' then 1 else 0 end, 0)),0) as ITEM8,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '7' then 1 else 0 end, 0)),0) as ITEM9,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '8' then 1 else 0 end, 0)),0) as ITEM10,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '1' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '2' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '310' or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) <> 0 ) then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '320' or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) = 0 ) then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '5' or master.DSP_RQ_KND_CD = '630' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '611' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 2) = '62' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '610' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '7' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '8' then 1 else 0 end, 0)),0) as ITEM11
			  FROM TBBADEAR001M master,
			       TBBADEAR002D detail
			 WHERE 1=1
			   AND master.AUD_YR = detail.AUD_YR
			   AND master.AUD_NO = detail.AUD_NO
			   AND master.DSP_RQ_SNO = detail.DSP_RQ_SNO
			   AND SUBSTR(master.DSP_RQ_KND_CD, 1, 1) NOT IN ('4','9')
			   AND detail.AUD_YR = #{audYr}
			   AND detail.AUD_NO = #{audNo}
			   AND detail.ENFM_MNG_BRDV_CD = #{enfmMngBrdvCd}   
			   AND NVL(detail.DTM_STA_CD,'0') = '2'
			   
			UNION ALL
			
			SELECT '이행 계' as TITLE ,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '1' then 1 else 0 end, 0)),0) as ITEM1,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '2' then 1 else 0 end, 0)),0) as ITEM2,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '310' 
			                         or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) <> 0 ) then 1 else 0 end, 0)),0) as ITEM3,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '320' 
			                         or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) = 0 ) then 1 else 0 end, 0)),0) as ITEM4,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '5' or master.DSP_RQ_KND_CD = '630' then 1 else 0 end, 0)),0) as ITEM5,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '611' then 1 else 0 end, 0)),0) as ITEM6,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 2) = '62' then 1 else 0 end, 0)),0) as ITEM7,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '610' then 1 else 0 end, 0)),0) as ITEM8,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '7' then 1 else 0 end, 0)),0) as ITEM9,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '8' then 1 else 0 end, 0)),0) as ITEM10,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '1' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '2' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '310' or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) <> 0 ) then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '320' or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) = 0 ) then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '5' or master.DSP_RQ_KND_CD = '630' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '611' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 2) = '62' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '610' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '7' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '8' then 1 else 0 end, 0)),0) as ITEM11
			  FROM TBBADEAR001M master,
			       TBBADEAR002D detail
			 WHERE 1=1
			   AND master.AUD_YR = detail.AUD_YR
			   AND master.AUD_NO = detail.AUD_NO
			   AND master.DSP_RQ_SNO = detail.DSP_RQ_SNO
			   AND SUBSTR(master.DSP_RQ_KND_CD, 1, 1) NOT IN ('4','9')
			   AND detail.AUD_YR = #{audYr}
			   AND detail.AUD_NO = #{audNo}
			   AND detail.ENFM_MNG_BRDV_CD = #{enfmMngBrdvCd}   
			   AND ((
			         NVL(detail.DTM_YN,'N') = 'Y'
			         AND NVL(detail.DTM_STA_CD,'0') = '1'
			         AND NVL(detail.DSP_RQ_APV_STA_CD,'1') IN ('','1','4','5')           
			       ) 
			       OR (NVL(detail.DTM_STA_CD,'0') = '2')
			   )
			   
			UNION ALL
			
			SELECT '미이행사항' as TITLE ,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '1' then 1 else 0 end, 0)),0) as ITEM1,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '2' then 1 else 0 end, 0)),0) as ITEM2,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '310' 
			                         or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) <> 0 ) then 1 else 0 end, 0)),0) as ITEM3,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '320' 
			                         or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) = 0 ) then 1 else 0 end, 0)),0) as ITEM4,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '5' or master.DSP_RQ_KND_CD = '630' then 1 else 0 end, 0)),0) as ITEM5,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '611' then 1 else 0 end, 0)),0) as ITEM6,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 2) = '62' then 1 else 0 end, 0)),0) as ITEM7,
			       NVL(sum(NVL(case when master.DSP_RQ_KND_CD = '610' then 1 else 0 end, 0)),0) as ITEM8,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '7' then 1 else 0 end, 0)),0) as ITEM9,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '8' then 1 else 0 end, 0)),0) as ITEM10,
			       NVL(sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '1' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '2' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '310' or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) <> 0 ) then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '320' or (master.DSP_RQ_KND_CD IN ('391','396') and NVL(detail.PNL_DRIN_PSVT_AM, 0) = 0 ) then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '5' or master.DSP_RQ_KND_CD = '630' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '611' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 2) = '62' then 1 else 0 end, 0))
			       + sum(NVL(case when master.DSP_RQ_KND_CD = '610' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '7' then 1 else 0 end, 0))
			       + sum(NVL(case when SUBSTR(master.DSP_RQ_KND_CD, 1, 1) = '8' then 1 else 0 end, 0)),0) as ITEM11
			  FROM TBBADEAR001M master,
			       TBBADEAR002D detail
			 WHERE 1=1
			   AND master.AUD_YR = detail.AUD_YR
			   AND master.AUD_NO = detail.AUD_NO
			   AND master.DSP_RQ_SNO = detail.DSP_RQ_SNO
			   AND SUBSTR(master.DSP_RQ_KND_CD, 1, 1) NOT IN ('4','9')
			   AND detail.AUD_YR = #{audYr}
			   AND detail.AUD_NO = #{audNo}
			   AND detail.ENFM_MNG_BRDV_CD = #{enfmMngBrdvCd}   
			   AND NVL(detail.DTM_YN,'N') <> 'Y'
			   AND NVL(detail.DSP_RQ_APV_STA_CD,'1') IN ('','1','4','5')
        ]]>
	</select>
	
	
	<!-- 상황 확인표 BADFRE001ERep52select -->
	<select id="selectStatusFlagRep" parameterType="paramMap" resultType="resultMap">
        <![CDATA[
		SELECT 
		      F_MNG_KND_AUDYRNO(D3.AUD_YR, D3.AUD_NO, SUBSTR(D3.AUD_KND_CD,3), '-') ||'-'|| D1.DSP_RQ_SNO AS HEAD1 
		     , D2.ENF_DT AS HEAD2
		     , F_MNG_KND_AUDYRNO(D3.AUD_YR, D3.AUD_NO, SUBSTR(D3.AUD_KND_CD,3), '-') ||'-'|| D1.DSP_RQ_SNO AS HEAD3 
		     , D3.AUD_SBJ_NM AS HEAD4
		     , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = D2.ENFM_MNG_BRDV_CD AND ROWNUM = 1) AS HEAD5
		     , D2.DSP_RQ_SRNO AS ITEM1
		     , F_ORG_INFO(D2.COPT_OFI_CD, '1') AS ITEM2
		     , F_CODE_NM('1000002', D1.DSP_RQ_KND_CD) AS ITEM3
		     , D1.TIT_TXT AS ITEM4
		     , (
		       SELECT MIN(ST2.ORG_NM) || DECODE((COUNT(DISTINCT ST1.RLTN_ORG_CD) - 1),0,'',' 외 ' || (COUNT(DISTINCT ST1.RLTN_ORG_CD) - 1))			       
		                  FROM TBBADEAR006M ST1, TBDCMACM015M ST2
		                 WHERE ST1.RLTN_ORG_CD = ST2.ORG_CD
		                   AND ST1.AUD_YR = D2.AUD_YR
		                   AND ST1.AUD_NO = D2.AUD_NO
		                   AND ST1.DSP_RQ_SNO = D2.DSP_RQ_SNO
		                 GROUP BY ST1.AUD_YR, ST1.AUD_NO, ST1.DSP_RQ_SNO 
					       ) AS ITEM5
		     , '1' /* D2.NOP_CNT */  AS ITEM6
		     , F_CODE_NM('1000283', D2.EPT_EFCT_AM_STA_CD) AS ITEM7
		     , NVL(D2.PNL_DRIN_PSVT_AM, 0) AS ITEM8
		     , F_CODE_NM('1000057', D4.OCP_CD) AS ITEM9
		     , F_CODE_NM('1000058', D4.RANK_CD) AS ITEM10
		     , D4.DFNT_NAM AS ITEM11
		     , D4.HND_CD AS ITEM12
		     , D5.ENFM_HIS  AS ITEM13 
		     , D5.ENFM_DT   AS ITEM14
		     , D5.PNL_AM    AS ITEM15
		     , F_CODE_NM('1000003', D5.ENFM_SHP_CD) AS ITEM16
		     , '' AS ITEM17
		     , '' AS ITEM18
		     , '' AS ITEM19
		     , '' AS ITEM20
		     , '' AS ITEM21     
		     , (SELECT COUNT(*) 
		          FROM TBBADEAR006M ST1
		         WHERE 1=1
		           AND ST1.AUD_YR = D2.AUD_YR
		           AND ST1.AUD_NO = D2.AUD_NO
		           AND ST1.DSP_RQ_SNO = D2.DSP_RQ_SNO
		         GROUP BY ST1.AUD_YR, ST1.AUD_NO, ST1.DSP_RQ_SNO ) AS ITEM21       
		  FROM TBBADEAR001M D1
		     , TBBADEAR002D D2
		     , TBBADDED001M D3
		     , TBBADEAR007M D4
		     , TBBADFRE008M D5     
		 WHERE 1 = 1
		   AND D1.AUD_YR      = D2.AUD_YR
		   AND D1.AUD_NO      = D2.AUD_NO
		   AND D1.DSP_RQ_SNO  = D2.DSP_RQ_SNO
		   AND D1.AUD_YR      = D3.AUD_YR
		   AND D1.AUD_NO      = D3.AUD_NO
		   AND D2.AUD_YR      = D4.AUD_YR(+)
		   AND D2.AUD_NO      = D4.AUD_NO(+)
		   AND D2.DSP_RQ_SNO  = D4.DSP_RQ_SNO(+)
		   AND D2.RLTN_ORG_CD = D4.RLTN_ORG_CD(+)
		   AND D4.AUD_YR      = D5.AUD_YR(+)
		   AND D4.AUD_NO      = D5.AUD_NO(+)
		   AND D4.DSP_RQ_SNO  = D5.DSP_RQ_SNO(+)
		   AND D4.RLTN_ORG_CD = D5.RLTN_ORG_CD(+)
		   AND D4.DFNT_SNO    = D5.DFNT_SNO(+)
		   AND D1.AUD_YR      = #{audYr}
		   AND D1.AUD_NO      = #{audNo}
		   AND D1.DSP_RQ_SNO  = #{dspRqSno}
		        ]]>
	</select>
	
	
	<!-- 집행전말 목록조회 리포트  BADFRE001EMainselectReport  -->
	<select id="selectReportMain" parameterType="paramMap" resultType="resultMap">
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM002QMapper.selectReportMain */
        <![CDATA[
			SELECT TT.*,
			(SELECT ORG_NM
			   FROM TBDCMACM015M
			  WHERE ORG_CD = TT.COPT_OFI_CD
			    AND ROWNUM = 1) AS COPT_OFI_NM,
			(SELECT ABR_DPT_NM_1
			  FROM TBDCMACM002M
			 WHERE DPT_CD = TT.ENFM_MNG_BRDV_CD
			   AND ROWNUM = 1) AS ENFM_MNG_BRDV_NM,
            (SELECT ABR_DPT_NM_1
               FROM TBDCMACM002M
              WHERE DPT_CD = TT.OD_ENFM_MNG_BRDV_CD
                AND ROWNUM = 1) AS OD_ENFM_MNG_BRDV_NM,   			
            (SELECT ABR_DPT_NM_1
               FROM TBDCMACM002M
              WHERE DPT_CD = TT.ENF_BRDV_CD
               AND ROWNUM = 1) AS ENF_BRDV_NM,            /* 시행국과 추가 - 2018.01.31 yyh */                                                       
			F_CODE_NM('1000002', TT.DSP_RQ_KND_CD) AS DSP_RQ_KND_NM,
			F_CODE_NM('1000333', TT.DSP_RQ_APV_STA_CD) AS DSP_RQ_APV_STA_NM,
			(
			SELECT ST1.ENFM_WHLS_CHGR_CNB FROM TBDCMACM002M ST1
			WHERE ST1.DPT_CD LIKE '0%'
			  AND ST1.USE_YN = 'Y'
			  AND ST1.ORZT_DVSN_CD = '30'
			  AND ST1.DPT_CD = TT.ENFM_MNG_BRDV_CD
			  AND ROWNUM = 1
			) AS ENFM_WHLS_CHGR_CNB,
			(SELECT MIN(ST2.ORG_NM) || DECODE((COUNT(DISTINCT ST1.RLTN_ORG_CD) - 1),0,'',' 외 ' || (COUNT(DISTINCT ST1.RLTN_ORG_CD) - 1))			       
			           FROM TBBADEAR006M ST1, TBDCMACM015M ST2
			          WHERE ST1.RLTN_ORG_CD = ST2.ORG_CD
			            AND ST1.AUD_YR = TT.AUD_YR
			            AND ST1.AUD_NO = TT.AUD_NO
			            AND ST1.DSP_RQ_SNO = TT.DSP_RQ_SNO
			          GROUP BY ST1.AUD_YR, ST1.AUD_NO, ST1.DSP_RQ_SNO 
			) AS RLTN_ORG_NM
			  FROM (SELECT T.* ,
			               ROW_NUMBER() OVER(
			                 ORDER BY AUD_YR DESC, AUD_NO DESC, DSP_RQ_SNO DESC ) AS NUM
			          FROM (SELECT DT.* ,
			                       COUNT(1) OVER() AS TOT_CNT
			                  FROM (
			                  
			        
						SELECT
						       T1.AUD_YR,
						       T1.AUD_NO,
						       T2.DSP_RQ_SNO,
						       F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') ||'-'||T2.DSP_RQ_SNO AS TOT_DSP_RQ_NO,
						       T1.AUD_SBJ_NM,
						       T2.TIT_TXT,
						       T3.HNDL_DDLN_DT,
						       T3.COPT_OFI_CD,
			                   T3.ENFM_MNG_BRDV_CD,
			                   T3.DSP_RQ_APV_STA_CD,
			                   T3.DTM_YN,
			                   /* DECODE(T3.DTM_STA_CD, '2', '확정', '1', DECODE(T3.DSP_RQ_APV_STA_CD, '3', '완결', '미결') , '') AS DTM_YN_NM, */
			                   
			                   CASE WHEN T3.DTM_STA_CD = '2'                                
			                             THEN '확정'
			                        WHEN T3.DTM_STA_CD = '1' AND  T3.DSP_RQ_APV_STA_CD  = '3'                                   
			                             THEN '완결' || CASE WHEN T3.CPLT_STA_DVSN_CD IS NOT NULL     THEN '(' || DECODE(T3.CPLT_STA_DVSN_CD,'1','완결','종결') || ')' 
			                                                     ELSE '' 
			                                            END
			                        WHEN T3.DTM_STA_CD = '1' AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD <> '3') 
			                             THEN '미결' || CASE WHEN T3.NOT_CPLT_STA_DVSN_CD IS NOT NULL THEN '(' || DECODE(T3.NOT_CPLT_STA_DVSN_CD,'1','정상','집중') || ')' 
			                                                     ELSE '' 
			                                            END
			                        ELSE ''
			                    END  AS DTM_YN_NM, 
			                                       
			                   T1.AUD_KND_CD,
			                   T3.ENF_DT,
			                   T3.ENFM_WHLS_DTM_DT,
			                   T2.DSP_RQ_KND_CD,
			                   T3.EXAM_RPRT_DSP_RQ_SBT,
							   T3.EXAM_RPRT_UNENFM_RTWR_TXT, 
							   T3.EXAM_RPRT_UNENFM_RSN_EXAM_TXT,
							   T3.APV_DOC_NO,
							   T3.OD_ENFM_MNG_BRDV_CD,
							   T3.ENF_BRDV_CD 
						  FROM TBBADDED001M T1,
						       TBBADEAR001M T2,
						       TBBADEAR002D T3
						 WHERE 1 = 1
						   AND T1.AUD_YR = T2.AUD_YR
						   AND T1.AUD_NO = T2.AUD_NO
						   AND T2.AUD_YR = T3.AUD_YR
						   AND T2.AUD_NO = T3.AUD_NO
						   AND T2.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   	/*
						   	  % 아래 6개는 감사결과 처분요구 입력시 바로 집행확정 처리함
								1000002	390	현지시정
								1000002	410	주의
								1000002	490	현지주의
								1000002	710	직접고발
								1000002	720	자체고발
								1000002	730	수사요청
							  % 아래 18개가 집행전말 처리 대상 종류
								1000002	110	변상판정
								1000002	210	징계문책
								1000002	310	시정(금액)
								1000002	320	시정(기타)
								1000002	391	현지시정회
								1000002	396 시정(국장전결)회
								1000002	510	법령상개선
								1000002	520	제도상개선
								1000002	530	행정상개선
								1000002	610	통보
								1000002	611	권고
								1000002	620	통보(인사)
								1000002	621	통보(징계)
								1000002	623	통보(비위)
								1000002	630	통보개선
								1000002	810	모범(예산절감)
								1000002	820	모범(업무개선)
								1000002	830	모범(성실근무)
								1000002	840	모범(민원해소)
								1000002	850	모범(기타)				
							*/
						   AND T2.DSP_RQ_KND_CD IN ('110','210','310','320','391','396','620','621','623','630','510','520','530','610','611','810','820','830','840','850')
						   /* 집행전말 대상은 처분요구확정 이후 상태 건 들임. */
						   AND T3.DTM_STA_CD IN ('1','2')      
					]]>
					
				<if test='dptSrchYn == "N"'>		
					/* 권한이 없는 일선 과 */
					
					/* 모든 국과선택이 전체일 경우 */
					<if test="enfBrdvCd_1 eq '' and enfBrdvCd_2 eq '' and upSpvBrdvCd eq '' and enfmMngBrdvCd eq ''">
						AND (
						         T3.ENF_BRDV_CD          IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', '')))
						      OR 
						      	 T3.ENFM_MNG_BRDV_CD     IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', '')))
							  OR 
							   	 T3.OD_ENFM_MNG_BRDV_CD  IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', '')))						      	 
						    )
					</if>
					
					<if test='enfBrdvCd_1 != "" or upSpvBrdvCd != "" or odUpSpvBrdvCd != ""'>
					
						<!-- 시행국과 -->
						<if test='enfBrdvCd_1 != null and enfBrdvCd_1 != ""'>
							AND T3.ENF_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{enfBrdvCd_1})))
						</if>
						<if test='enfBrdvCd_2 != null and enfBrdvCd_2 != ""'>
							AND T3.ENF_BRDV_CD = #{enfBrdvCd_2}
						</if>
				
						<!-- 이행국과 -->
						<if test='upSpvBrdvCd != null and upSpvBrdvCd != ""'>
							AND T3.ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{upSpvBrdvCd})))
						</if>
						<if test='enfmMngBrdvCd != null and enfmMngBrdvCd != ""'>
							AND T3.ENFM_MNG_BRDV_CD     = #{enfmMngBrdvCd}
						</if>
												
						<!-- 이전국과 -->
						<if test='odUpSpvBrdvCd != null and odUpSpvBrdvCd != ""'>
							AND T3.OD_ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{odUpSpvBrdvCd})))
						</if>
						<if test='odEnfmMngBrdvCd != null and odEnfmMngBrdvCd != ""'>
							AND T3.OD_ENFM_MNG_BRDV_CD     = #{odEnfmMngBrdvCd}
						</if>						
						
					</if>
				</if>
		
				<if test='dptSrchYn == "Y"'>
					/* 이행관리과 등 권한이 있는 과*/
			
					<!-- 시행국과 -->
					<if test='enfBrdvCd_1 != null and enfBrdvCd_1 != ""'>
						AND T3.ENF_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{enfBrdvCd_1})))
					</if>			
					<if test='enfBrdvCd_2 != null and enfBrdvCd_2 != ""'>
						AND T3.ENF_BRDV_CD = #{enfBrdvCd_2}
					</if>
			
					<!-- 이행국과 -->
					AND T3.ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{upSpvBrdvCd})))
			
					<if test='enfmMngBrdvCd != null and enfmMngBrdvCd != ""'> 	   
						AND T3.ENFM_MNG_BRDV_CD     = #{enfmMngBrdvCd}
					</if>
					
					<!-- 이전국과 -->
					<if test='odUpSpvBrdvCd != null and odUpSpvBrdvCd != ""'>
						AND T3.OD_ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{odUpSpvBrdvCd})))
					</if>
					<if test='odEnfmMngBrdvCd != null and odEnfmMngBrdvCd != ""'>
						AND T3.OD_ENFM_MNG_BRDV_CD     = #{odEnfmMngBrdvCd}
					</if>						
				</if>
									
				<if test='audYr != null and audYr != ""'>
					   AND T1.AUD_YR               = #{audYr}
				</if>
				<!-- 검색조건을 감사번호에서 감사부여번호로 변경 - 2016.06.02 yyh -->
				<if test='audGrnNo != null and audGrnNo != ""'>
					   AND T1.AUD_GRN_NO           = #{audGrnNo}
				</if>
				<if test='dspRqSno != null and dspRqSno != ""'>
					   AND T2.DSP_RQ_SNO           = #{dspRqSno}
				</if>
				<if test='titTxt != null and titTxt != ""'>
					   AND T2.TIT_TXT              LIKE '%'||#{titTxt}||'%'
				</if>
				<!-- isNotEmpty property="coptoficd">	 	   
					   AND T3.COPT_OFI_CD          = #{coptoficd} 
				</isNotEmpty -->
				<!--  isNotEmpty property="rltnorgcd">	 	   
					   AND T3.RLTN_ORG_CD          = #{rltnorgcd} 
				</isNotEmpty -->
				<if test='rltnOrgCd != null and rltnOrgCd != ""'>
					   AND EXISTS (
					   	SELECT ST1.RLTN_ORG_CD
					   	FROM TBBADEAR006M ST1
					   	WHERE 1 = 1
					   	AND ST1.AUD_YR = T1.AUD_YR
					   	AND ST1.AUD_NO = T1.AUD_NO
					   	AND ST1.DSP_RQ_SNO = T2.DSP_RQ_SNO
					   	AND ST1.RLTN_ORG_CD = #{rltnOrgCd}
					   )
					   
				</if>
				<if test='enfDtFrom != null and enfDtFrom != ""'>
					   AND T3.ENF_DT               >= REPLACE(#{enfDtFrom},'-','')
				</if>
				<if test='enfDtTo != null and enfDtTo != ""'>
					   AND REPLACE(#{enfDtTo},'-','')            >= T3.ENF_DT 
				</if>
				<if test='dspRqDtmDtFrom != null and dspRqDtmDtFrom != ""'>
					   AND T3.ENFM_WHLS_DTM_DT        >= REPLACE(#{dspRqDtmDtFrom},'-','')
				</if>
				<if test='dspRqDtmDtTo != null and dspRqDtmDtTo != ""'>
					   AND REPLACE(#{dspRqDtmDtTo},'-','')       >= T3.ENFM_WHLS_DTM_DT 
				</if>
				
				<if test='notEnfmStaCd == "1"'>
					   <!-- 고위험 관리 지정 -->
					<![CDATA[
					   /* 주석처리 - 2016.05.13 yyh   
					   AND T3.HRK_MNG_ASG_YN = 'Y' */
					]]>   
				</if>
				<if test='notEnfmStaCd == "2"'>
				    <!-- 미집행(확정이아닌것) + 처리기한내 -->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
				       AND TO_CHAR(SYSDATE, 'YYYYMMDD') <= T3.HNDL_DDLN_DT
				    ]]>   
				</if>
				<if test='notEnfmStaCd == "3"'>
				    <!-- 미집행(확정이아닌것) + 처리기한경과 -->
				    <![CDATA[
				       AND T3.DTM_STA_CD = '1'
					   AND TO_CHAR(SYSDATE, 'YYYYMMDD') > T3.HNDL_DDLN_DT
					]]>
				</if>
				
				<if test='dspRqKndCd != null and dspRqKndCd != "" and dspRqKndCd != "000"'>
					<if test='dspRqKndCd != "300"'>
						<if test='dspRqKndCd != "500"'>
							<if test='dspRqKndCd != "800"'>
								<!-- 
								     전체, 시정전체, 개선전체, 모범전체가 아닌경우는 해당 코드로 바로 조회 
								-->
								AND T2.DSP_RQ_KND_CD = #{dspRqKndCd}	
							</if>
						</if>
					</if>	
					
					<if test='dspRqKndCd == "300"'>
						<!-- 
						     300(시정) = 시정(금액)+시정(기타)+현지시정회 +시정(국장전결)회
						-->
						AND T2.DSP_RQ_KND_CD IN ('310','320','391','396')
					</if>
					<if test='dspRqKndCd == "500"'>
						<!-- 
						     500(개선) = 법령상개선+제도상개선+행정상개선 
						-->
						AND T2.DSP_RQ_KND_CD IN ('510','520','530')
					</if>
					<if test='dspRqKndCd == "800"'>
						<!-- 
						     800(모범) = 예산절감+업무개선+성실근무+민원해소+기타 
						-->
						AND T2.DSP_RQ_KND_CD IN ('810','820','830','840','850')
					</if>
				</if>
					
				<if test='enfmGubunCd == "1"'>
					<!-- 
					     처분요구
					-->
					AND T2.DSP_RQ_KND_CD IN ('110', '210', '310', '320', '391', '396', '810', '820', '830', '840', '850')
				</if>
				<if test='enfmGubunCd == "2"'>
					<!-- 
					     권고.통보 
					-->
					AND T2.DSP_RQ_KND_CD IN ('510','520','530','610','611', '620', '621', '623', '630')
				</if>
				
				<if test='dtmStaCd == "1"'>
					<!-- 
					     미결
					     1(처분요구확정) + 처분요구결재상태  <> 3(결재완료)
					     
					-->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
					   AND NVL(T3.DSP_RQ_APV_STA_CD,'0') <> '3'
					   
					]]>
				</if>
				<if test='dtmStaCd == "2"'>
					<!-- 
					     완결
					     1(처분요구확정) + 처분요구결재상태  = 3(결재완료)
					     
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND NVL(T3.DSP_RQ_APV_STA_CD,'0') = '3'
					   
				</if>
				<if test='dtmStaCd == "3"'>
						<!-- 
						     집행확정
						     2(처분요구확정) 
						-->
					   AND T3.DTM_STA_CD = '2'
				</if>
				
				<if test='notCpltStaDvsnCd != null and notCpltStaDvsnCd != ""'>
					<!-- 미결구분 - 2016.05.19 yyh  -->
					AND T3.NOT_CPLT_STA_DVSN_CD = #{notCpltStaDvsnCd}
				</if>
				
				<if test='cpltStaDvsnCd != null and cpltStaDvsnCd != ""'>
					<!-- 완결구분 - 2016.05.19 yyh  -->
					AND T3.CPLT_STA_DVSN_CD = #{cpltStaDvsnCd}
				</if>
				
				<!--  isNotEqual property="clsgprssstacd" compareValue="0">
					   AND T3.CLSG_PRSS_STA_CD = #{clsgprssstacd}
				</isNotEqual -->
				<if test='dspRqApvStaCd != "0" and dspRqApvStaCd != null and  dspRqApvStaCd != "" '>
						<!-- 
						             조회조건
							결재상태코드 : 2 (결재중) / 3 (승인) / 4(반려)
							                       나머지 1(상신전),5(상신취소),null -> (상신전) 
						-->
					   AND DECODE(T3.DSP_RQ_APV_STA_CD,'2','2','3','3','4','4','1') = #{dspRqApvStaCd}
					   
				</if>
				
				<!-- isNotEqual property="dsprqkndcd" compareValue="000">
					   AND T2.DSP_RQ_KND_CD = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000002'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{dsprqkndcd}
											       AND ROWNUM = 1
										       )
				</if>
				<if test='dtmstacd != "0"'>
					   AND T3.DTM_STA_CD    = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000017'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{dtmstacd}
											       AND ROWNUM = 1
										       )
				</if>
				<if test='clsgprssstacd != "0"'>
					   AND T3.CLSG_PRSS_STA_CD = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000336'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{clsgprssstacd}
											       AND ROWNUM = 1
										       )
				</if>
				<if test='dsprqapvstacd != "0"'>
					   AND T3.DSP_RQ_APV_STA_CD = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000333'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{dsprqapvstacd}
											       AND ROWNUM = 1
										       )
				</isNotEqual -->
				<!--  isNotEqual property="dtmyn" compareValue="0">
					   AND T3.DTM_YN = #{dtmyn}
				</isNotEqual -->
				<if test='selectedtab == "1"'>
				<!-- 
					집행전말관리 집행회보접수 탭 선택시 추가되는 WHERE절
				 	: 접수일 IS NULL
				-->
					   AND EXISTS (
						   SELECT AUD_YR FROM TBBADFRE001H ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND ST1.BAI_CHGD_ACP_DT IS NULL
					   )
				</if>
				<if test='selectedtab == "2"'>
				<!-- 
					집행전말관리 검토의견작성 탭 선택시 추가되는 WHERE절 
					: 검토결과가 없는 건
				-->
					   AND EXISTS (
						   SELECT AUD_YR FROM TBBADFRE001H ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND (
		             	       ST1.ENFM_WHLS_APV_STA_CD IS NULL
		                       OR ST1.ENFM_WHLS_APV_STA_CD NOT IN ('3')
		           		   )
					   )
				</if>
				<if test='selectedtab == "3"'>
				<!-- 
					집행전말관리 집행완결처리 탭 선택시 추가되는 WHERE절 
					: 확정상태코드 : 처분확정(1) & 확정여부 : 미확정(N)
					  & 관계기관 완결 : 전부Y & 관계자 완결 : 전부Y
				-->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
					   AND NVL(T3.DTM_YN,'N') <> 'Y' 
					   AND NOT EXISTS (
						   SELECT AUD_YR FROM TBBADEAR006M ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND (
		                       ST1.CPLT_YN IS NULL
		                       OR ST1.CPLT_YN = 'N'
		                   )
					   )
					   AND NOT EXISTS (
						   SELECT AUD_YR FROM TBBADEAR007M ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND (
		                       ST1.CPLT_YN IS NULL
		                       OR ST1.CPLT_YN = 'N'
		                   )
					   )
					]]> 
				</if>
				
				<if test='selectedtab == "4"'>
					<if test='selectedtab2 == "0"'>
					<!-- 
						집행전말관리 집행상황 결재&결산송부 탭 + 권고통보사항(국장전결)
						선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 확정여부 : 확정(Y) 
						  & 집행전말결재종류코드 : 권고통보사항(국장전결)(1) & 처분요구결재상태코드 : 승인(3) 이 아닌것
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.ENFM_WHLS_APV_KND_CD = '1'
					   AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD NOT IN ('3'))
					</if>
					<if test='selectedtab2 == "1"'>
					<!-- 
						집행전말관리 집행상황 결재&결산송부 탭 + 권고통보외처분요구사항(과장전결)
						선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 확정여부 : 확정(Y) 
						  & 집행전말결재종류코드 : 권고통보외처분요구사항(과장전결)(2) & 처분요구결재상태코드 : 승인(3) 이 아닌것
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.ENFM_WHLS_APV_KND_CD = '2'
					   AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD NOT IN ('3'))
					</if>
					<if test='selectedtab2 == "2"'>
					<!-- 
						집행전말관리 집행상황 결재&결산송부 탭 + 처분요구대로집행되지아니한사항
						선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 확정여부 : 확정(Y) 
						  & 집행전말결재종류코드 : 처분요구대로집행되지아니한사항(3) & 처분요구결재상태코드 : 승인(3) 이 아닌것
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.ENFM_WHLS_APV_KND_CD = '3'
					   AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD NOT IN ('3'))
					</if>
				</if>
				
				<if test='selectedtab == "5"'>
					<if test='selectedtab3 == "0"'>
					<!-- 
						집행전말관리 집행전말 확정처리 탭(확정할사항 탭) 선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 완결여부 : 완결(Y) & 처분요구결재상태코드 : 결재완료(3)
						
						- 검토할사항으로 변경 - 2016.05.17 yyh 
					-->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.DSP_RQ_APV_STA_CD = '3'
					   AND (T3.DTM_APV_STA_CD IS NULL OR T3.DTM_APV_STA_CD <> '2')
					 ]]>
					</if>
					
					<if test='selectedtab3 == "1"'>
					<!-- 
						- 검토한사항 추가 - 2016.05.17 yyh
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.DSP_RQ_APV_STA_CD = '3'
					   AND T3.DTM_APV_STA_CD = '2' 			
					</if>			
					
					<if test='selectedtab3 == "2"'>
					<!-- 
						집행전말관리 집행전말 확정처리 탭(확정한사항 탭) 선택시 추가되는 WHERE절 
						: 확정상태코드 : 집행확정(2)
					-->
					   AND T3.DTM_STA_CD = '2'
					</if>
				</if>
				
				/* 감사연번종류코드 - 2015.12.22 yyh */
					<if test='audYrNoKndCd != null and audYrNoKndCd != ""'>
						  AND SUBSTR(T1.AUD_KND_CD,1,3) = #{audYrNoKndCd} 
					</if>		
				
				/* 관련자명, 조치요구 추가 - 2016.05.16 yyh */
				<if test='dfntNam != null and dfntNam != ""'>
					   AND EXISTS (
						           SELECT 1 
						             FROM TBBADEAR007M Y
						            WHERE 1=1
						              AND Y.AUD_YR     = T3.AUD_YR
						              AND Y.AUD_NO     = T3.AUD_NO
						              AND Y.DSP_RQ_SNO = T3.DSP_RQ_SNO
						              AND Y.DFNT_NAM LIKE '%' || #{dfntNam} || '%' 
						          )		
				</if>
				<if test='hndRqKndCd != null and hndRqKndCd != ""'>
					   AND EXISTS (
						           SELECT 1 
						             FROM TBBADEAR007M Y
						            WHERE 1=1
						              AND Y.AUD_YR        = T3.AUD_YR
						              AND Y.AUD_NO        = T3.AUD_NO
						              AND Y.DSP_RQ_SNO    = T3.DSP_RQ_SNO
						              AND Y.HND_RQ_KND_CD = SUBSTR(#{hndRqKndCd}, 4) 
						          )			
				</if>		
				
				<if test='mainEnfmMngTgYn != null and mainEnfmMngTgYn != ""'>
			           AND NVL(T3.MAIN_ENFM_MNG_TG_YN,'N') = #{mainEnfmMngTgYn}
				</if>
								
				<if test='enfmStepCd != null and enfmStepCd != ""'>
                       AND (SELECT MAX(ENFM_STEP_CD)
		                      FROM TBBADFRE001H Z1
		                     WHERE Z1.AUD_YR     = T3.AUD_YR
		                       AND Z1.AUD_NO     = T3.AUD_NO
		                       AND Z1.DSP_RQ_SNO = T3.DSP_RQ_SNO
		                       AND Z1.HST_NO     = (SELECT MAX(HST_NO)
		                                              FROM TBBADFRE001H Z2
      		                                         WHERE Z2.AUD_YR     = T3.AUD_YR
		                                               AND Z2.AUD_NO     = T3.AUD_NO
		                                               AND Z2.DSP_RQ_SNO = T3.DSP_RQ_SNO))  = #{enfmStepCd}  				
				</if>
								
				) DT
			                 ORDER BY AUD_YR DESC,
			                       AUD_NO DESC,
			                       DSP_RQ_SNO DESC ) T ) TT
	</select>
	
	<!-- 엑셀다운로드 - 2018.04.02 yyh  -->
	<select id="selectExcelExportList" parameterType="paramMap" resultType="egovMap" >
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM002QMapper.selectExcelExportList */
        <![CDATA[
						SELECT T1.AUD_YR
						      ,T1.AUD_NO
						      ,T2.DSP_RQ_SNO
						      ,F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') ||'-'||T2.DSP_RQ_SNO  AS TOT_DSP_RQ_NO
						      ,F_CODE_NM('1000002', T2.DSP_RQ_KND_CD)                                            AS DSP_RQ_KND_NM
						      ,T3.ENF_DT
						      ,T3.HNDL_DDLN_DT						      
						      ,T1.AUD_SBJ_NM
						      ,T2.TIT_TXT
						      ,F_DPT_INFO(T3.ENFM_MNG_BRDV_CD, '1')                                              AS ENFM_MNG_BRDV_NM
						      ,F_DPT_INFO(T3.OD_ENFM_MNG_BRDV_CD, '1')                                           AS OD_ENFM_MNG_BRDV_NM
							  ,F_DPT_INFO(T3.ENF_BRDV_CD, '1')                                                   AS ENF_BRDV_NM
							  ,F_ORG_INFO(T3.COPT_OFI_CD, '1')                                                   AS COPT_OFI_NM
                              ,(SELECT MIN(ST2.ORG_NM) || DECODE((COUNT(DISTINCT ST1.RLTN_ORG_CD) - 1),0,'',' 외 ' || (COUNT(DISTINCT ST1.RLTN_ORG_CD) - 1))			       
                                  FROM TBBADEAR006M ST1
                                      ,TBDCMACM015M ST2
                                 WHERE ST1.RLTN_ORG_CD = ST2.ORG_CD
                                   AND ST1.AUD_YR = T2.AUD_YR
                                   AND ST1.AUD_NO = T2.AUD_NO
                                   AND ST1.DSP_RQ_SNO = T2.DSP_RQ_SNO
                                 GROUP BY ST1.AUD_YR, ST1.AUD_NO, ST1.DSP_RQ_SNO)                                AS RLTN_ORG_NM
                              ,(SELECT MIN(ST2.ORG_NM) || DECODE((COUNT(DISTINCT ST1.ENFM_MNG_ORG_CD) - 1),0,'',' 외 ' || (COUNT(DISTINCT ST1.ENFM_MNG_ORG_CD) - 1))			       
                                  FROM TBBADEAR006M ST1
                                      ,TBDCMACM015M ST2
                                 WHERE ST1.ENFM_MNG_ORG_CD = ST2.ORG_CD
                                   AND ST1.AUD_YR = T2.AUD_YR
                                   AND ST1.AUD_NO = T2.AUD_NO
                                   AND ST1.DSP_RQ_SNO = T2.DSP_RQ_SNO
                                 GROUP BY ST1.AUD_YR, ST1.AUD_NO, ST1.DSP_RQ_SNO)                                AS ENFM_MNG_ORG_NM
                              ,T4.SLF_SEN_DT
                              ,F_CODE_NM('1000016', T4.ENFM_STEP_CD)                                             AS ENFM_STEP_NM
			                  ,F_CODE_NM('1000390', T4.EXAM_STA_CD)                                              AS EXAM_STA_NM
                              ,T4.CHGR_EXAM_DT                                                                   AS CHGR_EXAM_DT			                   
			                  ,CASE WHEN T3.DTM_STA_CD = '2'                                
			                             THEN '확정'
			                        WHEN T3.DTM_STA_CD = '1' AND  T3.DSP_RQ_APV_STA_CD  = '3'                                   
			                             THEN '완결' || CASE WHEN T3.CPLT_STA_DVSN_CD IS NOT NULL     THEN '(' || DECODE(T3.CPLT_STA_DVSN_CD,'1','완결','종결') || ')' 
			                                                     ELSE '' 
			                                            END
			                        WHEN T3.DTM_STA_CD = '1' AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD <> '3') 
			                             THEN '미결' || CASE WHEN T3.NOT_CPLT_STA_DVSN_CD IS NOT NULL THEN '(' || DECODE(T3.NOT_CPLT_STA_DVSN_CD,'1','정상','집중') || ')' 
			                                                     ELSE '' 
			                                            END
			                        ELSE ''
			                    END                                                                              AS DTM_YN_NM 
		                   	  ,DECODE((SELECT DECODE(COUNT(ST.DOC_ID),0,'N','Y')
										FROM TBBADDED111M ST
							           WHERE 1=1
							           AND T2.AUD_YR = ST.AUD_YR
									   AND T2.AUD_NO = ST.AUD_NO
							           AND ST.RPRT_CD = 'A10900900'
							           AND T2.DSP_RQ_SNO = ST.REF_ID),'N','-','작성')  AS RPRT_YN
							  ,CASE WHEN (SELECT COUNT(1)
										    FROM TBBADFRE012M ST1
										    WHERE ST1.AUD_YR = T3.AUD_YR
										    AND ST1.AUD_NO = T3.AUD_NO
										    AND ST1.ACP_DVSN_CD = '2'
										    AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO)< 1
							 THEN '-'
							ELSE '재심' END AS JESIM_YN
			                  ,T3.ENFM_WHLS_DTM_DT                   
                              ,F_CODE_NM('1000333', T3.DSP_RQ_APV_STA_CD)                                        AS DSP_RQ_APV_STA_NM
						  FROM TBBADDED001M T1,
						       TBBADEAR001M T2,
						       TBBADEAR002D T3,
                               (SELECT Z1.AUD_YR
                                      ,Z1.AUD_NO 
                                      ,Z1.DSP_RQ_SNO
                                      ,MAX(SLF_SEN_DT)      AS SLF_SEN_DT
                                      ,MAX(ENFM_STEP_CD)    AS ENFM_STEP_CD
                                      ,MAX(BAI_CHGD_ACP_DT) AS BAI_CHGD_ACP_DT
                                      ,MAX(EXAM_STA_CD)     AS EXAM_STA_CD
                                      ,MAX(CHGR_EXAM_DT)    AS CHGR_EXAM_DT
                                 FROM TBBADFRE001H Z1
                                WHERE 1=1
                                  AND Z1.HST_NO = (SELECT MAX(HST_NO)
                                                     FROM TBBADFRE001H Z2
                                                    WHERE Z2.AUD_YR = Z1.AUD_YR
                                                      AND Z2.AUD_NO = Z1.AUD_NO
                                                      AND Z2.DSP_RQ_SNO = Z1.DSP_RQ_SNO)  
                                   GROUP BY Z1.AUD_YR, Z1.AUD_NO, Z1.DSP_RQ_SNO)  T4 						       
						 WHERE 1 = 1
						   AND T1.AUD_YR      = T2.AUD_YR
						   AND T1.AUD_NO      = T2.AUD_NO
						   AND T2.AUD_YR      = T3.AUD_YR
						   AND T2.AUD_NO      = T3.AUD_NO
						   AND T2.DSP_RQ_SNO  = T3.DSP_RQ_SNO
			    		   AND T3.AUD_YR 	  = T4.AUD_YR(+)
			    		   AND T3.AUD_NO 	  = T4.AUD_NO(+)
			    		   AND T3.DSP_RQ_SNO  = T4.DSP_RQ_SNO(+)    						   
						   
						   	/*
						   	  % 아래 6개는 감사결과 처분요구 입력시 바로 집행확정 처리함
								1000002	390	현지시정
								1000002	410	주의
								1000002	490	현지주의
								1000002	710	직접고발
								1000002	720	자체고발
								1000002	730	수사요청
							  % 아래 18개가 집행전말 처리 대상 종류
								1000002	110	변상판정
								1000002	210	징계문책
								1000002	310	시정(금액)
								1000002	320	시정(기타)
								1000002	391	현지시정회
								1000002	396	시정(국장전결)회
								1000002	510	법령상개선
								1000002	520	제도상개선
								1000002	530	행정상개선
								1000002	610	통보
								1000002	611	권고
								1000002	620	통보(인사)
								1000002	621	통보(징계)
								1000002	623	통보(비위)
								1000002	630	통보개선
								1000002	810	모범(예산절감)
								1000002	820	모범(업무개선)
								1000002	830	모범(성실근무)
								1000002	840	모범(민원해소)
								1000002	850	모범(기타)				
							*/
						   AND T2.DSP_RQ_KND_CD IN ('110','210','310','320','391','396','620','621','623','630','510','520','530','610','611','810','820','830','840','850')
						   /* 집행전말 대상은 처분요구확정 이후 상태 건 들임. */
						   AND T3.DTM_STA_CD IN ('1','2')      
					]]>
					
				<if test='dptSrchYn == "N"'>		
					/* 권한이 없는 일선 과 */
					
					/* 모든 국과선택이 전체일 경우 */
					<if test="enfBrdvCd_1 eq '' and enfBrdvCd_2 eq '' and upSpvBrdvCd eq '' and enfmMngBrdvCd eq ''">
						AND (
						         T3.ENF_BRDV_CD          IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', '')))
						      OR 
						      	 T3.ENFM_MNG_BRDV_CD     IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', '')))
							  OR 
							   	 T3.OD_ENFM_MNG_BRDV_CD  IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', '')))						      	 
						    )
					</if>
					<if test='rprtYn == "1"'>
							AND (SELECT DECODE(COUNT(ST.DOC_ID),0,'N','Y')
									FROM TBBADDED111M ST
							        WHERE 1=1
							        AND ST.AUD_YR = T2.AUD_YR
									AND ST.AUD_NO = T2.AUD_NO
									AND ST.REF_ID = T2.DSP_RQ_SNO
							        AND ST.RPRT_CD = 'A10900900'
							           ) = 'Y'				
				   </if>
				   <if test='rprtYn == "2"'>
							AND (SELECT DECODE(COUNT(ST.DOC_ID),0,'N','Y')
									FROM TBBADDED111M ST
							        WHERE 1=1
							        AND ST.AUD_YR = T2.AUD_YR
									AND ST.AUD_NO = T2.AUD_NO
									AND ST.REF_ID = T2.DSP_RQ_SNO
							        AND ST.RPRT_CD = 'A10900900'
							           ) = 'N'				
				   </if>
				   <if test='jesimYn == "1"'>
							AND (SELECT COUNT(1)
								   FROM TBBADFRE012M ST1
							       WHERE ST1.AUD_YR = T3.AUD_YR
							       AND ST1.AUD_NO = T3.AUD_NO
							       AND ST1.ACP_DVSN_CD = '2'
							       AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO) >= 1
				   </if>
				   <if test='jesimYn == "2"'>
							AND (SELECT COUNT(1)
								   FROM TBBADFRE012M ST1
							       WHERE ST1.AUD_YR = T3.AUD_YR
							       AND ST1.AUD_NO = T3.AUD_NO
							       AND ST1.ACP_DVSN_CD = '2'
							       AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO) = 0
				   </if>
					
					<if test='enfBrdvCd_1 != "" or upSpvBrdvCd != "" or odUpSpvBrdvCd != ""'>
					
						<!-- 시행국과 -->
						<if test='enfBrdvCd_1 != null and enfBrdvCd_1 != ""'>
							AND T3.ENF_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{enfBrdvCd_1})))
						</if>
						<if test='enfBrdvCd_2 != null and enfBrdvCd_2 != ""'>
							AND T3.ENF_BRDV_CD = #{enfBrdvCd_2}
						</if>
				
						<!-- 이행국과 -->
						<if test='upSpvBrdvCd != null and upSpvBrdvCd != ""'>
							AND T3.ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{upSpvBrdvCd})))
						</if>
						<if test='enfmMngBrdvCd != null and enfmMngBrdvCd != ""'>
							AND T3.ENFM_MNG_BRDV_CD     = #{enfmMngBrdvCd}
						</if>
												
						<!-- 이전국과 -->
						<if test='odUpSpvBrdvCd != null and odUpSpvBrdvCd != ""'>
							AND T3.OD_ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{odUpSpvBrdvCd})))
						</if>
						<if test='odEnfmMngBrdvCd != null and odEnfmMngBrdvCd != ""'>
							AND T3.OD_ENFM_MNG_BRDV_CD     = #{odEnfmMngBrdvCd}
						</if>						
						
					</if>
				</if>
		
				<if test='dptSrchYn == "Y"'>
					/* 이행관리과 등 권한이 있는 과*/
			
					<!-- 시행국과 -->
					<if test='enfBrdvCd_1 != null and enfBrdvCd_1 != ""'>
						AND T3.ENF_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{enfBrdvCd_1})))
					</if>			
					<if test='enfBrdvCd_2 != null and enfBrdvCd_2 != ""'>
						AND T3.ENF_BRDV_CD = #{enfBrdvCd_2}
					</if>
			
					<!-- 이행국과 -->
					AND T3.ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{upSpvBrdvCd})))
			
					<if test='enfmMngBrdvCd != null and enfmMngBrdvCd != ""'> 	   
						AND T3.ENFM_MNG_BRDV_CD     = #{enfmMngBrdvCd}
					</if>
					
					<!-- 이전국과 -->
					<if test='odUpSpvBrdvCd != null and odUpSpvBrdvCd != ""'>
						AND T3.OD_ENFM_MNG_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{odUpSpvBrdvCd})))
					</if>
					<if test='odEnfmMngBrdvCd != null and odEnfmMngBrdvCd != ""'>
						AND T3.OD_ENFM_MNG_BRDV_CD     = #{odEnfmMngBrdvCd}
					</if>			
					<if test='rprtYn == "1"'>
							AND (SELECT DECODE(COUNT(ST.DOC_ID),0,'N','Y')
									FROM TBBADDED111M ST
							        WHERE 1=1
							        AND ST.AUD_YR = T2.AUD_YR
									AND ST.AUD_NO = T2.AUD_NO
									AND ST.REF_ID = T2.DSP_RQ_SNO
							        AND ST.RPRT_CD = 'A10900900'
							           ) = 'Y'				
				   </if>
				   <if test='rprtYn == "2"'>
							AND (SELECT DECODE(COUNT(ST.DOC_ID),0,'N','Y')
									FROM TBBADDED111M ST
							        WHERE 1=1
							        AND ST.AUD_YR = T2.AUD_YR
									AND ST.AUD_NO = T2.AUD_NO
									AND ST.REF_ID = T2.DSP_RQ_SNO
							        AND ST.RPRT_CD = 'A10900900'
							           ) = 'N'				
				   </if>
				   <if test='jesimYn == "1"'>
							AND (SELECT COUNT(1)
								   FROM TBBADFRE012M ST1
							       WHERE ST1.AUD_YR = T3.AUD_YR
							       AND ST1.AUD_NO = T3.AUD_NO
							       AND ST1.ACP_DVSN_CD = '2'
							       AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO) >= 1
				   </if>
				   <if test='jesimYn == "2"'>
							AND (SELECT COUNT(1)
								   FROM TBBADFRE012M ST1
							       WHERE ST1.AUD_YR = T3.AUD_YR
							       AND ST1.AUD_NO = T3.AUD_NO
							       AND ST1.ACP_DVSN_CD = '2'
							       AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO) = 0
				   </if>			
				</if>
									
				<if test='audYr != null and audYr != ""'>
					   AND T1.AUD_YR               = #{audYr}
				</if>
				<!-- 검색조건을 감사번호에서 감사부여번호로 변경 - 2016.06.02 yyh -->
				<if test='audGrnNo != null and audGrnNo != ""'>
					   AND T1.AUD_GRN_NO           = #{audGrnNo}
				</if>
				<if test='dspRqSno != null and dspRqSno != ""'>
					   AND T2.DSP_RQ_SNO           = #{dspRqSno}
				</if>
				<if test='titTxt != null and titTxt != ""'>
					   AND T2.TIT_TXT              LIKE '%'||#{titTxt}||'%'
				</if>
				<!-- isNotEmpty property="coptoficd">	 	   
					   AND T3.COPT_OFI_CD          = #{coptoficd} 
				</isNotEmpty -->
				<!--  isNotEmpty property="rltnorgcd">	 	   
					   AND T3.RLTN_ORG_CD          = #{rltnorgcd} 
				</isNotEmpty -->
				<if test='rltnOrgCd != null and rltnOrgCd != ""'>
					   AND EXISTS (
					   	SELECT ST1.RLTN_ORG_CD
					   	FROM TBBADEAR006M ST1
					   	WHERE 1 = 1
					   	AND ST1.AUD_YR = T1.AUD_YR
					   	AND ST1.AUD_NO = T1.AUD_NO
					   	AND ST1.DSP_RQ_SNO = T2.DSP_RQ_SNO
					   	AND ST1.RLTN_ORG_CD = #{rltnOrgCd}
					   )
					   
				</if>
				<if test='enfDtFrom != null and enfDtFrom != ""'>
					   AND T3.ENF_DT               >= REPLACE(#{enfDtFrom},'-','')
				</if>
				<if test='enfDtTo != null and enfDtTo != ""'>
					   AND REPLACE(#{enfDtTo},'-','')            >= T3.ENF_DT 
				</if>
				<if test='dspRqDtmDtFrom != null and dspRqDtmDtFrom != ""'>
					   AND T3.ENFM_WHLS_DTM_DT        >= REPLACE(#{dspRqDtmDtFrom},'-','')
				</if>
				<if test='dspRqDtmDtTo != null and dspRqDtmDtTo != ""'>
					   AND REPLACE(#{dspRqDtmDtTo},'-','')       >= T3.ENFM_WHLS_DTM_DT 
				</if>
				
				<if test='notEnfmStaCd == "1"'>
					   <!-- 고위험 관리 지정 -->
					<![CDATA[
					   /* 주석처리 - 2016.05.13 yyh   
					   AND T3.HRK_MNG_ASG_YN = 'Y' */
					]]>   
				</if>
				<if test='notEnfmStaCd == "2"'>
				    <!-- 미집행(확정이아닌것) + 처리기한내 -->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
				       AND TO_CHAR(SYSDATE, 'YYYYMMDD') <= T3.HNDL_DDLN_DT
				    ]]>   
				</if>
				<if test='notEnfmStaCd == "3"'>
				    <!-- 미집행(확정이아닌것) + 처리기한경과 -->
				    <![CDATA[
				       AND T3.DTM_STA_CD = '1'
					   AND TO_CHAR(SYSDATE, 'YYYYMMDD') > T3.HNDL_DDLN_DT
					]]>
				</if>
				
				<if test='dspRqKndCd != null and dspRqKndCd != "" and dspRqKndCd != "000"'>
					<if test='dspRqKndCd != "300"'>
						<if test='dspRqKndCd != "500"'>
							<if test='dspRqKndCd != "800"'>
								<!-- 
								     전체, 시정전체, 개선전체, 모범전체가 아닌경우는 해당 코드로 바로 조회 
								-->
								AND T2.DSP_RQ_KND_CD = #{dspRqKndCd}	
							</if>
						</if>
					</if>	
					
					<if test='dspRqKndCd == "300"'>
						<!-- 
						     300(시정) = 시정(금액)+시정(기타)+현지시정회 +시정(국장전결)회
						-->
						AND T2.DSP_RQ_KND_CD IN ('310','320','391','396')
					</if>
					<if test='dspRqKndCd == "500"'>
						<!-- 
						     500(개선) = 법령상개선+제도상개선+행정상개선 
						-->
						AND T2.DSP_RQ_KND_CD IN ('510','520','530')
					</if>
					<if test='dspRqKndCd == "800"'>
						<!-- 
						     800(모범) = 예산절감+업무개선+성실근무+민원해소+기타 
						-->
						AND T2.DSP_RQ_KND_CD IN ('810','820','830','840','850')
					</if>
				</if>
					
				<if test='enfmGubunCd == "1"'>
					<!-- 
					     처분요구
					-->
					AND T2.DSP_RQ_KND_CD IN ('110', '210', '310', '320', '391', '396', '810', '820', '830', '840', '850')
				</if>
				<if test='enfmGubunCd == "2"'>
					<!-- 
					     권고.통보 
					-->
					AND T2.DSP_RQ_KND_CD IN ('510','520','530','610','611', '620', '621', '623', '630')
				</if>
				
				<if test='dtmStaCd == "1"'>
					<!-- 
					     미결
					     1(처분요구확정) + 처분요구결재상태  <> 3(결재완료)
					     
					-->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
					   AND NVL(T3.DSP_RQ_APV_STA_CD,'0') <> '3'
					   
					]]>
				</if>
				<if test='dtmStaCd == "2"'>
					<!-- 
					     완결
					     1(처분요구확정) + 처분요구결재상태  = 3(결재완료)
					     
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND NVL(T3.DSP_RQ_APV_STA_CD,'0') = '3'
					   
				</if>
				<if test='dtmStaCd == "3"'>
						<!-- 
						     집행확정
						     2(처분요구확정) 
						-->
					   AND T3.DTM_STA_CD = '2'
				</if>
				
				<if test='notCpltStaDvsnCd != null and notCpltStaDvsnCd != ""'>
					<!-- 미결구분 - 2016.05.19 yyh  -->
					AND T3.NOT_CPLT_STA_DVSN_CD = #{notCpltStaDvsnCd}
				</if>
				
				<if test='cpltStaDvsnCd != null and cpltStaDvsnCd != ""'>
					<!-- 완결구분 - 2016.05.19 yyh  -->
					AND T3.CPLT_STA_DVSN_CD = #{cpltStaDvsnCd}
				</if>
				
				<!--  isNotEqual property="clsgprssstacd" compareValue="0">
					   AND T3.CLSG_PRSS_STA_CD = #{clsgprssstacd}
				</isNotEqual -->
				<if test='dspRqApvStaCd != "0" and dspRqApvStaCd != null and  dspRqApvStaCd != "" '>
						<!-- 
						     조회조건
							결재상태코드 : 2 (결재중) / 3 (승인) / 4(반려)
							                       나머지 1(상신전),5(상신취소),null -> (상신전) 
						-->
					   AND DECODE(T3.DSP_RQ_APV_STA_CD,'2','2','3','3','4','4','1') = #{dspRqApvStaCd}
					   
				</if>
				
				<!-- isNotEqual property="dsprqkndcd" compareValue="000">
					   AND T2.DSP_RQ_KND_CD = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000002'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{dsprqkndcd}
											       AND ROWNUM = 1
										       )
				</if>
				<if test='dtmstacd != "0"'>
					   AND T3.DTM_STA_CD    = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000017'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{dtmstacd}
											       AND ROWNUM = 1
										       )
				</if>
				<if test='clsgprssstacd != "0"'>
					   AND T3.CLSG_PRSS_STA_CD = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000336'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{clsgprssstacd}
											       AND ROWNUM = 1
										       )
				</if>
				<if test='dsprqapvstacd != "0"'>
					   AND T3.DSP_RQ_APV_STA_CD = (
											    SELECT ST1.CD
											      FROM TBDCMACM013C ST1
											     WHERE ST1.CMM_CD_DVSN_CD = '1000333'
											       AND ST1.USE_YN = 'Y'
											       AND ST1.CD = #{dsprqapvstacd}
											       AND ROWNUM = 1
										       )
				</isNotEqual -->
				<!--  isNotEqual property="dtmyn" compareValue="0">
					   AND T3.DTM_YN = #{dtmyn}
				</isNotEqual -->
				<if test='selectedtab == "1"'>
				<!-- 
					집행전말관리 집행회보접수 탭 선택시 추가되는 WHERE절
				 	: 접수일 IS NULL
				-->
					   AND EXISTS (
						   SELECT AUD_YR FROM TBBADFRE001H ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND ST1.BAI_CHGD_ACP_DT IS NULL
					   )
				</if>
				<if test='selectedtab == "2"'>
				<!-- 
					집행전말관리 검토의견작성 탭 선택시 추가되는 WHERE절 
					: 검토결과가 없는 건
				-->
					   AND EXISTS (
						   SELECT AUD_YR FROM TBBADFRE001H ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND (
		             	       ST1.ENFM_WHLS_APV_STA_CD IS NULL
		                       OR ST1.ENFM_WHLS_APV_STA_CD NOT IN ('3')
		           		   )
					   )
				</if>
				<if test='selectedtab == "3"'>
				<!-- 
					집행전말관리 집행완결처리 탭 선택시 추가되는 WHERE절 
					: 확정상태코드 : 처분확정(1) & 확정여부 : 미확정(N)
					  & 관계기관 완결 : 전부Y & 관계자 완결 : 전부Y
				-->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
					   AND NVL(T3.DTM_YN,'N') <> 'Y' 
					   AND NOT EXISTS (
						   SELECT AUD_YR FROM TBBADEAR006M ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND (
		                       ST1.CPLT_YN IS NULL
		                       OR ST1.CPLT_YN = 'N'
		                   )
					   )
					   AND NOT EXISTS (
						   SELECT AUD_YR FROM TBBADEAR007M ST1 WHERE 1 = 1
						   AND ST1.AUD_YR = T3.AUD_YR
						   AND ST1.AUD_NO = T3.AUD_NO
						   AND ST1.DSP_RQ_SNO = T3.DSP_RQ_SNO
						   AND (
		                       ST1.CPLT_YN IS NULL
		                       OR ST1.CPLT_YN = 'N'
		                   )
					   )
					]]> 
				</if>
				
				<if test='selectedtab == "4"'>
					<if test='selectedtab2 == "0"'>
					<!-- 
						집행전말관리 집행상황 결재&결산송부 탭 + 권고통보사항(국장전결)
						선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 확정여부 : 확정(Y) 
						  & 집행전말결재종류코드 : 권고통보사항(국장전결)(1) & 처분요구결재상태코드 : 승인(3) 이 아닌것
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.ENFM_WHLS_APV_KND_CD = '1'
					   AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD NOT IN ('3'))
					</if>
					<if test='selectedtab2 == "1"'>
					<!-- 
						집행전말관리 집행상황 결재&결산송부 탭 + 권고통보외처분요구사항(과장전결)
						선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 확정여부 : 확정(Y) 
						  & 집행전말결재종류코드 : 권고통보외처분요구사항(과장전결)(2) & 처분요구결재상태코드 : 승인(3) 이 아닌것
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.ENFM_WHLS_APV_KND_CD = '2'
					   AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD NOT IN ('3'))
					</if>
					<if test='selectedtab2 == "2"'>
					<!-- 
						집행전말관리 집행상황 결재&결산송부 탭 + 처분요구대로집행되지아니한사항
						선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 확정여부 : 확정(Y) 
						  & 집행전말결재종류코드 : 처분요구대로집행되지아니한사항(3) & 처분요구결재상태코드 : 승인(3) 이 아닌것
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.ENFM_WHLS_APV_KND_CD = '3'
					   AND (T3.DSP_RQ_APV_STA_CD IS NULL OR T3.DSP_RQ_APV_STA_CD NOT IN ('3'))
					</if>
				</if>
				
				<if test='selectedtab == "5"'>
					<if test='selectedtab3 == "0"'>
					<!-- 
						집행전말관리 집행전말 확정처리 탭(확정할사항 탭) 선택시 추가되는 WHERE절 
						: 확정상태코드 : 처분확정(1) & 완결여부 : 완결(Y) & 처분요구결재상태코드 : 결재완료(3)
						
						- 검토할사항으로 변경 - 2016.05.17 yyh 
					-->
					<![CDATA[
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.DSP_RQ_APV_STA_CD = '3'
					   AND (T3.DTM_APV_STA_CD IS NULL OR T3.DTM_APV_STA_CD <> '2')
					 ]]>
					</if>
					
					<if test='selectedtab3 == "1"'>
					<!-- 
						- 검토한사항 추가 - 2016.05.17 yyh
					-->
					   AND T3.DTM_STA_CD = '1'
					   AND T3.DTM_YN = 'Y'
					   AND T3.DSP_RQ_APV_STA_CD = '3'
					   AND T3.DTM_APV_STA_CD = '2' 			
					</if>			
					
					<if test='selectedtab3 == "2"'>
					<!-- 
						집행전말관리 집행전말 확정처리 탭(확정한사항 탭) 선택시 추가되는 WHERE절 
						: 확정상태코드 : 집행확정(2)
					-->
					   AND T3.DTM_STA_CD = '2'
					</if>
				</if>
				
				/* 감사연번종류코드 - 2015.12.22 yyh */
					<if test='audYrNoKndCd != null and audYrNoKndCd != ""'>
						  AND SUBSTR(T1.AUD_KND_CD,1,3) = #{audYrNoKndCd} 
					</if>		
				
				/* 관련자명, 조치요구 추가 - 2016.05.16 yyh */
				<if test='dfntNam != null and dfntNam != ""'>
					   AND EXISTS (
						           SELECT 1 
						             FROM TBBADEAR007M Y
						            WHERE 1=1
						              AND Y.AUD_YR     = T3.AUD_YR
						              AND Y.AUD_NO     = T3.AUD_NO
						              AND Y.DSP_RQ_SNO = T3.DSP_RQ_SNO
						              AND Y.DFNT_NAM LIKE '%' || #{dfntNam} || '%' 
						          )		
				</if>
				<if test='hndRqKndCd != null and hndRqKndCd != ""'>
					   AND EXISTS (
						           SELECT 1 
						             FROM TBBADEAR007M Y
						            WHERE 1=1
						              AND Y.AUD_YR        = T3.AUD_YR
						              AND Y.AUD_NO        = T3.AUD_NO
						              AND Y.DSP_RQ_SNO    = T3.DSP_RQ_SNO
						              AND Y.HND_RQ_KND_CD = SUBSTR(#{hndRqKndCd}, 4) 
						          )			
				</if>		
				
				<if test='mainEnfmMngTgYn != null and mainEnfmMngTgYn != ""'>
			           AND NVL(T3.MAIN_ENFM_MNG_TG_YN,'N') = #{mainEnfmMngTgYn}
				</if>
								
				<if test='enfmStepCd != null and enfmStepCd != ""'>
                       AND (SELECT MAX(ENFM_STEP_CD)
		                      FROM TBBADFRE001H Z1
		                     WHERE Z1.AUD_YR     = T3.AUD_YR
		                       AND Z1.AUD_NO     = T3.AUD_NO
		                       AND Z1.DSP_RQ_SNO = T3.DSP_RQ_SNO
		                       AND Z1.HST_NO     = (SELECT MAX(HST_NO)
		                                              FROM TBBADFRE001H Z2
      		                                         WHERE Z2.AUD_YR     = T3.AUD_YR
		                                               AND Z2.AUD_NO     = T3.AUD_NO
		                                               AND Z2.DSP_RQ_SNO = T3.DSP_RQ_SNO))  = #{enfmStepCd}  				
				</if>
            ORDER BY T2.AUD_YR     DESC
                    ,T2.AUD_NO     DESC
                    ,T2.DSP_RQ_SNO DESC
	</select>	
</mapper> 
