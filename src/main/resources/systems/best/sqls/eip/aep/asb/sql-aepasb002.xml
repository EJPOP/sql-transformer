<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.asb.dao.AEPASB002PMapper">

    <insert id="insertAsbData">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB002PMapper.insertAsbData */
		<![CDATA[
		INSERT INTO TBAEPASB001M(AUD_YR,
								 AUD_NO,
								 DCS_SNO,
								 DCS_DSVN_CD,
								 DCS_DATE,
								 CHF_MB_CNB,
								 DCS_STATE)
						  VALUES(#{audYr},
								 #{audNo},
								 (SELECT 
								 	LPAD(NVL(MAX(TO_NUMBER(DCS_SNO)),0)+1,3,0) 
								 FROM TBAEPASB001M 
								 WHERE 
								 		AUD_YR = #{audYr} 
								 AND AUD_NO =#{audNo} ),
								 #{cbAudGb},
								 #{dlbrDate},
								 #{ChfMbCnb},
								 '001')
		]]>
    </insert>

    <update id="updateAsbData" parameterType="paramMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB002PMapper.updateAsbData */
		<![CDATA[
		UPDATE	TBAEPASB001M
			SET		DCS_DSVN_CD = #{cbAudGb}
					,DCS_DATE = #{dlbrDate}
   					,CHF_MB_CNB = #{ChfMbCnb}
			WHERE	AUD_YR = #{audYr}
			AND		AUD_NO	= #{audNo}
			AND		DCS_SNO = #{dcsSno}
		]]>
    </update>

    <select id="selectAsbInfo" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB002PMapper.selectAsbInfo */
		<![CDATA[
				SELECT 
				AUD_YR,
				AUD_NO,
			    DCS_SNO, 
			    DCS_DSVN_CD, 
			    TO_CHAR(to_date(DCS_DATE),'YYYY"-"MM"-"DD') AS DCS_DATE, 
			    F_USR_INFO(CHF_MB_CNB,'2') AS CHF_MB_NM, 
			    CHF_MB_CNB
			FROM TBAEPASB001M
			WHERE aud_yr= #{audYr}
			AND AUD_NO = #{audNo}
			AND DCS_SNO = #{dcsSno}
		]]>
    </select>

</mapper> 
