<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper">
    
    <insert id="insertTBBADDED178D" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.insertTBBADDED178D*/
   		INSERT INTO TBBADDED178D
        (
              AUD_YR                         /*감사년도*/
            , AUD_NO                         /*감사번호*/
            , AUD_STEP_CD                    /*감사단계코드*/
            , DOC_ID                         /*문서ID */
            , ANNEX_DVSN_CD                  /*부속서류 종류 코드*/
            , EVI_SRNO                       /*일련번호*/
            , ISUE_DY                        /*발부일자*/
            , DVSN_NM                        /*구분*/
            , TITLE_NM                       /*제목*/
            , TERM_DY                        /*답변기한*/
            , ANSWERER_NM                    /*답변자*/
            , RECEIVER_NM                    /*수령자*/
            , AUDTOR_NM                      /*감사자*/
            , REFER                          /*참고*/
            , FRT_USR_ID                     /*최초사용자ID*/
            , FNL_USR_ID                     /*최종사용자ID*/
            , FNL_DEAL_DPT_CD                /*최종거래부서코드*/
            , FNL_MNU_ID                     /*최종메뉴ID*/
            , FRT_REGI_DH                    /*최초등록일시*/
            , FNL_MDF_DH                     /*최종수정일시*/
        ) VALUES (
              #{audYr}
            , #{audNo}
            , #{audStepCd}
            , #{docId}
            , #{annexDvsnCd}
            , #{eviSrno}
            , replace(#{isueDy},'-','')
            , #{dvsnNm}
            , #{titleNm}
            , replace(#{termDy},'-','')
            , #{answererNm}
            , #{receiverNm}
            , #{audtorNm}
            , #{refer}
            , #{fnlUsrId}
            , #{fnlUsrId}
            , #{fnlDealDptCd}
            , #{fnlMnuId}
            , SYSDATE
            , SYSDATE
        )
    </insert>
    
    
    <insert id="insertTBBADDED188D" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.insertTBBADDED188D*/
   		INSERT INTO TBBADDED188D
        (
              AUD_YR                         /*감사년도*/
            , AUD_NO                         /*감사번호*/
            , AUD_STEP_CD                    /*감사단계코드*/
            , DOC_ID                         /*감사서류문서ID */
            , ANNEX_DVSN_CD                  /*부속서류 종류 코드*/
            , IDENT_EVI_SRNO                 /*일련번호*/
            , IDENT_BNG_NM                   /*확인자 소속명*/
            , IDENT_CLASS_NM                 /*확인자 직명*/
            , IDENT_NM                       /*확인자 성명*/
            , IDENT_RSN                      /*확인사유*/
            , IDENT_DY                       /*확인일시*/
            , IDENT_PLC                      /*확인장소*/
            , REFER                          /*참고*/
            , FRT_USR_ID                     /*최초사용자ID*/
            , FNL_USR_ID                     /*최종사용자ID*/
            , FNL_DEAL_DPT_CD                /*최종거래부서코드*/
            , FNL_MNU_ID                     /*최종메뉴ID*/
            , FRT_REGI_DH                    /*최초등록일시*/
            , FNL_MDF_DH                     /*최종수정일시*/
        ) VALUES (
              #{audYr}
            , #{audNo}
            , #{audStepCd} 
            , #{docId} 
            , #{annexDvsnCd}
            , #{identEviSrno}
            , #{identBngNm}
            , #{identClassNm}
            , #{identNm}
            , #{identRsn}
            , replace(#{identDy},'-','')
            , #{identPlc}
            , #{refer}
            , #{fnlUsrId}
            , #{fnlUsrId}
            , #{fnlDealDptCd}
            , #{fnlMnuId}
            , SYSDATE
            , SYSDATE
        )
    </insert>
    
    <insert id="insertTBBADDED198D" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.insertTBBADDED198D*/
   		INSERT INTO TBBADDED198D
        (
              AUD_YR                         /*감사년도*/
            , AUD_NO                         /*감사번호*/
            , AUD_STEP_CD                    /*감사단계코드*/
            , DOC_ID                         /*감사서류문서ID*/
            , ANNEX_DVSN_CD                  /*부속서류 종류 코드*/
            , QNA_EVI_SRNO                   /*일련번호*/
            , QNA_BNG_NM                     /*문답대상자 소속명*/
            , QNA_CLASS_NM                   /*문답대상자 직명*/
            , QNA_NM                         /*문답대상자 성명*/
            , QNA_RSN                        /*문답사유*/
            , QNA_DY                         /*문답일시*/
            , QNA_PLC                        /*문답장소*/
            , CNSNT_WRK_OVR_YN               /*동의서징구여부 근무시간외여부*/
            , CNSNT_OWL_TIME_YN              /*동의서징구여부 심야시간여부*/
            , COUNSL_PARTCPTN_YN             /*변호인 참여여부*/
            , SPCY_QNA_NM                    /*지정 문답자*/
            , SPCY_ENTR_NM                   /*지정 입회자*/
            , REFER                          /*참고*/
            , FRT_USR_ID                     /*최초사용자ID*/
            , FNL_USR_ID                     /*최종사용자ID*/
            , FNL_DEAL_DPT_CD                /*최종거래부서코드*/
            , FNL_MNU_ID                     /*최종메뉴ID*/
            , FRT_REGI_DH                    /*최초등록일시*/
            , FNL_MDF_DH                     /*최종수정일시*/
        ) VALUES (
              #{audYr}
            , #{audNo}
            , #{audStepCd} 
            , #{docId}
            , #{annexDvsnCd}
            , #{qnaEviSrno}
            , #{qnaBngNm}
            , #{qnaClassNm}
            , #{qnaNm}
            , #{qnaRsn}
            , replace(#{qnaDy},'-','')
            , #{qnaPlc}
            , #{cnsntWrkOvrYn}
            , #{cnsntOwlTimeYn}
            , #{counslPartcptnYn}
            , #{spcyQnaNm}
            , #{spcyEntrNm}
            , #{refer}
            , #{fnlUsrId}
            , #{fnlUsrId}
            , #{fnlDealDptCd}
            , #{fnlMnuId}
            , SYSDATE
            , SYSDATE
        )
    </insert>
    
    
    <select id="selectTbbadded178d" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.selectTbbadded178d */      
        SELECT A.AUD_YR                                                     /*감사년도*/
            , A.AUD_NO                                                      /*감사번호*/
            , A.AUD_STEP_CD                                                 /*감사단계코드*/
            , A.DOC_ID                                                      /*문서ID */
            , A.ANNEX_DVSN_CD                                               /*부속서류 종류 코드*/
            , A.EVI_SRNO                                                    /*일련번호*/
            , TO_CHAR(TO_DATE(A.ISUE_DY), 'YYYY-MM-DD') AS ISUE_DY          /*발부일자*/
            , A.DVSN_NM                                                     /*구분*/
            , A.TITLE_NM                                                    /*제목*/
            , TO_CHAR(TO_DATE(A.TERM_DY), 'YYYY-MM-DD') AS TERM_DY          /*답변기한*/
            , A.ANSWERER_NM                                                 /*답변자*/
            , A.RECEIVER_NM                                                 /*수령자*/
            , A.AUDTOR_NM                                                   /*감사자*/
            , A.REFER                                                       /*참고*/
            , '질문서' AS DVSN_NM
            , B.AUD_DCM_DOC_ID
            , B.FILE_NM
            , B.EVI_DCM_GRP_SNO
            , B.PERS_INF_INC_CD
            , B.EVI_DCM_DVSN_CD
        FROM TBBADDED178D A
  INNER JOIN TBBADDED108D B ON (B.AUD_YR = A.AUD_YR AND B.AUD_NO = A.AUD_NO AND B.AUD_DCM_DOC_ID = A.DOC_ID)
       WHERE A.AUD_YR = #{audYr}
         AND A.AUD_NO = #{audNo}
         <if test="rprtCd != null and rprtCd != '' and rprtCd eq 'A10609030'.toString()">
         AND A.ANNEX_DVSN_CD = #{rprtCd}
         </if>
         <if test="spvrAstYn eq 'N'.toString() and maintenanceRoleYn eq 'N'.toString()">
         AND B.AUD_DCM_CRE_ID = #{fnlUsrId}
         </if>
    ORDER BY A.EVI_SRNO ASC, A.FRT_REGI_DH ASC
    </select>
    
    <select id="selectTbbadded188d" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.selectTbbadded188d */      
	   SELECT ROWNUM AS IDENT_EVI_SRNO
	        , AUD_YR
	        , AUD_NO
	        , AUD_STEP_CD
	        , DOC_ID
	        , ANNEX_DVSN_CD
	        , IDENT_BNG_NM
	        , IDENT_CLASS_NM
	        , IDENT_NM
	        , IDENT_RSN
	        , IDENT_DY
	        , IDENT_PLC
	        , REFER
	        , AUD_DCM_DOC_ID
	        , FILE_NM
	        , EVI_DCM_GRP_SNO
	        , PERS_INF_INC_CD
	        , FRT_REGI_DH
	        , EVI_DCM_DVSN_CD
	    FROM (
	        SELECT A.AUD_YR                                                     /*감사년도*/
	            , A.AUD_NO                                                      /*감사번호*/
	            , A.AUD_STEP_CD                                                 /*감사단계코드*/
	            , A.DOC_ID                                                      /*감사서류문서ID */
	            , A.ANNEX_DVSN_CD                                               /*부속서류 종류 코드*/
	            , A.IDENT_BNG_NM                                                /*확인자 소속명*/
	            , A.IDENT_CLASS_NM                                              /*확인자 직명*/
	            , A.IDENT_NM                                                    /*확인자 성명*/
	            , A.IDENT_RSN                                                   /*확인사유*/
	            , TO_CHAR(TO_DATE(A.IDENT_DY), 'YYYY-MM-DD') AS IDENT_DY        /*확인일시*/
	            , A.IDENT_PLC                                                   /*확인장소*/
	            , A.REFER                                                       /*참고*/
	            , B.AUD_DCM_DOC_ID
	            , B.FILE_NM
	            , B.EVI_DCM_GRP_SNO
	            , B.PERS_INF_INC_CD
	            , A.FRT_REGI_DH
	            , B.EVI_DCM_DVSN_CD
	        FROM TBBADDED188D A
	  INNER JOIN TBBADDED108D B ON (B.AUD_YR = A.AUD_YR AND B.AUD_NO = A.AUD_NO AND B.AUD_DCM_DOC_ID = A.DOC_ID)
	       WHERE A.AUD_YR = #{audYr}
	         AND A.AUD_NO = #{audNo}
	         <if test="rprtCd != null and rprtCd != '' and rprtCd eq 'A10609040'.toString()">
             AND A.ANNEX_DVSN_CD = #{rprtCd}
             </if>
             <if test="spvrAstYn eq 'N'.toString() and maintenanceRoleYn eq 'N'.toString()">
             AND B.AUD_DCM_CRE_ID = #{fnlUsrId}
             </if>
	    ORDER BY A.FRT_REGI_DH ASC
	    )
    </select>
    
    <select id="selectTbbadded198d" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.selectTbbadded198d */      
	   SELECT ROWNUM AS QNA_EVI_SRNO
	        , AUD_YR
	        , AUD_NO
	        , AUD_STEP_CD
	        , DOC_ID
	        , ANNEX_DVSN_CD
	        , QNA_BNG_NM
	        , QNA_CLASS_NM
	        , QNA_NM
	        , QNA_RSN
	        , QNA_DY
	        , QNA_PLC
	        , CNSNT_WRK_OVR_YN
	        , CNSNT_OWL_TIME_YN
	        , COUNSL_PARTCPTN_YN
	        , DECODE(CNSNT_WRK_OVR_YN, 'Y', 'O','X') AS CNSNT_WRK_OVR_OX
	        , DECODE(CNSNT_OWL_TIME_YN, 'Y', 'O','X') AS CNSNT_OWL_TIME_OX
            , DECODE(CNSNT_OWL_TIME_YN, 'Y', 'O','X') AS COUNSL_PARTCPTN_OX
	        , SPCY_QNA_NM
	        , SPCY_ENTR_NM
	        , REFER
	        , AUD_DCM_DOC_ID
	        , FILE_NM
	        , EVI_DCM_GRP_SNO
	        , PERS_INF_INC_CD
	        , FRT_REGI_DH
	        , EVI_DCM_DVSN_CD
	    FROM (  
	        SELECT A.AUD_YR                                                     /*감사년도*/
	            , A.AUD_NO                                                      /*감사번호*/
	            , A.AUD_STEP_CD                                                 /*감사단계코드*/
	            , A.DOC_ID                                                      /*감사서류문서ID*/
	            , A.ANNEX_DVSN_CD                                               /*부속서류 종류 코드*/
	            , A.QNA_BNG_NM                                                  /*문답대상자 소속명*/
	            , A.QNA_CLASS_NM                                                /*문답대상자 직명*/
	            , A.QNA_NM                                                      /*문답대상자 성명*/
	            , A.QNA_RSN                                                     /*문답사유*/
	            , TO_CHAR(TO_DATE(A.QNA_DY), 'YYYY-MM-DD') AS QNA_DY            /*문답일시*/
	            , A.QNA_PLC                                                     /*문답장소*/
	            , A.CNSNT_WRK_OVR_YN                                            /*동의서징구여부 근무시간외여부*/
	            , A.CNSNT_OWL_TIME_YN                                           /*동의서징구여부 심야시간여부*/
	            , A.COUNSL_PARTCPTN_YN                                          /*변호인참여여부 심야시간여부*/
	            , A.SPCY_QNA_NM                                                 /*지정 문답자*/
	            , A.SPCY_ENTR_NM                                                /*지정 입회자*/
	            , A.REFER                                                       /*참고*/
	            , B.AUD_DCM_DOC_ID
	            , B.FILE_NM
	            , B.EVI_DCM_GRP_SNO
	            , B.PERS_INF_INC_CD
	            , A.FRT_REGI_DH
	            , B.EVI_DCM_DVSN_CD
	        FROM TBBADDED198D A
	  INNER JOIN TBBADDED108D B ON (B.AUD_YR = A.AUD_YR AND B.AUD_NO = A.AUD_NO AND B.AUD_DCM_DOC_ID = A.DOC_ID)
	       WHERE A.AUD_YR = #{audYr}
	         AND A.AUD_NO = #{audNo}
	         <if test="rprtCd != null and rprtCd != '' and rprtCd eq 'A10609050'.toString()">
             AND A.ANNEX_DVSN_CD = #{rprtCd}
             </if>
             <if test="spvrAstYn eq 'N'.toString() and maintenanceRoleYn eq 'N'.toString()">
             AND B.AUD_DCM_CRE_ID = #{fnlUsrId}
             </if>
	    ORDER BY A.FRT_REGI_DH ASC
	    )
    </select>
    
    
    <delete id="deleteEviDocDetail" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.deleteEviDocDetail*/
        DECLARE
    	    BEGIN
    	        DELETE 
    	          FROM TBBADDED178D
    	         WHERE AUD_YR = #{audYr}
    	           AND AUD_NO = #{audNo}
    	           AND DOC_ID = #{docId};
    	           
    	        DELETE 
    	          FROM TBBADDED188D
    	         WHERE AUD_YR = #{audYr}
    	           AND AUD_NO = #{audNo}
    	           AND DOC_ID = #{docId};
    	           
    	        DELETE 
    	          FROM TBBADDED198D
    	         WHERE AUD_YR = #{audYr}
    	           AND AUD_NO = #{audNo}
    	           AND DOC_ID = #{docId};
    	    END;
    </delete>
    
    
    <update id="updateTBBADDED178D" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.updateTBBADDED178D*/
        UPDATE TBBADDED178D
           SET FNL_USR_ID              = #{fnlUsrId}
             , FNL_DEAL_DPT_CD         = #{fnlDealDptCd}
             , FNL_MNU_ID              = #{fnlMnuId}
             , FNL_MDF_DH              = SYSDATE
         <if test='eviSrno != null and eviSrno != ""'>
             , EVI_SRNO                = #{eviSrno}
         </if>
         <if test='isueDy != null and isueDy != ""'>
             , ISUE_DY                 = replace(#{isueDy},'-','')
         </if>
         <if test='titleNm != null and titleNm != ""'>
             , TITLE_NM                = #{titleNm}
         </if>
         <if test='termDy != null and termDy != ""'>
             , TERM_DY                 = replace(#{termDy},'-','')
         </if>
         <if test='answererNm != null and answererNm != ""'>
             , ANSWERER_NM             = #{answererNm}
         </if>
         <if test='receiverNm != null and receiverNm != ""'>
             , RECEIVER_NM             = #{receiverNm}
         </if>
         <if test='audtorNm != null and audtorNm != ""'>
             , AUDTOR_NM               = #{audtorNm}
         </if>
             , DVSN_NM                 = #{dvsnNm}
             , REFER                   = #{refer}
         WHERE AUD_YR = #{audYr}
    	   AND AUD_NO = #{audNo}
    	   AND DOC_ID = #{docId}
    </update>
    
    
    <update id="updateTBBADDED188D" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.updateTBBADDED188D*/
        UPDATE TBBADDED188D
           SET FNL_USR_ID              = #{fnlUsrId}
             , FNL_DEAL_DPT_CD         = #{fnlDealDptCd}
             , FNL_MNU_ID              = #{fnlMnuId}
             , FNL_MDF_DH              = SYSDATE
         <if test='identEviSrno != null and identEviSrno != ""'>
             , IDENT_EVI_SRNO          = #{identEviSrno}
         </if>
         <if test='identBngNm != null and identBngNm != ""'>
             , IDENT_BNG_NM            = #{identBngNm}
         </if>
         <if test='identClassNm != null and identClassNm != ""'>
             , IDENT_CLASS_NM          = #{identClassNm}
         </if>
         <if test='identNm != null and identNm != ""'>
             , IDENT_NM                = #{identNm}
         </if>
         <if test='identRsn != null and identRsn != ""'>
             , IDENT_RSN               = #{identRsn}
         </if>
         <if test='identDy != null and identDy != ""'>
             , IDENT_DY                = replace(#{identDy},'-','')
         </if>
         <if test='identPlc != null and identPlc != ""'>
             , IDENT_PLC               = #{identPlc}
         </if>
             , REFER                   = #{refer}
         WHERE AUD_YR = #{audYr}
    	   AND AUD_NO = #{audNo}
    	   AND DOC_ID = #{docId}
    </update>
    
    
    <update id="updateTBBADDED198D" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.updateTBBADDED198D*/
        UPDATE TBBADDED198D
           SET FNL_USR_ID              = #{fnlUsrId}
             , FNL_DEAL_DPT_CD         = #{fnlDealDptCd}
             , FNL_MNU_ID              = #{fnlMnuId}
             , FNL_MDF_DH              = SYSDATE
         <if test='qnaEviSrno != null and qnaEviSrno != ""'>
             , QNA_EVI_SRNO            = #{qnaEviSrno}
         </if>
         <if test='qnaBngNm != null and qnaBngNm != ""'>
             , QNA_BNG_NM              = #{qnaBngNm}
         </if>
         <if test='qnaClassNm != null and qnaClassNm != ""'>
             , QNA_CLASS_NM            = #{qnaClassNm}
         </if>
         <if test='qnaNm != null and qnaNm != ""'>
             , QNA_NM                  = #{qnaNm}
         </if>
         <if test='qnaRsn != null and qnaRsn != ""'>
             , QNA_RSN                 = #{qnaRsn}
         </if>
         <if test='qnaDy != null and qnaDy != ""'>
             , QNA_DY                  = replace(#{qnaDy},'-','')
         </if>
         <if test='qnaPlc != null and qnaPlc != ""'>
             , QNA_PLC                 = #{qnaPlc}
         </if>
         <if test='cnsntWrkOvrYn != null and cnsntWrkOvrYn != ""'>
             , CNSNT_WRK_OVR_YN        = #{cnsntWrkOvrYn}
         </if>
         <if test='cnsntOwlTimeYn != null and cnsntOwlTimeYn != ""'>
             , CNSNT_OWL_TIME_YN       = #{cnsntOwlTimeYn}
         </if>
         <if test='counslPartcptnYn != null and counslPartcptnYn != ""'>
             , COUNSL_PARTCPTN_YN       = #{counslPartcptnYn}
         </if>
         <if test='spcyQnaNm != null and spcyQnaNm != ""'>
             , SPCY_QNA_NM             = #{spcyQnaNm}
         </if>
         <if test='spcyEntrNm != null and spcyEntrNm != ""'>
             , SPCY_ENTR_NM            = #{spcyEntrNm}
         </if>
             , REFER                   = #{refer}
         WHERE AUD_YR = #{audYr}
    	   AND AUD_NO = #{audNo}
    	   AND DOC_ID = #{docId}
    </update>
    
    <select id="selectRequireEviDetailYn" parameterType="paramMap" resultType="String">
    <![CDATA[
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC012PMapper.selectRequireEviDetailYn */
          SELECT DECODE(COUNT(AUD_YR),1,'Y','N') 
            FROM TBBADDED001M 
           WHERE AUD_YR = #{audYr}
             AND AUD_NO = #{audNo}
             AND TO_DATE(TO_CHAR(FRT_REGI_DH,'YYYYMMDD'),'YYYYMMDD') 
                 >= 
                 (SELECT TO_DATE(ST.USR_DFN_TXT_1,'YYYYMMDD') FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000915' AND ST.CD = '20')
        ]]>
    </select>
</mapper>
