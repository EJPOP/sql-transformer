<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper">
    
    <select id="selectAudBscSbj" parameterType="paramMap" resultType="egovMap" >
            /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectAudBscSbj*/
            SELECT  A.AUD_YR /*감사년도*/ 
                   ,A.AUD_NO /*실연번호*/
                   ,F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-') AS AUD_YR_NO  /*감사번호*/
                   ,A.AUD_SBJ_NM  /*감사사항명*/
                   ,CASE WHEN A.AUD_YR >= '2016' THEN SUBSTR(A.AUD_KND_CD, 3, 1) 
                         ELSE ''
                         END AS AUD_YR_NO_KND_CD  /*감사종류코드*/
                   ,CASE WHEN A.AUD_YR >= '2016' THEN F_CODE_NM('1000739', A.AUD_KND_CD)
                         ELSE '-'
                         END AS AUD_YR_NO_KND_NM  /*감사종류명*/
                   ,A.BZT_BGT_DVSN_CD AS BZT_BGT_DVSN_CD  /*예산구분코드*/
                   ,F_CODE_NM('1000751', A.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM /*예산구분명*/
                   ,A.SPV_BRDV_CD AS SPV_BRDV_CD /*주관국과코드*/
                   ,F_DPT_INFO(A.SPV_BRDV_CD, '1') AS SPV_BRDV_NM  /*주관국과명*/
                   ,A.ORG_DVSN_CD AS ORG_DVSN_CD /*기관구분코드*/
                   ,A.AUD_RPST_ORG_CD AS AUD_RPST_ORG_CD /*감사대표기관코드*/
                   ,F_ORG_INFO(A.AUD_RPST_ORG_CD, '1') AS AUD_RPST_ORG_NM /*대표기관명*/
                   ,A.MNG_DPT_CD AS MNG_DPT_CD /*관리부서코드*/
                   ,F_DPT_INFO(A.MNG_DPT_CD, '1') AS MNG_DPT_NM /*관리부서명*/
                   ,A.AUD_SCL_CD /*감사규모코드*/
                   ,F_CODE_NM('1000027', A.AUD_SCL_CD) AS AUD_SCL_CD_NM/*감사규모코드명*/
                   ,A.AUD_TOT_DRTR_CNB   /*감사총책임자전산번호 */
                   ,F_USR_INFO(A.AUD_TOT_DRTR_CNB, 2) AS AUD_TOT_DRTR_CNB_NM /*감사총책임자명 */
                   ,A.TOT_DRTR_RANK_CD   /*총책임자직급코드 */
                   ,F_CODE_NM('1000173',A.TOT_DRTR_RANK_CD)   AS TOT_DRTR_RANK_NM   /*총책임자직급명*/
                   ,A.TOT_DRTR_BRDV_CD   /*총책임자국과코드 */    
                   ,F_DPT_INFO(A.TOT_DRTR_BRDV_CD,'1') AS TOT_DRTR_BRDV_NM /*총책임자국과명 */
                   ,F_USR_INFO(A.AUD_TOT_DRTR_CNB, 2) ||'('||F_DPT_INFO(A.TOT_DRTR_BRDV_CD,'1')||' | '||F_CODE_NM('1000173',A.TOT_DRTR_RANK_CD)||')' as TOT_DRTR_FULL /*감사단장 FULL */
                   
                   /*여기부터 세부사항*/
                   ,A.SPVR_CNB   /*주관자전산번호 */
                   ,F_USR_INFO(A.SPVR_CNB, 2) AS SPVR_CNB_NM /*주관자명 */
                   ,A.SPVR_RANK_CD   /*주관자직급코드 */
                   ,F_CODE_NM('1000173',A.SPVR_RANK_CD)   AS SPVR_RANK_CD_NM   /*주관자직급명*/
                   ,A.SPVR_BRDV_CD   /*주관자국과코드 */    
                   ,F_DPT_INFO(A.SPVR_BRDV_CD,'1') AS SPVR_BRDV_CD_NM /*주관자국과명 */
                   ,F_USR_INFO(A.SPVR_CNB, 2) ||'('|| F_DPT_INFO(A.SPVR_BRDV_CD,'1') ||' | '||F_CODE_NM('1000173',A.SPVR_RANK_CD)||')' as SPVR_FULL /*주관자 FULL */
                   ,A.AST_CNB    /*보조자전산번호 */
                   ,F_USR_INFO(A.AST_CNB, 2) AS AST_CNB_NM /*보조자명 */
                   ,A.AST_RANK_CD    /*보조자직급코드 */
                   ,F_CODE_NM('1000173',A.AST_RANK_CD)   AS AST_RANK_CD_NM   /*보조자직급명*/
                   ,A.AST_BRDV_CD    /*보조자국과코드 */    
                   ,F_DPT_INFO(A.AST_BRDV_CD,'1') AS AST_BRDV_CD_NM /*보조자국과명 */
                   ,F_USR_INFO(A.AST_CNB, 2) ||'('|| F_DPT_INFO(A.AST_BRDV_CD,'1') ||' | '||F_CODE_NM('1000173',A.AST_RANK_CD)||')' as AST_FULL /*보조자 FULL */
                   ,A.AUD_TASK_CD  /*감사과제코드 */
                   ,F_CODE_NM('1000008', A.AUD_TASK_CD) AS AUD_TASK_CD_NM  /*감사과제코드명*/
                   ,A.AUD_WAY_CD   /*감사방법코드  */
                   ,F_CODE_NM('1000009', A.AUD_WAY_CD) AS AUD_WAY_CD_NM  /*감사방법코드명*/
                   ,A.EPS_TASK_CD    /*감사중점과제코드  */
                   ,F_CODE_NM_YEAR('1000005', a.EPS_TASK_CD, a.AUD_YR) as EPS_TASK_CD_NM  /*감사중점과제코드명*/
            FROM TBBADDED001M A
            WHERE 1=1
            <if test='audYr != null and audYr != ""'>
                AND A.AUD_YR = #{audYr}
            </if>
            <if test='audKndCd != null and audKndCd != ""'>
                AND SUBSTR(A.AUD_KND_CD,3,1) = #{audKndCd}
            </if>
            <if test='audGrnNo != null and audGrnNo != ""'>
                AND A.AUD_GRN_NO = #{audGrnNo}
            </if>
    </select>
    
    <select id="selectMainList" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectMainList*/
        SELECT F_MNG_KND_AUDYRNO(B.AUD_YR, B.AUD_NO, B.AUD_KND_CD, '-') AS AUD_YR_N0  /*감사번호*/
              ,A.BZT_SNO /*출장순번*/
              ,A.AUD_BZT_KND_CD /*출장종류코드*/
              ,F_CODE_NM ('1000030', A.AUD_BZT_KND_CD) AS AUD_BZT_KND_NM /*감사출장종류코드*/
              ,A.TIT_TXT /*출장제목*/
              ,to_char(to_date(A.AUD_STR_DT,'YYYY-MM-DD'),'YYYY-MM-DD') AS AUD_STR_DT /*출장시작일*/
              ,to_char(to_date(A.AUD_END_DT,'YYYY-MM-DD'),'YYYY-MM-DD') AS AUD_END_DT /*출장종료일*/
              ,to_char(to_date(A.AUD_STR_DT,'YYYY-MM-DD'),'YYYY-MM-DD') || ' ~ ' || to_char(to_date(A.AUD_END_DT,'YYYY-MM-DD'),'YYYY-MM-DD') as AUD_DT
              ,A.BZT_BRDV_CD  /*출장부서코드*/
              ,F_DPT_INFO(A.BZT_BRDV_CD, '1') AS SPV_BRDV_NM  /*출장부서명*/
              ,A.REL_AUD_YR
              ,A.REL_AUD_NO 
              ,ROW_NUMBER( ) OVER (ORDER BY REL_AUD_NO DESC, AUD_STEP_SNO DESC ) AS BZT_NO /*출장순번??*/
              ,C.CNT AS AJT_CNT /*수령자*/
              ,CASE WHEN C.CALC_CNT>0 THEN 'Y' 
                    ELSE 'N'
                     END AJT_YN_N /*여비입력*/
              ,CASE WHEN C.ADJ_CNT>0 THEN 'Y'
                    ELSE 'N'
                     END AJT_YN_Y /*여비정산*/
        FROM TBBADDED002M A,
             TBBADDED001M B,
            (SELECT BZT_YR 
                   ,BZT_SNO
                   ,COUNT(DISTINCT PCT_CNB) AS CNT
                   ,SUM(DECODE(CALC_YN, 'N', 1, 0)) AS CALC_CNT 
                   ,SUM(DECODE(CALC_YN, 'Y', 1, 0)) AS ADJ_CNT
               FROM TBBADDED011L
              WHERE 1=1
                AND BZT_YR = #{audYr}
           GROUP BY BZT_YR, BZT_SNO ) C
        WHERE A.REL_AUD_YR = B.AUD_YR
          AND A.REL_AUD_NO = B.AUD_NO
          AND A.BZT_YR = C.BZT_YR(+)
          AND A.BZT_SNO = C.BZT_SNO(+)
          AND A.BZT_DVSN_CD = 1 /*감사출장*/
            <if test='audYr != null and audYr != ""'>
                AND B.AUD_YR = #{audYr}
            </if>
            <if test='audNo != null and audNo != ""'>
                AND B.AUD_NO = #{audNo}
            </if>
            <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1010'.toString()">
                AND A.AUD_BZT_KND_CD IN ('00','15') /*서면감사인 경우 확인출장(15) 조회 되도록 수정*/
            </if>
            <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1020'.toString()">
                AND A.AUD_BZT_KND_CD = '01'
            </if>
            <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1030'.toString()">
                AND A.AUD_BZT_KND_CD IN ('02','03')
            </if>
            <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1040'.toString()">
                AND A.AUD_BZT_KND_CD IN ('02','03')
            </if>
    </select>
    
    <select id="selectRelBztList" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectRelBztList*/
        SELECT F_MNG_KND_AUDYRNO(B.AUD_YR, B.AUD_NO, B.AUD_KND_CD, '-') AS AUD_YR_N0  /*감사번호*/
              ,B.AUD_SBJ_NM
              ,A.BZT_SNO /*출장순번*/
              ,A.AUD_BZT_KND_CD /*출장종류코드*/
              ,NVL(F_CODE_NM ('1000030', A.AUD_BZT_KND_CD),'-') AS AUD_BZT_KND_NM /*감사출장종류코드*/
              ,NVL(A.TIT_TXT,' * 해당 감사사항의 출장정보가 존재하지 않습니다.') AS TIT_TXT/*출장제목*/
              ,to_char(to_date(A.AUD_STR_DT,'YYYY-MM-DD'),'YYYY-MM-DD') AS AUD_STR_DT /*출장시작일*/
              ,to_char(to_date(A.AUD_END_DT,'YYYY-MM-DD'),'YYYY-MM-DD') AS AUD_END_DT /*출장종료일*/
              ,DECODE(A.AUD_STR_DT,NULL,'-',to_char(to_date(A.AUD_STR_DT,'YYYY-MM-DD'),'YYYY-MM-DD') || ' ~ ' || to_char(to_date(A.AUD_END_DT,'YYYY-MM-DD'),'YYYY-MM-DD')) as AUD_DT
              ,A.BZT_BRDV_CD AS BZT_BRDV_CD  /*출장부서코드*/
              ,NVL(F_DPT_INFO(A.BZT_BRDV_CD, '1'),'-') AS SPV_BRDV_NM  /*출장부서명*/
              ,A.REL_AUD_YR
              ,A.REL_AUD_NO 
              ,ROW_NUMBER( ) OVER (ORDER BY A.REL_AUD_NO DESC, A.AUD_STEP_SNO DESC ) AS BZT_NO /*출장순번'2017''2017'*/
              ,C.CNT AS AJT_CNT /*수령자*/
              ,CASE WHEN C.CALC_CNT IS NULL THEN '-' 
                    WHEN C.CALC_CNT>0 THEN 'Y' 
                    ELSE 'N'
                     END AJT_YN_N /*여비입력*/
              ,CASE WHEN C.ADJ_CNT IS NULL THEN '-'
                    WHEN C.ADJ_CNT>0 THEN 'Y'
                    ELSE 'N'
                     END AJT_YN_Y /*여비정산*/
         FROM TBBADDED101L D
              LEFT OUTER JOIN TBBADDED002M A
              ON (A.REL_AUD_YR = D.REL_AUD_YR AND A.REL_AUD_NO = D.REL_AUD_NO AND A.BZT_DVSN_CD = 1)
              INNER JOIN TBBADDED001M B
              ON (B.AUD_YR = D.REL_AUD_YR AND B.AUD_NO = D.REL_AUD_NO)
             LEFT OUTER JOIN
                (SELECT BZT_YR 
                       ,BZT_SNO
                       ,COUNT(DISTINCT PCT_CNB) AS CNT
                       ,SUM(DECODE(CALC_YN, 'N', 1, 0)) AS CALC_CNT 
                       ,SUM(DECODE(CALC_YN, 'Y', 1, 0)) AS ADJ_CNT
                   FROM TBBADDED011L
                  WHERE 1=1
               GROUP BY BZT_YR, BZT_SNO ) C
             ON (C.BZT_YR = A.BZT_YR AND C.BZT_SNO = A.BZT_SNO)
        WHERE  D.AUD_YR = #{audYr}
          AND D.AUD_NO = #{audNo}
          AND D.AUD_STEP_CD = #{audStepCd}
        ORDER BY B.AUD_YR DESC, B.AUD_GRN_NO DESC, A.BZT_SNO DESC
    </select>
    
    <select id="selectRelAudList" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectRelAudList*/
       SELECT     D1.AUD_YR
			        ,D1.AUD_NO
			        ,D1.AUD_SBJ_NM
			        , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-') AS AUD_YR_NO
			        , D1.AUD_KND_CD
			        , F_CODE_NM_YEAR('1000007', D1.AUD_KND_CD, D1.AUD_YR) AS AUD_KND_NM
			        , (	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = D1.SPV_BRDV_CD
   					) AS SPV_BRDV_NM  /*주관국과명*/
                    , (	SELECT	S1.DPT_NM
   						FROM	TBDCMACM002M S1
   						WHERE	S1.DPT_CD = D1.MNG_DPT_CD
   					) AS MNG_DPT_NM /*관리국과명*/
			FROM    TBBADDED001M D1
			        ,TBBADDED101L D2
			WHERE   D1.AUD_YR = D2.AUD_YR
			AND      D1.AUD_NO = D2.AUD_NO
			AND		D2.REL_AUD_YR = #{audYr}
			AND		D2.REL_AUD_NO = #{audNo}
			AND       D2.AUD_STEP_CD = 'A1030'
    </select>
    
    
    <select id="selectRelDocList" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectRelDocList*/
        SELECT F_MNG_KND_AUDYRNO(T3.AUD_YR, T3.AUD_NO, T3.AUD_KND_CD, '-') AS AUD_YR_N0  /*감사번호*/
                 , T3.AUD_SBJ_NM
                 , (
                    SELECT MAX(DECODE(RPRT_CD, 'A10600100', '개별처분요구안', 'A10500200', '실지감사종료보고서', B.DTIL_AUD_DOC_NM))
                      FROM TBFDMADM002M B
                     WHERE B.AUD_DOC_CD = T2.RPRT_CD
                   ) RPRT_KND_NM 
                 , T2.RPRT_NM                                                 /*보고서명 */
                 , T2.APV_STA_CD                                              /*결재상태코드 */
                 , F_CODE_NM('1000773',NVL(T2.APV_STA_CD,'10')) AS APV_STA_NM /*결재상태명 */
                 , T2.SORT_SNO                                                /*보고서순번  */
                 , T2.DOC_ID                                                  /*결재문서번호 */
                 , T2.APV_RQS_ID                                              /*결재요청ID */
                 , T2.AUD_RPRT_DVSN_CD                                        /*감사보고서구분코드 */
                 , T2.RPRT_CD                                                 /*문서종류코드 */
                 , (SELECT USR_NAM FROM TBDCMACM001M WHERE USR_ID = T2.DOC_WRT_ID) AS MAKTER_USER
                 , DECODE(T2.APV_RQS_ID, NULL, 'Y', 'N') AS APV_YN
                 , (SELECT APV_USR_NM 
                     FROM (
                         SELECT 
                            F_USR_INFO(APVR_CNB,'2') || 
                            DECODE(APV_DH,NULL,'','('||TO_CHAR(APV_DH,'YYYY-MM-DD')||')') AS APV_USR_NM,
                            APV_DOC_NO
                         FROM TBDCMACM023L
                         WHERE  
                          APVR_KND_CD = '3'
                         ORDER BY APV_SNO DESC)
                     WHERE ROWNUM = 1
                     AND APV_DOC_NO = T2.APV_RQS_ID) AS APV_USR_NM
                 , T2.AUD_YR
                 , T2.AUD_NO
                 , T2.AUD_KND_CD
                 , T2.AUD_STEP_CD
                 , F_OPEN_EDIT(T2.LINK_URL) AS DOC_TYPE
              FROM TBBADDED101L T1
                   INNER JOIN TBBADDED103M T2
                   ON (T1.REL_AUD_YR = T2.AUD_YR AND T1.REL_AUD_NO = T2.AUD_NO AND T1.REL_AUD_STEP_CD = T2.AUD_STEP_CD)
                   INNER JOIN TBBADDED001M T3
                   ON (T1.REL_AUD_YR = T3.AUD_YR AND T1.REL_AUD_NO = T3.AUD_NO)
             WHERE T1.AUD_YR = #{audYr}
                AND T1.AUD_NO = #{audNo}
                AND T1.AUD_STEP_CD = #{audStepCd}
             ORDER BY T3.AUD_YR DESC, T3.AUD_GRN_NO DESC, T2.SORT_SNO
    </select>
    
    
    <select id="selectExptPrbList" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectExptPrbList*/
        SELECT 
               F_MNG_KND_AUDYRNO(AUD_YR, AUD_NO, AUD_KND_CD, '-')||'-'||EXPT_PRB_CD AS EXPT_PRB_NO  /*예상문제번호*/ ,
               DOC_ID  /*문서ID*/,
               EXPT_PRB_CD /*예상문제코드*/,
               RPRT_FILD_ID  /*보고서필드ID*/,
               EXPT_PRB_SNO AS EXPT_PRB_SN /*예상문제번호(순번)*/,
               EXPT_PRB_NM  /*예상문제명*/
          from TBBADDED144M
          WHERE 1=1
            <if test='audYr != null and audYr != ""'>
                AND AUD_YR = #{audYr}
            </if>
            <if test='audKndCd != null and audKndCd != ""'>
                AND AUD_KND_CD = #{audKndCd}
            </if>
            <if test='audNo != null and audNo != ""'>
                AND AUD_NO = #{audNo}
            </if>
            <if test='audStepCd != null and audStepCd != ""'>
                AND AUD_STEP_CD = #{audStepCd}
            </if>
            ORDER BY EXPT_PRB_SNO ASC
    </select>
    
    <select id="selectEviDocbList" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectEviDocbList*/
        /*증거서류함(그룹)*/
        SELECT 
            AUD_YR	/*감사년도 */
            ,AUD_NO	/*감사번호 */
            ,EVI_DCMB_SNO	/*감사서류함순번 */
            ,AUD_KND_CD	/*감사종류코드 */
            ,AUD_GRN_NO	/*감사부여코드 */
            ,FOLDER_NM	/*폴더명 */
            ,SORT_SNO	/*정렬순번 */
            ,FRT_USR_ID  /*최초사용자ID */
            ,F_USR_INFO_BY_ID(FRT_USR_ID,'2') AS FRT_USR_NM /*최초사용자ID명 */
            ,TO_CHAR(FRT_REGI_DH,'YYYY-MM-DD') FRT_REGI_DH  /*최초등록일시 */
            ,(SELECT COUNT(*) FROM TBBADDED108D D
            WHERE D.EVI_DCM_GRP_SNO = A.EVI_DCMB_SNO
            AND A.AUD_YR = d.AUD_YR
            AND A.AUD_NO = d.AUD_NO
            AND D.EVI_DCMB_DVSN_CD = #{eviDcmbDvsnCd} /*감사서류구분코드 10 : 증거서류,30 : 실지감사부속서류*/) AS CNT
            FROM TBBADDED108M A
          WHERE 1=1
            <if test='audYr != null and audYr != ""'>
                AND A.AUD_YR = #{audYr}
            </if>
            <if test='audKndCd != null and audKndCd != ""'>
                AND A.AUD_KND_CD = #{audKndCd}
            </if>
            <if test='audNo != null and audNo != ""'>
                AND A.AUD_NO = #{audNo}
            </if>
            <if test='dcmbCreId != null and dcmbCreId != ""'>
                AND A.DCMB_CRE_ID = #{dcmbCreId}
            </if>
            ORDER BY SORT_SNO ASC
    </select>
    
    <select id="selectWholeYn" parameterType="paramMap" resultType="egovMap">
    <![CDATA[
        /* kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectWholeYn */
        SELECT DECODE(SUM(CNT), 0, 'N', 'Y') AS WHOLE_YN
       FROM (
             SELECT COUNT(1) AS CNT
               FROM TBBADDED001M T1
              WHERE T1.AUD_YR = #{audYr}
                AND T1.AUD_NO = #{audNo}
                AND T1.AUD_TOT_DRTR_CNB = F_USR_INFO_BY_ID(#{usrId},'1')
              UNION ALL
             SELECT COUNT(1)
               FROM TBBADDED031L T1
              WHERE T1.AUD_YR = #{audYr}
                AND T1.AUD_NO = #{audNo}
                AND T1.CNB = F_USR_INFO_BY_ID(#{usrId},'1')
              UNION ALL
             SELECT COUNT(1)
               FROM TBDCMACM001M T1
              WHERE T1.CNB = F_USR_INFO_BY_ID(#{usrId},'1')
                AND T1.PST_CD IN ('0013600','0015800','0035100','0058100','0055600','0045900','0055700','0067400'))
    ]]>
    </select>
    
    <select id="selectDcmbCreIdCombo" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectDcmbCreIdCombo */
        SELECT 
            DCMB_CRE_ID 
            , F_USR_INFO_BY_ID(DCMB_CRE_ID,'2') AS DCMB_CRE_NM
            <if test='MaintenanceYn != "Y" and wholeYn != "Y"'>
            , 'N' AS WHOLE_YN
            </if>
            <if test='MaintenanceYn == "Y" or wholeYn == "Y"'>
            , 'Y' AS WHOLE_YN
            </if>
          FROM TBBADDED108M A
         WHERE 1=1
           <if test='audYr != null and audYr != ""'>
                AND A.AUD_YR = #{audYr}
            </if>
            <if test='audKndCd != null and audKndCd != ""'>
                AND A.AUD_KND_CD = #{audKndCd}
            </if>
            <if test='audNo != null and audNo != ""'>
                AND A.AUD_NO = #{audNo}
            </if>
            <if test='MaintenanceYn != "Y" and wholeYn != "Y"'>
                AND A.DCMB_CRE_ID IN (#{usrId})
            </if>
         GROUP BY DCMB_CRE_ID
        
    </select>
    
    <select id="selectIdvtEvtInfList" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectIdvtEvtInfList*/
        /*개별사건정보*/
        <![CDATA[
        SELECT 
                A.LIST_NO           /*일람표일련번호 */
                ,B.DSP_RQ_SNO       /*처분요구순번 */
                ,(
                   CASE 
                     WHEN A.AFF_CD ='00' OR B.AFF_DSP_CD = '00' THEN ''
                     ELSE F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-')||'-'||A.AFF_CD||'-'||B.AFF_DSP_CD
                   END 
                  ) AS AUD_YR_NO /*처분요구번호 */
                ,A.DOC_ID           /*문서ID */
                ,A.RPRT_FILD_ID		/*RPRT_FILD_ID*/
                ,A.APVR_CD          /*결재자코드  */
                ,A.AFF_SNO          /*사건순번 */
                ,A.REFER_DVSN_CD    /*부의구분코드 (1000774)*/
                ,F_CODE_NM('1000774', A.REFER_DVSN_CD) REFER_DVSN_NM /*부의구분코드명*/
                ,A.TITLE_NM         /*제목명 */
                ,A.QST_DOC_ISUE_YN /*질문서발부여부 */
                ,DECODE(A.QST_DOC_ISUE_YN,'Y','발부','미발부') QST_DOC_ISUE_YN_NM /*질문서발부여부명 */
                ,A.AUDTOR           /*감사자 */
                ,B.RLTN_ORG_CD      /*관계기관코드 (대상기관)*/
                ,B.HND_ORG_CD       /*조치기관코드 */
                ,B.REF_ORG_CD       /*참조기관코드 */
                ,F_ORG_INFO(B.RLTN_ORG_CD,'1')  AS RLTN_ORG_NM  /*관계기관코드명*/
                ,F_ORG_INFO(B.HND_ORG_CD,'1')  AS HND_ORG_NM    /*조치기관코드명*/
                ,F_ORG_INFO(B.REF_ORG_CD,'1')  AS REF_ORG_NM    /*참조기관코드명*/
                ,B.DSP_RQ_CD        /*처분요구코드 */
                ,F_CODE_NM('1000002', B.DSP_RQ_CD) ||
                DECODE(NOP_AM_DVSN_CD,'10','('||TO_CHAR(NVL(B.NOP_AM,0),'Fm999,999,999,999,999')||'명)'
                                     ,'20','('||TO_CHAR(NVL(B.NOP_SUM,0),'Fm999,999,999,999,999')||'만원)'
                                     ,'30','('||TO_CHAR(NVL(B.NOP_AM,0),'Fm999,999,999,999,999')||'명/'||TO_CHAR(NVL(B.NOP_SUM,0),'Fm999,999,999,999,999')||'만원)') AS DSP_RQ_NM /*처분요구코드명+인원금액*/
                ,(SELECT COUNT(ST.CNDIDAT_SRNO) 
                    FROM TBBADDED146D ST 
                   WHERE ST.AUD_YR = B.AUD_YR 
                     AND ST.AUD_NO = B.AUD_NO 
                     AND ST.AUD_STEP_CD = B.AUD_STEP_CD 
                     AND ST.DOC_ID = B.DOC_ID
                     AND ST.APVR_CD = B.APVR_CD
                     AND ST.AFF_SNO = B.AFF_SNO
                     AND ST.DSP_RQ_SNO = B.DSP_RQ_SNO) AS CNDIDAT_CNT
                ,(SELECT COUNT(DISTINCT F_MNG_KND_AUDYRNO(ST2.AUD_YR, ST2.AUD_NO, ST3.AUD_KND_CD, '-'))
		            FROM TBBADDED146D ST
		      INNER JOIN TBBADDED146D ST2 ON (ST2.CNDIDT_NM = ST.CNDIDT_NM AND ST2.CNDIDT_YMD = ST.CNDIDT_YMD)
		      INNER JOIN TBBADDED001M ST3 ON (ST3.AUD_YR = ST2.AUD_YR AND ST3.AUD_NO = ST2.AUD_NO)
		      INNER JOIN TBBADDED146M ST4 ON (ST4.AUD_YR = ST2.AUD_YR AND ST4.AUD_NO = ST2.AUD_NO AND ST4.AUD_STEP_CD = ST2.AUD_STEP_CD AND ST4.DOC_ID = ST2.DOC_ID AND ST4.APVR_CD = ST2.APVR_CD AND ST4.AFF_SNO = ST2.AFF_SNO AND ST4.DSP_RQ_SNO = ST2.DSP_RQ_SNO)
		           WHERE ST.AUD_YR = A.AUD_YR
		             AND ST.AUD_NO = A.AUD_NO
		             AND ST.AUD_STEP_CD = A.AUD_STEP_CD
		             AND ST.DOC_ID = A.DOC_ID
		             AND ST.APVR_CD = A.APVR_CD
		             AND ST.AFF_SNO = A.AFF_SNO
		             AND ST.DSP_RQ_SNO = B.DSP_RQ_SNO
		             AND (ST2.AUD_YR <> A.AUD_YR OR ST2.AUD_NO <> A.AUD_NO)
		          ) AS REL_AUD_CNT
		         , CASE WHEN B.DSP_RQ_CD IN ('410', '210', '620', '623') THEN 'Y'
		                ELSE 'N' END AS CNDIDAT_VIEW_YN           
           FROM TBBADDED145M A 
      LEFT JOIN TBBADDED146M B
             ON (A.AUD_YR = B.AUD_YR
            AND A.AUD_NO = B.AUD_NO
            AND A.AUD_STEP_CD = B.AUD_STEP_CD 
            AND A.DOC_ID = B.DOC_ID 
            AND A.APVR_CD = B.APVR_CD 
            AND A.AFF_SNO = B.AFF_SNO )
            ]]>
          WHERE A.AUD_YR = #{audYr}
            <if test='audNo != null and audNo != ""'>
            AND A.AUD_NO = #{audNo}
            </if>
            <if test='audStepCd != null and audStepCd != ""'>
            AND A.AUD_STEP_CD = #{audStepCd}
            </if>
            <if test='docId != null and docId != ""'>
            AND A.DOC_ID = #{docId}
            </if>
            <if test='apvrCd != null and apvrCd != ""'>
            AND A.APVR_CD = (SELECT NVL(F_USR_INFO_BY_ID(#{apvrCd}, '4'), '0010200') AS CD_NM FROM DUAL)
            </if>
            <if test='affSno != null and affSno != ""'>
            AND A.AFF_SNO = #{affSno}
            </if>
            ORDER BY A.SORT_SNO, B.SORT_SNO
    </select>
    
    <select id="chkExptPrbCnt1" parameterType="paramMap" resultType="Integer">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.chkExptPrbCnt1*/
        /*예상문제등록 팝업 체크1(감사실시계획서 결재완료 건수)*/
        SELECT COUNT(*)
          FROM TBBADDED103M AS A
         WHERE A.AUD_YR = #{audYr}
           AND A.AUD_NO = #{audNo}
           AND A.AUD_STEP_CD = 'A1030'
           AND A.RPRT_CD = 'A10300100'
           AND A.APV_STA_CD = '30'
    </select>
    
    <select id="chkExptPrbCnt2" parameterType="paramMap" resultType="Integer">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.chkExptPrbCnt2*/
        /*예상문제등록 팝업 체크1(사건매핑정보 건수)*/
        SELECT COUNT(*) FROM TBBADDED147M
        WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = 'A1050'
           AND PRE_AFF_NO IS NOT NULL
    </select>
	
    <select id="selectRelAudCnt" parameterType="paramMap" resultType="Integer">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectRelAudCnt*/
        SELECT
            (SELECT COUNT(*)
              FROM TBBADDED101L
             WHERE AUD_YR = #{audYr}
               AND AUD_NO = #{audNo})
            +
            (SELECT COUNT(*)
              FROM TBBADDED002M
             WHERE REL_AUD_YR = #{audYr}
               AND REL_AUD_NO = #{audNo})
          FROM DUAL
    </select>
    
    <select id="selectSecAudYn" parameterType="paramMap" resultType="egovMap">
    <![CDATA[
        /* kr.go.bai.eip.aep.arp.dao.AEPMAC001QMapper.selectSecAudYn */
          SELECT NVL(T1.SEC_AUD_YN, 'N') AS SEC_AUD_YN
            FROM TBBADDED001M T1
           WHERE T1.AUD_YR = #{audYr}
             AND T1.AUD_NO = #{audNo}
        ]]>
    </select>
    
    
    <select id="selectBztCtrlYn" parameterType="paramMap" resultType="String">
    <![CDATA[
        /* kr.go.bai.eip.aep.arp.dao.AEPMAC001QMapper.selectBztCtrlYn */
          SELECT CASE WHEN SUBSTR(AUD_KND_CD, -1, 1) = '5' /*확인출장*/ THEN (CASE WHEN BZT_BGT_DVSN_CD = '3'/*차장배정*/ AND AUD_CTRL_CD <> '2' THEN 'N'
                                                                       ELSE 'Y' END)
                        ELSE 'Y' END BZT_CTRL_YN
            FROM TBBADDED001M T1
            WHERE AUD_YR = #{audYr}
            AND AUD_NO = #{audNo}
        ]]>
    </select>

    <select id="selectBztAudCtrlYn" parameterType="paramMap" resultType="String">
    <![CDATA[
        /* kr.go.bai.eip.aep.arp.dao.AEPMAC001QMapper.selectBztAudCtrlYn */
            SELECT    CASE WHEN COUNT(1) > 0  THEN 'Y'
                     ELSE 'N'
                     END
			FROM    TBBADDED001M D1
			        ,TBBADDED101L D2
			WHERE   D1.AUD_YR = D2.AUD_YR
			AND      D1.AUD_NO = D2.AUD_NO
			AND		D2.REL_AUD_YR =  #{audYr}
			AND		D2.REL_AUD_NO = #{audNo}
			AND       D2.AUD_STEP_CD = 'A1030'
        ]]>
    </select>
    
   <select id="selectLinkedBztCtrlYn" parameterType="paramMap" resultType="String">
    <![CDATA[
        /* kr.go.bai.eip.aep.arp.dao.AEPMAC001QMapper.selectLinkedBztCtrlYn */
          SELECT CASE WHEN COUNT(A.AUD_YR||A.AUD_NO) > 0 THEN 'Y' 
                      ELSE 'N' END AS BZT_CTRL_YN
            FROM TBBADDED001M A 
      INNER JOIN TBBADDED101L B ON (B.REL_AUD_YR = A.AUD_YR AND B.REL_AUD_NO = A.AUD_NO) /*자료수집 연결*/
           WHERE A.AUD_CTRL_CD = '2'     /*확인완료*/
             AND A.BZT_BGT_DVSN_CD = '3' /*차장배정*/
             AND B.AUD_YR = #{audYr}
             AND B.AUD_NO = #{audNo}
        ]]>
    </select> 
    
    <select id="selectLinkedBztAudCtrlYn" parameterType="paramMap" resultType="String">
    /* kr.go.bai.eip.aep.arp.dao.AEPMAC001QMapper.selectLinkedBztAudCtrlYn */
    SELECT CASE WHEN COUNT(A.AUD_YR||A.AUD_NO) > 0 THEN 'Y' 
                      ELSE 'N' END AS BZT_AUD_CTRL_YN
            FROM TBBADDED001M A 
      INNER JOIN TBBADDED101L B ON (B.REL_AUD_YR = A.AUD_YR AND B.REL_AUD_NO = A.AUD_NO)  /*관련 감사사항 연결*/
           WHERE A.AUD_CTRL_CD = '1'     
             AND A.BZT_BGT_DVSN_CD = '1' 
             AND B.AUD_YR = #{audYr}
             AND B.AUD_NO = #{audNo}
    </select>

     
  

    <!-- 금융정보제출요구 조회 -->
    <select id="selectMntyInfSmtRqList" parameterType="paramMap" resultType="egovMap" >
    /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectMntyInfSmtRqList*/
        SELECT A.YR                       -- 년도
             , A.DPT_CD                   -- 부서코드
             , A.SLN                      -- 연번 			
             , A.AUD_YR                   -- 감사년도
             , A.AUD_NO                   -- 감사번호
             , B.AUD_GRN_NO 			              /*감사부여번호 - 2016.06.01 yyh*/
             , CASE WHEN B.AUD_YR >= '2016' 
			        THEN SUBSTR(B.AUD_KND_CD,3,1)
			   ELSE '' END AS AUD_YR_NO_KND_CD        /*감사연번호종류코드 추가 - 2015.12.28 yyh*/	
			 , B.AUD_SBJ_NM		 					  /*감사사항명*/
             , A.MNTY_INF_SMT_RQ_DOC_NO   -- 문서번호
             , A.TG_ORG_CD                -- 감사대상기관코드
             , DECODE(F_ORG_INFO(A.TG_ORG_CD, '1'), null, A.TG_ORG_NM, F_ORG_INFO(A.TG_ORG_CD, '1')) AS TG_ORG_NM
             /*, F_ORG_INFO(A.TG_ORG_CD, '1') AS TG_ORG_NM -- 감사대상기관명*/	
             , A.PUBOL_SRCH_PTOT_NOC       /*조회건수순계(공직)*/
			 , A.GEN_PSO_SRCH_PTOT_NOC 	   /*조회건수순계(일반)*/
             , A.HND_TXT                  -- 조치내용
             , A.RMK_SBJ                  -- 비고
             , A.DOC_ID
			 , A.DOC_TYP_CD
			 , A.TG_ORG_NM                  /*대상기관명*/
             , (SELECT COUNT(*) 
                  FROM TBBADJFS002D AA
                 WHERE AA.YR = A.YR
                   AND AA.DPT_CD = A.DPT_CD
                   AND AA.SLN = A.SLN )     AS DTL_CNT -- 상세정보(건수)
          FROM TBBADJFS001M A, TBBADDED001M B /*감사사항*/
		 WHERE 	1=1
		   AND 	A.AUD_NO 		= B.AUD_NO(+)
		   AND  A.AUD_YR 		= B.AUD_YR(+)
		   AND A.AUD_YR = #{audYr}
		   AND A.AUD_NO = #{audNo}
		 ORDER BY 
		       A.YR     DESC
		     , A.DPT_CD ASC
		     , A.SLN    DESC
    </select>
    
    <!-- 금융정보제출요구 입력 -->
    <insert id="insertMntyInfSmtRqData" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.insertMntyInfSmtRqData*/
        INSERT 
		  INTO TBBADJFS001M
		     ( YR                        -- 년도
		     , DPT_CD				     -- 부서코드
			 , SLN	  		             -- 연번
			 , AUD_YR				     -- 감사년도
			 , AUD_NO 			         -- 감사번호
			 , MNTY_INF_SMT_RQ_DOC_NO 	 -- 문서번호
			 , TG_ORG_CD 				 -- 감사대상기관코드
			 , TG_ORG_NM
			 , HND_TXT 					 -- 조치내용
			 , RMK_SBJ 					 -- 비고
			 , REGI_RUT	                 -- 등록경로
			 , FRT_USR_ID 			     -- 최초사용자ID
			 , FNL_USR_ID 		     	 -- 최종사용자ID
			 , FNL_DEAL_DPT_CD 	 	     -- 최종거래부서코드
			 , FNL_MNU_ID 			     -- 최종메뉴ID
			 , FRT_REGI_DH 			     -- 최초들록일시
			 , FNL_MDF_DH 			     -- 최종수정일시
			 )
		VALUES 
		     ( TO_CHAR(SYSDATE,'yyyy')   -- 년도
		     , #{dptCd}				 -- 부서코드
			 , #{sln} -- 연번
			 , #{audYr}				     -- 감사년도
			 , #{audNo} 			     -- 감사번호
			 , #{mntyInfSmtRqDocNo} 	 -- 문서번호
			 , #{tgOrgCd} 				 -- 감사대상기관코드
			 , #{tgOrgNm}
			 , #{hndTxt}     			 -- 조치내용
			 , #{rmkSbj}				 -- 비고
			 , 'A'				     	 -- 등록경로
			 , #{usrId} 			     -- 최초사용자ID
			 , #{usrId} 		  		 -- 최종사용자ID
			 , #{dptCd} 	 	         -- 최종거래부서코드
			 , #{menuNo}         		 -- 최종메뉴ID
			 , SYSDATE 			         -- 최초들록일시
			 , SYSDATE 			         -- 최종수정일시
		     )
    </insert>
    
    <!-- 금융정보제출요구 수정 -->
    <update id="updateMntyInfSmtRqData" parameterType="paramMap">
    	/*kr.go.bai.eip.aep.afu.dao.AEPMAC001QMapper.updateMntyInfSmtRqData*/
    	UPDATE TBBADJFS001M 
		   SET MNTY_INF_SMT_RQ_DOC_NO = #{mntyInfSmtRqDocNo}	/*문서번호*/
			 , TG_ORG_CD 		 	  = #{tgOrgCd}				/*대상기관코드*/
			 , TG_ORG_NM 		 	  = #{tgOrgNm}				/*대상기관명*/
			 , HND_TXT 		          = #{hndTxt}				/*조치내용*/
			 , RMK_SBJ 				  = #{rmkSbj}				/*비고*/
			 , FNL_USR_ID 	    	  = #{usrId}				/*최종사용자ID*/
			 , FNL_DEAL_DPT_CD 	 	  = #{dptCd}				/*최종거래부서코드*/
			 , FNL_MNU_ID		 	  = #{menuNo}				/*최종메뉴ID*/
			 , FNL_MDF_DH 		 	  = SYSDATE					/*최종수정일시*/
		 WHERE YR = #{yr}
		   AND DPT_CD = #{dptCd}
		   AND SLN = #{sln}
    </update>
    
    <!-- 금융정보제출요구 삭제 -->
    <delete id="deleteMntyInfSmtRqData" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.deleteMntyInfSmtRqData*/
        DELETE TBBADJFS001M
         WHERE YR = #{yr}
		   AND DPT_CD = #{dptCd}
		   AND SLN = #{sln}
    </delete>
    
    <!-- 금융정보제출요구 상세조회 -->
    <select id="selectDetailMntyInfSmtRqList" parameterType="paramMap" resultType="egovMap" >
    /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectDetailMntyInfSmtRqList*/
		   SELECT T3.IS_NO									/* 발부번호 */
				, T1.AUD_NO									/* 감사번호 */
				, T1.AUD_YR									/* 감사년도 */
				, T2.AUD_GRN_NO								/* 감사부여년도 - 2016.06.01 yyh*/
				, CASE WHEN T2.AUD_YR >= '2016' 
						THEN F_CODE_NM('1000739', T2.AUD_KND_CD)
						ELSE '-' 
			      END AS AUD_YR_NO_KND_NM					/*감사연번호종류코드 추가 - 2015.12.28 yyh*/				 
				, F_DPT_INFO(T1.DPT_CD, '1') AS DPT_NM		/* 부서명 */
				, T2.AUD_SBJ_NM								/* 감사사항명 */
				, T1.TG_ORG_CD								/* 대상기관코드 */ 
				, F_ORG_INFO(T1.TG_ORG_CD, '1') AS ORG_NM	/* 대상기관명 */
				, T1.DOC_ID									/* 문서ID */
				, T1.DOC_TYP_CD								/* 문서유형코드 */
				, T1.TG_ORG_NM								/* 대상기관명 */
				, TO_CHAR(TO_DATE(T3.IS_DT,'yyyyMMdd'),'yyyy-MM-dd') AS IS_DT	/*발부일*/
				, T3.NAM									/* 성명 */
				, T3.EIN									/*암호화주민등록번호*/
				, SUBSTR(DGUARD.DECRYPT('TB_ENC','EIN',T3.EIN),0,6)  AS EIN_F
				, SUBSTR(DGUARD.DECRYPT('TB_ENC','EIN',T3.EIN),7,13) AS EIN_B
				, DECODE(T3.EIN,NULL,'',SUBSTR(T3.EIN,0,6)||'-*******') AS P_EIN
/*
				, CASE WHEN T3.EIN IS NOT NULL THEN
				  SUBSTR(DGUARD.DECRYPT('TB_ENC','EIN',T3.EIN),0,6) || '-' ||
 				  REGEXP_REPLACE(SUBSTR(DGUARD.DECRYPT('TB_ENC','EIN',T3.EIN),7,13),'[0-9]','*',1)
				  ELSE ''
				  END AS EIN
*/
				, T3.CMPY_NM								/* 회사명 */
				, DECODE(T3.BZN,NULL,'',SUBSTRING(T3.BZN,1,3) || '-' || SUBSTRING(T3.BZN,4,2) || '-' || SUBSTRING(T3.BZN,6,5)) AS BZN
				, DGUARD.DECRYPT('TB_ENC','EAN',T3.EAN) AS EAN													/*암호화계좌번호*/
				, REGEXP_REPLACE(DGUARD.DECRYPT('TB_ENC','EAN',T3.EAN),'[0-9]','*',1) AS P_EAN
				, T3.MNTY_ORG_NM							/* 금융기관명 */
				, T3.BRC_NM									/* 지점명 */
				, T3.ETC_SBJ								/* 기타사항 */
				, T3.USE_PPS_CD								/* 사용목적코드 */
				, T3.RQ_DEAL_INF_HIS						/* 요구거래정보내역 */
				, TO_CHAR(TO_DATE(T3.ACP_DT,'yyyyMMdd'),'yyyy-MM-dd') AS ACP_DT		/*접수일*/
				, T3.PUBOL_DVSN_YN													/*공직자구분여부*/
				, T3.GEN_PSO_SRCH_NOC						/* 일반인조회건수 */
				, T3.AUD_PEN_NAM							/* 감사자성명 */
				, T3.ACT_INF_NM								/* 계좌정보명 */
				, T3.MNTY_ORG_INF_NM						/* 금융기관정보명 */
				, T1.YR										/* 년도 */
				, T1.DPT_CD									/* 부서코드 */
				, T1.SLN									/* 연번 */
				, T1.DOC_ID
				, T1.DOC_TYP_CD
				, T3.FRT_USR_ID
			  FROM TBBADJFS001M T1 /*금융정보제출요구사항*/
			     , TBBADDED001M T2 /*감사사항*/
			     , TBBADJFS002D T3 /* 금융정보제출요구사항상세 */
			 WHERE 	1=1
			   AND T1.AUD_YR 	= T2.AUD_YR(+)
			   AND T1.AUD_NO 	= T2.AUD_NO(+)
			   AND T1.YR        = T3.YR(+)
			   AND T1.DPT_CD    = T3.DPT_CD(+)
			   AND T1.SLN       = T3.SLN(+)	
			   AND T3.YR 	  = #{yr}
			   AND T3.DPT_CD = #{dptCd}
			   AND T3.SLN 	  = #{sln}
		 ORDER BY T3.SLN , T3.IS_NO DESC
    </select>
    
    <!-- 금융정보제출요구 상세 입력 -->
    <insert id="insertDetailMntyInfSmtRqData" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.insertDetailMntyInfSmtRqData*/
        INSERT 
		  INTO TBBADJFS002D
		     ( YR                        /*년도*/
		     , DPT_CD				     /*부서코드*/
			 , SLN	  		             /*연번*/
			 , IS_NO					/*발부번호*/
			 , IS_DT                   	/*발부일*/
			 , NAM                     	/*성명*/
			 , EIN                     	/*암호화주민등록번호*/
			 , CMPY_NM                 	/*회사명*/
			 , BZN                     	/*사업자등록번호*/
			 , EAN                     	/*암호화계좌번호*/
			 , MNTY_ORG_NM             	/*금융기관명*/
			 , BRC_NM                  	/*지점출장소명*/
			 , ETC_SBJ                  /*기타*/
			 , USE_PPS_CD              	/*사용목적코드*/
			 , RQ_DEAL_INF_HIS         	/*요구거래정보내역*/
			 , ACP_DT                  	/*접수일*/
			 , PUBOL_SRCH_NOC			/*공직자조회건수*/
			 , GEN_PSO_SRCH_NOC			/*일반인조회건수*/
			 , AUD_PEN_NAM				/*감사자명*/
			 , PUBOL_DVSN_YN           	/*공직자구분여부*/
			 , ACT_INF_NM              	/*계좌정보명*/
			 , MNTY_ORG_INF_NM         	/*금융기관정보명*/
			 , FRT_USR_ID              	/*최초사용자ID*/
			 , FNL_USR_ID				/*최종사용자ID*/
			 , FNL_DEAL_DPT_CD         	/*최종거래부서코드*/
			 , FNL_MNU_ID				/*최종메뉴ID*/
			 , FRT_REGI_DH             	/*최초등록일시*/
			 , FNL_MDF_DH				/*최종수정일시*/
			 )
		VALUES 
		     ( #{yr}
		     , #{dptCd}
			 , #{sln}
			 , #{isNo}
			 , replace(#{isDt},'-','')
			 , #{nam}
			 , (DGUARD.ENCRYPT('TB_ENC','EIN',#{einF}||#{einB}))
			 , #{cmpyNm}
			 , replace(#{bzn},'-','')
			 , #{ean}
			 , #{mntyOrgNm}
			 , #{brcNm}
			 , #{etcSbj}
			 , #{usePpsCd}
			 , #{rqDealInfHis}
			 , replace(#{acpDt},'-','')
			 , #{pubolSrchNoc}
			 , #{genPsoSrchNoc}
			 , #{audPenNam}
			 , #{pubolDvsnYn}
			 , #{actInfNm}
			 , #{mntyOrgInfNm}
			 , #{usrId}
			 , #{usrId}
			 , #{dptCd}
			 , #{menuNo}
			 , SYSDATE
			 , SYSDATE 
		     )
    </insert>
    
    <!-- 금융정보제출요구 상세 수정 -->
    <update id="updateDetailMntyInfSmtRqData" parameterType="paramMap">
    	/*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.updateDetailMntyInfSmtRqData*/
    	UPDATE TBBADJFS002D 
    	   SET FNL_MDF_DH 		= SYSDATE						/*최종수정일시*/
			  , IS_DT			= replace(#{isDt},'-','')		/*발부일*/
			  , NAM				= #{nam}						/*성명*/
			  , EIN				= (DGUARD.ENCRYPT('TB_ENC','EIN',#{einF}||#{einB}))
			  , CMPY_NM      	= #{cmpyNm} 					/*회사명*/
			  , BZN          	= replace(#{bzn},'-','')		/*사업자등록번호*/
			  , EAN          	= #{ean}						/*암호화계좌번호*/
			  , MNTY_ORG_NM  	= #{mntyOrgNm}					/*금융기관명*/
			  , BRC_NM       	= #{brcNm}						/*지점출장소명*/
			  , ETC_SBJ         = #{etcSbj}						/*기타*/
			  , USE_PPS_CD   	= #{usePpsCd}					/*사용목적코드*/
			  , RQ_DEAL_INF_HIS = #{rqDealInfHis}				/*요구거래정보내역*/
			  , ACP_DT          = replace(#{acpDt},'-','')		/*접수일*/
			  , PUBOL_SRCH_NOC  = #{pubolSrchNoc}				/*공직자조회건수*/
			  , GEN_PSO_SRCH_NOC= #{genPsoSrchNoc}				/*일반인조회건수*/
			  , PUBOL_DVSN_YN   = #{pubolDvsnYn}				/*공직자구분여부*/
			  , AUD_PEN_NAM   	= #{audPenNam}					/*감사자명*/
			  , ACT_INF_NM   	= #{actInfNm}					/*계좌정보명*/
			  , MNTY_ORG_INF_NM	= #{mntyOrgInfNm}				/*금융기관정보명*/
			  , FNL_USR_ID     	= #{usrId}						/*최종사용자ID*/
			  , FNL_DEAL_DPT_CD = #{dptCd}						/*최종거래부서코드*/
		 WHERE YR = #{yr}
		   AND DPT_CD = #{dptCd}
		   AND SLN = #{sln}
		   AND IS_NO = #{isNo}
    </update>
    
    <!-- 금융정보제출요구 상세 삭제 -->
    <delete id="deleteDetailMntyInfSmtRqData" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.deleteDetailMntyInfSmtRqData*/
        DELETE TBBADJFS002D
         WHERE YR = #{yr}
		   AND DPT_CD = #{dptCd}
		   AND SLN = #{sln}
		   <if test="isNo != null and isNo != ''">
			  AND IS_NO = #{isNo}
		   </if>
    </delete>
    
    <select id="selectDocId" parameterType="paramMap" resultType="egovMap" >
		/* kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectDocId*/
		SELECT DOC_ID
	      FROM TBBADJFS001M
		 WHERE YR = #{yr}
		   AND DPT_CD = #{dptCd}
		   AND SLN = #{sln}
	</select>
	<update id="updateTBBADJFS001M" parameterType="paramMap">
		/* kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.updateTBBADJFS001M*/
		UPDATE TBBADJFS001M
		   SET DOC_ID = #{docId}
              ,FNL_MDF_DH = SYSDATE
              ,FNL_USR_ID = #{usrId}
              ,FNL_DEAL_DPT_CD =#{dptCd}
		 WHERE YR = #{yr}
		   AND DPT_CD = #{dptCd}
		   AND SLN = #{sln}
	</update>
	
		<select id="getAudDocTmpData" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.getAudDocTmpData*/
		SELECT DOC_ID
	      FROM TBBADJFS001M
		 WHERE YR = #{yr}
		   AND DPT_CD = #{dptCd}
		   AND SLN = #{sln}
	</select>
	
	<!-- 금융정보제출요구 이력 -->
    <insert id="insertMntyInfSmtRqDataH" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.insertMntyInfSmtRqDataH*/
        INSERT 
		  INTO TBBADJFS001H
		     ( HST_DVSN_CD               /* 이력구분코드 */
		     , HST_SNO	                 /* 이력순번 */
		     , HST_DH					 /* 이력일시 */
		     , HST_USR_ID				 /* 이력사용자ID */
		     , YR						 /* 년도 */
		     , DPT_CD					 /* 부서코드 */
		     , SLN						 /* 연번 */
		     , AUD_YR					 /* 감서년도 */
		     , AUD_NO					 /* 감사번호 */
		     , MNTY_INF_SMT_RQ_DOC_NO    /* 금융정보제출요구문서번호 */
		     , TG_ORG_CD                 /* 대상기관코드 */
		     , PUBOL_SRCH_PTOT_NOC       /* 공직자조회순계건수 */
		     , GEN_PSO_SRCH_PTOT_NOC     /* 일반인조회순계건수 */
		     , HND_TXT                   /* 조치사항 */
		     , RMK_SBJ				     /* 비고사항 */
		     , DOC_ID                    /* 문서ID */
		     , DOC_TYP_CD                /* 문서유형코드 */
		     , ONR_SEN_DT                /* 온나라발송일 */
		     , ONR_SEN_PEN_ID            /* 온나라발송자ID */
		     , OPM_TXT                   /* 시행문내용 */
		     , ONR_DOC_MNG_CRD_ID        /* 온나라문서관리카드ID */
		     , CVPT_OPM_APV_HNDL_STA_CD  /* 민원시행문결재처리상태코드 */
		     , ADMN_INF_HNDL_NO          /* 행정정보처리번호 */
		     , ONR_APV_RQS_DH            /* 온나라결재요청일시 */
		     , ONR_APV_CMPT_DH           /* 온나라결재완료일시 */
		     , TG_ORG_NM                 /* 대상기관명 */
		     , FRT_USR_ID                /* 최초사용자ID */
		     , FNL_USR_ID                /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD           /* 최종거래부서코드 */
		     , FNL_MNU_ID                /* 최종메뉴ID */
		     , FRT_REGI_DH               /* 최초등록일시 */
		     , FNL_MDF_DH                /* 최종수정일시 */
		     , REGI_RUT                  /* 등록경로 */
			 )
		SELECT #{hstDvsnCd}              /* 이력구분코드 */
		     , TBBADJFS001H_SEQ.NEXTVAL	 /* 이력순번 */
		     , SYSDATE					 /* 이력일시 */
		     , #{usrId}				     /* 이력사용자ID */
		     , YR						 /* 년도 */
		     , DPT_CD					 /* 부서코드 */
		     , SLN						 /* 연번 */
		     , AUD_YR					 /* 감서년도 */
		     , AUD_NO					 /* 감사번호 */
		     , MNTY_INF_SMT_RQ_DOC_NO    /* 금융정보제출요구문서번호 */
		     , TG_ORG_CD                 /* 대상기관코드 */
		     , PUBOL_SRCH_PTOT_NOC       /* 공직자조회순계건수 */
		     , GEN_PSO_SRCH_PTOT_NOC     /* 일반인조회순계건수 */
		     , HND_TXT                   /* 조치사항 */
		     , RMK_SBJ				     /* 비고사항 */
		     , DOC_ID                    /* 문서ID */
		     , DOC_TYP_CD                /* 문서유형코드 */
		     , ONR_SEN_DT                /* 온나라발송일 */
		     , ONR_SEN_PEN_ID            /* 온나라발송자ID */
		     , OPM_TXT                   /* 시행문내용 */
		     , ONR_DOC_MNG_CRD_ID        /* 온나라문서관리카드ID */
		     , CVPT_OPM_APV_HNDL_STA_CD  /* 민원시행문결재처리상태코드 */
		     , ADMN_INF_HNDL_NO          /* 행정정보처리번호 */
		     , ONR_APV_RQS_DH            /* 온나라결재요청일시 */
		     , ONR_APV_CMPT_DH           /* 온나라결재완료일시 */
		     , TG_ORG_NM                 /* 대상기관명 */
		     , FRT_USR_ID                /* 최초사용자ID */
		     , FNL_USR_ID                /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD           /* 최종거래부서코드 */
		     , FNL_MNU_ID                /* 최종메뉴ID */
		     , FRT_REGI_DH               /* 최초등록일시 */
		     , FNL_MDF_DH                /* 최종수정일시 */
		     , REGI_RUT                  /* 등록경로 */
		  FROM TBBADJFS001M
		 WHERE YR = TO_CHAR(SYSDATE,'yyyy')
		   AND DPT_CD = #{dptCd}
		   AND SLN = #{sln}
    </insert>

    <select id="selectMaxSln" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectMaxSln */
            SELECT NVL(MAX(SLN),0)+1 AS SLN
		      FROM TBBADJFS001M
		     WHERE YR = TO_CHAR(SYSDATE,'yyyy')
			   AND DPT_CD = #{dptCd}
    </select>
    
    <!-- 금융정보제출요구 상세 이력 -->
    <insert id="insertDetailMntyInfSmtRqDataH" parameterType="paramMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.insertDetailMntyInfSmtRqDataH*/
        INSERT 
		  INTO TBBADJFS002H
		     ( HST_DVSN_CD               /* 이력구분코드 */
		     , HST_SNO	                 /* 이력순번 */
		     , HST_DH					 /* 이력일시 */
		     , HST_USR_ID				 /* 이력사용자ID */
		     , YR                        /* 년도 */
		     , DPT_CD                    /* 부서코드 */
		     , SLN                       /* 연번 */
		     , IS_NO                     /* 발부번호 */
		     , IS_DT                     /* 발부일 */
		     , NAM                       /* 성명 */
		     , EIN                       /* 암호화주민등록번호 */
		     , CMPY_NM                   /* 회사명 */
		     , BZN                       /* 사업자등록번호 */
		     , EAN                       /* 암호화계좌번호 */
		     , MNTY_ORG_NM               /* 금융기관명 */
		     , BRC_NM                    /* 지점명 */
		     , ETC_SBJ                   /* 기타사항 */
		     , USE_PPS_CD                /* 사용목적코드 */
		     , RQ_DEAL_INF_HIS           /* 요구거래정보내역 */
		     , ACP_DT                    /* 접수일 */
		     , PUBOL_SRCH_NOC            /* 공직자조회건수 */
		     , GEN_PSO_SRCH_NOC          /* 일반인조회건수 */
		     , PUBOL_DVSN_YN             /* 공직자구분여부 */
		     , AUD_PEN_NAM               /* 감사자성명 */
		     , ACT_INF_NM                /* 계좌정보명 */
		     , MNTY_ORG_INF_NM           /* 금융기관정보명 */
		     , FRT_USR_ID                /* 최초사용자ID */
		     , FNL_USR_ID                /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD           /* 최종거래부서코드 */
		     , FNL_MNU_ID                /* 최종메뉴 ID */
		     , FRT_REGI_DH               /* 최초등록일시 */
		     , FNL_MDF_DH                /* 최종수정일시 */
			 )
		SELECT #{hstDvsnCd}              /* 이력구분코드 */
		     , TBBADJFS002H_SEQ.NEXTVAL	 /* 이력순번 */
		     , SYSDATE					 /* 이력일시 */
		     , #{usrId}  				 /* 이력사용자ID */
		     , YR                        /* 년도 */
		     , DPT_CD                    /* 부서코드 */
		     , SLN                       /* 연번 */
		     , IS_NO                     /* 발부번호 */
		     , IS_DT                     /* 발부일 */
		     , NAM                       /* 성명 */
		     , EIN                       /* 암호화주민등록번호 */
		     , CMPY_NM                   /* 회사명 */
		     , BZN                       /* 사업자등록번호 */
		     , EAN                       /* 암호화계좌번호 */
		     , MNTY_ORG_NM               /* 금융기관명 */
		     , BRC_NM                    /* 지점명 */
		     , ETC_SBJ                   /* 기타사항 */
		     , USE_PPS_CD                /* 사용목적코드 */
		     , RQ_DEAL_INF_HIS           /* 요구거래정보내역 */
		     , ACP_DT                    /* 접수일 */
		     , PUBOL_SRCH_NOC            /* 공직자조회건수 */
		     , GEN_PSO_SRCH_NOC          /* 일반인조회건수 */
		     , PUBOL_DVSN_YN             /* 공직자구분여부 */
		     , AUD_PEN_NAM               /* 감사자성명 */
		     , ACT_INF_NM                /* 계좌정보명 */
		     , MNTY_ORG_INF_NM           /* 금융기관정보명 */
		     , FRT_USR_ID                /* 최초사용자ID */
		     , FNL_USR_ID                /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD           /* 최종거래부서코드 */
		     , FNL_MNU_ID                /* 최종메뉴 ID */
		     , FRT_REGI_DH               /* 최초등록일시 */
		     , FNL_MDF_DH                /* 최종수정일시 */ 
		  FROM TBBADJFS002D
		 WHERE YR = #{yr}
		   AND DPT_CD = #{dptCd}
		   AND SLN = #{sln}
		   <if test="isNo != null and isNo != ''">
			  AND IS_NO = #{isNo}
		   </if>
    </insert>
    
    <select id="selectMaxIsNo" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.aep.mac.dao.AEPMAC001QMapper.selectMaxIsNo */
            SELECT NVL(MAX(IS_NO),0)+1 AS IS_NO 
				  FROM TBBADJFS002D
				 WHERE YR = #{yr}
				   AND DPT_CD = #{dptCd}
				   AND SLN	  = #{sln}
    </select>
</mapper> 
