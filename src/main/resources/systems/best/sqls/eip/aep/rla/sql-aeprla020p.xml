<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper">
    
    <insert id="insertLegalReq" parameterType="paramMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.insertLegalReq*/
                MERGE INTO  TBBADDED126M T1
                    USING   (   SELECT  '1'
                                FROM    DUAL
                            ) T2
                    ON  (    T1.WRK_DVSN_CD     = NVL(#{wrkDvsnCd}, 'A10')
                         AND T1.WRK_YR          = #{wrkYr}
                         AND T1.WRK_NO          = #{wrkNo}
                         AND T1.AUD_STEP_CD     = DECODE(#{wrkDvsnCd},'D10','D1020','E10','E1040','A1060')
                         AND T1.LEGAL_REQ_SRNO  = #{legalReqSrno}
                        )
                WHEN    MATCHED THEN
                    UPDATE
                    SET     
                            T1.LEGAL_REQ_DVSN_CD   = #{legalReqDvsnCd}
                           ,T1.APVR_CD             = #{apvrCd}
                           ,T1.AFF_SNO             = #{affSno}
                           ,T1.RPRT_FILD_ID        = #{rprtFildId}
                           ,T1.FNL_USR_ID          = #{usrId}
                           ,T1.FNL_DEAL_DPT_CD     = #{dptCd}
                           ,T1.FNL_MNU_ID          = #{mnuId}
                           ,T1.FNL_MDF_DH          = SYSDATE
                WHEN    NOT MATCHED THEN
                INSERT (
                            WRK_DVSN_CD
                           ,WRK_YR
                           ,WRK_NO
                           ,AUD_STEP_CD
                           ,LEGAL_REQ_SRNO
                           ,LEGAL_REQ_GRN_SRNO
                           ,LEGAL_REQ_DH
                           ,APVR_CD
                           ,AFF_SNO
                           ,RPRT_FILD_ID
                           ,REQ_STAT_CD
                           ,LEGAL_REQ_DVSN_CD
                           ,LEGAL_RCP_YN
                           ,LEGAL_RCP_DH
                           ,HIDDEN_YN
                           ,FRT_USR_ID
                           ,FNL_USR_ID
                           ,FNL_DEAL_DPT_CD
                           ,FNL_MNU_ID
                           ,FRT_REGI_DH
                           ,FNL_MDF_DH )
                        VALUES (
                            NVL(#{wrkDvsnCd}, 'A10')
                           ,#{wrkYr}
                           ,#{wrkNo}
                           ,DECODE(#{wrkDvsnCd},'D10','D1020','E10','E1040','A1060')
                           ,(SELECT NVL(MAX(LEGAL_REQ_SRNO), 0) + 1
                               FROM TBBADDED126M
                              WHERE WRK_YR = #{wrkYr})
                           ,(SELECT NVL(MAX(LEGAL_REQ_SRNO), 0) + 1
                               FROM TBBADDED126M
                              WHERE WRK_YR = #{wrkYr})
                           ,''
                       <if test="apvrCd != null and apvrCd != ''">
                           ,#{apvrCd}
                       </if>
                       <if test="apvrCd == null or apvrCd == ''">
                           ,''
                       </if>
                       <if test="affSno != null and affSno != ''">
                           ,#{affSno}
                       </if>
                       <if test="affSno == null or affSno == ''">
                           ,''
                       </if>
                       <if test="rprtFildId != null and rprtFildId != ''">
                           ,#{rprtFildId}
                       </if>
                       <if test="rprtFildId == null or rprtFildId == ''">
                           ,''
                       </if>
                           ,'10'
                           ,#{legalReqDvsnCd}
                           ,''
                           ,''
                           ,'N'
                           ,#{usrId}
                           ,#{usrId}
                           ,#{dptCd}
                           ,#{mnuId}
                           ,SYSDATE
                           ,SYSDATE )
        
    </insert>
    
    <insert id="insertLegalReqDetail" parameterType="paramMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.insertLegalReqDetail*/
                INSERT INTO  TBBADDED126D T1
                        (
                            WRK_DVSN_CD
                          , WRK_YR
                          , WRK_NO
                          , AUD_STEP_CD
                          , LEGAL_REQ_DVSN_CD
                          , LEGAL_REQ_SRNO
                          , LEGAL_REQ_GRN_SRNO
                          , INV_ACC_CNT
                          , ENF_DT
                          , MNG_DPT_CD
                          , SPV_BRDV_CD
                          , FRT_USR_ID
                          , FNL_USR_ID
                          , FNL_DEAL_DPT_CD
                          , FNL_MNU_ID
                          , FRT_REGI_DH
                          , FNL_MDF_DH )
                        VALUES (
                            #{wrkDvsnCd}
                           ,#{wrkYr}
                           ,#{wrkNo}
                           ,DECODE(#{wrkDvsnCd},'D10','D1020','E10','E1040','')
                           ,#{legalReqDvsnCd}
                           ,#{legalReqSrno}
                           ,#{legalReqSrno}
                           ,1
                           ,(
                             SELECT MIN(ENF_DT)
                               FROM TBBADFRE013D T1
                              WHERE T1.ACP_YR = #{wrkYr}
                                AND T1.ACP_DVSN_CD = DECODE(#{wrkDvsnCd},'D10','1','E10','2','')
                                AND T1.ACP_SRNO = #{wrkNo}
                            )
                           ,#{dptCd}
                           ,#{dptCd}
                           ,#{usrId}
                           ,#{usrId}
                           ,#{dptCd}
                           ,#{mnuId}
                           ,SYSDATE
                           ,SYSDATE )
        
    </insert>
    
    <delete id="deleteLegalReq" parameterType="paramMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.deleteLegalReq*/
        <![CDATA[
            DELETE
              FROM TBBADDED126M
             WHERE WRK_DVSN_CD = #{wrkDvsnCd}
               AND WRK_YR = #{wrkYr}
               AND WRK_NO = #{wrkNo}
               AND AUD_STEP_CD = #{audStepCd}
               AND LEGAL_REQ_SRNO = #{legalReqSrno}
        ]]>
    </delete>
    
    <select id="selectDocId" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.selectDocId*/
        <![CDATA[
            SELECT MAX(DOC_ID) AS DOC_ID
              FROM TBFDMADM002M
             WHERE AUD_DOC_CD = #{rprtCd}
        ]]>
    </select>
    
    <select id="selectRprtApvList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.selectRprtApvList*/
        <![CDATA[
            SELECT G1.RPRT_NM
                  ,G1.RPRT_NM AS V_RPRT_NM
                  ,G1.APV_STA_CD
                  ,G1.APV_STA_NM
                  ,G1.DOC_ID
                  ,G1.APV_RQS_ID
                   ,(SELECT  T5.TIT_NM FROM TBBADFRE012M T5 WHERE  T5.ACP_YR = G1.ACP_YR  AND T5.ACP_DVSN_CD = G1.ACP_DVSN_CD AND T5.ACP_SRNO = G1.ACP_SRNO) AS AUD_SBJ_NM
                  ,MAX(G1.APV_INFO_1) AS APV_INFO_1
                  ,MAX(G1.APV_INFO_2) AS APV_INFO_2
                  ,MAX(G1.APV_INFO_3) AS APV_INFO_3
                  ,MAX(G1.APV_INFO_4) AS APV_INFO_4
                  ,MAX(G1.APV_INFO_5) AS APV_INFO_5
                  ,MAX(G1.APV_INFO_6) AS APV_INFO_6
                  ,MAX(G1.APV_INFO_7) AS APV_INFO_7
                  ,(
                    SELECT DECODE(COUNT(1), 0, 'N', 'Y')
                      FROM TBBADFRE111M T3
                     WHERE T3.ACP_YR = G1.ACP_YR
                       AND T3.ACP_DVSN_CD = G1.ACP_DVSN_CD
                       AND T3.ACP_SRNO = G1.ACP_SRNO
                       AND T3.RPRT_CD = G1.RPRT_CD
                       AND T3.DOC_ID = G1.DOC_ID
                   ) AS SEND_YN
                   ,(
                    SELECT T3.DOC_STA_CD
                      FROM TBBADFRE111M T3
                     WHERE T3.ACP_YR = G1.ACP_YR
                       AND T3.ACP_DVSN_CD = G1.ACP_DVSN_CD
                       AND T3.ACP_SRNO = G1.ACP_SRNO
                       AND T3.RPRT_CD = G1.RPRT_CD
                       AND T3.DOC_ID = G1.DOC_ID
                       AND T3.SND_DPT_CD = '160100' --법무에서 발신된 문서
                   ) AS SEND_STA_CD
                   ,(
                    SELECT T3.SUPPLM_REQ
                      FROM TBBADFRE111M T3
                     WHERE T3.ACP_YR = G1.ACP_YR
                       AND T3.ACP_DVSN_CD = G1.ACP_DVSN_CD
                       AND T3.ACP_SRNO = G1.ACP_SRNO
                       AND T3.RPRT_CD = G1.RPRT_CD
                       AND T3.DOC_ID = G1.DOC_ID
                       AND T3.SND_DPT_CD = '160100' --법무에서 발신된 문서
                   ) AS SUPPLM_REQ
                   ,(
                    SELECT T3.RCPT_DPT_CD
                      FROM TBBADFRE111M T3
                     WHERE T3.ACP_YR = G1.ACP_YR
                       AND T3.ACP_DVSN_CD = G1.ACP_DVSN_CD
                       AND T3.ACP_SRNO = G1.ACP_SRNO
                       AND T3.RPRT_CD = G1.RPRT_CD
                       AND T3.DOC_ID = G1.DOC_ID
                       AND T3.SND_DPT_CD = '160100' --법무에서 발신된 문서
                   ) AS RCPT_DPT_CD
                   ,(
                    SELECT DECODE(T3.RCPT_DPT_CD, '160000', '법률자문관I', '160100', '법률자문관II') 
                      FROM TBBADFRE111M T3
                     WHERE T3.ACP_YR = G1.ACP_YR
                       AND T3.ACP_DVSN_CD = G1.ACP_DVSN_CD
                       AND T3.ACP_SRNO = G1.ACP_SRNO
                       AND T3.RPRT_CD = G1.RPRT_CD
                       AND T3.DOC_ID = G1.DOC_ID
                       AND T3.SND_DPT_CD = '160100' --법무에서 발신된 문서
                   ) AS RCPT_DPT_NM
                  ,G1.RPRT_CD
                  , G1.DOC_WRT_ID
                  ,G1.DOC_TYPE
              FROM (
                SELECT ACP_YR
                      ,ACP_DVSN_CD
                      ,ACP_SRNO
                      ,RPRT_CD
                      ,RPRT_NM
                      ,APV_STA_CD
                      ,APV_STA_NM
                      ,DOC_ID
                      ,APV_RQS_ID
                       ,DOC_WRT_ID
                       ,DOC_TYPE
                      ,DECODE(ROW_ID, 1, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_1
                      ,DECODE(ROW_ID, 2, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_2
                      ,DECODE(ROW_ID, 3, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_3
                      ,DECODE(ROW_ID, 4, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_4
                      ,DECODE(ROW_ID, 5, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_5
                      ,DECODE(ROW_ID, 6, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_6
                      ,DECODE(ROW_ID, 7, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_7
                  FROM (
                    SELECT ACP_YR
	                      ,ACP_DVSN_CD
	                      ,ACP_SRNO
                          ,RPRT_CD
                          ,RPRT_NM
                          ,APV_STA_CD
                          ,APV_STA_NM
                          ,DOC_ID
                          ,APV_RQS_ID
                          ,PST_NM
                          ,APVR_NM
                          ,APV_DH
                           ,DOC_WRT_ID
                           ,DOC_TYPE
                          ,ROW_NUMBER() OVER(PARTITION BY DOC_ID ORDER BY APV_SNO) AS ROW_ID 
                      FROM (
                        SELECT T1.ACP_YR
                              ,T1.ACP_DVSN_CD
                              ,T1.ACP_SRNO
                              ,T1.RPRT_CD
                              ,T1.RPRT_NM
                              ,T1.APV_STA_CD
                              ,F_CODE_NM('1000773',APV_STA_CD) AS APV_STA_NM
                              ,T1.DOC_ID
                              ,T2.APV_SNO
                              ,T1.APV_RQS_ID
                              ,CASE WHEN APVR_PST_CD IS NULL
                                    THEN (SELECT MAX(ONR_PST_NM) FROM TBDCMACM001M WHERE CNB = APVR_CNB)
                                    ELSE F_CODE_NM('1000176', T2.APVR_PST_CD)
                               END  AS PST_NM
                              ,F_USR_INFO(T2.APVR_CNB, '2') AS APVR_NM
                              ,CASE WHEN SUBSTR(T2.APVR_STA_CD,0,1) = '2' THEN TO_CHAR(T2.APV_DH, 'YYYY-MM-DD')
                                    ELSE ''
                               END  AS APV_DH
                                ,T1.DOC_WRT_ID
                                
                              , F_OPEN_EDIT(LINK_URL) AS DOC_TYPE
                          FROM TBBADFRE103M T1
                         LEFT OUTER JOIN TBDCMACM023L T2 ON
                                    T1.APV_RQS_ID = T2.APV_DOC_NO
                                AND T2.APV_SNO <> '1' --(기안자 제외)
                                AND T2.APVR_KND_CD <> '4' --(협조자 제외)
                         WHERE T1.ACP_YR = #{wrkYr}
                           AND T1.ACP_DVSN_CD = DECODE(#{wrkDvsnCd},'D10','1','E10','2','')
                           AND T1.ACP_SRNO = #{wrkNo}
                           AND T1.RPRT_CD IN ('D10200500','E10400300','D10200900','E10400700','D10200600','E10400400','D10200800','E10400600')
                           AND T1.REF_ID = #{legalReqSrno}
                            ) 
                        )
                    ) AS G1
            GROUP BY G1.ACP_YR
                    ,G1.ACP_DVSN_CD
                    ,G1.ACP_SRNO
                    ,G1.RPRT_CD
                    ,G1.RPRT_NM
                    ,G1.APV_STA_CD
                    ,G1.APV_STA_NM
                    ,G1.DOC_ID
                    ,G1.APV_RQS_ID 
                    , G1.DOC_WRT_ID
                    ,G1.DOC_TYPE
        ]]>
    </select>
    
    <select id="selectRprtRcptList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.selectRprtRcptList*/
        <![CDATA[
            SELECT RPRT_NM
                 , DOC_ID
                 , '수신' AS STA_NM
                 , F_DPT_INFO(SND_DPT_CD, 1) AS SND_DPT_NM
                 , TO_CHAR(SND_DH, 'YYYY-MM-DD') AS SND_DT
                 , F_DPT_INFO(RCPT_DPT_CD, 1) AS RCPT_DPT_NM
                 , TO_CHAR(RCPT_DH, 'YYYY-MM-DD') AS RCPT_DT
                 , F_OPEN_EDIT(LINK_URL) AS DOC_TYPE
              FROM TBBADFRE111M 
             WHERE ACP_YR = #{wrkYr}
               AND ACP_DVSN_CD = DECODE(#{wrkDvsnCd},'D10','1','E10','2','')
               AND ACP_SRNO = #{wrkNo}
               AND RPRT_CD IN ('D10200800', 'E10400600')
               AND REF_ID = #{legalReqSrno}
        ]]>
    </select>
    
    <select id="selectRprtSndList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapperselectRprtSndList*/
        <![CDATA[
            SELECT RPRT_NM
                 , DOC_ID
                 , DECODE(DOC_STA_CD, '10', '발신', '20', '수신', '') AS STA_NM
                 , F_DPT_INFO(SND_DPT_CD, 1) AS SND_DPT_NM
                 , TO_CHAR(SND_DH, 'YYYY-MM-DD') AS SND_DT
                 , F_DPT_INFO(RCPT_DPT_CD, 1) AS RCPT_DPT_NM
                 , TO_CHAR(RCPT_DH, 'YYYY-MM-DD') AS RCPT_DT
                 , F_OPEN_EDIT(LINK_URL) AS DOC_TYPE
              FROM TBBADFRE111M 
             WHERE ACP_YR = #{wrkYr}
               AND ACP_DVSN_CD = DECODE(#{wrkDvsnCd},'D10','1','E10','2','')
               AND ACP_SRNO = #{wrkNo}
               AND RPRT_CD IN ('D10200500', 'D10200600', 'E10400300', 'E10400400')
               AND SND_DPT_CD <> '160100' --법무에서 발신된 문서 제외
               AND REF_ID = #{legalReqSrno}
        ]]>
    </select>
    
    <insert id="insertSendDoc" parameterType="paramMap">
        /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.insertSendDoc*/
            INSERT INTO TBBADFRE111M (
                   ACP_YR
                  ,ACP_DVSN_CD
                  ,ACP_SRNO
                  ,ACP_STEP_CD
                  ,DOC_ID
                  ,SR_DOC_SNO
                  ,ACP_KND_CD
                  ,ACP_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,DOC_STA_CD
                  ,SND_DPT_CD
                  ,SNDR_ID
                  ,SND_DH
                  ,RCPT_DPT_CD
                  ,RCNT_ID
                  ,RCPT_DH
                  ,ACP_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH )
           (SELECT ACP_YR
                  ,ACP_DVSN_CD
                  ,ACP_SRNO
                  ,ACP_STEP_CD
                  ,DOC_ID
                  ,(
                    SELECT NVL(MAX(SR_DOC_SNO), 0) + 1
                      FROM TBBADFRE111M T2
                     WHERE T2.ACP_YR = T1.ACP_YR
                       AND T1.ACP_DVSN_CD = T1.ACP_DVSN_CD
                       AND T2.ACP_SRNO = T1.ACP_SRNO
                       AND T2.DOC_ID = T1.DOC_ID
                   )
                  ,ACP_KND_CD
                  ,ACP_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,'10'
                  ,#{dptCd}
                  ,#{usrId}
                  ,SYSDATE
                  ,'160100'
                  ,''
                  ,SYSDATE
                  ,ACP_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,#{usrId}
                  ,#{usrId}
                  ,#{dptCd}
                  ,#{mnuId}
                  ,SYSDATE
                  ,SYSDATE 
              FROM TBBADFRE103M T1
             WHERE T1.ACP_YR = #{wrkYr}
               AND T1.ACP_DVSN_CD = DECODE(#{wrkDvsnCd},'D10','1','E10','2','')
               AND T1.ACP_SRNO = #{wrkNo}
               AND T1.DOC_ID = #{docId}
               AND T1.RPRT_CD = #{rprtCd}
             )
    </insert>
    
    <insert id="insertSendTrtmDoc" parameterType="paramMap">
        /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.insertSendTrtmDoc*/
            INSERT INTO TBBADFRE111M (
                   ACP_YR
                  ,ACP_DVSN_CD
                  ,ACP_SRNO
                  ,ACP_STEP_CD
                  ,DOC_ID
                  ,SR_DOC_SNO
                  ,ACP_KND_CD
                  ,ACP_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,DOC_STA_CD
                  ,SND_DPT_CD
                  ,SNDR_ID
                  ,SND_DH
                  ,RCPT_DPT_CD
                  ,RCNT_ID
                  ,RCPT_DH
                  ,ACP_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH )
           (SELECT ACP_YR
                  ,ACP_DVSN_CD
                  ,ACP_SRNO
                  ,ACP_STEP_CD
                  ,#{docId}
                  ,(
                    SELECT NVL(MAX(SR_DOC_SNO), 0)
                      FROM TBBADFRE111M T2
                     WHERE T2.ACP_YR = T1.ACP_YR
                       AND T2.ACP_DVSN_CD = T1.ACP_DVSN_CD
                       AND T2.ACP_SRNO = T1.ACP_SRNO
                       AND T2.DOC_ID = T1.DOC_ID
                   ) + ROWNUM
                  ,ACP_KND_CD
                  ,ACP_GRN_NO
                  ,#{rprtNm}
                  ,DECODE(ACP_DVSN_CD,'1','D10200600','2','E10400400','') AS RPRT_CD
                  ,LINK_URL
                  ,DOC_STA_CD
                  ,SND_DPT_CD
                  ,#{usrId}
                  ,SYSDATE
                  ,RCPT_DPT_CD
                  ,RCNT_ID
                  ,SYSDATE
                  ,ACP_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,#{usrId}
                  ,#{usrId}
                  ,#{dptCd}
                  ,#{mnuId}
                  ,SYSDATE
                  ,SYSDATE 
              FROM TBBADFRE111M T1
             WHERE T1.ACP_YR = #{wrkYr}
               AND T1.ACP_DVSN_CD = DECODE(#{wrkDvsnCd},'D10','1','E10','2','')
               AND T1.ACP_SRNO = #{wrkNo}
               AND T1.REF_ID = #{legalReqSrno}
               AND T1.RPRT_CD IN ('D10200500', 'E10400300')
             )
    </insert>
    
    <update id="updateReqStatCd" parameterType="paramMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.updateReqStatCd*/
        <![CDATA[
            UPDATE TBBADDED126M
               SET REQ_STAT_CD          = '20'
                 , REQ_STAT_CHG_DH      = SYSDATE
                 , LEGAL_REQ_DH         = SYSDATE
                 , FNL_USR_ID           = #{usrId}
                 , FNL_DEAL_DPT_CD      = #{dptCd}
                 , FNL_MNU_ID           = #{mnuId}
                 , FNL_MDF_DH           = SYSDATE
             WHERE WRK_DVSN_CD          = #{wrkDvsnCd}
               AND WRK_YR               = #{wrkYr}
               AND WRK_NO               = #{wrkNo}
               AND AUD_STEP_CD          = #{audStepCd}
               AND LEGAL_REQ_SRNO       = #{legalReqSrno}
               AND LEGAL_REQ_DVSN_CD    = #{legalReqDvsnCd}
        ]]>
    </update>
    
    <update id="updateReqStatCdClng" parameterType="paramMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.updateReqStatCdClng*/
        <![CDATA[
            UPDATE TBBADDED126M
               SET REQ_STAT_CD          = '90'
                 , REQ_STAT_CHG_DH      = SYSDATE
                 , LEGAL_REQ_DH         = SYSDATE
                 , FNL_USR_ID           = #{usrId}
                 , FNL_DEAL_DPT_CD      = #{dptCd}
                 , FNL_MNU_ID           = #{mnuId}
                 , FNL_MDF_DH           = SYSDATE
             WHERE WRK_DVSN_CD          = #{wrkDvsnCd}
               AND WRK_YR               = #{wrkYr}
               AND WRK_NO               = #{wrkNo}
               AND AUD_STEP_CD          = #{audStepCd}
               AND LEGAL_REQ_SRNO       = #{legalReqSrno}
               AND LEGAL_REQ_DVSN_CD    = #{legalReqDvsnCd}
        ]]>
    </update>
    
    <select id="selectDelDocId" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.selectDelDocId*/
        <![CDATA[
            SELECT DOC_ID
              FROM TBBADFRE103M
             WHERE RPRT_CD IN ('D10200500', 'D10200600', 'D10200900', 'E10400300', 'E10400400', 'E10400700')
               AND ACP_YR = #{wrkYr}
               AND ACP_SRNO = #{wrkNo}
               AND REF_ID = #{legalReqSrno}
        ]]>
    </select>
    
    <select id="selectDelDocId2" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.selectDelDocId2*/
        <![CDATA[
            SELECT DOC_ID
              FROM TBBADFRE103M
             WHERE RPRT_CD IN ('E10400300', 'E10400400', 'E10400700')
               AND ACP_YR = #{wrkYr}
               AND ACP_SRNO = #{wrkNo}
               AND REF_ID = #{legalReqSrno}
        ]]>
    </select>
    
    <update id="deleteDoc" parameterType="paramMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper."deleteDoc"*/
        <![CDATA[
            DELETE 
              FROM TBBADFRE103M
             WHERE DOC_ID = #{docId}
        ]]>
    </update>
    
    
    <select id="selectLawListBADFRE" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.selectLawListBADFRE*/
        <![CDATA[
    	SELECT LEGAL_REQ_DVSN_CD
                 , AUD_YR_NO
                 , AFF_NO
                 , AFF_NO AS AFF_NO_REGI
                 , TITLE_NM
                 , RQS_DOC_NM
                 , RQS_DOC_NM AS V_RQS_DOC_NM
                 , RQS_DOC_ID
                 , RQS_DOC_TYPE
                 , RQS_DOC_SND_DT
                 , RQS_DOC_APV_STA_CD
                 , NVL(F_CODE_NM('1000773', RQS_DOC_APV_STA_CD), '미작성') AS RQS_DOC_APV_STA_NM
                 , RQS_DOC_APV_RQS_ID
                 , NVL(RQS_DOC_SND_DT, '미발신') RQS_DOC_SND_STA_NM
                 , OPIN_DOC_NM
                 , OPIN_DOC_NM AS V_OPIN_DOC_NM
                 , OPIN_DOC_ID
                 , OPIN_DOC_TYPE
                 , OPIN_DOC_RCPT_NM
                 , EXAM_DOC_NM
                 , EXAM_DOC_NM AS V_EXAM_DOC_NM
                 , EXAM_DOC_ID
                 , EXAM_DOC_TYPE
                 , EXAM_DOC_APV_STA_CD
                 , NVL(F_CODE_NM('1000773', EXAM_DOC_APV_STA_CD), '미작성') AS EXAM_DOC_APV_STA_NM
                 , EXAM_DOC_APV_RQS_ID
                 , WRK_YR
                 , WRK_NO
                 , LEGAL_REQ_SRNO
                 , AFF_SNO
                 , APVR_CD
                 , TRTM_DOC_ID
                 , REQ_STAT_CD
                 , F_CODE_NM('1000830', REQ_STAT_CD) AS REQ_STAT_NM
                 , WRK_DVSN_CD
                 , AUD_STEP_CD
                 , SUPPLM_REQ_CNT
                /*, (SELECT MAX(ST2.AUD_KND_CD) FROM TBBADDED001M ST2 WHERE ST2.AUD_YR = WRK_YR AND ST2.AUD_NO = WRK_NO) AS AUD_KND_CD */
              FROM (
                SELECT T1.LEGAL_REQ_DVSN_CD
                     , T2.ACP_YR || '-' || DECODE(T2.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || DECODE(T2.ORG_ACP_SRNO, null, T2.ACP_SRNO, T2.ORG_ACP_SRNO) AS AUD_YR_NO
                     , T2.ACP_YR || '-' || DECODE(T2.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || DECODE(T2.ORG_ACP_SRNO, null, T2.ACP_SRNO, T2.ORG_ACP_SRNO) AS AFF_NO
                     , T2.TIT_NM AS TITLE_NM
                     , (SELECT MAX(RPRT_NM)
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200500', 'E10400300')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_NM   /*요청서*/
                     , (SELECT MAX(DOC_ID)
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200500', 'E10400300')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_ID   /*요청서*/
                     , (SELECT F_OPEN_EDIT(MAX(LINK_URL))
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200500', 'E10400300')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_TYPE   /*요청서*/
                     , (SELECT TO_CHAR(MAX(SND_DH), 'YYYY-MM-DD')
                          FROM TBBADFRE111M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200500', 'E10400300')
                           AND RCPT_DPT_CD = '160100'
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_SND_DT   /*요청서*/
                     , (SELECT MAX(APV_STA_CD)
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200500', 'E10400300')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_APV_STA_CD   /*요청서*/
                     , (SELECT MAX(APV_RQS_ID)
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200500', 'E10400300')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_APV_RQS_ID   /*요청서*/
                     , (SELECT MAX(RPRT_NM)
                          FROM TBBADFRE111M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200700', 'E10400500')
                           AND SND_DPT_CD = DECODE(T1.LEGAL_REQ_DVSN_CD, '30', '160000', '160100')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS OPIN_DOC_NM          /*의견서*/
                     , (SELECT MAX(DOC_ID)
                          FROM TBBADFRE111M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200700', 'E10400500')
                           AND SND_DPT_CD = DECODE(T1.LEGAL_REQ_DVSN_CD, '30', '160000', '160100')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS OPIN_DOC_ID          /*의견서*/
                     , (SELECT F_OPEN_EDIT(MAX(LINK_URL))
                          FROM TBBADFRE111M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200700', 'E10400500')
                           AND SND_DPT_CD = DECODE(T1.LEGAL_REQ_DVSN_CD, '30', '160000', '160100')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS OPIN_DOC_TYPE          /*의견서*/
                     , NVL((SELECT MAX('수신('||TO_CHAR(RCPT_DH, 'YYYY-MM-DD')||')')
                          FROM TBBADFRE111M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200700', 'E10400500')
                           AND SND_DPT_CD = DECODE(T1.LEGAL_REQ_DVSN_CD, '30', '160000', '160100')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)), '미수신') AS OPIN_DOC_RCPT_NM /*의견서*/
                     , (SELECT MAX(RPRT_NM)
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200900', 'E10400700')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS EXAM_DOC_NM  /*검토보고서*/
                     , (SELECT MAX(DOC_ID)
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200900', 'E10400700')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS EXAM_DOC_ID  /*검토보고서*/
                     , (SELECT F_OPEN_EDIT(MAX(LINK_URL))
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200900', 'E10400700')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS EXAM_DOC_TYPE  /*검토보고서*/
                     , (SELECT APV_STA_CD
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200900', 'E10400700')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS EXAM_DOC_APV_STA_CD  /*검토보고서*/
                     , (SELECT MAX(APV_RQS_ID)
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200900', 'E10400700')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS EXAM_DOC_APV_RQS_ID  /*검토보고서*/
                     , (SELECT MAX(DOC_ID)
                          FROM TBBADFRE103M
                         WHERE ACP_YR = T1.WRK_YR
                           AND ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                           AND ACP_SRNO = T1.WRK_NO
                           AND RPRT_CD IN ('D10200600', 'E10400400')
                           AND REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS TRTM_DOC_ID  /*처리안*/
                       ,(SELECT COUNT(T3.DOC_ID) AS CNT
                        FROM TBBADFRE111M T3
                       WHERE T3.ACP_YR = T1.WRK_YR
                          AND T3.ACP_SRNO = T1.WRK_NO
                          AND T3.ACP_DVSN_CD = DECODE(T1.WRK_DVSN_CD,'D10','1','E10','2','3')
                          AND T3.RPRT_CD IN  ('D10200600', 'E10400400', 'D10200500', 'E10400300')
                          AND T3.SND_DPT_CD = '160100' --법무에서 발신된 문서
                          AND T3.REF_ID = TO_CHAR(T1.LEGAL_REQ_SRNO)
                          AND T3.DOC_STA_CD = '51'
                       ) AS SUPPLM_REQ_CNT
                     , T1.WRK_YR
                     , T1.WRK_NO
                     , T1.LEGAL_REQ_SRNO
                     , '' AS AFF_SNO
                     , '' AS APVR_CD
                     , T1.REQ_STAT_CD
                     , T1.WRK_DVSN_CD
                     , T1.AUD_STEP_CD
                  FROM TBBADDED126M T1
                  LEFT OUTER JOIN TBBADFRE012M T2 ON (T1.WRK_YR = T2.ACP_YR AND T1.WRK_NO = T2.ACP_SRNO AND T1.WRK_DVSN_CD = DECODE(T2.ACP_DVSN_CD, '1', 'D10', '2', 'E10', 'A10'))
                  WHERE NVL(T2.MG_ACP_YR, T2.ACP_YR) = #{audYr}
                   AND NVL(T2.MG_ACP_SRNO, T2.ACP_SRNO) = #{audNo}
                   AND NVL(T2.MG_ACP_DVSN_CD, T2.ACP_DVSN_CD) = #{acpDvsnCd}
             )
             ORDER BY DECODE(REQ_STAT_CD, '70', '30', REQ_STAT_CD), LEGAL_REQ_SRNO DESC
    	]]>
    </select>
    
    <update id="updateSendDocBADFRE" parameterType="paramMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.updateSendDocBADFRE*/
        <![CDATA[
              UPDATE TBBADFRE111M
                   SET DOC_STA_CD = '52'
                      , FNL_USR_ID           = #{usrId}
                      , FNL_DEAL_DPT_CD      = #{dptCd}
                      , FNL_MNU_ID           = #{mnuId}
                      , FNL_MDF_DH           = SYSDATE
                    WHERE DOC_ID = #{docId}
                      AND RCPT_DPT_CD = #{rcptDptCd}
                      AND ACP_YR = #{wrkYr}
                      AND ACP_SRNO = #{wrkNo}
                      AND REF_ID = #{legalReqSrno}
        ]]>
    </update>
    
    <update id="updateBlockEdtAuthBADFRE" parameterType="paramMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.updateBlockEdtAuthBADFRE*/
        <![CDATA[
              UPDATE TBBADFRE103M
                   SET EDT_AUTH = NULL
                      , FNL_USR_ID           = #{usrId}
                      , FNL_DEAL_DPT_CD      = #{dptCd}
                      , FNL_MNU_ID           = #{mnuId}
                      , FNL_MDF_DH           = SYSDATE
                    WHERE DOC_ID = #{docId}
                      AND ACP_YR = #{wrkYr}
                      AND ACP_SRNO = #{wrkNo}
                      AND REF_ID = #{legalReqSrno}
        ]]>
    </update>
    
    <select id="selectSendMsgInfoBADFRE" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA020PMapper.selectSendMsgInfoBADFRE*/
        <![CDATA[
            SELECT A.ACP_YR || '-' || DECODE(A.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || A.ACP_SRNO AS ACP_NO /* 분류번호 */
                   , NVL(A.TIT_NM, ' ') AS TIT_NM
                   , (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = A.DPT_CD) AS DPT_NM
                   , F_CODE_NM('1000828', #{legalReqDvsnCd}) AS LEGAL_REQ_DVSN_NM
                   , (SELECT NVL(AGGR_CONCAT(ST.USR_DFN_TXT_2,''), '000') FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000859' AND USR_DFN_TXT_1 = '3') AS RCPT_USR_CNB
                   , (SELECT COUNT(ST.USR_DFN_TXT_1) FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000859' AND USR_DFN_TXT_1 = '3') AS RCPT_USR_CNT
              FROM TBBADFRE012M A
             WHERE A.ACP_YR = #{wrkYr}
               AND A.ACP_DVSN_CD = DECODE(#{wrkDvsnCd},'D10','1','E10','2','')
               AND A.ACP_SRNO = #{wrkNo}
        ]]>
    </select>
    
      <select id="selectRlaReqInfoBADFRE" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.rla.dao.AEPRLA001PMapper.selectRlaReqInfo*/
        <![CDATA[
           SELECT USR_NAM AS USR_NAM
                    ,F_DPT_INFO(DPT_CD,'1') AS DPT_NM
            FROM TBDCMACM001M
           WHERE USR_ID = #{usrId}
        ]]>
    </select>
</mapper> 