<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.asb.dao.AEPASB025PMapper">
    
    <select id="selectSbmtDocList" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.aep.asb.dao.AEPASB025PMapper.selectSbmtDocList*/
        /*서면의견 서류 */
        SELECT
         	AUD_YR   /*감사년도 */
            ,AUD_NO  /*감사번호 */
            ,AUD_STEP_CD  /* 감사단계코드 */
            ,DOC_ID  /* 감사보고서 ID */
            ,APVR_CD  /* 결재자코드 */
            ,AFF_SNO   /* 사건순번 */
            ,SBMT_SEQ  /* 안건순번 */
            ,SBMT_FILE_SEQ  /* 서면의견 문서 순번 */	
            ,SBMT_DOC_ID   /* 서면의견 문서 ID */
            ,SBMT_FILE_NM  /* 서면의견 문서명 */
            ,SBMT_ORG_PER  /* 제출자 */
            ,SBMT_ORG_TYPE_YN  /* 제출기관수기입력여부 */
            ,SBMT_ORG_CD   /* 제출기관코드 */
            ,CASE
	             WHEN SBMT_ORG_TYPE_YN = '1'
				 THEN F_ORG_INFO(SBMT_ORG_CD,'1')  
				 WHEN SBMT_ORG_TYPE_YN = '2'
				 THEN SBMT_ORG_NM
				 ELSE ''
		     END AS SBMT_ORG_NM   /* 제출기관명 */
            ,TO_CHAR(TO_DATE(SBMT_ORG_DT,'YYYY-MM-DD'),'YYYY-MM-DD') AS SBMT_ORG_DT   /* 제출일자 */
            ,SBMT_SORT_SNO /* 서면의견 문서 정렬순서 */
            ,F_USR_INFO_BY_ID(FRT_USR_ID,'2') AS FRT_USR_NM /*최초사용자ID명 */
            ,TO_CHAR(FRT_REGI_DH,'YYYY-MM-DD') FRT_REGI_DH  /*최초등록일시 */
            FROM TBBADDED114L  A
          WHERE 1=1
            <if test='audYr != null and audYr != ""'>
                AND A.AUD_YR = #{audYr}
            </if>
            <if test='audNo != null and audNo != ""'>
                AND A.AUD_NO = #{audNo}
            </if>
            <if test='affSno != null and affSno != ""'>
                AND A.AFF_SNO = #{affSno}
            </if>
            <if test='sbmtSeq != null and sbmtSeq != ""'>
                AND A.SBMT_SEQ = #{sbmtSeq}
            </if>
            
            ORDER BY SBMT_SORT_SNO, SBMT_FILE_SEQ  ASC
    </select>
    
    
    <insert id="insertSbmtDocFile" parameterType="paramMap">
        /*kr.go.bai.eip.aep.asb.dao.AEPASB025PMapper.insertSbmtDocFile*/
        /*서면의견 Insert*/
        INSERT INTO TBBADDED114L
        (
            AUD_YR  /* 감사년도 */
			,AUD_NO   /* 감사번호 */
			,AUD_STEP_CD   /* 감사단계코드 */
			,DOC_ID   /* 감사보고서 ID */
			,APVR_CD   /* 결재자코드 */
			,AFF_SNO   /* 사건순번 */
			,SBMT_SEQ   /* 안건순번 */
			,SBMT_FILE_SEQ   /* 서면의견 문서 순번 */	
			,SBMT_DOC_ID   /* 서면의견 문서 ID */
			,SBMT_FILE_NM   /* 서면의견 문서명 */
			,SBMT_ORG_PER   /* 제출자 */
			,SBMT_ORG_TYPE_YN   /* 제출기관수기입력여부 */
			,SBMT_ORG_CD   /* 제출기관코드 */
			,SBMT_ORG_NM   /* 제출기관명 */
			,SBMT_ORG_DT   /* 제출일자 */
			,SBMT_SORT_SNO   /* 서면의견 문서 정렬순서 */
			,FRT_USR_ID   /* 최초사용자ID */
			,FNL_USR_ID   /* 최종사용자ID */
			,FNL_DEAL_DPT_CD   /* 최종거래부서코드 */
			,FNL_MNU_ID   /* 최종메뉴ID */
			,FRT_REGI_DH   /* 최초등록일시 */
			,FNL_MDF_DH   /* 최종수정일시 */
        )
        values
        (
            #{audYr}        
            ,#{audNo}       
            ,#{audStepCd}  
            ,#{docId} 
            ,#{apvrCd} 
            ,#{affSno}
            ,#{sbmtSeq}
            ,(SELECT NVL(MAX(SBMT_FILE_SEQ),0)+1
                 FROM TBBADDED114L
                  WHERE AUD_YR = #{audYr}
                  AND AUD_NO = #{audNo}
                  AND AFF_SNO = #{affSno} 
                  AND SBMT_SEQ = #{sbmtSeq} 
              )
            ,#{sbmtDocId}  
            ,#{sbmtFileNm} 
            ,#{sbmtOrgPer}  
            ,#{sbmtOrgTypeYn}  
            ,#{sbmtOrgCd}  
            ,#{sbmtOrgNm} 
            ,REPLACE(#{sbmtOrgDt},'-')
            ,#{sbmtSortSno}  
            ,#{frtUsrId}  /*최초사용자id */
            ,#{fnlUsrId} /*최종사용자id */
            ,#{fnlDealDptCd}    /*최종거래부서코드 */
            ,#{fnlMnuId} /*최종메뉴id */
            ,SYSDATE    /*최초등록일시 */
            ,SYSDATE /*최종수정일시 */
        )
    </insert>
    
    
    <update id="updateSbmtDocFile" parameterType="paramMap">
        /*kr.go.bai.eip.aep.asb.dao.AEPASB025PMapper.updateSbmtDocFile*/
        /*서면의견 Update*/
        UPDATE TBBADDED114L
             SET 
                 SBMT_ORG_PER = #{sbmtOrgPer} 	
	    		 , SBMT_ORG_TYPE_YN = #{sbmtOrgTypeYn} 
                 , SBMT_ORG_CD = #{sbmtOrgCd} 
                 , SBMT_ORG_NM = #{sbmtOrgNm} 		                 
	    		 , SBMT_ORG_DT= REPLACE(#{sbmtOrgDt},'-')
                 , FNL_USR_ID = #{fnlUsrId} /*최종사용자ID */
                 , FNL_DEAL_DPT_CD = #{fnlDealDptCd} /*최종거래부서코드 */
	    		 , FNL_MNU_ID = #{fnlMnuId} /*최종메뉴ID */
	     	     , FNL_MDF_DH = SYSDATE /*최종수정일시 */
         WHERE AUD_YR = #{audYr}
            AND AUD_NO = #{audNo}
            AND AFF_SNO = #{affSno}
            AND SBMT_SEQ = #{sbmtSeq}
            AND SBMT_FILE_SEQ = #{sbmtFileSeq}
    </update>
    
    
    <delete id="deleteSbmtDocFile" parameterType="paramMap">
	    /*kr.go.bai.aep.asb.dao.AEPASB025PMapper.deleteSbmtDocFile*/
	    /*서면의견 Delete*/
	        DELETE FROM TBBADDED114L
	        WHERE SBMT_DOC_ID = #{sbmtDocId} /*서면의견 파일 ID */
	            <if test='audYr != null and audYr != ""'>
	                AND AUD_YR = #{audYr}
	            </if>
	            <if test='audNo != null and audNo != ""'>
	                AND AUD_NO = #{audNo}
	            </if>
	            <if test='affSno != null and affSno != ""'>
	                AND AFF_SNO = #{affSno}
	            </if>
	            <if test='sbmtSeq != null and sbmtSeq != ""'>
	                AND SBMT_SEQ  = #{sbmtSeq}
	            </if>
	            <if test='sbmtFileSeq != null and sbmtFileSeq != ""'>
	                AND SBMT_FILE_SEQ  = #{sbmtFileSeq}
	            </if>
    </delete>
    

</mapper> 
