<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.osm.dao.AEPOSM010PMapper">
    
    <select id="selectMainList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM010PMapper.selectMainList*/
        <include refid="include.pageSelct" />
           SELECT 
                T2.CMT_SBJ_TIT
                , CASE 
                    WHEN T1.CMT_SBCN_YN = 'Y' AND T3.CMTR_SBCN_Y_CNT <![CDATA[>]]> T3.CMTR_SBCN_N_CNT THEN '가결'
                    WHEN T1.CMT_SBCN_YN = 'Y' AND T3.CMTR_SBCN_Y_CNT <![CDATA[<]]> T3.CMTR_SBCN_N_CNT THEN '부결'
                    ELSE '-'
                  END AS CMT_SBCN_NM
                , T3.CMTR_SBCN_Y_CNT||'/'||T3.CMTR_SBCN_N_CNT AS CMTR_SBCN_YN
                , F_DPT_INFO(REL_DPT_CD,'1') AS REL_DPT_NM
                , NVL(T3.CMTR_CNT,0) AS CMTR_CNT
                , NVL(T3.CMTR_SBCN_CNT,0) AS CMTR_SBCN_CNT
              FROM TBBADDED120M T1
                   INNER JOIN TBBADDED121M T2
                   ON (T1.CMT_DY = T2.CMT_DY
                       AND T1.CMT_DVSN_CD = T2.CMT_DVSN_CD
                       AND T1.CMT_SQ = T2.CMT_SQ)
                   INNER JOIN (SELECT 
                                COUNT(1) AS CMTR_CNT
                                , SUM(DECODE(CMTR_SBCN_YN,'Y',1,0)) CMTR_SBCN_Y_CNT
                                , SUM(DECODE(CMTR_SBCN_YN,'N',1,0)) CMTR_SBCN_N_CNT
                                , SUM(DECODE(CMTR_SBCN_YN,'N',1,DECODE(CMTR_SBCN_YN,'Y',1,0))) CMTR_SBCN_CNT
                                , CMT_DY
                                , CMT_DVSN_CD
                                , CMT_SQ
                                , CMT_SBJ_DVSN_CD
                                , CMT_SBJ_SNO
                            FROM TBBADDED123M
                            GROUP BY CMT_DY, CMT_DVSN_CD, CMT_SQ, CMT_SBJ_DVSN_CD, CMT_SBJ_SNO) T3
                    ON (T2.CMT_DY = T3.CMT_DY
                        AND T2.CMT_DVSN_CD = T3.CMT_DVSN_CD
                        AND T2.CMT_SQ = T3.CMT_SQ
                        AND T2.CMT_SBJ_DVSN_CD = T3.CMT_SBJ_DVSN_CD
                        AND T2.CMT_SBJ_SNO = T3.CMT_SBJ_SNO)
             WHERE T1.CMT_DY = REPLACE(#{cmtDy},'-')
               AND T1.CMT_DVSN_CD = #{cmtDvsnCd}
               AND T1.CMT_SQ = #{cmtSq}
        <include refid="include.pageOrder" />
    </select>
    
    <select id="selectVtList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM010PMapper.selectVtList*/
        SELECT 
            F_CODE_NM('1000176', F_USR_INFO(CMTR_ID, '4')) AS CMTR_PST_NM
            , F_USR_INFO(CMTR_ID, '2') AS CMTR_NM
            , DECODE(CMTR_SBCN_YN,'Y','Y','N') AS CMTR_SBCN_Y
            , DECODE(CMTR_SBCN_YN,'N','Y','N') AS CMTR_SBCN_N
            , SBCN_VT_TXT
          FROM TBBADDED123M T1
         WHERE T1.CMT_DY = REPLACE(#{cmtDy},'-')
           AND T1.CMT_DVSN_CD = #{cmtDvsnCd}
           AND T1.CMT_SQ = #{cmtSq}
           AND CMT_SBJ_DVSN_CD = '90'
           AND CMT_SBJ_SNO = 1
    </select>

   
   
    <select id="selectSubByAddNList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM010PMapper.selectSubByAddNList*/
        <include refid="include.pageSelct" />
            SELECT F_MNG_KND_AUDYRNO(D2.AUD_YR,D2.AUD_NO, D2.AUD_KND_CD, '-') AS AUD_KND_GRN_AFF_DSP_SNO,
                   D1.TITLE_NM,
                   CASE WHEN D3.RLTN_ORG_CD IS NOT NULL THEN F_ORG_INFO(D3.RLTN_ORG_CD,'1') ELSE '' END COPT_OFI_NM,
                   F_CODE_NM('1000002',D.DSP_RQ_CD ) AS DSP_RQ_NM,
                   CASE D.SBCN_VT_CD WHEN '90' THEN '보류' ELSE F_CODE_NM('1000772',D.SBCN_VT_CD) END AS SBCN_VT_NM,
                   SBCN_VT_TXT,
                   D.AUD_YR,
                   D.AUD_NO,
                   D.DOC_ID,
                   D.APVR_CD,
                   D.AFF_SNO,
                   D.DSP_RQ_SNO,
                   D.SBCN_DY
              FROM TBBADDED113M AS D
        INNER JOIN TBBADDED145M AS D1 ON D.AUD_YR = D1.AUD_YR
                                     AND D.AUD_NO = D1.AUD_NO
                                     AND D.APVR_CD = D1.APVR_CD
                                     AND D.AFF_SNO = D1.AFF_SNO
        INNER JOIN TBBADDED146M AS D3 ON D.AUD_YR = D3.AUD_YR
                                     AND D.AUD_NO = D3.AUD_NO
                                     AND D.APVR_CD = D3.APVR_CD
                                     AND D.AFF_SNO = D3.AFF_SNO
                                     AND D.DSP_RQ_SNO = D3.DSP_RQ_SNO
        INNER JOIN TBBADDED001M AS D2 ON D.AUD_YR = D2.AUD_YR
                                     AND D.AUD_NO = D2.AUD_NO
             WHERE D.AUD_YR           =  #{audYr}
               AND D.AUD_NO           =  #{audNo}
               AND D.SBCN_DY = REPLACE(#{cmtDy},'-')
          ORDER BY D.AFF_SNO
        <include refid="include.pageOrder" />
    </select>
    
    
    <select id="selectSubByAddYList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM010PMapper.selectSubByAddYList*/
        <include refid="include.pageSelct" />
            SELECT CMT_SBJ_DTL_TIT,
                   NVL(DOC_ID,'-') AS DOC_ID,
                   CMT_SBJ_DTL_SNO,
                   CASE SBCN_VT_CD WHEN '10' THEN '의결'
                                   WHEN '20' THEN '부결'
                                   ELSE '' END AS SBCN_VT_NM,
                   SBCN_VT_TXT,
                   CMT_DY,
                   CMT_DVSN_CD,
                   CMT_SQ,
                   CMT_SBJ_DVSN_CD,
                   CMT_SBJ_SNO,
                   FILE_NM
              FROM TBBADDED122M
             WHERE CMT_DY = REPLACE(#{cmtDy},'-')
               AND CMT_DVSN_CD = #{cmtDvsnCd}
               AND CMT_SQ = #{cmtSq}
               AND CMT_SBJ_DVSN_CD = #{cmtSbjDvsnCd}
               AND CMT_SBJ_SNO = #{cmtSbjSno}
        <include refid="include.pageOrder" />
    </select>
    
    <update id="updateBADDED120M" parameterType="paramMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM010PMapper.updateBADDED120M*/
        UPDATE TBBADDED120M SET CMT_END_YN = 'Y',
                                CMT_END_DH = SYSDATE,
                                FNL_USR_ID = #{usrId},
                                FNL_DEAL_DPT_CD = #{dptCd},
                                FNL_MNU_ID = #{menuNo},
                                FNL_MDF_DH = SYSDATE
                          WHERE CMT_DY = REPLACE(#{cmtDy},'-')
                            AND CMT_DVSN_CD = #{cmtDvsnCd}
                            AND CMT_SQ = #{cmtSq}
    </update>
    
</mapper>