<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper">
	
	<!-- 특수관리사항 목록조회 BADFRE013EMainselect-->
	<select id="selectMainList" parameterType="paramMap" resultType="egovMap">
	    <!-- <include refid="include.pageSelct" /> -->
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.selectMainList */
	      SELECT 
                 D1.AUD_YR                                                            /* 감사년도                   */
                ,D1.AUD_NO                                                            /* 감사번호                   */
                ,D4.AUD_GRN_NO                                                        /* 감사부여번호 - 2016.06.02 yyh */
                ,D1.DSP_RQ_SNO                                                        /* 처분요구순번               */
                ,D1.RLTN_ORG_CD                                                       /* 관계기관코드               */
                ,F_ORG_INFO(D1.RLTN_ORG_CD,'1')                    AS RLTN_ORG_NM     /* 관계기관명               */
                ,D1.MNG_SNO                                                           /* 관리순번                   */
                ,D1.SPV_BRDV_CD                                                       /* 주관국과코드               */
                ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')                    AS SPV_BRDV_NM     /* 주관국과명               */
                ,D1.DTM_YN                                                            /* 확정여부        */
                ,D1.MNG_ORG_CD                                                        /* 관리기관코드    */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1')                     AS MNG_ORG_NM      /* 관리기관명        */
                ,TO_CHAR(TO_DATE(D1.ASG_DT),'YYYY-MM-DD')          AS ASG_DT          /* 지정일                     */
                ,D1.ASG_AM                                                            /* 지정금액                   */
                ,D1.CPS_DRTR_NM                                                       /* 변상책임자명               */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1') || '(' ||
                 D1.CPS_DRTR_NM || ')'                             AS ORG_DRTR_NM     /* 관리기관(책임자) */                     
                ,D1.CPS_DRTR_AD                                                       /* 변상책임자주소             */
                ,TO_CHAR(TO_DATE(D1.RLS_DT),'YYYY-MM-DD') AS RLS_DT           /* 해제일                     */
                ,D1.RLS_RSN                                                           /* 해제사유                   */
                ,D1.RQR_ID                                                            /* 요청자ID      */
                ,F_USR_INFO(D1.RQR_ID,'2')                         AS RQR_NM          /* 요청자명      */
                ,TO_CHAR(TO_DATE(D1.RQS_DT),'YYYY-MM-DD') AS RQS_DT         /* 요청일                     */
                ,D1.RQS_RSN                                                           /* 요청사유                   */
                ,D1.APV_DOC_NO                                                        /* 결재문서번호     */
                ,D1.APV_STA_CD                                                        /* 결재상태코드               */
                ,CASE WHEN D1.APV_STA_CD IS NULL THEN '미상신'
                      ELSE F_CODE_NM('1000603', D1.APV_STA_CD)
                  END                                              AS APV_STA_NM      /* 결재상태명               */
                ,TO_CHAR(TO_DATE(D1.APV_STA_DT),'YYYY-MM-DD')   AS APV_STA_DT                                                        /* 결재상태일                 */
                ,D1.MNG_YR                                                            /* 관리년도                   */
                ,D1.MNG_NO                                                            /* 관리번호                   */
                ,D1.SLF_PRSS_STA_CD                                                   /* 자체진행상태코드           */
                ,TO_CHAR(TO_DATE(D1.SLF_APV_DT),'YYYY-MM-DD') AS SLF_APV_DT                                                        /* 자체결재일                 */
                ,TO_CHAR(TO_DATE(D1.SLF_SEN_DT),'YYYY-MM-DD') AS SLF_SEN_DT                                                        /* 자체발송일                 */
                ,D1.SPCN_MNG_STA_CD                                                   /* 특수관리상태코드           */
                ,D1.ASG_RSN                                                           /* 지정사유                   */
                ,D1.EXAM_RPT_FRM_ENFM_HIS                                             /* 검토보고서식집행내역       */
                ,D1.EXAM_RPT_FRM_ASG_RSN                                              /* 검토보고서식지정사유       */
                ,D1.EXAM_RPT_FRM_EXAM_OPIN                                            /* 검토보고서식검토의견       */
                ,D1.EXAM_RPT_FRM_APV_STA_CD                                           /* 검토보고서식결재상태코드   */
                ,TO_CHAR(TO_DATE(D1.EXAM_RPT_FRM_APV_STA_DT),'YYYY-MM-DD') AS EXAM_RPT_FRM_APV_STA_DT                                           /* 검토보고서식결재상태일     */
            	,D1.EXAM_RPT_FRM_APV_DOC_NO                                           /* 검토보고서식결재문서번호 */
                ,D1.DOC_ID                                                            /* 문서ID      */
                ,D1.DOC_TYP_CD                                                        /* 문서유형코드               */
                ,D1.FRT_USR_ID                                                        /* 최초사용자ID    */
                ,D1.FNL_USR_ID                                                        /* 최종사용자ID   */
                ,D1.FNL_DEAL_DPT_CD                                                   /* 최종거래부서코드           */
                ,D1.FNL_MNU_ID                                                        /* 최종메뉴ID    */
                ,D1.FRT_REGI_DH                                                       /* 최초등록일시               */
                ,D1.FNL_MDF_DH                                                        /* 최종수정일시       */
                /*  ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D4.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO      AS DSP_RQ_NO       처분요구번호                   */
 		     	,NVL2(D2.ACT_DSP_NM,D2.ACT_DSP_NM, F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D4.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO  ) AS DSP_RQ_NO
 		     	
 		     	
 		     	, D4.AUD_KND_CD
 		     	, CASE WHEN D2.AUD_YR >= '2016' 
			                THEN SUBSTR(D4.AUD_KND_CD,3,1)
			           ELSE '' 
			       END                                             AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.24 yyh*/	                                                                   
                ,D2.TIT_TXT                                        AS TIT_TXT         /* 제목내용                   */
                ,CASE WHEN NVL(D1.DTM_YN,'N')   != 'Y' 
                           AND D1.ASG_DT        IS NOT NULL                 
        	               AND D1.RLS_DT        IS NULL     THEN '지정X'
        	          WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
        	               AND D1.ASG_DT        IS NOT NULL                  
    	                   AND D1.RLS_DT        IS NULL     THEN '지정O'
    	              WHEN NVL(D1.DTM_YN,'N')  != 'Y'                 
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제X'
    	              WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제O'
    	             END                                           AS DVSN                 /* 구분                   */
                
                ,D3.ENF_BRDV_CD                                    AS ENF_BRDV_CD          /* 시행국과명 */
                ,F_DPT_INFO(D3.ENF_BRDV_CD,'1')                    AS ENF_BRDV_NM          /* 시행국과명 */                
                ,D2.DSP_RQ_KND_CD                                  AS DSP_RQ_KND_CD        /* 처분요구종류코드 */
                ,F_CODE_NM('1000002', D2.DSP_RQ_KND_CD)            AS DSP_RQ_KND_NM        /* 처분요구종류명 */
                ,D3.PNL_DRIN_PSVT_AM                               AS PNL_DRIN_PSVT_AM     /* 추징회수보전금액 */ 
                ,TO_CHAR(TO_DATE(D3.ENF_DT),'YYYY-MM-DD')          AS ENF_DT               /* 시행일 */
                ,D4.AUD_SBJ_NM                                     AS AUD_SBJ_NM           /* 감사사항명 */
                ,D3.EXAM_RPRT_DSP_RQ_SBT                           AS EXAM_RPRT_DSP_RQ_SBT /* 검토보고서 처분요구요지 */
                ,(SELECT SUM(AM)
                    FROM TBBADEAR007M /* 관계자 기본 */
                   WHERE 1=1
                     AND AUD_YR     = D1.AUD_YR    
        	         AND AUD_NO     = D1.AUD_NO     
        	         AND DSP_RQ_SNO = D1.DSP_RQ_SNO)               AS DSP_RQ_TAM           /* 처분요구 전체 금액 */
        	         
           FROM TBBADFRE011M D1  /* 특수관리기본 */
               ,TBBADEAR001M D2  /* 처분요구사항기본 */
               ,TBBADEAR002D D3  /* 처분요구사항 상세 */
               ,TBBADDED001M D4  /* 감사사항기본 */               
          WHERE 1=1
            AND D1.AUD_YR        = D2.AUD_YR    
        	AND D1.AUD_NO        = D2.AUD_NO     
        	AND D1.DSP_RQ_SNO    = D2.DSP_RQ_SNO
            AND D2.AUD_YR        = D3.AUD_YR    
        	AND D2.AUD_NO        = D3.AUD_NO     
        	AND D2.DSP_RQ_SNO    = D3.DSP_RQ_SNO 
        	AND D3.AUD_YR        = D4.AUD_YR    
        	AND D3.AUD_NO        = D4.AUD_NO        	
            AND D1.SLF_PRSS_STA_CD  &gt;= '71'
            
            AND D1.SPV_BRDV_CD   IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, #{dptAuth}, '', #{upSpvBrdvCd})))
			            
            <!-- 주관국과코드 -->    
			<if test='spvBrdvCd != null and spvBrdvCd != ""'>
                AND D1.SPV_BRDV_CD = #{spvBrdvCd}
            </if> 
            
            <!-- 기관에서 지정요청할 사항 -->
			<if test='asgDvsn == "1"'>
               AND D1.ASG_DT IS NULL
               AND D1.RLS_DT IS NULL 
	        </if>     
            <!-- 지정한 사항 -->
			<if test='asgDvsn == "2"'>
               AND D1.ASG_DT IS NOT NULL
               AND D1.RLS_DT IS NULL 
	        </if>                 
            <!-- 해제한 사항 -->
			<if test='asgDvsn == "3"'>
               AND D1.RLS_DT IS NOT NULL   
	        </if>               
  
			<!-- 검색어 -->
			<if test='schTxt != null and schTxt != ""'>
                AND ( (SELECT ORG_NM 
                         FROM TBDCMACM015M                                
        		        WHERE ORG_CD = D1.MNG_ORG_CD) LIKE  '%' || #{schTxt} || '%'
        		     OR D1.CPS_DRTR_NM  LIKE  '%' || #{schTxt} || '%'
        		     OR D2.TIT_TXT      LIKE  '%' || #{schTxt} || '%'
        		    )
            </if>
           
            <!-- 결재확정  -->
			<if test='apvDtm != null and apvDtm != ""'>
                AND NVL(D1.APV_STA_CD,'1') = #{apvDtm}
            </if>
            
            <!-- 감사연번 -->
			<if test='audYr != null and audYr != ""'>
                AND D1.AUD_YR = #{audYr}
            </if>
            <!-- 감사부여번호 추가 - 2016.06.02 yyh -->
			<if test='audGrnNo != null and audGrnNo != ""'>
                AND D4.AUD_GRN_NO = #{audGrnNo}
            </if>            
			<if test='audYrNoKndCd != null and audYrNoKndCd != ""'>
	              /* 감사연번종류코드 - 2015.12.24 yyh */
				  AND SUBSTR(D4.AUD_KND_CD,3,1) = #{audYrNoKndCd} 
			</if>		
            
        ORDER BY D1.AUD_YR DESC 
               , D1.AUD_NO DESC
               , D1.DSP_RQ_SNO DESC
               , D1.RLTN_ORG_CD DESC
               , D1.MNG_SNO DESC
        <!-- <include refid="include.pageOrder" /> -->
	</select>
	
	
	<select id="BADFRE013EPopselect" parameterType="paramMap" resultType="egovMap">
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.?? */
	      SELECT 
                 D1.AUD_YR                                                            /* 감사년도                   */
                ,D1.AUD_NO                                                            /* 감사번호                   */
                ,D4.AUD_GRN_NO                                                        /* 감사부여번호 - 2016.06.02 yyh */
                ,D1.DSP_RQ_SNO                                                        /* 처분요구순번               */
                ,D1.RLTN_ORG_CD                                                       /* 관계기관코드               */
                ,F_ORG_INFO(D1.RLTN_ORG_CD,'1')                    AS RLTN_ORG_NM     /* 관계기관명               */
                ,D1.MNG_SNO                                                           /* 관리순번                   */
                ,D1.SPV_BRDV_CD                                                       /* 주관국과코드               */
                ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')                    AS SPV_BRDV_NM     /* 주관국과명               */
                ,D1.DTM_YN                                                            /* 확정여부        */
                ,D1.MNG_ORG_CD                                                        /* 관리기관코드    */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1')                     AS MNG_ORG_NM      /* 관리기관명        */
                ,TO_CHAR(TO_DATE(D1.ASG_DT),'YYYY-MM-DD')          AS ASG_DT          /* 지정일                     */
                ,D1.ASG_AM                                                            /* 지정금액                   */
                ,D1.CPS_DRTR_NM                                                       /* 변상책임자명               */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1') || '(' ||
                 D1.CPS_DRTR_NM || ')'                             AS ORG_DRTR_NM     /* 관리기관(책임자) */                     
                ,D1.CPS_DRTR_AD                                                       /* 변상책임자주소             */
                ,TO_CHAR(TO_DATE(D1.RLS_DT),'YYYY-MM-DD') AS RLS_DT           /* 해제일                     */
                ,D1.RLS_RSN                                                           /* 해제사유                   */
                ,D1.RQR_ID                                                            /* 요청자ID      */
                ,F_USR_INFO(D1.RQR_ID,'2')                         AS RQR_NM          /* 요청자명      */
                ,TO_CHAR(TO_DATE(D1.RQS_DT),'YYYY-MM-DD') AS RQS_DT         /* 요청일                     */
                ,D1.RQS_RSN                                                           /* 요청사유                   */
                ,D1.APV_DOC_NO                                                        /* 결재문서번호     */
                ,D1.APV_STA_CD                                                        /* 결재상태코드               */
                ,CASE WHEN D1.APV_STA_CD IS NULL THEN '미상신'
                      ELSE F_CODE_NM('1000603', D1.APV_STA_CD)
                  END                                              AS APV_STA_NM      /* 결재상태명               */
                ,D1.APV_STA_DT                                                        /* 결재상태일                 */
                ,D1.MNG_YR                                                            /* 관리년도                   */
                ,D1.MNG_NO                                                            /* 관리번호                   */
                ,D1.SLF_PRSS_STA_CD                                                   /* 자체진행상태코드           */
                ,D1.SLF_APV_DT                                                        /* 자체결재일                 */
                ,D1.SLF_SEN_DT                                                        /* 자체발송일                 */
                ,D1.SPCN_MNG_STA_CD                                                   /* 특수관리상태코드           */
                ,D1.ASG_RSN                                                           /* 지정사유                   */
                ,D1.EXAM_RPT_FRM_ENFM_HIS                                             /* 검토보고서식집행내역       */
                ,D1.EXAM_RPT_FRM_ASG_RSN                                              /* 검토보고서식지정사유       */
                ,D1.EXAM_RPT_FRM_EXAM_OPIN                                            /* 검토보고서식검토의견       */
                ,D1.EXAM_RPT_FRM_APV_STA_CD                                           /* 검토보고서식결재상태코드   */
                ,D1.EXAM_RPT_FRM_APV_STA_DT                                           /* 검토보고서식결재상태일     */
            	,D1.EXAM_RPT_FRM_APV_DOC_NO                                           /* 검토보고서식결재문서번호 */
                ,D1.DOC_ID                                                            /* 문서ID      */
                ,D1.DOC_TYP_CD                                                        /* 문서유형코드               */
                ,D1.FRT_USR_ID                                                        /* 최초사용자ID    */
                ,D1.FNL_USR_ID                                                        /* 최종사용자ID   */
                ,D1.FNL_DEAL_DPT_CD                                                   /* 최종거래부서코드           */
                ,D1.FNL_MNU_ID                                                        /* 최종메뉴ID    */
                ,D1.FRT_REGI_DH                                                       /* 최초등록일시               */
                ,D1.FNL_MDF_DH                                                        /* 최종수정일시       */
                /* ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D4.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO       AS DSP_RQ_NO        처분요구번호                   */
 		     	,NVL2(D2.ACT_DSP_NM,D2.ACT_DSP_NM, F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D4.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO  ) AS DSP_RQ_NO
 		     	
 		     	, CASE WHEN D2.AUD_YR >= '2016' 
			                THEN SUBSTR(D4.AUD_KND_CD,3,1)
			           ELSE '' 
			       END                                             AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.24 yyh*/	                                                                     
                ,D2.TIT_TXT                                        AS TIT_TXT         /* 제목내용                   */
                ,CASE WHEN NVL(D1.DTM_YN,'N')   != 'Y' 
                           AND D1.ASG_DT        IS NOT NULL                 
        	               AND D1.RLS_DT        IS NULL     THEN '지정X'
        	          WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
        	               AND D1.ASG_DT        IS NOT NULL                  
    	                   AND D1.RLS_DT        IS NULL     THEN '지정O'
    	              WHEN NVL(D1.DTM_YN,'N')  != 'Y'                 
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제X'
    	              WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제O'
    	             END                                           AS DVSN                 /* 구분                   */
                
                ,D3.ENF_BRDV_CD                                    AS ENF_BRDV_CD          /* 시행국과명 */
                ,F_DPT_INFO(D3.ENF_BRDV_CD,'1')                    AS ENF_BRDV_NM          /* 시행국과명 */                
                ,D2.DSP_RQ_KND_CD                                  AS DSP_RQ_KND_CD        /* 처분요구종류코드 */
                ,F_CODE_NM('1000002', D2.DSP_RQ_KND_CD)            AS DSP_RQ_KND_NM        /* 처분요구종류명 */
                ,D3.PNL_DRIN_PSVT_AM                               AS PNL_DRIN_PSVT_AM     /* 추징회수보전금액 */ 
                ,TO_CHAR(TO_DATE(D3.ENF_DT),'YYYY-MM-DD')          AS ENF_DT               /* 시행일 */
                ,D4.AUD_SBJ_NM                                     AS AUD_SBJ_NM           /* 감사사항명 */
                ,D3.EXAM_RPRT_DSP_RQ_SBT                           AS EXAM_RPRT_DSP_RQ_SBT /* 검토보고서 처분요구요지 */
                ,(SELECT SUM(AM)
                    FROM TBBADEAR007M /* 관계자 기본 */
                   WHERE 1=1
                     AND AUD_YR     = D1.AUD_YR    
        	         AND AUD_NO     = D1.AUD_NO     
        	         AND DSP_RQ_SNO = D1.DSP_RQ_SNO)               AS DSP_RQ_TAM           /* 처분요구 전체 금액 */
        	         
           FROM TBBADFRE011M D1  /* 특수관리기본 */
               ,TBBADEAR001M D2  /* 처분요구사항기본 */
               ,TBBADEAR002D D3  /* 처분요구사항 상세 */
               ,TBBADDED001M D4  /* 감사사항기본 */               
          WHERE 1=1
            AND D1.AUD_YR        = D2.AUD_YR    
        	AND D1.AUD_NO        = D2.AUD_NO     
        	AND D1.DSP_RQ_SNO    = D2.DSP_RQ_SNO
            AND D2.AUD_YR        = D3.AUD_YR    
        	AND D2.AUD_NO        = D3.AUD_NO     
        	AND D2.DSP_RQ_SNO    = D3.DSP_RQ_SNO 
        	AND D3.AUD_YR        = D4.AUD_YR    
        	AND D3.AUD_NO        = D4.AUD_NO        	
            AND D1.SLF_PRSS_STA_CD  &gt;= '71'
            AND D1.AUD_YR        = #{audYr}
            AND D1.AUD_NO        = #{audNo}
            AND D1.DSP_RQ_SNO    = #{dspRqSno}
            AND D1.RLTN_ORG_CD   = #{rltnOrgCd}
            AND D1.MNG_SNO       = #{mngSno}
        ORDER BY D1.AUD_YR DESC 
               , D1.AUD_NO DESC
               , D1.DSP_RQ_SNO DESC
               , D1.RLTN_ORG_CD DESC
               , D1.MNG_SNO DESC
	</select>

	<!-- 특수관리사항 상세조회 BADFRE013EMainDtlselect-->
	<select id="selectMainDtl" parameterType="paramMap" resultType="egovMap">
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.selectMainDtl */
	      SELECT 
                 D1.AUD_YR                                                      /* 감사년도                   */
                ,D1.AUD_NO                                                      /* 감사번호                   */
                ,D4.AUD_GRN_NO                                                  /* 감사부여번호 - 2016.06.02 yyh */                
                ,D1.DSP_RQ_SNO                                                  /* 처분요구순번               */
                ,SUBSTR(D4.AUD_KND_CD,3,1)                  AS AUD_YR_NO_KND_CD
                /* ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D4.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO */
                ,NVL2(D2.ACT_DSP_NM,D2.ACT_DSP_NM, F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D4.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO  )
                                                            AS AUD_YR_NO        /* 감사연번호 - 2016.06.09 yyh */
                ,D1.RLTN_ORG_CD                                                 /* 관계기관코드               */
                ,F_ORG_INFO(D1.RLTN_ORG_CD,'1')             AS RLTN_ORG_NM      /* 관계기관명               */
                ,D1.MNG_SNO                                                     /* 관리순번                   */
                ,D1.SPV_BRDV_CD                                                 /* 주관국과코드               */
                ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')             AS SPV_BRDV_NM      /* 주관국과명               */
                ,D1.DTM_YN                                                      /* 확정여부                  */
                ,D1.MNG_ORG_CD                                                  /* 관리기관코드               */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1')              AS MNG_ORG_NM       /* 관리기관명        */
                ,TO_CHAR(TO_DATE(D1.ASG_DT),'YYYY-MM-DD')   AS ASG_DT           /* 지정일                     */
                ,D1.ASG_AM                                                      /* 지정금액                   */
                ,D1.CPS_DRTR_NM                                                 /* 변상책임자명               */                   
                ,D1.CPS_DRTR_AD                                                 /* 변상책임자주소             */
                ,TO_CHAR(TO_DATE(D1.RLS_DT),'YYYY-MM-DD') AS RLS_DT     /* 해제일                     */
                ,D1.RLS_RSN                                                     /* 해제사유                   */
                ,D1.RQR_ID                                                      /* 요청자ID      */
                ,F_USR_INFO(D1.RQR_ID,'2')                  AS RQR_NM           /* 요청자명      */
                ,TO_CHAR(TO_DATE(D1.RQS_DT),'YYYY-MM-DD') AS RQS_DT   /* 요청일                     */
                ,D1.RQS_RSN                                                     /* 요청사유                   */
                ,D1.APV_DOC_NO                                                  /* 결재문서번호     */
                ,D1.APV_STA_CD                                                  /* 결재상태코드               */
                ,TO_CHAR(TO_DATE(D1.APV_STA_DT),'YYYY-MM-DD')   AS APV_STA_DT  /* 결재상태일                 */
                ,D1.MNG_YR                                                      /* 관리년도                   */
                ,D1.MNG_NO                                                      /* 관리번호                   */
                ,D1.SLF_PRSS_STA_CD                                             /* 자체진행상태코드           */
                ,TO_CHAR(TO_DATE(D1.SLF_APV_DT),'YYYY-MM-DD') AS SLF_APV_DT    /* 자체결재일                 */
                ,TO_CHAR(TO_DATE(D1.SLF_SEN_DT),'YYYY-MM-DD') AS SLF_SEN_DT     /* 자체발송일                 */
                ,D1.SPCN_MNG_STA_CD                                             /* 특수관리상태코드           */
                ,D1.ASG_RSN                                                     /* 지정사유                   */
                ,D1.EXAM_RPT_FRM_ENFM_HIS                                       /* 검토보고서식집행내역       */
                ,D1.EXAM_RPT_FRM_ASG_RSN                                        /* 검토보고서식지정사유       */
                ,D1.EXAM_RPT_FRM_EXAM_OPIN                                      /* 검토보고서식검토의견       */
                ,D1.EXAM_RPT_FRM_APV_STA_CD                                     /* 검토보고서식결재상태코드   */
                ,TO_CHAR(TO_DATE(D1.EXAM_RPT_FRM_APV_STA_DT),'YYYY-MM-DD') AS EXAM_RPT_FRM_APV_STA_DT    /* 검토보고서식결재상태일     */
                ,D1.EXAM_RPT_FRM_APV_DOC_NO                                     /* 검토보고서식결재문서번호 */
                ,D1.DOC_ID                                                      /* 문서ID      */
                ,D1.DOC_TYP_CD                                                  /* 문서유형코드               */ 
                
                ,D3.ENF_BRDV_CD                             AS ENF_BRDV_CD      /* 시행국과명 */
                ,F_DPT_INFO(D3.ENF_BRDV_CD,'1')             AS ENF_BRDV_NM      /* 시행국과명 */
                ,D2.DSP_RQ_KND_CD                           AS DSP_RQ_KND_CD    /* 처분요구종류코드 */
                ,F_CODE_NM('1000002', D2.DSP_RQ_KND_CD)     AS DSP_RQ_KND_NM    /* 처분요구종류명 */
                ,D2.TIT_TXT                                 AS TIT_TXT          /* 제목내용 */ 
                ,D3.PNL_DRIN_PSVT_AM                        AS PNL_DRIN_PSVT_AM /* 추징회수보전금액 */ 
                ,TO_CHAR(TO_DATE(D3.ENF_DT),'YYYY-MM-DD')   AS ENF_DT           /* 시행일 */
                ,D4.AUD_SBJ_NM                              AS AUD_SBJ_NM       /* 감사사항명 */
                ,D3.EXAM_RPRT_DSP_RQ_SBT                    AS EXAM_RPRT_DSP_RQ_SBT /* 검토보고서 처분요구요지 */
                ,(SELECT SUM(AM)
                    FROM TBBADEAR007M /* 관계자 기본 */
                   WHERE 1=1
                     AND AUD_YR     = D1.AUD_YR    
        	         AND AUD_NO     = D1.AUD_NO     
        	         AND DSP_RQ_SNO = D1.DSP_RQ_SNO)        AS DSP_RQ_TAM           /* 처분요구 전체 금액 */ 
        	         
        	    ,D1.SPV_BRDV_CD                     AS ENFM_MNG_BRDV_CD
        	    ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')     AS ENFM_MNG_BRDV_NM             
                           
           FROM TBBADFRE011M D1  /* 특수관리기본 */
               ,TBBADEAR001M D2  /* 처분요구사항 기본*/
               ,TBBADEAR002D D3  /* 처분요구사항 상세 */
               ,TBBADDED001M D4  /* 감사사항기본 */
          WHERE 1=1
            AND D1.AUD_YR        = D2.AUD_YR    
        	AND D1.AUD_NO        = D2.AUD_NO     
        	AND D1.DSP_RQ_SNO    = D2.DSP_RQ_SNO   
            AND D2.AUD_YR        = D3.AUD_YR    
        	AND D2.AUD_NO        = D3.AUD_NO     
        	AND D2.DSP_RQ_SNO    = D3.DSP_RQ_SNO 
        	AND D3.AUD_YR        = D4.AUD_YR    
        	AND D3.AUD_NO        = D4.AUD_NO
            AND D1.AUD_YR        = #{audYr}      /* 감사년도 */
            AND D1.AUD_NO        = #{audNo}      /* 감사번호 */
            AND D1.DSP_RQ_SNO    = #{dspRqSno}   /* 처분요구순번 */
            AND D1.RLTN_ORG_CD   = #{rltnOrgCd}  /* 관계기관코드 */
            AND D1.MNG_SNO       = #{mngSno}     /* 관리순번 */           
	</select>


	<!-- 특수관리 집행내역 조회 BADFRE013EHisselect -->
	<select id="selectHis" parameterType="paramMap" resultType="egovMap">
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.selectHis */
	      SELECT 
                 AUD_YR                                     /* 감사년도 */
                ,AUD_NO                                     /* 감사번호 */   
                ,DSP_RQ_SNO                                 /* 처분요구순번 */
                ,RLTN_ORG_CD                                /* 관계기관코드 */
                ,F_ORG_INFO(RLTN_ORG_CD,'1') AS RLTN_ORG_NM /* 관계기관명 */
                ,MNG_SNO                                    /* 관리순번 */
                ,SLN                                        /* 연번 */     
                ,TO_CHAR(TO_DATE(ENFM_DT),'YYYY-MM-DD') AS ENFM_DT     /* 집행일 */             
                ,ENFM_AM                                    /* 집행금액 */           
                ,ENFM_TXT                                   /* 집행내용 */           
                ,DTM_YN                                     /* 확정여부 */           
	       FROM TBBADFRE011L
	      WHERE 1=1
	        AND AUD_YR        = #{audYr}      /* 감사년도 */
            AND AUD_NO        = #{audNo}      /* 감사번호 */
            AND DSP_RQ_SNO    = #{dspRqSno}   /* 처분요구순번 */
            AND RLTN_ORG_CD   = #{rltnOrgCd}  /* 관계기관코드 */
            AND MNG_SNO       = #{mngSno}     /* 관리순번 */  
	      ORDER BY SLN DESC 
	</select>
	
	<!-- 특수관리 기본 입력 BADFRE013EMaininsert -->
	<insert id="insertMain" parameterType="paramMap">
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.insertMain */
         INSERT INTO TBBADFRE011M          /* 특수관리 기본 */
         (
              AUD_YR                            
             ,AUD_NO
             ,DSP_RQ_SNO
             ,RLTN_ORG_CD
             ,MNG_SNO
             ,SPV_BRDV_CD
             ,MNG_ORG_CD
             ,ASG_DT
             ,ASG_AM
             ,CPS_DRTR_NM
             ,CPS_DRTR_AD
             ,RLS_DT
             ,RLS_RSN
             ,RQR_ID
             ,RQS_DT
             ,RQS_RSN
             ,MNG_YR
             ,MNG_NO
             ,SLF_PRSS_STA_CD
             ,SLF_APV_DT
             ,SLF_SEN_DT
             ,SPCN_MNG_STA_CD
             ,ASG_RSN
             ,EXAM_RPT_FRM_ENFM_HIS
             ,EXAM_RPT_FRM_ASG_RSN
             ,EXAM_RPT_FRM_EXAM_OPIN
             ,EXAM_RPT_FRM_APV_STA_CD
             ,EXAM_RPT_FRM_APV_STA_DT
             ,EXAM_RPT_FRM_APV_DOC_NO
             ,DOC_ID
             ,DOC_TYP_CD
             ,FRT_USR_ID
             ,FNL_USR_ID
             ,FNL_DEAL_DPT_CD
             ,FNL_MNU_ID
             ,FRT_REGI_DH
             ,FNL_MDF_DH
         ) VALUES (
              #{audYr}                          /* 감사년도           - */                
             ,#{audNo}                          /* 감사번호            - */
             ,#{dspRqSno}                      /* 처분요구순번      - */
             ,#{rltnOrgCd}                     /* 관계기관코드    - */
             ,#{mngSno}                         /* 관리순번       - */
             ,#{enfmMngBrdvCd ,jdbcType=VARCHAR}                 /* 주관국과코드 spvBrdvCd을 enfmMngBrdvCd로 변경처리 - 2018.06.20 yyh */
             ,#{mngOrgCd ,jdbcType=VARCHAR}                      /* 관리기관코드         - */
             ,REPLACE(#{asgDt ,jdbcType=VARCHAR},'-','')         /* 지정일           - */
             ,#{asgAm ,jdbcType=VARCHAR}                          /* 지정금액         - */
             ,#{cpsDrtrNm ,jdbcType=VARCHAR}                     /* 변상책임자명     - */
             ,#{cpsDrtrAd ,jdbcType=VARCHAR}                     /* 변상책임자주소    */
             ,REPLACE(#{rlsDt ,jdbcType=VARCHAR},'-','')        /* 해제일             - */
             ,#{rlsRsn ,jdbcType=VARCHAR}                         /* 해제사유         - */
             ,#{rqrId ,jdbcType=VARCHAR}                          /* 요청자ID */
             ,REPLACE(#{rqsDt ,jdbcType=VARCHAR},'-','')                          /* 요청일            - */
             ,#{rqsRsn ,jdbcType=VARCHAR}                         /* 요청사유          - */
             ,#{mngYr ,jdbcType=VARCHAR}                          /* 관리년도        -  */
             ,#{mngNo ,jdbcType=VARCHAR}                          /* 관리번호        -  */
             ,#{slfPrssStaCd ,jdbcType=VARCHAR}                 /* 자체진행상태코드          */
             ,REPLACE(#{slfApvDt ,jdbcType=VARCHAR},'-','')     /* 자체결재일                */
             ,REPLACE(#{slfSenDt ,jdbcType=VARCHAR},'-','')     /* 자체발송일                */
             ,'1'                               /* 특수관리상태코드(1:지정접수) */
             ,#{asgRsn ,jdbcType=VARCHAR}                         /* 지정사유                  */
             ,#{examRptFrmEnfmHis ,jdbcType=VARCHAR}           /* 검토보고서식집행내역      */
             ,#{examRptFrmAsgRsn ,jdbcType=VARCHAR}            /* 검토보고서식지정사유      */
             ,#{examRptFrmExamOpin ,jdbcType=VARCHAR}          /* 검토보고서식검토의견      */
             ,#{examRptFrmApvStaCd ,jdbcType=VARCHAR}         /* 검토보고서식결재상태코드  */
             ,REPLACE(#{examRptFrmApvStaDt ,jdbcType=VARCHAR},'-','') /* 검토보고서식결재상태일    */
             ,#{examRptFrmApvDocNo ,jdbcType=VARCHAR}         /* 검토보고서식결재문서번호  */
             ,#{docId ,jdbcType=VARCHAR}                          /* 문서ID          */
             ,#{docTypCd ,jdbcType=VARCHAR}                      /* 문서유형코드              */
             ,#{frtUsrId}                      /* 최초사용자ID      */
             ,#{fnlUsrId}                      /* 최종사용자ID      */
             ,#{fnlDealDptCd}                 /* 최종거래부서코드          */
             ,#{fnlMnuId}                      /* 최종메뉴ID       */
             ,SYSDATE                           /* 최초등록일시              */
             ,SYSDATE                           /* 최종수정일시              */
         ) 
	</insert>	
	
	<!-- 특수관리기본 수정 -->
	<update id="updateMain" parameterType="paramMap">
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.updateMain */
        UPDATE TBBADFRE011M                                      /* 특수관리 기본 */ 
		  SET ASG_DT                 = REPLACE(#{asgDt ,jdbcType=VARCHAR},'-','')                  /* 지정일 */          
		     ,ASG_AM                 = #{asgAm}                  /* 지정금액 */
             ,ASG_RSN                = #{asgRsn}                 /* 지정사유 */
             ,CPS_DRTR_NM            = #{cpsDrtrNm}             /* 변상책임자명 */          
             ,CPS_DRTR_AD            = #{cpsDrtrAd ,jdbcType=VARCHAR}             /* 변상책임자주소 */
             ,RLS_DT                 = REPLACE(#{rlsDt ,jdbcType=VARCHAR},'-','')       /* 해제일 */
             ,RLS_RSN                = #{rlsRsn ,jdbcType=VARCHAR}                 /* 해제사유 */
			 ,RQR_ID                 = #{rqrId}                  /* 요청자ID */
			 ,RQS_DT                 = REPLACE(#{rqsDt ,jdbcType=VARCHAR},'-','')  /* 요청일 */
			 ,RQS_RSN                = #{rqsRsn}                 /* 요청사유 */
			 ,SPCN_MNG_STA_CD        = '1'                       /* 특수관리상태코드(1:지정접수) */
             ,EXAM_RPT_FRM_ENFM_HIS  = #{examRptFrmEnfmHis ,jdbcType=VARCHAR}   /* 검토보고서식집행내역 */ 
             ,EXAM_RPT_FRM_ASG_RSN   = #{examRptFrmAsgRsn ,jdbcType=VARCHAR}    /* 검토보고서식지정사유 */
             ,EXAM_RPT_FRM_EXAM_OPIN = #{examRptFrmExamOpin ,jdbcType=VARCHAR}  /* 검토보고서식검토의견 */			 
             ,FNL_MDF_DH             = SYSDATE                   /* 최종수정일시 */ 
             ,FNL_USR_ID             = #{fnlUsrId}              /* 최종사용자ID */       
             ,FNL_DEAL_DPT_CD        = #{fnlDealDptCd}         /* 최종거래부서코드 */
             ,FNL_MNU_ID             = #{fnlMnuId}              /* 최종메뉴ID */		
             ,DOC_ID                 = #{docId}                 /* 문서id - 2018.04.04 yyh */
             ,DOC_TYP_CD             = #{docTypCd}              /* 문서유형코드 */
             ,MNG_ORG_CD             = #{mngOrgCd}              /* 관리기관코드추가 - 2018.06.21 yyh */
        WHERE AUD_YR                 = #{audYr}                  /* 감사년도 */
		  AND AUD_NO                 = #{audNo}                  /* 감사번호 */
          AND DSP_RQ_SNO             = #{dspRqSno}              /* 처분요구순번 */
          AND RLTN_ORG_CD            = #{rltnOrgCd}             /* 관계기관코드 */
          AND MNG_SNO                = #{mngSno}                 /* 관리순번 */
	</update>		
	
	<!-- 특수관리기본 삭제 BADFRE013EMaindelete-->
	<update id="deleteMain" parameterType="paramMap">
	/*  kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.deleteMain */
          DELETE 
            FROM TBBADFRE011M                   /* 특수관리 기본 */ 
           WHERE AUD_YR      = #{audYr}         /* 감사년도 */
		     AND AUD_NO      = #{audNo}         /* 감사번호 */
             AND DSP_RQ_SNO  = #{dspRqSno}     /* 처분요구순번 */
             AND RLTN_ORG_CD = #{rltnOrgCd}    /* 관계기관코드 */
             AND MNG_SNO     = #{mngSno}        /* 관리순번 */
	</update>	
	
	<!-- 특수관리기본 해제 BADFRE013EMainRlsupdate-->
	<update id="updateMainRls" parameterType="paramMap">
	/*  kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.updateMainRls*/
	
        UPDATE TBBADFRE011M                            /* 특수관리 기본 */ 
		  SET RLS_DT            = REPLACE(#{rlsDt ,jdbcType=VARCHAR},'-','')  /* 해제일 */
             ,RLS_RSN           = #{rlsRsn}            /* 해제사유 */
             ,SPCN_MNG_STA_CD   = '3'                  /* 특수관리상태코드(3:해제접수) */
             ,FNL_MDF_DH        = SYSDATE              /* 최종수정일시 */ 
             ,FNL_USR_ID        = #{fnlUsrId ,jdbcType=VARCHAR}         /* 최종사용자ID */       
             ,FNL_DEAL_DPT_CD   = #{fnlDealDptCd ,jdbcType=VARCHAR}    /* 최종거래부서코드 */
             ,FNL_MNU_ID        = #{fnlMnuId ,jdbcType=VARCHAR}         /* 최종메뉴ID */			 
             ,DOC_ID            = #{docId}                 /* 문서id - 2018.04.04 yyh */
             ,DOC_TYP_CD        = #{docTypCd}              /* 문서유형코드 */
        WHERE AUD_YR            = #{audYr}             /* 감사년도 */
		  AND AUD_NO            = #{audNo}             /* 감사번호 */
          AND DSP_RQ_SNO        = #{dspRqSno}         /* 처분요구순번 */
          AND RLTN_ORG_CD       = #{rltnOrgCd}        /* 관계기관코드 */
          AND MNG_SNO           = #{mngSno}            /* 관리순번 */
	</update>		
	
	<!-- 특수관리기본의 max관리번호를 조회한다.  BADFRE013EMaxMngNoselect-->
	<select id="selectMaxMngNo" parameterType="paramMap" resultType="egovMap">
        /*  kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.selectMaxMngNo */
        SELECT NVL(MAX(MNG_NO),0) + 1 AS MNG_NO
          FROM TBBADFRE011M /* 특수관리기본 */
         WHERE MNG_YR = #{mngYr}	
	</select>
	
	<!-- 특수관리기본의 max관리순번을 조회한다. BADFRE013EMaxMngSnoselect-->
	<select id="selectMaxMngSno" parameterType="paramMap" resultType="egovMap">	
	    /*  kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.selectMaxMngSno */
	    
	    SELECT NVL(MAX(MNG_SNO),0) + 1 AS MNG_SNO
          FROM TBBADFRE011M
         WHERE AUD_YR      = #{audYr}
           AND AUD_NO      = #{audNo}
           AND DSP_RQ_SNO  = #{dspRqSno}
           AND RLTN_ORG_CD = #{rltnOrgCd}
	</select>
	
	<!-- 결재문서번호로 조회  BADFRE013EKeyApvDocNoselect -->
	<select id="selectKeyApvDocNo" parameterType="paramMap" resultType="egovMap">
	    /*  kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.selectKeyApvDocNo */
	    
	    SELECT                  
	           D1.AUD_YR          /* 감사년도 */   
	          ,D1.AUD_NO          /* 감사번호 */  
	          ,D1.DSP_RQ_SNO      /* 처분요구순번 */         
	          ,D1.RLTN_ORG_CD     /* 관계기관코드 */
	          ,D1.MNG_SNO         /* 관리순번 */      
	     FROM TBBADFRE011M  D1    /* 특수관리기본 */
	    WHERE D1.APV_DOC_NO = #{apvDocNo}
	</select>	
	
	<!-- 결재처리정보를 수정한다 
	<update id="BADFRE013EApvInfoupdate" parameterType="paramMap">
           UPDATE TBBADFRE011M                                          /* 특수관리 기본 */ 
              SET APV_DOC_NO              = #{apvDocNo}                /* 결재문서번호 */
                 ,APV_STA_CD              = #{apvStaCd}                /* 결재상태코드 */
                 
			<isNotNull property="apvStaDt">
                 ,APV_STA_DT              = #{apvStaDt}                /* 결재상태일 */
            </isNotNull>     
			<isNull property="apvStaDt">
				 ,APV_STA_DT              = TO_CHAR(SYSDATE,'YYYYMMDD') /* 결재상태일 */
			</isNull>
			
				 ,EXAM_RPT_FRM_APV_DOC_NO = #{apvDocNo}                /* 검토보고서식결재문서번호 */
                 ,EXAM_RPT_FRM_APV_STA_CD = #{apvStaCd}                /* 검토보고서식결재상태코드 */

			<isNotNull property="apvStaDt">
                 ,EXAM_RPT_FRM_APV_STA_DT = #{apvStaDt}                /* 검토보고서식결재상태일 */
            </isNotNull>     
			<isNull property="apvStaDt">
				 ,EXAM_RPT_FRM_APV_STA_DT = TO_CHAR(SYSDATE,'YYYYMMDD') /* 검토보고서식결재상태일 */
			</isNull>

            WHERE AUD_YR       = #{audYr}         /* 감사년도 */ 
              AND AUD_NO       = #{audNo}         /* 감사번호 */
              AND DSP_RQ_SNO   = #{dspRqSno}     /* 처분요구순번 */
              AND RLTN_ORG_CD  = #{rltnOrgCd}    /* 관계기관코드 */
              AND MNG_SNO      = #{mngSno}        /* 관리순번 */ 
	</update>	
	-->
	<!-- 특수관리 집행내역 delete "BADFRE013EHisdelete"-->
	<update id="deleteHis" parameterType="paramMap">
          
          /* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.deleteHis */
          DELETE 
            FROM TBBADFRE011L
           WHERE AUD_YR      = #{audYr}       /* 감사년도 */
             AND AUD_NO      = #{audNo}       /* 감사번호 */
             AND DSP_RQ_SNO  = #{dspRqSno}   /* 처분요구순번 */
             AND RLTN_ORG_CD = #{rltnOrgCd}  /* 관계기관코드 */
             AND MNG_SNO     = #{mngSno}      /* 관리순번 */
	</update>
	
    <!-- 특수관리 집행내역 insert BADFRE013EHisinsert-->
	<insert id="insertHis" parameterType="paramMap">
		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.insertHis */
        INSERT INTO TBBADFRE011L
            (
                 AUD_YR               /* 감사년도          */
                ,AUD_NO               /* 감사번호          */
                ,DSP_RQ_SNO           /* 처분요구순번      */
                ,RLTN_ORG_CD          /* 관계기관코드      */
                ,MNG_SNO              /* 관리순번          */
                ,SLN                  /* 연번              */
                ,ENFM_DT              /* 집행일            */
                ,ENFM_AM              /* 집행금액          */
                ,ENFM_TXT             /* 집행내용          */
                ,DTM_YN               /* 확정여부          */
                ,FRT_USR_ID           /* 최초사용자ID      */
                ,FNL_USR_ID           /* 최종사용자ID      */
                ,FNL_DEAL_DPT_CD      /* 최종거래부서코드  */
                ,FNL_MNU_ID           /* 최종메뉴ID        */
                ,FRT_REGI_DH          /* 최초등록일시      */
                ,FNL_MDF_DH           /* 최종수정일시      */
            ) VALUES (
                 #{audYr}             /* 감사년도          */ 
                ,#{audNo}             /* 감사번호          */ 
                ,#{dspRqSno}         /* 처분요구순번      */ 
                ,#{rltnOrgCd}        /* 관계기관코드      */ 
                ,#{mngSno}            /* 관리순번          */ 
                ,#{sln}                /* 연번              */ 
                ,REPLACE(#{enfmDt},'-','')            /* 집행일            */ 
                ,#{enfmAm}            /* 집행금액          */ 
                ,#{enfmTxt}           /* 집행내용          */ 
                ,#{dtmYn  ,jdbcType=VARCHAR}             /* 확정여부          */ 
                ,#{frtUsrId}         /* 최초사용자ID      */ 
                ,#{fnlUsrId}         /* 최종사용자ID      */ 
                ,#{fnlDealDptCd}    /* 최종거래부서코드  */ 
                ,#{fnlMnuId}         /* 최종메뉴ID        */ 
                ,SYSDATE              /* 최초등록일시      */ 
                ,SYSDATE              /* 최종수정일시      */ 
            )
	</insert>
	    <!-- 특수관리 집행내역 update AEPEWM005EsaveHis-->
	<update id="updateHis" parameterType="paramMap">
		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.updateHis */
        	UPDATE TBBADFRE011L
        	   SET
                 AUD_YR          =   #{audYr}         /* 감사년도          */
                ,AUD_NO          =   #{audNo}         /* 감사번호          */
                ,DSP_RQ_SNO      = #{dspRqSno}        /* 처분요구순번      */
                ,RLTN_ORG_CD     = #{rltnOrgCd}       /* 관계기관코드      */
                ,MNG_SNO         = #{mngSno}          /* 관리순번          */
                ,SLN             = #{sln}             /* 연번              */
                ,ENFM_DT         = REPLACE(#{enfmDt},'-','')      /* 집행일            */
                ,ENFM_AM         = #{enfmAm}          /* 집행금액          */
                ,ENFM_TXT        = #{enfmTxt}         /* 집행내용          */
                ,DTM_YN          = #{dtmYn  ,jdbcType=VARCHAR}    /* 확정여부          */
                ,FNL_USR_ID      = #{fnlUsrId}        /* 최종사용자ID      */
                ,FNL_DEAL_DPT_CD = #{fnlDealDptCd}    /* 최종거래부서코드  */
                ,FNL_MNU_ID      =   #{fnlMnuId}      /* 최종메뉴ID        */
                ,FNL_MDF_DH      = SYSDATE            /* 최종수정일시      */
           WHERE AUD_YR      = #{audYr}       /* 감사년도 */
             AND AUD_NO      = #{audNo}       /* 감사번호 */
             AND DSP_RQ_SNO  = #{dspRqSno}   /* 처분요구순번 */
             AND RLTN_ORG_CD = #{rltnOrgCd}  /* 관계기관코드 */
             AND MNG_SNO     = #{mngSno}      /* 관리순번 */
             AND SLN         = #{sln}      /* 연번 */
	</update>

	<!-- 특수관리집행내역의 max연번을 조회한다. BADFRE013EMaxSlnselect -->
	<select id="selectMaxSln" parameterType="paramMap" resultType="egovMap">	
        /* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.selectMaxSln */
        SELECT NVL(MAX(SLN),0) + 1 AS SLN
          FROM TBBADFRE011L
         WHERE AUD_YR      = #{audYr}
           AND AUD_NO      = #{audNo}
           AND DSP_RQ_SNO  = #{dspRqSno}
           AND RLTN_ORG_CD = #{rltnOrgCd}
           AND MNG_SNO     = #{mngSno}
	</select>	
	
	<!-- 특수관리집행내역변경이력 입력  BADFRE013EEnfmChgHstinsert-->
	<insert id="insertEnfmChgHst" parameterType="paramMap">
	 		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.insertEnfmChgHst */
            INSERT INTO TBBADFRE028H /* 특수관리집행내역변경이력 */
            (
                 CON_NO                  /* 연계번호          */     
                ,AUD_YR                  /* 감사년도          */
                ,AUD_NO                  /* 감사번호          */
                ,DSP_RQ_SNO              /* 처분요구순번      */
                ,RLTN_ORG_CD             /* 관계기관코드      */
                ,MNG_SNO                 /* 관리순번          */
                ,SLN                     /* 연번              */
                ,ENFM_DT                 /* 집행일            */
                ,ENFM_AM                 /* 집행금액          */
                ,ENFM_TXT                /* 집행내용          */
                ,DTM_YN                  /* 확정여부          */
                ,USE_YN                  /* 사용여부          */
                ,CON_RTRN_CD             /* 연계반환코드      */
                ,FRT_USR_ID              /* 최초사용자ID      */
                ,FNL_USR_ID              /* 최종사용자ID      */
                ,FNL_DEAL_DPT_CD         /* 최종거래부서코드  */
                ,FNL_MNU_ID              /* 최종메뉴ID        */
                ,FRT_REGI_DH             /* 최초등록일시      */
                ,FNL_MDF_DH              /* 최종수정일시      */
            ) 
            SELECT 
               (SELECT NVL(MAX(CON_NO),0) + 1                
                  FROM TBBADFRE028H)     /* CON_NO            */              
               ,AUD_YR                   /* AUD_YR            */
               ,AUD_NO                   /* AUD_NO            */
               ,DSP_RQ_SNO               /* DSP_RQ_SNO        */
               ,RLTN_ORG_CD              /* RLTN_ORG_CD       */
               ,MNG_SNO                  /* MNG_SNO           */
               ,SLN                      /* SLN               */
               ,ENFM_DT                  /* ENFM_DT           */
               ,ENFM_AM                  /* ENFM_AM           */
               ,ENFM_TXT                 /* ENFM_TXT          */
               ,DTM_YN                   /* DTM_YN            */
               ,'N' AS USE_YN            /* USE_YN            */
               ,''  AS CON_RTRN_CD       /* CON_RTRN_CD       */
               ,#{frtUsrId}             /* FRT_USR_ID        */
               ,#{fnlUsrId}             /* FNL_USR_ID        */
               ,#{fnlDealDptCd}        /* FNL_DEAL_DPT_CD   */
               ,#{fnlMnuId}             /* FNL_MNU_ID        */
               ,SYSDATE                  /* FRT_REGI_DH       */
               ,SYSDATE                  /* FNL_MDF_DH        */
            FROM TBBADFRE011L
           WHERE 1=1
             AND AUD_YR       = #{audYr}                
             AND AUD_NO       = #{audNo}                
             AND DSP_RQ_SNO   = #{dspRqSno}
             AND RLTN_ORG_CD  = #{rltnOrgCd}
             AND MNG_SNO      = #{mngSno}
             AND SLN          = #{sln}
	</insert>	

	<!-- 특수관리집행내역변경이력  BADFRE013EEnfmChgHstdelete-->
	<update id="deleteEnfmChgHst" parameterType="paramMap">
          /*  kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.deleteEnfmChgHst*/
          DELETE 
            FROM TBBADFRE028H                 /* 특수관리집행내역변경이력 */
           WHERE AUD_YR      = #{audYr}       /* 감사년도 */
             AND AUD_NO      = #{audNo}       /* 감사번호 */
             AND DSP_RQ_SNO  = #{dspRqSno}   /* 처분요구순번 */
             AND RLTN_ORG_CD = #{rltnOrgCd}  /* 관계기관코드 */
             AND MNG_SNO     = #{mngSno}      /* 관리순번 */
	</update>
		
	
	<!-- (출력물)특수관리사항 목록조회-->
	<select id="BADFRE013EReportListselect" parameterType="paramMap" resultType="egovMap">
	      SELECT
	            <!-- 조회조건 -->
	             CASE WHEN #{asgDvsn} = '1' THEN '기관에서 지정요청할 사항' 
	                  WHEN #{asgDvsn} = '2' THEN '지정한 사항'
	                  WHEN #{asgDvsn} = '3' THEN '해제한 사항' 
	                  ELSE                         '전체'
	              END                                            AS CND_ASG_DVSN      /* 지정구분 */
	            ,CASE WHEN #{dptcd} = '' THEN '전체' 
	                  ELSE F_DPT_INFO(#{dptcd},'1')  
	              END                                            AS CND_SPV_BRDV_NM   /* 주관국과 */
	            ,#{schTxt}                                     AS CND_SCH_TXT       /* 검색어 */
	      
                <!-- 목록 -->
                /* ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO  */      
                , NVL2(D2.ACT_DSP_NM,D2.ACT_DSP_NM, F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO  )                                                
                                                                 AS DSP_RQ_NO    /* 처분요구번호(관리번호) */
                                                                 	    
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1') || '(' ||
                 D1.CPS_DRTR_NM || ')'                           AS ORG_DRTR_NM  /* 관리기관(책임자) */   	      
                ,D2.TIT_TXT                                      AS TIT_TXT      /* 제목내용 */
                ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')                  AS SPV_BRDV_NM  /* 주관국과명 */                
                ,D1.ASG_AM                                       AS ASG_AM       /* 지정금액 */                
                ,D1.RQS_DT                                       AS RQS_DT       /* 요청일 */
                ,D1.ASG_DT                                       AS ASG_DT       /* 지정일 */                
                ,D1.RLS_DT                                       AS RLS_DT       /* 해제일 */                
                ,CASE WHEN D1.APV_STA_CD IS NULL THEN '미상신'
                      ELSE F_CODE_NM('1000603', D1.APV_STA_CD)
                  END                                            AS APV_STA_NM  /* 결재상태명               */                
                ,CASE WHEN NVL(D1.DTM_YN,'N')   != 'Y' 
                           AND D1.ASG_DT        IS NOT NULL                 
        	               AND D1.RLS_DT        IS NULL     THEN '지정X'
        	          WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
        	               AND D1.ASG_DT        IS NOT NULL                  
    	                   AND D1.RLS_DT        IS NULL     THEN '지정O'
    	              WHEN NVL(D1.DTM_YN,'N')  != 'Y'                 
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제X'
    	              WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제O'
    	             END                                         AS DVSN         /* 확정 */
           FROM TBBADFRE011M D1                   /* 특수관리기본 */
               ,TBBADEAR001M D2                   /* 처분요구사항기본 */
               ,TBBADDED001M D3
          WHERE 1=1
            AND D1.AUD_YR               = D2.AUD_YR    
        	AND D1.AUD_NO               = D2.AUD_NO     
        	AND D1.DSP_RQ_SNO           = D2.DSP_RQ_SNO    
            AND D1.AUD_YR               = D3.AUD_YR    
        	AND D1.AUD_NO               = D3.AUD_NO             	          
            AND D1.SLF_PRSS_STA_CD  &gt;= '71'
           	AND D1.SPV_BRDV_CD   IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, #{dptauth}, '', #{dptcd})))
           	
            <!-- 주관국과코드 -->    
		<if test='dptcd2 != null and dptcd2 != ""'>
                AND D1.SPV_BRDV_CD = #{dptcd2}
            </if> 
          
            
            <!-- 기관에서 지정요청할 사항 -->
		<if test='asgDvsn == "1"'>
               AND D1.ASG_DT IS NULL
               AND D1.RLS_DT IS NULL 
	        </if>     
            <!-- 지정한 사항 -->
		<if test='asgDvsn == "2"'>
               AND D1.ASG_DT IS NOT NULL
               AND D1.RLS_DT IS NULL 
	        </if>                 
            <!-- 해제한 사항 -->
		<if test='asgDvsn == "3"'>
               AND D1.RLS_DT IS NOT NULL   
	        </if>               
  
			<!-- 검색어 -->
		<if test='schTxt != null and schTxt != ""'>
                AND ( (SELECT ORG_NM 
                         FROM TBDCMACM015M                                
        		        WHERE ORG_CD = D1.MNG_ORG_CD) LIKE  '%' || #{schTxt} || '%'
        		     OR D1.CPS_DRTR_NM  LIKE  '%' || #{schTxt} || '%'
        		     OR D2.TIT_TXT      LIKE  '%' || #{schTxt} || '%'
        		    )
            </if>
           
            <!-- 결재확정  -->
		<if test='apvDtm != "0"'>
                AND NVL(D1.APV_STA_CD,'1') = #{apvDtm}
            </if>
            
            <!-- 감사연번 -->
		<if test='audyr != null and audyr != ""'>
                AND D1.AUD_YR = #{audyr}
            </if>
            <!-- 감사부여번호 추가 - 2016.06.02 yyh -->            
		<if test='audGrnNo != null and audGrnNo != ""'>
                AND D3.AUD_GRN_NO = #{audGrnNo}
            </if>      
			
		<if test='audYrNoKndCd != null and audYrNoKndCd != ""'>
		              /* 감사연번종류코드 - 2015.12.24 yyh */
					  AND SUBSTR(D3.AUD_KND_CD,3,1) = #{audYrNoKndCd} 
				</if>		
            
        ORDER BY D1.AUD_YR DESC 
               , D1.AUD_NO DESC
               , D1.DSP_RQ_SNO DESC
               , D1.RLTN_ORG_CD DESC
               , D1.MNG_SNO DESC                   
            
	</select>
	
	<!-- 특수관리기본변경이력 입력  BADFRE013EChgHstinsert-->
	<insert id="insertChgHst" parameterType="paramMap">
	/*  kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.insertChgHst  */
	
	
            INSERT INTO TBBADFRE027H           /* 특수관리기본변경이력           */
            (
                     CON_NO                    /* 연계번호                       */
                    ,AUD_YR                    /* 감사년도                       */
                    ,AUD_NO                    /* 감사번호                       */
                    ,DSP_RQ_SNO                /* 처분요구순번                   */
                    ,RLTN_ORG_CD               /* 관계기관코드                   */
                    ,MNG_SNO                   /* 관리순번                       */
                    ,SPV_BRDV_CD               /* 주관국과코드                   */
                    ,DTM_YN                    /* 확정여부                       */
                    ,MNG_ORG_CD                /* 관리기관코드                   */
                    ,ASG_DT                    /* 지정일                         */
                    ,ASG_AM                    /* 지정금액                       */
                    ,CPS_DRTR_NM               /* 변상책임자명                   */
                    ,CPS_DRTR_AD               /* 변상책임자주소                 */
                    ,RLS_DT                    /* 해제일                         */
                    ,RLS_RSN                   /* 해제사유                       */
                    ,RQR_ID                    /* 요청자ID                       */
                    ,RQS_DT                    /* 요청일                         */
                    ,RQS_RSN                   /* 요청사유                       */
                    ,APV_DOC_NO                /* 결재문서번호                   */
                    ,APV_STA_CD                /* 결재상태코드                   */
                    ,APV_STA_DT                /* 결재상태일                     */
                    ,MNG_YR                    /* 관리년도                       */
                    ,MNG_NO                    /* 관리번호                       */
                    ,SLF_PRSS_STA_CD           /* 자체진행상태코드               */
                    ,SLF_APV_DT                /* 자체결재일                     */
                    ,SLF_SEN_DT                /* 자체발송일                     */
                    ,SPCN_MNG_STA_CD           /* 특수관리상태코드               */
                    ,ASG_RSN                   /* 지정사유                       */
                    ,EXAM_RPT_FRM_ENFM_HIS     /* 검토보고서식집행내역           */
                    ,EXAM_RPT_FRM_ASG_RSN      /* 검토보고서식지정사유           */
                    ,EXAM_RPT_FRM_EXAM_OPIN    /* 검토보고서식검토의견           */
                    ,EXAM_RPT_FRM_APV_STA_CD   /* 검토보고서식결재상태코드       */
                    ,EXAM_RPT_FRM_APV_STA_DT   /* 검토보고서식결재상태일         */
                    ,EXAM_RPT_FRM_APV_DOC_NO   /* 검토보고서식결재문서번호       */
                    ,DOC_ID                    /* 문서ID                         */
                    ,DOC_TYP_CD                /* 문서유형코드                   */
                    ,USE_YN                    /* 사용여부                       */
                    ,CON_RTRN_CD               /* 연계반환코드                   */
                    ,FRT_USR_ID                /* 최초사용자ID                   */
                    ,FNL_USR_ID                /* 최종사용자ID                   */
                    ,FNL_DEAL_DPT_CD           /* 최종거래부서코드               */
                    ,FNL_MNU_ID                /* 최종메뉴ID                     */
                    ,FRT_REGI_DH               /* 최초등록일시                   */
                    ,FNL_MDF_DH                /* 최종수정일시                   */
            ) 
              SELECT                     
                     (SELECT NVL(MAX(CON_NO),0) + 1
                        FROM TBBADFRE027H)                                 
                    ,AUD_YR           
                    ,AUD_NO             
                    ,DSP_RQ_SNO       
                    ,RLTN_ORG_CD       
                    ,MNG_SNO           
                    ,SPV_BRDV_CD            
                    ,DTM_YN                 
                    ,MNG_ORG_CD             
                    ,ASG_DT                 
                    ,ASG_AM                 
                    ,CPS_DRTR_NM            
                    ,CPS_DRTR_AD            
                    ,RLS_DT                 
                    ,RLS_RSN                
                    ,RQR_ID                 
                    ,RQS_DT                 
                    ,RQS_RSN                
                    ,APV_DOC_NO             
                    ,APV_STA_CD             
                    ,APV_STA_DT             
                    ,MNG_YR                 
                    ,MNG_NO                 
                    ,SLF_PRSS_STA_CD        
                    ,SLF_APV_DT             
                    ,SLF_SEN_DT             
                    ,SPCN_MNG_STA_CD        
                    ,ASG_RSN                
                    ,EXAM_RPT_FRM_ENFM_HIS  
                    ,EXAM_RPT_FRM_ASG_RSN   
                    ,EXAM_RPT_FRM_EXAM_OPIN 
                    ,EXAM_RPT_FRM_APV_STA_CD
                    ,EXAM_RPT_FRM_APV_STA_DT
                    ,EXAM_RPT_FRM_APV_DOC_NO
                    ,DOC_ID                 
                    ,DOC_TYP_CD             
                    ,'N'           AS USE_YN            
                    ,''            AS CON_RTRN_CD  
                    ,#{frtUsrId}       
                    ,#{fnlUsrId}       
                    ,#{fnlDealDptCd}  
                    ,#{fnlMnuId}       
                    ,SYSDATE            
                    ,SYSDATE            
                FROM TBBADFRE011M     /* 특수관리기본 */
               WHERE 1=1
                 AND AUD_YR         = #{audYr}
                 AND AUD_NO         = #{audNo}
                 AND DSP_RQ_SNO     = #{dspRqSno} 
                 AND RLTN_ORG_CD    = #{rltnOrgCd}
                 AND MNG_SNO        = #{mngSno}
	</insert>	

	<!-- 처분요구사항상세 수정 -->
	<update id="BADFRE013EDspRqSbjDtlupdate" parameterType="paramMap">
        UPDATE TBBADEAR002D                                       /* 처분요구사항 상세 */ 
		  SET FNL_MDF_DH           = SYSDATE                      /* 최종수정일시 */ 
             ,FNL_USR_ID           = #{fnlUsrId}                 /* 최종사용자ID */       
             ,FNL_DEAL_DPT_CD      = #{fnlDealDptCd}            /* 최종거래부서코드 */
             ,FNL_MNU_ID           = #{fnlMnuId}                 /* 최종메뉴ID */
             ,APV_DOC_NO           = #{apvDocNo}                 /* 결재문서번호 */             
             ,CPLT_DT              = TO_CHAR(SYSDATE,'YYYYMMDD')  /* 완결일 */
             ,CPLT_PEN_ID          = #{cpltPenId}                /* 완결자ID */
		     ,ENFM_CPLT_IPT_DT     = TO_CHAR(SYSDATE,'YYYYMMDD')
		     ,ENFM_CPLT_IPT_PEN_ID = #{cpltPenId}             
             ,ENFM_WHLS_APV_KND_CD = #{enfmWhlsApvKndCd}       /* 집행전말결재종류코드 */
             ,DTM_STA_CD           = #{dtmStaCd}
             ,DSP_RQ_APV_STA_CD    = #{dspRqApvStaCd}  
             ,DTM_YN               = 'Y'           
        WHERE AUD_YR               = #{audYr}                     /* 감사년도 */
		  AND AUD_NO               = #{audNo}                     /* 감사번호 */
          AND DSP_RQ_SNO           = #{dspRqSno}                 /* 처분요구순번 */
	</update>
	
	
	
	<!-- (출력물)특수관리사항 목록조회 BADFRE013EReportListselect-->
	<select id="selectReportList" parameterType="paramMap" resultType="resultMap">
		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.selectReportList */
		SELECT
             CASE WHEN #{asgDvsn} = '1' THEN '기관에서 지정요청할 사항' 
                  WHEN #{asgDvsn} = '2' THEN '지정한 사항'
                  WHEN #{asgDvsn} = '3' THEN '해제한 사항' 
                  ELSE                         '전체'
              END                                            AS CND_ASG_DVSN      /* 지정구분 */
            ,CASE WHEN #{upSpvBrdvCd} = '' THEN '전체' 
                  ELSE F_DPT_INFO(#{upSpvBrdvCd},'1')  
              END                                            AS CND_SPV_BRDV_NM   /* 주관국과 */
            ,#{schtxt}                                     AS CND_SCH_TXT       /* 검색어 */
      
               <!-- 목록 -->
               /* ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO */
               
               , NVL2(D2.ACT_DSP_NM,D2.ACT_DSP_NM, F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO  )
                                                                AS DSP_RQ_NO    /* 처분요구번호(관리번호) */	    
               ,F_ORG_INFO(D1.MNG_ORG_CD,'1') || '(' ||
                D1.CPS_DRTR_NM || ')'                           AS ORG_DRTR_NM  /* 관리기관(책임자) */   	      
               ,D2.TIT_TXT                                      AS TIT_TXT      /* 제목내용 */
               ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')                  AS SPV_BRDV_NM  /* 주관국과명 */                
               ,D1.ASG_AM                                       AS ASG_AM       /* 지정금액 */                
               ,D1.RQS_DT                                       AS RQS_DT       /* 요청일 */
               ,D1.ASG_DT                                       AS ASG_DT       /* 지정일 */                
               ,D1.RLS_DT                                       AS RLS_DT       /* 해제일 */                
               ,CASE WHEN D1.APV_STA_CD IS NULL THEN '미상신'
                     ELSE F_CODE_NM('1000603', D1.APV_STA_CD)
                 END                                            AS APV_STA_NM  /* 결재상태명               */                
               ,CASE WHEN NVL(D1.DTM_YN,'N')   != 'Y' 
                          AND D1.ASG_DT        IS NOT NULL                 
       	               AND D1.RLS_DT        IS NULL     THEN '지정X'
       	          WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
       	               AND D1.ASG_DT        IS NOT NULL                  
   	                   AND D1.RLS_DT        IS NULL     THEN '지정O'
   	              WHEN NVL(D1.DTM_YN,'N')  != 'Y'                 
   	                   AND D1.RLS_DT        IS NOT NULL THEN '해제X'
   	              WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
   	                   AND D1.RLS_DT        IS NOT NULL THEN '해제O'
   	             END                                         AS DVSN         /* 확정 */
           FROM TBBADFRE011M D1                   /* 특수관리기본 */
               ,TBBADEAR001M D2                   /* 처분요구사항기본 */
               ,TBBADDED001M D3
          WHERE 1=1
            AND D1.AUD_YR               = D2.AUD_YR    
        	AND D1.AUD_NO               = D2.AUD_NO     
        	AND D1.DSP_RQ_SNO           = D2.DSP_RQ_SNO    
            AND D1.AUD_YR               = D3.AUD_YR    
        	AND D1.AUD_NO               = D3.AUD_NO             	          
            AND D1.SLF_PRSS_STA_CD  &gt;= '71'
           	AND D1.SPV_BRDV_CD   IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{strCnb}, #{strDptAuth}, '', #{upSpvBrdvCd})))
           	
            <!-- 주관국과코드 -->    
			<if test='spvBrdvCd != null and spvBrdvCd != ""'>
                AND D1.SPV_BRDV_CD = #{spvBrdvCd}
            </if>  
          
            
            <!-- 기관에서 지정요청할 사항 -->
		<if test='asgDvsn == "1"'>
               AND D1.ASG_DT IS NULL
               AND D1.RLS_DT IS NULL 
	        </if>     
            <!-- 지정한 사항 -->
		<if test='asgDvsn == "2"'>
               AND D1.ASG_DT IS NOT NULL
               AND D1.RLS_DT IS NULL 
	        </if>                 
            <!-- 해제한 사항 -->
		<if test='asgDvsn == "3"'>
               AND D1.RLS_DT IS NOT NULL   
	        </if>               
  
			<!-- 검색어 -->
		<if test='schTxt != null and schTxt != ""'>
                AND ( (SELECT ORG_NM 
                         FROM TBDCMACM015M                                
        		        WHERE ORG_CD = D1.MNG_ORG_CD) LIKE  '%' || #{schtxt} || '%'
        		     OR D1.CPS_DRTR_NM  LIKE  '%' || #{schtxt} || '%'
        		     OR D2.TIT_TXT      LIKE  '%' || #{schtxt} || '%'
        		    )
            </if>
           
            <!-- 결재확정  -->
			<if test='apvDtm != null and apvDtm != ""'>
                AND NVL(D1.APV_STA_CD,'1') = #{apvDtm}
            </if>
            
            <!-- 감사연번 -->
			<if test='audYr != null and audYr != ""'>
                AND D1.AUD_YR = #{audYr}
            </if>
            <!-- 감사부여번호 추가 - 2016.06.02 yyh -->            
			<if test='audGrnNo != null and audGrnNo != ""'>
                AND D4.AUD_GRN_NO = #{audGrnNo}
            </if>      
			<if test='audYrNoKndCd != null and audYrNoKndCd != ""'>
	              /* 감사연번종류코드 - 2015.12.24 yyh */
				  AND SUBSTR(D4.AUD_KND_CD,3,1) = #{audYrNoKndCd} 
			</if>	                  
            
        ORDER BY D1.AUD_YR DESC 
               , D1.AUD_NO DESC
               , D1.DSP_RQ_SNO DESC
               , D1.RLTN_ORG_CD DESC
               , D1.MNG_SNO DESC                   

	</select>
	
	<!-- 특수관리사항 엑셀다운로드 2018.10.08 yyh -->
	<select id="selectExcelList" parameterType="paramMap" resultType="egovMap">
	/* kr.go.bai.eip.aep.ewm.dao.AEPEWM005EMapper.selectExcelList */
	      SELECT F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D4.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO  AS DSP_RQ_NO       /* 처분요구번호 */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1') || '(' || D1.CPS_DRTR_NM || ')'                        AS ORG_DRTR_NM     /* 관리기관(책임자) */
                ,D2.TIT_TXT                                                                           AS TIT_TXT         /* 제목내용 */                
                ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')                                                       AS SPV_BRDV_NM     /* 이행부서 */
                ,NVL(D1.ASG_AM, 0)                                                                    AS ASG_AM          /* 지정금액 */   
                ,TO_CHAR(TO_DATE(D1.RQS_DT),'YYYY-MM-DD')                                             AS RQS_DT          /* 요청일 */  
                ,TO_CHAR(TO_DATE(D1.ASG_DT),'YYYY-MM-DD')                                             AS ASG_DT          /* 지정일 */       
                ,TO_CHAR(TO_DATE(D1.RLS_DT),'YYYY-MM-DD')                                             AS RLS_DT          /* 해제일 */    
                ,CASE WHEN D1.APV_STA_CD IS NULL THEN '미상신'
                      ELSE F_CODE_NM('1000603', D1.APV_STA_CD)
                  END                                                                                 AS APV_STA_NM      /* 결재상태명 */                
                ,TO_CHAR(TO_DATE(D1.SLF_SEN_DT),'YYYY-MM-DD')                                         AS SLF_SEN_DT      /* 자체발송일 */
                ,CASE WHEN NVL(D1.DTM_YN,'N')   != 'Y' 
                           AND D1.ASG_DT        IS NOT NULL                 
        	               AND D1.RLS_DT        IS NULL     THEN '지정X'
        	          WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
        	               AND D1.ASG_DT        IS NOT NULL                  
    	                   AND D1.RLS_DT        IS NULL     THEN '지정O'
    	             END                                                                              AS ASG_DVSN        /* 지정구분 */                 
                                
                ,CASE WHEN NVL(D1.DTM_YN,'N')  != 'Y'                 
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제X'
    	              WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제O'
    	             END                                                                              AS RLS_DVSN        /* 해제구분 */ 
           FROM TBBADFRE011M D1  /* 특수관리기본 */
               ,TBBADEAR001M D2  /* 처분요구사항기본 */
               ,TBBADEAR002D D3  /* 처분요구사항 상세 */
               ,TBBADDED001M D4  /* 감사사항기본 */               
          WHERE 1=1
            AND D1.AUD_YR        = D2.AUD_YR    
        	AND D1.AUD_NO        = D2.AUD_NO     
        	AND D1.DSP_RQ_SNO    = D2.DSP_RQ_SNO
            AND D2.AUD_YR        = D3.AUD_YR    
        	AND D2.AUD_NO        = D3.AUD_NO     
        	AND D2.DSP_RQ_SNO    = D3.DSP_RQ_SNO 
        	AND D3.AUD_YR        = D4.AUD_YR    
        	AND D3.AUD_NO        = D4.AUD_NO        	
            AND D1.SLF_PRSS_STA_CD  &gt;= '71'
            
            AND D1.SPV_BRDV_CD   IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, #{dptAuth}, '', #{upSpvBrdvCd})))
			            
            <!-- 주관국과코드 -->    
			<if test='spvBrdvCd != null and spvBrdvCd != ""'>
                AND D1.SPV_BRDV_CD = #{spvBrdvCd}
            </if> 
            
            <!-- 기관에서 지정요청할 사항 -->
			<if test='asgDvsn == "1"'>
               AND D1.ASG_DT IS NULL
               AND D1.RLS_DT IS NULL 
	        </if>     
            <!-- 지정한 사항 -->
			<if test='asgDvsn == "2"'>
               AND D1.ASG_DT IS NOT NULL
               AND D1.RLS_DT IS NULL 
	        </if>                 
            <!-- 해제한 사항 -->
			<if test='asgDvsn == "3"'>
               AND D1.RLS_DT IS NOT NULL   
	        </if>               
  
			<!-- 검색어 -->
			<if test='schTxt != null and schTxt != ""'>
                AND ( (SELECT ORG_NM 
                         FROM TBDCMACM015M                                
        		        WHERE ORG_CD = D1.MNG_ORG_CD) LIKE  '%' || #{schTxt} || '%'
        		     OR D1.CPS_DRTR_NM  LIKE  '%' || #{schTxt} || '%'
        		     OR D2.TIT_TXT      LIKE  '%' || #{schTxt} || '%'
        		    )
            </if>
           
            <!-- 결재확정  -->
			<if test='apvDtm != null and apvDtm != ""'>
                AND NVL(D1.APV_STA_CD,'1') = #{apvDtm}
            </if>
            
            <!-- 감사연번 -->
			<if test='audYr != null and audYr != ""'>
                AND D1.AUD_YR = #{audYr}
            </if>
            <!-- 감사부여번호 추가 - 2016.06.02 yyh -->
			<if test='audGrnNo != null and audGrnNo != ""'>
                AND D4.AUD_GRN_NO = #{audGrnNo}
            </if>            
			<if test='audYrNoKndCd != null and audYrNoKndCd != ""'>
	              /* 감사연번종류코드 - 2015.12.24 yyh */
				  AND SUBSTR(D4.AUD_KND_CD,3,1) = #{audYrNoKndCd} 
			</if>		
            
        ORDER BY D1.AUD_YR DESC 
               , D1.AUD_NO DESC
               , D1.DSP_RQ_SNO DESC
               , D1.RLTN_ORG_CD DESC
               , D1.MNG_SNO DESC
	</select>	
</mapper> 
