<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper">

    <delete id="deleteCopyAudRprt">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.deleteCopyAudRprt */
        DECLARE
            BEGIN
                DELETE TBBADDED103M
                WHERE 
                       DOC_ID = #{docId}
                AND RPRT_CD = 'A10600300'
                AND AUD_STEP_CD = 'A1070';
                
                DELETE TBBADDED111M
                WHERE 
                       DOC_ID = #{docId}
                AND RPRT_CD = 'A10600300'
                AND AUD_STEP_CD = 'A1070';
            END;
    </delete>
    
    <insert id="insertCopyAudRprt">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.insertCopyAudRprt */
        <![CDATA[
        INSERT INTO TBBADDED103M (
                   AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,DOC_ID 
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,LINK_URL
                  ,NECES_YN
                  ,APV_STA_CD
                  ,RPRT_CD
                  ,APV_RQS_ID
                  ,SND_DOC_YN
                  ,DOC_KND_CD   
                  ,AUD_RPRT_DVSN_CD
                  ,REF_ID
                  ,REF_DY
                  ,RLTN_ORG_CD
                  ,SORT_SNO
                  ,SYT_TRTM_DVSN_YN
                  ,AUD_DOC_KND_CD
                  ,CON_PGM_CD
                  ,APV_WAY_CD
                  ,DOC_WRT_ID
                  ,ONR_HNDL_NO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH
                  ,EDT_AUTH
                  ,FNL_BAI_RPRT_YN
                  ,REF_DOC_ID
                  ,TEMPLATE_DOC_ID
            )
             SELECT AUD_YR
                  ,AUD_NO
                  ,'A1070'
                  ,#{copyAudRprtId}
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM||'(비서용-'||#{usrNam}||')'
                  ,REPLACE(REPLACE(LINK_URL,'audStepCd=A1060','audStepCd=A1070'),'docId='||DOC_ID,'docId='||#{copyAudRprtId})
                  ,NECES_YN
                  ,'10'
                  ,'A10600300'
                  ,''
                  ,'N'
                  ,DOC_KND_CD
                  ,AUD_RPRT_DVSN_CD
                  ,#{audRprtDocId}
                  ,REF_DY
                  ,RLTN_ORG_CD
                  ,(SELECT MAX(B.SORT_SNO)+1 FROM TBBADDED103M B  WHERE B.AUD_YR = A.AUD_YR AND B.AUD_NO = A.AUD_NO AND B.AUD_STEP_CD = 'A1070') AS SORT_SNO
                  ,SYT_TRTM_DVSN_YN
                  ,AUD_DOC_KND_CD
                  ,CON_PGM_CD
                  ,APV_WAY_CD
                  ,#{usrId}
                  ,ONR_HNDL_NO
                  ,#{usrId}
                  ,#{usrId}
                  ,#{dptCd}
                  ,'AEPASB012E'
                  ,SYSDATE
                  ,SYSDATE
                  ,'Y'
                  ,''
                  ,#{audRprtDocId}
                  ,TEMPLATE_DOC_ID
            FROM TBBADDED103M A
            WHERE DOC_ID = #{audRprtDocId}
        ]]>
    </insert>
    
    <update id="saveShareTrtm" parameterType="paramMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.saveShareTrtm */
        <![CDATA[
        UPDATE TBBADDED112D
        SET 
        ]]>
        <if test="shareCmtrId != null and shareCmtrId != ''">
            SHARE_YN = 'Y'
           , SHARE_CMTR_ID = #{shareCmtrId}
           , SHARE_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
        </if>
        <if test="shareCmtrId == null or shareCmtrId == ''">
            SHARE_YN = 'N'
           , SHARE_DT = ''
           , SHARE_CMTR_ID = ''
        </if>
        WHERE
                AUD_YR = #{audYr}
        AND AUD_NO = #{audNo}
        AND DOC_ID = #{docId}
        
    </update>
    
    <update id="saveShareTrtmBADFRE" parameterType="paramMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.saveShareTrtmBADFRE */
        <![CDATA[
        UPDATE TBBADFRE112D
        SET 
        ]]>
        <if test="shareCmtrId != null and shareCmtrId != ''">
            SHARE_YN = 'Y'
           , SHARE_CMTR_ID = #{shareCmtrId}
           , SHARE_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
        </if>
        <if test="shareCmtrId == null or shareCmtrId == ''">
            SHARE_YN = 'N'
           , SHARE_DT = ''
           , SHARE_CMTR_ID = ''
        </if>
        WHERE
                ACP_YR = #{audYr}
        AND ACP_DVSN_CD = #{acpDvsnCd}
        AND ACP_SRNO = #{audNo}
        AND DOC_ID = #{docId}
    </update>
    
    <select id="selectAudRprtGrid" 
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.selectAudRprtGrid */
        <![CDATA[
        SELECT
            T1.RPRT_NM
            , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') AS AUD_YR_NO
            , T2.AUD_SBJ_NM
            , F_DPT_INFO(T2.MNG_DPT_CD,'1') AS MNG_DPT_NM
            , F_USR_INFO_BY_ID(T1.DOC_WRT_ID,'2') AS CRE_USR_NM
            , TO_CHAR(T1.FRT_REGI_DH,'YYYY"-"MM"-"DD" "HH24:MI') AS CRE_DH
            , T1.AUD_YR
            , T1.AUD_NO
            , T1.AUD_STEP_CD
            , T1.DOC_ID
            , T1.RPRT_CD
            , T1.REF_ID
          FROM TBBADDED103M T1
               INNER JOIN TBBADDED001M T2
               ON (T1.AUD_YR = T2.AUD_YR AND T1.AUD_NO = T2.AUD_NO)
         WHERE T1.AUD_YR = #{audYr}
           AND T1.AUD_NO = #{audNo}
           AND T1.AUD_STEP_CD = 'A1070'
           AND T1.RPRT_CD = 'A10600300'
           AND T1.REF_ID = #{docId}
        ]]>
    </select>
    
    
    <select id="selectRcptDoc" 
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.selectRcptDoc */
        <![CDATA[
        SELECT
            A.RPRT_NM
            ,F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, C.AUD_KND_CD, '-') AS AUD_YR_NO
            ,C.AUD_SBJ_NM
            ,F_DPT_INFO(MNG_DPT_CD,'4') AS MNG_DPT_NM
            ,F_USR_INFO_BY_ID(SNDR_ID,'2') AS SNDR_NM
            ,TO_CHAR(SND_DH,'YYYY"-"MM"-"DD') AS SND_DH
            ,A.AUD_YR
            ,A.AUD_NO
            ,B.AUD_STEP_CD
            ,B.DOC_ID
            ,SR_DOC_SNO
            ,DOC_STA_CD
            ,A.APV_RQS_ID
            ,B.RPRT_CD
            ,D.RPRT_NM AS SCT_AUD_RPRT_NM
            ,D.DOC_ID AS SCT_AUD_RPRT_DOC_ID
            ,#{refId} AS AUD_RPRT_DOC_ID
            ,(SELECT DECODE(MAX(ST1.DOC_ID), NULL, 'N', 'Y')
                FROM TBBADDED111M ST1
               WHERE ST1.AUD_YR = D.AUD_YR
                 AND ST1.AUD_NO = D.AUD_NO
                 AND ST1.DOC_ID = D.DOC_ID) AS CHF_SEND_YN
            , F_CODE_NM('1000894', C.DOC_WRIT_KND_CD)       AS DOC_TYPE 
            , F_USR_INFO_BY_ID(d.DOC_WRT_ID, '2') AS DOC_WRT_NM
        FROM 
            TBBADDED103M A 
            INNER JOIN TBBADDED111M B
            ON (A.AUD_YR = B.AUD_YR AND A.AUD_NO = B.AUD_NO AND A.DOC_ID = B.DOC_ID AND A.RPRT_CD = B.RPRT_CD)
            INNER JOIN TBBADDED001M C
            ON (A.AUD_YR = C.AUD_YR AND A.AUD_NO = C.AUD_NO)
            LEFT OUTER JOIN TBBADDED103M D
            ON (A.AUD_YR = D.AUD_YR AND A.AUD_NO = D.AUD_NO AND A.REF_ID = D.REF_ID AND D.RPRT_CD = 'A10600300')
        WHERE
            B.AUD_YR =  #{audYr}
        AND B.AUD_NO = #{audNo}
        AND B.AUD_STEP_CD = #{audStepCd}
        ]]>
        <if test="refId != null and refId != ''">
            AND B.REF_ID = #{refId}
            AND B.RPRT_CD = 'A10700100'
        </if>
        <if test="rcptDptCd != null and rcptDptCd != ''">
            AND B.RCPT_DPT_CD   = #{rcptDptCd}
        </if>
    </select>
    
    
    
    
    
    
    <select id="selectAudList" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.selectAudList */
        <include refid="include.pageSelct" />
        <![CDATA[
            SELECT 
                AUD_YR,
                AUD_NO,
                F_MNG_KND_AUDYRNO(AUD_YR, AUD_NO, T1.AUD_KND_CD, '-')    AS AUD_YR_NO,
                AUD_SBJ_NM,
                F_DPT_INFO(MNG_DPT_CD,'1') AS MNG_DPT_NM,
                '추후조인' AS SBCN_AFF_CNT,
                CHF_CMTR_CNB,
                F_USR_INFO(CHF_CMTR_CNB,'2') AS CHF_CMTR_NM,
                (SELECT COUNT(1)
                FROM TBBADDED111M
                WHERE
                    AUD_YR = T1.AUD_YR
                AND AUD_NO = T1.AUD_NO
                AND AUD_STEP_CD = '70'
                AND RPRT_CD = 'AUD_REPORT'
                AND RCPT_DPT_CD = '160100')
                ||' / '||
                (SELECT COUNT(1)
                FROM TBBADDED111M
                WHERE
                    AUD_YR = T1.AUD_YR
                AND AUD_NO = T1.AUD_NO
                AND AUD_STEP_CD = '70'
                AND RPRT_CD = 'AUD_REPORT'
                AND RCPT_DPT_CD = '160100'
                AND DOC_STA_CD = 'S')
                ||' / '||
                (SELECT COUNT(1)
                FROM TBBADDED111M
                WHERE
                    AUD_YR = T1.AUD_YR
                AND AUD_NO = T1.AUD_NO
                AND AUD_STEP_CD = '70'
                AND RPRT_CD = 'AUD_REPORT'
                AND RCPT_DPT_CD = '160100'
                AND DOC_STA_CD = 'R') AS AUD_RPRT_SMM_CNT
            FROM 
                TBBADDED001M T1
            WHERE 1=1
            AND AUD_STEP_CD = '70'
            ]]>
        <if test='iptAudYr != null and iptAudYr != ""'>
            AND AUD_YR = #{iptAudYr}
        </if>
        <if test='iptAudNo != null and iptAudNo != ""'>
            AND AUD_GRN_NO = #{iptAudNo}
        </if>
        <if test='cbAudKndCd != null and cbAudKndCd != ""'>
            AND AUD_KND_CD = #{cbAudKndCd}
        </if>
        <if test='iptAudSbjNm != null and iptAudSbjNm != ""'>
            AND AUD_SBJ_NM LIKE '%'||#{iptAudSbjNm}||'%'
        </if>
        
        <if test="schSpvBrdvCd != null and schSpvBrdvCd != ''">
            AND (SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = T1.MNG_DPT_CD) =
            #{schSpvBrdvCd}
        </if>
        <if test="schDeptCd != null and schDeptCd != ''">
            AND MNG_DPT_CD = #{schDeptCd}
        </if>
            <![CDATA[
            ORDER BY AUD_YR, T1.AUD_KND_CD, T1.AUD_GRN_NO DESC
            ]]>
        <include refid="include.pageOrder" />
    </select>
    
    <select id="selectAsbList" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.selectAsbList */
        <include refid="include.pageSelct" />
		<![CDATA[
			SELECT 
				A.AUD_YR,
				A.AUD_NO,
                F_MNG_KND_AUDYRNO(M.AUD_YR, M.AUD_NO, M.AUD_KND_CD, '-')    AS AUD_YR_NO,    /*감사연번호*/
                AUD_SBJ_NM,
			    A.DCS_SNO, 
			    A.DCS_DSVN_CD, 
			    CASE 
			        WHEN A.DCS_DSVN_CD = '1' THEN '부의'
			        WHEN A.DCS_DSVN_CD = '2' THEN '분리부의'
			        WHEN A.DCS_DSVN_CD = '3' THEN '재부의'
			    END AS DCS_DSVN_NM,
			    TO_CHAR(to_date(A.DCS_DATE),'YYYY"-"MM"-"DD') AS DCS_DATE, 
			    F_USR_INFO(A.CHF_MB_CNB,'2') AS CHF_MB_NM, 
			    A.CHF_MB_CNB,
			    A.DCS_STATE,
			    CASE 
			        WHEN DCS_STATE = '001' THEN '부의사항접수대장 작성'
			        WHEN DCS_STATE = '002' THEN '주심위원 설명자료 작성'
			        WHEN DCS_STATE = '003' THEN '주심위원 검토'
			        WHEN DCS_STATE = '004' THEN '처리안변경 검토보고서 작성'
			        WHEN DCS_STATE = '005' THEN '감사보고서 작성'
			        WHEN DCS_STATE = '006' THEN '부의번호등재대장 작성'
			        WHEN DCS_STATE = '007' THEN '감사위원회 심의'
			        WHEN DCS_STATE = '008' THEN '부의사항처리부 및 보류사항정리부 작성'
			        WHEN DCS_STATE = '009' THEN '변경의결사항대조표 작성'
			        WHEN DCS_STATE = '010' THEN '부의 완료'
			    END AS DCS_STATE_NM,
			    (SELECT COUNT(1) 
                FROM TBAEPASB002D B, tbbadear001m C
                WHERE B.AUD_YR = A.AUD_YR
                AND B.AUD_NO = A.AUD_NO
                AND B.DCS_SNO = A.DCS_SNO
                AND B.AUD_YR = C.AUD_YR
                AND B.AUD_NO = C.AUD_NO
                AND B.DSP_RQ_SNO = C.DSP_RQ_SNO
                AND C.DSP_RQ_KND_CD IN ('610','611','620','621','623','630','904','905','914')
                )
                AS ADV_CNT,
			    (SELECT COUNT(1) 
                FROM TBAEPASB002D B, tbbadear001m C
                WHERE B.AUD_YR = A.AUD_YR
                AND B.AUD_NO = A.AUD_NO
                AND B.DCS_SNO = A.DCS_SNO
                AND B.AUD_YR = C.AUD_YR
                AND B.AUD_NO = C.AUD_NO
                AND B.DSP_RQ_SNO = C.DSP_RQ_SNO
                AND C.DSP_RQ_KND_CD NOT IN ('610','611','620','621','623','630','904','905','914')
                ) AS DSP_RQ_CNT,														/*처분요구건수*/
                A.DCS_RCD_NO,																/*등재번호*/
                A.DCS_PAGE_NO,															/*부의면수*/
                A.DCS_TOT_NO																/*부의회수*/
			FROM TBAEPASB001M A, TBBADDED001M M
            WHERE A.AUD_YR = M.AUD_YR
            AND A.AUD_NO = M.AUD_NO
            ]]>
        <if test='iptAudYr != null and iptAudYr != ""'>
            AND A.AUD_YR = #{iptAudYr}
        </if>
        <if test='iptAudNo != null and iptAudNo != ""'>
            AND A.AUD_GRN_NO = #{iptAudNo}
        </if>
        <if test='cbAudKndCd != null and cbAudKndCd != ""'>
            AND M.AUD_KND_CD = #{cbAudKndCd}
        </if>
        <if test='iptAudSbjNm != null and iptAudSbjNm != ""'>
            AND M.AUD_SBJ_NM LIKE '%'||#{iptAudSbjNm}||'%'
        </if>
        <if test='dipEnfDtFrom != null and dipEnfDtFrom != ""'>
            AND TO_DATE(A.DCS_DATE) &gt;= TO_DATE(#{dipEnfDtFrom})
        </if>
        <if test='dipEnfDtTo != null and dipEnfDtTo != ""'>
            AND TO_DATE(A.DCS_DATE) &lt;= TO_DATE(#{dipEnfDtTo})
        </if>
        <if test="schSpvBrdvCd != null and schSpvBrdvCd != ''">
            AND (SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = M.MNG_DPT_CD) =
            #{schSpvBrdvCd}
        </if>
        <if test="schDeptCd != null and schDeptCd != ''">
            AND M.MNG_DPT_CD = #{schDeptCd}
        </if>
        <if test='cbDcsDsvnCd != null and cbDcsDsvnCd != ""'>
            AND A.DCS_DSVN_CD = #{cbDcsDsvnCd}
        </if>
        <if test='iptDcsTotNo != null and iptDcsTotNo != ""'>
            AND A.DCS_TOT_NO = #{iptDcsTotNo}
        </if>
        <if test='iptChfMbCnb != null and iptChfMbCnb != ""'>
            AND A.CHF_MB_CNB = #{iptChfMbCnb}
        </if>
        <if test='cbDcsState != null and cbDcsState != ""'>
            AND A.DCS_STATE = #{cbDcsState}
        </if>
			<![CDATA[
			order by A.DCS_TOT_NO, A.AUD_YR, A.AUD_NO, A.DCS_SNO asc
			]]>
        <include refid="include.pageOrder" />
    </select>


    <select id="selectAgdList" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.selectAgdList */
 		<![CDATA[
 		select 
		    A.AUD_YR,																/*감사년도*/
		    A.AUD_NO,																/*감사순번*/
		    A.DSP_RQ_SNO,														/*처분요구순번*/
		    F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, B.AUD_KND_CD, '-') ||'-'|| A.DSP_RQ_SNO 
		                                                         AS DSP_RQ_SNO_NM,					/*처분요구순번명*/
		    A.TIT_TXT AS DSP_RQ_TITLE,																/*처분제목*/
		    F_CODE_NM('1000002',A.DSP_RQ_KND_CD ) AS DSP_RQ_NM,			/*처분종류*/
		    D.AGD_SNO,																/*안건순번*/
		    D.DCS_SNO,																/*부의순번*/
		    D.AGD_TOT_SNO,													/*부의번호*/
		    D.VOTE_TXT,															/*의결내역*/
		    D.NOTE_TXT,															/*비고*/
		    CASE WHEN c.COPT_OFI_CD IS NOT NULL THEN F_ORG_INFO(c.COPT_OFI_CD,'1')ELSE '' END COPT_OFI_NM /*소관청*/
		FROM TBBADEAR001M A, TBBADDED001M b, TBBADEAR002D C, TBAEPASB002D D
		WHERE   
				A.AUD_YR = #{audYr}
		AND A.AUD_NO = #{audNo}
		AND D.DCS_SNO =  #{dcsSno}
		AND A.AUD_YR = B.AUD_YR
		AND A.AUD_NO = B.AUD_NO
		AND A.AUD_YR = C.AUD_YR 
		AND A.AUD_NO = C.AUD_NO
		AND A.DSP_RQ_SNO = C.DSP_RQ_SNO
		AND A.AUD_YR = D.AUD_YR
		AND A.AUD_NO = D.AUD_NO
		AND A.DSP_RQ_SNO = D.DSP_RQ_SNO
		ORDER BY A.DSP_RQ_SNO
 		]]>
    </select>

    <update id="updateAsbData" parameterType="paramMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.updateAsbData */
		<![CDATA[
		UPDATE	TBAEPASB001M
			SET		AUD_YR = AUD_YR
		]]>
        <if test='dcsTotNo != null and   dcsTotNo  != ""'>
            ,DCS_TOT_NO = #{dcsTotNo}
        </if>
        <if test='dcsPageNo != null and   dcsPageNo  != ""'>
            ,DCS_PAGE_NO = #{dcsPageNo}
        </if>
        <if test='dcsRcdNo != null and   dcsRcdNo  != ""'>
            ,DCS_RCD_NO = #{dcsRcdNo}
        </if>
        <if test='dcsDate != null and   dcsDate  != ""'>
            ,DCS_DATE = #{dcsDate}
        </if>
        <if test='chfMbCnb != null and   chfMbCnb  != ""'>
            ,CHF_MB_CNB = #{chfMbCnb}
        </if>
		<![CDATA[ 	
			WHERE	AUD_YR = #{audYr}
			AND		AUD_NO	= #{audNo}
			AND		DCS_SNO = #{dcsSno}
		]]>
    </update>

    
    <update id="updateChfCmtr" parameterType="paramMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.updateChfCmtr */
        <![CDATA[
        UPDATE TBBADDED001M
        SET 
            CHF_CMTR_CNB = #{chfCmtrCnb}
        WHERE 
                AUD_YR = #{audYr}
        AND AUD_NO = #{audNo}
        ]]>
    </update>
    
    <update id="saveRcptDoc" parameterType="paramMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.saveRcptDoc */
        <![CDATA[
        UPDATE TBBADDED111M
        SET 
            DOC_STA_CD = 'R',
            FNL_MDF_DH = SYSDATE,
            RCPT_DH = SYSDATE,
            RCNT_ID = #{rcntId},
            FNL_MNU_ID = 'AEPASB012E'
        WHERE 
                AUD_YR = #{audYr}
        AND AUD_NO = #{audNo}
        AND AUD_STEP_CD = '70'
        AND DOC_ID = #{docId}
        AND SR_DOC_SNO = #{srDocSno}
        ]]>
    </update>
    
    
    <select id="selectRcptDocBADFRE111" 
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB012EMapper.selectRcptDocBADFRE111 */
        <![CDATA[
        SELECT
            A.RPRT_NM
            ,B.ACP_YR || '-' || DECODE(B.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || DECODE(B.ORG_ACP_SRNO, null, B.ACP_SRNO, B.ORG_ACP_SRNO) AS AUD_YR_NO
            ,C.TIT_NM AS AUD_SBJ_NM
            ,F_DPT_INFO(B.DPT_CD,'1') AS MNG_DPT_NM
            ,F_USR_INFO_BY_ID(A.SNDR_ID,'2') AS SNDR_NM
            ,TO_CHAR(A.SND_DH,'YYYY"-"MM"-"DD') AS SND_DH
            ,A.ACP_YR AS AUD_YR
            ,A.ACP_SRNO AS AUD_NO
            ,A.ACP_STEP_CD AS AUD_STEP_CD
            ,A.DOC_ID
            ,A.SR_DOC_SNO
            ,A.DOC_STA_CD
            ,'' AS APV_RQS_ID
            ,A.RPRT_CD
            ,A.ACP_DVSN_CD
            ,A.REF_ID
            ,F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE
        FROM 
            TBBADFRE111M A
            LEFT OUTER JOIN TBBADFRE012M B ON (B.ACP_YR = A.ACP_YR AND B.ACP_DVSN_CD = A.ACP_DVSN_CD AND B.ACP_SRNO = A.ACP_SRNO)
            LEFT OUTER JOIN TBBADFRE112M C ON (C.ACP_YR = A.ACP_YR AND C.ACP_DVSN_CD = A.ACP_DVSN_CD AND C.ACP_SRNO = A.ACP_SRNO)
        WHERE
            A.ACP_YR =  #{audYr}
        AND A.ACP_DVSN_CD = #{acpDvsnCd}
        AND A.ACP_SRNO = #{audNo}
        AND A.DOC_ID IN (SELECT ST.DOC_ID 
                           FROM TBBADFRE103M ST 
                          WHERE ST.ACP_YR = A.ACP_YR 
                            AND ST.ACP_DVSN_CD = A.ACP_DVSN_CD 
                            AND ST.ACP_SRNO = A.ACP_SRNO 
                            AND ST.RPRT_CD IN ('E10300150','D10300200','E10500200')
                            AND NVL(ST.REF_DOC_ID, ST.DOC_ID) = #{refId})
        AND A.RPRT_CD IN ('E10300150','D10300200','E10500200') 
         ]]>
       
    </select>
</mapper> 
