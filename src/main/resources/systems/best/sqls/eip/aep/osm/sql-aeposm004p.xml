<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.osm.dao.AEPOSM004PMapper">
    
    <select id="selectMainInfo" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM004PMapper.selectMainInfo*/
        SELECT  F_MNG_KND_AUDYRNO(D2.AUD_YR, D2.AUD_NO, D2.AUD_KND_CD, '-') AS AUD_KND_GRN_AFF_DSP_SNO,
               D1.TITLE_NM,
               CASE WHEN D3.RLTN_ORG_CD IS NOT NULL THEN F_ORG_INFO(D3.RLTN_ORG_CD,'1') ELSE '' END COPT_OFI_NM,
               F_CODE_NM('1000002',D.DSP_RQ_CD ) AS DSP_RQ_NM,
               D.SBCN_VT_CD,
               F_CODE_NM('1000772',D.SBCN_VT_CD) AS SBCN_VT_NM,
               SBCN_VT_TXT
          FROM TBBADDED113M AS D
    INNER JOIN TBBADDED145M AS D1 ON D.AUD_YR = D1.AUD_YR
                                 AND D.AUD_NO = D1.AUD_NO
                                 AND D.APVR_CD = D1.APVR_CD
                                 AND D.AFF_SNO = D1.AFF_SNO
    INNER JOIN TBBADDED146M AS D3 ON D.AUD_YR = D3.AUD_YR
                                 AND D.AUD_NO = D3.AUD_NO
                                 AND D.APVR_CD = D3.APVR_CD
                                 AND D.AFF_SNO = D3.AFF_SNO
                                 AND D.DSP_RQ_SNO = D3.DSP_RQ_SNO
    INNER JOIN TBBADDED001M AS D2 ON D.AUD_YR = D2.AUD_YR
                                 AND D.AUD_NO = D2.AUD_NO
         WHERE D.AUD_YR           =  #{audYr}
           AND D.AUD_NO           =  #{audNo}
           AND D.APVR_CD = #{apvrCd}
           AND D.AFF_SNO = #{affSno}
           AND D.DSP_RQ_SNO = #{dspRqSno}
           AND D.SBCN_DY = REPLACE(#{sbcnDy},'-')
           AND D.SBCN_DY IS NOT NULL
      ORDER BY D.AFF_SNO
    </select>
    
    <update id="updateBADDED113M" parameterType="paramMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM004PMapper.updateBADDED113M*/
        UPDATE TBBADDED113M SET SBCN_VT_CD = #{sbcnVtCd},
                                SBCN_VT_TXT = #{sbcnVtTxt},
                                FNL_USR_ID = #{usrId},
                                FNL_DEAL_DPT_CD = #{dptCd},
                                FNL_MNU_ID = #{menuNo},
                                FNL_MDF_DH = SYSDATE
                          WHERE AUD_YR           = #{audYr}
                            AND AUD_NO           = #{audNo}
                            AND APVR_CD          = #{apvrCd}
                            AND AFF_SNO          = #{affSno}
                            AND DSP_RQ_SNO       = #{dspRqSno}
                            AND SBCN_DY = REPLACE(#{sbcnDy},'-')
    </update>
    <select id="selectMainRprtYn" parameterType="paramMap"
        resultType="egovMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM004PMapper.selectMainRprtYn*/
        SELECT DECODE(T2.AUD_RPRT_DVSN_CD,'10','Y','N') AS MAIN_RPRT_YN
          FROM TBBADDED113M T1
               INNER JOIN TBBADDED103M T2
               ON (T1.AUD_YR = T2.AUD_YR AND T1.AUD_NO = T2.AUD_NO AND T1.DOC_ID = T2.DOC_ID)
          WHERE T1.AUD_YR           = #{audYr}
            AND T1.AUD_NO           = #{audNo}
            AND T1.APVR_CD          = #{apvrCd}
            AND T1.AFF_SNO          = #{affSno}
            AND T1.DSP_RQ_SNO       = #{dspRqSno}
            AND T1.SBCN_DY = REPLACE(#{sbcnDy},'-')
    </select>
    
    <update id="updateBADFRE113M" parameterType="paramMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM004PMapper.updateBADFRE113M*/
        UPDATE TBBADFRE113M SET SBCN_VT_CD = #{sbcnVtCd},
                                SBCN_VT_TXT = #{sbcnVtTxt},
                                FNL_USR_ID = #{usrId},
                                FNL_DEAL_DPT_CD = #{dptCd},
                                FNL_MNU_ID = #{menuNo},
                                FNL_MDF_DH = SYSDATE
                          WHERE ACP_YR           = #{audYr}
                          	AND ACP_DVSN_CD		 = #{acpDvsnCd}
                            AND ACP_SRNO         = #{audNo}
                            AND APVR_CD          = #{apvrCd}
                            AND SBCN_DY = REPLACE(#{sbcnDy},'-')
    </update>
    
    <select id="select147MMppSeq" parameterType="paramMap"
        resultType="egovMap">
    	/*kr.go.bai.eip.aep.osm.dao.AEPOSM004PMapper."select147MMppSeq"*/   
        SELECT MPP_SEQ, PRE_AFF_NO , AFF_NO
        FROM TBBADDED147M
		WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND DOC_ID  = #{docId}
           AND AFF_SNO = #{affSno}
           AND DSP_RQ_SNO = #{dspRqSno}
		   AND APVR_CD = 'A107001'
		   AND AFF_NO = #{affNo}
	</select>   
     
    <insert id="insert148MD80D90" parameterType="paramMap">
       /*kr.go.bai.eip.aep.osm.dao.AEPOSM004PMapper."insert148MD80D90" */
       		DECLARE
        		BEGIN
		            INSERT INTO TBBADDED148M
					(
						AUD_YR
						, AUD_NO
						, AUD_STEP_CD
						, DOC_ID
						, APVR_CD
						, AFF_SNO
						, DSP_RQ_SNO
						, MPP_SEQ
						, AFF_DVSN_SEQ
						, PRE_AFF_NO
						, AFF_NO
						, AFF_MPP_DVSN_CD
						, MPP_RSN
						, FRT_USR_ID
						, FNL_USR_ID
						, FNL_DEAL_DPT_CD
						, FNL_MNU_ID
						, FRT_REGI_DH
						, FNL_MDF_DH
					)VALUES (
						#{audYr}
						, #{audNo}
						, 'A1070'
						, #{docId}
						, 'A107001'
						, #{affSno}
						, #{dspRqSno}
						, #{mppSeq}
						, SEQ_AFF_DVSN.NEXTVAL
						, #{preAffNo}
						, #{affNo}
						, #{affMppDvsnCd}
						, #{sbcnVtTxt}
						, #{usrId}
						, #{usrId}
						, #{dptCd}
						, #{menuNo}
						, SYSDATE
						, SYSDATE
					)
					;
					
					INSERT INTO TBBADDED148H
					(
						HST_DVSN_CD
						, HST_SNO
						, HST_DH
						, HST_USR_ID
						
						, AUD_YR
						, AUD_NO
						, AUD_STEP_CD
						, DOC_ID
						, APVR_CD
						, AFF_SNO
						, DSP_RQ_SNO
						, MPP_SEQ
						, AFF_DVSN_SEQ
						
						, PRE_AFF_NO
						, AFF_NO
						, AFF_MPP_DVSN_CD
						, PRE_DSP_RQ_CD
						, DSP_RQ_CD
						, MPP_RSN
						
						, FRT_USR_ID
						, FNL_USR_ID
						, FNL_DEAL_DPT_CD
						, FNL_MNU_ID
						, FRT_REGI_DH
						, FNL_MDF_DH
					)
					SELECT 
						'C'
						, TBBADDED148H_SEQ.NEXTVAL
						, SYSDATE
						, #{usrId}
						
						, AUD_YR
						, AUD_NO
						, AUD_STEP_CD
						, DOC_ID
						, APVR_CD
						, AFF_SNO
						, DSP_RQ_SNO
						, MPP_SEQ
						, AFF_DVSN_SEQ
						
						, PRE_AFF_NO
						, AFF_NO
						, AFF_MPP_DVSN_CD
						, PRE_DSP_RQ_CD
						, DSP_RQ_CD
						, MPP_RSN
						
						, FRT_USR_ID
						, FNL_USR_ID
						, FNL_DEAL_DPT_CD
						, FNL_MNU_ID
						, FRT_REGI_DH
						, FNL_MDF_DH	
					FROM TBBADDED148M
					WHERE AUD_YR = #{audYr}
						AND AUD_NO = #{audNo}
						AND AUD_STEP_CD = 'A1070'
						AND APVR_CD = 'A107001'
						AND AFF_SNO = #{affSno}
						AND DSP_RQ_SNO = #{dspRqSno}
						AND MPP_SEQ = #{mppSeq}
						AND AFF_NO = #{affNo}
					;
					
                 UPDATE TBBADDED147M
                      SET AFF_NO = #{affNo}
                  WHERE  AUD_YR = #{audYr}
                     AND AUD_NO = #{audNo}
                     AND AUD_STEP_CD = 'A1070'
                     AND APVR_CD = 'A107001'
                     AND AFF_SNO = #{affSno}
                     AND DSP_RQ_SNO = #{dspRqSno}
                     AND MPP_SEQ = #{mppSeq};	
					
				END;
				

    </insert>
    
    
    <insert id="delete148MD80D90" parameterType="paramMap">
        /* kr.go.bai.eip.aep.evm.dao.AEPEVM008PMapper.delete148MD80D90 */
        	DECLARE
        		BEGIN
        			INSERT INTO TBBADDED148H
					(
						HST_DVSN_CD
						, HST_SNO
						, HST_DH
						, HST_USR_ID
						
						, AUD_YR
						, AUD_NO
						, AUD_STEP_CD
						, DOC_ID
						, APVR_CD
						, AFF_SNO
						, DSP_RQ_SNO
						, MPP_SEQ
						, AFF_DVSN_SEQ
						
						, PRE_AFF_NO
						, AFF_NO
						, AFF_MPP_DVSN_CD
						, PRE_DSP_RQ_CD
						, DSP_RQ_CD
						, MPP_RSN
						
						, FRT_USR_ID
						, FNL_USR_ID
						, FNL_DEAL_DPT_CD
						, FNL_MNU_ID
						, FRT_REGI_DH
						, FNL_MDF_DH
					)
					SELECT 
						'D'
						, TBBADDED148H_SEQ.NEXTVAL
						, SYSDATE
						, #{usrId}
						
						, AUD_YR
						, AUD_NO
						, AUD_STEP_CD
						, DOC_ID
						, APVR_CD
						, AFF_SNO
						, DSP_RQ_SNO
						, MPP_SEQ
						, AFF_DVSN_SEQ
						
						, PRE_AFF_NO
						, AFF_NO
						, AFF_MPP_DVSN_CD
						, PRE_DSP_RQ_CD
						, DSP_RQ_CD
						, MPP_RSN
						
						, FRT_USR_ID
						, FNL_USR_ID
						, FNL_DEAL_DPT_CD
						, FNL_MNU_ID
						, FRT_REGI_DH
						, FNL_MDF_DH	
					FROM TBBADDED148M
					WHERE AUD_YR = #{audYr}
						AND AUD_NO = #{audNo}
						AND AUD_STEP_CD = 'A1070'
						AND APVR_CD = 'A107001'
						AND AFF_SNO = #{affSno}
						AND DSP_RQ_SNO = #{dspRqSno}
						AND MPP_SEQ = #{mppSeq}
						AND AFF_NO = #{affNo}
					;
				
			        DELETE FROM TBBADDED148M 
					WHERE 1=1
						AND AUD_YR = #{audYr}
						AND AUD_NO = #{audNo}
						AND AUD_STEP_CD = 'A1070'
						AND APVR_CD = 'A107001'
						AND AFF_SNO = #{affSno}
						AND DSP_RQ_SNO = #{dspRqSno}
						AND MPP_SEQ = #{mppSeq}
						AND AFF_NO = #{affNo}
					;
				END;
    </insert>
    
    
    
</mapper>