<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper">

    <select id="selectSubList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper.selectSubList*/
            <![CDATA[
                       /*회의상세안건*/
                         SELECT 
                                 T2.CMT_SQ         /*회의 회차*/
                                 ,T2.CMT_TIT        /*회의 안건명*/
                                 ,T2.CMT_DY         /*회의 일자*/
                                 ,T2.CMT_END_YN     /*회의 종료여부*/
                                 ,T2.CMT_DVSN_CD    /*회의 구분코드*/
                                 ,REPLACE(T2.CMT_STR_TXT,'|',' ') AS CMT_STR_TXT     /*회의 개회선언사*/
						         ,REPLACE(T2.CMT_END_TXT,'|',' ') AS CMT_END_TXT      /*회의 폐회사*/
                                 ,F_USR_INFO(T2.CHF_CMTR_ID, '2') AS CHF_CMTR_NM     /*회의 의장*/
                                 ,F_USR_INFO(T2.CMTR1_ID, '2') AS CMTR1_NM           /*회의 위원1*/
                                 ,F_USR_INFO(T2.CMTR2_ID, '2') AS CMTR2_NM           /*회의 위원2*/
                                 ,F_USR_INFO(T2.CMTR3_ID, '2') AS CMTR3_NM           /*회의 위원3*/
                                 ,F_USR_INFO(T2.CMTR4_ID, '2') AS CMTR4_NM           /*회의 위원4*/ 
                                 ,F_USR_INFO(T2.CMTR5_ID, '2') AS CMTR5_NM           /*회의 위원5*/
                                 ,F_USR_INFO(T2.CMTR6_ID, '2') AS CMTR6_NM           /*회의 위원6*/
                                 ,DECODE(T2.CMT_END_YN, 'Y', '종료',  '진행중') AS CMT_END_NM  /*회의종료구분*/ 
                                 ,SUBSTR(CMT_DY,0,4)||'년 '||SUBSTR(CMT_DY, 5, 2)||'월 ' ||SUBSTR(CMT_DY, 7, 2)||'일 ' AS CMT_DATA /*회의 날짜*/ 
                                 ,REPLACE(REPLACE(T1.AUD_SBJ_NM , CHR(13), ''), chr(10), '') AS AUD_SBJ_NM       /*회의 안건명*/
                                 ,T1.CMT_SBJ_DVSN_CD      /*안건구분코드*/
                                 ,T1.CMT_SBJ_DVSN_NM     /*안건구분코코드*/
                                 ,T1.SBCN_PAGE_CNT        /*부의순번*/
                                 ,T1.AUD_YR_NO            /*감사연번호*/
                                 ,T1.CNT                  /*건수*/
                                 ,T1.DPT_NM                /*관련부서명*/
                                 ,T1.CMT_ADD_YN             /*회의추가여부*/
                                 ,T1.SBCN_DY                /*회의일자*/
                                 ,T1.AUD_YR                 /*감사년도*/
                                 ,T1.AUD_NO                 /*감사번호*/
                                 ,T1.DOC_ID               /*부의안 요약 DOCID*/
                                 ,T1.REF_ID               /*부의안   DOCID*/
                                 ,T1.RPT_DOC_ID
                                 ,T1.RPT_RPRT_NM
                                 ,T1.BAICHF_DOC_ID
                                 ,T1.BAICHF_RPRT_NM
                                 ,T1.CMT_SBJ_SNO
                                 ,T1.DPT_CD
                                 ,T1.SBCN_RPTR
                                 ,T1.ACP_DVSN_CD
                                 ,T1.SBCN_RPRT_SEND_YN
                                 ,T1.MG_DIV_CD
                                 ,T1.DOC_TYPE
                                 ,T1.AUD_TOT_DRTR_CNB
                        FROM ( 
                                SELECT
                                        A.AUD_YR
                                       ,A.AUD_NO
                                       ,B.AUD_SBJ_NM||(SELECT REL_TEXT1
                                                             FROM TBBADDED121T F
                                                            WHERE F.AUD_YR = A.AUD_YR
                                                              AND F.AUD_NO  = A.AUD_NO
                                                              AND F.AUD_YR_DY = C.REF_DY) AS AUD_SBJ_NM
                                       ,'10' AS CMT_SBJ_DVSN_CD    /*안건구분코드*/
                                       ,F_CODE_NM('1000789', '10') AS CMT_SBJ_DVSN_NM    /*안건구분코드명*/
                                       ,A.SBCN_PAGE_CNT 
                                       ,DECODE(REL_TSK_NM,NULL,F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, B.AUD_KND_CD, '-'),REL_TSK_NM )AS AUD_YR_NO
                                       ,COUNT(A.DSP_RQ_SNO) AS CNT
                                       ,NVL(SBCN_PRSS_DPT_NM, F_DPT_INFO(B.MNG_DPT_CD, 1)) AS DPT_NM
                                       ,'N' AS CMT_ADD_YN   /*N : 하드코딩*/
                                       ,A.SBCN_DY
                                       ,'' AS CMT_SBJ_SNO
                                       ,'10' as CMT_DVSN_CD
                                       ,SBCN_REGI_REQ_DT as SBCN_REGI_REQ_DT 
                                       ,B.MNG_DPT_CD AS DPT_CD
                                       ,A.SBCN_RPTR
                                       ,C.REF_ID
                                       ,C.DOC_ID
                                       ,C.RPT_DOC_ID
                                       ,C.RPT_RPRT_NM
                                       ,C.BAICHF_DOC_ID
                                       ,C.BAICHF_RPRT_NM
                                       ,'9' AS ACP_DVSN_CD
                                       , (SELECT DECODE(COUNT(1),0,'N','Y')
                                           FROM TBBADDED111M ST1 
                                          WHERE ST1.AUD_YR = A.AUD_YR
                                            AND ST1.AUD_NO = A.AUD_NO
                                            AND ST1.DOC_ID = C.DOC_ID) AS SBCN_RPRT_SEND_YN
                                       ,'' AS MG_DIV_CD
                                       , TO_CHAR(A.AUD_MAIN_STEP_SNO) AS AUD_MAIN_STEP_SNO
                                       , (SELECT ST1.RAL_BLT_DIV_CD 
                                            FROM TBDCMACM001M ST1 
                                      INNER JOIN TBBADDED116L ST2 ON (ST2.CHF_CMTR_CNB = ST1.CNB)
                                           WHERE ST2.AUD_YR = A.AUD_YR AND ST2.AUD_NO = A.AUD_NO AND ST2.DOC_ID = A.DOC_ID AND ST2.SRNO = (SELECT MAX(ST3.SRNO) FROM TBBADDED116L ST3 WHERE ST3.AUD_YR = A.AUD_YR AND ST3.AUD_NO = A.AUD_NO AND ST3.DOC_ID = A.DOC_ID)) AS RAL_BLT_DIV_CD
                                       ,C.DOC_TYPE
                                       ,B.AUD_TOT_DRTR_CNB
                                FROM TBBADDED113M A 
                                     INNER JOIN TBBADDED001M B
                                     ON (B.AUD_YR = A.AUD_YR
                                        AND B.AUD_NO = A.AUD_NO)
                                     LEFT OUTER JOIN 
                                        (SELECT 
                                            AUD_YR,
                                            AUD_NO,
                                            REF_DY,
                                            REF_DOC_ID,
                                            MAX(REF_ID) AS REF_ID,
                                            MAX(DOC_ID) AS DOC_ID,
                                            MAX(BAICHF_DOC_ID) AS BAICHF_DOC_ID, 
                                            MAX(BAICHF_RPRT_NM) AS BAICHF_RPRT_NM,
                                            MAX(RPT_DOC_ID) AS RPT_DOC_ID,
                                            MAX(RPT_RPRT_NM) AS RPT_RPRT_NM,
                                            MAX(EDT_AUTH) AS EDT_AUTH,
                                            MAX(DOC_TYPE) AS DOC_TYPE
                                          FROM (
                                            SELECT 
                                                AUD_YR,
                                                AUD_NO,
                                                REF_DY,
                                                REF_DOC_ID,
                                                DECODE(ST1.RPRT_CD, 'A10700500', DOC_ID, NULL) AS REF_ID,
                                                DECODE(ST1.RPRT_CD, 'A10700600', DOC_ID, NULL) AS DOC_ID,
                                                DECODE(ST1.RPRT_CD, 'A10700700', DOC_ID, NULL) AS RPT_DOC_ID,
                                                DECODE(ST1.RPRT_CD, 'A10700700', RPRT_NM, NULL) AS RPT_RPRT_NM,
                                                DECODE(ST1.RPRT_CD, 'A10700800', DOC_ID, NULL) AS BAICHF_DOC_ID,
                                                DECODE(ST1.RPRT_CD, 'A10700800', RPRT_NM, NULL) AS BAICHF_RPRT_NM,
                                                DECODE(ST1.RPRT_CD, 'A10700600', EDT_AUTH, NULL) AS EDT_AUTH,
                                                F_OPEN_EDIT(ST1.LINK_URL) AS DOC_TYPE
                                              FROM TBBADDED103M ST1
                                             WHERE RPRT_CD IN ('A10700500', 'A10700600', 'A10700700', 'A10700800')
                                           )
                                         GROUP BY AUD_YR, AUD_NO, REF_DY, REF_DOC_ID) C
                                     ON (A.AUD_YR = C.AUD_YR AND A.AUD_NO = C.AUD_NO AND C.REF_DY = A.SBCN_REGI_REQ_DT AND C.REF_DOC_ID = A.DOC_ID)
                                WHERE A.SBCN_DY = #{cmtDy}    /*회의일자 PARAM*/
                                AND EXISTS (SELECT 1 FROM TBBADDED120M C WHERE C.CMT_DY = A.SBCN_DY AND C.CMT_DVSN_CD = '10')
                                GROUP BY  A.AUD_YR ,A.AUD_NO, A.SBCN_DY, B.SPV_BRDV_CD ,B.AUD_SBJ_NM ,A.SBCN_PAGE_CNT, B.AUD_KND_CD, SBCN_PRSS_DPT_NM, REL_TSK_NM
                                , A.SBCN_REGI_REQ_DT,B.MNG_DPT_CD,A.SBCN_RPTR,C.REF_ID,C.DOC_ID,C.RPT_DOC_ID,C.RPT_RPRT_NM,C.BAICHF_DOC_ID,C.BAICHF_RPRT_NM, C.REF_DY, A.DOC_ID, A.AUD_MAIN_STEP_SNO, C.DOC_TYPE,B.AUD_TOT_DRTR_CNB
                                
                                /*심사,재심의*/
                                UNION ALL
                                SELECT  
                                     D.ACP_YR                          AS AUD_YR,
                                     TO_CHAR(D.ACP_SRNO)                          AS AUD_NO,
                                     (SELECT TIT_NM 
                                      FROM TBBADFRE112M 
                                      WHERE ACP_YR = D.ACP_YR
                                      AND ACP_DVSN_CD = D.ACP_DVSN_CD
                                      AND ACP_SRNO = D.ACP_SRNO) AS AUD_SBJ_NM,
                                     ''                                AS CMT_SBJ_DVSN_CD,
                                     ''                                AS CMT_SBJ_DVSN_NM,
                                     A.SBCN_PAGE_CNT                   AS SBCN_PAGE_CNT,
                                     D.ACP_YR || '-' || DECODE(D.ACP_DVSN_CD, '1', '심사', '재심') || '-' || TO_CHAR(D.ACP_SRNO) AS AUD_YR_NO,
                                     1       AS CNT,
                                     NVL(A.SBCN_PRSS_DPT_NM, F_DPT_INFO(D.DPT_CD,'1'))      AS DPT_NM,
                                     'N'                               AS CMT_ADD_YN,
                                     A.SBCN_DY,
                                     ''                                AS CMT_SBJ_SNO,
                                     '10'                              AS CMT_DVSN_CD,
                                     A.SBCN_REGI_REQ_DT                AS SBCN_REGI_REQ_DT,
                                     D.DPT_CD,
                                     A.SBCN_RPTR,
                                     C.REF_ID,
                                     C.DOC_ID,
                                     C.RPT_DOC_ID,
                                     C.RPT_RPRT_NM,
                                     C.BAICHF_DOC_ID,
                                     C.BAICHF_RPRT_NM,
                                     D.ACP_DVSN_CD,
                                     (SELECT DECODE(COUNT(1),0,'N','Y')
                                           FROM TBBADFRE111M ST1 
                                          WHERE ST1.ACP_YR = A.ACP_YR
                                            AND ST1.ACP_SRNO = A.ACP_SRNO
                                            AND ST1.ACP_DVSN_CD = A.ACP_DVSN_CD
                                            AND ST1.DOC_ID = C.DOC_ID) AS SBCN_RPRT_SEND_YN,
                                     D.MG_DIV_CD,
                                     TO_CHAR(A.ACP_MAIN_STEP_SNO) AS AUD_MAIN_STEP_SNO,
                                     '' AS RAL_BLT_DIV_CD,
                                     C.DOC_TYPE,
                                     '' AS AUD_TOT_DRTR_CNB
                                FROM TBBADFRE113M AS A
                                     INNER JOIN (SELECT ACP_YR
                                                        , ACP_SRNO
                                                        , ACP_DVSN_CD
                                                        , DPT_CD
                                                        , TIT_NM
                                                        , CASE WHEN (ACP_YR = MG_ACP_YR AND ACP_DVSN_CD = MG_ACP_DVSN_CD AND ACP_SRNO = MG_ACP_SRNO) THEN '대표'
                                                               WHEN MG_DIV_CD IS NULL THEN '대표'
                                                               WHEN MG_DIV_CD = '10' THEN '병합'
                                                               WHEN MG_DIV_CD = '20' THEN '병행'
                                                          END AS MG_DIV_NM
                                                        , MG_DIV_CD
                                                 FROM TBBADFRE012M) AS D 
                                     ON (A.ACP_YR   = D.ACP_YR AND A.ACP_SRNO = D.ACP_SRNO AND A.ACP_DVSN_CD = D.ACP_DVSN_CD)
                                     LEFT OUTER JOIN TBBADDED120M D4 
                                     ON (D4.CMT_DY = A.SBCN_DY AND D4.CMT_DVSN_CD = '10')
                                     LEFT OUTER JOIN 
                                        (SELECT 
                                            ACP_YR,
                                            ACP_SRNO,
                                            ACP_DVSN_CD,
                                            REF_DY,
                                            REF_ID,
                                            MAX(DOC_ID) AS DOC_ID,
                                            MAX(BAICHF_DOC_ID) AS BAICHF_DOC_ID, 
                                            MAX(BAICHF_RPRT_NM) AS BAICHF_RPRT_NM,
                                            MAX(RPT_DOC_ID) AS RPT_DOC_ID,
                                            MAX(RPT_RPRT_NM) AS RPT_RPRT_NM,
                                            MAX(EDT_AUTH) AS EDT_AUTH,
                                            MAX(DOC_TYPE) AS DOC_TYPE
                                          FROM (
                                            SELECT 
                                                ACP_YR,
                                                ACP_SRNO,
                                                ACP_DVSN_CD,
                                                REF_DY,
                                                REF_ID,
                                                DECODE(ST1.RPRT_CD, 'D10301100', DOC_ID,'E10500600', DOC_ID, NULL) AS DOC_ID,
                                                DECODE(ST1.RPRT_CD, 'D10301110', DOC_ID,'E10500610', DOC_ID, NULL) AS RPT_DOC_ID,
                                                DECODE(ST1.RPRT_CD, 'D10301110', RPRT_NM,'E10500610', RPRT_NM, NULL) AS RPT_RPRT_NM,
                                                DECODE(ST1.RPRT_CD, 'D10301120', DOC_ID,'E10500620', DOC_ID, NULL) AS BAICHF_DOC_ID,
                                                DECODE(ST1.RPRT_CD, 'D10301120', RPRT_NM,'E10500620', RPRT_NM, NULL) AS BAICHF_RPRT_NM,
                                                DECODE(ST1.RPRT_CD, 'D10301100', EDT_AUTH,'E10500600', EDT_AUTH, NULL) AS EDT_AUTH,
                                                F_OPEN_EDIT(ST1.LINK_URL) AS DOC_TYPE
                                              FROM TBBADFRE103M ST1
                                             WHERE RPRT_CD IN ('D10301100', 'E10500600','D10301110','E10500610','D10301120','E10500620')
                                           )
                                         GROUP BY ACP_YR, ACP_SRNO, ACP_DVSN_CD, REF_DY, REF_ID) C
                                     ON (A.ACP_YR = C.ACP_YR AND A.ACP_DVSN_CD = C.ACP_DVSN_CD AND A.ACP_SRNO = C.ACP_SRNO AND C.REF_DY = A.SBCN_REGI_REQ_DT)
                                WHERE A.SBCN_DY = #{cmtDy}
                                AND D.MG_DIV_NM = '대표'
                                AND EXISTS (SELECT 1 FROM TBBADDED120M C WHERE C.CMT_DY = A.SBCN_DY AND C.CMT_DVSN_CD = '10')
                                GROUP BY D.ACP_YR, D.ACP_SRNO, D.ACP_DVSN_CD,  D.TIT_NM, D.DPT_CD, A.SBCN_PAGE_CNT, A.SBCN_REGI_REQ_DT
                                    , A.ACP_YR, A.ACP_SRNO,A.ACP_DVSN_CD,A.SBCN_PRSS_DPT_NM, D4.CMT_DY , D4.CMT_SQ, A.SBCN_RPTR, C.REF_ID
                                    , C.DOC_ID,C.RPT_DOC_ID,C.RPT_RPRT_NM,C.BAICHF_DOC_ID, C.BAICHF_RPRT_NM,C.REF_DY, A.SBCN_DY, D.MG_DIV_CD, A.ACP_MAIN_STEP_SNO, C.DOC_TYPE
                                
                                UNION ALL
                                SELECT
                                    REL_AUD_YR as AUD_YR
                                    ,REL_AUD_NO as AUD_NO
                                    ,A.CMT_SBJ_TIT AS AUD_SBJ_NM
                                    ,A.CMT_SBJ_DVSN_CD
                                    ,F_CODE_NM('1000789', A.CMT_SBJ_DVSN_CD) AS CMT_SBJ_DVSN_NM
                                    ,A.SBCN_SNO  AS  SBCN_PAGE_CNT
                                    ,DECODE(A.REL_TSK_NM,NULL,DECODE(WORK_DVSN_CD,'A10',(SELECT F_MNG_KND_AUDYRNO(ST1.AUD_YR, ST1.AUD_NO, ST1.AUD_KND_CD, '-')
                                                                 FROM TBBADDED001M ST1
                                                                WHERE ST1.AUD_YR = REL_AUD_YR
                                                                  AND ST1.AUD_NO = REL_AUD_NO)
                                                       ,'E10',REL_AUD_YR||'-재심-'||REL_AUD_NO
                                                       ,'D10',REL_AUD_YR||'-심사-'||REL_AUD_NO
                                                       ,NULL),A.REL_TSK_NM) AS AUD_YR_NO
                                    ,(SELECT COUNT(B.CMT_SBJ_DTL_SNO)
                                        FROM TBBADDED122M B
                                        WHERE A.CMT_DY = B.CMT_DY
                                        AND A.CMT_DVSN_CD = B.CMT_DVSN_CD
                                        AND A.CMT_SQ = B.CMT_SQ
                                        AND A.CMT_SBJ_SNO = B.CMT_SBJ_SNO) AS CNT
                                  ,NVL(PRSS_DPT_NM, F_DPT_INFO(REL_DPT_CD, 1)) AS DPT_NM
                                  ,A.CMT_ADD_YN AS CMT_ADD_YN           /*N : 하드코딩*/
                                  ,A.CMT_DY AS SBCN_DY
                                  ,TO_CHAR(A.CMT_SBJ_SNO) AS CMT_SBJ_SNO
                                  ,A.CMT_DVSN_CD
                                  ,'' as SBCN_REGI_REQ_DT 
                                  ,REL_DPT_CD AS DPT_CD
                                  ,SBCN_RPTR AS SBCN_RPTR
                                  ,C.REF_ID
                                  ,C.DOC_ID
                                  ,C.RPT_DOC_ID
                                  ,C.RPT_RPRT_NM
                                  ,C.BAICHF_DOC_ID
                                  ,C.BAICHF_RPRT_NM
                                  ,'' AS ACP_DVSN_CD
                                  ,'Y' AS SBCN_RPRT_SEND_YN
                                  ,'' AS MG_DIV_CD
                                  ,'' AS AUD_MAIN_STEP_SNO
                                  ,'' AS RAL_BLT_DIV_CD
                                  ,'hancom' AS DOC_TYPE
                                  ,'' AS AUD_TOT_DRTR_CNB
                               FROM TBBADDED121M A
                                    LEFT OUTER JOIN (
                                             SELECT 
                                                    CMT_DY,
                                                    CMT_DVSN_CD,
                                                    CMT_SQ,
                                                    CMT_SBJ_DVSN_CD,
                                                    CMT_SBJ_SNO,
                                                    MAX(REF_ID) AS REF_ID,
                                                    MAX(DOC_ID) AS DOC_ID,
                                                    MAX(BAICHF_DOC_ID) AS BAICHF_DOC_ID, 
                                                    MAX(BAICHF_RPRT_NM) AS BAICHF_RPRT_NM,
                                                    MAX(RPT_DOC_ID) AS RPT_DOC_ID,
                                                    MAX(RPT_RPRT_NM) AS RPT_RPRT_NM,
                                                    MAX(EDT_AUTH) AS EDT_AUTH
                                                  FROM (
                                                    SELECT 
                                                        ST1.CMT_DY,
                                                        ST1.CMT_DVSN_CD,
                                                        ST1.CMT_SQ,
                                                        ST1.CMT_SBJ_DVSN_CD,
                                                        ST1.CMT_SBJ_SNO,
                                                        /* CMT_SBJ_DTL_SNO - 1 : 부의안, 2 : 부의안요약(보고자용), 3 : 부의안요약(원장용) 
                                                           기타안건(CMT_SBJ_DVSN_CD:90)일 경우 1 로 대체*/
                                                        DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,1), ST2.DOC_ID, NULL) AS REF_ID,
                                                        DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,3), ST2.DOC_ID, NULL) AS DOC_ID,
                                                        DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,2), ST2.DOC_ID, NULL) AS RPT_DOC_ID,
                                                        DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,2), ST2.FILE_NM, NULL) AS RPT_RPRT_NM,
                                                        DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,3), ST2.DOC_ID, NULL) AS BAICHF_DOC_ID,
                                                        DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,3), ST2.FILE_NM, NULL) AS BAICHF_RPRT_NM,
                                                        '' AS EDT_AUTH
                                                      FROM TBBADDED121M ST1
                                                           INNER JOIN TBBADDED122M ST2
                                                           ON (ST1.CMT_DY = ST2.CMT_DY 
                                                               AND ST1.CMT_DVSN_CD = ST2.CMT_DVSN_CD
                                                               AND ST1.CMT_SQ = ST2.CMT_SQ
                                                               AND ST1.CMT_SBJ_DVSN_CD = ST2.CMT_SBJ_DVSN_CD
                                                               AND ST1.CMT_SBJ_SNO = ST2.CMT_SBJ_SNO)
                                                     WHERE ST1.CMT_SBJ_DVSN_CD IN ('10','90')
                                                    )
                                                 GROUP BY CMT_DY, CMT_DVSN_CD, CMT_SQ, CMT_SBJ_DVSN_CD,CMT_SBJ_SNO) C
                                      ON (A.CMT_DY = C.CMT_DY 
                                          AND A.CMT_DVSN_CD = C.CMT_DVSN_CD
                                          AND A.CMT_SQ = C.CMT_SQ
                                          AND A.CMT_SBJ_DVSN_CD = C.CMT_SBJ_DVSN_CD
                                          AND A.CMT_SBJ_SNO = C.CMT_SBJ_SNO)
                               WHERE A.CMT_DY = #{cmtDy}/*회의일자 PARAM*/
                                    AND A.CMT_DVSN_CD = #{cmtDvsnCd} /*회의 구분코드*/
                      ) T1 INNER JOIN TBBADDED120M T2
                      ON T1.SBCN_DY = T2.CMT_DY
                     AND T1.CMT_DVSN_CD = T2.CMT_DVSN_CD
              WHERE T2.CMT_DY = #{cmtDy}   /*회의일자 PARAM*/
               AND T1.CMT_DVSN_CD = #{cmtDvsnCd} /*회의 구분코드*/
                
               ORDER BY T1.SBCN_PAGE_CNT , T1.RAL_BLT_DIV_CD, T1.AUD_MAIN_STEP_SNO ASC
               ]]>
    </select>
    
    <select id="selectSbmtList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper.selectSbmtList*/
        <![CDATA[
            SELECT 
                 T2.CMT_SQ         /*회의 회차*/
                 ,T2.CMT_TIT        /*회의 안건명*/
                 ,T2.CMT_DY         /*회의 일자*/
                 ,T2.CMT_END_YN     /*회의 종료여부*/
                 ,T2.CMT_DVSN_CD    /*회의 구분코드*/
                 ,REPLACE(T2.CMT_STR_TXT,'|',' ') AS CMT_STR_TXT     /*회의 개회선언사*/
                 ,REPLACE(T2.CMT_END_TXT,'|',' ') AS CMT_END_TXT      /*회의 폐회사*/
                 ,F_USR_INFO(T2.CHF_CMTR_ID, '2') AS CHF_CMTR_NM     /*회의 의장*/
                 ,F_USR_INFO(T2.CMTR1_ID, '2') AS CMTR1_NM           /*회의 위원1*/
                 ,F_USR_INFO(T2.CMTR2_ID, '2') AS CMTR2_NM           /*회의 위원2*/
                 ,F_USR_INFO(T2.CMTR3_ID, '2') AS CMTR3_NM           /*회의 위원3*/
                 ,F_USR_INFO(T2.CMTR4_ID, '2') AS CMTR4_NM           /*회의 위원4*/ 
                 ,F_USR_INFO(T2.CMTR5_ID, '2') AS CMTR5_NM           /*회의 위원5*/
                 ,F_USR_INFO(T2.CMTR6_ID, '2') AS CMTR6_NM           /*회의 위원6*/
                 ,DECODE(T2.CMT_END_YN, 'Y', '종료',  '진행중') AS CMT_END_NM  /*회의종료구분*/ 
                 ,SUBSTR(CMT_DY,0,4)||'년 '||SUBSTR(CMT_DY, 5, 2)||'월 ' ||SUBSTR(CMT_DY, 7, 2)||'일 ' AS CMT_DATA /*회의 날짜*/ 
                 ,T1.AUD_SBJ_NM           /*회의 안건명*/
                 ,T1.CMT_DVSN_CD      /*안건구분코드*/
                 ,T1.CMT_DVSN_NM     /*안건구분코코드*/
                 ,T1.SBCN_PAGE_CNT        /*부의순번*/
                 ,T1.AUD_YR_NO            /*감사연번호*/
                 ,T1.CNT                  /*건수*/
                 ,T1.DPT_NM                /*관련부서명*/
                 ,T1.CMT_ADD_YN AS CMT_ADD_YN             /*회의추가여부*/
                 ,T1.SBCN_DY                /*회의일자*/
                 ,T1.AUD_YR                 /*감사년도*/
                 ,T1.AUD_NO                 /*감사번호*/
                 ,T1.DOC_ID               /*소위원회심의안 요약 DOC_ID*/
                 ,T1.REF_DOC_ID         /*소위원회심의안 DOC_ID*/
                 ,T1.RPRT_NM
                 ,T1.DPT_CD
                 ,T1.DSP_RQ_NM
                 , T1.ACP_DVSN_CD
                 ,T1.RPT_DOC_ID             /*소위원회심의안 요약(보고자용)DOC_ID*/
                 ,T1.ADD_YN
                 ,T1.SBCN_RPRT_SEND_YN
                 ,T1.DOC_TYPE
                 , T1.AUD_TOT_DRTR_CNB
                 ,T1.MG_DIV_CD
              FROM ( 
                    SELECT 
                        T1.TITLE_NM AS AUD_SBJ_NM           /*회의 안건명*/
                        , '20' AS CMT_DVSN_CD
                        , F_CODE_NM('1000789', '20') AS CMT_DVSN_NM    /*안건구분코드명*/
                        , T1.SBMT_NO AS SBCN_PAGE_CNT        /*부의순번*/
                        , F_MNG_KND_AUDYRNO(T2.AUD_YR, T2.AUD_NO, T2.AUD_KND_CD, '-')||'-'||T1.AFF_CD AS AUD_YR_NO /*개별사건번호*/
                        , 1 AS CNT
                        , NVL(T1.SBCN_PRSS_DPT_NM, F_DPT_INFO(T2.MNG_DPT_CD,'1')) AS DPT_NM
                        , SBMT_FIX_DT AS SBCN_DY                /*회의일자*/
                        , T1.AUD_YR
                        , T1.AUD_NO
                        , T4.DOC_ID
                        , T5.DOC_ID AS REF_DOC_ID
                        , T4.RPRT_NM
                        , T2.MNG_DPT_CD AS DPT_CD
                        , T1.SBMT_DVSN_NO
                        , AGGR_CONCAT(T3.DSP_RQ_NM||DECODE(T3.DSP_RQ_CNT,1,'',T3.DSP_RQ_CNT), ',')  AS DSP_RQ_NM
                        ,'9' AS ACP_DVSN_CD
                        , T6.DOC_ID AS RPT_DOC_ID
                        
                        , 'N' AS ADD_YN
                        , (SELECT DECODE(COUNT(1),0,'N','Y')
                               FROM TBBADDED111M ST1 
                              WHERE ST1.DOC_ID = T5.DOC_ID) AS SBCN_RPRT_SEND_YN
                        , 'N' AS CMT_ADD_YN
                        , F_OPEN_EDIT(T4.LINK_URL) AS DOC_TYPE
                        , T2.AUD_TOT_DRTR_CNB
                        , '' AS MG_DIV_CD
                      FROM TBBADDED114M T1
                           INNER JOIN TBBADDED001M T2
                           ON (T1.AUD_YR = T2.AUD_YR AND T1.AUD_NO = T2.AUD_NO)
                           INNER JOIN ( SELECT 
                                            ST1.AUD_YR
                                           , ST1.AUD_NO
                                           , ST1.AUD_STEP_CD
                                           , ST1.DOC_ID
                                           , ST1.APVR_CD
                                           , ST1.AFF_SNO
                                           , ST1.SBMT_SEQ
                                           , F_CODE_NM('1000002', ST2.DSP_RQ_CD) AS DSP_RQ_NM
                                           , COUNT(ST2.DSP_RQ_CD) AS DSP_RQ_CNT
                                         FROM TBBADDED114D ST1
                                              INNER JOIN TBBADDED146M ST2
                                              ON (ST1.AUD_YR = ST2.AUD_YR
                                                  AND ST1.AUD_NO = ST2.AUD_NO
                                                  AND ST1.AUD_STEP_CD = ST2.AUD_STEP_CD
                                                  AND ST1.DOC_ID = ST2.DOC_ID
                                                  AND ST1.APVR_CD = ST2.APVR_CD
                                                  AND ST1.AFF_SNO = ST2.AFF_SNO
                                                  AND ST1.DSP_RQ_SNO = ST2.DSP_RQ_SNO)
                                        GROUP BY ST1.AUD_YR, ST1.AUD_NO, ST1.AUD_STEP_CD, ST1.DOC_ID, ST1.APVR_CD
                                                , ST1.AFF_SNO, ST1.SBMT_SEQ, ST2.DSP_RQ_CD) T3
                           ON (T1.AUD_YR = T3.AUD_YR
                                AND T1.AUD_NO = T3.AUD_NO
                                AND T1.AUD_STEP_CD = T3.AUD_STEP_CD
                                AND T1.DOC_ID = T3.DOC_ID
                                AND T1.APVR_CD = T3.APVR_CD
                                AND T1.AFF_SNO = T3.AFF_SNO
                                AND T1.SBMT_SEQ = T3.SBMT_SEQ) 
                           LEFT OUTER JOIN TBBADDED103M T4
                           ON (T4.RPRT_CD = 'A10700230' -- 소위원회 심의안 요약
                              AND T4.AUD_YR = T1.AUD_YR
                              AND T4.AUD_NO = T1.AUD_NO
                              AND T4.REF_DY = T1.SBMT_SEQ
                              AND T4.REF_ID = TO_CHAR(T1.AFF_SNO))
                           LEFT OUTER JOIN TBBADDED103M T5
                            ON (T5.RPRT_CD = 'A10700200' -- 소위원회 심의안
                               AND T5.AUD_YR = T1.AUD_YR
                               AND T5.AUD_NO = T1.AUD_NO
                               AND T5.REF_DY = T1.SBMT_SEQ
                               AND T5.REF_ID = TO_CHAR(T1.AFF_SNO))
                           LEFT OUTER JOIN TBBADDED103M T6
                            ON (T6.RPRT_CD = 'A10700220' -- 소위원회 심의안 요약 (보고자용)
                               AND T6.AUD_YR = T1.AUD_YR
                               AND T6.AUD_NO = T1.AUD_NO
                               AND T6.REF_DY = T1.SBMT_SEQ
                               AND T6.REF_ID = TO_CHAR(T1.AFF_SNO))
                     WHERE SBMT_FIX_DT = #{cmtDy}
                     GROUP BY T1.TITLE_NM, T1.SBMT_NO, T2.AUD_YR, T2.AUD_NO, T2.AUD_KND_CD,T2.MNG_DPT_CD, SBMT_FIX_DT
                        , T1.AUD_YR, T1.AUD_NO, T4.DOC_ID, T4.RPRT_NM, T1.SBMT_DVSN_NO, T1.AFF_CD, T5.DOC_ID, T6.DOC_ID, T1.SBCN_PRSS_DPT_NM, T4.LINK_URL, T2.AUD_TOT_DRTR_CNB
                    
                            
                UNION ALL
                
                SELECT 
                    T1.CMT_SBJ_TIT AS AUD_SBJ_NM
                    , T1.CMT_DVSN_CD
                    , F_CODE_NM('1000789', T1.CMT_DVSN_CD) AS CMT_DVSN_NM    /*안건구분코드명*/
                    , T1.SBCN_SNO AS SBCN_PAGE_CNT
                    , DECODE(T1.WORK_DVSN_CD, 'A10', F_MNG_KND_AUDYRNO(T1.REL_AUD_YR, T1.REL_AUD_NO, (SELECT AUD_KND_CD FROM TBBADDED001M WHERE AUD_YR = T1.REL_AUD_YR AND AUD_NO = T1.REL_AUD_NO), '-') 
                                                                             , T1.REL_AUD_YR || '-' || DECODE(T1.WORK_DVSN_CD, 'D10', '심사', 'E10', '재심', '') || '-' || TO_CHAR(T1.REL_AUD_NO)) AS AUD_YR_NO
                    , 1 AS CNT
                    , T1.SBMT_MNG_DPT_NM AS DPT_NM
                    , T1.CMT_DY AS SBCN_DY
                    , T1.REL_AUD_YR AS AUD_YR
                    , T1.REL_AUD_NO AS AUD_NO
                    , BAICHF_DOC_ID AS DOC_ID
                    , REF_ID AS REF_DOC_ID
                    , BAICHF_RPRT_NM AS RPRT_NM
                    , DECODE(T1.WORK_DVSN_CD, 'A10', (SELECT MNG_DPT_CD FROM TBBADDED001M WHERE AUD_YR = T1.REL_AUD_YR AND AUD_NO = T1.REL_AUD_NO)
                                                                    , (SELECT DPT_CD
                                                                         FROM TBBADFRE012M ST1
                                                                        WHERE ST1.ACP_YR = T1.REL_AUD_YR
                                                                          AND ST1.ACP_DVSN_CD = DECODE(T1.WORK_DVSN_CD, 'D10', '1', '2')
                                                                          AND ST1.ACP_SRNO = T1.REL_AUD_NO )) AS DPT_CD
                    , T1.SBMT_DVSN_NO
                    , DECODE(T1.WORK_DVSN_CD, 'A10', DECODE(T1.REL_AUD_NO,'255','통보(인사자료)',  '766', '징계문책',  '276', DECODE(T1.CMT_SBJ_SNO, 1, '징계문책', 2,'징계문책'  ) ,   '')
                                                                    , (SELECT F_CODE_NM('1000002', ST2.DSP_RQ_KND_CD) AS DSP_RQ_NM
                                                                        FROM TBBADFRE012M ST1 
                                                                             LEFT OUTER JOIN TBBADEAR001M ST2 
                                                                             ON (ST1.AUD_YR = ST2.AUD_YR
                                                                                 AND ST1.AUD_NO = ST2.AUD_NO
                                                                                 AND ST1.DSP_RQ_SNO = ST2.DSP_RQ_SNO)
                                                                       WHERE ST1.ACP_YR = T1.REL_AUD_YR
                                                                         AND ST1.ACP_DVSN_CD = DECODE(T1.WORK_DVSN_CD, 'D10', '1', '2')
                                                                         AND ST1.ACP_SRNO = T1.REL_AUD_NO)) AS DSP_RQ_NM
                    , DECODE(T1.WORK_DVSN_CD, 'D10', '1', '2') AS ACP_DVSN_CD
                    , RPT_DOC_ID
                    , 'Y' AS ADD_YN
                    , 'Y' AS SBCN_RPRT_SEND_YN
                    , T1.CMT_ADD_YN
                    , 'hancom' AS DOC_TYPE
                    , '' AS AUD_TOT_DRTR_CNB
                    , '' AS MG_DIV_CD
                  FROM TBBADDED121M T1
                       LEFT OUTER JOIN (
                          SELECT 
                                CMT_DY,
                                CMT_DVSN_CD,
                                CMT_SQ,
                                CMT_SBJ_DVSN_CD,
                                CMT_SBJ_SNO,
                                MAX(REF_ID) AS REF_ID,
                                MAX(DOC_ID) AS DOC_ID,
                                MAX(BAICHF_DOC_ID) AS BAICHF_DOC_ID, 
                                MAX(BAICHF_RPRT_NM) AS BAICHF_RPRT_NM,
                                MAX(RPT_DOC_ID) AS RPT_DOC_ID,
                                MAX(RPT_RPRT_NM) AS RPT_RPRT_NM,
                                '' AS EDT_AUTH
                              FROM (
                                SELECT 
                                    ST1.CMT_DY,
                                    ST1.CMT_DVSN_CD,
                                    ST1.CMT_SQ,
                                    ST1.CMT_SBJ_DVSN_CD,
                                    ST1.CMT_SBJ_SNO,
                                    /* CMT_SBJ_DTL_SNO - 1 : 심의안, 2 : 심의안요약(보고자용), 3 : 심의안요약(원장용) 
                                       기타안건(CMT_SBJ_DVSN_CD:90)일 경우 1 로 대체*/
                                    DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,1), ST2.DOC_ID, NULL) AS REF_ID,
                                    DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,3), ST2.DOC_ID, NULL) AS DOC_ID,
                                    DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,2), ST2.DOC_ID, NULL) AS RPT_DOC_ID,
                                    DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,2), ST2.FILE_NM, NULL) AS RPT_RPRT_NM,
                                    DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,3), ST2.DOC_ID, NULL) AS BAICHF_DOC_ID,
                                    DECODE(ST2.CMT_SBJ_DTL_SNO, DECODE(ST2.CMT_SBJ_DVSN_CD,'90',1,3), ST2.FILE_NM, NULL) AS BAICHF_RPRT_NM,
                                    '' AS EDT_AUTH
                                  FROM TBBADDED121M ST1
                                       INNER JOIN TBBADDED122M ST2
                                       ON (ST1.CMT_DY = ST2.CMT_DY 
                                           AND ST1.CMT_DVSN_CD = ST2.CMT_DVSN_CD
                                           AND ST1.CMT_SQ = ST2.CMT_SQ
                                           AND ST1.CMT_SBJ_DVSN_CD = ST2.CMT_SBJ_DVSN_CD
                                           AND ST1.CMT_SBJ_SNO = ST2.CMT_SBJ_SNO)
                                 WHERE ST1.CMT_SBJ_DVSN_CD IN ('10','90')
                                )
                             GROUP BY CMT_DY, CMT_DVSN_CD, CMT_SQ, CMT_SBJ_DVSN_CD,CMT_SBJ_SNO) T2
                       ON (T1.CMT_DY = T2.CMT_DY 
                          AND T1.CMT_DVSN_CD = T2.CMT_DVSN_CD
                          AND T1.CMT_SQ = T2.CMT_SQ
                          AND T1.CMT_SBJ_DVSN_CD = T2.CMT_SBJ_DVSN_CD
                          AND T1.CMT_SBJ_SNO = T2.CMT_SBJ_SNO)      
                 WHERE 1=1
                   AND T1.CMT_DY = REPLACE(#{cmtDy},'-')
                   AND T1.CMT_DVSN_CD = '20'
                    
                    
                     UNION ALL
                    
                    
                    
                     SELECT 
					    T1.TIT_NM AS AUD_SBJ_NM           /*회의 안건명*/
					    , '20' AS CMT_DVSN_CD
					    , F_CODE_NM('1000789', '20') AS CMT_DVSN_NM    /*안건구분코드명*/
					    , T1.SBMT_NO AS SBCN_PAGE_CNT        /*부의순번*/
					    , T1.AUD_YR_NO /*개별사건번호*/
					    , 1 AS CNT
					    , NVL(T1.SBCN_PRSS_DPT_NM, F_DPT_INFO(T1.DPT_CD,'1')) AS DPT_NM
					    , SBMT_FIX_DT AS SBCN_DY                /*회의일자*/
					    , T1.ACP_YR
					    , TO_CHAR(T1.ACP_SRNO)
					    , T1.DOC_ID
					    , T1.REF_ID AS REF_DOC_ID       /*소위원회 심의안 요약 DOC_ID*/
    					, T1.RPRT_NM AS RPRT_NM      /*소위원회 심의안 요약 보고서명*/
					    , T1.DPT_CD AS DPT_CD
					    , T1.SBMT_DVSN_NO
					    , T1.DSP_RQ_NM /*처분요구수정*/
				        , T1.ACP_DVSN_CD
                        , T1.RPT_DOC_ID AS RPT_DOC_ID      /*소위원회심의안 요약(보고자용)DOC_ID*/
                        , 'N' AS ADD_YN
                        , (SELECT DECODE(COUNT(1),0,'N','Y')
                               FROM TBBADFRE111M ST1 
                              WHERE ST1.DOC_ID = T1.DOC_ID_SIM) AS SBCN_RPRT_SEND_YN
                        , 'N' AS CMT_ADD_YN
                        , T1.DOC_TYPE
                        ,  '' AS AUD_TOT_DRTR_CNB
                        , T1.MG_DIV_CD
					  FROM ( 
					    SELECT
					  		  T3.MG_DIV_CD,
	                          T3.ACP_YR,
	                          T3.ACP_SRNO,
	                          T3.ACP_DVSN_CD,
	                          T3.AUD_YR_NO,
	                          T3.DPT_CD,
	                          T3.SBMT_PLAN_DT,
	                          T3.SBMT_REL_CON,
	                          T3.SBMT_REL_PER,
	                          T3.SBMT_REQ_DT,
	                          T3.SBMT_NO,
	                          T3.SBMT_FIX_DT,
	                          T3.SBMT_STA_CD,
	                          T3.APVR_CD,
	                          T3.AFF_SNO,
	                          T3.ACP_MAIN_STEP_SNO,
	                          T3.TIT_NM,
	                          ( SELECT DOC_ID
			                      FROM TBBADFRE103M
			                     WHERE REF_ID = ST3.DOC_ID
			                     AND RPRT_CD NOT IN ('D10300610','E10300310','D10300620','E10300320')
			                     ) AS DOC_ID_SIM ,
	                          ( SELECT DOC_ID
			                      FROM TBBADFRE103M
			                     WHERE REF_ID = ST3.DOC_ID
			                     AND RPRT_CD NOT IN ('D10300610','E10300310','D10300600','E10300300')
			                     ) AS DOC_ID ,
			                  ST3.DOC_ID AS REF_ID,  /*심의안  아이디*/
					  		  ( SELECT RPRT_NM
			                      FROM TBBADFRE103M
			                     WHERE REF_ID = ST3.DOC_ID
			                     AND RPRT_CD NOT IN ('D10300610','E10300310','D10300600','E10300300')
			                     ) AS RPRT_NM ,
					          T3.SBMT_DVSN_NO,
					          T3.DSP_RQ_NM
                              ,  ( SELECT DOC_ID
			                      FROM TBBADFRE103M
			                     WHERE REF_ID = ST3.DOC_ID
			                     AND RPRT_CD NOT IN ('D10300600','E10300300','D10300620','E10300320')
			                     )  AS RPT_DOC_ID  /*소위원회 심의안요약(보고자용) DOC_ID*/
			                  , T3.SBCN_PRSS_DPT_NM
			                  ,( SELECT F_OPEN_EDIT(LINK_URL)
			                      FROM TBBADFRE103M
			                     WHERE REF_ID = ST3.DOC_ID
			                     AND RPRT_CD NOT IN ('D10300610','E10300310','D10300600','E10300300')
			                     ) AS DOC_TYPE
					  		FROM (
					  			SELECT ST1.SBMT_SEQ AS SBMT_SEQ,
			                          ST2.MG_DIV_CD,
			                          DECODE(ST2.MG_DIV_CD, NULL, ST1.ACP_YR, ST2.MG_ACP_YR) AS ACP_YR,
			                          DECODE(ST2.MG_DIV_CD, NULL, ST1.ACP_SRNO, ST2.MG_ACP_SRNO) AS ACP_SRNO,
			                          DECODE(ST2.MG_DIV_CD, NULL, ST1.ACP_DVSN_CD, ST2.MG_ACP_DVSN_CD) AS ACP_DVSN_CD,
			                          ST2.ACP_YR||'-'||DECODE(ST2.ACP_DVSN_CD,'1','심사','재심')||'-'||TO_CHAR(ST2.ACP_SRNO) AS AUD_YR_NO,
			                          ST2.DPT_CD,
			                          ST1.SBMT_PLAN_DT,
			                          ST1.SBMT_REL_CON,
			                          ST1.SBMT_REL_PER,
			                          ST1.SBMT_REQ_DT,
			                          ST1.SBMT_NO,
			                          ST1.SBMT_FIX_DT,
			                          ST1.SBMT_STA_CD,
			                          ST1.APVR_CD,
			                          ST1.AFF_SNO,
			                          ST1.ACP_MAIN_STEP_SNO,
			                          ST1.TITLE_NM AS TIT_NM,
			                          ST1.SBMT_DVSN_NO,
			                          (
				                        SELECT F_CODE_NM('1000002',A.DSP_RQ_KND_CD) 
							              FROM TBBADEAR001M A
							             WHERE 1=1
							               AND A.AUD_YR = ST2.AUD_YR
							               AND A.AUD_NO = ST2.AUD_NO
							               AND A.DSP_RQ_SNO = ST2.DSP_RQ_SNO
							               AND A.AUD_YR IS NOT NULL
				                      ) AS DSP_RQ_NM,
				                      ST1.SBCN_PRSS_DPT_NM
			                     FROM TBBADFRE114M ST1 INNER JOIN TBBADFRE012M ST2 ON (ST1.ACP_YR=ST2.ACP_YR
			                      AND ST1.ACP_SRNO = ST2.ACP_SRNO
			                      AND ST1.ACP_DVSN_CD = ST2.ACP_DVSN_CD)
			                    WHERE 1=1
			                      AND ST1.SBMT_FIX_DT = #{cmtDy}
			                 ) T3 LEFT JOIN (
			                                 SELECT G.DOC_ID, 
                                                    G.RPRT_NM,
                                                    G.DOC_WRT_ID,
                                                    G.APV_STA_CD,
                                                    G.RPRT_CD,
                                                    G.ACP_YR,G.ACP_DVSN_CD,G.ACP_SRNO,
                                                    G.REF_ID
	                                           FROM TBBADFRE103M G
	                                          WHERE G.RPRT_CD IN (DECODE(G.ACP_DVSN_CD,'1','D10300500','2','E10300200'))
			                                ) ST3 ON (T3.ACP_YR=ST3.ACP_YR
			             AND T3.ACP_SRNO = ST3.ACP_SRNO
			             AND T3.ACP_DVSN_CD = ST3.ACP_DVSN_CD
			             AND TO_CHAR(T3.SBMT_SEQ) = ST3.REF_ID/*20170905 UPDATE*/
			             )
			             
			             
			           LEFT JOIN TBBADFRE103M ST4 ON (T3.ACP_YR=ST4.ACP_YR
					              AND T3.ACP_SRNO = ST4.ACP_SRNO
					              AND T3.ACP_DVSN_CD = ST4.ACP_DVSN_CD)
			           WHERE ST4.RPRT_CD = DECODE(T3.ACP_DVSN_CD,'1','D10300200','2','E10300150') 
			           )T1 
                    
                    
                    
                    
                    
                    
                    ) T1 
                    INNER JOIN TBBADDED120M T2
                    ON (T1.SBCN_DY = T2.CMT_DY
                       AND T1.SBMT_DVSN_NO = T2.SBMT_DVSN_NO)
             WHERE T2.CMT_DY = #{cmtDy}   /*회의일자 PARAM*/
               AND T2.CMT_DVSN_CD = '20' /*회의 구분코드*/
               AND T2.CMT_SQ = #{cmtSq}
               ORDER BY T1.SBCN_PAGE_CNT 
        ]]>
    </select>
    
     <select id="selectSubListEtc" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper.selectSubListEtc*/
          <![CDATA[
                     SELECT 
				        	T2.CMT_SQ         /*회의 회차*/
						    ,T2.CMT_TIT        /*회의 안건명*/
						    ,T2.CMT_DY         /*회의 일자*/
						    ,T2.CMT_END_YN     /*회의 종료여부*/
						    ,T2.CMT_DVSN_CD    /*회의 구분코드*/
						    ,REPLACE(T2.CMT_STR_TXT,'|',' ') AS CMT_STR_TXT     /*회의 개회선언사*/
						    ,REPLACE(T2.CMT_END_TXT,'|',' ') AS CMT_END_TXT      /*회의 폐회사*/
						    ,F_USR_INFO(T2.CHF_CMTR_ID, '2') AS CHF_CMTR_NM     /*회의 의장*/
						    ,F_USR_INFO(T2.CMTR1_ID, '2') AS CMTR1_NM           /*회의 위원1*/
						     ,F_USR_INFO(T2.CMTR2_ID, '2') AS CMTR2_NM           /*회의 위원2*/
						     ,F_USR_INFO(T2.CMTR3_ID, '2') AS CMTR3_NM           /*회의 위원3*/
						     ,F_USR_INFO(T2.CMTR4_ID, '2') AS CMTR4_NM           /*회의 위원4*/ 
						     ,F_USR_INFO(T2.CMTR5_ID, '2') AS CMTR5_NM           /*회의 위원5*/
						     ,F_USR_INFO(T2.CMTR6_ID, '2') AS CMTR6_NM           /*회의 위원6*/
                             , T2.CHF_CMTR_ID
                             , T2.CMTR1_ID
                             , T2.CMTR2_ID
                             , T2.CMTR3_ID
                             , T2.CMTR4_ID
                             , T2.CMTR5_ID
                             , T2.CMTR6_ID
						     ,DECODE(T2.CMT_END_YN, 'Y', '종료',  '진행중') AS CMT_END_NM  /*회의종료구분*/ 
						     ,SUBSTR(CMT_DY,0,4)||'년 '||SUBSTR(CMT_DY, 5, 2)||'월 ' ||SUBSTR(CMT_DY, 7, 2)||'일 ' AS CMT_DATA /*회의 날짜*/ 
				             ,DECODE(T1.CMT_SBJ_DVSN_CD , 10,  T1.AUD_SBJ_NM||'('||AUD_YR_NO ||')',  T1.AUD_SBJ_NM) AS AUD_SBJ_NM /*회의 안건명*/
						     ,T1.CMT_SBJ_DVSN_CD      /*안건구분코드*/
						     ,T1.CMT_SBJ_DVSN_NM     /*안건구분코코드*/
						     ,T1.SBCN_PAGE_CNT        /*부의순번*/  
						     ,T1.AUD_YR_NO            /*감사연번호*/     
						     ,T1.CNT                  /*건수*/  
						     ,T1.DPT_NM                /*관련부서명*/    
						     ,T1.CMT_ADD_YN             /*회의추가여부*/    
						     ,T1.SBCN_DY                /*회의일자*/
                             ,T1.AUD_YR                 /*감사년도*/
                             ,T1.AUD_NO                 /*감사번호*/
                             ,T1.DOC_ID               /*부의안 요약 DOCID*/
                             ,T1.REF_ID               /*부의안   DOCID*/
                             ,T1.CMT_SBJ_SNO
                             ,T1.DOC_TYPE               /*부의안 요약 DOCID*/
			 	FROM ( 
						
						    SELECT 
                                 '' as AUD_YR
                                 ,'01' as AUD_NO
						    	,A.CMT_SBJ_TIT AS AUD_SBJ_NM
						        ,A.CMT_SBJ_DVSN_CD
						        ,F_CODE_NM('1000789', A.CMT_SBJ_DVSN_CD) AS CMT_SBJ_DVSN_NM
						        ,A.SBCN_SNO   AS  SBCN_PAGE_CNT
						        ,'' AS AUD_YR_NO
						        ,(SELECT COUNT(B.CMT_SBJ_DTL_SNO)        
						          FROM TBBADDED122M B            
						          WHERE A.CMT_DY = B.CMT_DY
						          AND A.CMT_DVSN_CD = B.CMT_DVSN_CD
						          AND A.CMT_SQ = B.CMT_SQ
						          AND A.CMT_SBJ_SNO = B.CMT_SBJ_SNO) AS CNT
						       	,F_DPT_INFO(A.REL_DPT_CD, '1')  AS DPT_NM
						       	,A.CMT_ADD_YN AS CMT_ADD_YN /*N : 하드코딩*/
						        ,A.CMT_DY AS SBCN_DY
						        ,(SELECT B.DOC_ID       
								        FROM TBBADDED122M B            
								       WHERE A.CMT_DY = B.CMT_DY
								         AND A.CMT_DVSN_CD = B.CMT_DVSN_CD
								         AND A.CMT_SQ = B.CMT_SQ
								         AND A.CMT_SBJ_SNO = B.CMT_SBJ_SNO
								         AND ROWNUM = 1) AS DOC_ID
								,'' AS REF_ID
								,TO_CHAR(A.CMT_SBJ_SNO) AS CMT_SBJ_SNO
								,A.CMT_SQ
								,A.CMT_DVSN_CD
								, 'hancom' AS DOC_TYPE
						    FROM TBBADDED121M A  
						   WHERE A.CMT_DY = #{cmtDy}  /*회의일자 PARAM*/
						    AND A.CMT_DVSN_CD = #{cmtDvsnCd}     /*회의 구분코드*/
						    AND A.CMT_SQ =#{cmtSq}
						) T1 INNER JOIN TBBADDED120M T2
						ON T1.SBCN_DY = T2.CMT_DY
					   AND T1.CMT_SQ = T2.CMT_SQ
					   AND T1.CMT_DVSN_CD  =T2.CMT_DVSN_CD
				      	WHERE T2.CMT_DY =#{cmtDy}   /*회의일자 PARAM*/
				      	 AND T2.CMT_DVSN_CD = #{cmtDvsnCd}  /*회의 구분코드*/
          ]]>
    </select>
    
    
     <select id="selectWtList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper.selectWtList*/
          <![CDATA[
                     SELECT 
                            T2.CMT_SQ         /*회의 회차*/
                            ,T2.CMT_TIT        /*회의 안건명*/
                            ,T2.CMT_DY         /*회의 일자*/
                            ,T2.CMT_END_YN     /*회의 종료여부*/
                            ,T2.CMT_DVSN_CD    /*회의 구분코드*/
                            ,REPLACE(T2.CMT_STR_TXT,'|',' ') AS CMT_STR_TXT     /*회의 개회선언사*/
                            ,REPLACE(T2.CMT_END_TXT,'|',' ') AS CMT_END_TXT      /*회의 폐회사*/
                            ,F_USR_INFO(T2.CHF_CMTR_ID, '2') AS CHF_CMTR_NM     /*회의 의장*/
                            ,F_USR_INFO(T2.CMTR1_ID, '2') AS CMTR1_NM           /*회의 위원1*/
                             ,F_USR_INFO(T2.CMTR2_ID, '2') AS CMTR2_NM           /*회의 위원2*/
                             ,F_USR_INFO(T2.CMTR3_ID, '2') AS CMTR3_NM           /*회의 위원3*/
                             ,F_USR_INFO(T2.CMTR4_ID, '2') AS CMTR4_NM           /*회의 위원4*/ 
                             ,F_USR_INFO(T2.CMTR5_ID, '2') AS CMTR5_NM           /*회의 위원5*/
                             ,F_USR_INFO(T2.CMTR6_ID, '2') AS CMTR6_NM           /*회의 위원6*/
                             , T2.CHF_CMTR_ID
                             , T2.CMTR1_ID
                             , T2.CMTR2_ID
                             , T2.CMTR3_ID
                             , T2.CMTR4_ID
                             , T2.CMTR5_ID
                             , T2.CMTR6_ID
                             ,DECODE(T2.CMT_END_YN, 'Y', '종료',  '진행중') AS CMT_END_NM  /*회의종료구분*/ 
                             ,SUBSTR(T2.CMT_DY,0,4)||'년 '||SUBSTR(T2.CMT_DY, 5, 2)||'월 ' ||SUBSTR(T2.CMT_DY, 7, 2)||'일 ' AS CMT_DATA /*회의 날짜*/ 
                             ,DECODE(T1.CMT_SBJ_DVSN_CD , 10,  T1.AUD_SBJ_NM||'('||AUD_YR_NO ||')',  T1.AUD_SBJ_NM) AS AUD_SBJ_NM /*회의 안건명*/
                             ,T1.CMT_SBJ_DVSN_CD      /*안건구분코드*/
                             ,T1.CMT_SBJ_DVSN_NM     /*안건구분코코드*/
                             ,T1.SBCN_PAGE_CNT        /*부의순번*/  
                             ,T1.AUD_YR_NO            /*감사연번호*/     
                             ,T1.CNT                  /*건수*/  
                             ,T1.DPT_NM                /*관련부서명*/    
                             ,T1.CMT_ADD_YN             /*회의추가여부*/    
                             ,T1.SBCN_DY                /*회의일자*/
                             ,T1.AUD_YR                 /*감사년도*/
                             ,T1.AUD_NO                 /*감사번호*/
                             ,T1.DOC_ID               /*부의안 요약 DOCID*/
                             ,T1.REF_ID               /*부의안   DOCID*/
                             ,T1.CMT_SBJ_SNO
                             ,T3.CMTR_SBCN_YN
                             ,T3.SBCN_VT_TXT
                             ,(SELECT COUNT(1) 
                                  FROM TBBADDED123M ST1
                                WHERE ST1.CMT_DY = T3.CMT_DY
                                     AND ST1.CMT_DVSN_CD = T3.CMT_DVSN_CD
                                     AND ST1.CMT_SQ = T3.CMT_SQ
                                     AND ST1.CMT_SBJ_DVSN_CD = '90'
                                     AND ST1.CMT_SBJ_SNO = 1
                                     AND ST1.CMTR_SBCN_YN = 'Y') AS CMTR_SBCN_Y_CNT
                             ,(SELECT COUNT(1) 
                                  FROM TBBADDED123M ST1
                                WHERE ST1.CMT_DY = T3.CMT_DY
                                     AND ST1.CMT_DVSN_CD = T3.CMT_DVSN_CD
                                     AND ST1.CMT_SQ = T3.CMT_SQ
                                     AND ST1.CMT_SBJ_DVSN_CD = '90'
                                     AND ST1.CMT_SBJ_SNO = 1
                                     AND ST1.CMTR_SBCN_YN = 'N') AS CMTR_SBCN_N_CNT
                             ,(SELECT COUNT(1) 
                                  FROM TBBADDED123M ST1
                                WHERE ST1.CMT_DY = T3.CMT_DY
                                     AND ST1.CMT_DVSN_CD = T3.CMT_DVSN_CD
                                     AND ST1.CMT_SQ = T3.CMT_SQ
                                     AND ST1.CMT_SBJ_DVSN_CD = '90'
                                     AND ST1.CMT_SBJ_SNO = 1) AS CMTR_CNT
                             , T2.CMT_SBCN_YN
                             , T1.DOC_TYPE
                FROM 
                    TBBADDED120M T2
                    LEFT OUTER JOIN ( 
                            SELECT 
                                 '' as AUD_YR
                                 ,'01' as AUD_NO
                                ,A.CMT_SBJ_TIT AS AUD_SBJ_NM
                                ,A.CMT_SBJ_DVSN_CD
                                ,F_CODE_NM('1000789', A.CMT_SBJ_DVSN_CD) AS CMT_SBJ_DVSN_NM
                                ,A.SBCN_SNO   AS  SBCN_PAGE_CNT
                                ,'' AS AUD_YR_NO
                                ,(SELECT COUNT(B.CMT_SBJ_DTL_SNO)        
                                  FROM TBBADDED122M B            
                                  WHERE A.CMT_DY = B.CMT_DY
                                  AND A.CMT_DVSN_CD = B.CMT_DVSN_CD
                                  AND A.CMT_SQ = B.CMT_SQ
                                  AND A.CMT_SBJ_SNO = B.CMT_SBJ_SNO) AS CNT
                                ,F_DPT_INFO(A.REL_DPT_CD, '1')  AS DPT_NM
                                ,A.CMT_ADD_YN AS CMT_ADD_YN /*N : 하드코딩*/
                                ,A.CMT_DY AS SBCN_DY
                                ,(SELECT B.DOC_ID       
                                        FROM TBBADDED121M B            
                                       WHERE A.CMT_DY = B.CMT_DY
                                         AND A.CMT_DVSN_CD = B.CMT_DVSN_CD
                                         AND A.CMT_SQ = B.CMT_SQ
                                         AND A.CMT_SBJ_SNO = B.CMT_SBJ_SNO
                                         AND ROWNUM = 1) AS DOC_ID
                                ,'' AS REF_ID
                                ,TO_CHAR(A.CMT_SBJ_SNO) AS CMT_SBJ_SNO
                                ,A.CMT_SQ
                                ,A.CMT_DVSN_CD
                                ,'hancom' AS DOC_TYPE
                            FROM TBBADDED121M A  
                           WHERE A.CMT_DY = #{cmtDy}  /*회의일자 PARAM*/
                            AND A.CMT_DVSN_CD = #{cmtDvsnCd}     /*회의 구분코드*/
                            AND A.CMT_SQ =#{cmtSq}
                        ) T1 
                            ON (T1.SBCN_DY = T2.CMT_DY
                               AND T1.CMT_SQ = T2.CMT_SQ
                               AND T1.CMT_DVSN_CD  =T2.CMT_DVSN_CD)
                        LEFT OUTER JOIN TBBADDED123M T3
                            ON (T2.CMT_DY = T3.CMT_DY
                               AND T2.CMT_DVSN_CD = T3.CMT_DVSN_CD
                               AND T2.CMT_SQ = T3.CMT_SQ
                               AND T3.CMT_SBJ_DVSN_CD = '90'
                               AND T3.CMT_SBJ_SNO = 1
                               AND T3.CMTR_ID = #{cnb})
                        WHERE T2.CMT_DY =#{cmtDy}   /*회의일자 PARAM*/
                         AND T2.CMT_DVSN_CD = #{cmtDvsnCd}  /*회의 구분코드*/
                         AND T2.CMT_SQ =#{cmtSq}
          ]]>
    </select>
    
    <select id="selectSubDetail" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper.selectSubDetail*/
            <![CDATA[
                 SELECT    C.AUD_YR
                          ,C.AUD_NO
                          ,F_MNG_KND_AUDYRNO(C.AUD_YR, C.AUD_NO, C.AUD_KND_CD, '-') AS AUD_YR_NO    --분류번호
                          ,C.AFF_SNO
                          ,C.TITLE_NM
                          ,C.SBCN_DY
                          ,C.DSP_RQ_NM
                          ,C.RPRT_FILD_ID
                          ,C.DOC_ID
                          ,C.REF_ID
                          ,C.RPT_DOC_ID
                          ,C.BAICHF_DOC_ID
                          ,C.SORT_SNO
                          ,C.DOC_TYPE
          FROM ( SELECT B.AUD_YR
                            ,B.AUD_NO
                            ,B.AUD_KND_CD
                            ,B.AFF_SNO
                            ,B.TITLE_NM
                            ,B.SBCN_DY
                            ,B.SORT_SNO
                            ,SUBSTR(MAX(RPAD(LEVEL,5) || SYS_CONNECT_BY_PATH(DSP_RQ_NM,',')),7) AS DSP_RQ_NM
                            ,B.RPRT_FILD_ID
                            ,B.DOC_TYPE
                            ,(SELECT C.DOC_ID FROM  TBBADDED103M C
                               WHERE C.AUD_YR = B.AUD_YR
                                 AND C.AUD_NO = B.AUD_NO
                                 AND C.RPRT_CD = 'A10700600'
                                 AND C.REF_DY  = B.SBCN_REGI_REQ_DT
                                 AND C.REF_DOC_ID = B.DOC_ID) AS  DOC_ID/*부의안*/
                            ,(SELECT C.DOC_ID FROM  TBBADDED103M C
                               WHERE C.AUD_YR = B.AUD_YR
                                 AND C.AUD_NO = B.AUD_NO
                                 AND C.RPRT_CD = 'A10700500'
                                 AND C.REF_DY  = B.SBCN_REGI_REQ_DT 
                                 AND C.REF_DOC_ID = B.DOC_ID) AS REF_ID /*부의안 요약*/ 
                           ,(SELECT MAX(C.DOC_ID) FROM  TBBADDED103M C
                               WHERE C.AUD_YR = B.AUD_YR
                                 AND C.AUD_NO = B.AUD_NO
                                 AND C.RPRT_CD = 'A10700700'
                                 AND C.REF_DY  = B.SBCN_REGI_REQ_DT 
                                 AND C.REF_DOC_ID = B.DOC_ID) AS RPT_DOC_ID /*부의안 요약*/ 
                            ,(SELECT MAX(C.DOC_ID) FROM  TBBADDED103M C
                               WHERE C.AUD_YR = B.AUD_YR
                                 AND C.AUD_NO = B.AUD_NO
                                 AND C.RPRT_CD = 'A10700800'
                                 AND C.REF_DY  = B.SBCN_REGI_REQ_DT 
                                 AND C.REF_DOC_ID = B.DOC_ID) AS BAICHF_DOC_ID /*부의안 요약*/ 
                       FROM (
                             SELECT  A.AUD_YR
                                    ,A.AUD_NO
                                    ,A.AUD_KND_CD
                                    ,A.AFF_SNO
                                    ,A.TITLE_NM
                                    ,A.SBCN_DY
                                    ,A.DSP_RQ_NM
                                    ,A.SBCN_REGI_REQ_DT
                                    ,A.RPRT_FILD_ID
                                    ,A.SORT_SNO
                                    ,A.DOC_ID
                                    ,A.DOC_TYPE
                                    ,ROW_NUMBER() OVER(PARTITION BY A.AUD_YR, A.AUD_NO, A.AFF_SNO ORDER BY A.AUD_YR, A.AUD_NO, A.AFF_SNO, A.DSP_RQ_NM) AS RN
                                FROM (
                                   SELECT A.AUD_YR
                                         ,A.AUD_NO
                                         ,A.AUD_KND_CD
                                         ,A.AFF_SNO
                                         ,A.TITLE_NM
                                         ,B.SBCN_DY
                                         ,F_CODE_NM('1000002', B.DSP_RQ_CD)||'('||COUNT(B.DSP_RQ_CD)||')' AS DSP_RQ_NM   
                                         ,B.SBCN_REGI_REQ_DT
                                         ,A.RPRT_FILD_ID
                                         ,A.SORT_SNO
                                         ,B.DOC_ID
                                         , NVL((SELECT F_OPEN_EDIT(AA.LINK_URL) 
                                                 FROM TBBADDED103M AA 
                                                WHERE AA.AUD_YR = A.AUD_YR
                                                  AND AA.AUD_NO = A.AUD_NO
                                                  AND AA.AUD_STEP_CD = A.AUD_STEP_CD
                                                  AND AA.DOC_ID = A.DOC_ID ),(SELECT F_CODE_NM('1000894', BB.DOC_WRIT_KND_CD) 
                                                                                FROM TBBADDED001M BB
                                                                               WHERE BB.AUD_YR = A.AUD_YR
                                                                                 AND BB.AUD_NO = A.AUD_NO)) AS DOC_TYPE
                                    FROM TBBADDED145M A -- 사건정보
                                     INNER JOIN TBBADDED113M B -- 부의안건정보
                                      ON A.AFF_SNO = B.AFF_SNO
                                     AND A.AUD_YR = B.AUD_YR
                                     AND A.AUD_NO = B.AUD_NO
                                    WHERE A.AUD_YR= #{audYr}
                                      AND A .AUD_NO = #{audNo}
                                      AND B.SBCN_DY = #{sbcnDy}
                                      AND A.APVR_CD = '0010600'   /*    테스트시에만  0055700 (원래는 0010600) */
                                    GROUP BY A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, A.AFF_SNO, A.TITLE_NM, B.SBCN_DY, B.DSP_RQ_CD, B.SBCN_REGI_REQ_DT, A.RPRT_FILD_ID,A.SORT_SNO,B.DOC_ID, A.AUD_STEP_CD, A.DOC_ID
                                ) A
                        ) B
                        CONNECT BY PRIOR RN = RN - 1 
                           AND PRIOR B.AFF_SNO = B.AFF_SNO
                           AND B.AUD_YR = B.AUD_YR
                           AND B.AUD_NO = B.AUD_NO
                           GROUP BY B.AUD_YR, B.AUD_NO, B.AUD_KND_CD, B.AFF_SNO, B.TITLE_NM,  B.SBCN_DY , B.SBCN_REGI_REQ_DT,B.RPRT_FILD_ID ,B.SORT_SNO, B.DOC_ID, B.DOC_TYPE
                              ) C
                            WHERE C.BAICHF_DOC_ID =#{docId}
                            ORDER BY C.AUD_YR, C.AUD_NO, C.SORT_SNO, C.TITLE_NM,  C.SBCN_DY
            ]]>
   	</select>
    
    
    <select id="selectSubDetailBADFRE" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper.selectSubDetailBADFRE*/
            <![CDATA[
                 SELECT  D.ACP_YR AS AUD_YR
                        , D.ACP_DVSN_CD
                        , D.ACP_SRNO AS AUD_NO
                        , D.ACP_YR || '-' || DECODE(D.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' ||D.ACP_SRNO AS AUD_YR_NO /* 분류번호 */
                        , '' AS AFF_SNO
                        , '(' || D.ACP_YR || '-' || DECODE(D.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || DECODE(D.ORG_ACP_SRNO, null, D.ACP_SRNO, D.ORG_ACP_SRNO) || ') ' || D.TIT_NM AS TITLE_NM
                        , A.SBCN_DY
                        , F_CODE_NM('1000045', D.HNDL_OPNN_CD) AS DSP_RQ_NM
                        , '' AS RPRT_FILD_ID
                        , C.DOC_ID
                        , C.REF_ID
                        , C.RPT_DOC_ID
                        , C.BAICHF_DOC_ID
                        , '' AS SORT_SNO
                        , CASE WHEN (D.ACP_YR = D.MG_ACP_YR AND D.ACP_DVSN_CD = D.MG_ACP_DVSN_CD AND D.ACP_SRNO = D.MG_ACP_SRNO) THEN '대표'
                               WHEN D.MG_DIV_CD IS NULL THEN '대표'
                               ELSE ''
                          END AS MG_DIV_NM
                        , D.MG_DIV_CD
                        , C.DOC_TYPE
                FROM TBBADFRE012M AS D
                     INNER JOIN TBBADFRE113M AS A
                     ON (A.ACP_YR   = NVL(D.MG_ACP_YR, D.ACP_YR) AND A.ACP_SRNO = NVL(D.MG_ACP_SRNO, D.ACP_SRNO) AND A.ACP_DVSN_CD = NVL(D.MG_ACP_DVSN_CD, D.ACP_DVSN_CD))
                     INNER JOIN TBBADFRE112M AS E
                     ON (E.ACP_YR = NVL(D.MG_ACP_YR, D.ACP_YR) AND E.ACP_SRNO = NVL(D.MG_ACP_SRNO, D.ACP_SRNO) AND E.ACP_DVSN_CD = NVL(D.MG_ACP_DVSN_CD, D.ACP_DVSN_CD))
                     LEFT OUTER JOIN TBBADDED120M D4 
                     ON (D4.CMT_DY = A.SBCN_DY AND D4.CMT_DVSN_CD = '10')
                     LEFT OUTER JOIN 
                        (SELECT 
                            ACP_YR,
                            ACP_SRNO,
                            ACP_DVSN_CD,
                            MAX(REF_DY) AS REF_DY,
                            MAX(REF_ID) AS REF_ID,
                            MAX(DOC_ID) AS DOC_ID,
                            MAX(BAICHF_DOC_ID) AS BAICHF_DOC_ID, 
                            MAX(BAICHF_RPRT_NM) AS BAICHF_RPRT_NM,
                            MAX(RPT_DOC_ID) AS RPT_DOC_ID,
                            MAX(RPT_RPRT_NM) AS RPT_RPRT_NM,
                            MAX(EDT_AUTH) AS EDT_AUTH,
                            MAX(DOC_TYPE)    AS DOC_TYPE
                          FROM (
                            SELECT 
                                ACP_YR,
                                ACP_SRNO,
                                ACP_DVSN_CD,
                                REF_DY,
                                F_OPEN_EDIT(ST1.LINK_URL) AS DOC_TYPE,
                                DECODE(ST1.RPRT_CD, 'D10300100', DOC_ID,'E10500100', DOC_ID, NULL) AS REF_ID,
                                DECODE(ST1.RPRT_CD, 'D10301100', DOC_ID,'E10500600', DOC_ID, NULL) AS DOC_ID,
                                DECODE(ST1.RPRT_CD, 'D10301110', DOC_ID,'E10500610', DOC_ID, NULL) AS RPT_DOC_ID,
                                DECODE(ST1.RPRT_CD, 'D10301110', RPRT_NM,'E10500610', RPRT_NM, NULL) AS RPT_RPRT_NM,
                                DECODE(ST1.RPRT_CD, 'D10301100', DOC_ID,'E10500600', DOC_ID, NULL) AS BAICHF_DOC_ID,
                                DECODE(ST1.RPRT_CD, 'D10301100', RPRT_NM,'E10500600', RPRT_NM, NULL) AS BAICHF_RPRT_NM,
                                DECODE(ST1.RPRT_CD, 'D10301110', EDT_AUTH,'E10500610', EDT_AUTH, NULL) AS EDT_AUTH
                              FROM TBBADFRE103M ST1
                             WHERE RPRT_CD IN ('D10300100', 'D10301100', 'E10500100', 'E10500600','D10301110','E10500610')
                           )
                         GROUP BY ACP_YR, ACP_SRNO, ACP_DVSN_CD) C
                     ON (NVL(D.MG_ACP_YR, D.ACP_YR) = C.ACP_YR AND NVL(D.MG_ACP_DVSN_CD, D.ACP_DVSN_CD) = C.ACP_DVSN_CD AND NVL(D.MG_ACP_SRNO, D.ACP_SRNO) = C.ACP_SRNO)
               WHERE 1=1
               AND NVL(D.MG_ACP_YR, D.MG_ACP_YR) = #{acpYr}
                 AND NVL(D.MG_ACP_DVSN_CD, D.ACP_DVSN_CD) = #{acpDvsnCd}
                 AND NVL(D.MG_ACP_SRNO, D.ACP_SRNO) = #{acpSrno}
                 AND A.SBCN_DY = #{sbcnDy}
                 AND (CASE WHEN (D.ACP_YR = D.MG_ACP_YR AND D.ACP_DVSN_CD = D.MG_ACP_DVSN_CD AND D.ACP_SRNO = D.MG_ACP_SRNO) THEN '대표'
                               WHEN D.MG_DIV_CD IS NULL THEN '대표'
                               ELSE ''
                          END) IS NULL
            GROUP BY D.ACP_YR, D.ACP_DVSN_CD, D.ACP_SRNO, D.ORG_ACP_SRNO, D.TIT_NM, A.SBCN_DY, C.DOC_ID, C.REF_ID, C.RPT_DOC_ID, C.BAICHF_DOC_ID, D.AUD_YR, D.AUD_NO, D.DSP_RQ_SNO, D.HNDL_OPNN_CD, D.MG_DIV_CD
                    ,CASE WHEN (D.ACP_YR = D.MG_ACP_YR AND D.ACP_DVSN_CD = D.MG_ACP_DVSN_CD AND D.ACP_SRNO = D.MG_ACP_SRNO) THEN '대표' WHEN D.MG_DIV_CD IS NULL THEN '대표' ELSE '' END, C.DOC_TYPE
            ORDER BY CASE WHEN (D.ACP_YR = D.MG_ACP_YR AND D.ACP_DVSN_CD = D.MG_ACP_DVSN_CD AND D.ACP_SRNO = D.MG_ACP_SRNO) THEN '대표' WHEN D.MG_DIV_CD IS NULL THEN '대표' ELSE '' END, AUD_YR ASC, TO_NUMBER(AUD_NO) ASC
            ]]>
   	</select>
   	
    <select id="selectSubDetailEtc" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper.selectSubDetailEtc*/
          <![CDATA[
                      SELECT ROWNUM AS AFF_SNO 
                              ,A.FILE_NM 
                              ,A.CMT_SBJ_DTL_TIT AS TITLE_NM
                              ,A.DOC_ID 
                              ,'' AS DSP_RQ_NM
                              ,A.CMT_SBJ_DVSN_CD
                              ,A.CMT_DVSN_CD
                      FROM TBBADDED122M A
                      WHERE A.CMT_DY = #{sbcnDy}
                      AND A.CMT_DVSN_CD =  #{cmtDvsnCd}
                      AND A.CMT_SBJ_DVSN_CD =  #{cmtSbjDvsnCd}
                      AND A.CMT_SBJ_SNO = #{cmtSbjSno}
          ]]>
    </select>

    <select id="getBltDptList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper.getBltDptList*/
          <![CDATA[
            SELECT T.DPT_CD
             FROM (SELECT A.DPT_CD    
                       FROM TBDCMACM002M A
                      WHERE A.USE_YN = 'Y'
                      CONNECT BY  PRIOR A.DPT_CD = A.HIRK_DPT_CD 
                                 START WITH A.DPT_CD IN (SELECT B.DPT_CD 
                                                           FROM TBDCMACM001M B
                                                          WHERE B.CNB =   #{cnb}--전산번호 PARMAETER
                                                            AND ROWNUM = 1
                                                         UNION
                                                         SELECT B.SUB_DPT_CD 
                                                           FROM TBDCMACM001M B
                                                          WHERE B.CNB =   #{cnb}--전산번호 PARMAETER
                                                            AND ROWNUM = 1)
          ]]>
          <if test="dptCd == '550000'  and pstCd == '0045900' " >
          <![CDATA[
                          UNION ALL 
                          SELECT A.DPT_CD
                           FROM TBDCMACM002M A
                          WHERE A.USE_YN = 'Y' 
                           CONNECT BY  PRIOR A.DPT_CD = A.HIRK_DPT_CD 
                                      START WITH A.DPT_CD = (SELECT DPT_CD 
                                                                       FROM TBDCMACM001M
                                                                      WHERE DPT_CD ='170000'
                                                                        AND PST_CD = '0013900'
                                                                        AND ROWNUM = 1 )
             ]]>
           </if>
          <![CDATA[
          ) T
          GROUP BY T.DPT_CD
            ]]>
    </select>

     <update id="updateBADDED123M" parameterType="paramMap"> 
    /*kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper.updateBADDED123M*/
        UPDATE TBBADDED123M SET 
                <if test="cmtrSbcnYn != null and cmtrSbcnYn !='' ">
                CMTR_SBCN_YN = #{cmtrSbcnYn},
                </if>
                <if test="sbcnVtTxt != null and sbcnVtTxt !='' ">
                SBCN_VT_TXT = #{sbcnVtTxt},
                </if>
                FNL_USR_ID = #{usrId},
                FNL_DEAL_DPT_CD = #{dptCd},
                FNL_MNU_ID = #{menuNo},
                FNL_MDF_DH = SYSDATE
          WHERE CMT_DY = REPLACE(#{cmtDy}, '-')
           AND CMT_DVSN_CD     = #{cmtDvsnCd}
           AND CMT_SQ          = #{cmtSq}
           AND CMT_SBJ_DVSN_CD =#{cmtSbjDvsnCd}
           AND CMTR_ID = #{cnb}
    </update>
    
    <update id="updateBADDED120M" parameterType="paramMap"> 
    /*kr.go.bai.eip.aep.cfr.dao.AEPCFR002QMapper.updateBADDED120M*/
        UPDATE TBBADDED120M SET 
                CMT_SBCN_YN = 'Y',
                FNL_USR_ID = #{usrId},
                FNL_DEAL_DPT_CD = #{dptCd},
                FNL_MNU_ID = #{menuNo},
                FNL_MDF_DH = SYSDATE
          WHERE CMT_DY = REPLACE(#{cmtDy}, '-')
           AND CMT_DVSN_CD     = #{cmtDvsnCd}
           AND CMT_SQ          = #{cmtSq}
    </update>
</mapper> 