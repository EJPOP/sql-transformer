<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.asb.dao.AEPASB013PMapper">

    <select id="selectDspRqList" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB013PMapper.selectDspRqList */
 		<![CDATA[
 		SELECT 
            F_MNG_KND_AUDYRNO(AUD_YR, AUD_NO, T1.AUD_KND_CD, '-')  
            ||'-'|| AFF_CD 
            ||'-'|| AFF_DSP_CD AS DSP_RQ_SNO_NM
            , TITLE_NM
            , DSP_RQ_CD
            , F_CODE_NM('1000002',DSP_RQ_CD ) AS DSP_RQ_NM
            , RLTN_ORG_CD
            , CASE WHEN RLTN_ORG_CD IS NOT NULL THEN F_ORG_INFO(RLTN_ORG_CD,'1')ELSE '' END COPT_OFI_NM
            , AUD_YR
            , AUD_NO
            , T1.AUD_KND_CD
            , T1.AUD_GRN_NO
            , AFF_CD
            , AFF_DSP_CD
            , DSP_RQ_CD
            , AUD_STEP_CD
            , DOC_ID
            , APVR_CD
            , AFF_SNO
            , DSP_RQ_SNO
            , RLTN_ORG_CD
        FROM 
            TBBADDED145M T1
            JOIN
            TBBADDED146M T2
            USING(AUD_YR, AUD_NO, AUD_STEP_CD, DOC_ID, APVR_CD, AFF_SNO)
        WHERE
            AUD_YR = '2016'
        AND AUD_NO = '061'
        AND AUD_STEP_CD = '60'
        ORDER BY AFF_CD, AFF_DSP_CD
 		]]>
    </select>

    <insert id="insertAgdList">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB013PMapper.insertAgdList */
	<![CDATA[
	INSERT INTO TBBADDED113M(
            AUD_YR
            ,AUD_NO
            ,SBCN_SBJ_SNO
            ,SBCN_AGD_SNO
            ,AUD_KND_CD
            ,AUD_GRN_NO
            ,AFF_CD
            ,TITLE_NM
            ,AFF_DSP_CD
            ,DSP_RQ_CD
            ,AUD_STEP_CD
            ,DOC_ID
            ,APVR_CD
            ,AFF_SNO
            ,DSP_RQ_SNO
            ,RLTN_ORG_CD
            ,FRT_USR_ID
            ,FNL_USR_ID
            ,FNL_DEAL_DPT_CD
            , FNL_MNU_ID
            , FRT_REGI_DH
            , FNL_MDF_DH
            
            )
    VALUES(
            #{audYr}
            , #{audNo}
            , #{sbcnSbjSno}
            , (SELECT 
            LPAD(NVL(MAX(TO_NUMBER(SBCN_AGD_SNO)),0)+1,3,0) 
            FROM TBBADDED113M 
            WHERE 
            AUD_YR = #{audYr} 
            AND AUD_NO =#{audNo}
            AND SBCN_SBJ_SNO =#{sbcnSbjSno}  )
            , #{audKndCd}
            , #{audGrnNo}
            , #{affCd}
            , #{titleNm}
            , #{affDspCd}
            , #{dspRqCd}
            , '70'
            , #{docId}
            , #{apvrCd}
            , #{affSno}
            , #{dspRqSno}
            , #{rltnOrgCd}
            , #{usrId}
            , #{usrId}
            , #{dptCd}
            , 'AEPASB013P'
            , SYSDATE
            , SYSDATE
            )

		]]>
    </insert>

</mapper> 
