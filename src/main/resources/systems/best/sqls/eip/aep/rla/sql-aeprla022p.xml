<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper">

    <!--부패행위 법률자문 요청목록 조회 -->
    <select id="selectLawList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.selectLawList */
        <![CDATA[
        SELECT LEGAL_REQ_DVSN_CD
             , AUD_YR_NO
             , AFF_NO
             , AFF_NO                            AS AFF_NO_REGI
             , TITLE_NM
             , RQS_DOC_NM
             , RQS_DOC_NM                        AS V_RQS_DOC_NM
             , RQS_DOC_ID
             , RQS_DOC_TYPE
             , RQS_DOC_SND_DT
             , RQS_DOC_APV_STA_CD
             , NVL(F_CODE_NM('1000773', RQS_DOC_APV_STA_CD), '미작성')
                                                 AS RQS_DOC_APV_STA_NM
             , RQS_DOC_APV_RQS_ID
             , NVL(RQS_DOC_SND_DT, '미발신')     AS RQS_DOC_SND_STA_NM
             , OPIN_DOC_NM
             , OPIN_DOC_NM                       AS V_OPIN_DOC_NM
             , OPIN_DOC_ID
             , OPIN_DOC_TYPE
             , OPIN_DOC_RCPT_NM
             , EXAM_DOC_NM
             , EXAM_DOC_NM                       AS V_EXAM_DOC_NM
             , EXAM_DOC_ID
             , EXAM_DOC_TYPE
             , EXAM_DOC_APV_STA_CD
             , NVL(F_CODE_NM('1000773', EXAM_DOC_APV_STA_CD), '미작성')
                                                 AS EXAM_DOC_APV_STA_NM
             , EXAM_DOC_APV_RQS_ID
             , WRK_YR
             , WRK_NO
             , LEGAL_REQ_SRNO
             , AFF_SNO
             , APVR_CD
             , TRTM_DOC_ID
             , REQ_STAT_CD
             , F_CODE_NM('1000830', REQ_STAT_CD) AS REQ_STAT_NM
             , WRK_DVSN_CD
             , AUD_STEP_CD
             , SUPPLM_REQ_CNT
             , REQ_DVSN_CD
         FROM (SELECT T1.LEGAL_REQ_DVSN_CD
                	, T2.ACP_YR || '-' || '부감' || '-' || T2.CVPT_ACP_NO AS AUD_YR_NO 
              		, T2.ACP_YR || '-' || '부감' || '-' || T2.CVPT_ACP_NO AS AFF_NO 
                    , T2.TIT_NM                                          AS TITLE_NM
                    , (SELECT MAX(RPRT_NM)
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100100') 
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_NM         /* 법률자문요청서(요청문서명) */
                    , (SELECT MAX(DOC_ID)
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100100')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_ID         /* 법률자문요청서(요청문서ID) */
                    , (SELECT F_OPEN_EDIT(MAX(LINK_URL))
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100100')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_TYPE       /* 법률자문요청서(요청문서유형) */
                    , (SELECT TO_CHAR(MAX(SND_DH), 'YYYY-MM-DD')
                         FROM TBCORCOR111M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND ACP_DVSN_CD  = T2.REQ_DVSN_CD
                          AND ACP_SRNO     = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100100')
                          AND RCPT_DPT_CD  = '160100'
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_SND_DT     /* 법률자문요청서(요청문서송신일자) */
                    , (SELECT MAX(APV_STA_CD)
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100100')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_APV_STA_CD /* 법률자문요청서(요청문서승인상태코드) */
                    , (SELECT MAX(APV_RQS_ID)
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100100')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS RQS_DOC_APV_RQS_ID /* 법률자문요청서(요청문서승인요청ID) */
                    , (SELECT MAX(RPRT_NM)
                         FROM TBCORCOR111M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND ACP_DVSN_CD  = T2.REQ_DVSN_CD
                          AND ACP_SRNO     = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100300')
                          /* BEST20 법률자문관2 사용시 조회되지 않음 */
                          --AND SND_DPT_CD   = DECODE(T1.LEGAL_REQ_DVSN_CD, '30', '160000', '160100')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS OPIN_DOC_NM        /* 법률자문의견서(의견문서명) */
                    , (SELECT MAX(DOC_ID)
                         FROM TBCORCOR111M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND ACP_DVSN_CD  = T2.REQ_DVSN_CD
                          AND ACP_SRNO     = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100300')
                          /* BEST20 법률자문관2 사용시 조회되지 않음 */
                          --AND SND_DPT_CD   = DECODE(T1.LEGAL_REQ_DVSN_CD, '30', '160000', '160100')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS OPIN_DOC_ID        /* 법률자문의견서(의견문서ID) */
                    , (SELECT F_OPEN_EDIT(MAX(LINK_URL))
                         FROM TBCORCOR111M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND ACP_DVSN_CD  = T2.REQ_DVSN_CD
                          AND ACP_SRNO     = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100300')
                          /* BEST20 법률자문관2 사용시 조회되지 않음 */
                          --AND SND_DPT_CD   = DECODE(T1.LEGAL_REQ_DVSN_CD, '30', '160000', '160100')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS OPIN_DOC_TYPE      /* 법률자문의견서(의견문서유형) */
                    , NVL(
                      (SELECT MAX('수신('||TO_CHAR(RCPT_DH, 'YYYY-MM-DD')||')')
                         FROM TBCORCOR111M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND ACP_DVSN_CD  = T2.REQ_DVSN_CD
                          AND ACP_SRNO     = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100300')
                          /* BEST20 법률자문관2 사용시 조회되지 않음 */
                          --AND SND_DPT_CD   = DECODE(T1.LEGAL_REQ_DVSN_CD, '30', '160000', '160100')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO))
                      , '미수신')                                        AS OPIN_DOC_RCPT_NM   /* 법률자문의견서(의견문서유형) */
                    , (SELECT MAX(RPRT_NM)
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100500')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS EXAM_DOC_NM        /* 법률자문검토보고서(검토문서명) */
                    , (SELECT MAX(DOC_ID)
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100500')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS EXAM_DOC_ID        /* 법률자문검토보고서(검토문서ID) */
                    , (SELECT F_OPEN_EDIT(MAX(LINK_URL))
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100500')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS EXAM_DOC_TYPE      /* 법률자문검토보고서(검토문서유형) */
                    , (SELECT APV_STA_CD
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100500')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS EXAM_DOC_APV_STA_CD/* 법률자문검토보고서(검토문서승인상태코드) */
                    , (SELECT MAX(APV_RQS_ID)
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100500')
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS EXAM_DOC_APV_RQS_ID/* 법률자문검토보고서(검토문서승인요청ID) */
                    , (SELECT MAX(DOC_ID)
                         FROM TBCORCOR603M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND REQ_DVSN_CD  = T2.REQ_DVSN_CD
                          AND CVPT_ACP_NO  = T1.WRK_NO
                          AND RPRT_CD     IN ('F40100200')  
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)) AS TRTM_DOC_ID        /* 법률자문처리안(처리문서ID) */
                    , (SELECT COUNT(DOC_ID)
                         FROM TBCORCOR111M
                        WHERE 1=1
                          AND ACP_YR       = T1.WRK_YR
                          AND ACP_SRNO     = T1.WRK_NO
                          AND ACP_DVSN_CD  = T2.REQ_DVSN_CD
                          AND RPRT_CD     IN ('F40100100','F40100200')
                          AND SND_DPT_CD   = '160100' --법무에서 발신된 문서
                          AND REF_ID       = TO_CHAR(T1.LEGAL_REQ_SRNO)
                          AND DOC_STA_CD   = '51')                       AS SUPPLM_REQ_CNT
                    , T1.WRK_YR
                    , T1.WRK_NO
                    , T1.LEGAL_REQ_SRNO
                    , ''                                                 AS AFF_SNO
                    , ''                                                 AS APVR_CD
                    , T1.REQ_STAT_CD
                    , T1.WRK_DVSN_CD
                    , T1.AUD_STEP_CD
                    , T2.REQ_DVSN_CD
                 FROM TBBADDED126M T1
      LEFT OUTER JOIN TBCORCOR101M T2 ON (T1.WRK_YR      = T2.ACP_YR
                                      AND T1.WRK_NO      = T2.CVPT_ACP_NO
                                      AND T1.WRK_DVSN_CD = DECODE(T2.REQ_DVSN_CD, '5', 'F10'))
                WHERE 1=1
                  AND T2.ACP_YR      = #{acpYr}
                  AND T2.CVPT_ACP_NO = #{cvptAcpNo}
                  AND T2.REQ_DVSN_CD = #{reqDvsnCd}
              )
        WHERE 1=1
        ORDER BY DECODE(REQ_STAT_CD, '70', '30', REQ_STAT_CD)
               , LEGAL_REQ_SRNO DESC
        ]]>
    </select>
    
    <select id="selectFldAudLnkCnt" parameterType="paramMap" resultType="int">
    <![CDATA[
        SELECT COUNT(1) AS CNT
          FROM TBBADDED030L TB
         WHERE 1=1
           AND TB.TSK_KEY1 = #{acpYr}
           AND TB.TSK_KEY2 = #{reqDvsnCd}
           AND TB.TSK_KEY3 = #{cvptAcpNo} 
    ]]>
    </select>
    
    <!-- 감사청구 법률자문 관련문서 조회 -->
    <select id="selectRprtApvList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.selectRprtApvList */
        <![CDATA[
        SELECT G1.RPRT_NM
             , G1.RPRT_NM                         AS V_RPRT_NM
             , G1.APV_STA_CD
             , G1.APV_STA_NM
             , G1.DOC_ID
             , G1.APV_RQS_ID
             , (SELECT TIT_NM
                  FROM TBCORCOR101M
                 WHERE 1=1
                   AND ACP_YR      = G1.ACP_YR
                   AND REQ_DVSN_CD = G1.ACP_DVSN_CD
                   AND CVPT_ACP_NO = G1.ACP_SRNO) AS AUD_SBJ_NM
             , MAX(G1.APV_INFO_1)                 AS APV_INFO_1
             , MAX(G1.APV_INFO_2)                 AS APV_INFO_2
             , MAX(G1.APV_INFO_3)                 AS APV_INFO_3
             , MAX(G1.APV_INFO_4)                 AS APV_INFO_4
             , MAX(G1.APV_INFO_5)                 AS APV_INFO_5
             , MAX(G1.APV_INFO_6)                 AS APV_INFO_6
             , MAX(G1.APV_INFO_7)                 AS APV_INFO_7
             , (SELECT DECODE(COUNT(1), 0, 'N', 'Y')
                  FROM TBCORCOR111M
                 WHERE 1=1
                   AND ACP_YR      = G1.ACP_YR
                   AND ACP_DVSN_CD = G1.ACP_DVSN_CD
                   AND ACP_SRNO    = G1.ACP_SRNO
                   AND RPRT_CD     = G1.RPRT_CD
                   AND DOC_ID      = G1.DOC_ID)   AS SEND_YN
             , (SELECT DOC_STA_CD
                  FROM TBCORCOR111M
                 WHERE 1=1
                   AND ACP_YR      = G1.ACP_YR
                   AND ACP_DVSN_CD = G1.ACP_DVSN_CD
                   AND ACP_SRNO    = G1.ACP_SRNO
                   AND RPRT_CD     = G1.RPRT_CD
                   AND DOC_ID      = G1.DOC_ID
                   AND SND_DPT_CD  = '160100')    AS SEND_STA_CD
             , (SELECT SUPPLM_REQ
                  FROM TBCORCOR111M
                 WHERE 1=1
                   AND ACP_YR      = G1.ACP_YR
                   AND ACP_DVSN_CD = G1.ACP_DVSN_CD
                   AND ACP_SRNO    = G1.ACP_SRNO
                   AND RPRT_CD     = G1.RPRT_CD
                   AND DOC_ID      = G1.DOC_ID
                   AND SND_DPT_CD  = '160100')    AS SUPPLM_REQ
             , (SELECT RCPT_DPT_CD
                  FROM TBCORCOR111M
                 WHERE 1=1
                   AND ACP_YR      = G1.ACP_YR
                   AND ACP_DVSN_CD = G1.ACP_DVSN_CD
                   AND ACP_SRNO    = G1.ACP_SRNO
                   AND RPRT_CD     = G1.RPRT_CD
                   AND DOC_ID      = G1.DOC_ID
                   AND SND_DPT_CD  = '160100')    AS RCPT_DPT_CD
             , (SELECT DECODE(RCPT_DPT_CD, '160000', '법률자문관I', '160100', '법률자문관II') 
                  FROM TBCORCOR111M
                 WHERE 1=1
                   AND ACP_YR      = G1.ACP_YR
                   AND ACP_DVSN_CD = G1.ACP_DVSN_CD
                   AND ACP_SRNO    = G1.ACP_SRNO
                   AND RPRT_CD     = G1.RPRT_CD
                   AND DOC_ID      = G1.DOC_ID
                   AND SND_DPT_CD  = '160100')    AS RCPT_DPT_NM
             , G1.RPRT_CD
             , G1.DOC_WRT_ID
             , G1.DOC_TYPE
          FROM (SELECT ACP_YR
                     , ACP_DVSN_CD
                     , ACP_SRNO
                     , RPRT_CD
                     , RPRT_NM
                     , APV_STA_CD
                     , APV_STA_NM
                     , DOC_ID
                     , APV_RQS_ID
                     , DOC_WRT_ID
                     , DOC_TYPE
                     , DECODE(ROW_ID, 1, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_1
                     , DECODE(ROW_ID, 2, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_2
                     , DECODE(ROW_ID, 3, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_3
                     , DECODE(ROW_ID, 4, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_4
                     , DECODE(ROW_ID, 5, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_5
                     , DECODE(ROW_ID, 6, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_6
                     , DECODE(ROW_ID, 7, DECODE(APVR_NM, NULL, '', APV_DH || '/' || PST_NM || '/' || APVR_NM), '') AS APV_INFO_7
                 FROM (SELECT ACP_YR
	                        , ACP_DVSN_CD
	                        , ACP_SRNO
	                        , RPRT_CD
	                        , RPRT_NM
	                        , APV_STA_CD
	                        , APV_STA_NM
	                        , DOC_ID
	                        , APV_RQS_ID
	                        , PST_NM
	                        , APVR_NM
	                        , APV_DH
                            , DOC_WRT_ID
                            , DOC_TYPE
                            , ROW_NUMBER() OVER(PARTITION BY DOC_ID ORDER BY APV_SNO) AS ROW_ID 
                         FROM (SELECT T1.ACP_YR
		                            , T1.REQ_DVSN_CD               AS ACP_DVSN_CD
		                            , T1.CVPT_ACP_NO               AS ACP_SRNO
		                            , T1.RPRT_CD
		                            , T1.RPRT_NM
		                            , T1.APV_STA_CD
		                            , F_CODE_NM('1000773', T1.APV_STA_CD)
		                                                           AS APV_STA_NM
		                            , T1.DOC_ID
		                            , T2.APV_SNO
		                            , T1.APV_RQS_ID
		                            , CASE WHEN T2.APVR_PST_CD IS NULL
		                                   THEN (SELECT MAX(ONR_PST_NM)
		                                           FROM TBDCMACM001M
		                                          WHERE 1=1
		                                            AND CNB = T2.APVR_CNB)
                                           ELSE F_CODE_NM('1000176', T2.APVR_PST_CD)
                                       END                         AS PST_NM
                                    , F_USR_INFO(T2.APVR_CNB, '2') AS APVR_NM
                                    , CASE WHEN SUBSTR(T2.APVR_STA_CD, 0, 1) = '2'
                                           THEN TO_CHAR(T2.APV_DH, 'YYYY-MM-DD')
                                           ELSE ''
                                       END                         AS APV_DH
                                    , T1.DOC_WRT_ID
                                    , F_OPEN_EDIT(LINK_URL)        AS DOC_TYPE
                                 FROM TBCORCOR603M T1
                      LEFT OUTER JOIN TBDCMACM023L T2 ON (T1.APV_RQS_ID   = T2.APV_DOC_NO
                                                      AND T2.APV_SNO     <> '1'  --(기안자 제외)
                                                      AND T2.APVR_KND_CD <> '4') --(협조자 제외)
                                WHERE 1=1
                                  AND T1.ACP_YR       = #{wrkYr}
                                  AND T1.REQ_DVSN_CD  = #{reqDvsnCd}
                                  AND T1.CVPT_ACP_NO  = #{wrkNo}
                                  AND T1.RPRT_CD     IN ('F40100100', 'F40100200', 'F40100400', 'F40100500')
                                  AND T1.REF_ID       = #{legalReqSrno}
                              )
                        WHERE 1=1
                      )
                WHERE 1=1
               ) AS G1
         WHERE 1=1
         GROUP BY G1.ACP_YR
                , G1.ACP_DVSN_CD
                , G1.ACP_SRNO
                , G1.RPRT_CD
                , G1.RPRT_NM
                , G1.APV_STA_CD
                , G1.APV_STA_NM
                , G1.DOC_ID
                , G1.APV_RQS_ID 
                , G1.DOC_WRT_ID
                , G1.DOC_TYPE
        ]]>
    </select>
    
    <!-- 감사청구 법률자문 수신문서 조회 -->
    <select id="selectRprtRcptList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.selectRprtRcptList */
        <![CDATA[
        SELECT RPRT_NM
             , DOC_ID
             , '수신'                         AS STA_NM
             , F_DPT_INFO(SND_DPT_CD, 1)      AS SND_DPT_NM
             , TO_CHAR(SND_DH, 'YYYY-MM-DD')  AS SND_DT
             , F_DPT_INFO(RCPT_DPT_CD, 1)     AS RCPT_DPT_NM
             , TO_CHAR(RCPT_DH, 'YYYY-MM-DD') AS RCPT_DT
             , F_OPEN_EDIT(LINK_URL)          AS DOC_TYPE
          FROM TBCORCOR111M
         WHERE 1=1
           AND ACP_YR       = #{wrkYr}
           AND ACP_DVSN_CD  = #{reqDvsnCd}
           AND ACP_SRNO     = #{wrkNo}
           AND RPRT_CD     IN ('F40100400')
           AND REF_ID       = #{legalReqSrno}
        ]]>
    </select>
    
    <!-- 감사청구 법률자문 발신문서 조회 -->
    <select id="selectRprtSndList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.selectRprtSndList */
        <![CDATA[
        SELECT RPRT_NM
             , DOC_ID
             , DECODE(DOC_STA_CD, '10', '발신', '20', '수신', '')
                                              AS STA_NM
             , F_DPT_INFO(SND_DPT_CD, 1)      AS SND_DPT_NM
             , TO_CHAR(SND_DH, 'YYYY-MM-DD')  AS SND_DT
             , F_DPT_INFO(RCPT_DPT_CD, 1)     AS RCPT_DPT_NM
             , TO_CHAR(RCPT_DH, 'YYYY-MM-DD') AS RCPT_DT
             , F_OPEN_EDIT(LINK_URL)          AS DOC_TYPE
          FROM TBCORCOR111M
         WHERE 1=1
           AND ACP_YR       = #{wrkYr}
           AND ACP_DVSN_CD  = #{reqDvsnCd}
           AND ACP_SRNO     = #{wrkNo}
           AND RPRT_CD     IN ('F40100100','F40100200')
           AND SND_DPT_CD  <> '160100'
           AND REF_ID       = #{legalReqSrno}
        ]]>
    </select>
    
    <!-- 감사청구 법률자문 요청목록 저장 -->
    <insert id="insertLegalReq" parameterType="paramMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.insertLegalReq */
        MERGE INTO TBBADDED126M T1
             USING (SELECT '1' FROM DUAL) T2
                ON (T1.WRK_DVSN_CD    = NVL(#{wrkDvsnCd}, 'C10')
                AND T1.WRK_YR         = #{wrkYr}
                AND T1.WRK_NO         = #{wrkNo}
                AND T1.AUD_STEP_CD    = DECODE(#{wrkDvsnCd}, 'C10', 'C2010', 'B3010')
                AND T1.LEGAL_REQ_SRNO = #{legalReqSrno})
              WHEN MATCHED THEN
                    UPDATE
                       SET T1.LEGAL_REQ_DVSN_CD = #{legalReqDvsnCd}
                         , T1.APVR_CD           = #{apvrCd}
                         , T1.AFF_SNO           = #{affSno}
                         , T1.RPRT_FILD_ID      = #{rprtFildId}
                         , T1.FNL_USR_ID        = #{usrId}
                         , T1.FNL_DEAL_DPT_CD   = #{dptCd}
                         , T1.FNL_MNU_ID        = #{mnuId}
                         , T1.FNL_MDF_DH        = SYSDATE
              WHEN NOT MATCHED THEN
                    INSERT (WRK_DVSN_CD
                          , WRK_YR
                          , WRK_NO
                          , AUD_STEP_CD
                          , LEGAL_REQ_SRNO
                          , LEGAL_REQ_GRN_SRNO
                          , LEGAL_REQ_DH
                          , APVR_CD
                          , AFF_SNO
                          , RPRT_FILD_ID
                          , REQ_STAT_CD
                          , LEGAL_REQ_DVSN_CD
                          , LEGAL_RCP_YN
                          , LEGAL_RCP_DH
                          , HIDDEN_YN
                          , FRT_USR_ID
                          , FNL_USR_ID
                          , FNL_DEAL_DPT_CD
                          , FNL_MNU_ID
                          , FRT_REGI_DH
                          , FNL_MDF_DH)
                    VALUES (NVL(#{wrkDvsnCd}, 'F10')
                          , #{wrkYr}
                          , #{wrkNo}
                          , DECODE(#{wrkDvsnCd}, 'F10','F3010')
                          , (SELECT NVL(MAX(LEGAL_REQ_SRNO), 0) + 1
                               FROM TBBADDED126M
                              WHERE 1=1
                                AND WRK_YR = #{wrkYr})
                          , (SELECT NVL(MAX(LEGAL_REQ_SRNO), 0) + 1
                               FROM TBBADDED126M
                              WHERE 1=1
                                AND WRK_YR = #{wrkYr})
                          , ''
            <if test="apvrCd != null and apvrCd != ''">
                          , #{apvrCd}
            </if>
            <if test="apvrCd == null or apvrCd == ''">
                          , ''
            </if>
            <if test="affSno != null and affSno != ''">
                          , #{affSno}
            </if>
            <if test="affSno == null or affSno == ''">
                          , ''
            </if>
            <if test="rprtFildId != null and rprtFildId != ''">
                          , #{rprtFildId}
            </if>
            <if test="rprtFildId == null or rprtFildId == ''">
                          , ''
            </if>
                          , '10'
                          , #{legalReqDvsnCd}
                          , ''
                          , ''
                          , 'N'
                          , #{usrId}
                          , #{usrId}
                          , #{dptCd}
                          , #{mnuId}
                          , SYSDATE
                          , SYSDATE)
    </insert>
    
    <!-- 감사청구 법률자문 요청목록 삭제(1) -->
    <delete id="deleteLegalReq" parameterType="paramMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.deleteLegalReq */
        <![CDATA[
        DELETE TBBADDED126M
         WHERE 1=1
           AND WRK_DVSN_CD    = #{wrkDvsnCd}
           AND WRK_YR         = #{wrkYr}
           AND WRK_NO         = #{wrkNo}
           AND AUD_STEP_CD    = #{audStepCd}
           AND LEGAL_REQ_SRNO = #{legalReqSrno}
        ]]>
    </delete>
    
    <!-- 감사청구 법률자문 요청목록 삭제(2) -->
    <select id="selectDelDocId" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.selectDelDocId */
        <![CDATA[
        SELECT DOC_ID
          FROM TBCORCOR603M
         WHERE 1=1																
           AND RPRT_CD    IN ('F40100100', 'F40100200', 'F40100500') /* 부패행위 법률자문요청서(F40100100), 부패행위 법률자문처리안(F40100200), 부패행위 법률자문검토보고서(F40100500) */
           AND ACP_YR      = #{wrkYr}
           AND CVPT_ACP_NO = #{wrkNo}
           AND REF_ID      = #{legalReqSrno}
        ]]>
    </select>
    
    <!-- 감사청구 법률자문 요청목록 삭제(3) -->
    <update id="deleteDoc" parameterType="paramMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.deleteDoc */
        <![CDATA[
        DELETE TBCORCOR603M
         WHERE 1=1
           AND DOC_ID = #{docId}
        ]]>
    </update>
    
    <!-- 감사청구 법률자문 문서양식ID 조회 -->    
    <select id="selectDocId" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.selectDocId */
        <![CDATA[
        SELECT MAX(DOC_ID) AS DOC_ID
          FROM TBFDMADM002M
         WHERE 1=1
           AND AUD_DOC_CD = #{rprtCd}
        ]]>
    </select>
    
    <!-- 감사청구 법률자문 문서발신 처리(1) -->
    <insert id="insertSendDoc" parameterType="paramMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.insertSendDoc */
        INSERT INTO TBCORCOR111M (
            ACP_YR
          , ACP_DVSN_CD
          , ACP_SRNO
          , ACP_STEP_CD
          , DOC_ID
          , SR_DOC_SNO
          , ACP_KND_CD
          , ACP_GRN_NO
          , RPRT_NM
          , RPRT_CD
          , LINK_URL
          , DOC_STA_CD
          , SND_DPT_CD
          , SNDR_ID
          , SND_DH
          , RCPT_DPT_CD
          , RCNT_ID
          , RCPT_DH
          , ACP_RPRT_DVSN_CD
          , DOC_KND_CD
          , REF_ID
          , REF_DY
          , SORT_SNO
          , FRT_USR_ID
          , FNL_USR_ID
          , FNL_DEAL_DPT_CD
          , FNL_MNU_ID
          , FRT_REGI_DH
          , FNL_MDF_DH)
        (SELECT ACP_YR
              , REQ_DVSN_CD
              , CVPT_ACP_NO
              , ACP_STEP_CD
              , DOC_ID
              , (SELECT NVL(MAX(TB.SR_DOC_SNO), 0) + 1
                  FROM TBCORCOR111M TB
                 WHERE 1=1
                   AND TB.ACP_YR      = ACP_YR
                   AND TB.ACP_DVSN_CD = REQ_DVSN_CD
                   AND TB.ACP_SRNO    = CVPT_ACP_NO
                   AND TB.DOC_ID      = DOC_ID)
              , '' AS ACP_KND_CD
              , '' AS ACP_GRN_NO
              , RPRT_NM
              , RPRT_CD
              , LINK_URL
              , '10'
              , #{dptCd}
              , #{usrId}
              , SYSDATE
              , '160100'
              , ''
              , SYSDATE
              , '' AS ACP_RPRT_DVSN_CD
              , DOC_KND_CD
              , REF_ID
              , REF_DY
              , SORT_SNO
              , #{usrId}
              , #{usrId}
              , #{dptCd}
              , #{mnuId}
              , SYSDATE
              , SYSDATE 
           FROM TBCORCOR603M
          WHERE 1=1
            AND ACP_YR       = #{wrkYr}
            AND REQ_DVSN_CD  = #{reqDvsnCd}
            AND CVPT_ACP_NO  = #{wrkNo}
            AND DOC_ID       = #{docId}
            AND RPRT_CD      = #{rprtCd})
    </insert>
    
    <update id="updateReqStatCd" parameterType="paramMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.updateReqStatCd */
        <![CDATA[
        UPDATE TBBADDED126M
           SET REQ_STAT_CD     = '20'
             , REQ_STAT_CHG_DH = SYSDATE
             , LEGAL_REQ_DH    = SYSDATE
             , FNL_USR_ID      = #{usrId}
             , FNL_DEAL_DPT_CD = #{dptCd}
             , FNL_MNU_ID      = #{mnuId}
             , FNL_MDF_DH      = SYSDATE
         WHERE 1=1
           AND WRK_DVSN_CD       = #{wrkDvsnCd}
           AND WRK_YR            = #{wrkYr}
           AND WRK_NO            = #{wrkNo}
           AND AUD_STEP_CD       = #{audStepCd}
           AND LEGAL_REQ_SRNO    = #{legalReqSrno}
           AND LEGAL_REQ_DVSN_CD = #{legalReqDvsnCd}
        ]]>
    </update>
    
    <select id="selectSendMsgInfo" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.selectSendMsgInfo */
        <![CDATA[
        SELECT ACP_YR || '-' || '부감' || '-' || SUBSTRING(CVPT_ACP_NO, 3, 3)
                                                       AS ACP_NO
             , NVL(TIT_NM, ' ')                        AS TIT_NM
             , (SELECT TB.DPT_NM
                  FROM TBDCMACM002M TB
                 WHERE 1=1
                   AND TB.DPT_CD = ACP_DPT_CD)         AS DPT_NM
             , F_CODE_NM('1000828', #{legalReqDvsnCd}) AS LEGAL_REQ_DVSN_NM
             , (SELECT NVL(AGGR_CONCAT(TB.USR_DFN_TXT_2, ''), '000')
                  FROM TBDCMACM013C TB
                 WHERE 1=1
                   AND TB.CMM_CD_DVSN_CD = '1000859'
                   AND TB.USR_DFN_TXT_1  = '3')        AS RCPT_USR_CNB
             , (SELECT COUNT(TB.USR_DFN_TXT_1)
                  FROM TBDCMACM013C TB
                 WHERE 1=1
                   AND TB.CMM_CD_DVSN_CD = '1000859'
                   AND TB.USR_DFN_TXT_1  = '3')        AS RCPT_USR_CNT
          FROM TBCORCOR101M
         WHERE 1=1
           AND ACP_YR       = #{wrkYr}
           AND REQ_DVSN_CD  = #{reqDvsnCd}
           AND CVPT_ACP_NO  = #{wrkNo}
        ]]>
    </select>
    
    <insert id="insertSendTrtmDoc" parameterType="paramMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.insertSendTrtmDoc */
        INSERT INTO TBCORCOR111M (
            ACP_YR
          , ACP_DVSN_CD
          , ACP_SRNO
          , ACP_STEP_CD
          , DOC_ID
          , SR_DOC_SNO
          , ACP_KND_CD
          , ACP_GRN_NO
          , RPRT_NM
          , RPRT_CD
          , LINK_URL
          , DOC_STA_CD
          , SND_DPT_CD
          , SNDR_ID
          , SND_DH
          , RCPT_DPT_CD
          , RCNT_ID
          , RCPT_DH
          , ACP_RPRT_DVSN_CD
          , DOC_KND_CD
          , REF_ID
          , REF_DY
          , SORT_SNO
          , FRT_USR_ID
          , FNL_USR_ID
          , FNL_DEAL_DPT_CD
          , FNL_MNU_ID
          , FRT_REGI_DH
          , FNL_MDF_DH)
        (SELECT ACP_YR
              , ACP_DVSN_CD
              , ACP_SRNO
              , ACP_STEP_CD
              , #{docId}
              , (SELECT NVL(MAX(TB.SR_DOC_SNO), 0)
                   FROM TBCORCOR111M TB
                  WHERE 1=1
                    AND TB.ACP_YR      = ACP_YR
                    AND TB.ACP_DVSN_CD = ACP_DVSN_CD
                    AND TB.ACP_SRNO    = ACP_SRNO
                    AND TB.DOC_ID      = DOC_ID) + ROWNUM
              , ACP_KND_CD
              , ACP_GRN_NO
              , #{rprtNm}
              , DECODE(ACP_DVSN_CD, '5','F40100200'', '') AS RPRT_CD
              , LINK_URL
              , DOC_STA_CD
              , SND_DPT_CD
              , #{usrId}
              , SYSDATE
              , RCPT_DPT_CD
              , RCNT_ID
              , SYSDATE
              , ACP_RPRT_DVSN_CD
              , DOC_KND_CD
              , REF_ID
              , REF_DY
              , SORT_SNO
              , #{usrId}
              , #{usrId}
              , #{dptCd}
              , #{mnuId}
              , SYSDATE
              , SYSDATE 
           FROM TBCORCOR111M
          WHERE 1=1
            AND ACP_YR       = #{wrkYr}
            AND ACP_DVSN_CD  = #{reqDvsnCd}
            AND ACP_SRNO     = #{wrkNo}
            AND REF_ID       = #{legalReqSrno}
            AND RPRT_CD     IN ('F40100100'))
    </insert>
    
    <!-- 감사청구 법률자문 문서발신 처리(2) -->
    <update id="updateSendDoc" parameterType="paramMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.updateSendDoc */
        <![CDATA[
        UPDATE TBCORCOR111M
           SET DOC_STA_CD      = '52'
             , FNL_USR_ID      = #{usrId}
             , FNL_DEAL_DPT_CD = #{dptCd}
             , FNL_MNU_ID      = #{mnuId}
             , FNL_MDF_DH      = SYSDATE
         WHERE 1=1
           AND DOC_ID      = #{docId}
           AND RCPT_DPT_CD = #{rcptDptCd}
           AND ACP_YR      = #{wrkYr}
           AND ACP_SRNO    = #{wrkNo}
           AND REF_ID      = #{legalReqSrno}
        ]]>
    </update>
    
    <update id="updateBlockEdtAuth" parameterType="paramMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.updateBlockEdtAuthBADFRE */
        <![CDATA[
        UPDATE TBCORCOR603M
           SET EDT_AUTH        = NULL
             , FNL_USR_ID      = #{usrId}
             , FNL_DEAL_DPT_CD = #{dptCd}
             , FNL_MNU_ID      = #{mnuId}
             , FNL_MDF_DH      = SYSDATE
         WHERE 1=1
           AND DOC_ID      = #{docId}
           AND ACP_YR      = #{wrkYr}
           AND CVPT_ACP_NO = #{wrkNo}
           AND REF_ID      = #{legalReqSrno}
        ]]>
    </update>
    
    <select id="selectRlaReqInfo" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.rla.dao.AEPRLA022PMapper.selectRlaReqInfo */
        <![CDATA[
        SELECT USR_NAM                 AS USR_NAM
             , F_DPT_INFO(DPT_CD, '1') AS DPT_NM
         FROM TBDCMACM001M
        WHERE 1=1
          AND USR_ID = #{usrId}
        ]]>
    </select>
</mapper>