<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.afu.dao.AEPAFU011PMapper">

    <select id="selectCprInfo" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.afu.dao.AEPAFU011PMapper.selectCprInfo*/
    
        SELECT APV_DOC_NO
             , APV_DVSN_CD
             , CPR_OPIN
             , OPIN_WRT_CNB
          FROM TBDCMACM030L
         WHERE APV_DOC_NO  = #{apvDocNo}
           AND APV_DVSN_CD = #{apvDvsnCd}
    </select>
    
    <update id="updateCpr" parameterType="paramMap">
    /*kr.go.bai.eip.aep.cam.dao.AEPAFU011PMapper.updateCpr*/
            MERGE INTO  TBDCMACM030L T1
                    USING   (   SELECT  '1'
                                FROM    DUAL
                            ) T2
                    ON  (   T1.APV_DOC_NO = #{apvDocNo}
                        AND T1.APV_DVSN_CD = #{apvDvsnCd}
                        )
                WHEN    MATCHED THEN
                    UPDATE
                    SET     
                            FNL_USR_ID = #{usrId}
                           ,FNL_DEAL_DPT_CD = #{dptCd}
                           ,FNL_MNU_ID = #{usrId}
                           ,FNL_MDF_DH = SYSDATE
                           ,CPR_OPIN = #{cprOpin}
                       <if test="cprOpin != null and cprOpin != ''">
                           ,OPIN_WRT_CNB = #{cnb}
                       </if>
                       <if test="cprOpin == null or cprOpin == ''">
                           ,OPIN_WRT_CNB = ''
                       </if>
                WHEN    NOT MATCHED THEN
                    INSERT  (
                              APV_DOC_NO        
                             ,APV_DVSN_CD       
                             ,CPR_OPIN      
                       <if test="cprOpin != null and cprOpin != ''">
                             ,OPIN_WRT_CNB  
                       </if>
                       <if test="cprOpin == null or cprOpin == ''">
                             ,OPIN_WRT_CNB  
                       </if>
                             ,FRT_USR_ID        
                             ,FNL_USR_ID        
                             ,FNL_DEAL_DPT_CD   
                             ,FNL_MNU_ID        
                             ,FRT_REGI_DH       
                             ,FNL_MDF_DH        
                            )
                    VALUES  (
                             #{apvDocNo}
                            ,#{apvDvsnCd}
                            ,#{cprOpin}
                       <if test="cprOpin != null and cprOpin != ''">
                            ,#{cnb}
                       </if> 
                       <if test="cprOpin == null or cprOpin == ''">
                            ,''
                       </if> 
                            ,#{usrId}
                            ,#{usrId}
                            ,#{dptCd}
                            ,#{mnuId}
                            ,SYSDATE
                            ,SYSDATE
                            )
    </update>
</mapper>