<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.fer.dao.AEPFER007QMapper">

    <select id="selectMainList" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.aep.fer.dao.AEPFER007QMapper.selectMainList */
        <![CDATA[
/*처리기간표*/
/* kr.go.bai.eip.aep.fer.dao.AEPFER007QMapper.selectMainList */
/* 2017-08-22 조현민 이클립스 적용      */
/* ENF_DT 컬럼 중복 삭제       		*/
/* 주석 부분 파라미터 받지 않게 수정    */
/* function 제거			*/

         SELECT   ROW_NUMBER() OVER(ORDER BY PD.AUD_YR,PD.AUD_NO) AS ROW_NUM
                ,PD.AUD_YR                                  --감사년도
                ,PD.AUD_NO                                  --감사번호
                ,PD.HIRK_DPT_NM                             --국
                ,PD.AUD_DPT_NM                              --과
                ,PD.AUD_DPT_FULL_NM                         --주관국과명
                ,PD.AUD_SBJ_NM                              --감사사항명
                ,PD.AUD_YR_NO                               --감사번호
                ,SUBSTR(PD.AUD_KND_NM,0,2) AS AUD_KND_NM    --감사종류코드
                ,PD.AUD_DVSN_NM                             --감사종류2
                ,PD.AUD_SCL_CD                              --감사규모코드
                ,TO_CHAR(TO_DATE(PD.REQ_NTAS_DCS_DT),'YY-MM-DD')    AS REQ_NTAS_DCS_DT  --청구국회결정일
                ,TO_CHAR(TO_DATE(PD.AUD_STR_DT00),'YY-MM-DD')       AS AUD_STR_DT00     --자료수집 시작일
                ,TO_CHAR(TO_DATE(PD.AUD_END_DT00),'YY-MM-DD')       AS AUD_END_DT00     --자료수집 종료일
                ,TO_CHAR(TO_DATE(PD.AUD_STR_DT01),'YY-MM-DD')       AS AUD_STR_DT01     --예비조사 시작일
                ,TO_CHAR(TO_DATE(PD.AUD_END_DT01),'YY-MM-DD')       AS AUD_END_DT01     --예비조사 종료일
                ,TO_CHAR(TO_DATE(PD.AUD_STR_DT02_1),'YY-MM-DD')     AS AUD_STR_DT02_1   --실지감사 시작일_1
                ,TO_CHAR(TO_DATE(PD.AUD_END_DT02_1),'YY-MM-DD')     AS AUD_END_DT02_1   --실지감사 종료일_1
                ,TO_CHAR(TO_DATE(PD.AUD_STR_DT02_2),'YY-MM-DD')     AS AUD_STR_DT02_2   --실지감사 시작일_2
                ,TO_CHAR(TO_DATE(PD.AUD_END_DT02_2),'YY-MM-DD')     AS AUD_END_DT02_2   --실지감사 종료일_2
                ,TO_CHAR(TO_DATE(PD.AUD_STR_DT02_3),'YY-MM-DD')     AS AUD_STR_DT02_3   --실지감사 시작일_3
                ,TO_CHAR(TO_DATE(PD.AUD_END_DT02_3),'YY-MM-DD')     AS AUD_END_DT02_3   --실지감사 종료일_3
                ,TO_CHAR(TO_DATE(PD.AUD_STR_DT03),'YY-MM-DD')       AS AUD_STR_DT03     --실지감사연장 시작일
                ,TO_CHAR(TO_DATE(PD.AUD_END_DT03),'YY-MM-DD')       AS AUD_END_DT03     --실지감사연장 종료일
                ,TO_CHAR(TO_DATE(PD.RETURN_DT),'YY-MM-DD')          AS RETURN_DT        --귀청일
                ,TO_CHAR(PD.E_CHA_APV,'YY-MM-DD')                   AS E_CHA_APV        --종료보고 차장결재일
                ,TO_CHAR(PD.E_CHONG_APV,'YY-MM-DD')                 AS E_CHONG_APV      --종료보고 총장결재일
                ,TO_CHAR(PD.E_FNL_APV,'YY-MM-DD')                   AS E_FNL_APV        --종료보고 최종결재일
                ,TO_CHAR(PD.GWA_APV,'YY-MM-DD')                     AS GWA_APV          --과장결재일
                ,TO_CHAR(PD.GUK_APP,'YY-MM-DD')                     AS GUK_APP          --국단실장접수일
                ,TO_CHAR(PD.RCPT_DH,'YY-MM-DD')                     AS RCPT_DH          --수신일시(접수)
                ,TO_CHAR(PD.SND_DH,'YY-MM-DD')                      AS SND_DH           --송신일시(발신)
                ,TO_CHAR(PD.GUK_APV,'YY-MM-DD')                     AS GUK_APV          --국단실장결재일
                ,TO_CHAR(PD.CHA_APP,'YY-MM-DD')                     AS CHA_APP          --사무차장접수일
                ,TO_CHAR(PD.CHA_APV,'YY-MM-DD')                     AS CHA_APV          --사무차장결재일
                ,TO_CHAR(PD.CHONG_APP,'YY-MM-DD')                   AS CHONG_APP        --사무총장접수일
                ,TO_CHAR(PD.CHONG_APV,'YY-MM-DD')                   AS CHONG_APV        --사무총장결재일
                ,TO_CHAR(PD.WI_APP,'YY-MM-DD')                      AS WI_APP           --주심위원접수일
                ,TO_CHAR(PD.WI_APV,'YY-MM-DD')                      AS WI_APV           --주심위원결재일
                ,TO_CHAR(PD.SBCN_DY,'YY-MM-DD')                     AS SBCN_DY          --최초부의일
                ,TO_CHAR(TO_DATE(PD.ENF_DT),'YY-MM-DD')             AS ENF_DT           --최초시행일
                ,(     SELECT
		                  MIN(
		                      CASE
		                      WHEN B.APV_DH IS NULL
		                            THEN
		                            CASE WHEN (SELECT MIN(TO_CHAR(APV_DH, 'YY-MM-DD'))
		                                              FROM TBDCMACM023H ST1
		                                             WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
		                                               AND ST1.APVR_CNB = B.APVR_CNB
		                                               AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') IS NULL
		                                        THEN B.APV_DH
		                                      ELSE (SELECT MIN(TO_CHAR(APV_DH, 'YY-MM-DD'))
		                                              FROM TBDCMACM023H ST1
		                                             WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
		                                               AND ST1.APVR_CNB = B.APVR_CNB
		                                               AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') END
		                           WHEN B.APV_DH IS NOT NULL
		                            THEN CASE WHEN (SELECT MIN(TO_CHAR(APV_DH, 'YY-MM-DD'))
		                                              FROM TBDCMACM023H ST1
		                                             WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
		                                               AND ST1.APVR_CNB = B.APVR_CNB
		                                               AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') IS NULL
		                                        THEN B.APV_DH
		                                      ELSE (SELECT MIN(TO_CHAR(APV_DH, 'YY-MM-DD'))
		                                              FROM TBDCMACM023H ST1
		                                             WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
		                                               AND ST1.APVR_CNB = B.APVR_CNB
		                                               AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') END
		                      END )  AS APV_DH /*결재일시 */
		             FROM TBBADDED103M A,
		                  (
		                  SELECT T1.APV_DOC_NO AS APV_RQS_ID ,
		                         T1.APV_SNO AS APV_SRNO ,
		                         CASE WHEN T1.APVR_PST_CD IS NULL
		                              THEN T1.ONR_PST_NM
		                              ELSE F_CODE_NM('1000176', T1.APVR_PST_CD)
		                         END  AS PST_NM ,
		                         T1.APVR_STA_CD,
		                         DECODE(T1.APVR_STA_CD, '206', (
		                                                     SELECT '(代)' || F_USR_INFO(T2.APVR_CNB, '2')
		                                                       FROM TBDCMACM023L T2
		                                                      WHERE T2.APV_DOC_NO = T1.APV_DOC_NO
		                                                        AND T2.APV_SNO = T1.APV_SNO
		                                                        AND T2.APVR_STA_CD = '203'
		                                                    ), F_USR_INFO(T1.APVR_CNB, '2')) AS APVR_NM ,
		                         CASE WHEN SUBSTR(APVR_STA_CD,0,1) = '2' THEN TO_CHAR(APV_DH, 'YY-MM-DD')
		                                  ELSE ''
		                         END  AS APV_DH,
		                         T1.APVR_CNB
		                    FROM TBDCMACM023L T1
		                   WHERE T1.APV_SNO <> '1'
		                   AND T1.APVR_KND_CD NOT IN ('4','6','7')
		                   UNION ALL
		                  SELECT DH1.APV_RQS_ID,
		                         DH1.APV_SRNO,
		                         (SELECT H2.PST_NM AS PST_NM
		                            FROM TBDCMACM111H H1,
		                                 TBDCMACM112H H2
		                           WHERE 1=1
		                             AND H1.RCPT_DT = H2.RCPT_DT
		                             AND H1.RCPT_ID = H2.RCPT_ID
		                             AND H1.ONR_DOC_MNG_CRD_ID = DH1.APV_RQS_ID
		                             AND H2.APVR_ID = DH1.APVR_ID
		                           GROUP BY H2.PST_NM ) AS PST_NM,
		                         '' as APVR_STA_CD,
		                         DH1.APVR_NM,
		                         DH1.APV_DH,
		                         DH1.APVR_ID AS APVR_CNB
		                    FROM
		                         (SELECT ONR_DOC_MNG_CRD_ID AS APV_RQS_ID,
		                                 APV_HIS_SRNO AS APV_SRNO,
		                                 APVR_ID,
		                                 APVR_NM AS APVR_NM,
		                                 TO_CHAR(APV_DH, 'YY-MM-DD') AS APV_DH
		                            FROM TBDCMACM102L D2
		                           WHERE 1=1
		                             AND ONR_APV_DVSN_CD <> '10' --(기안자 제외)
		                             AND NVL(ONR_APV_RSLT_CD,'hh') <>'50'
		                           ORDER BY APV_RQS_ID,APV_SRNO
		                         ) DH1
		                  ) B
		             WHERE A.AUD_YR = PD.AUD_YR
		              AND A.AUD_NO = PD.AUD_NO
		              AND A.APV_RQS_ID = B.APV_RQS_ID
			          AND A.RPRT_CD IN ('A10800300','A10800600')
	             )                                                           AS ONR_APV_DT /* 온나라 시행문 결재일 - 2021.08.24 yyh */
	             
                ,PD.PROC_DY_CNT                                     AS PROC_DY_CNT      --실제처리일수
                ,PD.SYT_TRTM_DVSN                                   AS SYT_TRTM_DVSN    --처리안구분
                ,PD.EXTN_PRD_COFM_DT                                AS EXTN_PRD_COFM_DT --연장기간승인일
                ,PD.STAN_PROC_DAY                                   AS STAN_PROC_DAY    --기준처리일
                ,TO_CHAR(TO_DATE(PD.STAN_PROC_DT),'YY-MM-DD')       AS STAN_PROC_DT     --기준처리기한
                ,PD.STAN_EXCE_DAY                                   AS STAN_EXCE_DAY    --기준초과일
                ,TO_CHAR(TO_DATE(PD.AUD_DVSN_PROC_DT),'YY-MM-DD')   AS AUD_DVSN_PROC_DT --청구국회처리기한
                ,PD.AUD_DVSN_EXCE_DAY                               AS AUD_DVSN_EXCE_DAY--청구국회초과일수
                /****************************** 출장일수계산 ******************************/
                ,PD.AUD_TOT_DAY                                     AS AUD_TOT_DAY      --감사전체일수      (예비조사시작OR실지감사시작~시행일)
                ,PD.AUD_READY_00                                    AS AUD_READY_00     --감사준비1         (자료수집시작~귀청일)
                ,PD.AUD_PERIO_00                                    AS AUD_PERIO_00     --자료수집_총기간   (자료수집시작~예비조사시작)
                ,PD.AUD_BSRP_00                                     AS AUD_BSRP_00      --자료수집_실시     (자료수집시작~자료수집끝)
                ,PD.AUD_WAIT_00                                     AS AUD_WAIT_00      --자료수집_대기     (총기간-실시)
                ,PD.AUD_READY_11                                    AS AUD_READY_11     --감사준비2         (예비조사시작~귀청일)
                ,PD.AUD_PERIO_11                                    AS AUD_PERIO_11     --예비조사_총기간   (예비조사시작~실지감사시작)
                ,PD.AUD_BSRP_11                                     AS AUD_BSRP_11      --예비조사_실시     (예비조사시작~예비조사끝)
                ,PD.AUD_WAIT_11                                     AS AUD_WAIT_11      --예비조사_대기     (총기간-실시)
                ,PD.AUD_PERIO_22                                    AS AUD_PERIO_22     --실지감사_총기간   (실지감사시작~귀청일)
                ,PD.AUD_BSRP_22_1+PD.AUD_BSRP_22_2+PD.AUD_BSRP_22_3 AS AUD_BSRP_SUM_22  --실지감사_합계     (실지감사_합계(실지감사_실시+실지감사_연장)
                ,PD.AUD_BSRP_22_1                                   AS AUD_BSRP_22_1    --실지감사_실시1     (실지감사시작~실지감사끝)
                ,PD.AUD_BSRP_22_2                                   AS AUD_BSRP_22_2    --실지감사_실시2     (실지감사시작~실지감사끝)
                ,PD.AUD_BSRP_22_3                                   AS AUD_BSRP_22_3    --실지감사_실시3     (실지감사시작~실지감사끝)
                ,PD.AUD_BSRP_33                                     AS AUD_BSRP_33      --실지감사_연장     (실지연장시작~실지연장끝)
                ,PD.AUD_PERIO_22-(PD.AUD_BSRP_22_1+PD.AUD_BSRP_22_2+PD.AUD_BSRP_22_3)                     AS AUD_WAIT_22      --실지감사_대기     (실지감사_총기간-실지감사_합계)

                 /****************************** 보고서일수계산 ******************************/
                ,PD.GWA_END_RPT_NDAY+PD.GWA_APV_NDAY+((NVL(TRUNC((TO_DATE(TO_CHAR(PD.ENF_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(PD.RETURN_DT , 'YYYYMMDD'))) +1,0),0))-(PD.GWA_END_RPT_NDAY+PD.GWA_APV_NDAY+PD.GUK_APV_NDAY+PD.CHA_APV_NDAY+PD.CHONG_APV_NDAY+PD.WI_APV_NDAY+PD.WI_SBCN_NDAY+PD.ENF_NDAY))+PD.GUK_APV_NDAY+PD.CHA_APV_NDAY+PD.CHONG_APV_NDAY+PD.WI_APV_NDAY+PD.WI_SBCN_NDAY+PD.ENF_NDAY AS PROC_TOT_NDAY --처리전체기간 (처리_결재기간+처리_부의기간)
                ,PD.GWA_END_RPT_NDAY+PD.GWA_APV_NDAY+((NVL(TRUNC((TO_DATE(TO_CHAR(PD.ENF_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(PD.RETURN_DT , 'YYYYMMDD'))) +1,0),0))-(PD.GWA_END_RPT_NDAY+PD.GWA_APV_NDAY+PD.GUK_APV_NDAY+PD.CHA_APV_NDAY+PD.CHONG_APV_NDAY+PD.WI_APV_NDAY+PD.WI_SBCN_NDAY+PD.ENF_NDAY))+PD.GUK_APV_NDAY+PD.CHA_APV_NDAY+PD.CHONG_APV_NDAY AS PROC_APVR_NDAY--처리_결재기간(과장_합계기간+국장_결재기간+총차장_합계기간)
                ,PD.GWA_END_RPT_NDAY+PD.GWA_APV_NDAY+((NVL(TRUNC((TO_DATE(TO_CHAR(PD.ENF_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(PD.RETURN_DT , 'YYYYMMDD'))) +1,0),0))-(PD.GWA_END_RPT_NDAY+PD.GWA_APV_NDAY+PD.GUK_APV_NDAY+PD.CHA_APV_NDAY+PD.CHONG_APV_NDAY+PD.WI_APV_NDAY+PD.WI_SBCN_NDAY+PD.ENF_NDAY)) AS GWA_APVR_SUM_NDAY  --과장_합계기간(과장_종료보고기간+과장_결재기간+과장_접수대기기간)
                ,PD.GWA_END_RPT_NDAY    --과장_종료보고기간(귀청일~종료보고최종결재)
                ,PD.GWA_APV_NDAY        --과장_결재기간(종료보고최종결재~과장결재)
                ,(NVL(TRUNC((TO_DATE(TO_CHAR(PD.ENF_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(PD.RETURN_DT , 'YYYYMMDD'))) +1,0),0))-(PD.GWA_END_RPT_NDAY+PD.GWA_APV_NDAY+PD.GUK_APV_NDAY+PD.CHA_APV_NDAY+PD.CHONG_APV_NDAY+PD.WI_APV_NDAY+PD.WI_SBCN_NDAY+PD.ENF_NDAY) AS GWA_APP_WAIT_NDAY--과장_접수대기기간(귀청일~시행일)-(과장_종료보고기간+과장_결재기간+국장_결재기간+총차장_합계기간+처리_부의기간)
                ,PD.GUK_APV_NDAY        --국장_결재기간(국장접수~국장종결)
                ,PD.PUM_APV_NDAY        --품질_결재기간(품질접수~품질종결)
                ,PD.CHA_APV_NDAY+PD.CHONG_APV_NDAY AS CHONG_CHA_APV_SUM_NDAY    --총차장_합계기간(차장_결재기간+총장_결재기간)
                ,PD.CHA_APV_NDAY        --차장_결재기간(차장접수~차장종결)
                ,PD.CHONG_APV_NDAY      --총장_결재기간(총장접수~총장종결)
                ,PD.WI_APV_NDAY+PD.WI_SBCN_NDAY+PD.ENF_NDAY AS PROC_SBCN_NDAY   --처리_부의기간(위원_결재기간+위원_회의기간+시행기간)
                ,PD.WI_APV_NDAY+PD.WI_SBCN_NDAY AS WI_APV_SUM_NDAY              --위원_합계(위원_결재기간+위원_회의기간)
                ,PD.WI_APV_NDAY         --위원_결재기간(위원접수~위원종결)
                ,PD.WI_SBCN_NDAY        --위원_회의기간(위원종결~위원회의)
                ,PD.ENF_NDAY            --시행기간(위원회의~시행일)
                ,PD.REMARK              --특이사항
                ,PD.IN_CHARGE_NM        --담당조정관
                ,DECODE(PD.PROC_DY_CNT,PD.GWA_END_RPT_NDAY+PD.GWA_APV_NDAY+((NVL(TRUNC((TO_DATE(TO_CHAR(PD.ENF_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(PD.RETURN_DT , 'YYYYMMDD'))) +1,0),0))-(PD.GWA_END_RPT_NDAY+PD.GWA_APV_NDAY+PD.GUK_APV_NDAY+PD.CHA_APV_NDAY+PD.CHONG_APV_NDAY+PD.WI_APV_NDAY+PD.WI_SBCN_NDAY+PD.ENF_NDAY))+PD.GUK_APV_NDAY+PD.CHA_APV_NDAY+PD.CHONG_APV_NDAY+PD.WI_APV_NDAY+PD.WI_SBCN_NDAY+PD.ENF_NDAY,'OK','NG') AS PROC_NDAY_VERI    --처리일수검증(실제처리일수=처리전체기간)
                ,END_RPT_PROC_CNT-HLDY_CNT AS END_RPT_PROC_NDAY     --실지감사종료보고소요기간
          FROM (
                WITH BASIS_INFO AS (/* 기본정보AA : BASIS_INFO */
                                    SELECT A1.AUD_YR         --감사년도
                                          ,A1.AUD_NO         --감사번호
                                          ,A1.AUD_KND_CD     --감사종류코드(1:재무,2:특정,3:성과,4:기관,5:확인,9:서면)
                                          ,A1.SPV_BRDV_CD    --주관국과코드
                                          ,NVL((SELECT T4.ABR_DPT_NM_1
												 FROM TBDCMACM002M T4
												WHERE T4.DPT_CD = (SELECT A2.HIRK_DPT_CD
														              FROM TBDCMACM002M A2
														             WHERE A2.DPT_CD =  A1.SPV_BRDV_CD)
												   AND T4.USE_YN = 'Y'
												   AND ROWNUM = 1)
											 	,((SELECT T4.ABR_DPT_NM_1
													 FROM TBDCMACM002M T4
													WHERE T4.DPT_CD = A1.SPV_BRDV_CD
													   AND T4.USE_YN = 'Y'
													   AND ROWNUM = 1))) AS HIRK_DPT_NM    /* 국 */
                                          ,(SELECT A2.DPT_NM
                                              FROM TBDCMACM002M A2
                                             WHERE A2.DPT_CD = A1.SPV_BRDV_CD) AS AUD_DPT_FULL_NM    --주관국과명 
                                          ,(SELECT T4.ABR_DPT_NM_1
												 FROM TBDCMACM002M T4
												WHERE T4.DPT_CD = A1.SPV_BRDV_CD
												   AND T4.USE_YN = 'Y'
												   AND ROWNUM = 1 ) AS AUD_DPT_NM    /* 과 */
                                          ,A1.AUD_SBJ_NM    --감사사항명
                                          ,F_MNG_KND_AUDYRNO(A1.AUD_YR, A1.AUD_NO, A1.AUD_KND_CD, '-') AS AUD_YR_NO --감사번호
										  ,F_CODE_NM('1000739', A1.AUD_KND_CD) AS AUD_KND_NM     --감사종류코드
                                          ,(SELECT T1.CD_NM
											 FROM TBDCMACM013C T1
											WHERE T1.CMM_CD_DVSN_CD = '1000027'
											  AND T1.CD = A1.AUD_SCL_CD
											  AND ROWNUM = 1) AS AUD_SCL_CD     --감사규모코드
--                                          ,(SELECT MIN(TO_DATE(A3.ENF_DT))
--                                              FROM TBBADEAR001M A7
--                                                  ,TBBADEAR002D A3
--                                             WHERE A7.AUD_YR      = A3.AUD_YR
--                                               AND A7.AUD_NO      = A3.AUD_NO
--                                               AND A7.DSP_RQ_SNO  = A3.DSP_RQ_SNO
--                                               AND A7.AUD_YR      = A1.AUD_YR
--                                               AND A7.AUD_NO      = A1.AUD_NO
--                                               AND A7.DSP_RQ_KND_CD NOT IN ('390','391','395','396','490','495','730')
--                                           ) AS ENF_DT   --최초시행일
                                          ,(SELECT A6.DVSN_CD FROM TBBADDED030L A6
                                             WHERE A6.AUD_YR = A1.AUD_YR
                                               AND A6.AUD_NO = A1.AUD_NO
                                               AND A6.SRNO = 1) AS AUD_KND_CD2  --종류코드2(1:민원2:국민3:공익4:국회5:심사6:재심8:손망9:판청)
--                                          ,(SELECT MIN(TO_DATE(A4.SBCN_DY))
--                                              FROM TBBADDED113M A4
--                                             WHERE A4.AUD_YR = A1.AUD_YR
--                                               AND A4.AUD_NO = A1.AUD_NO
--                                             GROUP BY A4.AUD_YR,A4.AUD_NO) AS SBCN_DY   --최초부의일
                                          ,A5.EXTN_PRD_COFM_DT  --연장기간승인일
                                          /****************************** 청구국회결정일,기준처리일 가져와야함 ******************************/
                                          ,TO_DATE(A5.REQ_NTAS_DCS_DT) AS REQ_NTAS_DCS_DT   --청구국회결정일
                                          ,STAD_HNDL_DCN AS STAN_PROC_DAY                   --기준처리일
        --                                  ,DECODE(SUBSTR(A1.AUD_KND_CD,3,1),1,26,
        --                                   DECODE(SUBSTR(A1.AUD_KND_CD,3,1),2,50,
        --                                   DECODE(SUBSTR(A1.AUD_KND_CD,3,1),3,75,
        --                                   DECODE(SUBSTR(A1.AUD_KND_CD,3,1),4,33,
        --                                   DECODE(SUBSTR(A1.AUD_KND_CD,3,1),9,33,''))))) AS STAN_PROC_DAY   --기준처리일(1:재무(26),2:특정(50),3:성과(75),4:기관(33),9:서면(33))
                                          /****************************** 청구국회결정일,기준처리일 가져와야함 ******************************/
                                          , GNR_HNDL_PLAN_YN											-- (2019.04.05 LSR 추가)
                                          , HNDL_DDLN_DT												-- (2019.04.05 LSR 추가)
                                          , EXTN_HNDL_DDLN_DT											-- (2019.04.05 LSR 추가)
                                          , RTN_DT														-- (2019.04.05 LSR 추가)
                                          , ENF_APV_DT													-- (2019.04.05 LSR 추가)
                                          , NVL(F_GNR_HNDL_PLAN_EXTN_DCN(A1.AUD_YR, A1.AUD_NO), 0) AS GNR_HNDL_PLAN_EXTN_DCN			-- (2019.04.05 LSR 추가)
                                          , NVL(CASE WHEN NVL(A5.EXTN_PRD_COFM_DT, 0) > 0 OR NVL(A5.GNR_HNDL_PLAN_YN, 'N') = 'Y'
			                         			THEN F_EXTN_HNDL_DT_CNT(A5.AUD_YR, A5.AUD_NO, TO_CHAR(TO_DATE(A5.RTN_DT)-1, 'YYYYMMDD'), NVL(A5.ENF_APV_DT, TO_CHAR(SYSDATE, 'YYYYMMDD')), '5', '9', 'T')
			                         			ELSE F_HNDL_DT_CNT(A5.AUD_YR, A5.AUD_NO, TO_CHAR(TO_DATE(A5.RTN_DT)-1, 'YYYYMMDD'), NVL(A5.ENF_APV_DT, TO_CHAR(SYSDATE, 'YYYYMMDD')), '2', '9')
			                         		END, 0) AS REAL_HNDL_DT										-- (2019.04.18 LSR 추가)
                                      FROM TBBADDED001M A1
                                          ,TBBADDED003M A5
                                     WHERE A1.AUD_YR = A5.AUD_YR(+)
                                       AND A1.AUD_NO = A5.AUD_NO(+)
                                       AND A1.AUD_YR = #{srcAudYr}   --PARAM
                                       AND SUBSTR(A1.AUD_KND_CD,3,1) <> '5' --확인출장제외
--                                       AND (SELECT MIN(TO_DATE(A3.ENF_DT)) FROM TBBADEAR002D A3
--                                             WHERE A3.AUD_YR = A1.AUD_YR
--                                               AND A3.AUD_NO = A1.AUD_NO) IS NOT NULL
                                    ),
                     BSRP_INFO AS (/* 출장정보BB : BSRP_INFO */
                                   SELECT B2.REL_AUD_YR          AS AUD_YR
                                         ,B2.REL_AUD_NO          AS AUD_NO
                                         ,MIN(CASE WHEN B2.AUD_STR_DT00 > B2.AUD_STR_DT000 THEN B2.AUD_STR_DT000
                                                   WHEN B2.AUD_STR_DT00 IS NULL THEN B2.AUD_STR_DT000
                                                   ELSE B2.AUD_STR_DT00 END)   AS AUD_STR_DT00    --자료수집 시작일
                                         ,MAX(CASE WHEN B2.AUD_END_DT00 > B2.AUD_END_DT000 THEN B2.AUD_END_DT000
                                                   WHEN B2.AUD_END_DT00 IS NULL THEN B2.AUD_END_DT000
                                                   ELSE B2.AUD_END_DT00 END)   AS AUD_END_DT00    --자료수집 종료일
                                         ,MIN(B2.AUD_STR_DT01)   AS AUD_STR_DT01    --예비조사 시작일
                                         ,MAX(B2.AUD_END_DT01)   AS AUD_END_DT01    --예비조사 종료일
                                         ,MIN(B2.AUD_STR_DT02_1) AS AUD_STR_DT02_1  --실지감사 시작일1
                                         ,MAX(B2.AUD_END_DT02_1) AS AUD_END_DT02_1  --실지감사 종료일1
                                         ,MIN(B2.AUD_STR_DT02_2) AS AUD_STR_DT02_2  --실지감사 시작일2
                                         ,MAX(B2.AUD_END_DT02_2) AS AUD_END_DT02_2  --실지감사 종료일2
                                         ,MIN(B2.AUD_STR_DT02_3) AS AUD_STR_DT02_3  --실지감사 시작일3
                                         ,MAX(B2.AUD_END_DT02_3) AS AUD_END_DT02_3  --실지감사 종료일3
                                         ,MIN(B2.AUD_STR_DT03)   AS AUD_STR_DT03    --실지감사연장 시작일
                                         ,MAX(B2.AUD_END_DT03)   AS AUD_END_DT03    --실지감사연장 종료일
--                                         ,CASE WHEN MAX(B2.AUD_END_DT03)   IS NOT NULL THEN MAX(B2.AUD_END_DT03)+1
--                                               WHEN MAX(B2.AUD_END_DT02_3) IS NOT NULL THEN MAX(B2.AUD_END_DT02_3)+1
--                                               WHEN MAX(B2.AUD_END_DT02_2) IS NOT NULL THEN MAX(B2.AUD_END_DT02_2)+1
--                                               WHEN MAX(B2.AUD_END_DT02_1) IS NOT NULL THEN MAX(B2.AUD_END_DT02_1)+1
--                                               ELSE NULL
--                                                END AS RETURN_DT
						                ,CASE WHEN MAX(B2.AUD_BZT_KND_CD) = '00' THEN TO_DATE('30000101')
						                     ELSE  MAX(B2.AUD_END_DT)+1
						                END AS RETURN_DT	-- 귀청일 수정 (2019.04.05 LSR)
                                     FROM (SELECT Z.REL_AUD_YR
                                                 ,Z.REL_AUD_NO
                                                 ,Z.AUD_BZT_KND_CD
                                                 ,Z.R_RANK
                                                 ,Z.AUD_STR_DT00
                                                 , (SELECT MIN(TO_DATE(B.AUD_STR_DT)) 
                                                                         FROM TBBADDED101L A
                                                                              INNER JOIN TBBADDED002M B
                                                                                      ON A.REL_AUD_YR = B.REL_AUD_YR
                                                                                     AND A.REL_AUD_NO = B.REL_AUD_NO
                                                                          WHERE A.AUD_YR = Z.REL_AUD_YR
                                                                            AND A.AUD_NO = Z.REL_AUD_NO ) AS AUD_STR_DT000
                                                 ,Z.AUD_END_DT00
                                                 , (SELECT MIN(TO_DATE(B.AUD_END_DT))
                                                                         FROM TBBADDED101L A
                                                                              INNER JOIN TBBADDED002M B
                                                                                      ON A.REL_AUD_YR = B.REL_AUD_YR
                                                                                     AND A.REL_AUD_NO = B.REL_AUD_NO
                                                                          WHERE A.AUD_YR = Z.REL_AUD_YR
                                                                            AND A.AUD_NO = Z.REL_AUD_NO ) AS AUD_END_DT000
                                                 ,Z.AUD_STR_DT01
                                                 ,Z.AUD_END_DT01
                                                 ,DECODE(Z.R_RANK,1,Z.AUD_STR_DT02_1,NULL) AS AUD_STR_DT02_1
                                                 ,DECODE(Z.R_RANK,1,Z.AUD_END_DT02_1,NULL) AS AUD_END_DT02_1
                                                 ,DECODE(Z.R_RANK,2,Z.AUD_STR_DT02_2,NULL) AS AUD_STR_DT02_2
                                                 ,DECODE(Z.R_RANK,2,Z.AUD_END_DT02_2,NULL) AS AUD_END_DT02_2
                                                 ,DECODE(Z.R_RANK,3,Z.AUD_STR_DT02_3,NULL) AS AUD_STR_DT02_3
                                                 ,DECODE(Z.R_RANK,3,Z.AUD_END_DT02_3,NULL) AS AUD_END_DT02_3
                                                 ,Z.AUD_STR_DT03
                                                 ,Z.AUD_END_DT03
                                                 ,Z.AUD_END_DT -- 2019.04.05 LSR 추가
                                             FROM (
                                                   SELECT B1.REL_AUD_YR
                                                         ,B1.REL_AUD_NO
                                                         ,B1.AUD_BZT_KND_CD
                                                         ,RANK() OVER(PARTITION BY B1.REL_AUD_YR,B1.REL_AUD_NO,B1.AUD_BZT_KND_CD ORDER BY B1.REL_AUD_YR,B1.REL_AUD_NO,B1.BZT_SNO,B1.AUD_BZT_KND_CD ) AS R_RANK
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'00',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT00
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'00',TO_DATE(AUD_END_DT)) AS AUD_END_DT00
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'01',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT01
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'01',TO_DATE(AUD_END_DT)) AS AUD_END_DT01
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT02_1
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_END_DT)) AS AUD_END_DT02_1
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT02_2
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_END_DT)) AS AUD_END_DT02_2
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT02_3
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_END_DT)) AS AUD_END_DT02_3
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'03',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT03
                                                         ,DECODE(B1.AUD_BZT_KND_CD,'03',TO_DATE(AUD_END_DT)) AS AUD_END_DT03
                                                         ,TO_DATE(AUD_END_DT) AS AUD_END_DT -- 2019.04.05 LSR 추가
                                                     FROM TBBADDED002M B1
                                                    WHERE 1=1
                                                      AND B1.REL_AUD_YR = #{srcAudYr} --PARAM
                                                      AND B1.AUD_BZT_KND_CD IN ('00','01','02','03')
                                                    ORDER BY B1.REL_AUD_YR,B1.REL_AUD_NO,B1.BZT_SNO,B1.AUD_BZT_KND_CD
                                                  ) Z
                                          ) B2
                                    GROUP BY B2.REL_AUD_YR,B2.REL_AUD_NO
                                  ),
                     END_APV_INFO AS (/* 종료보고 결재정보CC : END_APV_INFO */
                                      SELECT C1.AUD_YR
                                            ,C1.AUD_NO
                                            --,C2.APV_SNO        --결재순번
                                            --,C1.RPRT_CD        --보고서코드
                                            --,C2.APVR_PST_CD    --결재자직위코드
                                            --,F_CODE_NM('1000176', C2.APVR_PST_CD) AS PST_NM                --결재자직위명
                                            --,C2.APVR_CNB       --결재자전산번호
                                            --,F_USR_INFO(C2.APVR_CNB, '2') AS APVR_NM                       --결재자명
                                            --,TO_CHAR(C2.APV_DH, 'YYYY-MM-DD') AS APV_DH                    --결재일
                                           ,MIN(DECODE(C2.APVR_PST_CD,'0013600',C2.APV_DH
                                                ,DECODE(C2.APVR_PST_CD,'0057400',C2.APV_DH,''))) AS E_GWA_APV --과장결재일
                                            ,MIN(DECODE(C2.APVR_PST_CD,'0015800',C2.APV_DH
                                                ,DECODE(C2.APVR_PST_CD,'0035100',C2.APV_DH
                                                ,DECODE(C2.APVR_PST_CD,'0058100',C2.APV_DH,'')))) AS E_GUK_APV --국장결재일(국장:0015800,단장:0035100,실장:0058100)
                                            ,MIN(DECODE(C2.APVR_PST_CD,'0055600',C2.APV_DH
                                                ,DECODE(C2.APVR_PST_CD,'0045900',C2.APV_DH,''))) AS E_CHA_APV   --차장결재일   /* 0045900 : 본부장 추가 */
                                            ,MIN(DECODE(C2.APVR_PST_CD,'0055700',C2.APV_DH,''))  AS E_CHONG_APV --총장결재일
                                            ,MIN(DECODE(C2.APVR_PST_CD,'0067400',C2.APV_DH,''))  AS E_WON_APV   --원장결재일
                                            ,MAX(DECODE(C1.APV_STA_CD,'30',C2.APV_DH,''))        AS E_FNL_APV   --최종결재일
                                        FROM TBBADDED103M C1
                                            ,TBDCMACM023H C2
                                       WHERE 1=1
                                         AND C1.APV_RQS_ID  = C2.APV_DOC_NO
                                         AND C2.APVR_STA_CD <> '401'
                                         AND C1.AUD_YR      = #{srcAudYr} --PARAM
                                         AND C1.RPRT_CD     = 'A10500200' --종료보고서
                                       --ORDER BY C2.APV_SNO
                                       GROUP BY C1.AUD_YR,C1.AUD_NO
                                      ),
                     AUD_RPRT_APV_INFO AS (/* 감사보고서(위원) 결재정보DD : AUD_RPRT_APV_INFO */
                                           SELECT D3.AUD_YR
                                                 ,D3.AUD_NO
                                                 ,MIN(D3.GWA_APV)          AS GWA_APV
                                                 ,MIN(D3.GUK_APP)          AS GUK_APP
                                                 ,MIN(D3.GUK_APV)          AS GUK_APV
                                                 ,MIN(D3.CHA_APP)          AS CHA_APP
                                                 ,MIN(D3.CHA_APV)          AS CHA_APV
                                                 ,MIN(D3.CHONG_APP)        AS CHONG_APP
                                                 ,MIN(D3.CHONG_APV)        AS CHONG_APV
                                                 ,MAX(D3.FNL_APV)          AS FNL_APV
                                                 ,MIN(D3.WI_APP)           AS WI_APP
                                                 ,MIN(D3.WI_APV)           AS WI_APV
                                                 ,MAX(D3.SYT_TRTM_DVSN_YN) AS SYT_TRTM_DVSN_YN
                                             FROM (
                                                   SELECT D1.AUD_YR
                                                         ,D1.AUD_NO
                                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0013600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                                 WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0057400' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                               ELSE NULL
                                                                END AS GWA_APV   --과장결재일
                                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D2.SEQ)
                                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D2.SEQ)
                                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D2.SEQ)
                                                               ELSE NULL
                                                                END AS GUK_APP   --국단실장접수일
                                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                               ELSE NULL
                                                                END AS GUK_APV   --국단실장결재일
                                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D2.SEQ)
                                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D2.SEQ)
                                                               ELSE NULL
                                                                END AS CHA_APP   --차장,본부장 접수일
                                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                               ELSE NULL
                                                                END AS CHA_APV   --차장,본부장 결재일
                                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D2.SEQ)
                                                               ELSE NULL
                                                                END AS CHONG_APP --사무총장접수일
                                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                               ELSE NULL
                                                                END AS CHONG_APV --사무총장결재일
                                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D1.APV_STA_CD = '30' THEN D2.APV_DH
                                                               ELSE NULL
                                                                END AS FNL_APV   --최종결재일
                                                         ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D2.SEQ,D2.APV_DH DESC)
                                                               ELSE NULL
                                                                END AS WI_APP    --주심위원접수일
                                                         ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                               ELSE NULL
                                                                END AS WI_APV    --주심위원결재일
                                                         ,D1.SYT_TRTM_DVSN_YN
                                                     FROM TBBADDED103M D1
                                                         ,TBDCMACM023H D2
                                                    WHERE D1.APV_RQS_ID = D2.APV_DOC_NO
                                                      AND D1.AUD_YR     = #{srcAudYr} --PARAM
                                                      AND D1.RPRT_CD    IN ('A10600200','A10700100') --감사보고서,주심위원설명자료
                                                      AND D1.AUD_RPRT_DVSN_CD = '10'   --(10:본안,20:우선,30:별도,40:재부의)
                                                      AND D2.APVR_KND_CD IN ('2','3','9')   --공석추가
                                                    ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D2.SEQ/*D2.APV_SNO,D2.APVR_SEQ*/
                                                   ) D3
                                            GROUP BY D3.AUD_YR,D3.AUD_NO
                                           ),
                     AUD_RPRT_SR_INFO AS (/* 감사보고서 품질접수발신일EE : AUD_RPRT_SR_INFO */
                                          SELECT E1.AUD_YR
                                                ,E1.AUD_NO
                                                ,MAX(DECODE(E1.RPRT_CD,'A10600200',E1.RCPT_DH)) AS RCPT_DH
                                                ,MAX(DECODE(E3.APV_STA_CD,'30',(SELECT MAX(E4.APV_DH)
                                                                                  FROM TBDCMACM023H E4
                                                                                 WHERE E4.APV_DOC_NO = E3.APV_RQS_ID
                                                                                   AND E4.APVR_STA_CD <> '201'
                                                                                   AND E4.APVR_STA_CD LIKE '20%'
                                                                               ),NULL)) AS SND_DH
                                            FROM TBBADDED111M E1
                                                ,TBBADDED145M E2
                                                ,TBBADDED103M E3
                                           WHERE 1=1
                                             AND E1.AUD_YR  = E2.AUD_YR
                                             AND E1.AUD_NO  = E2.AUD_NO
                                             AND E1.DOC_ID  = E2.DOC_ID
                                             AND E1.AUD_YR  = E3.AUD_YR
                                             AND E1.AUD_NO  = E3.AUD_NO
                                             AND E2.AFF_SNO = E3.REF_ID
                                             AND E1.AUD_YR           = #{srcAudYr} --PARAM
                                             AND E1.AUD_RPRT_DVSN_CD = '10'        --감사보고서구분코드(10:본안,20:우선,30:별도,40:재부의)
                                             AND E1.RPRT_CD          = 'A10600200' --감사보고서
                                             AND E2.APVR_CD          = '0013600'   --과장사건
                                             AND E3.RPRT_CD          = 'A10600500' --처리안검토의견서
                                           GROUP BY E1.AUD_YR,E1.AUD_NO
                                         ),
                         AFF_CNT_INFO AS (/* 사건정보FF : AFF_CNT_INFO */
                                          SELECT A.AUD_YR
                                                ,A.AUD_NO
                                                ,A.DOC_ID
                                                ,SUM(CASE WHEN A.FNL_YN = 'Y' AND A.REFER_DVSN_CD = 'D10' THEN 1 ELSE 0 END) AS REFER_DVSN_D10
                                                ,SUM(CASE WHEN A.FNL_YN = 'Y' AND A.REFER_DVSN_CD = 'E10' THEN 1 ELSE 0 END) AS REFER_DVSN_E10
                                                ,MIN(TO_DATE(C.SBCN_DY)) AS SBCN_DY
                                                ,MIN(TO_DATE(E.ENF_DT))  AS ENF_DT
                                            FROM TBBADDED145M A
                                                ,TBBADDED146M B
                                                ,TBBADDED113M C
                                                ,(SELECT A7.AUD_YR
                                                        ,A7.AUD_NO
                                                        ,'A1070' AS APVR_CD
                                                        ,A7.AUD_DSP_RQ_SNO
                                                        ,A3.ENF_DT
                                                    FROM TBBADEAR001M A7
                                                        ,TBBADEAR002D A3
                                                   WHERE A7.AUD_YR      = A3.AUD_YR
                                                     AND A7.AUD_NO      = A3.AUD_NO
                                                     AND A7.DSP_RQ_SNO  = A3.DSP_RQ_SNO
                                                 ) E
                                           WHERE 1=1
                                             AND A.AUD_YR      = B.AUD_YR
                                             AND A.AUD_NO      = B.AUD_NO
                                             AND A.AUD_STEP_CD = B.AUD_STEP_CD
                                             AND A.DOC_ID      = B.DOC_ID
                                             AND A.APVR_CD     = B.APVR_CD
                                             AND A.AFF_SNO     = B.AFF_SNO
                                             AND B.DSP_RQ_CD NOT IN ('390','391','395','396','490','495','730')
                                             AND B.AUD_YR      = C.AUD_YR(+)
                                             AND B.AUD_NO      = C.AUD_NO(+)
                                             AND B.DOC_ID      = C.DOC_ID(+)
                                             AND B.APVR_CD     = C.APVR_CD(+)
                                             AND B.AFF_SNO     = C.AFF_SNO(+)
                                             AND B.DSP_RQ_SNO  = C.DSP_RQ_SNO(+)
                                             AND B.AUD_YR      = E.AUD_YR(+)
                                             AND B.AUD_NO      = E.AUD_NO(+)
                                             AND B.APVR_CD     = E.APVR_CD(+)
                                             AND B.DSP_RQ_SNO  = E.AUD_DSP_RQ_SNO(+)
                                             AND A.AUD_YR = #{srcAudYr} --PARAM
                                             AND (SELECT Z.AUD_RPRT_DVSN_CD FROM TBBADDED103M Z WHERE A.AUD_NO = Z.AUD_NO AND A.AUD_YR = Z.AUD_YR AND  Z.DOC_ID = A.DOC_ID) = '10'
                                           GROUP BY A.AUD_YR,A.AUD_NO,A.DOC_ID
                                           ORDER BY A.AUD_YR,A.AUD_NO,A.DOC_ID
                                         )

                   SELECT AA.AUD_YR             --감사년도
                         ,AA.AUD_NO             --감사번호
                         ,AA.HIRK_DPT_NM        --국
                         ,AA.AUD_DPT_NM         --주관국과명
                         ,AA.AUD_DPT_FULL_NM    --주관국과명
                         ,AA.AUD_SBJ_NM         --감사사항명
                         ,AA.AUD_YR_NO          --감사번호
                         ,AA.AUD_KND_NM         --감사종류코드
                         ,(SELECT T1.CD_NM
							 FROM TBDCMACM013C T1
							WHERE T1.CMM_CD_DVSN_CD = '1000742'
							  AND T1.CD = AA.AUD_KND_CD2
							  AND ROWNUM = 1) AS AUD_DVSN_NM
                         ,AA.AUD_SCL_CD         --감사규모코드
                         ,FF.ENF_DT             --최초시행일
                         ,AA.REQ_NTAS_DCS_DT    --청구국회결정일
                         ,BB.AUD_STR_DT00       --자료수집 시작일
                         ,BB.AUD_END_DT00       --자료수집 종료일
                         ,BB.AUD_STR_DT01       --예비조사 시작일
                         ,BB.AUD_END_DT01       --예비조사 종료일
                         ,BB.AUD_STR_DT02_1     --실지감사 시작일_1
                         ,BB.AUD_END_DT02_1     --실지감사 종료일_1
                         ,BB.AUD_STR_DT02_2     --실지감사 시작일_2
                         ,BB.AUD_END_DT02_2     --실지감사 종료일_2
                         ,BB.AUD_STR_DT02_3     --실지감사 시작일_3
                         ,BB.AUD_END_DT02_3     --실지감사 종료일_3
                         ,BB.AUD_STR_DT03       --실지감사연장 시작일
                         ,BB.AUD_END_DT03       --실지감사연장 종료일
                         ,BB.RETURN_DT          --귀청일
                         ,CC.E_CHA_APV          --종료보고 차장결재일
                         ,CC.E_CHONG_APV        --종료보고 총장결재일
                         ,CC.E_FNL_APV          --종료보고 최종결재일
                         ,DD.GWA_APV            --과장결재일
                         ,EE.RCPT_DH            --수신일시(접수)
                         ,EE.SND_DH             --송신일시(발신)
                         ,DD.GUK_APP          --국단실장접수일(품질부서의 요청으로 변경됨)
                         --,DD.GWA_APV AS GUK_APP --국단실장접수일 = 품질접수일(처리안검토의견서가 없어지면서 과장결재일-국장접수일
                         ,DD.GUK_APV            --국단실장결재일
                         ,DD.CHA_APP            --사무차장접수일
                         ,DD.CHA_APV            --사무차장결재일
                         ,DD.CHONG_APP          --사무총장접수일
                         ,DD.CHONG_APV          --사무총장결재일
                         ,DD.WI_APP             --주심위원접수일
                         ,DD.WI_APV             --주심위원결재일
                         ,FF.SBCN_DY            --최초부의일
--                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(FF.ENF_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.RETURN_DT , 'YYYYMMDD'))) +1,0),0)) AS PROC_DY_CNT      --실제처리일수
			      		 , AA.REAL_HNDL_DT AS PROC_DY_CNT			--실제처리일수 (2019.04.05 LSR 수정)
--                         ,DECODE(DD.SYT_TRTM_DVSN_YN,'Y','종합','')     AS SYT_TRTM_DVSN    --처리안구분
                         ,DECODE(AA.GNR_HNDL_PLAN_YN,'Y','종합','')     AS SYT_TRTM_DVSN    --처리안구분 (2019.04.05 LSR 수정)
                         ,AA.EXTN_PRD_COFM_DT                           AS EXTN_PRD_COFM_DT --연장기간승인일
--                         ,AA.STAN_PROC_DAY+DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0)+DECODE(AA.EXTN_PRD_COFM_DT,'',0,AA.EXTN_PRD_COFM_DT)                                                   AS STAN_PROC_DAY  --기준처리일
                         ,AA.STAN_PROC_DAY+DECODE(AA.GNR_HNDL_PLAN_YN,'Y',AA.GNR_HNDL_PLAN_EXTN_DCN,0)+DECODE(AA.EXTN_PRD_COFM_DT,'',0,AA.EXTN_PRD_COFM_DT) AS STAN_PROC_DAY  --기준처리일(2019.04.05 LSR 수정)
--                         ,(BB.RETURN_DT + (AA.STAN_PROC_DAY+DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0)+DECODE(AA.EXTN_PRD_COFM_DT,'',0,AA.EXTN_PRD_COFM_DT))) - 1                            AS STAN_PROC_DT   --기준처리기한
                         , NVL(TO_DATE(AA.EXTN_HNDL_DDLN_DT), TO_DATE(AA.HNDL_DDLN_DT)) AS STAN_PROC_DT   --기준처리기한 (2019.04.05 LSR 수정)
--                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(FF.ENF_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.RETURN_DT , 'YYYYMMDD'))) +1,0),0)) - (AA.STAN_PROC_DAY+DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0)+DECODE(AA.EXTN_PRD_COFM_DT,'',0,AA.EXTN_PRD_COFM_DT)) AS STAN_EXCE_DAY  --기준초과일
                         ,(NVL(TRUNC((NVL(TO_DATE(TO_CHAR(FF.ENF_DT, 'YYYYMMDD')), TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'))) - TO_DATE(TO_CHAR(BB.RETURN_DT , 'YYYYMMDD'))) +1,0),0)) - (AA.STAN_PROC_DAY+DECODE(AA.GNR_HNDL_PLAN_YN,'Y',AA.GNR_HNDL_PLAN_EXTN_DCN,0)+DECODE(AA.EXTN_PRD_COFM_DT,'',0,AA.EXTN_PRD_COFM_DT)) AS STAN_EXCE_DAY  --기준초과일 (2019.04.05 LSR 수정)
                         ,DECODE(AA.AUD_KND_CD2,'2',AA.REQ_NTAS_DCS_DT+59,
                          DECODE(AA.AUD_KND_CD2,'3',ADD_MONTHS(AA.REQ_NTAS_DCS_DT,6),
                          DECODE(AA.AUD_KND_CD2,'4',ADD_MONTHS(AA.REQ_NTAS_DCS_DT,5),'')))              AS AUD_DVSN_PROC_DT     --청구국회처리기한(2:국민3:공익4:국회)
                         ,FF.ENF_DT-(DECODE(AA.AUD_KND_CD2,'2',AA.REQ_NTAS_DCS_DT+59,
                                     DECODE(AA.AUD_KND_CD2,'3',ADD_MONTHS(AA.REQ_NTAS_DCS_DT,6),
                                     DECODE(AA.AUD_KND_CD2,'4',ADD_MONTHS(AA.REQ_NTAS_DCS_DT,5),''))))  AS AUD_DVSN_EXCE_DAY    --청구국회초과일수

                         /****************************** 출장일수계산 ******************************/
                         ,(FF.ENF_DT - DECODE(BB.AUD_STR_DT01,'',BB.AUD_STR_DT02_1,BB.AUD_STR_DT01))+1  AS AUD_TOT_DAY      --감사전체일수   (예비조사시작OR실지감사시작~시행일)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.RETURN_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT00 , 'YYYYMMDD'))),0),0))                            AS AUD_READY_00     --감사준비1      (자료수집시작~귀청일)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_STR_DT01, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT00 , 'YYYYMMDD'))),0),0))                         AS AUD_PERIO_00     --자료수집_총기간(자료수집시작~예비조사시작)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_END_DT00, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT00, 'YYYYMMDD'))) +1,0),0))                        AS AUD_BSRP_00      --자료수집_실시  (자료수집시작~자료수집끝)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_STR_DT01, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT00 , 'YYYYMMDD'))),0),0)) - (NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_END_DT00, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT00, 'YYYYMMDD'))) +1,0),0))   AS AUD_WAIT_00   --자료수집_대기(총기간-실시)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.RETURN_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT01 , 'YYYYMMDD'))),0),0))                            AS AUD_READY_11     --감사준비2      (예비조사시작~귀청일)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_STR_DT02_1, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT01 , 'YYYYMMDD'))),0),0))                       AS AUD_PERIO_11     --예비조사_총기간(예비조사시작~실지감사시작)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_END_DT01, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT01, 'YYYYMMDD'))) +1,0),0))                        AS AUD_BSRP_11      --예비조사_실시  (예비조사시작~예비조사끝)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_STR_DT02_1, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT01 , 'YYYYMMDD'))),0),0)) - (NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_END_DT01, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT01, 'YYYYMMDD'))) +1,0),0)) AS AUD_WAIT_11   --예비조사_대기(총기간-실시)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.RETURN_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT02_1 , 'YYYYMMDD'))),0),0))                          AS AUD_PERIO_22     --실지감사_총기간(실지감사시작~귀청일)
                         --,AUD_BSRP_SUM_22             --◆SUM◆실지감사_합계(실지감사_실시+실지감사_연장)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_END_DT02_1, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT02_1, 'YYYYMMDD'))) +1,0),0))                    AS AUD_BSRP_22_1    --실지감사_실시_1(실지감사시작~실지감사끝)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_END_DT02_2, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT02_2, 'YYYYMMDD'))) +1,0),0))                    AS AUD_BSRP_22_2    --실지감사_실시_2(실지감사시작~실지감사끝)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_END_DT02_3, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT02_3, 'YYYYMMDD'))) +1,0),0))                    AS AUD_BSRP_22_3    --실지감사_실시_3(실지감사시작~실지감사끝)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(BB.AUD_END_DT03, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.AUD_STR_DT03, 'YYYYMMDD'))) +1,0),0))                        AS AUD_BSRP_33      --실지감사_연장  (실지연장시작~실지연장끝)
                         --,AUD_WAIT_22                 --◆SUM◆실지감사_대기(실지감사_총기간-실지감사_합계)

                         /****************************** 보고서일수계산 ******************************/
                          --,PROC_TOT_NDAY              --◆SUM◆처리전체기간 (처리_결재기간+처리_부의기간)
                          --,PROC_APVR_NDAY             --◆SUM◆처리_결재기간(과장_합계기간+국장_결재기간+총차장_합계기간)
                          --,GWA_APVR_SUM_NDAY          --◆SUM◆과장_합계기간(과장_종료보고기간+과장_결재기간+과장_접수대기기간)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(CC.E_FNL_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(CC.E_FNL_APV , 'YYYYMMDD'))) +1,0),0))  AS GWA_END_RPT_NDAY --과장_종료보고기간(귀청일~종료보고최종결재)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(DD.GWA_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(CC.E_FNL_APV , 'YYYYMMDD'))),0),0))     AS GWA_APV_NDAY     --과장_결재기간(종료보고최종결재~과장결재)
                          --,GWA_APP_WAIT_NDAY          --◆SUM◆과장_접수대기기간(귀청일~시행일)-(과장_종료보고기간+과장_결재기간+국장_결재기간+총차장_합계기간+처리_부의기간)
                         ,CASE WHEN TO_CHAR(EE.RCPT_DH,'YYYYMMDD') > TO_CHAR(DD.GWA_APV,'YYYYMMDD') THEN (NVL(TRUNC((TO_DATE(TO_CHAR(DD.GUK_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(EE.RCPT_DH , 'YYYYMMDD'))) +1,0),0))
                               ELSE (NVL(TRUNC((TO_DATE(TO_CHAR(DD.GUK_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.GWA_APV , 'YYYYMMDD'))),0),0))  --처리안검토의견서 업무가 없어지면서 국장결재일-과장결재일로 변경
                               END AS GUK_APV_NDAY      --국장_결재기간(국장접수~국장종결)
                         ,(NVL(TRUNC((TO_DATE(TO_CHAR(EE.SND_DH, 'YYYYMMDD'))- TO_DATE(TO_CHAR(EE.RCPT_DH , 'YYYYMMDD'))),0),0))        AS PUM_APV_NDAY     --품질_결재기간(품질접수~품질종결)
                          --,CHONG_CHA_APV_SUM_NDAY     --◆SUM◆총차장_합계기간(차장_결재기간+총장_결재기간)
                         ,CASE WHEN TO_CHAR(DD.CHA_APP,'YYYYMMDD') > TO_CHAR(DD.GUK_APV,'YYYYMMDD') THEN (NVL(TRUNC((TO_DATE(TO_CHAR(DD.CHA_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.CHA_APP , 'YYYYMMDD'))) +1,0),0))
                               ELSE (NVL(TRUNC((TO_DATE(TO_CHAR(DD.CHA_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.CHA_APP , 'YYYYMMDD'))),0),0))
                               END AS CHA_APV_NDAY      --차장_결재기간(차장접수~차장종결)
                         ,CASE WHEN TO_CHAR(DD.CHONG_APP,'YYYYMMDD') > TO_CHAR(DD.CHA_APV,'YYYYMMDD') THEN (NVL(TRUNC((TO_DATE(TO_CHAR(DD.CHONG_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.CHONG_APP , 'YYYYMMDD'))) +1,0),0))
                               ELSE (NVL(TRUNC((TO_DATE(TO_CHAR(DD.CHONG_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.CHONG_APP , 'YYYYMMDD'))),0),0))
                               END AS CHONG_APV_NDAY    --총장_결재기간(총장접수~총장종결)
                          --,PROC_SBCN_NDAY             --◆SUM◆처리_부의기간(위원_결재기간+위원_회의+시행)
                          --,WI_APV_SUM_NDAY            --◆SUM◆위원_합계(위원_결재기간+위원_회의)
                         ,CASE WHEN TO_CHAR(DD.CHONG_APV,'YYYYMMDD') IS NULL
                               THEN (CASE WHEN TO_CHAR(DD.WI_APP,'YYYYMMDD') > TO_CHAR(DD.CHA_APV,'YYYYMMDD') THEN (NVL(TRUNC((TO_DATE(TO_CHAR(DD.WI_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.WI_APP , 'YYYYMMDD'))) +1,0),0))
                                          ELSE (NVL(TRUNC((TO_DATE(TO_CHAR(DD.WI_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.WI_APP , 'YYYYMMDD'))),0),0))
                                           END)
                               ELSE (CASE WHEN TO_CHAR(DD.WI_APP,'YYYYMMDD') > TO_CHAR(DD.CHONG_APV,'YYYYMMDD') THEN (NVL(TRUNC((TO_DATE(TO_CHAR(DD.WI_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.WI_APP , 'YYYYMMDD'))) +1,0),0))
                                          ELSE (NVL(TRUNC((TO_DATE(TO_CHAR(DD.WI_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.WI_APP , 'YYYYMMDD'))),0),0))
                                           END)
                               END AS WI_APV_NDAY       --위원_결재기간(위원접수~위원종결)
                         ,CASE WHEN TO_CHAR(FF.SBCN_DY,'YYYYMMDD') > TO_CHAR(DD.WI_APV,'YYYYMMDD') THEN (NVL(TRUNC((TO_DATE(TO_CHAR(FF.SBCN_DY, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.WI_APV , 'YYYYMMDD'))),0),0))
                               ELSE 0
                               END AS WI_SBCN_NDAY      --위원_회의(위원종결~위원회의)
                         ,CASE WHEN TO_CHAR(FF.SBCN_DY,'YYYYMMDD') IS NULL
                               THEN (CASE WHEN TO_CHAR(FF.ENF_DT,'YYYYMMDD') > TO_CHAR(DD.WI_APV,'YYYYMMDD') THEN (NVL(TRUNC((TO_DATE(TO_CHAR(FF.ENF_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(DD.WI_APV , 'YYYYMMDD'))),0),0))
                                          ELSE 0
                                           END)
                               ELSE (CASE WHEN TO_CHAR(FF.ENF_DT,'YYYYMMDD') > TO_CHAR(FF.SBCN_DY,'YYYYMMDD') THEN (NVL(TRUNC((TO_DATE(TO_CHAR(FF.ENF_DT, 'YYYYMMDD'))- TO_DATE(TO_CHAR(FF.SBCN_DY , 'YYYYMMDD'))),0),0))
                                          ELSE 0
                                           END)
                               END AS ENF_NDAY          --시행(위원회의~시행일)
                         ,(SELECT -- F1.AUD_YR
                                  --,F1.AUD_NO
                                  --,COUNT(F1.REFER_DVSN_CD) --부의구분코드(D10:부의,D11:분리부의,D12:재부의,E10:위임)
                                  --,SUM(DECODE(F1.REFER_DVSN_CD,'E10',1,0))
                                  DECODE(COUNT(F1.REFER_DVSN_CD),SUM(DECODE(F1.REFER_DVSN_CD,'E10',1,0)),'전부위임','')
                             FROM TBBADDED145M F1
                            WHERE F1.AUD_YR         = #{srcAudYr} --PARAM
                              AND F1.AUD_NO         = AA.AUD_NO
                              AND F1.AUD_STEP_CD    = 'A1070' --감사부의
                            GROUP BY F1.AUD_YR,F1.AUD_NO) AS REMARK --특이사항
--                         ,(WITH AUD_USER_INFO AS (SELECT ROWNUM AS RNUM ,CNB
--                                                    FROM (SELECT G1.CNB
--                                                            FROM TBDCMACM001M G1
--                                                           ORDER BY G1.RAL_BLT_DIV_CD              --실소속과코드
--                                                                   ,NVL(G1.INN_RANK_CD,'50') ASC   --내부직급코드
--                                                                   ,G1.RANK_SRT_SEQ_NM             --직급정렬순서명
--                                                                   ,G1.CRNT_RANK_APM_DT            --현직급임용일
--                                                                   ,G1.SRT_KY_NO                   --정렬키번호
--                                                                   ,G1.CRNT_DPT_APM_DT             --현부서임용일
--                                                          )
--                                                 )
--                           SELECT CASE WHEN G4.TRTM_EXAMER_CNT > 1
--                                       THEN F_USR_INFO(G5.CNB, '2') || ' 등 ' || G4.TRTM_EXAMER_CNT
--                                       ELSE F_USR_INFO(G5.CNB, '2')
--                                   END AS USR_TRTM_EXAMER_CNT
--                             FROM (SELECT G2.AUD_YR
--                                         ,G2.AUD_NO
--                                         --,G2.DOC_ID
--                                         ,COUNT(DISTINCT(G2.TRTM_EXAMER_CNB)) AS TRTM_EXAMER_CNT
--                                         ,MIN(G3.RNUM) AS RNUM
--                                     FROM TBBADDED145M G2
--                                         ,AUD_USER_INFO AS G3
--                                    WHERE 1=1
--                                      AND G2.AUD_YR = srcAudYr    --PARAM
--                                      AND G2.AUD_STEP_CD        = 'A1060'   --감사결과처리
--                                      AND G2.APVR_CD            = '0013600' --과장
--                                      AND G2.TRTM_EXAMER_CNB    = G3.CNB
--                                      AND G2.TRTM_EXAMER_CNB IS NOT NULL
--                                    GROUP BY G2.AUD_YR,G2.AUD_NO--,G2.DOC_ID
--                                   ) AS G4
--                                 ,AUD_USER_INFO AS G5
--                              WHERE G4.RNUM     = G5.RNUM
--                                AND G4.AUD_YR   = AA.AUD_YR
--                                AND G4.AUD_NO   = AA.AUD_NO
--                          ) AS IN_CHARGE_NM         --담당조정관(보고서전체)
--func
						,(SELECT CASE WHEN COUNT(DISTINCT(G2.TRTM_EXAMER_CNB)) > 1
                                  THEN F_USR_INFO(MIN(G1.REF_ID), '2') || ' 등 ' || COUNT(DISTINCT(G2.TRTM_EXAMER_CNB))
                                  ELSE F_USR_INFO(MIN(G1.REF_ID), '2')
                              END AS USR_TRTM_EXAMER_CNT
                             FROM TBBADDED103M G1
                                 ,TBBADDED145M G2
                            WHERE 1=1
                              AND G1.AUD_YR = G2.AUD_YR
                              AND G1.AUD_NO = G2.AUD_NO
                              AND G1.DOC_ID = G2.DOC_ID
                              AND G1.AUD_YR = AA.AUD_YR
                              AND G1.AUD_NO = AA.AUD_NO
                              AND G1.REF_ID IS NOT NULL
                              AND G1.RPRT_CD = 'A10600200'
                              AND SUBSTR(G1.AUD_RPRT_DVSN_CD,2) <> '1'  --최종보고서 제외
                            GROUP BY G1.AUD_YR,G1.AUD_NO
                          ) AS IN_CHARGE_NM    --담당조정관(보고서전체)
                         --,() AS PROC_NDAY_VERI    --처리일수검증--◆SUM◆
                         ,NVL(TRUNC((TO_DATE(TO_CHAR(CC.E_CHA_APV, 'YYYYMMDD'))- TO_DATE(TO_CHAR(BB.RETURN_DT , 'YYYYMMDD'))) +1,0),0) as END_RPT_PROC_CNT
                         ,(SELECT COUNT(*)
                            FROM TBBADDED013B
                           WHERE YE||MD BETWEEN BB.RETURN_DT AND CC.E_CHA_APV) AS HLDY_CNT

                     FROM BASIS_INFO        AA
                         ,BSRP_INFO         BB
                         ,END_APV_INFO      CC
                         ,AUD_RPRT_APV_INFO DD
                         ,AUD_RPRT_SR_INFO  EE
                         ,AFF_CNT_INFO      FF
                    WHERE AA.AUD_YR = BB.AUD_YR(+) AND AA.AUD_NO = BB.AUD_NO(+)
                      AND AA.AUD_YR = CC.AUD_YR(+) AND AA.AUD_NO = CC.AUD_NO(+)
                      AND AA.AUD_YR = DD.AUD_YR(+) AND AA.AUD_NO = DD.AUD_NO(+)
                      AND AA.AUD_YR = EE.AUD_YR(+) AND AA.AUD_NO = EE.AUD_NO(+)
                      AND AA.AUD_YR = FF.AUD_YR(+) AND AA.AUD_NO = FF.AUD_NO(+)
                      AND AA.AUD_YR = #{srcAudYr} --PARAM
                    ORDER BY AA.AUD_YR,AA.AUD_NO
               ) PD
        ORDER BY PD.AUD_YR,PD.AUD_NO

        ]]>
    </select>

</mapper>