<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.fer.dao.AEPFER004QMapper">
    
    <select id="selectTotalSituList" parameterType="paramMap" resultType="egovMap" >
            /* kr.go.bai.eip.aep.fer.dao.AEPFER004QMapper.selectTotalSituList */
         <![CDATA[
        WITH BASIS_INFO AS (/* 기본정보AA : BASIS_INFO */
                            SELECT A1.AUD_YR                                                    AS AUD_YR       --감사년도
                                  ,A1.AUD_NO                                                    AS AUD_NO       --감사번호
                                  ,A1.AUD_KND_CD                                                AS AUD_KND_CD   --감사종류코드(1:재무,2:특정,3:성과,4:기관,5:확인,9:서면)
                                  ,F_MNG_KND_AUDYRNO(A1.AUD_YR, A1.AUD_NO, A1.AUD_KND_CD, '-')  AS AUD_YR_NO    --분류번호   
                                  ,(SELECT T4.ABR_DPT_NM_1
                                         FROM TBDCMACM002M T4
                                        WHERE T4.DPT_CD = (SELECT A2.HIRK_DPT_CD
                                                             FROM TBDCMACM002M A2
                                                            WHERE A2.DPT_CD =  A1.SPV_BRDV_CD)
                                           AND T4.USE_YN = 'Y'
                                           AND ROWNUM = 1)                                  AS HIRK_DPT_NM  --국
                                  ,  (SELECT A2.HIRK_DPT_CD
                                                             FROM TBDCMACM002M A2
                                                            WHERE A2.DPT_CD =  A1.SPV_BRDV_CD) AS HIRK_DPT_CD
                                  ,(SELECT ABR_DPT_NM_1
                                      FROM TBDCMACM002M
                                     WHERE DPT_CD = A1.SPV_BRDV_CD)                             AS AUD_DPT_NM   --과
                                  ,A1.AUD_SBJ_NM                                                AS AUD_SBJ_NM   --감사사항명
                                  ,F_CODE_NM('1000739', A1.AUD_KND_CD)                    AS AUD_KND_NM   --종류코드2(1:민원2:국민3:공익4:국회5:심사6:재심8:손망9:판청)
                                  ,(SELECT A6.DVSN_CD
                                      FROM TBBADDED030L A6
                                     WHERE A6.AUD_YR = A1.AUD_YR
                                       AND A6.AUD_NO = A1.AUD_NO
                                       AND A6.SRNO   = 1)                                       AS AUD_KND_CD2  --종류코드2
                                  ,(SELECT TO_DATE(A5.REQ_NTAS_DCS_DT)
                                      FROM TBBADDED003M A5
                                     WHERE A5.AUD_YR = A1.AUD_YR
                                       AND A5.AUD_NO = A1.AUD_NO)                               AS REQ_NTAS_DCS_DT  --청구국회결정일
                                  ,(SELECT NVL(A7.EXTN_PRD_COFM_DT,0)
                                      FROM TBBADDED003M A7
                                     WHERE A7.AUD_YR = A1.AUD_YR
                                       AND A7.AUD_NO = A1.AUD_NO)                               AS EXTN_PRD_COFM_DT  --연장승인일
                                  ,B.DPT_SNO
                                  ,B.DPT_CD
                                  ,B.DPT_NM
                                  ,(SELECT MAX(TO_CHAR(TO_DATE(A8.EXAM_RPT_APV_DT),'YYYY-MM-DD')) AS EXAM_RPT_APV_DT
                                      FROM TBCSPEAR001M A8
                                          ,(SELECT TSK_KEY1 AS ACP_YR
                                                  ,TSK_KEY2 AS REQ_DVSN_CD
                                                  ,TSK_KEY3 AS CVPT_ACP_NO
                                                  ,AUD_YR
                                                  ,AUD_NO
                                              FROM TBBADDED030L) A9
                                          ,TBBADDED001M A10
                                     WHERE A8.ACP_YR      = A9.ACP_YR(+)
                                       AND A8.REQ_DVSN_CD = A9.REQ_DVSN_CD(+)
                                       AND A8.CVPT_ACP_NO = A9.CVPT_ACP_NO(+)     
                                       AND A9.AUD_YR      = A10.AUD_YR 
                                       AND A9.AUD_NO      = A10.AUD_NO
                                       AND A10.AUD_YR     = A1.AUD_YR
                                       AND A10.AUD_NO     = A1.AUD_NO
                                   ) AS EXAM_RPT_APV_DT --감사실시여부검토일
                                  ,(SELECT MAX(
                                           CASE WHEN A8.REQ_DVSN_CD IN ('2','3') AND (A8.EXAM_RPT_APV_DT IS NULL OR A8.REQ_EXAM_RSLT_CD <> '01') THEN ''
                                                WHEN A8.REQ_DVSN_CD = '2' AND (A8.EXAM_RPT_APV_DT IS NOT NULL AND A8.REQ_EXAM_RSLT_CD = '01') THEN TO_CHAR(TO_DATE(A8.EXAM_RPT_APV_DT)+60, 'YYYY-MM-DD')
                                                WHEN A8.REQ_DVSN_CD = '3' AND (A8.EXAM_RPT_APV_DT IS NOT NULL AND A8.REQ_EXAM_RSLT_CD = '01') THEN TO_CHAR(ADD_MONTHS(TO_DATE(A8.EXAM_RPT_APV_DT) , 6), 'YYYY-MM-DD')
                                                ELSE '' END) AS HNDL_DDLN_DT2
                                      FROM TBCSPEAR001M A8
                                          ,(SELECT TSK_KEY1 AS ACP_YR
                                                  ,TSK_KEY2 AS REQ_DVSN_CD
                                                  ,TSK_KEY3 AS CVPT_ACP_NO
                                                  ,AUD_YR
                                                  ,AUD_NO
                                              FROM TBBADDED030L) A9
                                          ,TBBADDED001M A10
                                     WHERE A8.ACP_YR      = A9.ACP_YR(+)
                                       AND A8.REQ_DVSN_CD = A9.REQ_DVSN_CD(+)
                                       AND A8.CVPT_ACP_NO = A9.CVPT_ACP_NO(+)     
                                       AND A9.AUD_YR      = A10.AUD_YR 
                                       AND A9.AUD_NO      = A10.AUD_NO
                                       AND A10.AUD_YR     = A1.AUD_YR
                                       AND A10.AUD_NO     = A1.AUD_NO
                                   ) AS HNDL_DDLN_DT2 --감사처리기한
                                   , C.AUD_EXEC_HNDL_STA_CD
                                   , B.SRT_SNO
                         	       , NVL(NVL(TO_DATE(C.ENF_APV_DT), TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD'))) - (NVL(TO_DATE(C.EXTN_HNDL_DDLN_DT), TO_DATE(C.HNDL_DDLN_DT))), 0) EXCS_DT		-- 초과일수 (시행결재일 - 처리기한일) 2019.04.05 LSR 추가                                   
                              FROM TBBADDED001M A1
                                  ,(SELECT S1.DPT_SNO
                                          ,S1.DPT_CD
                                          ,S1.DPT_NM
                                          ,S1.SRT_SNO
                                      FROM TBDCMACM002M S1
                                     WHERE S1.USE_YN         = 'Y'
                                       AND S1.IMD_CD         = 'Y'
                                       AND S1.ORZT_DVSN_CD   = '20'
                                       --AND S1.DPT_CD NOT IN ('100000','150000')
                                     ORDER BY S1.DPT_SNO
                                   ) B
                                   , TBBADDED003M C
                             WHERE 1=1
                               AND A1.AUD_YR BETWEEN #{schAudYr}  AND #{schEndYr} --PARAM
                               AND SUBSTR(A1.MNG_DPT_CD, 1, 3) || '000' = B.DPT_CD(+)
                               AND SUBSTR(A1.AUD_KND_CD,3,1) <> '5' --확인출장제외
                               AND A1.AUD_YR = C.AUD_YR
                               AND A1.AUD_NO = C.AUD_NO
                           ),
             BSRP_INFO AS (/* 출장정보BB : BSRP_INFO */
                    SELECT B2.REL_AUD_YR AS AUD_YR
                          ,B2.REL_AUD_NO AS AUD_NO
                          ,MIN(B2.AUD_STR_DT00) AS AUD_STR_DT00 --자료수집 시작일
                          ,MAX(B2.AUD_END_DT00) AS AUD_END_DT00 --자료수집 종료일
                          ,SUM(B2.AUD_DCN00)    AS AUD_DCN00    --자료수집 출장일수
                          ,MIN(B2.AUD_STR_DT01) AS AUD_STR_DT01 --예비조사 시작일
                          ,MAX(B2.AUD_END_DT01) AS AUD_END_DT01 --예비조사 종료일
                          ,SUM(B2.AUD_DCN01)    AS AUD_DCN01    --예비조사 출장일수
                          ,MIN(B2.AUD_STR_DT02) AS AUD_STR_DT02 --실지감사 시작일
                          ,MAX(B2.AUD_END_DT02) AS AUD_END_DT02 --실지감사 종료일
                          ,SUM(B2.AUD_DCN02)    AS AUD_DCN02    --실지감사 출장일수
                          ,MIN(B2.AUD_STR_DT03) AS AUD_STR_DT03 --실지감사연장 시작일
                          ,MAX(B2.AUD_END_DT03) AS AUD_END_DT03 --실지감사연장 종료일
                          ,SUM(B2.AUD_DCN03)    AS AUD_DCN03    --실지감사연장 출장일수
                          ,DECODE(MAX(B2.AUD_END_DT03),NULL,MAX(B2.AUD_END_DT02)+1,MAX(B2.AUD_END_DT03)+1) AS RETURN_DT  --귀청일
                          ,(SELECT SUM((NVL(TRUNC((TO_DATE(TO_CHAR(TO_DATE(B3.AUD_END_DT), 'YYYYMMDD'))- TO_DATE(TO_CHAR(TO_DATE(B3.AUD_STR_DT) , 'YYYYMMDD'))) +1,0),0)))
                              FROM TBBADDED002M B3
                             WHERE B3.REL_AUD_YR = B2.REL_AUD_YR
                               AND B3.REL_AUD_NO = B2.REL_AUD_NO
                               AND B3.AUD_BZT_KND_CD IN ('02','03')) AS AUD_BSRP_SUM
                      FROM (SELECT B1.REL_AUD_YR,B1.REL_AUD_NO
                                  ,DECODE(B1.AUD_BZT_KND_CD,'00',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT00
                                  ,DECODE(B1.AUD_BZT_KND_CD,'00',TO_DATE(AUD_END_DT)) AS AUD_END_DT00
                                  ,DECODE(B1.AUD_BZT_KND_CD,'00',AUD_DCN            ) AS AUD_DCN00
                                  ,DECODE(B1.AUD_BZT_KND_CD,'01',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT01
                                  ,DECODE(B1.AUD_BZT_KND_CD,'01',TO_DATE(AUD_END_DT)) AS AUD_END_DT01
                                  ,DECODE(B1.AUD_BZT_KND_CD,'01',AUD_DCN            ) AS AUD_DCN01
                                  ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT02
                                  ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_END_DT)) AS AUD_END_DT02
                                  ,DECODE(B1.AUD_BZT_KND_CD,'02',AUD_DCN            ) AS AUD_DCN02
                                  ,DECODE(B1.AUD_BZT_KND_CD,'03',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT03
                                  ,DECODE(B1.AUD_BZT_KND_CD,'03',TO_DATE(AUD_END_DT)) AS AUD_END_DT03
                                  ,DECODE(B1.AUD_BZT_KND_CD,'03',AUD_DCN            ) AS AUD_DCN03
                              FROM TBBADDED002M B1
                                INNER JOIN TBBADDED001M B2
                                           ON B1.REL_AUD_YR = B2.AUD_YR
                                           AND B1.REL_AUD_NO = B2.AUD_NO
                             WHERE B2.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr} 
                                AND B2.AUD_KND_CD NOT LIKE '%5'
                           ) B2
                     GROUP BY B2.REL_AUD_YR,B2.REL_AUD_NO
                     UNION ALL
                                SELECT D.AUD_YR AS AUD_NO
                                      ,D.AUD_NO AS AUD_NO
                                      ,NULL AS AUD_STR_DT00 --자료수집 시작일
                                      ,NULL AS AUD_END_DT00 --자료수집 종료일
                                      ,NULL AS AUD_DCN00    --자료수집 출장일수
                                      ,NULL AS AUD_STR_DT01 --예비조사 시작일
                                      ,NULL AS AUD_END_DT01 --예비조사 종료일
                                      ,NULL AS AUD_DCN01    --예비조사 출장일수
                                      ,MIN(TO_DATE(A.AUD_STR_DT)) AS AUD_STR_DT02 --실지감사 시작일
                                      ,MAX(TO_DATE(A.AUD_END_DT)) AS AUD_END_DT02 --실지감사 종료일
                                      ,SUM(A.AUD_DCN)    AS AUD_DCN02    --실지감사 출장일수
                                      ,NULL AS AUD_STR_DT03 --실지감사연장 시작일
                                      ,NULL AS AUD_END_DT03 --실지감사연장 종료일
                                      ,NULL AS AUD_DCN03    --실지감사연장 출장일수
                                      ,MAX(TO_DATE(A.AUD_END_DT))+1 AS RETURN_DT  --귀청일
                                      ,MAX(TO_DATE(A.AUD_END_DT)) - MIN(TO_DATE(A.AUD_STR_DT)) AS AUD_BSRP_SUM
                                 FROM TBBADDED101L D
                                      INNER JOIN TBBADDED001M B
                                                 ON (D.AUD_YR  = B.AUD_YR AND D.AUD_NO = B.AUD_NO)
                                      LEFT OUTER JOIN TBBADDED002M A
                                                 ON (A.REL_AUD_YR = D.REL_AUD_YR AND A.REL_AUD_NO = D.REL_AUD_NO AND A.BZT_DVSN_CD = 1)
                               WHERE B.AUD_KND_CD LIKE '%9'   --서면감사인 경우에만 자료수집 건을 출장정보로 설정함
                                  AND B.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr} 
                                GROUP BY D.AUD_YR, D.AUD_NO
                            ),
             END_APV_INFO AS (/* 종료보고결재CC : END_APV_INFO */
                              SELECT C1.AUD_YR
                                    ,C1.AUD_NO
                                    ,MIN(DECODE(C2.APVR_PST_CD,'0013600', C2.APV_DH, '0057400',C2.APV_DH, '0035400',C2.APV_DH, ''))   AS E_GWA_APV      --과장결재일
                                    ,MIN(DECODE(C2.APVR_PST_CD,'0015800',C2.APV_DH
                                        ,DECODE(C2.APVR_PST_CD,'0035100',C2.APV_DH
                                        ,DECODE(C2.APVR_PST_CD,'0058100',C2.APV_DH,'')))) AS E_GUK_APV      --국장결재일(국장:0015800,단장:0035100,실장:0058100)
                                    ,MIN(DECODE(C2.APVR_PST_CD,'0055600',C2.APV_DH
			                                ,DECODE(C2.APVR_PST_CD,'0045900',C2.APV_DH
			                                ,DECODE(C2.APVR_PST_CD,'0058100',C2.APV_DH,''))))  AS E_CHA_APV      --차장결재일(차장:0055600,본부장:0045900, 실장 : 0058100)
                                    ,MIN(DECODE(C2.APVR_PST_CD,'0055700',C2.APV_DH,''))   AS E_CHONG_APV    --총장결재일
                                    ,MIN(DECODE(C2.APVR_PST_CD,'0067400',C2.APV_DH,''))   AS E_WON_APV      --원장결재일
                                    ,MAX(DECODE(C1.APV_STA_CD,'30',C2.APV_DH,''))         AS E_FNL_APV      --최종결재일
                                    ,MAX(C1.APV_STA_CD)                                   AS APV_STA_CD     --결재상태
                                    ,MIN(DECODE(C2.APVR_PST_CD,'0013600',C2.APVR_KND_CD,'0057400',C2.APVR_KND_CD,'0035400',C2.APVR_KND_CD,''))   AS E_GWA_KND      
                                    ,MIN(DECODE(C2.APVR_PST_CD,'0015800',C2.APVR_KND_CD
                                        ,DECODE(C2.APVR_PST_CD,'0035100',C2.APVR_KND_CD
                                        ,DECODE(C2.APVR_PST_CD,'0058100',C2.APVR_KND_CD,'')))) AS E_GUK_KND      
                                    ,MIN(DECODE(C2.APVR_PST_CD,'0055600',C2.APVR_KND_CD
                                        ,DECODE(C2.APVR_PST_CD,'0045900',C2.APVR_KND_CD,'')))  AS E_CHA_KND      
                                    ,MIN(DECODE(C2.APVR_PST_CD,'0055700',C2.APVR_KND_CD,''))   AS E_CHONG_KND  
                                FROM TBBADDED103M C1
                                    ,TBDCMACM023H C2
                               WHERE 1=1
                                 AND C1.APV_RQS_ID  = C2.APV_DOC_NO
                                 AND C2.APVR_STA_CD <> '401'
                                 AND C1.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr} --PARAM
                                 AND C1.RPRT_CD     = 'A10500200' --종료보고서
                               GROUP BY C1.AUD_YR,C1.AUD_NO
                              ),
             AUD_RPRT_APV_INFO AS (/* 감사보고서(위원) 결재정보DD : AUD_RPRT_APV_INFO */
                                   SELECT D3.AUD_YR
                                         ,D3.AUD_NO
                                         ,D3.AUD_RPRT_DVSN_CD      AS AUD_RPRT_DVSN_CD
                                         ,D3.DOC_ID                AS DOC_ID
                                         ,MIN(D3.GWA_APV)          AS GWA_APV
                                         ,MIN(D3.GUK_APP)          AS GUK_APP
                                         ,MIN(D3.GUK_APV)          AS GUK_APV
                                         ,MIN(D3.CHA_APP)          AS CHA_APP
                                         ,MIN(D3.CHA_APV)          AS CHA_APV
                                         ,MIN(D3.CHONG_APP)        AS CHONG_APP
                                         ,MIN(D3.CHONG_APV)        AS CHONG_APV
                                         ,MAX(D3.FNL_APV)          AS FNL_APV
                                         ,MIN(D3.WI_APP)           AS WI_APP
                                         ,MIN(D3.WI_APV)           AS WI_APV
                                         ,MAX(D3.SYT_TRTM_DVSN_YN) AS SYT_TRTM_DVSN_YN
                                         ,MAX(D3.USE_YN)           AS USE_YN
                                         ,MAX(D3.AUD_RPRT_STA_CD)  AS AUD_RPRT_STA_CD
                                         ,MAX(D3.WI_RPRT_STA_CD)   AS WI_RPRT_STA_CD
                                         ,'SBCN'                AS SBCN_GUBN
                                     FROM (
                                           SELECT D1.AUD_YR
                                                 ,D1.AUD_NO
                                                 ,D1.AUD_RPRT_DVSN_CD
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' THEN D1.DOC_ID
                                                       ELSE D1.REF_ID
                                                        END AS DOC_ID
                                                ,CASE WHEN D1.RPRT_CD = 'A10600200' AND (D2.APVR_PST_CD = '0013600' OR D2.APVR_PST_CD = '0057400' OR D2.APVR_PST_CD = '0035400') AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS GWA_APV   --과장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS GUK_APP   --국단실장접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS GUK_APV   --국단실장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS CHA_APP   --차장,본부장 접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS CHA_APV   --차장,본부장 결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS CHONG_APP --사무총장접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS CHONG_APV --사무총장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D1.APV_STA_CD = '30' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS FNL_APV   --최종결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ,D2.APV_DH DESC)
                                                       ELSE NULL
                                                        END AS WI_APP    --주심위원접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS WI_APV    --주심위원결재일
                                                 ,D1.SYT_TRTM_DVSN_YN
                                                 ,D1.USE_YN
                                                 ,DECODE(D1.RPRT_CD,'A10600200',D1.APV_STA_CD ) AS AUD_RPRT_STA_CD
                                                 ,DECODE(D1.RPRT_CD,'A10700100',D1.APV_STA_CD ) AS WI_RPRT_STA_CD
                                             FROM TBBADDED103M D1
                                                 ,(SELECT A.SEQ
                                                              ,A.APV_DOC_NO
                                                              ,A.APVR_PST_CD
                                                              ,A.APVR_KND_CD
                                                              ,A.APVR_STA_CD
                                                              ,A.APV_DH
                                                              ,A.APV_DVSN_CD
                                                              ,A.APVR_CNB
                                                          FROM TBDCMACM023H A
                                                        UNION ALL
                                                        SELECT 9999999999 AS SEQ
                                                              ,B.APV_DOC_NO
                                                              ,B.APVR_PST_CD
                                                              ,B.APVR_KND_CD
                                                              ,B.APVR_STA_CD
                                                              ,B.APV_DH
                                                              ,B.APV_DVSN_CD
                                                              ,B.APVR_CNB
                                                          FROM TBDCMACM023L B
                                                         WHERE B.APVR_STA_CD IN ('102','103')
                                                           AND NOT EXISTS (SELECT 'X'
                                                                             FROM TBDCMACM023H S
                                                                            WHERE S.APV_DOC_NO  = B.APV_DOC_NO 
                                                                              AND S.APV_DVSN_CD = B.APV_DVSN_CD
                                                                              AND S.APVR_CNB    = B.APVR_CNB   
                                                                      )
                                                         ORDER BY SEQ) D2
                                            WHERE D1.APV_RQS_ID = D2.APV_DOC_NO
                                              AND D1.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr} --PARAM
                                              AND D1.AUD_RPRT_DVSN_CD IN ('10','20','30') --재부의 제외
                                              AND D1.RPRT_CD          IN ('A10600200','A10700100') --감사보고서,주심위원설명자료
                                              AND D2.APVR_KND_CD      IN ('2','3','9')   --공석추가
                                            ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ/*D2.APV_SNO,D2.APVR_SEQ*/
                                           ) D3
                                    GROUP BY D3.AUD_YR,D3.AUD_NO,D3.AUD_RPRT_DVSN_CD,D3.DOC_ID
                                    UNION
                                    SELECT D3.AUD_YR
                                         ,D3.AUD_NO
                                         ,D3.AUD_RPRT_DVSN_CD      AS AUD_RPRT_DVSN_CD
                                         ,D3.DOC_ID                AS DOC_ID
                                         ,MIN(D3.GWA_APV)          AS GWA_APV
                                         ,MIN(D3.GUK_APP)          AS GUK_APP
                                         ,MIN(D3.GUK_APV)          AS GUK_APV
                                         ,MIN(D3.CHA_APP)          AS CHA_APP
                                         ,MIN(D3.CHA_APV)          AS CHA_APV
                                         ,MIN(D3.CHONG_APP)        AS CHONG_APP
                                         ,MIN(D3.CHONG_APV)        AS CHONG_APV
                                         ,MAX(D3.FNL_APV)          AS FNL_APV
                                         ,MIN(D3.WI_APP)           AS WI_APP
                                         ,MIN(D3.WI_APV)           AS WI_APV
                                         ,MAX(D3.SYT_TRTM_DVSN_YN) AS SYT_TRTM_DVSN_YN
                                         ,MAX(D3.USE_YN)           AS USE_YN
                                         ,MAX(D3.AUD_RPRT_STA_CD)  AS AUD_RPRT_STA_CD
                                         ,MAX(D3.WI_RPRT_STA_CD)   AS WI_RPRT_STA_CD
                                         ,'RE_SBCN'                AS SBCN_GUBN
                                     FROM (
                                           SELECT D3.AUD_YR
                                                 ,D3.AUD_NO
                                                 ,NVL(D1.AUD_RPRT_DVSN_CD,'40') AS AUD_RPRT_DVSN_CD
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' THEN D1.DOC_ID
                                                       ELSE D1.REF_ID
                                                        END AS DOC_ID
                                                ,CASE WHEN D1.RPRT_CD = 'A10600200' AND (D2.APVR_PST_CD = '0013600' OR D2.APVR_PST_CD = '0057400' OR D2.APVR_PST_CD = '0035400') AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS GWA_APV   --과장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS GUK_APP   --국단실장접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS GUK_APV   --국단실장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS CHA_APP   --차장,본부장 접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS CHA_APV   --차장,본부장 결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS CHONG_APP --사무총장접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS CHONG_APV --사무총장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D1.APV_STA_CD = '30' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS FNL_APV   --최종결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ,D2.APV_DH DESC)
                                                       ELSE NULL
                                                        END AS WI_APP    --주심위원접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS WI_APV    --주심위원결재일
                                                 ,D1.SYT_TRTM_DVSN_YN
                                                 ,D1.USE_YN
                                                 ,DECODE(D1.RPRT_CD,'A10600200',D1.APV_STA_CD ) AS AUD_RPRT_STA_CD
                                                 ,DECODE(D1.RPRT_CD,'A10700100',D1.APV_STA_CD ) AS WI_RPRT_STA_CD
                                                 ,D3.REFER_DVSN_D10
                                                 ,D3.REFER_DVSN_E10
                                                 ,D3.SBCN_DY
                                                 ,D3.RE_SBCN_DY
                                                 ,D3.RE_WI_APV
                                                 ,D3.RE_DOC_ID
                                                 ,D3.RE_SBCN_CNT
                                             FROM (SELECT 
                                                        T1.AUD_YR
                                                        , T1.AUD_NO
                                                        , T1.DOC_ID AS DOC_ID
                                                        , T2.DOC_ID AS RE_DOC_ID
                                                        , SUM(CASE WHEN T3.FNL_YN= 'Y' AND T3.REFER_DVSN_CD = 'D10' THEN 1 ELSE 0 END) AS REFER_DVSN_D10   --부의
                                                        , SUM(CASE WHEN T3.FNL_YN= 'Y' AND T3.REFER_DVSN_CD = 'E10' THEN 1 ELSE 0 END) AS REFER_DVSN_E10   --위임
                                                        , MIN(T1.SBCN_DY) AS SBCN_DY
                                                        , MIN(T4.SBCN_DY) AS RE_SBCN_DY
                                                        , MAX(T5.APV_STA_CD)
                                                        , MIN(T6.APV_DH) AS RE_WI_APV      -- 재부의 주심위원설명자료 결재일자
                                                        , COUNT(DISTINCT T2.DSP_RQ_SNO) AS RE_SBCN_CNT
                                                      FROM TBBADDED113M T1
                                                           LEFT OUTER JOIN TBBADDED146M T2
                                                           ON (T1.AUD_YR = T2.AUD_YR AND T1.AUD_NO = T2.AUD_NO
                                                               AND T1.DOC_ID = T2.HD_DOC_ID AND T1.APVR_CD = T2.HD_APVR_CD
                                                               AND T1.AFF_SNO = T2.HD_AFF_SNO AND T1.DSP_RQ_SNO = T2.HD_DSP_RQ_SNO)
                                                           LEFT OUTER JOIN TBBADDED145M T3
                                                           ON (T2.AUD_YR = T3.AUD_YR AND T2.AUD_NO = T3.AUD_NO
                                                               AND T2.AUD_STEP_CD = T3.AUD_STEP_CD AND T2.DOC_ID = T3.DOC_ID 
                                                               AND T2.APVR_CD = T3.APVR_CD AND T2.AFF_SNO = T3.AFF_SNO)
                                                           LEFT OUTER JOIN TBBADDED113M T4
                                                           ON (T2.AUD_YR = T4.AUD_YR AND T2.AUD_NO = T4.AUD_NO
                                                               AND T2.DOC_ID = T4.DOC_ID AND T2.APVR_CD = T4.APVR_CD 
                                                               AND T2.AFF_SNO = T4.AFF_SNO AND T2.DSP_RQ_SNO = T4.DSP_RQ_SNO)
                                                           LEFT OUTER JOIN TBBADDED103M T5
                                                           ON (T5.REF_ID = T4.DOC_ID AND T5.RPRT_CD = 'A10700100')
                                                           LEFT OUTER JOIN TBDCMACM023H T6
                                                           ON (T5.APV_RQS_ID = T6.APV_DOC_NO AND T6.APVR_PST_CD = '0010600')
                                                           LEFT OUTER JOIN TBBADDED146M T7 -- 원 부의 처분요구
                                                           ON (T7.AUD_YR = T1.AUD_YR AND T7.AUD_NO = T1.AUD_NO
                                                               AND T7.DOC_ID = T1.DOC_ID AND T7.APVR_CD = 'A107001'
                                                               AND T7.AFF_SNO = T1.AFF_SNO AND T7.DSP_RQ_SNO = T1.DSP_RQ_SNO)
                                                     WHERE T1.SBCN_VT_CD = '90'
                                                     AND ((T2.HD_DOC_ID IS NULL AND T7.DF_DOC_ID IS NULL) OR (T2.HD_DOC_ID IS NOT NULL AND T7.DF_DOC_ID IS NOT NULL))
                                                     GROUP BY T1.AUD_YR, T1.AUD_NO, T1.DOC_ID, T2.DOC_ID) D3
                                                 LEFT OUTER JOIN TBBADDED103M D1
                                                 ON (D3.AUD_YR = D1.AUD_YR AND D3.AUD_NO = D1.AUD_NO 
                                                    AND (D3.RE_DOC_ID = D1.DOC_ID OR D3.RE_DOC_ID = D1.REF_ID)
                                                    AND D1.AUD_RPRT_DVSN_CD = '40'
                                                    AND D1.RPRT_CD          IN ('A10600200','A10700100'))
                                                 LEFT OUTER JOIN (SELECT A.SEQ
                                                              ,A.APV_DOC_NO
                                                              ,A.APVR_PST_CD
                                                              ,A.APVR_KND_CD
                                                              ,A.APVR_STA_CD
                                                              ,A.APV_DH
                                                              ,A.APV_DVSN_CD
                                                              ,A.APVR_CNB
                                                          FROM TBDCMACM023H A
                                                        UNION ALL
                                                        SELECT 9999999999 AS SEQ
                                                              ,B.APV_DOC_NO
                                                              ,B.APVR_PST_CD
                                                              ,B.APVR_KND_CD
                                                              ,B.APVR_STA_CD
                                                              ,B.APV_DH
                                                              ,B.APV_DVSN_CD
                                                              ,B.APVR_CNB
                                                          FROM TBDCMACM023L B
                                                         WHERE B.APVR_STA_CD IN ('102','103')
                                                           AND NOT EXISTS (SELECT 'X'
                                                                             FROM TBDCMACM023H S
                                                                            WHERE S.APV_DOC_NO  = B.APV_DOC_NO 
                                                                              AND S.APV_DVSN_CD = B.APV_DVSN_CD
                                                                              AND S.APVR_CNB    = B.APVR_CNB   
                                                                      )
                                                         ORDER BY SEQ) D2
                                                 ON (D1.APV_RQS_ID = D2.APV_DOC_NO AND D2.APVR_KND_CD      IN ('2','3','9'))
                                            WHERE D3.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr}
                                            ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ
                                           ) D3
                                    WHERE (CASE WHEN D3.REFER_DVSN_D10 =  0 THEN NVL(D3.RE_WI_APV,TO_DATE('99991231'))    --부의건수가 없으면 위원결재일
                                                WHEN D3.REFER_DVSN_D10 <> 0 THEN TO_DATE(NVL(D3.RE_SBCN_DY,'99991231'))   --부의건수가 있으면 부의일
                                                ELSE TO_DATE('99991231')
                                                END) > SYSDATE
                                    GROUP BY D3.AUD_YR,D3.AUD_NO,D3.AUD_RPRT_DVSN_CD,D3.DOC_ID, D3.RE_DOC_ID
                                    
                                   ),
             AUD_RPRT_SR_INFO AS (/* 감사보고서 품질접수발신일EE : AUD_RPRT_SR_INFO */
                                  SELECT E1.AUD_YR
                                        ,E1.AUD_NO
                                        ,E1.DOC_ID
                                        ,MAX(DECODE(E1.RPRT_CD,'A10600200',E1.RCPT_DH)) AS RCPT_DH
                                        ,MAX(DECODE(E3.APV_STA_CD,'30',(SELECT MAX(E4.APV_DH)
                                                                          FROM TBDCMACM023H E4
                                                                         WHERE E4.APV_DOC_NO = E3.APV_RQS_ID
                                                                           AND E4.APVR_STA_CD <> '201'
                                                                           AND E4.APVR_STA_CD LIKE '20%'
                                                                       ),NULL)) AS SND_DH
                                    FROM TBBADDED111M E1
                                        ,TBBADDED145M E2
                                        ,TBBADDED103M E3
                                   WHERE 1=1
                                     AND E1.AUD_YR  = E2.AUD_YR
                                     AND E1.AUD_NO  = E2.AUD_NO
                                     AND E1.DOC_ID  = E2.DOC_ID
                                     AND E1.AUD_YR  = E3.AUD_YR
                                     AND E1.AUD_NO  = E3.AUD_NO
                                     AND TO_CHAR(E2.AFF_SNO) = E3.REF_ID
                                     AND E1.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr}  --PARAM
                                     --AND E1.AUD_RPRT_DVSN_CD = '10'         --감사보고서구분코드(10:본안,20:우선,30:별도,40:재부의)
                                     AND E1.RPRT_CD          = 'A10600200'  --감사보고서
                                     AND E2.APVR_CD          in ( '0013600', '0057400', '0035400')    --과장사건
                                     AND E3.RPRT_CD          = 'A10600500'  --처리안검토의견서
                                   GROUP BY E1.AUD_YR,E1.AUD_NO,E1.DOC_ID
                                 ),
             AFF_CNT_INFO AS (/* 사건정보GG : AFF_CNT_INFO */
                              SELECT A.AUD_YR
                                    ,A.AUD_NO
                                    ,A.DOC_ID
                                    ,SUM(CASE WHEN A.FNL_YN= 'Y' AND A.REFER_DVSN_CD = 'D10' THEN 1 ELSE 0 END) AS REFER_DVSN_D10   --부의
                                    ,SUM(CASE WHEN A.FNL_YN= 'Y' AND A.REFER_DVSN_CD = 'E10' THEN 1 ELSE 0 END) AS REFER_DVSN_E10   --위임
                                    ,MIN(C.SBCN_DY) AS SBCN_DY  --최초부의일
                                    ,MIN(E.ENF_DT)  AS ENF_DT   --최초시행일
                                FROM TBBADDED145M A
                                    ,TBBADDED146M B
                                    ,TBBADDED113M C
                                    ,(SELECT A7.AUD_YR
                                            ,A7.AUD_NO
                                            ,'A1070' AS APVR_CD
                                            ,A7.AUD_DSP_RQ_SNO
                                            ,A3.ENF_DT
                                        FROM TBBADEAR001M A7
                                            ,TBBADEAR002D A3
                                       WHERE A7.AUD_YR      = A3.AUD_YR
                                         AND A7.AUD_NO      = A3.AUD_NO
                                         AND A7.DSP_RQ_SNO  = A3.DSP_RQ_SNO
                                     ) E
                               WHERE 1=1
                                 AND A.AUD_YR      = B.AUD_YR
                                 AND A.AUD_NO      = B.AUD_NO
                                 AND A.AUD_STEP_CD = B.AUD_STEP_CD
                                 AND A.DOC_ID      = B.DOC_ID
                                 AND A.APVR_CD     = B.APVR_CD
                                 AND A.AFF_SNO     = B.AFF_SNO
                                 AND B.DSP_RQ_CD NOT IN ('390','391','395','396','490','495','730')
                                 AND B.AUD_YR      = C.AUD_YR(+)
                                 AND B.AUD_NO      = C.AUD_NO(+)
                                 AND B.DOC_ID      = C.DOC_ID(+)
                                 AND B.APVR_CD     = C.APVR_CD(+)
                                 AND B.AFF_SNO     = C.AFF_SNO(+)
                                 AND B.DSP_RQ_SNO  = C.DSP_RQ_SNO(+)
                                 AND B.AUD_YR      = E.AUD_YR(+)
                                 AND B.AUD_NO      = E.AUD_NO(+)
                                 AND B.APVR_CD     = E.APVR_CD(+)
                                 AND B.DSP_RQ_SNO  = E.AUD_DSP_RQ_SNO(+)
                                 AND A.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr}
                               GROUP BY A.AUD_YR,A.AUD_NO,A.DOC_ID
                               ORDER BY A.AUD_YR,A.AUD_NO,A.DOC_ID
                             )
        /***************************** 총괄 S***********************************/
        SELECT Z.DPT_SNO
              ,Z.DPT_NM
              ,SUM(Z.TOTAL_CNT)      AS TOTAL_CNT
              ,SUM(Z.END_RPRT_CNT)   AS END_RPRT_CNT
              ,SUM(Z.GWA_RPRT_CNT)   AS GWA_RPRT_CNT
              ,SUM(Z.PUM_RPRT_CNT)   AS PUM_RPRT_CNT
              ,SUM(Z.GUK_RPRT_CNT)   AS GUK_RPRT_CNT
              ,SUM(Z.CHA_RPRT_CNT)   AS CHA_RPRT_CNT
              ,SUM(Z.CHONG_RPRT_CNT) AS CHONG_RPRT_CNT
              ,SUM(Z.WI_RPRT_CNT)    AS WI_RPRT_CNT
              ,SUM(Z.OVERDUE)        AS OVERDUE
              
              ,CASE WHEN SUM(Z.ETC_TOTAL_CNT)      <> 0 THEN SUM(Z.ETC_TOTAL_CNT)      ELSE 0 END AS ETC_TOTAL_CNT
              ,CASE WHEN SUM(Z.ETC_END_RPRT_CNT)   <> 0 THEN SUM(Z.ETC_END_RPRT_CNT)   ELSE 0 END AS ETC_END_RPRT_CNT
              ,CASE WHEN SUM(Z.ETC_GWA_RPRT_CNT)   <> 0 THEN SUM(Z.ETC_GWA_RPRT_CNT)   ELSE 0 END AS ETC_GWA_RPRT_CNT
              ,CASE WHEN SUM(Z.ETC_PUM_RPRT_CNT)   <> 0 THEN SUM(Z.ETC_PUM_RPRT_CNT)   ELSE 0 END AS ETC_PUM_RPRT_CNT
              ,CASE WHEN SUM(Z.ETC_GUK_RPRT_CNT)   <> 0 THEN SUM(Z.ETC_GUK_RPRT_CNT)   ELSE 0 END AS ETC_GUK_RPRT_CNT
              ,CASE WHEN SUM(Z.ETC_CHA_RPRT_CNT)   <> 0 THEN SUM(Z.ETC_CHA_RPRT_CNT)   ELSE 0 END AS ETC_CHA_RPRT_CNT
              ,CASE WHEN SUM(Z.ETC_CHONG_RPRT_CNT) <> 0 THEN SUM(Z.ETC_CHONG_RPRT_CNT) ELSE 0 END AS ETC_CHONG_RPRT_CNT
              ,CASE WHEN SUM(Z.ETC_WI_RPRT_CNT)    <> 0 THEN SUM(Z.ETC_WI_RPRT_CNT)    ELSE 0 END AS ETC_WI_RPRT_CNT
          FROM (
                SELECT AA.DPT_SNO
                      ,AA.DPT_CD
                      ,AA.DPT_NM
        --              ,AA.AUD_YR
        --              ,AA.AUD_NO
        --              ,AA.AUD_YR_NO
                      ,1                                                                               AS TOTAL_CNT      --전체
                      ,CASE WHEN DD.GWA_APV   IS NULL 
                                 AND CASE WHEN NVL(CC.E_CHA_KND,'0') <> '9' THEN TO_CHAR(CC.E_CHA_APV,'MM. DD')
                                          WHEN NVL(CC.E_GUK_KND,'0') <> '9' THEN TO_CHAR(CC.E_GUK_APV,'MM. DD')
                                          WHEN NVL(CC.E_GWA_KND,'0') <> '9' THEN TO_CHAR(CC.E_GWA_APV,'MM. DD')
                                          ELSE '' END  IS NULL
                                THEN 1 ELSE 0 END AS END_RPRT_CNT        --종료보고 (종료보고서 차장결재 X, 감사보고서 과장결재 X)
                      --,CASE WHEN NVL(CC.APV_STA_CD,'00') <> '30'                     THEN 1 ELSE 0 END AS END_RPRT_CNT   --종료보고 (종료보고서 코드 30(결재완료)이 아닌것)
                      ,CASE WHEN CASE WHEN NVL(CC.E_CHA_KND,'0') <> '9' THEN TO_CHAR(CC.E_CHA_APV,'MM. DD')
                                      WHEN NVL(CC.E_GUK_KND,'0') <> '9' THEN TO_CHAR(CC.E_GUK_APV,'MM. DD')
                                      WHEN NVL(CC.E_GWA_KND,'0') <> '9' THEN TO_CHAR(CC.E_GWA_APV,'MM. DD')
                                      ELSE '' END IS NOT NULL  AND DD.GWA_APV   IS NULL THEN 1 ELSE 0 END AS GWA_RPRT_CNT   --과장(종료보고서 차장결재 결재완료이고 과장결재일자가 없는것)
                      ,CASE WHEN EE.RCPT_DH   IS NOT NULL   AND EE.SND_DH    IS NULL THEN 1 ELSE 0 END AS PUM_RPRT_CNT   --품질(품질접수일 있고 품질종료일 없는것)
                      ,CASE WHEN DD.GWA_APV   IS NOT NULL   AND DD.GUK_APV   IS NULL THEN 1 ELSE 0 END AS GUK_RPRT_CNT   --국장(과장결재일 있고 국장종료일 없는것)
                      ,CASE WHEN DD.GUK_APV   IS NOT NULL   AND DD.CHA_APV   IS NULL THEN 1 ELSE 0 END AS CHA_RPRT_CNT   --차장(국장종료일 있고 차장종료일 없는것)
                      ,CASE WHEN DD.AUD_RPRT_STA_CD <> '30' AND DD.CHA_APV   IS NOT NULL AND DD.CHONG_APV IS NULL THEN 1 ELSE 0 END AS CHONG_RPRT_CNT --총장(차장종료일 있고,결재완료아니고 총장종료일 없는것)
                      ,CASE WHEN DD.AUD_RPRT_STA_CD = '30'                           THEN 1 ELSE 0 END AS WI_RPRT_CNT    --위원(감보 결재완료이고 위원종료일 없는것)
                      /*
                      ,DD.AUD_RPRT_DVSN_CD  --보고서구분코드
                      ,AA.AUD_KND_CD2       --감사종류2
                      ,CASE WHEN SUBSTR(AA.AUD_KND_CD,3,1) = '1' THEN TO_CHAR(BB.RETURN_DT-1+14+10+2+3+1+(DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0))  ,'YY-MM-DD') --재무
                            WHEN SUBSTR(AA.AUD_KND_CD,3,1) = '2' THEN TO_CHAR(BB.RETURN_DT-1+28+12+10+20+3+(DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0)),'YY-MM-DD') --특정
                            WHEN SUBSTR(AA.AUD_KND_CD,3,1) = '3' THEN TO_CHAR(BB.RETURN_DT-1+50+15+10+25+3+(DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0)),'YY-MM-DD') --성과
                            WHEN SUBSTR(AA.AUD_KND_CD,3,1) = '4' THEN TO_CHAR(BB.RETURN_DT-1+18+10+5+15+2+(DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0)) ,'YY-MM-DD') --기관
                            WHEN SUBSTR(AA.AUD_KND_CD,3,1) = '9' THEN TO_CHAR(BB.RETURN_DT-1+18+10+5+15+2+(DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0)) ,'YY-MM-DD') --서면=기관
                            ELSE NULL END AS FINAL_APV_DEADLINE     --최종 처리기한일
                      ,SYSDATE AS ASDFASDFASDF
                      */
                      /*
                      ,CASE WHEN DD.SBCN_GUBN = 'RE_SBCN' THEN 0    -- 재부의 제외
                                WHEN (CASE WHEN SUBSTR(AA.AUD_KND_CD,3,1) = '1' THEN BB.RETURN_DT-1+14+10+2+3+1+(DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0))   --재무
                                           WHEN SUBSTR(AA.AUD_KND_CD,3,1) = '2' THEN BB.RETURN_DT-1+28+12+10+20+3+(DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0)) --특정
                                           WHEN SUBSTR(AA.AUD_KND_CD,3,1) = '3' THEN BB.RETURN_DT-1+50+15+10+25+3+(DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0)) --성과
                                           WHEN SUBSTR(AA.AUD_KND_CD,3,1) = '4' THEN BB.RETURN_DT-1+18+10+5+15+2+(DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0))  --기관
                                           WHEN SUBSTR(AA.AUD_KND_CD,3,1) = '9' THEN BB.RETURN_DT-1+18+10+5+15+2+(DECODE(DD.SYT_TRTM_DVSN_YN,'Y',5,0))  --서면=기관
                                           ELSE NULL END
                                     ) < SYSDATE THEN 1
                                ELSE 0
                             END AS OVERDUE
                      */
                      ,CASE WHEN DD.SBCN_GUBN = 'RE_SBCN' THEN 0								-- 재부의 제외
                      			WHEN AA.EXCS_DT > 0 THEN 1
                      		ELSE 0
                      	END AS OVERDUE															-- (2019.04.05 LSR 수정)
                      ,DECODE(NVL(DD.AUD_RPRT_DVSN_CD,'10'),'10',0,1) AS ETC_TOTAL_CNT      
                      ,CASE WHEN DD.GWA_APV   IS NULL 
                                             AND CASE WHEN NVL(CC.E_CHA_KND,'0') <> '9' THEN TO_CHAR(CC.E_CHA_APV,'MM. DD')
                                                      WHEN NVL(CC.E_GUK_KND,'0') <> '9' THEN TO_CHAR(CC.E_GUK_APV,'MM. DD')
                                                      WHEN NVL(CC.E_GWA_KND,'0') <> '9' THEN TO_CHAR(CC.E_GWA_APV,'MM. DD')
                                                      ELSE '' END  IS NULL                       THEN DECODE(NVL(DD.AUD_RPRT_DVSN_CD,'10'),'10',0,1) ELSE 0 END AS ETC_END_RPRT_CNT
        			              ,CASE WHEN CASE WHEN NVL(CC.E_CHA_KND,'0') <> '9' THEN TO_CHAR(CC.E_CHA_APV,'MM. DD')
                                                  WHEN NVL(CC.E_GUK_KND,'0') <> '9' THEN TO_CHAR(CC.E_GUK_APV,'MM. DD')
                                                  WHEN NVL(CC.E_GWA_KND,'0') <> '9' THEN TO_CHAR(CC.E_GWA_APV,'MM. DD')
                                                  ELSE '' END IS NOT NULL AND DD.GWA_APV IS NULL THEN DECODE(NVL(DD.AUD_RPRT_DVSN_CD,'10'),'10',0,1) ELSE 0 END AS ETC_GWA_RPRT_CNT
                      ,CASE WHEN EE.RCPT_DH   IS NOT NULL   AND EE.SND_DH    IS NULL THEN DECODE(NVL(DD.AUD_RPRT_DVSN_CD,'10'),'10',0,1) ELSE 0 END AS ETC_PUM_RPRT_CNT
                      ,CASE WHEN DD.GWA_APV   IS NOT NULL   AND DD.GUK_APV   IS NULL THEN DECODE(NVL(DD.AUD_RPRT_DVSN_CD,'10'),'10',0,1) ELSE 0 END AS ETC_GUK_RPRT_CNT
                      ,CASE WHEN DD.GUK_APV   IS NOT NULL   AND DD.CHA_APV   IS NULL THEN DECODE(NVL(DD.AUD_RPRT_DVSN_CD,'10'),'10',0,1) ELSE 0 END AS ETC_CHA_RPRT_CNT
                      ,CASE WHEN DD.AUD_RPRT_STA_CD <> '30' AND DD.CHA_APV   IS NOT NULL AND DD.CHONG_APV IS NULL THEN DECODE(NVL(DD.AUD_RPRT_DVSN_CD,'10'),'10',0,1) ELSE 0 END AS ETC_CHONG_RPRT_CNT
                      ,CASE WHEN DD.AUD_RPRT_STA_CD = '30'                           THEN DECODE(NVL(DD.AUD_RPRT_DVSN_CD,'10'),'10',0,1) ELSE 0 END AS ETC_WI_RPRT_CNT			                     
                  FROM BASIS_INFO        AA --기본정보AA
                      ,BSRP_INFO         BB --출장정보BB
                      ,END_APV_INFO      CC --종료보고결재CC
                      ,AUD_RPRT_APV_INFO DD --감사보고서(위원) 결재정보DD
                      ,AUD_RPRT_SR_INFO  EE --감사보고서 품질접수발신일EE
                      ,AFF_CNT_INFO      GG --사건수GG
                 WHERE AA.AUD_YR = BB.AUD_YR(+) AND AA.AUD_NO = BB.AUD_NO(+)
                   AND AA.AUD_YR = CC.AUD_YR(+) AND AA.AUD_NO = CC.AUD_NO(+)
                   AND AA.AUD_YR = DD.AUD_YR(+) AND AA.AUD_NO = DD.AUD_NO(+)
                   AND DD.AUD_YR = EE.AUD_YR(+) AND DD.AUD_NO = EE.AUD_NO(+) AND DD.DOC_ID = EE.DOC_ID(+)
                   AND DD.AUD_YR = GG.AUD_YR(+) AND DD.AUD_NO = GG.AUD_NO(+) AND DD.DOC_ID = GG.DOC_ID(+)
                   AND BB.AUD_STR_DT02 IS NOT NULL                                   --실지감사 출장정보가 있는 감사
                   AND (CASE WHEN GG.REFER_DVSN_D10 =  0 THEN NVL(DD.WI_APV,TO_DATE('99991231'))    -- 부의건수가 없으면 위원결재일
                             WHEN GG.REFER_DVSN_D10 <> 0 THEN TO_DATE(NVL(GG.SBCN_DY,'99991231'))   -- 부의건수가 있으면 부의일
                             WHEN DD.SBCN_GUBN = 'RE_SBCN' THEN TO_DATE('99991231')                 -- 재부의는 AUD_RPRT_APV_INFO에 조건 포함
                             ELSE TO_DATE('99991231')
                              END) > SYSDATE
                   AND NVL(DD.USE_YN,'Y') <> 'N'
                   -- AND AA.DPT_SNO NOT IN ('530','640') --첨단,감찰 제외
                   AND TO_DATE(DECODE(BB.AUD_END_DT03,NULL,BB.AUD_END_DT02,BB.AUD_END_DT03)) < NEXT_DAY(NEXT_DAY(SYSDATE,'2'),'4') -- 조회일기준 다음주 수요일 이전 귀청건만 조회
                   AND (DD.DOC_ID IS NOT NULL -- 감사보고서 작성시 USE_YN으로 판단
                        OR (DD.DOC_ID IS NULL AND (CASE WHEN DD.SBCN_GUBN = 'RE_SBCN' THEN '1' ELSE AA.AUD_EXEC_HNDL_STA_CD END) != '9' ))  -- 감사보고서 미작성시 감사사항 종료여부로 판단
                   ]]>
                   <if test="hirkDptCd != null and hirkDptCd != '' ">
                   AND AA.HIRK_DPT_CD = #{hirkDptCd}
                   </if>
                   <![CDATA[
                UNION ALL
                SELECT S1.DPT_SNO,S1.DPT_CD,S1.DPT_NM,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
                  FROM TBDCMACM002M S1
                 WHERE S1.USE_YN         = 'Y'
                   AND S1.IMD_CD         = 'Y'
                   AND S1.ORZT_DVSN_CD   = '20'
                   AND S1.DPT_CD NOT IN ('100000','150000')
                   ]]>
                   <if test="hirkDptCd != null and hirkDptCd != '' ">
                   AND S1.HIRK_DPT_CD = #{hirkDptCd}
                   </if>
                   <![CDATA[
               ) Z
         GROUP BY Z.DPT_SNO,Z.DPT_NM
         ORDER BY Z.DPT_SNO
         ]]>
    </select>
    
        <select id="selectDptTrtmSituList" parameterType="paramMap" resultType="egovMap" >
            /* kr.go.bai.eip.aep.fer.dao.AEPFER004QMapper.selectDptTrtmSituList */
         <![CDATA[
      WITH BASIS_INFO AS (/* 기본정보AA : BASIS_INFO */
                          SELECT A1.AUD_YR  AS AUD_YR       --감사년도
                                   ,A1.AUD_NO AS AUD_NO       --감사번호
                                   ,A1.AUD_GRN_NO
                                   ,A1.AUD_KND_CD AS AUD_KND_CD   --감사종류코드(1:재무,2:특정,3:성과,4:기관,5:확인,9:서면)
                                   ,F_MNG_KND_AUDYRNO(A1.AUD_YR, A1.AUD_NO, A1.AUD_KND_CD, '-')  AS AUD_YR_NO    --분류번호   
                                   ,(SELECT T4.ABR_DPT_NM_1
                                      FROM TBDCMACM002M T4
                                     WHERE T4.DPT_CD = B.HIRK_DPT_CD
                                        AND T4.USE_YN = 'Y'
                                        AND ROWNUM = 1) AS HIRK_DPT_NM  --국
                                   ,B.HIRK_DPT_CD  AS HIRK_DPT_CD
                                   ,B.ABR_DPT_NM_1 AS AUD_DPT_NM   --과
                                   ,A1.AUD_SBJ_NM  AS AUD_SBJ_NM   --감사사항명
                                   ,F_CODE_NM('1000739', A1.AUD_KND_CD)  AS AUD_KND_NM   --종류코드2(1:민원2:국민3:공익4:국회5:심사6:재심8:손망9:판청)
                                   ,(SELECT A6.DVSN_CD
                                      FROM TBBADDED030L A6
                                     WHERE A6.AUD_YR = A1.AUD_YR
                                        AND A6.AUD_NO = A1.AUD_NO
                                        AND A6.SRNO = 1) AS AUD_KND_CD2  --종류코드2                                
                                   ,(SELECT NVL(A7.EXTN_PRD_COFM_DT,0)
                                      FROM TBBADDED003M A7
                                     WHERE A7.AUD_YR = A1.AUD_YR
                                        AND A7.AUD_NO = A1.AUD_NO) AS EXTN_PRD_COFM_DT  --연장승인일
                                   ,(SELECT T4.DPT_SNO
                                     FROM TBDCMACM002M T4
                                    WHERE T4.DPT_CD = B.HIRK_DPT_CD
                                       AND T4.USE_YN = 'Y'
                                       AND ROWNUM = 1)   AS DPT_SNO --상위부서의 DPT_SNO
                                   ,B.HIRK_DPT_CD AS DPT_CD
                                   ,(SELECT T4.ABR_DPT_NM_1
                                     FROM TBDCMACM002M T4
                                    WHERE T4.DPT_CD = B.HIRK_DPT_CD
                                       AND T4.USE_YN = 'Y'
                                       AND ROWNUM = 1)   AS DPT_NM --상위부서의 DPT_NM
                                   ,(SELECT MAX(TO_CHAR(TO_DATE(A9.EXAM_RPT_APV_DT),'YYYY-MM-DD')) AS EXAM_RPT_APV_DT
                                       FROM TBBADDED030L A8
                                               INNER JOIN TBCSPEAR001M A9
                                                          ON  A9.ACP_YR  = A8.TSK_KEY1
                                                         AND A9.REQ_DVSN_CD = A8.TSK_KEY2
                                                         AND A9.CVPT_ACP_NO = A8.TSK_KEY3
                                       WHERE A8.AUD_YR = A1.AUD_YR
                                          AND A8.AUD_NO  =A1.AUD_NO) AS EXAM_RPT_APV_DT --감사실시여부검토일
                                   ,(SELECT MAX(
                                             CASE WHEN A9.TSK_KEY2 IN ('2', '3')  THEN (SELECT CASE WHEN A10.EXAM_RPT_APV_DT IS NOT NULL AND A10.REQ_EXAM_RSLT_CD = '01' THEN TO_CHAR(TO_DATE(A10.EXAM_RPT_APV_DT), 'YYYY-MM-DD')
                                                                                                               WHEN  A10.EXAM_RPT_APV_DT IS NULL OR A10.REQ_EXAM_RSLT_CD <> '01' THEN ''
                                                                                                                 ELSE '' END
                                                                                               FROM TBCSPEAR001M A10 
                                                                                             WHERE A10.ACP_YR  = A9.TSK_KEY1
                                                                                               AND A10.REQ_DVSN_CD = A9.TSK_KEY2
                                                                                               AND A10.CVPT_ACP_NO = A9.TSK_KEY3  )                                                 
                                                    WHEN A9.TSK_KEY2 = '4' THEN (SELECT  CASE WHEN A10.EXTN_YN = 'Y' THEN A10.EXTN_HNDL_DDLN_DT 
                                                                                                               ELSE A10.HNDL_DDLN_DT END 
                                                                                               FROM TBCSPEAR007M A10
                                                                                              WHERE  A10.ACP_YR  = A9.TSK_KEY1
                                                                                                 AND A10.REQ_DVSN_CD = A9.TSK_KEY2
                                                                                                 AND A10.CVPT_ACP_NO = A9.TSK_KEY3  )
                                                              ELSE '' END ) AS HNDL_DDLN_DT2
                                       FROM TBBADDED030L A9
                                     WHERE A9.AUD_YR     = A1.AUD_YR
                                        AND A9.AUD_NO     = A1.AUD_NO ) AS HNDL_DDLN_DT2 --감사처리기한
                                     ,(SELECT MAX(CASE  WHEN A9.TSK_KEY2 = '4' THEN (SELECT  A10.EXTN_YN
                                                                                                         FROM TBCSPEAR007M A10
                                                                                                        WHERE A10.ACP_YR  = A9.TSK_KEY1
                                                                                                           AND A10.REQ_DVSN_CD = A9.TSK_KEY2
                                                                                                           AND A10.CVPT_ACP_NO = A9.TSK_KEY3  )
                                                              ELSE '' END ) AS EXTN_YN
                                       FROM TBBADDED030L A9
                                     WHERE A9.AUD_YR     = A1.AUD_YR
                                        AND A9.AUD_NO     = A1.AUD_NO ) AS EXTN_YN  --국회 청구 연장여부
                                     ,(SELECT MAX(CASE  WHEN A9.TSK_KEY2 = '4' THEN (SELECT  A10.REQ_DT
                                                                                                         FROM TBCSPEAR007M A10
                                                                                                        WHERE A10.ACP_YR  = A9.TSK_KEY1
                                                                                                           AND A10.REQ_DVSN_CD = A9.TSK_KEY2
                                                                                                           AND A10.CVPT_ACP_NO = A9.TSK_KEY3  )
                                                              ELSE '' END ) AS REQ_DT
                                       FROM TBBADDED030L A9
                                     WHERE A9.AUD_YR     = A1.AUD_YR
                                        AND A9.AUD_NO     = A1.AUD_NO ) AS REQ_DT  --국회 청구 연장여부
                                    , C.AUD_EXEC_HNDL_STA_CD
                                    , B.SRT_SNO
                                    , C.GNR_HNDL_PLAN_YN
                                    , C.HNDL_DDLN_DT				-- 2019.04.05 LSR 추가
                                    , C.RPT_DDLN_DT					-- 2019.04.05 LSR 추가
									, C.BRDV_HNDL_DDLN_DT			-- 2019.04.05 LSR 추가
									, C.MDT_CHGR_APV_DDLN_DT		-- 2019.04.05 LSR 추가
									, C.MDT_OFER_APV_DDLN_DT		-- 2019.04.05 LSR 추가
									, C.RVW_RM_APV_DDLN_DT			-- 2019.04.05 LSR 추가
									, C.TOT_DHD_APV_DDLN_DT			-- 2019.04.05 LSR 추가
									, C.DHD_APV_DDLN_DT				-- 2019.04.05 LSR 추가
									, C.PSD_APV_DDLN_DT				-- 2019.04.05 LSR 추가
									, C.CHF_CMTR_APV_DDLN_DT		-- 2019.04.05 LSR 추가
									, C.ENF_APV_DDLN_DT				-- 2019.04.05 LSR 추가
                                    , C.EXTN_HNDL_DDLN_DT			-- 2019.04.05 LSR 추가
									, C.EXTN_RPT_DDLN_DT			-- 2019.04.05 LSR 추가
									, C.EXTN_BRDV_HNDL_DDLN_DT		-- 2019.04.05 LSR 추가
									, C.EXTN_MDT_CHGR_APV_DDLN_DT	-- 2019.04.05 LSR 추가
									, C.EXTN_MDT_OFER_APV_DDLN_DT	-- 2019.04.05 LSR 추가
									, C.EXTN_RVW_RM_APV_DDLN_DT		-- 2019.04.05 LSR 추가
									, C.EXTN_TOT_DHD_APV_DDLN_DT	-- 2019.04.05 LSR 추가
									, C.EXTN_DHD_APV_DDLN_DT		-- 2019.04.05 LSR 추가
									, C.EXTN_PSD_APV_DDLN_DT		-- 2019.04.05 LSR 추가
									, C.EXTN_CHF_CMTR_APV_DDLN_DT	-- 2019.04.05 LSR 추가
									, C.EXTN_ENF_APV_DDLN_DT		-- 2019.04.05 LSR 추가
                               		, C.PSD_APV_DDLN_DT AS TOT_DHD_DVS_CD	-- 총,차장 단계 분리 구분 (2019.04.18 LSR 수정)
                         	        , NVL(NVL(TO_DATE(C.ENF_APV_DT), TO_DATE(TO_CHAR(SYSDATE, 'YYYY/MM/DD'))) - (NVL(TO_DATE(C.EXTN_HNDL_DDLN_DT), TO_DATE(C.HNDL_DDLN_DT))), 0) EXCS_DT		-- 초과일수 (시행결재일 - 처리기한일) 2019.04.05 LSR 추가
                         	        ,(SELECT COUNT(*) FROM TBBADDED103M A 
                                                             INNER JOIN TBDCMACM023H B 
                                                                     ON A.APV_RQS_ID = B.APV_DOC_NO AND B.APVR_KND_CD = 1 AND B.APVR_STA_CD = '201' 
                                        WHERE 1=1
                                          AND A.AUD_YR = A1.AUD_YR
                                          AND A.AUD_NO  = A1.AUD_NO
                                          AND A.RPRT_CD = 'A10600200'
                                          AND A.AUD_RPRT_DVSN_CD = '10'
                                          AND A.AUD_STEP_CD = 'A1060') AS CNT
                                  FROM TBBADDED001M A1 
                                           INNER JOIN TBDCMACM002M B
                                                     ON B.DPT_CD = A1.MNG_DPT_CD
                                                    AND B.USE_YN = 'Y'
                                           INNER JOIN TBBADDED003M C
                                                      ON A1.AUD_YR = C.AUD_YR
                                                    AND A1.AUD_NO = C.AUD_NO
                                 WHERE 1=1
                             AND A1.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr} --PARAM
                             AND NVL(A1.SEC_AUD_YN, 'N') <> 'Y'
                             AND SUBSTR(A1.AUD_KND_CD,3,1) <> '5' --확인출장제외
                         ),
           BSRP_INFO AS (/* 출장정보BB : BSRP_INFO */
                          SELECT B2.REL_AUD_YR AS AUD_YR
                                ,B2.REL_AUD_NO AS AUD_NO
                                ,MIN(B2.AUD_STR_DT00) AS AUD_STR_DT00 --자료수집 시작일
                                ,MAX(B2.AUD_END_DT00) AS AUD_END_DT00 --자료수집 종료일
                                      ,SUM(B2.AUD_DCN00)    AS AUD_DCN00    --자료수집 출장일수
                                ,MIN(B2.AUD_STR_DT01) AS AUD_STR_DT01 --예비조사 시작일
                                ,MAX(B2.AUD_END_DT01) AS AUD_END_DT01 --예비조사 종료일
                                      ,SUM(B2.AUD_DCN01)    AS AUD_DCN01    --예비조사 출장일수
                                ,MIN(B2.AUD_STR_DT02) AS AUD_STR_DT02 --실지감사 시작일
                                ,MAX(B2.AUD_END_DT02) AS AUD_END_DT02 --실지감사 종료일
                                      ,SUM(B2.AUD_DCN02)    AS AUD_DCN02    --실지감사 출장일수
                                ,MIN(B2.AUD_STR_DT03) AS AUD_STR_DT03 --실지감사연장 시작일
                               ,CASE WHEN MAX(B2.AUD_END_DT02) > MAX(B2.AUD_END_DT03) THEN MAX(B2.AUD_END_DT02)
                                          ELSE MAX(B2.AUD_END_DT03) END AS AUD_END_DT03 --실지감사연장 종료일
                                      ,SUM(B2.AUD_DCN03)    AS AUD_DCN03    --실지감사연장 출장일수
                                ,DECODE(MAX(B2.AUD_END_DT03),NULL,MAX(B2.AUD_END_DT02)+1,MAX(B2.AUD_END_DT03)+1) AS RETURN_DT  --귀청일
                                ,(SELECT SUM((NVL(TRUNC((TO_DATE(TO_CHAR(TO_DATE(B3.AUD_END_DT), 'YYYYMMDD'))- TO_DATE(TO_CHAR(TO_DATE(B3.AUD_STR_DT) , 'YYYYMMDD'))) +1,0),0)))
                                    FROM TBBADDED002M B3
                                   WHERE B3.REL_AUD_YR = B2.REL_AUD_YR
                                     AND B3.REL_AUD_NO = B2.REL_AUD_NO
                                     AND B3.AUD_BZT_KND_CD IN ('02','03')) AS AUD_BSRP_SUM
                            FROM (SELECT B1.REL_AUD_YR,B1.REL_AUD_NO
                                        ,DECODE(B1.AUD_BZT_KND_CD,'00',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT00
                                        ,DECODE(B1.AUD_BZT_KND_CD,'00',TO_DATE(AUD_END_DT)) AS AUD_END_DT00
                                        ,DECODE(B1.AUD_BZT_KND_CD,'00',AUD_DCN            ) AS AUD_DCN00
                                        ,DECODE(B1.AUD_BZT_KND_CD,'01',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT01
                                        ,DECODE(B1.AUD_BZT_KND_CD,'01',TO_DATE(AUD_END_DT)) AS AUD_END_DT01
                                        ,DECODE(B1.AUD_BZT_KND_CD,'01',AUD_DCN            ) AS AUD_DCN01
                                        ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT02
                                        ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_END_DT)) AS AUD_END_DT02
                                        ,DECODE(B1.AUD_BZT_KND_CD,'02',AUD_DCN            ) AS AUD_DCN02
                                        ,DECODE(B1.AUD_BZT_KND_CD,'03',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT03
                                        ,DECODE(B1.AUD_BZT_KND_CD,'03',TO_DATE(AUD_END_DT)) AS AUD_END_DT03
                                        ,DECODE(B1.AUD_BZT_KND_CD,'03',AUD_DCN            ) AS AUD_DCN03
                                    FROM TBBADDED002M B1
                                    INNER JOIN TBBADDED001M B2
                                           ON B1.REL_AUD_YR = B2.AUD_YR
                                           AND B1.REL_AUD_NO = B2.AUD_NO 
                                   WHERE B2.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr} --PARAM
                                       AND B2.AUD_KND_CD NOT LIKE '%5'
                                 ) B2
                           GROUP BY B2.REL_AUD_YR,B2.REL_AUD_NO
                                 UNION ALL
                                SELECT D.AUD_YR AS AUD_NO
                                      ,D.AUD_NO AS AUD_NO
                                      ,NULL AS AUD_STR_DT00 --자료수집 시작일
                                      ,NULL AS AUD_END_DT00 --자료수집 종료일
                                      ,NULL AS AUD_DCN00    --자료수집 출장일수
                                      ,NULL AS AUD_STR_DT01 --예비조사 시작일
                                      ,NULL AS AUD_END_DT01 --예비조사 종료일
                                      ,NULL AS AUD_DCN01    --예비조사 출장일수
                                      ,MIN(TO_DATE(A.AUD_STR_DT)) AS AUD_STR_DT02 --실지감사 시작일
                                      ,MAX(TO_DATE(A.AUD_END_DT)) AS AUD_END_DT02 --실지감사 종료일
                                      ,SUM(A.AUD_DCN)    AS AUD_DCN02    --실지감사 출장일수
                                      ,NULL AS AUD_STR_DT03 --실지감사연장 시작일
                                      ,NULL AS AUD_END_DT03 --실지감사연장 종료일
                                      ,NULL AS AUD_DCN03    --실지감사연장 출장일수
                                      ,MAX(TO_DATE(A.AUD_END_DT))+1 AS RETURN_DT  --귀청일
                                      ,MAX(TO_DATE(A.AUD_END_DT)) - MIN(TO_DATE(A.AUD_STR_DT)) AS AUD_BSRP_SUM
                                 FROM TBBADDED101L D
                                      INNER JOIN TBBADDED001M B
                                                 ON (D.AUD_YR  = B.AUD_YR AND D.AUD_NO = B.AUD_NO)
                                      LEFT OUTER JOIN TBBADDED002M A
                                                 ON (A.REL_AUD_YR = D.REL_AUD_YR AND A.REL_AUD_NO = D.REL_AUD_NO AND A.BZT_DVSN_CD = 1)
                               WHERE B.AUD_KND_CD LIKE '%9'   --서면감사인 경우에만 자료수집 건을 출장정보로 설정함
                                  AND B.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr} 
                                GROUP BY D.AUD_YR, D.AUD_NO
			                    ),
			      END_APV_INFO AS (/* 종료보고결재CC : END_APV_INFO */
			                      SELECT C1.AUD_YR
			                            ,C1.AUD_NO
			                            ,MIN(DECODE(C2.APVR_PST_CD,'0013600', C2.APV_DH, '0057400',C2.APV_DH, '0035400',C2.APV_DH, ''))   AS E_GWA_APV      --과장결재일
			                            ,MIN(DECODE(C2.APVR_PST_CD,'0015800',C2.APV_DH
			                                ,DECODE(C2.APVR_PST_CD,'0035100',C2.APV_DH
			                                ,DECODE(C2.APVR_PST_CD,'0058100',C2.APV_DH,'')))) AS E_GUK_APV      --국장결재일(국장:0015800,단장:0035100,실장:0058100)
			                            ,MIN(DECODE(C2.APVR_PST_CD,'0055600',C2.APV_DH
			                                ,DECODE(C2.APVR_PST_CD,'0045900',C2.APV_DH
			                                ,DECODE(C2.APVR_PST_CD,'0058100',C2.APV_DH,''))))  AS E_CHA_APV      --차장결재일(차장:0055600,본부장:0045900, 실장 : 0058100)
			                            ,MIN(DECODE(C2.APVR_PST_CD,'0055700',C2.APV_DH,''))   AS E_CHONG_APV    --총장결재일
			                            ,MIN(DECODE(C2.APVR_PST_CD,'0067400',C2.APV_DH,''))   AS E_WON_APV      --원장결재일
			                            ,MAX(DECODE(C1.APV_STA_CD,'30',C2.APV_DH,''))         AS E_FNL_APV      --최종결재일
			                            ,MAX(C1.APV_STA_CD)                                   AS APV_STA_CD     --결재상태
                                        ,MIN(DECODE(C2.APVR_PST_CD,'0013600',C2.APVR_KND_CD,'0057400',C2.APVR_KND_CD,'0035400',C2.APVR_KND_CD,''))   AS E_GWA_KND      
                                        ,MIN(DECODE(C2.APVR_PST_CD,'0015800',C2.APVR_KND_CD
                                            ,DECODE(C2.APVR_PST_CD,'0035100',C2.APVR_KND_CD
                                            ,DECODE(C2.APVR_PST_CD,'0058100',C2.APVR_KND_CD,'')))) AS E_GUK_KND      
                                        ,MIN(DECODE(C2.APVR_PST_CD,'0055600',C2.APVR_KND_CD
                                            ,DECODE(C2.APVR_PST_CD,'0045900',C2.APVR_KND_CD,'')))  AS E_CHA_KND      
                                        ,MIN(DECODE(C2.APVR_PST_CD,'0055700',C2.APVR_KND_CD,''))   AS E_CHONG_KND  
			                        FROM TBBADDED103M C1
			                            ,TBDCMACM023H C2
			                       WHERE 1=1
			                         AND C1.APV_RQS_ID  = C2.APV_DOC_NO
			                         AND C2.APVR_STA_CD <> '401'
			                         AND C1.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr}  --PARAM
			                         AND C1.RPRT_CD     = 'A10500200' --종료보고서
			                       GROUP BY C1.AUD_YR,C1.AUD_NO
			                      ),
			     AUD_RPRT_APV_INFO AS (/* 감사보고서(위원) 결재정보DD : AUD_RPRT_APV_INFO */
			                           SELECT D3.AUD_YR
			                                 ,D3.AUD_NO
			                                 ,D3.AUD_RPRT_DVSN_CD      AS AUD_RPRT_DVSN_CD
			                                 ,D3.DOC_ID                AS DOC_ID
			                                 ,MIN(D3.GWA_APV)          AS GWA_APV
			                                 ,MIN(D3.GUK_APP)          AS GUK_APP
			                                 ,MIN(D3.GUK_APV)          AS GUK_APV
			                                 ,MIN(D3.CHA_APP)          AS CHA_APP
			                                 ,MIN(D3.CHA_APV)          AS CHA_APV
			                                 ,MIN(D3.CHONG_APP)        AS CHONG_APP
			                                 ,MIN(D3.CHONG_APV)        AS CHONG_APV
			                                 ,MAX(D3.FNL_APV)          AS FNL_APV
			                                 ,MIN(D3.WI_APP)           AS WI_APP
			                                 ,MIN(D3.WI_APV)           AS WI_APV
			                                 ,MAX(D3.SYT_TRTM_DVSN_YN) AS SYT_TRTM_DVSN_YN
			                                 ,MAX(D3.USE_YN)           AS USE_YN
			                                 ,MAX(D3.AUD_RPRT_STA_CD)  AS AUD_RPRT_STA_CD
			                                 ,MAX(D3.WI_RPRT_STA_CD)   AS WI_RPRT_STA_CD
			                             FROM (
			                                   SELECT D1.AUD_YR
			                                         ,D1.AUD_NO
			                                         ,D1.AUD_RPRT_DVSN_CD
			                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' THEN D1.DOC_ID
			                                               ELSE D1.REF_ID
			                                                END AS DOC_ID
			                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND (D2.APVR_PST_CD = '0013600' OR D2.APVR_PST_CD = '0057400' OR D2.APVR_PST_CD = '0035400') AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS GWA_APV   --과장결재일
			                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ, D2.APV_SNO)
			                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ, D2.APV_SNO)
			                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ, D2.APV_SNO)
			                                               ELSE NULL
			                                                END AS GUK_APP   --국단실장접수일
			                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS GUK_APV   --국단실장결재일
			                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ, D2.APV_SNO)
			                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ, D2.APV_SNO)
			                                               ELSE NULL
			                                                END AS CHA_APP   --차장,본부장 접수일
			                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS CHA_APV   --차장,본부장 결재일
			                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ, D2.APV_SNO)
			                                               ELSE NULL
			                                                END AS CHONG_APP --사무총장접수일
			                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS CHONG_APV --사무총장결재일
			                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D1.APV_STA_CD = '30' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS FNL_APV   --최종결재일
			                                         ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ,D2.APV_DH DESC)
			                                               ELSE NULL
			                                                END AS WI_APP    --주심위원접수일
			                                         ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS WI_APV    --주심위원결재일
			                                         ,D1.SYT_TRTM_DVSN_YN
			                                         ,D1.USE_YN
			                                         ,DECODE(D1.RPRT_CD,'A10600200',D1.APV_STA_CD ) AS AUD_RPRT_STA_CD
			                                         ,DECODE(D1.RPRT_CD,'A10700100',D1.APV_STA_CD ) AS WI_RPRT_STA_CD
			                                         FROM TBBADDED103M D1
			                                         , (SELECT A.SEQ
                                                              ,A.APV_DOC_NO
                                                              ,A.APVR_PST_CD
                                                              ,A.APVR_KND_CD
                                                              ,A.APVR_STA_CD
                                                              ,A.APV_DH
                                                              ,A.APV_DVSN_CD
                                                              ,A.APVR_CNB
                                                              ,A.APV_SNO
                                                          FROM TBDCMACM023H A
                                                        UNION ALL
                                                        SELECT 9999999999 AS SEQ
                                                              ,B.APV_DOC_NO
                                                              ,B.APVR_PST_CD
                                                              ,B.APVR_KND_CD
                                                              ,B.APVR_STA_CD
                                                              ,B.APV_DH
                                                              ,B.APV_DVSN_CD
                                                              ,B.APVR_CNB
                                                              ,B.APV_SNO
                                                          FROM TBDCMACM023L B
                                                         WHERE B.APVR_STA_CD IN ('102','103', '206', '106')
                                                          AND B.APVR_KND_CD <> 6
                                                           AND NOT EXISTS (SELECT 'X'
                                                                             FROM TBDCMACM023H S
                                                                            WHERE S.APV_DOC_NO  = B.APV_DOC_NO 
                                                                              AND S.APV_DVSN_CD = B.APV_DVSN_CD
                                                                              AND S.APVR_CNB    = B.APVR_CNB   
                                                                      )
                                                         ORDER BY SEQ) D2
			                                    WHERE 1=1
			                                      AND D1.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr} --PARAM
			                                      AND   D1.AUD_RPRT_DVSN_CD IN ('10','20','30') --재부의 제외
			                                      AND D1.RPRT_CD          IN ('A10600200','A10700100') --감사보고서,주심위원설명자료	
			                                      AND D1.APV_RQS_ID = D2.APV_DOC_NO
			                                      AND D2.APVR_KND_CD      IN ('2','3','9')   --공석추가
			                                    ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ/*D2.APV_SNO,D2.APVR_SEQ*/
			                                   ) D3
			                            GROUP BY D3.AUD_YR,D3.AUD_NO,D3.AUD_RPRT_DVSN_CD,D3.DOC_ID
			                           ),
			     AUD_RPRT_SR_INFO AS (/* 감사보고서 품질접수발신일EE : AUD_RPRT_SR_INFO */
			                          SELECT E1.AUD_YR
			                                ,E1.AUD_NO
			                                ,E1.DOC_ID
			                                ,MAX(DECODE(E1.RPRT_CD,'A10600200',E1.RCPT_DH)) AS RCPT_DH
			                                ,MAX(DECODE(E3.APV_STA_CD,'30',(SELECT MAX(E4.APV_DH)
			                                                                  FROM TBDCMACM023H E4
			                                                                 WHERE E4.APV_DOC_NO = E3.APV_RQS_ID
			                                                                   AND E4.APVR_STA_CD <> '201'
			                                                                   AND E4.APVR_STA_CD LIKE '20%'
			                                                               ),NULL)) AS SND_DH
			                            FROM TBBADDED111M E1
			                                ,TBBADDED145M E2
			                                ,TBBADDED103M E3
			                           WHERE 1=1
			                             AND E1.AUD_YR  = E2.AUD_YR
			                             AND E1.AUD_NO  = E2.AUD_NO
			                             AND E1.DOC_ID  = E2.DOC_ID
			                             AND E1.AUD_YR  = E3.AUD_YR
			                             AND E1.AUD_NO  = E3.AUD_NO
			                             AND TO_CHAR(E2.AFF_SNO) = E3.REF_ID
			                             AND E1.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr}       --PARAM
			                             --AND E1.AUD_RPRT_DVSN_CD = '10'         --감사보고서구분코드(10:본안,20:우선,30:별도,40:재부의)
			                             AND E1.RPRT_CD          = 'A10600200'  --감사보고서
			                             AND E2.APVR_CD          IN ( '0013600', '0057400', '0035400')     --과장사건
			                             AND E3.RPRT_CD          = 'A10600500'  --처리안검토의견서
			                           GROUP BY E1.AUD_YR,E1.AUD_NO,E1.DOC_ID
			                         ),
			     CHF_CMTR_INFO AS (/* 주심위원FF : CHF_CMTR_INFO */
			                        SELECT B.AUD_YR
			                              ,B.AUD_NO
                                          ,B.DOC_ID
			                              ,B.CHF_CMTR_NM||DECODE(B.CHF_CMTR_CNT,0,'',' 외'||B.CHF_CMTR_CNT) AS CHF_CMTR_NM
			                          FROM (SELECT A.AUD_YR
			                                      ,A.AUD_NO
                                                  ,A.DOC_ID
			                                      ,(SELECT T1.USR_NAM
														FROM TBDCMACM001M T1
														WHERE T1.CNB = A.CHF_CMTR_CNB
														  AND ROWNUM = 1)  AS CHF_CMTR_NM
			                                      ,DECODE(CHF_CMTR1_CNB, NULL, 0, 1)
			                                      +DECODE(CHF_CMTR2_CNB, NULL, 0, 1)
			                                      +DECODE(CHF_CMTR3_CNB, NULL, 0, 1)
			                                      +DECODE(CHF_CMTR4_CNB, NULL, 0, 1)
			                                      +DECODE(CHF_CMTR5_CNB, NULL, 0, 1) AS CHF_CMTR_CNT
			                                  FROM TBBADDED116L A
			                                 WHERE 1=1
			                                   AND A.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr} --PARAM
			                                   AND A.TASK_DVSN_CD = '9'
			                                   AND A.SRNO = (SELECT MAX(C.SRNO) FROM TBBADDED116L C
			                                                  WHERE C.AUD_YR = A.AUD_YR
			                                                    AND C.AUD_NO = A.AUD_NO
                                                                AND C.DOC_ID = A.DOC_ID
			                                                )
			                               ) B
			                      ),
			     AFF_CNT_INFO AS (/* 사건정보GG : AFF_CNT_INFO */
			                      SELECT A.AUD_YR
			                            ,A.AUD_NO
			                            ,A.DOC_ID
			                            ,SUM(CASE WHEN A.FNL_YN= 'Y' AND A.REFER_DVSN_CD = 'D10' THEN 1 ELSE 0 END) AS REFER_DVSN_D10   --부의
			                            ,SUM(CASE WHEN A.FNL_YN= 'Y' AND A.REFER_DVSN_CD = 'E10' THEN 1 ELSE 0 END) AS REFER_DVSN_E10   --위임
			                            ,MIN(C.SBCN_DY) AS SBCN_DY  --최초부의일
			                            ,MIN(E.ENF_DT)  AS ENF_DT   --최초시행일
			                        FROM TBBADDED145M A
			                            ,TBBADDED146M B
			                            ,TBBADDED113M C
			                            ,(SELECT A7.AUD_YR
			                                    ,A7.AUD_NO
			                                    ,'A1070' AS APVR_CD
			                                    ,A7.AUD_DSP_RQ_SNO
			                                    ,A3.ENF_DT
			                                FROM TBBADEAR001M A7
			                                    ,TBBADEAR002D A3
			                               WHERE A7.AUD_YR      = A3.AUD_YR
			                                 AND A7.AUD_NO      = A3.AUD_NO
			                                 AND A7.DSP_RQ_SNO  = A3.DSP_RQ_SNO
			                             ) E
			                       WHERE 1=1
			                         AND A.AUD_YR      = B.AUD_YR
			                         AND A.AUD_NO      = B.AUD_NO
			                         AND A.AUD_STEP_CD = B.AUD_STEP_CD
			                         AND A.DOC_ID      = B.DOC_ID
			                         AND A.APVR_CD     = B.APVR_CD
			                         AND A.AFF_SNO     = B.AFF_SNO
			                         AND B.DSP_RQ_CD NOT IN ('390','391','395','396','490','495','730')
			                         AND B.AUD_YR      = C.AUD_YR(+)
			                         AND B.AUD_NO      = C.AUD_NO(+)
			                         AND B.DOC_ID      = C.DOC_ID(+)
			                         AND B.APVR_CD     = C.APVR_CD(+)
			                         AND B.AFF_SNO     = C.AFF_SNO(+)
			                         AND B.DSP_RQ_SNO  = C.DSP_RQ_SNO(+)
			                         AND B.AUD_YR      = E.AUD_YR(+)
			                         AND B.AUD_NO      = E.AUD_NO(+)
			                         AND B.APVR_CD     = E.APVR_CD(+)
			                         AND B.DSP_RQ_SNO  = E.AUD_DSP_RQ_SNO(+)
			                         AND A.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr}
			                       GROUP BY A.AUD_YR,A.AUD_NO,A.DOC_ID
			                       ORDER BY A.AUD_YR,A.AUD_NO,A.DOC_ID
			                     )
			/***************************** 국과별 처리상황 S***********************************/
			SELECT '1' AS GUBN
			      ,AA.DPT_SNO
			--      ,AA.AUD_YR
			--      ,AA.AUD_NO
			      ,AA.AUD_YR_NO
			      ,DD.DOC_ID
			      ,AA.AUD_DPT_NM
			      ,AA.AUD_SBJ_NM
			      ,AA.AUD_KND_NM
                  ,DD.AUD_RPRT_DVSN_CD
			      ,(SELECT T1.CD_NM
					 FROM TBDCMACM013C T1
					WHERE T1.CMM_CD_DVSN_CD = '1000788'
					  AND T1.CD = DD.AUD_RPRT_DVSN_CD
					  AND ROWNUM = 1)||CHR(13)||
					   (CASE WHEN DD.AUD_RPRT_DVSN_CD = '10' AND  AA.GNR_HNDL_PLAN_YN = 'Y' THEN '(종합)' 
					          WHEN  DD.AUD_RPRT_DVSN_CD <> '10' AND DD.SYT_TRTM_DVSN_YN = 'Y'  THEN '(종합)'
                              WHEN DD.AUD_RPRT_DVSN_CD = '10' AND  AA.GNR_HNDL_PLAN_YN = 'N' THEN '(개별)' 
					          WHEN  DD.AUD_RPRT_DVSN_CD <> '10' AND DD.SYT_TRTM_DVSN_YN = 'N'  THEN '(개별)'
					          ELSE '' END ) AS AUD_RPRT_DVSN_NM --보고서구분
			      ,(CASE WHEN AA.AUD_KND_CD2 IN ('2','3', '4') THEN (SELECT T1.CD_NM
 					                                                                  FROM TBDCMACM013C T1
  					                                                                 WHERE T1.CMM_CD_DVSN_CD = '1000742'
					                                                                    AND T1.CD = AA.AUD_KND_CD2
					                                                                    AND ROWNUM = 1)  
					       ELSE '' END) AS AUD_KND_CD3
			      ,(SELECT T1.CD_NM
					 FROM TBDCMACM013C T1
					WHERE T1.CMM_CD_DVSN_CD = '1000742'
					  AND T1.CD = AA.AUD_KND_CD2
					  AND ROWNUM = 1)||DECODE(AA.EXTN_YN ,'Y', '(연장)')   AS AUD_KND_CD2
                  ,DECODE(AA.HNDL_DDLN_DT2,NULL,'',CHR(39) || TO_CHAR(TO_DATE(AA.HNDL_DDLN_DT2),'YY. MM. DD')) AS AUD_DVSN_PROC_DT --청구국회처리기한(2:국민3:공익4:국회)
			      ,CASE WHEN AA.DPT_SNO = '420' THEN DECODE(AA.EXAM_RPT_APV_DT,NULL,'',CHR(39) || TO_CHAR(TO_DATE(AA.EXAM_RPT_APV_DT),'YY. MM. DD'))
                        WHEN AUD_STR_DT01 IS NULL THEN ''
			      		ELSE CHR(39) || TO_CHAR(BB.AUD_STR_DT01,'YY. MM. DD') 
			      	END                                       								AS AUD_STR_DT01     --예비조사시작
			      ,CASE WHEN BB.AUD_STR_DT02 IS NULL THEN ''
			            ELSE CHR(39) || TO_CHAR(BB.AUD_STR_DT02,'YY. MM. DD') 
                             ||' ~ '||CHR(13)||CHR(10)|| CHR(39) || TO_CHAR(DECODE(BB.AUD_END_DT03,NULL,BB.AUD_END_DT02,BB.AUD_END_DT03),'YY. MM. DD')
			                 ||' ('||TO_CHAR(NVL(AUD_DCN02,0)+NVL(AUD_DCN03,0))||'일)'
			             END                                                                        AS AUD_STR_DT02     --실지감사 실시기간
                  ,CASE WHEN NVL(CC.E_CHA_KND,'0') <> '9' THEN TO_CHAR(CC.E_CHA_APV,'MM. DD')
                        WHEN NVL(CC.E_GUK_KND,'0') <> '9' THEN TO_CHAR(CC.E_GUK_APV,'MM. DD')
                        WHEN NVL(CC.E_GWA_KND,'0') <> '9' THEN TO_CHAR(CC.E_GWA_APV,'MM. DD')
                        ELSE '' END                                                               AS E_CHA_APV        --종료보고차장결재
                  ,CASE WHEN  BB.AUD_STR_DT02 IS NULL AND CC.E_GWA_APV IS NULL AND  SUBSTR(AA.AUD_KND_CD, 3, 1)  = '9'  THEN DECODE(DD.GWA_APV, NULL, '검토중', TO_CHAR(DD.GWA_APV  ,'MM. DD')) 
                          WHEN  BB.AUD_STR_DT02 IS NOT NULL AND CC.E_GWA_APV IS NULL AND  SUBSTR(AA.AUD_KND_CD, 3, 1)  = '9'  THEN DECODE(DD.GWA_APV, NULL, '검토중', TO_CHAR(DD.GWA_APV  ,'MM. DD')) 
                            ELSE  DECODE(CASE WHEN NVL(CC.E_CHA_KND,'0') <> '9' THEN TO_CHAR(CC.E_CHA_APV,'MM. DD')
                                                      WHEN NVL(CC.E_GUK_KND,'0') <> '9' THEN TO_CHAR(CC.E_GUK_APV,'MM. DD')
                                                      WHEN NVL(CC.E_GWA_KND,'0') <> '9' THEN TO_CHAR(CC.E_GWA_APV,'MM. DD')
                                                        ELSE '' END , NULL, '', DECODE(DD.GWA_APV, NULL, '검토중', TO_CHAR(DD.GWA_APV  ,'MM. DD'))) 
                             END    AS GWA_APV          --과장결재(서면감사이면서 출장정보가 없고 종료보고서가 없을때 추가 2018.05.25 CJLEE)
			      ,CASE WHEN EE.RCPT_DH IS     NULL AND EE.SND_DH IS     NULL THEN ''
			            WHEN EE.RCPT_DH IS NOT NULL AND EE.SND_DH IS     NULL THEN TO_CHAR(EE.RCPT_DH,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||'검토중'
			            WHEN EE.RCPT_DH IS NOT NULL AND EE.SND_DH IS NOT NULL THEN TO_CHAR(EE.RCPT_DH,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||TO_CHAR(EE.SND_DH,'MM. DD')
			            ELSE 'ERR' END AS SND_DH    --품질
			      ,CASE WHEN DD.GUK_APP IS     NULL AND DD.GUK_APV IS     NULL THEN ''
			            WHEN DD.GUK_APP IS NOT NULL AND DD.GUK_APV IS     NULL THEN TO_CHAR(DD.GUK_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||'검토중'
			            WHEN DD.GUK_APP IS NOT NULL AND DD.GUK_APV IS NOT NULL THEN TO_CHAR(DD.GUK_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||TO_CHAR(DD.GUK_APV,'MM. DD')
			            ELSE 'ERR' END AS GUK_APV   --국장
			      ,CASE WHEN DD.CHA_APP IS     NULL AND DD.CHA_APV IS     NULL THEN ''
			            WHEN DD.CHA_APP IS NOT NULL AND DD.CHA_APV IS     NULL THEN TO_CHAR(DD.CHA_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||'검토중'
			            WHEN DD.CHA_APP IS NOT NULL AND DD.CHA_APV IS NOT NULL THEN TO_CHAR(DD.CHA_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||TO_CHAR(DD.CHA_APV,'MM. DD')
			            ELSE 'ERR' END AS CHA_APV   --차장
			      ,CASE WHEN GG.REFER_DVSN_D10 = 0    AND DD.CHA_APV   IS NOT NULL THEN '전부위임' -- 전부위임인경우 총장결재 하지 않음   
                        WHEN DD.CHONG_APP IS     NULL AND DD.CHONG_APV IS     NULL THEN ''
			            WHEN DD.CHONG_APP IS NOT NULL AND DD.CHONG_APV IS     NULL THEN TO_CHAR(DD.CHONG_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||'검토중'
			            WHEN DD.CHONG_APP IS NOT NULL AND DD.CHONG_APV IS NOT NULL THEN TO_CHAR(DD.CHONG_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||TO_CHAR(DD.CHONG_APV,'MM. DD')
			            ELSE 'ERR' END AS CHONG_APV --총장
			      ,CASE WHEN GG.REFER_DVSN_D10 = 0 AND DD.CHA_APV IS NOT NULL AND DD.WI_APP IS     NULL THEN FF.CHF_CMTR_NM -- 전부위임, 차장결재완료, 주심위원 접수 전인경우 위원이름만 보여줌
                        WHEN GG.REFER_DVSN_D10 != 0 AND DD.CHONG_APV IS NOT NULL AND DD.WI_APP IS     NULL THEN FF.CHF_CMTR_NM -- 부의, 총장결재완료, 주심위원 접수 전인경우 위원이름만 보여줌
                        WHEN DD.WI_APP IS     NULL AND DD.WI_APV IS     NULL THEN ''
			            WHEN DD.WI_APP IS NOT NULL AND DD.WI_APV IS     NULL THEN FF.CHF_CMTR_NM ||CHR(13)||CHR(10)|| TO_CHAR(DD.WI_APP,'MM. DD') ||' ~ '||'검토중'
			            WHEN DD.WI_APP IS NOT NULL AND DD.WI_APV IS NOT NULL THEN FF.CHF_CMTR_NM ||CHR(13)||CHR(10)|| TO_CHAR(DD.WI_APP,'MM. DD') ||' ~ '||TO_CHAR(DD.WI_APV,'MM. DD')
			            ELSE 'ERR' END AS WI_APV    --위원
                      ,CASE WHEN AA.EXCS_DT > 0 THEN 1
                      		ELSE 0
                      	END AS OVERDUE_YN -- 지연여부 (2019.04.05 LSR 수정)
                     ,AA.SRT_SNO
                     ,BB.AUD_END_DT02
                     ,BB.AUD_END_DT03
                    , BB.AUD_STR_DT02
                 FROM BASIS_INFO        AA --기본정보AA
			      ,BSRP_INFO         BB --출장정보BB
			      ,END_APV_INFO      CC --종료보고결재CC
			      ,AUD_RPRT_APV_INFO DD --감사보고서(위원) 결재정보DD
			      ,AUD_RPRT_SR_INFO  EE --감사보고서 품질접수발신일EE
			      ,CHF_CMTR_INFO     FF --주심위원FF
			      ,AFF_CNT_INFO      GG --사건수GG
			 WHERE AA.AUD_YR = BB.AUD_YR(+) AND AA.AUD_NO = BB.AUD_NO(+)
			   AND AA.AUD_YR = CC.AUD_YR(+) AND AA.AUD_NO = CC.AUD_NO(+)
			   AND AA.AUD_YR = DD.AUD_YR(+) AND AA.AUD_NO = DD.AUD_NO(+)
			   AND DD.AUD_YR = EE.AUD_YR(+) AND DD.AUD_NO = EE.AUD_NO(+) AND DD.DOC_ID = EE.DOC_ID(+)
			   AND DD.AUD_YR = FF.AUD_YR(+) AND DD.AUD_NO = FF.AUD_NO(+) AND DD.DOC_ID = FF.DOC_ID(+)
			   AND DD.AUD_YR = GG.AUD_YR(+) AND DD.AUD_NO = GG.AUD_NO(+) AND DD.DOC_ID = GG.DOC_ID(+)
			    AND (BB.AUD_STR_DT02 IS NOT NULL OR (BB.AUD_STR_DT02 IS NULL AND SUBSTR(AA.AUD_KND_CD, 3, 1)  = '9'  ))  --실지감사 출장정보가 있는 감사(서면감사이면서 출장정보가 없고 종료보고서가 없을때 추가 2018.05.25 CJLEE)
			      ]]>
			  <if test="allSrch != 'true' ">
			  <![CDATA[     
			   AND (CASE WHEN GG.REFER_DVSN_D10 =  0 THEN NVL(DD.WI_APV,TO_DATE('99991231'))    --부의건수가 없으면 위원결재일
			             WHEN GG.REFER_DVSN_D10 <> 0 THEN TO_DATE(NVL(GG.SBCN_DY,'99991231'))   --부의건수가 있으면 부의일
			             ELSE TO_DATE('99991231')
			              END) >  SYSDATE
               AND NVL(DD.USE_YN,'Y') <> 'N'
               AND (TO_DATE(DECODE(BB.AUD_END_DT03,NULL,BB.AUD_END_DT02,BB.AUD_END_DT03)) < NEXT_DAY(NEXT_DAY(SYSDATE,'2'),'4') OR (BB.AUD_STR_DT02 IS NULL AND SUBSTR(AA.AUD_KND_CD, 3, 1)  = '9'  )) -- 조회일기준 다음주 수요일 이전 귀청건만 조회(서면감사이면서 출장정보가 없고 종료보고서가 없을때 추가 2018.05.25 CJLEE)
               AND (DD.DOC_ID IS NOT NULL 
                    OR (DD.DOC_ID IS NULL AND AA.AUD_EXEC_HNDL_STA_CD != '9')) -- 감사보고서가 있을경우 감사보고서의 USE_YN, 없을경우 감사사항의 종료여부
               ]]>
               </if>
            --   AND AA.DPT_SNO NOT IN ('530','640') --첨단,감찰 제외
               <if test="hirkDptCd != null and hirkDptCd != '' ">
               AND AA.HIRK_DPT_CD = #{hirkDptCd}
               </if>
               <![CDATA[
			 UNION ALL
				SELECT '2' AS GUBN 
			      ,AA.DPT_SNO
			--      ,AA.AUD_YR
			--      ,AA.AUD_NO
			       , AA.AUD_YR_NO
			      ,DD.DOC_ID
			      ,AA.AUD_DPT_NM
			      ,AA.AUD_SBJ_NM
			      ,AA.AUD_KND_NM
                 ,DD.AUD_RPRT_DVSN_CD 
			     ,(SELECT T1.CD_NM
					 FROM TBDCMACM013C T1
					WHERE T1.CMM_CD_DVSN_CD = '1000788'
					  AND T1.CD = DD.AUD_RPRT_DVSN_CD
					  AND ROWNUM = 1)||CHR(13)||
					     (CASE WHEN DD.AUD_RPRT_DVSN_CD = '10' AND  AA.GNR_HNDL_PLAN_YN = 'Y' THEN '(종합)' 
					          WHEN  DD.AUD_RPRT_DVSN_CD <> '10' AND DD.SYT_TRTM_DVSN_YN = 'Y'  THEN '(종합)'
                              WHEN DD.AUD_RPRT_DVSN_CD = '10' AND  AA.GNR_HNDL_PLAN_YN = 'N' THEN '(개별)' 
					          WHEN  DD.AUD_RPRT_DVSN_CD <> '10' AND DD.SYT_TRTM_DVSN_YN = 'N'  THEN '(개별)'
					          ELSE '' END ) AS AUD_RPRT_DVSN_NM --보고서구분
			     ,NVL(DECODE(AA.HNDL_DDLN_DT2,NULL,'',CHR(39) || 
			                      CASE WHEN AA.AUD_KND_CD2 IN ( '2', '3') THEN TO_CHAR(TO_DATE(AA.HNDL_DDLN_DT2),'YY. MM. DD')
			                             WHEN AA.AUD_KND_CD2 = '4' THEN TO_CHAR(TO_DATE(AA.REQ_DT),'YY. MM. DD')
			                             ELSE '' END
			      ), CASE WHEN AA.AUD_KND_CD2 IN ('2', '3', '4') THEN '결정일 미정' ELSE '' END )  AS AUD_KND_CD3  --감사실시 결정일/국회 접수일
			      ,NVL(DECODE(AA.HNDL_DDLN_DT2,NULL,'',CHR(39) || 
			          CASE WHEN AA.AUD_KND_CD2 = '2' THEN TO_CHAR(TO_DATE(AA.HNDL_DDLN_DT2)+59,'YY. MM. DD') 
			                 WHEN AA.AUD_KND_CD2 = '3' THEN TO_CHAR(ADD_MONTHS(TO_DATE(AA.HNDL_DDLN_DT2), 6),'YY. MM. DD')
			                 WHEN AA.AUD_KND_CD2 = '4' THEN TO_CHAR(TO_DATE(AA.HNDL_DDLN_DT2),'YY. MM. DD')
			                 ELSE '' END ) , (SELECT T1.CD_NM FROM TBDCMACM013C T1 WHERE T1.CMM_CD_DVSN_CD = '1000742' AND T1.CD = AA.AUD_KND_CD2 AND ROWNUM = 1)   )    AS AUD_KND_CD2
                  ,DECODE(AA.HNDL_DDLN_DT2,NULL,'',CHR(39) || TO_CHAR(TO_DATE(AA.HNDL_DDLN_DT2),'YY. MM. DD')) AS AUD_DVSN_PROC_DT --청구국회처리기한(2:국민3:공익4:국회)
				 , CASE WHEN NVL(TO_DATE((CASE WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT = 0 THEN  TO_DATE(AA.EXTN_HNDL_DDLN_DT) - 5
 				  		                                    WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT > 0 THEN  TO_DATE(AA.EXTN_HNDL_DDLN_DT)
				  		                                      ELSE TO_DATE(AA.EXTN_HNDL_DDLN_DT) END )), TO_DATE(AA.HNDL_DDLN_DT)) IS NULL THEN ''
				  		ELSE CHR(39) || TO_CHAR(NVL(TO_DATE((CASE WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT = 0 THEN  TO_DATE(AA.EXTN_HNDL_DDLN_DT) - 5
 				  		                                                         WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT > 0 THEN  TO_DATE(AA.EXTN_HNDL_DDLN_DT)
				  		                                                           ELSE TO_DATE(AA.EXTN_HNDL_DDLN_DT) END )), TO_DATE(AA.HNDL_DDLN_DT)),'YY. MM. DD')
				  		END AS FINAL_APV_DEADLINE     --최종 처리기한일 (2019.04.05 LSR 수정)
				  		
			      ,CASE WHEN BB.AUD_STR_DT02 IS NULL THEN ''
			            ELSE CHR(39) || TO_CHAR(BB.AUD_STR_DT02,'YY. MM. DD') 
                             ||' ~ '||CHR(13)||CHR(10)|| CHR(39) || TO_CHAR(DECODE(BB.AUD_END_DT03,NULL,BB.AUD_END_DT02,BB.AUD_END_DT03),'YY. MM. DD')
			                 ||' ('||TO_CHAR(NVL(AUD_DCN02,0)+NVL(AUD_DCN03,0))||'일)'
			             END                                                                        AS AUD_STR_DT02     --실지감사 실시기간
				  , CASE WHEN NVL(TO_DATE(AA.EXTN_RPT_DDLN_DT), TO_DATE(AA.RPT_DDLN_DT)) IS NULL THEN ''
				  		ELSE TO_CHAR(NVL(TO_DATE(AA.EXTN_RPT_DDLN_DT), TO_DATE(AA.RPT_DDLN_DT)),'MM. DD')
				  		END AS END_APV_DEADLINE    --종료보고 처리기한일 (2019.04.05 LSR 수정)
				  , CASE WHEN NVL(TO_DATE(AA.EXTN_BRDV_HNDL_DDLN_DT), TO_DATE(AA.BRDV_HNDL_DDLN_DT)) IS NULL THEN ''
				  		ELSE TO_CHAR(NVL((CASE WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT = 0 THEN  TO_DATE(AA.EXTN_BRDV_HNDL_DDLN_DT) - 5
 				  		                       WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT > 0 THEN  TO_DATE(AA.EXTN_BRDV_HNDL_DDLN_DT)
				  		                        ELSE TO_DATE(AA.EXTN_BRDV_HNDL_DDLN_DT) END ) , TO_DATE(AA.BRDV_HNDL_DDLN_DT)),'MM. DD')
				  		END AS GWA_APV_DEADLINE    --과장 처리기한일 (2019.04.05 LSR 수정)
			      ,'-'                AS SND_DH     --품질
				  , CASE WHEN NVL(TO_DATE(AA.EXTN_RVW_RM_APV_DDLN_DT), TO_DATE(AA.RVW_RM_APV_DDLN_DT)) IS NULL THEN ''
				  		ELSE TO_CHAR(NVL((CASE WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT = 0 THEN  TO_DATE(AA.EXTN_RVW_RM_APV_DDLN_DT) - 5
 				  		                       WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT > 0 THEN  TO_DATE(AA.EXTN_RVW_RM_APV_DDLN_DT)
				  		                        ELSE TO_DATE(AA.EXTN_RVW_RM_APV_DDLN_DT) END ), TO_DATE(AA.RVW_RM_APV_DDLN_DT)),'MM. DD')
				  		END AS GUK_APV_DEADLINE    --국장 처리기한일 (2019.04.05 LSR 수정)
-- 총,차장 단계 분리로 인하여 코드 재정의 (2019.04.18 LSR 수정)
                  , CASE
                   		 WHEN TOT_DHD_DVS_CD IS NOT NULL
                   		 THEN
						  	CASE WHEN NVL(TO_DATE(AA.EXTN_DHD_APV_DDLN_DT), TO_DATE(AA.DHD_APV_DDLN_DT)) IS NULL THEN ''
						  		ELSE TO_CHAR(NVL((CASE WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT = 0 THEN  TO_DATE(AA.EXTN_DHD_APV_DDLN_DT) - 5
 				  		                               WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT > 0 THEN  TO_DATE(AA.EXTN_DHD_APV_DDLN_DT)
				  		                                ELSE TO_DATE(AA.EXTN_DHD_APV_DDLN_DT) END ), TO_DATE(AA.DHD_APV_DDLN_DT)),'MM. DD')
						  		END
						 ELSE
						  	CASE WHEN NVL(TO_DATE(AA.EXTN_TOT_DHD_APV_DDLN_DT), TO_DATE(AA.TOT_DHD_APV_DDLN_DT)) IS NULL THEN ''
						  		ELSE TO_CHAR(NVL((CASE WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT = 0 THEN  TO_DATE(AA.EXTN_TOT_DHD_APV_DDLN_DT) - 5
 				  		                               WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT > 0 THEN  TO_DATE(AA.EXTN_TOT_DHD_APV_DDLN_DT)
				  		                                ELSE TO_DATE(AA.EXTN_TOT_DHD_APV_DDLN_DT) END ), TO_DATE(AA.TOT_DHD_APV_DDLN_DT)),'MM. DD')
						  		END
					END AS CHA_APV_DEADLINE    --차장 처리기한일 (2019.04.05 LSR 수정)
-- 총,차장 단계 분리로 인하여 코드 재정의 (2019.04.18 LSR 수정)
                  , CASE
                   		 WHEN TOT_DHD_DVS_CD IS NOT NULL
                   		 THEN
						    CASE WHEN NVL(TO_DATE(AA.EXTN_PSD_APV_DDLN_DT), TO_DATE(AA.PSD_APV_DDLN_DT)) IS NULL THEN ''
						  		 ELSE TO_CHAR(NVL((CASE WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT = 0 THEN  TO_DATE(AA.EXTN_PSD_APV_DDLN_DT) - 5
 				  		                                WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT > 0 THEN  TO_DATE(AA.EXTN_PSD_APV_DDLN_DT)
				  		                                ELSE TO_DATE(AA.EXTN_PSD_APV_DDLN_DT) END ), TO_DATE(AA.PSD_APV_DDLN_DT)),'MM. DD')
						  		  END
						  ELSE
						    CASE WHEN NVL(TO_DATE(AA.EXTN_TOT_DHD_APV_DDLN_DT), TO_DATE(AA.TOT_DHD_APV_DDLN_DT)) IS NULL THEN ''
						  		 ELSE TO_CHAR(NVL((CASE WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT = 0 THEN  TO_DATE(AA.EXTN_TOT_DHD_APV_DDLN_DT) - 5
 				  		                                WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT > 0 THEN  TO_DATE(AA.EXTN_TOT_DHD_APV_DDLN_DT)
				  		                                ELSE TO_DATE(AA.EXTN_TOT_DHD_APV_DDLN_DT) END ) , TO_DATE(AA.TOT_DHD_APV_DDLN_DT)),'MM. DD')
						  		  END
					END AS CHONG_APV_DEADLINE  --총장 처리기한일 (2019.04.05 LSR 수정)
				  , CASE WHEN NVL(TO_DATE(AA.EXTN_CHF_CMTR_APV_DDLN_DT), TO_DATE(AA.CHF_CMTR_APV_DDLN_DT)) IS NULL THEN ''
				  		 ELSE TO_CHAR(NVL((CASE WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT = 0 THEN  TO_DATE(AA.EXTN_CHF_CMTR_APV_DDLN_DT) - 5
 				  		                                WHEN AA.GNR_HNDL_PLAN_YN = 'Y' AND AA.CNT > 0 THEN  TO_DATE(AA.EXTN_CHF_CMTR_APV_DDLN_DT)
				  		                                ELSE TO_DATE(AA.EXTN_CHF_CMTR_APV_DDLN_DT) END ) , TO_DATE(AA.CHF_CMTR_APV_DDLN_DT)),'MM. DD')
				  		  END AS WI_APV_DEADLINE     --위원 처리기한일 (2019.04.05 LSR 수정)
	                      ,CASE WHEN AA.EXCS_DT > 0 THEN 1
	                      		ELSE 0
	                      	END AS OVERDUE_YN -- 지연여부 (2019.04.05 LSR 수정)
                            ,AA.SRT_SNO
                            ,BB.AUD_END_DT02
                            ,BB.AUD_END_DT03
                           , BB.AUD_STR_DT02
			  FROM BASIS_INFO        AA --기본정보AA
			      ,BSRP_INFO         BB --출장정보BB
			      ,END_APV_INFO      CC --종료보고결재CC
			      ,AUD_RPRT_APV_INFO DD --감사보고서(위원) 결재정보DD
			      ,AUD_RPRT_SR_INFO  EE --감사보고서 품질접수발신일EE
			      ,CHF_CMTR_INFO     FF --주심위원FF
			      ,AFF_CNT_INFO      GG --사건수GG
			 WHERE AA.AUD_YR = BB.AUD_YR(+) AND AA.AUD_NO = BB.AUD_NO(+)
			   AND AA.AUD_YR = CC.AUD_YR(+) AND AA.AUD_NO = CC.AUD_NO(+)
			   AND AA.AUD_YR = DD.AUD_YR(+) AND AA.AUD_NO = DD.AUD_NO(+)
			   AND DD.AUD_YR = EE.AUD_YR(+) AND DD.AUD_NO = EE.AUD_NO(+) AND DD.DOC_ID = EE.DOC_ID(+)
			   AND DD.AUD_YR = FF.AUD_YR(+) AND DD.AUD_NO = FF.AUD_NO(+)  AND DD.DOC_ID = FF.DOC_ID(+)
			   AND DD.AUD_YR = GG.AUD_YR(+) AND DD.AUD_NO = GG.AUD_NO(+) AND DD.DOC_ID = GG.DOC_ID(+)
			   AND (BB.AUD_STR_DT02 IS NOT NULL OR (BB.AUD_STR_DT02 IS NULL AND SUBSTR(AA.AUD_KND_CD, 3, 1)  = '9'  ))    --실지감사 출장정보가 있는 감사(서면감사이면서 출장정보가 없고 종료보고서가 없을때 추가 2018.05.25 CJLEE)
			      ]]>
			   <if test="allSrch != 'true' ">
              <![CDATA[
			   AND (CASE WHEN GG.REFER_DVSN_D10 =  0 THEN NVL(DD.WI_APV,TO_DATE('99991231'))    --부의건수가 없으면 위원결재일
			             WHEN GG.REFER_DVSN_D10 <> 0 THEN TO_DATE(NVL(GG.SBCN_DY,'99991231'))   --부의건수가 있으면 부의일
			             ELSE TO_DATE('99991231')
			              END) > SYSDATE
               AND NVL(DD.USE_YN,'Y') <> 'N'
               AND (TO_DATE(DECODE(BB.AUD_END_DT03,NULL,BB.AUD_END_DT02,BB.AUD_END_DT03)) < NEXT_DAY(NEXT_DAY(SYSDATE,'2'),'4') OR (BB.AUD_STR_DT02 IS NULL AND SUBSTR(AA.AUD_KND_CD, 3, 1)  = '9' ))  -- 조회일기준 다음주 수요일 이전 귀청건만 조회(서면감사이면서 출장정보가 없고 종료보고서가 없을때 추가 2018.05.25 CJLEE)
               AND (DD.DOC_ID IS NOT NULL 
                    OR (DD.DOC_ID IS NULL AND AA.AUD_EXEC_HNDL_STA_CD != '9')) -- 감사보고서가 있을경우 감사보고서의 USE_YN, 없을경우 감사사항의 종료여부
               ]]>
               </if>
           --     AND AA.DPT_SNO NOT IN ('530','640') --국방,첨단,감찰 제외
               <if test="hirkDptCd != null and hirkDptCd != '' ">
               AND AA.HIRK_DPT_CD = #{hirkDptCd}
               </if>
               <![CDATA[
          ORDER BY AA.DPT_SNO, AA.SRT_SNO ,DECODE(BB.AUD_END_DT03,NULL,BB.AUD_END_DT02,BB.AUD_END_DT03), BB.AUD_STR_DT02,  DD.AUD_RPRT_DVSN_CD  , AA.AUD_YR_NO ,GUBN  
             ]]>
    </select>
    
    <select id="selectDfTrtmSituList" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.aep.fer.dao.AEPFER004QMapper.selectDfTrtmSituList */
     <![CDATA[
          WITH BASIS_INFO AS (/* 기본정보AA : BASIS_INFO */
                    SELECT A1.AUD_YR                                                    AS AUD_YR       --감사년도
                          ,A1.AUD_NO                                                    AS AUD_NO       --감사번호
                          ,A1.AUD_KND_CD                                                AS AUD_KND_CD   --감사종류코드(1:재무,2:특정,3:성과,4:기관,5:확인,9:서면)
                          ,F_MNG_KND_AUDYRNO(A1.AUD_YR, A1.AUD_NO, A1.AUD_KND_CD, '-')  AS AUD_YR_NO    --분류번호   
                          ,(SELECT T4.ABR_DPT_NM_1
                                 FROM TBDCMACM002M T4
                                WHERE T4.DPT_CD = (SELECT A2.HIRK_DPT_CD
                                                     FROM TBDCMACM002M A2
                                                    WHERE A2.DPT_CD =  A1.SPV_BRDV_CD)
                                   AND T4.USE_YN = 'Y'
                                   AND ROWNUM = 1)                                  AS HIRK_DPT_NM  --국
                          ,(SELECT A2.HIRK_DPT_CD
                             FROM TBDCMACM002M A2
                            WHERE A2.DPT_CD =  A1.SPV_BRDV_CD) AS HIRK_DPT_CD
                          ,(SELECT ABR_DPT_NM_1
                              FROM TBDCMACM002M
                             WHERE DPT_CD = A1.SPV_BRDV_CD)                             AS AUD_DPT_NM   --과
                          ,A1.AUD_SBJ_NM                                                AS AUD_SBJ_NM   --감사사항명
                          ,F_CODE_NM('1000739', A1.AUD_KND_CD)  AS AUD_KND_NM   --종류코드2(1:민원2:국민3:공익4:국회5:심사6:재심8:손망9:판청)
                          ,(SELECT A6.DVSN_CD
                              FROM TBBADDED030L A6
                             WHERE A6.AUD_YR = A1.AUD_YR
                               AND A6.AUD_NO = A1.AUD_NO
                               AND A6.SRNO   = 1)                                       AS AUD_KND_CD2  --종류코드2
                          ,(SELECT TO_DATE(A5.REQ_NTAS_DCS_DT)
                              FROM TBBADDED003M A5
                             WHERE A5.AUD_YR = A1.AUD_YR
                               AND A5.AUD_NO = A1.AUD_NO)                               AS REQ_NTAS_DCS_DT  --청구국회결정일
                          ,(SELECT NVL(A7.EXTN_PRD_COFM_DT,0)
                              FROM TBBADDED003M A7
                             WHERE A7.AUD_YR = A1.AUD_YR
                               AND A7.AUD_NO = A1.AUD_NO)                               AS EXTN_PRD_COFM_DT  --연장승인일
                          ,B.DPT_SNO
                          ,B.DPT_CD
                          ,B.DPT_NM
                          ,(SELECT MAX(TO_CHAR(TO_DATE(A8.EXAM_RPT_APV_DT),'YYYY-MM-DD')) AS EXAM_RPT_APV_DT
                              FROM TBCSPEAR001M A8
                                  ,(SELECT TSK_KEY1 AS ACP_YR
                                          ,TSK_KEY2 AS REQ_DVSN_CD
                                          ,TSK_KEY3 AS CVPT_ACP_NO
                                          ,AUD_YR
                                          ,AUD_NO
                                      FROM TBBADDED030L) A9
                                  ,TBBADDED001M A10
                             WHERE A8.ACP_YR      = A9.ACP_YR(+)
                               AND A8.REQ_DVSN_CD = A9.REQ_DVSN_CD(+)
                               AND A8.CVPT_ACP_NO = A9.CVPT_ACP_NO(+)     
                               AND A9.AUD_YR      = A10.AUD_YR 
                               AND A9.AUD_NO      = A10.AUD_NO
                               AND A10.AUD_YR     = A1.AUD_YR
                               AND A10.AUD_NO     = A1.AUD_NO
                           ) AS EXAM_RPT_APV_DT --감사실시여부검토일
                          ,(SELECT MAX(
                                   CASE WHEN A8.REQ_DVSN_CD IN ('2','3') AND (A8.EXAM_RPT_APV_DT IS NULL OR A8.REQ_EXAM_RSLT_CD <> '01') THEN ''
                                        WHEN A8.REQ_DVSN_CD = '2' AND (A8.EXAM_RPT_APV_DT IS NOT NULL AND A8.REQ_EXAM_RSLT_CD = '01') THEN TO_CHAR(TO_DATE(A8.EXAM_RPT_APV_DT)+60, 'YYYY-MM-DD')
                                        WHEN A8.REQ_DVSN_CD = '3' AND (A8.EXAM_RPT_APV_DT IS NOT NULL AND A8.REQ_EXAM_RSLT_CD = '01') THEN TO_CHAR(ADD_MONTHS(TO_DATE(A8.EXAM_RPT_APV_DT) , 6), 'YYYY-MM-DD')
                                        ELSE '' END) AS HNDL_DDLN_DT2
                              FROM TBCSPEAR001M A8
                                  ,(SELECT TSK_KEY1 AS ACP_YR
                                          ,TSK_KEY2 AS REQ_DVSN_CD
                                          ,TSK_KEY3 AS CVPT_ACP_NO
                                          ,AUD_YR
                                          ,AUD_NO
                                      FROM TBBADDED030L) A9
                                  ,TBBADDED001M A10
                             WHERE A8.ACP_YR      = A9.ACP_YR(+)
                               AND A8.REQ_DVSN_CD = A9.REQ_DVSN_CD(+)
                               AND A8.CVPT_ACP_NO = A9.CVPT_ACP_NO(+)     
                               AND A9.AUD_YR      = A10.AUD_YR 
                               AND A9.AUD_NO      = A10.AUD_NO
                               AND A10.AUD_YR     = A1.AUD_YR
                               AND A10.AUD_NO     = A1.AUD_NO
                           ) AS HNDL_DDLN_DT2 --감사처리기한
                      FROM TBBADDED001M A1
                          ,(SELECT S1.DPT_SNO
                                  ,S1.DPT_CD
                                  ,S1.DPT_NM
                              FROM TBDCMACM002M S1
                             WHERE S1.USE_YN         = 'Y'
                               AND S1.IMD_CD         = 'Y'
                               AND S1.ORZT_DVSN_CD   = '20'
                               --AND S1.DPT_CD NOT IN ('100000','150000')
                             ORDER BY S1.DPT_SNO
                           ) B
                     WHERE 1=1
                       AND A1.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr}   --PARAM
                       AND SUBSTR(A1.MNG_DPT_CD, 1, 3) || '000' = B.DPT_CD(+)
                       AND SUBSTR(A1.AUD_KND_CD,3,1) <> '5' --확인출장제외
                   ),
     BSRP_INFO AS (/* 출장정보BB : BSRP_INFO */
                    SELECT B2.REL_AUD_YR AS AUD_YR
                          ,B2.REL_AUD_NO AS AUD_NO
                          ,MIN(B2.AUD_STR_DT00) AS AUD_STR_DT00 --자료수집 시작일
                          ,MAX(B2.AUD_END_DT00) AS AUD_END_DT00 --자료수집 종료일
                          ,SUM(B2.AUD_DCN00)    AS AUD_DCN00    --자료수집 출장일수
                          ,MIN(B2.AUD_STR_DT01) AS AUD_STR_DT01 --예비조사 시작일
                          ,MAX(B2.AUD_END_DT01) AS AUD_END_DT01 --예비조사 종료일
                          ,SUM(B2.AUD_DCN01)    AS AUD_DCN01    --예비조사 출장일수
                          ,MIN(B2.AUD_STR_DT02) AS AUD_STR_DT02 --실지감사 시작일
                          ,MAX(B2.AUD_END_DT02) AS AUD_END_DT02 --실지감사 종료일
                          ,SUM(B2.AUD_DCN02)    AS AUD_DCN02    --실지감사 출장일수
                          ,MIN(B2.AUD_STR_DT03) AS AUD_STR_DT03 --실지감사연장 시작일
                          ,MAX(B2.AUD_END_DT03) AS AUD_END_DT03 --실지감사연장 종료일
                          ,SUM(B2.AUD_DCN03)    AS AUD_DCN03    --실지감사연장 출장일수
                          ,DECODE(MAX(B2.AUD_END_DT03),NULL,MAX(B2.AUD_END_DT02)+1,MAX(B2.AUD_END_DT03)+1) AS RETURN_DT  --귀청일
                          ,(SELECT SUM((NVL(TRUNC((TO_DATE(TO_CHAR(TO_DATE(B3.AUD_END_DT), 'YYYYMMDD'))- TO_DATE(TO_CHAR(TO_DATE(B3.AUD_STR_DT) , 'YYYYMMDD'))) +1,0),0)))
                              FROM TBBADDED002M B3
                             WHERE B3.REL_AUD_YR = B2.REL_AUD_YR
                               AND B3.REL_AUD_NO = B2.REL_AUD_NO
                               AND B3.AUD_BZT_KND_CD IN ('02','03')) AS AUD_BSRP_SUM
                      FROM (SELECT B1.REL_AUD_YR,B1.REL_AUD_NO
                                  ,DECODE(B1.AUD_BZT_KND_CD,'00',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT00
                                  ,DECODE(B1.AUD_BZT_KND_CD,'00',TO_DATE(AUD_END_DT)) AS AUD_END_DT00
                                  ,DECODE(B1.AUD_BZT_KND_CD,'00',AUD_DCN            ) AS AUD_DCN00
                                  ,DECODE(B1.AUD_BZT_KND_CD,'01',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT01
                                  ,DECODE(B1.AUD_BZT_KND_CD,'01',TO_DATE(AUD_END_DT)) AS AUD_END_DT01
                                  ,DECODE(B1.AUD_BZT_KND_CD,'01',AUD_DCN            ) AS AUD_DCN01
                                  ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT02
                                  ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_END_DT)) AS AUD_END_DT02
                                  ,DECODE(B1.AUD_BZT_KND_CD,'02',AUD_DCN            ) AS AUD_DCN02
                                  ,DECODE(B1.AUD_BZT_KND_CD,'03',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT03
                                  ,DECODE(B1.AUD_BZT_KND_CD,'03',TO_DATE(AUD_END_DT)) AS AUD_END_DT03
                                  ,DECODE(B1.AUD_BZT_KND_CD,'03',AUD_DCN            ) AS AUD_DCN03
                              FROM TBBADDED002M B1
                                INNER JOIN TBBADDED001M B2
                                           ON B1.REL_AUD_YR = B2.AUD_YR
                                           AND B1.REL_AUD_NO = B2.AUD_NO
                             WHERE B2.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr} --PARAM
                                AND B2.AUD_KND_CD NOT LIKE '%5'
                           ) B2
                     GROUP BY B2.REL_AUD_YR,B2.REL_AUD_NO
                      UNION ALL
                                SELECT D.AUD_YR AS AUD_NO
                                      ,D.AUD_NO AS AUD_NO
                                      ,NULL AS AUD_STR_DT00 --자료수집 시작일
                                      ,NULL AS AUD_END_DT00 --자료수집 종료일
                                      ,NULL AS AUD_DCN00    --자료수집 출장일수
                                      ,NULL AS AUD_STR_DT01 --예비조사 시작일
                                      ,NULL AS AUD_END_DT01 --예비조사 종료일
                                      ,NULL AS AUD_DCN01    --예비조사 출장일수
                                      ,MIN(TO_DATE(A.AUD_STR_DT)) AS AUD_STR_DT02 --실지감사 시작일
                                      ,MAX(TO_DATE(A.AUD_END_DT)) AS AUD_END_DT02 --실지감사 종료일
                                      ,SUM(A.AUD_DCN)    AS AUD_DCN02    --실지감사 출장일수
                                      ,NULL AS AUD_STR_DT03 --실지감사연장 시작일
                                      ,NULL AS AUD_END_DT03 --실지감사연장 종료일
                                      ,NULL AS AUD_DCN03    --실지감사연장 출장일수
                                      ,MAX(TO_DATE(A.AUD_END_DT))+1 AS RETURN_DT  --귀청일
                                      ,MAX(TO_DATE(A.AUD_END_DT)) - MIN(TO_DATE(A.AUD_STR_DT)) AS AUD_BSRP_SUM
                                 FROM TBBADDED101L D
                                      INNER JOIN TBBADDED001M B
                                                 ON (D.AUD_YR  = B.AUD_YR AND D.AUD_NO = B.AUD_NO)
                                      LEFT OUTER JOIN TBBADDED002M A
                                                 ON (A.REL_AUD_YR = D.REL_AUD_YR AND A.REL_AUD_NO = D.REL_AUD_NO AND A.BZT_DVSN_CD = 1)
                               WHERE B.AUD_KND_CD LIKE '%9'   --서면감사인 경우에만 자료수집 건을 출장정보로 설정함
                                  AND B.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr} 
                                GROUP BY D.AUD_YR, D.AUD_NO
                    ),
     END_APV_INFO AS (/* 종료보고결재CC : END_APV_INFO */
                      SELECT C1.AUD_YR
                            ,C1.AUD_NO
                            ,MIN(DECODE(C2.APVR_PST_CD,'0013600', C2.APV_DH, '0057400',C2.APV_DH, '0035400',C2.APV_DH, ''))   AS E_GWA_APV      --과장결재일
                            ,MIN(DECODE(C2.APVR_PST_CD,'0015800',C2.APV_DH
                                ,DECODE(C2.APVR_PST_CD,'0035100',C2.APV_DH
                                ,DECODE(C2.APVR_PST_CD,'0058100',C2.APV_DH,'')))) AS E_GUK_APV      --국장결재일(국장:0015800,단장:0035100,실장:0058100)
                           ,MIN(DECODE(C2.APVR_PST_CD,'0055600',C2.APV_DH
			                                ,DECODE(C2.APVR_PST_CD,'0045900',C2.APV_DH
			                                ,DECODE(C2.APVR_PST_CD,'0058100',C2.APV_DH,''))))  AS E_CHA_APV      --차장결재일(차장:0055600,본부장:0045900, 실장 : 0058100)
                            ,MIN(DECODE(C2.APVR_PST_CD,'0055700',C2.APV_DH,''))   AS E_CHONG_APV    --총장결재일
                            ,MIN(DECODE(C2.APVR_PST_CD,'0067400',C2.APV_DH,''))   AS E_WON_APV      --원장결재일
                            ,MAX(DECODE(C1.APV_STA_CD,'30',C2.APV_DH,''))         AS E_FNL_APV      --최종결재일
                            ,MAX(C1.APV_STA_CD)                                   AS APV_STA_CD     --결재상태
                            ,MIN(DECODE(C2.APVR_PST_CD,'0013600',C2.APVR_KND_CD,'0057400',C2.APVR_KND_CD,'0035400',C2.APVR_KND_CD,''))   AS E_GWA_KND            
                            ,MIN(DECODE(C2.APVR_PST_CD,'0015800',C2.APVR_KND_CD
                                ,DECODE(C2.APVR_PST_CD,'0035100',C2.APVR_KND_CD
                                ,DECODE(C2.APVR_PST_CD,'0058100',C2.APVR_KND_CD,'')))) AS E_GUK_KND      
                            ,MIN(DECODE(C2.APVR_PST_CD,'0055600',C2.APVR_KND_CD
                                ,DECODE(C2.APVR_PST_CD,'0045900',C2.APVR_KND_CD,'')))  AS E_CHA_KND      
                            ,MIN(DECODE(C2.APVR_PST_CD,'0055700',C2.APVR_KND_CD,''))   AS E_CHONG_KND  
                        FROM TBBADDED103M C1
                            ,TBDCMACM023H C2
                       WHERE 1=1
                         AND C1.APV_RQS_ID  = C2.APV_DOC_NO
                         AND C2.APVR_STA_CD <> '401'
                         AND C1.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr} --PARAM
                         AND C1.RPRT_CD     = 'A10500200' --종료보고서
                       GROUP BY C1.AUD_YR,C1.AUD_NO
                      ),
     AUD_RPRT_APV_INFO AS (/* 감사보고서(위원) 결재정보DD : AUD_RPRT_APV_INFO */
                            SELECT D3.AUD_YR
                                 ,D3.AUD_NO
                                 ,D3.AUD_RPRT_DVSN_CD      AS AUD_RPRT_DVSN_CD
                                 ,D3.DOC_ID                AS DOC_ID
                                 ,MIN(D3.GWA_APV)          AS GWA_APV
                                 ,MIN(D3.GUK_APP)          AS GUK_APP
                                 ,MIN(D3.GUK_APV)          AS GUK_APV
                                 ,MIN(D3.CHA_APP)          AS CHA_APP
                                 ,MIN(D3.CHA_APV)          AS CHA_APV
                                 ,MIN(D3.CHONG_APP)        AS CHONG_APP
                                 ,MIN(D3.CHONG_APV)        AS CHONG_APV
                                 ,MAX(D3.FNL_APV)          AS FNL_APV
                                 ,MIN(D3.WI_APP)           AS WI_APP
                                 ,MIN(D3.WI_APV)           AS WI_APV
                                 ,MAX(D3.SYT_TRTM_DVSN_YN) AS SYT_TRTM_DVSN_YN
                                 ,MAX(D3.USE_YN)           AS USE_YN
                                 ,MAX(D3.AUD_RPRT_STA_CD)  AS AUD_RPRT_STA_CD
                                 ,MAX(D3.WI_RPRT_STA_CD)   AS WI_RPRT_STA_CD
                                 ,DECODE(D3.RE_DOC_ID,NULL,'3','1') AS GUBN
                                 ,MIN(D3.SBCN_DY) AS SBCN_DY
                                 ,D3.RE_DOC_ID AS RE_DOC_ID
                                 ,(SELECT COUNT(1) 
                                     FROM TBBADDED113M ST1
                                    WHERE ST1.AUD_YR = D3.AUD_YR
                                      AND ST1.AUD_NO = D3.AUD_NO
                                      AND ST1.SBCN_VT_CD = '90') AS SBCN_CNT
                             FROM (
                                   SELECT D3.AUD_YR
                                         ,D3.AUD_NO
                                         ,NVL(D1.AUD_RPRT_DVSN_CD,'40') AS AUD_RPRT_DVSN_CD
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' THEN D1.DOC_ID
                                               ELSE D1.REF_ID
                                                END AS DOC_ID
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND (D2.APVR_PST_CD = '0013600' OR D2.APVR_PST_CD = '0057400' OR D2.APVR_PST_CD = '0035400') AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS GWA_APV   --과장결재일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               ELSE NULL
                                                END AS GUK_APP   --국단실장접수일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS GUK_APV   --국단실장결재일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               ELSE NULL
                                                END AS CHA_APP   --차장,본부장 접수일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS CHA_APV   --차장,본부장 결재일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               ELSE NULL
                                                END AS CHONG_APP --사무총장접수일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS CHONG_APV --사무총장결재일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D1.APV_STA_CD = '30' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS FNL_APV   --최종결재일
                                         ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ,D2.APV_DH DESC)
                                               ELSE NULL
                                                END AS WI_APP    --주심위원접수일
                                         ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS WI_APV    --주심위원결재일
                                         ,D1.SYT_TRTM_DVSN_YN
                                         ,D1.USE_YN
                                         ,DECODE(D1.RPRT_CD,'A10600200',D1.APV_STA_CD ) AS AUD_RPRT_STA_CD
                                         ,DECODE(D1.RPRT_CD,'A10700100',D1.APV_STA_CD ) AS WI_RPRT_STA_CD
                                         ,D3.REFER_DVSN_D10
                                         ,D3.REFER_DVSN_E10
                                         ,D3.SBCN_DY
                                         ,D3.RE_SBCN_DY
                                         ,D3.RE_WI_APV
                                         ,D3.RE_DOC_ID
                                     FROM (SELECT 
                                                T1.AUD_YR
                                                , T1.AUD_NO
                                                , T1.DOC_ID AS DOC_ID
                                                , T2.DOC_ID AS RE_DOC_ID
                                                , SUM(CASE WHEN T3.REFER_DVSN_CD = 'D10' THEN 1 ELSE 0 END) AS REFER_DVSN_D10   --부의
                                                , SUM(CASE WHEN T3.REFER_DVSN_CD = 'E10' THEN 1 ELSE 0 END) AS REFER_DVSN_E10   --위임
                                                , MIN(T1.SBCN_DY) AS SBCN_DY    -- 부의 일자
                                                , MIN(T4.SBCN_DY) AS RE_SBCN_DY -- 재부의 일자
                                                , MAX(T5.APV_STA_CD) 
                                                , MIN(T6.APV_DH) AS RE_WI_APV      -- 재부의 주심위원설명자료 결재일자
                                              FROM TBBADDED113M T1
                                                   LEFT OUTER JOIN TBBADDED146M T2
                                                   ON (T1.AUD_YR = T2.AUD_YR AND T1.AUD_NO = T2.AUD_NO
                                                       AND T1.DOC_ID = T2.HD_DOC_ID AND T2.HD_APVR_CD = 'A107001'
                                                       AND T1.AFF_SNO = T2.HD_AFF_SNO AND T1.DSP_RQ_SNO = T2.HD_DSP_RQ_SNO)
                                                   LEFT OUTER JOIN TBBADDED145M T3
                                                   ON (T2.AUD_YR = T3.AUD_YR AND T2.AUD_NO = T3.AUD_NO
                                                       AND T2.AUD_STEP_CD = T3.AUD_STEP_CD AND T2.DOC_ID = T3.DOC_ID 
                                                       AND T2.APVR_CD = T3.APVR_CD AND T2.AFF_SNO = T3.AFF_SNO)
                                                   LEFT OUTER JOIN TBBADDED113M T4
                                                   ON (T2.AUD_YR = T4.AUD_YR AND T2.AUD_NO = T4.AUD_NO
                                                       AND T2.DOC_ID = T4.DOC_ID AND  T4.APVR_CD = '0010600'
                                                       AND T2.AFF_SNO = T4.AFF_SNO AND T2.DSP_RQ_SNO = T4.DSP_RQ_SNO)
                                                   LEFT OUTER JOIN TBBADDED103M T5
                                                   ON (T5.REF_ID = T4.DOC_ID AND T5.RPRT_CD = 'A10700100')
                                                   LEFT OUTER JOIN TBDCMACM023H T6
                                                   ON (T5.APV_RQS_ID = T6.APV_DOC_NO AND T6.APVR_PST_CD = '0010600')
                                                   LEFT OUTER JOIN TBBADDED146M T7 -- 원 부의 처분요구
                                                       ON (T7.AUD_YR = T1.AUD_YR AND T7.AUD_NO = T1.AUD_NO
                                                           AND T7.DOC_ID = T1.DOC_ID   AND  T7.APVR_CD = 'A107001'
                                                           AND T7.AFF_SNO = T1.AFF_SNO AND T7.DSP_RQ_SNO = T1.DSP_RQ_SNO)
                                             WHERE T1.SBCN_VT_CD = '90'
                                                AND EXISTS (SELECT 1 FROM TBBADDED103M A WHERE A.AUD_YR = T1.AUD_YR AND A.AUD_NO = T1.AUD_NO AND T1.DOC_ID = A.DOC_ID AND  NVL(A.USE_YN,'Y') <> 'N')
                                                 AND ((T2.HD_DOC_ID IS NULL AND T7.DF_DOC_ID IS NULL)
                                                          OR (T2.HD_DOC_ID IS NOT NULL AND T7.DF_DOC_ID IS NOT NULL))
                                             GROUP BY T1.AUD_YR, T1.AUD_NO, T1.DOC_ID, T2.DOC_ID) D3
                                         LEFT OUTER JOIN TBBADDED103M D1
                                         ON (D3.AUD_YR = D1.AUD_YR AND D3.AUD_NO = D1.AUD_NO 
                                            AND (D3.DOC_ID = D1.DOC_ID OR D3.DOC_ID = D1.REF_ID)
                                            AND D1.RPRT_CD          IN ('A10600200','A10700100')
                                            AND NVL(D1.FNL_BAI_RPRT_YN,'N') != 'Y'
                                            )
                                         LEFT OUTER JOIN (SELECT A.SEQ
                                                              ,A.APV_DOC_NO
                                                              ,A.APVR_PST_CD
                                                              ,A.APVR_KND_CD
                                                              ,A.APVR_STA_CD
                                                              ,A.APV_DH
                                                              ,A.APV_DVSN_CD
                                                              ,A.APVR_CNB
                                                          FROM TBDCMACM023H A
                                                        UNION ALL
                                                        SELECT 9999999999 AS SEQ
                                                              ,B.APV_DOC_NO
                                                              ,B.APVR_PST_CD
                                                              ,B.APVR_KND_CD
                                                              ,B.APVR_STA_CD
                                                              ,B.APV_DH
                                                              ,B.APV_DVSN_CD
                                                              ,B.APVR_CNB
                                                          FROM TBDCMACM023L B
                                                         WHERE B.APVR_STA_CD IN ('102','103')
                                                           AND NOT EXISTS (SELECT 'X'
                                                                             FROM TBDCMACM023H S
                                                                            WHERE S.APV_DOC_NO  = B.APV_DOC_NO 
                                                                              AND S.APV_DVSN_CD = B.APV_DVSN_CD
                                                                              AND S.APVR_CNB    = B.APVR_CNB   
                                                                      )
                                                         ORDER BY SEQ) D2
                                         ON (D1.APV_RQS_ID = D2.APV_DOC_NO AND D2.APVR_KND_CD      IN ('2','3','9'))
                                    WHERE D3.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr}
                                    ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ/*D2.APV_SNO,D2.APVR_SEQ*/
                                   ) D3
                            WHERE (CASE WHEN D3.REFER_DVSN_D10 =  0 THEN NVL(D3.RE_WI_APV,TO_DATE('99991231'))    --부의건수가 없으면 위원결재일
                                        WHEN D3.REFER_DVSN_D10 <> 0 THEN TO_DATE(NVL(D3.RE_SBCN_DY,'99991231'))   --부의건수가 있으면 부의일
                                        ELSE TO_DATE('99991231')
                                        END) > SYSDATE
                            GROUP BY D3.AUD_YR,D3.AUD_NO,D3.AUD_RPRT_DVSN_CD,D3.DOC_ID, D3.RE_DOC_ID
                            UNION
                            SELECT D3.AUD_YR
                                 ,D3.AUD_NO
                                 ,D3.AUD_RPRT_DVSN_CD      AS AUD_RPRT_DVSN_CD
                                 ,D3.DOC_ID                AS DOC_ID
                                 ,MIN(D3.GWA_APV)          AS GWA_APV
                                 ,MIN(D3.GUK_APP)          AS GUK_APP
                                 ,MIN(D3.GUK_APV)          AS GUK_APV
                                 ,MIN(D3.CHA_APP)          AS CHA_APP
                                 ,MIN(D3.CHA_APV)          AS CHA_APV
                                 ,MIN(D3.CHONG_APP)        AS CHONG_APP
                                 ,MIN(D3.CHONG_APV)        AS CHONG_APV
                                 ,MAX(D3.FNL_APV)          AS FNL_APV
                                 ,MIN(D3.WI_APP)           AS WI_APP
                                 ,MIN(D3.WI_APV)           AS WI_APV
                                 ,MAX(D3.SYT_TRTM_DVSN_YN) AS SYT_TRTM_DVSN_YN
                                 ,MAX(D3.USE_YN)           AS USE_YN
                                 ,MAX(D3.AUD_RPRT_STA_CD)  AS AUD_RPRT_STA_CD
                                 ,MAX(D3.WI_RPRT_STA_CD)   AS WI_RPRT_STA_CD
                                 ,DECODE(D3.RE_DOC_ID,NULL,'4','2') AS GUBN 
                                 ,MIN(D3.SBCN_DY) AS SBCN_DY
                                 ,D3.RE_DOC_ID AS RE_DOC_ID
                                 ,MAX(D3.RE_SBCN_CNT) AS SBCN_CNT
                             FROM (
                                   SELECT D3.AUD_YR
                                         ,D3.AUD_NO
                                         ,NVL(D1.AUD_RPRT_DVSN_CD,'40') AS AUD_RPRT_DVSN_CD
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' THEN D1.DOC_ID
                                               ELSE D1.REF_ID
                                                END AS DOC_ID
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD  IN ( '0013600', '0057400', '0035400')  AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS GWA_APV   --과장결재일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               ELSE NULL
                                                END AS GUK_APP   --국단실장접수일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS GUK_APV   --국단실장결재일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               ELSE NULL
                                                END AS CHA_APP   --차장,본부장 접수일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS CHA_APV   --차장,본부장 결재일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                               ELSE NULL
                                                END AS CHONG_APP --사무총장접수일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS CHONG_APV --사무총장결재일
                                         ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D1.APV_STA_CD = '30' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS FNL_APV   --최종결재일
                                         ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ,D2.APV_DH DESC)
                                               ELSE NULL
                                                END AS WI_APP    --주심위원접수일
                                         ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                               ELSE NULL
                                                END AS WI_APV    --주심위원결재일
                                         ,D1.SYT_TRTM_DVSN_YN
                                         ,D1.USE_YN
                                         ,DECODE(D1.RPRT_CD,'A10600200',D1.APV_STA_CD ) AS AUD_RPRT_STA_CD
                                         ,DECODE(D1.RPRT_CD,'A10700100',D1.APV_STA_CD ) AS WI_RPRT_STA_CD
                                         ,D3.REFER_DVSN_D10
                                         ,D3.REFER_DVSN_E10
                                         ,D3.SBCN_DY
                                         ,D3.RE_SBCN_DY
                                         ,D3.RE_WI_APV
                                         ,D3.RE_DOC_ID
                                         ,D3.RE_SBCN_CNT
                                     FROM (SELECT 
                                                T1.AUD_YR
                                                , T1.AUD_NO
                                                , T1.DOC_ID AS DOC_ID
                                                , T2.DOC_ID AS RE_DOC_ID
                                                , SUM(CASE WHEN T3.REFER_DVSN_CD = 'D10' THEN 1 ELSE 0 END) AS REFER_DVSN_D10   --부의
                                                , SUM(CASE WHEN T3.REFER_DVSN_CD = 'E10' THEN 1 ELSE 0 END) AS REFER_DVSN_E10   --위임
                                                , MIN(T1.SBCN_DY) AS SBCN_DY
                                                , MIN(T4.SBCN_DY) AS RE_SBCN_DY
                                                , MAX(T5.APV_STA_CD)
                                                , MIN(T6.APV_DH) AS RE_WI_APV      -- 재부의 주심위원설명자료 결재일자
                                                , COUNT(DISTINCT T4.DSP_RQ_SNO) AS RE_SBCN_CNT
                                               FROM TBBADDED113M T1 -- 원 부의
                                                       LEFT OUTER JOIN TBBADDED146M T2 -- 재부의 처분요구
                                                       ON (T1.AUD_YR = T2.AUD_YR AND T1.AUD_NO = T2.AUD_NO
                                                       AND T1.DOC_ID = T2.HD_DOC_ID AND T2.HD_APVR_CD = 'A107001'
                                                           AND T1.AFF_SNO = T2.HD_AFF_SNO AND T1.DSP_RQ_SNO = T2.HD_DSP_RQ_SNO)
                                                       LEFT OUTER JOIN TBBADDED145M T3 -- 재부의 사건
                                                       ON (T2.AUD_YR = T3.AUD_YR AND T2.AUD_NO = T3.AUD_NO
                                                           AND T2.AUD_STEP_CD = T3.AUD_STEP_CD AND T2.DOC_ID = T3.DOC_ID 
                                                           AND T2.APVR_CD = T3.APVR_CD AND T2.AFF_SNO = T3.AFF_SNO)
                                                       LEFT OUTER JOIN TBBADDED113M T4 -- 재부의 부의
                                                       ON (T2.AUD_YR = T4.AUD_YR AND T2.AUD_NO = T4.AUD_NO
                                                           AND T2.DOC_ID = T4.DOC_ID 
                                                           AND T4.APVR_CD = '0010600' )
                                                       LEFT OUTER JOIN TBBADDED103M T5 -- 재부의 주심위원 설명자료
                                                       ON (T5.REF_ID = T4.DOC_ID AND T5.RPRT_CD = 'A10700100')
                                                       LEFT OUTER JOIN TBDCMACM023H T6 -- 재부의 결재정보
                                                       ON (T5.APV_RQS_ID = T6.APV_DOC_NO AND T6.APVR_PST_CD = '0010600')
                                                       LEFT OUTER JOIN TBBADDED146M T7 -- 원 부의 처분요구
                                                       ON (T7.AUD_YR = T1.AUD_YR AND T7.AUD_NO = T1.AUD_NO
                                                           AND T7.DOC_ID = T1.DOC_ID AND T7.APVR_CD = 'A107001' 
                                                           AND T7.AFF_SNO = T1.AFF_SNO AND T7.DSP_RQ_SNO = T1.DSP_RQ_SNO)
                                             WHERE T1.SBCN_VT_CD = '90'
                                                AND EXISTS (SELECT 1 FROM TBBADDED103M A WHERE A.AUD_YR = T1.AUD_YR AND A.AUD_NO = T1.AUD_NO AND T1.DOC_ID = A.DOC_ID AND  NVL(A.USE_YN,'Y') <> 'N')
                                                AND ((T2.HD_DOC_ID IS NULL AND T7.DF_DOC_ID IS NULL)
                                                          OR (T2.HD_DOC_ID IS NOT NULL AND T7.DF_DOC_ID IS NOT NULL))
                                             GROUP BY T1.AUD_YR, T1.AUD_NO, T1.DOC_ID, T2.DOC_ID) D3
                                         LEFT OUTER JOIN TBBADDED103M D1
                                         ON (D3.AUD_YR = D1.AUD_YR AND D3.AUD_NO = D1.AUD_NO 
                                            AND (D3.RE_DOC_ID = D1.DOC_ID OR D3.RE_DOC_ID = D1.REF_ID)
                                            AND D1.AUD_RPRT_DVSN_CD = '40'
                                            AND D1.RPRT_CD          IN ('A10600200','A10700100'))
                                         LEFT OUTER JOIN (SELECT A.SEQ
                                                              ,A.APV_DOC_NO
                                                              ,A.APVR_PST_CD
                                                              ,A.APVR_KND_CD
                                                              ,A.APVR_STA_CD
                                                              ,A.APV_DH
                                                              ,A.APV_DVSN_CD
                                                              ,A.APVR_CNB
                                                          FROM TBDCMACM023H A
                                                        UNION ALL
                                                        SELECT 9999999999 AS SEQ
                                                              ,B.APV_DOC_NO
                                                              ,B.APVR_PST_CD
                                                              ,B.APVR_KND_CD
                                                              ,B.APVR_STA_CD
                                                              ,B.APV_DH
                                                              ,B.APV_DVSN_CD
                                                              ,B.APVR_CNB
                                                          FROM TBDCMACM023L B
                                                         WHERE B.APVR_STA_CD IN ('102','103')
                                                           AND NOT EXISTS (SELECT 'X'
                                                                             FROM TBDCMACM023H S
                                                                            WHERE S.APV_DOC_NO  = B.APV_DOC_NO 
                                                                              AND S.APV_DVSN_CD = B.APV_DVSN_CD
                                                                              AND S.APVR_CNB    = B.APVR_CNB   
                                                                      )
                                                         ORDER BY SEQ) D2
                                         ON (D1.APV_RQS_ID = D2.APV_DOC_NO AND D2.APVR_KND_CD      IN ('2','3','9'))
                                    WHERE D3.AUD_YR  BETWEEN #{schAudYr} AND #{schEndYr}
                                    ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ
                                   ) D3
                            WHERE (CASE WHEN D3.REFER_DVSN_D10 =  0 THEN NVL(D3.RE_WI_APV,TO_DATE('99991231'))    --부의건수가 없으면 위원결재일
                                        WHEN D3.REFER_DVSN_D10 <> 0 THEN TO_DATE(NVL(D3.RE_SBCN_DY,'99991231'))   --부의건수가 있으면 부의일
                                        ELSE TO_DATE('99991231')
                                        END) > SYSDATE
                            GROUP BY D3.AUD_YR,D3.AUD_NO,D3.AUD_RPRT_DVSN_CD,D3.DOC_ID, D3.RE_DOC_ID
                            
                           ),
     CHF_CMTR_INFO AS (/* 주심위원FF : CHF_CMTR_INFO */
                        SELECT B.AUD_YR
                              ,B.AUD_NO
                              ,B.DOC_ID
                              ,B.CHF_CMTR_NM||DECODE(B.CHF_CMTR_CNT,0,'',' 외'||B.CHF_CMTR_CNT) AS CHF_CMTR_NM
                          FROM (SELECT A.AUD_YR
                                      ,A.AUD_NO
                                      ,A.DOC_ID
                                      ,(SELECT T1.USR_NAM
                                            FROM TBDCMACM001M T1
                                            WHERE T1.CNB = A.CHF_CMTR_CNB
                                              AND ROWNUM = 1)  AS CHF_CMTR_NM
                                      ,DECODE(CHF_CMTR1_CNB, NULL, 0, 1)
                                      +DECODE(CHF_CMTR2_CNB, NULL, 0, 1)
                                      +DECODE(CHF_CMTR3_CNB, NULL, 0, 1)
                                      +DECODE(CHF_CMTR4_CNB, NULL, 0, 1)
                                      +DECODE(CHF_CMTR5_CNB, NULL, 0, 1) AS CHF_CMTR_CNT
                                  FROM TBBADDED116L A
                                 WHERE 1=1
                                   AND A.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr}--PARAM
                                   AND A.TASK_DVSN_CD = '9'
                                   AND A.SRNO = (SELECT MAX(C.SRNO) FROM TBBADDED116L C
                                                  WHERE C.AUD_YR = A.AUD_YR
                                                    AND C.AUD_NO = A.AUD_NO
                                                    AND C.DOC_ID = A.DOC_ID
                                                )
                               ) B
                      )
/***************************** 국과별 처리상황 S***********************************/
SELECT DD.GUBN AS GUBN
      ,AA.DPT_SNO
      ,AA.AUD_YR_NO
      ,DD.DOC_ID
      ,AA.AUD_DPT_NM
      ,AA.AUD_SBJ_NM
      ,AA.AUD_KND_NM
      ,(SELECT T1.CD_NM
         FROM TBDCMACM013C T1
        WHERE T1.CMM_CD_DVSN_CD = '1000742'
          AND T1.CD = AA.AUD_KND_CD2
          AND ROWNUM = 1)   AS AUD_KND_CD2
      ,CASE WHEN AA.DPT_SNO = '440' THEN DECODE(AA.HNDL_DDLN_DT2,NULL,'',CHR(39) || TO_CHAR(TO_DATE(AA.HNDL_DDLN_DT2),'YY. MM. DD'))
            ELSE DECODE(AA.AUD_KND_CD2,'2',DECODE(AA.HNDL_DDLN_DT2,NULL,'',CHR(39) || TO_CHAR(AA.REQ_NTAS_DCS_DT+59,'YY. MM. DD')),
                 DECODE(AA.AUD_KND_CD2,'3',DECODE(AA.HNDL_DDLN_DT2,NULL,'',CHR(39) || TO_CHAR(ADD_MONTHS(AA.REQ_NTAS_DCS_DT,6),'YY. MM. DD')),
                 DECODE(AA.AUD_KND_CD2,'4',DECODE(AA.HNDL_DDLN_DT2,NULL,'',CHR(39) || TO_CHAR(ADD_MONTHS(AA.REQ_NTAS_DCS_DT,5),'YY. MM. DD'),''))))
             END AS AUD_DVSN_PROC_DT --청구국회처리기한(2:국민3:공익4:국회)
      ,CASE WHEN AA.DPT_SNO = '440' THEN DECODE(AA.EXAM_RPT_APV_DT,NULL,'',CHR(39) || TO_CHAR(TO_DATE(AA.EXAM_RPT_APV_DT),'YY. MM. DD'))
            WHEN AUD_STR_DT01 IS NULL THEN ''
            ELSE CHR(39) || TO_CHAR(BB.AUD_STR_DT01,'YY. MM. DD') 
        END                                                                     AS AUD_STR_DT01     --예비조사시작
      ,CASE WHEN BB.AUD_STR_DT02 IS NULL THEN ''
            ELSE CHR(39) || TO_CHAR(BB.AUD_STR_DT02,'YY. MM. DD') 
                 ||' ~ '||CHR(13)||CHR(10)|| CHR(39) || TO_CHAR(DECODE(BB.AUD_END_DT03,NULL,BB.AUD_END_DT02,BB.AUD_END_DT03),'YY. MM. DD')
                 ||' ('||TO_CHAR(NVL(AUD_DCN02,0)+NVL(AUD_DCN03,0))||'일)'
             END                                                                        AS AUD_STR_DT02     --실지감사 실시기간
      ,CASE WHEN DD.GUBN = '2' OR DD.GUBN = '4' THEN TO_CHAR(TO_DATE(DD.SBCN_DY),'MM. DD')||CHR(13)||CHR(10)||'(보류결정일)'
            WHEN NVL(CC.E_CHA_KND,'0') <> '9' THEN TO_CHAR(CC.E_CHA_APV,'MM. DD')
            WHEN NVL(CC.E_GUK_KND,'0') <> '9' THEN TO_CHAR(CC.E_GUK_APV,'MM. DD')
            WHEN NVL(CC.E_GWA_KND,'0') <> '9' THEN TO_CHAR(CC.E_GWA_APV,'MM. DD')
            ELSE '' END                                                               AS E_CHA_APV        --종료보고차장결재
      ,NVL(TO_CHAR(DD.GWA_APV  ,'MM. DD'),DECODE(DD.RE_DOC_ID,NULL,'미작성','검토중')) AS GWA_APV          --과장결재
      ,CASE WHEN DD.GWA_APV IS NOT NULL AND DD.GUK_APP IS     NULL AND DD.GUK_APV IS     NULL THEN '검토중'
            WHEN DD.GUK_APP IS     NULL AND DD.GUK_APV IS     NULL THEN ''
            WHEN DD.GUK_APP IS NOT NULL AND DD.GUK_APV IS     NULL THEN TO_CHAR(DD.GUK_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||'검토중'
            WHEN DD.GUK_APP IS NOT NULL AND DD.GUK_APV IS NOT NULL THEN TO_CHAR(DD.GUK_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||TO_CHAR(DD.GUK_APV,'MM. DD')
            ELSE 'ERR' END AS GUK_APV   --국장
      ,CASE WHEN DD.CHA_APP IS     NULL AND DD.CHA_APV IS     NULL THEN ''
            WHEN DD.CHA_APP IS NOT NULL AND DD.CHA_APV IS     NULL THEN TO_CHAR(DD.CHA_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||'검토중'
            WHEN DD.CHA_APP IS NOT NULL AND DD.CHA_APV IS NOT NULL THEN TO_CHAR(DD.CHA_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||TO_CHAR(DD.CHA_APV,'MM. DD')
            ELSE 'ERR' END AS CHA_APV   --차장
      ,CASE WHEN DD.CHONG_APP IS     NULL AND DD.CHONG_APV IS     NULL THEN ''
            WHEN DD.CHONG_APP IS NOT NULL AND DD.CHONG_APV IS     NULL THEN TO_CHAR(DD.CHONG_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||'검토중'
            WHEN DD.CHONG_APP IS NOT NULL AND DD.CHONG_APV IS NOT NULL THEN TO_CHAR(DD.CHONG_APP,'MM. DD') ||' ~ '||CHR(13)||CHR(10)||TO_CHAR(DD.CHONG_APV,'MM. DD')
            ELSE 'ERR' END AS CHONG_APV --총장
      ,CASE WHEN DD.WI_APP IS     NULL AND DD.WI_APV IS     NULL AND DD.CHONG_APV IS NOT NULL THEN FF.CHF_CMTR_NM
            WHEN DD.WI_APP IS     NULL AND DD.WI_APV IS     NULL THEN ''
            WHEN DD.WI_APP IS NOT NULL AND DD.WI_APV IS     NULL THEN FF.CHF_CMTR_NM ||CHR(13)||CHR(10)|| TO_CHAR(DD.WI_APP,'MM. DD') ||' ~ '||'검토중'
            WHEN DD.WI_APP IS NOT NULL AND DD.WI_APV IS NOT NULL THEN FF.CHF_CMTR_NM ||CHR(13)||CHR(10)|| TO_CHAR(DD.WI_APP,'MM. DD') ||' ~ '||TO_CHAR(DD.WI_APV,'MM. DD')
            ELSE 'ERR' END AS WI_APV    --위원
      , DD.RE_DOC_ID
      , DECODE(DD.SBCN_CNT,0,'미정',DD.SBCN_CNT||'건') AS SBCN_CNT
  FROM BASIS_INFO        AA --기본정보AA
      ,BSRP_INFO         BB --출장정보BB
      ,END_APV_INFO      CC --종료보고결재CC
      ,AUD_RPRT_APV_INFO DD --감사보고서(위원) 결재정보DD
      ,CHF_CMTR_INFO     FF --주심위원FF
 WHERE AA.AUD_YR = BB.AUD_YR(+) AND AA.AUD_NO = BB.AUD_NO(+)
   AND AA.AUD_YR = CC.AUD_YR(+) AND AA.AUD_NO = CC.AUD_NO(+)
   AND AA.AUD_YR = DD.AUD_YR AND AA.AUD_NO = DD.AUD_NO
   AND DD.AUD_YR = FF.AUD_YR(+) AND DD.AUD_NO = FF.AUD_NO(+)  AND DD.DOC_ID = FF.DOC_ID(+)
   AND BB.AUD_STR_DT02 IS NOT NULL                                   --실지감사 출장정보가 있는 감사
   AND NVL(DD.USE_YN,'Y') <> 'N'
   -- AND AA.DPT_SNO NOT IN ('530','640') --국방,첨단,감찰 제외
    
    
 ORDER BY AA.DPT_SNO,AA.AUD_DPT_NM,AA.AUD_YR_NO,GUBN 
    ]]>
   </select>
    <select id="selectChfPrcsSituList" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.aep.fer.dao.AEPFER004QMapper.selectChfPrcsSituList */
     <![CDATA[
            WITH BASIS_INFO AS (/* 기본정보AA : BASIS_INFO */
                            SELECT A1.AUD_YR                                                    AS AUD_YR       --감사년도
                                  ,A1.AUD_NO                                                    AS AUD_NO       --감사번호
                                  ,A1.AUD_KND_CD                                                AS AUD_KND_CD   --감사종류코드(1:재무,2:특정,3:성과,4:기관,5:확인,9:서면)
                                  ,F_MNG_KND_AUDYRNO(A1.AUD_YR, A1.AUD_NO, A1.AUD_KND_CD, '-')  AS AUD_YR_NO    --분류번호   
                                  ,(SELECT T4.ABR_DPT_NM_1
                                         FROM TBDCMACM002M T4
                                        WHERE T4.DPT_CD = (SELECT A2.HIRK_DPT_CD
                                                             FROM TBDCMACM002M A2
                                                            WHERE A2.DPT_CD =  A1.MNG_DPT_CD)
                                           AND T4.USE_YN = 'Y'
                                           AND ROWNUM = 1)                                  AS HIRK_DPT_NM  --국
                                  ,  (SELECT A2.HIRK_DPT_CD
                                                             FROM TBDCMACM002M A2
                                                            WHERE A2.DPT_CD =  A1.SPV_BRDV_CD) AS HIRK_DPT_CD
                                  ,(SELECT ABR_DPT_NM_1
                                      FROM TBDCMACM002M
                                     WHERE DPT_CD = A1.MNG_DPT_CD)                             AS AUD_DPT_NM   --과
                                  ,A1.AUD_SBJ_NM                                                AS AUD_SBJ_NM   --감사사항명
                                  ,F_CODE_NM('1000739', A1.AUD_KND_CD)  AS AUD_KND_NM   --종류코드2(1:민원2:국민3:공익4:국회5:심사6:재심8:손망9:판청)
                                  ,(SELECT A6.DVSN_CD
                                      FROM TBBADDED030L A6
                                     WHERE A6.AUD_YR = A1.AUD_YR
                                       AND A6.AUD_NO = A1.AUD_NO
                                       AND A6.SRNO   = 1)                                       AS AUD_KND_CD2  --종류코드2
                                  ,(SELECT TO_DATE(A5.REQ_NTAS_DCS_DT)
                                      FROM TBBADDED003M A5
                                     WHERE A5.AUD_YR = A1.AUD_YR
                                       AND A5.AUD_NO = A1.AUD_NO)                               AS REQ_NTAS_DCS_DT  --청구국회결정일
                                  ,(SELECT NVL(A7.EXTN_PRD_COFM_DT,0)
                                      FROM TBBADDED003M A7
                                     WHERE A7.AUD_YR = A1.AUD_YR
                                       AND A7.AUD_NO = A1.AUD_NO)                               AS EXTN_PRD_COFM_DT  --연장승인일
                                  ,B.DPT_SNO
                                  ,(SELECT T1.DPT_SNO FROM TBDCMACM002M T1 WHERE T1.DPT_CD = A1.MNG_DPT_CD) AS R_DPT_SNO
                                  ,B.DPT_CD
                                  ,B.DPT_NM
                                  ,(SELECT MAX(TO_CHAR(TO_DATE(A8.EXAM_RPT_APV_DT),'YYYY-MM-DD')) AS EXAM_RPT_APV_DT
                                      FROM TBCSPEAR001M A8
                                          ,(SELECT TSK_KEY1 AS ACP_YR
                                                  ,TSK_KEY2 AS REQ_DVSN_CD
                                                  ,TSK_KEY3 AS CVPT_ACP_NO
                                                  ,AUD_YR
                                                  ,AUD_NO
                                              FROM TBBADDED030L) A9
                                          ,TBBADDED001M A10
                                     WHERE A8.ACP_YR      = A9.ACP_YR(+)
                                       AND A8.REQ_DVSN_CD = A9.REQ_DVSN_CD(+)
                                       AND A8.CVPT_ACP_NO = A9.CVPT_ACP_NO(+)     
                                       AND A9.AUD_YR      = A10.AUD_YR 
                                       AND A9.AUD_NO      = A10.AUD_NO
                                       AND A10.AUD_YR     = A1.AUD_YR
                                       AND A10.AUD_NO     = A1.AUD_NO
                                   ) AS EXAM_RPT_APV_DT --감사실시여부검토일
                                  ,(SELECT MAX(
                                           CASE WHEN A8.REQ_DVSN_CD IN ('2','3') AND (A8.EXAM_RPT_APV_DT IS NULL OR A8.REQ_EXAM_RSLT_CD <> '01') THEN ''
                                                WHEN A8.REQ_DVSN_CD = '2' AND (A8.EXAM_RPT_APV_DT IS NOT NULL AND A8.REQ_EXAM_RSLT_CD = '01') THEN TO_CHAR(TO_DATE(A8.EXAM_RPT_APV_DT)+60, 'YYYY-MM-DD')
                                                WHEN A8.REQ_DVSN_CD = '3' AND (A8.EXAM_RPT_APV_DT IS NOT NULL AND A8.REQ_EXAM_RSLT_CD = '01') THEN TO_CHAR(ADD_MONTHS(TO_DATE(A8.EXAM_RPT_APV_DT) , 6), 'YYYY-MM-DD')
                                                ELSE '' END) AS HNDL_DDLN_DT2
                                      FROM TBCSPEAR001M A8
                                          ,(SELECT TSK_KEY1 AS ACP_YR
                                                  ,TSK_KEY2 AS REQ_DVSN_CD
                                                  ,TSK_KEY3 AS CVPT_ACP_NO
                                                  ,AUD_YR
                                                  ,AUD_NO
                                              FROM TBBADDED030L) A9
                                          ,TBBADDED001M A10
                                     WHERE A8.ACP_YR      = A9.ACP_YR(+)
                                       AND A8.REQ_DVSN_CD = A9.REQ_DVSN_CD(+)
                                       AND A8.CVPT_ACP_NO = A9.CVPT_ACP_NO(+)     
                                       AND A9.AUD_YR      = A10.AUD_YR 
                                       AND A9.AUD_NO      = A10.AUD_NO
                                       AND A10.AUD_YR     = A1.AUD_YR
                                       AND A10.AUD_NO     = A1.AUD_NO
                                   ) AS HNDL_DDLN_DT2 --감사처리기한
                                   , C.AUD_EXEC_HNDL_STA_CD
                              FROM TBBADDED001M A1
                                  ,(SELECT S1.DPT_SNO
                                          ,S1.DPT_CD
                                          ,S1.DPT_NM
                                      FROM TBDCMACM002M S1
                                     WHERE S1.USE_YN         = 'Y'
                                       AND S1.IMD_CD         = 'Y'
                                       AND S1.ORZT_DVSN_CD   = '20'
                                       --AND S1.DPT_CD NOT IN ('100000','150000')
                                     ORDER BY S1.DPT_SNO
                                   ) B
                                   , TBBADDED003M C
                             WHERE 1=1
                               AND A1.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr}   --PARAM
                               AND SUBSTR(A1.MNG_DPT_CD, 1, 3) || '000' = B.DPT_CD(+)
                               AND SUBSTR(A1.AUD_KND_CD,3,1) <> '5' --확인출장제외
                               AND A1.AUD_YR = C.AUD_YR
                               AND A1.AUD_NO = C.AUD_NO
                           ),
             BSRP_INFO AS (/* 출장정보BB : BSRP_INFO */
                            SELECT B2.REL_AUD_YR AS AUD_YR
                                  ,B2.REL_AUD_NO AS AUD_NO
                                  ,MIN(B2.AUD_STR_DT00) AS AUD_STR_DT00 --자료수집 시작일
                                  ,MAX(B2.AUD_END_DT00) AS AUD_END_DT00 --자료수집 종료일
                                  ,SUM(B2.AUD_DCN00)    AS AUD_DCN00    --자료수집 출장일수
                                  ,MIN(B2.AUD_STR_DT01) AS AUD_STR_DT01 --예비조사 시작일
                                  ,MAX(B2.AUD_END_DT01) AS AUD_END_DT01 --예비조사 종료일
                                  ,SUM(B2.AUD_DCN01)    AS AUD_DCN01    --예비조사 출장일수
                                  ,MIN(B2.AUD_STR_DT02) AS AUD_STR_DT02 --실지감사 시작일
                                  ,MAX(B2.AUD_END_DT02) AS AUD_END_DT02 --실지감사 종료일
                                  ,SUM(B2.AUD_DCN02)    AS AUD_DCN02    --실지감사 출장일수
                                  ,MIN(B2.AUD_STR_DT03) AS AUD_STR_DT03 --실지감사연장 시작일
                                  ,MAX(B2.AUD_END_DT03) AS AUD_END_DT03 --실지감사연장 종료일
                                  ,SUM(B2.AUD_DCN03)    AS AUD_DCN03    --실지감사연장 출장일수
                                  ,DECODE(MAX(B2.AUD_END_DT03),NULL,MAX(B2.AUD_END_DT02)+1,MAX(B2.AUD_END_DT03)+1) AS RETURN_DT  --귀청일
                                  ,(SELECT SUM((NVL(TRUNC((TO_DATE(TO_CHAR(TO_DATE(B3.AUD_END_DT), 'YYYYMMDD'))- TO_DATE(TO_CHAR(TO_DATE(B3.AUD_STR_DT) , 'YYYYMMDD'))) +1,0),0)))
                                      FROM TBBADDED002M B3
                                     WHERE B3.REL_AUD_YR = B2.REL_AUD_YR
                                       AND B3.REL_AUD_NO = B2.REL_AUD_NO
                                       AND B3.AUD_BZT_KND_CD IN ('02','03')) AS AUD_BSRP_SUM
                              FROM (SELECT B1.REL_AUD_YR,B1.REL_AUD_NO
                                          ,DECODE(B1.AUD_BZT_KND_CD,'00',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT00
                                          ,DECODE(B1.AUD_BZT_KND_CD,'00',TO_DATE(AUD_END_DT)) AS AUD_END_DT00
                                          ,DECODE(B1.AUD_BZT_KND_CD,'00',AUD_DCN            ) AS AUD_DCN00
                                          ,DECODE(B1.AUD_BZT_KND_CD,'01',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT01
                                          ,DECODE(B1.AUD_BZT_KND_CD,'01',TO_DATE(AUD_END_DT)) AS AUD_END_DT01
                                          ,DECODE(B1.AUD_BZT_KND_CD,'01',AUD_DCN            ) AS AUD_DCN01
                                          ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT02
                                          ,DECODE(B1.AUD_BZT_KND_CD,'02',TO_DATE(AUD_END_DT)) AS AUD_END_DT02
                                          ,DECODE(B1.AUD_BZT_KND_CD,'02',AUD_DCN            ) AS AUD_DCN02
                                          ,DECODE(B1.AUD_BZT_KND_CD,'03',TO_DATE(AUD_STR_DT)) AS AUD_STR_DT03
                                          ,DECODE(B1.AUD_BZT_KND_CD,'03',TO_DATE(AUD_END_DT)) AS AUD_END_DT03
                                          ,DECODE(B1.AUD_BZT_KND_CD,'03',AUD_DCN            ) AS AUD_DCN03
                                      FROM TBBADDED002M B1
                                               INNER JOIN TBBADDED001M B2
                                                          ON B1.REL_AUD_YR = B2.AUD_YR
                                                         AND B1.REL_AUD_NO = B2.AUD_NO
                                     WHERE B2.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr} --PARAM
                                         AND B2.AUD_KND_CD NOT LIKE '5%'
                                   ) B2
                             GROUP BY B2.REL_AUD_YR,B2.REL_AUD_NO
                            ),
             AUD_RPRT_APV_INFO AS (/* 감사보고서(위원) 결재정보DD : AUD_RPRT_APV_INFO */
                                   SELECT D3.AUD_YR
                                         ,D3.AUD_NO
                                         ,D3.AUD_RPRT_DVSN_CD      AS AUD_RPRT_DVSN_CD
                                         ,D3.DOC_ID                AS DOC_ID
                                         ,MIN(D3.GWA_APV)          AS GWA_APV
                                         ,MIN(D3.GUK_APP)          AS GUK_APP
                                         ,MIN(D3.GUK_APV)          AS GUK_APV
                                         ,MIN(D3.CHA_APP)          AS CHA_APP
                                         ,MIN(D3.CHA_APV)          AS CHA_APV
                                         ,MIN(D3.CHONG_APP)        AS CHONG_APP
                                         ,MIN(D3.CHONG_APV)        AS CHONG_APV
                                         ,MAX(D3.FNL_APV)          AS FNL_APV
                                         ,MIN(D3.WI_APP)           AS WI_APP
                                         ,MIN(D3.WI_APV)           AS WI_APV
                                         ,MAX(D3.SYT_TRTM_DVSN_YN) AS SYT_TRTM_DVSN_YN
                                         ,MAX(D3.USE_YN)           AS USE_YN
                                         ,MAX(D3.AUD_RPRT_STA_CD)  AS AUD_RPRT_STA_CD
                                         ,MAX(D3.WI_RPRT_STA_CD)   AS WI_RPRT_STA_CD
                                         ,'SBCN'                AS SBCN_GUBN
                                     FROM (
                                           SELECT D1.AUD_YR
                                                 ,D1.AUD_NO
                                                 ,D1.AUD_RPRT_DVSN_CD
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' THEN D1.DOC_ID
                                                       ELSE D1.REF_ID
                                                        END AS DOC_ID
                                                ,CASE WHEN D1.RPRT_CD = 'A10600200' AND (D2.APVR_PST_CD = '0013600' OR D2.APVR_PST_CD = '0057400' OR D2.APVR_PST_CD = '0035400') AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS GWA_APV   --과장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS GUK_APP   --국단실장접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS GUK_APV   --국단실장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS CHA_APP   --차장,본부장 접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS CHA_APV   --차장,본부장 결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS CHONG_APP --사무총장접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS CHONG_APV --사무총장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D1.APV_STA_CD = '30' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS FNL_APV   --최종결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ,D2.APV_DH DESC)
                                                       ELSE NULL
                                                        END AS WI_APP    --주심위원접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS WI_APV    --주심위원결재일
                                                 ,D1.SYT_TRTM_DVSN_YN
                                                 ,D1.USE_YN
                                                 ,DECODE(D1.RPRT_CD,'A10600200',D1.APV_STA_CD ) AS AUD_RPRT_STA_CD
                                                 ,DECODE(D1.RPRT_CD,'A10700100',D1.APV_STA_CD ) AS WI_RPRT_STA_CD
                                             FROM TBBADDED103M D1
                                                 ,(SELECT A.SEQ
                                                              ,A.APV_DOC_NO
                                                              ,A.APVR_PST_CD
                                                              ,A.APVR_KND_CD
                                                              ,A.APVR_STA_CD
                                                              ,A.APV_DH
                                                              ,A.APV_DVSN_CD
                                                              ,A.APVR_CNB
                                                          FROM TBDCMACM023H A
                                                        UNION ALL
                                                        SELECT 9999999999 AS SEQ
                                                              ,B.APV_DOC_NO
                                                              ,B.APVR_PST_CD
                                                              ,B.APVR_KND_CD
                                                              ,B.APVR_STA_CD
                                                              ,B.APV_DH
                                                              ,B.APV_DVSN_CD
                                                              ,B.APVR_CNB
                                                          FROM TBDCMACM023L B
                                                         WHERE B.APVR_STA_CD IN ('102','103')
                                                           AND NOT EXISTS (SELECT 'X'
                                                                             FROM TBDCMACM023H S
                                                                            WHERE S.APV_DOC_NO  = B.APV_DOC_NO 
                                                                              AND S.APV_DVSN_CD = B.APV_DVSN_CD
                                                                              AND S.APVR_CNB    = B.APVR_CNB   
                                                                      )
                                                         ORDER BY SEQ) D2
                                            WHERE D1.APV_RQS_ID = D2.APV_DOC_NO
                                              AND D1.AUD_YR   BETWEEN #{schAudYr} AND #{schEndYr} 
                                              AND D1.AUD_RPRT_DVSN_CD IN ('10','20','30') --재부의 제외
                                              AND D1.RPRT_CD          IN ('A10600200','A10700100') --감사보고서,주심위원설명자료
                                              AND D2.APVR_KND_CD      IN ('2','3','9')   --공석추가
                                              AND NVL(D1.USE_YN,'Y') <> 'N'                                              
                                            ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ/*D2.APV_SNO,D2.APVR_SEQ*/
                                           ) D3
                                    GROUP BY D3.AUD_YR,D3.AUD_NO,D3.AUD_RPRT_DVSN_CD,D3.DOC_ID
                                    UNION
                                    SELECT D3.AUD_YR
                                         ,D3.AUD_NO
                                         ,D3.AUD_RPRT_DVSN_CD      AS AUD_RPRT_DVSN_CD
                                         ,D3.DOC_ID                AS DOC_ID
                                         ,MIN(D3.GWA_APV)          AS GWA_APV
                                         ,MIN(D3.GUK_APP)          AS GUK_APP
                                         ,MIN(D3.GUK_APV)          AS GUK_APV
                                         ,MIN(D3.CHA_APP)          AS CHA_APP
                                         ,MIN(D3.CHA_APV)          AS CHA_APV
                                         ,MIN(D3.CHONG_APP)        AS CHONG_APP
                                         ,MIN(D3.CHONG_APV)        AS CHONG_APV
                                         ,MAX(D3.FNL_APV)          AS FNL_APV
                                         ,MIN(D3.WI_APP)           AS WI_APP
                                         ,MIN(D3.WI_APV)           AS WI_APV
                                         ,MAX(D3.SYT_TRTM_DVSN_YN) AS SYT_TRTM_DVSN_YN
                                         ,MAX(D3.USE_YN)           AS USE_YN
                                         ,MAX(D3.AUD_RPRT_STA_CD)  AS AUD_RPRT_STA_CD
                                         ,MAX(D3.WI_RPRT_STA_CD)   AS WI_RPRT_STA_CD
                                         ,'RE_SBCN'                AS SBCN_GUBN
                                     FROM (
                                           SELECT D3.AUD_YR
                                                 ,D3.AUD_NO
                                                 ,NVL(D1.AUD_RPRT_DVSN_CD,'40') AS AUD_RPRT_DVSN_CD
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' THEN D1.DOC_ID
                                                       ELSE D1.REF_ID
                                                        END AS DOC_ID
                                                ,CASE WHEN D1.RPRT_CD = 'A10600200' AND (D2.APVR_PST_CD = '0013600' OR D2.APVR_PST_CD = '0057400' OR D2.APVR_PST_CD = '0035400') AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
			                                               ELSE NULL
			                                                END AS GWA_APV   --과장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS GUK_APP   --국단실장접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0015800' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0035100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0058100' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS GUK_APV   --국단실장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS CHA_APP   --차장,본부장 접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0045900' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS CHA_APV   --차장,본부장 결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ)
                                                       ELSE NULL
                                                        END AS CHONG_APP --사무총장접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D2.APVR_PST_CD = '0055700' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS CHONG_APV --사무총장결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10600200' AND D1.APV_STA_CD = '30' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS FNL_APV   --최종결재일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' THEN LAG(D2.APV_DH) OVER (ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ,D2.APV_DH DESC)
                                                       ELSE NULL
                                                        END AS WI_APP    --주심위원접수일
                                                 ,CASE WHEN D1.RPRT_CD = 'A10700100' AND D2.APVR_PST_CD = '0010600' AND D2.APVR_STA_CD <> '401' THEN D2.APV_DH
                                                       ELSE NULL
                                                        END AS WI_APV    --주심위원결재일
                                                 ,D1.SYT_TRTM_DVSN_YN
                                                 ,D1.USE_YN
                                                 ,DECODE(D1.RPRT_CD,'A10600200',D1.APV_STA_CD ) AS AUD_RPRT_STA_CD
                                                 ,DECODE(D1.RPRT_CD,'A10700100',D1.APV_STA_CD ) AS WI_RPRT_STA_CD
                                                 ,D3.REFER_DVSN_D10
                                                 ,D3.REFER_DVSN_E10
                                                 ,D3.SBCN_DY
                                                 ,D3.RE_SBCN_DY
                                                 ,D3.RE_WI_APV
                                                 ,D3.RE_DOC_ID
                                                 ,D3.RE_SBCN_CNT
                                             FROM (SELECT 
                                                T1.AUD_YR
                                                , T1.AUD_NO
                                                , T1.DOC_ID AS DOC_ID
                                                , T2.DOC_ID AS RE_DOC_ID
                                                , SUM(CASE WHEN T3.REFER_DVSN_CD = 'D10' THEN 1 ELSE 0 END) AS REFER_DVSN_D10   --부의
                                                , SUM(CASE WHEN T3.REFER_DVSN_CD = 'E10' THEN 1 ELSE 0 END) AS REFER_DVSN_E10   --위임
                                                , MIN(T1.SBCN_DY) AS SBCN_DY
                                                , MIN(T4.SBCN_DY) AS RE_SBCN_DY
                                                , MAX(T5.APV_STA_CD)
                                                , MIN(T6.APV_DH) AS RE_WI_APV      -- 재부의 주심위원설명자료 결재일자
                                                , COUNT(DISTINCT T4.DSP_RQ_SNO) AS RE_SBCN_CNT
                                               FROM TBBADDED113M T1 -- 원 부의
                                                       LEFT OUTER JOIN TBBADDED146M T2 -- 재부의 처분요구
                                                       ON (T1.AUD_YR = T2.AUD_YR AND T1.AUD_NO = T2.AUD_NO
                                                       AND T1.DOC_ID = T2.HD_DOC_ID AND T2.HD_APVR_CD = 'A107001'
                                                           AND T1.AFF_SNO = T2.HD_AFF_SNO AND T1.DSP_RQ_SNO = T2.HD_DSP_RQ_SNO)
                                                       LEFT OUTER JOIN TBBADDED145M T3 -- 재부의 사건
                                                       ON (T2.AUD_YR = T3.AUD_YR AND T2.AUD_NO = T3.AUD_NO
                                                           AND T2.AUD_STEP_CD = T3.AUD_STEP_CD AND T2.DOC_ID = T3.DOC_ID 
                                                           AND T2.APVR_CD = T3.APVR_CD AND T2.AFF_SNO = T3.AFF_SNO)
                                                       LEFT OUTER JOIN TBBADDED113M T4 -- 재부의 부의
                                                       ON (T2.AUD_YR = T4.AUD_YR AND T2.AUD_NO = T4.AUD_NO
                                                           AND T2.DOC_ID = T4.DOC_ID 
                                                           AND T4.APVR_CD = '0010600' )
                                                       LEFT OUTER JOIN TBBADDED103M T5 -- 재부의 주심위원 설명자료
                                                       ON (T5.REF_ID = T4.DOC_ID AND T5.RPRT_CD = 'A10700100')
                                                       LEFT OUTER JOIN TBDCMACM023H T6 -- 재부의 결재정보
                                                       ON (T5.APV_RQS_ID = T6.APV_DOC_NO AND T6.APVR_PST_CD = '0010600')
                                                       LEFT OUTER JOIN TBBADDED146M T7 -- 원 부의 처분요구
                                                       ON (T7.AUD_YR = T1.AUD_YR AND T7.AUD_NO = T1.AUD_NO
                                                           AND T7.DOC_ID = T1.DOC_ID AND T7.APVR_CD = 'A107001' 
                                                           AND T7.AFF_SNO = T1.AFF_SNO AND T7.DSP_RQ_SNO = T1.DSP_RQ_SNO)
                                             WHERE T1.SBCN_VT_CD = '90'
                                                    AND EXISTS (SELECT 1 FROM TBBADDED103M A WHERE A.AUD_YR = T1.AUD_YR AND A.AUD_NO = T1.AUD_NO AND T1.DOC_ID = A.DOC_ID AND  NVL(A.USE_YN,'Y') <> 'N')
                                                     GROUP BY T1.AUD_YR, T1.AUD_NO, T1.DOC_ID, T2.DOC_ID) D3
                                                 LEFT OUTER JOIN TBBADDED103M D1
                                                 ON (D3.AUD_YR = D1.AUD_YR AND D3.AUD_NO = D1.AUD_NO 
                                                    AND (D3.RE_DOC_ID = D1.DOC_ID OR D3.RE_DOC_ID = D1.REF_ID)
                                                    AND D1.AUD_RPRT_DVSN_CD = '40'
                                                    AND D1.RPRT_CD          IN ('A10600200','A10700100'))
                                                 LEFT OUTER JOIN (SELECT A.SEQ
                                                              ,A.APV_DOC_NO
                                                              ,A.APVR_PST_CD
                                                              ,A.APVR_KND_CD
                                                              ,A.APVR_STA_CD
                                                              ,A.APV_DH
                                                              ,A.APV_DVSN_CD
                                                              ,A.APVR_CNB
                                                          FROM TBDCMACM023H A
                                                        UNION ALL
                                                        SELECT 9999999999 AS SEQ
                                                              ,B.APV_DOC_NO
                                                              ,B.APVR_PST_CD
                                                              ,B.APVR_KND_CD
                                                              ,B.APVR_STA_CD
                                                              ,B.APV_DH
                                                              ,B.APV_DVSN_CD
                                                              ,B.APVR_CNB
                                                          FROM TBDCMACM023L B
                                                         WHERE B.APVR_STA_CD IN ('102','103')
                                                           AND NOT EXISTS (SELECT 'X'
                                                                             FROM TBDCMACM023H S
                                                                            WHERE S.APV_DOC_NO  = B.APV_DOC_NO 
                                                                              AND S.APV_DVSN_CD = B.APV_DVSN_CD
                                                                              AND S.APVR_CNB    = B.APVR_CNB   
                                                                      )
                                                         ORDER BY SEQ) D2
                                                 ON (D1.APV_RQS_ID = D2.APV_DOC_NO AND D2.APVR_KND_CD      IN ('2','3','9'))
                                            WHERE D3.AUD_YR   BETWEEN #{schAudYr} AND #{schEndYr}
                                            ORDER BY D1.AUD_YR,D1.AUD_NO,D1.RPRT_CD,D1.AUD_RPRT_DVSN_CD,D2.SEQ
                                           ) D3
                                    WHERE (CASE WHEN D3.REFER_DVSN_D10 =  0 THEN NVL(D3.RE_WI_APV,TO_DATE('99991231'))    --부의건수가 없으면 위원결재일
                                                WHEN D3.REFER_DVSN_D10 <> 0 THEN TO_DATE(NVL(D3.RE_SBCN_DY,'99991231'))   --부의건수가 있으면 부의일
                                                ELSE TO_DATE('99991231')
                                                END) > SYSDATE
                                    GROUP BY D3.AUD_YR,D3.AUD_NO,D3.AUD_RPRT_DVSN_CD,D3.DOC_ID, D3.RE_DOC_ID
                                    
                                   ),
             CHF_CMTR_INFO AS (/* 주심위원FF : CHF_CMTR_INFO */
                                SELECT A.AUD_YR
                                      ,A.AUD_NO
                                      ,A.DOC_ID
                                      ,F_USR_INFO(A.CHF_CMTR_CNB,'2') AS CHF_CMTR_NM
                                      ,B.RAL_BLT_DIV_CD -- 실소속 부서코드
                                  FROM TBBADDED116L A
                                       INNER JOIN TBDCMACM001M B
                                       ON (A.CHF_CMTR_CNB = B.CNB)
                                 WHERE 1=1
                                   AND A.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr} --PARAM
                                   AND A.TASK_DVSN_CD = '9'
                                   AND A.SRNO = (SELECT MAX(C.SRNO) FROM TBBADDED116L C
                                                  WHERE C.AUD_YR = A.AUD_YR
                                                    AND C.AUD_NO = A.AUD_NO
                                                    AND C.DOC_ID = A.DOC_ID
                                                )
                              ),
             AFF_CNT_INFO AS (/* 사건정보GG : AFF_CNT_INFO */
                              SELECT A.AUD_YR
                                    ,A.AUD_NO
                                    ,A.DOC_ID
                                    ,SUM(CASE WHEN A.FNL_YN= 'Y' AND A.REFER_DVSN_CD = 'D10' THEN 1 ELSE 0 END) AS REFER_DVSN_D10   --부의
                                    ,SUM(CASE WHEN A.FNL_YN= 'Y' AND A.REFER_DVSN_CD = 'E10' THEN 1 ELSE 0 END) AS REFER_DVSN_E10   --위임
                                    ,MIN(C.SBCN_DY) AS SBCN_DY  --최초부의일
                                    ,MIN(E.ENF_DT)  AS ENF_DT   --최초시행일
                                FROM TBBADDED145M A
                                    ,TBBADDED146M B
                                    ,TBBADDED113M C
                                    ,(SELECT A7.AUD_YR
                                            ,A7.AUD_NO
                                            ,'A1070' AS APVR_CD
                                            ,A7.AUD_DSP_RQ_SNO
                                            ,A3.ENF_DT
                                        FROM TBBADEAR001M A7
                                            ,TBBADEAR002D A3
                                       WHERE A7.AUD_YR      = A3.AUD_YR
                                         AND A7.AUD_NO      = A3.AUD_NO
                                         AND A7.DSP_RQ_SNO  = A3.DSP_RQ_SNO
                                     ) E
                               WHERE 1=1
                                 AND A.AUD_YR      = B.AUD_YR
                                 AND A.AUD_NO      = B.AUD_NO
                                 AND A.AUD_STEP_CD = B.AUD_STEP_CD
                                 AND A.DOC_ID      = B.DOC_ID
                                 AND A.APVR_CD     = B.APVR_CD
                                 AND A.AFF_SNO     = B.AFF_SNO
                                 AND B.DSP_RQ_CD NOT IN ('390','391','395','396','490','495','730')
                                 AND B.AUD_YR      = C.AUD_YR(+)
                                 AND B.AUD_NO      = C.AUD_NO(+)
                                 AND B.DOC_ID      = C.DOC_ID(+)
                                 AND B.APVR_CD     = C.APVR_CD(+)
                                 AND B.AFF_SNO     = C.AFF_SNO(+)
                                 AND B.DSP_RQ_SNO  = C.DSP_RQ_SNO(+)
                                 AND B.AUD_YR      = E.AUD_YR(+)
                                 AND B.AUD_NO      = E.AUD_NO(+)
                                 AND B.APVR_CD     = E.APVR_CD(+)
                                 AND B.DSP_RQ_SNO  = E.AUD_DSP_RQ_SNO(+)
                                 AND A.AUD_YR BETWEEN #{schAudYr} AND #{schEndYr}
                               GROUP BY A.AUD_YR,A.AUD_NO,A.DOC_ID
                               ORDER BY A.AUD_YR,A.AUD_NO,A.DOC_ID
                             )
        /***************************** 주심위원별 처리상황 ***********************************/
        
        SELECT 
            FF.CHF_CMTR_NM
            , AA.HIRK_DPT_NM||CHR(13)||CHR(10)||AA.AUD_DPT_NM AS AUD_DPT_NM
            , AA.AUD_YR_NO
            , AA.AUD_SBJ_NM||'('||DECODE(AUD_KND_CD2,NULL,AUD_KND_NM,F_CODE_NM('1000742',AUD_KND_CD2))||')' AS AUD_SBJ_NM
           , CHR(39) || NVL(TO_CHAR(DECODE(BB.AUD_END_DT03,NULL,BB.AUD_END_DT02+1,BB.AUD_END_DT03+1),'YY. MM. DD') ,'서면감사'||CHR(39)) AS BZT_END_DT
           , CASE WHEN DD.WI_APP IS NOT NULL THEN CHR(39) ||TO_CHAR(DD.WI_APP,'YY. MM. DD')  ELSE '접수전'  END AS WI_APP
            , DECODE(GG.REFER_DVSN_D10, 0, '위임',GG.REFER_DVSN_D10||'건') AS SBCN_CNT
            , (SELECT DECODE(MIN(ST1.SBCN_DY),NULL,'미 정',CHR(39) || TO_CHAR(TO_DATE(MIN(ST1.SBCN_DY)),'YY. MM. DD')) 
                 FROM TBBADDED113M ST1
                WHERE ST1.AUD_YR = AA.AUD_YR 
                  AND ST1.AUD_NO = AA.AUD_NO
                  AND ST1.DOC_ID = GG.DOC_ID) AS SBCN_DY
            , (SELECT DECODE(COUNT(1),0,'N','Y')
                FROM TBBADDED120M T1
                     INNER JOIN TBBADDED113M T2
                     ON (T1.CMT_DY = T2.SBCN_DY)
               WHERE T1.CMT_DVSN_CD = '10'
                 AND T1.CMT_END_YN = 'N'
                 AND T1.CMT_SQ = (SELECT MIN(CMT_SQ)
                                    FROM TBBADDED120M T1
                                   WHERE T1.CMT_DVSN_CD = '10'
                                     AND T1.CMT_END_YN = 'N') -- 차회 부의 회차
                 AND T2.AUD_YR = DD.AUD_YR
                 AND T2.AUD_NO = DD.AUD_NO
                 AND T2.DOC_ID = DD.DOC_ID) AS NEXT_SBCN_YN
            , F_CODE_NM('1000788', DD.AUD_RPRT_DVSN_CD) AS AUD_RPRT_DVSN_NM
          FROM BASIS_INFO        AA --기본정보AA
              ,BSRP_INFO         BB --출장정보BB
              ,AUD_RPRT_APV_INFO DD --감사보고서(위원) 결재정보DD
              ,CHF_CMTR_INFO     FF --주심위원FF
              ,AFF_CNT_INFO      GG --사건수GG
         WHERE AA.AUD_YR = BB.AUD_YR(+) AND AA.AUD_NO = BB.AUD_NO(+)
           AND AA.AUD_YR = DD.AUD_YR(+) AND AA.AUD_NO = DD.AUD_NO(+)
           AND DD.AUD_YR = FF.AUD_YR(+) AND DD.AUD_NO = FF.AUD_NO(+) AND DD.DOC_ID = FF.DOC_ID(+)
           AND DD.AUD_YR = GG.AUD_YR(+) AND DD.AUD_NO = GG.AUD_NO(+) AND DD.DOC_ID = GG.DOC_ID(+)
           AND (BB.AUD_STR_DT02 IS NOT NULL OR (BB.AUD_STR_DT02 IS NULL AND SUBSTR(AA.AUD_KND_CD, 3, 1)  = '9'  ))    --실지감사 출장정보가 있는 감사(서면감사이면서 출장정보가 없고 종료보고서가 없을때 추가 2018.05.25 CJLEE)
           AND (CASE WHEN GG.REFER_DVSN_D10 =  0 THEN NVL(DD.WI_APV,TO_DATE('99991231'))    -- 부의건수가 없으면 위원결재일
                     WHEN GG.REFER_DVSN_D10 <> 0 THEN TO_DATE(NVL(GG.SBCN_DY,'99991231'))   -- 부의건수가 있으면 부의일
                     WHEN DD.SBCN_GUBN = 'RE_SBCN' THEN TO_DATE('99991231')                 -- 재부의는 AUD_RPRT_APV_INFO에 조건 포함
                     ELSE TO_DATE('99991231')
                      END) > SYSDATE
           AND NVL(DD.USE_YN,'Y') <> 'N'
           AND (DD.DOC_ID IS NOT NULL 
                OR (DD.DOC_ID IS NULL AND AA.AUD_EXEC_HNDL_STA_CD != '9')) -- 감사보고서가 있을경우 감사보고서의 USE_YN, 없을경우 감사사항의 종료여부
           --AND AA.DPT_SNO NOT IN ('530','640') --국방,첨단,감찰 제외
           AND AA.AUD_EXEC_HNDL_STA_CD <> '9'
            AND (TO_DATE(DECODE(BB.AUD_END_DT03,NULL,BB.AUD_END_DT02,BB.AUD_END_DT03)) < NEXT_DAY(NEXT_DAY(SYSDATE,'2'),'4') 
                OR (BB.AUD_STR_DT02 IS NULL 
                    AND BB.AUD_END_DT03 IS NULL
                    AND SUBSTR(AA.AUD_KND_CD, 3, 1)  = '9'  )           
           )-- 조회일기준 다음주 수요일 이전 귀청건만 조회
       --    AND DD.WI_APP IS NOT NULL    -- 위원접수건만 조회
            AND FF.CHF_CMTR_NM IS NOT NULL
         ORDER BY FF.RAL_BLT_DIV_CD, AA.DPT_SNO, AA.R_DPT_SNO
       ]]>
   </select>
   
   <select id="selectCurrentYear" parameterType="paramMap" resultType="egovMap" >
       SELECT LEVEL AS CD
            , LEVEL AS CD_NM
         FROM DUAL
        WHERE LEVEL BETWEEN TO_CHAR(SYSDATE, 'YYYY') - 10 AND TO_CHAR(SYSDATE, 'YYYY')
   CONNECT BY LEVEL <![CDATA[<=]]> TO_CHAR(SYSDATE, 'YYYY')
   </select>
</mapper> 
