<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.pln.dao.AEPPLN001WMapper">

	<!-- 부서 과 리스트 조회 -->
	<select id="selectDeptList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001P.selectDeptList */
        <![CDATA[
          SELECT  A.CD, A.CD_NM, A.HIRK_DPT_CD 
            FROM(
		           SELECT DPT_CD AS CD,  F_CODE_NM('1000144', DPT_CD) AS CD_NM, HIRK_DPT_CD
                     FROM TBDCMACM002M
                    WHERE 1=1
					  AND DPT_CD NOT LIKE '%000'
					  AND DPT_CD NOT LIKE '0L0%'
					  AND DPT_CD <> '880880'
		              AND USE_YN = 'Y'
                 ) A
           WHERE CD_NM IS NOT NULL
         ]]>
            <if test="bizTripDptCd != null and bizTripDptCd != ''">
                    AND CD = #{bizTripDptCd}
            </if>
           ORDER BY CD 

	</select>
	
	
		<!-- 상세정보 등록 -->
<insert id="AEPPLN001EInsert" parameterType="paramMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001Mapper.AEPPLN001EInsert */
        <![CDATA[
        	INSERT INTO	TBBADDED128M
        				(	 AUD_PLAN_YR
        					,DPT_CD
							,AUD_PLAN_SNO
							,AUD_SBJ_NM
							,AUD_KND_CD
							,DATA_AUD_STR_DY
							,DATA_AUD_END_DY
							,DATA_AUD_DT
							,PREY_AUD_STR_DY
							,PREY_AUD_END_DY
							,PREY_AUD_DT
							,ACTU_AUD_STR_DY
							,ACTU_AUD_END_DY
							,ACTU_AUD_DT
							,PRSS_AUD_STR_DY
							,PRSS_AUD_END_DY
							,AUD_POINT
							,RLTN_ORG
							,MPP_AUD_YN
							,MPP_AUD_YR
							,MPP_AUD_NO
							,PLAN_PR_GUBN
							,PLAN_NUD_GUBN
							,PLAN_CHG_YN
							,FRT_USR_ID
							,FNL_USR_ID
							,FNL_DEAL_DPT_CD
							,FNL_MNU_ID
							,FRT_REGI_DH
							,FNL_MDF_DH

        				)
        		VALUES	(	 #{audPlanYr}
							,#{dptCd}
							,#{audPlanSno}
							,#{audSbjNm}
							,#{audKndCd}
							,#{dataAudStrDy}
							,#{dataAudEndDy}
							,#{dataAudDt}
							,#{preyAudStrDy}
							,#{preyAudEndDy}
							,#{preyAudDt}
							,#{actuAudStrDy}
							,#{actuAudEndDy}
							,#{actuAudDt}
							,#{prssAudStrDy}
							,#{prssAudEndDy}
							,#{audPoint}
							,#{rltnOrg}
							,#{mppAudYn}
							,#{mppAudYr}
							,#{mppAudNo}
							,#{planPrGubn}
							,#{planNudGubn}
							,#{planChgYn}
							,#{frtUsrId}
							,#{fnlUsrId}
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
        				)
		]]>
	</insert>
	
			<!-- 출장정보 등록 -->
<insert id="AEPPLN001PInsert" parameterType="paramMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001Mapper.AEPPLN001PInsert */
        <![CDATA[
        	INSERT INTO	TBBADDED129M
        				(	 AUD_PLAN_YR
        					,DPT_CD
							,AUD_PLAN_SNO
							,BIZ_TRIP_CD
							,BIZ_TRIP_DPT_CD
							,BIZ_TRIP_PER
							,SORT_SNO
							,FRT_USR_ID
							,FNL_USR_ID
							,FNL_DEAL_DPT_CD
							,FNL_MNU_ID
							,FRT_REGI_DH
							,FNL_MDF_DH

        				)
        		VALUES	(	 #{audPlanYr}
							,#{dptCd}
							,#{audPlanSno}
							,#{bizTripCd}
							,#{bizTripDptCd}
							,#{bizTripPer}
							,#{sortSno}
							,#{frtUsrId}
							,#{fnlUsrId}
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
        				)
		]]>
	</insert>
	<!--감사계획관리 감사계획일련번호 조회-->
	<select id="selectMaxAudplanSno" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001Mapper.selectMaxAudplanSno */
		<![CDATA[
			SELECT NVL(MAX(AUD_PLAN_SNO),0) + 1
			  FROM TBBADDED128M
			 WHERE AUD_PLAN_YR 		= #{audPlanYr}
			   AND DPT_CD  = #{dptCd}
		]]>
	</select>
		<!-- 감사계획관리 delete -->
	<delete id="TBBADDED128MDelete" parameterType="paramMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001Mapper.TBBADDED128MDelete */
		DELETE
		  FROM TBBADDED128M
		 WHERE AUD_PLAN_YR 		= #{audPlanYr}
		   AND DPT_CD 	        = #{dptCd}
		   AND AUD_PLAN_SNO		= #{audPlanSno}
	</delete>
			<!-- 출장정보 delete -->
	<delete id="TBBADDED129MDelete" parameterType="paramMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001Mapper.TBBADDED129MDelete */
		DELETE
		  FROM TBBADDED129M
		 WHERE AUD_PLAN_YR 		= #{audPlanYr}
		   AND DPT_CD 	        = #{dptCd}
		   AND AUD_PLAN_SNO		= #{audPlanSno}
	</delete>
			<!-- 대상기관 delete -->
	<delete id="TBBADDED130MDelete" parameterType="paramMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001Mapper.TBBADDED130MDelete */
		DELETE
		  FROM TBBADDED130M
		 WHERE AUD_PLAN_YR 		= #{audPlanYr}
		   AND DPT_CD 	        = #{dptCd}
		   AND AUD_PLAN_SNO		= #{audPlanSno}
	</delete>
			<!-- 문서함 delete -->
	<delete id="TBBADDED131MDelete" parameterType="paramMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001Mapper.TBBADDED131MDelete */
		DELETE
		  FROM TBBADDED131M
		 WHERE AUD_PLAN_YR 		= #{audPlanYr}
		   AND DPT_CD 	        = #{dptCd}
		   AND AUD_PLAN_SNO		= #{audPlanSno}
		   AND DOC_ID           = #{docId} 
	</delete>
	
			<!-- 사항별 세부계획 조회 -->
	<select id="selectDetailList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001W.selectDetailList */
        <![CDATA[
           WITH MAX_ROW AS (SELECT Z.R_NUM
                                ,Z.AUD_PLAN_YR
                                ,Z.DPT_CD
                                ,Z.AUD_PLAN_SNO
                           FROM (
                                 SELECT
                                       RANK() OVER (PARTITION BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.BIZ_TRIP_CD
                                                         ORDER BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.BIZ_TRIP_CD,A.BIZ_TRIP_DPT_CD
                                                    ) AS R_NUM
                                       ,A.AUD_PLAN_YR
                                       ,A.DPT_CD
                                       ,A.AUD_PLAN_SNO
                                       ,A.BIZ_TRIP_CD
                                       ,A.BIZ_TRIP_DPT_CD
                                       ,A.BIZ_TRIP_PER
                                   FROM (/**************************************************************/
                                         SELECT Z.* FROM TBBADDED129M Z
                                          WHERE NOT EXISTS (SELECT 'X'
                                                              FROM TBBADDED129D X
                                                             WHERE X.AUD_PLAN_YR     = Z.AUD_PLAN_YR
                                                               AND X.DPT_CD          = Z.DPT_CD
                                                               AND X.AUD_PLAN_SNO    = Z.AUD_PLAN_SNO
                                                               AND X.BIZ_TRIP_CD     = Z.BIZ_TRIP_CD
                                                               AND X.BIZ_TRIP_DPT_CD = Z.BIZ_TRIP_DPT_CD)
                                          UNION ALL
                                         SELECT Y.* FROM TBBADDED129D Y
                                         /**************************************************************/
                                        ) A
                    ]]>
                    	WHERE 1=1
				        <if test='audPlanYr != null and audPlanYr != ""'>
								AND  A.AUD_PLAN_YR  = #{audPlanYr}
						</if>
			         	<if test='dptCd != null and dptCd != ""'>
						        AND  A.DPT_CD = #{dptCd}
						</if>
			         	<if test='dptCd == null and schSpvBrdvCd != ""'>
					        AND  A.DPT_CD IN ( SELECT DPT_CD FROM TBDCMACM002M 
				                                        WHERE SUBSTR( DPT_CD, 0, 3) = SUBSTR(#{schSpvBrdvCd}, 0, 3)
				                                          AND DPT_CD NOT LIKE '%000'
				                                          AND USE_YN = 'Y'
				                           )
					    </if>
         			<![CDATA[
                                  ORDER BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.BIZ_TRIP_CD,A.BIZ_TRIP_DPT_CD
                                ) Z
                          GROUP BY Z.R_NUM,Z.AUD_PLAN_YR,Z.DPT_CD,Z.AUD_PLAN_SNO
                          ORDER BY Z.AUD_PLAN_YR,Z.DPT_CD,Z.AUD_PLAN_SNO,Z.R_NUM
                        )
            ,DATA_AUD AS (SELECT RANK() OVER (PARTITION BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO
                                                  ORDER BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.BIZ_TRIP_CD,A.BIZ_TRIP_DPT_CD ) AS R_NUM
                                ,A.AUD_PLAN_YR
                                ,A.DPT_CD
                                ,A.AUD_PLAN_SNO
                                ,A.BIZ_TRIP_CD
                                ,A.BIZ_TRIP_DPT_CD
                                ,A.BIZ_TRIP_PER
                            FROM (/**************************************************************/
                                  SELECT Z.* FROM TBBADDED129M Z
                                   WHERE NOT EXISTS (SELECT 'X'
                                                       FROM TBBADDED129D X
                                                      WHERE X.AUD_PLAN_YR     = Z.AUD_PLAN_YR
                                                        AND X.DPT_CD          = Z.DPT_CD
                                                        AND X.AUD_PLAN_SNO    = Z.AUD_PLAN_SNO
                                                        AND X.BIZ_TRIP_CD     = Z.BIZ_TRIP_CD
                                                        AND X.BIZ_TRIP_DPT_CD = Z.BIZ_TRIP_DPT_CD)
                                   UNION ALL
                                  SELECT Y.* FROM TBBADDED129D Y
                                  /**************************************************************/
                                 ) A
                    ]]>
                    	WHERE 1=1
				        <if test='audPlanYr != null and audPlanYr != ""'>
								AND  A.AUD_PLAN_YR  = #{audPlanYr}
						</if>
			         	<if test='dptCd != null and dptCd != ""'>
						        AND  A.DPT_CD = #{dptCd}
						</if>
			         	<if test='dptCd == null and schSpvBrdvCd != ""'>
					        AND  A.DPT_CD IN ( SELECT DPT_CD FROM TBDCMACM002M 
				                                        WHERE SUBSTR( DPT_CD, 0, 3) = SUBSTR(#{schSpvBrdvCd}, 0, 3)
				                                          AND DPT_CD NOT LIKE '%000'
				                                          AND USE_YN = 'Y'
				                           )
					    </if>
         			<![CDATA[
                             AND A.BIZ_TRIP_CD = '00'
                           ORDER BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.BIZ_TRIP_CD,A.BIZ_TRIP_DPT_CD
                         )
            ,PREY_AUD AS (SELECT RANK() OVER (PARTITION BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO
                                                  ORDER BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.BIZ_TRIP_CD,A.BIZ_TRIP_DPT_CD ) AS R_NUM
                                ,A.AUD_PLAN_YR
                                ,A.DPT_CD
                                ,A.AUD_PLAN_SNO
                                ,A.BIZ_TRIP_CD
                                ,A.BIZ_TRIP_DPT_CD
                                ,A.BIZ_TRIP_PER
                            FROM (/**************************************************************/
                                  SELECT Z.* FROM TBBADDED129M Z
                                   WHERE NOT EXISTS (SELECT 'X'
                                                       FROM TBBADDED129D X
                                                      WHERE X.AUD_PLAN_YR     = Z.AUD_PLAN_YR
                                                        AND X.DPT_CD          = Z.DPT_CD
                                                        AND X.AUD_PLAN_SNO    = Z.AUD_PLAN_SNO
                                                        AND X.BIZ_TRIP_CD     = Z.BIZ_TRIP_CD
                                                        AND X.BIZ_TRIP_DPT_CD = Z.BIZ_TRIP_DPT_CD)
                                   UNION ALL
                                  SELECT Y.* FROM TBBADDED129D Y
                                  /**************************************************************/
                                 ) A
                    ]]>
                    	WHERE 1=1
				        <if test='audPlanYr != null and audPlanYr != ""'>
								AND  A.AUD_PLAN_YR  = #{audPlanYr}
						</if>
			         	<if test='dptCd != null and dptCd != ""'>
						        AND  A.DPT_CD = #{dptCd}
						</if>
			         	<if test='dptCd == null and schSpvBrdvCd != ""'>
					        AND  A.DPT_CD IN ( SELECT DPT_CD FROM TBDCMACM002M 
				                                        WHERE SUBSTR( DPT_CD, 0, 3) = SUBSTR(#{schSpvBrdvCd}, 0, 3)
				                                          AND DPT_CD NOT LIKE '%000'
				                                          AND USE_YN = 'Y'
				                           )
					    </if>
         			<![CDATA[
                             AND A.BIZ_TRIP_CD = '01'
                           ORDER BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.BIZ_TRIP_CD,A.BIZ_TRIP_DPT_CD
                         )
            ,ACTU_AUD AS (SELECT RANK() OVER (PARTITION BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO
                                                  ORDER BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.BIZ_TRIP_CD,A.BIZ_TRIP_DPT_CD ) AS R_NUM
                                ,A.AUD_PLAN_YR
                                ,A.DPT_CD
                                ,A.AUD_PLAN_SNO
                                ,A.BIZ_TRIP_CD
                                ,A.BIZ_TRIP_DPT_CD
                                ,A.BIZ_TRIP_PER
                            FROM (/**************************************************************/
                                  SELECT Z.* FROM TBBADDED129M Z
                                   WHERE NOT EXISTS (SELECT 'X'
                                                       FROM TBBADDED129D X
                                                      WHERE X.AUD_PLAN_YR     = Z.AUD_PLAN_YR
                                                        AND X.DPT_CD          = Z.DPT_CD
                                                        AND X.AUD_PLAN_SNO    = Z.AUD_PLAN_SNO
                                                        AND X.BIZ_TRIP_CD     = Z.BIZ_TRIP_CD
                                                        AND X.BIZ_TRIP_DPT_CD = Z.BIZ_TRIP_DPT_CD)
                                   UNION ALL
                                  SELECT Y.* FROM TBBADDED129D Y
                                  /**************************************************************/
                                 ) A
                           WHERE 1=1
                           ]]>
				        <if test='audPlanYr != null and audPlanYr != ""'>
								AND  A.AUD_PLAN_YR  = #{audPlanYr}
						</if>
			         	<if test='dptCd != null and dptCd != ""'>
						        AND  A.DPT_CD = #{dptCd}
						</if>
			         	<if test='dptCd == null and schSpvBrdvCd != ""'>
					        AND  A.DPT_CD IN ( SELECT DPT_CD FROM TBDCMACM002M 
				                                        WHERE SUBSTR( DPT_CD, 0, 3) = SUBSTR(#{schSpvBrdvCd}, 0, 3)
				                                          AND DPT_CD NOT LIKE '%000'
				                                          AND USE_YN = 'Y'
				                           )
					    </if>
         <![CDATA[
                             AND A.BIZ_TRIP_CD = '02'
                           ORDER BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.BIZ_TRIP_CD,A.BIZ_TRIP_DPT_CD
           )
     
     SELECT AUD_PLAN_YR
            , DPT_CD
            , DPT_NM
            , AUD_PLAN_SNO
            , AUD_SBJ_NM
            , AUD_KND_NM
            , DATA_AUD || CASE WHEN AGGR_CONCAT(DATA_AUD_INFO,',') IS NOT NULL THEN '<br>' || '(' ||AGGR_CONCAT(DATA_AUD_INFO,',') || ', ' ||SUM(DATA_BIZ_TRIP_PER) || '명)' ELSE '' END AS DATA_AUD
            , PREY_AUD || CASE WHEN AGGR_CONCAT(PREY_AUD_INFO,',') IS NOT NULL THEN '<br>' || '(' ||AGGR_CONCAT(PREY_AUD_INFO,',') || ', ' || SUM(PREY_BIZ_TRIP_PER) || '명)' ELSE '' END AS PREY_AUD
            , ACTU_AUD || CASE WHEN AGGR_CONCAT(ACTU_AUD_INFO,',') IS NOT NULL THEN '<br>' || '(' ||AGGR_CONCAT(ACTU_AUD_INFO,',') || ', ' || SUM(ACTU_BIZ_TRIP_PER) || '명)' ELSE '' END AS ACTU_AUD
            , PRSS_AUD
            , WRIT_NM
            , PLAN_NUD_GUBN
     FROM (   
        SELECT A.AUD_PLAN_YR 
              ,A.DPT_CD
              ,F_DPT_INFO(A.DPT_CD, '4') AS DPT_NM
              ,A.AUD_PLAN_SNO
              ,DECODE(E.PLAN_NUD_GUBN,NULL,NULL,E.PLAN_NUD_GUBN||' ') || E.AUD_SBJ_NM || '(' || F_CODE_NM('1000739', E.AUD_KND_CD) || ')' AS AUD_SBJ_NM
              ,F_CODE_NM('1000739', E.AUD_KND_CD) AS AUD_KND_NM
              ,DECODE (E.DATA_AUD_STR_DY, null, '-',TO_CHAR(TO_DATE(E.DATA_AUD_STR_DY, 'YYYYMMDD'), 'YY-MM-DD')||' ~ '||TO_CHAR(TO_DATE(E.DATA_AUD_END_DY, 'YYYYMMDD'), 'YY-MM-DD')) AS DATA_AUD
              ,DECODE (E.PREY_AUD_STR_DY, null, '-',TO_CHAR(TO_DATE(E.PREY_AUD_STR_DY, 'YYYYMMDD'), 'YY-MM-DD')||' ~ '||TO_CHAR(TO_DATE(E.PREY_AUD_END_DY, 'YYYYMMDD'), 'YY-MM-DD')) AS PREY_AUD
              ,DECODE (E.ACTU_AUD_STR_DY, null, '-',TO_CHAR(TO_DATE(E.ACTU_AUD_STR_DY, 'YYYYMMDD'), 'YY-MM-DD')||' ~ '||TO_CHAR(TO_DATE(E.ACTU_AUD_END_DY, 'YYYYMMDD'), 'YY-MM-DD')) AS ACTU_AUD
              ,DECODE (E.PRSS_AUD_STR_DY, null, '-',TO_CHAR(TO_DATE(E.PRSS_AUD_STR_DY, 'YYYYMMDD'), 'YY-MM-DD')||' ~ '||TO_CHAR(TO_DATE(E.PRSS_AUD_END_DY, 'YYYYMMDD'), 'YY-MM-DD')) AS PRSS_AUD
              ,F_USR_INFO_BY_ID(E.FRT_USR_ID,'2')||' '||'('||TO_CHAR(E.FNL_MDF_DH,'YY"-"MM"-"DD')||')' AS WRIT_NM
              ,DECODE(B.BIZ_TRIP_DPT_CD,NULL,NULL,F_DPT_INFO(B.BIZ_TRIP_DPT_CD, '4')) AS DATA_AUD_INFO
              ,DECODE(C.BIZ_TRIP_DPT_CD,NULL,NULL,F_DPT_INFO(C.BIZ_TRIP_DPT_CD, '4')) AS PREY_AUD_INFO
              ,DECODE(D.BIZ_TRIP_DPT_CD,NULL,NULL,F_DPT_INFO(D.BIZ_TRIP_DPT_CD, '4')) AS ACTU_AUD_INFO
              ,E.PLAN_NUD_GUBN
              ,NVL(B.BIZ_TRIP_PER,0) AS DATA_BIZ_TRIP_PER
              ,NVL(C.BIZ_TRIP_PER,0) AS PREY_BIZ_TRIP_PER
              ,NVL(D.BIZ_TRIP_PER,0) AS ACTU_BIZ_TRIP_PER
          FROM MAX_ROW  A
              ,DATA_AUD B
              ,PREY_AUD C
              ,ACTU_AUD D
              ,(/***********************************************************/
                SELECT Z.* FROM TBBADDED128M Z
                 WHERE NOT EXISTS (SELECT 'X'
                                     FROM TBBADDED128D X
                                    WHERE X.AUD_PLAN_YR  = Z.AUD_PLAN_YR
                                      AND X.DPT_CD       = Z.DPT_CD
                                      AND X.AUD_PLAN_SNO = Z.AUD_PLAN_SNO)
                 UNION ALL
                SELECT Y.* FROM TBBADDED128D Y
                /***********************************************************/
               ) E
         WHERE 1=1
           AND A.R_NUM = B.R_NUM(+) AND A.AUD_PLAN_YR = B.AUD_PLAN_YR(+) AND A.DPT_CD = B.DPT_CD(+) AND A.AUD_PLAN_SNO = B.AUD_PLAN_SNO(+)
           AND A.R_NUM = C.R_NUM(+) AND A.AUD_PLAN_YR = C.AUD_PLAN_YR(+) AND A.DPT_CD = C.DPT_CD(+) AND A.AUD_PLAN_SNO = C.AUD_PLAN_SNO(+)
           AND A.R_NUM = D.R_NUM(+) AND A.AUD_PLAN_YR = D.AUD_PLAN_YR(+) AND A.DPT_CD = D.DPT_CD(+) AND A.AUD_PLAN_SNO = D.AUD_PLAN_SNO(+)
                                    AND A.AUD_PLAN_YR = E.AUD_PLAN_YR(+) AND A.DPT_CD = E.DPT_CD(+) AND A.AUD_PLAN_SNO = E.AUD_PLAN_SNO(+)
         ORDER BY A.DPT_CD,A.AUD_PLAN_SNO,A.R_NUM
     ) GROUP BY AUD_PLAN_YR, DPT_CD, DPT_NM, AUD_PLAN_SNO, AUD_SBJ_NM, AUD_KND_NM, DATA_AUD, PREY_AUD, ACTU_AUD, PRSS_AUD, WRIT_NM, PLAN_NUD_GUBN
          ]]>
          
	</select>
		
		<!-- 상세정보 조회 -->
	<select id="AEPPLN001EselecDetailInfo" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001E.AEPPLN001EselecDetailInfo */
        <![CDATA[
        	SELECT   AUD_PLAN_YR
        		    ,DPT_CD
				    ,AUD_PLAN_SNO
					,AUD_SBJ_NM
					,AUD_KND_CD
					,DATA_AUD_STR_DY
					,DATA_AUD_END_DY
					,DATA_AUD_DT
					,PREY_AUD_STR_DY
					,PREY_AUD_END_DY
					,PREY_AUD_DT
					,ACTU_AUD_STR_DY
					,ACTU_AUD_END_DY
					,ACTU_AUD_DT
					,PRSS_AUD_STR_DY
					,PRSS_AUD_END_DY
					,AUD_POINT
					,RLTN_ORG
					,MPP_AUD_YN
					,MPP_AUD_YR
					,MPP_AUD_NO
					,PLAN_PR_GUBN
					,PLAN_NUD_GUBN
					,PLAN_CHG_YN
					          				   /* 자료수집 */	
				    ,(
					   SELECT AGGR_CONCAT(F_CODE_NM('1000144', B.BIZ_TRIP_DPT_CD)||'('||B.BIZ_TRIP_PER||')', ',') AS DATA_INFO
						 FROM TBBADDED129M B
						WHERE B.AUD_PLAN_YR = A.AUD_PLAN_YR
						  AND B.DPT_CD = A.DPT_CD
						  AND B.AUD_PLAN_SNO = A.AUD_PLAN_SNO
                          AND BIZ_TRIP_CD = '00'
                   
				   ) AS DATA_INFO	
                         /* 예비조사 */	
				    ,(
					   SELECT AGGR_CONCAT(F_CODE_NM('1000144', B.BIZ_TRIP_DPT_CD)||'('||B.BIZ_TRIP_PER||')', ',') AS PREY_INFO
						 FROM TBBADDED129M B
						WHERE B.AUD_PLAN_YR = A.AUD_PLAN_YR
						  AND B.DPT_CD = A.DPT_CD
						  AND B.AUD_PLAN_SNO = A.AUD_PLAN_SNO
                          AND BIZ_TRIP_CD = '01'
                   
				   ) AS PREY_INFO	
                            /* 실지감사 */	
				    ,(
					   SELECT AGGR_CONCAT(F_CODE_NM('1000144', B.BIZ_TRIP_DPT_CD)||'('||B.BIZ_TRIP_PER||')', ',') AS ACTU_INFO
						 FROM TBBADDED129M B
						WHERE B.AUD_PLAN_YR = A.AUD_PLAN_YR
						  AND B.DPT_CD = A.DPT_CD
						  AND B.AUD_PLAN_SNO = A.AUD_PLAN_SNO
                          AND BIZ_TRIP_CD = '02'
                   
				   ) AS ACTU_INFO
				           /* 대상기관 */	
				    ,(
					   SELECT AGGR_CONCAT(ORG_NM, ',') AS RLTN_ORG_INFO
						 FROM TBBADDED130M B
						WHERE B.AUD_PLAN_YR = A.AUD_PLAN_YR
						  AND B.DPT_CD = A.DPT_CD
						  AND B.AUD_PLAN_SNO = A.AUD_PLAN_SNO
				   ) AS RLTN_ORG_INFO
			 FROM TBBADDED128M A
			WHERE 1=1
         ]]>
		<if test='audPlanYr != null and audPlanYr != ""'>
			AND AUD_PLAN_YR  = #{audPlanYr}
		</if>
		<if test='dptCd != null and dptCd != ""'>
			AND DPT_CD = #{dptCd}
		</if>
		<if test='audPlanSno != null and audPlanSno != ""'>
			AND AUD_PLAN_SNO = #{audPlanSno}
		</if>
			
	</select>
	    <update id="TBBADDED128MUpdate" parameterType="paramMap">
        /* kr.go.bai.eip.aep.pln.dao.AEPPLN001E.TBBADDED128MUpdate */
        <![CDATA[
        UPDATE TBBADDED128M
           SET   AUD_SBJ_NM = #{audSbjNm}
                ,AUD_KND_CD = #{audKndCd}
				,DATA_AUD_STR_DY = #{dataAudStrDy}
				,DATA_AUD_END_DY = #{dataAudEndDy}
				,DATA_AUD_DT = #{dataAudDt}
				,PREY_AUD_STR_DY = #{preyAudStrDy}
				,PREY_AUD_END_DY = #{preyAudEndDy}
				,PREY_AUD_DT = #{preyAudDt}
				,ACTU_AUD_STR_DY = #{actuAudStrDy}
				,ACTU_AUD_END_DY = #{actuAudEndDy}
				,ACTU_AUD_DT = #{actuAudDt}
				,PRSS_AUD_STR_DY = #{prssAudStrDy}
				,PRSS_AUD_END_DY = #{prssAudEndDy}
				,AUD_POINT = #{audPoint}
				,RLTN_ORG = #{rltnOrg}
			]]>
                <if test="mppAudYn != null and mppAudYn !='' ">
                ,MPP_AUD_YN = #{mppAudYn}
                </if>
                <if test="mppAudYr != null and mppAudYr !='' ">
                ,MPP_AUD_YR = #{mppAudYr}
                </if>
                 <if test="mapAudNo != null and mapAudNo !='' ">
                ,MPP_AUD_NO = #{mapAudNo}
                </if>
                <if test="planPrGubn != null and planPrGubn !='' ">
                ,PLAN_PR_GUBN = #{planPrGubn}
                </if>
                 <if test="planNudGubn != null and planNudGubn !='' ">
                ,PLAN_NUD_GUBN = #{planNudGubn}
                </if>
                 <if test="planChgYn != null and planChgYn !='' ">
                ,PLAN_CHG_YN = #{planChgYn}
                </if>
        <![CDATA[
                ,FNL_USR_ID = #{usrId}
                ,FNL_DEAL_DPT_CD = #{dptCd}
                ,FNL_MNU_ID = #{fnlMnuId}
                ,FNL_MDF_DH = SYSDATE
        WHERE  1=1
        ]]>
		<if test='audPlanYr != null and audPlanYr != ""'>
			AND AUD_PLAN_YR  = #{audPlanYr}
		</if>
		<if test='dptCd != null and dptCd != ""'>
			AND DPT_CD = #{dptCd}
		</if>
		<if test='audPlanSno != null and audPlanSno != ""'>
			AND AUD_PLAN_SNO = #{audPlanSno}
		</if>
    </update>
	<!--감사계획관리 감사계획일련번호 조회-->
	<select id="selectBizTripList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001Mapper.selectBizTripList */
		<![CDATA[
           SELECT BIZ_TRIP_DPT_CD,BIZ_TRIP_PER,SORT_SNO
            FROM TBBADDED129M
           WHERE 1 = 1
          ]]>
          <if test='cnt == 1'>
			AND BIZ_TRIP_CD = '00'
		</if>
		 <if test='cnt == 2'>
			AND BIZ_TRIP_CD = '01'
		</if>
		 <if test='cnt == 3'>
			AND BIZ_TRIP_CD = '02'
		</if>
		<if test='audPlanYr != null and audPlanYr != ""'>
			AND AUD_PLAN_YR  = #{audPlanYr}
		</if>
		<if test='dptCd != null and dptCd != ""'>
			AND DPT_CD = #{dptCd}
		</if>
		<if test='audPlanSno != null and audPlanSno != ""'>
			AND AUD_PLAN_SNO = #{audPlanSno}
		</if>
	</select>
	
			<!-- 종류별 세부계획 조회 -->
	<select id="selectKndList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001E.selectKndList */
       <include refid="include.pageSelct" />
        <![CDATA[

SELECT RLTN_ORG
     , AUD_KND_CD
     , AUD_PLAN_SNO
     , DPT_CD
     , AUD_PLAN_YR
     , AUD_SBJ_NM
     , ACTU_AUD_DT
     , AUD_MONTH
     , DPT_NM
     , DECODE(AUD_KND_CD, 1, ORG_NM,4, ORG_NM, RLTN_ORG) AS ORG_NM
     , ACTU_TRIP_PER
 FROM
(
SELECT A.RLTN_ORG
     , A.AUD_KND_CD
     , A.AUD_PLAN_SNO
     , A.DPT_CD
     , A.AUD_PLAN_YR
     , A.AUD_SBJ_NM
     , DECODE (A.ACTU_AUD_DT, null,'',A.ACTU_AUD_DT||'일') AS ACTU_AUD_DT
     , DECODE (A.ACTU_AUD_STR_DY, null,'',SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월') AS AUD_MONTH
     , F_CODE_NM('1000144', A.DPT_CD) AS DPT_NM
     ,(SELECT AGGR_CONCAT(B.ORG_NM,',') 
		  FROM TBBADDED130M B
         WHERE B.AUD_PLAN_YR = A.AUD_PLAN_YR
           AND B.DPT_CD = A.DPT_CD
           AND B.AUD_PLAN_SNO = A.AUD_PLAN_SNO
         GROUP BY B.AUD_PLAN_SNO, B.DPT_CD, B.AUD_PLAN_YR   
       ) AS ORG_NM
       
     , (SELECT SUM(BIZ_TRIP_PER)||'명'
          FROM TBBADDED129M B 
         WHERE BIZ_TRIP_CD = '02'
           AND B.AUD_PLAN_YR = A.AUD_PLAN_YR
           AND B.DPT_CD = A.DPT_CD
           AND B.AUD_PLAN_SNO = A.AUD_PLAN_SNO
         GROUP BY B.AUD_PLAN_YR, B.DPT_CD, B.AUD_PLAN_SNO
        ) AS ACTU_TRIP_PER
       
  FROM TBBADDED128M A
)

 WHERE 1 = 1
         ]]>
		<if test='audPlanYr != null and audPlanYr != ""'>
			AND AUD_PLAN_YR  = #{audPlanYr}
		</if>
		<if test='dptCd != null and dptCd != ""'>
			AND DPT_CD = #{dptCd}
		</if>
		 <if test='audKndCd != null and audKndCd != ""'>
			AND AUD_KND_CD = #{audKndCd}
		</if>
		 <if test='dptCd == null and schSpvBrdvCd != ""'>
	        AND  DPT_CD IN ( SELECT DPT_CD FROM TBDCMACM002M 
	                                       WHERE SUBSTR( DPT_CD, 0, 3) = SUBSTR(#{schSpvBrdvCd}, 0, 3)
	                                         AND DPT_CD NOT LIKE '%000'
	                                         AND USE_YN = 'Y'
	                          )
	     </if>
		ORDER BY DPT_NM
		<include refid="include.pageOrder" />
	</select>
	
				<!-- 대상기관 등록 -->
<insert id="TBBADDED130MInsert" parameterType="paramMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001Mapper.TBBADDED130MInsert */
        <![CDATA[
        	INSERT INTO	TBBADDED130M
        				(	 AUD_PLAN_YR
        					,DPT_CD
							,AUD_PLAN_SNO
							,ORG_CD
							,ORG_NM
							,SORT_SNO
							,FRT_USR_ID
							,FNL_USR_ID
							,FNL_DEAL_DPT_CD
							,FNL_MNU_ID
							,FRT_REGI_DH
							,FNL_MDF_DH

        				)
        		VALUES	(	 #{audPlanYr}
							,#{dptCd}
							,#{audPlanSno}
							,#{orgCd}
							,#{orgNm}
							,#{sortSno}
							,#{frtUsrId}
							,#{fnlUsrId}
							,#{fnlDealDptCd}
							,#{fnlMnuId}
							,SYSDATE
							,SYSDATE
        				)
		]]>
	</insert>
	<!-- 자료수집 조회 -->
	<select id="AEPPLN001EselecDataAud" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001E.AEPPLN001EselecDataAud */
        <![CDATA[
       	  SELECT BIZ_TRIP_DPT_CD, BIZ_TRIP_PER, SORT_SNO
		    FROM TBBADDED129M
           WHERE BIZ_TRIP_CD = '00' 
         ]]>
		<if test='audPlanYr != null and audPlanYr != ""'>
			AND AUD_PLAN_YR  = #{audPlanYr}
		</if>
		<if test='dptCd != null and dptCd != ""'>
			AND DPT_CD = #{dptCd}
		</if>
		<if test='audPlanSno != null and audPlanSno != ""'>
			AND AUD_PLAN_SNO = #{audPlanSno}
		</if>
	        ORDER BY SORT_SNO
	</select>
		<!-- 예비조사 조회 -->
	<select id="AEPPLN001EselecPreyAud" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001E.AEPPLN001EselecPreyAud */
        <![CDATA[
       	  SELECT BIZ_TRIP_DPT_CD, BIZ_TRIP_PER, SORT_SNO
		    FROM TBBADDED129M
           WHERE BIZ_TRIP_CD = '01' 
         ]]>
		<if test='audPlanYr != null and audPlanYr != ""'>
			AND AUD_PLAN_YR  = #{audPlanYr}
		</if>
		<if test='dptCd != null and dptCd != ""'>
			AND DPT_CD = #{dptCd}
		</if>
		<if test='audPlanSno != null and audPlanSno != ""'>
			AND AUD_PLAN_SNO = #{audPlanSno}
		</if>
	        ORDER BY SORT_SNO
	</select>
		<!-- 실지감사 조회 -->
	<select id="AEPPLN001EselecActuAud" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001E.AEPPLN001EselecActuAud */
        <![CDATA[
       	  SELECT BIZ_TRIP_DPT_CD, BIZ_TRIP_PER, SORT_SNO
		    FROM TBBADDED129M
           WHERE BIZ_TRIP_CD = '02' 
         ]]>
		<if test='audPlanYr != null and audPlanYr != ""'>
			AND AUD_PLAN_YR  = #{audPlanYr}
		</if>
		<if test='dptCd != null and dptCd != ""'>
			AND DPT_CD = #{dptCd}
		</if>
		<if test='audPlanSno != null and audPlanSno != ""'>
			AND AUD_PLAN_SNO = #{audPlanSno}
		</if>
	        ORDER BY SORT_SNO
	</select>
			<!-- 대상기관 조회 -->
	<select id="AEPPLN001EselecrltnOrg" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001E.AEPPLN001EselecrltnOrg */
        <![CDATA[
           SELECT ORG_CD,ORG_NM,SORT_SNO
            FROM TBBADDED130M
           WHERE 1 = 1
         ]]>
		<if test='audPlanYr != null and audPlanYr != ""'>
			AND AUD_PLAN_YR  = #{audPlanYr}
		</if>
		<if test='dptCd != null and dptCd != ""'>
			AND DPT_CD = #{dptCd}
		</if>
		<if test='audPlanSno != null and audPlanSno != ""'>
			AND AUD_PLAN_SNO = #{audPlanSno}
		</if>
	        ORDER BY SORT_SNO
	</select>
			<!-- 감사계획 총괄 조회 -->
	<select id="AEPPLN001EselectAudMain" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001W.AEPPLN001EselectAudMain */
        <![CDATA[
WITH MAX_ROW AS (SELECT RANK() OVER (PARTITION BY A.DPT_CD ORDER BY A.DPT_CD,ACTU_AUD_STR_DY,A.AUD_PLAN_SNO) AS R_NUM
                       ,A.DPT_CD
                   FROM TBBADDED128M A
                  WHERE 1=1
                  ORDER BY A.DPT_CD,ACTU_AUD_STR_DY,A.AUD_PLAN_SNO
                )
    ,T_QUARTER1 AS (SELECT RANK() OVER (PARTITION BY A.DPT_CD ORDER BY A.DPT_CD,A.ACTU_AUD_STR_DY,A.AUD_PLAN_SNO) AS R_NUM
                          ,A.AUD_PLAN_YR
                          ,A.DPT_CD
                          ,A.AUD_PLAN_SNO
                          ,F_DPT_INFO(A.DPT_CD, '4') AS DPT_NM
                          ,F_CODE_NM('1000739', A.AUD_KND_CD) AS AUD_KND_NM
                          ,SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월' AS SM
                          ,A.AUD_SBJ_NM
                      FROM TBBADDED128M A
                     WHERE TO_CHAR(TO_DATE(A.ACTU_AUD_STR_DY),'Q') = '1'
                     ORDER BY A.DPT_CD,ACTU_AUD_STR_DY,A.AUD_PLAN_SNO
                   )
    ,T_QUARTER2 AS (SELECT RANK() OVER (PARTITION BY A.DPT_CD ORDER BY A.DPT_CD,A.ACTU_AUD_STR_DY,A.AUD_PLAN_SNO) AS R_NUM
                          ,A.AUD_PLAN_YR
                          ,A.DPT_CD
                          ,A.AUD_PLAN_SNO
                          ,F_DPT_INFO(A.DPT_CD, '4') AS DPT_NM
                          ,F_CODE_NM('1000739', A.AUD_KND_CD) AS AUD_KND_NM
                          ,SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월' AS SM
                          ,A.AUD_SBJ_NM
                      FROM TBBADDED128M A
                     WHERE TO_CHAR(TO_DATE(A.ACTU_AUD_STR_DY),'Q') = '2'
                     ORDER BY A.DPT_CD,ACTU_AUD_STR_DY,A.AUD_PLAN_SNO
                   )
    ,T_QUARTER3 AS (SELECT RANK() OVER (PARTITION BY A.DPT_CD ORDER BY A.DPT_CD,A.ACTU_AUD_STR_DY,A.AUD_PLAN_SNO) AS R_NUM
                          ,A.AUD_PLAN_YR
                          ,A.DPT_CD
                          ,A.AUD_PLAN_SNO
                          ,F_DPT_INFO(A.DPT_CD, '4') AS DPT_NM
                          ,F_CODE_NM('1000739', A.AUD_KND_CD) AS AUD_KND_NM
                          ,SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월' AS SM
                          ,A.AUD_SBJ_NM
                      FROM TBBADDED128M A
                     WHERE TO_CHAR(TO_DATE(A.ACTU_AUD_STR_DY),'Q') = '3'
                     ORDER BY A.DPT_CD,ACTU_AUD_STR_DY,A.AUD_PLAN_SNO
                   )
    ,T_QUARTER4 AS (SELECT RANK() OVER (PARTITION BY A.DPT_CD ORDER BY A.DPT_CD,A.ACTU_AUD_STR_DY,A.AUD_PLAN_SNO) AS R_NUM
                          ,A.AUD_PLAN_YR
                          ,A.DPT_CD
                          ,A.AUD_PLAN_SNO
                          ,F_DPT_INFO(A.DPT_CD, '4') AS DPT_NM
                          ,F_CODE_NM('1000739', A.AUD_KND_CD) AS AUD_KND_NM
                          ,SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월' AS SM
                          ,A.AUD_SBJ_NM
                      FROM TBBADDED128M A
                     WHERE TO_CHAR(TO_DATE(A.ACTU_AUD_STR_DY),'Q') = '4'
                     ORDER BY A.DPT_CD,ACTU_AUD_STR_DY,A.AUD_PLAN_SNO
                   )
select DPT_NM,QUARTER1,QUARTER2,QUARTER3,QUARTER4,AUD_YRAA,QUARTER1_YR,QUARTER2_YR,QUARTER3_YR,QUARTER4_YR, QUARTER1_SNO,QUARTER2_SNO,QUARTER3_SNO,QUARTER4_SNO, DPT_CD from(

SELECT F_DPT_INFO(MST.DPT_CD, '4') AS DPT_NM , MST.DPT_CD AS DPT_CD
      ,CASE WHEN A.AUD_SBJ_NM IS NOT NULL THEN A.AUD_SBJ_NM||'<br>('||A.AUD_KND_NM||'-'||A.SM||')' ELSE NULL END AS QUARTER1
      ,CASE WHEN B.AUD_SBJ_NM IS NOT NULL THEN B.AUD_SBJ_NM||'<br>('||B.AUD_KND_NM||'-'||B.SM||')' ELSE NULL END AS QUARTER2
      ,CASE WHEN C.AUD_SBJ_NM IS NOT NULL THEN C.AUD_SBJ_NM||'<br>('||C.AUD_KND_NM||'-'||C.SM||')' ELSE NULL END AS QUARTER3
      ,CASE WHEN D.AUD_SBJ_NM IS NOT NULL THEN D.AUD_SBJ_NM||'<br>('||D.AUD_KND_NM||'-'||D.SM||')' ELSE NULL END AS QUARTER4
      
       ,CASE WHEN A.AUD_SBJ_NM IS NOT NULL THEN A.AUD_PLAN_YR
            WHEN B.AUD_SBJ_NM IS NOT NULL THEN B.AUD_PLAN_YR
            WHEN C.AUD_SBJ_NM IS NOT NULL THEN C.AUD_PLAN_YR
            WHEN D.AUD_SBJ_NM IS NOT NULL THEN D.AUD_PLAN_YR
            END AS AUD_YRAA
      ,CASE WHEN A.AUD_SBJ_NM IS NOT NULL THEN  A.AUD_PLAN_YR ELSE NULL END AS QUARTER1_YR
      ,CASE WHEN B.AUD_SBJ_NM IS NOT NULL THEN  B.AUD_PLAN_YR ELSE NULL END AS QUARTER2_YR
      ,CASE WHEN C.AUD_SBJ_NM IS NOT NULL THEN  C.AUD_PLAN_YR ELSE NULL END AS QUARTER3_YR
      ,CASE WHEN D.AUD_SBJ_NM IS NOT NULL THEN  D.AUD_PLAN_YR ELSE NULL END AS QUARTER4_YR
      
      ,CASE WHEN A.AUD_SBJ_NM IS NOT NULL THEN  A.AUD_PLAN_SNO ELSE NULL END AS QUARTER1_SNO
      ,CASE WHEN B.AUD_SBJ_NM IS NOT NULL THEN  B.AUD_PLAN_SNO ELSE NULL END AS QUARTER2_SNO
      ,CASE WHEN C.AUD_SBJ_NM IS NOT NULL THEN  C.AUD_PLAN_SNO ELSE NULL END AS QUARTER3_SNO
      ,CASE WHEN D.AUD_SBJ_NM IS NOT NULL THEN  D.AUD_PLAN_SNO ELSE NULL END AS QUARTER4_SNO
  FROM MAX_ROW MST
      ,T_QUARTER1 A
      ,T_QUARTER2 B
      ,T_QUARTER3 C
      ,T_QUARTER4 D
 WHERE MST.R_NUM = A.R_NUM(+) AND MST.DPT_CD = A.DPT_CD(+)
   AND MST.R_NUM = B.R_NUM(+) AND MST.DPT_CD = B.DPT_CD(+)
   AND MST.R_NUM = C.R_NUM(+) AND MST.DPT_CD = C.DPT_CD(+)
   AND MST.R_NUM = D.R_NUM(+) AND MST.DPT_CD = D.DPT_CD(+)
   AND NVL(A.AUD_PLAN_SNO,0)+NVL(B.AUD_PLAN_SNO,0)+NVL(C.AUD_PLAN_SNO,0)+NVL(D.AUD_PLAN_SNO,0) <> 0
   ) Q
   WHERE 1=1
            ]]>
   		<if test='audPlanYr != null and audPlanYr != ""'>
			AND  AUD_YRAA = #{audPlanYr}
		</if>
		<if test='dptCd != null and dptCd != ""'>
			AND  DPT_CD = #{dptCd}
		</if>
		 <if test='dptCd == null and schSpvBrdvCd != ""'>
	        AND  DPT_CD IN ( SELECT DPT_CD FROM TBDCMACM002M 
                                        WHERE SUBSTR( DPT_CD, 0, 3) = SUBSTR(#{schSpvBrdvCd}, 0, 3)
                                          AND DPT_CD NOT LIKE '%000'
                                          AND USE_YN = 'Y'
                           )
	     </if>
	</select>
	<!-- 계획관리-업무계획보고서작성 목록* -->
	<select id="selectTab4MainList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001.selectTab4MainList */
        <![CDATA[
			SELECT A.AUD_PLAN_YR ,
			       A.DPT_CD ,
			       F_DPT_INFO(A.DPT_CD, '1') AS DPT_NM , --감사명
			       A.AUD_PLAN_SNO ,
			       A.AUD_SBJ_NM , --감사명
			       F_CODE_NM('1000739',A.AUD_KND_CD) AS AUD_KND_NM , --감사종류
			       B.DOC_ID AS DOC_ID , --명세서ID
			       B.RPRT_NM AS RPRT_NM , --명세서명
			       B.RPRT_CD AS RPRT_CD , 
			       A.DATA_AUD_STR_DY ,
			       A.DATA_AUD_END_DY ,
			       A.DATA_AUD_DT ,
			       A.PREY_AUD_STR_DY ,
			       A.PREY_AUD_END_DY ,
			       A.PREY_AUD_DT ,
			       A.ACTU_AUD_STR_DY ,
			       A.ACTU_AUD_END_DY ,
			       A.ACTU_AUD_DT ,
			       A.PRSS_AUD_STR_DY ,
			       A.PRSS_AUD_END_DY ,
			       A.AUD_POINT ,
			       A.RLTN_ORG ,
			       A.MPP_AUD_YN ,
			       A.MPP_AUD_YR ,
			       A.MPP_AUD_NO ,
			       A.PLAN_PR_GUBN ,
			       A.PLAN_NUD_GUBN ,
			       A.PLAN_CHG_YN ,
			       A.FRT_USR_ID , --작성자ID
			       F_USR_INFO_BY_ID(A.FRT_USR_ID, '2')||'('||TO_CHAR(A.FRT_REGI_DH,'YY"-"MM"-"DD')||')' AS FRT_USR_NM , --작성자명+(일자)
			       A.FNL_USR_ID ,
			       A.FNL_DEAL_DPT_CD ,
			       A.FNL_MNU_ID ,
			       A.FRT_REGI_DH ,
			       A.FNL_MDF_DH
			  FROM TBBADDED128M A LEFT OUTER JOIN (SELECT AUD_PLAN_YR,AUD_PLAN_SNO,DPT_CD,DOC_ID, RPRT_NM, RPRT_CD 
                                                     FROM TBBADDED131M 
                                                    WHERE RPRT_CD = 'A11000800') B ON (A.AUD_PLAN_YR=B.AUD_PLAN_YR AND A.DPT_CD=B.DPT_CD AND A.AUD_PLAN_SNO=B.AUD_PLAN_SNO)
			--WHERE B.RPRT_CD = ('A11000800')   --감사사항 명세서 
         ]]>
			  <if test="audPlanYr != null and audPlanYr != ''">
                    AND A.AUD_PLAN_YR = #{audPlanYr}
              </if>
              <if test="schDeptCd != null and schDeptCd != ''">
                    AND A.DPT_CD IN (SELECT DPT_CD FROM TBDCMACM002M WHERE HIRK_DPT_CD=#{schDeptCd})--조건:HIRK_DPT_CD
              </if>
			 <![CDATA[
			 ORDER BY A.DPT_CD ,
			       A.AUD_KND_CD
             ]]>

	</select>
	
	<!-- 계획관리-개별 보고서 목록 -->
	<select id="selectTab4SubList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001.selectTab4SubList */
        <![CDATA[
			SELECT A.RPRT_CD,
			       A.RPRT_GUBUN, --보고서구분
			       B.RPRT_NM AS RPRT_NM, --보고서명
			       B.FRT_USR_ID, 
			       F_USR_INFO_BY_ID(B.FRT_USR_ID, '2') AS FRT_USR_NM , --작성자명
			       B.DOC_ID, --보고서DOCID
			       B.AUD_PLAN_YR ,
			       B.DPT_CD ,
			       B.AUD_PLAN_SNO ,
			       CASE WHEN A.RPRT_CD = 'A11000810' AND (B.DOC_ID IS NULL OR B.DOC_ID='') THEN '작성' 
			            WHEN B.DOC_ID IS NULL OR B.DOC_ID='' THEN '취합' 
			       ELSE '삭제' END DEL_NM,
                   DECODE(B.FRT_USR_ID,NULL,'','','',F_USR_INFO_BY_ID(B.FRT_USR_ID, '2')||'('||TO_CHAR(B.FRT_REGI_DH,'YY"-"MM"-"DD')||')') AS FRT_REGI_DH  --작성자명+(일자)
			  FROM(SELECT AUD_DOC_CD AS RPRT_CD, DTIL_AUD_DOC_NM AS RPRT_GUBUN FROM TBFDMADM002M WHERE AUD_DOC_CD ='A11000810'
			       UNION ALL SELECT AUD_DOC_CD AS RPRT_CD, DTIL_AUD_DOC_NM AS RPRT_GUBUN FROM TBFDMADM002M WHERE AUD_DOC_CD ='A11000900' --감사계획 공개(안)
			       UNION ALL SELECT AUD_DOC_CD AS RPRT_CD, DTIL_AUD_DOC_NM AS RPRT_GUBUN FROM TBFDMADM002M WHERE AUD_DOC_CD ='A11001000'--대행위탁감사 목록
			       UNION ALL SELECT AUD_DOC_CD AS RPRT_CD, DTIL_AUD_DOC_NM AS RPRT_GUBUN FROM TBFDMADM002M WHERE AUD_DOC_CD ='A11001100'--외부전문가 자문등 활용계획
			       UNION ALL SELECT AUD_DOC_CD AS RPRT_CD, DTIL_AUD_DOC_NM AS RPRT_GUBUN FROM TBFDMADM002M WHERE AUD_DOC_CD ='A11001200'--수견직원감사활용계획
			       UNION ALL SELECT AUD_DOC_CD AS RPRT_CD, DTIL_AUD_DOC_NM AS RPRT_GUBUN FROM TBFDMADM002M WHERE AUD_DOC_CD ='A11001300'--연구용역계획
			       UNION ALL SELECT AUD_DOC_CD AS RPRT_CD, DTIL_AUD_DOC_NM AS RPRT_GUBUN FROM TBFDMADM002M WHERE AUD_DOC_CD ='A11001400'--감사연구원 활용계획
			       UNION ALL SELECT AUD_DOC_CD AS RPRT_CD, DTIL_AUD_DOC_NM AS RPRT_GUBUN FROM TBFDMADM002M WHERE AUD_DOC_CD ='A11001500'--해외 자료수집 계획
			       UNION ALL SELECT AUD_DOC_CD AS RPRT_CD, DTIL_AUD_DOC_NM AS RPRT_GUBUN FROM TBFDMADM002M WHERE AUD_DOC_CD ='A11001600'--정책사업모니터링목록
			       UNION ALL SELECT AUD_DOC_CD AS RPRT_CD, DTIL_AUD_DOC_NM AS RPRT_GUBUN FROM TBFDMADM002M WHERE AUD_DOC_CD ='A11001700'--운영발전을위한일반업무 주요과제명세서
			      
			               ) A LEFT OUTER JOIN (
			               						SELECT RPRT_NM, FRT_USR_ID,DOC_ID, RPRT_CD, FRT_REGI_DH,AUD_PLAN_YR ,DPT_CD ,AUD_PLAN_SNO
			               						  FROM TBBADDED131M 
			               						 WHERE AUD_PLAN_YR = #{audPlanYr}
			                					   AND DPT_CD = #{dptCd} 
			                					   AND AUD_PLAN_SNO = #{audPlanSno} ) B ON(A.RPRT_CD = B.RPRT_CD) 
		]]>
	</select>
	
	<select id="selectDocumentList" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.aep.pln.dao.AEPPLN001.selectDocumentList*/
        /*문서함(결재정보)*/
        <![CDATA[
        SELECT
            RPRT_NM,
           APV_STA_CD,
           APV_RQS_ID,
           DOC_ID,
           APV_SRNO,
           PST_NM,
           APVR_NM,
           APV_DH ,
           CASE
                WHEN ROW_NUMBER() OVER(PARTITION BY DOC_ID ORDER BY APV_SRNO) = 1 THEN COUNT(*) OVER(PARTITION BY DOC_ID)
                ELSE 0
           END ROWSPAN_CNT
      FROM (
           SELECT
                  A.RPRT_NM ,       /*보고서명 */
                  A.APV_STA_CD ,    /*결재상태코드 */
                  A.DOC_ID ,        /*결재문서번호 */
                  A.APV_RQS_ID,     /*결재요청ID */
                  B.APV_SRNO ,      /*결재순번 */
                  B.PST_NM ,        /*결재자직위코드 */
                  B.APVR_NM ,       /*결재자전산번호 */
                  B.APV_DH          /*결재일시 */
             FROM TBBADDED131M A,
                  (
                  SELECT APV_DOC_NO AS APV_RQS_ID ,
                         APV_SNO AS APV_SRNO ,
                         CASE WHEN APVR_PST_CD IS NULL
                              THEN ONR_PST_NM
                              ELSE F_CODE_NM('1000176', APVR_PST_CD)
                         END  AS PST_NM ,
                         F_USR_INFO(APVR_CNB, '2') AS APVR_NM ,
                         CASE WHEN SUBSTR(APVR_STA_CD,0,1) = '2' THEN TO_CHAR(APV_DH, 'YYYY-MM-DD')
                                  ELSE ''
                         END  AS APV_DH
                    FROM TBDCMACM023L
                   WHERE APV_SNO <> '1'
                   AND APVR_KND_CD NOT IN ('4','6','7')
                   UNION ALL
                  SELECT DH1.APV_RQS_ID,
                         DH1.APV_SRNO,
                         (SELECT H2.PST_NM AS PST_NM
                            FROM TBDCMACM111H H1,
                                 TBDCMACM112H H2
                           WHERE 1=1
                             AND H1.RCPT_DT = H2.RCPT_DT
                             AND H1.RCPT_ID = H2.RCPT_ID
                             AND H1.ONR_DOC_MNG_CRD_ID = DH1.APV_RQS_ID
                             AND H2.APVR_ID = DH1.APVR_ID
                           GROUP BY H2.PST_NM ) AS PST_NM,
                         DH1.APVR_NM,
                         DH1.APV_DH
                    FROM
                         (SELECT ONR_DOC_MNG_CRD_ID AS APV_RQS_ID,
                                 APV_HIS_SRNO AS APV_SRNO,
                                 APVR_ID,
                                 APVR_NM AS APVR_NM,
                                 TO_CHAR(APV_DH, 'YYYY-MM-DD') AS APV_DH
                            FROM TBDCMACM102L D2
                           WHERE 1=1
                             AND ONR_APV_DVSN_CD <> '10' --(기안자 제외)
                              AND NVL(ONR_APV_RSLT_CD,'hh') <>'50'
                           ORDER BY APV_RQS_ID,APV_SRNO
                         ) DH1
                  ) B
            WHERE A.AUD_PLAN_YR = #{audPlanYr}
              AND A.DPT_CD = #{dptCd}
              AND A.AUD_PLAN_SNO = #{audPlanSno}
        ]]>
              AND B.APV_RQS_ID = A.APV_RQS_ID
        ORDER BY A.SORT_SNO
        )
    </select>
	
	<select id="selectDocumentList2" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.aep.pln.dao.AEPPLN001.selectDocumentList2*/
        /*문서함(문서자체정보)*/
        <![CDATA[
          SELECT
               RPRT_NM ,       /*보고서명 */
               A.RPRT_CD ,       /*보고서코드*/
               A.REF_ID ,
               A.APV_STA_CD,    /*결재상태코드 */
               F_CODE_NM('1000773',A.APV_STA_CD) AS APV_STA_NM ,    /*결재상태코드 */
               A.SORT_SNO ,      /*보고서순번  */
               A.DOC_ID,         /*결재문서번호 */
               A.APV_RQS_ID,      /*결재ID*/
               '' AS APV_YN ,           /*결재여부 */
               CON_PGM_CD    /*연계프로그램코드*/
                  /*필수여부*/
                  ,A.NECES_YN
                  ,A.APV_WAY_CD /*결재방법코드*/
                  , A.SND_DOC_YN /*문서발송여부*/
          FROM TBBADDED131M AS A
           WHERE A.AUD_PLAN_YR = #{audPlanYr}
              AND A.DPT_CD = #{dptCd}
              AND A.AUD_PLAN_SNO = #{audPlanSno}
         ]]>
        
        ORDER BY A.SORT_SNO ASC, A.FRT_REGI_DH ASC
    </select>
    
    <!-- 실적 및 총괄-->
	<select id="selectAllList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001W.selectAllList */
        <![CDATA[
	    SELECT
		    QUARTER,
		    NVL(H_1,'재정경제감사국') AS H_1,
		    NVL(H_2,'산업금융감사국') AS H_2,
		    NVL(H_3,'국토해양감사국') AS H_3,
		    NVL(H_4,'사회복지감사국') AS H_4,
		    NVL(H_5,'행정안전감사국') AS H_5,
		    NVL(H_6,'지방행정감사1국') AS H_6,
		    NVL(H_7,'지방행정감사2국') AS H_7,
		    NVL(H_8,'특별조사국') AS H_8,
		    NVL(H_9,'민원조사단') AS H_9,
		    NVL(H_10,'감사청구조사단') AS H_10,
		    NVL(H_11,'공공기관감사국') AS H_11,
		    NVL(H_12,'전략감사단') AS H_12,
		    NVL(H_13,'SOC시설안전감사단') AS H_13,
		    NVL(H_14,'국방감사단') AS H_14,
		    NVL(H_15,'IT감사단') AS H_15,
		    NVL(H_16,'공공감사운영단') AS H_16
		FROM(
	    
	    /* 감사실적 및 계획 총괄1 */
		SELECT '구분' AS QUARTER
		      ,MAX(CASE WHEN E.GUK_CD = '010' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_1
		      ,MAX(CASE WHEN E.GUK_CD = '020' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_2
		      ,MAX(CASE WHEN E.GUK_CD = '030' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_3
		      ,MAX(CASE WHEN E.GUK_CD = '040' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_4
		      ,MAX(CASE WHEN E.GUK_CD = '050' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_5
		      ,MAX(CASE WHEN E.GUK_CD = '061' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_6
		      ,MAX(CASE WHEN E.GUK_CD = '062' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_7
		      ,MAX(CASE WHEN E.GUK_CD = '070' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_8
		      ,MAX(CASE WHEN E.GUK_CD = '071' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_9
		      ,MAX(CASE WHEN E.GUK_CD = '081' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_10
		      ,MAX(CASE WHEN E.GUK_CD = '090' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_11
		      ,MAX(CASE WHEN E.GUK_CD = '0A0' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_12
		      ,MAX(CASE WHEN E.GUK_CD = '0A1' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_13
		      ,MAX(CASE WHEN E.GUK_CD = '0G0' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_14
		      ,MAX(CASE WHEN E.GUK_CD = '0H0' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_15
		      ,MAX(CASE WHEN E.GUK_CD = '180' THEN F_DPT_INFO(E.GUK_CD||'000','1')||E.AUD_CNT_GUK||'<br>'||AGGR_CONCAT(F_CODE_NM('1000739', E.AUD_KND_CD)||E.AUD_CNT||E.ORG_CNT,',') ELSE '' END) AS H_16
		  FROM (
		        SELECT C.GUK_CD
		              ,'('||(SELECT COUNT(*)
		                       FROM TBBADDED128M D
		                      WHERE D.AUD_PLAN_YR = #{audPlanYr}
		                        AND SUBSTR(D.DPT_CD,0,3) = C.GUK_CD)||')' AS AUD_CNT_GUK
		              ,C.AUD_KND_CD
		              ,COUNT(*) AS AUD_CNT
		              ,CASE WHEN C.AUD_KND_CD = '1' OR C.AUD_KND_CD = '4' THEN '('||SUM(C.ORG_CNT)||')'
		                    ELSE NULL
		                     END AS ORG_CNT
		          FROM (
		                SELECT A.AUD_PLAN_YR
		                      ,SUBSTR(A.DPT_CD,0,3) AS GUK_CD
		                      ,A.AUD_PLAN_SNO
		                      ,A.AUD_KND_CD
		                      ,COUNT(B.ORG_CD) AS ORG_CNT
		                  FROM TBBADDED128M A
		                      ,TBBADDED130M B
		                 WHERE A.AUD_PLAN_YR  = B.AUD_PLAN_YR(+)
		                   AND A.DPT_CD       = B.DPT_CD(+)
		                   AND A.AUD_PLAN_SNO = B.AUD_PLAN_SNO(+)
		                   AND A.AUD_PLAN_YR = #{audPlanYr}
		                   AND A.ACTU_AUD_STR_DY IS NOT NULL
		                 GROUP BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.AUD_KND_CD
		                 ORDER BY A.AUD_PLAN_YR,A.DPT_CD,A.AUD_PLAN_SNO,A.AUD_KND_CD
		               ) C
		          GROUP BY C.AUD_PLAN_YR,C.GUK_CD,C.AUD_KND_CD
		       ) E
		 GROUP BY E.GUK_CD,E.AUD_CNT_GUK
		)QQ 
		UNION ALL
		
		/* 감사실적 및 계획 총괄2 */
		
		    SELECT Z.QUARTER||'/4 분기'||CHR(13)||CHR(10)||'계획('||SUM(Z.AUD_CNT)||')' AS QUARTER
		          ,MAX(Z.AUD_INFO_010) AS H_01
		          ,MAX(Z.AUD_INFO_020) AS H_02
		          ,MAX(Z.AUD_INFO_030) AS H_03
		          ,MAX(Z.AUD_INFO_040) AS H_04
		          ,MAX(Z.AUD_INFO_050) AS H_05
		          ,MAX(Z.AUD_INFO_061) AS H_06
		          ,MAX(Z.AUD_INFO_062) AS H_07
		          ,MAX(Z.AUD_INFO_070) AS H_08
		          ,MAX(Z.AUD_INFO_071) AS H_09
		          ,MAX(Z.AUD_INFO_081) AS H_10
		          ,MAX(Z.AUD_INFO_090) AS H_11
		          ,MAX(Z.AUD_INFO_0A0) AS H_12
		          ,MAX(Z.AUD_INFO_0A1) AS H_13
		          ,MAX(Z.AUD_INFO_0G0) AS H_14
		          ,MAX(Z.AUD_INFO_0H0) AS H_15
		          ,MAX(Z.AUD_INFO_180) AS H_16
		      FROM (
		            SELECT TO_CHAR(TO_DATE(A.ACTU_AUD_STR_DY),'Q') AS QUARTER
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '010' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_010
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '020' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_020
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '030' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_030
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '040' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_040
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '050' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_050
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '061' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_061
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '062' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_062
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '070' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_070
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '071' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_071
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '081' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_081
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '090' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_090
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '0A0' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_0A0
		                   ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '0A1' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_0A1
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '0G0' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_0G0
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '0H0' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_0H0
		                  ,CASE WHEN SUBSTR(A.DPT_CD,0,3) = '180' THEN AGGR_CONCAT(DECODE(A.MPP_AUD_YN,'Y','<font color="blue">','') || '('||DECODE(SUBSTR(A.DPT_CD,0,3),'062',F_DPT_INFO(A.DPT_CD,'4'),SUBSTR(F_DPT_INFO(A.DPT_CD,'4'),3,1)||'과')||'-'
		                                                                              ||F_CODE_NM('1000739', A.AUD_KND_CD)||'-'
		                                                                              ||SUBSTR(A.ACTU_AUD_STR_DY,5,2)||'월) '
		                                                                              ||A.AUD_SBJ_NM||CHR(13)||CHR(10) || DECODE(A.MPP_AUD_YN,'Y','</font>',''), '' ORDER BY A.AUD_KND_CD,A.DPT_CD,A.ACTU_AUD_STR_DY)
		                        ELSE '' END AS AUD_INFO_180
		                  ,COUNT(*) AS AUD_CNT
		              FROM TBBADDED128M A
		             WHERE 1=1
		               AND A.AUD_PLAN_YR = #{audPlanYr}
		               AND A.ACTU_AUD_STR_DY IS NOT NULL
		               AND SUBSTR(A.DPT_CD,0,3) IN ('010','020','030','040','050','061','062','070','071','081','090','0A0','0a1','0G0','0H0','180')
		             GROUP BY TO_CHAR(TO_DATE(A.ACTU_AUD_STR_DY),'Q')
		                     ,SUBSTR(A.DPT_CD,0,3)
		             ORDER BY SUBSTR(A.DPT_CD,0,3)
		           ) Z
		     GROUP BY Z.QUARTER
				]]>
	</select>
	
	
	<select id="selectAepPlnCnt" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.pln.dao.AEPPLN001W.selectAepPlnCnt */
        <![CDATA[
			SELECT AUD_KND_CNT
                  , AUD_PLAN_YR
                  , AUD_KND_CD
                  , F_CODE_NM('1000739', AUD_KND_CD) AS AUD_KND_NM
                  , SUM(DECODE(AUD_KND_CD, 1, ORG_CNT, 4, ORG_CNT ,0)) AS ORG_SUM
            FROM (
            SELECT COUNT(A.AUD_PLAN_YR) OVER (PARTITION BY A.AUD_PLAN_YR, A.AUD_KND_CD) AS AUD_KND_CNT
                , A.AUD_PLAN_YR
                , A.AUD_KND_CD
                , A.DPT_CD
                , A.AUD_PLAN_SNO
                , (SELECT COUNT(ST1.ORG_CD) FROM TBBADDED130M ST1 WHERE ST1.AUD_PLAN_YR = A.AUD_PLAN_YR AND ST1.DPT_CD = A.DPT_CD AND ST1.AUD_PLAN_SNO = A.AUD_PLAN_SNO) AS ORG_CNT
            FROM TBBADDED128M A 
            WHERE A.AUD_PLAN_YR = #{audPlanYr}
            AND SUBSTR(A.DPT_CD,0,3) IN ('010','020','030','040','050','061','062','070','071','081','090','0A0','0A1','0G0','0H0','180'))
            GROUP BY AUD_PLAN_YR, AUD_KND_CD, AUD_KND_CNT
		]]>
	</select>
</mapper>