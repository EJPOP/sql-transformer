<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.osm.dao.AEPOSM002PMapper">
    
    <select id="selectMainInfo" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM002PMapper.selectMainInfo*/
        SELECT A.CMT_SBJ_TIT,
               A.SBCN_SNO AS SBCN_PAGE_CNT,
               F_DPT_INFO(A.REL_DPT_CD,'1')  AS MNG_DPT_NM,
               A.REL_DPT_CD,
               A.CMT_SBJ_DVSN_CD,
               A.CMT_SBJ_SNO,
               A.REGI_NO,
               A.PRSS_DPT_NM,
               A.SBCN_RPTR
          FROM TBBADDED121M AS A
         WHERE A.CMT_DY = REPLACE(#{cmtDy},'-')
           AND A.CMT_DVSN_CD = #{cmtDvsnCd}
           AND A.CMT_SQ = #{cmtSq}
           <if test="cmtSbjDvsnCd != null and cmtSbjDvsnCd != ''">
           AND A.CMT_SBJ_DVSN_CD = #{cmtSbjDvsnCd}
           </if>
           <if test="cmtSbjSno != null and cmtSbjSno != ''">
           AND A.CMT_SBJ_SNO = #{cmtSbjSno}
           </if>
           <if test="sbcnPageCnt != null and sbcnPageCnt != ''">
           AND A.SBCN_SNO = #{sbcnPageCnt}
           </if>
    </select>
    
    <select id="selectSubList" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM002PMapper.selectSubList*/
        <include refid="include.pageSelct" />
            SELECT A.CMT_SBJ_DTL_TIT,
                   NVL(A.DOC_ID,'') AS DOC_ID1,
                   NVL(A.DOC_ID,'') AS DOC_ID2,
                   A.CMT_SBJ_DTL_SNO,
                   A.FILE_NM
              FROM TBBADDED122M AS A
             WHERE A.CMT_DY = REPLACE(#{cmtDy},'-')
               AND A.CMT_DVSN_CD = #{cmtDvsnCd}
               AND A.CMT_SQ = #{cmtSq}
               AND A.CMT_SBJ_DVSN_CD = #{cmtSbjDvsnCd}
               AND A.CMT_SBJ_SNO = #{cmtSbjSno}
       <include refid="include.pageOrder" />
    </select>
    
    <update id="updateBADDED121M" parameterType="paramMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM002PMapper.updateBADDED121M*/
        UPDATE TBBADDED121M SET CMT_SBJ_TIT     = #{cmtSbjTit},
                                REGI_NO = #{regiNo},
                                PRSS_DPT_NM = #{prssDptNm},
                                SBCN_RPTR = #{sbcnRptr},
                                REL_DPT_CD      = #{relDptCd},
                                FNL_USR_ID      = #{usrId},
                                FNL_DEAL_DPT_CD = #{dptCd},
                                FNL_MNU_ID      = 'AEPOSM002P',
                                FNL_MDF_DH      = SYSDATE
                          WHERE CMT_DY = REPLACE(#{cmtDy},'-')
                            AND CMT_DVSN_CD = #{cmtDvsnCd}
                            AND CMT_SQ = #{cmtSq}
                            AND CMT_SBJ_DVSN_CD = #{cmtSbjDvsnCd}
                            AND CMT_SBJ_SNO = #{cmtSbjSno}
    </update>
    
    <insert id="insertBADDED122M" parameterType="paramMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM002PMapper.insertBADDED122M*/
        INSERT INTO TBBADDED122M(CMT_DY,
                                 CMT_DVSN_CD,
                                 CMT_SQ,
                                 CMT_SBJ_DVSN_CD,
                                 CMT_SBJ_SNO,
                                 CMT_SBJ_DTL_SNO,
                                 CMT_SBJ_DTL_TIT,
                                 <if test="docId != null and docId !=''">
                                 DOC_ID,
                                 FILE_NM,
                                 </if>
                                 FRT_USR_ID,
                                 FNL_USR_ID,
                                 FNL_DEAL_DPT_CD,
                                 FNL_MNU_ID,
                                 FRT_REGI_DH,
                                 FNL_MDF_DH)
                          VALUES(REPLACE(#{cmtDy},'-'),
                                 #{cmtDvsnCd},
                                 #{cmtSq},
                                 #{cmtSbjDvsnCd},
                                 #{cmtSbjSno},
                                 (SELECT NVL(MAX(CMT_SBJ_DTL_SNO)+1,'1') FROM TBBADDED122M WHERE CMT_DY = REPLACE(#{cmtDy},'-')
                                                                                             AND CMT_DVSN_CD = #{cmtDvsnCd}
                                                                                             AND CMT_SQ = #{cmtSq}
                                                                                             AND CMT_SBJ_DVSN_CD = #{cmtSbjDvsnCd}
                                                                                             AND CMT_SBJ_SNO = #{cmtSbjSno}),
                                 #{cmtSbjDtlTit},
                                 <if test="docId != null and docId !=''">
                                 #{docId},
                                 #{fileNm},
                                 </if>
                                 #{usrId},
                                 #{usrId},
                                 #{dptCd},
                                 #{menuNo},
                                 SYSDATE,
                                 SYSDATE)
    </insert>
    
    <update id="updateBADDED122M" parameterType="paramMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM002PMapper.updateBADDED122M*/
        UPDATE TBBADDED122M SET CMT_SBJ_DTL_TIT = #{cmtSbjDtlTit},
                                DOC_ID = #{docId},
                                FNL_USR_ID      = #{usrId},
                                FNL_DEAL_DPT_CD = #{dptCd},
                                FNL_MNU_ID      = 'HARD_CODING',
                                FNL_MDF_DH      = SYSDATE,
                                FILE_NM            = #{fileNm}
                          WHERE CMT_DY = REPLACE(#{cmtDy},'-')
                            AND CMT_DVSN_CD = #{cmtDvsnCd}
                            AND CMT_SQ = #{cmtSq}
                            AND CMT_SBJ_DVSN_CD = #{cmtSbjDvsnCd}
                            AND CMT_SBJ_SNO = #{cmtSbjSno}
                            AND CMT_SBJ_DTL_SNO = #{cmtSbjDtlSno}
    </update>
    
    <delete id="deleteBADDED122M" parameterType="paramMap">
    /*kr.go.bai.eip.aep.osm.dao.AEPOSM002PMapper.deleteBADDED122M*/
        DELETE FROM TBBADDED122M WHERE CMT_DY = REPLACE(#{cmtDy},'-')
                                   AND CMT_DVSN_CD = #{cmtDvsnCd}
                                   AND CMT_SQ = #{cmtSq}
                                   AND CMT_SBJ_DVSN_CD = #{cmtSbjDvsnCd}
                                   AND CMT_SBJ_SNO = #{cmtSbjSno}
                                   AND CMT_SBJ_DTL_SNO = #{cmtSbjDtlSno}
    </delete>
    
</mapper>