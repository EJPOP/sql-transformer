<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.cfr.dao.AEPCFR004QMapper">

    <select id="selectUsrList" parameterType="paramMap" resultType="egovMap">
    	/*kr.go.bai.eip.aep.cfr.dao.AEPCFR004QMapper.selectUsrList*/
    	<include refid="include.pageSelct" />
		SELECT     B.LG_SRNO
		         , B.USR_ID
				 , B.USR_NAM
		         , B.RQS_IP_NO
		         , B.DVSN_CD_NM
		         , B.DOC_ID
		         , B.TIT_NM                 
		         , B.CAT_NO
			     , B.ACCESS_TIME	
			     , B.DVSN_CD
			     , B.FNL_MDF_DH
			FROM
		        ( 
						SELECT A.LG_SRNO
			                 , A.USR_ID
							 , A.USR_NAM
			                 , A.RQS_IP_NO
							 , CASE WHEN DVSN_CD IN ('03','04') THEN '제' || A.CMT_SQ || '회' ||' '|| F_CODE_NM('1000789',A.CMT_DVSN_CD) ||   DECODE(A.CAT_NO, 'null' , ' ', ' (' || CAT_NO || ') ') || A.CMT_SBJ_SNO ||'. ' || TIT_NM
							        ELSE F_CODE_NM('1000847',A.DVSN_CD) 
							   END AS DVSN_CD_NM
			                 , A.DOC_ID
			                 , A.TIT_NM                 
			                 , A.CAT_NO
						     , TO_CHAR(A.FNL_MDF_DH,'YYYY-MM-DD HH24:MI:SS') AS ACCESS_TIME		
						     , A.FNL_MDF_DH	 	 
						     , A.DVSN_CD	 
						 FROM TBBADDED134H A
						WHERE 1=1
		         )B
		WHERE 1=1
			<if test='usrNm != null and usrNm != ""'>
			  AND B.USR_NAM LIKE '%'||#{usrNm}||'%'
			</if>
			<if test='usrId != null and usrId != ""'>
			  AND B.USR_ID LIKE #{usrId}||'%'
			</if>
		    <if test='dvsnCdNm != null and dvsnCdNm != ""'>
			  AND B.DVSN_CD_NM LIKE '%'||#{dvsnCdNm}||'%'
			</if>
			<if test='schStrDt != null and schStrDt != ""'>			  
              AND TO_CHAR(B.FNL_MDF_DH,'YYYYMMDD') BETWEEN REPLACE(#{schStrDt},'-') AND REPLACE(#{schEndDt},'-')
			</if>
			<if test='dvsnCd != null and dvsnCd != ""'>
			  AND B.DVSN_CD = #{dvsnCd}
			</if>
			ORDER BY B.LG_SRNO DESC
		<include refid="include.pageOrder" />
    </select>
    
    <insert id="insertAgoraUsrHist" parameterType="HashMap">
    /* kr.go.bai.eip.aep.cfr.dao.AEPCFR004QMapper.insertAgoraUsrHist */
    <![CDATA[
        INSERT INTO TBBADDED134H (
                LG_SRNO,
                USR_ID,
                USR_NAM,
                RQS_IP_NO,
                DVSN_CD,
                DOC_ID,
                TIT_NM,
                CAT_NO,
                CMT_DVSN_CD,
                CMT_SQ,
                CMT_SBJ_SNO,
                FRT_USR_ID,
                FNL_USR_ID,                
                FRT_REGI_DH,
                FNL_MDF_DH
        )VALUES(
                AGORA_IF_SEQ.NEXTVAL,
                #{usrId},
                #{usrNam},
                #{rqsIpNo},
                #{dvsnCd},
                #{docId},
                #{titNm},
                #{audYrNo},
                #{cmtDvsnCd},
                #{cmtSq},
                #{cmtSbjSno},
                #{usrId},
                #{usrId},
                SYSDATE,
                SYSDATE
        )
    ]]>
    </insert>   
    
</mapper> 