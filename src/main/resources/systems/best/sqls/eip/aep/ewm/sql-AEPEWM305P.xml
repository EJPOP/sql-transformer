<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.ewm.dao.AEPEWM305PMapper">
	
	<resultMap type="java.util.Map" id="examRprtselect">
		<result property="audYr"               column="AUD_YR"                 jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="audNo"               column="AUD_NO"                 jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="dspRqSno"            column="DSP_RQ_SNO"             jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="mngSno"              column="MNG_SNO"                jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="audYrNoDsp"          column="AUD_YR_NO_DSP"          jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="audSbjNm"            column="AUD_SBJ_NM"             jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="rltnOrgCd"           column="RLTN_ORG_CD"            jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="rltnOrgNm"           column="RLTN_ORG_NM"            jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="enfmMngOrgCd"        column="ENFM_MNG_ORG_CD"        jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="enfmMngOrgNm"        column="ENFM_MNG_ORG_NM"        jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="enfDt"               column="ENF_DT"                 jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="titTxt"              column="TIT_TXT"                jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="dspRqKndNm"          column="DSP_RQ_KND_NM"          jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="examRprtDspRqSbt"    column="EXAM_RPRT_DSP_RQ_SBT"   jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="totAm"               column="TOT_AM"                 jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="cpsDrtrNm"           column="CPS_DRTR_NM"            jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="asgAm"               column="ASG_AM"                 jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="examRptFrmEnfmHis"   column="EXAM_RPT_FRM_ENFM_HIS"  jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="examRptFrmAsgRsn"    column="EXAM_RPT_FRM_ASG_RSN"   jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="examRptFrmExamOpin"  column="EXAM_RPT_FRM_EXAM_OPIN" jdbcType="VARCHAR" javaType="java.lang.String"/>
		<result property="examRptFrmAllTxt"    column="EXAM_RPT_FRM_ALL_TXT"   jdbcType="CLOB"    javaType="java.lang.String"/>
	</resultMap>
	
	<select id="selectExamRprt" parameterType="paramMap" resultMap="examRprtselect">
			/* kr.go.bai.eip.aep.ewm.dao.AEPEWM305PMapper.selectExamRprt */
			SELECT MASTER.AUD_YR                                              AS AUD_YR
			     , MASTER.AUD_NO                                              AS AUD_NO
			     , MASTER.DSP_RQ_SNO                                          AS DSP_RQ_SNO
                 , T2.MNG_SNO                                                 AS MNG_SNO
                 , F_MNG_KND_AUDYRNO(MASTER.AUD_YR, MASTER.AUD_NO, '', '-')   AS AUD_YR_NO_DSP 
                 , T1.AUD_SBJ_NM                                              AS AUD_SBJ_NM    
 			     , RELORG.RLTN_ORG_CD                                         AS RLTN_ORG_CD            /* 관계기관코드 */
			     , F_ORG_INFO(RELORG.RLTN_ORG_CD, '1')                        AS RLTN_ORG_NM            /* 관계기관명 */
 			     , RELORG.ENFM_MNG_ORG_CD                                     AS ENFM_MNG_ORG_CD        /* 조치기관코드 */
			     , F_ORG_INFO(RELORG.ENFM_MNG_ORG_CD, '1')                    AS ENFM_MNG_ORG_NM 	    /* 조치기관명 */		          
			     , TO_CHAR(TO_DATE(DETAIL.ENF_DT),'YYYY-MM-DD')               AS ENF_DT      
				 , MASTER.TIT_TXT                                             AS TIT_TXT
				 , F_CODE_NM('1000002', MASTER.DSP_RQ_KND_CD)                 AS DSP_RQ_KND_NM   
				 , DETAIL.EXAM_RPRT_DSP_RQ_SBT                                AS EXAM_RPRT_DSP_RQ_SBT   /* 검토보고서처분요구요지 */
		         , NVL(DETAIL.PNL_DRIN_PSVT_AM,0) + 
			       NVL(DETAIL.RSR_AM,0)           + 
			       NVL(DETAIL.SPLP_AM,0)                                      AS TOT_AM                 /* 전체금액 */ 
                 , T2.CPS_DRTR_NM                                             AS CPS_DRTR_NM            /* 변상책임자 */
                 , T2.ASG_AM                                                  AS ASG_AM                 /* 지정금액 */
                 , T2.EXAM_RPT_FRM_ENFM_HIS                                   AS EXAM_RPT_FRM_ENFM_HIS  /* 검토보고서식집행내역 */
                 , T2.EXAM_RPT_FRM_ASG_RSN                                    AS EXAM_RPT_FRM_ASG_RSN   /* 검토보고서식지정사유 */
                 , T2.EXAM_RPT_FRM_EXAM_OPIN                                  AS EXAM_RPT_FRM_EXAM_OPIN /* 검토보고서식검토의견 */
                 , T2.EXAM_RPT_FRM_ALL_TXT                                    AS EXAM_RPT_FRM_ALL_TXT   /* 검토보고서식전체내용 */
			  FROM TBBADEAR001M MASTER
			     , TBBADEAR002D DETAIL
			     , TBBADEAR006M RELORG
			     , TBBADDED001M T1
                 , TBBADFRE011M T2
			 WHERE 1=1
			   AND MASTER.AUD_YR 		= DETAIL.AUD_YR
			   AND MASTER.AUD_NO 		= DETAIL.AUD_NO
			   AND MASTER.DSP_RQ_SNO 	= DETAIL.DSP_RQ_SNO
			   AND MASTER.AUD_YR 		= RELORG.AUD_YR
			   AND MASTER.AUD_NO 		= RELORG.AUD_NO
			   AND MASTER.DSP_RQ_SNO 	= RELORG.DSP_RQ_SNO
			   AND MASTER.AUD_YR 		= T1.AUD_YR
			   AND MASTER.AUD_NO 		= T1.AUD_NO
               AND MASTER.AUD_YR 		= T2.AUD_YR
			   AND MASTER.AUD_NO 		= T2.AUD_NO
			   AND MASTER.DSP_RQ_SNO 	= T2.DSP_RQ_SNO    
               AND T2.AUD_YR            = #{audYr} 
               AND T2.AUD_NO            = #{audNo}
               AND T2.DSP_RQ_SNO        = #{dspRqSno}
               AND T2.RLTN_ORG_CD       = #{rltnOrgCd}
               AND T2.MNG_SNO           = #{mngSno}
 	</select>
 	
 	
	<update id="saveExamRprt" parameterType="paramMap">
       /* kr.go.bai.eip.aep.ewm.dao.AEPEWM305PMapper.saveExamRprt */
        <![CDATA[
			UPDATE TBBADFRE011M
			   SET EXAM_RPT_FRM_ALL_TXT = #{examRptFrmAllTxt,jdbcType=CLOB} 
			      ,FNL_USR_ID           = #{fnlUsrId}
			      ,FNL_DEAL_DPT_CD      = #{fnlDealDptCd}
			      ,FNL_MNU_ID           = #{fnlMnuId}
			      ,FNL_MDF_DH           = SYSDATE
			 WHERE 1 = 1
			   AND AUD_YR       = #{audYr}    
			   AND AUD_NO       = #{audNo}    
			   AND DSP_RQ_SNO   = #{dspRqSno}	
               AND RLTN_ORG_CD  = #{rltnOrgCd}
               AND MNG_SNO      = #{mngSno}			   
        ]]>
	</update>
	
</mapper> 
