<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.asb.dao.AEPASB005QMapper">

    <select id="selectAsbInfo" parameterType="paramMap"
        resultType="egovMap">
        /* kr.go.bai.eip.aep.asb.dao.AEPASB005QMapper.selectAsbInfo */
		<![CDATA[
			SELECT 
				A.AUD_YR,
				A.AUD_NO,
                F_MNG_KND_AUDYRNO(M.AUD_YR, M.AUD_NO, M.AUD_KND_CD, '-')    AS AUD_YR_NO,    /*감사연번호*/
                AUD_SBJ_NM,
			    A.DCS_SNO, 
			    A.DCS_DSVN_CD, 
			    CASE 
			        WHEN A.DCS_DSVN_CD = '1' THEN '부의'
			        WHEN A.DCS_DSVN_CD = '2' THEN '분리부의'
			        WHEN A.DCS_DSVN_CD = '3' THEN '재부의'
			    END AS DCS_DSVN_NM,
			    TO_CHAR(to_date(A.DCS_DATE),'YYYY"-"MM"-"DD') AS DCS_DATE, 
			    F_USR_INFO(A.CHF_MB_CNB,'2') AS CHF_MB_NM, 
			    A.CHF_MB_CNB,
			    A.DCS_STATE,
			    CASE 
			        WHEN DCS_STATE = '001' THEN '부의사항접수대장 작성'
			        WHEN DCS_STATE = '002' THEN '주심위원 설명자료 작성'
			        WHEN DCS_STATE = '003' THEN '주심위원 검토'
			        WHEN DCS_STATE = '004' THEN '처리안변경 검토보고서 작성'
			        WHEN DCS_STATE = '005' THEN '감사보고서 작성'
			        WHEN DCS_STATE = '006' THEN '부의번호등재대장 작성'
			        WHEN DCS_STATE = '007' THEN '감사위원회 심의'
			        WHEN DCS_STATE = '008' THEN '부의사항처리부 및 보류사항정리부 작성'
			        WHEN DCS_STATE = '009' THEN '변경의결사항대조표 작성'
			        WHEN DCS_STATE = '010' THEN '부의 완료'
			    END AS DCS_STATE_NM,
			    (SELECT COUNT(1) 
                FROM TBAEPASB002D B, tbbadear001m C
                WHERE B.AUD_YR = A.AUD_YR
                AND B.AUD_NO = A.AUD_NO
                AND B.DCS_SNO = A.DCS_SNO
                AND B.AUD_YR = C.AUD_YR
                AND B.AUD_NO = C.AUD_NO
                AND B.DSP_RQ_SNO = C.DSP_RQ_SNO
                AND C.DSP_RQ_KND_CD IN ('610','611','620','621','623','630','904','905','914')
                )
                AS ADV_CNT,
			    (SELECT COUNT(1) 
                FROM TBAEPASB002D B, tbbadear001m C
                WHERE B.AUD_YR = A.AUD_YR
                AND B.AUD_NO = A.AUD_NO
                AND B.DCS_SNO = A.DCS_SNO
                AND B.AUD_YR = C.AUD_YR
                AND B.AUD_NO = C.AUD_NO
                AND B.DSP_RQ_SNO = C.DSP_RQ_SNO
                AND C.DSP_RQ_KND_CD NOT IN ('610','611','620','621','623','630','904','905','914')
                ) AS DSP_RQ_CNT,
                A.DCS_RCD_NO,
                A.DCS_TOT_NO
			FROM TBAEPASB001M A, TBBADDED001M M
            WHERE 
            		A.AUD_YR = M.AUD_YR
            AND A.AUD_NO = M.AUD_NO
            AND A.AUD_YR = #{audYr}
            AND A.AUD_NO = #{audNo}
            AND A.DCS_SNO = #{dcsSno}
			]]>

    </select>

</mapper> 
