<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.ewm.dao.AEPEWM501PMapper">
	
	<!-- 처분요구관리 조회  BADFRE031PMainSelect-->
	<select id="selectMainList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.ewm.dao.AEPEWM501PMapper.selectMainList */
        <include refid="include.pageSelct" />
        
        <![CDATA[       
			SELECT MASTER.AUD_YR      AS AUD_YR
			     , MASTER.AUD_NO      AS AUD_NO
			     , T1.AUD_GRN_NO      AS AUD_GRN_NO                  /* 감사부여번호 - 2016.06.02 yyh */
			     , MASTER.DSP_RQ_SNO  AS DSP_RQ_SNO
                 /* ,F_MNG_KND_AUDYRNO(MASTER.AUD_YR, MASTER.AUD_NO, T1.AUD_KND_CD, '-') || '-' || MASTER.DSP_RQ_SNO      AS DSP_RQ_SNO_NM */
                 ,NVL2(MASTER.ACT_DSP_NM,MASTER.ACT_DSP_NM, F_MNG_KND_AUDYRNO(MASTER.AUD_YR, MASTER.AUD_NO, T1.AUD_KND_CD, '-') || '-' || MASTER.DSP_RQ_SNO   ) AS DSP_RQ_SNO_NM
                 ,T1.AUD_SBJ_NM                                     AS AUD_SBJ_NM           /* 감사사항명 */
 		     	, CASE WHEN T1.AUD_YR >= '2016' 
			                THEN SUBSTR(T1.AUD_KND_CD,3,1)
			           ELSE '' 
			       END                                          AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.24 yyh*/	 			     
			     , RELORG.RLTN_ORG_CD                           AS RLTN_ORG_CD
			     , (SELECT ORG_NM
			          FROM TBDCMACM015M
			          WHERE ORG_CD = RELORG.RLTN_ORG_CD)        AS RLTN_ORG_NM /* AUD_ORG_CNT*/
			     , MASTER.DSP_RQ_KND_CD                         AS DSP_RQ_KND_CD
			     , (SELECT CD_NM
			          FROM TBDCMACM013C
			         WHERE CMM_CD_DVSN_CD = '1000002'
			           AND CD = MASTER.DSP_RQ_KND_CD)           AS DSP_RQ_KND_NM
			     , DETAIL.ENF_BRDV_CD ENF_BRDV_CD
			     , (SELECT DPT_NM
			          FROM TBDCMACM002M
			         WHERE DPT_CD = DETAIL.ENF_BRDV_CD)         AS OPER_BURDIV_NM
			     , DETAIL.ENFM_MNG_BRDV_CD                      AS ENFM_MNG_BRDV_CD
			     , (SELECT DPT_NM
			          FROM TBDCMACM002M
			         WHERE DPT_CD = DETAIL.ENFM_MNG_BRDV_CD)    AS ENFM_MNG_BRDV_NM
			     , DETAIL.PNL_DRIN_PSVT_AM                      AS PNL_DRIN_PSVT_AM
			     
			     , RELPSN.DFNT_NAM                              AS DETAILUSR_NAM
			     , RELPSN.AD                                    AS AD
			     , RELPSN.AM                                    AS AM
			     , TO_CHAR(TO_DATE(DETAIL.ENF_DT,'YYYY-MM-DD'),'YYYY-MM-DD')                                AS ENF_DT                          /*시행일*/
			     , F_DPT_INFO(DETAIL.ENF_BRDV_CD,'1')	        AS ENF_BRDV_NM                     /*시행국과명*/     
			     , MASTER.TIT_TXT                               AS TIT_TXT                         /*제목내용*/   
			     , DETAIL.EXAM_RPRT_DSP_RQ_SBT                  AS EXAM_RPRT_DSP_RQ_SBT            /*검토보고서처분요구요지*/
			     , RELPSN.DFNT_SNO
			  FROM TBBADEAR001M MASTER
			     , TBBADEAR002D DETAIL
			     , TBBADEAR006M RELORG
			     , TBBADEAR007M RELPSN
			     , TBBADDED001M T1
			 WHERE 1=1
			   AND MASTER.AUD_YR 		= DETAIL.AUD_YR
			   AND MASTER.AUD_NO 		= DETAIL.AUD_NO
			   AND MASTER.DSP_RQ_SNO 	= DETAIL.DSP_RQ_SNO
			   AND MASTER.AUD_YR 		= RELORG.AUD_YR(+)
			   AND MASTER.AUD_NO 		= RELORG.AUD_NO(+)
			   AND MASTER.DSP_RQ_SNO 	= RELORG.DSP_RQ_SNO(+)
			   AND MASTER.DSP_RQ_KND_CD = '110'
			   AND RELORG.AUD_YR 		= RELPSN.AUD_YR(+)
			   AND RELORG.AUD_NO 		= RELPSN.AUD_NO(+)
			   AND RELORG.DSP_RQ_SNO 	= RELPSN.DSP_RQ_SNO(+)
			   AND RELORG.RLTN_ORG_CD 	= RELPSN.RLTN_ORG_CD(+)
			   AND MASTER.AUD_YR 		= T1.AUD_YR
			   AND MASTER.AUD_NO 		= T1.AUD_NO
			   
		]]>
		<if test='enfDtSt != null and enfDtSt != ""'>
			<![CDATA[  		
			   AND DETAIL.ENF_DT     >= #{enfDtSt}
			]]>
		</if>
		<if test='enfDtEnd != null and enfDtEnd != ""'>
        	<![CDATA[  			
			   AND DETAIL.ENF_DT     <= #{enfDtEnd}
			]]>   
		</if>		
		<if test='audYrSt != null and audYrSt != ""'>
        	<![CDATA[  		
			   AND MASTER.AUD_YR   >= #{audYrSt}
			]]>    
		</if>		
		<if test='audGrnNoSt != null and audGrnNoSt != ""'>
        	<![CDATA[  		
			    AND T1.AUD_GRN_NO      >= #{audGrnNoSt}
			]]>    
		</if>		
		<if test='audYrEnd != null and audYrEnd != ""'>
        	<![CDATA[  		
			   AND MASTER.AUD_YR  <= #{audYrEnd}
			]]>   
		</if>		
		<if test='audGrnNoEnd != null and audGrnNoEnd != ""'>
        	<![CDATA[  			
			   AND T1.AUD_GRN_NO     <= #{audGrnNoEnd}
			]]>   
		</if>		
		
		/* 감사연번종류코드 추가 - 2015.12.24 yyh */		
		<if test='audYrNoKndCdSt != null and audYrNoKndCdSt != ""'>
            AND SUBSTR(T1.AUD_KND_CD,3,1) = NVL(#{audYrNoKndCdSt},'0')  
		</if>		
		
		<if test='enfBrdvCd != null and enfBrdvCd != ""'>
			   AND DETAIL.ENF_BRDV_CD  = #{enfBrdvCd}
		</if>		
		<if test='titTxt != null and titTxt != ""'>
			    AND MASTER.TIT_TXT LIKE '%'||#{titTxt}||'%'
		</if>		
		<if test='rltnOrgCd != null and rltnOrgCd != ""'>
			   AND RELORG.RLTN_ORG_CD = #{rltnOrgCd}
		</if>		
		<if test='dfntNam != null and dfntNam != ""'>
			   AND RELPSN.DFNT_NAM LIKE #{dfntNam}||'%'	
		</if>
		<if test='dfntSno != null and dfntSno != ""'>
			   AND RELPSN.DFNT_SNO = #{dfntSno}	
		</if>

       
			  ORDER BY MASTER.AUD_YR DESC
			          ,MASTER.AUD_NO DESC
			          ,MASTER.DSP_RQ_SNO DESC
	<include refid="include.pageOrder" />
	</select>

	
</mapper> 
