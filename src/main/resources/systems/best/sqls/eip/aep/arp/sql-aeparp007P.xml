<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper">
	<select id="selectMainList" parameterType="paramMap" resultType="egovMap">
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.selectMainList*/
		SELECT A.AUD_YR /*감사년도 */
		,A.AUD_NO /*감사순번*/
		,A.LIST_NO /*일람표일련번호 */
		,A.SORT_SNO /*정렬순번 */
		,A.DOC_ID /*문서ID */
		,A.APVR_CD /*결재자코드 */
		,A.AFF_SNO /*사건순번 */
		,A.REFER_DVSN_CD /*부의구분코드 (1000774)*/
		,F_CODE_NM('1000774', A.REFER_DVSN_CD) REFER_DVSN_NM /*부의구분코드명*/
		,A.TITLE_NM /*제목명 */
		,A.QST_DOC_ISUE_YN /*질문서발부여부 */
		,DECODE(A.QST_DOC_ISUE_YN,'Y','발부','미발부') QST_DOC_ISUE_YN_NM /*질문서발부여부명 */
		,A.AUDTOR /*감사자 */
		,A.RPRT_FILD_ID /*RPRT_FILD_ID*/
		,(SELECT CASE WHEN COUNT(B.DSP_RQ_CD) > 0 THEN 'Y' ELSE 'N' END
		FROM TBBADDED146M B
		WHERE B.AUD_YR = A.AUD_YR
		AND B.AUD_NO = A.AUD_NO
		AND B.AUD_STEP_CD = A.AUD_STEP_CD
		AND B.DOC_ID = A.DOC_ID
		AND B.APVR_CD = A.APVR_CD
		AND B.AFF_SNO = A.AFF_SNO
		AND B.DSP_RQ_CD IN ('410', '210', '620', '623')) AS CNDIDT_VIEW_YN
		FROM TBBADDED145M A
		WHERE A.AUD_YR = #{audYr}
		<if test='audNo != null and audNo != ""'>
			AND A.AUD_NO = #{audNo}
		</if>
		<if test='audStepCd != null and audStepCd != ""'>
			AND A.AUD_STEP_CD = #{audStepCd}
		</if>
		AND A.APVR_CD = #{apvrCd}
		AND A.DOC_ID = #{docId}
		<!-- <if test='apvrCd != null and apvrCd != ""'> -->
		<!-- AND A.APVR_CD = (SELECT NVL(F_USR_INFO_BY_ID(#{apvrCd}, '4'), '0010200') 
			AS CD_NM FROM DUAL) -->
		<!-- </if> -->
		<if test='affSno != null and affSno != ""'>
			AND A.AFF_SNO = #{affSno}
		</if>
		ORDER BY A.SORT_SNO
	</select>

	<select id="selectSubList" parameterType="paramMap" resultType="egovMap">
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.selectSubList*/
        <![CDATA[
        SELECT A.AUD_YR /*감사년도 */
              ,A.AUD_NO /*감사순번*/
              ,A.SORT_SNO           /*정렬순번  */
              ,A.AUD_NO /*감사번호 */
              ,A.AUD_STEP_CD /*감사단계코드*/
              ,A.DOC_ID /*문서ID */
              ,A.APVR_CD /*결재자코드*/
              ,A.AFF_SNO /*사건순번 */
              ,A.DSP_RQ_SNO /*처분요구순번*/
              ,A.AUD_KND_CD /*감사종류코드 */
              ,A.AUD_GRN_NO /*감사부여번호 */
              ,CASE WHEN B.TITLE_NM IS NULL AND (SELECT COUNT(C.AFF_NO) 
			                                                    FROM TBBADDED147M C
												               WHERE A.AUD_YR = C.AUD_YR
												              	  AND A.AUD_NO = C.AUD_NO
												            	  AND A.AUD_STEP_CD = C.AUD_STEP_CD
												            	  AND A.DOC_ID = C.DOC_ID
												            	  AND A.APVR_CD = C.APVR_CD
												            	  AND A.AFF_SNO = C.AFF_SNO
												            	  AND A.DSP_RQ_SNO = C.DSP_RQ_SNO) != 0 THEN '처분요구 없음'
              		ELSE B.TITLE_NM
              	END 	AS TITLE_NM 		/*처분요구명*/ 
              ,B.TITLE_CD
              ,A.ACCN_INSP_CD
              ,A.RPRT_FILD_ID /*보고서필드ID */
              ,A.AFF_DSP_CD /*사건처분코드 */
              ,A.RLTN_ORG_CD /*관계기관코드 (대상기관)*/
              ,A.HND_ORG_CD /*조치기관코드 */
              ,A.REF_ORG_CD /*참조기관코드 */
              ,F_ORG_INFO(RLTN_ORG_CD, '1') AS RLTN_ORG_NM /*관계기관코드명*/
              ,F_ORG_INFO(HND_ORG_CD, '1') AS HND_ORG_NM /*조치기관코드명*/
              ,F_ORG_INFO(REF_ORG_CD, '1') AS REF_ORG_NM /*참조기관코드명*/
              ,A.DSP_RQ_CD /*처분요구코드 */
              ,A.NOP_AM_DVSN_CD /*인원금액구분코드*/
              ,A.NOP_AM /*인원 */
              ,A.NOP_SUM /*금액 */
              ,F_CODE_NM('1000002', A.DSP_RQ_CD) AS DSP_RQ_NM  /*처분요구코드명 */
              ,F_CODE_NM('1000784', A.NOP_AM_DVSN_CD) AS NOP_AM_DVSN_NM /*인원금액구분코드명*/
              ,A.KYWD1 /*키워드1*/
              ,A.KYWD2 /*키워드2*/
              ,A.KYWD3 /*키워드3*/
              ,A.KYWD4 /*키워드4*/
              ,A.KYWD5 /*키워드5*/
              ,CASE WHEN B.TITLE_NM IS NULL AND (SELECT COUNT(C.AFF_NO) 
			                                                   FROM TBBADDED147M C
												              WHERE A.AUD_YR = C.AUD_YR
												            	AND A.AUD_NO = C.AUD_NO
												            	AND A.AUD_STEP_CD = C.AUD_STEP_CD
												            	AND A.DOC_ID = C.DOC_ID
												            	AND A.APVR_CD = C.APVR_CD
												            	AND A.AFF_SNO = C.AFF_SNO
												            	AND A.DSP_RQ_SNO = C.DSP_RQ_SNO) != 0 THEN 'Y'
             		  ELSE 'N'
               END AS NEW_YN 		/*신규입건여부*/    
              ,(SELECT COUNT(ST.CNDIDAT_SRNO) 
                 FROM TBBADDED146D ST 
                WHERE ST.AUD_YR = A.AUD_YR 
                  AND ST.AUD_NO = A.AUD_NO 
                  AND ST.AUD_STEP_CD = A.AUD_STEP_CD 
                  AND ST.DOC_ID = A.DOC_ID
                  AND ST.APVR_CD = A.APVR_CD
                  AND ST.AFF_SNO = A.AFF_SNO
                  AND ST.DSP_RQ_SNO = A.DSP_RQ_SNO) AS CNDIDAT_CNT
              ,(SELECT COUNT(DISTINCT F_MNG_KND_AUDYRNO(ST2.AUD_YR, ST2.AUD_NO, ST3.AUD_KND_CD, '-'))
		            FROM TBBADDED146D ST
		      INNER JOIN TBBADDED146D ST2 ON (ST2.CNDIDT_NM = ST.CNDIDT_NM AND ST2.CNDIDT_YMD = ST.CNDIDT_YMD)
		      INNER JOIN TBBADDED001M ST3 ON (ST3.AUD_YR = ST2.AUD_YR AND ST3.AUD_NO = ST2.AUD_NO)
		      INNER JOIN TBBADDED146M ST4 ON (ST4.AUD_YR = ST2.AUD_YR AND ST4.AUD_NO = ST2.AUD_NO AND ST4.AUD_STEP_CD = ST2.AUD_STEP_CD AND ST4.DOC_ID = ST2.DOC_ID AND ST4.APVR_CD = ST2.APVR_CD AND ST4.AFF_SNO = ST2.AFF_SNO AND ST4.DSP_RQ_SNO = ST2.DSP_RQ_SNO)
		           WHERE ST.AUD_YR = A.AUD_YR
		             AND ST.AUD_NO = A.AUD_NO
		             AND ST.AUD_STEP_CD = A.AUD_STEP_CD
		             AND ST.DOC_ID = A.DOC_ID
		             AND ST.APVR_CD = A.APVR_CD
		             AND ST.AFF_SNO = A.AFF_SNO
		             AND ST.DSP_RQ_SNO = A.DSP_RQ_SNO
		             AND NOT(ST2.AUD_YR = A.AUD_YR AND ST2.AUD_NO = A.AUD_NO)
		          ) AS REL_AUD_CNT
		      , CASE WHEN A.DSP_RQ_CD IN ('410', '210', '620', '623') THEN 'Y'
		             ELSE 'N' END AS CNDIDAT_VIEW_YN
              FROM TBBADDED146M A
              ]]>
		LEFT OUTER JOIN (SELECT AA.AUD_YR
		, AA.AUD_NO
		, AA.AUD_STEP_CD
		, AA.AFF_SNO
		, AA.DSP_RQ_SNO
		, AGGR_CONCAT(CC.TITLE_NM, '^c') AS TITLE_NM
		, AGGR_CONCAT(BB.DSP_RQ_SNO, '^c') AS TITLE_CD
		FROM (SELECT T1.AUD_YR, T1.AUD_NO, T1.AUD_STEP_CD, T1.APVR_CD, T1.AFF_SNO,
		T1.DSP_RQ_SNO, T1.PRE_AFF_NO
		FROM TBBADDED147M T1
		WHERE T1.AUD_YR = #{audYr}
		AND T1.AUD_NO = #{audNo}
		AND T1.AUD_STEP_CD = #{audStepCd}
		<if test='preAudStepCd != "A1050"'>
			AND T1.DOC_ID = #{docId}
		</if>
		AND T1.APVR_CD IN
		<foreach collection="nextApvrCd" item="item" index="index"
			separator="," open="(" close=")">
			#{item}
		</foreach>
		GROUP BY T1.AUD_YR, T1.AUD_NO, T1.AUD_STEP_CD, T1.APVR_CD, T1.AFF_SNO,
		T1.DSP_RQ_SNO, T1.PRE_AFF_NO ) AA
		,(SELECT T2.AUD_YR, T2.AUD_NO, T2.AUD_STEP_CD, T2.APVR_CD, T2.AFF_SNO,
		T2.DSP_RQ_SNO, T2.AFF_NO
		FROM TBBADDED147M T2
		WHERE T2.AUD_YR = #{audYr}
		AND T2.AUD_NO = #{audNo}
		AND T2.AUD_STEP_CD =#{preAudStepCd}
		<if test='preAudStepCd != "A1050"'>
			AND T2.DOC_ID = #{docId}
		</if>
		AND T2.APVR_CD IN
		<foreach collection="preApvrCd" item="item" index="index"
			separator="," open="(" close=")">
			#{item}
		</foreach>
		GROUP BY T2.AUD_YR, T2.AUD_NO, T2.AUD_STEP_CD, T2.APVR_CD, T2.AFF_SNO,
		T2.DSP_RQ_SNO, T2.AFF_NO ) BB
		, TBBADDED145M CC
		WHERE AA.AUD_YR = BB.AUD_YR
		AND AA.AUD_NO = BB.AUD_NO
		AND AA.PRE_AFF_NO = BB.AFF_NO
		AND BB.AUD_YR = CC.AUD_YR
		AND BB.AUD_NO = CC.AUD_NO
		AND BB.AFF_SNO = CC.AFF_SNO
		AND BB.APVR_CD = CC.APVR_CD
		GROUP BY AA.AUD_YR
		, AA.AUD_NO
		, AA.AUD_STEP_CD
		, AA.AFF_SNO
		, AA.DSP_RQ_SNO ) B
		ON A.AUD_YR = B.AUD_YR
		AND A.AUD_NO = B.AUD_NO
		AND A.AUD_STEP_CD = B.AUD_STEP_CD
		AND A.AFF_SNO = B.AFF_SNO
		AND A.DSP_RQ_SNO = B.DSP_RQ_SNO
		WHERE A.AUD_YR = #{audYr}
		AND A.AUD_NO = #{audNo}
		AND A.AUD_STEP_CD = #{audStepCd}
		AND A.APVR_CD = #{apvrCd}
		AND A.DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND A.AFF_SNO = #{affSno}
		</if>
		ORDER BY A.SORT_SNO
	</select>

	<select id="selectMaxListNo" parameterType="paramMap"
		resultType="egovMap">
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.searchListNo*/
		SELECT NVL(MAX(TO_NUMBER(LIST_NO)),0)+1 AS LIST_NO FROM TBBADDED145M A
		WHERE A.AUD_YR = #{audYr}
		<if test='audNo != null and audNo != ""'>
			AND A.AUD_NO = #{audNo}
		</if>
		<if test='audStepCd != null and audStepCd != ""'>
			AND A.AUD_STEP_CD = #{audStepCd}
		</if>
		AND A.APVR_CD = #{apvrCd}
		AND A.DOC_ID = #{docId}
		<!-- <if test='apvrCd != null and apvrCd != ""'> -->
		<!-- AND A.APVR_CD = (SELECT NVL(F_USR_INFO_BY_ID(#{apvrCd}, '4'), '0010200') 
			AS CD_NM FROM DUAL) -->
		<!-- </if> -->
	</select>

	<select id="selectMaxAffSno" parameterType="paramMap"
		resultType="egovMap">
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.selectMaxAffSno*/
		SELECT NVL(MAX(AFF_SNO),0)+1 AS AFF_SNO FROM TBBADDED145M A
		WHERE A.AUD_YR = #{audYr}
		AND A.AUD_NO = #{audNo}
	</select>

	<insert id="TBBADDED145MInsert" parameterType="paramMap">
		DECLARE
		BEGIN
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.TBBADDED145MInsert*/
		INSERT INTO TBBADDED145M
		(
		AUD_YR,
		AUD_NO,
		AUD_STEP_CD,
		DOC_ID,
		APVR_CD,
		AFF_SNO,
		AUD_KND_CD,
		AUD_GRN_NO,
		RPRT_FILD_ID,
		AFF_CD,
		LIST_NO,
		REFER_DVSN_CD,
		AFF_SPH,
		TITLE_NM,
		DP_TITLE_NM,
		QST_DOC_ISUE_YN,
		QST_DOC_ISUE_DY,
		AUDTOR,
		DETL_DOC_NO,
		MTRL_IPT_DVSN_CD,
		SYT_TRTM_DVSN_YN,
		SCRT_YN,
		SORT_SNO,
		TRTM_EXAMER_CNB,
		FNL_YN,
		FRT_USR_ID,
		FNL_USR_ID,
		FNL_DEAL_DPT_CD,
		FNL_MNU_ID,
		FRT_REGI_DH,
		FNL_MDF_DH
		)
		VALUES
		(
		#{audYr},
		#{audNo},
		#{audStepCd},
		#{docId},
		#{apvrCd},
		#{affSno},
		#{audKndCd},
		#{audGrnNo},
		'',
		'00',
		(SELECT NVL(MAX(LIST_NO+0),0)+1
		FROM TBBADDED145M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND AUD_STEP_CD = #{apvrCd}
		),
		#{referDvsnCd},
		#{affSph},
		#{titleNm},
		#{titleNm},
		#{qstDocIsueYn},
		#{qstDocIsueDy},
		#{audtor},
		#{detlDocNo},
		'20',
		#{sytTrtmDvsnYn},
		#{scrtYn},
		(SELECT NVL(MAX(SORT_SNO),0)+1
		FROM TBBADDED145M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		)
		,#{trtmExamerCnb}
		,'N'
		,#{frtUsrId} /*최초사용자id */
		,#{fnlUsrId} /*최종사용자id */
		,#{fnlDealDptCd} /*최종거래부서코드 */
		,#{fnlMnuId} /*최종메뉴id */
		,SYSDATE /*최초등록일시 */
		,SYSDATE /*최종수정일시 */
		)
		;
		INSERT INTO TBBADDED145H
		(
		HST_DVSN_CD
		, HST_SNO
		, HST_DH
		, HST_USR_ID
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_CD
		, LIST_NO
		, REFER_DVSN_CD
		, AFF_SPH
		, TITLE_NM
		, DP_TITLE_NM
		, QST_DOC_ISUE_YN
		, QST_DOC_ISUE_DY
		, AUDTOR
		, DETL_DOC_NO
		, MTRL_IPT_DVSN_CD
		, SYT_TRTM_DVSN_YN
		, SCRT_YN
		, SORT_SNO
		, TRTM_EXAMER_CNB
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, REF_DOC_ID
		)
		SELECT 'C'
		, TBBADDED145H_SEQ.NEXTVAL
		, SYSDATE
		, #{frtUsrId}
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_CD
		, LIST_NO
		, REFER_DVSN_CD
		, AFF_SPH
		, TITLE_NM
		, DP_TITLE_NM
		, QST_DOC_ISUE_YN
		, QST_DOC_ISUE_DY
		, AUDTOR
		, DETL_DOC_NO
		, MTRL_IPT_DVSN_CD
		, SYT_TRTM_DVSN_YN
		, SCRT_YN
		, SORT_SNO
		, TRTM_EXAMER_CNB
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, REF_DOC_ID
		FROM TBBADDED145M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND AFF_SNO = #{affSno}
		;
		END;
	</insert>

	<update id="TBBADDED145MUpdate" parameterType="paramMap">
		DECLARE
		BEGIN
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.TBBADDED145MUpdate*/
		UPDATE TBBADDED145M
		SET
		FNL_USR_ID = #{fnlUsrId} /*최종사용자ID */
		,FNL_DEAL_DPT_CD = #{fnlDealDptCd} /*최종거래부서코드 */
		,FNL_MNU_ID = #{fnlMnuId} /*최종메뉴ID */
		,FNL_MDF_DH = SYSDATE /*최종수정일시 */
		<if test='referDvsnCd != null and referDvsnCd != ""'>
			,REFER_DVSN_CD =#{referDvsnCd}/*부의구분코드 */
		</if>
		<if test='titleNm != null and titleNm != ""'>
			,TITLE_NM =#{titleNm}/*제목명 */
		</if>
		<if test='qstDocIsueYn != null and qstDocIsueYn != ""'>
			,QST_DOC_ISUE_YN =#{qstDocIsueYn}/*질문서발부여부 */
		</if>
		<if test='sortSno != null and sortSno != ""'>
			,SORT_SNO = #{sortSno} /*정렬순번 */
		</if>
		<if test='listNo != null and listNo != ""'>
			,LIST_NO = #{listNo} /*일람표일련번호 */
		</if>

		<if test='sortSno == null or sortSno == ""'>
			,SORT_SNO = NULL /*정렬순번 */
		</if>
		<if test='listNo == null or listNo == ""'>
			,LIST_NO = NULL /*일람표일련번호 */
		</if>
		WHERE 1=1
		<if test='audYr != null and audYr != ""'>
			AND AUD_YR = #{audYr}
		</if>
		<if test='audNo != null and audNo != ""'>
			AND AUD_NO = #{audNo}
		</if>
		<if test='audStepCd != null and audStepCd != ""'>
			AND AUD_STEP_CD = #{audStepCd}
		</if>
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND AFF_SNO = #{affSno}
		</if>
		;
		INSERT INTO TBBADDED145H
		(
		HST_DVSN_CD
		, HST_SNO
		, HST_DH
		, HST_USR_ID
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_CD
		, LIST_NO
		, REFER_DVSN_CD
		, AFF_SPH
		, TITLE_NM
		, DP_TITLE_NM
		, QST_DOC_ISUE_YN
		, QST_DOC_ISUE_DY
		, AUDTOR
		, DETL_DOC_NO
		, MTRL_IPT_DVSN_CD
		, SYT_TRTM_DVSN_YN
		, SCRT_YN
		, SORT_SNO
		, TRTM_EXAMER_CNB
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, REF_DOC_ID
		)
		SELECT 'U'
		, TBBADDED145H_SEQ.NEXTVAL
		, SYSDATE
		, #{fnlUsrId}
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_CD
		, LIST_NO
		, REFER_DVSN_CD
		, AFF_SPH
		, TITLE_NM
		, DP_TITLE_NM
		, QST_DOC_ISUE_YN
		, QST_DOC_ISUE_DY
		, AUDTOR
		, DETL_DOC_NO
		, MTRL_IPT_DVSN_CD
		, SYT_TRTM_DVSN_YN
		, SCRT_YN
		, SORT_SNO
		, TRTM_EXAMER_CNB
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, REF_DOC_ID
		FROM TBBADDED145M
		WHERE 1=1
		<if test='audYr != null and audYr != ""'>
			AND AUD_YR = #{audYr}
		</if>
		<if test='audNo != null and audNo != ""'>
			AND AUD_NO = #{audNo}
		</if>
		<if test='audStepCd != null and audStepCd != ""'>
			AND AUD_STEP_CD = #{audStepCd}
		</if>
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND AFF_SNO = #{affSno}
		</if>
		;
		END;
	</update>

	<select id="selectMaxDspRqSno" parameterType="paramMap"
		resultType="egovMap">
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.selectMaxDspRqSno*/
		/*처분요구순번 MAX*/
		SELECT NVL(MAX(DSP_RQ_SNO),0)+1 AS DSP_RQ_SNO
		FROM TBBADDED146M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
	</select>

	<select id="select145MMaxSortSno" parameterType="paramMap"
		resultType="egovMap">
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.select145MMaxSortSno*/
		/*정렬순번 MAX*/
		SELECT NVL(MAX(SORT_SNO),0)+1 AS SORT_SNO
		FROM TBBADDED145M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
	</select>

	<select id="select146MMaxSortSno" parameterType="paramMap"
		resultType="egovMap">
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.select146MMaxSortSno*/
		/*정렬순번 MAX*/
		SELECT NVL(MAX(SORT_SNO),0)+1 AS SORT_SNO
		FROM TBBADDED146M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		AND AFF_SNO = #{affSno}
	</select>

	<insert id="TBBADDED146MInsert" parameterType="paramMap">
		DECLARE
		BEGIN
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.TBBADDED146MInsert*/
		INSERT INTO TBBADDED146M
		(
		AUD_YR,
		AUD_NO,
		AUD_STEP_CD,
		DOC_ID,
		APVR_CD,
		AFF_SNO,
		DSP_RQ_SNO,
		DP_DSP_RQ_SNO,
		AUD_KND_CD,
		AUD_GRN_NO,
		RPRT_FILD_ID,
		AFF_DSP_CD,
		RLTN_ORG_CD,
		HND_ORG_CD,
		ACCN_INSP_CD,
		REF_ORG_CD,
		DSP_RQ_CD,
		MTRL_IPT_DVSN_CD,
		NOP_AM_DVSN_CD,
		NOP_AM,
		NOP_SUM,
		SORT_SNO,
		FNL_YN,
		KYWD1,
		KYWD2,
		KYWD3,
		KYWD4,
		KYWD5,
		FRT_USR_ID,
		FNL_USR_ID,
		FNL_DEAL_DPT_CD,
		FNL_MNU_ID,
		FRT_REGI_DH,
		FNL_MDF_DH
		)
		VALUES
		(
		#{audYr},
		#{audNo},
		#{audStepCd},
		#{docId},
		#{apvrCd},
		#{affSno},
		#{dspRqSno},
		#{dspRqSno},
		#{audKndCd},
		#{audGrnNo},
		(SELECT NVL(MAX(RPRT_FILD_ID),'')
		FROM TBBADDED145M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND AFF_SNO = #{affSno}
		),
		'00',
		#{rltnOrgCd},
		#{hndOrgCd},
		#{accnInspCd},
		#{refOrgCd},
		#{dspRqCd},
		'20',
		#{nopAmDvsnCd},
		#{nopAm},
		#{nopSum},
		(SELECT NVL(MAX(SORT_SNO),0)+1
		FROM TBBADDED146M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND AFF_SNO = #{affSno}
		)
		,'N'
		,REPLACE(#{kywd1}, ' ', '')
		,REPLACE(#{kywd2}, ' ', '')
		,REPLACE(#{kywd3}, ' ', '')
		,REPLACE(#{kywd4}, ' ', '')
		,REPLACE(#{kywd5}, ' ', '')
		,#{frtUsrId} /*최초사용자id */
		,#{fnlUsrId} /*최종사용자id */
		,#{fnlDealDptCd} /*최종거래부서코드 */
		,#{fnlMnuId} /*최종메뉴id */
		,SYSDATE /*최초등록일시 */
		,SYSDATE /*최종수정일시 */
		)
		;
		INSERT INTO TBBADDED146H
		(
		HST_DVSN_CD
		, HST_SNO
		, HST_DH
		, HST_USR_ID
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, DSP_RQ_SNO
		, DP_DSP_RQ_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_DSP_CD
		, RLTN_ORG_CD
		, HND_ORG_CD
		, REF_ORG_CD
		, DSP_RQ_CD
		, MTRL_IPT_DVSN_CD
		, NOP_AM_DVSN_CD
		, NOP_AM
		, SORT_SNO
		, ACCN_INSP_CD
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, NOP_SUM
		, HD_AUD_STEP_CD
		, HD_DOC_ID
		, HD_APVR_CD
		, HD_AFF_SNO
		, HD_DSP_RQ_SNO
		, REF_DOC_ID
		, DF_AUD_STEP_CD
		, DF_DOC_ID
		, DF_APVR_CD
		, DF_AFF_SNO
		, DF_DSP_RQ_SNO
		, KYWD1
		, KYWD2
		, KYWD3
		, KYWD4
		, KYWD5
		)
		SELECT 'C'
		, TBBADDED146H_SEQ.NEXTVAL
		, SYSDATE
		, #{frtUsrId}
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, DSP_RQ_SNO
		, DP_DSP_RQ_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_DSP_CD
		, RLTN_ORG_CD
		, HND_ORG_CD
		, REF_ORG_CD
		, DSP_RQ_CD
		, MTRL_IPT_DVSN_CD
		, NOP_AM_DVSN_CD
		, NOP_AM
		, SORT_SNO
		, ACCN_INSP_CD
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, NOP_SUM
		, HD_AUD_STEP_CD
		, HD_DOC_ID
		, HD_APVR_CD
		, HD_AFF_SNO
		, HD_DSP_RQ_SNO
		, REF_DOC_ID
		, DF_AUD_STEP_CD
		, DF_DOC_ID
		, DF_APVR_CD
		, DF_AFF_SNO
		, DF_DSP_RQ_SNO
		, KYWD1
		, KYWD2
		, KYWD3
		, KYWD4
		, KYWD5
		FROM TBBADDED146M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND AFF_SNO = #{affSno}
		AND DSP_RQ_SNO = #{dspRqSno}
		;
		END;
	</insert>

	<update id="TBBADDED146MUpdate" parameterType="paramMap">
		DECLARE
		BEGIN
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.TBBADDED146MUpdate*/
		UPDATE TBBADDED146M
		SET
		FNL_USR_ID = #{fnlUsrId} /*최종사용자ID */
		,FNL_DEAL_DPT_CD = #{fnlDealDptCd} /*최종거래부서코드 */
		,FNL_MNU_ID = #{fnlMnuId} /*최종메뉴ID */
		,FNL_MDF_DH = SYSDATE /*최종수정일시 */
		<if test='rltnOrgCd != null and rltnOrgCd != ""'>
			,RLTN_ORG_CD = #{rltnOrgCd}/*관계기관코드 */
		</if>
		<if test='hndOrgCd != null and hndOrgCd != ""'>
			,HND_ORG_CD = #{hndOrgCd}/*조치기관코드 */
		</if>
		<if test='accnInspCd != null and accnInspCd != ""'>
			,ACCN_INSP_CD = #{accnInspCd} /*회계감찰코드 */
		</if>
		<if test='refOrgCd != null and refOrgCd != ""'>
			,REF_ORG_CD = #{refOrgCd}/*참조기관코드 */
		</if>
		<if test='dspRqCd != null and dspRqCd != ""'>
			,DSP_RQ_CD = #{dspRqCd}/*처분요구코드 */
		</if>
		,NOP_AM_DVSN_CD = #{nopAmDvsnCd}/*인원금액구분코드 */
		,NOP_AM = #{nopAm}/*인원수 */
		,NOP_SUM = #{nopSum}/*금액 */
		<if test='sortSno != null and sortSno != ""'>
			,SORT_SNO = #{sortSno} /*정렬순번 */
		</if>
		<if test='sortSno == null or sortSno == ""'>
			,SORT_SNO = NULL /*정렬순번 */
		</if>
		<if test='kywd1 != null and kywd1 != ""'>
			,KYWD1 = REPLACE(#{kywd1}, ' ', '')/*키워드1*/
		</if>
		<if test='kywd2 != null and kywd2 != ""'>
			,KYWD2 = REPLACE(#{kywd2}, ' ', '')/*키워드2*/
		</if>
		<if test='kywd3 != null and kywd3 != ""'>
			,KYWD3 = REPLACE(#{kywd3}, ' ', '')/*키워드3*/
		</if>
		<if test='kywd4 != null and kywd4 != ""'>
			,KYWD4 = REPLACE(#{kywd4}, ' ', '')/*키워드4*/
		</if>
		<if test='kywd5 != null and kywd5 != ""'>
			,KYWD5 = REPLACE(#{kywd5}, ' ', '')/*키워드5*/
		</if>
		WHERE 1=1
		<if test='audYr != null and audYr != ""'>
			AND AUD_YR = #{audYr}
		</if>
		<if test='audNo != null and audNo != ""'>
			AND AUD_NO = #{audNo}
		</if>
		<if test='audStepCd != null and audStepCd != ""'>
			AND AUD_STEP_CD = #{audStepCd}
		</if>
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND AFF_SNO = #{affSno}
		</if>
		<if test='dspRqSno != null and dspRqSno != ""'>
			AND DSP_RQ_SNO = #{dspRqSno}
		</if>
		;
		INSERT INTO TBBADDED146H
		(
		HST_DVSN_CD
		, HST_SNO
		, HST_DH
		, HST_USR_ID
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, DSP_RQ_SNO
		, DP_DSP_RQ_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_DSP_CD
		, RLTN_ORG_CD
		, HND_ORG_CD
		, REF_ORG_CD
		, DSP_RQ_CD
		, MTRL_IPT_DVSN_CD
		, NOP_AM_DVSN_CD
		, NOP_AM
		, SORT_SNO
		, ACCN_INSP_CD
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, NOP_SUM
		, HD_AUD_STEP_CD
		, HD_DOC_ID
		, HD_APVR_CD
		, HD_AFF_SNO
		, HD_DSP_RQ_SNO
		, REF_DOC_ID
		, DF_AUD_STEP_CD
		, DF_DOC_ID
		, DF_APVR_CD
		, DF_AFF_SNO
		, DF_DSP_RQ_SNO
		, KYWD1
		, KYWD2
		, KYWD3
		, KYWD4
		, KYWD5
		)
		SELECT 'U'
		, TBBADDED146H_SEQ.NEXTVAL
		, SYSDATE
		, #{fnlUsrId}
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, DSP_RQ_SNO
		, DP_DSP_RQ_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_DSP_CD
		, RLTN_ORG_CD
		, HND_ORG_CD
		, REF_ORG_CD
		, DSP_RQ_CD
		, MTRL_IPT_DVSN_CD
		, NOP_AM_DVSN_CD
		, NOP_AM
		, SORT_SNO
		, ACCN_INSP_CD
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, NOP_SUM
		, HD_AUD_STEP_CD
		, HD_DOC_ID
		, HD_APVR_CD
		, HD_AFF_SNO
		, HD_DSP_RQ_SNO
		, REF_DOC_ID
		, DF_AUD_STEP_CD
		, DF_DOC_ID
		, DF_APVR_CD
		, DF_AFF_SNO
		, DF_DSP_RQ_SNO
		, KYWD1
		, KYWD2
		, KYWD3
		, KYWD4
		, KYWD5
		FROM TBBADDED146M
		WHERE 1=1
		<if test='audYr != null and audYr != ""'>
			AND AUD_YR = #{audYr}
		</if>
		<if test='audNo != null and audNo != ""'>
			AND AUD_NO = #{audNo}
		</if>
		<if test='audStepCd != null and audStepCd != ""'>
			AND AUD_STEP_CD = #{audStepCd}
		</if>
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND AFF_SNO = #{affSno}
		</if>
		<if test='dspRqSno != null and dspRqSno != ""'>
			AND DSP_RQ_SNO = #{dspRqSno}
		</if>
		;
		END;
	</update>

	<delete id="TBBADDED146MDelete" parameterType="paramMap">
		DECLARE
		BEGIN
		INSERT INTO TBBADDED146H
		(
		HST_DVSN_CD
		, HST_SNO
		, HST_DH
		, HST_USR_ID
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, DSP_RQ_SNO
		, DP_DSP_RQ_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_DSP_CD
		, RLTN_ORG_CD
		, HND_ORG_CD
		, REF_ORG_CD
		, DSP_RQ_CD
		, MTRL_IPT_DVSN_CD
		, NOP_AM_DVSN_CD
		, NOP_AM
		, SORT_SNO
		, ACCN_INSP_CD
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, NOP_SUM
		, HD_AUD_STEP_CD
		, HD_DOC_ID
		, HD_APVR_CD
		, HD_AFF_SNO
		, HD_DSP_RQ_SNO
		, REF_DOC_ID
		, DF_AUD_STEP_CD
		, DF_DOC_ID
		, DF_APVR_CD
		, DF_AFF_SNO
		, DF_DSP_RQ_SNO
		, KYWD1
		, KYWD2
		, KYWD3
		, KYWD4
		, KYWD5
		)
		SELECT 'D'
		, TBBADDED146H_SEQ.NEXTVAL
		, SYSDATE
		, #{frtUsrId}
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, DSP_RQ_SNO
		, DP_DSP_RQ_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_DSP_CD
		, RLTN_ORG_CD
		, HND_ORG_CD
		, REF_ORG_CD
		, DSP_RQ_CD
		, MTRL_IPT_DVSN_CD
		, NOP_AM_DVSN_CD
		, NOP_AM
		, SORT_SNO
		, ACCN_INSP_CD
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, NOP_SUM
		, HD_AUD_STEP_CD
		, HD_DOC_ID
		, HD_APVR_CD
		, HD_AFF_SNO
		, HD_DSP_RQ_SNO
		, REF_DOC_ID
		, DF_AUD_STEP_CD
		, DF_DOC_ID
		, DF_APVR_CD
		, DF_AFF_SNO
		, DF_DSP_RQ_SNO
		, KYWD1
		, KYWD2
		, KYWD3
		, KYWD4
		, KYWD5
		FROM TBBADDED146M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND AFF_SNO = #{affSno}
		</if>
		<if test='dspRqSno != null and dspRqSno != ""'>
			AND DSP_RQ_SNO = #{dspRqSno}
		</if>
		;
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.TBBADDED146MDelete*/
		DELETE
		FROM TBBADDED146M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND AFF_SNO = #{affSno}
		</if>
		<if test='dspRqSno != null and dspRqSno != ""'>
			AND DSP_RQ_SNO = #{dspRqSno}
		</if>
		;
		END;
	</delete>

	<delete id="TBBADDED145MDelete" parameterType="paramMap">
		DECLARE
		BEGIN
		INSERT INTO TBBADDED145H
		(
		HST_DVSN_CD
		, HST_SNO
		, HST_DH
		, HST_USR_ID
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_CD
		, LIST_NO
		, REFER_DVSN_CD
		, AFF_SPH
		, TITLE_NM
		, DP_TITLE_NM
		, QST_DOC_ISUE_YN
		, QST_DOC_ISUE_DY
		, AUDTOR
		, DETL_DOC_NO
		, MTRL_IPT_DVSN_CD
		, SYT_TRTM_DVSN_YN
		, SCRT_YN
		, SORT_SNO
		, TRTM_EXAMER_CNB
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, REF_DOC_ID
		)
		SELECT 'D'
		, TBBADDED145H_SEQ.NEXTVAL
		, SYSDATE
		, #{frtUsrId}
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, AUD_KND_CD
		, AUD_GRN_NO
		, RPRT_FILD_ID
		, AFF_CD
		, LIST_NO
		, REFER_DVSN_CD
		, AFF_SPH
		, TITLE_NM
		, DP_TITLE_NM
		, QST_DOC_ISUE_YN
		, QST_DOC_ISUE_DY
		, AUDTOR
		, DETL_DOC_NO
		, MTRL_IPT_DVSN_CD
		, SYT_TRTM_DVSN_YN
		, SCRT_YN
		, SORT_SNO
		, TRTM_EXAMER_CNB
		, FNL_YN
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, REF_DOC_ID
		FROM TBBADDED145M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND AFF_SNO = #{affSno}
		</if>
		;
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.TBBADDED145MDelete*/
		DELETE
		FROM TBBADDED145M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND AFF_SNO = #{affSno}
		</if>
		;
		END;
	</delete>

	<select id="checkAffSno" parameterType="paramMap" resultType="Integer">
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.checkAffSno*/
		SELECT COUNT(*) CNT FROM TBBADDED146M
		WHERE AUD_YR = #{audYr}
		<if test='audNo != null and audNo != ""'>
			AND AUD_NO = #{audNo}
		</if>
		<if test='audStepCd != null and audStepCd != ""'>
			AND AUD_STEP_CD = #{audStepCd}
		</if>
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND AFF_SNO = #{affSno}
		</if>
	</select>

	<select id="selectRprtComboList" parameterType="paramMap"
		resultType="egovMap">
		/* kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.selectRprtComboList */
		<if test='audStepCd != "A1070"'>
			SELECT RPRT_NM
			, ROWNUM-1 AS IDX
			, DOC_ID
			, APVR_PST_CD
			, '( ' ||F_CODE_NM('1000176', APVR_PST_CD) ||' 처분요구 목록 )' AS
			APVR_PST_NM
			, APV_STA_CD
			, AUD_RPRT_DVSN_CD
			FROM (
			SELECT T1.RPRT_NM
			, T1.DOC_ID
			, (
			CASE WHEN T2.APVR_PST_CD IS NULL AND T1.APV_STA_CD IN ('10', '20') THEN
			'0013600'
			ELSE T2.APVR_PST_CD
			END
			) AS APVR_PST_CD
			, T1.APV_STA_CD
			, T1.AUD_RPRT_DVSN_CD
			FROM TBBADDED103M T1
			LEFT OUTER JOIN (
			SELECT AUD_YR, AUD_NO, AUD_STEP_CD, DOC_ID, APVR_CD AS APVR_PST_CD
			FROM (SELECT DISTINCT AUD_YR,
			AUD_NO,
			AUD_STEP_CD,
			DOC_ID,
			APVR_CD,
			DECODE(APVR_CD, '0013600', 1, '0015800', 2, '0035100', 3, '0058100', 4, '0055600',
			5, '0045900', 6, '0055700', 7) AS APVR_LV
			FROM TBBADDED145M
			WHERE AUD_YR = #{audYr}
			AND AUD_NO = #{audNo} ) T1
			WHERE APVR_LV = (SELECT MAX(DECODE(APVR_CD, '0013600', 1, '0015800', 2,
			'0035100', 3, '0058100', 4, '0055600', 5, '0045900', 6, '0055700',
			7))
			FROM TBBADDED145M ST2
			WHERE ST2.AUD_YR = #{audYr}
			AND ST2.AUD_NO = #{audNo}
			AND ST2.DOC_ID = T1.DOC_ID)
			) T2
			ON (T2.AUD_YR = T1.AUD_YR
			AND T2.AUD_NO = T1.AUD_NO
			AND T2.AUD_STEP_CD = T1.AUD_STEP_CD
			AND T2.DOC_ID = T1.DOC_ID)
			WHERE T1.AUD_YR = #{audYr}
			AND T1.AUD_NO = #{audNo}
			AND T1.AUD_STEP_CD = #{audStepCd}
			AND T1.RPRT_CD IN ( 'A10600200', 'A10601100', 'A10601300', 'A10601320',
			'A10601330', 'A10601340' )
			ORDER BY T1.AUD_RPRT_DVSN_CD DESC )
			WHERE APVR_PST_CD IS NOT NULL
		</if>
		<if test='audStepCd == "A1070" and apvrCd == "0010600"'>
			SELECT RPRT_NM
			, ROWNUM-1 AS IDX
			, DOC_ID
			, APVR_PST_CD
			, APV_SNO
			, '( 주심위원 처분요구 목록 )' AS APVR_PST_NM
			, APV_STA_CD
			FROM (
			SELECT T1.RPRT_NM
			, T1.DOC_ID
			, '0010600' AS APVR_PST_CD
			, '' AS APV_SNO
			, (SELECT APV_STA_CD
			FROM TBBADDED103M ST1
			WHERE ST1.AUD_YR = T1.AUD_YR
			AND ST1.AUD_NO = T1.AUD_NO
			AND ST1.REF_ID = T1.DOC_ID
			AND ST1.RPRT_CD = 'A10700100') AS APV_STA_CD /* 주심위원 설명자료 결재코드로 결재완료여부
			판단 */
			, T1.AUD_RPRT_DVSN_CD
			FROM TBBADDED103M T1
			WHERE T1.AUD_YR = #{audYr}
			AND T1.AUD_NO = #{audNo}
			AND T1.AUD_STEP_CD = 'A1060'
			AND T1.RPRT_CD = 'A10600200'
			AND T1.APV_STA_CD = '30'
			ORDER BY T1.AUD_RPRT_DVSN_CD DESC )
		</if>
		<if test='audStepCd == "A1070" and apvrCd == "A107001"'>
			SELECT RPRT_NM
			, ROWNUM-1 AS IDX
			, DOC_ID
			, APVR_PST_CD
			, APV_SNO
			, '( 부의 처분요구 목록 )' AS APVR_PST_NM
			, APV_STA_CD
			FROM (
			SELECT
			(SELECT ST1.RPRT_NM
			FROM TBBADDED103M ST1
			WHERE ST1.AUD_YR = T1.AUD_YR
			AND ST1.AUD_NO = T1.AUD_NO
			AND ST1.DOC_ID = T1.REF_ID
			AND ST1.AUD_STEP_CD = 'A1060'
			AND ST1.RPRT_CD = 'A10600200') AS RPRT_NM /* 감사보고서명 */
			, T1.REF_ID AS DOC_ID /* 감사보고서 DOC_ID */
			, 'A1070' AS APVR_PST_CD
			, '' AS APV_SNO
			, (SELECT MAX(APV_STA_CD)
			FROM TBBADDED103M ST1
			WHERE ST1.AUD_YR = T1.AUD_YR
			AND ST1.AUD_NO = T1.AUD_NO
			AND ST1.AUD_STEP_CD = 'A1070'
			AND ST1.REF_ID = T1.REF_ID
			AND ST1.RPRT_CD = 'A10600200') AS APV_STA_CD /* 최종감사보고서 결재코드 */
			, T1.AUD_RPRT_DVSN_CD
			FROM TBBADDED103M T1
			WHERE T1.AUD_YR = #{audYr}
			AND T1.AUD_NO = #{audNo}
			AND T1.AUD_STEP_CD = 'A1070'
			AND T1.RPRT_CD = 'A10700100' /* 주심위원 설명자료 */
			AND T1.APV_STA_CD = '30'
			ORDER BY T1.AUD_RPRT_DVSN_CD DESC )
		</if>
		<if test='audStepCd == "A1070" and apvrCd == "A1070"'>
			SELECT RPRT_NM
			, ROWNUM-1 AS IDX
			, DOC_ID
			, APVR_PST_CD
			, APV_SNO
			, '( 부의 처분요구 목록 )' AS APVR_PST_NM
			, APV_STA_CD
			FROM (
			SELECT
			(SELECT ST1.RPRT_NM
			FROM TBBADDED103M ST1
			WHERE ST1.AUD_YR = T1.AUD_YR
			AND ST1.AUD_NO = T1.AUD_NO
			AND ST1.DOC_ID = T1.REF_ID
			AND ST1.AUD_STEP_CD = 'A1060'
			AND ST1.RPRT_CD = 'A10600200') AS RPRT_NM /* 감사보고서명 */
			, T1.REF_ID AS DOC_ID /* 감사보고서 DOC_ID */
			, 'A1070' AS APVR_PST_CD
			, '' AS APV_SNO
			, (SELECT MAX(APV_STA_CD)
			FROM TBBADDED103M ST1
			WHERE ST1.AUD_YR = T1.AUD_YR
			AND ST1.AUD_NO = T1.AUD_NO
			AND ST1.AUD_STEP_CD = 'A1070'
			AND ST1.REF_ID = T1.REF_ID
			AND ST1.RPRT_CD = 'A10600200') AS APV_STA_CD /* 최종감사보고서 결재코드 */
			, T1.AUD_RPRT_DVSN_CD
			FROM TBBADDED103M T1
			WHERE T1.AUD_YR = #{audYr}
			AND T1.AUD_NO = #{audNo}
			AND T1.AUD_STEP_CD = 'A1070'
			AND T1.RPRT_CD = 'A10700100' /* 주심위원 설명자료 */
			AND T1.APV_STA_CD = '30'
			ORDER BY T1.AUD_RPRT_DVSN_CD DESC )
		</if>
	</select>

	<select id="selectAffComboList" parameterType="paramMap"
		resultType="egovMap">
    <![CDATA[
        /* kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.selectAffComboList */
          SELECT T1.APVR_CD AS CD
                 , CASE
				 	WHEN T1.APVR_CD = 'A107001'
				 		THEN
				 			'부의 처분요구정보' 
				 	WHEN T1.APVR_CD = 'A1070'
				 		THEN
				 			'부의결과 처분요구정보' 
					 	ELSE F_CODE_NM('1000176', T1.APVR_CD)||'결재시 처분요구정보'
				  END CD_NM 
            FROM TBBADDED145M T1
           WHERE T1.AUD_YR = #{audYr}
             AND T1.AUD_NO = #{audNo}
             AND T1.DOC_ID = #{docId}             
             AND T1.AUD_STEP_CD = #{audStepCd}
             AND T1.APVR_CD <> '0010200'
             AND T1.APVR_CD <> '0010600'
        GROUP BY T1.APVR_CD
        ORDER BY 
        		CASE 
        			WHEN T1.APVR_CD IN ('0013600','0057400','0035400') THEN 0
        			WHEN T1.APVR_CD IN ('0015800','0035100','0058100','0013900') THEN 1
        			WHEN T1.APVR_CD IN ('0055600','0045900') THEN 2
        			WHEN T1.APVR_CD = '0055700' THEN 3
        			WHEN T1.APVR_CD = 'A107001' THEN 4
	       			WHEN T1.APVR_CD = 'A1070' THEN 5
        		END 
        ]]>
	</select>

	<select id="selectMppYn" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.selectMppYn */
		SELECT DECODE(COUNT(*),0,'N','Y') AS MPP_YN
		FROM TBBADDED147M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != "" and affSno != "null"'>
			AND AFF_SNO IN
			<foreach collection="affSno" item="item" index="index"
				separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
		<if test='dspRqSno != null and dspRqSno != "" and dspRqSno != "null"'>
			AND DSP_RQ_SNO IN
			<foreach collection="dspRqSno" item="item" index="index"
				separator="," open="(" close=")">
				#{item}
			</foreach>
		</if>
	</select>

	<insert id="TBBADDED147MDelete" parameterType="paramMap">
		DECLARE
		BEGIN
		INSERT INTO TBBADDED147H
		(
		HST_DVSN_CD
		, HST_SNO
		, HST_DH
		, HST_USR_ID
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, APVR_CD
		, AUD_KND_CD
		, PRE_AFF_NO
		, AFF_NO
		, AFF_SNO
		, DSP_RQ_SNO
		, DOC_ID
		, MPP_SEQ
		, SORT_SNO
		, RPRT_FILD_ID
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		)
		SELECT 'D'
		, TBBADDED147H_SEQ.NEXTVAL
		, SYSDATE
		, #{frtUsrId}
		, AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, APVR_CD
		, AUD_KND_CD
		, PRE_AFF_NO
		, AFF_NO
		, AFF_SNO
		, DSP_RQ_SNO
		, DOC_ID
		, MPP_SEQ
		, SORT_SNO
		, RPRT_FILD_ID
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		FROM TBBADDED147M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		<if test='affSno != null and affSno!= ""'>
			AND AFF_SNO = #{affSno}
		</if>
		<if test='dspRqSno != null and dspRqSno != ""'>
			AND DSP_RQ_SNO = #{dspRqSno}
		</if>
		;
		/* kr.go.bai.eip.aep.evm.dao.AEPARP007PMapper.TBBADDED147MDelete */
		DELETE FROM TBBADDED147M
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		<if test='affSno != null and affSno!= ""'>
			AND AFF_SNO = #{affSno}
		</if>
		<if test='dspRqSno != null and dspRqSno != ""'>
			AND DSP_RQ_SNO = #{dspRqSno}
		</if>
		;
		END;
	</insert>



	<insert id="cndidtInsert" parameterType="paramMap">
		/* kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.cndidtInsert */
		INSERT INTO TBBADDED146D (
		AUD_YR
		, AUD_NO
		, AUD_STEP_CD
		, DOC_ID
		, APVR_CD
		, AFF_SNO
		, DSP_RQ_SNO
		, CNDIDAT_SRNO
		, CNDIDT_NM
		, CNDIDT_YMD
		, CNDIDT_RANK_CD
		, CNDIDT_ORG_CD
		, CNDIDT_DPT_NM
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH )
		(
		SELECT DISTINCT B.AUD_YR
		, B.AUD_NO
		, B.AUD_STEP_CD
		, B.DOC_ID
		, B.APVR_CD
		, B.AFF_SNO
		, B.DSP_RQ_SNO
		, (SELECT NVL(MAX(ST.CNDIDAT_SRNO),0)+1
		FROM TBBADDED146D ST
		WHERE ST.AUD_YR = B.AUD_YR
		AND ST.AUD_NO = B.AUD_NO
		AND ST.AUD_STEP_CD = B.AUD_STEP_CD
		AND ST.DOC_ID = B.DOC_ID
		AND ST.APVR_CD = B.APVR_CD
		AND ST.AFF_SNO = B.AFF_SNO
		AND ST.DSP_RQ_SNO = B.DSP_RQ_SNO) AS CNDIDAT_SRNO
		, C.CNDIDT_NM
		, C.CNDIDT_YMD
		, C.CNDIDT_RANK_CD
		, C.CNDIDT_ORG_CD
		, C.CNDIDT_DPT_NM
		, #{fnlUsrId}
		, #{fnlUsrId}
		, #{fnlDealDptCd}
		, #{fnlMnuId}
		, SYSDATE
		, SYSDATE
		FROM TBBADDED147M A
		INNER JOIN TBBADDED147M B ON (B.AUD_YR = A.AUD_YR AND B.AUD_NO = A.AUD_NO
		AND B.PRE_AFF_NO = A.AFF_NO)
		INNER JOIN TBBADDED146M E ON (E.AUD_YR = B.AUD_YR AND E.AUD_NO = B.AUD_NO
		AND E.AUD_STEP_CD = B.AUD_STEP_CD AND E.DOC_ID = B.DOC_ID AND
		E.APVR_CD = B.APVR_CD AND E.AFF_SNO = B.AFF_SNO AND E.DSP_RQ_SNO =
		B.DSP_RQ_SNO)
		INNER JOIN TBBADDED146D C ON (C.AUD_YR = A.AUD_YR AND C.AUD_NO = A.AUD_NO
		AND C.AUD_STEP_CD = A.AUD_STEP_CD AND C.DOC_ID = A.DOC_ID AND
		C.APVR_CD = A.APVR_CD AND C.AFF_SNO = A.AFF_SNO AND C.DSP_RQ_SNO =
		A.DSP_RQ_SNO)
		WHERE A.AUD_YR = #{audYr}
		AND A.AUD_NO = #{audNo}
		AND A.AUD_STEP_CD = (CASE WHEN #{apvrCd} IN
		('0013600','0057400','0035400') THEN 'A1050'
		WHEN #{apvrCd} IN ('0010600') THEN 'A1060'
		ELSE #{audStepCd} END)
		AND (CASE WHEN A.APVR_CD IN ('0013600','0057400','0035400') THEN
		'0013600'
		WHEN A.APVR_CD IN ('0015800','0035100','0058100','0013900') THEN '0015800'
		WHEN A.APVR_CD IN ('0055600','0045900') THEN '0055600'
		ELSE A.APVR_CD END) =
		(CASE WHEN #{apvrCd} IN ('0013600','0057400','0035400') THEN '0010200'
		WHEN #{apvrCd} IN ('0015800','0035100','0058100','0013900') THEN '0013600'
		WHEN #{apvrCd} IN ('0055600','0045900') THEN '0015800'
		WHEN #{apvrCd} IN ('0055700') THEN '0055600'
		WHEN #{apvrCd} IN ('0010600') THEN '0055700'
		WHEN #{apvrCd} IN ('A107001') THEN '0010600'
		WHEN #{apvrCd} IN ('A1070') THEN 'A107001' END)
		AND B.AUD_STEP_CD = #{audStepCd}
		AND B.DOC_ID = #{docId}
		AND B.APVR_CD = #{apvrCd}
		AND NOT EXISTS ( --중복제외
		SELECT 1
		FROM TBBADDED146D D
		WHERE D.AUD_YR = B.AUD_YR
		AND D.AUD_NO = B.AUD_NO
		AND D.AUD_STEP_CD = B.AUD_STEP_CD
		AND D.DOC_ID = B.DOC_ID
		AND D.APVR_CD = B.APVR_CD
		AND D.AFF_SNO = B.AFF_SNO
		AND D.DSP_RQ_SNO = B.DSP_RQ_SNO
		AND D.CNDIDT_NM = C.CNDIDT_NM
		AND D.CNDIDT_YMD = C.CNDIDT_YMD))
	</insert>

	<delete id="TBBADDED146DDelete" parameterType="paramMap">
		/*kr.go.bai.eip.aep.arp.dao.AEPARP007PMapper.TBBADDED146DDelete*/
		DELETE
		FROM TBBADDED146D
		WHERE AUD_YR = #{audYr}
		AND AUD_NO = #{audNo}
		AND AUD_STEP_CD = #{audStepCd}
		AND APVR_CD = #{apvrCd}
		AND DOC_ID = #{docId}
		<if test='affSno != null and affSno != ""'>
			AND AFF_SNO = #{affSno}
		</if>
		<if test='dspRqSno != null and dspRqSno != ""'>
			AND DSP_RQ_SNO = #{dspRqSno}
		</if>
	</delete>
</mapper>
