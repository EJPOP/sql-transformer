<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper">

	<select id="selectMainList" parameterType="paramMap" resultType="egovMap">
	/*kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper.selectMainList*/
		SELECT RULE_SRNO
		  	 , TO_CHAR(RULE_AMD_DATE, 'yyyy-MM-dd') 		AS RULE_AMD_DATE
		  	 , TO_CHAR(RULE_APC_STR_DH, 'yyyy-MM-dd') 	AS RULE_APC_STR_DH
		  	 , TO_CHAR(RULE_APC_END_DH, 'yyyy-MM-dd') 	AS RULE_APC_END_DH  
		  	 , GNR_HNDL_PLAN_EXTN_DCN
		  	 , RMK
		  FROM TBBADDED023B B
		 WHERE 1=1
		 <if test='schRuleApcStrDh != null and schRuleApcStrDh != ""'>
               AND RULE_APC_STR_DH &gt;= #{schRuleApcStrDh}
         </if>
		 <if test='schRuleApcEndDh != null and schRuleApcEndDh != ""'>
               AND RULE_APC_END_DH &lt;= #{schRuleApcEndDh}
         </if>
		 <if test='schRuleAmdStrDate != null and schRuleAmdStrDate != ""'>
               AND RULE_AMD_DATE &gt;= #{schRuleAmdStrDate}
         </if>
		 <if test='schRuleAmdSEndDate != null and schRuleAmdSEndDate != ""'>
               AND RULE_AMD_DATE &lt;= #{schRuleAmdSEndDate}
         </if>
	    ORDER BY RULE_SRNO DESC
    </select>
    
   <update id="updateHndlDdlnDate" parameterType="paramMap">
   /*kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper.updateHndlDdlnDate*/
		UPDATE TBBADDED023B
			SET RULE_APC_END_DH	= TO_DATE(#{ruleApcStrDh}) - 1
				, FNL_USR_ID				= #{fnlUsrId}
				, FNL_DEAL_DPT_CD		= #{fnlDealDptCd}
				, FNL_MNU_ID			= #{fnlMnuId}
				, FNL_MDF_DH 			= SYSDATE
		WHERE RULE_SRNO = (SELECT MAX(RULE_SRNO) FROM TBBADDED023B)
    </update>    
    
   <insert id="insertHndlDdlnList" parameterType="paramMap">
   /*kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper.insertHndlDdlnList*/
		INSERT INTO TBBADDED023B
			(
				RULE_SRNO
				,RULE_AMD_DATE
				,RULE_APC_STR_DH
				,RULE_APC_END_DH
				,GNR_HNDL_PLAN_EXTN_DCN  
				,RMK
				,FRT_USR_ID
				,FNL_USR_ID
				,FNL_DEAL_DPT_CD
				,FNL_MNU_ID
				,FRT_REGI_DH
				,FNL_MDF_DH 
			)
		VALUES
			(
				(SELECT MAX(RULE_SRNO +1) FROM TBBADDED023B)
				,#{ruleAmdDate}
				,#{ruleApcStrDh}
				,#{ruleApcEndDh}
				,#{gnrHndlPlanExtnDcn}
				,#{rmk}
				,#{frtUsrId}
				,#{fnlUsrId}
				,#{fnlDealDptCd}
				,#{fnlMnuId}
				,SYSDATE
				,SYSDATE
			)
    </insert>
 
   <insert id="insertHndlDdlnDetailList" parameterType="paramMap">
   /*kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper.insertHndlDdlnDetailList*/
		INSERT INTO TBBADDED024B
			(
				  RULE_SRNO
				, AUD_KND_CD
				, REQ_DVSN_CD
				, AUD_HNDL_STEP_SNO
				, DDLN_DCN
				, SAT_ICLS
				, SNDY_ICLS
				, HLDY_ICLS
				, TMP_HLDY_ICLS
				, SBST_HLDY_ICLS
				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
			)
		SELECT RULE_SRNO + 1
			 , AUD_KND_CD
			 , REQ_DVSN_CD
			 , AUD_HNDL_STEP_SNO
			 , DDLN_DCN
			 , SAT_ICLS
			 , SNDY_ICLS
			 , HLDY_ICLS
			 , TMP_HLDY_ICLS
			 , SBST_HLDY_ICLS  
			 , #{frtUsrId}
			 , #{fnlUsrId}
			 , #{fnlDealDptCd}
			 , #{fnlMnuId}
			 , SYSDATE
			 , SYSDATE     
		  FROM TBBADDED024B A
		 WHERE A.RULE_SRNO = (SELECT MAX(B.RULE_SRNO) FROM TBBADDED024B B)
    </insert>
    
   <insert id="insertHndlDdlnExlList" parameterType="paramMap">
   /*kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper.insertHndlDdlnExlList*/
		INSERT INTO TBBADDED025B
			(
				  RULE_SRNO
				, AUD_KND_CD
				, REQ_DVSN_CD
				, EXTN_SAT_ICLS
				, EXTN_SNDY_ICLS
				, EXTN_HLDY_ICLS
				, EXTN_TMP_HLDY_ICLS
				, EXTN_SBST_HLDY_ICLS
				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
			)
		SELECT RULE_SRNO + 1 AS RULE_SRNO
			 , AUD_KND_CD
			 , REQ_DVSN_CD
			 , EXTN_SAT_ICLS
			 , EXTN_SNDY_ICLS
			 , EXTN_HLDY_ICLS
			 , EXTN_TMP_HLDY_ICLS
			 , EXTN_SBST_HLDY_ICLS
			 , #{frtUsrId}
			 , #{fnlUsrId}
			 , #{fnlDealDptCd}
			 , #{fnlMnuId}
			 , SYSDATE
			 , SYSDATE     
		  FROM TBBADDED025B A
		 WHERE A.RULE_SRNO = (SELECT MAX(B.RULE_SRNO) FROM TBBADDED025B B)
    </insert>

   <update id="updateHndlDdlnList" parameterType="paramMap">
   /*kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper.updateHndlDdlnList*/
		UPDATE TBBADDED023B
			SET RULE_AMD_DATE 		= #{ruleAmdDate}
				, RULE_APC_STR_DH	= #{ruleApcStrDh}
				, RULE_APC_END_DH	= #{ruleApcEndDh}
				, GNR_HNDL_PLAN_EXTN_DCN = #{gnrHndlPlanExtnDcn}
				, RMK						= #{rmk}
				, FNL_USR_ID				= #{fnlUsrId}
				, FNL_DEAL_DPT_CD		= #{fnlDealDptCd}
				, FNL_MNU_ID			= #{fnlMnuId}
				, FNL_MDF_DH 			= SYSDATE
		WHERE RULE_SRNO = #{ruleSrno}
    </update>
    
	<select id="selectMaxRuleSrno" parameterType="paramMap" resultType="egovMap">
	/*kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper.selectMaxRuleSrno*/
		SELECT MAX(RULE_SRNO) AS RULE_SRNO
		 FROM TBBADDED023B B
    </select>    
    
    <delete id="deleteHndlDdlnList" parameterType="paramMap">
    /*kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper.deleteHndlDdlnList*/
		DELETE FROM TBBADDED023B
		WHERE RULE_SRNO = #{ruleSrno}
    </delete>
    
    <delete id="deleteHndlDdlnDetailList" parameterType="paramMap">
    /*kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper.deleteHndlDdlnDetailList*/
		DELETE FROM TBBADDED024B
		WHERE RULE_SRNO = #{ruleSrno}
    </delete>

    <delete id="deleteHndlDdlnExList" parameterType="paramMap">
    /*kr.go.bai.eip.aep.afu.dao.AEPAFU017QMapper.deleteHndlDdlnExList*/
		DELETE FROM TBBADDED025B
		WHERE RULE_SRNO = #{ruleSrno}
    </delete>        
</mapper> 