<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.aep.dre.dao.AEPDRE101PMapper">
	

	<!--성과금액 명세 출력   BADEAR003EReport1Select-->
	<select id="selectReport1" parameterType="paramMap" resultType="resultMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101PMapper.selectReport1 */
        <![CDATA[   
			SELECT Z.AUD_YR ,  /*감사년도*/
			       Z.AUD_NO ,  /*감사순번*/
			       MAX(Z.SPV_BRDV_CD)  AS SPV_BRDV_CD ,  /*부서코드*/
			       MAX(Z.EXEC_DPT_NM)  AS EXEC_DPT_NM,  /*부서명*/
			       MAX(Z.AUD_KND_CD)  AS AUD_KND_CD,  /*감사종류코드*/
			       MAX(Z.AUD_EXEC_DVSN_CD_NM)  AS AUD_EXEC_DVSN_CD_NM,  /*감사종류명*/
			       MAX(Z.AUD_SBJ_NM) AS AUD_SBJ_NM,  /*감사사항명*/
			       MAX(Z.AUD) AS AUD,  /*감사연번호*/
			       MAX(Z.AUD_RPST_ORG_CD) AS AUD_RPST_ORG_CD,  /*감사대상기관코드*/
			       MAX(Z.AUD_REP_ORG_NM) AS AUD_REP_ORG_NM,  /*감사대상기관명*/
			       SUM(Z.AM)AS AM ,  /*재정적성과금액*/
			       SUM(Z.MEASURES_AM) AS MEA_AM ,      /*조치금액 : 추징회수보전금액 + 환급금액 + 추급금액*/ 
			       SUM(Z.EXP_EFT_AM) AS EXP_EFT_AM ,   /*기대효과금액 : 예산절감금액 + 수입증대금액 + 재산증가금액 + 지출합리화금액 + 국민부담경감금액(극민편익)*/
			       SUM(Z.BGT_RDC_AM) AS BGT_RDC_AM ,    /*예산절감금액*/
			       SUM(Z.INC_ICR_AM) AS INC_ICR_AM ,    /*수입증대금액*/
			       SUM(Z.FRTN_INCR_AM) AS FRTN_INCR_AM , /*재산증가금액*/
			       SUM(Z.EXPN_RTNL_AM) AS EXPN_RTNL_AM , /*지출합리화금액*/
			       SUM(Z.PPL_BDN_RDT_AM) AS PPL_BDN_RDT_AM , /*국민부담경감금액(극민편익)*/
			       SUM(Z.EXPOT_Y_EFCT_AM) AS AFT_EFT_AM  /*사후적효과금액*/
			  FROM (SELECT A.AUD_YR ,
			               A.AUD_NO ,
			               A.DSP_RQ_SNO ,
			               C.SPV_BRDV_CD ,
			               F_DPT_INFO(C.SPV_BRDV_CD ,'1')  AS EXEC_DPT_NM ,
			               C.AUD_KND_CD,               
			               F_CODE_NM('1000007',C.AUD_KND_CD) AUD_EXEC_DVSN_CD_NM, /*감사종류명*/
			               C.AUD_SBJ_NM ,
			               F_MNG_KND_AUDYRNO(C.AUD_YR, C.AUD_NO, C.AUD_KND_CD, '-')  AS AUD ,
			               C.AUD_RPST_ORG_CD ,
			               F_ORG_CNT_NM_AUD(C.AUD_YR,C.AUD_NO,'AUD') AS AUD_REP_ORG_NM ,
			               (NVL(B.PNL_DRIN_PSVT_AM, 0) + NVL(B.RSR_AM, 0) + NVL(B.SPLP_AM, 0) + NVL(B.BGT_RDC_AM, 0) + NVL(B.INC_ICR_AM, 0) + NVL(B.PPL_BDN_RDT_AM, 0) + NVL(B.FRTN_INCR_AM, 0) + NVL(B.EXPN_RTNL_AM, 0) + NVL(B.EXPOT_Y_EFCT_AM, 0)) AS AM ,
			               (NVL(B.PNL_DRIN_PSVT_AM, 0) + NVL(B.RSR_AM, 0) + NVL(B.SPLP_AM, 0)) AS MEASURES_AM ,  /*추징회수보전금액 + 환급금액 + 추급금액 =조치금액*/
			               (NVL(B.BGT_RDC_AM, 0) + NVL(B.INC_ICR_AM, 0) + NVL(B.FRTN_INCR_AM, 0) + NVL(B.EXPN_RTNL_AM, 0) + NVL(B.PPL_BDN_RDT_AM, 0)) AS EXP_EFT_AM ,  /*기대효과금액*/
			               NVL(B.BGT_RDC_AM, 0) AS BGT_RDC_AM ,      /*예산절감금액*/
			               NVL(B.INC_ICR_AM, 0) AS INC_ICR_AM ,      /*수입증대금액*/
			               NVL(B.FRTN_INCR_AM, 0) AS FRTN_INCR_AM ,  /*재산증가금액*/
			               NVL(B.EXPN_RTNL_AM, 0) AS EXPN_RTNL_AM ,  /*지출합리화금액*/
			               NVL(B.PPL_BDN_RDT_AM, 0) AS PPL_BDN_RDT_AM ,  /*국민부담경감금액(극민편익)*/
			               NVL(B.EXPOT_Y_EFCT_AM, 0) AS EXPOT_Y_EFCT_AM  /*사후적효과금액*/
			          FROM TBBADEAR001M A ,
			               TBBADEAR002D B ,
			               TBBADDED001M C
			         WHERE 1 = 1
			           AND A.AUD_YR = B.AUD_YR
			           AND A.AUD_NO = B.AUD_NO
			           AND A.DSP_RQ_SNO = B.DSP_RQ_SNO
			           AND A.AUD_YR = C.AUD_YR
			           AND A.AUD_NO = C.AUD_NO
			           AND A.AUD_YR = #{audYr}  /*화면 인자값 감사년도*/
			           AND A.AUD_NO = #{audNo}   /*화면 인자값 감사순번*/
			     ) Z
			 GROUP BY Z.AUD_YR ,
			       Z.AUD_NO 
		]]>
	</select>	
	
	<!--성과금액 명세 출력  BADEAR003EReport21Select -->
	<select id="selectReport2" parameterType="paramMap" resultType="resultMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101PMapper.selectReport2 */
        <![CDATA[
				SELECT DISTINCT A.AUD_YR ,
				       A.AUD_NO ,
				       F_MNG_KND_AUDYRNO(C.AUD_YR, C.AUD_NO, C.AUD_KND_CD, '-')  AS AUD_NUM ,  /*감사연번호*/
				       C.AUD_SBJ_NM   							 /*감사사항명*/
				  FROM TBBADEAR001M A ,
				       TBBADEAR002D B ,
				       TBBADDED001M C
				 WHERE 1 = 1
				   AND A.AUD_YR = B.AUD_YR
				   AND A.AUD_NO = B.AUD_NO
				   AND A.DSP_RQ_SNO = B.DSP_RQ_SNO
				   AND A.AUD_YR = C.AUD_YR
				   AND A.AUD_NO = C.AUD_NO
				   AND A.AUD_YR = #{audYr}  /*화면 인자값 감사년도*/
				   AND A.AUD_NO = #{audNo}  /*화면 인자값 감사순번  */    
		]]>
	</select>
	
	<!--성과금액 명세 출력 BADEAR003EReport22Select-->
	<select id="selectReport22" parameterType="paramMap" resultType="resultMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101PMapper.selectReport22 */
        <![CDATA[ 
        
        		SELECT  D1.AUD_YR                                                                 AS AUD_YR
				      , D1.AUD_NO                                                                 AS AUD_NO
				      , D1.DSP_RQ_SNO                                                             AS DSP_RQ_SNO
			          , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, '', '-')                          AS AUD_NUM 
			          , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, '', '-') || '-' || D1.DSP_RQ_SNO  AS AUD 
				      , D2.DSP_RQ_KND_CD                                                          AS DSP_RQ_KND_CD
			          , F_CODE_NM('1000002', D2.DSP_RQ_KND_CD)                                    AS DISP_REQ_NM 
                      , D3.AUD_SBJ_NM                                                             AS AUD_SBJ_NM
                      , D2.TIT_TXT                                                                AS TIT_TXT 
				      , D1.TYPE                                                                   AS TYPE
				      , D1.AM                                                                     AS AM
				  FROM (
				            SELECT AUD_YR                                                                AS AUD_YR
							     , AUD_NO                                                                AS AUD_NO
							     , DSP_RQ_SNO                                                            AS DSP_RQ_SNO              
				                 , CASE WHEN EPT_EFCT_DVSN_CD = '1'      THEN '예산절감금액'
				                        WHEN EPT_EFCT_DVSN_CD = '2'      THEN '수입증대금액'
				                        WHEN EPT_EFCT_DVSN_CD = '3'      THEN '국민편익금액'
				                        WHEN EPT_EFCT_DVSN_CD = '4'      THEN '재산증가금액'
				                        WHEN EPT_EFCT_DVSN_CD = '5'      THEN '지출합리화금액'  
				                    END                                                                  AS TYPE                 
				                 ,NVL(EPT_EFCT_AM,0)                                                     AS AM
							  FROM TBBADEAR003M 
							 WHERE 1=1           
							   AND AUD_YR = #{audYr}
							   AND AUD_NO = #{audNo}
				               AND NVL(EPT_EFCT_AM,0) != 0
				               
				        UNION ALL                
				        
							SELECT AUD_YR                                                                AS AUD_YR
							     , AUD_NO                                                                AS AUD_NO
							     , DSP_RQ_SNO                                                            AS DSP_RQ_SNO              
				                 , '조치금액'                                                             AS TYPE                 
				                 ,NVL(PNL_DRIN_PSVT_AM, 0) + NVL(RSR_AM, 0) + NVL(SPLP_AM, 0)            AS AM
							  FROM TBBADEAR003M D1
							 WHERE 1=1            
							   AND AUD_YR = #{audYr}
							   AND AUD_NO = #{audNo}
				               AND (NVL(PNL_DRIN_PSVT_AM, 0) != 0  OR NVL(RSR_AM, 0) != 0  OR NVL(SPLP_AM, 0) != 0)
				               
				        UNION ALL                
				        
							SELECT AUD_YR                                                                AS AUD_YR
							     , AUD_NO                                                                AS AUD_NO
							     , DSP_RQ_SNO                                                            AS DSP_RQ_SNO            
				                 , '사후적효과금액'                                                        AS TYPE                 
				                 , NVL(EXPOT_Y_EFCT_AM, 0)                                               AS AM
							  FROM TBBADEAR003M D1
							 WHERE 1=1             
							   AND AUD_YR = #{audYr}
							   AND AUD_NO = #{audNo}
				               AND NVL(EXPOT_Y_EFCT_AM, 0) != 0               
				    ) D1
                  ,TBBADEAR001M D2
                  ,TBBADDED001M D3 
             WHERE D1.AUD_YR       = D2.AUD_YR
               AND D1.AUD_NO       = D2.AUD_NO
               AND D1.DSP_RQ_SNO   = D2.DSP_RQ_SNO
               AND D1.AUD_YR       = D3.AUD_YR
               AND D1.AUD_NO       = D3.AUD_NO   
		     ORDER BY D1.AUD_YR
			         ,D1.AUD_NO
			         ,D1.DSP_RQ_SNO
       
		]]>
	</select>
	
	<!-- 처분요구 시행 상세  BADEAR003EMainSelectPage -->
	<select id="selectDetail" parameterType="paramMap" resultType="egovMap" >
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectDetail */
        <![CDATA[       
			SELECT D1.AUD_YR                         AS AUD_YR                          /*감사년도*/
			     , D1.AUD_NO                         AS AUD_NO                          /*감사번호*/
			     , D3.AUD_GRN_NO                     AS AUD_GRN_NO                      /*감사부여번호 - 2016.05.31 yyh*/
			     , D1.AUD_YR||D1.AUD_NO              AS AUD_YR_NO   
			     , D3.SPV_BRDV_NM                    AS SPV_BRDV_NM                     /*주관국과명*/
			     , F_DPT_INFO(D3.SPV_BRDV_CD,'1')    AS SPV_BRDV_CD
			     , F_DPT_INFO(D3.MNG_DPT_CD,'1')     AS MNG_DPT_CD                      /*관리부서 - 2016.03.08 yyh*/
			     , D3.AUD_SBJ_NM                     AS AUD_SBJ_NM                      /*감사사항*/
			     , D3.AUD_ORG_CNT                    AS AUD_ORG_CNT                     /*기관명*/
			     , D1.DSP_RQ_SNO                     AS DSP_RQ_SNO                      /*처분요구순번*/
			     /* , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-') ||'-'|| D1.DSP_RQ_SNO  AS DSP_RQ_SNO_NM                   처분요구순번DISP */
			     , NVL2(D1.ACT_DSP_NM,D1.ACT_DSP_NM, F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-') ||'-'|| D1.DSP_RQ_SNO  )  AS DSP_RQ_SNO_NM                   /*처분요구순번DISP*/
			     
			     , CASE WHEN D1.AUD_YR >= '2016' 
			                 THEN SUBSTR(D3.AUD_KND_CD,3,1)
			            ELSE '' 
			        END                              AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.18 yyh*/				                                         
			     , D1.FRM_NO                         AS FRM_NO                          /*서식번호*/
			     , D1.RPRT_NO                        AS RPRT_NO                         /*보고서식번호*/
			     , D1.TIT_TXT                        AS TIT_TXT                         /*제목내용*/    
			     , D1.DSP_RQ_KND_CD                  AS DSP_RQ_KND_CD                   /*처분요구종류코드*/
			     , D1.ORG_DVSN_CD                    AS ORG_DVSN_CD                     /*기관구분코드*/
			     , D1.AUD_EPS_CD                     AS AUD_EPS_CD                      /*감사중점코드*/
			     , D2.DSP_RQ_SRNO                    AS DSP_RQ_SRNO                     /*처분요구일련번호*/
			     , TO_CHAR(TO_DATE(D2.ENF_DT),'YYYY-MM-DD')        AS ENF_DT            /*시행일*/
			     , TO_CHAR(TO_DATE(D2.HNDL_DDLN_DT),'YYYY-MM-DD')  AS HNDL_DDLN_DT      /*처리기한일*/
			     , D2.ENF_BRDV_CD                    AS ENF_BRDV_CD                     /*시행국과코드*/
			     , F_DPT_INFO(D2.ENF_BRDV_CD,'1')	 AS ENF_BRDV_NM                     /*시행국과명*/
			     , D2.DOC_SEN_NO                     AS DOC_SEN_NO                      /*문서발송코드*/
			     , D2.WRDO_CAU_CD                    AS WRDO_CAU_CD                     /*비위원인코드*/
			     , D2.ENFM_MNG_BRDV_CD               AS ENFM_MNG_BRDV_CD                /*집행관리국과코드*/    
			     , D2.DTM_YN                         AS DTM_YN                          /*확정여부*/
			     , D2.DTM_STA_CD                     AS DTM_STA_CD                      /*확정상태코드*/
			     , D2.HMP_OPEN_YN                    AS HMP_OPEN_YN                     /*홈페이지공개여부*/
			     , D2.DTY_OBV_UTL_YN                 AS DTY_OBV_UTL_YN                  /*직무관철활용여부*/
                 , D2.MAIN_ENFM_MNG_TG_YN                 AS MAIN_ENFM_MNG_TG_YN                  /*주요 이행관리대상*/
			     , CASE WHEN SUBSTR(D2.WRDO_TYP_CD,1,1) = '1' THEN '100000000'
			            WHEN SUBSTR(D2.WRDO_TYP_CD,1,1) = '2' THEN '200000000'    
			            ELSE ''
			         END                             AS WRDO_TYP_CD                     /*비위유형코드 - 수정 2016.05.11 yyh*/
			     , D2.DSP_RQ_APV_STA_CD              AS DSP_RQ_APV_STA_CD               /*처분요구결재상태코드*/
			     , D2.TSK_CAT_CD                     AS TSK_CAT_CD                      /*업무분류코드*/
			     , F_CODE_NM('1000121',D2.WRDO_TYP_CD) AS WRDO_TYP_NM                   /*비위유형코드명*/      
			     , F_CODE_NM('1000120',D2.TSK_CAT_CD)  AS TSK_CAT_NM                    /*업무분류명*/
			     , F_CODE_NM('1000002',D1.DSP_RQ_KND_CD )  AS DSP_RQ_KND_NM                    /*처분요구종류명*/
			     , F_CODE_NM('1000017',D2.DTM_STA_CD )  AS DTM_STA_NM                   /*결재상태명*/
			     , CASE WHEN NVL(D4.CNT,0)>0 THEN 'Y' ELSE 'N' END  AS FRE_CNT			/*집행전말입력여부*/
				 , D2.PSC_RQT_NOP_CNT													/*고발인원*/
			     , D2.NOP_CNT 															/*인원*/
			     , CASE WHEN D2.RLTN_ORG_CD IS NOT NULL THEN F_ORG_INFO(D2.RLTN_ORG_CD,'1')||'외 '||D5.CNT  ELSE '' END RLTN_ORG_NM /*관계기관*/
			     , CASE WHEN D2.COPT_OFI_CD IS NOT NULL THEN F_ORG_INFO(D2.COPT_OFI_CD,'1')|| DECODE(D7.CNT,0,'','외 '||D7.CNT) ELSE '' END COPT_OFI_NM /*소관청*/
			     , COPT_OFI_CD AS COPT_OFI_CD /* 추가 - 2016.04.28 yyh*/
			     
			     
			     
			     ,D2.RLTN_ORG_CD
                 ,F_ORG_INFO(D2.RLTN_ORG_CD,'1')  AS RLTN_ORG_NM
			     , F_ORG_INFO(D2.COPT_OFI_CD,'1') AS COPT_OFI_NM
			     , COPT_OFI_CD AS COPT_OFI_CD
			     
			     /* 처분요구사항실시내역 추가 - 2016.02.24 yyh */
			     , Z1.DVSN_CD                AS DVSN_CD    /* 구분코드 */
			     , Z1.TSK_KEY1               AS TSK_KEY1   /* 업무키1 */
			     , Z1.TSK_KEY2               AS TSK_KEY2   /* 업무키2 */
			     , Z1.TSK_KEY3               AS TSK_KEY3   /* 업무키3 */
			     , Z1.TSK_KEY4               AS TSK_KEY4   /* 업무키4 */
			     , CASE WHEN Z1.DVSN_CD IN ('1','2','3') THEN (SELECT S1.ACP_YR||'-'||F_CODE_NM('1000740',S1.REQ_DVSN_CD)||'-'||S1.RM_CVPT_ACP_NO
			     									  		     FROM TBCSPDCP101M S1
			      											    WHERE Z1.TSK_KEY1 = S1.ACP_YR
			      									  		      AND Z1.TSK_KEY2 = S1.REQ_DVSN_CD
			      											      AND Z1.TSK_KEY3 = S1.CVPT_ACP_NO)
			      												
			            WHEN Z1.DVSN_CD = '4'            THEN ''
			            WHEN Z1.DVSN_CD IN ('5','6','7') THEN (SELECT CASE WHEN S1.ACP_YR >= '2016' 
		 	                                                                 THEN S1.ACP_YR || '-' || DECODE(S1.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || S1.ACP_SRNO
		 	                                                            ELSE 
		 	                                                                      S1.ACP_YR || '-' || S1.ACP_DVSN_CD || '-' || S1.ACP_SRNO
		 	                                                             END
			                                                  FROM TBBADFRE012M S1 
			                                                 WHERE Z1.TSK_KEY1 = S1.ACP_YR   
			                                                   AND Z1.TSK_KEY2 = S1.ACP_DVSN_CD
			                                                   AND Z1.TSK_KEY3 = S1.ACP_SRNO
			                                                   AND Z1.TSK_KEY4 = S1.DPT_CD)
                        WHEN Z1.DVSN_CD IN ('8','9')     THEN (SELECT CASE WHEN S1.OGN_DVSN_CD = '6' 
					                                                                 THEN S1.YR||'-판청-'||S1.ACP_NO
					                                                            ELSE S1.YR||'-손망-'||S1.ACP_NO
					                                                        END 
					                                                  FROM TBBADGDA001M S1
					                                                 WHERE Z1.TSK_KEY1 = S1.ORG_CD   
					                                                   AND Z1.TSK_KEY2 = S1.NTF_DVSN_CD
					                                                   AND Z1.TSK_KEY3 = S1.NNB)	
					    WHEN Z1.DVSN_CD = '0'            THEN Z1.TSK_KEY1 ||'-정보-'|| Z1.TSK_KEY2
					    WHEN Z1.DVSN_CD = 'A'            THEN F_MNG_KND_AUDYRNO(Z1.TSK_KEY1, Z1.TSK_KEY2, (SELECT AUD_KND_CD 
					                                                                                         FROM TBBADDED001M 
					                                                                                        WHERE AUD_YR = Z1.TSK_KEY1 
					                                                                                          AND AUD_NO = Z1.TSK_KEY2), '-')  ||'-'|| 
					                                          Z1.TSK_KEY3                                                                      ||'-'|| 
					                                          F_ORG_INFO(Z1.TSK_KEY4,'1')
                        /* C, D 추가 - 2018.08.23 yyh */
                        WHEN Z1.DVSN_CD = 'C'            THEN TSK_KEY1 ||'-청금-'|| (SELECT RM_CVPT_ACP_NO FROM TBDCPDCP101M WHERE 1=1 AND ACP_YR = TSK_KEY1 AND REQ_DVSN_CD = TSK_KEY2 AND CVPT_ACP_NO = TSK_KEY3)
                                                                                      /*청탁금지법 추가 2020.12.15 최성호*/
                        WHEN Z1.DVSN_CD = 'D'            THEN TSK_KEY1 ||'-'||F_CODE_NM('1000742', 'D')||'-'||(SELECT RM_CVPT_ACP_NO FROM TBCORCOR101M WHERE 1=1 AND ACP_YR = TSK_KEY1 AND REQ_DVSN_CD = TSK_KEY2 AND CVPT_ACP_NO = TSK_KEY3)
										       										/*부패방지법 추가 2020.12.15 최성호*/
			            ELSE ''
			        END                      AS TSK_KEY_NO /* 실시번호 */
			      ,D2.AUD_YR || '-' || D2.AUD_NO || '-' || D2.DSP_RQ_SNO AS AUD_YR_NO_FOCUS /* 저장 후 ROW위치 지정 */
			      ,D1.EXEC_DSP_NM                                          /* 시행번호 */
			      ,'TBBADEAR002D'                                              AS TABLE_TYPE
			      , D1.ACT_DSP_NM  /* 사건번호  */
			      , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-')   AS AUD_YR_GRNNO
			      , D8.DOC_ID                     AS DOC_ID_NO
			      , NVL(D2.JUD_RST_SBJ_CD,'0')    AS JUD_RST_SBJ_CD              /* 판정유보사항코드 - 2018.08.06 yyh */
			      , D2.JUD_RST_RSN_TXT            AS JUD_RST_RSN_TXT             /* 판정유보사유내용 - 2018.08.06 yyh */
			      , D2.JUD_RST_SBJ_HNDL_RSLT_TXT  AS JUD_RST_SBJ_HNDL_RSLT_TXT   /* 판정유보사항처리결과내용 - 2018.08.06 yyh */
			      , D2.IMMUN_EXAM_CD                  /* 적극행정면책 검토 내용 - 2020.02.05 kdI*/
			      , D2.IMMUN_EXAM_CD2                  /* 적극행정면책 검토 내용-면책인정, 면책일부인정, 면책불인정 - 2020.02.05 kdI*/
			      , D2.PASV_ADMN_EXAM_YN            /* 소극행정 검토 내용 - 2020.02.05 kdI*/
			      , D2.SELF_YN                             /* 자율여부 - 2020.02.06 kdI*/
			      , D9.KYWD1                      AS KYWD1                       /* 키워드 추가 - 2018.08.06 yyh */ 
			      , D9.KYWD2                      AS KYWD2
			      , D9.KYWD3                      AS KYWD3
			      , D9.KYWD4                      AS KYWD4
			      , D9.KYWD5                      AS KYWD5			      
			      , F_CODE_NM('1000894',D3.DOC_WRIT_KND_CD) AS DOC_TYPE_NO
			  FROM TBBADEAR001M D1
			     , TBBADEAR002D D2
			     , (
		           SELECT D1.AUD_YR
		                , D1.AUD_NO
		                , D1.AUD_GRN_NO
		                , D1.AUD_KND_CD 
		                , F_DPT_INFO(D1.SPV_BRDV_CD,'1')||'(단장 : '||F_USR_INFO(D1.AUD_TOT_DRTR_CNB,'2')||', 주관 : '||F_USR_INFO(D1.SPVR_CNB,'2')||')' AS SPV_BRDV_NM               
		                , '<'||F_CODE_NM('1000007',D1.AUD_KND_CD) ||'>'||D1.AUD_SBJ_NM AS AUD_SBJ_NM
		                , F_ORG_CNT_NM_AUD(D1.AUD_YR,D1.AUD_NO,'AUD') AS AUD_ORG_CNT
		            	, D1.SPV_BRDV_CD
		            	, D1.MNG_DPT_CD
		            	, D1.DOC_WRIT_KND_CD 
		            FROM TBBADDED001M D1
		           WHERE 1=1
		             AND D1.MNG_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{sCnb}, #{dptAuth}, '', #{upSpvBrdvCd})))   /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/
        ]]>			             
					<if test='audYrNoKndCd != null and audYrNoKndCd != ""'>
			             /* 감사연번종류코드 - 2015.12.18 yyh */
						 AND SUBSTR(D1.AUD_KND_CD,3,1) = #{audYrNoKndCd} 
					</if>		
			
					<if test='spvBrdvCd != null and spvBrdvCd != ""'>
						 AND D1.MNG_DPT_CD = #{spvBrdvCd}
					</if>
			
					<!-- 감사부여번호 조건 추가 - 2016.05.31 yyh -->
					<if test='audGrnNo != null and audGrnNo != ""'>
						AND D1.AUD_GRN_NO = #{audGrnNo}
					</if>
			        <![CDATA[       
			     ) D3
                 /* 
                  - 처분요구에서 입력한 실시구분만 조회되도록 수정함 - 2018.09.06 yyh
                  - 공통코드 1000742에 USR_DFN_TXT_3에 입력된 코드 2자리중 
                  - 앞자리는 감사사항에서 입력여부, 뒷자리는 처분요구 입력여부 (0:미사용, 1:사용)
                 */
			     , (SELECT AUD_YR
                          ,AUD_NO
                          ,DSP_RQ_SNO
                          ,DVSN_CD
                          ,TSK_KEY1
                          ,TSK_KEY2
                          ,TSK_KEY3
                          ,TSK_KEY4
                     FROM TBBADEAR035L
                    WHERE DVSN_CD IN ( SELECT CD 
                                         FROM TBDCMACM013C
                                        WHERE CMM_CD_DVSN_CD            = '1000742'
                                          AND SUBSTR(USR_DFN_TXT_3, -1) = '1' ) 
                   ) Z1            
			     , (
			         SELECT AUD_YR
				          , AUD_NO
				          , DSP_RQ_SNO 
				          , COUNT(1) CNT 
				       FROM TBBADFRE001M
				      GROUP BY AUD_YR
				             , AUD_NO
				             , DSP_RQ_SNO    
			     ) D4
			     , (/*관계기관*/
			        SELECT AUD_YR, AUD_NO, DSP_RQ_SNO , COUNT(1)-1 CNT 
			          FROM TBBADEAR006M
			         GROUP BY AUD_YR, AUD_NO, DSP_RQ_SNO 
			       ) D5
			     , (/*소관청*/
			        SELECT AUD_YR, AUD_NO, DSP_RQ_SNO , COUNT(1)-1 CNT 
			          FROM TBBADEAR008M
			         GROUP BY AUD_YR, AUD_NO, DSP_RQ_SNO 
			       ) D7
			       , TBBADDED103M  D8  /* 문서함 */
                   , (SELECT AUD_YR
                            ,AUD_NO
                            ,DSP_RQ_SNO
                            ,MAX(CASE WHEN SNO=1 THEN KYWD END) AS KYWD1
                            ,MAX(CASE WHEN SNO=2 THEN KYWD END) AS KYWD2
                            ,MAX(CASE WHEN SNO=3 THEN KYWD END) AS KYWD3
                            ,MAX(CASE WHEN SNO=4 THEN KYWD END) AS KYWD4
                            ,MAX(CASE WHEN SNO=5 THEN KYWD END) AS KYWD5
                        FROM TBBADEAR037M
                       GROUP BY AUD_YR, AUD_NO, DSP_RQ_SNO) D9 /* 키워드 추가 */ 			       
			 WHERE 1=1
		]]>
        <![CDATA[  			   
			   
			   AND D1.AUD_YR     = D2.AUD_YR
			   AND D1.AUD_NO     = D2.AUD_NO
			   AND D1.DSP_RQ_SNO = D2.DSP_RQ_SNO
			   AND D1.AUD_YR     = D3.AUD_YR
			   AND D1.AUD_NO     = D3.AUD_NO   
			   AND D1.AUD_YR     = D4.AUD_YR(+)
			   AND D1.AUD_NO     = D4.AUD_NO(+)
			   AND D1.DSP_RQ_SNO = D4.DSP_RQ_SNO(+)
			   AND D1.AUD_YR     = D5.AUD_YR(+)
			   AND D1.AUD_NO     = D5.AUD_NO(+)
			   AND D1.DSP_RQ_SNO = D5.DSP_RQ_SNO(+)
			   AND D1.AUD_YR     = D7.AUD_YR(+)
			   AND D1.AUD_NO     = D7.AUD_NO(+)
			   AND D1.DSP_RQ_SNO = D7.DSP_RQ_SNO(+)
			   
			   /* 처분요구사항실시내역 추가 - 2016.02.24 yyh */
			   AND D1.AUD_YR     = Z1.AUD_YR(+)
			   AND D1.AUD_NO     = Z1.AUD_NO(+)
			   AND D1.DSP_RQ_SNO = Z1.DSP_RQ_SNO(+)
			   
			   AND D1.AUD_YR     = D8.AUD_YR(+)
			   AND D1.AUD_NO     = D8.AUD_NO(+)
			   AND TO_CHAR(D1.AUD_DSP_RQ_SNO) = D8.REF_ID(+)
			   AND D8.AUD_STEP_CD(+) = 'A1080'   /*  감사단계코드  */
			   AND D8.RPRT_CD(+)  = 'A10800500'
			   
			   AND D1.AUD_YR     = D9.AUD_YR(+)
			   AND D1.AUD_NO     = D9.AUD_NO(+)
			   AND D1.DSP_RQ_SNO = D9.DSP_RQ_SNO(+)			   
		]]>


		<if test='audYr != null and audYr != ""'>
			   AND D1.AUD_YR      = #{audYr}
		</if>
		<if test='audNo != null and audNo != ""'>
			   AND D1.AUD_NO      = #{audNo}
		</if>
		
		<!-- 감사부여번호 조건 추가 - 2016.05.31 yyh -->

		<if test='audGrnNo != null and audGrnNo != ""'>
			   AND D3.AUD_GRN_NO = #{audGrnNo}
			</if>
		
		<if test='dspRqSno != null and dspRqSno != ""'>
			   AND D1.DSP_RQ_SNO      = #{dspRqSno}
		</if>
		
		<if test='audGrnNo != null and audGrnNo != ""'>
			   AND D3.AUD_GRN_NO      = #{audGrnNo}
		</if>
		
	</select>
	
	
	<!-- 처분요구 시행 상세 시행번호 생성전 -->
	<select id="selectDetailInit" parameterType="paramMap" resultType="egovMap" >
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectDetailInit */
		<![CDATA[  
			SELECT   T2.AUD_YR
			        ,T2.AUD_NO
			        ,T2.REF_DOC_ID AS DOC_ID
			        ,(
                        SELECT D1.DOC_ID
                        FROM TBBADDED103M D1  
                        WHERE D1.AUD_YR = T2.AUD_YR
                          AND D1.AUD_NO = T2.AUD_NO
                          AND D1.REF_ID = TO_CHAR(T2.DSP_RQ_SNO)
                          AND D1.RPRT_CD  = 'A10800500' 
                     ) AS DOC_ID_NO /*  사건처분별 공개문  */
                    ,(
                        SELECT F_OPEN_EDIT(D1.LINK_URL)
                        FROM TBBADDED103M D1  
                        WHERE D1.AUD_YR = T2.AUD_YR
                          AND D1.AUD_NO = T2.AUD_NO
                          AND D1.REF_ID = TO_CHAR(T2.DSP_RQ_SNO)
                          AND D1.RPRT_CD  = 'A10800500' 
                     ) AS DOC_TYPE_NO /*  사건처분별 공개문 DocType  */
			        ,T2.APVR_CD
			        ,T2.AFF_SNO
			        ,T2.DSP_RQ_SNO
			        ,T4.AUD_SBJ_NM                                                  AS AUD_SBJ_NM            /*감사사항*/                    
			        ,T2.DSP_RQ_CD                                                   AS  DSP_RQ_KND_CD       /* 처분요구코드 */
			        , (SELECT CD_NM
			          FROM TBDCMACM013C
			          WHERE CMM_CD_DVSN_CD = '1000002' 
			          AND CD = T2.DSP_RQ_CD)                                        AS DSP_RQ_KND_NM         /*처분요구종류명*/
			        , T2.RLTN_ORG_CD                                                                  /*관계기관*/
                    , F_ORG_INFO(T2.RLTN_ORG_CD, '1') AS RLTN_ORG_NM
                    , T2.HND_ORG_CD                                                                  /*조치기관*/
                    , F_ORG_INFO(T2.HND_ORG_CD, '1') AS HND_ORG_NM
                    , (SELECT CASE WHEN COUNT(DISTINCT ORG_CD)>1 
                                     THEN F_ORG_INFO(MIN(ORG_CD),'1')||'외 '||TO_CHAR(COUNT(DISTINCT ORG_CD)-1)||'' 
                                ELSE F_ORG_INFO(MIN(ORG_CD),'1') 
                            END
                      FROM TBBADDED008L     /*조별출장대상기관내역*/
                     WHERE 1 = 1
                       AND (BZT_YR, BZT_SNO) IN (SELECT BZT_YR
                                                       ,BZT_SNO
                                                   FROM TBBADDED002M   /* 출장상황기본 */
                                                  WHERE 1=1
                                                    AND REL_AUD_YR = T2.AUD_YR
                                                    AND REL_AUD_NO = T2.AUD_NO )) AS AUD_ORG_CNT           /*기관명*/
			        ,T3.TITLE_NM                                                     AS TIT_Txt  /*제목명 */
			        ,T3.AUD_STEP_CD   /*스텝*/
			        
			      /* ,F_MNG_KND_AUDYRNO(T3.AUD_YR, T3.AUD_NO, T3.AUD_KND_CD, '-')  || '-' || T3.AFF_CD || '-' ||  T2.AFF_DSP_CD AS ACT_DSP_NM */  /*  사건번호 */
			        ,(SELECT MAX(TT1.AFF_NO) 
		               FROM TBBADDED147M TT1 
		              WHERE TT1.AUD_YR = T3.AUD_YR
		                AND TT1.AUD_NO = T3.AUD_NO 
		                AND TT1.APVR_CD IN ('A1070', '0010600') 
		                AND TT1.AFF_SNO = T3.AFF_SNO 
		                AND TT1.DSP_RQ_SNO = T2.DSP_RQ_SNO)   AS ACT_DSP_NM      /*  사건번호 */       
			        ,T5.EXEC_DSP_NM                                                  AS EXEC_DSP_NM                                                 /* 시행번호  예 :2016-특정-001-시01*/
			        , F_MNG_KND_AUDYRNO(T3.AUD_YR, T3.AUD_NO, T3.AUD_KND_CD, '-') ||'-'|| T2.DSP_RQ_SNO   AS DSP_RQ_SNO_NM
			        ,'TBBADDED146M'                                              AS TABLE_TYPE
			        , F_MNG_KND_AUDYRNO(T2.AUD_YR, T2.AUD_NO, T2.AUD_KND_CD, '-')                  AS AUD_YR_GRNNO
			        , F_ORG_CNT_NM_AUD(T2.AUD_YR,T2.AUD_NO,'AUD') AS AUD_ORG_CNT
			        , DECODE(T2.ACCN_INSP_CD,'10','100000000','20','200000000','') AS WRDO_TYP_CD
			        , T2.KYWD1
                    , T2.KYWD2
                    , T2.KYWD3
                    , T2.KYWD4
                    , T2.KYWD5
                    , F_CODE_NM('1000894',T4.DOC_WRIT_KND_CD) AS DOC_TYPE
			FROM TBBADDED146M T2 
		   INNER JOIN TBBADDED145M T3 ON T3.AUD_YR = T2.AUD_YR
			                          AND T3.AUD_NO = T2.AUD_NO
			                          AND T3.AUD_STEP_CD = T2.AUD_STEP_CD
			                          AND T3.APVR_CD = T2.APVR_CD
			                          AND T3.REF_DOC_ID = T2.REF_DOC_ID
			                          AND T3.AFF_SNO = T2.AFF_SNO
			INNER JOIN TBBADDED001M T4 ON T4.AUD_YR     = T2.AUD_YR
			                          AND T4.AUD_NO     = T2.AUD_NO
			LEFT OUTER JOIN TBBADEAR001M T5 ON T5.AUD_YR     = T2.AUD_YR   /* 처분요구사항기본 */
						              AND T5.AUD_NO     = T2.AUD_NO
                                      AND T5.AUD_DSP_RQ_SNO = T2.DSP_RQ_SNO
			]]>
			WHERE 1=1
		                         AND T2.AUD_YR = #{audYr}
		                         AND T2.AUD_NO = #{audNo}
		                         AND T2.FNL_YN = 'Y'
			                          
							<if test='audGrnNo != null and audGrnNo != ""'>
								   AND T2.AUD_GRN_NO = #{audGrnNo}
							</if>
							<if test='dspRqCd != null and dspRqCd != ""'>
								   AND T2.DSP_RQ_CD = #{dspRqCd}
							</if>
							<if test='docId != null and docId != ""'>
								   AND T2.REF_DOC_ID = #{docId}
							</if>
							<if test='affSno != null and affSno != ""'>
								   AND T2.AFF_SNO = #{affSno}
							</if>
							<if test='dspRqSrno != null and dspRqSrno != ""'>
								  AND T2.DSP_RQ_SNO = #{dspRqSrno}
							</if>
	</select>
	
	
	<!-- 처분요구 시행 상세 시행번호 생성전 -->
	<select id="selectDetailInit2" parameterType="paramMap" resultType="egovMap" >
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectDetailInit2 */
		<![CDATA[  
			SELECT   T2.AUD_YR
			        ,T2.AUD_NO
			        ,T2.DOC_ID
			        ,(
                        SELECT D1.DOC_ID
                        FROM TBBADDED103M D1  
                        WHERE D1.AUD_YR = T2.AUD_YR
                          AND D1.AUD_NO = T2.AUD_NO
                          AND D1.REF_ID = TO_CHAR(T2.DSP_RQ_SNO)
                          AND D1.RPRT_CD  = 'A10800500' 
                     ) AS DOC_ID_NO /*  사건처분별 공개문  */
                    ,(
                        SELECT F_OPEN_EDIT(D1.LINK_URL)
                        FROM TBBADDED103M D1  
                        WHERE D1.AUD_YR = T2.AUD_YR
                          AND D1.AUD_NO = T2.AUD_NO
                          AND D1.REF_ID = TO_CHAR(T2.DSP_RQ_SNO)
                          AND D1.RPRT_CD  = 'A10800500' 
                     ) AS DOC_TYPE_NO /*  사건처분별 공개문  */
			        ,T2.APVR_CD
			        ,T2.AFF_SNO
			        ,T2.DSP_RQ_SNO
			        ,T4.AUD_SBJ_NM                                                  AS AUD_SBJ_NM            /*감사사항*/                    
			        ,T2.DSP_RQ_CD                                                   AS  DSP_RQ_KND_CD       /* 처분요구코드 */
			        , (SELECT CD_NM
			          FROM TBDCMACM013C
			          WHERE CMM_CD_DVSN_CD = '1000002' 
			          AND CD = T2.DSP_RQ_CD)                                        AS DSP_RQ_KND_NM         /*처분요구종류명*/
			        , T2.RLTN_ORG_CD                                                                  /*관계기관*/
                    , F_ORG_INFO(T2.RLTN_ORG_CD, '1') AS RLTN_ORG_NM
                    , T2.HND_ORG_CD                                                                  /*조치기관*/
                    , F_ORG_INFO(T2.HND_ORG_CD, '1') AS HND_ORG_NM
                    , (SELECT CASE WHEN COUNT(DISTINCT ORG_CD)>1 
                                     THEN F_ORG_INFO(MIN(ORG_CD),'1')||'외 '||TO_CHAR(COUNT(DISTINCT ORG_CD)-1)||'' 
                                ELSE F_ORG_INFO(MIN(ORG_CD),'1') 
                            END
                      FROM TBBADDED008L     /*조별출장대상기관내역*/
                     WHERE 1 = 1
                       AND (BZT_YR, BZT_SNO) IN (SELECT BZT_YR
                                                       ,BZT_SNO
                                                   FROM TBBADDED002M   /* 출장상황기본 */
                                                  WHERE 1=1
                                                    AND REL_AUD_YR = T2.AUD_YR
                                                    AND REL_AUD_NO = T2.AUD_NO )) AS AUD_ORG_CNT           /*기관명*/
			        ,T3.TITLE_NM                                                     AS TIT_Txt  /*제목명 */
			        ,T3.AUD_STEP_CD   /*스텝*/
			        
			     /*  ,F_MNG_KND_AUDYRNO(T3.AUD_YR, T3.AUD_NO, T3.AUD_KND_CD, '-')  || '-' || T3.AFF_CD || '-' ||  T2.AFF_DSP_CD AS ACT_DSP_NM*/   /*  사건번호 */
			        ,(SELECT MAX(TT1.AFF_NO) 
		               FROM TBBADDED147M TT1 
		              WHERE TT1.AUD_YR = T3.AUD_YR
		                AND TT1.AUD_NO = T3.AUD_NO 
		                AND TT1.APVR_CD IN ('A1070', '0010600') 
		                AND TT1.AFF_SNO = T3.AFF_SNO 
		                AND TT1.DSP_RQ_SNO = T2.DSP_RQ_SNO) AS ACT_DSP_NM   /*  사건번호 */
			        ,T5.EXEC_DSP_NM                                                  AS EXEC_DSP_NM                                                 /* 시행번호  예 :2016-특정-001-시01*/
			        , F_MNG_KND_AUDYRNO(T3.AUD_YR, T3.AUD_NO, T3.AUD_KND_CD, '-') ||'-'|| T2.DSP_RQ_SNO   AS DSP_RQ_SNO_NM
			        ,'TBBADDED146M'                                              AS TABLE_TYPE
			        , F_MNG_KND_AUDYRNO(T2.AUD_YR, T2.AUD_NO, T2.AUD_KND_CD, '-')                  AS AUD_YR_GRNNO
			        , F_ORG_CNT_NM_AUD(T2.AUD_YR,T2.AUD_NO,'AUD') AS AUD_ORG_CNT
			        , DECODE(T2.ACCN_INSP_CD,'10','100000000','20','200000000','') AS WRDO_TYP_CD
			        , T2.KYWD1
                    , T2.KYWD2
                    , T2.KYWD3
                    , T2.KYWD4
                    , T2.KYWD5
			FROM
				TBBADDED146M T2 
			INNER JOIN TBBADDED145M T3 ON T3.AUD_YR = T2.AUD_YR
			                          AND T3.AUD_NO = T2.AUD_NO
			                          AND T3.AUD_STEP_CD = T2.AUD_STEP_CD
			                          AND T3.APVR_CD = T2.APVR_CD
			                          AND T3.DOC_ID = T2.DOC_ID
			                          AND T3.AFF_SNO = T2.AFF_SNO
			INNER JOIN TBBADDED001M T4 ON T4.AUD_YR     = T2.AUD_YR
			                          AND T4.AUD_NO     = T2.AUD_NO
			LEFT OUTER JOIN TBBADEAR001M T5 ON T5.AUD_YR     = T2.AUD_YR   /* 처분요구사항기본 */
						              AND T5.AUD_NO     = T2.AUD_NO
						              /*AND T5.AFF_CD     = T3.AFF_CD*/
                                      /*AND T5.AFF_DSP_CD = T2.AFF_DSP_CD*/
						              AND T5.AUD_DSP_RQ_SNO = T2.DSP_RQ_SNO
			]]>
			WHERE 1=1
		                         AND T2.AUD_YR = #{audYr}
		                         AND T2.AUD_NO = #{audNo}
		                         AND T2.FNL_YN = 'Y'
			                          
							<if test='audGrnNo != null and audGrnNo != ""'>
								   AND T2.AUD_GRN_NO = #{audGrnNo}
							</if>
							<if test='dspRqCd != null and dspRqCd != ""'>
								   AND T2.DSP_RQ_CD = #{dspRqCd}
							</if>
							<if test='docId != null and docId != ""'>
								   AND T2.DOC_ID = #{docId}
							</if>
							<if test='affSno != null and affSno != ""'>
								   AND T2.AFF_SNO = #{affSno}
							</if>
							<if test='dspRqSrno != null and dspRqSrno != ""'>
								  AND T2.DSP_RQ_SNO = #{dspRqSrno}
							</if>

	</select>
	
	<!--처분요구사항기본 insert  BADEAR003EMasterInsert -->
	<insert id="insertMaster" parameterType="paramMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertMaster */
		<![CDATA[  
		DECLARE
			BEGIN		
			INSERT INTO TBBADEAR001M(
			       AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , FRM_NO
			     , RPRT_NO
			     , JUDG_NO
			     , TIT_TXT
			     , HND_SBJ_TXT
			     , HNDL_PLAN_DVSN_CD
			     , DSP_RQ_KND_CD
			     , ORG_DVSN_CD
			     , AUD_EPS_CD
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH
			     , EXEC_DSP_NM
			     , ACT_DSP_NM
			     , AFF_CD
			     , AFF_DSP_CD
			     , AUD_DSP_RQ_SNO
			)VALUES(
			       #{audYr}
			     , #{audNo}
			     , #{dspRqSno}
			     , #{frmNo}
			     , #{rprtNo}
			     , #{judgNo}
			     , #{titTxt}
			     , #{hndSbjTxt}
			     , #{hndlPlanDvsnCd}
			     , #{dspRqKndCd}
			     , #{orgDvsnCd}
			     , #{audEpsCd}
			     , #{frtUsrId}
			     , #{fnlUsrId}
			     , #{fnlDealDptCd}
			     , #{fnlMnuId}
			     , SYSDATE
			     , SYSDATE
			     , #{execDspNm}
			     , #{actDspNm}
			     , #{affCd}
			     , #{affDspCd}
			     , #{audDspRqSno}
			);
		END;
			
		]]>
	</insert>
	
	<!--처분요구사항상세 insert BADEAR003EMasterSubInsert-->
	<insert id="insertMasterSub" parameterType="paramMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertMasterSub */
		<![CDATA[
			INSERT INTO TBBADEAR002D(
			       AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , DSP_RQ_SRNO
			     , ENF_DT
			     , HNDL_DDLN_DT
			     , ENF_BRDV_CD
			     , CHGR_NM
			     , DOC_SEN_NO
			     , DSP_RQ_IPT_DT
			     , PSC_RQT_NOP_CNT
			     , PNL_DRIN_PSVT_AM
			     , RSR_AM
			     , SPLP_AM
			     , BGT_RDC_AM
			     , INC_ICR_AM
			     , PPL_BDN_RDT_AM
			     , FRTN_INCR_AM
			     , EXPN_RTNL_AM
			     , IJS_AM
			     , SLF_HNDL_RQ_AM
			     , WRDO_CAU_CD
			     , ENFM_MNG_BRDV_CD
                 , OD_ENFM_MNG_BRDV_CD
			     , DTM_YN
			     , DTM_STA_CD
			     , ENFM_HST_IPT_DT
			     , ACNT_INSP_CD
			     , CPLT_DT
			     , HMP_OPEN_YN
			     , DTY_OBV_UTL_YN
			     , AM
			     , NOP_CNT
			     , HNDL_PLAN_RPT_NO
			     , EVI_CNT
			     , TOT_EVI_CNT
			     , WRDO_TYP_CD
			     , DTY_INSP_MTRL_TXT
			     , AUD_POLI_CD
			     , AUD_SPH_CD
			     , AUD_RPT_YR
			     , ENFM_CPLT_IPT_DT
			     , EPT_EFCT_AM_STA_CD
			     , EPT_EFCT_DT
			     , ENFM_WHLS_DTM_DT
			     , SLF_HNDL_TXT
			     , STF_SMT_INF_TXT
			     , COPT_OFI_CD
			     , RLTN_ORG_CD
			     , COPT_CNT
			     , ORG_CNT
			     , DSP_RQ_DTM_DT
			     , DSP_RQ_DTM_PEN_ID
			     , ENFM_CPLT_IPT_PEN_ID
			     , ENFM_WHLS_DTM_PEN_ID
			     , DSP_RQ_APV_STA_CD
			     , DSP_RQ_APV_STA_DT
			     , CPLT_PEN_ID
			     , TSK_CAT_CD
			     , EXPOT_Y_EFCT_AM
			     , ENFM_WHLS_APV_KND_CD
			     , EXAM_RPRT_DSP_RQ_SBT
			     , EXAM_RPRT_UNENFM_RTWR_TXT
			     , EXAM_RPRT_UNENFM_RSN_EXAM_TXT
			     , EXAM_RPRT_APV_STA_DT
			     , EXAM_RPRT_APV_STA_CD
			     , CLSG_PRSS_STA_CD
                 , MAIN_ENFM_MNG_TG_YN
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH
			     , JUD_RST_SBJ_CD                /* 판정유보사항코드 - 2018.08.06 yyh */
			     , JUD_RST_RSN_TXT               /* 판정유보사유내용 - 2018.08.06 yyh */
			     , JUD_RST_SBJ_HNDL_RSLT_TXT     /* 판정유보사항처리결과내용 - 2018.08.06 yyh */
			     , IMMUN_EXAM_CD                  /* 적극행정면책 검토 내용 - 2020.02.05 kdI*/
			     , IMMUN_EXAM_CD2                  /* 적극행정면책 검토 내용-면책인정, 면책일부인정, 면책불인정 - 2020.02.05 kdI*/
			     , PASV_ADMN_EXAM_YN            /* 소극행정 검토 내용 - 2020.02.05 kdI*/
			     , SELF_YN                             /* 자율여부 - 2020.02.06 kdI*/
			) VALUES(
			       #{audYr}
			     , #{audNo}
			     , #{dspRqSno}
			     , #{dspRqSrno}
			     , #{enfDt}
			     , REPLACE(#{hndlDdlnDt},'-','')
			     , #{enfBrdvCd}
			     , #{chgrNm}
			     , #{docSenNo}
			     , #{dspRqIptDt}
			     , #{pscRqtNopCnt}
			     , #{pnlDrinPsvtAm}
			     , #{rsrAm}
			     , #{splpAm}
			     , #{bgtRdcAm}
			     , #{incIcrAm}
			     , #{pplBdnRdtAm}
			     , #{frtnIncrAm}
			     , #{expnRtnlAm}
			     , #{ijsAm}
			     , #{slfHndlRqAm}
			     , #{wrdoCauCd}
			     , #{enfmMngBrdvCd}
                 , #{enfBrdvCd}
			     , #{dtmYn}
			     , #{dtmStaCd}
			     , #{enfmHstIptDt}
			     , #{acntInspCd}
			     , #{cpltDt}
			     , #{hmpOpenYn}
			     , #{dtyObvUtlYn}
			     , #{am}
			     , #{nopCnt}
			     , #{hndlPlanRptNo}
			     , #{eviCnt}
			     , #{totEviCnt}
			     , #{wrdoTypCd}
			     , #{dtyInspMtrlTxt}
			     , #{audPoliCd}
			     , #{audSphCd}
			     , #{audRptYr}
			     , #{enfmCpltIptDt}
			     , #{eptEfctAmStaCd}
			     , #{eptEfctDt}
			     , #{enfmWhlsDtmDt}
			     , #{slfHndlTxt}
			     , #{stfSmtInfTxt}
			     , #{coptOfiCd}
			     , #{rltnOrgCd}
			     , #{coptCnt}
			     , #{orgCnt}
			     , #{dspRqDtmDt}
			     , #{dspRqDtmPenId}
			     , #{enfmCpltIptPenId}
			     , #{enfmWhlsDtmPenId}
			     , #{dspRqApvStaCd}
			     , #{dspRqApvStaDt}
			     , #{cpltPenId}
			     , #{tskCatCd}
			     , #{expotYEfctAm}
			     , #{enfmWhlsApvKndCd}
			     , #{examRprtDspRqSbt}
			     , #{examRprtUnenfmRtwrTxt}
			     , #{examRprtUnenfmRsnExamTxt}
			     , #{examRprtApvStaDt}
			     , #{examRprtApvStaCd}
			     , #{clsgPrssStaCd}
                 , #{mainEnfmMngTgYn}
			     , #{frtUsrId}
			     , #{fnlUsrId}
			     , #{fnlDealDptCd}
			     , #{fnlMnuId}
			     , SYSDATE
			     , SYSDATE
			     , #{judRstSbjCd}
			     , #{judRstRsnTxt}
			     , #{judRstSbjHndlRsltTxt}
			     , #{immunExamCd}
			     , #{immunExamCd2}
			     , #{pasvAdmnExamYn} 
			     , #{selfYn}
			)
		]]>
	</insert>  

	


    

    
    
    <!-- 회계사항 -->
	<select id="searchAcctList" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.searchAcctList */
        <![CDATA[    
			SELECT D1.AUD_YR               AS AUD_YR               /*감사년도*/
			     , D1.AUD_NO               AS AUD_NO               /*감사번호*/
			     , D1.DSP_RQ_SNO           AS DSP_RQ_SNO           /*처분요구순번*/
			     , D1.ACNT_SBJ_SNO         AS ACNT_SBJ_SNO         /*회계사항순번*/
			     , D1.DSP_RQ_ACNT_CD       AS DSP_RQ_ACNT_CD       /*처분요구회계코드*/
			     , F_CODE_NM('1000004',    D1.DSP_RQ_ACNT_CD)       AS DSP_RQ_ACNT_NM       /*처분요구회계명*/
			     , D1.EPT_EFCT_DVSN_CD     AS EPT_EFCT_DVSN_CD     /*기대효과구분코드*/
			     , F_CODE_NM('1000334',D1.EPT_EFCT_DVSN_CD)      AS EPT_EFCT_DVSN_NM     /*기대효과구분코드*/
			     , D1.ACNT_YE              AS ACNT_YE              /*회계연도*/
			     , D1.PNL_DRIN_PSVT_AM     AS PNL_DRIN_PSVT_AM     /*추징회수보전금액*/    
			     , D1.RSR_AM               AS RSR_AM               /*환급금액*/
			     , D1.SPLP_AM              AS SPLP_AM              /*추급금액*/
			     , D1.EPT_EFCT_AM          AS EPT_EFCT_AM          /*기대효과금액*/
			     , D1.EXPOT_Y_EFCT_AM      AS EXPOT_Y_EFCT_AM      /*사후적효과금액*/
			     , D1.EXPOT_Y_EFCT_AM_CALC_BAS_TXT AS EXPOT_Y_EFCT_AM_CALC_BAS_TXT /*사후적효과금액산출근거*/
			     , D1.ETC_ACNT_NM          AS ETC_ACNT_NM			/*기타회계명 */
			     , D1.EXPOT_Y_EFCT_AM_APC_YN AS EXPOT_Y_EFCT_AM_APC_YN /*사후적효과금액적용여부*/
			     , D1.BGT_RFC_NCSY_YN AS BGT_RFC_NCSY_YN /*예산반영 필요성*/
			  FROM TBBADEAR003M D1
			 WHERE 1=1
			   AND D1.AUD_YR               = #{audYr} 
			   AND D1.AUD_NO               = #{audNo} 	
			   AND D1.DSP_RQ_SNO			= #{dspRqSno}	
		    ORDER BY D1.EPT_EFCT_DVSN_CD	  
		]]>
	</select>
	
	
	

	<!--회계사항 delete  BADEAR003EAcctDelete-->
	<update id="deleteAcct" parameterType="paramMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.deleteAcct */
		<![CDATA[
		DECLARE
			BEGIN			
			  FOR CS IN ( 
			    SELECT AUD_YR
			         , AUD_NO
			         , DSP_RQ_SNO
			         , ACNT_SBJ_SNO
				  FROM TBBADEAR003M
				 WHERE 1=1
				   AND AUD_YR 		= #{audYr} 
				   AND AUD_NO 		= #{audNo} 	
				   AND DSP_RQ_SNO 	= #{dspRqSno}	
		]]>
		<if test='acntSbjSno != null and acntSbjSno != ""'>
			       AND ACNT_SBJ_SNO		= #{acntSbjSno}
		</if>	
		<if test='dspRqAcntCd != null and dspRqAcntCd != ""'>
			      AND DSP_RQ_ACNT_CD	= #{dspRqAcntCd}
		</if>	
		<if test='eptEfctDvsnCd != null and eptEfctDvsnCd != "" and eptEfctDvsnCd != "null"'>
 			      AND EPT_EFCT_DVSN_CD	= #{eptEfctDvsnCd}	
		</if>	
		<![CDATA[
			)
			LOOP 				   		
			   DELETE 
				 FROM TBBADEAR003M
				WHERE 1=1
				  AND AUD_YR 		= CS.AUD_YR
				  AND AUD_NO 		= CS.AUD_NO
				  AND DSP_RQ_SNO 	= CS.DSP_RQ_SNO
				  AND ACNT_SBJ_SNO	= CS.ACNT_SBJ_SNO
				;
				
			END LOOP;
		END;												
		]]>
	</update>	



	
	<!-- 처분요구 시행 관계기관 & 관계자 -->
	<select id="selectRltnList" parameterType="paramMap" resultType="egovMap" >
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectRltnList */
        <![CDATA[
			SELECT D1.AUD_YR            AS AUD_YR               /*감사년도*/
			     , D1.AUD_NO            AS AUD_NO               /*감사번호*/
			     , D1.DSP_RQ_SNO        AS DSP_RQ_SNO           /*처분요구순번*/
			     , D1.RLTN_ORG_CD       AS RLTN_ORG_CD          /*관계기관코드*/
			     , F_ORG_INFO(D1.RLTN_ORG_CD,'1') AS RLTN_ORG_NM
			     , D1.RLTN_ORG_DVSN_CD  AS RLTN_ORG_DVSN_CD     /*관계기관구분코드*/    
			     , D1.DSP_RQ_TG_KND_CD  AS DSP_RQ_TG_KND_CD     /*처분요구대상종류코드*/
			     , D1.CPLT_YN           AS CPLT_YN              /*완결여부*/
			     , D1.CPLT_DT           AS CPLT_DT              /*완결일*/
			     , D1.CPLT_PEN_ID       AS CPLT_PEN_ID          /*완결자ID*/
			     , D1.SLF_ACP_STA_CD    AS SLF_ACP_STA_CD       /*자체접수상태고드*/
			     , D1.SLF_APV_DT        AS SLF_APV_DT           /*자체결재일*/
			     , D1.SLF_ACP_DT        AS SLF_ACP_DT           /*자체접수일*/
			     , D1.ENFM_MNG_ORG_CD   AS ENFM_MNG_ORG_CD      /*집행관리기관코드*/
			     , F_ORG_INFO(D1.ENFM_MNG_ORG_CD,'1') AS ENFM_MNG_ORG_NM
			     , D2.DFNT_SNO          AS DFNT_SNO             /*관계자순번*/
			     , D2.AD                AS AD                   /*주소*/
			     , D2.OCP_CD            AS OCP_CD               /*직종코드*/
			     , F_CODE_NM('1000057', D2.OCP_CD)      AS OCP_CD_NM
			     , D2.RANK_CD           AS RANK_CD              /*직급코드*/
			     , F_CODE_NM('1000058', D2.RANK_CD)      AS RANK_CD_NM
			     , D2.DFNT_NAM          AS DFNT_NAM             /*관계자성명*/
			     , D2.EIN               AS EIN                  /*주민번호*/
			     , D2.BK_COM_AD         AS BK_COM_AD            /*이전직장주소*/
			     , D2.CMPY_NM           AS CMPY_NM              /*회사명*/    
			     , D2.ACNT_NM           AS ACNT_NM              /*회계명*/
			     , D2.HND_CD            AS HND_CD               /*조치코드*/
			     , F_CODE_NM('1000032', D2.HND_CD)      AS HND_CD_NM
			     , D2.AM                AS AM                   /*금액*/
			     , D2.CPLT_YN           AS PSN_CPLT_YN          /*완결여부*/
			     , D2.HND_RQ_KND_CD     AS HND_RQ_KND_CD        /*조치요구종류코드*/
			     , D2.CPLT_DT           AS PSN_CPLT_DT          /*완결일*/
			     , D2.CPLT_PEN_ID       AS PSN_CPLT_PEN_ID      /*완결자ID*/
			     , D2.SDY_GRT_AM        AS SDY_GRT_AM           /*연대보증금액*/
			     , D2.SDY_GRT_RSN       AS SDY_GRT_RSN          /*연대보증사유*/
			     , D2.PST_NM            AS PST_NM               /*직위명*/
			     , D2.RMK_TXT           AS RMK_TXT              /*비고내용*/
			  FROM TBBADEAR006M D1
			     LEFT OUTER JOIN TBBADEAR007M D2 ON D1.AUD_YR       = D2.AUD_YR
										   AND D1.AUD_NO       = D2.AUD_NO
										   AND D1.DSP_RQ_SNO   = D2.DSP_RQ_SNO
										   AND D1.RLTN_ORG_CD  = D2.RLTN_ORG_CD
			 WHERE 1=1
			   AND D1.AUD_YR       = #{audYr} 
			   AND D1.AUD_NO       = #{audNo} 	
			   AND D1.DSP_RQ_SNO	= #{dspRqSno}	
		    ORDER BY D1.FRT_REGI_DH, D1.RLTN_ORG_CD	,D2.DFNT_SNO  			            
        ]]>
	</select>
	
	<!-- 처분요구 시행 관계자 -->
	<select id="selectEtrList" parameterType="paramMap" resultType="egovMap" >
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectEtrList */
        <![CDATA[     	
			SELECT D1.AUD_YR                    AS AUD_YR                   /*감사년도*/
			     , D1.AUD_NO                    AS AUD_NO                   /*감사번호*/
			     , D1.DSP_RQ_SNO                AS DSP_RQ_SNO               /*처분요구순번*/
			     , D1.ETR_PEN_ID                AS ETR_PEN_ID               /*적출자ID*/
			     , D1.ETR_PEN_BLT_CD            AS ETR_PEN_BLT_CD           /*적출자소속코드*/
			     , D1.ETR_PEN_RANK_CD           AS ETR_PEN_RANK_CD          /*적출자직급코드*/
			     , D1.ETR_PEN_NAM               AS ETR_PEN_NAM              /*적출자성명*/
			     , F_DPT_INFO(D1.ETR_PEN_BLT_CD,'1')	    AS ETR_PEN_BLT_NM   /*적출자소속명*/
			     , F_CODE_NM('1000173',D1.ETR_PEN_RANK_CD)	AS ETR_PEN_RANK_NM  /*적출자직급명*/
			     , D1.CTB_RTE                   AS CTB_RTE                  /*기여율*/
			     , D1.PNL_DRIN_PSVT_AM          AS PNL_DRIN_PSVT_AM         /*추징회수보전금액*/
			     , D1.IJS_AM                    AS IJS_AM                   /*부당금액*/
			     , D1.NOP_RTE                   AS NOP_RTE                  /*인원율*/
			     , D1.ETR_PEN_EXAM_OPIN_TXT     AS ETR_PEN_EXAM_OPIN_TXT    /*적출자검토의견내용*/
			     , F_DPT_INFO( F_USR_INFO(D1.ETR_PEN_ID, '5'),'1')       AS BLT_NM	/*현재소속부서*/
                 , F_CODE_NM('1000173',F_USR_INFO(D1.ETR_PEN_ID, '3'))   AS RANK_NM	/*현재직급*/
			  FROM TBBADEAR004M D1      
			 WHERE 1=1
			   AND D1.AUD_YR       = #{audYr} 
			   AND D1.AUD_NO       = #{audNo} 	
			   AND D1.DSP_RQ_SNO	= #{dspRqSno}	
			 ORDER BY D1.ETR_PEN_ID			 
		]]>
	</select>
	
	
	
	<!--초기 감사자 조회   -->
	<select id="selectUserList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectUserList */
        <![CDATA[
    	SELECT 
            STATUS
            , AUD_YR
            , AUD_NO
            , USR_ID
            , ETR_PEN_NAM
            , ETR_PEN_ID
            , BLT_NM
            , ETR_PEN_BLT_NM
            , ETR_PEN_BLT_CD
            , RANK_NM
            , PST_CD
            , ETR_PEN_RANK_NM
            , ETR_PEN_RANK_CD
            , DEP_RGN_CD
            , DPT_NM
            , SORT_SNO
        FROM (
	    	SELECT '신규'     AS  STATUS
	    	     , D1.SORT_SNO
	             , D1.AUD_YR	        /*감사년도*/
	             , D1.AUD_NO	        /*감사번호*/
	             , D1.USR_ID	        /*사용자ID */
	             , D2.USR_NAM AS ETR_PEN_NAM     /* 성명*/
	             , D2.CNB AS ETR_PEN_ID 
	             , F_DPT_INFO(D2.DPT_CD,'1') AS BLT_NM  /*현재소속부서*/
	             , F_CODE_NM('1000176',D2.DPT_CD)  AS ETR_PEN_BLT_NM
	             , D2.DPT_CD AS ETR_PEN_BLT_CD  /*현재소속부서 코드*/
	             , F_CODE_NM('1000173',D2.RANK_CD) AS RANK_NM   /*현재직급 */
	             , D2.PST_CD
	             , F_CODE_NM('1000173',D2.RANK_CD) AS ETR_PEN_RANK_NM   /*현재직급 */
	             , D2.RANK_CD AS ETR_PEN_RANK_CD   /*현재직급 */
	             , F_DPT_INFO(D2.DPT_CD, '3')  AS DEP_RGN_CD
	             , F_DPT_INFO(D2.DPT_CD,'1') AS DPT_NM
	          FROM TBBADDED117M D1,
	               TBDCMACM001M D2,
	               TBBADDED145M D4
	         WHERE D1.AUD_YR = #{audYr}
	           AND D1.AUD_NO = #{audNo}
	           AND D1.USR_ID = D2.USR_ID
	           AND D1.AUD_YR = D4.AUD_YR
	           AND D1.AUD_NO = D4.AUD_NO
	           AND D1.AFF_SNO = D4.AFF_SNO
	           AND D4.AUD_STEP_CD  = 'A1050'
	           AND D4.AFF_CD = #{affCd}
	         )
         GROUP BY STATUS,AUD_YR,AUD_NO,USR_ID,ETR_PEN_NAM,ETR_PEN_ID,BLT_NM,ETR_PEN_BLT_NM,ETR_PEN_BLT_CD,RANK_NM,PST_CD,ETR_PEN_RANK_NM,ETR_PEN_RANK_CD,DEP_RGN_CD,DPT_NM, SORT_SNO
         ORDER BY ETR_PEN_RANK_CD ASC, SORT_SNO
		]]>
	</select>
	
	<select id="selectMaxSno" parameterType="paramMap" resultType="egovMap">
       <![CDATA[     	
		    SELECT NVL(MAX(TO_NUMBER(DSP_RQ_SNO)),0)+1 AS MAX_SEQ
			  FROM TBBADEAR001M
			 WHERE 1=1
			   AND AUD_YR               =  #{audYr}
			   AND AUD_NO               =  #{audNo}
		]]>
	</select>
	
	<select id="selectExecDspNm" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectExecDspNm */
         <![CDATA[
    SELECT 
         ACT_DSP_NM
         , AUD_STEP_CD
         , APVR_CD
         , AFF_SNO
         , AUD_DSP_RQ_SNO
         , DSP_RQ_SNO
         , (CASE WHEN LENGTH(DSP_RQ_SNO) = 1 THEN BASE_NM || '-' || '시' || '0' || DSP_RQ_SNO
                          ELSE BASE_NM || '-' || '시' || DSP_RQ_SNO
                          END) AS EXEC_DSP_NM                                                                  -- 시행번호
    FROM (
        SELECT T1.BASE_NM
             , T1.ACT_DSP_NM
             , T1.AUD_STEP_CD
             , T1.APVR_CD
             , T1.AFF_SNO
             , T1.DSP_RQ_SNO AS AUD_DSP_RQ_SNO
             , T1.AUD_YR
             , T1.AUD_NO
             , CASE WHEN T2.DSP_RQ_SNO IS NOT NULL 
                    THEN 
                        (SELECT MAX(DSP_RQ_SNO)+1 
                                FROM TBBADEAR001M 
                                WHERE AUD_YR = T1.AUD_YR 
                                AND AUD_NO = T1.AUD_NO)
                    ELSE T1.EXEC_INDEX END AS DSP_RQ_SNO
        FROM (
            SELECT T1.BASE_NM
                /* , T1.BASE_NM || '-' || T1.AFF_CD ||  '-' || T1.AFF_DSP_CD AS ACT_DSP_NM  */      -- 사건번호
                  , (SELECT MAX(TT1.AFF_NO) 
		              FROM TBBADDED147M TT1 
		             WHERE TT1.AUD_YR = T1.AUD_YR
		                AND TT1.AUD_NO = T1.AUD_NO 
		                AND TT1.APVR_CD IN ('A1070', '0010600') 
		                AND TT1.AFF_SNO = T1.AFF_SNO 
		                AND TT1.DSP_RQ_SNO = T1.DSP_RQ_SNO) AS ACT_DSP_NM          -- 사건번호
                 , T1.EXEC_INDEX
                 , T1.AUD_STEP_CD
                 , T1.APVR_CD
                 , T1.AFF_SNO
                 , T1.DSP_RQ_SNO
                 , T1.AUD_YR
                 , T1.AUD_NO
             FROM (
                SELECT ROW_NUMBER() OVER(ORDER BY T3.RPRT_CD, T2.AFF_CD, T1.AFF_DSP_CD) AS EXEC_INDEX
                     , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-')  AS BASE_NM
                     , T1.DSP_RQ_SNO
                     , T2.AFF_CD
                     , T1.AFF_DSP_CD
                     , T1.AUD_STEP_CD
                     , T1.APVR_CD
                     , T1.AFF_SNO
                     , T1.AUD_YR
                     , T1.AUD_NO
                  FROM TBBADDED146M T1
                 INNER JOIN TBBADDED145M T2 
                    ON T1.AUD_YR = T2.AUD_YR
                   AND T1.AUD_NO = T2.AUD_NO
                   AND T1.AUD_STEP_CD = T2.AUD_STEP_CD
                   AND NVL(T1.REF_DOC_ID, T1.DOC_ID) = NVL(T2.REF_DOC_ID, T2.DOC_ID)
                   AND T1.APVR_CD = T2.APVR_CD
                   AND T1.AFF_SNO = T2.AFF_SNO
                 INNER JOIN TBBADDED103M T3
                  ON T3.AUD_YR = T1.AUD_YR
                  AND T3.AUD_NO = T1.AUD_NO
                  AND T3.DOC_ID = NVL(T1.REF_DOC_ID, T1.DOC_ID)
                  AND T3.RPRT_CD IN ('A10601300','A10601320','A10601330','A10601340','A10601100','A10600200')
                  WHERE T1.AUD_YR = #{audYr}
                    AND T1.AUD_NO = #{audNo}
                    AND T1.AUD_STEP_CD = 'A1070'
                    AND T1.APVR_CD = 'A1070'
                    AND T1.AUD_KND_CD <> '916' 
                  ) T1 
             ) T1
             LEFT OUTER JOIN TBBADEAR001M T2 ON (T2.AUD_YR       = T1.AUD_YR
                                             AND T2.AUD_NO       = T1.AUD_NO
                                             AND T2.DSP_RQ_SNO  = T1.EXEC_INDEX)
             WHERE T1.DSP_RQ_SNO = #{dspRqSrno}
             AND T1.AFF_SNO = #{affSno}
         )
		]]>
	</select>
	
	<!-- 실시구분 insert  BADEAR003ETskExecInsert-->
	<insert id="insertTskExec" parameterType="paramMap">
			/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertTskExec */
			INSERT INTO TBBADEAR035L
			 (
				   AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , DVSN_CD
			     , TSK_KEY1
			     , TSK_KEY2
			     , TSK_KEY3
			     , TSK_KEY4
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH
			 ) VALUES
			 (
			       #{audYr}
			     , #{audNo}
			     , #{dspRqSno}
			     , #{dvsnCd}
			     , #{tskKey1}
			     , #{tskKey2}
			     , #{tskKey3}
			     , #{tskKey4}				    
			     , #{frtUsrId}
			     , #{fnlUsrId}
			     , #{fnlDealDptCd}
			     , #{fnlMnuId}
			     , SYSDATE
			     , SYSDATE
			 ) 
	</insert>
	
	<!-- 처분요구 시행 메인 업데이트  BADEAR003EMasterUpdate -->
	<update id="updateMaster" parameterType="paramMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateMaster */
			DECLARE
			BEGIN	
		<![CDATA[ 	
			UPDATE TBBADEAR001M
			   SET AUD_YR        = #{audYr} 
			     , AUD_NO        = #{audNo} 		
			     , DSP_RQ_SNO    = #{dspRqSno}
		]]>	 
		<if test='frmNo != null and   frmNo  != ""'>	 	
			      ,FRM_NO      = #{frmNo}
		</if>	
		<if test='rprtNo != null and    rprtNo != ""'>	 	
			      ,RPRT_NO      = #{rprtNo}
		</if>		
		<if test='judgNo != null and   judgNo  != ""'>	 	
			      ,JUDG_NO      = #{judgNo}
		</if>	
		<if test='titTxt != null and   titTxt  != ""'>	 	
			      ,TIT_TXT      = #{titTxt}
		</if>	
		<if test='hndSbjTxt != null and    hndSbjTxt != ""'>	 	
			      ,HND_SBJ_TXT      = #{hndSbjTxt}
		</if>	
		<if test='hndlPlanDvsnCd != null and    hndlPlanDvsnCd != ""'>	 	
			      ,HNDL_PLAN_DVSN_CD      = #{hndlPlanDvsnCd}
		</if>	
		<if test='dspRqKndCd != null and   dspRqKndCd  != ""'>	 	
			      ,DSP_RQ_KND_CD      = #{dspRqKndCd}
		</if>	
		<if test='orgDvsnCd != null and    orgDvsnCd != ""'>	 	
			      ,ORG_DVSN_CD      = #{orgDvsnCd}
		</if>	
		<if test='audEpsCd != null and   audEpsCd  != ""'>	 	
			      ,AUD_EPS_CD      = #{audEpsCd}
		</if>
		<if test='fnlUsrId != null and    fnlUsrId != ""'>	       
			      ,FNL_USR_ID      = #{fnlUsrId}
		</if>	
		<if test='fnlDealDptCd != null and   fnlDealDptCd  != ""'>	       
			      ,FNL_DEAL_DPT_CD  = #{fnlDealDptCd}
		</if>		
		<if test='fnlMnuId != null and    fnlMnuId != ""'>	       
			      ,FNL_MNU_ID        = #{fnlMnuId}
		</if>
		<![CDATA[ 	
				 , FNL_MDF_DH        = SYSDATE			
			  WHERE 1=1
			    AND AUD_YR = #{audYr} 
			    AND AUD_NO = #{audNo} 	
			    AND DSP_RQ_SNO = #{dspRqSno}
			    ;
		]]>		
		END;				        
	</update>	

	<!--처분요구상세 update-->
	<update id="updateMasterSub" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateMasterSub */
			<![CDATA[ 	
				UPDATE TBBADEAR002D
				   SET AUD_YR        = #{audYr} 
				     , AUD_NO        = #{audNo} 		
				     , DSP_RQ_SNO    = #{dspRqSno}
			]]>	 
	 
			<if test='dspRqSrno != null  and   dspRqSrno!=""  '>,DSP_RQ_SRNO=#{dspRqSrno} </if>
			<if test='enfDt != null  and  enfDt !=""  '>,ENF_DT=REPLACE(#{enfDt},'-','')  </if>
			<if test='hndlDdlnDt != null  and  hndlDdlnDt !=""  '>,HNDL_DDLN_DT=REPLACE(#{hndlDdlnDt},'-','')  </if>
			<if test='enfBrdvCd != null  and   enfBrdvCd!=""  '>,ENF_BRDV_CD=#{enfBrdvCd} </if>
			<if test='chgrNm != null  and   chgrNm!=""  '>,CHGR_NM=#{chgrNm} </if>
			<if test='docSenNo != null  and   docSenNo!=""  '>,DOC_SEN_NO=#{docSenNo} </if>
			<if test='dspRqIptDt != null  and   dspRqIptDt!=""  '>,DSP_RQ_IPT_DT=#{dspRqIptDt} </if>
			<if test='pscRqtNopCnt != null  and  pscRqtNopCnt !=""  '>,PSC_RQT_NOP_CNT=#{pscRqtNopCnt} </if>
			<if test='pnlDrinPsvtAm != null  and pnlDrinPsvtAm  !=""  '>,PNL_DRIN_PSVT_AM=#{pnlDrinPsvtAm} </if>
			<if test='rsrAm != null  and   rsrAm !=""  '>,RSR_AM=#{rsrAm} </if>
			<if test='splpAm != null  and  splpAm !=""  '>,SPLP_AM=#{splpAm} </if>
			<if test='bgtRdcAm != null  and  bgtRdcAm !=""  '>,BGT_RDC_AM=#{bgtRdcAm} </if>
			<if test='incIcrAm != null  and  incIcrAm !=""  '>,INC_ICR_AM=#{incIcrAm} </if>
			<if test='pplBdnRdtAm != null  and  pplBdnRdtAm !=""  '>,PPL_BDN_RDT_AM=#{pplBdnRdtAm} </if>
			<if test='frtnIncrAm != null  and   frtnIncrAm !=""  '>,FRTN_INCR_AM=#{frtnIncrAm} </if>
			<if test='expnRtnlAm != null  and  expnRtnlAm !=""  '>,EXPN_RTNL_AM=#{expnRtnlAm} </if>
			<if test='ijsAm != null  and   ijsAm !=""  '>,IJS_AM=#{ijsAm} </if>
			<if test='slfHndlRqAm != null  and  slfHndlRqAm !=""  '>,SLF_HNDL_RQ_AM=#{slfHndlRqAm} </if>
			<if test='wrdoCauCd != null  and   wrdoCauCd !=""  '>,WRDO_CAU_CD=#{wrdoCauCd} </if>
			<if test='enfmMngBrdvCd != null  and enfmMngBrdvCd  !=""  '>,ENFM_MNG_BRDV_CD=#{enfmMngBrdvCd} </if>
            <if test='enfBrdvCd != null  and enfBrdvCd  !=""  '>,OD_ENFM_MNG_BRDV_CD=#{enfBrdvCd} </if>
			<if test='dtmYn != null  and dtmYn  !=""  '>,DTM_YN=#{dtmYn} </if>
			<if test='dtmStaCd != null  and  dtmStaCd !=""  '>,DTM_STA_CD=#{dtmStaCd} </if>
			<if test='enfmHstIptDt != null  and enfmHstIptDt  !=""  '>,ENFM_HST_IPT_DT=#{enfmHstIptDt} </if>
			<if test='acntInspCd != null  and  acntInspCd !=""  '>,ACNT_INSP_CD=#{acntInspCd} </if>
			<if test='cpltDt != null  and  cpltDt !=""  '>,CPLT_DT=#{cpltDt} </if>
			<if test='hmpOpenYn != null  and  hmpOpenYn !=""  '>,HMP_OPEN_YN=#{hmpOpenYn} </if>
			<if test='dtyObvUtlYn != null  and  dtyObvUtlYn !=""  '>,DTY_OBV_UTL_YN=#{dtyObvUtlYn} </if>
            <if test='mainEnfmMngTgYn != null  and  mainEnfmMngTgYn !=""  '>,MAIN_ENFM_MNG_TG_YN=#{mainEnfmMngTgYn} </if>
			<if test='am != null  and   am !=""  '>,AM=#{am} </if>
			<if test='nopCnt != null  and  nopCnt !=""  '>,NOP_CNT=#{nopCnt} </if>
			<if test='hndlPlanRptNo != null  and  hndlPlanRptNo !=""  '>,HNDL_PLAN_RPT_NO=#{hndlPlanRptNo} </if>
			<if test='eviCnt != null  and  eviCnt !=""  '>,EVI_CNT=#{eviCnt} </if>
			<if test='totEviCnt != null  and  totEviCnt !=""  '>,TOT_EVI_CNT=#{totEviCnt} </if>
			<if test='wrdoTypCd != null  and  wrdoTypCd !=""  '>,WRDO_TYP_CD=#{wrdoTypCd} </if>
			<if test='dtyInspMtrlTxt != null  and   dtyInspMtrlTxt !=""  '>,DTY_INSP_MTRL_TXT=#{dtyInspMtrlTxt} </if>
			<if test='audPoliCd != null  and  audPoliCd !=""  '>,AUD_POLI_CD=#{audPoliCd} </if>
			<if test='audSphCd != null  and   audSphCd !=""  '>,AUD_SPH_CD=#{audSphCd} </if>
			<if test='audRptYr != null  and   audRptYr !=""  '>,AUD_RPT_YR=#{audRptYr} </if>
			<if test='enfmCpltIptDt != null  and  enfmCpltIptDt !=""  '>,ENFM_CPLT_IPT_DT=#{enfmCpltIptDt} </if>
			<if test='eptEfctAmStaCd != null  and eptEfctAmStaCd  !=""  '>,EPT_EFCT_AM_STA_CD=#{eptEfctAmStaCd} </if>
			<if test='eptEfctDt != null  and  eptEfctDt !=""  '>,EPT_EFCT_DT=#{eptEfctDt} </if>
			<if test='enfmWhlsDtmDt != null  and  enfmWhlsDtmDt !=""  '>,ENFM_WHLS_DTM_DT=#{enfmWhlsDtmDt} </if>
			<if test='slfHndlTxt != null  and  slfHndlTxt !=""  '>,SLF_HNDL_TXT=#{slfHndlTxt} </if>
			<if test='stfSmtInfTxt != null  and  stfSmtInfTxt !=""  '>,STF_SMT_INF_TXT=#{stfSmtInfTxt} </if>
			<if test='coptOfiCd != null  and   coptOfiCd !=""  '>,COPT_OFI_CD=#{coptOfiCd} </if>
			<if test='rltnOrgCd != null  and  rltnOrgCd !=""  '>,RLTN_ORG_CD=#{rltnOrgCd} </if>
			<if test='coptCnt != null  and  coptCnt !=""  '>,COPT_CNT=#{coptCnt} </if>
			<if test='orgCnt != null  and  orgCnt !=""  '>,ORG_CNT=#{orgCnt} </if>
			<if test='dspRqDtmDt != null  and  dspRqDtmDt !=""  '>,DSP_RQ_DTM_DT=#{dspRqDtmDt} </if>
			<if test='dspRqDtmPenId != null  and   dspRqDtmPenId !=""  '>,DSP_RQ_DTM_PEN_ID=#{dspRqDtmPenId} </if>
			<if test='enfmCpltIptPenId != null  and  enfmCpltIptPenId !=""  '>,ENFM_CPLT_IPT_PEN_ID=#{enfmCpltIptPenId} </if>
			<if test='enfmWhlsDtmPenId != null  and  enfmWhlsDtmPenId !=""  '>,ENFM_WHLS_DTM_PEN_ID=#{enfmWhlsDtmPenId} </if>
			<if test='dspRqApvStaCd != null  and  dspRqApvStaCd !=""  '>,DSP_RQ_APV_STA_CD=#{dspRqApvStaCd} </if>
			<if test='dspRqApvStaDt != null  and   dspRqApvStaDt !=""  '>,DSP_RQ_APV_STA_DT=#{dspRqApvStaDt} </if>
			<if test='cpltPenId != null  and   cpltPenId !=""  '>,CPLT_PEN_ID=#{cpltPenId} </if>
			<if test='tskCatCd != null  and  tskCatCd !=""  '>,TSK_CAT_CD=#{tskCatCd} </if>
			<if test='expotYEfctAm != null  and  expotYEfctAm !=""  '>,EXPOT_Y_EFCT_AM=#{expotYEfctAm} </if>
			<if test='enfmWhlsApvKndCd != null  and  enfmWhlsApvKndCd !=""  '>,ENFM_WHLS_APV_KND_CD=#{enfmWhlsApvKndCd} </if>
			<if test='examRprtDspRqSbt != null  and  examRprtDspRqSbt !=""  '>,EXAM_RPRT_DSP_RQ_SBT=#{examRprtDspRqSbt} </if>
			<if test='examRprtUnenfmRtwrTxt != null  and examRprtUnenfmRtwrTxt    !=""  '>,EXAM_RPRT_UNENFM_RTWR_TXT=#{examRprtUnenfmRtwrTxt} </if>
			<if test='examRprtUnenfmRsnExamTxt != null  and  examRprtUnenfmRsnExamTxt !=""  '>,EXAM_RPRT_UNENFM_RSN_EXAM_TXT=#{examRprtUnenfmRsnExamTxt} </if>
			<if test='examRprtApvStaDt != null  and  examRprtApvStaDt !=""  '>,EXAM_RPRT_APV_STA_DT=#{examRprtApvStaDt} </if>
			<if test='examRprtApvDocNo != null  and  examRprtApvDocNo !=""  '>,EXAM_RPRT_APV_DOC_NO=#{examRprtApvDocNo} </if>
			<if test='examRprtApvStaCd != null  and  examRprtApvStaCd !=""  '>,EXAM_RPRT_APV_STA_CD=#{examRprtApvStaCd} </if>
			<if test='clsgPrssStaCd != null  and  clsgPrssStaCd !=""  '>,CLSG_PRSS_STA_CD=#{clsgPrssStaCd} </if>
			<if test='fnlUsrId != null  and  fnlUsrId !=""  '>
				      ,FNL_USR_ID      = #{fnlUsrId}
			</if>	
			<if test='fnlDealDptCd != null  and  fnlDealDptCd !=""  '>
				      ,FNL_DEAL_DPT_CD  = #{fnlDealDptCd}
			</if>		
			<if test='fnlMnuId != null  and  fnlMnuId !=""  '>
				      ,FNL_MNU_ID        = #{fnlMnuId}
			</if>
		
					 , FNL_MDF_DH        = SYSDATE		
					 
			<if test='judRstSbjCd          != null'>,JUD_RST_SBJ_CD=#{judRstSbjCd} </if>
			<if test='judRstRsnTxt         != null'>,JUD_RST_RSN_TXT=#{judRstRsnTxt} </if>
			<if test='judRstSbjHndlRsltTxt != null'>,JUD_RST_SBJ_HNDL_RSLT_TXT=#{judRstSbjHndlRsltTxt} </if>		 
			<if test='immunExamCd != null'>,IMMUN_EXAM_CD=#{immunExamCd} </if>		 
			<if test='immunExamCd != null'>,IMMUN_EXAM_CD2=#{immunExamCd2} </if>		 
			<if test='pasvAdmnExamYn != null'>,PASV_ADMN_EXAM_YN=#{pasvAdmnExamYn}	</if>	 
			<if test='selfYn != null'>,SELF_YN=#{selfYn}	</if>
					 	
				  WHERE 1=1
				    AND AUD_YR = #{audYr} 
				    AND AUD_NO = #{audNo} 	
				    AND DSP_RQ_SNO = #{dspRqSno}
	    					        
	</update>
	
	
	
	<update id="updateGongMaster" parameterType="paramMap">	
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateGongMaster */
		<![CDATA[	
			INSERT INTO TBBADEAR012H
			(
			    CON_NO,
			    AUD_YR,
			    AUD_NO,
			    DSP_RQ_SNO,
			    FRM_NO,
			    RPRT_NO,
			    JUDG_NO,
			    TIT_TXT,
			    HND_SBJ_TXT,
			    HNDL_PLAN_DVSN_CD,
			    DSP_RQ_KND_CD,
			    ORG_DVSN_CD,
			    AUD_EPS_CD,
			    USE_YN,
			    FRT_USR_ID,
			    FNL_USR_ID,
			    FNL_DEAL_DPT_CD,
			    FNL_MNU_ID,
			    FRT_REGI_DH,
			    FNL_MDF_DH
			)
			SELECT (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADEAR012H),
			       AUD_YR,
			       AUD_NO,
			       DSP_RQ_SNO,
			       FRM_NO,
			       RPRT_NO,
			       JUDG_NO,
			       TIT_TXT,
			       HND_SBJ_TXT,
			       HNDL_PLAN_DVSN_CD,
			       DSP_RQ_KND_CD,
			       ORG_DVSN_CD,
			       AUD_EPS_CD,
			       'N',
			       #{frtUsrId},
			       #{fnlUsrId},
			       #{fnlDealDptCd},
			       #{fnlMnuId},
			       SYSDATE,
			       SYSDATE
			  FROM TBBADEAR001M
			 WHERE 1=1
			   AND AUD_YR       = #{audYr}
			   AND AUD_NO       = #{audNo}
			   AND DSP_RQ_SNO   = #{dspRqSno}		
		]]>
	</update>
	
	
		<!--처분요구상세 update-->
	<update id="updateGongMasterSub" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateGongMasterSub */
		<![CDATA[
		INSERT INTO TBBADEAR014H
				(
				    CON_NO,
				    AUD_YR,
				    AUD_NO,
				    DSP_RQ_SNO,
				    DSP_RQ_SRNO,
				    ENF_DT,
				    HNDL_DDLN_DT,
				    ENF_BRDV_CD,
				    CHGR_NM,
				    DOC_SEN_NO,
				    DSP_RQ_IPT_DT,
				    PSC_RQT_NOP_CNT,
				    PNL_DRIN_PSVT_AM,
				    RSR_AM,
				    SPLP_AM,
				    BGT_RDC_AM,
				    INC_ICR_AM,
				    PPL_BDN_RDT_AM,
				    FRTN_INCR_AM,
				    EXPN_RTNL_AM,
				    IJS_AM,
				    SLF_HNDL_RQ_AM,
				    WRDO_CAU_CD,
				    ENFM_MNG_BRDV_CD,
				    DTM_YN,
				    DTM_STA_CD,
				    ENFM_HST_IPT_DT,
				    ACNT_INSP_CD,
				    CPLT_DT,
				    HMP_OPEN_YN,
				    DTY_OBV_UTL_YN,
				    AM,
				    NOP_CNT,
				    HNDL_PLAN_RPT_NO,
				    EVI_CNT,
				    TOT_EVI_CNT,
				    WRDO_TYP_CD,
				    DTY_INSP_MTRL_TXT,
				    AUD_POLI_CD,
				    AUD_SPH_CD,
				    AUD_RPT_YR,
				    ENFM_CPLT_IPT_DT,
				    EPT_EFCT_AM_STA_CD,
				    EPT_EFCT_DT,
				    ENFM_WHLS_DTM_DT,
				    SLF_HNDL_TXT,
				    STF_SMT_INF_TXT,
				    COPT_OFI_CD,
				    RLTN_ORG_CD,
				    COPT_CNT,
				    ORG_CNT,
				    DSP_RQ_DTM_DT,
				    DSP_RQ_DTM_PEN_ID,
				    ENFM_CPLT_IPT_PEN_ID,
				    ENFM_WHLS_DTM_PEN_ID,
				    DSP_RQ_APV_STA_CD,
				    APV_DOC_NO,
				    DSP_RQ_APV_STA_DT,
				    CPLT_PEN_ID,
				    TSK_CAT_CD,
				    APV_DOC_GRP_NO,
				    EXPOT_Y_EFCT_AM,
				    ENFM_WHLS_APV_KND_CD,
				    EXAM_RPRT_DSP_RQ_SBT,
				    EXAM_RPRT_UNENFM_RTWR_TXT,
				    EXAM_RPRT_UNENFM_RSN_EXAM_TXT,
				    EXAM_RPRT_APV_STA_DT,
				    EXAM_RPRT_APV_DOC_NO,
				    EXAM_RPRT_APV_STA_CD,
				    CLSG_PRSS_STA_CD,
				    USE_YN,
				    FRT_USR_ID,
				    FNL_USR_ID,
				    FNL_DEAL_DPT_CD,
				    FNL_MNU_ID,
				    FRT_REGI_DH,
				    FNL_MDF_DH
				)
				SELECT (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADEAR014H),
				        AUD_YR,
				        AUD_NO,
				        DSP_RQ_SNO,
				        DSP_RQ_SRNO,
				        ENF_DT,
				        HNDL_DDLN_DT,
				        ENF_BRDV_CD,
				        CHGR_NM,
				        DOC_SEN_NO,
				        DSP_RQ_IPT_DT,
				        PSC_RQT_NOP_CNT,
				        PNL_DRIN_PSVT_AM,
				        RSR_AM,
				        SPLP_AM,
				        BGT_RDC_AM,
				        INC_ICR_AM,
				        PPL_BDN_RDT_AM,
				        FRTN_INCR_AM,
				        EXPN_RTNL_AM,
				        IJS_AM,
				        SLF_HNDL_RQ_AM,
				        WRDO_CAU_CD,
				        ENFM_MNG_BRDV_CD,
				        DTM_YN,
				        DTM_STA_CD,
				        ENFM_HST_IPT_DT,
				        ACNT_INSP_CD,
				        CPLT_DT,
				        HMP_OPEN_YN,
				        DTY_OBV_UTL_YN,
				        AM,
				        NOP_CNT,
				        HNDL_PLAN_RPT_NO,
				        EVI_CNT,
				        TOT_EVI_CNT,
				        WRDO_TYP_CD,
				        DTY_INSP_MTRL_TXT,
				        AUD_POLI_CD,
				        AUD_SPH_CD,
				        AUD_RPT_YR,
				        ENFM_CPLT_IPT_DT,
				        EPT_EFCT_AM_STA_CD,
				        EPT_EFCT_DT,
				        ENFM_WHLS_DTM_DT,
				        SLF_HNDL_TXT,
				        STF_SMT_INF_TXT,
				        COPT_OFI_CD,
				        RLTN_ORG_CD,
				        COPT_CNT,
				        ORG_CNT,
				        DSP_RQ_DTM_DT,
				        DSP_RQ_DTM_PEN_ID,
				        ENFM_CPLT_IPT_PEN_ID,
				        ENFM_WHLS_DTM_PEN_ID,
				        DSP_RQ_APV_STA_CD,
				        APV_DOC_NO,
				        DSP_RQ_APV_STA_DT,
				        CPLT_PEN_ID,
				        TSK_CAT_CD,
				        APV_DOC_GRP_NO,
				        EXPOT_Y_EFCT_AM,
				        ENFM_WHLS_APV_KND_CD,
				        EXAM_RPRT_DSP_RQ_SBT,
				        EXAM_RPRT_UNENFM_RTWR_TXT,
				        EXAM_RPRT_UNENFM_RSN_EXAM_TXT,
				        EXAM_RPRT_APV_STA_DT,
				        EXAM_RPRT_APV_DOC_NO,
				        EXAM_RPRT_APV_STA_CD,
				        CLSG_PRSS_STA_CD,
				        'N',
				        #{frtUsrId},
				        #{fnlUsrId},
				        #{fnlDealDptCd},
				        #{fnlMnuId},
				        SYSDATE,
				        SYSDATE
				  FROM TBBADEAR002D
				 WHERE 1=1
				   AND AUD_YR       = #{audYr}
				   AND AUD_NO       = #{audNo}
				   AND DSP_RQ_SNO   = #{dspRqSno}
			  	
		]]>
	</update>
	
	<!--실시구분 삭제 delete  BADEAR003ETskExecDelete -->
	<update id="deleteTskExec" parameterType="paramMap">
			/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.deleteTskExec */
			DELETE 
			  FROM TBBADEAR035L
			 WHERE AUD_YR     = #{audYr} 
			   AND AUD_NO     = #{audNo}
			   AND DSP_RQ_SNO = #{dspRqSno}
               AND DVSN_CD IN ( SELECT CD 
                                  FROM TBDCMACM013C
                                 WHERE CMM_CD_DVSN_CD            = '1000742'
                                   AND SUBSTR(USR_DFN_TXT_3, -1) = '1' )   /* 처분요구에서 입력한 실시구분만 조회되도록 수정함 - 2018.09.06 yyh */	
	</update>
	
	
	<!-- 회계사항   MAX_ACNT_SBJ_SNO 조회-->
	<select id="selectAcctMax" parameterType="paramMap"		resultType="egovMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectAcctMax */
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(ACNT_SBJ_SNO)),0)+1) AS MAX_ACNT_SBJ_SNO
				  FROM TBBADEAR003M
				 WHERE 1=1
					AND AUD_YR = #{audYr}
					AND AUD_NO = #{audNo}
					AND DSP_RQ_SNO = #{dspRqSno}
		]]>
	</select>
	


	<!--회계사항 insert BADEAR003EAcctInsert -->
	<insert id="insertAcct" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertAcct */
		<![CDATA[
		DECLARE
			BEGIN			
			INSERT INTO TBBADEAR003M (
			       AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , ACNT_SBJ_SNO
			     , DSP_RQ_ACNT_CD
			     , EPT_EFCT_DVSN_CD
			     , ACNT_YE
			     , PNL_DRIN_PSVT_AM
			     , RSR_AM
			     , SPLP_AM
			     , EPT_EFCT_AM
			     , EXPOT_Y_EFCT_AM
			     , EXPOT_Y_EFCT_AM_CALC_BAS_TXT
			     , ETC_ACNT_NM
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH
			     , EXPOT_Y_EFCT_AM_APC_YN
			     , BGT_RFC_NCSY_YN
			) VALUES(
			       #{audYr}
			     , #{audNo}
			     , #{dspRqSno}
			     , #{acntSbjSno}
			     , #{dspRqAcntCd ,jdbcType=VARCHAR}
			     , #{eptEfctDvsnCd ,jdbcType=VARCHAR}
			     , #{acntYe ,jdbcType=VARCHAR}
			     , #{pnlDrinPsvtAm, jdbcType=INTEGER}
			     , #{rsrAm  ,jdbcType=INTEGER}
			     , #{splpAm ,jdbcType=INTEGER}
			     , #{eptEfctAm  ,jdbcType=INTEGER}
			     , #{expotYEfctAm ,jdbcType=INTEGER}
			     , #{expotYEfctAmCalcBasTxt ,jdbcType=VARCHAR}
			     , #{etcAcntNm  ,jdbcType=VARCHAR}
			     , #{frtUsrId  ,jdbcType=VARCHAR}
			     , #{fnlUsrId  ,jdbcType=VARCHAR}
			     , #{fnlDealDptCd  ,jdbcType=VARCHAR}
			     , #{fnlMnuId}
			     , SYSDATE
			     , SYSDATE
			     , #{expotYEfctAmApcYn ,jdbcType=VARCHAR}
			     , #{bgtRfcNcsyYn ,jdbcType=VARCHAR}
			);
		END;			
		]]>
	</insert>
	
	
	<!-- 이력 Max값 찾기 -->
	<select id="selectHistoryMax" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectHistoryMax */
        <![CDATA[     	
			SELECT TO_CHAR(NVL(MAX(TO_NUMBER(HST_SNO)),0)+1) AS MAX_HST_SNO
			  FROM TBBADEAR009H
			 WHERE 1=1
			   AND AUD_YR     = #{audYr}      
			   AND AUD_NO     = #{audNo} 		
			   AND DSP_RQ_SNO = #{dspRqSno}   
		]]>
	</select>
	
	
	
	<!-- 회계사항 수정시 처분요구상세에 회계사항 관련 컬럼을 Update 한다. BADEAR003EAcctToDetailUpdate -->
	<update id="updateAcctToDetail" parameterType="paramMap">
	<![CDATA[ 	
		UPDATE TBBADEAR002D D1
		   SET ( BGT_RDC_AM         /*예산절감*/
		       , INC_ICR_AM         /*수입증대*/
		       , PPL_BDN_RDT_AM     /*국민부담경감금액*/
		       , FRTN_INCR_AM       /*재산증가*/
		       , EXPN_RTNL_AM       /*지출합리화*/
		       , PNL_DRIN_PSVT_AM   /*추징회수보전금액*/ 
		       , RSR_AM             /*환급금액*/
		       , SPLP_AM            /*추급금액*/
		       , EXPOT_Y_EFCT_AM    /*사후적효과금액*/
		       
		       ) = (SELECT SUM(DECODE(EPT_EFCT_DVSN_CD,'1',EPT_EFCT_AM,''))     AS EPT_EFCT_AM1                 /*예산절감*/
		                 , SUM(DECODE(EPT_EFCT_DVSN_CD,'2',EPT_EFCT_AM,''))     AS EPT_EFCT_AM2                 /*수입증대*/
		                 , SUM(DECODE(EPT_EFCT_DVSN_CD,'3',EPT_EFCT_AM,''))     AS EPT_EFCT_AM3                 /*국민편익*/
		                 , SUM(DECODE(EPT_EFCT_DVSN_CD,'4',EPT_EFCT_AM,''))     AS EPT_EFCT_AM4                 /*재산증가*/     
		                 , SUM(DECODE(EPT_EFCT_DVSN_CD,'5',EPT_EFCT_AM,''))     AS EPT_EFCT_AM5                 /*지출합리화*/    
		                 , SUM(PNL_DRIN_PSVT_AM)                                AS PNL_DRIN_PSVT_AM             /*추징회수보전금액*/
		                 , SUM(RSR_AM)                                          AS RSR_AM                       /*환급금액*/
		                 , SUM(SPLP_AM)                                         AS SPLP_AM                      /*추급금액*/
		                 , SUM(EXPOT_Y_EFCT_AM)                                 AS EXPOT_Y_EFCT_AM              /*사후적효과금액*/
		              FROM TBBADEAR003M
		             WHERE 1=1
		               AND AUD_YR       = D1.AUD_YR
		               AND AUD_NO       = D1.AUD_NO
		               AND DSP_RQ_SNO   = D1.DSP_RQ_SNO
		             GROUP BY AUD_YR
		                    , AUD_NO
		                    , DSP_RQ_SNO)
		 WHERE 1=1
		   AND D1.AUD_YR        = #{audYr}
		   AND D1.AUD_NO        = #{audNo}
		   AND D1.DSP_RQ_SNO    = #{dspRqSno}
	]]>			    					        
</update>	


	
	
	<!-- 회계사항 Update -->
	<update id="updateAcct" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateAcct */
		<![CDATA[ 	
		DECLARE
			BEGIN		
			UPDATE TBBADEAR003M
			   SET AUD_YR        = #{audYr} 
			     , AUD_NO        = #{audNo} 		
			     , DSP_RQ_SNO    = #{dspRqSno}
			     , ACNT_SBJ_SNO  = #{acntSbjSno}
   
		]]>	 
		<if test='dspRqAcntCd  != null and    dspRqAcntCd!= "" '>	
			     ,DSP_RQ_ACNT_CD	= #{dspRqAcntCd}
		</if>	
		<if test='eptEfctDvsnCd  != null and   eptEfctDvsnCd != "" '>	
			     ,EPT_EFCT_DVSN_CD	= #{eptEfctDvsnCd}	
		</if>		  		
		<if test='acntYe  != null and   acntYe != "" '>	       
			     ,ACNT_YE      = #{acntYe}
		</if>	
		<if test='pnlDrinPsvtAm  != null and   pnlDrinPsvtAm != "" '>	       
			      ,PNL_DRIN_PSVT_AM      = #{pnlDrinPsvtAm}
		</if>	
		<if test='rsrAm  != null and   rsrAm != "" '>	       
			      ,RSR_AM      = #{rsrAm}
		</if>	
		<if test='splpAm  != null and  splpAm  != "" '>	       
			      ,SPLP_AM      = #{splpAm}
		</if>	
		<if test='eptEfctAm  != null and  eptEfctAm  != "" '>	       
			      ,EPT_EFCT_AM      = #{eptEfctAm}
		</if>	
		<if test='expotYEfctAm  != null and   expotYEfctAm != "" '>	       
			      ,EXPOT_Y_EFCT_AM      = #{expotYEfctAm}
		</if>	
		<if test='expotYEfctAmCalcBasTxt  != null and   expotYEfctAmCalcBasTxt != "" '>	       
			      ,EXPOT_Y_EFCT_AM_CALC_BAS_TXT      = #{expotYEfctAmCalcBasTxt}
		</if>				
		<if test='fnlUsrId  != null and   fnlUsrId != "" '>	       
			      ,FNL_USR_ID      = #{fnlUsrId}
		</if>	
		<if test='fnlDealDptCd  != null and   fnlDealDptCd != "" '>	       
			      ,FNL_DEAL_DPT_CD  = #{fnlDealDptCd}
		</if>		
		<if test='fnlMnuId  != null and  fnlMnuId  != "" '>	       
			      ,FNL_MNU_ID        = #{fnlMnuId}
		</if>
		<if test='etcAcntNm  != null and   etcAcntNm != "" '>	       
			      ,ETC_ACNT_NM        = #{etcAcntNm}
		</if>	
		<if test='expotYEfctAmApcYn  != null and   expotYEfctAmApcYn != "" '>	       
			      ,EXPOT_Y_EFCT_AM_APC_YN  = #{expotYEfctAmApcYn}
		</if>
		<if test='bgtRfcNcsyYn  != null and   bgtRfcNcsyYn != "" '>	       
			      ,BGT_RFC_NCSY_YN  = #{bgtRfcNcsyYn}
		</if>	
		<![CDATA[ 	
				 , FNL_MDF_DH        = SYSDATE			
			  WHERE 1=1
			    AND AUD_YR 		= #{audYr} 
			    AND AUD_NO 		= #{audNo} 	
			    AND DSP_RQ_SNO 	= #{dspRqSno}
			    AND ACNT_SBJ_SNO		= #{acntSbjSno}				    
			  ; 
		END; 				  
		]]>			    					        
	</update>
	
	
	
	
	
	
		<!-- 회계사항 Update  BADEAR010EGongAcctUpdate-->
		<update id="updateGongAcct" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateGongAcct */
		<![CDATA[ 	
		DECLARE
			BEGIN		
				INSERT INTO TBBADEAR022H
				(
				    CON_NO,
				    AUD_YR,
				    AUD_NO,
				    DSP_RQ_SNO,
				    ACNT_SBJ_SNO,
				    DSP_RQ_ACNT_CD,
				    EPT_EFCT_DVSN_CD,
				    ACNT_YE,
				    PNL_DRIN_PSVT_AM,
				    RSR_AM,
				    SPLP_AM,
				    EPT_EFCT_AM,
				    EXPOT_Y_EFCT_AM,
				    EXPOT_Y_EFCT_AM_CALC_BAS_TXT,
				    DSP_RQ_BK_ACNT_CD,
				    USE_YN,
				    FRT_USR_ID,
				    FNL_USR_ID,
				    FNL_DEAL_DPT_CD,
				    FNL_MNU_ID,
				    FRT_REGI_DH,
				    FNL_MDF_DH
				)
				SELECT  (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADEAR022H),
				        AUD_YR,
				        AUD_NO,
				        DSP_RQ_SNO,
				        ACNT_SBJ_SNO,
				        DSP_RQ_ACNT_CD,
				        EPT_EFCT_DVSN_CD,
				        ACNT_YE,
				        PNL_DRIN_PSVT_AM,
				        RSR_AM,
				        SPLP_AM,
				        EPT_EFCT_AM,
				        EXPOT_Y_EFCT_AM,
				        EXPOT_Y_EFCT_AM_CALC_BAS_TXT,
				        DSP_RQ_BK_ACNT_CD, 
				        'N',
				        #{frtUsrId},
				        #{fnlUsrId},
				        #{fnlDealDptCd},
				        #{fnlMnuId},
				        SYSDATE,
				        SYSDATE        
				  FROM TBBADEAR003M
				WHERE 1=1
				  AND AUD_YR 		= #{audYr} 
				  AND AUD_NO 		= #{audNo} 	 
				  AND DSP_RQ_SNO 	= #{dspRqSno}
				  AND ACNT_SBJ_SNO	= #{acntSbjSno}	
				;  	
		END; 				  
		]]>			    					        
	</update>
	
	
	
	<!-- 회계사항 이력 insert BADEAR003EAcctHisInsert -->
	<insert id="insertAcctHis" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertAcctHis */
		<![CDATA[
			INSERT INTO TBBADEAR009H (
			       AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , ACNT_SBJ_SNO
			     , DSP_RQ_ACNT_CD
			     , EPT_EFCT_DVSN_CD
			     , HST_SNO
			     , ACNT_YE
			     , PNL_DRIN_PSVT_AM
			     , RSR_AM
			     , SPLP_AM
			     , EPT_EFCT_AM
			     , EXPOT_Y_EFCT_AM
			     , EXPOT_Y_EFCT_AM_CALC_BAS_TXT
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH 
			) 
			SELECT AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , ACNT_SBJ_SNO
			     , DSP_RQ_ACNT_CD
			     , EPT_EFCT_DVSN_CD
			     , (
						SELECT TO_CHAR(NVL(MAX(TO_NUMBER(HST_SNO)),0)+1) AS MAX_HST_SNO
						  FROM TBBADEAR009H
						 WHERE 1=1
						   AND AUD_YR     = #{audYr}
						   AND AUD_NO     = #{audNo}
						   AND DSP_RQ_SNO = #{dspRqSno}
			       )
			     , ACNT_YE
			     , PNL_DRIN_PSVT_AM
			     , RSR_AM
			     , SPLP_AM
			     , EPT_EFCT_AM
			     , EXPOT_Y_EFCT_AM
			     , EXPOT_Y_EFCT_AM_CALC_BAS_TXT
			     , #{frtUsrId}
			     , #{fnlUsrId}
			     , #{fnlDealDptCd}
			     , #{fnlMnuId}
			     , SYSDATE
			     , SYSDATE
			  FROM TBBADEAR003M
			 WHERE 1=1
			   AND AUD_YR     = #{audYr}
			   AND AUD_NO     = #{audNo}
			   AND DSP_RQ_SNO = #{dspRqSno}
		]]>
	</insert>	




	  
	<!--관계기관 조회   BADEAR003ERltnSelect -->   
	<select id="selectRltn" parameterType="paramMap" resultType="egovMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectRltn */
        <![CDATA[	
            SELECT AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , RLTN_ORG_CD
			     , RLTN_ORG_DVSN_CD 
		      FROM TBBADEAR006M
			 WHERE 1=1         
			   AND AUD_YR       = #{audYr}    
			   AND AUD_NO       = #{audNo}    
			   AND DSP_RQ_SNO   = #{dspRqSno}         
			   AND RLTN_ORG_CD  = #{rltnOrgCd}
        ]]>
	</select>
	
	
	<update id="BADEAR003EEnFmMngBrdvCdUpdate" parameterType="paramMap">
        <![CDATA[	
			UPDATE TBBADEAR002D MST
			   SET ENFM_MNG_BRDV_CD  = (    SELECT D2.ENFM_DPT_CD 
			                                  FROM (
			                                        SELECT TBBADEAR006M.*, ROW_NUMBER() OVER( ORDER BY FRT_REGI_DH) ROW_NUM 
			                                          FROM TBBADEAR006M
			                                         WHERE 1=1
			                                           AND AUD_YR      = #{audYr} 
			                                           AND AUD_NO      = #{audNo} 	
			                                           AND DSP_RQ_SNO  = #{dspRqSno}	        
			                                        ) D1
			                                     , TBDCMACM015M D2
			                                 WHERE 1=1
			                                   AND D1.RLTN_ORG_CD = D2.ORG_CD
			                                   AND ROW_NUM = '1'
			                            ) 
			  WHERE 1=1
			    AND MST.AUD_YR       = #{audYr} 
			    AND MST.AUD_NO       = #{audNo} 	
			    AND MST.DSP_RQ_SNO   = #{dspRqSno}	        
        ]]>
	</update>
	
	
	<!-- 관계기관 insert 2015.03.25 yyh BADEAR010EGongRltnInsert_1  -->
	<insert id="insertGongRltnInsert" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertGongRltnInsert */
		DECLARE
			BEGIN			
		<![CDATA[	
			  FOR CS IN ( 
			    SELECT AUD_YR
			         , AUD_NO
			         , DSP_RQ_SNO
			         , RLTN_ORG_CD
				  FROM TBBADEAR006M
				 WHERE 1=1
				   AND AUD_YR 		= #{audYr} 
				   AND AUD_NO 		= #{audNo} 	
				   AND DSP_RQ_SNO 	= #{dspRqSno}	
				   AND RLTN_ORG_CD  = #{rltnOrgCd}
			   )
			LOOP			
				INSERT INTO TBBADEAR021H
				(
				    CON_NO,
				    AUD_YR,
				    AUD_NO,
				    DSP_RQ_SNO,
				    RLTN_ORG_CD,
				    CON_HNDL_CD,
				    USE_YN,
				    FRT_USR_ID,
				    FNL_USR_ID,
				    FNL_DEAL_DPT_CD,
				    FNL_MNU_ID,
				    FRT_REGI_DH,
				    FNL_MDF_DH
				)
				VALUES
				(
				    (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADEAR021H),
				    CS.AUD_YR,
				    CS.AUD_NO,
				    CS.DSP_RQ_SNO,
				    CS.RLTN_ORG_CD,
				    'C',
				    'N',
				    #{frtUsrId},
				    #{fnlUsrId},
				    #{fnlDealDptCd},
				    #{fnlMnuId},
				    SYSDATE,
				    SYSDATE
				);	
			END LOOP;
		]]>				
		END;	
	</insert>
	
	<!--관계기관 insert 2015.03.25 yyh   BADEAR010EGongRltnDelete_1 -->
	<update id="deleteGongRltn" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.deleteGongRltn */
		<![CDATA[
		DECLARE
			BEGIN	
			  FOR CS IN ( 
			    SELECT AUD_YR
			         , AUD_NO
			         , DSP_RQ_SNO
			         , RLTN_ORG_CD
				  FROM TBBADEAR006M
				 WHERE 1=1
				   AND AUD_YR 		= #{audYr} 
				   AND AUD_NO 		= #{audNo} 	
				   AND DSP_RQ_SNO 	= #{dspRqSno}	
                   AND RLTN_ORG_CD  = #{rltnOrgCd}				   
			   )
			LOOP
		
					INSERT INTO TBBADEAR021H
					(
					    CON_NO,
					    AUD_YR,
					    AUD_NO,
					    DSP_RQ_SNO,
					    RLTN_ORG_CD,
					    CON_HNDL_CD,
					    USE_YN,
					    FRT_USR_ID,
					    FNL_USR_ID,
					    FNL_DEAL_DPT_CD,
					    FNL_MNU_ID,
					    FRT_REGI_DH,
					    FNL_MDF_DH
					)
					VALUES
					(
					    (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADEAR021H),
					    CS.AUD_YR,
					    CS.AUD_NO,
					    CS.DSP_RQ_SNO,
					    CS.RLTN_ORG_CD,
					    'D',
					    'N',
					    #{frtUsrId},
					    #{fnlUsrId},
					    #{fnlDealDptCd},
					    #{fnlMnuId},
					    SYSDATE,
					    SYSDATE
					);					
			END LOOP ;	
		END;	
	]]>	
	</update>	
	
	           
	<!--관계자 조회 BADEAR003EDfntSelect-->   
	<select id="selectDfnt" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectDfnt */
        <![CDATA[
			SELECT AUD_YR       
			     , AUD_NO
			     , DSP_RQ_SNO
			     , RLTN_ORG_CD
			     , DFNT_SNO
			     , AD
			     , OCP_CD
			     , RANK_CD
			     , DFNT_NAM
			     , EIN
			     , BK_COM_AD
			     , CMPY_NM
			     , ACNT_NM
			     , HND_CD
			     , AM
			     , CPLT_YN
			     , HND_RQ_KND_CD
			     , CPLT_DT
			     , CPLT_PEN_ID
			     , SDY_GRT_AM
			     , SDY_GRT_RSN
			     , PST_NM
			     , RMK_TXT
			  FROM TBBADEAR007M
			 WHERE 1=1         
			   AND AUD_YR       = #{audYr} 
			   AND AUD_NO       = #{audNo} 	
			   AND DSP_RQ_SNO   = #{dspRqSno}	
			   AND RLTN_ORG_CD  = #{rltnOrgCd}			 
        ]]>
	</select>      
        
	<!--관계기관 insert  BADEAR003ERltnInsert-->
	<insert id="insertRltn" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertRltn */
		DECLARE
			BEGIN			
		<![CDATA[
			INSERT INTO TBBADEAR006M ( 
			       AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , RLTN_ORG_CD
			     , RLTN_ORG_DVSN_CD
			     , DSP_RQ_TG_KND_CD
			     , CPLT_YN
			     , CPLT_DT
			     , CPLT_PEN_ID
			     , SLF_ACP_STA_CD
			     , SLF_APV_DT
			     , SLF_ACP_DT
			     , ENFM_MNG_ORG_CD
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH
			     , FRT_USR_ID
			) VALUES ( 
			       #{audYr}
			     , #{audNo}
			     , #{dspRqSno}
			     , #{rltnOrgCd}
			     , #{rltnOrgDvsnCd  ,jdbcType=VARCHAR}
			     , #{dspRqTgKndCd ,jdbcType=VARCHAR}
			     , #{cpltYn ,jdbcType=VARCHAR}
			     , #{cpltDt ,jdbcType=VARCHAR}
			     , #{cpltPenId ,jdbcType=VARCHAR}
			     , #{slfAcpStaCd ,jdbcType=VARCHAR}
			     , #{slfApvDt ,jdbcType=VARCHAR}
			     , #{slfAcpDt ,jdbcType=VARCHAR}
			     , #{enfmMngOrgCd ,jdbcType=VARCHAR}
			     , #{fnlUsrId ,jdbcType=VARCHAR}
			     , #{fnlDealDptCd ,jdbcType=VARCHAR}
			     , #{fnlMnuId ,jdbcType=VARCHAR}
			     , SYSDATE
			     , SYSDATE
			     , #{frtUsrId ,jdbcType=VARCHAR}
			) ;
		]]>
		END;	
	</insert>	        

	<!--관계자 insert  BADEAR003EDfntInsert -->
	<insert id="insertDfnt" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertDfnt */
		DECLARE
			BEGIN	
		<![CDATA[
			INSERT INTO TBBADEAR007M ( 
			       AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , RLTN_ORG_CD
			     , DFNT_SNO
			     , AD
			     , OCP_CD
			     , RANK_CD
			     , DFNT_NAM
			     , EIN
			     , BK_COM_AD
			     , CMPY_NM
			     , ACNT_NM
			     , HND_CD
			     , AM
			     , CPLT_YN
			     , HND_RQ_KND_CD
			     , CPLT_DT
			     , CPLT_PEN_ID
			     , SDY_GRT_AM
			     , SDY_GRT_RSN
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH
			     , PST_NM
			     , RMK_TXT
			 ) VALUES ( 
			       #{audYr}
			     , #{audNo}
			     , #{dspRqSno}
			     , #{rltnOrgCd}
			     , #{dfntSno}
			     , #{ad  ,jdbcType=VARCHAR}
			     , #{ocpCd ,jdbcType=VARCHAR}
			     , #{rankCd ,jdbcType=VARCHAR}
			     , #{dfntNam ,jdbcType=VARCHAR}
			     , #{ein ,jdbcType=VARCHAR}
			     , #{bkComAd ,jdbcType=VARCHAR}
			     , #{cmpyNm ,jdbcType=VARCHAR}
			     , #{acntNm ,jdbcType=VARCHAR}
			     , #{hndCd ,jdbcType=VARCHAR}
			     , #{am ,jdbcType=VARCHAR}
			     , #{cpltYn ,jdbcType=VARCHAR}
			     , SUBSTR(#{hndCd ,jdbcType=VARCHAR}, 4)
			     , #{cpltDt ,jdbcType=VARCHAR}
			     , #{cpltPenId ,jdbcType=VARCHAR}
			     , #{sdyGrtAm ,jdbcType=VARCHAR}
			     , #{sdyGrtRsn ,jdbcType=VARCHAR}
			     , #{frtUsrId ,jdbcType=VARCHAR}
			     , #{fnlUsrId ,jdbcType=VARCHAR}
			     , #{fnlDealDptCd ,jdbcType=VARCHAR}
			     , #{fnlMnuId ,jdbcType=VARCHAR}
			     , SYSDATE
			     , SYSDATE
			     , #{pstNm ,jdbcType=VARCHAR}
			     , #{rmkTxt ,jdbcType=VARCHAR}
			 )
			 ;		
		]]>
		END;
	</insert>
	
	<!-- 관계기관 Update  BADEAR003ERltnUpdate -->
	<update id="updateRltn" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateRltn */
		DECLARE
			BEGIN		
			<![CDATA[ 	
				UPDATE TBBADEAR006M
				   SET AUD_YR        = #{audYr} 
				     , AUD_NO        = #{audNo} 		
				     , DSP_RQ_SNO    = #{dspRqSno}		
				     , RLTN_ORG_CD   = #{rltnOrgCd}     
			]]>	 
			<if test='rltnOrgDvsnCd  != null and  rltnOrgDvsnCd  != "" '>	       
				      ,RLTN_ORG_DVSN_CD      = #{rltnOrgDvsnCd}
			</if>
			<if test='dspRqTgKndCd   != null and  dspRqTgKndCd != "" '>	       
				      ,DSP_RQ_TG_KND_CD      = #{dspRqTgKndCd}
			</if>

			<if test='enfmMngOrgCd  != null and  enfmMngOrgCd != "" '>	       
				      ,ENFM_MNG_ORG_CD      = #{enfmMngOrgCd}
			</if>
				      ,FNL_USR_ID      = #{fnlUsrId}
				      ,FNL_DEAL_DPT_CD  = #{fnlDealDptCd}
				      ,FNL_MNU_ID        = #{fnlMnuId}
			<![CDATA[ 	
					 , FNL_MDF_DH        = SYSDATE			
				  WHERE 1=1
				    AND AUD_YR 		= #{audYr} 
				    AND AUD_NO 		= #{audNo} 	
				    AND DSP_RQ_SNO 	= #{dspRqSno}	
				    AND RLTN_ORG_CD = #{rltnOrgCd}		
				    ;	    
			]]>			    					        
		END;
	</update>
	
	<!-- 관계자 Update  BADEAR003EDfntUpdate-->
	<update id="updateDfnt" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateDfnt */
		<![CDATA[ 	
		DECLARE
			BEGIN				
			UPDATE TBBADEAR007M
			   SET AUD_YR        = #{audYr} 
			     , AUD_NO        = #{audNo} 		
			     , DSP_RQ_SNO    = #{dspRqSno}		
			     , RLTN_ORG_CD   = #{rltnOrgCd}    
			     , DFNT_SNO      = #{dfntSno} 
		]]>	 
		<if test='ad != null   and     ad != "" '>	       
			      ,AD      = #{ad}
		</if>
		<if test='ocpCd != null   and    ocpCd  != "" '>	       
			      ,OCP_CD      = #{ocpCd}
		</if>
		<if test='rankCd != null   and    rankCd  != "" '>	       
			      ,RANK_CD      = #{rankCd}
		</if>
		<if test='dfntNam != null   and    dfntNam  != "" '>	       
			      ,DFNT_NAM      = #{dfntNam}
		</if>
		<if test='ein != null   and    ein  != "" '>	       
			      ,EIN      = #{ein}
		</if>
		<if test='bkComAd != null   and    bkComAd  != "" '>	       
			      ,BK_COM_AD      = #{bkComAd}
		</if>
		<if test='cmpyNm != null   and    cmpyNm  != "" '>	       
			      ,CMPY_NM      = #{cmpyNm}
		</if>
		<if test='acntNm != null   and     acntNm != "" '>	       
			      ,ACNT_NM      = #{acntNm}
		</if>
		<if test='hndCd != null   and    hndCd  != "" '>	       
			      ,HND_CD      = #{hndCd}
		</if>
		<if test='am != null   and     am != "" '>	       
			      ,AM      = #{am}
		</if>
		<if test='cpltYn != null   and     cpltYn != "" '>	       
			      ,CPLT_YN      = #{cpltYn}
		</if>
		<if test='hndCd != null   and    hndCd  != "" '>	       
			      ,HND_RQ_KND_CD      = SUBSTR(#{hndCd}, 4) 
		</if>
		<if test='cpltDt != null   and     cpltDt != "" '>	       
			      ,CPLT_DT      = #{cpltDt}
		</if>
		<if test='cpltPenId != null   and     cpltPenId != "" '>	       
			      ,CPLT_PEN_ID      = #{cpltPenId}
		</if>
		<if test='sdyGrtAm != null   and    sdyGrtAm  != "" '>	       
			      ,SDY_GRT_AM      = #{sdyGrtAm}
		</if>
		<if test='sdyGrtRsn != null   and     sdyGrtRsn != "" '>	       
			      ,SDY_GRT_RSN      = #{sdyGrtRsn}
		</if>
		<if test='fnlUsrId != null   and     fnlUsrId != "" '>	       
			      ,FNL_USR_ID      = #{fnlUsrId}
		</if>	
		<if test='fnlDealDptCd != null   and    fnlDealDptCd  != "" '>	       
			      ,FNL_DEAL_DPT_CD  = #{fnlDealDptCd}
		</if>		
		<if test='fnlMnuId != null   and    fnlMnuId  != "" '>	       
			      ,FNL_MNU_ID        = #{fnlMnuId}
		</if>
		<if test='pstNm != null   and    pstNm  != "" '>	       
			      ,PST_NM        = #{pstNm}
		</if>
		<if test='rmkTxt != null   and    rmkTxt  != "" '>	       
			      ,RMK_TXT        = #{rmkTxt}
		</if>
		<![CDATA[ 	
				 , FNL_MDF_DH        = SYSDATE			
			  WHERE 1=1
			    AND AUD_YR 		= #{audYr} 
			    AND AUD_NO 		= #{audNo} 	
			    AND DSP_RQ_SNO 	= #{dspRqSno}	
			    AND RLTN_ORG_CD = #{rltnOrgCd}		
			    AND DFNT_SNO    = #{dfntSno} 	 
			; 			
		END;							       
		]]>			    					        
	</update>
	
	
	<!--관계기관 delete  BADEAR003ERltnDelete-->
	<update id="deleteRltn" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.deleteRltn */
		DECLARE
			BEGIN	
			  FOR CS IN ( 
			    SELECT AUD_YR
			         , AUD_NO
			         , DSP_RQ_SNO
			         , RLTN_ORG_CD
				  FROM TBBADEAR006M
				 WHERE 1=1
				   AND AUD_YR 		= #{audYr} 
				   AND AUD_NO 		= #{audNo} 	
				   AND DSP_RQ_SNO 	= #{dspRqSno}	
		<if test='rltnOrgCd != null and rltnOrgCd != ""'>
			 	   AND RLTN_ORG_CD = #{rltnOrgCd}
		</if>	   			  
		<![CDATA[
			   )
			LOOP
			      DELETE 
				   FROM TBBADEAR006M
				  WHERE 1=1
				    AND AUD_YR 		= CS.AUD_YR
				    AND AUD_NO 		= CS.AUD_NO
				    AND DSP_RQ_SNO 	= CS.DSP_RQ_SNO
					AND RLTN_ORG_CD = CS.RLTN_ORG_CD
					;
			
			END LOOP ;	
		END;	
	]]>	
	</update>
	
	
	<!-- 관계기관 Update  BADEAR010EGongRltnUpdate -->
	<update id="updateGongRltn" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateGongRltn */
		<![CDATA[		
		DECLARE
			BEGIN		
			INSERT INTO TBBADEAR020H
			(
			    CON_NO,
			    AUD_YR,
			    AUD_NO,
			    DSP_RQ_SNO,
			    RLTN_ORG_CD,
			    RLTN_ORG_DVSN_CD,
			    DSP_RQ_TG_KND_CD,
			    CPLT_YN,
			    CPLT_DT,
			    CPLT_PEN_ID,
			    SLF_ACP_STA_CD,
			    SLF_APV_DT,
			    SLF_ACP_DT,
			    ENFM_MNG_ORG_CD,
			    USE_YN,
			    FNL_USR_ID,
			    FNL_DEAL_DPT_CD,
			    FNL_MNU_ID,
			    FRT_REGI_DH,
			    FNL_MDF_DH,
			    FRT_USR_ID
			)
			 SELECT	(SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADEAR020H),
				    AUD_YR,
				    AUD_NO,
				    DSP_RQ_SNO,
				    RLTN_ORG_CD,
				    RLTN_ORG_DVSN_CD,
				    DSP_RQ_TG_KND_CD,
				    CPLT_YN,
				    CPLT_DT,
				    CPLT_PEN_ID,
				    SLF_ACP_STA_CD,
				    SLF_APV_DT,
				    SLF_ACP_DT,
				    ENFM_MNG_ORG_CD,		    
				    'N',
				    #{fnlUsrId},
				    #{fnlDealDptCd},
				    #{fnlMnuId},
				    SYSDATE,
				    SYSDATE,
				    #{frtUsrId}
			   FROM TBBADEAR006M
			  WHERE 1=1
			    AND AUD_YR 		= #{audYr} 
			    AND AUD_NO 		= #{audNo} 	
			    AND DSP_RQ_SNO 	= #{dspRqSno}	
			    AND RLTN_ORG_CD = #{rltnOrgCd}			  
				;
		END;
		]]>
	</update>	

	<!-- 관계자 Update BADEAR010EGongDfntUpdate -->
	<update id="updateGongDfnt" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateGongDfnt */
		<![CDATA[ 	
		DECLARE
			BEGIN				
			INSERT INTO TBBADEAR016H
			(
			    CON_NO,
			    AUD_YR,
			    AUD_NO,
			    DSP_RQ_SNO,
			    RLTN_ORG_CD,
			    DFNT_SNO,
			    AD,
			    OCP_CD,
			    RANK_CD,
			    DFNT_NAM,
			    EIN,
			    BK_COM_AD,
			    CMPY_NM,
			    ACNT_NM,
			    HND_CD,
			    AM,
			    CPLT_YN,
			    HND_RQ_KND_CD,
			    CPLT_DT,
			    CPLT_PEN_ID,
			    SDY_GRT_AM,
			    SDY_GRT_RSN,
			    USE_YN,
			    FRT_USR_ID,
			    FNL_USR_ID,
			    FNL_DEAL_DPT_CD,
			    FNL_MNU_ID,
			    FRT_REGI_DH,
			    FNL_MDF_DH
			)
			SELECT  (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADEAR016H),
			        AUD_YR,
			        AUD_NO,
			        DSP_RQ_SNO,
			        RLTN_ORG_CD,
			        DFNT_SNO,
			        AD,
			        OCP_CD,
			        RANK_CD,
			        DFNT_NAM,
			        EIN,
			        BK_COM_AD,
			        CMPY_NM,
			        ACNT_NM,
			        HND_CD,
			        AM,
			        CPLT_YN,
			        HND_RQ_KND_CD,
			        CPLT_DT,
			        CPLT_PEN_ID,
			        SDY_GRT_AM,
			        SDY_GRT_RSN,
				    'N',
				    #{frtUsrId},
				    #{fnlUsrId},
				    #{fnlDealDptCd},
				    #{fnlMnuId},
				    SYSDATE,
				    SYSDATE
			  FROM TBBADEAR007M
			 WHERE 1=1
			   AND AUD_YR      = #{audYr}
			   AND AUD_NO      = #{audNo}
			   AND DSP_RQ_SNO  = #{dspRqSno}
			   AND RLTN_ORG_CD = #{rltnOrgCd}
			   AND DFNT_SNO    = #{dfntSno}			    
			;
		END;							       
		]]>			    					        
	</update>	
	
	
	<!--관계기관 조회 BADEAR003EEnFmMngBrdvCdUpdate --> 
	<update id="updateEnFmMngBrdvCd" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateEnFmMngBrdvCd */
        <![CDATA[	
			UPDATE TBBADEAR002D MST
			   SET ENFM_MNG_BRDV_CD  = (    SELECT D2.ENFM_DPT_CD 
			                                  FROM (
			                                        SELECT TBBADEAR006M.*, ROW_NUMBER() OVER( ORDER BY FRT_REGI_DH) ROW_NUM 
			                                          FROM TBBADEAR006M
			                                         WHERE 1=1
			                                           AND AUD_YR      = #{audYr} 
			                                           AND AUD_NO      = #{audNo} 	
			                                           AND DSP_RQ_SNO  = #{dspRqSno}	        
			                                        ) D1
			                                     , TBDCMACM015M D2
			                                 WHERE 1=1
			                                   AND D1.RLTN_ORG_CD = D2.ORG_CD
			                                   AND ROW_NUM = '1'
			                            ) 
			  WHERE 1=1
			    AND MST.AUD_YR       = #{audYr} 
			    AND MST.AUD_NO       = #{audNo} 	
			    AND MST.DSP_RQ_SNO   = #{dspRqSno}	        
        ]]>
	</update>
	
	
	

<!-- 관계기관 조회 - 2016.04.27 yyh BADEAR003ERltnOrgCdSelect -->
	<select id="selectRltnOrgCd" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectRltnOrgCd */
        <![CDATA[  
                  SELECT AUD_YR 
                        ,AUD_NO
                        ,DSP_RQ_SNO
                        ,RLTN_ORG_CD
                        ,RLTN_ORG_DVSN_CD
                        ,FRT_USR_ID
                        ,FNL_USR_ID
                        ,FNL_DEAL_DPT_CD
                        ,FNL_MNU_ID  
                    FROM (
                           SELECT AUD_YR 
                                 ,AUD_NO
                                 ,DSP_RQ_SNO
                                 ,RLTN_ORG_CD
                                 ,RLTN_ORG_DVSN_CD
                                 ,FRT_USR_ID
                                 ,FNL_USR_ID
                                 ,FNL_DEAL_DPT_CD
                                 ,FNL_MNU_ID                        
                             FROM TBBADEAR006M
                            WHERE AUD_YR     = #{audYr} 
                              AND AUD_NO     = #{audNo}
                              AND DSP_RQ_SNO = #{dspRqSno}
                            ORDER BY FRT_REGI_DH, RLTN_ORG_CD
                         )
                   WHERE ROWNUM = 1 /* 1차기관은 1개만 입력 */
		]]>
	</select>	






	<!--소관청 delete  BADEAR010EGongCoptDelete-->
	<update id="deleteGongCopt" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.deleteGongCopt */
		<![CDATA[ 	
		DECLARE
			BEGIN	
				FOR CS IN (
				 
				    SELECT AUD_YR
				         , AUD_NO
				         , DSP_RQ_SNO
				         , RLTN_ORG_CD
					  FROM TBBADEAR008M
					 WHERE 1=1
					   AND AUD_YR 		= #{audYr} 
					   AND AUD_NO 		= #{audNo} 	
					   AND DSP_RQ_SNO 	= #{dspRqSno}
				)
				LOOP
						INSERT INTO TBBADEAR025H
						(
						    CON_NO,
						    AUD_YR,
						    AUD_NO,
						    DSP_RQ_SNO,
						    RLTN_ORG_CD,
						    CON_HNDL_CD,
						    USE_YN,
						    FRT_USR_ID,
						    FNL_USR_ID,
						    FNL_DEAL_DPT_CD,
						    FNL_MNU_ID,
						    FRT_REGI_DH,
						    FNL_MDF_DH
						)
						VALUES
						(
						    (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADEAR025H),
						    CS.AUD_YR,
						    CS.AUD_NO,
						    CS.DSP_RQ_SNO,
						    CS.RLTN_ORG_CD,
						    'D',
						    'N',
						    #{frtUsrId},
						    #{fnlUsrId},
						    #{fnlDealDptCd},
						    #{fnlMnuId},
						    SYSDATE,
						    SYSDATE
						);
				END LOOP;
			END;
		]]>   
	</update>






	<!--소관청 delete  BADEAR003ECoptDelete-->
	<update id="deleteCopt" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.deleteCopt */
		<![CDATA[ 	
		DECLARE
			BEGIN	
				FOR CS IN (
				 
				    SELECT AUD_YR
				         , AUD_NO
				         , DSP_RQ_SNO
				         , RLTN_ORG_CD
					  FROM TBBADEAR008M
					 WHERE 1=1
					   AND AUD_YR 		= #{audYr} 
					   AND AUD_NO 		= #{audNo} 	
					   AND DSP_RQ_SNO 	= #{dspRqSno}
		]]>			   	
		<if test='rltnOrgCd != null and rltnOrgCd != ""'>
			 		   AND RLTN_ORG_CD = #{rltnOrgCd}
		</if>					   	
		<![CDATA[ 	
				)
				LOOP
				     DELETE 
					   FROM TBBADEAR008M
					  WHERE 1=1
					    AND AUD_YR 		= CS.AUD_YR
					    AND AUD_NO 		= CS.AUD_NO
					    AND DSP_RQ_SNO 	= CS.DSP_RQ_SNO
					    AND RLTN_ORG_CD = CS.RLTN_ORG_CD
					  ; 
				END LOOP;
			END;
		]]>   
	</update>	

	<!-- 1차기관 조회 - 2016.04.27 yyh -->
	<select id="selectDge1OrgCd" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectDge1OrgCd */
        <![CDATA[    
                  SELECT ORG_CD
	                    ,ORG_NM
	                    ,ORG_DVSN_CD
	                    ,ORG_DGE_CD 
	                FROM TBDCMACM015M
	               WHERE ORG_CD      = RPAD(#{cutOrgCd}, 12, '0')
	                 AND ORG_DGE_CD  = '1'
	                 AND USE_DVSN_NO = 'Y'        
		]]>
	</select>
	
	
	<!--1차기관 - 2016.04.27 yyh   BADEAR003ECoptMergeInsert-->
	<insert id="insertCoptMerge" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertCoptMerge */
		<![CDATA[
			MERGE INTO TBBADEAR008M
			USING DUAL
			   ON (     
			            AUD_YR      = #{audYr}
			        AND AUD_NO      = #{audNo}
			        AND DSP_RQ_SNO  = #{dspRqSno}
			        AND RLTN_ORG_CD = #{rltnOrgCd}
			      ) 
			 WHEN NOT MATCHED THEN   
                    INSERT 
                    (
	                      AUD_YR            
	                    , AUD_NO            
	                    , DSP_RQ_SNO        
	                    , RLTN_ORG_CD       
	                    , COPT_ORG_DVSN_CD  
	                    , DSP_RQ_TG_KND_CD  
	                    , CPLT_YN           
	                    , FRT_USR_ID
	                    , FNL_USR_ID
	                    , FNL_DEAL_DPT_CD
	                    , FNL_MNU_ID
	                    , FRT_REGI_DH
	                    , FNL_MDF_DH 
	                ) VALUES(
	                      #{audYr}            
	                    , #{audNo}            
	                    , #{dspRqSno}        
	                    , #{rltnOrgCd}       
	                    , #{coptOrgDvsnCd}  
	                    , #{dspRqTgKndCd}  
	                    , #{cpltYn}           
	                    , #{frtUsrId}
	                    , #{fnlUsrId}
	                    , #{fnlDealDptCd}
	                    , #{fnlMnuId}
	                    , SYSDATE
	                    , SYSDATE
	                )
		]]>
	</insert>




	<!--소관청 insert  BADEAR010EGongCoptInsert-->
	<insert id="insertGongCopt" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertGongCopt */
		<![CDATA[
		DECLARE
			BEGIN	
				FOR CS IN (
				 
				    SELECT AUD_YR
				         , AUD_NO
				         , DSP_RQ_SNO
				         , RLTN_ORG_CD
					  FROM TBBADEAR008M
					 WHERE 1=1
					   AND AUD_YR 		= #{audYr} 
					   AND AUD_NO 		= #{audNo} 	
					   AND DSP_RQ_SNO 	= #{dspRqSno}
				)
				LOOP			
					INSERT INTO TBBADEAR025H
					(
					    CON_NO,
					    AUD_YR,
					    AUD_NO,
					    DSP_RQ_SNO,
					    RLTN_ORG_CD,
					    CON_HNDL_CD,
					    USE_YN,
					    FRT_USR_ID,
					    FNL_USR_ID,
					    FNL_DEAL_DPT_CD,
					    FNL_MNU_ID,
					    FRT_REGI_DH,
					    FNL_MDF_DH
					)
					VALUES
					(
					    (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADEAR025H),
					    CS.AUD_YR,
					    CS.AUD_NO,
					    CS.DSP_RQ_SNO,
					    CS.RLTN_ORG_CD,
					    'C',
					    'N',
					    #{frtUsrId},
					    #{fnlUsrId},
					    #{fnlDealDptCd},
					    #{fnlMnuId},
					    SYSDATE,
					    SYSDATE
					);
				END LOOP;	
		END;		
				
		]]>
	</insert>	





	
	<!--관계자 delete  BADEAR003EDfntDelete -->
	<update id="deleteDfnt" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.deleteDfnt */
		<![CDATA[ 	
		DECLARE
			BEGIN	
			  FOR CS IN ( 
			  	SELECT AUD_YR
			  	     , AUD_NO
			  	     , DSP_RQ_SNO
			  	     , RLTN_ORG_CD
			  	     , DFNT_SNO
			  	  FROM TBBADEAR007M
				 WHERE 1=1
				   AND AUD_YR 		= #{audYr} 
				   AND AUD_NO 		= #{audNo} 	
				   AND DSP_RQ_SNO 	= #{dspRqSno}	
			]]>   
		<if test='rltnOrgCd != null and rltnOrgCd != ""'>
			 	   AND RLTN_ORG_CD = #{rltnOrgCd}
		</if>	 
		<if test='dfntSno != null and dfntSno != ""'>
			 	   AND DFNT_SNO = #{dfntSno}
		</if>	  		       		
		<![CDATA[ 
		   )
		   LOOP 
				 DELETE 
				   FROM TBBADEAR007M
				  WHERE 1=1
				    AND AUD_YR 		= CS.AUD_YR
				    AND AUD_NO 		= CS.AUD_NO
				    AND DSP_RQ_SNO 	= CS.DSP_RQ_SNO
				    AND RLTN_ORG_CD = CS.RLTN_ORG_CD
				    AND DFNT_SNO    = CS.DFNT_SNO
				  ; 
			END LOOP ;	
		END;								  
		]]>   
	</update>	

	
	<!-- 관계자 Max값 찾기  BADEAR003EDfntMaxSnoSelect -->
	<select id="selectDfntMaxSno" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectDfntMaxSno */
        <![CDATA[     	
			    SELECT NVL(MAX(TO_NUMBER(DFNT_SNO)),0)+1 AS MAX_SEQ
				  FROM TBBADEAR007M
				 WHERE 1=1
				   AND AUD_YR 		= #{audYr} 
				   AND AUD_NO 		= #{audNo} 	
				   AND DSP_RQ_SNO 	= #{dspRqSno}	
				   AND RLTN_ORG_CD  = #{rltnOrgCd}
		]]>
	</select>
	
	<!-- 감사자 SELECT -->
	<select id="BADEAR003EEtrSelect" parameterType="paramMap" resultType="egovMap">
        <![CDATA[     	
			SELECT D1.AUD_YR                    AS AUD_YR                   /*감사년도*/
			     , D1.AUD_NO                    AS AUD_NO                   /*감사번호*/
			     , D1.DSP_RQ_SNO                AS DSP_RQ_SNO               /*처분요구순번*/
			     , D1.ETR_PEN_ID                AS ETR_PEN_ID               /*적출자ID*/
			     , D1.ETR_PEN_BLT_CD            AS ETR_PEN_BLT_CD           /*적출자소속코드*/
			     , D1.ETR_PEN_RANK_CD           AS ETR_PEN_RANK_CD          /*적출자직급코드*/
			     , D1.ETR_PEN_NAM               AS ETR_PEN_NAM              /*적출자성명*/
			     , F_DPT_INFO(D1.ETR_PEN_BLT_CD,'1')	    AS ETR_PEN_BLT_NM   /*적출자소속명*/
			     , F_CODE_NM('1000173',D1.ETR_PEN_RANK_CD)	AS ETR_PEN_RANK_NM  /*적출자직급명*/
			     , D1.CTB_RTE                   AS CTB_RTE                  /*기여율*/
			     , D1.PNL_DRIN_PSVT_AM          AS PNL_DRIN_PSVT_AM         /*추징회수보전금액*/
			     , D1.IJS_AM                    AS IJS_AM                   /*부당금액*/
			     , D1.NOP_RTE                   AS NOP_RTE                  /*인원율*/
			     , D1.ETR_PEN_EXAM_OPIN_TXT     AS ETR_PEN_EXAM_OPIN_TXT    /*적출자검토의견내용*/
			     , F_DPT_INFO( F_USR_INFO(D1.ETR_PEN_ID, '5'),'1')       AS BLT_NM	/*현재소속부서*/
                 , F_CODE_NM('1000173',F_USR_INFO(D1.ETR_PEN_ID, '3'))   AS RANK_NM	/*현재직급*/
			  FROM TBBADEAR004M D1      
			 WHERE 1=1
			   AND D1.AUD_YR 		= #{audYr} 
			   AND D1.AUD_NO 		= #{audNo} 	
			   AND D1.DSP_RQ_SNO 	= #{dspRqSno}	
			 ORDER BY D1.ETR_PEN_ID			 
		]]>
	</select>
	
	<!--감사자 insert  BADEAR003EEtrInsert-->
	<insert id="insertEtr" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertEtr */
		DECLARE
			BEGIN		
		<![CDATA[
			INSERT INTO TBBADEAR004M ( 
			       AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , ETR_PEN_ID
			     , ETR_PEN_BLT_CD
			     , ETR_PEN_RANK_CD
			     , ETR_PEN_NAM
			     , CTB_RTE
			     , PNL_DRIN_PSVT_AM
			     , IJS_AM
			     , NOP_RTE
			     , ETR_PEN_EXAM_OPIN_TXT
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH
			) VALUES(
			       #{audYr}
			     , #{audNo}
			     , #{dspRqSno}
			     , #{etrPenId}
			     , #{etrPenBltCd ,jdbcType=VARCHAR}
			     , #{etrPenRankCd ,jdbcType=VARCHAR}
			     , #{etrPenNam ,jdbcType=VARCHAR}
			     , #{ctbRte ,jdbcType=VARCHAR}
			     , #{pnlDrinPsvtAm ,jdbcType=VARCHAR}
			     , #{ijsAm ,jdbcType=VARCHAR}
			     , #{nopRte ,jdbcType=VARCHAR}
			     , #{etrPenExamOpinTxt ,jdbcType=VARCHAR}
			     , #{frtUsrId ,jdbcType=VARCHAR}
			     , #{fnlUsrId ,jdbcType=VARCHAR}
			     , #{fnlDealDptCd ,jdbcType=VARCHAR}
			     , #{fnlMnuId ,jdbcType=VARCHAR}
			     , SYSDATE
			     , SYSDATE
			);
	
		]]>
		END;
	</insert>

	<!-- 감사자 Update  BADEAR003EEtrUpdate-->
	<update id="updateEtr" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateEtr */
		DECLARE
			BEGIN	
		<![CDATA[ 	
			UPDATE TBBADEAR004M
			   SET AUD_YR        = #{audYr} 
			     , AUD_NO        = #{audNo} 		
			     , DSP_RQ_SNO    = #{dspRqSno}		
			     , ETR_PEN_ID    = #{etrPenId}  
		]]>	 
		<if test='etrPenBltCd != null and   etrPenBltCd != ""'>	       
			      ,ETR_PEN_BLT_CD      = #{etrPenBltCd}
		</if>
		<if test='etrPenRankCd != null and   etrPenRankCd != ""'>	       
			      ,ETR_PEN_RANK_CD      = #{etrPenRankCd}
		</if>
		<if test='etrPenNam != null and   etrPenNam != ""'>	       
			      ,ETR_PEN_NAM      = #{etrPenNam}
		</if>
		<if test='ctbRte != null and   ctbRte != ""'>	       
			      ,CTB_RTE      = #{ctbRte}
		</if>
		<if test='pnlDrinPsvtAm != null and   pnlDrinPsvtAm != ""'>	       
			      ,PNL_DRIN_PSVT_AM      = #{pnlDrinPsvtAm}
		</if>
		<if test='ijsAm != null and   ijsAm != ""'>	       
			      ,IJS_AM      = #{ijsAm}
		</if>
		<if test='nopRte != null and  nopRte  != ""'>	       
			      ,NOP_RTE      = #{nopRte}
		</if>
		<if test='etrPenExamOpinTxt != null and   etrPenExamOpinTxt != ""'>	       
			      ,ETR_PEN_EXAM_OPIN_TXT      = #{etrPenExamOpinTxt}
		</if>
		<if test='fnlUsrId != null and   fnlUsrId != ""'>	       
			      ,FNL_USR_ID      = #{fnlUsrId}
		</if>	
		<if test='fnlDealDptCd != null and   fnlDealDptCd != ""'>	       
			      ,FNL_DEAL_DPT_CD  = #{fnlDealDptCd}
		</if>		
		<if test='fnlMnuId != null and  fnlMnuId  != ""'>	       
			      ,FNL_MNU_ID        = #{fnlMnuId}
		</if>
		<![CDATA[ 	
				 , FNL_MDF_DH        = SYSDATE			
			  WHERE 1=1
			    AND AUD_YR 		= #{audYr} 
			    AND AUD_NO 		= #{audNo} 	
			    AND DSP_RQ_SNO 	= #{dspRqSno}	
			    AND ETR_PEN_ID  = #{etrPenId}   
			 ; 
		END;			   
		]]>			    					        
	</update>
	
	
	<!-- 공감 감사자 -->
	<update id="updateGongEtr" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateGongEtr */
		<![CDATA[
		DECLARE
			BEGIN	
			INSERT INTO TBBADEAR018H
			(
			    CON_NO,
			    AUD_YR,
			    AUD_NO,
			    DSP_RQ_SNO,
			    ETR_PEN_ID,
			    ETR_PEN_BLT_CD,
			    ETR_PEN_RANK_CD,
			    ETR_PEN_NAM,
			    CTB_RTE,
			    PNL_DRIN_PSVT_AM,
			    IJS_AM,
			    NOP_RTE,
			    ETR_PEN_EXAM_OPIN_TXT,
			    USE_YN,
			    FRT_USR_ID,
			    FNL_USR_ID,
			    FNL_DEAL_DPT_CD,
			    FNL_MNU_ID,
			    FRT_REGI_DH,
			    FNL_MDF_DH
			)
			SELECT   (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADEAR018H),
			        AUD_YR,
			        AUD_NO,
			        DSP_RQ_SNO,
			        ETR_PEN_ID,
			        ETR_PEN_BLT_CD,
			        ETR_PEN_RANK_CD,
			        ETR_PEN_NAM,
			        CTB_RTE,
			        PNL_DRIN_PSVT_AM,
			        IJS_AM,
			        NOP_RTE,
			        ETR_PEN_EXAM_OPIN_TXT, 
			        'N',
			        #{frtUsrId},
			        #{fnlUsrId},
			        #{fnlDealDptCd},
			        #{fnlMnuId},
			        SYSDATE,
			        SYSDATE    
			  FROM TBBADEAR004M
			 WHERE 1=1
			   AND AUD_YR 		= #{audYr}
			   AND AUD_NO 		= #{audNo}
			   AND DSP_RQ_SNO 	= #{dspRqSno}
			   AND ETR_PEN_ID 	= #{etrPenId}
			  ;
		END;			   
		]]>			    					        
	</update>		


	<!--처분요구기본상세 update   BADEAR003ERltnToDetailUpdate-->
	<update id="updateRltnToDetail" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateRltnToDetail */
		<![CDATA[ 	
			 UPDATE TBBADEAR002D
			    SET COPT_OFI_CD = (
			                        SELECT RLTN_ORG_CD
			                          FROM (
			                                SELECT ROW_NUMBER() OVER(ORDER BY  FRT_REGI_DH) RNUM
			                                     , RLTN_ORG_CD 
			                                  FROM TBBADEAR008M
			                                 WHERE 1=1
			                                   AND AUD_YR 		= #{audYr}
			                                   AND AUD_NO  		= #{audNo}
			                                   AND DSP_RQ_SNO 	= #{dspRqSno}
			                                ) 
			                         WHERE RNUM = '1'
			                      )
			     , RLTN_ORG_CD = (
			                          SELECT RLTN_ORG_CD
			                          FROM (
			                                SELECT ROW_NUMBER() OVER(ORDER BY  FRT_REGI_DH) RNUM
			                                     , RLTN_ORG_CD 
			                                  FROM TBBADEAR006M
			                                 WHERE 1=1
			                                   AND AUD_YR 		= #{audYr}
			                                   AND AUD_NO  		= #{audNo}
			                                   AND DSP_RQ_SNO 	= #{dspRqSno}
			                                ) 
			                         WHERE RNUM = '1'   
			                     ) 
			      , NOP_CNT = (
			      
      							SELECT COUNT(1) AS CNT 
                                  FROM TBBADEAR007M
                                 WHERE 1=1
                                   AND AUD_YR 		= #{audYr}
                                   AND AUD_NO  		= #{audNo}
                                   AND DSP_RQ_SNO 	= #{dspRqSno}
			                  ) 
			 WHERE 1=1
			   AND AUD_YR 		= #{audYr}
			   AND AUD_NO  		= #{audNo}
			   AND DSP_RQ_SNO 	= #{dspRqSno}
		]]>						        
	</update>	 
        		
        		
    <!--처분요구기본 update  BADEAR003EOrgDvsnCdUpdate-->
	<update id="updateOrgDvsnCd" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateOrgDvsnCd */
		<![CDATA[ 	
			 UPDATE TBBADEAR001M
			    SET ORG_DVSN_CD = (
			                        SELECT COPT_ORG_DVSN_CD
			                          FROM (
			                                SELECT ROW_NUMBER() OVER(ORDER BY  FRT_REGI_DH) RNUM
			                                     , COPT_ORG_DVSN_CD 
			                                  FROM TBBADEAR008M
			                                 WHERE 1=1
			                                   AND AUD_YR 		= #{audYr}
			                                   AND AUD_NO  		= #{audNo}
			                                   AND DSP_RQ_SNO 	= #{dspRqSno}
			                                ) 
			                         WHERE RNUM = '1'
			                      )
			 WHERE 1=1
			   AND AUD_YR 		= #{audYr}
			   AND AUD_NO  		= #{audNo}
			   AND DSP_RQ_SNO 	= #{dspRqSno}
		]]>						        
	</update>	
	



	<!--감사자 delete  BADEAR003EEtrDelete-->
	<update id="deleteEtr" parameterType="paramMap">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.deleteEtr */
		DECLARE
			BEGIN
			  FOR CS IN ( 
		<![CDATA[ 			  
			  	SELECT AUD_YR
			  	     , AUD_NO
			  	     , DSP_RQ_SNO
			  	     , ETR_PEN_ID
			  	  FROM TBBADEAR004M
				 WHERE 1=1
				   AND AUD_YR 		= #{audYr} 
				   AND AUD_NO 		= #{audNo} 	
				   AND DSP_RQ_SNO 	= #{dspRqSno}	
		]]>  		   							
		<if test='etrPenId != null and etrPenId != ""'>
			 	   AND ETR_PEN_ID = #{etrPenId}
		</if>	 
		<![CDATA[ 	
	   		 )
		     LOOP 
			      DELETE 
				   FROM TBBADEAR004M
				  WHERE 1=1
				    AND AUD_YR 		= CS.AUD_YR
				    AND AUD_NO 		= CS.AUD_NO
				    AND DSP_RQ_SNO 	= CS.DSP_RQ_SNO
				    AND ETR_PEN_ID 	= CS.ETR_PEN_ID	
				  ;  
			END LOOP ;	
		END;	
		]]>   
	</update>
	
	
	

	<!-- 공감연계 감사사항 insert BADEAR010EGongAudItemInsert-->
	<insert id="insertGongAudItem" parameterType="paramMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertGongAudItem */
		<![CDATA[
		
				INSERT INTO TBBADDED024H
				   ( 
				       CON_NO
				     , AUD_YR
				     , AUD_NO
				     , CON_HNDL_CD
				     , USE_YN
				     , FRT_USR_ID
				     , FNL_USR_ID
				     , FNL_DEAL_DPT_CD
				     , FNL_MNU_ID
				     , FRT_REGI_DH
				     , FNL_MDF_DH 
				  ) VALUES(
				       (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADDED024H)
				     , #{audYr}
				     , #{audNo}
				     , 'C'
				     , 'N'
				     , #{frtUsrId}
				     , #{fnlUsrId}
				     , #{fnlDealDptCd}
				     , #{fnlMnuId}
				     , SYSDATE
				     , SYSDATE
				  )		
		]]>
	</insert>



	<!-- 공감연계 국과별처리현황 insert BADEAR010EGongAudBrdvInsert-->
	<insert id="insertGongAudBrdv" parameterType="paramMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertGongAudBrdv */
		<![CDATA[
		
            INSERT INTO TBBADDED026H
                (
                    CON_NO,
                    AUD_YR,
                    AUD_NO,
                    CON_HNDL_CD,
                    USE_YN,
                    FRT_USR_ID,
                    FNL_USR_ID,
                    FNL_DEAL_DPT_CD,
                    FNL_MNU_ID,
                    FRT_REGI_DH,
                    FNL_MDF_DH
                )
                VALUES
                (
                    (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADDED026H)
				    , #{audYr}
				    , #{audNo}
                    , 'C'
                    , 'N'
				    , #{frtUsrId}
				    , #{fnlUsrId}
				    , #{fnlDealDptCd}
				    , #{fnlMnuId}
                    , SYSDATE
                    , SYSDATE
                )
		]]>
	</insert>
	
	
	
	

	
	<update id="updateEnfmMngOrgChng" parameterType="paramMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateEnfmMngOrgChng */
	<![CDATA[ 	
           UPDATE TBBADEAR006M                             /* 관계기관 기본 */ 
              SET 
                  ENFM_MNG_ORG_CD   = #{enfmMngOrgCd}    /* 집행관리기관코드 */   
                 ,FNL_USR_ID        = #{frtUsrId}         /* 최종사용자ID */
                 ,FNL_DEAL_DPT_CD   = #{fnlDealDptCd}    /* 최종거래부서코드 */
                 ,FNL_MNU_ID        = #{fnlMnuId}         /* 최종메뉴ID */
                 ,FNL_MDF_DH        = SYSDATE              /* 최종수정일시 */ 
            WHERE AUD_YR            = #{audYr}             /* 감사년도  */ 
              AND AUD_NO            = #{audNo}             /* 감사번호 */
              AND DSP_RQ_SNO        = #{dspRqSno}         /* 처분요구순번 */
              AND RLTN_ORG_CD       = #{rltnOrgCd}        /* 관계기관코드 */
		]]>						        
	</update>

	<!-- 감사보고서 본안 시행일 조회 -->
	<select id="selectEnfDt" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.aep.dre.dao.AEPDRE101PMapper.selectEnfDt */
        <![CDATA[
			  SELECT MIN(B.ENF_DT) 
              FROM TBBADEAR001M A 
              INNER JOIN TBBADEAR002D B ON (B.AUD_YR = A.AUD_YR AND B.AUD_NO = A.AUD_NO AND B.DSP_RQ_SNO = A.DSP_RQ_SNO)
              INNER JOIN TBBADDED146M C ON (C.AUD_YR = A.AUD_YR AND C.AUD_NO = A.AUD_NO AND C.DSP_RQ_SNO = A.AUD_DSP_RQ_SNO)
              WHERE A.AUD_YR = #{audYr}
              AND A.AUD_NO = #{audNo}
              AND C.DOC_ID IN (SELECT DISTINCT REF_ID FROM TBBADDED103M WHERE AUD_YR = #{audYr} AND AUD_NO = #{audNo} AND RPRT_CD = 'A10600200' AND AUD_RPRT_DVSN_CD = '11')
		]]>
	</select>
	
	<update id="updateBADDED003M" parameterType="paramMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.updateBADDED003M */
	<![CDATA[ 	
           UPDATE TBBADDED003M
              SET 
                  ENF_APV_DT   = #{enfApvDt}
                 ,AUD_EXEC_HNDL_STA_CD  = '9'
                 ,FNL_USR_ID        = #{frtUsrId}         /* 최종사용자ID */
                 ,FNL_DEAL_DPT_CD   = #{fnlDealDptCd}    /* 최종거래부서코드 */
                 ,FNL_MNU_ID        = #{fnlMnuId}         /* 최종메뉴ID */
                 ,FNL_MDF_DH        = SYSDATE              /* 최종수정일시 */ 
            WHERE AUD_YR            = #{audYr}             /* 감사년도  */ 
              AND AUD_NO            = #{audNo}             /* 감사번호 */
              AND (ENF_APV_DT <> #{enfApvDt} OR ENF_APV_DT IS NULL)
		]]>						        
	</update>

	<!-- 키워드 삭제 -->
	<update id="deleteKywd" parameterType="paramMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.deleteKywd */
		<![CDATA[  	
			DELETE 
			  FROM TBBADEAR037M
			 WHERE AUD_YR     = #{audYr} 
			   AND AUD_NO     = #{audNo}
			   AND DSP_RQ_SNO = #{dspRqSno}	
		]]>		   
	</update>
	
	<!-- 키워드 입력 -->
	<insert id="insertKywd" parameterType="paramMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.insertKywd */
		<![CDATA[  
			INSERT INTO TBBADEAR037M(
			       AUD_YR
			     , AUD_NO
			     , DSP_RQ_SNO
			     , SNO
			     , KYWD			     
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH
			) VALUES (
			       #{audYr}
			     , #{audNo}
			     , #{dspRqSno}
			     , (SELECT NVL(MAX(SNO),0) + 1 
			          FROM TBBADEAR037M
			         WHERE AUD_YR     = #{audYr}
			           AND AUD_NO     = #{audNo}
			           AND DSP_RQ_SNO = #{dspRqSno} )
			     , #{kywd}
			     , #{frtUsrId}
			     , #{fnlUsrId}
			     , #{fnlDealDptCd}
			     , #{fnlMnuId}
			     , SYSDATE
			     , SYSDATE
			);
		]]>
	</insert>	
	
		<!-- 부서 과 리스트 조회 -->
	<select id="selectDeptSectList" parameterType="paramMap" resultType="egovMap">
	/* kr.go.bai.eip.aep.dre.dao.AEPDRE101pMapper.selectDeptSectList */
        <![CDATA[
           SELECT DPT_CD, DPT_NM, HIRK_DPT_CD
             FROM TBDCMACM002M
            WHERE 1=1

                 ]]>
		<if test='dptAuth != null and dptAuth != ""'>
              DPT_CD IN ( SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, #{dptAuth}, 'Y')))
             </if>

		<if test='hirkDptCd != null and hirkDptCd != ""'>
		<if test='dptCd == null or dptCd == ""'>
				AND SUBSTR(DPT_CD, 0, 3) = SUBSTR(#{hirkDptCd}, 0, 3)
	        	</if>
		<if test='dptCd != null and dptCd != ""'>
	        	OR SUBSTR(DPT_CD, 0, 3) = SUBSTR(#{hirkDptCd}, 0, 3)
	        	</if>
			</if>

			  AND DPT_CD NOT LIKE '%000'
              --AND USE_YN = 'Y'
            ORDER BY USE_YN DESC, DPT_CD

	</select>
</mapper> 
