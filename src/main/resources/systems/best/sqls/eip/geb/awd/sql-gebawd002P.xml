<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.geb.awd.dao.GEBAWD002PMapper">
	<select id="selectAudDocList" parameterType="paramMap" resultType="egovMap" >
			/* kr.go.bai.eip.geb.awd.dao.GEBAWD002PMapper.selectAudDocList*/
		<include refid="include.pageSelct" />
		       SELECT B.AUD_STEP_NM, 
		              A.RPRT_NM, 
		              C.FNL_MDF_DH, 
		              C.APV_RQS_ID, 
		              C.AUD_YR, 
		              C.AUD_NO, 
		              C.AUD_STEP_CD, 
		              C.DOC_ID, 
		              A.SORT_SNO, 
		              A.RPRT_CD, 
		              C.FRT_USR_ID, 
		              C.FNL_USR_ID, 
		              C.FNL_DEAL_DPT_CD, 
		              C.FNL_MNU_ID, 
		              C.FRT_REGI_DH,
		              C.APV_STA_CD,
		              F_CODE_NM('1000773',C.APV_STA_CD) AS APV_STA_NM,
		              F_OPEN_EDIT(C.LINK_URL) AS DOC_TYPE
	             FROM (SELECT AA.AUD_YR
			                , AA.AUD_NO
			                , AA.AUD_STEP_CD
			                , AA.DOC_ID
			                , AA.RPRT_CD
			                , AA.RPRT_NM
			                , AA.LINK_URL
			                , AA.SORT_SNO
			             FROM TBBADDED103M AA
			            UNION ALL 
			           SELECT BB.AUD_YR
			                , BB.AUD_NO
			                , 'NO'
			                , BB.DOC_ID
			                , DECODE(BB.DOC_TYP_CD,'AD-AR-002','A10300100','AD-AR-003','A10600200','AD-AR-001','A10500200')   AS RPRT_CD /* 감사실시계획서, 감사보고서, 실지감사 종료보고서 'A10300100','A10500200','A10600200' */
			                , CC.FILE_NAME    AS RPRT_NM
			                , 'hancom'        AS DOC_TYPE
			                , null
			             FROM TBBADDED021M BB  
			            INNER JOIN
			                  ECM_FILE_LIST_VIEW2 CC
			               ON CC.DOC_ID = BB.DOC_ID) A
		       LEFT OUTER JOIN 
		                 TBBADDED101M B
		               ON A.AUD_YR = B.AUD_YR
		              AND A.AUD_NO = B.AUD_NO
		              AND A.AUD_STEP_CD = B.AUD_STEP_CD
		       INNER JOIN TBAEPMAR001M C
				      ON A.AUD_YR = C.AUD_YR
				     AND A.AUD_NO = C.AUD_NO
				     AND A.AUD_STEP_CD = C.AUD_STEP_CD
				     AND A.DOC_ID = C.REF_DOC_ID
		            WHERE C.PRSS_CD = '30' /* 접수문서만 조회 */ 
		             AND C.RCV_USR_ID = #{usrId}
		             AND A.RPRT_NM LIKE '%' || #{schText} || '%'
	              
         <include refid = "include.pageOrder"/> 
	</select>
	
	<select id="getAudNoByApvRqsId" parameterType="paramMap" resultType="egovMap" >
			/* kr.go.bai.eip.geb.awd.dao.GEBAWD002PMapper.getAudNoByApvRqsId*/
		       select AUD_YR
		            , AUD_NO
				  FROM TBAEPMAR001M
				 WHERE APV_RQS_ID = #{apvRqsId}
				   AND ROWNUM = 1
	</select>
	
</mapper> 