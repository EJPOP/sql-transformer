<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper">

	<select id="getAudDocTmpData" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getAudDocTmpData*/
		SELECT D1.AUD_DOC_CD,
			   F_CODE_NM('1000786', D1.AUD_DOC_CD) AS AUD_DOC_NM,
		   	   D2.DTIL_AUD_DOC_NM,
			   D1.TSK_KND_CD,
			   D1.AUD_STEP_CD,
			   CASE WHEN D1.MNT_CHO_CD = '10' THEN 'Y'
			        ELSE 'N' END AS MNT_CHO_YN,
			   D1.TRNM_POSS_YN,
               D1.APV_WAY_CD,
               D1.AUD_DOC_KND_CD,
               D1.CON_PGM_CD
		  FROM TBFDMADM001M D1, TBFDMADM002M D2
		 WHERE D1.AUD_DOC_CD = D2.AUD_DOC_CD(+)
		   <if test="audDocCd != null and audDocCd != ''">
		   AND D1.AUD_DOC_CD = #{audDocCd}
		   </if>
		   <if test="tmpDocId != null and tmpDocId != ''">
		   AND (D2.DOC_ID = #{tmpDocId} OR D2.HWP_DOC_ID = #{tmpDocId})
		   </if>
	</select>

	<select id="getAudTmpDocCd" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getAudTmpDocCd*/
		SELECT AUD_DOC_CD,        /*보고서코드 */
               DTIL_AUD_DOC_NM AS AUD_DOC_NM,
               DTIL_AUD_DOC_NM,
               DECODE(#{docType},'HWP', HWP_DOC_ID, DOC_ID ) AS DOC_ID
		  FROM TBFDMADM002M
	     WHERE 1=1
	     <if test="tmpDocId != null and tmpDocId != ''">
	     AND (DOC_ID = #{tmpDocId} OR HWP_DOC_ID = #{tmpDocId})
	     </if>
	     <if test="audDocCd != null and audDocCd != ''">
	     AND AUD_DOC_CD = #{audDocCd}
	     </if>
	     <if test="tmpDocId == null or tmpDocId == ''">
		   		<if test="audDocCd == null or audDocCd == ''">
		   			AND (DOC_ID = #{tmpDocId} OR HWP_DOC_ID = #{tmpDocId})
		   		</if>
		 </if>
		 AND ROWNUM=1
	</select>
	
	<select id="getAudRefTmpDocCd" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getAudTmpDocCd*/
		SELECT AUD_DOC_CD,        /*보고서코드 */
               DTIL_AUD_DOC_NM AS AUD_DOC_NM,
               DTIL_AUD_DOC_NM,
               DECODE(#{docType},'HWP', HWP_DOC_ID, DOC_ID ) AS DOC_ID
		  FROM TBFDMADM002M
	     WHERE 1=1
	     <if test="refTmpDocId != null and refTmpDocId != ''">
	     AND (DOC_ID = #{refTmpDocId} OR HWP_DOC_ID = #{refTmpDocId})
	     </if>
		 AND ROWNUM=1
	</select>
	
	<insert id="insertBADDED103M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBADDED103M*/
		INSERT INTO TBBADDED103M (AUD_YR,
								  AUD_NO,
								  AUD_STEP_CD,
								  DOC_ID,
								  AUD_KND_CD,
								  AUD_GRN_NO,
								  RPRT_NM,
								  LINK_URL,
                                  NECES_YN,
								  APV_STA_CD,
								  RPRT_CD,
								  APV_RQS_ID,
								  SND_DOC_YN,
                                  AUD_RPRT_DVSN_CD,
                                  REF_ID,
                                  REF_DY,
                                  RLTN_ORG_CD,
								  SORT_SNO,
                                  APV_WAY_CD,
                                  SYT_TRTM_DVSN_YN, --종합처리안 구분 여부
                                  AUD_DOC_KND_CD,
                                  CON_PGM_CD,
                                  DOC_WRT_ID,
                                  ONR_HNDL_NO,
								  FRT_USR_ID,
								  FNL_USR_ID,
								  FNL_DEAL_DPT_CD,
								  FNL_MNU_ID,
								  FRT_REGI_DH,
								  FNL_MDF_DH,
								  <if test="templateDocId != null and templateDocId != ''">
								  TEMPLATE_DOC_ID,
								  </if>
								   <if test="refDocId != null and refDocId != ''">
								  REF_DOC_ID,
                                   </if>
                                   <if test="edtAuth != null and edtAuth != ''">
								  EDT_AUTH,
								  </if>
								  SECU_RPT_YN
								  )
		   		          VALUES (#{audYr},
		   		           		  #{audNo},
		   		           		  #{audStepCd},
		   		           		  #{docId},
		   		           		  #{audKndCd},
		   		           		  (SELECT MAX(AUD_GRN_NO) FROM TBBADDED001M WHERE AUD_YR = #{audYr} AND AUD_NO = #{audNo}),
		   		           		  #{rprtNm},
		   		           		  #{linkUrl},
                                  #{necesYn},
		   		           		  #{apvStaCd},
		   		           		  #{rprtCd},
		   		           		  #{apvRqsId},
		   		           		  #{sndDocYn},
                                  #{audRprtDvsnCd},
                                  #{refId},
                                  #{refDy},
                                  #{rltnOrgCd},
				        		  (SELECT NVL(MAX(SORT_SNO),0)+1
		   		           		  	 FROM TBBADDED103M
		   		           		    WHERE AUD_YR = #{audYr}
					   		          AND AUD_NO = #{audNo}
					   		          AND AUD_STEP_CD = #{audStepCd}
		   		           		  ),
                                  #{apvWayCd},
                                  <if test="sytTrtmDvsnYn != null and sytTrtmDvsnYn != ''">
                                  #{sytTrtmDvsnYn},
                                  </if>
                                  <if test =" sytTrtmDvsnYn == null or sytTrtmDvsnYn == '' " >
                                  (CASE WHEN 'A10600200' = #{rprtCd} THEN
                                      (CASE WHEN
                                          ((SELECT F_CODE_NM('1000739',#{audKndCd}) FROM DUAL) IN ('성과', '특정')) THEN 'Y'
                                       ELSE 'N' END)
                                   ELSE 'N' END),
                                   </if>
                                  #{audDocKndCd},
                                  #{conPgmCd},
                                  #{usrId},
                                  #{onrHndlNo},
				        		  #{usrId},    /*세션정보*/
                                  #{usrId},
                                  #{dptCd},
                                  #{menuNo},
                                  SYSDATE,
                                  SYSDATE,
								   <if test="templateDocId != null and templateDocId != ''">
                                   #{templateDocId},
                                   </if>
                                   <if test="refDocId != null and refDocId != ''">
                                   #{refDocId},
                                   </if>
                                   <if test="edtAuth != null and edtAuth != ''">
								   #{edtAuth},
								  </if>
                                   #{secuRptYn}
                                  )
	</insert>

	<update id="updateBADDED103M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED103M*/
		UPDATE TBBADDED103M
		   SET FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
		   	   <if test="rprtNm != null and rprtNm != ''">
		   	   ,RPRT_NM = #{rprtNm}
		   	   </if>
		   	   <if test="linkUrl != null and linkUrl != ''">
		   	   ,LINK_URL = #{linkUrl}
		   	   </if>
		   	   <if test="apvStaCd != null and apvStaCd != ''">
		   	   ,APV_STA_CD = #{apvStaCd}
		   	   </if>
		   	   <if test="apvRqsId != null and apvRqsId != ''">
		   	   ,APV_RQS_ID = #{apvRqsId}
		   	   </if>
               <if test="refId != null and refId != ''">
               ,REF_ID = #{refId}
               </if>
               <if test="onrHndlNo != null and onrHndlNo != ''">
               ,ONR_HNDL_NO = #{onrHndlNo}
               </if>
               <if test="secuRptYn != null and secuRptYn != ''">
               ,SECU_RPT_YN = #{secuRptYn}
               </if>
               <if test="refDocId != null and refDocId != ''">
               ,REF_DOC_ID = #{refDocId}
               </if>
               <if test="sytTrtmDvsnYn != null and sytTrtmDvsnYn != ''">
                ,SYT_TRTM_DVSN_YN = #{sytTrtmDvsnYn}
                </if>
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   AND AUD_STEP_CD = #{audStepCd}
  		   AND DOC_ID = #{docId}
	</update>

	<select id="selectCodeFromCodeNm" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectCodeFromCodeNm*/
		SELECT (SELECT CD
				  FROM TBDCMACM013C
				 WHERE CMM_CD_DVSN_CD = '1000774'
				   AND CD_NM = #{referDvsnNm} ) AS REFER_DVSN_CD,
			   (SELECT CD
				  FROM TBDCMACM013C
				 WHERE CMM_CD_DVSN_CD = '1000002'
				   AND CD_NM = #{dspRqNm} ) AS DSP_RQ_CD
  		  FROM DUAL
	</select>

	<select id="selectMaxAffSno" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectMaxAffSno*/
		SELECT 1 AS A
        <if test=" 'Y' .toString() == maxCheckYn ">
            ,  NVL(MAX(AFF_SNO),0) AS MAX_CHK
        </if>
        <if test =" maxCheckYn == null or maxCheckYn == '' " >
            , CASE WHEN NVL(MAX(AFF_SNO),0) > TO_NUMBER(#{chkMaxAffSno}) THEN NVL(MAX(AFF_SNO),0)+1
                        ELSE TO_NUMBER(#{chkMaxAffSno})+1  END AS MAX_AFF_SNO
        </if>
  		  FROM TBBADDED145M
  	     WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
	</select>

	<select id="selectMaxDspRqSno" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectMaxDspRqSno*/
		SELECT 1 AS A
        <if test=" 'Y' .toString() == maxCheckYn ">
            ,  NVL(MAX(DSP_RQ_SNO),0) AS MAX_CHK
        </if>
        <if test =" maxCheckYn == null or maxCheckYn == '' " >
            , CASE WHEN NVL(MAX(DSP_RQ_SNO),0) > TO_NUMBER(#{chkMaxDspRqSno}) THEN NVL(MAX(DSP_RQ_SNO),0)+1
                        ELSE TO_NUMBER(#{chkMaxDspRqSno})+1 END AS MAX_DSP_RQ_SNO
        </if>
  		  FROM TBBADDED146M
  	     WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
	</select>

	<update id="updateBADDED102M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED102M*/
		UPDATE TBBADDED102M
		   SET CMPT_YN = 'Y'
               ,FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   AND AUD_STEP_CD = #{audStepCd}
		   AND AUD_MAIN_STEP_SNO = #{audMainStepSno}
		   AND AUD_MAIN_STEP_ID = #{audMainStepId}
	</update>

	<insert id="insertBADDED145M" parameterType="paramMap">
	DECLARE
		BEGIN
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBADDED145M*/
		INSERT INTO TBBADDED145M (AUD_YR,
								  AUD_NO,
								  AUD_STEP_CD,
								  APVR_CD,
								  AFF_SNO,
								  AUD_KND_CD,
								  AUD_GRN_NO,
								  RPRT_FILD_ID,
								  AFF_CD,
								  REFER_DVSN_CD,
								  AFF_SPH,
								  TITLE_NM,
								  DP_TITLE_NM,
								  DETL_DOC_NO,
								  MTRL_IPT_DVSN_CD,
								  SYT_TRTM_DVSN_YN,
								  SORT_SNO,
								  <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
								  DOC_ID,
								  REF_DOC_ID,
								  </if>
								  <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
								  DOC_ID,
								  </if>
								  FNL_YN,
								  FRT_USR_ID,
								  FNL_USR_ID,
								  FNL_DEAL_DPT_CD,
								  FNL_MNU_ID,
								  FRT_REGI_DH,
								  FNL_MDF_DH)
		   		          VALUES (#{audYr},
		   		           		  #{audNo},
		   		           		  #{audStepCd},
		   		           		  #{apvrCd},
		   		           		  #{maxAffSno},
		   		           		  #{audKndCd},
		   		           		  #{audGrnNo},
		   		           		  #{rprtFildId},
		   		           		  '00',
		   		           		  NVL(#{referDvsnCd},'E10'),
		   		           		  #{affSph},
		   		           		  SUBSTRING(#{titleNm},0,100),
		   		           		  SUBSTRING(#{titleNm},0,100),
		   		           		  #{detlDocNo},
		   		           		  '10',
		   		           		  #{sytTrtmDvsnYn},
                                  #{sortSno},
                                  <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
                                  (SELECT REF_ID FROM TBBADDED103M
									    WHERE AUD_YR = #{audYr}
									       AND AUD_NO=#{audNo}
									       AND AUD_GRN_NO=#{audGrnNo}
									       AND AUD_STEP_CD='A1070'
									       AND RPRT_CD='A10600200'
									       AND DOC_ID = #{docId}) ,
								  #{docId},
								  </if>
								  <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
								  #{docId},
								  </if>
								  'N',
				        		  #{usrId},    /*세션정보*/
                                  #{usrId},
                                  #{dptCd},
                                  #{menuNo},
                                  SYSDATE,
                                  SYSDATE)
                       ;
		           INSERT INTO TBBADDED145H
							(
							   HST_DVSN_CD
							 , HST_SNO
							 , HST_DH
							 , HST_USR_ID	
							 , AUD_YR			
							 , AUD_NO			
							 , AUD_STEP_CD	
							 , DOC_ID			
							 , APVR_CD		
							 , AFF_SNO		
							 , AUD_KND_CD		
							 , AUD_GRN_NO		
							 , RPRT_FILD_ID	
							 , AFF_CD			
							 , LIST_NO		
							 , REFER_DVSN_CD	
							 , AFF_SPH		
							 , TITLE_NM		
							 , DP_TITLE_NM	
							 , QST_DOC_ISUE_YN
							 , QST_DOC_ISUE_DY
							 , AUDTOR			
							 , DETL_DOC_NO	
							 , MTRL_IPT_DVSN_CD
							 , SYT_TRTM_DVSN_YN
							 , SCRT_YN		
							 , SORT_SNO		
							 , TRTM_EXAMER_CNB
							 , FNL_YN			
							 , FRT_USR_ID		
							 , FNL_USR_ID		
							 , FNL_DEAL_DPT_CD
							 , FNL_MNU_ID		
							 , FRT_REGI_DH	
							 , FNL_MDF_DH		
							 , REF_DOC_ID		
							)
						SELECT 'C'
						 	 , TBBADDED145H_SEQ.NEXTVAL
						 	 , SYSDATE
						 	 , #{usrId}
							 , AUD_YR			
							 , AUD_NO			
							 , AUD_STEP_CD	
							 , DOC_ID			
							 , APVR_CD		
							 , AFF_SNO		
							 , AUD_KND_CD		
							 , AUD_GRN_NO		
							 , RPRT_FILD_ID	
							 , AFF_CD			
							 , LIST_NO		
							 , REFER_DVSN_CD	
							 , AFF_SPH		
							 , TITLE_NM		
							 , DP_TITLE_NM	
							 , QST_DOC_ISUE_YN
							 , QST_DOC_ISUE_DY
							 , AUDTOR			
							 , DETL_DOC_NO	
							 , MTRL_IPT_DVSN_CD
							 , SYT_TRTM_DVSN_YN
							 , SCRT_YN		
							 , SORT_SNO		
							 , TRTM_EXAMER_CNB
							 , FNL_YN			
							 , FRT_USR_ID		
							 , FNL_USR_ID		
							 , FNL_DEAL_DPT_CD
							 , FNL_MNU_ID		
							 , FRT_REGI_DH	
							 , FNL_MDF_DH		
							 , REF_DOC_ID
						 FROM TBBADDED145M
				         WHERE AUD_YR = #{audYr}
				           AND AUD_NO = #{audNo}
				           AND AUD_STEP_CD = #{audStepCd}
				           AND APVR_CD = #{apvrCd}
				           AND AFF_SNO = #{maxAffSno}
						;
			END;            
	</insert>

	<insert id="insertBADDED146M" parameterType="paramMap">
	DECLARE
		BEGIN
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBADDED146M*/
		INSERT INTO TBBADDED146M (AUD_YR,
								  AUD_NO,
								  AUD_STEP_CD,
								  APVR_CD,
								  AFF_SNO,
								  DSP_RQ_SNO,
								  DP_DSP_RQ_SNO,
								  AUD_KND_CD,
								  AUD_GRN_NO,
								  RPRT_FILD_ID,
								  AFF_DSP_CD,
								  RLTN_ORG_CD,
								  HND_ORG_CD,
								  DSP_RQ_CD,
								  MTRL_IPT_DVSN_CD,
								  SORT_SNO,
								  <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
								  DOC_ID,
								  REF_DOC_ID,
								  </if>
								  <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
								  DOC_ID,
								  </if>
								  FNL_YN,
								  FRT_USR_ID,
								  FNL_USR_ID,
								  FNL_DEAL_DPT_CD,
								  FNL_MNU_ID,
								  FRT_REGI_DH,
								  FNL_MDF_DH)
		   		          VALUES (#{audYr},
		   		           		  #{audNo},
		   		           		  #{audStepCd},
		   		           		  #{apvrCd},
		   		           		  #{maxAffSno},
		   		           		  #{maxDspRqSno},
		   		           		  #{maxDspRqSno},
		   		           		  #{audKndCd},
		   		           		  #{audGrnNo},
		   		           		  #{rprtFildId},
		   		           		  '00',
		   		           		  #{rltnOrgCd},
		   		           		  #{hndOrgCd},
		   		           		  #{dspRqCd},
		   		           		  '10',
                                  #{sortSno},
                                  <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
                                  (SELECT REF_ID FROM TBBADDED103M
								   WHERE AUD_YR = #{audYr}
									  AND AUD_NO=#{audNo}
									  AND AUD_GRN_NO=#{audGrnNo}
									  AND AUD_STEP_CD='A1070'
									  AND RPRT_CD='A10600200'
									  AND DOC_ID = #{docId}) ,
								  #{docId},
								  </if>
								  <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
								  #{docId},
								  </if>
								  'N',
				        		  #{usrId},    /*세션정보*/
                                  #{usrId},
                                  #{dptCd},
                                  #{menuNo},
                                  SYSDATE,
                                  SYSDATE)
					;
					INSERT INTO TBBADDED146H
							(
							    HST_DVSN_CD
							  , HST_SNO
							  , HST_DH
							  , HST_USR_ID	
							  , AUD_YR
							  , AUD_NO
							  , AUD_STEP_CD 	
							  , DOC_ID 			
							  , APVR_CD 		
							  , AFF_SNO 		
							  , DSP_RQ_SNO 		
							  , DP_DSP_RQ_SNO 	
							  , AUD_KND_CD 		
							  , AUD_GRN_NO 		
							  , RPRT_FILD_ID 	
							  , AFF_DSP_CD 		
							  , RLTN_ORG_CD 	
							  , HND_ORG_CD 		
							  , REF_ORG_CD 		
							  , DSP_RQ_CD 		
							  , MTRL_IPT_DVSN_CD
							  , NOP_AM_DVSN_CD 	
							  , NOP_AM 			
							  , SORT_SNO		
							  , ACCN_INSP_CD	
							  , FNL_YN 			
							  , FRT_USR_ID 		
							  , FNL_USR_ID 		
							  , FNL_DEAL_DPT_CD 
							  , FNL_MNU_ID 		
							  , FRT_REGI_DH		
							  , FNL_MDF_DH 		
							  , NOP_SUM 		
							  , HD_AUD_STEP_CD 	
							  , HD_DOC_ID		
							  , HD_APVR_CD		
							  , HD_AFF_SNO 		
							  , HD_DSP_RQ_SNO	
							  , REF_DOC_ID 		
							  , DF_AUD_STEP_CD 	
							  , DF_DOC_ID 		
							  , DF_APVR_CD 		
							  , DF_AFF_SNO		
							  , DF_DSP_RQ_SNO 	
							  , KYWD1			
							  , KYWD2 			
							  , KYWD3 			
							  , KYWD4			
							  , KYWD5			
							)
						SELECT 'C'
						 	 , TBBADDED146H_SEQ.NEXTVAL
						 	 , SYSDATE
						 	 , #{usrId}
							 , AUD_YR
							 , AUD_NO
							 , AUD_STEP_CD 	
							 , DOC_ID 			
							 , APVR_CD 		
							 , AFF_SNO 		
							 , DSP_RQ_SNO 		
							 , DP_DSP_RQ_SNO 	
							 , AUD_KND_CD 		
							 , AUD_GRN_NO 		
							 , RPRT_FILD_ID 	
							 , AFF_DSP_CD 		
							 , RLTN_ORG_CD 	
							 , HND_ORG_CD 		
							 , REF_ORG_CD 		
							 , DSP_RQ_CD 		
							 , MTRL_IPT_DVSN_CD
							 , NOP_AM_DVSN_CD 	
							 , NOP_AM 			
							 , SORT_SNO		
							 , ACCN_INSP_CD	
							 , FNL_YN 			
							 , FRT_USR_ID 		
							 , FNL_USR_ID 		
							 , FNL_DEAL_DPT_CD 
							 , FNL_MNU_ID 		
							 , FRT_REGI_DH		
							 , FNL_MDF_DH 		
							 , NOP_SUM 		
							 , HD_AUD_STEP_CD 	
							 , HD_DOC_ID		
							 , HD_APVR_CD		
							 , HD_AFF_SNO 		
							 , HD_DSP_RQ_SNO	
							 , REF_DOC_ID 		
							 , DF_AUD_STEP_CD 	
							 , DF_DOC_ID 		
							 , DF_APVR_CD 		
							 , DF_AFF_SNO		
							 , DF_DSP_RQ_SNO 	
							 , KYWD1			
							 , KYWD2 			
							 , KYWD3 			
							 , KYWD4			
							 , KYWD5
						 FROM TBBADDED146M
			        	 WHERE AUD_YR = #{audYr}
			           		AND AUD_NO = #{audNo}
			           		AND AUD_STEP_CD = #{audStepCd}
			           		AND APVR_CD = #{apvrCd}
			           		AND AFF_SNO = #{maxAffSno}
			           		AND DSP_RQ_SNO = #{maxDspRqSno}
							;
					END;                                  
	</insert>

	<delete id="deleteBADDED145M" parameterType="paramMap">
	DECLARE
		BEGIN
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'D'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , #{usrId}
					 , A.AUD_YR			
					 , A.AUD_NO			
					 , A.AUD_STEP_CD	
					 , A.DOC_ID			
					 , A.APVR_CD		
					 , A.AFF_SNO		
					 , A.AUD_KND_CD		
					 , A.AUD_GRN_NO		
					 , A.RPRT_FILD_ID	
					 , A.AFF_CD			
					 , A.LIST_NO		
					 , A.REFER_DVSN_CD	
					 , A.AFF_SPH		
					 , A.TITLE_NM		
					 , A.DP_TITLE_NM	
					 , A.QST_DOC_ISUE_YN
					 , A.QST_DOC_ISUE_DY
					 , A.AUDTOR			
					 , A.DETL_DOC_NO	
					 , A.MTRL_IPT_DVSN_CD
					 , A.SYT_TRTM_DVSN_YN
					 , A.SCRT_YN		
					 , A.SORT_SNO		
					 , A.TRTM_EXAMER_CNB
					 , A.FNL_YN			
					 , A.FRT_USR_ID		
					 , A.FNL_USR_ID		
					 , A.FNL_DEAL_DPT_CD
					 , A.FNL_MNU_ID		
					 , A.FRT_REGI_DH	
					 , A.FNL_MDF_DH		
					 , A.REF_DOC_ID
				 FROM TBBADDED145M A
				 WHERE A.AUD_YR = #{audYr}
				   AND A.AUD_NO = #{audNo}
				   AND A.AUD_STEP_CD = #{audStepCd}
				   AND A.APVR_CD = #{apvrCd}
				   AND A.MTRL_IPT_DVSN_CD  IN ( '10', '30')
		           AND A.RPRT_FILD_ID IN (${affSnosToDelete})
		           <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
			           AND A.DOC_ID = (SELECT B.REF_ID 
			                                 FROM TBBADDED103M B 
			                                WHERE B.AUD_YR =  A.AUD_YR
			                                   AND B.AUD_NO =  A.AUD_NO 
			                                   AND B.AUD_STEP_CD =  'A1070'
			                                   AND B.RPRT_CD = 'A10600200'  
			                                   AND B.DOC_ID = #{docId})
					</if>
					 <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
			           AND A.DOC_ID = #{docId}
					</if>
				;				
			/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.deleteBADDED145M*/
			DELETE
			  FROM TBBADDED145M A
			 WHERE A.AUD_YR = #{audYr}
			   AND A.AUD_NO = #{audNo}
			   AND A.AUD_STEP_CD = #{audStepCd}
			   AND A.APVR_CD = #{apvrCd}
			   AND A.MTRL_IPT_DVSN_CD  IN ( '10', '30')
	           AND A.RPRT_FILD_ID IN (${affSnosToDelete})
	           <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
		           AND A.DOC_ID = (SELECT B.REF_ID 
		                                 FROM TBBADDED103M B 
		                                WHERE B.AUD_YR =  A.AUD_YR
		                                   AND B.AUD_NO =  A.AUD_NO 
		                                   AND B.AUD_STEP_CD =  'A1070'
		                                   AND B.RPRT_CD = 'A10600200'  
		                                   AND B.DOC_ID = #{docId})
				</if>
				 <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
		           AND A.DOC_ID = #{docId}
				</if>
				;
		END;
	</delete>

	<delete id="deleteBADDED146M" parameterType="paramMap">
	DECLARE
		BEGIN
		INSERT INTO TBBADDED146H
				(
				    HST_DVSN_CD
				  , HST_SNO
				  , HST_DH
				  , HST_USR_ID	
				  , AUD_YR
				  , AUD_NO
				  , AUD_STEP_CD 	
				  , DOC_ID 			
				  , APVR_CD 		
				  , AFF_SNO 		
				  , DSP_RQ_SNO 		
				  , DP_DSP_RQ_SNO 	
				  , AUD_KND_CD 		
				  , AUD_GRN_NO 		
				  , RPRT_FILD_ID 	
				  , AFF_DSP_CD 		
				  , RLTN_ORG_CD 	
				  , HND_ORG_CD 		
				  , REF_ORG_CD 		
				  , DSP_RQ_CD 		
				  , MTRL_IPT_DVSN_CD
				  , NOP_AM_DVSN_CD 	
				  , NOP_AM 			
				  , SORT_SNO		
				  , ACCN_INSP_CD	
				  , FNL_YN 			
				  , FRT_USR_ID 		
				  , FNL_USR_ID 		
				  , FNL_DEAL_DPT_CD 
				  , FNL_MNU_ID 		
				  , FRT_REGI_DH		
				  , FNL_MDF_DH 		
				  , NOP_SUM 		
				  , HD_AUD_STEP_CD 	
				  , HD_DOC_ID		
				  , HD_APVR_CD		
				  , HD_AFF_SNO 		
				  , HD_DSP_RQ_SNO	
				  , REF_DOC_ID 		
				  , DF_AUD_STEP_CD 	
				  , DF_DOC_ID 		
				  , DF_APVR_CD 		
				  , DF_AFF_SNO		
				  , DF_DSP_RQ_SNO 	
				  , KYWD1			
				  , KYWD2 			
				  , KYWD3 			
				  , KYWD4			
				  , KYWD5			
				)
			SELECT 'D'
			 	 , TBBADDED146H_SEQ.NEXTVAL
			 	 , SYSDATE
			 	 , #{usrId}
				 , A.AUD_YR
				 , A.AUD_NO
				 , A.AUD_STEP_CD 	
				 , A.DOC_ID 			
				 , A.APVR_CD 		
				 , A.AFF_SNO 		
				 , A.DSP_RQ_SNO 		
				 , A.DP_DSP_RQ_SNO 	
				 , A.AUD_KND_CD 		
				 , A.AUD_GRN_NO 		
				 , A.RPRT_FILD_ID 	
				 , A.AFF_DSP_CD 		
				 , A.RLTN_ORG_CD 	
				 , A.HND_ORG_CD 		
				 , A.REF_ORG_CD 		
				 , A.DSP_RQ_CD 		
				 , A.MTRL_IPT_DVSN_CD
				 , A.NOP_AM_DVSN_CD 	
				 , A.NOP_AM 			
				 , A.SORT_SNO		
				 , A.ACCN_INSP_CD	
				 , A.FNL_YN 			
				 , A.FRT_USR_ID 		
				 , A.FNL_USR_ID 		
				 , A.FNL_DEAL_DPT_CD 
				 , A.FNL_MNU_ID 		
				 , A.FRT_REGI_DH		
				 , A.FNL_MDF_DH 		
				 , A.NOP_SUM 		
				 , A.HD_AUD_STEP_CD 	
				 , A.HD_DOC_ID		
				 , A.HD_APVR_CD		
				 , A.HD_AFF_SNO 		
				 , A.HD_DSP_RQ_SNO	
				 , A.REF_DOC_ID 		
				 , A.DF_AUD_STEP_CD 	
				 , A.DF_DOC_ID 		
				 , A.DF_APVR_CD 		
				 , A.DF_AFF_SNO		
				 , A.DF_DSP_RQ_SNO 	
				 , A.KYWD1			
				 , A.KYWD2 			
				 , A.KYWD3 			
				 , A.KYWD4			
				 , A.KYWD5
			 FROM TBBADDED146M A
			 WHERE A.AUD_YR = #{audYr}
			   AND A.AUD_NO = #{audNo}
			   AND A.AUD_STEP_CD = #{audStepCd}
			   AND A.APVR_CD = #{apvrCd}
			   AND A.MTRL_IPT_DVSN_CD  IN ( '10', '30')
	           AND A.RPRT_FILD_ID IN (${affSnosToDelete})
	           <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
		            AND DOC_ID = (SELECT B.REF_ID 
		                                 FROM TBBADDED103M B 
		                                WHERE B.AUD_YR =  A.AUD_YR
		                                   AND B.AUD_NO =  A.AUD_NO 
		                                   AND B.AUD_STEP_CD = 'A1070'
		                                   AND B.RPRT_CD = 'A10600200'  
		                                   AND B.DOC_ID = #{docId})
				</if>
				 <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
		           AND A.DOC_ID = #{docId}
				</if>
				;			
			/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.deleteBADDED146M*/
			DELETE
			  FROM TBBADDED146M A
			 WHERE A.AUD_YR = #{audYr}
			   AND A.AUD_NO = #{audNo}
			   AND A.AUD_STEP_CD = #{audStepCd}
			   AND A.APVR_CD = #{apvrCd}
			   AND A.MTRL_IPT_DVSN_CD  IN ( '10', '30')
	           AND A.RPRT_FILD_ID IN (${affSnosToDelete})
	           <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
		            AND DOC_ID = (SELECT B.REF_ID 
		                                 FROM TBBADDED103M B 
		                                WHERE B.AUD_YR =  A.AUD_YR
		                                   AND B.AUD_NO =  A.AUD_NO 
		                                   AND B.AUD_STEP_CD = 'A1070'
		                                   AND B.RPRT_CD = 'A10600200'  
		                                   AND B.DOC_ID = #{docId})
				</if>
				 <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
		           AND A.DOC_ID = #{docId}
				</if>
				;
		END;
	</delete>

	<delete id="deleteBADDED147M" parameterType="paramMap">
    DECLARE
    	BEGIN
   		 INSERT INTO TBBADDED147H
        			(
        			    HST_DVSN_CD
					  , HST_SNO
					  , HST_DH
					  , HST_USR_ID	
                      , AUD_YR
                      , AUD_NO
                      , AUD_STEP_CD
                      , APVR_CD
                      , AUD_KND_CD
                      , PRE_AFF_NO
                      , AFF_NO
                      , AFF_SNO
                      , DSP_RQ_SNO
                      , DOC_ID
                      , MPP_SEQ
                      , SORT_SNO
                      , RPRT_FILD_ID
                      , FRT_USR_ID
                      , FNL_USR_ID
                      , FNL_DEAL_DPT_CD
                      , FNL_MNU_ID
                      , FRT_REGI_DH
                      , FNL_MDF_DH
                     )
					SELECT 'D'
						 	 , TBBADDED147H_SEQ.NEXTVAL
						 	 , SYSDATE
						 	 , #{usrId}
		                     , A.AUD_YR
		                     , A.AUD_NO
		                     , A.AUD_STEP_CD
		                     , A.APVR_CD
		                     , A.AUD_KND_CD
		                     , A.PRE_AFF_NO
		                     , A.AFF_NO
		                     , A.AFF_SNO
		                     , A.DSP_RQ_SNO
		                     , A.DOC_ID
		                     , A.MPP_SEQ
		                     , A.SORT_SNO
		                     , A.RPRT_FILD_ID
		                     , A.FRT_USR_ID
		                     , A.FNL_USR_ID
		                     , A.FNL_DEAL_DPT_CD
		                     , A.FNL_MNU_ID
		                     , A.FRT_REGI_DH
		                     , A.FNL_MDF_DH
					  FROM TBBADDED147M A
					 WHERE A.AUD_YR = #{audYr}
					   AND A.AUD_NO = #{audNo}
					   AND A.AUD_STEP_CD = #{audStepCd}
					   AND A.APVR_CD = #{apvrCd}
			           AND A.RPRT_FILD_ID IN (${affSnosToDelete})
			          <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
			           AND A.DOC_ID =  (SELECT B.REF_ID 
				                                 FROM TBBADDED103M B 
				                                WHERE B.AUD_YR =  A.AUD_YR
				                                   AND B.AUD_NO =  A.AUD_NO 
				                                   AND B.AUD_STEP_CD =  'A1070'
				                                   AND B.RPRT_CD = 'A10600200'  
				                                   AND B.DOC_ID = #{docId})
			           </if>
						<if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
				           AND A.DOC_ID = #{docId}
						</if>
		            ;	
				/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.deleteBADDED147M*/
				DELETE
				  FROM TBBADDED147M A
				 WHERE A.AUD_YR = #{audYr}
				   AND A.AUD_NO = #{audNo}
				   AND A.AUD_STEP_CD = #{audStepCd}
				   AND A.APVR_CD = #{apvrCd}
		           AND A.RPRT_FILD_ID IN (${affSnosToDelete})
		          <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
		           AND A.DOC_ID =  (SELECT B.REF_ID 
			                                 FROM TBBADDED103M B 
			                                WHERE B.AUD_YR =  A.AUD_YR
			                                   AND B.AUD_NO =  A.AUD_NO 
			                                   AND B.AUD_STEP_CD =  'A1070'
			                                   AND B.RPRT_CD = 'A10600200'  
			                                   AND B.DOC_ID = #{docId})
		           </if>
					<if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
			           AND A.DOC_ID = #{docId}
					</if>
				;
		END;
	</delete>

	<select id="selectIndcSbjRqList" parameterType="paramMap" resultType="egovMap">
		 /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectIndcSbjRqList*/
		  SELECT D1.APVR_CD AS APVR_CD,
				 F_CODE_NM('1000161',D1.APVR_CD) AS APVR_NM,
				 D1.AFF_SNO AS AFF_SNO,
				 D1.RPRT_FILD_ID AS RPRT_FILD_ID,
				 D1.AFF_CD AS AFF_CD,
				 D1.DETL_DOC_NO AS DETL_DOC_NO,
				 D1.REFER_DVSN_CD AS REFER_DVSN_CD,				 
				 CASE WHEN D2.DSP_RQ_CD IN ('390' ,'391',  '490' ) THEN '현지조치' 
				      WHEN D2.DSP_RQ_CD IN ('395' ,'396',  '495' ) THEN '국장전결'
                      ELSE F_CODE_NM('1000774',D1.REFER_DVSN_CD)
                      END AS REFER_DVSN_NM,
				 D1.AFF_SPH AS AFF_SPH,
				 D1.TITLE_NM AS TITLE_NM,
				 D2.AFF_DSP_CD AS AFF_DSP_CD,
				 D2.DSP_RQ_CD AS DSP_RQ_CD,
				 --F_CODE_NM('1000002',D2.DSP_RQ_CD) AS DSP_RQ_NM,
                 --F_CODE_NM('1000002', D2.DSP_RQ_CD) || DECODE(NOP_AM_DVSN_CD,'10','('||NVL(D2.NOP_AM,0)||'명)','20','('||NVL(D2.NOP_AM,0)||'만원)') AS DSP_RQ_NM,
                  F_CODE_NM('1000002', D2.DSP_RQ_CD) ||
   						DECODE(NOP_AM_DVSN_CD,'10','('||TO_CHAR(NVL(D2.NOP_AM,0),'Fm999,999,999,999,999')||'명)'
                        ,'20','('||TO_CHAR(NVL(D2.NOP_SUM,0),'Fm999,999,999,999,999')||'만원)'
                        ,'30','('||TO_CHAR(NVL(D2.NOP_AM,0),'Fm999,999,999,999,999')||'명/'||TO_CHAR(NVL(D2.NOP_SUM,0),'Fm999,999,999,999,999')||'만원)') AS DSP_RQ_NM, /*처분요구코드명+인원금액*/  
				 RLTN_ORG_CD,
				 F_ORG_INFO(RLTN_ORG_CD, 1) AS RLTN_ORG_NM,
				 HND_ORG_CD,
				 F_ORG_INFO(HND_ORG_CD, 1) AS HND_ORG_NM,
				 CASE WHEN D1.QST_DOC_ISUE_YN = 'Y' THEN '발부'
					  ELSE '미발부' END AS QST_DOC_ISUE_YN,
			     D1.AUDTOR AS AUDTOR,
                 D1.LIST_NO
		    FROM TBBADDED145M D1
RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
							    AND D1.AUD_NO = D2.AUD_NO
							    AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                AND D1.DOC_ID = D2.DOC_ID
							    AND D1.APVR_CD = D2.APVR_CD
					   		    AND D1.AFF_SNO = D2.AFF_SNO
		   WHERE D1.AUD_YR = #{audYr}
			 AND D1.AUD_NO = #{audNo}
			 AND D1.AUD_STEP_CD = #{audStepCd}
			 AND D1.APVR_CD = (SELECT MAX(APVR_CD) AS APVR_CD
							   FROM TBBADDED145M
							  WHERE 1 = 1
							    AND AUD_YR = #{audYr}
							    AND AUD_NO = #{audNo}
							    AND AUD_STEP_CD = #{audStepCd})
	  ORDER BY LPAD(D1.LIST_NO, 10), AUDTOR
	</select>

	<select id="selectDspRqList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectDspRqList*/
        SELECT H1.AUD_YR AS AUD_YR,
               H1.AUD_NO AS AUD_NO,
               H1.APVR_CD,
               F_CODE_NM('1000161',H1.APVR_CD) AS APVR_NM,
               H1.AFF_SNO,
               H1.DSP_RQ_SNO,
               H1.RPRT_FILD_ID,
               H1.AFF_CD,
               H1.DETL_DOC_NO,
               H1.REFER_DVSN_CD,
               F_CODE_NM('1000774', H1.REFER_DVSN_CD) AS REFER_DVSN_NM,
               H1.AFF_SPH,
               H1.TITLE_NM,
               H1.AFF_DSP_CD,
               H1.DSP_RQ_CD,
               F_CODE_NM('1000002', H1.DSP_RQ_CD) AS DSP_RQ_NM,
               H1.RLTN_ORG_CD,
               F_ORG_INFO(H1.RLTN_ORG_CD, 1) AS RLTN_ORG_NM,
               H1.HND_ORG_CD,
               F_ORG_INFO(H1.HND_ORG_CD, 1) AS HND_ORG_NM,
               DOC_ID,
               RPRT_CD,
               DECODE(NOP_AM_DVSN_CD,'10','('||NVL(H1.NOP_AM,0)||'명)','20','('||NVL(H1.NOP_AM,0)||'만원)') AS NOP_AM,
               ACCN_INSP_CD,
               F_CODE_NM('1000792', ACCN_INSP_CD) AS ACCN_INSP_NM,
               H1.DSP_RQ_SNO,
               '처분요구별 공개문'||'-'||NVL( (SELECT T1.DSP_RQ_SNO FROM TBBADEAR001M T1 WHERE H1.AUD_YR = T1.AUD_YR AND H1.AUD_NO = T1.AUD_NO AND H1.DSP_RQ_SNO = T1.AUD_DSP_RQ_SNO ), H1.DSP_RQ_SNO) AS DSP_RQ_PUB_NM 
          FROM (
                  SELECT D1.AUD_YR AS AUD_YR,
                         D1.AUD_NO AS AUD_NO,
                         D1.APVR_CD AS APVR_CD,
                         D1.AFF_SNO AS AFF_SNO,
                         TO_CHAR(D2.DSP_RQ_SNO) AS DSP_RQ_SNO,
                         D1.RPRT_FILD_ID AS RPRT_FILD_ID,
                         D1.AFF_CD AS AFF_CD,
                         D1.DETL_DOC_NO AS DETL_DOC_NO,
                         D1.REFER_DVSN_CD AS REFER_DVSN_CD,
                         D1.AFF_SPH AS AFF_SPH,
                         D1.TITLE_NM AS TITLE_NM,
                         D2.AFF_DSP_CD AS AFF_DSP_CD,
                         D2.DSP_RQ_CD AS DSP_RQ_CD,
                         RLTN_ORG_CD,
                         HND_ORG_CD,
                         D2.NOP_AM,
                         D2.NOP_AM_DVSN_CD,
                         D2.ACCN_INSP_CD
                    FROM TBBADDED145M D1
        RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
                                        AND D1.AUD_NO = D2.AUD_NO
                                        AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                        AND D1.DOC_ID = D2.DOC_ID
                                        AND D1.APVR_CD = D2.APVR_CD
                                        AND D1.AFF_SNO = D2.AFF_SNO
                   WHERE D1.AUD_YR = #{audYr}
                     AND D1.AUD_NO = #{audNo}
                     --AND D1.AUD_STEP_CD = 'A1060'
                     <if test="apvrCd =='A1070'  ">
                          <if test="apvrCd =='A1070' or audStepCd == 'A1080'   ">
                           AND D1.DOC_ID = (
                                 SELECT B.REF_ID 
	                                 FROM TBBADDED103M B 
	                                WHERE B.AUD_YR =  D1.AUD_YR
	                                   AND B.AUD_NO =  D1.AUD_NO 
	                                   AND B.AUD_STEP_CD =  'A1070'
	                                   AND B.RPRT_CD = 'A10600200'  
	                                   AND B.DOC_ID = #{docId})
	                       </if>
                     </if>   
                    <if test="apvrCd !='A1070' ">
                        <if test="apvrCd !='A1070' or audStepCd != 'A1080'   ">
                               AND D1.DOC_ID = #{docId}
                         </if>
                     </if>
                     <if test="referDvsnCd != null and referDvsnCd != ''">
                         AND D1.REFER_DVSN_CD = #{referDvsnCd}
                     </if>
                     <if test="sytTrtmDvsnYn != null and sytTrtmDvsnYn != ''">
                         AND D1.SYT_TRTM_DVSN_YN = #{sytTrtmDvsnYn}
                     </if>
                    <if test="apvrCd =='A1070'  ">
                          <if test="apvrCd =='A1070' or audStepCd == 'A1080'   ">
                             AND D1.APVR_CD = 'A1070'
                         </if>
                     </if>   
                      <if test="apvrCd !='A1070' ">
                        <if test="apvrCd !='A1070' or audStepCd != 'A1080'   ">
                         AND D1.APVR_CD = (SELECT MAX(APVR_CD) AS APVR_CD
                                                    FROM TBBADDED145M
                                                   WHERE 1 = 1
                                                      AND AUD_YR = #{audYr}
                                                      AND AUD_NO = #{audNo}
                                                      AND DOC_ID = #{docId})
                     </if>
                     </if>   
                    ) H1
    LEFT OUTER JOIN (
                     SELECT AUD_YR,
                            AUD_NO,
                            REF_ID,
                            RPRT_CD,
                            DOC_ID
                       FROM TBBADDED103M
                      WHERE RPRT_CD = 'A10800500'
                        AND AUD_YR = #{audYr}
                        AND AUD_NO = #{audNo}
                    ) H2 ON H1.AUD_YR = H2.AUD_YR
                        AND H1.AUD_NO = H2.AUD_NO
                        AND H1.DSP_RQ_SNO = H2.REF_ID
          ORDER BY HND_ORG_NM, LPAD(H1.DSP_RQ_SNO, 10)
	</select>

	<select id="selectInnRankCd" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectInnRankCd*/
        SELECT NVL(INN_RANK_CD,'') AS INN_RANK_CD
          FROM TBDCMACM001M
         WHERE 1=1
           AND CNB = #{cnb}
    </select>

	<select id="selectAudDocList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudDocList*/
		SELECT RPRT_NM ,       /*보고서명 */
		       SORT_SNO ,      /*정렬순번  */
		       DOC_ID,         /*결재문서번호 */
		       RPRT_CD,
		       RPRT_CD AS AUD_DOC_CD,
		       F_CODE_NM('1000786', RPRT_CD) AS AUD_DOC_NM,
		       RPRT_NM AS DOC_NM,
		       AUD_RPRT_DVSN_CD
		  FROM TBBADDED103M
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   <if test="rprtCds != null and rprtCds != ''">
		   AND RPRT_CD IN (${rprtCds})
		   </if>
		   <if test="rprtCd != null and rprtCd != ''">
		   /* 2019-03-13 LCH 법률자문에서 개별사건 조회 시 수사요청서도 같이 조회되도록 추가 */
		    <if test="legal != null and legal != ''">
		    AND (RPRT_CD = #{rprtCd} OR ( NVL(#{legal},'N') = 'Y' AND (RPRT_CD = 'A10601100' OR RPRT_CD = 'A10601700')))
		    </if>
		     <if test="legal == null or legal == ''">
		    AND RPRT_CD = #{rprtCd}
		    </if>
		   </if>
		   <if test="docId != null and docId != ''">
		   AND DOC_ID = #{docId}
		   </if>
		 ORDER BY SORT_SNO
	</select>
	
	 <select id="getEdtStrEndDt" parameterType="paramMap" resultType="java.lang.String">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getEdtStrEndDt*/
		SELECT (CASE WHEN (TO_DATE(B.EDT_STR_DT || B.EDT_STR_DH,'YYYYMMDDHH24MI') >= SYSTIMESTAMP OR SYSTIMESTAMP >= TO_DATE(B.EDT_END_DT || B.EDT_END_DH,'YYYYMMDDHH24MI')) THEN 'N'
				        WHEN B.EDT_AUTH_CNBS IS NOT NULL AND INSTR(B.EDT_AUTH_CNBS,#{cnb}) = 0  THEN 'N'
			                                          	                                                                       ELSE NVL(A.EDT_AUTH,'N')
				  END) AS EDT_AUTH             
        FROM TBBADDED103M A
        LEFT OUTER JOIN TBDCMACM018M B
        ON(A.AUD_YR = B.AUD_YR AND A.AUD_NO = B.AUD_NO AND A.AUD_STEP_CD = B.AUD_STEP_CD AND A.DOC_ID = B.DOC_ID)
        WHERE 1=1
        AND A.AUD_YR = #{audYr}
        AND A.AUD_NO =#{audNo}
        AND A.AUD_STEP_CD = #{audStepCd}
        AND A.DOC_ID = #{docId}
	</select>
	
	<!-- BEST20 문서편집요청 권한 확인 -->
	<select id="getEdtStrEndDt2" parameterType="paramMap" resultType="java.lang.String">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getEdtStrEndDt2*/
		<![CDATA[
		SELECT (CASE WHEN EDT_ALLOW_DM IS NULL                                            THEN 'N' 
			             WHEN SYSDATE <= TO_DATE(EDT_ALLOW_DM||EDT_ALLOW_DH,'yyyyMMddhh24mi') THEN 'Y' ELSE 'N' END) AS EDT_YN
		 FROM TBBADDED103M A
		   LEFT OUTER JOIN 
			      TBBADDED149M B
			ON B.AUD_YR = A.AUD_YR
			AND B.AUD_NO = A.AUD_NO
		    AND B.AUD_STEP_CD = A.AUD_STEP_CD
			AND B.DOC_ID = A.DOC_ID
			AND B.SRNO = (SELECT MAX(AA.SRNO)
			                      FROM TBBADDED149M AA
			                     WHERE AA.AUD_YR = B.AUD_YR
			                       AND AA.AUD_NO = B.AUD_NO
			                       AND AA.AUD_STEP_CD = B.AUD_STEP_CD
			                       AND AA.DOC_ID = B.DOC_ID)
			AND B.APV_STA_CD = '30'
			AND NVL(B.CMPT_YN,'N')  = 'N'
      WHERE A.AUD_YR = #{audYr}
        AND A.AUD_NO =#{audNo}
        AND A.AUD_STEP_CD = #{audStepCd}
        AND A.DOC_ID = #{docId}
        
        ]]>
	</select>
	
	<select id="selectAudDocListByLegal" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudDocListByLegal*/
		SELECT D1.RPRT_NM
		     , D1.SORT_SNO
		     , D1.DOC_ID
		     , D1.RPRT_CD
		     , D1.RPRT_CD                       AS AUD_DOC_CD
		     , F_CODE_NM('1000786', D1.RPRT_CD) AS AUD_DOC_NM
		     , D1.RPRT_NM                       AS DOC_NM
		     , ''                              AS AUD_RPRT_DVSN_CD
		  FROM TBBADFRE103M D1  
    INNER JOIN TBBADFRE012M D2 ON (D2.ACP_YR = D1.ACP_YR AND D2.ACP_DVSN_CD = D1.ACP_DVSN_CD AND D2.ACP_SRNO = D1.ACP_SRNO)
	     WHERE 1=1
		   AND (
		           (
	               NVL(D2.MG_DIV_CD, '20') = '20' 
	               AND D1.ACP_YR = #{acpYr}
	               AND D1.ACP_DVSN_CD= #{acpDvsnCd}
	               AND D1.ACP_SRNO = #{acpSrno}
		           )
		           OR(
		               D2.MG_DIV_CD = '10' 
		               AND (D1.ACP_YR, D1.ACP_DVSN_CD, D1.ACP_SRNO) IN(
       		                SELECT MG_ACP_YR, MG_ACP_DVSN_CD, MG_ACP_SRNO 
		                      FROM TBBADFRE012M 
		                     WHERE ACP_YR = #{acpYr}
		                       AND ACP_DVSN_CD = #{acpDvsnCd}
		                       AND ACP_SRNO = #{acpSrno}
		               )
		           )
		       )
		   AND D1.ACP_STEP_CD IN ('E1040','D1020')
		   AND D1.RPRT_CD IN ('E10400100','D10200100')
	 	 ORDER BY D1.SORT_SNO 
	</select>

	<select id="selectAudSbjDocList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudSbjDocList*/
		SELECT RPRT_NM ,       /*보고서명 */
		       SORT_SNO ,      /*정렬순번  */
		       DOC_ID,         /*결재문서번호 */
		       RPRT_CD,
		       RPRT_CD AS AUD_DOC_CD,
		       DECODE(RPRT_CD, 'A10600540', RPRT_NM, F_CODE_NM('1000786', RPRT_CD)) AS AUD_DOC_NM,
		       RPRT_NM AS DOC_NM
		  FROM TBBADDED103M
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   <if test="audKndCd != null and audKndCd != ''">
		   AND AUD_KND_CD = #{audKndCd}
		   </if>
		   <if test="rprtCds != null and rprtCds != ''">
		   AND RPRT_CD IN (${rprtCds})
		   </if>
		   <if test="rprtCd != null and rprtCd != ''">
		   AND RPRT_CD = #{rprtCd}
		   </if>
	</select>

    <select id="selectStepAudSbjDocList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectStepAudSbjDocList*/
        SELECT RPRT_NM ,       /*보고서명 */
               SORT_SNO ,      /*정렬순번  */
               DOC_ID,         /*결재문서번호 */
               RPRT_CD,
               RPRT_CD AS AUD_DOC_CD,
               F_CODE_NM('1000786', RPRT_CD) AS AUD_DOC_NM,
               RPRT_NM AS DOC_NM,
               APV_WAY_CD,
               APV_STA_CD,
               'N' AS SAVE_YN
          FROM TBBADDED103M
         WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND APV_WAY_CD IN ('10', '30')
           AND APV_STA_CD IN ('19', '30')
           <if test="audKndCd != null and audKndCd != ''">
           AND AUD_KND_CD = #{audKndCd}
           </if>
           <if test="rprtCds != null and rprtCds != ''">
           AND RPRT_CD IN (${rprtCds})
           </if>
           <if test="rprtCd != null and rprtCd != ''">
           AND RPRT_CD = #{rprtCd}
           </if>
           AND RPRT_CD NOT IN ('A10600910', 'A10600920', 'A10600930' ,'A10600940', 'A10601000', 'A10600510', 'A10600530' ,'A10600540')
           UNION ALL
           SELECT T1.RPRT_NM ,       /*보고서명 */
                    T1.SORT_SNO ,      /*정렬순번  */
                    T1.DOC_ID,         /*결재문서번호 */
                    T1.RPRT_CD,
                    T1.RPRT_CD AS AUD_DOC_CD,
                    F_CODE_NM('1000786', T1.RPRT_CD) AS AUD_DOC_NM,
                    CASE WHEN T4.CNT = 0 THEN '('||'의견없음'||')'||T1.RPRT_NM 
                             ELSE T1.RPRT_NM END AS DOC_NM,
                    T1.APV_WAY_CD,
                    T1.APV_STA_CD,
                    CASE WHEN ROUND((TO_DATE(TO_CHAR(T1.FNL_MDF_DH, 'YYYYMMDDHH24MISS'), 'YYYYMMDDHH24MISS')  - TO_DATE(TO_CHAR(T1.FRT_REGI_DH, 'YYYYMMDDHH24MISS'), 'YYYYMMDDHH24MISS'))*(24*60*60), 3) > 5  THEN 'Y'
                           ELSE 'N'
                          END AS SAVE_YN
          FROM TBBADDED103M T1 
                   INNER JOIN (SELECT T1.AUD_YR, T1.AUD_NO, T2.DOC_ID,  SUM(DECODE(T1.OPIN_NO_YN, 'Y', 0, 1)) AS CNT
                                     FROM TBBADDED141M T1 
                                              INNER JOIN TBBADDED145M T2 
                                                        ON T1.AUD_YR = T2.AUD_YR
                                                      AND T1.AUD_NO = T2.AUD_NO
                                                      AND T2.APVR_CD IN ('0015800', '0035100', '0058100')
                                                      AND T1.RPRT_FILD_ID = T2.RPRT_FILD_ID
                                     WHERE T1.AUD_YR = #{audYr}
                                        AND T1.AUD_NO = #{audNo}
                                       GROUP BY  T2.DOC_ID   ,T1.AUD_YR, T1.AUD_NO) T4
                                ON T1.AUD_YR = T4.AUD_YR
                               AND T1.AUD_NO  = T4.AUD_NO
                               AND T1.REF_ID = T4.DOC_ID
         WHERE T1.AUD_YR = #{audYr}
           AND T1.AUD_NO = #{audNo}
           AND T1.APV_WAY_CD IN ('10', '30')
           <!-- 2019.09.17 특수의료용도등식품 관련  감사사항은 표삽입으로 취합본을 검토보고(A10600530)로 대치함 감사가 종료 된 이후에는 해당 코드를 제거해도 됨 cjLee-->
           <choose>
               <when test="audYr == '2019' and audNo == '389' ">
                    AND RPRT_CD  = 'A10600530'
               </when>
               <otherwise>
                     AND RPRT_CD  = 'A10600540'
               </otherwise>
             </choose>
         ORDER BY RPRT_CD 
    </select>

	<select id="getOnrUserInfo" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getOnrUserInfo*/
		SELECT	D1.USR_ID,
        D1.EML_AD,
        D1.DPT_CD,
        F_DPT_INFO(D1.DPT_CD,'6') AS GCC_DPT_CD,
        D2.FRML_DPT_NM AS DPT_NM,
        D1.USR_NAM,
        D1.RANK_NM_2 AS POSITION_NM,
        D1.PST_CD,
        F_CODE_NM('1000176', D1.PST_CD) AS PST_NM,
        D2.FRML_DPT_NM,
        D2.MANPOWER_POOL_SYE_YN
        <if test =" (audYr != null or audYr != '') and (audNo != null or audNo != '') " >
        ,CASE WHEN MANPOWER_POOL_SYE_YN ='Y'
              THEN F_DPT_INFO((
		       SELECT MNG_DPT_CD
		         FROM TBBADDED001M
		        WHERE AUD_YR = #{audYr}
		          AND AUD_NO = #{audNo}),'6')
             ELSE F_DPT_INFO(D1.DPT_CD,'6') 
         END AS MP_GCC_DPT_CD 
        ,CASE WHEN MANPOWER_POOL_SYE_YN ='Y'
              THEN 
		       (SELECT S2.FRML_DPT_NM
		         FROM TBBADDED001M S1
                    , TBDCMACM002M S2
		        WHERE AUD_YR = #{audYr}
		          AND AUD_NO = #{audNo}
		          AND S1.MNG_DPT_CD = S2.DPT_CD)
             ELSE D2.FRML_DPT_NM
         END AS MP_DPT_NM   
        </if>   
        <if test =" audDocCd != null or audDocCd != '' " >   
        ,CASE WHEN MANPOWER_POOL_SYE_YN ='Y'
              THEN
               (SELECT DECODE(TSK_KND_CD, 'A10', 'Y', 'N')
                  FROM TBFDMADM001M
                 WHERE AUD_STEP_CD != 'A0000' /* 문서작성기 조회제거 */
                   AND AUD_DOC_CD = #{audDocCd})
               ELSE 'N'
         END AS MP_A10_YN                 
        ,CASE WHEN D2.MANPOWER_POOL_SYE_YN = 'Y' AND D2.ORZT_DVSN_CD = '20' THEN (SELECT F_DPT_INFO(DPT_CD,'6')
						                                                            FROM TBDCMACM002M
                                                                                   WHERE DPT_SNO = (SELECT MIN(DPT_SNO)
                                                                                                      FROM TBDCMACM002M A
                                                                                                     WHERE A.HIRK_DPT_CD = D1.DPT_CD
                                                                                                       AND A.USE_YN = 'Y'
                                                                                                    )
                                                                                     AND HIRK_DPT_CD = D1.DPT_CD
                                                                                 )
             ELSE F_DPT_INFO(D1.DPT_CD,'6')
            END CMM_DPT_CD
        ,CASE WHEN D2.MANPOWER_POOL_SYE_YN = 'Y' AND D2.ORZT_DVSN_CD = '20' THEN (SELECT FRML_DPT_NM
						                                                            FROM TBDCMACM002M
                                                                                   WHERE DPT_SNO = (SELECT MIN(DPT_SNO)
                                                                                                      FROM TBDCMACM002M A
                                                                                                     WHERE A.HIRK_DPT_CD = D1.DPT_CD
                                                                                                       AND A.USE_YN = 'Y'
                                                                                                    )
                                                                                     AND HIRK_DPT_CD = D1.DPT_CD
                                                                                 )
             ELSE D2.FRML_DPT_NM
            END CMM_DPT_NM
        </if>         
		  FROM	TBDCMACM001M D1
		      , TBDCMACM002M D2
		 WHERE 	USR_ID = #{usrId}
		   AND	D1.DPT_CD = D2.DPT_CD  
	</select>

    <select id="getOnrAdministrativeNumSeq" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getOnrAdministrativeNumSeq*/
        SELECT ONR_ADMINISTRATIVENUM_SEQ.NEXTVAL AS ONR_ADMINISTRATIVENUM_SEQ
          FROM DUAL
    </select>


    <select id="getReviewCmptYn" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getReviewCmptYn*/
        SELECT DECODE(RVW_CMPT_YN, 'Y', 'Y', 'N') AS RVW_CMPT_YN   /* 심의완료 여부 */
	    FROM TBBADDED112D
	    WHERE AUD_YR = #{audYr}
	       AND AUD_NO = #{audNo}
	       AND DOC_ID = #{refId}
    </select>

    <select id="getAudExecNo" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getAudExecNo*/
        SELECT  CASE WHEN DVSN_CD IN ('1','2','3') THEN (SELECT S1.ACP_YR||'-'||F_CODE_NM('1000740',S1.REQ_DVSN_CD)||'-'||S1.RM_CVPT_ACP_NO
                                                                  FROM TBCSPDCP101M S1
                                                                 WHERE T1.TSK_KEY1 = S1.ACP_YR
                                                                   AND T1.TSK_KEY2 = S1.REQ_DVSN_CD
                                                                   AND T1.TSK_KEY3 = S1.CVPT_ACP_NO)
                            WHEN DVSN_CD = '4'              THEN T1.TSK_KEY1 ||'-국회-'|| T1.TSK_KEY3		/*국회 로직 추가 2017.01.11 전상철*/
                            WHEN DVSN_CD IN ('5','6','7') THEN (SELECT CASE WHEN S1.ACP_YR >= '2016' THEN S1.ACP_YR || '-' || DECODE(S1.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || S1.ACP_SRNO
                                                                            ELSE S1.ACP_YR || '-' || S1.ACP_DVSN_CD || '-' || S1.ACP_SRNO END
                                                                  FROM TBBADFRE012M S1
                                                                 WHERE T1.TSK_KEY1 = S1.ACP_YR
                                                                   AND T1.TSK_KEY2 = S1.ACP_DVSN_CD
                                                                   AND T1.TSK_KEY3 = S1.ACP_SRNO
                                                                   AND T1.TSK_KEY4 = S1.DPT_CD)
                            WHEN DVSN_CD IN ('8','9')     THEN (SELECT CASE WHEN S1.OGN_DVSN_CD = '6' THEN S1.YR||'-판청-'||S1.ACP_NO
                                                                            ELSE S1.YR||'-손망-'||S1.ACP_NO END
                                                                  FROM TBBADGDA001M S1
                                                                 WHERE T1.TSK_KEY1 = S1.ORG_CD
                                                                   AND T1.TSK_KEY2 = S1.NTF_DVSN_CD
                                                                   AND T1.TSK_KEY3 = S1.NNB)
                            WHEN DVSN_CD = '0'            THEN TSK_KEY1 ||'-정보-'|| TSK_KEY2
                            WHEN DVSN_CD = 'A'            THEN F_MNG_KND_AUDYRNO(TSK_KEY1, TSK_KEY2, (SELECT AUD_KND_CD
                                                                                                        FROM TBBADDED001M
                                                                                                       WHERE AUD_YR = TSK_KEY1
                                                                                                         AND AUD_NO = TSK_KEY2), '-') ||'-'|| TSK_KEY3 ||'-'|| F_ORG_INFO(TSK_KEY4,'1')
                            WHEN DVSN_CD = 'C'            THEN TSK_KEY1 ||'-청금-'||(SELECT RM_CVPT_ACP_NO FROM TBDCPDCP101M WHERE 1=1 AND ACP_YR = TSK_KEY1 AND REQ_DVSN_CD = TSK_KEY2 AND CVPT_ACP_NO = TSK_KEY3)
					                                                                                      /*청탁금지법 추가 2020.12.15 최성호*/
                           WHEN DVSN_CD = 'D'            THEN TSK_KEY1 ||'-'||F_CODE_NM('1000742', 'D')||'-'|| (SELECT RM_CVPT_ACP_NO FROM TBCORCOR101M WHERE 1=1 AND ACP_YR = TSK_KEY1 AND REQ_DVSN_CD = TSK_KEY2 AND CVPT_ACP_NO = TSK_KEY3)
															     										 /*부패방지법 추가 2020.12.15 최성호*/
                            ELSE ''
                        END AS EXEC_NO
                      ,CASE WHEN DVSN_CD IN ('1','2','3') THEN (SELECT S1.TIT_NM
                                                                    FROM TBCSPDCP101M S1
                                                                   WHERE T1.TSK_KEY1 = S1.ACP_YR
                                                                       AND T1.TSK_KEY2 = S1.REQ_DVSN_CD
                                                                     AND T1.TSK_KEY3 = S1.CVPT_ACP_NO)

                            WHEN DVSN_CD = '4'            THEN (SELECT S1.AUD_REQ_TIT_NM
                                                                  FROM TBCSPEAR007M S1
                                                                 WHERE T1.TSK_KEY1 = S1.ACP_YR
                                                                   AND T1.TSK_KEY2 = S1.REQ_DVSN_CD
                                                                   AND T1.TSK_KEY3 = S1.CVPT_ACP_NO
                                                                     )	/*국회 로직 추가 2017.01.11 전상철*/
                            WHEN DVSN_CD IN ('5','6','7') THEN (SELECT S1.TIT_NM
                                                                  FROM TBBADFRE012M S1
                                                                 WHERE T1.TSK_KEY1 = S1.ACP_YR
                                                                   AND T1.TSK_KEY2 = S1.ACP_DVSN_CD
                                                                   AND T1.TSK_KEY3 = S1.ACP_SRNO
                                                                   AND T1.TSK_KEY4 = S1.DPT_CD)
                            WHEN DVSN_CD IN ('8','9')     THEN (SELECT S1.TIT_NM
                                                                  FROM TBBADGDA001M S1
                                                                 WHERE T1.TSK_KEY1 = S1.ORG_CD
                                                                   AND T1.TSK_KEY2 = S1.NTF_DVSN_CD
                                                                   AND T1.TSK_KEY3 = S1.NNB)
                            WHEN DVSN_CD = '0'            THEN (SELECT TIT_TXT
                                                                  FROM TBCSPBII100M S1
                                                                 WHERE S1.YE   = T1.TSK_KEY1
                                                                   AND S1.SRNO = T1.TSK_KEY2)
                            WHEN DVSN_CD = 'A'            THEN (SELECT TIT_TXT
                                                                  FROM TBBADEAR001M S1
                                                                 WHERE S1.AUD_YR      = T1.TSK_KEY1
                                                                   AND S1.AUD_NO      = T1.TSK_KEY2
                                                                   AND S1.DSP_RQ_SNO  = T1.TSK_KEY3)
                            WHEN DVSN_CD = 'C'            THEN (SELECT TIT_NM
                                                           FROM TBDCPDCP101M
                                                           WHERE 1=1
                                                           AND ACP_YR = T1.TSK_KEY1
                                                           AND REQ_DVSN_CD = T1.TSK_KEY2
                                                           AND CVPT_ACP_NO = T1.TSK_KEY3) /*청탁금지법 추가 2020.12.15 최성호*/
                  		 WHEN DVSN_CD = 'D'            THEN (SELECT TIT_NM
                                                           FROM TBCORCOR101M
                                                           WHERE 1=1
                                                           AND ACP_YR = T1.TSK_KEY1
                                                           AND REQ_DVSN_CD = T1.TSK_KEY2
                                                           AND CVPT_ACP_NO = T1.TSK_KEY3) /*청탁금지법 추가 2020.12.15 최성호*/
                            ELSE '' END AS EXEC_TIT_NM
                  FROM TBBADDED030L T1
                 WHERE T1.AUD_YR = #{audYr}
                   AND T1.AUD_NO = #{audNo}
              ORDER BY T1.SRNO
    </select>

	<select id="getAudDocData" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getAudDocData*/
		<if test=" 'Y'.toString() == onlyDocIdParam " >
             SELECT T.* FROM (
      </if>
		SELECT F.* 
			, F_USR_INFO_BY_ID( F.DOC_WRT_ID, '2' ) AS DOC_WRT_NM
			, F_CODE_NM('1000773', F.APV_STA_CD) AS APV_STA_NM
			, F_CODE_NM('1000786', F.RPRT_CD) AS ORG_RPRT_NM
			, (SELECT ST.AUD_SBJ_NM FROM TBBADDED001M ST WHERE ST.AUD_YR = F.AUD_YR AND ST.AUD_NO = F.AUD_NO) AS AUD_SBJ_NM
            , CASE WHEN F.RPRT_CD = 'A10800500' THEN  '처분요구별 공개문'||'-'||NVL( (SELECT TO_CHAR(T1.DSP_RQ_SNO) FROM TBBADEAR001M T1 WHERE F.AUD_YR = T1.AUD_YR AND F.AUD_NO = T1.AUD_NO AND F.REF_ID = TO_CHAR(T1.AUD_DSP_RQ_SNO) ), F.REF_ID)   
			       ELSE ''  END AS DSP_RQ_PUB_NM
		FROM TBBADDED103M F
	     WHERE 1=1
	    <if test =" onlyDocIdParam == null or onlyDocIdParam == '' " >
	       AND F.AUD_YR = #{audYr}
		   AND F.AUD_NO = #{audNo}
		   AND F.AUD_STEP_CD = #{audStepCd}
     	   AND ((F.DOC_ID = #{docId})
            OR F.DOC_ID = (SELECT T1.REF_ID
                  FROM TBBADDED111M T1
                 WHERE F.AUD_YR = T1.AUD_YR
                   AND F.AUD_NO = T1.AUD_NO
                   AND T1.DOC_ID = #{docId}
                   AND T1.RPRT_CD = 'A10600200'
                   AND EXISTS (SELECT 1
                                FROM TBDCMACM013C T2
                               WHERE T2.CD_NM =#{cnb}
                                 AND T2.CMM_CD_DVSN_CD = '1000914'
                                 AND T2.USR_DFN_TXT_1 IN ('10','20'))) ) 
     	</if>
     	<if test=" 'Y'.toString() == onlyDocIdParam " >
         	AND ((F.DOC_ID = #{docId})
            OR F.DOC_ID = (SELECT T1.REF_ID
                  FROM TBBADDED111M T1
                 WHERE F.AUD_YR = T1.AUD_YR
                   AND F.AUD_NO = T1.AUD_NO
                   AND T1.DOC_ID = #{docId}
                   AND T1.RPRT_CD = 'A10600200'
                   AND EXISTS (SELECT 1
                                FROM TBDCMACM013C T2
                               WHERE T2.CD_NM =#{cnb}
                                 AND T2.CMM_CD_DVSN_CD = '1000914'
                                 AND T2.USR_DFN_TXT_1 IN ('10','20'))) ) 
         	ORDER BY F.AUD_STEP_CD DESC
         ) T
         WHERE ROWNUM=1
      </if>   
	</select>
	
	<!-- BEST20 문서정보 조회(문서편집요청) -->
	<select id="getAudDocDataEdt" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getAudDocDataEdt*/
		<![CDATA[
		SELECT F.* 
			, F_USR_INFO_BY_ID( F.DOC_WRT_ID, '2' ) AS DOC_WRT_NM
			, F_CODE_NM('1000773', F.APV_STA_CD) AS APV_STA_NM
			, F_CODE_NM('1000786', F.RPRT_CD) AS ORG_RPRT_NM
			, (SELECT ST.AUD_SBJ_NM FROM TBBADDED001M ST WHERE ST.AUD_YR = F.AUD_YR AND ST.AUD_NO = F.AUD_NO) AS AUD_SBJ_NM
            , CASE WHEN F.RPRT_CD = 'A10800500' THEN  '처분요구별 공개문'||'-'||NVL( (SELECT TO_CHAR(T1.DSP_RQ_SNO) FROM TBBADEAR001M T1 WHERE F.AUD_YR = T1.AUD_YR AND F.AUD_NO = T1.AUD_NO AND F.REF_ID = TO_CHAR(T1.AUD_DSP_RQ_SNO) ), F.REF_ID)   
			       ELSE ''  END AS DSP_RQ_PUB_NM
			, B.APV_RQS_ID     AS EDT_RQS_APV_RQS_ID  /* BEST20 결재요청ID */
            , B.APV_STA_CD     AS EDT_RQS_APV_STA_CD  /* BEST20 편집요청상태코드 */
            , B.RQR_ID         AS EDT_RQR_ID          /* BEST20 요청자 */
            , B.EDT_ALLOW_DM                          /* BEST20 편집허용일자 */
            , B.EDT_ALLOW_DH                          /* BEST20 편집허용일시 */
            , (CASE WHEN B.EDT_ALLOW_DM IS NULL OR B.CMPT_YN = 'Y'                                         THEN 'N' 
                       WHEN SYSDATE <= TO_DATE(B.EDT_ALLOW_DM||B.EDT_ALLOW_DH,'yyyyMMddhh24mi') THEN 'Y' ELSE 'N' END) AS EDT_YN
		FROM TBBADDED103M F
	    LEFT OUTER JOIN
                    TBBADDED149M B
                 ON B.AUD_YR = F.AUD_YR
                AND B.AUD_NO = F.AUD_NO
                AND B.AUD_STEP_CD = F.AUD_STEP_CD
                AND B.DOC_ID = F.DOC_ID
                AND B.SRNO = (SELECT MAX(AA.SRNO)
                                FROM TBBADDED149M AA
                               WHERE AA.AUD_YR = B.AUD_YR
                                 AND AA.AUD_NO = B.AUD_NO
                                 AND AA.AUD_STEP_CD = B.AUD_STEP_CD
                                 AND AA.DOC_ID = B.DOC_ID)
	     WHERE 1=1
	       AND F.AUD_YR = #{audYr}
		   AND F.AUD_NO = #{audNo}
		   AND F.AUD_STEP_CD = #{audStepCd}
     	   AND ((F.DOC_ID = #{docId})
            OR F.DOC_ID = (SELECT T1.REF_ID
                  FROM TBBADDED111M T1
                 WHERE F.AUD_YR = T1.AUD_YR
                   AND F.AUD_NO = T1.AUD_NO
                   AND T1.DOC_ID = #{docId}
                   AND T1.RPRT_CD = 'A10600200'
                   AND EXISTS (SELECT 1
                                FROM TBDCMACM013C T2
                               WHERE T2.CD_NM =#{cnb}
                                 AND T2.CMM_CD_DVSN_CD = '1000914'
                                 AND T2.USR_DFN_TXT_1 IN ('10','20'))) ) 
       ]]>
	</select>


	<select id="getAudTmpDocData" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getAudTmpDocData*/
		SELECT APV_WAY_CD,
       		   AUD_DOC_KND_CD,
       		   DOC_PRD_DPT_CD,
               CON_PGM_CD,
	   		   CASE WHEN MNT_CHO_CD = '10' THEN 'Y'
            	    ELSE 'N' END AS MNT_CHO_YN,
	   		   TRNM_POSS_YN
  		  FROM TBFDMADM001M
  		 WHERE AUD_DOC_CD = #{audDocCd}
	</select>

	<select id="selectOrgList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOrgList*/
		SELECT ORG_CD AS RLTN_ORG_CD,
		       ORG_NM AS RLTN_ORG_NM,
		       COPT_SG_CD || '000000000' AS HND_ORG_CD,
		       F_ORG_INFO(COPT_SG_CD || '000000000', 1) AS HND_ORG_NM
		  FROM TBDCMACM015M
		 WHERE USE_DVSN_NO = 'Y'
		 	<if test="rltnOrgNm != null and rltnOrgNm != ''">
		  	   AND ORG_NM = #{rltnOrgNm}
		    </if>
	</select>

	<select id="selectAudDocIdFDMADM002M" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudDocIdFDMADM002M*/
		SELECT DECODE(#{docType},'HWP', HWP_DOC_ID, DOC_ID ) AS DOC_ID,
			   DTIL_AUD_DOC_NM,
               IDVT_DSP_RQ_PLAN_CD
		  FROM TBFDMADM002M
	     WHERE AUD_DOC_CD = #{audDocCd}
	</select>

    <select id="selectAudDocIdByPlanCodeFDMADM002M" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudDocIdByPlanCodeFDMADM002M*/
        SELECT DECODE(#{docType},'HWP', HWP_DOC_ID, DOC_ID ) AS DOC_ID,
               DTIL_AUD_DOC_NM
          FROM TBFDMADM002M
         WHERE IDVT_DSP_RQ_PLAN_CD = #{idvtDspRqPlanCd}
         <if test="audDocCd != null and audDocCd != '' ">
           AND AUD_DOC_CD = #{audDocCd}
           </if>
    </select>

	<select id="selectAudDocIdFDMBTM001M" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudDocIdFDMBTM001M*/
		SELECT DECODE(#{docType},'HWP', HWP_DOC_ID, DOC_ID ) AS DOC_ID
		  FROM TBFDMBTM001M
	     WHERE AUD_DOC_TMP_CD = #{audDocCd}
	</select>

	<select id="getRvwRfrMtrl" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getRvwRfrMtrl*/
		SELECT AUD_YR 
                , AUD_NO
                , DOC_ID
			    , RPRT_FILD_ID
			    , SRNO
		  FROM TBBADDED115M
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		<if test="srno != null and srno != '' ">
		    AND SRNO = #{srno}
        </if>
        <if test="rprtFildId != null and rprtFildId != '' ">
		    AND RPRT_FILD_ID = #{rprtFildId}
        </if>
        ORDER BY SRNO
	</select>

	<select id="selectMaxSrnoBADDED115M" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectMaxSrnoBADDED115M*/
		SELECT NVL(MAX(SRNO),0)+1 AS SRNO
	  	  FROM TBBADDED115M
	     WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
	</select>

	<insert id="insertBADDED115M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBADDED115M*/
		INSERT INTO TBBADDED115M (AUD_YR,
								  AUD_NO,
								  SRNO,
								  RPRT_FILD_ID,
								  DOC_ID,
								  FRT_USR_ID,
								  FNL_USR_ID,
								  FNL_DEAL_DPT_CD,
								  FNL_MNU_ID,
								  FRT_REGI_DH,
								  FNL_MDF_DH)
		   		          VALUES (#{audYr},
		   		           		  #{audNo},
		   		           		  #{srno},
		   		           		  #{rprtFildId},
		   		           		  #{docId},
				        		  #{usrId},    /*세션정보*/
                                  #{usrId},
                                  #{dptCd},
                                  #{menuNo},
                                  SYSDATE,
                                  SYSDATE)
	</insert>

	<update id="updateBADDED115M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED115M*/
		UPDATE TBBADDED115M
		   SET FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
			   <if test="rprtFildId != null and rprtFildId != ''">
			   ,RPRT_FILD_ID = #{rprtFildId}
			   </if>
			   <if test="docId != null and docId != ''">
			   ,DOC_ID = #{docId}
			   </if>
		 WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
		   AND SRNO = #{srno}
	</update>

	<select id="selectEviDcmbList" parameterType="paramMap" resultType="egovMap">
	<![CDATA[
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectEviDcmbList 위 */
		 SELECT T.* FROM (
			SELECT D1.AUD_YR,
				    D1.AUD_NO,
				    D1.EVI_DCMB_SNO,
				    D1.AUD_DCM_DOC_ID,
                    D1.AUD_DCM_CRE_ID,
				    D1.AUD_KND_CD,
				    D1.AUD_GRN_NO,
				    D1.EVI_DCM_DVSN_CD,
	                F_CODE_NM('1000776',D1.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM,
	                D2.FOLDER_NM,
				    D1.FILE_NM,
				    D1.ISUE_DY,
				    D1.EVI_DCMB_DVSN_CD,
				    D1.SORT_SNO,
				    D1.AFF_SNO,
	                (SELECT USR_NAM FROM TBDCMACM001M D3 WHERE D3.USR_ID = D1.AUD_DCM_CRE_ID) AS USR_NAM,
	                D1.EVI_DCM_NO,
	                D1.EVI_DCM_GRP_SNO
	 		   FROM TBBADDED108D D1
	LEFT OUTER JOIN TBBADDED108M D2 ON D1.AUD_YR = D2.AUD_YR AND D1.AUD_NO = D2.AUD_NO AND D1.EVI_DCM_GRP_SNO = D2.EVI_DCMB_SNO
	          WHERE D1.AUD_YR = #{audYr}
	            AND D1.AUD_NO = #{audNo}
	            AND D1.EVI_DCM_DVSN_CD <> '99'
	            AND D1.DOC_STA_CD = 'Y'
	            AND D1.DESTROY_YN = 'N'
	]]>
          <if test=" searchByUserYn == 'Y'.toString() ">
	            AND (#{usrId} IN ( SELECT A.AUD_DCM_SHARE_ID
                                          FROM TBBADDED108L A
                                        WHERE A.AUD_YR =D1.AUD_YR
                                           AND A.AUD_NO = D1.AUD_NO
                                           AND A.AUD_DCM_CRE_ID = D1.AUD_DCM_CRE_ID) OR D1.AUD_DCM_CRE_ID =#{usrId})
	   	   </if>
           <if test="eviDcmDvsnCd != null and eviDcmDvsnCd != ''">
           AND D1.EVI_DCM_DVSN_CD = #{eviDcmDvsnCd}
           </if>
           <if test="folderNm != null and folderNm != ''">
           AND D2.FOLDER_NM LIKE '%' || #{folderNm} || '%'
           </if>
           <if test="fileNm != null and fileNm != ''">
           AND D1.FILE_NM LIKE '%' || #{fileNm} || '%'
           </if>
           <if test="usrNam != null and usrNam != ''">
           AND  (SELECT USR_NAM FROM TBDCMACM001M D3 WHERE D3.USR_ID = D1.AUD_DCM_CRE_ID)  LIKE '%' || #{usrNam} || '%'
           </if>
            <if test="strAudDcmId != null and strAudDcmId != ''">
           AND  D1.AUD_DCM_DOC_ID IN (${strAudDcmId})
           </if>
            ) T
	  ORDER BY T.USR_NAM, T.EVI_DCM_DVSN_CD, T.EVI_DCM_NO

	</select>

	<select id="selectMaxEviDcmMppSno" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectMaxEviDcmMppSno*/
		SELECT NVL(MAX(EVI_DCM_MPP_SNO),0)+1 AS EVI_DCM_MPP_SNO
	  	  FROM TBBADDED110M
	     WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
	</select>

	<delete id="deleteBADDED110M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.deleteBADDED110M*/
		DELETE
		  FROM TBBADDED110M
	     WHERE AUD_YR = #{delAudYr}
           AND AUD_NO = #{delAudNo}
           <if test="delDocId != null and delDocId != ''">
		   	   AND DOC_ID = #{delDocId}
		   </if>
		   <if test="delRprtFildId != null and delRprtFildId != ''">
			   AND RPRT_FILD_ID = #{delRprtFildId}
		   </if>
	</delete>

	<insert id="insertBADDED110M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBADDED110M*/
		INSERT INTO TBBADDED110M (AUD_YR,
								  AUD_NO,
								  EVI_DCM_MPP_SNO,
								  AUD_KND_CD,
								  AUD_GRN_NO,
								  DOC_ID,
								  AUD_DCM_DOC_ID,
								  RPRT_FILD_ID,
								  EVI_DCMB_SNO,
								  EVI_MPP_DVSN_CD,
								  SORT_SNO,
								  FRT_USR_ID,
								  FNL_USR_ID,
								  FNL_DEAL_DPT_CD,
								  FNL_MNU_ID,
								  FRT_REGI_DH,
								  FNL_MDF_DH)
		   		          VALUES (#{audYr},
		   		           		  #{audNo},
		   		           		  #{eviDcmMppSno},
		   		           		  #{audKndCd},
		   		           		  #{audGrnNo},
		   		           		  #{docId},
		   		           		  #{audDcmDocId},
		   		           		  #{rprtFildId},
		   		           		  #{eviDcmbSno},
 		   		           		  #{eviMppDvsnCd}, /*'10',*/
  		   		           		  #{eviDcmMppSno},
				        		  #{usrId},    /*세션정보*/
                                  #{usrId},
                                  #{dptCd},
                                  #{menuNo},
                                  SYSDATE,
                                  SYSDATE)
	</insert>

	<select id="selectEviDcmbMapList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectEviDcmbMapList 아래*/
        <![CDATA[
        SELECT T.* FROM (
            
    		 SELECT DISTINCT D1.AUD_YR,
    			    D1.AUD_NO,
    			    D1.EVI_DCM_MPP_SNO,
    			    D1.AUD_KND_CD,
    			    D1.AUD_GRN_NO,
    			    D1.DOC_ID,
    			    D2.FOLDER_NM,
    			    D3.FILE_NM,
    			    D3.FILE_NM AS DOC_NM,
    			    D1.AUD_DCM_DOC_ID,
    			    D1.RPRT_FILD_ID,
    			    D1.EVI_DCMB_SNO,
    			    D1.EVI_MPP_DVSN_CD,
    		  	    D1.SORT_SNO,
                    D1.HYPER_LINK_YN,
                    D3.EVI_DCM_DVSN_CD,
                    F_CODE_NM('1000776',D3.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM,
                    D3.FILE_SIZE,
                    D3.EVI_DCM_NO,
                    D3.EVI_DCM_GRP_SNO,
                    ( SELECT DECODE(COUNT(*),0,'N','Y') AS DOWN_UP_LOAD_AUTH_YN
                        FROM (SELECT T.AUD_DCM_CRE_ID -- 권한자 ID ( 증거서류 등록자 )
							    FROM (SELECT DISTINCT 
							                 D3.AUD_DCM_CRE_ID
							               , D1.RPRT_FILD_ID
								        FROM TBBADDED110M D1
								       INNER JOIN TBBADDED108D D3 
								          ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO   AND D1.AUD_DCM_DOC_ID  = D3.AUD_DCM_DOC_ID   AND D3.DOC_STA_CD = 'Y'
								        LEFT OUTER JOIN  TBBADDED108M D2   
								          ON D1.AUD_YR = D2.AUD_YR AND D1.AUD_NO = D2.AUD_NO AND D2.EVI_DCMB_SNO = D3.EVI_DCM_GRP_SNO
								       WHERE D1.AUD_YR = #{audYr}
								         AND D1.AUD_NO = #{audNo} ) T
		                        WHERE 1=1
								  AND T.RPRT_FILD_ID = #{rprtFildId}
								UNION
							   SELECT F_USR_INFO(D1.CNB,'1') AS AUD_DCM_CRE_ID -- 권한자 ID ( 주관자, 보조자  )
								 FROM TBBADDED031L AS D1
							    WHERE AUD_YR = #{audYr}
								  AND AUD_NO = #{audNo}) AA
						WHERE AA.AUD_DCM_CRE_ID = #{usrId} ) AS DOWN_UP_LOAD_AUTH_YN
     		   	   FROM TBBADDED110M D1
        INNER JOIN TBBADDED108D D3 
                ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO   AND D1.AUD_DCM_DOC_ID  = D3.AUD_DCM_DOC_ID   AND D3.DOC_STA_CD = 'Y'
        LEFT OUTER JOIN  TBBADDED108M D2   
                ON D1.AUD_YR = D2.AUD_YR AND D1.AUD_NO = D2.AUD_NO AND D2.EVI_DCMB_SNO = D3.EVI_DCM_GRP_SNO
           WHERE D1.AUD_YR = #{audYr}
               AND D1.AUD_NO = #{audNo}
               AND D3.DESTROY_YN <> 'Y' 
            ]]>
    <if test=" 'Y'.toString() == isOne " >
    UNION  /* 심사재심 문서함에 있는 증거서류 포함 */

        SELECT B.AUD_YR
                 , B.AUD_NO
                 , 1 AS EVI_DCM_MPP_SNO
                 , A.ACP_KND_CD AS AUD_KND_CD
                 , A.ACP_GRN_NO AS AUD_GRN_NO
                 , A.DOC_ID
                 , '증거서류' AS FOLDER_NM
                 , A.RPRT_NM AS FILE_NM
                 , A.RPRT_NM AS DOC_NM
                 , A.DOC_ID AS ACP_DCM_DOC_ID
                , #{rprtFildId} AS RPRT_FILD_ID
                , 1 AS EVI_DCMB_SNO
                , '' AS EVI_MPP_DVSN_CD
                , A.SORT_SNO
                , '' AS HYPER_LINK_YN
                , '' AS EVI_DCM_DVSN_CD
                , '증거서류' AS EVI_DCM_DVSN_NM
                , '' FILE_SIZE
                , '' EVI_DCM_NO
                , 0 EVI_DCM_GRP_SNO
                ,   ( SELECT DECODE(COUNT(*),0,'N','Y') AS DOWN_UP_LOAD_AUTH_YN
                        FROM (SELECT T.AUD_DCM_CRE_ID -- 권한자 ID ( 증거서류 등록자 )
							    FROM (SELECT DISTINCT D3.AUD_DCM_CRE_ID
								        FROM TBBADDED110M D1
								       INNER JOIN TBBADDED108D D3 
								          ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO   AND D1.AUD_DCM_DOC_ID  = D3.AUD_DCM_DOC_ID   AND D3.DOC_STA_CD = 'Y'
								        LEFT OUTER JOIN  TBBADDED108M D2   
								          ON D1.AUD_YR = D2.AUD_YR AND D1.AUD_NO = D2.AUD_NO AND D2.EVI_DCMB_SNO = D3.EVI_DCM_GRP_SNO
								       WHERE D1.AUD_YR = #{audYr}
								         AND D1.AUD_NO = #{audNo} ) T
		                        WHERE 1=1
								  AND T.RPRT_FILD_ID = #{rprtFildId}
								UNION
							   SELECT F_USR_INFO(D1.CNB,'1') AS AUD_DCM_CRE_ID -- 권한자 ID ( 주관자, 보조자  )
								 FROM TBBADDED031L AS D1
							    WHERE AUD_YR = #{audYr}
								  AND AUD_NO = #{audNo}) AA
						WHERE AA.AUD_DCM_CRE_ID = #{usrId} ) AS DOWN_UP_LOAD_AUTH_YN
             FROM TBBADFRE111M A,  TBBADFRE012M B
            WHERE 1=1
               AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
               AND A.ACP_YR = B.ACP_YR
               AND A.ACP_SRNO = B.ACP_SRNO
               AND A.RPRT_CD IN ('D10100380','E10100380')
               AND A.ACP_YR = #{acpYr}
               AND A.ACP_DVSN_CD = #{acpDvsnCd}
               AND A.ACP_SRNO = #{acpSrno} 
          --  AND REF_ID = '2016'||'-'||'871'||'-'||'16'
  </if>
  
    ) T
    
    WHERE 1=1
	   <if test="docId != null and docId != ''">
	   AND T.DOC_ID = #{docId}
	   </if>
	   <if test="rprtFildId != null and rprtFildId != ''">
	   AND T.RPRT_FILD_ID = #{rprtFildId}
	   </if>
       <if test="hyperLinkYn != null and hyperLinkYn != ''">
       AND T.HYPER_LINK_YN = #{hyperLinkYn}
       </if>
    ORDER BY DECODE(T.EVI_DCM_DVSN_CD,'20',1,'30',2,'10',3,'50',4,'60',5,'70',6), T.EVI_DCM_NO, T.DOC_NM
</select>

    	<select id="selectEviDcmbMapListOne" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectEviDcmbMapListOne 아래*/
		 <![CDATA[
        SELECT AUD_YR,AUD_NO, EVI_DCM_MPP_SNO, AUD_KND_CD, AUD_GRN_NO, DOC_ID, FOLDER_NM, FILE_NM, DOC_NM, AUD_DCM_DOC_ID, RPRT_FILD_ID, EVI_DCMB_SNO, EVI_MPP_DVSN_CD, ROWNUM AS SORT_SNO, HYPER_LINK_YN, EVI_DCM_DVSN_CD, EVI_DCM_DVSN_NM, FILE_SIZE, EVI_DCM_NO, EVI_DCM_GRP_SNO 
          FROM (
    		 SELECT DISTINCT D1.AUD_YR,
    			    D1.AUD_NO,
    			    D1.EVI_DCM_MPP_SNO,
    			    D1.AUD_KND_CD,
    			    D1.AUD_GRN_NO,
    			    D1.DOC_ID,
    			    D2.FOLDER_NM,
    			    D3.FILE_NM,
    			    D3.FILE_NM AS DOC_NM,
    			    D1.AUD_DCM_DOC_ID,
    			    D1.RPRT_FILD_ID,
    			    D1.EVI_DCMB_SNO,
    			    D1.EVI_MPP_DVSN_CD,
    		  	    D1.SORT_SNO,
                    D1.HYPER_LINK_YN,
                    D3.EVI_DCM_DVSN_CD,
                    F_CODE_NM('1000776',D3.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM,
                    D3.FILE_SIZE,
                    D3.EVI_DCM_NO,
                    D3.EVI_DCM_GRP_SNO
     		  FROM TBBADDED110M D1
        INNER JOIN TBBADDED108D D3 
                ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO   AND D1.AUD_DCM_DOC_ID  = D3.AUD_DCM_DOC_ID   AND D3.DOC_STA_CD = 'Y'
        LEFT OUTER JOIN  TBBADDED108M D2   
                ON D1.AUD_YR = D2.AUD_YR AND D1.AUD_NO = D2.AUD_NO AND D2.EVI_DCMB_SNO = D3.EVI_DCM_GRP_SNO
           WHERE D1.AUD_YR = #{audYr}
    		   AND D1.AUD_NO = #{audNo} 
    		   AND D3.DESTROY_YN =  'N' 
    UNION  /* 심사재심 문서함에 있는 증거서류 포함 */
        SELECT B.AUD_YR
                 , B.AUD_NO
                 , 1 AS EVI_DCM_MPP_SNO
                 , A.ACP_KND_CD AS AUD_KND_CD
                 , A.ACP_GRN_NO AS AUD_GRN_NO
                 , A.DOC_ID
                 , '증거서류' AS FOLDER_NM
                 , A.RPRT_NM AS FILE_NM
                 , A.RPRT_NM AS DOC_NM
                 , A.DOC_ID AS ACP_DCM_DOC_ID
                , #{rprtFildId} AS RPRT_FILD_ID
                , 1 AS EVI_DCMB_SNO
                , '' AS EVI_MPP_DVSN_CD
                , A.SORT_SNO
                , '' AS HYPER_LINK_YN
                , '' AS EVI_DCM_DVSN_CD
                , '증거서류' AS EVI_DCM_DVSN_NM
                , '' FILE_SIZE
                , '' EVI_DCM_NO
                , 0 EVI_DCM_GRP_SNO
             FROM TBBADFRE111M A,  TBBADFRE012M B
            WHERE 1=1
               AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
               AND A.ACP_YR = B.ACP_YR
               AND A.ACP_SRNO = B.ACP_SRNO
               AND A.RPRT_CD IN ('D10100380','E10100380')
               AND A.ACP_YR = #{acpYr}
               AND A.ACP_DVSN_CD = #{acpDvsnCd}
               AND A.ACP_SRNO = #{acpSrno} 
    ) T
    WHERE 1=1
    ]]>
	   <if test="docId != null and docId != ''">
	   AND T.DOC_ID = #{docId}
	   </if>
	   <if test="rprtFildId != null and rprtFildId != ''">
	   AND T.RPRT_FILD_ID = #{rprtFildId}
	   </if>
       <if test="hyperLinkYn != null and hyperLinkYn != ''">
       AND T.HYPER_LINK_YN = #{hyperLinkYn}
       </if>
    ORDER BY DECODE(T.EVI_DCM_DVSN_CD,'20',1,'30',2,'10',3,'50',4,'60',5,'70',6), T.EVI_DCM_NO, T.DOC_NM
    </select>
    
    <!-- BEST20 증거서류 매핑정보 조회(전체) -->
    <select id="selectAllEviDcmbMapList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAllEviDcmbMapList*/
        
        SELECT T.* FROM (
            
    		 SELECT DISTINCT D1.AUD_YR,
    			    D1.AUD_NO,
    			    D1.EVI_DCM_MPP_SNO,
    			    D1.AUD_KND_CD,
    			    D1.AUD_GRN_NO,
    			    D1.DOC_ID,
    			    D2.FOLDER_NM,
    			    D3.FILE_NM,
    			    D3.FILE_NM AS DOC_NM,
    			    D1.AUD_DCM_DOC_ID,
    			    D1.RPRT_FILD_ID,
    			    D1.EVI_DCMB_SNO,
    			    D1.EVI_MPP_DVSN_CD,
    		  	    D1.SORT_SNO,
                    D1.HYPER_LINK_YN,
                    D3.EVI_DCM_DVSN_CD,
                    F_CODE_NM('1000776',D3.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM,
                    D3.FILE_SIZE,
                    D3.EVI_DCM_NO,
                    D3.EVI_DCM_GRP_SNO,
                    ( SELECT DECODE(COUNT(*),0,'N','Y') AS DOWN_UP_LOAD_AUTH_YN
                        FROM (SELECT T.AUD_DCM_CRE_ID -- 권한자 ID ( 증거서류 등록자 )
							    FROM (SELECT DISTINCT 
							                 D3.AUD_DCM_CRE_ID
							               , D1.RPRT_FILD_ID
								        FROM TBBADDED110M D1
								       INNER JOIN TBBADDED108D D3 
								          ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO   AND D1.AUD_DCM_DOC_ID  = D3.AUD_DCM_DOC_ID   AND D3.DOC_STA_CD = 'Y'
								        LEFT OUTER JOIN  TBBADDED108M D2   
								          ON D1.AUD_YR = D2.AUD_YR AND D1.AUD_NO = D2.AUD_NO AND D2.EVI_DCMB_SNO = D3.EVI_DCM_GRP_SNO
								       WHERE D1.AUD_YR = #{audYr}
								         AND D1.AUD_NO = #{audNo} ) T
		                        WHERE 1=1
								  AND T.RPRT_FILD_ID IN (${rprtFildId})
								UNION
							   SELECT F_USR_INFO(D1.CNB,'1') AS AUD_DCM_CRE_ID -- 권한자 ID ( 주관자, 보조자  )
								 FROM TBBADDED031L AS D1
							    WHERE AUD_YR = #{audYr}
								  AND AUD_NO = #{audNo}) AA
						WHERE AA.AUD_DCM_CRE_ID = #{usrId} ) AS DOWN_UP_LOAD_AUTH_YN
     		   	   FROM TBBADDED110M D1
        INNER JOIN TBBADDED108D D3 
                ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO   AND D1.AUD_DCM_DOC_ID  = D3.AUD_DCM_DOC_ID   AND D3.DOC_STA_CD = 'Y'
        LEFT OUTER JOIN  TBBADDED108M D2   
                ON D1.AUD_YR = D2.AUD_YR AND D1.AUD_NO = D2.AUD_NO AND D2.EVI_DCMB_SNO = D3.EVI_DCM_GRP_SNO
           WHERE D1.AUD_YR = #{audYr}
    		   AND D1.AUD_NO = #{audNo}   
    ) T
    WHERE 1=1
	   <if test="docId != null and docId != ''">
	   AND T.DOC_ID = #{docId}
	   </if>
	   <if test="rprtFildId != null and rprtFildId != ''">
	   AND T.RPRT_FILD_ID IN (${rprtFildId})
	   </if>
       <if test="hyperLinkYn != null and hyperLinkYn != ''">
       AND T.HYPER_LINK_YN = #{hyperLinkYn}
       </if>
    ORDER BY DECODE(T.EVI_DCM_DVSN_CD,'20',1,'30',2,'10',3,'50',4,'60',5,'70',6), T.EVI_DCM_NO, T.DOC_NM
</select>

<!-- BEST20 증거서류 매핑정보 조회(전체) -->
    <select id="selectAllEviDcmbList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAllEviDcmbList*/
        
        SELECT  AUD_DCM_DOC_ID	    /*감사서류문서ID */
            ,EVI_DCM_DVSN_CD	/*증거서류구분코드 */
            ,F_CODE_NM('1000776', A.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM	/*증거서류구분코드 */
            ,SUBSTR(F_CODE_NM('1000776', A.EVI_DCM_DVSN_CD),0,2)||'-'||LPAD(EVI_DCM_NO,4,'0') AS EVI_DCM_NO /*증거서류구분 번호 */
            ,FILE_NM            /*파일명 */
            ,SORT_SNO           /*정렬순번 */
            ,FRT_USR_ID         /*최초사용자ID */
            ,F_USR_INFO_BY_ID(AUD_DCM_CRE_ID,'2') AS FRT_USR_NM /* 작성자 */
            ,TO_CHAR(FRT_REGI_DH,'YYYY"-"MM"-"DD" "HH24:MI')FRT_REGI_DH  /*최초등록일시 */
            , AUD_YR
            , AUD_NO
            , A.DESTROY_YN
            , DECODE(A.DESTROY_YN,'Y','파기완료','미파기') AS DESTROY_YN_INFO
            , (CASE WHEN A.DESTROY_YN = 'Y' THEN 'N'
		                                                ELSE DECODE(A.DOC_STA_CD,'N','N','Y')
		        END) AS DOC_STA_CD
		    , (CASE WHEN A.DESTROY_YN = 'Y' THEN '미사용'
		                                                 ELSE DECODE(A.DOC_STA_CD,'N','미사용','사용')
		       END) AS DOC_STA_NM
         FROM TBBADDED108D A
          WHERE EVI_DCMB_DVSN_CD = '10'  /*감사서류구분코드 10 : 증거서류,30 : 실지감사부속서류*/
             AND A.AUD_YR = #{audYr}
              AND A.AUD_NO = #{audNo} 
             ORDER BY 4
</select>

    <select id="selectChkDfnAuthYn" parameterType="paramMap" resultType="java.lang.String">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectChkDfnAuthYn*/
         SELECT  DECODE(A.USR_DFN_TXT_2,  '0013600', 'Y', 'N') AS DFN_YN
          FROM TBDCMACM013C A                                              
         WHERE A.CMM_CD_DVSN_CD = '1000855'
            AND A.CD = (SELECT T1.INN_RANK_CD 
                              FROM TBDCMACM001M T1 
                             WHERE T1.CNB = #{cnb})
            AND A.USE_YN = 'Y'
           AND EXISTS ( SELECT 1
                              FROM TBBADDED001M A
                       WHERE A.AUD_YR = #{audYr}
                          AND A.AUD_NO = #{audNo}
                          AND A.MNG_DPT_CD = #{dptCd})
           AND ROWNUM  = 1
    </select>

	<select id="getAudDetailInfo" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getAudDetailInfo*/
        SELECT D1.AUD_SBJ_NM AS AUD_SBJ_NM,									--감사사항명
               F_CODE_NM('1000007', D1.AUD_KND_CD) AS AUD_KND_NM,			--감사종류명
               D1.SPV_BRDV_CD, -- 주관부서코드
               F_DPT_INFO(D1.SPV_BRDV_CD,'1') AS SPV_BRDV_NM,				--주관부서명
               BZT_BGT_DVSN_CD, 											--예산구분코드
               F_CODE_NM('1000751',D1.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM,	--예산구분명
               F_ORG_INFO(D1.AUD_RPST_ORG_CD,'1')    AS AUD_RPST_ORG_NM,	--대상기관명
               D1.MNG_DPT_CD, -- 담당부서 코드
               F_DPT_INFO(D1.MNG_DPT_CD,'1')        AS MNG_DPT_NM,			--담당부서
               F_USR_INFO(D1.AUD_TOT_DRTR_CNB,'2')    AS TOT_DRTR_NM,		--감사단장명
               F_DPT_INFO(D1.TOT_DRTR_BRDV_CD,'1')    AS TOT_DRTR_BRDV_NM,	--감사단장부서명
               F_CODE_NM('1000173',D1.TOT_DRTR_RANK_CD)    AS TOT_DRTR_RANK_NM,	--감사단장직급명
               F_CODE_NM('1000008', D1.AUD_TASK_CD) AS AUD_TASK_NM,			--감사과제명
               F_USR_INFO(D1.SPVR_CNB,'2')            AS SPVR_NM,			--감사주관자명
               F_DPT_INFO(D1.SPVR_BRDV_CD,'1')        AS SPVR_BRDV_NM,		--감사주관자부서명
               F_CODE_NM('1000173',D1.SPVR_RANK_CD) AS SPVR_RANK_NM,		--감사주관자직급명
               F_CODE_NM('1000005', D1.EPS_TASK_CD) AS EPS_TASK_NM,			--감사중점명
               F_USR_INFO(D1.AST_CNB,'2')            AS AST_NM,				--감사보조자명
               F_DPT_INFO(D1.AST_BRDV_CD,'1')        AS AST_BRDV_NM,		--감사보조자부서명
               F_CODE_NM('1000173',D1.AST_RANK_CD)    AS AST_RANK_NM,		--감사보조자직급명
               F_CODE_NM('1000009', D1.AUD_WAY_CD) AS AUD_WAY_NM			--감사방법명
           FROM TBBADDED001M AS D1
LEFT OUTER JOIN TBCSPDCP101M AS D2 ON D1.ACP_YR= D2.ACP_YR AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
LEFT OUTER JOIN TBBADDED003M AS D3 ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO
          WHERE D1.AUD_YR = #{audYr}
            AND D1.AUD_KND_CD = #{audKndCd}
            AND D1.AUD_NO = #{audNo}
    </select>

  <select id="selectRprtInfo" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper."selectRprtInfo"*/
        <![CDATA[
             SELECT RPRT_CD
                    , FNL_BAI_RPRT_YN
                    , AUD_STEP_CD
                    , REF_ID
              FROM TBBADDED103M
            WHERE AUD_YR = #{audYr}
              AND AUD_NO  = #{audNo}
              AND DOC_ID =  #{docId}
              AND ROWNUM = 1
          ]]>
    </select>

    
	<select id="selectOpmTgOrgBaiRprtList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpmTgOrgBaiRprtList */
        <![CDATA[
        with RLTN_MEETING as (
        SELECT count(*) as CNT
                           FROM TBBADDED145M D1
               RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
                                               AND D1.AUD_NO = D2.AUD_NO
                                               AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                               AND D1.REF_DOC_ID = D2.REF_DOC_ID
                                               AND D1.APVR_CD = D2.APVR_CD
                                               AND D1.AFF_SNO = D2.AFF_SNO
                          WHERE D1.AUD_YR = #{audYr}
                            AND D1.AUD_NO = #{audNo}
                            AND D1.REF_DOC_ID = #{docId}
                            AND D1.FNL_YN = 'Y'
                            AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        
                                                FROM TBBADDED145M
                                               WHERE 1 = 1
                                                 AND AUD_YR = #{audYr}
                                                 AND AUD_NO = #{audNo}
                                                 AND REF_DOC_ID = #{docId}
                                                 AND FNL_YN = 'Y'
                                                 and REFER_DVSN_CD <> 'E10')
                            AND LENGTH(D2.RLTN_ORG_CD) > 0
        ),
        HND_MEETING as (
        SELECT count(*) as CNT
                           FROM TBBADDED145M D1
               RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
                                               AND D1.AUD_NO = D2.AUD_NO
                                               AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                               AND D1.REF_DOC_ID = D2.REF_DOC_ID
                                               AND D1.APVR_CD = D2.APVR_CD
                                               AND D1.AFF_SNO = D2.AFF_SNO
                          WHERE D1.AUD_YR = #{audYr}
                            AND D1.AUD_NO = #{audNo}
                            AND D1.REF_DOC_ID = #{docId}
                            AND D1.FNL_YN = 'Y'
                            AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        
                                                FROM TBBADDED145M
                                               WHERE 1 = 1
                                                 AND AUD_YR = #{audYr}
                                                 AND AUD_NO = #{audNo}
                                                 AND REF_DOC_ID = #{docId}
                                                 AND FNL_YN = 'Y'
                                                 and REFER_DVSN_CD <> 'E10')
                            AND LENGTH(D2.HND_ORG_CD) > 0
        ),
        TG_MEETING as (
        SELECT count(*) as CNT
                           FROM TBBADDED145M D1
               RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
                                               AND D1.AUD_NO = D2.AUD_NO
                                               AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                               AND D1.REF_DOC_ID = D2.REF_DOC_ID
                                               AND D1.APVR_CD = D2.APVR_CD
                                               AND D1.AFF_SNO = D2.AFF_SNO
                          WHERE D1.AUD_YR = #{audYr}
                            AND D1.AUD_NO = #{audNo}
                            AND D1.REF_DOC_ID = #{docId}
                            AND D1.FNL_YN = 'Y'
                            AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        
                                                FROM TBBADDED145M
                                               WHERE 1 = 1
                                                 AND AUD_YR = #{audYr}
                                                 AND AUD_NO = #{audNo}
                                                 AND REF_DOC_ID = #{docId}
                                                 AND FNL_YN = 'Y'
                                                 and REFER_DVSN_CD <> 'E10')
                            AND LENGTH(D2.REF_ORG_CD) > 0
        )
        ]]>
		SELECT H1.AUD_YR,
			   H1.AUD_NO,
			   H1.APVR_CD,
			   H1.APVR_NM,
			   H1.AFF_SNO,
			   H1.RPRT_FILD_ID,
			   H1.AFF_CD,
			   H1.DETL_DOC_NO,
			   H1.REFER_DVSN_CD,
			   H1.REFER_DVSN_NM,
			   H1.AFF_SPH,
			   H1.TITLE_NM,
			   H1.AFF_DSP_CD,
			   H1.DSP_RQ_CD,
			   H1.DSP_RQ_NM,
			   H1.RLTN_ORG_CD,
			   H1.RLTN_ORG_NM,
			   H1.HND_ORG_CD,
			   H1.HND_ORG_NM,
			   H1.REF_ORG_CD,
			   H1.REF_ORG_NM,
			   H1.TG_ORG_CD,
			   H1.TG_ORG_NM,
			   H2.DOC_ID,
			   H1.REF_DOC_ID
		  FROM (
		  		 SELECT D1.AUD_YR AS AUD_YR,
					    D1.AUD_NO AS AUD_NO,
		  		 		D1.APVR_CD AS APVR_CD,
					    F_CODE_NM('1000161',D1.APVR_CD) AS APVR_NM,
					    D1.AFF_SNO AS AFF_SNO,
					    D1.RPRT_FILD_ID AS RPRT_FILD_ID,
					    D1.AFF_CD AS AFF_CD,
					    D1.DETL_DOC_NO AS DETL_DOC_NO,
					    D1.REFER_DVSN_CD AS REFER_DVSN_CD,
					    F_CODE_NM('1000774',D1.REFER_DVSN_CD) AS REFER_DVSN_NM,
					    D1.AFF_SPH AS AFF_SPH,
					    D1.TITLE_NM AS TITLE_NM,
					    D2.AFF_DSP_CD AS AFF_DSP_CD,
					    D2.DSP_RQ_CD AS DSP_RQ_CD,
					    F_CODE_NM('1000002',D2.DSP_RQ_CD) AS DSP_RQ_NM,
					    RLTN_ORG_CD,
					    F_ORG_INFO(RLTN_ORG_CD, 1) AS RLTN_ORG_NM,
					    HND_ORG_CD,
					    F_ORG_INFO(HND_ORG_CD, 1) AS HND_ORG_NM,
					    REF_ORG_CD,
					    F_ORG_INFO(REF_ORG_CD, 1) AS REF_ORG_NM,
					    RLTN_ORG_CD AS TG_ORG_CD,
					    F_ORG_INFO(RLTN_ORG_CD, 1) AS TG_ORG_NM, D1.DOC_ID, D1.REF_DOC_ID
				   FROM TBBADDED145M D1
	   RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
									   AND D1.AUD_NO = D2.AUD_NO
									   AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
									   AND D1.REF_DOC_ID = D2.REF_DOC_ID
									   AND D1.APVR_CD = D2.APVR_CD
									   AND D1.AFF_SNO = D2.AFF_SNO
				  WHERE D1.AUD_YR = #{audYr}
				    AND D1.AUD_NO = #{audNo}
				    AND D1.REF_DOC_ID = #{docId}
                    AND D1.APVR_CD IN ('A1070', '0010600', '0055600')    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                    AND D1.FNL_YN = 'Y'
				    <if test="referDvsnCd != null and referDvsnCd != ''">
					AND D1.REFER_DVSN_CD = #{referDvsnCd}
				    </if>
				    <if test="sytTrtmDvsnYn != null and sytTrtmDvsnYn != ''">
					AND D1.SYT_TRTM_DVSN_YN = #{sytTrtmDvsnYn}
				    </if>
				    AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        <!-- 변경사항의결대조표의 결재자코드값 검색, 없으면 감사위원 결재자코드사용-->
									    FROM TBBADDED145M
									   WHERE 1 = 1
									     AND AUD_YR = #{audYr}
									     AND AUD_NO = #{audNo}
									     AND REF_DOC_ID = #{docId}
                                         AND (APVR_CD IN ('A1070', '0010600') OR ((SELECT CNT FROM RLTN_MEETING) = 0 AND APVR_CD ='0055600'))    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                                         AND FNL_YN = 'Y')
				    AND LENGTH(D2.RLTN_ORG_CD) > 0
				 UNION
				 SELECT D1.AUD_YR AS AUD_YR,
					    D1.AUD_NO AS AUD_NO,
				 		D1.APVR_CD AS APVR_CD,
					    F_CODE_NM('1000161',D1.APVR_CD) AS APVR_NM,
					    D1.AFF_SNO AS AFF_SNO,
					    D1.RPRT_FILD_ID AS RPRT_FILD_ID,
					    D1.AFF_CD AS AFF_CD,
					    D1.DETL_DOC_NO AS DETL_DOC_NO,
					    D1.REFER_DVSN_CD AS REFER_DVSN_CD,
					    F_CODE_NM('1000774',D1.REFER_DVSN_CD) AS REFER_DVSN_NM,
					    D1.AFF_SPH AS AFF_SPH,
					    D1.TITLE_NM AS TITLE_NM,
					    D2.AFF_DSP_CD AS AFF_DSP_CD,
					    D2.DSP_RQ_CD AS DSP_RQ_CD,
					    F_CODE_NM('1000002',D2.DSP_RQ_CD) AS DSP_RQ_NM,
					    RLTN_ORG_CD,
					    F_ORG_INFO(RLTN_ORG_CD, 1) AS RLTN_ORG_NM,
					    HND_ORG_CD,
					    F_ORG_INFO(HND_ORG_CD, 1) AS HND_ORG_NM,
					    REF_ORG_CD,
					    F_ORG_INFO(REF_ORG_CD, 1) AS REF_ORG_NM,
					    HND_ORG_CD AS TG_ORG_CD,
					    F_ORG_INFO(HND_ORG_CD, 1) AS TG_ORG_NM, D1.DOC_ID, D1.REF_DOC_ID
				   FROM TBBADDED145M D1
	   RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
									   AND D1.AUD_NO = D2.AUD_NO
									   AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
									   AND D1.REF_DOC_ID = D2.REF_DOC_ID
									   AND D1.APVR_CD = D2.APVR_CD
									   AND D1.AFF_SNO = D2.AFF_SNO
				  WHERE D1.AUD_YR = #{audYr}
				    AND D1.AUD_NO = #{audNo}
				    AND D1.REF_DOC_ID = #{docId}
                    AND D1.APVR_CD IN ('A1070', '0010600', '0055600')    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                    AND D1.FNL_YN = 'Y'
				    <if test="referDvsnCd != null and referDvsnCd != ''">
				   	AND D1.REFER_DVSN_CD = #{referDvsnCd}
				    </if>
				    <if test="sytTrtmDvsnYn != null and sytTrtmDvsnYn != ''">
				   	AND D1.SYT_TRTM_DVSN_YN = #{sytTrtmDvsnYn}
				    </if>
				    AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        <!-- 변경사항의결대조표의 결재자코드값 검색, 없으면 감사위원 결재자코드사용-->
									    FROM TBBADDED145M
									   WHERE 1 = 1
									     AND AUD_YR = #{audYr}
									     AND AUD_NO = #{audNo}
									     AND REF_DOC_ID = #{docId}
                                         AND (APVR_CD IN ('A1070', '0010600') OR ((SELECT CNT FROM HND_MEETING) = 0 AND APVR_CD ='0055600'))    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                                         AND FNL_YN = 'Y')
				    AND LENGTH(D2.HND_ORG_CD) > 0
				 UNION
				 SELECT D1.AUD_YR AS AUD_YR,
					    D1.AUD_NO AS AUD_NO,
				 		D1.APVR_CD AS APVR_CD,
					    F_CODE_NM('1000161',D1.APVR_CD) AS APVR_NM,
					    D1.AFF_SNO AS AFF_SNO,
					    D1.RPRT_FILD_ID AS RPRT_FILD_ID,
					    D1.AFF_CD AS AFF_CD,
					    D1.DETL_DOC_NO AS DETL_DOC_NO,
					    D1.REFER_DVSN_CD AS REFER_DVSN_CD,
					    F_CODE_NM('1000774',D1.REFER_DVSN_CD) AS REFER_DVSN_NM,
					    D1.AFF_SPH AS AFF_SPH,
					    D1.TITLE_NM AS TITLE_NM,
					    D2.AFF_DSP_CD AS AFF_DSP_CD,
					    D2.DSP_RQ_CD AS DSP_RQ_CD,
					    F_CODE_NM('1000002',D2.DSP_RQ_CD) AS DSP_RQ_NM,
					    RLTN_ORG_CD,
					    F_ORG_INFO(RLTN_ORG_CD, 1) AS RLTN_ORG_NM,
					    HND_ORG_CD,
					    F_ORG_INFO(HND_ORG_CD, 1) AS HND_ORG_NM,
					    REF_ORG_CD,
					    F_ORG_INFO(REF_ORG_CD, 1) AS REF_ORG_NM,
					    REF_ORG_CD AS TG_ORG_CD,
					    F_ORG_INFO(REF_ORG_CD, 1) AS TG_ORG_NM, D1.DOC_ID, D1.REF_DOC_ID
				   FROM TBBADDED145M D1
	   RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
									   AND D1.AUD_NO = D2.AUD_NO
									   AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
									   AND D1.REF_DOC_ID = D2.REF_DOC_ID
									   AND D1.APVR_CD = D2.APVR_CD
									   AND D1.AFF_SNO = D2.AFF_SNO
				  WHERE D1.AUD_YR = #{audYr}
				    AND D1.AUD_NO = #{audNo}
				    AND D1.REF_DOC_ID = #{docId}
                    AND D1.APVR_CD IN ('A1070', '0010600', '0055600')    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                    AND D1.FNL_YN = 'Y'
				    <if test="referDvsnCd != null and referDvsnCd != ''">
				   	AND D1.REFER_DVSN_CD = #{referDvsnCd}
				    </if>
				    <if test="sytTrtmDvsnYn != null and sytTrtmDvsnYn != ''">
				   	AND D1.SYT_TRTM_DVSN_YN = #{sytTrtmDvsnYn}
				    </if>
				    AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        <!-- 변경사항의결대조표의 결재자코드값 검색, 없으면 감사위원 결재자코드사용-->
									    FROM TBBADDED145M
									   WHERE 1 = 1
										 AND AUD_YR = #{audYr}
										 AND AUD_NO = #{audNo}
										 AND REF_DOC_ID = #{docId}
                                         AND (APVR_CD IN ('A1070', '0010600') OR ((SELECT CNT FROM TG_MEETING) = 0 AND APVR_CD ='0055600'))    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                                         AND FNL_YN = 'Y')
				    AND LENGTH(D2.REF_ORG_CD) > 0

		  		) H1
LEFT OUTER JOIN	(
		  		  SELECT A.AUD_YR,
		  		  		 A.AUD_NO,
		  		  		 A.RLTN_ORG_CD,
		  		  		 A.DOC_ID,
		  		  		 NVL(B.REF_ID, A.REF_ID) AS REF_ID
		  		    FROM TBBADDED103M A
		 LEFT OUTER JOIN TBBADDED103M B ON (B.AUD_YR = A.AUD_YR AND B.AUD_NO = A.AUD_NO AND B.AUD_STEP_CD = A.AUD_STEP_CD AND B.DOC_ID = A.REF_ID)
		  		   WHERE A.RPRT_CD = #{rprtCd}
		  		     AND A.AUD_YR = #{audYr}
					 AND A.AUD_NO = #{audNo}
		  		) H2 ON H1.AUD_YR = H2.AUD_YR AND H1.AUD_NO = H2.AUD_NO AND H1.TG_ORG_CD = H2.RLTN_ORG_CD AND H2.REF_ID = H1.REF_DOC_ID
		ORDER BY TG_ORG_NM
        
	</select>
	
	<select id="selectOpmTgOrgList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpmTgOrgList*/
        <![CDATA[
        with RLTN_MEETING as (
        SELECT count(*) as CNT
                           FROM TBBADDED145M D1
               RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
                                               AND D1.AUD_NO = D2.AUD_NO
                                               AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                               AND D1.DOC_ID = D2.DOC_ID
                                               AND D1.APVR_CD = D2.APVR_CD
                                               AND D1.AFF_SNO = D2.AFF_SNO
                          WHERE D1.AUD_YR = #{audYr}
                            AND D1.AUD_NO = #{audNo}
                            AND D1.DOC_ID = #{docId}
                            AND D1.FNL_YN = 'Y'
                            AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        
                                                FROM TBBADDED145M
                                               WHERE 1 = 1
                                                 AND AUD_YR = #{audYr}
                                                 AND AUD_NO = #{audNo}
                                                 AND DOC_ID = #{docId}
                                                 AND FNL_YN = 'Y'
                                                 and REFER_DVSN_CD <> 'E10')
                            AND LENGTH(D2.RLTN_ORG_CD) > 0
        ),
        HND_MEETING as (
        SELECT count(*) as CNT
                           FROM TBBADDED145M D1
               RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
                                               AND D1.AUD_NO = D2.AUD_NO
                                               AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                               AND D1.DOC_ID = D2.DOC_ID
                                               AND D1.APVR_CD = D2.APVR_CD
                                               AND D1.AFF_SNO = D2.AFF_SNO
                          WHERE D1.AUD_YR = #{audYr}
                            AND D1.AUD_NO = #{audNo}
                            AND D1.DOC_ID = #{docId}
                            AND D1.FNL_YN = 'Y'
                            AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        
                                                FROM TBBADDED145M
                                               WHERE 1 = 1
                                                 AND AUD_YR = #{audYr}
                                                 AND AUD_NO = #{audNo}
                                                 AND DOC_ID = #{docId}
                                                 AND FNL_YN = 'Y'
                                                 and REFER_DVSN_CD <> 'E10')
                            AND LENGTH(D2.HND_ORG_CD) > 0
        ),
        TG_MEETING as (
        SELECT count(*) as CNT
                           FROM TBBADDED145M D1
               RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
                                               AND D1.AUD_NO = D2.AUD_NO
                                               AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                               AND D1.DOC_ID = D2.DOC_ID
                                               AND D1.APVR_CD = D2.APVR_CD
                                               AND D1.AFF_SNO = D2.AFF_SNO
                          WHERE D1.AUD_YR = #{audYr}
                            AND D1.AUD_NO = #{audNo}
                            AND D1.DOC_ID = #{docId}
                            AND D1.FNL_YN = 'Y'
                            AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        
                                                FROM TBBADDED145M
                                               WHERE 1 = 1
                                                 AND AUD_YR = #{audYr}
                                                 AND AUD_NO = #{audNo}
                                                 AND DOC_ID = #{docId}
                                                 AND FNL_YN = 'Y'
                                                 and REFER_DVSN_CD <> 'E10')
                            AND LENGTH(D2.REF_ORG_CD) > 0
        )
        ]]>
		SELECT H1.AUD_YR,
			   H1.AUD_NO,
			   H1.APVR_CD,
			   H1.APVR_NM,
			   H1.AFF_SNO,
			   H1.RPRT_FILD_ID,
			   H1.AFF_CD,
			   H1.DETL_DOC_NO,
			   H1.REFER_DVSN_CD,
			   H1.REFER_DVSN_NM,
			   H1.AFF_SPH,
			   H1.TITLE_NM,
			   H1.AFF_DSP_CD,
			   H1.DSP_RQ_CD,
			   H1.DSP_RQ_NM,
			   H1.RLTN_ORG_CD,
			   H1.RLTN_ORG_NM,
			   H1.HND_ORG_CD,
			   H1.HND_ORG_NM,
			   H1.REF_ORG_CD,
			   H1.REF_ORG_NM,
			   H1.TG_ORG_CD,
			   H1.TG_ORG_NM,
			   H2.DOC_ID
		  FROM (
		  		 SELECT D1.AUD_YR AS AUD_YR,
					    D1.AUD_NO AS AUD_NO,
		  		 		D1.APVR_CD AS APVR_CD,
					    F_CODE_NM('1000161',D1.APVR_CD) AS APVR_NM,
					    D1.AFF_SNO AS AFF_SNO,
					    D1.RPRT_FILD_ID AS RPRT_FILD_ID,
					    D1.AFF_CD AS AFF_CD,
					    D1.DETL_DOC_NO AS DETL_DOC_NO,
					    D1.REFER_DVSN_CD AS REFER_DVSN_CD,
					    F_CODE_NM('1000774',D1.REFER_DVSN_CD) AS REFER_DVSN_NM,
					    D1.AFF_SPH AS AFF_SPH,
					    D1.TITLE_NM AS TITLE_NM,
					    D2.AFF_DSP_CD AS AFF_DSP_CD,
					    D2.DSP_RQ_CD AS DSP_RQ_CD,
					    F_CODE_NM('1000002',D2.DSP_RQ_CD) AS DSP_RQ_NM,
					    RLTN_ORG_CD,
					    F_ORG_INFO(RLTN_ORG_CD, 1) AS RLTN_ORG_NM,
					    HND_ORG_CD,
					    F_ORG_INFO(HND_ORG_CD, 1) AS HND_ORG_NM,
					    REF_ORG_CD,
					    F_ORG_INFO(REF_ORG_CD, 1) AS REF_ORG_NM,
					    RLTN_ORG_CD AS TG_ORG_CD,
					    F_ORG_INFO(RLTN_ORG_CD, 1) AS TG_ORG_NM
				   FROM TBBADDED145M D1
	   RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
									   AND D1.AUD_NO = D2.AUD_NO
									   AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
									   AND D1.DOC_ID = D2.DOC_ID
									   AND D1.APVR_CD = D2.APVR_CD
									   AND D1.AFF_SNO = D2.AFF_SNO
				  WHERE D1.AUD_YR = #{audYr}
				    AND D1.AUD_NO = #{audNo}
				    AND D1.DOC_ID = #{docId}
                    AND D1.APVR_CD IN ('A1070', '0010600', '0055600')    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                    AND D1.FNL_YN = 'Y'
				    <if test="referDvsnCd != null and referDvsnCd != ''">
					AND D1.REFER_DVSN_CD = #{referDvsnCd}
				    </if>
				    <if test="sytTrtmDvsnYn != null and sytTrtmDvsnYn != ''">
					AND D1.SYT_TRTM_DVSN_YN = #{sytTrtmDvsnYn}
				    </if>
				    AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        <!-- 변경사항의결대조표의 결재자코드값 검색, 없으면 감사위원 결재자코드사용-->
									    FROM TBBADDED145M
									   WHERE 1 = 1
									     AND AUD_YR = #{audYr}
									     AND AUD_NO = #{audNo}
									     AND DOC_ID = #{docId}
                                         AND (APVR_CD IN ('A1070', '0010600') OR ((SELECT CNT FROM RLTN_MEETING) = 0 AND APVR_CD ='0055600'))    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                                         AND FNL_YN = 'Y')
				    AND LENGTH(D2.RLTN_ORG_CD) > 0
				 UNION
				 SELECT D1.AUD_YR AS AUD_YR,
					    D1.AUD_NO AS AUD_NO,
				 		D1.APVR_CD AS APVR_CD,
					    F_CODE_NM('1000161',D1.APVR_CD) AS APVR_NM,
					    D1.AFF_SNO AS AFF_SNO,
					    D1.RPRT_FILD_ID AS RPRT_FILD_ID,
					    D1.AFF_CD AS AFF_CD,
					    D1.DETL_DOC_NO AS DETL_DOC_NO,
					    D1.REFER_DVSN_CD AS REFER_DVSN_CD,
					    F_CODE_NM('1000774',D1.REFER_DVSN_CD) AS REFER_DVSN_NM,
					    D1.AFF_SPH AS AFF_SPH,
					    D1.TITLE_NM AS TITLE_NM,
					    D2.AFF_DSP_CD AS AFF_DSP_CD,
					    D2.DSP_RQ_CD AS DSP_RQ_CD,
					    F_CODE_NM('1000002',D2.DSP_RQ_CD) AS DSP_RQ_NM,
					    RLTN_ORG_CD,
					    F_ORG_INFO(RLTN_ORG_CD, 1) AS RLTN_ORG_NM,
					    HND_ORG_CD,
					    F_ORG_INFO(HND_ORG_CD, 1) AS HND_ORG_NM,
					    REF_ORG_CD,
					    F_ORG_INFO(REF_ORG_CD, 1) AS REF_ORG_NM,
					    HND_ORG_CD AS TG_ORG_CD,
					    F_ORG_INFO(HND_ORG_CD, 1) AS TG_ORG_NM
				   FROM TBBADDED145M D1
	   RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
									   AND D1.AUD_NO = D2.AUD_NO
									   AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
									   AND D1.DOC_ID = D2.DOC_ID
									   AND D1.APVR_CD = D2.APVR_CD
									   AND D1.AFF_SNO = D2.AFF_SNO
				  WHERE D1.AUD_YR = #{audYr}
				    AND D1.AUD_NO = #{audNo}
				    AND D1.DOC_ID = #{docId}
                    AND D1.APVR_CD IN ('A1070', '0010600', '0055600')    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                    AND D1.FNL_YN = 'Y'
				    <if test="referDvsnCd != null and referDvsnCd != ''">
				   	AND D1.REFER_DVSN_CD = #{referDvsnCd}
				    </if>
				    <if test="sytTrtmDvsnYn != null and sytTrtmDvsnYn != ''">
				   	AND D1.SYT_TRTM_DVSN_YN = #{sytTrtmDvsnYn}
				    </if>
				    AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        <!-- 변경사항의결대조표의 결재자코드값 검색, 없으면 감사위원 결재자코드사용-->
									    FROM TBBADDED145M
									   WHERE 1 = 1
									     AND AUD_YR = #{audYr}
									     AND AUD_NO = #{audNo}
									     AND DOC_ID = #{docId}
                                         AND (APVR_CD IN ('A1070', '0010600') OR ((SELECT CNT FROM HND_MEETING) = 0 AND APVR_CD ='0055600'))    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                                         AND FNL_YN = 'Y')
				    AND LENGTH(D2.HND_ORG_CD) > 0
				 UNION
				 SELECT D1.AUD_YR AS AUD_YR,
					    D1.AUD_NO AS AUD_NO,
				 		D1.APVR_CD AS APVR_CD,
					    F_CODE_NM('1000161',D1.APVR_CD) AS APVR_NM,
					    D1.AFF_SNO AS AFF_SNO,
					    D1.RPRT_FILD_ID AS RPRT_FILD_ID,
					    D1.AFF_CD AS AFF_CD,
					    D1.DETL_DOC_NO AS DETL_DOC_NO,
					    D1.REFER_DVSN_CD AS REFER_DVSN_CD,
					    F_CODE_NM('1000774',D1.REFER_DVSN_CD) AS REFER_DVSN_NM,
					    D1.AFF_SPH AS AFF_SPH,
					    D1.TITLE_NM AS TITLE_NM,
					    D2.AFF_DSP_CD AS AFF_DSP_CD,
					    D2.DSP_RQ_CD AS DSP_RQ_CD,
					    F_CODE_NM('1000002',D2.DSP_RQ_CD) AS DSP_RQ_NM,
					    RLTN_ORG_CD,
					    F_ORG_INFO(RLTN_ORG_CD, 1) AS RLTN_ORG_NM,
					    HND_ORG_CD,
					    F_ORG_INFO(HND_ORG_CD, 1) AS HND_ORG_NM,
					    REF_ORG_CD,
					    F_ORG_INFO(REF_ORG_CD, 1) AS REF_ORG_NM,
					    REF_ORG_CD AS TG_ORG_CD,
					    F_ORG_INFO(REF_ORG_CD, 1) AS TG_ORG_NM
				   FROM TBBADDED145M D1
	   RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
									   AND D1.AUD_NO = D2.AUD_NO
									   AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
									   AND D1.DOC_ID = D2.DOC_ID
									   AND D1.APVR_CD = D2.APVR_CD
									   AND D1.AFF_SNO = D2.AFF_SNO
				  WHERE D1.AUD_YR = #{audYr}
				    AND D1.AUD_NO = #{audNo}
				    AND D1.DOC_ID = #{docId}
                    AND D1.APVR_CD IN ('A1070', '0010600', '0055600')    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                    AND D1.FNL_YN = 'Y'
				    <if test="referDvsnCd != null and referDvsnCd != ''">
				   	AND D1.REFER_DVSN_CD = #{referDvsnCd}
				    </if>
				    <if test="sytTrtmDvsnYn != null and sytTrtmDvsnYn != ''">
				   	AND D1.SYT_TRTM_DVSN_YN = #{sytTrtmDvsnYn}
				    </if>
				    AND D1.APVR_CD = (SELECT MIN(APVR_CD) AS APVR_CD        <!-- 변경사항의결대조표의 결재자코드값 검색, 없으면 감사위원 결재자코드사용-->
									    FROM TBBADDED145M
									   WHERE 1 = 1
										 AND AUD_YR = #{audYr}
										 AND AUD_NO = #{audNo}
										 AND DOC_ID = #{docId}
                                         AND (APVR_CD IN ('A1070', '0010600') OR ((SELECT CNT FROM TG_MEETING) = 0 AND APVR_CD ='0055600'))    <!-- 감사위원, 변경사항의결대조표  or 위임 일 때 사무차장-->
                                         AND FNL_YN = 'Y')
				    AND LENGTH(D2.REF_ORG_CD) > 0

		  		) H1
LEFT OUTER JOIN	(
		  		  SELECT AUD_YR,
		  		  		 AUD_NO,
		  		  		 RLTN_ORG_CD,
		  		  		 DOC_ID
		  		    FROM TBBADDED103M
		  		   WHERE RPRT_CD = #{rprtCd}
		  		     AND AUD_YR = #{audYr}
					 AND AUD_NO = #{audNo}
                     AND REF_ID = #{docId}
		  		) H2 ON H1.AUD_YR = H2.AUD_YR AND H1.AUD_NO = H2.AUD_NO AND H1.TG_ORG_CD = H2.RLTN_ORG_CD
		ORDER BY TG_ORG_NM
        
	</select>

	<select id="selectAudRsltChgSbjList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudRsltChgSbjList*/
		SELECT DOC_ID,
			   RPRT_NM AS DOC_NM
		  FROM TBBADDED103M
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   AND AUD_STEP_CD = #{audStepCd}
		   AND REF_ID = (SELECT AFF_SNO
						   FROM TBBADDED145M
						  WHERE AUD_YR = #{audYr}
						    AND AUD_NO = #{audNo}
						    AND AUD_STEP_CD = #{audStepCd}
						    AND RPRT_FILD_ID = #{rprtFildId})
		   AND RPRT_CD = #{audDocCd}
	</select>

	<select id="selectAudRprtSubDocList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudRprtSubDocList*/
		SELECT A.RPRT_FILD_ID
              ,B.RPRT_NM AS DOC_NM
              ,B.DOC_ID
          FROM TBBADDED145M A INNER JOIN TBBADDED103M B
            ON A.AUD_YR = B.AUD_YR
           AND A.AUD_NO = B.AUD_NO
           AND A.AFF_SNO = TO_NUMBER(B.REF_ID)
           AND B.RPRT_CD = #{audDocCd}
           AND A.FNL_YN = 'Y'
         WHERE A.AUD_YR = #{audYr}
           AND A.AUD_NO = #{audNo}
           <if test='rprtFildId != null and rprtFildId != ""'>
           AND A.RPRT_FILD_ID = #{rprtFildId}
           </if>
	</select>

	<select id="selectAudRltnCamList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudRltnCamList*/
		SELECT B.DOC_ID
		      ,B.RPRT_NM
		      ,B.RPRT_CD
		      ,0 AS SORT_SNO
		 FROM TBBADDED145M A INNER JOIN TBBADDED103M B
		   ON A.AUD_YR = B.AUD_YR
		  AND A.AUD_NO = B.AUD_NO
		  AND B.REF_ID = TO_CHAR(A.AFF_SNO)
		  AND B.RPRT_CD  IN (  'A10700200', 'A10700300', 'A10700230')
		 INNER JOIN TBBADDED114M C ON A.AUD_YR = C.AUD_YR
          AND A.AUD_NO = C.AUD_NO
          AND A.APVR_CD = C.APVR_CD
          AND A.AFF_SNO = C.AFF_SNO
          AND A.AUD_STEP_CD = C.AUD_STEP_CD
          AND A.DOC_ID = C.DOC_ID
		WHERE A.AUD_YR = #{audYr} 
		  AND A.AUD_NO = #{audNo}
		  AND (B.APV_STA_CD IN ('30') OR (B.RPRT_CD = 'A10700230'))
		 <if test='rprtFildId != null and rprtFildId != ""'>
		   AND A.RPRT_FILD_ID = #{rprtFildId}
		 </if> 
		 
		 UNION ALL       
         SELECT SBMT_DOC_ID   AS DOC_ID 
               ,SBMT_FILE_NM  AS RPRT_NM 
               ,'' AS RPRT_CD
               ,NVL(SBMT_SORT_SNO,SBMT_FILE_SEQ) AS SORT_SNO
         FROM TBBADDED114L
         WHERE AUD_YR = #{audYr} 
           AND AUD_NO = #{audNo}
           AND AFF_SNO IN (
           		SELECT B.REF_ID
				FROM TBBADDED145M A INNER JOIN TBBADDED103M B
				   ON A.AUD_YR = B.AUD_YR
				  AND A.AUD_NO = B.AUD_NO
				  AND B.REF_ID = TO_CHAR(A.AFF_SNO)
				  AND B.RPRT_CD  IN (  'A10700200', 'A10700300', 'A10700230')
				INNER JOIN TBBADDED114M C ON A.AUD_YR = C.AUD_YR
		          AND A.AUD_NO = C.AUD_NO
		          AND A.APVR_CD = C.APVR_CD
		          AND A.AFF_SNO = C.AFF_SNO
		          AND A.AUD_STEP_CD = C.AUD_STEP_CD
		          AND A.DOC_ID = C.DOC_ID
				WHERE A.AUD_YR = #{audYr} 
				  AND A.AUD_NO = #{audNo}
				  AND (B.APV_STA_CD IN ('30') OR (B.RPRT_CD = 'A10700230'))
				 <if test='rprtFildId != null and rprtFildId != ""'>
				   AND A.RPRT_FILD_ID = #{rprtFildId}
				 </if>
				 GROUP BY B.REF_ID
           )
           AND SBMT_SEQ IN  (
           		SELECT B.REF_DY
				FROM TBBADDED145M A INNER JOIN TBBADDED103M B
				   ON A.AUD_YR = B.AUD_YR
				  AND A.AUD_NO = B.AUD_NO
				  AND B.REF_ID = TO_CHAR(A.AFF_SNO)
				  AND B.RPRT_CD  IN (  'A10700200', 'A10700300', 'A10700230')
				INNER JOIN TBBADDED114M C ON A.AUD_YR = C.AUD_YR
		          AND A.AUD_NO = C.AUD_NO
		          AND A.APVR_CD = C.APVR_CD
		          AND A.AFF_SNO = C.AFF_SNO
		          AND A.AUD_STEP_CD = C.AUD_STEP_CD
		          AND A.DOC_ID = C.DOC_ID
				WHERE A.AUD_YR = #{audYr} 
				  AND A.AUD_NO = #{audNo}
				  AND (B.APV_STA_CD IN ('30') OR (B.RPRT_CD = 'A10700230'))
				 <if test='rprtFildId != null and rprtFildId != ""'>
				   AND A.RPRT_FILD_ID = #{rprtFildId}
				 </if>
				 GROUP BY B.REF_DY
           )
		 
		   
		 ORDER BY  
          CASE WHEN B.RPRT_CD ='A10700230' THEN '1'
                  WHEN B.RPRT_CD ='A10700200' THEN '2'
                  WHEN B.RPRT_CD ='A10700300' THEN '3' ELSE '4' END , SORT_SNO
	</select>
	
    
    <select id="selectAudExamCnb" parameterType="paramMap" resultType="java.lang.Integer">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudExamCnb*/
    /*소명자료 열람권한 처리 주심위원 및  공유위원 심의지원, 업무지원  조회 */
    <![CDATA[
            SELECT COUNT(*) AS CNT
               FROM TBBADDED112M E
                    INNER JOIN TBBADDED116L T2
                    ON (E.AUD_YR = T2.AUD_YR AND E.AUD_NO = T2.AUD_NO  AND T2.TASK_DVSN_CD = '9'
                       AND T2.SRNO = (SELECT MAX(SRNO) FROM TBBADDED116L WHERE AUD_YR = T2.AUD_YR AND AUD_NO = T2.AUD_NO AND TASK_DVSN_CD = '9'))
              WHERE E.AUD_YR = #{audYr}
                 AND E.AUD_NO = #{audNo}
                 AND ( (E.SHARE_CMTR_ID LIKE '%'|| NVL((SELECT A.CMTR_CNB
                                                                    FROM TBBADDED116M A
                                                                   WHERE (A.CMTR_CNB =  #{cnb}
                                                                         OR A.RVW_SUP_CNB =  #{cnb}
                                                                         OR A.TSK_SUP_CNB =  #{cnb} )), '9999') ||'%' )
                          OR (
                               (T2.CHF_CMTR_CNB =  (SELECT A.CMTR_CNB
                                                         FROM TBBADDED116M A
                                                        WHERE (A.CMTR_CNB =  #{cnb}
                                                             OR A.RVW_SUP_CNB =  #{cnb}
                                                             OR A.TSK_SUP_CNB =  #{cnb} )))
                                OR (T2.CHF_CMTR1_CNB =  (SELECT A.CMTR_CNB
                                                         FROM TBBADDED116M A
                                                        WHERE (A.CMTR_CNB =  #{cnb}
                                                             OR A.RVW_SUP_CNB =  #{cnb}
                                                             OR A.TSK_SUP_CNB =  #{cnb} )))
                                OR (T2.CHF_CMTR2_CNB =  (SELECT A.CMTR_CNB
                                                         FROM TBBADDED116M A
                                                        WHERE (A.CMTR_CNB =  #{cnb}
                                                             OR A.RVW_SUP_CNB =  #{cnb}
                                                             OR A.TSK_SUP_CNB =  #{cnb} )))
                                OR (T2.CHF_CMTR3_CNB =  (SELECT A.CMTR_CNB
                                                         FROM TBBADDED116M A
                                                        WHERE (A.CMTR_CNB =  #{cnb}
                                                             OR A.RVW_SUP_CNB =  #{cnb}
                                                             OR A.TSK_SUP_CNB =  #{cnb} )))
                                OR (T2.CHF_CMTR4_CNB =  (SELECT A.CMTR_CNB
                                                         FROM TBBADDED116M A
                                                        WHERE (A.CMTR_CNB =  #{cnb}
                                                             OR A.RVW_SUP_CNB =  #{cnb}
                                                             OR A.TSK_SUP_CNB =  #{cnb} )))
                                OR (T2.CHF_CMTR5_CNB =  (SELECT A.CMTR_CNB
                                                         FROM TBBADDED116M A
                                                        WHERE (A.CMTR_CNB =  #{cnb}
                                                             OR A.RVW_SUP_CNB =  #{cnb}
                                                             OR A.TSK_SUP_CNB =  #{cnb} )))
                             )
                     )
        ]]>
    </select>
    
      <select id="selectAudSecrytCnb" parameterType="paramMap" resultType="java.lang.Integer">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudSecrytCnb*/
    /*소명자료 열람권한 처리 주심위원 및 위원  비서 조회 */
    <![CDATA[
              SELECT COUNT(*) AS CNT           
               FROM (SELECT   T1.CNB
                                  , (SELECT CNB
                                      FROM TBDCMACM001M ST1
                                     WHERE ST1.RAL_BLT_DIV_CD = T1.RAL_BLT_DIV_CD
                                        AND ST1.USR_DVSN_CD = '1'
                                        AND ST1.GEN_ADMN_DVSN_CD ='1'
                                        AND ST1.CNB != T1.CNB
                                        AND ROWNUM = 1) AS SCRT_CNB
                                  , T2.RVW_SUP_CNB
                                  , T2.TSK_SUP_CNB
                          FROM TBDCMACM001M T1
                                  LEFT OUTER JOIN TBBADDED116M T2
                                                   ON (T1.CNB = T2.CMTR_CNB)
                         WHERE T1.DPT_CD = '510000'
                            AND T1.PST_CD = '0010600') A
                WHERE (A.CNB = #{cnb}  OR 
                          A.SCRT_CNB = #{cnb}  OR 
                          A.RVW_SUP_CNB = #{cnb}  OR 
                          A.TSK_SUP_CNB = #{cnb} )
        ]]>
    </select>
    
    
     <select id="selectAudApvrCd" parameterType="paramMap" resultType="java.lang.String">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudApvrCd*/
    /*소명자료 현재사건  param 조회 */
    <![CDATA[
         SELECT B.APVR_CD
          FROM (
             SELECT DENSE_RANK() OVER ( ORDER BY DECODE(APVR_CD, 'A1070', 1, '0010600', 2,  '0055700', 3, '0055600' ,4 ,'0045900', 5,  '0015800' ,6,'0035100', 7, '0058100', 8,  '0013600', 9, 99) ASC ) AS RN
                     ,APVR_CD
            FROM TBBADDED145M A
           WHERE A.AUD_YR = #{audYr}
             AND A.AUD_NO  =  #{audNo}
             AND A.APVR_CD <> '0010200' 
               ]]>
             <if test='rprtFildId != null and rprtFildId != ""'>
                  AND  A.RPRT_FILD_ID = #{rprtFildId}
            </if> 
            <![CDATA[
            GROUP BY APVR_CD
      )   B
        WHERE B.RN = 1
        ]]>
    </select>
    

    <select id="selectAudExamRprtList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudExamRprtList*/
        /*소명자료 관련 문서 검토보고서 :A10600900 , 소명서 : A10600800  , 소명자료 검토의견서 : A10601000 , 적극행정 면책 자문 위원회의 보고서 : A10600950 */
         SELECT D.SRNO
                ,D.RPRT_NM
                ,D.RPRT_CD
                ,D.DOC_ID
          FROM (
                    SELECT MIN(A.SRNO) AS SRNO
                            ,C.RPRT_NM
                            ,C.RPRT_CD
                            ,C.DOC_ID
                     FROM TBCSPKDE103M_VIEW A INNER JOIN TBCSPKDE106M B
                        ON A.AUD_YR = B.AUD_YR
                       AND A.AUD_NO = B.AUD_NO
                       AND A.SRNO = B.SRNO INNER JOIN TBBADDED103M C
                                                               ON C.AUD_YR = B.AUD_YR
                                                              AND C.AUD_NO = B.AUD_NO
                                                              AND ( C.REF_DY = B.AFF_SNO OR C.REF_DY = A.SRNO || A.MFEX_DVSN_CD )
                                                              AND C.RPRT_CD IN ( 'A10600900',  'A10600960')
                    WHERE A.AUD_YR = #{audYr} 
                       AND A.AUD_NO = #{audNo}
                  <if test='rprtFildId != null and rprtFildId != ""'>
                       AND B.RPRT_FILD_ID = #{rprtFildId}
                   </if>
                     GROUP BY C.RPRT_NM, C.RPRT_CD, C.DOC_ID 
                      UNION ALL
                      SELECT A.SRNO
                              ,C.FILE_NM AS RPRT_NM
                              ,'A10600800' AS RPRT_CD
                              ,C.DOC_ID
                       FROM TBCSPKDE103M A INNER JOIN TBCSPKDE106M B
                          ON A.AUD_YR = B.AUD_YR
                         AND A.AUD_NO = B.AUD_NO
                         AND A.SRNO = B.SRNO INNER JOIN TBCSPKDE104M C
                                                                                     ON C.AUD_YR = A.AUD_YR
                                                                                    AND C.AUD_NO = A.AUD_NO
                                                                                    AND C.SRNO  = A.SRNO  
                       WHERE A.AUD_YR = #{audYr} 
                          AND A.AUD_NO =#{audNo}
                      <if test='rprtFildId != null and rprtFildId != ""'>
                          AND B.RPRT_FILD_ID = #{rprtFildId}
                      </if>
                      GROUP BY A.SRNO ,C.FILE_NM ,C.DOC_ID 
                       UNION ALL
                      SELECT DISTINCT
                               A.SRNO
                              ,C.RPRT_NM
                              ,'A10600950' AS RPRT_CD
                              ,C.DOC_ID
                       FROM TBCSPKDE103M A INNER JOIN TBCSPKDE106M B
                          ON A.AUD_YR = B.AUD_YR
                         AND A.AUD_NO = B.AUD_NO
                         AND A.SRNO = B.SRNO INNER JOIN TBBADDED103M C
                                                                                     ON C.AUD_YR = A.AUD_YR
                                                                                    AND C.AUD_NO = A.AUD_NO
                                                                                    AND C.REF_ID  = TO_CHAR(A.SRNO)
                                                                                    AND C.RPRT_CD = 'A10600950'
                                                                                    AND EXISTS (SELECT 1 FROM TBBADDED111M D WHERE D.DOC_ID = C.DOC_ID)
                        WHERE A.AUD_YR = #{audYr} 
                          AND A.AUD_NO =#{audNo}
                      <if test='rprtFildId != null and rprtFildId != ""'>
                          AND B.RPRT_FILD_ID = #{rprtFildId}
                      </if>
                  <if test='optOpenYn == "Y"'>
                        UNION ALL
                        SELECT  MIN(B.SRNO) AS SRNO
                                  ,C.RPRT_NM
                                  ,C.RPRT_CD
                                  ,C.DOC_ID
                         FROM TBBADDED145M A 
                           INNER JOIN TBCSPKDE106M B 
                                                                  ON A.AUD_YR = B.AUD_YR
                                                                 AND A.AUD_NO = B.AUD_NO
                                                                 AND A.AFF_SNO = B.AFF_SNO
                           INNER JOIN TBBADDED103M C
                            ON A.AUD_YR = C.AUD_YR
                           AND A.AUD_NO = C.AUD_NO
                           AND ((C.REF_ID = B.SRNO) OR (C.REF_ID = A.AFF_SNO))
                        WHERE A.AUD_YR =#{audYr} 
                           AND A.AUD_NO =#{audNo}
                           AND C.RPRT_CD = 'A10601000'
                            AND EXISTS ( SELECT 1  /*품질부서로 발신된 검토의견서만 조회됨*/
                                              FROM TBBADDED111M D
                                             WHERE D.AUD_YR = A.AUD_yR
                                                AND D.AUD_NO  =A.AUD_NO
                                                AND D.RPRT_CD = C.RPRT_CD
                                                AND D.DOC_ID = C.DOC_ID ) 
                           
                              <if test='rprtFildId != null and rprtFildId != ""'>
                                AND B.RPRT_FILD_ID = #{rprtFildId}
                          </if>
                           
                           GROUP BY  C.RPRT_NM ,C.RPRT_CD  ,C.DOC_ID
                     </if> 
                  ) D
         ORDER BY D.SRNO  , D.RPRT_CD DESC , D.RPRT_NM  
    </select>
 	    
     <select id="selectImmunCnt" parameterType="paramMap" resultType="Integer">
          SELECT COUNT(A.MFEX_SMT_AIM_YN4) AS CNT
           FROM TBCSPKDE103M A
                   INNER JOIN TBCSPKDE106M B
                              ON A.AUD_YR = B.AUD_YR
                             AND A.AUD_NO = B.AUD_NO
                             AND A.SRNO = B.SRNO 
           WHERE A.AUD_YR = #{audYr} 
              AND A.AUD_NO =#{audNo}
              AND A.MFEX_SMT_AIM_YN4 ='Y'
          <if test='rprtFildId != null and rprtFildId != ""'>
               AND B.RPRT_FILD_ID = #{rprtFildId}
           </if>             
     </select>
     
    <select id="selectLawRprtListBefore" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectLawRprtListBefore*/
    /*법률자문의견 검토보고서 : A10940300 , 법률자문요청서 : A10940100 , 법률자문의견서 : A10940200 기능구현 이전 SQL  */
     <![CDATA[
    SELECT B.DOC_ID
          ,B.RPRT_NM
          ,B.RPRT_CD
    FROM TBBADDED145M A INNER JOIN TBBADDED103M B
    ON A.AUD_YR = B.AUD_YR
    AND A.AUD_NO = B.AUD_NO
    AND B.REF_ID = TO_CHAR(A.AFF_SNO)
    AND B.RPRT_CD  IN ( 'A10940300', 'A10940100', 'A10940200')
    AND A.APVR_CD  = (SELECT NVL(MAX(T2.APVR_CD), '0013600')
                  FROM (SELECT DENSE_RANK() OVER ( ORDER BY DECODE(H.APVR_CD, 'A1070', 1, '0010600', 2,  '0055700', 3, '0055600' ,4 ,'0045900', 5,  '0015800' ,6,'0035100', 7, '0058100', 8,  '0013600', 9, 99) ASC ) AS RN
                             , H.APVR_CD
                             , H.DOC_ID
                         FROM TBBADDED145M H
                        WHERE H.AUD_YR = #{audYr}
                          AND H.AUD_NO  =  #{audNo}
                                    AND H.APVR_CD <> '0010200'
                                   GROUP BY H.DOC_ID, H.APVR_CD) T2
                    WHERE T2.DOC_ID = A.DOC_ID)
    WHERE A.AUD_YR = #{audYr}
      AND A.AUD_NO = #{audNo}
       ]]>
     <if test='rprtFildId != null and rprtFildId != ""'>
       AND A.RPRT_FILD_ID = #{rprtFildId}
     </if>
    </select>
    
      <select id="selectLawRprtRefDataList" parameterType="paramMap" resultType="egovMap">
         /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectLawRprtRefDataList*/
         /*수사참고자료 법률자문 개별사건 참고 조회  */
     <![CDATA[
         SELECT B.DOC_ID
                  ,B.RPRT_NM
                  ,B.RPRT_CD
          FROM TBBADDED126M A 
                   INNER JOIN TBBADDED103M B 
                             ON A.WRK_YR = B.AUD_YR
                            AND A.WRK_NO =B.AUD_NO
                            AND A.AUD_STEP_CD = B.AUD_STEP_CD
 							AND A.LEGAL_REQ_SRNO = B.REF_ID
                            AND B.RPRT_CD IN  ( 'A10602310', 'A10602100' , 'A10602400')
        WHERE A.WRK_YR = #{audYr}
           AND A.WRK_NO  =  #{audNo}
           AND A.AUD_DOC_ID = #{currDocId}
           AND A.LEGAL_REQ_DVSN_CD = '50'
          ORDER BY A.LEGAL_REQ_SRNO, B.RPRT_CD    
      ]]>
     </select> 
     

 	
 	<select id="selectLawRprtListRef" parameterType="paramMap" resultType="egovMap">
 	<![CDATA[
 	    SELECT B.DOC_ID
                , B.RPRT_NM
                , B.RPRT_CD
                , A.LEGAL_REQ_SRNO
         FROM TBBADDED126M A INNER JOIN TBBADDED103M B
                                                   ON A.WRK_YR = B.AUD_YR
                                                  AND A.WRK_NO = B.AUD_NO
                                                  AND A.LEGAL_REQ_SRNO = B.REF_ID                           
                                                  AND A.LEGAL_REQ_DVSN_CD = '50'
                                                  AND B.RPRT_CD IN ('A10602400', 'A10602100' ,'A10602310', 'A10601810')
                                                  AND A.WRK_DVSN_CD = 'A10'                            
       WHERE A.WRK_YR =#{audYr}
          AND A.WRK_NO =  #{audNo}
        ]]>
      <if test='rprtFildId != null and rprtFildId != ""'>
          AND B.REF_DOC_ID = #{rprtFildId}
     </if>
       
 	</select>
 	
     <select id="selectLawRprtList" parameterType="paramMap" resultType="egovMap">
         <![CDATA[
          /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectLawRprtList*/
          /*법률자문의견 검토보고서 : A10602400 , 법률자문요청서 : A10602100 , 법률자문의견서 : A10602310  기능구현 이후 SQL */
             SELECT C.DOC_ID
                     , C.RPRT_NM
                     , C.RPRT_CD
                     , B.LEGAL_REQ_SRNO
               FROM TBBADDED145M A
                        INNER JOIN TBBADDED126M B
                                   ON A.AUD_YR = B.WRK_YR
                                  AND A.AUD_NO = B.WRK_NO
                                  AND A.AFF_SNO = B.AFF_SNO
                                  AND A.APVR_CD  = (SELECT NVL(MAX(T2.APVR_CD), '0013600')
                                                             FROM (SELECT DENSE_RANK() OVER ( ORDER BY DECODE(H.APVR_CD, 'A1070', 1, '0010600', 2,  '0055700', 3, '0055600' ,4 ,'0045900', 5,  '0015800' ,6,'0035100', 7, '0058100', 8,  '0013600', 9, 99) ASC ) AS RN
                                                                              , H.APVR_CD
                                                                              , H.DOC_ID
                                                                       FROM TBBADDED145M H
                                                                      WHERE H.AUD_YR = #{audYr}
                                                                         AND H.AUD_NO  =  #{audNo}
                                                                         AND H.APVR_CD <> '0010200'
                                                                         AND H.AUD_STEP_CD <> 'A1050'
                                                                  GROUP BY H.DOC_ID, H.APVR_CD) T2
                                                            WHERE T2.DOC_ID = A.DOC_ID)
                        INNER JOIN TBBADDED103M C
                                   ON C.AUD_YR = B.WRK_YR
                                  AND C.AUD_NO = B.WRK_NO
                                  AND C.REF_ID = B.LEGAL_REQ_SRNO
                                  AND C.AUD_STEP_CD = 'A1060'
                                  AND C.RPRT_CD IN  ( 'A10602310', 'A10602100' , 'A10602400')
                  WHERE 1=1
                     AND A.AUD_YR = #{audYr}
                     AND A.AUD_NO  = #{audNo}
                  ]]>
                 <if test='rprtFildId != null and rprtFildId != ""'>
                     AND A.RPRT_FILD_ID = #{rprtFildId}
                 </if> 
               ORDER BY B.LEGAL_REQ_SRNO, C.RPRT_CD
    </select>
 
     <select id="getApvrCd" parameterType="paramMap" resultType="egovMap">
    <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getApvrCd*/
         SELECT NVL((SELECT B.APVR_PST_CD
           FROM (SELECT ROWNUM AS R_NUM
                       ,A.*
                  FROM TBDCMACM023L A
                 WHERE A.APV_DOC_NO = (SELECT APV_RQS_ID
                                         FROM TBBADDED103M
                                        WHERE AUD_YR        = #{audYr}
                                          AND AUD_NO        = #{audNo}
                                          AND AUD_STEP_CD   = #{audStepCd}
                                          AND DOC_ID        = #{docId})
                  AND A.APV_SNO <> 1
                  AND A.APVR_STA_CD IN ('102', '103', '401')
                ORDER BY A.APVR_STA_CD DESC
              ) B
        WHERE B.R_NUM = 1),'0013600') AS APVR_CD
         FROM DUAL
	]]>
    </select>

    <select id="getFileData" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.bad.ded.dao.GEBAWD001EMapper.getFileData*/
        SELECT DECODE(#{docType},'HWP', HWP_DOC_ID, DOC_ID ) AS DOC_ID,
               DTIL_AUD_DOC_NM
          FROM TBFDMADM002M
         WHERE AUD_DOC_CD = #{audDocCd}
           AND DOC_KND_CD = #{docKndCd}
    </select>

    <update id="updateEviDcmbMapHyperLinkYn" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateEviDcmbMapHyperLinkYn*/
        <![CDATA[
        DECLARE
            BEGIN
             UPDATE TBBADDED110M
                  SET HYPER_LINK_YN = #{hyperLinkYn}
                       ,FNL_MDF_DH = SYSDATE
                       ,FNL_USR_ID = #{usrId}
                       ,FNL_DEAL_DPT_CD =#{dptCd}
              WHERE AUD_YR = #{audYr}
                 AND AUD_NO = #{audNo}
                 AND AUD_DCM_DOC_ID = #{docId};
           
             UPDATE TBBADDED108D
                  SET FNL_MDF_DH = SYSDATE
                       ,FNL_USR_ID = #{usrId}
                       ,FNL_DEAL_DPT_CD =#{dptCd}
               WHERE AUD_YR = #{audYr}
                  AND AUD_NO = #{audNo}
                  AND AUD_DCM_DOC_ID = #{docId}; 
           END;
          ]]>
    </update>

    <select id="getApvrCdByApvrId" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.bad.ded.dao.GEBAWD001EMapper.getApvrCdByApvrId*/
        SELECT F_USR_INFO_BY_ID(#{apvrId}, 4) AS APVR_CD
          FROM DUAL
    </select>

    <select id="selectExptPrbList" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.bad.ded.dao.GEBAWD001EMapper.selectExptPrbList*/
        SELECT F_MNG_KND_AUDYRNO(AUD_YR, AUD_NO, AUD_KND_CD, '-')||'-'||EXPT_PRB_CD AS EXPT_PRB_NO  /*예상문제번호*/,
               DOC_ID,
               EXPT_PRB_SNO,
               RPRT_FILD_ID,
               EXPT_PRB_CD,
               EXPT_PRB_NM
          FROM TBBADDED144M
         WHERE AUD_YR = #{audYr}
           AND AUD_KND_CD = #{audKndCd}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = #{audStepCd}
      ORDER BY EXPT_PRB_SNO ASC
    </select>

    <update id="updateBADDED104MRprtFildId" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED104MRprtFildId*/
        UPDATE TBBADDED144M
           SET FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
               ,RPRT_FILD_ID = #{rprtFildId}
               <if test='docId != null and docId != ""'>
               ,DOC_ID = #{docId}
               </if>
         WHERE AUD_YR = #{audYr}
           AND AUD_KND_CD = #{audKndCd}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = #{audStepCd}
           AND EXPT_PRB_SNO = #{exptPrbSno}
    </update>

    <select id="selectAudEndIdvtEvtList" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.bad.ded.dao.GEBAWD001EMapper.selectAudEndIdvtEvtList*/
        SELECT  A.LIST_NO           /*일람표일련번호 */
                ,A.DOC_ID           /*문서ID */
                ,A.APVR_CD          /*결재자코드  */
                ,A.AFF_SNO          /*사건순번 */
                ,A.RPRT_FILD_ID     /*보고서필드ID*/
                ,A.REFER_DVSN_CD    /*부의구분코드 (1000774)*/
                ,F_CODE_NM('1000774', A.REFER_DVSN_CD) REFER_DVSN_NM /*부의구분코드명*/
                ,A.TITLE_NM         /*제목명 */
                ,A.QST_DOC_ISUE_YN /*질문서발부여부 */
                ,DECODE(A.QST_DOC_ISUE_YN,'Y','발부','미발부') QST_DOC_ISUE_YN_NM /*질문서발부여부명 */
                ,A.AUDTOR           /*감사자 */
           FROM TBBADDED145M A
          WHERE A.AUD_YR = #{audYr}
            <if test='audNo != null and audNo != ""'>
            AND A.AUD_NO = #{audNo}
            </if>
            <if test='audStepCd != null and audStepCd != ""'>
            AND A.AUD_STEP_CD = #{audStepCd}
            </if>
            <if test='docId != null and docId != ""'>
            AND A.DOC_ID = #{docId}
            </if>
            <if test='apvrCd != null and apvrCd != ""'>
            AND A.APVR_CD = (SELECT NVL(F_USR_INFO_BY_ID(#{apvrCd}, '4'), '0010200') AS CD_NM FROM DUAL)
            </if>
            <if test='affSno != null and affSno != ""'>
            AND A.AFF_SNO = #{affSno}
            </if>
            AND A.MTRL_IPT_DVSN_CD = '20'
    </select>

    <update id="updateBADDED105MRprtFildId" parameterType="paramMap">
    DECLARE
    	BEGIN
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED105M*/
        UPDATE TBBADDED145M
           SET FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
               ,RPRT_FILD_ID = #{rprtFildId}
               <if test='docId != null and docId != ""'>
               ,DOC_ID = #{docId}
               </if>
         WHERE AUD_YR = #{audYr}
           AND AUD_KND_CD = #{audKndCd}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = #{audStepCd}
           AND AFF_SNO = #{affSno}
        ;
          INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , #{usrId}
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID
				 FROM TBBADDED145M
		         WHERE AUD_YR = #{audYr}
		           AND AUD_KND_CD = #{audKndCd}
		           AND AUD_NO = #{audNo}
		           AND AUD_STEP_CD = #{audStepCd}
		           AND AFF_SNO = #{affSno}
				;
		END;        
    </update>

    <update id="updateBADDED106MRprtFildId" parameterType="paramMap">
    DECLARE
    	BEGIN
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED106M*/
        UPDATE TBBADDED146M
           SET FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
               ,RPRT_FILD_ID = #{rprtFildId}
               <if test='docId != null and docId != ""'>
               ,DOC_ID = #{docId}
               </if>
         WHERE AUD_YR = #{audYr}
           AND AUD_KND_CD = #{audKndCd}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = #{audStepCd}
           AND AFF_SNO = #{affSno}
         ;
		INSERT INTO TBBADDED146H
				(
				    HST_DVSN_CD
				  , HST_SNO
				  , HST_DH
				  , HST_USR_ID	
				  , AUD_YR
				  , AUD_NO
				  , AUD_STEP_CD 	
				  , DOC_ID 			
				  , APVR_CD 		
				  , AFF_SNO 		
				  , DSP_RQ_SNO 		
				  , DP_DSP_RQ_SNO 	
				  , AUD_KND_CD 		
				  , AUD_GRN_NO 		
				  , RPRT_FILD_ID 	
				  , AFF_DSP_CD 		
				  , RLTN_ORG_CD 	
				  , HND_ORG_CD 		
				  , REF_ORG_CD 		
				  , DSP_RQ_CD 		
				  , MTRL_IPT_DVSN_CD
				  , NOP_AM_DVSN_CD 	
				  , NOP_AM 			
				  , SORT_SNO		
				  , ACCN_INSP_CD	
				  , FNL_YN 			
				  , FRT_USR_ID 		
				  , FNL_USR_ID 		
				  , FNL_DEAL_DPT_CD 
				  , FNL_MNU_ID 		
				  , FRT_REGI_DH		
				  , FNL_MDF_DH 		
				  , NOP_SUM 		
				  , HD_AUD_STEP_CD 	
				  , HD_DOC_ID		
				  , HD_APVR_CD		
				  , HD_AFF_SNO 		
				  , HD_DSP_RQ_SNO	
				  , REF_DOC_ID 		
				  , DF_AUD_STEP_CD 	
				  , DF_DOC_ID 		
				  , DF_APVR_CD 		
				  , DF_AFF_SNO		
				  , DF_DSP_RQ_SNO 	
				  , KYWD1			
				  , KYWD2 			
				  , KYWD3 			
				  , KYWD4			
				  , KYWD5			
				)
			SELECT 'U'
			 	 , TBBADDED146H_SEQ.NEXTVAL
			 	 , SYSDATE
			 	 , #{usrId}
				 , AUD_YR
				 , AUD_NO
				 , AUD_STEP_CD 	
				 , DOC_ID 			
				 , APVR_CD 		
				 , AFF_SNO 		
				 , DSP_RQ_SNO 		
				 , DP_DSP_RQ_SNO 	
				 , AUD_KND_CD 		
				 , AUD_GRN_NO 		
				 , RPRT_FILD_ID 	
				 , AFF_DSP_CD 		
				 , RLTN_ORG_CD 	
				 , HND_ORG_CD 		
				 , REF_ORG_CD 		
				 , DSP_RQ_CD 		
				 , MTRL_IPT_DVSN_CD
				 , NOP_AM_DVSN_CD 	
				 , NOP_AM 			
				 , SORT_SNO		
				 , ACCN_INSP_CD	
				 , FNL_YN 			
				 , FRT_USR_ID 		
				 , FNL_USR_ID 		
				 , FNL_DEAL_DPT_CD 
				 , FNL_MNU_ID 		
				 , FRT_REGI_DH		
				 , FNL_MDF_DH 		
				 , NOP_SUM 		
				 , HD_AUD_STEP_CD 	
				 , HD_DOC_ID		
				 , HD_APVR_CD		
				 , HD_AFF_SNO 		
				 , HD_DSP_RQ_SNO	
				 , REF_DOC_ID 		
				 , DF_AUD_STEP_CD 	
				 , DF_DOC_ID 		
				 , DF_APVR_CD 		
				 , DF_AFF_SNO		
				 , DF_DSP_RQ_SNO 	
				 , KYWD1			
				 , KYWD2 			
				 , KYWD3 			
				 , KYWD4			
				 , KYWD5
			 FROM TBBADDED146M
	         WHERE AUD_YR = #{audYr}
	           AND AUD_KND_CD = #{audKndCd}
	           AND AUD_NO = #{audNo}
	           AND AUD_STEP_CD = #{audStepCd}
	           AND AFF_SNO = #{affSno}
				;
		END;		                                   
    </update>

    <select id="selectAprvIds" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.bad.ded.dao.GEBAWD001EMapper."selectAprvIds"*/
         SELECT F_USR_INFO(APVR_CNB, '1') AS APVR_ID
                 , F_USR_INFO(APVR_CNB, '2') AS APVR_NM
                 , APVR_PST_CD --결재자 직위 코드
                 , APV_DOC_NO
                 , F_CODE_NM('1000350', APVR_KND_CD) AS APVR_CD
                 , (SELECT T2.APV_STA_CD 
                     FROM TBBADDED103M T2 
                    WHERE T2.AUD_YR = #{audYr}
                       AND T2.AUD_NO =#{audNo}
                       AND T2.DOC_ID = DECODE(#{audDocCd},  'A10700600',  NVL(#{refId},(SELECT T1.REF_ID FROM TBBADDED103M T1 WHERE T1.AUD_YR =#{audYr} AND T1.AUD_NO = #{audNo} AND T1.DOC_ID =  #{docId} ))
                                                        ,'A10700210',  (SELECT T1.REF_DOC_ID FROM TBBADDED103M T1 WHERE T1.AUD_YR =#{audYr} AND T1.AUD_NO =#{audNo} AND T1.DOC_ID = #{docId})
                                                       ,  #{docId} )) AS APV_STA_CD
          FROM TBDCMACM023L
         WHERE 1=1
           AND APV_DOC_NO = ( SELECT APV_RQS_ID
                                        FROM TBBADDED103M
                                       WHERE AUD_YR = #{audYr}
                                          AND AUD_NO = #{audNo}
                                          AND AUD_STEP_CD = #{audStepCd}
                                           AND DOC_ID =   DECODE(#{audDocCd},  'A10700600',  NVL(#{refId},(SELECT T1.REF_ID FROM TBBADDED103M T1 WHERE T1.AUD_YR = #{audYr} AND T1.AUD_NO = #{audNo} AND T1.DOC_ID = #{docId}))
                                                                                             ,'A10700210',  (SELECT T1.REF_DOC_ID FROM TBBADDED103M T1 WHERE T1.AUD_YR =#{audYr} AND T1.AUD_NO =#{audNo} AND T1.DOC_ID = #{docId})
                                                                           , #{docId} ))
           AND APVR_KND_CD NOT IN ( '8' ) --열람자 제외
           ORDER BY APV_SNO
    </select>

    <select id="getDocIdByApvDocNo" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.bad.ded.dao.GEBAWD001EMapper."getDocIdByApvDocNo"*/
        SELECT DOC_ID
          FROM TBBADDED103M
         WHERE APV_RQS_ID = #{apvRqsId}
    </select>

    <select id="selectTrtmRevDocList" parameterType="paramMap" resultType="egovMap">
         /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectTrtmRevDocList*/
  		  SELECT D1.AUD_YR AS AUD_YR,
                 D1.AUD_NO AS AUD_NO,
                 D1.AUD_STEP_CD AS AUD_STEP_CD,
                 D1.DOC_ID AS DOC_ID,
                 D1.APVR_CD AS APVR_CD,
                 D1.AFF_SNO AS AFF_SNO,
                 D1.DSP_RQ_SNO AS DSP_RQ_SNO,
                 F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-')||'-'||D2.AFF_CD AS AFF_NO,
                 D2.TITLE_NM AS TITLE_NM,
                 D2.RPRT_FILD_ID,
                 D1.DSP_RQ_CD AS DSP_RQ_CD,
                 F_CODE_NM('1000002',D1.DSP_RQ_CD) AS DSP_RQ_NM,
                 D2.LIST_NO,
                 D2.DETL_DOC_NO,
                 D3.REVIEW_DOC_ID,
				 D2.TRTM_EXAMER_CNB,
				 D3.AFF_EST,
				 D3.HND_COU,
				 D3.LOG_SYS,
				 D3.REFER_ENT,
				 D3.DTL_OPIN,
				 D3.REFLECT_YN
            FROM TBBADDED146M D1
 LEFT OUTER JOIN TBBADDED145M D2 ON D1.AUD_YR = D2.AUD_YR
                                AND D1.AUD_NO = D2.AUD_NO
                                AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                AND D1.DOC_ID = D2.DOC_ID
                                AND D1.APVR_CD = D2.APVR_CD
                                AND D1.AFF_SNO = D2.AFF_SNO
 LEFT OUTER JOIN TBBADDED118M D3 ON D1.AUD_YR = D3.AUD_YR
                                AND D1.AUD_NO = D3.AUD_NO
                                AND D1.AUD_STEP_CD = D3.AUD_STEP_CD
                                AND D1.DOC_ID = D3.DOC_ID
                                AND D1.APVR_CD = D3.APVR_CD
                                AND D1.AFF_SNO = D3.AFF_SNO
  INNER JOIN TBBADDED103M T3 ON D2.AUD_YR = T3.AUD_YR
                                 AND D2.AUD_NO = T3.AUD_NO
                                 AND D2.DOC_ID = T3.DOC_ID 
           WHERE D1.AUD_YR = #{audYr}
             AND D1.AUD_NO = #{audNo}
             AND D1.AUD_STEP_CD = #{audStepCd}
             AND D1.APVR_CD = '0013600'     /*결재자코드:과장*/
             <if test='docId != null and docId != ""'>
             AND D1.DOC_ID = #{docId}
             </if>
             <if test='affSno != null and affSno != ""'>
             AND D1.DOC_ID = ( SELECT DOC_ID
                                 FROM TBBADDED145M
                                WHERE AUD_YR = #{audYr}
                                  AND AUD_NO = #{audNo}
                                  AND AUD_STEP_CD = #{audStepCd}
                                  AND APVR_CD = '0013600'     /*결재자코드:과장*/
                                  AND AFF_SNO = #{affSno}
                             )
             AND D1.AFF_SNO = #{affSno}
             </if>
  ORDER BY CASE WHEN T3.RPRT_CD = 'A10600200' 
                               THEN DECODE(T3.AUD_RPRT_DVSN_CD, '10', 1, '20', 2, '30', 3, '40', 4)
                         WHEN T3.RPRT_CD = 'A10601300' THEN 5
                         WHEN T3.RPRT_CD = 'A10601320' THEN 5
                         WHEN T3.RPRT_CD = 'A10601330' THEN 5
                         WHEN T3.RPRT_CD = 'A10601340' THEN 5
                         WHEN T3.RPRT_CD = 'A10601100' THEN 6
                         WHEN T3.RPRT_CD = 'A10601700' THEN 7 ELSE 8 END
               , D2.SORT_SNO
               , D1.SORT_SNO 
    </select>


    <delete id="deleteBADDED118M" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.deleteBADDED118M*/
        DELETE
          FROM TBBADDED118M
         WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = #{audStepCd}
           AND DOC_ID = (SELECT DOC_ID
                           FROM TBBADDED145M
                          WHERE AUD_YR = #{audYr}
                            AND AUD_NO = #{audNo}
                            AND AFF_SNO = #{affSno}
                            AND APVR_CD = '0013600' /*결재자코드:과장*/)
           AND APVR_CD = '0013600'   /*결재자코드:과장*/
           AND AFF_SNO = #{affSno}


    </delete>

    <insert id="insertBADDED118M" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBADDED118M*/
        INSERT INTO TBBADDED118M (AUD_YR,
                                  AUD_NO,
                                  AUD_STEP_CD,
                                  DOC_ID,
                                  APVR_CD,
                                  AFF_SNO,
                                  REVIEW_DOC_ID,
                                  TRTM_EXAMR_CNB,
                                  AFF_EST,
                                  HND_COU,
                                  LOG_SYS,
                                  REFER_ENT,
                                  DTL_OPIN,
                                  REFLECT_YN,
                                  FRT_USR_ID,
                                  FNL_USR_ID,
                                  FNL_DEAL_DPT_CD,
                                  FNL_MNU_ID,
                                  FRT_REGI_DH,
                                  FNL_MDF_DH)
                          VALUES (#{audYr},
                                  #{audNo},
                                  #{audStepCd},
                                  (SELECT DOC_ID
                                     FROM TBBADDED145M
                                    WHERE AUD_YR = #{audYr}
                                      AND AUD_NO = #{audNo}
                                      AND AFF_SNO = #{affSno}
                                      AND APVR_CD = '0013600' /*결재자코드:과장*/),
                                  '0013600',   /*결재자코드:과장*/
                                  #{affSno},
                                  #{reviewDocId},
                                  #{cnb},
                                  #{affEst},
                                  #{hndCou},
                                  #{logSys},
                                  #{referEnt},
                                  #{dtlOpin},
                                  #{reflectYn},
                                  #{usrId},    /*세션정보*/
                                  #{usrId},
                                  #{dptCd},
                                  #{menuNo},
                                  SYSDATE,
                                  SYSDATE)
    </insert>

    <update id="updateBADDED118M" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED118M*/
        UPDATE TBBADDED118M
           SET FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD = #{dptCd}
               ,REFLECT_YN = nvl(#{reflectYn},'')
         WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = #{audStepCd}
           AND DOC_ID = #{docId}
           AND AFF_SNO = #{affSno}
           AND APVR_CD = '0013600'
    </update>

    <select id="selectTrtmRevDocIdByFildId" parameterType="paramMap" resultType="egovMap">
          /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectTrtmRevDocIdByFildId*/
          SELECT D2.REVIEW_DOC_ID AS DOC_ID,
                 D1.AFF_SNO,
                 D1.TRTM_EXAMER_CNB,
                 (  SELECT APV_STA_CD
                      FROM TBBADDED103M T4
                    WHERE T4.REF_ID = TO_CHAR(D1.AFF_SNO)
                       AND D1.AUD_YR = T4.AUD_YR
                       AND D1.AUD_NO = T4.AUD_NO
                       AND T4.RPRT_CD = 'A10600500' ) AS APV_STA_CD
            FROM TBBADDED145M D1
 LEFT OUTER JOIN TBBADDED118M D2 ON D1.AUD_YR = D2.AUD_YR
                                AND D1.AUD_NO = D2.AUD_NO
                                AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                AND D1.DOC_ID = D2.DOC_ID
                                AND D1.APVR_CD = D2.APVR_CD
                                AND D1.AFF_SNO = D2.AFF_SNO
           WHERE D1.AUD_YR = #{audYr}
             AND D1.AUD_NO = #{audNo}
             AND D1.AUD_STEP_CD = #{audStepCd}
             AND D1.APVR_CD = '0013600'
             AND D1.RPRT_FILD_ID = #{rprtFildId}
    </select>


    <select id="selectAffSnoToDelete" parameterType="paramMap" resultType="egovMap">
          /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAffSnoToDelete*/
          SELECT AFF_SNO,
                 RPRT_FILD_ID
            FROM TBBADDED145M
           WHERE AUD_YR = #{audYr}
             AND AUD_NO = #{audNo}
             AND AUD_STEP_CD = #{audStepCd}
             AND DOC_ID = #{docId}
             AND APVR_CD = #{apvrCd}
             AND RPRT_FILD_ID NOT IN (${allRprtFildIds})
    </select>

    <select id="selectAffSno" parameterType="paramMap" resultType="egovMap">
          /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAffSno*/
          SELECT A.AFF_SNO,
                   A.RPRT_FILD_ID
            FROM TBBADDED145M A
           WHERE A.AUD_YR = #{audYr}
              AND A.AUD_NO = #{audNo}
              AND A.AUD_STEP_CD = #{audStepCd}
             <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
	             AND A.DOC_ID = (SELECT B.REF_ID 
	                                 FROM TBBADDED103M B 
	                                WHERE B.AUD_YR =  A.AUD_YR
	                                   AND B.AUD_NO =  A.AUD_NO 
	                                   AND B.AUD_STEP_CD =  'A1070'
	                                   AND B.RPRT_CD = 'A10600200'  
	                                   AND B.DOC_ID = #{docId})
			</if>
			 <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
	           AND A.DOC_ID = #{docId}
			</if>
             AND A.APVR_CD = #{apvrCd}
    </select>

    <select id="selectDspRqInfoToDelete" parameterType="paramMap" resultType="egovMap">
          /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectDspRqInfoToDelete*/
   		  SELECT D1.AFF_SPH,
 		  		 D1.TITLE_NM,
 		  		 D1.DETL_DOC_NO,
 		  		 D1.REFER_DVSN_CD,
 		  		 D2.AFF_SNO,
			     D2.DSP_RQ_SNO,
			     D2.RPRT_FILD_ID,
			     D2.AFF_DSP_CD,
			     D2.RLTN_ORG_CD,
			     D2.HND_ORG_CD,
			     D2.DSP_RQ_CD,
                 F_CODE_NM('1000002',D2.DSP_RQ_CD) AS DSP_RQ_NM
		    FROM TBBADDED145M D1
RIGHT OUTER JOIN TBBADDED146M D2 ON D1.AUD_YR = D2.AUD_YR
							    AND D1.AUD_NO = D2.AUD_NO
							    AND D1.AUD_STEP_CD = D2.AUD_STEP_CD
                                AND D1.DOC_ID = D2.DOC_ID
							    AND D1.APVR_CD = D2.APVR_CD
					   		    AND D1.AFF_SNO = D2.AFF_SNO
		   WHERE D1.AUD_YR = #{audYr}
			 AND D1.AUD_NO = #{audNo}
			 AND D1.AUD_STEP_CD = #{audStepCd}
			 <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
	              AND D1.DOC_ID = (SELECT B.REF_ID 
	                                 FROM TBBADDED103M B 
	                                WHERE B.AUD_YR =  D1.AUD_YR
	                                   AND B.AUD_NO =  D1.AUD_NO 
	                                   AND B.AUD_STEP_CD =  'A1070'
	                                   AND B.RPRT_CD = 'A10600200'  
	                                   AND B.DOC_ID = #{docId})
			</if>
			 <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
	           AND D1.DOC_ID = #{docId}
			</if>
			 AND D1.APVR_CD = #{apvrCd}
			 AND D1.MTRL_IPT_DVSN_CD  IN ( '10', '30')
             AND D1.RPRT_FILD_ID = #{rprtFildId}
		ORDER BY D2.AFF_SNO, D2.DSP_RQ_SNO
    </select>


    <select id="selectSprvIds" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.bad.ded.dao.GEBAWD001EMapper.selectSprvIds*/
 		 SELECT F_USR_INFO(D1.AUD_TOT_DRTR_CNB,'2')    AS TOT_DRTR_NM,
                F_USR_INFO(D1.AUD_TOT_DRTR_CNB,'1')    AS AUD_TOT_DRTR_USR_ID, --감사총책임자전산번호
                F_USR_INFO(D4.CNB,'2')        AS SPVR_NM0, --감사주관자1
                F_USR_INFO(D5.CNB,'2')        AS SPVR_NM1, --감사주관자2
                F_USR_INFO(D6.CNB,'2')        AS SPVR_NM2, --감사주관자3
                F_USR_INFO(D4.CNB,'1')        AS SPVR_USR_ID0, --감사주관자1
                F_USR_INFO(D5.CNB,'1')        AS SPVR_USR_ID1, --감사주관자2
                F_USR_INFO(D6.CNB,'1')        AS SPVR_USR_ID2, --감사주관자3
                F_USR_INFO(D7.CNB,'2')        AS AST_NM0, --감사보조자1
                F_USR_INFO(D8.CNB,'2')        AS AST_NM1, --감사보조자2
                F_USR_INFO(D9.CNB,'2')        AS AST_NM2, --감사보조자3
                F_USR_INFO(D7.CNB,'1')        AS AST_USR_ID0, --감사보조자1
                F_USR_INFO(D8.CNB,'1')        AS AST_USR_ID1, --감사보조자2
                F_USR_INFO(D9.CNB,'1')        AS AST_USR_ID2 --감사보조자3
           FROM TBBADDED001M AS D1
LEFT OUTER JOIN TBCSPDCP101M AS D2 ON D1.ACP_YR= D2.ACP_YR AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
LEFT OUTER JOIN TBBADDED003M AS D3 ON D1.AUD_YR = D3.AUD_YR AND D1.AUD_NO = D3.AUD_NO
LEFT OUTER JOIN TBBADDED031L AS D4 ON D1.AUD_YR = D4.AUD_YR AND D1.AUD_NO = D4.AUD_NO AND D4.AUDTOR_DVSN_CD = '1' AND D4.AUDTOR_SNO = '1'
LEFT OUTER JOIN TBBADDED031L AS D5 ON D1.AUD_YR = D5.AUD_YR AND D1.AUD_NO = D5.AUD_NO AND D5.AUDTOR_DVSN_CD = '1' AND D5.AUDTOR_SNO = '2'
LEFT OUTER JOIN TBBADDED031L AS D6 ON D1.AUD_YR = D6.AUD_YR AND D1.AUD_NO = D6.AUD_NO AND D6.AUDTOR_DVSN_CD = '1' AND D6.AUDTOR_SNO = '3'
LEFT OUTER JOIN TBBADDED031L AS D7 ON D1.AUD_YR = D7.AUD_YR AND D1.AUD_NO = D7.AUD_NO AND D7.AUDTOR_DVSN_CD = '2' AND D7.AUDTOR_SNO = '1'
LEFT OUTER JOIN TBBADDED031L AS D8 ON D1.AUD_YR = D8.AUD_YR AND D1.AUD_NO = D8.AUD_NO AND D8.AUDTOR_DVSN_CD = '2' AND D8.AUDTOR_SNO = '2'
LEFT OUTER JOIN TBBADDED031L AS D9 ON D1.AUD_YR = D9.AUD_YR AND D1.AUD_NO = D9.AUD_NO AND D9.AUDTOR_DVSN_CD = '2' AND D9.AUDTOR_SNO = '3'
         WHERE D1.AUD_YR = #{audYr}
           AND D1.AUD_KND_CD = #{audKndCd}
           AND D1.AUD_NO = #{audNo}
    </select>
    
    <select id="selectSprvIEditYn" parameterType="paramMap" resultType="egovMap">
     /* kr.go.bai.eip.bad.ded.dao.GEBAWD001EMapper.selectSprvIEditYn */
     SELECT 
     	 	<if test=" sprvListParam == null || sprvListParam == '' ">
     	 	    NVL(MAX(CASE WHEN C.AUTH_CD = 'R01' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_R01 --작성자
     	 	  , NVL(MAX(CASE WHEN C.AUTH_CD = 'R02' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_R02 --주관자
			  , NVL(MAX(CASE WHEN C.AUTH_CD = 'R03' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_R03 --보조자
		      , NVL(MAX(CASE WHEN C.AUTH_CD = 'R04' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_R04 --주관권한
		      , NVL(MAX(CASE WHEN C.AUTH_CD = 'R05' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_R05 --서무권한
		      , NVL(MAX(CASE WHEN C.AUTH_CD = 'R06' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_R06 --감사총책임자
		      , NVL(MAX(CASE WHEN C.AUTH_CD = 'R07' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_R07 --부서장
		      , NVL(MAX(CASE WHEN C.AUTH_CD = 'R99' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_R99 --임의권한
		      
		      , NVL(MAX(CASE WHEN C.AUTH_CD = 'R06' THEN 'Y' ELSE 'N' END), 'N') AS AUD_TOT_DRTR -- 감사단장
		      , NVL(MAX(CASE WHEN C.AUTH_CD IN ('R02','R01','R07','R99') THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_CD1 --감사주관자
		      , NVL(MAX(CASE WHEN C.AUTH_CD = 'R03' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_CD2 --감사보조자
		      , NVL(MAX(CASE WHEN C.AUTH_CD = 'R04' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_CD3 --주관자권한
		      , NVL(MAX(CASE WHEN C.AUTH_CD = 'R05' THEN 'Y' ELSE 'N' END), 'N') AS AUDTOR_CD4 --서무권한
		      
		      , '' AS DPT_NM --부서명
		      , '' AS RANK_NM --직급명
		      </if>
		   <if test=" sprvListParam == 'Y'.toString() ">
		        DISTINCT
		   		*
		   </if>
		FROM 
		( SELECT AA.AUTH_CD
		       , AA.CNB 
		       , F_USR_INFO(AA.CNB, '1')  AS ID
		       , F_USR_INFO(AA.CNB, '2')  AS NM
		       , AA.AUTH_CD AS AUDTOR_DVSN_CD
		       , (CASE WHEN AA.AUTH_CD = 'R01' THEN '작성자'
		               WHEN AA.AUTH_CD = 'R02' THEN '주관자'
		               WHEN AA.AUTH_CD = 'R03' THEN '보조자'
		               WHEN AA.AUTH_CD = 'R04' THEN '주관권한'
		               WHEN AA.AUTH_CD = 'R05' THEN '서무권한'
		               WHEN AA.AUTH_CD = 'R06' THEN '감사총책임자'
		               WHEN AA.AUTH_CD = 'R07' THEN '부서장'
		               WHEN AA.AUTH_CD = 'R07' THEN '임의권한'
		           END ) AS AUDTOR_DVSN_NM
		       , F_DPT_INFO(BB.DPT_CD,'1') AS DPT_NM
		       , F_CODE_NM('1000173',BB.RANK_CD) AS RANK_NM
		      FROM  ( SELECT B.AUTH_CD
						   , (CASE WHEN B.AUTH_CD = 'R01' THEN F_USR_INFO_BY_ID(A.DOC_WRT_ID,'1')
							                              ELSE C.CNB
							   END) AS CNB
					    FROM TBBADDED103M A 			
					   INNER JOIN 
							 (SELECT AA.AUD_DOC_CD /* 문서그룹ID */
								   , AA.AUTH_CD /* 권한코드 */
								   , CC.CD_NM AS AUTH_CD_NM /* 코드명 */ 
								FROM TBDCMACM201M AA /* 감사문서기본편집권한관리 */
							   INNER JOIN
								     TBFDMADM001M BB
								  ON BB.AUD_DOC_CD = AA.AUD_DOC_CD
							   INNER JOIN    
									 ( SELECT CD
									        , CD_NM 
									     FROM TBDCMACM013C 
									    WHERE CMM_CD_DVSN_CD = '1000889' 
									      AND USE_YN = 'Y' 
									      AND CD != '000000000') CC /* 공통코드 */
								  ON AA.AUTH_CD = CC.CD ) B
						   ON A.RPRT_CD = B.AUD_DOC_CD
					    LEFT OUTER JOIN
							  (/* 주관자, 보조자, 주관자권한, 서무권한*/
							    SELECT A.AUD_YR
									 , A.AUD_NO
									 , CASE WHEN A.AUDTOR_DVSN_CD = '1'  THEN 'R02' -- 주관자
										    WHEN A.AUDTOR_DVSN_CD = '2'  THEN 'R03' -- 보조자
											WHEN A.AUDTOR_DVSN_CD = '3'  THEN 'R04' -- 주관자권한
											WHEN A.AUDTOR_DVSN_CD = '4'  THEN 'R05' -- 서무권한
										END AS AUTH_CD 
									 , CNB  
								  FROM TBBADDED031L A
							     UNION ALL
								 /* 감사단장 */
								SELECT A.AUD_YR
									 , A.AUD_NO
									 , 'R06' AS AUD_TH
									 , A.AUD_TOT_DRTR_CNB AS CNB
								  FROM TBBADDED001M A
								  
								 UNION ALL
						        /* 부서장 */
						        SELECT B.AUD_YR
									 , B.AUD_NO
									 , 'R07' AS AUD_CD
									 , A.CNB
								  FROM TBDCMACM001M A
								 INNER JOIN 
									   TBBADDED001M B
									ON B.MNG_DPT_CD = A.DPT_CD
								 WHERE A.PST_CD = '0013600'    ) C	  
					      ON C.AUD_YR = A.AUD_YR
						 AND C.AUD_NO = A.AUD_NO
						 AND C.AUTH_CD = B.AUTH_CD  
					   WHERE A.AUD_YR = #{audYr}
						 AND A.AUD_NO = #{audNo}
						 AND A.AUD_STEP_CD = #{audStepCd}
						 AND A.DOC_ID = #{docId} 
				       UNION ALL
				       /* 사용자 추가 권한 */
				       SELECT 'R99'
						    , A.EDT_CNB
					     FROM TBDCMACM202M A
					    WHERE A.AUD_YR = #{audYr}
					      AND A.AUD_NO = #{audNo}
					      AND A.AUD_STEP_CD = #{audStepCd}
					      AND A.DOC_ID = #{docId} ) AA

           INNER JOIN
                 TBDCMACM001M BB
              ON BB.CNB = AA.CNB 
		 WHERE 1=1
		    <if test=" sprvListParam == null || sprvListParam == '' ">
	       		<if test="usrId != null and usrId != '' " >
	       		AND F_USR_INFO(AA.CNB, '1') =#{usrId}
	       		</if>
	       		<if test="cnb != null and cnb != '' ">
	       		AND AA.CNB =#{cnb}
	       		</if>
		    </if>
		   ) C 
		   ORDER BY AUTH_CD
    </select>
    
    <select id="selectAllAudSpvrNm" parameterType="paramMap" resultType="java.lang.String">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAllAudSpvrNm */
          SELECT AGGR_CONCAT( F_USR_INFO(CNB,'2'), ',' ) AS allAudSpvrNm
          FROM TBBADDED031L
         WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND AUDTOR_DVSN_CD = '1'
        ]]>
    </select>

    <select id="selectAprvUserId" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAprvUserId */
        SELECT F_USR_INFO(APVR_CNB, '1') AS APVR_ID,
               F_USR_INFO(APVR_CNB, '2') AS APVR_NM,
               APVR_KND_CD
          FROM TBDCMACM023L
         WHERE APV_DOC_NO = #{apvRqsId}
           AND SUBSTR(APVR_STA_CD,0,1) = '1' --결재 요청 상태
            AND APVR_KND_CD <>'8' --열람자 제외
            ORDER BY APVR_SEQ DESC
        ]]>
    </select>

	<!-- BEST20 소위원회 심의안 조회시 소위원회 심의안 요약문 LINK_URL로 변경-->
    <select id="selectAudGrnNo" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudGrnNo */
        SELECT A1.AUD_KND_CD,
               F_MNG_KND_AUDYRNO(A1.AUD_YR, A1.AUD_NO, A1.AUD_KND_CD, '-') as AUD_YR_GRN_NO,
               (CASE WHEN A1.RPRT_CD = 'A10700200' THEN (SELECT MAX(ST1.LINK_URL)
				                                                           FROM TBBADDED103M ST1
				                                                          WHERE ST1.AUD_YR = A1.AUD_YR
				                                                            AND ST1.AUD_NO = A1.AUD_NO
				                                                            AND ST1.AUD_STEP_CD = A1.AUD_STEP_CD
				                                                            AND ST1.AUD_KND_CD = A1.AUD_KND_CD
				                                                            AND ST1.RPRT_CD = 'A10700210'
				                                                            AND ST1.REF_DOC_ID = A1.DOC_ID)
				                                                    ELSE A1.LINK_URL 
                  END ) AS LINK_URL
          FROM TBBADDED103M as A1
         WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = #{audStepCd}
           AND DOC_ID = #{docId}
        ]]>
    </select>

    <update id="updateDcmFileNm" parameterType="paramMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateDcmFileNm */
          UPDATE TBBADDED108D
             SET FILE_NM = #{fileNm}
           WHERE 1=1
             AND AUD_YR = #{audYr}
             AND AUD_NO = #{audNo}
             AND EVI_DCMB_SNO = #{eviDcmbSno}
             AND AUD_DCM_DOC_ID = #{audDcmDocId}
        ]]>
    </update>

    <update id="updateAudRprtNm" parameterType="paramMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateAudRprtNm */
          UPDATE TBBADDED103M
             SET RPRT_NM = #{rprtNm}
           WHERE 1=1
             AND AUD_YR = #{audYr}
             AND AUD_NO = #{audNo}
             AND AUD_STEP_CD = #{audStepCd}
             AND DOC_ID = #{docId}
        ]]>
    </update>

    <insert id="insertCSPDCP603M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertCSPDCP603M*/
		INSERT INTO TBCSPDCP603M (REQ_DVSN_CD
									, ACP_YR
									, CVPT_ACP_NO
									, ACP_STEP_CD
									, DOC_ID
									, RPRT_NM
									, LINK_URL
									, NECES_YN
									, APV_STA_CD
									, RPRT_CD
									, APV_RQS_ID
									, DOC_KND_CD
									, SORT_SNO
									, CON_PGM_CD
									, APV_WAY_CD
									, DOC_WRT_ID
									, ONR_HNDL_NO
									, FRT_USR_ID
									, FNL_USR_ID
									, FNL_DEAL_DPT_CD
									, FNL_MNU_ID
									, FRT_REGI_DH
									, FNL_MDF_DH
									, SRNO)
		   		          VALUES (
		   		          			#{reqDvsnCd}
									, #{acpYr}
									, #{cvptAcpNo}
									, #{acpStepCd}
									, #{docId}
									, #{rprtNm}
									, #{linkUrl}
									, #{necesYn}
									, #{apvStaCd}
									, #{rprtCd}
									, #{apvRqsId}
									, #{docKndCd}
									, ( SELECT NVL(MAX(SORT_SNO),0)+1
		   		           		  	 	FROM TBCSPDCP603M
		   		           		    	WHERE ACP_YR = #{acpYr}
		   		           		    	AND REQ_DVSN_CD = #{reqDvsnCd}
					   		          	AND CVPT_ACP_NO = #{cvptAcpNo}
					   		          	AND ACP_STEP_CD = #{acpStepCd}
		   		           		  		)
									, #{conPgmCd}
									, #{apvWayCd}
									, #{usrId}
									, #{onrHndlNo}
									, #{usrId}
									, #{usrId}
									, #{dptCd}
									, #{menuNo}
									, SYSDATE
									, SYSDATE
									, #{srno}
		   		          )
	</insert>

	<update id="updateCSPDCP603M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateCSPDCP603M*/
		UPDATE TBCSPDCP603M
		   SET FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
		   	   <if test="rprtNm != null and rprtNm != ''">
		   	   ,RPRT_NM = #{rprtNm}
		   	   </if>
		   	   <if test="linkUrl != null and linkUrl != ''">
		   	   ,LINK_URL = #{linkUrl}
		   	   </if>
		   	   <if test="apvStaCd != null and apvStaCd != ''">
		   	   ,APV_STA_CD = #{apvStaCd}
		   	   </if>
		   	   <if test="apvRqsId != null and apvRqsId != ''">
		   	   ,APV_RQS_ID = #{apvRqsId}
		   	   </if>
               <if test="refId != null and refId != ''">
               ,REF_ID = #{refId}
               </if>
               <if test="onrHndlNo != null and onrHndlNo != ''">
               ,ONR_HNDL_NO = #{onrHndlNo}
               </if>

			WHERE REQ_DVSN_CD = #{reqDvsnCd}
			AND ACP_YR = #{acpYr}
			AND CVPT_ACP_NO = #{cvptAcpNo}
			AND ACP_STEP_CD = #{acpStepCd}
  		   	AND DOC_ID = #{docId}
	</update>

	<update id="updateCSPDCP602M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateCSPDCP602M*/
		UPDATE TBCSPDCP602M
		   SET CMPT_YN = 'Y'
               ,FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
		WHERE REQ_DVSN_CD = #{reqDvsnCd}
		AND ACP_YR = #{acpYr}
		AND CVPT_ACP_NO = #{cvptAcpNo}
		AND ACP_STEP_CD = #{acpStepCd}
	    AND ACP_MAIN_STEP_SNO = #{acpMainStepSno}
    	AND ACP_MAIN_STEP_ID = #{acpMainStepId}
    	<if test='srno != null and srno != ""'>
			AND srno = #{srno}
		</if>
    	 
	</update>

    <update id="updateTBBADDED114MSubCommitteeAgendaInfo" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateTBBADDED114MSubCommitteeAgendaInfo*/
        UPDATE TBBADDED114M
           SET SBMT_STA_CD = #{sbmtStaCd}
         WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND SBMT_FIX_DT = #{sbmtFixDt}
    </update>

    <select id="selectEviDcmbTypeList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectEviDcmbTypeList*/
        <![CDATA[
			SELECT CD, CD_NM FROM TBDCMACM013C
			WHERE CMM_CD_DVSN_CD = #{cmmCdDvsnCd}
			   AND CD <> '000000000'
			   AND CD <> '99'
			   AND USE_YN ='Y'
			]]>
    </select>
    
    <select id="selectSignDocIdList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectSignDocIdList*/
        <![CDATA[
         (SELECT CNB, USR_ID, USR_NAM, PST_CD, DPT_CD, ONR_PST_NM, SGN_DOC_ID, STMP_DOC_ID
           FROM TBDCMACM001M
          WHERE DPT_CD = '500000'
            AND PST_CD = '0067400'
            AND USR_ID = #{usrId}
            AND WOK_DVSN_CD = 'AAA')
         union
         (SELECT CNB, USR_ID, USR_NAM, PST_CD, DPT_CD, ONR_PST_NM, SGN_DOC_ID, STMP_DOC_ID
           FROM TBDCMACM001M
          WHERE DPT_CD = '510000'
            AND PST_CD = '0010600'
            AND USR_ID = #{usrId}
            AND WOK_DVSN_CD = 'AAA')
			]]>
    </select>
    
    <resultMap type="java.util.HashMap" id="bmsEnforceMap">
        <result property="apvDocHtmlTxt" column="APV_DOC_HTML_TXT"  jdbcType="CLOB"	 javaType="java.lang.String" />
    </resultMap>
    
    <select id="selectBmsEnforceFormHTML" parameterType="paramMap" resultMap="bmsEnforceMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectBmsEnforceFormHTML*/
        <![CDATA[
         SELECT D1.APV_DOC_HTML_TXT
           FROM TBDCMACM022L as D1
          WHERE 1=1
            AND APV_DVSN_CD = 'fieldAudit'
            AND D1.APV_DOC_NO = (SELECT APV_RQS_ID 
                                   FROM TBBADDED103M
                                  WHERE AUD_YR = #{audYr}
                                    AND AUD_NO = #{audNo}
                                    AND DOC_ID =  #{docId})
            ]]>
    </select>
    
    <insert id="insertBADDED200M" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBADDED200M*/
        INSERT INTO TBBADDED200M (
               CONN_USR_ID
             , CONN_DATE
             , FRT_USR_ID
             , FNL_USR_ID
             , FNL_DEAL_DPT_CD
             , FNL_MNU_ID
             , FRT_REGI_DH
             , FNL_MDF_DH
         )  VALUES (
            #{usrId},
            SYSDATE,
            #{usrId},
            #{usrId},
            #{dptCd},
            #{menuNo},
            SYSDATE,
            SYSDATE )
    </insert>
    
        <select id="selectExamRprtDocList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectExamRprtDocList*/
        <![CDATA[
			SELECT DOC_ID, RPRT_CD, RPRT_NM FROM TBCSPDCP603M , TBBADDED030L
    		WHERE   TSK_KEY1 = ACP_YR
		    AND TSK_KEY3 = CVPT_ACP_NO
		    AND TSK_KEY2 = REQ_DVSN_CD
		    AND AUD_NO = #{audNo}
		    AND REQ_DVSN_CD = '2'
		    AND RPRT_CD IN ( 'C10220100','C10330100')
		    AND ACP_YR = #{audYr}
			]]>
    </select>
        
    <update id="updateBADDED145MSortSno" parameterType="paramMap">
    DECLARE
    	BEGIN
       /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED145M*/
       <![CDATA[
	       UPDATE TBBADDED145M A
	           SET A.SORT_SNO = #{sortSno145}+1
	         WHERE A.AUD_YR = #{audYr}
	           AND A.AUD_KND_CD = #{audKndCd}
	           AND A.AUD_NO = #{audNo}
	           AND A.AUD_STEP_CD = #{audStepCd}
           ]]>
	        <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
	             AND A.DOC_ID = (SELECT B.REF_ID 
	                                 FROM TBBADDED103M B 
	                                WHERE B.AUD_YR =  A.AUD_YR
	                                   AND B.AUD_NO =  A.AUD_NO 
	                                   AND B.AUD_STEP_CD =  'A1070'
	                                   AND B.RPRT_CD = 'A10600200'  
	                                   AND B.DOC_ID = #{docId})
			</if>
			 <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
	           AND A.DOC_ID = #{docId}
			</if>
				AND A.MTRL_IPT_DVSN_CD IN ( '10', '30')
	           AND A.RPRT_FILD_ID = #{rprtFildId}
	         ;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , #{usrId}
					 , A.AUD_YR			
					 , A.AUD_NO			
					 , A.AUD_STEP_CD	
					 , A.DOC_ID			
					 , A.APVR_CD		
					 , A.AFF_SNO		
					 , A.AUD_KND_CD		
					 , A.AUD_GRN_NO		
					 , A.RPRT_FILD_ID	
					 , A.AFF_CD			
					 , A.LIST_NO		
					 , A.REFER_DVSN_CD	
					 , A.AFF_SPH		
					 , A.TITLE_NM		
					 , A.DP_TITLE_NM	
					 , A.QST_DOC_ISUE_YN
					 , A.QST_DOC_ISUE_DY
					 , A.AUDTOR			
					 , A.DETL_DOC_NO	
					 , A.MTRL_IPT_DVSN_CD
					 , A.SYT_TRTM_DVSN_YN
					 , A.SCRT_YN		
					 , A.SORT_SNO		
					 , A.TRTM_EXAMER_CNB
					 , A.FNL_YN			
					 , A.FRT_USR_ID		
					 , A.FNL_USR_ID		
					 , A.FNL_DEAL_DPT_CD
					 , A.FNL_MNU_ID		
					 , A.FRT_REGI_DH	
					 , A.FNL_MDF_DH		
					 , A.REF_DOC_ID
				 FROM TBBADDED145M A
		         WHERE A.AUD_YR = #{audYr}
		           AND A.AUD_KND_CD = #{audKndCd}
		           AND A.AUD_NO = #{audNo}
		           AND A.AUD_STEP_CD = #{audStepCd}
		        <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
		             AND A.DOC_ID = (SELECT B.REF_ID 
		                                 FROM TBBADDED103M B 
		                                WHERE B.AUD_YR =  A.AUD_YR
		                                   AND B.AUD_NO =  A.AUD_NO 
		                                   AND B.AUD_STEP_CD =  'A1070'
		                                   AND B.RPRT_CD = 'A10600200'  
		                                   AND B.DOC_ID = #{docId})
				</if>
				 <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
		           AND A.DOC_ID = #{docId}
				</if>
					AND A.MTRL_IPT_DVSN_CD IN ( '10', '30')
		           AND A.RPRT_FILD_ID = #{rprtFildId}
				;
		END;	         
    </update>
    
        <update id="updateBADDED146MSortSno" parameterType="paramMap">
        DECLARE
        	BEGIN
            /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED146M*/
        <![CDATA[
	        UPDATE TBBADDED146M A
	           SET A.SORT_SNO = #{sortSno146}+1
	         WHERE A.AUD_YR = #{audYr}
	           AND A.AUD_KND_CD = #{audKndCd}
	           AND A.AUD_NO = #{audNo}
	           AND A.AUD_STEP_CD = #{audStepCd}
	           ]]>
	          <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
		            AND A.DOC_ID = (SELECT B.REF_ID 
		                                 FROM TBBADDED103M B 
		                                WHERE B.AUD_YR =  A.AUD_YR
		                                   AND B.AUD_NO =  A.AUD_NO 
		                                   AND B.AUD_STEP_CD =  'A1070'
		                                   AND B.RPRT_CD = 'A10600200'  
		                                   AND B.DOC_ID = #{docId})
				</if>
				 <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
		           AND A.DOC_ID = #{docId}
				</if>
	           AND A.MTRL_IPT_DVSN_CD  IN ( '10', '30')
	           AND A.RPRT_FILD_ID = #{rprtFildId}
	           <choose>
	               <when test="rltnOrgCd != null and rltnOrgCd != ''">
	                    AND A.RLTN_ORG_CD = #{rltnOrgCd}
	               </when>
	               <otherwise>
	                     AND A.RLTN_ORG_CD IS NULL
	               </otherwise>
             	</choose>
	           AND A.DSP_RQ_CD = #{dspRqCd}
	          ;
			INSERT INTO TBBADDED146H
					(
					    HST_DVSN_CD
					  , HST_SNO
					  , HST_DH
					  , HST_USR_ID	
					  , AUD_YR
					  , AUD_NO
					  , AUD_STEP_CD 	
					  , DOC_ID 			
					  , APVR_CD 		
					  , AFF_SNO 		
					  , DSP_RQ_SNO 		
					  , DP_DSP_RQ_SNO 	
					  , AUD_KND_CD 		
					  , AUD_GRN_NO 		
					  , RPRT_FILD_ID 	
					  , AFF_DSP_CD 		
					  , RLTN_ORG_CD 	
					  , HND_ORG_CD 		
					  , REF_ORG_CD 		
					  , DSP_RQ_CD 		
					  , MTRL_IPT_DVSN_CD
					  , NOP_AM_DVSN_CD 	
					  , NOP_AM 			
					  , SORT_SNO		
					  , ACCN_INSP_CD	
					  , FNL_YN 			
					  , FRT_USR_ID 		
					  , FNL_USR_ID 		
					  , FNL_DEAL_DPT_CD 
					  , FNL_MNU_ID 		
					  , FRT_REGI_DH		
					  , FNL_MDF_DH 		
					  , NOP_SUM 		
					  , HD_AUD_STEP_CD 	
					  , HD_DOC_ID		
					  , HD_APVR_CD		
					  , HD_AFF_SNO 		
					  , HD_DSP_RQ_SNO	
					  , REF_DOC_ID 		
					  , DF_AUD_STEP_CD 	
					  , DF_DOC_ID 		
					  , DF_APVR_CD 		
					  , DF_AFF_SNO		
					  , DF_DSP_RQ_SNO 	
					  , KYWD1			
					  , KYWD2 			
					  , KYWD3 			
					  , KYWD4			
					  , KYWD5			
					)
				SELECT 'U'
				 	 , TBBADDED146H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , #{usrId}
					 , A.AUD_YR
					 , A.AUD_NO
					 , A.AUD_STEP_CD 	
					 , A.DOC_ID 			
					 , A.APVR_CD 		
					 , A.AFF_SNO 		
					 , A.DSP_RQ_SNO 		
					 , A.DP_DSP_RQ_SNO 	
					 , A.AUD_KND_CD 		
					 , A.AUD_GRN_NO 		
					 , A.RPRT_FILD_ID 	
					 , A.AFF_DSP_CD 		
					 , A.RLTN_ORG_CD 	
					 , A.HND_ORG_CD 		
					 , A.REF_ORG_CD 		
					 , A.DSP_RQ_CD 		
					 , A.MTRL_IPT_DVSN_CD
					 , A.NOP_AM_DVSN_CD 	
					 , A.NOP_AM 			
					 , A.SORT_SNO		
					 , A.ACCN_INSP_CD	
					 , A.FNL_YN 			
					 , A.FRT_USR_ID 		
					 , A.FNL_USR_ID 		
					 , A.FNL_DEAL_DPT_CD 
					 , A.FNL_MNU_ID 		
					 , A.FRT_REGI_DH		
					 , A.FNL_MDF_DH 		
					 , A.NOP_SUM 		
					 , A.HD_AUD_STEP_CD 	
					 , A.HD_DOC_ID		
					 , A.HD_APVR_CD		
					 , A.HD_AFF_SNO 		
					 , A.HD_DSP_RQ_SNO	
					 , A.REF_DOC_ID 		
					 , A.DF_AUD_STEP_CD 	
					 , A.DF_DOC_ID 		
					 , A.DF_APVR_CD 		
					 , A.DF_AFF_SNO		
					 , A.DF_DSP_RQ_SNO 	
					 , A.KYWD1			
					 , A.KYWD2 			
					 , A.KYWD3 			
					 , A.KYWD4			
					 , A.KYWD5
				 FROM TBBADDED146M A
		         WHERE A.AUD_YR = #{audYr}
		           AND A.AUD_KND_CD = #{audKndCd}
		           AND A.AUD_NO = #{audNo}
		           AND A.AUD_STEP_CD = #{audStepCd}
		          <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
			            AND A.DOC_ID = (SELECT B.REF_ID 
			                                 FROM TBBADDED103M B 
			                                WHERE B.AUD_YR =  A.AUD_YR
			                                   AND B.AUD_NO =  A.AUD_NO 
			                                   AND B.AUD_STEP_CD =  'A1070'
			                                   AND B.RPRT_CD = 'A10600200'  
			                                   AND B.DOC_ID = #{docId})
					</if>
					 <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
			           AND A.DOC_ID = #{docId}
					</if>
		           AND A.MTRL_IPT_DVSN_CD  IN ( '10', '30')
		           AND A.RPRT_FILD_ID = #{rprtFildId}
	           <choose>
	               <when test="rltnOrgCd != null and rltnOrgCd != ''">
	                    AND A.RLTN_ORG_CD = #{rltnOrgCd}
	               </when>
	               <otherwise>
	                     AND A.RLTN_ORG_CD IS NULL
	               </otherwise>
             	</choose>
		           AND A.DSP_RQ_CD = #{dspRqCd}
					;
			END;		                          
    </update>
    
        <update id="saveFinalAudReportDocData" parameterType="paramMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.saveFinalAudReportDocData */
          UPDATE TBBADDED103M
             SET  LINK_URL= #{linkUrl}
             	   ,SECU_RPT_YN = NVL(#{secuRptYn},'')
	        ]]>
             	<if test="sytTrtmDvsnYn != null and sytTrtmDvsnYn != ''">
                   ,SYT_TRTM_DVSN_YN = #{sytTrtmDvsnYn}
                </if>
           WHERE 1=1
             AND AUD_YR = #{audYr}
             AND AUD_NO = #{audNo}
             AND AUD_STEP_CD = #{audStepCd}
             AND AUD_KND_CD = #{audKndCd} 
             AND AUD_GRN_NO = #{audGrnNo}
             AND DOC_ID = #{docId}
    </update>
    
   <select id="selectSytTrtmDvsnYn" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectSytTrtmDvsnYn*/
			 SELECT 
    				CASE WHEN (SELECT F_CODE_NM('1000739',#{audKndCd})  FROM DUAL) IN ('성과', '특정') THEN 'Y' ELSE 'N' END AS SYT_TRTM_DVSN_YN--종합처리안 구분 여부
  			FROM DUAL
			]]>
    </select>
    
     <update id="updateBADDED003M" parameterType="paramMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED003M */
          UPDATE TBBADDED003M
             SET GNR_HNDL_PLAN_YN = #{sytTrtmDvsnYn}
           WHERE AUD_YR = #{audYr}
             AND AUD_NO = #{audNo}
        ]]>
    </update>
        
    <select id="selectFnlRptApvrCd" parameterType="paramMap" resultType="java.lang.String" >
      <![CDATA[
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectFnlRptApvrCd*/
          SELECT NVL(MAX(B.APVR_CD), '  ') AS APVR_CD
           FROM TBBADDED103M A INNER JOIN TBBADDED145M B
              ON A.DOC_ID = B.REF_DOC_ID
             AND A.AUD_YR = B.AUD_YR
             AND A.AUD_NO = B.AUD_NO         
          WHERE A.AUD_YR        = #{audYr}
             AND A.AUD_NO        = #{audNo}
             AND A.AUD_STEP_CD   ='A1070'
             AND A.DOC_ID        =  #{docId}
         ]]>
     </select>
      
      <select id="selectAudReportData" parameterType="paramMap" resultType="egovMap" >
      <![CDATA[
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudReportData*/
          SELECT  AUD_YR, AUD_NO, AUD_STEP_CD, DOC_ID, APVR_CD, AFF_SNO, 
          			RPRT_FILD_ID , AFF_SPH, TITLE_NM, DETL_DOC_NO, SYT_TRTM_DVSN_YN
 			FROM TBBADDED145M 
          WHERE AUD_YR = #{audYr}
             AND AUD_NO = #{audNo}
             AND AUD_STEP_CD = #{audStepCd}
       ]]>
          <include refid="whereApvrCd" />
          <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
			  AND REF_DOC_ID = #{docId}
		  </if>
		  <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
	           AND DOC_ID = #{docId}
			</if>
         
     </select>
     
      <update id="updateBADDED145MwebMapping" parameterType="paramMap">
      DECLARE
      	BEGIN      
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED145MwebMapping*/
      <![CDATA[
        UPDATE TBBADDED145M
           SET RPRT_FILD_ID =  #{rprtFildId}
      			, AFF_SPH = #{affSph} 
      			, TITLE_NM = #{titleNm}
      			, DETL_DOC_NO = #{detlDocNo}
      			, SYT_TRTM_DVSN_YN = #{sytTrtmDvsnYn}
      			, MTRL_IPT_DVSN_CD = '30'
      			, FNL_MDF_DH = SYSDATE
         WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = #{audStepCd}
           AND AFF_SNO = #{affSno}
           ]]>
           <include refid="whereApvrCd" />
         <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
			  AND REF_DOC_ID = #{docId}
		  </if>
		  <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
	           AND DOC_ID = #{docId}
			</if>
		;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , #{usrId}
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	 ASD
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID
				 FROM TBBADDED145M
		         WHERE AUD_YR = #{audYr}
		           AND AUD_NO = #{audNo}
		           AND AUD_STEP_CD = #{audStepCd}
		           AND AFF_SNO = #{affSno}
		           <include refid="whereApvrCd" />
		         <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
					  AND REF_DOC_ID = #{docId}
				  </if>
				  <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
			           AND DOC_ID = #{docId}
					</if>
				;
		END;		
    </update>
    
    <update id="updateBADDED146MwebMapping" parameterType="paramMap">
    DECLARE
    	BEGIN
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateBADDED146MwebMapping*/
      <![CDATA[
        UPDATE TBBADDED146M
           SET RPRT_FILD_ID = #{rprtFildId}
         , MTRL_IPT_DVSN_CD = '30'
         , FNL_MDF_DH = SYSDATE
         WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = #{audStepCd}
           AND AFF_SNO = #{affSno}
         ]]>
           <include refid="whereApvrCd" />
           <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
			  AND REF_DOC_ID = #{docId}
		  </if>
		  <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
	           AND DOC_ID = #{docId}
			</if>
		;
		INSERT INTO TBBADDED146H
				(
				    HST_DVSN_CD
				  , HST_SNO
				  , HST_DH
				  , HST_USR_ID	
				  , AUD_YR
				  , AUD_NO
				  , AUD_STEP_CD 	
				  , DOC_ID 			
				  , APVR_CD 		
				  , AFF_SNO 		
				  , DSP_RQ_SNO 		
				  , DP_DSP_RQ_SNO 	
				  , AUD_KND_CD 		
				  , AUD_GRN_NO 		
				  , RPRT_FILD_ID 	
				  , AFF_DSP_CD 		
				  , RLTN_ORG_CD 	
				  , HND_ORG_CD 		
				  , REF_ORG_CD 		
				  , DSP_RQ_CD 		
				  , MTRL_IPT_DVSN_CD
				  , NOP_AM_DVSN_CD 	
				  , NOP_AM 			
				  , SORT_SNO		
				  , ACCN_INSP_CD	
				  , FNL_YN 			
				  , FRT_USR_ID 		
				  , FNL_USR_ID 		
				  , FNL_DEAL_DPT_CD 
				  , FNL_MNU_ID 		
				  , FRT_REGI_DH		
				  , FNL_MDF_DH 		
				  , NOP_SUM 		
				  , HD_AUD_STEP_CD 	
				  , HD_DOC_ID		
				  , HD_APVR_CD		
				  , HD_AFF_SNO 		
				  , HD_DSP_RQ_SNO	
				  , REF_DOC_ID 		
				  , DF_AUD_STEP_CD 	
				  , DF_DOC_ID 		
				  , DF_APVR_CD 		
				  , DF_AFF_SNO		
				  , DF_DSP_RQ_SNO 	
				  , KYWD1			
				  , KYWD2 			
				  , KYWD3 			
				  , KYWD4			
				  , KYWD5			
				)
			SELECT 'U'
			 	 , TBBADDED146H_SEQ.NEXTVAL
			 	 , SYSDATE
			 	 , #{usrId}
				 , AUD_YR
				 , AUD_NO
				 , AUD_STEP_CD 	
				 , DOC_ID 			
				 , APVR_CD 		
				 , AFF_SNO 		
				 , DSP_RQ_SNO 		
				 , DP_DSP_RQ_SNO 	
				 , AUD_KND_CD 		
				 , AUD_GRN_NO 		
				 , RPRT_FILD_ID 	
				 , AFF_DSP_CD 		
				 , RLTN_ORG_CD 	
				 , HND_ORG_CD 		
				 , REF_ORG_CD 		
				 , DSP_RQ_CD 		
				 , MTRL_IPT_DVSN_CD
				 , NOP_AM_DVSN_CD 	
				 , NOP_AM 			
				 , SORT_SNO		
				 , ACCN_INSP_CD	
				 , FNL_YN 			
				 , FRT_USR_ID 		
				 , FNL_USR_ID 		
				 , FNL_DEAL_DPT_CD 
				 , FNL_MNU_ID 		
				 , FRT_REGI_DH		
				 , FNL_MDF_DH 		
				 , NOP_SUM 		
				 , HD_AUD_STEP_CD 	
				 , HD_DOC_ID		
				 , HD_APVR_CD		
				 , HD_AFF_SNO 		
				 , HD_DSP_RQ_SNO	
				 , REF_DOC_ID 		
				 , DF_AUD_STEP_CD 	
				 , DF_DOC_ID 		
				 , DF_APVR_CD 		
				 , DF_AFF_SNO		
				 , DF_DSP_RQ_SNO 	
				 , KYWD1			
				 , KYWD2 			
				 , KYWD3 			
				 , KYWD4			
				 , KYWD5
			 FROM TBBADDED146M
	         WHERE AUD_YR = #{audYr}
	           AND AUD_NO = #{audNo}
	           AND AUD_STEP_CD = #{audStepCd}
	           AND AFF_SNO = #{affSno}
	           <include refid="whereApvrCd" />
	           <if test="apvrCd =='A1070' and audStepCd == 'A1070' ">
				  AND REF_DOC_ID = #{docId}
			  </if>
			  <if test="apvrCd !='A1070' or audStepCd != 'A1070' ">
		           AND DOC_ID = #{docId}
				</if>
				;
		END;				
    </update>
    
     <sql id = "whereApvrCd">
      <if test="audStepCd == 'A1060' ">
        AND APVR_CD IN NVL((SELECT B.APVR_CD
					               FROM (SELECT A.APVR_CD, ROWNUM AS RN
							               FROM TBBADDED145M A
								          WHERE A.AUD_YR = #{audYr}
								            AND A.AUD_NO = #{audNo}
								            AND A.AUD_STEP_CD = #{audStepCd}
							     	        AND A.DOC_ID = #{docId}
								       ORDER BY CASE WHEN A.APVR_CD IN ('0013600','0057400','0035400') THEN '0'
                    				                 WHEN A.APVR_CD IN ('0015800','0035100','0058100','0013900') THEN '1'
									                 WHEN A.APVR_CD IN ('0055600','0045900') THEN '2'
									                 WHEN A.APVR_CD IN ('0055700') THEN '3' END DESC     
							             ) B
						           WHERE ROWNUM = 1),'0013600')
		</if>
		<if test="audStepCd == 'A1070' ">
        AND APVR_CD = NVL((SELECT B.APVR_PST_CD
								        FROM (SELECT ROWNUM AS R_NUM, A.*
								                    FROM TBDCMACM023L A
								                  WHERE A.APV_DOC_NO = (SELECT APV_RQS_ID
									                                            FROM TBBADDED103M
									                                           WHERE AUD_YR        = #{audYr}
									                                              AND AUD_NO        = #{audNo}
									                                              AND AUD_STEP_CD   = #{audStepCd}
									                                              AND DOC_ID        = #{docId})
								                      AND A.APV_SNO <![CDATA[<>]]> 1
								                      AND A.APVR_STA_CD IN ('102', '103', '401')
								                   ORDER BY A.APVR_STA_CD DESC ) B
								     WHERE B.R_NUM = 1),'0013600')
		</if>
     </sql>
     
    <select id="selelctFirstDocYn" parameterType="paramMap" resultType="java.lang.String" >
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selelctFirstDocYn*/
			 SELECT DECODE(COUNT(1),0,'Y','N') AS FIRST_DOC_YN
			  FROM TBBADDED103M
			 WHERE AUD_YR = #{audYr}
			     AND AUD_NO = #{audNo}
			     AND RPRT_CD = 'A10500200'
			]]>
    </select>
    
    <select id="selectSbmtAgdList" parameterType="paramMap" resultType="egovMap" >
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectSbmtAgdList */
            SELECT  
                NVL(TO_CHAR(TO_DATE(T1.SBMT_FIX_DT),'YYYY-MM-DD'),'미확정') AS SBMT_FIX_DT --소위예정일 
                ,T1.SBMT_FIX_DH --소위예정시간
                ,T1.SBMT_NO --안건번호
                ,T1.TITLE_NM --제목
                ,T1.SBMT_REL_CON --소관기관
                ,T6.RPRT_NM
                , NVL(T6.AUD_RPRT_CHONG_DH, T6.AUD_RPRT_CHA_DH) AS PSD_APV_DY --사무처결재일자
                , T1.DOC_ID
              FROM TBBADDED114M T1
                 INNER JOIN (
                            SELECT 
                                ST1.AUD_YR, ST1.AUD_NO, ST1.DOC_ID, ST1.RPRT_NM 
                                , MIN(DECODE(ST1.RPRT_CD,'A10600200',DECODE(ST2.APVR_PST_CD,'0055600',F_USR_INFO(ST2.APVR_CNB,'2') ,
                                                                                          DECODE(ST2.APVR_PST_CD,'0045900',F_USR_INFO(ST2.APVR_CNB,'2') ,'')),'')) AS AUD_RPRT_CHA  /* 0045900 : 본부장 추가 */
                                , MIN(DECODE(ST1.RPRT_CD,'A10600200',DECODE(ST2.APVR_PST_CD,'0055700',F_USR_INFO(ST2.APVR_CNB,'2'),''),'')) AS AUD_RPRT_CHONG
                                , MIN(DECODE(ST1.RPRT_CD,'A10600200',DECODE(ST2.APVR_PST_CD,'0055600',TO_CHAR(ST2.APV_DH,'YYYY"-"MM"-"DD" "HH24:MI') ,
                                                                                                  DECODE(ST2.APVR_PST_CD,'0045900',TO_CHAR(ST2.APV_DH,'YYYY"-"MM"-"DD" "HH24:MI') ,'')),'')) AS AUD_RPRT_CHA_DH  /* 0045900 : 본부장 추가 */
                                , MIN(DECODE(ST1.RPRT_CD,'A10600200',DECODE(ST2.APVR_PST_CD,'0055700',TO_CHAR(ST2.APV_DH,'YYYY"-"MM"-"DD" "HH24:MI'),''),'')) AS AUD_RPRT_CHONG_DH
                              FROM TBBADDED103M ST1 INNER JOIN TBDCMACM023H ST2
                                   ON (ST1.APV_RQS_ID = ST2.APV_DOC_NO AND ST2.APVR_STA_CD IN ('202','203'))
                             WHERE ST1.RPRT_CD = 'A10600200'
                             GROUP BY ST1.AUD_YR, ST1.AUD_NO, ST1.DOC_ID, ST1.RPRT_NM
                            ) T6
                ON (T1.AUD_YR = T6.AUD_YR AND T1.AUD_NO = T6.AUD_NO AND T1.DOC_ID = T6.DOC_ID)
             WHERE 1=1
              AND T1.AUD_YR = #{audYr}
              AND T1.AUD_NO = #{audNo}
              AND T1.SBMT_SEQ = #{sbmtSeq}
			]]>
    </select>
    
        <select id="selectReqDocList" parameterType="paramMap" resultType="egovMap" >
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectReqDocList */
        SELECT A.AUD_YR
	          , A.AUD_NO
	          , A.DVSN_CD
	          , E.ACP_YR
	          , E.REQ_DVSN_CD
	          , E.CVPT_ACP_NO
	          , DECODE( F.RM_CVPT_ACP_NO,NULL,NULL,E.ACP_YR||'-'||F_CODE_NM('1000740',E.REQ_DVSN_CD)||'-'||
										CASE WHEN E.REQ_DVSN_CD ='1' /*제보*/ THEN F.RM_CVPT_ACP_NO
				                         WHEN E.REQ_DVSN_CD IN ('2','3') /*청구*/ THEN SUBSTR(F.RM_CVPT_ACP_NO,3,5)  END  ) AS ACP_NO          /*분류번호*/
	          , E.STEP_GB_CD
	          , E.DOC_ID
	          , E.FOLDER_RPRT_NM
              , F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, '', '-') AS AUD_YR_NO  /* 원 감사사항 분류번호*/
              , FILE_DOC_NM
          FROM TBBADDED030L A, TBCSPDCP101M F,
             (
		        SELECT '10' AS STEP_GB_CD /* selectStepAcpSbjDocList 단계별 */
		          		  , RPRT_NM AS FOLDER_RPRT_NM
		            	  , F_CODE_NM('1000786', RPRT_CD) AS FILE_DOC_NM
		            	  , DOC_ID AS DOC_ID
		            	  , ACP_YR
		            	  , CVPT_ACP_NO
		            	  , REQ_DVSN_CD
		          FROM TBCSPDCP603M --제보청구문서함
		         WHERE 1=1
		            AND APV_WAY_CD IN ('10', '30')
        
        	UNION ALL
         
	               SELECT '20' AS STEP_GB_CD  /* selectEtcDocumentList 기타문서함 조회*/
	                	, F_CODE_NM('1000746', SPMT_DVSN_CD)   AS FOLDER_RPRT_NM
	                	, FILE_NM AS FILE_DOC_NM
	                	, ACP_DCM_DOC_ID AS DOC_ID
		                , A.ACP_YR
		                , A.CVPT_ACP_NO
		                , A.REQ_DVSN_CD
				  FROM TBCSPEAR003L A, TBCSPDCP608D B 
				WHERE  A.ACP_YR = B.ACP_YR
				   AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
				   AND A.REQ_DVSN_CD = B.REQ_DVSN_CD
				   AND A.EVI_DCMB_SNO = B.EVI_DCMB_SNO
    		) E  
    
         WHERE A.TSK_KEY1 = E.ACP_YR
	         AND A.TSK_KEY2 = E.REQ_DVSN_CD
	         AND A.TSK_KEY3 = E.CVPT_ACP_NO
	         
	         AND F.ACP_YR = E.ACP_YR
	         AND F.REQ_DVSN_CD = E.REQ_DVSN_CD
	         AND F.CVPT_ACP_NO = E.CVPT_ACP_NO
	         
	         AND A.AUD_YR = #{audYr}
	         AND A.AUD_NO = #{audNo}
             
	   ORDER BY E.ACP_YR, E.REQ_DVSN_CD, E.CVPT_ACP_NO, E.STEP_GB_CD
		]]>
    </select>
    
    <select id="selectBAIEditorInfo" parameterType="paramMap" resultType="egovMap" >
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectBAIEditorInfo */
        SELECT EDT_TITLE_NM, EDT_VER, ODT_TITLE_NM, ODT_VER, OLD_EDT_VER
		  FROM TBBADDED125M
	     WHERE ODT_SNO = (SELECT MAX(ODT_SNO) AS SNO FROM TBBADDED125M WHERE EDIT_FLAG = NVL(#{editFlag},'ODT'))	
	       AND EDIT_FLAG = NVL(#{editFlag},'ODT')
		]]>
    </select>
    
    <insert id="insertBAIEditorInfo" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBAIEditorInfo */
        INSERT INTO TBBADDED125M(
              EDIT_FLAG
            , ODT_SNO
            , EDT_TITLE_NM
            , EDT_VER
            , ODT_TITLE_NM
            , ODT_VER
            , PATCH_DATE
            , FRT_USR_ID
            , FNL_USR_ID
            , FNL_DEAL_DPT_CD
            , FNL_MNU_ID
            , FRT_REGI_DH
            , FNL_MDF_DH
            , OLD_EDT_VER
        ) VALUES (
               NVL(#{editFlag},'ODT')
             , ( SELECT NVL(MAX(ODT_SNO),0)+1 FROM TBBADDED125M WHERE EDIT_FLAG = NVL(#{editFlag},'ODT') )
             , #{edtTitleNm}
             , #{edtVer}
             , #{odtTitleNm}
             , #{odtVer}
             , SYSDATE
             , #{usrId}
             , #{usrId}
             , #{dptCd}
             , #{menuNo}
             , SYSDATE
             , SYSDATE
             , #{oldEdtVer}
        )
        </insert>
    <select id="selectBruchfApvYn" parameterType="paramMap" resultType="java.lang.String">
    <![CDATA[
    	/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectBruchfApvYn */
        SELECT NVL(MAX(CASE WHEN F.USR_DFN_TXT_2 IN ('0055600','0055700','0010600','0067400') --차장 또는 본부장급 이상
                            THEN 'Y' 
                            ELSE 'N' END), 'N') AS BRUCHF_APV_YN
          FROM TBBADDED103M C 
    INNER JOIN TBDCMACM023L D ON C.APV_RQS_ID = D.APV_DOC_NO
    INNER JOIN TBDCMACM001M E ON E.CNB = D.APVR_CNB
LEFT OUTER JOIN TBDCMACM013C F ON F.CMM_CD_DVSN_CD = '1000855' AND F.CD = E.INN_RANK_CD
         WHERE D.APV_SNO <> 1
           AND C.RPRT_CD = 'A10600200'
           AND D.APVR_STA_CD IN ('202','203','204')
           --AND D.APVR_CNB = cnb
           AND C.DOC_ID = #{docId}
           AND D.APV_SNO = (SELECT MAX(T2.APV_SNO) 
                             FROM TBBADDED103M T1 
                       INNER JOIN TBDCMACM023L T2 ON T1.APV_RQS_ID = T2.APV_DOC_NO
                            WHERE T2.APV_SNO <> 1
                              AND T1.RPRT_CD = 'A10600200'
                              AND T2.APVR_STA_CD IN ('202','203','204')
                            --AND D.APVR_CNB = cnb
                              AND T1.DOC_ID = #{docId})
    ]]>
    </select>
    
    <select id="selectAudReportDocId" parameterType="paramMap" resultType="java.lang.String">
    <![CDATA[
    	/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudReportDocId */
		SELECT MAX(DOC_ID) AS REF_DOC_ID
		  FROM TBBADDED113M
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   AND APVR_CD = '0010600'
		   AND SBCN_REGI_REQ_DT = #{refDy}
		   AND AUD_MAIN_STEP_SNO = #{audMainStepSno}
    ]]>
    </select>
    
    	<insert id="insertDCMACM043H" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertDCMACM043H */
		INSERT INTO TBDCMACM043H(
			   SRNO
             , DOC_ID
             , DOC_NM
             , RPRT_CD
             , PRT_DPT_CD
             , PRT_DPT_NM
             , PRT_USR_ID
             , PRT_USR_NM
             , PRT_DT
             , REL_WORK_CD
             , REL_WORK_YEAR
             , REL_WORK_DVSN_CD
             , REL_WORK_NO
             , REL_STEP_CD
             , FRT_USR_ID
             , FNL_USR_ID
             , FNL_DEAL_DPT_CD
             , FNL_MNU_ID
             , FRT_REGI_DH
             , FNL_MDF_DH
		) VALUES (
			  ( SELECT NVL(MAX(SRNO),0)+1 FROM TBDCMACM043H )
			 , #{docId}
			 , #{docNm}
			 , #{rprtCd}
			 , #{dptCd}
			 , #{dptNm}
			 , #{usrId}
			 , #{usrNam}
			 , TO_DATE( #{printDate} , 'YYYY/MM/DD HH24:MI:SS')
			 , #{relWorkCd}
			 , #{relWorkYear}
			 , #{relWorkDvsnCd}
			 , #{relWorkNo}
			 , #{relStepCd}
			 , #{usrId}
			 , #{usrId}
			 , #{dptCd}
			 , #{menuNo}
			 , SYSDATE
			 , SYSDATE
		)
		</insert>
		
	<select id="selectMaxOnnaraNum" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
    	/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectMaxOnnaraNum */
    	
		SELECT MAX(TO_NUMBER(SUBSTR(D.DOC_ID,4,LENGTH(D.DOC_ID))))+1 AS ONR_ADMINISTRATIVENUM_SEQ
		FROM (
		    SELECT DOC_ID, CON_PGM_CD FROM TBBADDED103M
		    UNION ALL
		    SELECT DOC_ID, CON_PGM_CD FROM TBCSPDCP603M
		    UNION ALL
		    SELECT DOC_ID, CON_PGM_CD FROM TBBADFRE103M
		) D
		WHERE D.CON_PGM_CD ='20'
		   AND D.DOC_ID LIKE 'ONR%'
    ]]>
    </select>
    
    	<insert id="insertBADDED127M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBADDED127M */
		INSERT INTO TBBADDED127M (
			  AUD_YR
			, AUD_NO
			, AUD_STEP_CD
			, AUD_KND_CD
			, AUD_GRN_NO
			, DOC_ID
			, SRNO
			, RPRT_FILD_ID
			, DSP_RQ_TXT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES (
			#{audYr}
			, #{audNo}
			, #{audStepCd}
			, #{audKndCd}
			, #{audGrnNo}
			, #{docId}
			, (SELECT NVL(MAX(SRNO),0)+1 FROM TBBADDED127M WHERE DOC_ID = #{docId} )
			, #{rprtFildId}
			, #{audStepItems, jdbcType=CLOB}
			, #{usrId}
			, #{usrId}
			, #{dptCd}
			, #{menuNo}
			, SYSDATE
			, SYSDATE
		)
	</insert>
	
	<delete id="deleteBADDED127M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.deleteBADDED127M*/
		DELETE FROM TBBADDED127M
		 WHERE AUD_YR = #{audYr}
		    AND AUD_NO = #{audNo}
		    AND AUD_STEP_CD = #{audStepCd}
            AND DOC_ID = #{docId}
	</delete>
    
    <select id="selectBADDED108M" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectBADDED108M */
        SELECT DISTINCT FOLDER_NM FROM TBBADDED108M
        WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
    ]]>
    </select>

    <insert id="insertTBCSPBII103L" parameterType="paramMap">
    <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertTBCSPBII103L */
        INSERT INTO TBCSPBII103L (
              AUD_YR
            , AUD_NO
            , SRNO
            , DOC_ID
            , INF_YR
            , INF_SRNO
            , WRIT_NO
            , COPT_ORG_NM
            , TIT_NM
            , RANK_NM
            , NAM
            , FRT_USR_ID
            , FNL_USR_ID
            , FNL_DEAL_DPT_CD
            , FNL_MNU_ID
            , FRT_REGI_DH
            , FNL_MDF_DH
        ) VALUES (
            #{audYr}
           , #{audNo}
           , (SELECT NVL(MAX(SRNO)+1,0) FROM TBCSPBII103L
             WHERE AUD_YR = #{audYr}
                AND AUD_NO = #{audNo}
                AND DOC_ID = #{docId})
           , #{docId}
           , #{infYr}
           , NULL
           , #{infSrno} --컬럼 변경 INF_SRNO를 WRIT_NO로 수정. 2017.10.30
           , #{coptOrgNm}
           , #{titNm}
           , #{rankNm}
           , #{nam}
           , #{usrId}
           , #{usrId}
           , #{dptCd}
           , #{menuNo}
           , SYSDATE
           , SYSDATE
        )
        ]]>
    </insert>
    
    <delete id="deleteCSPBII103L" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.deleteCSPBII103L */
        DELETE FROM TBCSPBII103L
         WHERE AUD_YR = #{audYr}
            AND AUD_NO = #{audNo}
            AND DOC_ID = #{docId}
    </delete>

    <select id="selectAudReportAssistantUse" parameterType="paramMap" resultType="egovMap" >
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAudReportAssistantUse */
        SELECT T1.RPRT_NM
                , T1.RPRT_CD
                , T1.DOC_ID
          FROM TBBADDED103M T1
               INNER JOIN TBBADDED111M T2
               ON (T1.AUD_YR = T2.AUD_YR
                   AND T1.AUD_NO = T2.AUD_NO
                   AND T1.DOC_ID = T2.DOC_ID)
         WHERE T1.AUD_YR = #{audYr}
           AND T1.AUD_NO = #{audNo}
           AND T1.REF_ID = #{docId}  -- 감사보고서DOC_ID(파라메터)
           AND T1.AUD_STEP_CD = 'A1070'    -- 감사단계코드(고정)
           AND T1.RPRT_CD = 'A10600300'    -- 보고서코드(고정)
        ]]>
    </select>
    
	<select id="selectAffList" parameterType="paramMap" resultType="egovMap" >
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAffList */
SELECT T.*
     , A.RPRT_CD
     , A.RPRT_NM
  FROM (
    SELECT MAX(AUD_YR) AS AUD_YR
         , MAX(AUD_NO) AS AUD_NO
         , MAX(DOC_ID) AS DOC_ID
         , MAX(RPRT_FILD_ID) AS RPRT_FILD_ID
         , AFF_SNO
         , MAX(TITLE_NM) AS TITLE_NM
      FROM TBBADDED145M
     WHERE 1=1
       AND AUD_YR = #{audYr}
       AND AUD_NO = #{audNo}
       AND AUD_STEP_CD = 'A1060'
     GROUP BY AFF_SNO
     ORDER BY AFF_SNO
     ) T
  LEFT OUTER JOIN 
     (
    SELECT DOC_ID
         , RPRT_CD
         , RPRT_NM
      FROM TBBADDED103M
     WHERE 1=1
       AND AUD_YR = #{audYr}
       AND AUD_NO = #{audNo}
       AND AUD_STEP_CD = 'A1060'
       AND RPRT_CD IN ('A10600200')
     ) A
    ON T.DOC_ID = A.DOC_ID
        ]]>
    </select>

    
    <select id="selectDocRprtCdInfo" parameterType="paramMap" resultType="egovMap" >
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectDocRprtCdInfo */
        ]]>
    </select>
    
    
     <select id="selectGetDspRqSno" parameterType="paramMap" resultType="java.lang.String">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectGetDspRqSno*/
    	<![CDATA[
            SELECT TO_CHAR(DSP_RQ_SNO) AS DSP_RQ_SNO
              FROM TBBADEAR001M
              WHERE AUD_YR         = #{audYr}
                AND AUD_NO         = #{audNo}
                AND AUD_DSP_RQ_SNO =#{audDspRqSno}
    	]]>
    </select>
    
    
    <insert id="saveDspRqHndSbjAndDocId" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.saveDspRqHndSbjAndDocId*/
		MERGE INTO TBBADEAR036M
		USING DUAL
		   ON (     AUD_YR         = #{audYr}        /* 감사년도 */
		        AND AUD_NO         = #{audNo}        /* 감사번호 */
		        AND AUD_DSP_RQ_SNO = #{audDspRqSno} /* 전자감사처분요구순번 */
		      ) 
		 WHEN MATCHED THEN 
							  UPDATE 
							     SET SUMPRT_TXT       = #{sumprtTxt}    /* 요약전내용(지적사항) */
							       , DSP_RQ_HND_SBJ   = #{dspRqHndSbj}  /* 조치사항 */ 
							       , DOC_ID           = #{docId}        /* 문서ID */  
							       , DOC_TYP_CD       = #{docTypCd}     /* 문서유형코드 */  
							       , FNL_USR_ID       = #{usrId}
							       , FNL_DEAL_DPT_CD  = #{dptCd}
							       , FNL_MNU_ID       = #{menuNo}
							       , FNL_MDF_DH       = SYSDATE
		 WHEN NOT MATCHED THEN   
							  INSERT (AUD_YR           
									 ,AUD_NO           
									 ,AUD_DSP_RQ_SNO       
									 ,SUMPRT_TXT       /* 요약전내용(지적사항) */
									 ,DSP_RQ_HND_SBJ   /* 조치사항 */ 
									 ,DOC_ID           /* 문서ID */  
									 ,DOC_TYP_CD       /* 문서유형코드 */  								  
									 ,FRT_USR_ID
									 ,FNL_USR_ID
									 ,FNL_DEAL_DPT_CD
									 ,FNL_MNU_ID
									 ,FRT_REGI_DH
									 ,FNL_MDF_DH)
			   		          VALUES (#{audYr}
			   		           		 ,#{audNo}
			   		           		 ,#{audDspRqSno}
									 ,#{sumprtTxt}      
									 ,#{dspRqHndSbj}  
									 ,#{docId}             
									 ,#{docTypCd}      								   								  
					        		 ,#{usrId}   
	                                 ,#{usrId}
	                                 ,#{dptCd}
	                                 ,#{menuNo}
	                                 ,SYSDATE
	                                 ,SYSDATE) 	
	</insert>  
	
    <insert id="saveDspRqHndSbjAndDocIdDtm" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.saveDspRqHndSbjAndDocIdDtm*/
		MERGE INTO TBBADEAR005M
		USING DUAL
		   ON (     AUD_YR     = #{audYr}     /* 감사년도 */
		        AND AUD_NO     = #{audNo}     /* 감사번호 */
		        AND DSP_RQ_SNO = #{dspRqSno}  /* 처분요구순번 */
		      ) 
		 WHEN MATCHED THEN 
							  UPDATE 
							     SET SUMPRT_TXT       = #{sumprtTxt}    /* 요약전내용(지적사항) */
							       , DSP_RQ_HND_SBJ   = #{dspRqHndSbj}  /* 조치사항 */ 
							       , DOC_ID           = #{docId}        /* 문서ID */  
							       , DOC_TYP_CD       = #{docTypCd}     /* 문서유형코드 */  
							       , FNL_USR_ID       = #{usrId}
							       , FNL_DEAL_DPT_CD  = #{dptCd}
							       , FNL_MNU_ID       = #{menuNo}
							       , FNL_MDF_DH       = SYSDATE
		 WHEN NOT MATCHED THEN   
							  INSERT (AUD_YR           
									 ,AUD_NO           
									 ,DSP_RQ_SNO       
									 ,SUMPRT_TXT       /* 요약전내용(지적사항) */
									 ,DSP_RQ_HND_SBJ   /* 조치사항 */ 
									 ,DOC_ID           /* 문서ID */  
									 ,DOC_TYP_CD       /* 문서유형코드 */  								  
									 ,SUMPRT_IPT_YN     
									 ,FRT_USR_ID
									 ,FNL_USR_ID
									 ,FNL_DEAL_DPT_CD
									 ,FNL_MNU_ID
									 ,FRT_REGI_DH
									 ,FNL_MDF_DH)
			   		          VALUES (#{audYr}
			   		           		 ,#{audNo}
			   		           		 ,#{dspRqSno} 
									 ,#{sumprtTxt}      
									 ,#{dspRqHndSbj}  
									 ,#{docId}             
									 ,#{docTypCd}      								   								  
									 ,'Y'            
					        		 ,#{usrId}   
	                                 ,#{usrId}
	                                 ,#{dptCd}
	                                 ,#{menuNo}
	                                 ,SYSDATE
	                                 ,SYSDATE) 	
	</insert> 
	
	<select id="getAudDocDataMainAudRprt" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.getAudDocDataMainAudRprt*/
		<if test=" 'Y'.toString() == onlyDocIdParam " >
             SELECT T.* FROM (
      </if>
		SELECT F.* 
			, F_USR_INFO_BY_ID( F.DOC_WRT_ID, '2' ) AS DOC_WRT_NM
			, F_CODE_NM('1000773', F.APV_STA_CD) AS APV_STA_NM
			, F_CODE_NM('1000786', F.RPRT_CD) AS ORG_RPRT_NM
		FROM TBBADDED103M F
	   INNER JOIN 
		     TBAEPMAR001M AA
		  ON AA.AUD_YR = F.AUD_YR
		 AND AA.AUD_NO = F.AUD_NO
		 AND AA.AUD_STEP_CD = F.AUD_STEP_CD
		 AND AA.REF_DOC_ID = F.DOC_ID
	   WHERE 1=1
	    <if test =" onlyDocIdParam == null or onlyDocIdParam == '' " >
	       AND F.AUD_YR = #{audYr}
		   AND F.AUD_NO = #{audNo}
		   AND F.AUD_STEP_CD = #{audStepCd}
     	   AND AA.DOC_ID = #{docId}
     	</if>
     	<if test=" 'Y'.toString() == onlyDocIdParam " >
         	AND AA.DOC_ID = #{docId}
         	ORDER BY F.AUD_STEP_CD DESC
         ) T
         WHERE ROWNUM=1
      </if>   
	</select>
	 
	<select id="selectExprPrbCnt" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectExprPrbCnt*/
		SELECT COUNT(EXPT_PRB_SNO) 
		  FROM TBBADDED144M
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   AND AUD_STEP_CD = #{audStepCd} /*A1030*/
	</select>	 

	<select id="selectAffCnt" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAffCnt*/
		SELECT COUNT(AFF_SNO) 
		  FROM TBBADDED145M
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   AND AUD_STEP_CD = #{audStepCd}	/*A1050*/
	</select>	 
	
	<select id="selectDspRqCnt" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectDspRqCnt*/
		SELECT COUNT(DSP_RQ_SNO) 
		  FROM TBBADDED146M
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   AND AUD_STEP_CD = #{audStepCd}	/*A1050*/
	</select>	 
	 
	<select id="selectAffMppCnt" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAffMppCnt*/
		SELECT COUNT(MPP_SEQ) 
		  FROM TBBADDED147M
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   AND AUD_STEP_CD = #{audStepCd} /*A1030, A1050*/
	</select>	
	
	<select id="selectAffMppGbnCnt" parameterType="paramMap" resultType="int">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAffMppGbnCnt*/
		SELECT COUNT(AFF_DVSN_SEQ) 
		  FROM TBBADDED148M
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   AND AUD_STEP_CD = #{audStepCd} /*A1050*/
	</select>			 
	 
    <update id="updateExprPrbDocId" parameterType="paramMap">
    	DECLARE
    		BEGIN
	        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateExprPrbDocId*/
			UPDATE TBBADDED144M
			     SET DOC_ID 		= #{docId}
			     	, FNL_USR_ID	= #{usrId}
			     	, FNL_DEAL_DPT_CD	= #{dptCd}
			     	, FNL_MNU_ID	= #{menuNo}
			     	, FNL_MDF_DH	= SYSDATE
			WHERE AUD_YR = #{audYr}
			   AND AUD_NO = #{audNo}
			   AND AUD_STEP_CD = #{audStepCd}	/*A1030*/
			;
            /*TBBADDED144HInsert*/    
			INSERT INTO TBBADDED144H
				(
					  HST_DVSN_CD
					, HST_SNO
					, HST_DH
					, HST_USR_ID				
					, AUD_YR
					, AUD_NO
					, AUD_STEP_CD
					, DOC_ID
					, EXPT_PRB_SNO
					, AUD_KND_CD
					, AUD_GRN_NO
					, RPRT_FILD_ID
					, EXPT_PRB_CD
					, EXPT_PRB_NM
					, SORT_SNO
					, FRT_USR_ID
					, FNL_USR_ID
					, FNL_DEAL_DPT_CD
					, FNL_MNU_ID
					, FRT_REGI_DH
					, FNL_MDF_DH	
				)
					SELECT  'U'
						 	 , TBBADDED144H_SEQ.NEXTVAL
						 	 , SYSDATE
						 	 , #{usrId} 
						     , AUD_YR
							 , AUD_NO
							 , AUD_STEP_CD
							 , DOC_ID
							 , EXPT_PRB_SNO
							 , AUD_KND_CD
							 , AUD_GRN_NO
							 , RPRT_FILD_ID
							 , EXPT_PRB_CD
							 , EXPT_PRB_NM
							 , SORT_SNO
							 , FRT_USR_ID
							 , FNL_USR_ID
							 , FNL_DEAL_DPT_CD
							 , FNL_MNU_ID
							 , FRT_REGI_DH
							 , FNL_MDF_DH
					  FROM TBBADDED144M
					 WHERE AUD_YR = #{audYr}
					   AND AUD_NO = #{audNo}
					   AND AUD_STEP_CD = #{audStepCd}
					;
            END;			
    </update>
    
    <update id="updateAffDocId" parameterType="paramMap">
    DECLARE
    	BEGIN
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateAffDocId*/
		UPDATE TBBADDED145M
		   SET DOC_ID 		= #{docId}
		     , FNL_USR_ID	= #{usrId}
		     , FNL_DEAL_DPT_CD	= #{dptCd}
		     , FNL_MNU_ID	= #{menuNo}
		     , FNL_MDF_DH	= SYSDATE
		WHERE AUD_YR = #{audYr}
		  AND AUD_NO = #{audNo}
		  AND AUD_STEP_CD = #{audStepCd}	/*A1050*/  
	;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , #{usrId}
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID
				 FROM TBBADDED145M
		         WHERE AUD_YR = #{audYr}
				   AND AUD_NO = #{audNo}
				   AND AUD_STEP_CD = #{audStepCd}	/*A1050*/  
				;
		END;              
    </update>
    
    <update id="updateDspRqDocId" parameterType="paramMap">
    DECLARE
    	BEGIN
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateDspRqDocId*/
		UPDATE TBBADDED146M
		   SET DOC_ID 		= #{docId}
		     , FNL_USR_ID	= #{usrId}
		     , FNL_DEAL_DPT_CD	= #{dptCd}
		     , FNL_MNU_ID	= #{menuNo}
		     , FNL_MDF_DH	= SYSDATE
		WHERE AUD_YR = #{audYr}
		  AND AUD_NO = #{audNo}
		  AND AUD_STEP_CD = #{audStepCd}	/*A1050*/  
		;  
		INSERT INTO TBBADDED146H
					(
					    HST_DVSN_CD
					  , HST_SNO
					  , HST_DH
					  , HST_USR_ID	
					  , AUD_YR
					  , AUD_NO
					  , AUD_STEP_CD 	
					  , DOC_ID 			
					  , APVR_CD 		
					  , AFF_SNO 		
					  , DSP_RQ_SNO 		
					  , DP_DSP_RQ_SNO 	
					  , AUD_KND_CD 		
					  , AUD_GRN_NO 		
					  , RPRT_FILD_ID 	
					  , AFF_DSP_CD 		
					  , RLTN_ORG_CD 	
					  , HND_ORG_CD 		
					  , REF_ORG_CD 		
					  , DSP_RQ_CD 		
					  , MTRL_IPT_DVSN_CD
					  , NOP_AM_DVSN_CD 	
					  , NOP_AM 			
					  , SORT_SNO		
					  , ACCN_INSP_CD	
					  , FNL_YN 			
					  , FRT_USR_ID 		
					  , FNL_USR_ID 		
					  , FNL_DEAL_DPT_CD 
					  , FNL_MNU_ID 		
					  , FRT_REGI_DH		
					  , FNL_MDF_DH 		
					  , NOP_SUM 		
					  , HD_AUD_STEP_CD 	
					  , HD_DOC_ID		
					  , HD_APVR_CD		
					  , HD_AFF_SNO 		
					  , HD_DSP_RQ_SNO	
					  , REF_DOC_ID 		
					  , DF_AUD_STEP_CD 	
					  , DF_DOC_ID 		
					  , DF_APVR_CD 		
					  , DF_AFF_SNO		
					  , DF_DSP_RQ_SNO 	
					  , KYWD1			
					  , KYWD2 			
					  , KYWD3 			
					  , KYWD4			
					  , KYWD5			
					)
				SELECT 'U'
				 	 , TBBADDED146H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , #{usrId}
					 , AUD_YR
					 , AUD_NO
					 , AUD_STEP_CD 	
					 , DOC_ID 			
					 , APVR_CD 		
					 , AFF_SNO 		
					 , DSP_RQ_SNO 		
					 , DP_DSP_RQ_SNO 	
					 , AUD_KND_CD 		
					 , AUD_GRN_NO 		
					 , RPRT_FILD_ID 	
					 , AFF_DSP_CD 		
					 , RLTN_ORG_CD 	
					 , HND_ORG_CD 		
					 , REF_ORG_CD 		
					 , DSP_RQ_CD 		
					 , MTRL_IPT_DVSN_CD
					 , NOP_AM_DVSN_CD 	
					 , NOP_AM 			
					 , SORT_SNO		
					 , ACCN_INSP_CD	
					 , FNL_YN 			
					 , FRT_USR_ID 		
					 , FNL_USR_ID 		
					 , FNL_DEAL_DPT_CD 
					 , FNL_MNU_ID 		
					 , FRT_REGI_DH		
					 , FNL_MDF_DH 		
					 , NOP_SUM 		
					 , HD_AUD_STEP_CD 	
					 , HD_DOC_ID		
					 , HD_APVR_CD		
					 , HD_AFF_SNO 		
					 , HD_DSP_RQ_SNO	
					 , REF_DOC_ID 		
					 , DF_AUD_STEP_CD 	
					 , DF_DOC_ID 		
					 , DF_APVR_CD 		
					 , DF_AFF_SNO		
					 , DF_DSP_RQ_SNO 	
					 , KYWD1			
					 , KYWD2 			
					 , KYWD3 			
					 , KYWD4			
					 , KYWD5
				 FROM TBBADDED146M
				WHERE AUD_YR = #{audYr}
				  AND AUD_NO = #{audNo}
				  AND AUD_STEP_CD = #{audStepCd}	/*A1050*/  
				;
		END;		                          		  
    </update>	  
    
    <update id="updateAffMppDocId" parameterType="paramMap">
    DECLARE
    	BEGIN
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateAffMppDocId*/
		UPDATE TBBADDED147M
		   SET DOC_ID 		= #{docId}
		     , FNL_USR_ID	= #{usrId}
		     , FNL_DEAL_DPT_CD	= #{dptCd}
		     , FNL_MNU_ID	= #{menuNo}
		     , FNL_MDF_DH	= SYSDATE
		WHERE AUD_YR = #{audYr}
		  AND AUD_NO = #{audNo}
		  AND AUD_STEP_CD = #{audStepCd}	/*A1030,A1050*/  
		  ;
        INSERT INTO TBBADDED147H
        			(
        			    HST_DVSN_CD
					  , HST_SNO
					  , HST_DH
					  , HST_USR_ID	
                      , AUD_YR
                      , AUD_NO
                      , AUD_STEP_CD
                      , APVR_CD
                      , AUD_KND_CD
                      , PRE_AFF_NO
                      , AFF_NO
                      , AFF_SNO
                      , DSP_RQ_SNO
                      , DOC_ID
                      , MPP_SEQ
                      , SORT_SNO
                      , RPRT_FILD_ID
                      , FRT_USR_ID
                      , FNL_USR_ID
                      , FNL_DEAL_DPT_CD
                      , FNL_MNU_ID
                      , FRT_REGI_DH
                      , FNL_MDF_DH
                     )
					SELECT 'U'
						 	 , TBBADDED147H_SEQ.NEXTVAL
						 	 , SYSDATE
						 	 , #{usrId}
		                     , AUD_YR
		                     , AUD_NO
		                     , AUD_STEP_CD
		                     , APVR_CD
		                     , AUD_KND_CD
		                     , PRE_AFF_NO
		                     , AFF_NO
		                     , AFF_SNO
		                     , DSP_RQ_SNO
		                     , DOC_ID
		                     , MPP_SEQ
		                     , SORT_SNO
		                     , RPRT_FILD_ID
		                     , FRT_USR_ID
		                     , FNL_USR_ID
		                     , FNL_DEAL_DPT_CD
		                     , FNL_MNU_ID
		                     , FRT_REGI_DH
		                     , FNL_MDF_DH
					  FROM TBBADDED147M
					 WHERE AUD_YR = #{audYr}
					   AND AUD_NO = #{audNo}
					   AND AUD_STEP_CD = #{audStepCd}
					 ;
            END;		  
    </update>	  
    
    <update id="updateAffMppGbnDocId" parameterType="paramMap">
    DECLARE
    	BEGIN
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateAffMppGbnDocId*/
		UPDATE TBBADDED148M
		   SET DOC_ID 		= #{docId}
		     , FNL_USR_ID	= #{usrId}
		     , FNL_DEAL_DPT_CD	= #{dptCd}
		     , FNL_MNU_ID	= #{menuNo}
		     , FNL_MDF_DH	= SYSDATE
		WHERE AUD_YR = #{audYr}
		  AND AUD_NO = #{audNo}
		  AND AUD_STEP_CD = #{audStepCd}	/*A1050*/  
		;
   		 INSERT INTO TBBADDED148H
        			(
        			    HST_DVSN_CD
					  , HST_SNO
					  , HST_DH
					  , HST_USR_ID	
					  , AUD_YR 		
					  , AUD_NO 		
					  , AUD_STEP_CD 
					  , DOC_ID		
					  , APVR_CD 	
					  , AFF_SNO 	
					  , DSP_RQ_SNO 	
					  , MPP_SEQ 	
					  , AFF_DVSN_SEQ 
					  , PRE_AFF_NO 	
					  , AFF_NO 		
					  , AFF_MPP_DVSN_CD
					  , PRE_DSP_RQ_CD 
					  , DSP_RQ_CD 	
					  , MPP_RSN 	
					  , FRT_USR_ID 	
					  , FNL_USR_ID 	
					  , FNL_DEAL_DPT_CD
					  , FNL_MNU_ID 	
					  , FRT_REGI_DH 
					  , FNL_MDF_DH 	
                     )
					SELECT 'U'
						 , TBBADDED148H_SEQ.NEXTVAL
						 , SYSDATE
						 , #{usrId}
						 , AUD_YR 		
						 , AUD_NO 		
						 , AUD_STEP_CD 
						 , DOC_ID		
						 , APVR_CD 	
						 , AFF_SNO 	
						 , DSP_RQ_SNO 	
						 , MPP_SEQ 	
						 , AFF_DVSN_SEQ 
						 , PRE_AFF_NO 	
						 , AFF_NO 		
						 , AFF_MPP_DVSN_CD
						 , PRE_DSP_RQ_CD 
						 , DSP_RQ_CD 	
						 , MPP_RSN 	
						 , FRT_USR_ID 	
						 , FNL_USR_ID 	
						 , FNL_DEAL_DPT_CD
						 , FNL_MNU_ID 	
						 , FRT_REGI_DH 
						 , FNL_MDF_DH 	
					  FROM TBBADDED148M
					WHERE AUD_YR = #{audYr}
					  AND AUD_NO = #{audNo}
					  AND AUD_STEP_CD = #{audStepCd}	/*A1050*/  
		            ;
		      END;
    </update>	 
    
    <select id="selectExtnPrdCofmDt" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectExtnPrdCofmDt*/
			 SELECT (SELECT NVL(A.EXTN_PRD_COFM_DT,0)
			           FROM TBBADDED003M A
			          WHERE A.AUD_YR = #{audYr}
			            AND A.AUD_NO = #{audNo} ) AS EXTN_PRD_COFM_DT
    		   FROM DUAL
			]]>
    </select>   
    
    <update id="callPrcBADDED003M3" parameterType="paramMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.callPrcBADDED003M3 */
           CALL PRC_EXTN_HNDL_DDLN( #{audYr}
                                   , #{audNo}
                                   , #{extnPrdCofmDt}
                                   , #{gnrHndlPlanYn}
                                   , #{usrId}
                                   , #{dptCd}
                                   , #{menuNo}
                                   )
        ]]>
    </update>
    
     <resultMap type="java.util.HashMap" id="opinBasicMap">
        <result property="audSbjNm"             column="AUD_SBJ_NM"          jdbcType="VARCHAR"    javaType="java.lang.String" />
        <result property="dptNm"                column="DPT_NM"              jdbcType="VARCHAR"    javaType="java.lang.String" />
        <result property="titleNm"              column="TITLE_NM"            jdbcType="VARCHAR"    javaType="java.lang.String" />
        <result property="opinNm"               column="OPIN_NM"             jdbcType="VARCHAR"    javaType="java.lang.String" />
        <result property="opinNoYn"             column="OPIN_NO_YN"          jdbcType="VARCHAR"    javaType="java.lang.String" />
        <result property="opinTxt"              column="OPIN_TXT"            jdbcType="CLOB"       javaType="java.lang.String" />
        <result property="examCluDvsnCd"        column="EXAM_CLU_DVSN_CD"    jdbcType="VARCHAR"    javaType="java.lang.String" />
        <result property="audRprtNumTxt"        column="AUD_RPRT_NUM_TXT"    jdbcType="VARCHAR"    javaType="java.lang.String" />
    </resultMap> 
    
    <select id="selectOpinBaiscInfo" parameterType="paramMap" resultMap="opinBasicMap">
    <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpinBaiscInfo */
        SELECT T3.AUD_SBJ_NM,  --감사사항명
                 F_DPT_INFO(T3.MNG_DPT_CD, '1') AS DPT_NM, --주관부서
                 ]]>
                 <if test=" 'Y'.toString() == ovrOpinYn ">
                 '감사품질담당관 종합의견' AS  TITLE_NM,
                 </if>
                 <if test=" 'N'.toString() == ovrOpinYn ">
                 T2.TITLE_NM||' '||-- 제목(처분요구종류)
                 '('||NVL((SELECT AGGR_CONCAT(F_CODE_NM('1000002', A.DSP_RQ_CD)||COUNT(1), ',' ORDER BY A.DSP_RQ_CD) 
                   FROM TBBADDED146M A
                  WHERE T1.AUD_YR = A.AUD_YR
                     AND T1.AUD_NO = A.AUD_NO
                     AND T1.AUD_STEP_CD =  A.AUD_STEP_CD
                     AND T1.APVR_CD = A.APVR_CD
                     AND T1.DOC_ID = A.DOC_ID
                     AND T1.AFF_SNO  =A.AFF_SNO
                    AND T1.RPRT_FILD_ID = A.RPRT_FILD_ID
                 GROUP BY A.DSP_RQ_CD),'종합의견')||')' AS TITLE_NM,
                 </if>
                  <![CDATA[ 
                 NVL(OPIN_NO_YN, 'N') AS OPIN_NO_YN,
                  '(감사품질담당관 '||F_USR_INFO(T1.CNB,'2') ||')'||DECODE(T1.OPIN_NO_YN, 'Y',  CHR(13)|| '의견없음', '') AS OPIN_NM,
                  T4.OPIN_TXT,
                  T4.EXAM_CLU_DVSN_CD,
                  T4.AUD_RPRT_NUM_TXT 
        FROM TBBADDED141M T1 
        ]]>
        <if test=" 'N'.toString() == ovrOpinYn ">
        LEFT OUTER JOIN TBBADDED145M T2
                 ON T1.AUD_YR = T2.AUD_YR
                AND T1.AUD_NO = T2.AUD_NO
                AND T1.AUD_STEP_CD =  T2.AUD_STEP_CD
                AND T1.APVR_CD = T2.APVR_CD
                AND T1.DOC_ID = T2.DOC_ID
                AND T1.AFF_SNO  =T2.AFF_SNO
                AND T1.RPRT_FILD_ID = T2.RPRT_FILD_ID
        </if>
        <![CDATA[ 
        INNER JOIN TBBADDED001M T3
                 ON T1.AUD_YR = T3.AUD_YR 
                AND T1.AUD_NO = T3.AUD_NO
        INNER JOIN TBBADDED140M T5
                  ON T1.AUD_YR = T5.AUD_YR
                 AND T1.AUD_NO = T5.AUD_NO
                 AND T1.AUD_STEP_CD = T5.AUD_STEP_CD
                 AND T1.DOC_ID = T5.DOC_ID
                 AND ALLOC_CMPL_YN  ='Y'
        LEFT OUTER JOIN TBBADDED142D T4
                        ON T1.AUD_YR = T4.AUD_YR
                       AND T1.AUD_NO = T4.AUD_NO
                       AND T1.AUD_STEP_CD =  T4.AUD_STEP_CD
                       AND T1.APVR_CD = T4.APVR_CD
                       AND T1.AFF_SNO  =T4.AFF_SNO
                       AND T1.RPRT_FILD_ID = T4.RPRT_FILD_ID
                       AND T1.OPIN_DOC_ID = T4.DOC_ID
                       AND T4.RPRT_CD = 'A10600510'
         WHERE T1.AUD_YR = #{audYr}
           AND T1.AUD_NO = #{audNo}
           AND T1.RPRT_FILD_ID = #{rprtFildId} 
           AND T1.APVR_CD IN ('0015800', '0035100', '0058100')
        ]]>
             <if test=" refDocId != null and refDocId != '' ">
           AND T1.DOC_ID  = (SELECT CASE WHEN D1.RPRT_CD != 'A10600200' THEN D1.REF_DOC_ID  
                                	ELSE #{refDocId}   END
                               FROM TBBADDED103M D1 
                              WHERE D1.AUD_YR = #{audYr}
                                AND D1.AUD_NO = #{audNo}
                                AND D1.DOC_ID = #{refDocId}  )
            </if>
    </select>
    
    <delete id="deleteBADDED142M" parameterType="paramMap">
     /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.deleteBADDED142M*/
      <![CDATA[
         DELETE TBBADDED142M T1
         WHERE T1.AUD_YR = #{audYr}
            AND T1.AUD_NO = #{audNo}
            AND T1.RPRT_CD = #{rprtCd}
            AND T1.RPRT_FILD_ID = #{rprtFildId} 
            AND T1.DOC_ID = #{docId}
         ]]>
    </delete>
    
    <update id="updateBADDED141M" parameterType="paramMap">
     /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.deleteBADDED142M*/
      <![CDATA[
         UPDATE TBBADDED141M T1
          SET OPIN_DOC_ID = #{docId}
         WHERE T1.AUD_YR = #{audYr}
            AND T1.AUD_NO = #{audNo}
            AND T1.RPRT_FILD_ID = #{rprtFildId}
            AND T1.DOC_ID  = (SELECT T2.REF_DOC_ID FROM TBBADDED103M T2 WHERE T2.AUD_YR = #{audYr} AND T2.AUD_NO = #{audNo} AND T2.DOC_ID =#{docId} )
         ]]>
    </update>
    
    <insert id="insertBADDED142M" parameterType="paramMap">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBADDED142M*/
     <![CDATA[
        INSERT INTO TBBADDED142M(
                                 AUD_YR,
                                 AUD_NO,
                                 AUD_STEP_CD,
                                 RPRT_CD,
                                 DOC_ID,
                                 APVR_CD,
                                 AFF_SNO,
                                 CNB,
                                 AUD_SBJ_NM_TXT,
                                 DPT_NM_TXT,
                                 AUD_RPRT_NUM_TXT,
                                 TITLE_NM_TXT,
                                 RPRT_FILD_ID,
                                 FRT_USR_ID,
                                 FNL_USR_ID,
                                 FNL_DEAL_DPT_CD,
                                 FNL_MNU_ID,
                                 FRT_REGI_DH,
                                 FNL_MDF_DH)
                       SELECT  T1.AUD_YR,
                                 T1.AUD_NO,
                                 T1.AUD_STEP_CD,
                                 #{rprtCd},
                                 #{docId},
                                 T1.APVR_CD,
                                 T1.AFF_SNO,
                                 T1.CNB,
                                 #{audSbjNmTxt},
                                 #{dptNmTxt},
                                 #{audRprtNumTxt}, 
                                 #{titleNmTxt},
                                 T1.RPRT_FILD_ID,
                                 #{usrId},    /*세션정보*/
                                 #{usrId},
                                 #{dptCd},
                                 #{menuNo},
                                 SYSDATE,
                                 SYSDATE
                         FROM TBBADDED141M T1
                       WHERE T1.AUD_YR = #{audYr}
                          AND T1.AUD_NO = #{audNo}
                          AND T1.RPRT_FILD_ID = #{rprtFildId}
                          AND T1.DOC_ID  = (SELECT T2.REF_DOC_ID FROM TBBADDED103M T2 WHERE T2.AUD_YR = #{audYr}AND T2.AUD_NO = #{audNo} AND T2.DOC_ID =#{docId} )
            ]]>
    </insert>
    
    <select id="selectOpinDocList" parameterType="paramMap" resultType="egovMap">
     /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpinDocList*/
      <![CDATA[
        SELECT T3.DOC_ID, 
                   CASE WHEN LEAD(T5.AUD_RPRT_DVSN_CD) OVER(ORDER BY T5.AUD_RPRT_DVSN_CD, T3.RPRT_CD) = '40' THEN '('||F_CODE_NM('1000788' ,T5.AUD_RPRT_DVSN_CD)||'-개별 검토의견)'||T3.RPRT_NM
                        WHEN T5.AUD_RPRT_DVSN_CD = '40' THEN '('||F_CODE_NM('1000788' ,T5.AUD_RPRT_DVSN_CD)||'-개별 검토의견)'||T3.RPRT_NM
                        WHEN (SELECT T2.AUD_RPRT_DVSN_CD 
                                  FROM TBBADDED103M T2 
                                WHERE T2.AUD_YR = '2020' 
                                   AND T2.AUD_NO = '296' 
                                   AND T2.DOC_ID =  (SELECT CASE WHEN D1.RPRT_CD != 'A10600200' THEN D1.REF_DOC_ID  
                                                                             ELSE  'f0f9dce9-3465-11eb-986e-671cf86eb020'  END
                                                             FROM TBBADDED103M D1 
                                                            WHERE D1.AUD_YR = '2020' 
                                                              AND D1.AUD_NO = '296' 
                                                              AND D1.DOC_ID = 'f0f9dce9-3465-11eb-986e-671cf86eb020' ))  = '40' 
                                 THEN '('||F_CODE_NM('1000788' ,T5.AUD_RPRT_DVSN_CD)||'-개별 검토의견)'||T3.RPRT_NM
                        ELSE '(개별-검토의견)'||T3.RPRT_NM END AS RPRT_NM,
                   T3.RPRT_CD,
                   'Y' AS DOC_WRT_YN,
                   NVL(T1.OPIN_NO_YN, 'N') AS  OPIN_NO_YN,
                   T5.AUD_RPRT_DVSN_CD,
                   T1.DOC_ID AS REF_DOC_ID,
                   T1.OVR_OPIN_YN
           FROM TBBADDED141M T1
                   INNER JOIN TBBADDED103M T3
                           ON T1.AUD_YR = T3.AUD_YR
                          AND T1.AUD_NO = T3.AUD_NO
                          AND T1.AUD_STEP_CD =  T3.AUD_STEP_CD
                          AND T3.DOC_ID = T1.OPIN_DOC_ID
                          AND T3.RPRT_CD = 'A10600510'
                   INNER JOIN TBBADDED140M T4
                           ON T1.AUD_YR = T4.AUD_YR
                          AND T1.AUD_NO = T4.AUD_NO
                          AND T1.DOC_ID = T4.DOC_ID
                    INNER JOIN TBBADDED103M T5
                            ON T5.AUD_YR = T1.AUD_YR
                           AND T5.AUD_NO = T1.AUD_NO
                           AND T5.DOC_ID = T1.DOC_ID
            WHERE T1.AUD_YR=  #{audYr}
               AND T1.AUD_NO = #{audNo}
               AND T1.RPRT_FILD_ID = #{rprtFildId}
               AND T4.OPIN_SND_YN = 'Y' 
               AND T3.REF_DOC_ID = #{currDocId}
              ]]>
         <if test=" 'N' .toString() == opinNoYn ">
         <![CDATA[
           UNION ALL
           SELECT  A.DOC_ID 
                    ,CASE WHEN LEAD(A.AUD_RPRT_DVSN_CD) OVER (ORDER BY A.AUD_RPRT_DVSN_CD, A.RPRT_CD) = '40' THEN '('||F_CODE_NM('1000788' ,A.AUD_RPRT_DVSN_CD)||')'||A.RPRT_NM
                            WHEN A.AUD_RPRT_DVSN_CD = '40' THEN '('||F_CODE_NM('1000788' ,A.AUD_RPRT_DVSN_CD)||')'||A.RPRT_NM
                            WHEN (SELECT T2.AUD_RPRT_DVSN_CD 
                                      FROM TBBADDED103M T2
                                     WHERE T2.AUD_YR = #{audYr} 
                                        AND T2.AUD_NO = #{audNo} 
                                        AND T2.DOC_ID =  (SELECT CASE WHEN D1.RPRT_CD != 'A10600200' THEN D1.REF_DOC_ID  
                                                                                  ELSE  #{currDocId}  END
                                                                          FROM TBBADDED103M D1 
                                                                        WHERE D1.AUD_YR =  #{audYr} 
                                                                           AND D1.AUD_NO = #{audNo} 
                                                                           AND D1.DOC_ID = #{currDocId} ) )  = '40'  THEN '('||F_CODE_NM('1000788' ,A.AUD_RPRT_DVSN_CD)||')'||A.RPRT_NM
                              ELSE A.RPRT_NM END AS RPRT_NM
                    ,A.RPRT_CD
                    ,A.DOC_WRT_YN
                    ,A.OPIN_NO_YN
                    ,A.AUD_RPRT_DVSN_CD
                    ,A.REF_DOC_ID
                    ,'N' AS OVR_OPIN_YN
             FROM (
                      SELECT  T1.DOC_ID
                               , '(개별-검토보고)'||T1.RPRT_NM AS RPRT_NM  
                               , T1.RPRT_CD
                               , CASE WHEN T1.DOC_ID IS NULL THEN 'N' ELSE 'Y' END AS DOC_WRT_YN
                               , 'N' AS OPIN_NO_YN
                               , (SELECT T3.AUD_RPRT_DVSN_CD
                                   FROM TBBADDED103M T3
                                 WHERE T1.AUD_YR = T3.AUD_YR
                                    AND T1.AUD_NO = T3.AUD_NO
                                    AND T1.REF_DOC_ID = T3.DOC_ID) AS AUD_RPRT_DVSN_CD
                               , T1.REF_DOC_ID 
                       FROM TBBADDED103M T1
                                INNER JOIN TBBADDED142M T2
                                           ON T1.AUD_YR = T2.AUD_YR
                                         AND T1.AUD_NO = T2.AUD_NO
                                         AND T1.DOC_ID = T2.DOC_ID
                                         AND T1.RPRT_CD = T2.RPRT_CD
                    WHERE T1.AUD_YR=  #{audYr}
                       AND T1.AUD_NO = #{audNo}
                       AND T1.RPRT_CD= 'A10600530'
                       AND T2.RPRT_FILD_ID = #{rprtFildId}
                       AND T1.REF_DOC_ID = #{currDocId}
        ]]>
             <if test=" 'Y' .toString() == opinRprtTmpYn ">
             <![CDATA[
                  UNION ALL
                 SELECT DECODE((SELECT T2.DOC_WRIT_KND_CD 
                                       FROM TBBADDED001M T2
                                      WHERE T2.AUD_YR  =#{audYr}
                                         AND T2.AUD_NO = #{audNo}), '10' , T1.DOC_ID, T1.HWP_DOC_ID) AS DOC_ID, 
                          '(개별-검토보고-작성필요)'||T1.DTIL_AUD_DOC_NM  AS RPRT_NM,
                          T1.AUD_DOC_CD,
                          'N' AS DOC_WRT_YN,
                          'N' AS OPIN_NO_YN,
                          (SELECT T2.AUD_RPRT_DVSN_CD
                            FROM TBBADDED103M T2
                           WHERE T2.AUD_YR = #{audYr}
                              AND T2.AUD_NO = #{audNo}
                              AND T2.DOC_ID =  #{currDocId} ) AS AUD_RPRT_DVSN_CD,
                          #{currDocId} AS REF_DOC_ID
                  FROM TBFDMADM002M T1
                 WHERE T1.AUD_DOC_CD = 'A10600530'
             ]]>
             </if>
             ) A
       </if>
        <![CDATA[
       UNION ALL
        SELECT T3.DOC_ID, 
                   CASE WHEN LEAD(T5.AUD_RPRT_DVSN_CD) OVER(ORDER BY T5.AUD_RPRT_DVSN_CD, T3.RPRT_CD) = '40' THEN '('||F_CODE_NM('1000788' ,T5.AUD_RPRT_DVSN_CD)||'-종합 검토의견)'||T3.RPRT_NM
                        WHEN T5.AUD_RPRT_DVSN_CD = '40' THEN '('||F_CODE_NM('1000788' ,T5.AUD_RPRT_DVSN_CD)||'-종합 검토의견)'||T3.RPRT_NM
                        WHEN (SELECT T2.AUD_RPRT_DVSN_CD 
                                  FROM TBBADDED103M T2 
                                WHERE T2.AUD_YR = '2020' 
                                   AND T2.AUD_NO = '296' 
                                   AND T2.DOC_ID =  (SELECT CASE WHEN D1.RPRT_CD != 'A10600200' THEN D1.REF_DOC_ID  
                                                                             ELSE  'f0f9dce9-3465-11eb-986e-671cf86eb020'  END
                                                             FROM TBBADDED103M D1 
                                                            WHERE D1.AUD_YR = '2020' 
                                                              AND D1.AUD_NO = '296' 
                                                              AND D1.DOC_ID = 'f0f9dce9-3465-11eb-986e-671cf86eb020' ))  = '40' 
                                 THEN '('||F_CODE_NM('1000788' ,T5.AUD_RPRT_DVSN_CD)||'-종합 검토의견)'||T3.RPRT_NM
                        ELSE '(종합-검토의견)'||T3.RPRT_NM END AS RPRT_NM,
                   T3.RPRT_CD,
                   'Y' AS DOC_WRT_YN,
                   NVL(T1.OPIN_NO_YN, 'N') AS  OPIN_NO_YN,
                   T5.AUD_RPRT_DVSN_CD,
                   T1.DOC_ID AS REF_DOC_ID,
                   T1.OVR_OPIN_YN
           FROM TBBADDED141M T1
                   INNER JOIN TBBADDED103M T3
                           ON T1.AUD_YR = T3.AUD_YR
                          AND T1.AUD_NO = T3.AUD_NO
                          AND T1.AUD_STEP_CD =  T3.AUD_STEP_CD
                          AND T3.DOC_ID = T1.OPIN_DOC_ID
                          AND T3.RPRT_CD = 'A10600510'
                   INNER JOIN TBBADDED140M T4
                           ON T1.AUD_YR = T4.AUD_YR
                          AND T1.AUD_NO = T4.AUD_NO
                          AND T1.DOC_ID = T4.DOC_ID
                    INNER JOIN TBBADDED103M T5
                            ON T5.AUD_YR = T1.AUD_YR
                           AND T5.AUD_NO = T1.AUD_NO
                           AND T5.DOC_ID = T1.DOC_ID
            WHERE T1.AUD_YR=  #{audYr}
               AND T1.AUD_NO = #{audNo}
               AND T1.RPRT_FILD_ID = '000000000000000000'
               AND T4.OPIN_SND_YN = 'Y' 
               AND T1.DOC_ID = (SELECT CASE WHEN D1.RPRT_CD != 'A10600200' THEN D1.REF_DOC_ID  
                                                                                  ELSE  #{currDocId}  END
                                                                          FROM TBBADDED103M D1 
                                                                        WHERE D1.AUD_YR =  #{audYr} 
                                                                           AND D1.AUD_NO = #{audNo} 
                                                                           AND D1.DOC_ID = #{currDocId} )
            ]]>
           <if test=" 'N' .toString() == opinOvrNoYn ">
           <![CDATA[
            UNION ALL
           SELECT  A.DOC_ID 
                    ,CASE WHEN LEAD(A.AUD_RPRT_DVSN_CD) OVER (ORDER BY A.AUD_RPRT_DVSN_CD, A.RPRT_CD) = '40' THEN '('||F_CODE_NM('1000788' ,A.AUD_RPRT_DVSN_CD)||')'||A.RPRT_NM
                            WHEN A.AUD_RPRT_DVSN_CD = '40' THEN '('||F_CODE_NM('1000788' ,A.AUD_RPRT_DVSN_CD)||')'||A.RPRT_NM
                            WHEN (SELECT T2.AUD_RPRT_DVSN_CD 
                                      FROM TBBADDED103M T2
                                     WHERE T2.AUD_YR = #{audYr} 
                                        AND T2.AUD_NO = #{audNo} 
                                        AND T2.DOC_ID =  (SELECT CASE WHEN D1.RPRT_CD != 'A10600200' THEN D1.REF_DOC_ID  
                                                                                  ELSE  #{currDocId}  END
                                                                          FROM TBBADDED103M D1 
                                                                        WHERE D1.AUD_YR =  #{audYr} 
                                                                           AND D1.AUD_NO = #{audNo} 
                                                                           AND D1.DOC_ID = #{currDocId} ) )  = '40'  THEN '('||F_CODE_NM('1000788' ,A.AUD_RPRT_DVSN_CD)||')'||A.RPRT_NM
                              ELSE A.RPRT_NM END AS RPRT_NM
                    ,A.RPRT_CD
                    ,A.DOC_WRT_YN
                    ,A.OPIN_NO_YN
                    ,A.AUD_RPRT_DVSN_CD
                    ,A.REF_DOC_ID
                    ,'Y' AS OVR_OPIN_YN
             FROM (
                      SELECT  T1.DOC_ID
                               , '(종합-검토보고)'||T1.RPRT_NM AS RPRT_NM  
                               , T1.RPRT_CD
                               , CASE WHEN T1.DOC_ID IS NULL THEN 'N' ELSE 'Y' END AS DOC_WRT_YN
                               , 'N' AS OPIN_NO_YN
                               , (SELECT T3.AUD_RPRT_DVSN_CD
                                   FROM TBBADDED103M T3
                                 WHERE T1.AUD_YR = T3.AUD_YR
                                    AND T1.AUD_NO = T3.AUD_NO
                                    AND T1.REF_DOC_ID = T3.DOC_ID) AS AUD_RPRT_DVSN_CD
                               , T1.REF_DOC_ID 
                       FROM TBBADDED103M T1
                                INNER JOIN TBBADDED142M T2
                                           ON T1.AUD_YR = T2.AUD_YR
                                         AND T1.AUD_NO = T2.AUD_NO
                                         AND T1.DOC_ID = T2.DOC_ID
                                         AND T1.RPRT_CD = T2.RPRT_CD
                    WHERE T1.AUD_YR=  #{audYr}
                       AND T1.AUD_NO = #{audNo}
                       AND T1.RPRT_CD= 'A10600530'
                       AND T2.RPRT_FILD_ID = '000000000000000000'
                       AND T1.REF_DOC_ID = (SELECT CASE WHEN D1.RPRT_CD != 'A10600200' THEN D1.REF_DOC_ID  
                                                                                  ELSE  #{currDocId}  END
                                                                          FROM TBBADDED103M D1 
                                                                        WHERE D1.AUD_YR =  #{audYr} 
                                                                           AND D1.AUD_NO = #{audNo} 
                                                                           AND D1.DOC_ID = #{currDocId} )  ]]>
              <if test=" 'Y' .toString() == opinOvrRprtTmpYn ">
             <![CDATA[
                  UNION ALL
                 SELECT DECODE((SELECT T2.DOC_WRIT_KND_CD 
                                       FROM TBBADDED001M T2
                                      WHERE T2.AUD_YR  =#{audYr}
                                         AND T2.AUD_NO = #{audNo}), '10' , T1.DOC_ID, T1.HWP_DOC_ID) AS DOC_ID, 
                          '(종합-검토보고-작성필요)'||T1.DTIL_AUD_DOC_NM  AS RPRT_NM,
                          T1.AUD_DOC_CD,
                          'N' AS DOC_WRT_YN,
                          'N' AS OPIN_NO_YN,
                          (SELECT T2.AUD_RPRT_DVSN_CD
                            FROM TBBADDED103M T2
                           WHERE T2.AUD_YR = #{audYr}
                              AND T2.AUD_NO = #{audNo}
                              AND T2.DOC_ID =  #{currDocId} ) AS AUD_RPRT_DVSN_CD,
                          #{currDocId} AS REF_DOC_ID
                  FROM TBFDMADM002M T1
                 WHERE T1.AUD_DOC_CD = 'A10600530'
             ]]>
             </if>
                 ) A
           </if>
            ORDER BY AUD_RPRT_DVSN_CD, DECODE(OVR_OPIN_YN, 'Y', 0, 999),RPRT_CD 
            
    </select>
    
    <select id="selectOpinDocExistYn" parameterType="paramMap" resultType="egovMap">
     /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpinDocExistYn*/
      <![CDATA[
         SELECT NVL(T2.OPIN_NO_YN, 'N') AS OPIN_NO_YN
          FROM TBBADDED140M T1 
                  INNER JOIN TBBADDED141M T2
                            ON T1.AUD_YR = T2.AUD_YR
                          AND T1.AUD_NO = T2.AUD_NO
                          AND T1.DOC_ID = T2.DOC_ID     
          WHERE T1.AUD_YR=  #{audYr}
             AND T1.AUD_NO  =#{audNo}
             AND T2.RPRT_FILD_ID = #{rprtFildId}
             AND T1.OPIN_SND_YN = 'Y'
      ]]>
      </select>
    
    <select id="selectOpinDocCnt" parameterType="paramMap" resultType="java.lang.Integer">
     /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpinDocCnt*/
      <![CDATA[
            SELECT COUNT(*) AS CNT
             FROM TBBADDED141M T1 
                     INNER JOIN TBBADDED140M T4
                               ON T1.AUD_YR = T4.AUD_YR
                             AND T1.AUD_NO = T4.AUD_NO
                             AND T1.DOC_ID = T4.DOC_ID
          WHERE T1.AUD_YR=  #{audYr}
             AND T1.AUD_NO  =#{audNo}
             AND T1.RPRT_FILD_ID = #{rprtFildId}
             AND T4.OPIN_SND_YN = 'Y'
             AND T1.OPIN_NO_YN = 'N'
             AND T1.DOC_ID = #{currDocId}
      ]]>
      </select>
      
      <select id="selectOpinOvrDocCnt" parameterType="paramMap" resultType="java.lang.Integer">
     /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpinOvrDocCnt*/
      <![CDATA[
            SELECT COUNT(*) AS CNT
             FROM TBBADDED141M T1 
                     INNER JOIN TBBADDED140M T4
                               ON T1.AUD_YR = T4.AUD_YR
                             AND T1.AUD_NO = T4.AUD_NO
                             AND T1.DOC_ID = T4.DOC_ID
          WHERE T1.AUD_YR=  #{audYr}
             AND T1.AUD_NO  =#{audNo}
             AND T1.RPRT_FILD_ID = '000000000000000000'
             AND T4.OPIN_SND_YN = 'Y'
             AND T1.OPIN_NO_YN = 'N'
             AND T1.DOC_ID = #{currDocId}
      ]]>
      </select>
      
       <select id="selectOpinRptDocCnt" parameterType="paramMap" resultType="java.lang.Integer">
     /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpinRptDocCnt*/
      <![CDATA[
           SELECT COUNT(*) AS CNT
            FROM TBBADDED142M T1 
                    INNER JOIN TBBADDED103M T2
                              ON T1.AUD_YR = T2.AUD_YR
                             AND T1.AUD_NO = T2.AUD_NO
                             AND T1.DOC_ID = T2.DOC_ID
                            AND T1.RPRT_CD = T2.RPRT_CD
          WHERE T1.AUD_YR=  #{audYr}
             AND T1.AUD_NO  =#{audNo}
             AND T1.RPRT_FILD_ID = #{rprtFildId}
             AND T1.RPRT_CD = 'A10600530'
             AND T2.REF_DOC_ID = #{currDocId}
      ]]>
      </select>
      
        <select id="selectOpinOvrRptDocCnt" parameterType="paramMap" resultType="java.lang.Integer">
     /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpinOvrRptDocCnt*/
      <![CDATA[
           SELECT COUNT(*) AS CNT
            FROM TBBADDED142M T1 
                    INNER JOIN TBBADDED103M T2
                              ON T1.AUD_YR = T2.AUD_YR
                             AND T1.AUD_NO = T2.AUD_NO
                             AND T1.DOC_ID = T2.DOC_ID
                            AND T1.RPRT_CD = T2.RPRT_CD
          WHERE T1.AUD_YR=  #{audYr}
             AND T1.AUD_NO  =#{audNo}
             AND T1.RPRT_FILD_ID = '000000000000000000'
             AND T1.RPRT_CD = 'A10600530'
             AND T2.REF_DOC_ID = #{currDocId}
      ]]>
      </select>
      
      
      <resultMap type="java.util.HashMap"  id="opinAggrListMap">
        <result property="audSbjNm"            column="AUD_SBJ_NM_TXT"       jdbcType="VARCHAR"    javaType="java.lang.String" />
        <result property="dptNm"                column="DPT_NM_TXT"             jdbcType="VARCHAR"    javaType="java.lang.String" />
        <result property="audRprtNumTxt"         column="AUD_RPRT_NUM_TXT"   jdbcType="VARCHAR"    javaType="java.lang.String" />
        <result property="titleNm"                column="TITLE_NM_TXT"           jdbcType="VARCHAR"    javaType="java.lang.String" />
        <result property="opinTxt"                   column="OPIN_TXT"                 jdbcType="CLOB"         javaType="java.lang.String" />
        <result property="opinBrfTxt"                column="OPIN_BRF_TXT"           jdbcType="CLOB"         javaType="java.lang.String" />
        <result property="examCluDvsnCd"                column="EXAM_CLU_DVSN_CD"           jdbcType="VARCHAR"         javaType="java.lang.String" />
    </resultMap> 
    
    <select id="selectOpinAggrList" parameterType="paramMap" resultMap="opinAggrListMap">
    <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpinAggrList */
        SELECT ]]>
        <if test=" 'N' .toString() == allOpinNoYn  ">
        <![CDATA[ T2.AUD_SBJ_NM_TXT
                     ,T2.DPT_NM_TXT
                     ,T2.AUD_RPRT_NUM_TXT
                     ,T2.TITLE_NM_TXT
                     ,T2.OPIN_TXT
                     ,T2.OPIN_BRF_TXT
                     ,T1.OPIN_NO_YN
                     ,T1.OVR_OPIN_YN
                     ,T5.SORT_SNO
                     ,T5.AFF_SNO
                     ,T2.EXAM_CLU_DVSN_CD
       ]]>
       </if>
        <if test=" 'Y' .toString() == allOpinNoYn  ">
        <![CDATA[ T2.AUD_SBJ_NM_TXT
                     ,T2.DPT_NM_TXT
                     ,'' AS AUD_RPRT_NUM_TXT
                     ,'' AS TITLE_NM_TXT
                     ,TO_CLOB('의견없음') AS OPIN_TXT
                     ,TO_CLOB('') AS OPIN_BRF_TXT
                     ,T1.OPIN_NO_YN
                     ,T1.OVR_OPIN_YN
                     ,T5.SORT_SNO
                     ,T5.AFF_SNO
                     ,T2.EXAM_CLU_DVSN_CD
       ]]>
       </if>
              FROM TBBADDED141M T1 
                   INNER JOIN TBBADDED142D T2
                           ON T1.AUD_YR = T2.AUD_YR
                          AND T1.AUD_NO = T2.AUD_NO
                          AND T1.RPRT_FILD_ID = T2.RPRT_FILD_ID
                          <if test=" 'N' .toString() == allOpinNoYn  ">
                          AND T2.RPRT_CD = 'A10600530'
                          </if>
                          <if test=" 'Y' .toString() == allOpinNoYn  ">
                          AND T2.RPRT_CD = 'A10600510'
                          </if>
                   INNER JOIN TBBADDED103M T3
                           ON T1.AUD_YR = T3.AUD_YR
                          AND T1.AUD_NO = T3.AUD_NO
                          AND T1.AUD_STEP_CD = T3.AUD_STEP_CD
                          AND T1.DOC_ID = T3.REF_ID
                          AND T3.RPRT_CD = 'A10600540'
                   INNER JOIN TBBADDED103M T4
                           ON T1.AUD_YR = T4.AUD_YR
                          AND T1.AUD_NO = T4.AUD_NO
                          AND T1.AUD_STEP_CD = T4.AUD_STEP_CD 
                          AND T2.DOC_ID = T4.DOC_ID
                          AND T4.REF_DOC_ID = T1.DOC_ID
                   INNER JOIN TBBADDED145M T5
                            ON T1.AUD_YR = T5.AUD_YR
                          AND T1.AUD_NO = T5.AUD_NO
                          AND T1.AUD_STEP_CD = T5.AUD_STEP_CD 
                          AND T1.DOC_ID = T5.DOC_ID
                          AND T1.APVR_CD = T5.APVR_CD
                          AND T1.AFF_SNO = T5.AFF_SNO
              WHERE T1.AUD_YR=  #{audYr}
                AND T1.AUD_NO  =#{audNo}
                <if test=" 'N' .toString() == allOpinNoYn  ">
                 <![CDATA[
                AND NVL(T1.OPIN_NO_YN, 'N') <> 'Y'
                ]]>
                </if>
                AND T3.DOC_ID = #{docId}
                
                <if test=" 'Y' .toString() == allOpinNoYn  ">
                AND ROWNUM = 1
                </if>
                UNION ALL
          SELECT
        <if test=" 'N' .toString() == ovrOpinNoYn  ">
        <![CDATA[ T2.AUD_SBJ_NM_TXT
                     ,T2.DPT_NM_TXT
                     ,T2.AUD_RPRT_NUM_TXT
                     ,T2.TITLE_NM_TXT
                     ,T2.OPIN_TXT
                     ,T2.OPIN_BRF_TXT
                     ,T1.OPIN_NO_YN
                     ,T1.OVR_OPIN_YN
                      ,0 AS SORT_SNO
                      ,0 AS AFF_SNO
                      ,T2.EXAM_CLU_DVSN_CD
       ]]>
       </if>
        <if test=" 'Y' .toString() == ovrOpinNoYn  ">
        <![CDATA[ T2.AUD_SBJ_NM_TXT
                     ,T2.DPT_NM_TXT
                     ,'' AS AUD_RPRT_NUM_TXT
                     ,'' AS TITLE_NM_TXT
                     ,TO_CLOB('종합의견없음') AS OPIN_TXT
                     ,TO_CLOB('') AS OPIN_BRF_TXT
                     ,T1.OPIN_NO_YN
                     ,T1.OVR_OPIN_YN
                     ,0 AS SORT_SNO
                     ,0 AS AFF_SNO
                     ,T2.EXAM_CLU_DVSN_CD
       ]]>
       </if>
              FROM TBBADDED141M T1 
                   INNER JOIN TBBADDED142D T2
                           ON T1.AUD_YR = T2.AUD_YR
                          AND T1.AUD_NO = T2.AUD_NO
                          AND T1.RPRT_FILD_ID = T2.RPRT_FILD_ID
                          <if test=" 'N' .toString() == ovrOpinNoYn  ">
                          AND T2.RPRT_CD = 'A10600530'
                          </if>
                          <if test=" 'Y' .toString() == ovrOpinNoYn  ">
                          AND T2.RPRT_CD = 'A10600510'
                          </if>
                   INNER JOIN TBBADDED103M T3
                           ON T1.AUD_YR = T3.AUD_YR
                          AND T1.AUD_NO = T3.AUD_NO
                          AND T1.AUD_STEP_CD = T3.AUD_STEP_CD
                          AND T1.DOC_ID = T3.REF_ID
                          AND T3.RPRT_CD = 'A10600540'
                   INNER JOIN TBBADDED103M T4
                           ON T1.AUD_YR = T4.AUD_YR
                          AND T1.AUD_NO = T4.AUD_NO
                          AND T1.AUD_STEP_CD = T4.AUD_STEP_CD 
                          AND T2.DOC_ID = T4.DOC_ID
                          AND T4.REF_DOC_ID = T1.DOC_ID
              WHERE T1.AUD_YR=  #{audYr}
                AND T1.AUD_NO  =#{audNo}
                 AND T1.OVR_OPIN_YN = 'Y'
                <if test=" 'N' .toString() == ovrOpinNoYn  ">
                 <![CDATA[
                AND NVL(T1.OPIN_NO_YN, 'N') <> 'Y'
                ]]>
                </if>
                AND T3.DOC_ID = #{docId}
                
                <if test=" 'Y' .toString() == ovrOpinNoYn  ">
                AND ROWNUM = 1
                </if>
                ORDER BY AFF_SNO,EXAM_CLU_DVSN_CD
                <!-- ORDER BY  SORT_SNO, DECODE(TRIM(TRANSLATE( AUD_RPRT_NUM_TXT ,'0123456789', ' ')), NULL , LPAD(AUD_RPRT_NUM_TXT , 7, 0), AUD_RPRT_NUM_TXT )  ,AFF_SNO --> 
    </select>
    
    <select id="selectAllOpinNoYn" parameterType="paramMap" resultType="java.lang.Integer">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectAllOpinNoYn */
    <![CDATA[
    SELECT SUM(T4.CNT) AS CNT
          FROM TBBADDED103M T1 
               INNER JOIN (SELECT T1.AUD_YR, T1.AUD_NO, T2.DOC_ID,  SUM(DECODE(T1.OPIN_NO_YN, 'Y', 0, 1)) AS CNT
                             FROM TBBADDED141M T1 
                                  INNER JOIN TBBADDED145M T2 
                                          ON T1.AUD_YR = T2.AUD_YR
                                         AND T1.AUD_NO = T2.AUD_NO
                                         AND T2.APVR_CD IN ('0015800', '0035100', '0058100')
                                         AND T1.RPRT_FILD_ID = T2.RPRT_FILD_ID
                                         AND T1.RPRT_FILD_ID <> '000000000000000000'  
                            WHERE T1.AUD_YR =#{audYr}
                              AND T1.AUD_NO = #{audNo}
                            GROUP BY  T2.DOC_ID   ,T1.AUD_YR, T1.AUD_NO) T4
                       ON T1.AUD_YR = T4.AUD_YR
                      AND T1.AUD_NO  = T4.AUD_NO
                      AND T1.REF_ID = T4.DOC_ID
         WHERE T1.AUD_YR = #{audYr}
           AND T1.AUD_NO = #{audNo}
           AND T1.APV_WAY_CD IN ('10', '30')
           AND T1.RPRT_CD  = 'A10600540'
           AND T1.DOC_ID =#{docId} ]]>
    </select>
    
     <select id="selectOvrOpinNoYn" parameterType="paramMap" resultType="java.lang.Integer">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOvrOpinNoYn */
    <![CDATA[
    SELECT COUNT(T4.CNT) AS CNT
          FROM TBBADDED103M T1 
               INNER JOIN (SELECT T1.AUD_YR, T1.AUD_NO, T1.DOC_ID,  SUM(DECODE(T1.OPIN_NO_YN, 'Y', 0, 1)) AS CNT
                             FROM TBBADDED141M T1                                
                            WHERE T1.AUD_YR =#{audYr}
                              AND T1.AUD_NO = #{audNo}
                               AND T1.RPRT_FILD_ID = '000000000000000000'  
                            GROUP BY  T1.DOC_ID   ,T1.AUD_YR, T1.AUD_NO) T4
                       ON T1.AUD_YR = T4.AUD_YR
                      AND T1.AUD_NO  = T4.AUD_NO
                      AND T1.REF_ID = T4.DOC_ID
         WHERE T1.AUD_YR = #{audYr}
           AND T1.AUD_NO = #{audNo}
           AND T1.APV_WAY_CD IN ('10', '30')
           AND T1.RPRT_CD  = 'A10600540'
           AND T1.DOC_ID =#{docId} ]]>
    </select>
    
    <select id="selectOpinQaYn" parameterType="paramMap" resultType="java.lang.String">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpinQaYn*/
        SELECT CASE WHEN COUNT(A.CD_NM) > 0 THEN 'Y' ELSE 'N' END AS QA_YN
         FROM TBDCMACM013C A
        WHERE A.CMM_CD_DVSN_CD = '1000914'
           AND A.USR_DFN_TXT_1 IN ('10' ,'20')
           AND A.CD_NM = #{cnb}
	</select>
    
     <select id="selectOpinTotPrintList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectOpinTotPrintList*/
        SELECT T.AUD_YR
                , T.AUD_NO
                , T.DOC_ID AS RPRT_DOC_ID --감사보고서 DOC_ID
                , DECODE(B.DOC_ID, NULL, '미작성', '완료') AS COMPLT_YN  --품질담당관 처리 의견 DOC_ID
                , B.DOC_ID
                , B.RPRT_FILD_ID
                , A.RPRT_CD --감사보고서 보고서 구분코드
                , A.RPRT_NM  --감사보고서명
                , T.TITLE_NM
                , DECODE((SELECT T1.OPIN_NO_YN  FROM TBBADDED141M T1
                             WHERE T1.AUD_YR = B.AUD_YR
                                AND T1.AUD_NO = B.AUD_NO
                                AND T1.DOC_ID = T.DOC_ID
                                AND T1.APVR_CD = B.APVR_CD
                                AND T1.AFF_SNO = B.AFF_SNO
                                AND T1.OPIN_DOC_ID = B.DOC_ID), 'Y', '의견없음', 'N', '-')  AS OPIN_NO_YN  --의견없음 여부
         FROM (
                  SELECT AUD_YR
                          , AUD_NO
                          , DOC_ID
                          , RPRT_FILD_ID
                          , AFF_SNO
                          , TITLE_NM
                          , SORT_SNO
                   FROM TBBADDED145M
                  WHERE 1=1
                     AND AUD_YR = #{audYr}
                     AND AUD_NO = #{audNo}
                     AND AUD_STEP_CD = 'A1060'
                     AND APVR_CD IN ('0015800', '0035100', '0058100')    
                  ORDER BY AFF_SNO ) T
                          INNER JOIN  TBBADDED103M A
                           ON T.DOC_ID = A.DOC_ID
                          AND T.AUD_YR = A.AUD_YR
                          AND T.AUD_NO = A.AUD_NO
                          AND AUD_STEP_CD = 'A1060'
                          AND RPRT_CD = 'A10600200'    
                 LEFT OUTER JOIN TBBADDED142M B
                                  ON B.AUD_YR = T.AUD_YR     
                                 AND B.AUD_NO = T.AUD_NO
                                 AND B.RPRT_FILD_ID = T.RPRT_FILD_ID
                                 AND B.AFF_SNO = T.AFF_SNO
                                 AND B.RPRT_CD = 'A10600510'
              WHERE 1=1
              <if test=" 'N'.toString() == qaYn ">
                   AND EXISTS (SELECT 1 
                              FROM TBBADDED111M T1
                             WHERE T1.AUD_YR = T.AUD_YR
                               AND T1.AUD_NO = T.AUD_NO
                               AND T1.RPRT_CD = B.RPRT_CD
                               AND T1.DOC_ID  = B.DOC_ID )
              </if>
              <if test="rprtFildId != null and rprtFildId != '' ">
                    AND A.RPRT_FILD_ID = #{rprtFildId}
             </if>
             ORDER BY T.SORT_SNO
	</select>
	
	<insert id="insertCORCOR603M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertCORCOR603M*/
		INSERT INTO TBCORCOR603M (REQ_DVSN_CD
									, ACP_YR
									, CVPT_ACP_NO
									, ACP_STEP_CD
									, DOC_ID
									, RPRT_NM
									, LINK_URL
									, NECES_YN
									, APV_STA_CD
									, RPRT_CD
									, APV_RQS_ID
									, DOC_KND_CD
									, SORT_SNO
									, CON_PGM_CD
									, APV_WAY_CD
									, DOC_WRT_ID
									, ONR_HNDL_NO
									, FRT_USR_ID
									, FNL_USR_ID
									, FNL_DEAL_DPT_CD
									, FNL_MNU_ID
									, FRT_REGI_DH
									, FNL_MDF_DH)
		   		          VALUES (
		   		          			#{reqDvsnCd}
									, #{acpYr}
									, #{cvptAcpNo}
									, #{acpStepCd}
									, #{docId}
									, #{rprtNm}
									, #{linkUrl}
									, #{necesYn}
									, #{apvStaCd}
									, #{rprtCd}
									, #{apvRqsId}
									, #{docKndCd}
									, ( SELECT NVL(MAX(SORT_SNO),0)+1
		   		           		  	 	FROM TBCSPDCP603M
		   		           		    	WHERE ACP_YR = #{acpYr}
		   		           		    	AND REQ_DVSN_CD = #{reqDvsnCd}
					   		          	AND CVPT_ACP_NO = #{cvptAcpNo}
					   		          	AND ACP_STEP_CD = #{acpStepCd}
		   		           		  		)
									, #{conPgmCd}
									, #{apvWayCd}
									, #{usrId}
									, #{onrHndlNo}
									, #{usrId}
									, #{usrId}
									, #{dptCd}
									, #{menuNo}
									, SYSDATE
									, SYSDATE
		   		          )
	</insert>
	
	<!-- *BEST20 부패행위  -->
	<update id="updateCORCOR602M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateCORCOR602M*/
		UPDATE TBCORCOR602M
		   SET CMPT_YN = 'Y'
               ,FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
		WHERE REQ_DVSN_CD = #{reqDvsnCd}
		AND ACP_YR = #{acpYr}
		AND CVPT_ACP_NO = #{cvptAcpNo}
		AND ACP_STEP_CD = #{acpStepCd}
	    AND ACP_MAIN_STEP_SNO = #{acpMainStepSno}
    	AND ACP_MAIN_STEP_ID = #{acpMainStepId}
	</update>
    
    <!-- *BEST20 청탁금지  -->
    <update id="updateDCPDCP602M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.updateDCPDCP602M*/
		UPDATE TBDCPDCP602M
		   SET CMPT_YN = 'Y'
               ,FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
		WHERE REQ_DVSN_CD = #{reqDvsnCd}
		AND ACP_YR = #{acpYr}
		AND CVPT_ACP_NO = #{cvptAcpNo}
		AND ACP_STEP_CD = #{acpStepCd}
	    AND ACP_MAIN_STEP_SNO = #{acpMainStepSno}
    	AND ACP_MAIN_STEP_ID = #{acpMainStepId}
	</update>
    
    
    <insert id="insertDCPDCP603M" parameterType="paramMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertDCPDCP603M*/
		INSERT INTO TBDCPDCP603M (REQ_DVSN_CD
									, ACP_YR
									, CVPT_ACP_NO
									, ACP_STEP_CD
									, DOC_ID
									, RPRT_NM
									, LINK_URL
									, NECES_YN
									, APV_STA_CD
									, RPRT_CD
									, APV_RQS_ID
									, DOC_KND_CD
									, SORT_SNO
									, CON_PGM_CD
									, APV_WAY_CD
									, DOC_WRT_ID
									, ONR_HNDL_NO
									, FRT_USR_ID
									, FNL_USR_ID
									, FNL_DEAL_DPT_CD
									, FNL_MNU_ID
									, FRT_REGI_DH
									, FNL_MDF_DH)
		   		          VALUES (
		   		          			#{reqDvsnCd}
									, #{acpYr}
									, #{cvptAcpNo}
									, #{acpStepCd}
									, #{docId}
									, #{rprtNm}
									, #{linkUrl}
									, #{necesYn}
									, #{apvStaCd}
									, #{rprtCd}
									, #{apvRqsId}
									, #{docKndCd}
									, ( SELECT NVL(MAX(SORT_SNO),0)+1
		   		           		  	 	FROM TBCSPDCP603M
		   		           		    	WHERE ACP_YR = #{acpYr}
		   		           		    	AND REQ_DVSN_CD = #{reqDvsnCd}
					   		          	AND CVPT_ACP_NO = #{cvptAcpNo}
					   		          	AND ACP_STEP_CD = #{acpStepCd}
		   		           		  		)
									, #{conPgmCd}
									, #{apvWayCd}
									, #{usrId}
									, #{onrHndlNo}
									, #{usrId}
									, #{usrId}
									, #{dptCd}
									, #{menuNo}
									, SYSDATE
									, SYSDATE
		   		          )
	</insert>
	
	<select id="isEdtApvrIdList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.isEdtApvrIdList*/
		<![CDATA[
		SELECT CD
				  FROM TBDCMACM013C
				 WHERE CMM_CD_DVSN_CD = '1000971'
                   AND USE_YN = 'Y'
                   AND CD <> '000000000'
				   AND CD = #{pstCd}
          ]]> 
	</select>
	
	<!-- <select id="selectRprtCd" parameterType="java.lang.String" resultType="java.util.HashMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.selectRprtCd*/
		<![CDATA[
		SELECT USR_DFN_TXT_6 
		     , USR_DFN_TXT_7
	      FROM TBDCMACM013C
         WHERE CMM_CD_DVSN_CD = '1000786'
           AND SUBSTR(CD,0,1) = 'A'
           AND CD NOT IN ('A00000001')
           AND CD = #{rprtCd}
          ]]> 
	</select> -->
	
	<delete id="deleteBADDED142D" parameterType="paramMap">
     /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.deleteBADDED142D*/
      <![CDATA[
         DELETE TBBADDED142D T1
         WHERE T1.AUD_YR = #{audYr}
            AND T1.AUD_NO = #{audNo}
            AND T1.RPRT_CD = #{rprtCd}
            AND T1.RPRT_FILD_ID = #{rprtFildId} 
            AND T1.DOC_ID = #{docId}
         ]]>
    </delete>

    <insert id="insertBADDED142D" parameterType="paramMap">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD001EMapper.insertBADDED142D*/
     <![CDATA[
        INSERT INTO TBBADDED142D(
                                 AUD_YR,
                                 AUD_NO,
                                 AUD_STEP_CD,
                                 RPRT_CD,
                                 DOC_ID,
                                 APVR_CD,
                                 AFF_SNO,
                                 EXAM_CLU_DVSN_CD,
                                 CNB,
                                 AUD_SBJ_NM_TXT,
                                 DPT_NM_TXT,
                                 AUD_RPRT_NUM_TXT,
                                 TITLE_NM_TXT,
                                 OPIN_TXT,
                                 OPIN_BRF_TXT,
                                 RPRT_FILD_ID,
                                 FRT_USR_ID,
                                 FNL_USR_ID,
                                 FNL_DEAL_DPT_CD,
                                 FNL_MNU_ID,
                                 FRT_REGI_DH,
                                 FNL_MDF_DH)
                       SELECT  T1.AUD_YR,
                                 T1.AUD_NO,
                                 T1.AUD_STEP_CD,
                                 #{rprtCd},
                                 #{docId},
                                 T1.APVR_CD,
                                 T1.AFF_SNO,
                                 #{examCluDvsnCd},
                                 T1.CNB,
                                 #{audSbjNmTxt},
                                 #{dptNmTxt},
                                 #{audRprtNumTxt}, 
                                 #{titleNmTxt},
                                 #{opinTxt, jdbcType=CLOB},
                                 #{opinBrfTxt, jdbcType=CLOB},
                                 T1.RPRT_FILD_ID,
                                 #{usrId},    /*세션정보*/
                                 #{usrId},
                                 #{dptCd},
                                 #{menuNo},
                                 SYSDATE,
                                 SYSDATE
                         FROM TBBADDED141M T1
                       WHERE T1.AUD_YR = #{audYr}
                          AND T1.AUD_NO = #{audNo}
                          AND T1.RPRT_FILD_ID = #{rprtFildId}
                          AND T1.DOC_ID  = (SELECT T2.REF_DOC_ID FROM TBBADDED103M T2 WHERE T2.AUD_YR = #{audYr}AND T2.AUD_NO = #{audNo} AND T2.DOC_ID =#{docId} )
            ]]>
    </insert>
    
</mapper>