<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper">

    <insert id="insertBADFRE103M" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.insertBADFRE103M*/
        INSERT INTO TBBADFRE103M (ACP_YR,
                                  ACP_DVSN_CD,
                                  ACP_SRNO,
                                  ACP_STEP_CD,
                                  DOC_ID,
                                  ACP_KND_CD,
                                  ACP_GRN_NO,
                                  RPRT_NM,
                                  LINK_URL,
                                  NECES_YN,
                                  APV_STA_CD,
                                  RPRT_CD,
                                  APV_RQS_ID,
                                  SND_DOC_YN,
                                  DOC_KND_CD,
                                  ACP_RPRT_DVSN_CD,
                                  REF_ID,
                                  REF_DY,
                                  RLTN_ORG_CD,
                                  SORT_SNO,
                                  ACP_DOC_KND_CD,
                                  CON_PGM_CD,
                                  APV_WAY_CD,
                                  DOC_WRT_ID,
                                  ONR_HNDL_NO,
                                  <if test="templateDocId != null and templateDocId != ''">
								  TEMPLATE_DOC_ID,
								  </if>
                                  FRT_USR_ID,
                                  FNL_USR_ID,
                                  FNL_DEAL_DPT_CD,
                                  FNL_MNU_ID,
                                  FRT_REGI_DH,
                                  FNL_MDF_DH,
                                  AUD_DOC_ID)
                          VALUES (#{acpYr},
                                  #{acpDvsnCd},
                                  #{acpSrno},
                                  #{acpStepCd},
                                  #{docId},
                                  #{acpKndCd},
                                  #{acpGrnNo},
                                  #{rprtNm},
                                  #{linkUrl},
                                  #{necesYn},
                                  #{apvStaCd},
                                  #{rprtCd},
                                  #{apvRqsId},
                                  #{sndDocYn},
                                  #{docKndCd},
                                  #{acpRprtDvsnCd},
                                  #{refId},
                                  #{refDy},
                                  #{rltnOrgCd},
                                  (SELECT NVL(MAX(SORT_SNO),0)+1
                                     FROM TBBADFRE103M
                                    WHERE ACP_YR = #{acpYr}
                                      AND ACP_DVSN_CD = #{acpDvsnCd}
                                      AND ACP_SRNO = #{acpSrno}
                                      AND ACP_STEP_CD = #{acpStepCd}
                                  ),
                                  #{acpDocKndCd},
                                  #{conPgmCd},
                                  #{apvWayCd},
                                  #{usrId},
                                  #{onrHndlNo},
                                  <if test="templateDocId != null and templateDocId != ''">
                                   #{templateDocId},
                                   </if>
                                  #{usrId},
                                  #{usrId},
                                  #{dptCd},
                                  #{menuNo},
                                  SYSDATE,
                                  SYSDATE,
                                  #{audDocId})
    </insert>

    <update id="updateBADFRE103M" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.updateBADFRE103M*/
        UPDATE TBBADFRE103M
           SET FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
               <if test="rprtNm != null and rprtNm != ''">
               ,RPRT_NM = #{rprtNm}
               </if>
               <if test="linkUrl != null and linkUrl != ''">
               ,LINK_URL = #{linkUrl}
               </if>
               <if test="apvStaCd != null and apvStaCd != ''">
               ,APV_STA_CD = #{apvStaCd}
               </if>
               <if test="apvRqsId != null and apvRqsId != ''">
               ,APV_RQS_ID = #{apvRqsId}
               </if>
               <if test="onrHndlNo != null and onrHndlNo != ''">
               ,ONR_HNDL_NO = #{onrHndlNo}
               </if>
         WHERE ACP_YR = #{acpYr}
           AND ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_SRNO = #{acpSrno}
           AND ACP_STEP_CD = #{acpStepCd}
           AND DOC_ID = #{docId}
    </update>


    <update id="updateBADFRE102M" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.updateBADFRE102M*/
        UPDATE TBBADFRE102M
           SET CMPT_YN = 'Y'
               ,FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
        WHERE ACP_DVSN_CD = #{acpDvsnCd}
        AND ACP_YR = #{acpYr}
        AND ACP_SRNO = #{acpSrno}
        AND ACP_STEP_CD = #{acpStepCd}
        AND ACP_MAIN_STEP_SNO = #{acpMainStepSno}
        AND ACP_MAIN_STEP_ID = #{acpMainStepId}
    </update>

    <update id="updateBADFRE101M" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.updateBADFRE101M*/
        UPDATE TBBADFRE101M A
           SET STEP_CMPT_YN = #{stepCmptYn}
           <if test= " 'Y'.toString() == stepCmptYn " >
               , STEP_CMPT_DH = SYSDATE
           </if>
               , FNL_MDF_DH = SYSDATE
               , FNL_USR_ID = #{usrId}
               , FNL_DEAL_DPT_CD =#{dptCd}
      WHERE 1=1
		<if test="mgDivCd == null or mgDivCd == '' " >
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_YR = #{acpYr}
            AND ACP_SRNO = #{acpSrno}
        </if>
        <if test=" mgDivCd =='10'  or mgDivCd =='20'  ">
            AND ACP_DVSN_CD = #{mgAcpDvsnCd}
            AND ACP_YR = #{mgAcpYr}
            AND ACP_SRNO = #{mgAcpSrno}
         </if>
          AND A.SORT_SNO = ( SELECT DECODE( #{stepCmptYn}, 'Y', B.SORT_SNO-1, B.SORT_SNO ) 
				                             FROM TBBADFRE101M B
				                            WHERE A.ACP_YR = B.ACP_YR
				                               AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
				                               AND A.ACP_SRNO = B.ACP_SRNO
				                               AND B.ACP_STEP_CD =  #{acpStepCd} )
    </update>
    
    <update id="updateBADFRE012M" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.updateBADFRE012M */
        UPDATE TBBADFRE012M
           SET ACP_HNDL_STA_CD = #{statusCd}
               ,FNL_MDF_DH = SYSDATE
               ,FNL_USR_ID = #{usrId}
               ,FNL_DEAL_DPT_CD =#{dptCd}
        WHERE 1=1
        <if test="mgDivCd == null or mgDivCd == '' " >
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_YR = #{acpYr}
            AND ACP_SRNO = #{acpSrno}
        </if>
        <if test=" mgDivCd =='10'  or mgDivCd =='20'  ">
            AND ACP_DVSN_CD = #{mgAcpDvsnCd}
            AND ACP_YR = #{mgAcpYr}
            AND ACP_SRNO = #{mgAcpSrno}
            AND (ACP_YR = MG_ACP_YR AND ACP_DVSN_CD = MG_ACP_DVSN_CD AND ACP_SRNO = MG_ACP_SRNO)
         </if>
    </update>
    
    <select id="selectBADFRE012M" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectBADFRE012M*/
        SELECT * FROM TBBADFRE012M 
        WHERE ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_YR = #{acpYr}
           AND ACP_SRNO = #{acpSrno}
    </select>
    
    <select id="getAudDocData" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.getAudDocData*/
        SELECT 
             A.ACP_YR
             , A.ACP_DVSN_CD
             , A.ACP_SRNO
             , A.ACP_STEP_CD
             , A.DOC_ID
             , A.ACP_KND_CD
             , A.ACP_GRN_NO
             , A.RPRT_NM
             , A.LINK_URL
             , A.NECES_YN
             , A.APV_STA_CD
             , A.RPRT_CD
             , A.APV_RQS_ID
             , A.SND_DOC_YN
             , A.DOC_KND_CD
             , A.ACP_RPRT_DVSN_CD
             , A.REF_ID
             , A.REF_DY
             , A.RLTN_ORG_CD
             , A.SORT_SNO
             , A.ACP_DOC_KND_CD
             , A.CON_PGM_CD
             , A.APV_WAY_CD
             , A.DOC_WRT_ID
             , F_USR_INFO_BY_ID( A.DOC_WRT_ID, '2' ) AS DOC_WRT_NM
             , A.ONR_HNDL_NO
             , A.DLV_DT
             , A.DLV_CNT
             , A.EDT_AUTH
             , F_CODE_NM('1000773', A.APV_STA_CD) AS APV_STA_NM
			 , F_CODE_NM('1000786', A.RPRT_CD) AS ORG_RPRT_NM
             ,  (SELECT NVL(D.RPRT_FILD_ID, '')
                 FROM  TBBADDED146M D
                 WHERE D.AUD_YR = C.AUD_YR
                 AND D.AUD_NO = C.AUD_NO
                 AND D.DSP_RQ_SNO = C.AUD_DSP_RQ_SNO
                 AND APVR_CD ='A1070') AS RPRT_FILD_ID
             , B.AUD_YR 
             , B.AUD_NO 
             , B.MG_DIV_CD
             , B.DPT_CD
             , F_DPT_INFO (B.DPT_CD, '1') AS DPT_NM
             , CASE WHEN #{cnb} = B.HNDL_CHGR_CD THEN 'Y' ELSE 'N' END AS HNDL_CHGR_YN
             , C.TIT_TXT
             , A.WRIT_CMPT_YN
         FROM TBBADFRE103M A
         INNER JOIN TBBADFRE012M B ON(A.ACP_YR =B.ACP_YR
                                      AND A.ACP_DVSN_CD =B.ACP_DVSN_CD
                                      AND A.ACP_SRNO = B.ACP_SRNO)
         LEFT OUTER JOIN TBBADEAR001M C ON(B.AUD_YR = C.AUD_YR
                                           AND B.AUD_NO = C.AUD_NO
                                           AND B.DSP_RQ_SNO = C.DSP_RQ_SNO)
         WHERE 1=1
         AND A.ACP_YR = #{acpYr}
         AND A.ACP_DVSN_CD = #{acpDvsnCd}
         AND A.ACP_SRNO = #{acpSrno}
         AND A.ACP_STEP_CD = #{acpStepCd}
         AND A.DOC_ID = #{docId}
    </select>
    
        <select id="getEdtStrEndDt" parameterType="paramMap" resultType="java.lang.String">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.getEdtStrEndDt*/
		SELECT  (CASE WHEN (TO_DATE(B.EDT_STR_DT || B.EDT_STR_DH,'YYYYMMDDHH24MI') >= SYSTIMESTAMP OR SYSTIMESTAMP >= TO_DATE(B.EDT_END_DT || B.EDT_END_DH,'YYYYMMDDHH24MI')) THEN 'N'
				        WHEN B.EDT_AUTH_CNBS IS NOT NULL AND INSTR(B.EDT_AUTH_CNBS,#{cnb}) = 0  THEN 'N'
			                                          	                                                                       ELSE NVL(A.EDT_AUTH,'N')
				  END) AS EDT_AUTH                     
        FROM TBBADFRE103M A
        LEFT OUTER JOIN TBDCMACM018M B
        ON (A.ACP_YR = B.AUD_YR AND TO_CHAR(A.ACP_SRNO) = B.AUD_NO AND A.ACP_STEP_CD = B.AUD_STEP_CD AND A.DOC_ID = B.DOC_ID) 
        WHERE 1=1
        AND A.ACP_YR = #{acpYr}
        AND A.ACP_SRNO =#{acpSrno}
        AND A.ACP_STEP_CD = #{acpStepCd}
        AND A.DOC_ID = #{docId}
        AND A.ACP_DVSN_CD = #{acpDvsnCd}
	</select>
	
	<!-- 권한조회 백업 -->
	 <select id="getEdtStrEndDtBack" parameterType="paramMap" resultType="java.lang.String">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.getEdtStrEndDt*/
		SELECT (CASE WHEN TO_DATE(SYSDATE) >= TO_DATE(B.EDT_END_DT)+1 THEN 'N'
	              ELSE  NVL(A.EDT_AUTH,'N')
		          END) AS EDT_AUTH	              
        FROM TBBADFRE103M A
        LEFT OUTER JOIN TBDCMACM018M B
        ON (A.ACP_YR = B.AUD_YR AND TO_CHAR(A.ACP_SRNO) = B.AUD_NO AND A.ACP_STEP_CD = B.AUD_STEP_CD AND A.DOC_ID = B.DOC_ID) 
        WHERE 1=1
        AND A.ACP_YR = #{acpYr}
        AND A.ACP_SRNO =#{acpSrno}
        AND A.ACP_STEP_CD = #{acpStepCd}
        AND A.DOC_ID = #{docId}
        AND A.ACP_DVSN_CD = #{acpDvsnCd}
	</select>
	
	

    <select id="getAudTmpDocData" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.getAudTmpDocData*/
    SELECT
         (SELECT D.RPRT_FILD_ID FROM  TBBADDED146M D
              WHERE D.AUD_YR = C.AUD_YR
               AND D.AUD_NO = C.AUD_NO
               AND D.DSP_RQ_SNO = C.AUD_DSP_RQ_SNO
               AND APVR_CD ='A1070') AS RPRT_FILD_ID
         ,  B.ACP_YR, B.ACP_DVSN_CD, B.ACP_SRNO , C.TIT_TXT, C.AUD_YR ,C.AUD_NO, C.DSP_RQ_SNO
     FROM TBBADFRE012M B, TBBADEAR001M C
    WHERE 1=1
        AND B.AUD_YR = C.AUD_YR
        AND B.AUD_NO = C.AUD_NO
        AND B.DSP_RQ_SNO = C.DSP_RQ_SNO
           
        AND B.ACP_YR = #{acpYr}
        AND B.ACP_DVSN_CD =#{acpDvsnCd}
        AND B.ACP_SRNO =#{acpSrno}
    </select>

    <update id="updateAudRprtNm" parameterType="paramMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.updateAudRprtNm */
          UPDATE TBBADFRE103M
             SET RPRT_NM = #{rprtNm}
           WHERE 1=1
             AND ACP_YR = #{acpYr}
             AND ACP_DVSN_CD = #{acpDvsnCd}
             AND ACP_SRNO = #{acpSrno}
             AND ACP_STEP_CD = #{acpStepCd}
             AND DOC_ID = #{docId}
        ]]>
    </update>
    
    <update id="updateDcmFileNm" parameterType="paramMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.updateDcmFileNm */
          UPDATE TBBADFRE108D
             SET FILE_NM = #{fileNm}
           WHERE 1=1
             AND ACP_DVSN_CD = #{acpDvsnCd}
             AND ACP_YR = #{acpYr}
             AND ACP_SRNO = #{acpSrno}
             AND EVI_DCMB_SNO = #{eviDcmbSno}
             AND ACP_DCM_DOC_ID = #{acpDcmDocId}
        ]]>
    </update>
    
    <select id="selectAudGrnNo" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectAudGrnNo */
        SELECT /*A1.AUD_KND_CD,*/
               /*F_MNG_KND_AUDYRNO(A1.AUD_YR, A1.AUD_NO, A1.AUD_KND_CD, '-') as AUD_YR_GRN_NO,*/
               A1.LINK_URL
          FROM TBBADFRE103M as A1
         WHERE ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_YR = #{acpYr}
           AND ACP_SRNO = #{acpSrno}
           AND ACP_STEP_CD = #{acpStepCd}
           AND DOC_ID = #{docId}
        ]]>
    </select>
    
    <select id="getDecisionReferEnt" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.getDecisionReferEnt*/
        SELECT REFER_ENT 
            FROM TBBADFRE012M 
        WHERE ACP_YR = #{acpYr}
            AND ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_SRNO = #{acpSrno}
    </select>       
    

        <select id="selectEviDocList" parameterType="paramMap" resultType="egovMap">
       /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectEviDocList 위 */
       <![CDATA[
       SELECT A.ACP_YR || '-' || DECODE(A.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || DECODE(A.ORG_ACP_SRNO, null, A.ACP_SRNO, A.ORG_ACP_SRNO) AS ACP_NO /* 분류번호 */
            ,A.ACP_DVSN_CD /*감사종류코드 */          
			,A.ACP_YR  /*감사년도 */
            ,A.ACP_SRNO /*감사번호 */
			,C.EVI_DCMB_SNO
			,C.ACP_DCM_DOC_ID		
			,C.EVI_DCM_DVSN_CD			
            ,F_CODE_NM(DECODE(A.ACP_DVSN_CD, 1, '1000810', '1000811'), C.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM		
            ,B.FOLDER_NM /* 폴더명 */
            ,C.FILE_NM /* 파일명 */
			,C.ISUE_DY
			,C.SORT_SNO
            ,F_USR_INFO_BY_ID(C.ACP_DCM_CRE_ID ,'2') AS FRT_USR_NM /*증거서류생성자명 */
            ,TO_CHAR(A.FRT_REGI_DH,'YYYY-MM-DD') FRT_REGI_DH  /*최초등록일시 */
            ,(SELECT COUNT(*) FROM TBBADFRE108D D
               WHERE A.ACP_YR = D.ACP_YR
                 AND A.ACP_DVSN_CD = D.ACP_DVSN_CD
                 AND A.ACP_SRNO = D.ACP_SRNO) AS CNT
            ,CASE WHEN (A.ACP_YR = A.MG_ACP_YR AND A.ACP_DVSN_CD = A.MG_ACP_DVSN_CD AND A.ACP_SRNO = A.MG_ACP_SRNO) THEN '대표'
			        WHEN A.MG_DIV_CD IS NULL AND A.MG_ACP_YR IS NULL THEN '대표'
			        WHEN A.MG_DIV_CD IS NULL THEN '대표'
			        WHEN A.MG_DIV_CD = '10' THEN '병합'
			        WHEN A.MG_DIV_CD = '20' THEN '병행'
			 END AS MG_DIV_NM /* 병합병행구분명 */
            FROM TBBADFRE012M A,
                 TBBADFRE108M B,
                 TBBADFRE108D C
                 , (SELECT T.MG_ACP_DVSN_CD, T.MG_ACP_YR, T.MG_ACP_SRNO
                 				,T.ACP_DVSN_CD, T.ACP_YR, T.ACP_SRNO
		                FROM TBBADFRE012M T 
		               WHERE T.ACP_DVSN_CD =#{acpDvsnCd}
		               AND T.ACP_YR =#{acpYr}
		               AND T.ACP_SRNO = #{acpSrno} ) D
          WHERE 1=1
            AND C.ACP_YR = A.ACP_YR(+)
            AND C.ACP_DVSN_CD = A.ACP_DVSN_CD(+)
            AND C.ACP_SRNO = A.ACP_SRNO(+)
            
            AND C.EVI_DCMB_SNO = B.EVI_DCMB_SNO(+)
            AND C.ACP_YR = B.ACP_YR(+)
            AND C.ACP_DVSN_CD = B.ACP_DVSN_CD(+)
            AND C.ACP_SRNO = B.ACP_SRNO(+)
            
            AND A.DEL_YN IS NULL
            AND C.EVI_DCM_DVSN_CD <> '99'
            ]]>
            
          <if test="mgDivCd != '10' " >
	          AND A.ACP_DVSN_CD = D.ACP_DVSN_CD
	          AND A.ACP_YR = D.ACP_YR
	          AND A.ACP_SRNO = D.ACP_SRNO
         </if>
         <if test=" mgDivCd == '10' " >
	          AND A.MG_ACP_DVSN_CD = D.MG_ACP_DVSN_CD
	          AND A.MG_ACP_YR = D.MG_ACP_YR
	          AND A.MG_ACP_SRNO = D.MG_ACP_SRNO
         </if>
        <if test='usrId != null and usrId != ""'>
             AND B.DCMB_CRE_ID = #{usrId}
        </if>
        <if test="eviDcmDvsnCd != null and eviDcmDvsnCd != ''">
           AND C.EVI_DCM_DVSN_CD = #{eviDcmDvsnCd}
       </if>        
	   <if test="folderNm != null and folderNm != ''">
	        AND B.FOLDER_NM LIKE '%' || #{folderNm} || '%'
	   </if>
	   <if test="fileNm != null and fileNm != ''">
	       AND C.FILE_NM LIKE '%' || #{fileNm} || '%'
	   </if>	       
	   <if test="usrNam != null and usrNam != ''">
           AND  (SELECT USR_NAM FROM TBDCMACM001M D3 WHERE D3.USR_ID = C.ACP_DCM_CRE_ID)  LIKE '%' || #{usrNam} || '%'
           </if> 
        ORDER BY C.SORT_SNO
    </select>
    
        <insert id="insertBADFRE115M" parameterType="paramMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.insertBADFRE115M*/
        INSERT INTO TBBADFRE115M (ACP_DVSN_CD
                            , ACP_YR
                            , ACP_SRNO
                            , SRNO
                            , RPRT_FILD_ID
                            , DOC_ID
                            , FRT_USR_ID
                            , FNL_USR_ID
                            , FNL_DEAL_DPT_CD
                            , FNL_MNU_ID
                            , FRT_REGI_DH
                            , FNL_MDF_DH)
                             VALUES (#{acpDvsnCd},
                                       #{acpYr},
                                        #{acpSrno},
                                        #{srno},
                                        #{rprtFildId},
                                        #{docId},
                                  #{usrId},    /*세션정보*/
                                  #{usrId},
                                  #{dptCd},
                                  #{menuNo},
                                  SYSDATE,
                                  SYSDATE)
    </insert>
    
    
      <update id="updateBADFRE115M" parameterType="paramMap">
      /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.updateBADFRE115M*/
         UPDATE TBBADFRE115M
               SET FNL_MDF_DH = SYSDATE
                     ,FNL_USR_ID = #{usrId}
                     ,FNL_DEAL_DPT_CD =#{dptCd}
        <if test="rprtFildId != null and rprtFildId != ''">
            ,RPRT_FILD_ID = #{rprtFildId}
        </if>
        <if test="docId != null and docId != ''">
            ,DOC_ID = #{docId}
        </if>
         WHERE ACP_DVSN_CD = #{acpDvsnCd}
            AND ACP_YR = #{acpYr}
            AND ACP_SRNO = #{acpSrno}
            AND SRNO = #{srno}
    </update>
    
    <select id="selectMaxSrnoBADFRE115M" parameterType="paramMap" resultType="egovMap">
           /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectMaxSrnoBADFRE115M*/
        SELECT NVL(MAX(SRNO),0)+1 AS SRNO
            FROM TBBADFRE115M
         WHERE ACP_DVSN_CD = #{acpDvsnCd}
		   AND ACP_YR = #{acpYr}
           AND ACP_SRNO = #{acpSrno}
    </select>
    
    <delete id="deleteBADFRE110M" parameterType="paramMap">
    <![CDATA[
	    /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.deleteBADFRE110M*/
	    DELETE FROM TBBADFRE110M
	    WHERE 1=1
     ]]>
     <if test="mgDivCd != '10'" >
        AND ACP_DVSN_CD = #{delAcpDvsnCd}
	    AND ACP_YR = #{delAcpYr}
	    AND ACP_SRNO = #{delAcpSrno}
     </if>
     <if test="mgDivCd == '10' " >
        AND (ACP_YR, ACP_DVSN_CD, ACP_SRNO) IN (SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO 
                                                  FROM TBBADFRE012M 
                                                 WHERE MG_ACP_YR = #{delAcpYr}
                                                   AND MG_ACP_DVSN_CD = #{delAcpDvsnCd}
                                                   AND MG_ACP_SRNO = #{delAcpSrno}) 
     </if>
     <if test="delDocId != null and delDocId != ''">
     	AND DOC_ID = #{delDocId}
     </if>
     
	 /* 2018-05-30 NOTE By KKOMZI [심사/재심의 증거서류 매핑 수정] 보고서코드 조건절 제외 */
     <!--<if test="delRprtFildId != null and delRprtFildId != ''">
     	AND RPRT_FILD_ID = #{delRprtFildId}
     </if>--> 
    </delete>
    
    
    	<select id="selectEviDcmbMapList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectEviDcmbMapList 밑 */
		 SELECT DISTINCT D1.ACP_DVSN_CD ,
		        D1.ACP_YR,
			    D1.ACP_SRNO,
			    D1.EVI_DCM_MPP_SNO,
			    D1.ACP_KND_CD,
			    D1.ACP_GRN_NO,
			    D1.DOC_ID,
			    D2.FOLDER_NM,
			    D3.FILE_NM,
			    D3.FILE_NM AS DOC_NM,
			    D1.ACP_DCM_DOC_ID,
			    D1.RPRT_FILD_ID,
			    D1.EVI_DCMB_SNO,
			    D1.EVI_MPP_DVSN_CD,
		  	    D1.SORT_SNO,
                D1.HYPER_LINK_YN,
                D3.EVI_DCM_DVSN_CD,
                F_CODE_NM(#{cmmCdDvsnCd},D3.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM
 		   FROM TBBADFRE110M D1
LEFT OUTER JOIN TBBADFRE108M D2 ON D1.ACP_DVSN_CD = D2.ACP_DVSN_CD AND D1.ACP_YR = D2.ACP_YR AND D1.ACP_SRNO = D2.ACP_SRNO AND D1.EVI_DCMB_SNO = D2.EVI_DCMB_SNO
LEFT OUTER JOIN TBBADFRE108D D3 ON D1.ACP_DVSN_CD = D3.ACP_DVSN_CD AND D1.ACP_YR = D3.ACP_YR AND D1.ACP_SRNO = D3.ACP_SRNO AND D1.EVI_DCMB_SNO = D3.EVI_DCMB_SNO AND D1.ACP_DCM_DOC_ID = D3.ACP_DCM_DOC_ID
INNER JOIN TBBADFRE012M D4 ON D1.ACP_DVSN_CD = D4.ACP_DVSN_CD AND D1.ACP_YR = D4.ACP_YR AND D1.ACP_SRNO = D4.ACP_SRNO
		WHERE 1=1
        <if test="mgDivCd != '10' " >
            AND D4.ACP_DVSN_CD = #{acpDvsnCd}
		    AND D4.ACP_YR = #{acpYr}
		    AND D4.ACP_SRNO = #{acpSrno}
        </if>
        <if test="mgDivCd == '10' " >
            AND D4.MG_ACP_DVSN_CD = #{acpDvsnCd}
            AND D4.MG_ACP_YR = #{acpYr}
            AND D4.MG_ACP_SRNO = #{acpSrno}
        </if>
		<if test="acpDcmDocId != null and acpDcmDocId != ''">
		    AND D1.ACP_DCM_DOC_ID = #{acpDcmDocId}
		</if>
		<if test="rprtFildId != null and rprtFildId != ''">
		    AND D1.RPRT_FILD_ID = #{rprtFildId}
		</if>
        <if test="hyperLinkYn != null and hyperLinkYn != ''">
            AND D1.HYPER_LINK_YN = #{hyperLinkYn}
        </if>
        ORDER BY D1.ACP_SRNO, D1.SORT_SNO
	</select>
	
    <select id="selectMaxEviDcmMppSno" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectEviDcmbList*/
        SELECT NVL(MAX(EVI_DCM_MPP_SNO),0)+1 AS EVI_DCM_MPP_SNO
          FROM TBBADFRE110M
        WHERE ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_YR = #{acpYr}
           AND ACP_SRNO = #{acpSrno}
    </select>

    <insert id="insertBADFRE110M" parameterType="paramMap">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.insertBADFRE110M*/
    INSERT INTO TBBADFRE110M (
    	ACP_DVSN_CD, ACP_YR, ACP_SRNO, EVI_DCM_MPP_SNO, ACP_KND_CD, ACP_GRN_NO, 
    	 DOC_ID, ACP_DCM_DOC_ID, RPRT_FILD_ID, EVI_DCMB_SNO, EVI_MPP_DVSN_CD, SORT_SNO, FRT_USR_ID, FNL_USR_ID,
          FNL_DEAL_DPT_CD, FNL_MNU_ID, FRT_REGI_DH, FNL_MDF_DH) 
          
     VALUES (#{acpDvsnCd}, 
			     #{acpYr},
			     #{acpSrno},
			 	 #{eviDcmMppSno},
			 	 #{acpKndCd},
			 	 #{acpGrnNo},
			 	 #{docId},
			 	 #{acpDcmDocId},
                 #{rprtFildId},
                 #{eviDcmbSno},
                 #{eviMppDvsnCd},
                 #{eviDcmMppSno},
                 #{usrId},
                 #{usrId},
                 #{dptCd},
                 #{menuNo}, SYSDATE, SYSDATE)
                  
    </insert>
    
    <select id="getRvwRfrMtrl" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.getRvwRfrMtrl*/
	    SELECT DOC_ID,
	      RPRT_FILD_ID,
	      SRNO
	    FROM TBBADFRE115M
	   WHERE ACP_DVSN_CD = #{acpDvsnCd}
	       AND ACP_YR = #{acpYr}
	       AND ACP_SRNO = #{acpSrno}
	   <if test="srno != null and srno != '' ">
		   AND SRNO = #{srno}
       </if>
       <if test="rprtFildId != null and rprtFildId != '' ">
		   AND RPRT_FILD_ID = #{rprtFildId}
       </if>
    </select>


    <select id="selectStepAcpSbjDocList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectStepAcpSbjDocList*/
        <![CDATA[
        SELECT RPRT_NM        /*보고서명 */
               , SORT_SNO       /*정렬순번  */
               , DOC_ID         /*결재문서번호 */
               , RPRT_CD
               , RPRT_CD AS AUD_DOC_CD
               , F_CODE_NM('1000786', RPRT_CD) AS AUD_DOC_NM
               , RPRT_NM AS DOC_NM
               , AUD_DOC_ID
               , B.ACP_DVSN_CD
               , B.ACP_YR
               , B.ACP_SRNO
          FROM TBBADFRE103M A, TBBADFRE012M B,
              (SELECT  MG_ACP_DVSN_CD, MG_ACP_YR, MG_ACP_SRNO 
              			, ACP_DVSN_CD, ACP_YR, ACP_SRNO
                FROM TBBADFRE012M
               WHERE ACP_DVSN_CD = #{acpDvsnCd}
               AND ACP_YR =#{acpYr}
               AND ACP_SRNO = #{acpSrno} ) C 
               
         WHERE A.ACP_DVSN_CD = B.ACP_DVSN_CD
           AND A.ACP_YR = B.ACP_YR
           AND A.ACP_SRNO = B.ACP_SRNO
         ]]>
           
          <if test="mgDivCd == null or mgDivCd == '' " >
           AND B.ACP_DVSN_CD = C.ACP_DVSN_CD
           AND B.ACP_YR = C.ACP_YR
           AND B.ACP_SRNO = C.ACP_SRNO
           </if>
           <if test="mgDivCd != null and (mgDivCd == '10' or mgDivCd =='20') " >
           AND B.MG_ACP_DVSN_CD = C.MG_ACP_DVSN_CD
           AND B.MG_ACP_YR = C.MG_ACP_YR
           AND B.MG_ACP_SRNO = C.MG_ACP_SRNO
           </if>
           AND A.APV_WAY_CD IN ('10', '30')
           
         <if test=" 'Y'.toString() != orderOrgDoc " >
           AND 'Y' = (CASE WHEN A.RPRT_CD ='D10100100' OR A.RPRT_CD= 'E10100100' THEN A.SND_DOC_YN 
            						ELSE 'Y' END ) --의견서이면 발신여부Y인것만
         ORDER BY RPRT_CD
         </if>
         <if test= " 'Y'.toString() == orderOrgDoc " >
           AND A.SND_DOC_YN ='Y' --발신여부Y
           AND AUD_DOC_ID IS NOT NULL
           AND (( A.RPRT_CD LIKE 'D101003%' OR A.RPRT_CD LIKE 'E101003%') OR A.RPRT_CD='E10100100' )  --300번대는 원처분코드, 의견서 추가 2017. 09. 14
                    
          ORDER BY CASE WHEN AUD_DOC_CD IN ( 'D10100350', 'E10100350' ) THEN 1 --원처분요구 (시행문에서 해당사건 발췌)
						          WHEN AUD_DOC_CD IN ( 'D10100340', 'E10100340' ) THEN 2 --감사결과 변경의결사항 대조표(해당사건 발췌)
						          WHEN AUD_DOC_CD IN ( 'D10100330', 'E10100330' ) THEN 3 --부의안 (해당사건 발췌)
						          WHEN AUD_DOC_CD IN ( 'D10100332', 'E10100332' ) THEN 4 --부의안 요약 (해당사건 발췌)
						          WHEN AUD_DOC_CD IN ( 'D10100370', 'E10100370') THEN 5 --소위원회 심의결과보고서
						          WHEN AUD_DOC_CD IN ( 'D10100360', 'E10100360') THEN 6 --소명자료 검토보고서 
						          WHEN AUD_DOC_CD IN ( 'D10100320', 'E10100320') THEN 7 --처리안(감사보고서) (해당사건 발췌)
						          WHEN AUD_DOC_CD IN ( 'D10100310', 'E10100310') THEN 8 --실지감사종료보고서 (해당사건 발췌)
						          WHEN AUD_DOC_CD IN ( 'D10100300', 'E10100300') THEN 9 --처리기간 평가표
						          WHEN AUD_DOC_CD IN ( 'D10100352', 'E10100352') THEN 10 --시행 공문 온나라 결재문서 (해당사건 시행처에 대한 시행 공문)
						          WHEN AUD_DOC_CD IN ( 'D10100351', 'E10100351') THEN 11 --시행문 내부결재 문서
						          WHEN AUD_DOC_CD IN ( 'D10100341', 'E10100341') THEN 12 --감사결과 변경의결사항 대조표 내부결재 문서
						          WHEN AUD_DOC_CD IN ( 'D10100361', 'E10100361') THEN 13 --소명자료 검토보고서 내부결재 문서
						          WHEN AUD_DOC_CD IN ( 'D10100321', 'E10100321') THEN 14 --처리안(감사보고서) 내부결재 문서
						          WHEN AUD_DOC_CD IN ( 'D10100311', 'E10100311') THEN 15 --실지감사종료보고서 내부결재 문서
         				 ELSE 16 END , A.RPRT_NM
         </if>
    </select>

    <select id="selectEviDcmbTypeList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectEviDcmbTypeList*/
        <![CDATA[
			SELECT CD, CD_NM FROM TBDCMACM013C
			WHERE CMM_CD_DVSN_CD = #{cmmCdDvsnCd}
			   AND CD <> '000000000'
			   AND CD <> '99'
			]]>
			<if test=" rprtCd != null and rprtCd != '' " >
				AND CD = #{rprtCd}
			</if>
    </select>
    
        <select id="selectDecisionDocList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectDecisionDocList*/
        <![CDATA[
				 
		SELECT A.ACP_YR || '-' || DECODE(A.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || DECODE(A.ORG_ACP_SRNO, null, A.ACP_SRNO, A.ORG_ACP_SRNO) AS ACP_NO /* 분류번호 */
			     ,A.ORG_NM /* 처분청 */
			     ,A.REQR_NM /* 청구인명 */ 
			     ,CASE WHEN (A.ACP_YR = A.MG_ACP_YR AND A.ACP_DVSN_CD = A.MG_ACP_DVSN_CD AND A.ACP_SRNO = A.MG_ACP_SRNO) THEN '대표'
			             WHEN A.MG_DIV_CD IS NULL AND A.MG_ACP_YR IS NULL THEN '대표'
			             WHEN A.MG_DIV_CD IS NULL THEN '대표'
			             WHEN A.MG_DIV_CD = '10' THEN '병합'
			             WHEN A.MG_DIV_CD = '20' THEN '병행'
			      END AS MG_DIV_NM /* 병합병행구분명 */
			    ,DOC_ID /* 문서 ID */
			    ,RPRT_NM
			    ,A.TIT_NM /* 청구내용*/
                ,A.AMIT_AM /* 금액 */
		 FROM TBBADFRE012M A, TBBADFRE013D B, TBBADFRE103M C
				, (SELECT T.MG_ACP_DVSN_CD, T.MG_ACP_YR, T.MG_ACP_SRNO
								,T.ACP_DVSN_CD, T.ACP_YR, T.ACP_SRNO, T.MG_DIV_CD
		                FROM TBBADFRE012M T 
		               WHERE T.ACP_DVSN_CD =#{acpDvsnCd}
		               AND T.ACP_YR =#{acpYr}
		               AND T.ACP_SRNO = #{acpSrno} ) D 
               
	    WHERE 1=1
		   AND A.ACP_YR 		= B.ACP_YR(+)
		   AND A.ACP_DVSN_CD 	= B.ACP_DVSN_CD(+)
		   AND A.ACP_SRNO 		= B.ACP_SRNO(+)
		   AND A.ACP_YR 		= C.ACP_YR
		   AND A.ACP_DVSN_CD 	= C.ACP_DVSN_CD
		   AND A.ACP_SRNO 		= C.ACP_SRNO
           AND C.ACP_STEP_CD  IN ( 'D1020' , 'E1040', 'E1020', 'E1030')
		   AND A.DEL_YN IS NULL
		]]>
         <if test= " mgDivCd == null  or mgDivCd ==''  " >
	          AND A.ACP_DVSN_CD = D.ACP_DVSN_CD
	          AND A.ACP_YR = D.ACP_YR
	          AND A.ACP_SRNO = D.ACP_SRNO
         </if>
		<if test=" mgDivCd =='10'  or mgDivCd =='20'  ">
	          AND A.MG_ACP_DVSN_CD = D.MG_ACP_DVSN_CD
	          AND A.MG_ACP_YR = D.MG_ACP_YR
	          AND A.MG_ACP_SRNO = D.MG_ACP_SRNO
         </if>
        <if test=' rprtCd != null  and rprtCd !="" '>
		   AND C.RPRT_CD = #{rprtCd}
		</if>
       ORDER BY MG_DIV_NM, A.ACP_YR, A.ACP_SRNO
    </select>
    
    <select id="selectJudgmentBasicList" parameterType="paramMap" resultType="egovMap">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectJudgmentBasicList */
    SELECT T.*, T5.* FROM (
	    SELECT
        <if test= " 'Y'.toString() != mgDivYn " >
			(CASE WHEN T1.MG_DIV_CD IN ('10','20') THEN (SELECT AGGR_CONCAT( ACP_YR || '-' || DECODE(ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || AGGR_CONCAT( ACP_SRNO ,'ㆍ' ORDER BY ACP_SRNO)  ,', ' ORDER BY ACP_YR) 
                                                         FROM TBBADFRE012M
                                                        WHERE MG_ACP_YR = T1.MG_ACP_YR
                                                          AND MG_ACP_DVSN_CD = T1.MG_ACP_DVSN_CD
                                                          AND MG_ACP_SRNO = T1.MG_ACP_SRNO
                                                        GROUP BY ACP_YR, ACP_DVSN_CD
                                                       ) || DECODE(T1.MG_DIV_CD, '10',' (병합)','20','(병행)')
	             ELSE T1.ACP_YR || '-' || DECODE(T1.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정')|| '-' || DECODE(T1.ORG_ACP_SRNO, NULL, T1.ACP_SRNO, T1.ORG_ACP_SRNO)
		         END ) AS ACP_NO /* 분류번호 */
	    </if>
        <if test= " 'Y'.toString() == mgDivYn " >
	        T1.ACP_YR || '-' || DECODE(T1.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정')|| '-' || DECODE(T1.ORG_ACP_SRNO, NULL, T1.ACP_SRNO, T1.ORG_ACP_SRNO)  AS ACP_NO /* 분류번호 */
	    </if>
            , (SELECT COUNT(*) FROM TBBADFRE012M
               WHERE MG_ACP_YR = T1.ACP_YR
                  AND MG_ACP_DVSN_CD = T1.ACP_DVSN_CD
                  AND MG_ACP_SRNO = T1.ACP_SRNO )AS TOT_CNT /* 총건수 */
             , (SELECT DOC_ID
			     FROM TBBADFRE103M
			    WHERE ACP_YR = T1.ACP_YR
			        AND ACP_DVSN_CD = T1.ACP_DVSN_CD
			        AND ACP_SRNO = T1.ACP_SRNO
        	        AND ACP_STEP_CD = 'D1020'
			        AND RPRT_CD = 'D10200100' ) AS DOC_ID /* 결정문 DOC_ID */
             
             , ( SELECT TO_CHAR(FNL_APV_DH, 'YYYY-MM-DD') 
	              FROM TBDCMACM022L 
	             WHERE APV_DOC_NO = (SELECT APV_RQS_ID
					                                  FROM TBBADFRE103M
					                                WHERE ACP_YR = T1.ACP_YR
					                                   AND ACP_DVSN_CD = T1.ACP_DVSN_CD
					                                   AND ACP_SRNO = T1.ACP_SRNO
					                                   AND ACP_STEP_CD = 'D1020'
					                                   AND RPRT_CD = 'D10200100'  ) ) AS FNL_APV_DH /* 최종결재일 */
				<if test="sbmtSeq != null and sbmtSeq != ''">
                 , ( SELECT TO_CHAR(TO_DATE(SBMT_PLAN_DT), 'YYYY-MM-DD')  
		                 FROM TBBADFRE114M A, TBBADFRE012M B
		             WHERE A.ACP_YR = B.ACP_YR
		                 AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		                 AND A.ACP_SRNO = B.ACP_SRNO
                         AND B.MG_ACP_YR = #{acpYr}
		                 AND B.MG_ACP_DVSN_CD =#{acpDvsnCd}
		                 AND B.MG_ACP_SRNO =#{acpSrno}
		                 AND SBMT_SEQ = #{sbmtSeq} ) AS SBMT_PLAN_DT /* 소위예정일 */
                 </if>
                  , ( SELECT REGI_NO FROM TBBADFRE112M 
                      WHERE ACP_YR = T1.ACP_YR
                         AND ACP_DVSN_CD = T1.ACP_DVSN_CD
                         AND ACP_SRNO = T1.ACP_SRNO) AS REGI_NO/*등재번호  */
                     
             , ( SELECT CHF_CMTR_ID FROM TBBADFRE112M 
               WHERE ACP_YR = T1.ACP_YR
                AND ACP_DVSN_CD = T1.ACP_DVSN_CD
                AND ACP_SRNO = T1.ACP_SRNO) AS CHF_CMTR_ID /*주심*/
              
              , T1.DSPTCH_INSTT_NAM ||'('|| T1.REQR_NM ||')' AS DSPTCH_REQR_NM /*발신기관명 ( 청구인) */
			  , (SELECT F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-')  
                   FROM TBBADDED001M D1
                 WHERE AUD_YR = T1.AUD_YR
                    AND AUD_NO = T1.AUD_NO) AS ORG_ACP_NO /* 원분류번호 */
              , NVL(T1.TIT_NM, ' ') AS TIT_NM			/*제목명*/
    		  , T1.REQR_NM AS REQ_NM /* 청구인 */
              , T1.AD /* 주소만 */
              , T1.DTL_AD /* 상세주소 */
    		  , T1.AD || ' ' || T1.REQR_NM AS  REQ_NM_ADDR /* 주소 + 청구인 */
    		  , T1.AGT_NM /* 대리인 */
              , T1.AGT_AD /* 주소만 */
              , T1.AGT_DTL_AD /* 상세주소 */
              , T1.AGT_AD || ' ' || T1.AGT_NM AS  AGT_NM_ADDR /* 주소 + 대리인 */
    		  , T1.ORG_CD 	 /* 처분청코드 */
    		  , F_ORG_INFO(T1.ORG_CD, '1') AS ORG_NM /* 처분청 */
    		  , TO_CHAR(TO_DATE(T1.REQ_DT), 'YYYY-MM-DD') AS REQ_DT    /*청구일자*/
    		   ,TO_CHAR(TO_DATE(T1.ACP_DT), 'YYYY-MM-DD') AS ACP_DT		/* 감사원 접수일 */
    		   ,TO_CHAR(TO_DATE(T1.DSP_OFC_ACP_DT), 'YYYY-MM-DD') AS DSP_OFC_ACP_DT /*처분청 접수일*/
   			  , T1.CVPT_SEN_ACP_NO /* 접수번호 */
              
	          , T1.DSPTCH_INSTT_NAM /* 발신기관명 */  
              , T1.AUD_YR			/*감사년도*/
              , T1.AUD_NO			/*감사번호*/
              , (SELECT AUD_GRN_NO
                          FROM TBBADDED001M
                         WHERE AUD_YR = T1.AUD_YR
                           AND AUD_NO = T1.AUD_NO) AS AUD_GRN_NO
              , T1.DSP_RQ_SNO		/*처분요구순번*/
              , (SELECT FRML_DPT_NM FROM TBDCMACM002M
                        WHERE DPT_CD=T1.BAI_DSP_DIV_CD) AS BAI_DSP_DIV_NM /*원처분과*/
              , ( SELECT  AUD_SBJ_NM  FROM TBBADDED001M
                       WHERE AUD_YR = T1.AUD_YR 
                       AND AUD_NO=T1.AUD_NO ) AS BAI_AUD_SBJ_NM /* 감사사항명 */
               ,CASE WHEN (T1.ACP_YR = T1.MG_ACP_YR AND T1.ACP_DVSN_CD = T1.MG_ACP_DVSN_CD AND T1.ACP_SRNO = T1.MG_ACP_SRNO) THEN '대표'
			             WHEN T1.MG_DIV_CD IS NULL AND T1.MG_ACP_YR IS NULL THEN '대표'
			             WHEN T1.MG_DIV_CD IS NULL THEN '대표'
			             WHEN T1.MG_DIV_CD = '10' THEN '병합'
			             WHEN T1.MG_DIV_CD = '20' THEN '병행'
			      END AS MG_DIV_NM /* 병합병행구분명 */
                ,T1.AMIT_AM /* 금액 */
                
                , (SELECT TNB FROM TBDCMACM002M WHERE T4.DPT_CD=DPT_CD ) AS DPT_TNB /* 담당자 부서 전화번호*/
                , (SELECT FAN FROM TBDCMACM002M WHERE T4.DPT_CD=DPT_CD ) AS DPT_FAN /* 담당자 부서 팩스 */
    			, DECODE(LENGTH(T4.TNB),4 , '02-2011-'||T4.TNB , T4.TNB) AS TNB /*처리담당자 전화번호 */
                , DECODE(LENGTH(T4.FAN),4 , '02-2011-'||T4.FAN , T4.FAN) AS FAN /*처리담당자 FAX */ 
                , T4.CNB --전산번호
    			, T4.USR_ID --사용자ID
                , T1.DPT_CD
                , F_DPT_INFO (T1.DPT_CD, '1') AS DPT_NM /* 처리과 */ 
    			, T4.USR_NAM --담당자 이름
			    , T4.PST_CD --담당자 직위코드
                , F_CODE_NM('1000176', T4.PST_CD) AS PST_NM --담당자 직위명
                , T4.RANK_NM_2 --담당자 직급명
                , T4.ONR_PST_NM --온나라 직급명
               
                 , CASE WHEN T1.REFER_ENT ='Y' THEN ( SELECT TO_CHAR(FNL_APV_DH, 'YYYY-MM-DD')
                                               FROM TBDCMACM022L 
                                             WHERE APV_DOC_NO = (SELECT G.APV_RQS_ID
                                                                  FROM TBBADFRE103M G
                                                                 WHERE G.ACP_YR = T1.ACP_YR
                                                                    AND G.ACP_DVSN_CD = T1.ACP_DVSN_CD
                                                                    AND G.ACP_SRNO = T1.ACP_SRNO
                                                                    AND G.ACP_STEP_CD IN ( 'D1020' ,'E1040')
                                                                    AND G.RPRT_CD IN ( 'D10200200' ,'E10400200' )) )
                      WHEN T1.REFER_ENT ='N' THEN T1.DCS_DT ELSE '' END AS DCS_DT /* 부의:부의의결일자, 위임:요약문 최종결재일자 */
    		 FROM  TBBADFRE012M T1 ,  TBBADFRE013D T3, TBDCMACM001M T4
     	   WHERE 1=1
		      AND T1.ACP_YR         = T3.ACP_YR(+)
		      AND T1.ACP_DVSN_CD    = T3.ACP_DVSN_CD(+)
		      AND T1.ACP_SRNO       = T3.ACP_SRNO(+)
		      AND T1.HNDL_CHGR_CD   = T4.CNB(+)
		<if test= " 'Y'.toString() != mgDivYn " >
    	  	  AND T1.ACP_YR = #{acpYr}
       		  AND T1.ACP_DVSN_CD = #{acpDvsnCd}
       		  AND T1.ACP_SRNO = #{acpSrno}
       	</if>
       	<if test= " 'Y'.toString() == mgDivYn " >
       	   AND T1.MG_ACP_YR = #{acpYr}
		   AND T1.MG_ACP_DVSN_CD =#{acpDvsnCd}
		   AND T1.MG_ACP_SRNO  = #{acpSrno}
		 </if>
         ) T
         , ( SELECT A.USR_NAM AS UP_USR_NM--담당자 부서의 과장
                      , A.DPT_CD AS UP_DPT_CD
                      , F_DPT_INFO (A.DPT_CD, '1') AS UP_DPT_NM
                      , A.PST_CD AS UP_PST_CD
                      , F_CODE_NM('1000176', A.PST_CD) AS UP_PST_NM
                      , A.RANK_NM_2 AS UP_RANK_NM_2
                     , A.ONR_PST_NM AS UP_ONR_PST_NM
              FROM TBDCMACM001M A
            WHERE A.PST_CD  IN ( '0013600' , '0035400')
          ) T5
    WHERE T.DPT_CD = T5.UP_DPT_CD(+)
    </select>
    
    <select id="selectAudDocIdFDMBTM001M" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectAudDocIdFDMBTM001M*/
		SELECT DECODE(#{docType},'HWP',HWP_DOC_ID,DOC_ID) AS DOC_ID
		  FROM TBFDMBTM001M
	     WHERE AUD_DOC_TMP_CD = #{audDocCd}
	</select>
	
		<select id="selectAudDocIdFDMADM002M" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectAudDocIdFDMADM002M*/
		SELECT DECODE(#{docType},'HWP',HWP_DOC_ID,DOC_ID) AS DOC_ID,
			   DTIL_AUD_DOC_NM,
               IDVT_DSP_RQ_PLAN_CD
		  FROM TBFDMADM002M
	     WHERE AUD_DOC_CD = #{audDocCd}
	</select>
	
	<select id="selectSbcnCoverInfoList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectSbcnCoverInfoList*/
   		SELECT 
          (CASE WHEN A.MG_DIV_CD IN ('10','20') THEN (SELECT AGGR_CONCAT(ACP_YR || '-' ||
                                                              DECODE(ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || AGGR_CONCAT( ACP_SRNO ,'ㆍ' )  ,', ')
                                                         FROM TBBADFRE012M
                                                        WHERE MG_ACP_YR = A.MG_ACP_YR
                                                          AND MG_ACP_DVSN_CD = A.MG_ACP_DVSN_CD
                                                          AND MG_ACP_SRNO = A.MG_ACP_SRNO
                                                        GROUP BY ACP_YR, ACP_DVSN_CD
                                                       ) || DECODE(A.MG_DIV_CD,'10',' (병합심의)','20',' (병행심의)')
				             ELSE A.ACP_YR || '-' || DECODE(A.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정')|| '-' || DECODE(A.ORG_ACP_SRNO, NULL, A.ACP_SRNO, A.ORG_ACP_SRNO)
				         END ) AS ACP_NO /* 분류번호 */
             ,A.REQR_NM /*청구인*/
             ,TO_CHAR(TO_DATE(A.ACP_DT), 'YYYY-MM-DD') AS ACP_DT		/* 접수일 */
              ,DECODE(A.MG_ACP_DVSN_CD, NULL,A.ACP_YR,A.MG_ACP_YR) AS ACP_YR
              ,A.TIT_NM /*청구내용*/
              ,A.ACP_SRNO
              ,A.ACP_DVSN_CD
              ,DECODE(A.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') AS ACP_DVSN_NM
              ,DECODE(A.MG_ACP_DVSN_CD, NULL,A.ACP_SRNO,A.MG_ACP_SRNO) AS ACP_NO
             , B.REGI_NO --등재번호 
             , B.CHF_CMTR_ID --주심
             , F_DPT_INFO (A.DPT_CD, '1') AS DPT_NM /* 처리과 */
             , F_DPT_INFO((SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = A.DPT_CD ), '1') AS UP_DPT_CD
             , (SELECT S1.TIT_TXT
                  FROM TBBADEAR001M S1
                WHERE S1.AUD_YR 		= A.AUD_YR
                    AND S1.AUD_NO  		= A.AUD_NO
                    AND S1.DSP_RQ_SNO 	= A.DSP_RQ_SNO
                ) AS DSP_RQ_TIT_NM /* 처분요구 제목 */
              , F_CODE_NM('1000043', A.JDG_REQ_DVSN_CD) AS JDG_REQ_DVSN_NM /*처분요구 종류*/
            
        FROM TBBADFRE012M A, TBBADFRE112M B
        WHERE 1=1
         AND A.ACP_YR  = #{acpYr}
         AND A.ACP_DVSN_CD = #{acpDvsnCd}
         AND A.ACP_SRNO = #{acpSrno}
         AND A.ACP_YR = B.ACP_YR
         AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
         AND A.ACP_SRNO = B.ACP_SRNO
 ORDER BY A.ACP_YR DESC, A.ACP_SRNO, A.MG_ACP_SRNO
	</select>
	
	<select id="selectOrgAudEviList" parameterType="paramMap" resultType="egovMap">
	SELECT 
	    ( SELECT FILE_NM FROM TBBADDED108D
	      WHERE AUD_YR = F.AUD_YR
	          AND AUD_NO = F.AUD_NO
	          AND AUD_DCM_DOC_ID = F.AUD_DCM_DOC_ID  
         ) AS FILE_NM
       , F.*
		FROM TBBADDED110M F INNER JOIN  (SELECT E.AUD_YR
		                                  ,E.AUD_NO      
		                                  ,D.ACP_YR
		                                  ,D.ACP_DVSN_CD
		                                  ,D.ACP_SRNO
		                                  ,E.RPRT_FILD_ID      
		                              FROM TBBADFRE012M D INNER JOIN (
		                                                  SELECT A.AUD_YR
		                                                        ,A.AUD_NO
		                                                        ,A.AFF_CD
		                                                        ,B.AFF_DSP_CD
		                                                        ,A.RPRT_FILD_ID
		                                                        ,C.DSP_RQ_SNO
		                                                    FROM TBBADDED145M A INNER JOIN TBBADDED146M B
		                                                      ON A.AUD_YR  = B.AUD_YR
		                                                     AND A.AUD_NO  = B.AUD_NO
		                                                     AND A.FNL_YN =  B.FNL_YN   
		                                                     AND A.AFF_SNO  = B.AFF_SNO
		                                                     AND A.FNL_YN = 'Y' INNER JOIN TBBADEAR001M C
		                                                                                ON C.AUD_YR  = A.AUD_YR
		                                                                               AND C.AUD_NO  = A.AUD_NO
		                                                                               AND C.AFF_CD  = A.AFF_CD
		                                                                               AND C.AFF_DSP_CD  = B.AFF_DSP_CD
                                                                                       AND C.AUD_DSP_RQ_SNO = B.DSP_RQ_SNO ) E
		                                                  ON D.AUD_YR  =E.AUD_YR
		                                                 AND D.AUD_NO  =E.AUD_NO
		                                                 AND D.DSP_RQ_SNO = E.DSP_RQ_SNO ) G
		                                 ON F.AUD_YR = G.AUD_YR
		                                AND F.AUD_NO = G.AUD_NO
		                                AND F.RPRT_FILD_ID  = G.RPRT_FILD_ID
		WHERE G.AUD_YR =#{acpYr}
		  AND G.ACP_DVSN_CD = #{acpDvsnCd}
		  AND G.ACP_SRNO =  #{acpSrno} 
   	</select>
  	<select id="selectOrgAudDocList" parameterType="paramMap" resultType="egovMap">
  		    /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectOrgAudDocList*/
  	        SELECT 
  	         B.ACP_YR || '-' || DECODE(B.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || DECODE(B.ORG_ACP_SRNO, null, B.ACP_SRNO, B.ORG_ACP_SRNO) AS ACP_NO /* 분류번호 */
             ,  (SELECT NVL(D.RPRT_FILD_ID, '')
                 FROM  TBBADDED146M D
                 WHERE D.AUD_YR = B.AUD_YR
                 AND D.AUD_NO = B.AUD_NO
                 AND D.DSP_RQ_SNO = C.AUD_DSP_RQ_SNO
                 AND D.AFF_DSP_CD  = C.AFF_DSP_CD
                 AND D.APVR_CD='A1070'
                 GROUP BY  D.RPRT_FILD_ID) AS RPRT_FILD_ID
             , B.AUD_YR 
             , B.AUD_NO 
             , B.DSP_RQ_SNO
             , B.MG_ACP_SRNO
             , B.MG_ACP_YR
             , B.MG_ACP_DVSN_CD
             , C.TIT_TXT
             , CASE WHEN (B.ACP_YR = B.MG_ACP_YR AND B.ACP_DVSN_CD = B.MG_ACP_DVSN_CD AND B.ACP_SRNO = B.MG_ACP_SRNO) THEN '대표'
                       WHEN B.MG_DIV_CD IS NULL AND B.MG_ACP_YR IS NULL THEN '대표'
                       WHEN B.MG_DIV_CD IS NULL THEN '대표'
                       WHEN B.MG_DIV_CD = '10' THEN '병합'
                       WHEN B.MG_DIV_CD = '20' THEN '병행'
			   END AS MG_DIV_NM 
             , B.REQR_NM
             , D.MG_ACP_DVSN_CD
             , D.MG_ACP_YR
             , D.MG_ACP_SRNO
             , B.ACP_DVSN_CD
             , B.ACP_YR
             , B.ACP_SRNO
             , ( SELECT AGGR_CONCAT(DOC_ID, ',') FROM  TBBADFRE103M
                    WHERE ACP_DVSN_CD = B.ACP_DVSN_CD
                    AND ACP_YR = B.ACP_YR
                    AND ACP_SRNO = B.ACP_SRNO 
                    AND RPRT_CD IN ( 'D10200100','D10400100','E10200100', 'E10400100')) AS DOC_LIST
         FROM TBBADFRE012M B, TBBADEAR001M C  
           ,(SELECT  MG_ACP_DVSN_CD, MG_ACP_YR, MG_ACP_SRNO , AUD_YR, AUD_NO
            	  			, ACP_DVSN_CD, ACP_YR, ACP_SRNO, DSP_RQ_SNO
        	   FROM TBBADFRE012M
             WHERE ACP_DVSN_CD =#{acpDvsnCd}
                AND ACP_YR =#{acpYr}
                AND ACP_SRNO =  #{acpSrno} 
              ) D 
       WHERE 1=1
          AND B.AUD_YR = C.AUD_YR
          AND B.AUD_NO = C.AUD_NO
          AND B.DSP_RQ_SNO = C.DSP_RQ_SNO
         
          AND B.MG_ACP_DVSN_CD = D.MG_ACP_DVSN_CD
          AND B.MG_ACP_YR = D.MG_ACP_YR
          AND B.MG_ACP_SRNO = D.MG_ACP_SRNO 
          
          AND B.AUD_YR IS NOT NULL
          AND B.AUD_NO IS NOT NULL
     ORDER BY CASE WHEN (B.ACP_YR = B.MG_ACP_YR AND B.ACP_DVSN_CD = B.MG_ACP_DVSN_CD AND B.ACP_SRNO = B.MG_ACP_SRNO) THEN 1
                        WHEN B.MG_DIV_CD IS NULL AND B.MG_ACP_YR IS NULL THEN 1
                        WHEN B.MG_DIV_CD IS NULL THEN 1
                        WHEN B.MG_DIV_CD = '10' THEN 2
                        WHEN B.MG_DIV_CD = '20' THEN 2
                        END
                   , ACP_YR, ACP_DVSN_CD, TO_NUMBER(ACP_SRNO) ASC
  </select>
  <select id="selectSprvYn" parameterType="paramMap"  resultType="egovMap">
	    /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectSprvYn*/
	    SELECT CASE WHEN A.USR_ID = #{usrId} THEN 'Y' ELSE 'N' END AS SPVR_YN
	        , A.USR_ID , A.USR_NAM
		  FROM TBDCMACM001M A, TBBADFRE012M B
	    WHERE A.CNB = B.HNDL_CHGR_CD
           AND  B.ACP_YR = #{acpYr}
           AND B.ACP_SRNO = #{acpSrno}
           AND B.ACP_DVSN_CD = #{acpDvsnCd}
	</select>
    <select id="selectAprvIds" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.ded.dao.GEBAWD003EMapper.selectAprvIds */
        SELECT F_USR_INFO(APVR_CNB, '1') AS APVR_ID
        		, F_USR_INFO(APVR_CNB, '2') AS APVR_NM
               , APVR_PST_CD --결재자 직위 코드
               , F_CODE_NM('1000350', APVR_KND_CD) AS APVR_CD
          FROM TBDCMACM023L
         WHERE 1=1
           AND APV_DOC_NO = ( SELECT APV_RQS_ID
         			            FROM TBBADFRE103M
        				       WHERE ACP_YR = #{acpYr}
        					     AND ACP_DVSN_CD = #{acpDvsnCd}
                                 AND ACP_SRNO = #{acpSrno}
        					     AND ACP_STEP_CD = #{acpStepCd}
        					     AND DOC_ID = #{docId} )
         ORDER BY APV_SNO
    </select>
    
    <select id="selectOnlyDocIdRprtList" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.ded.dao.GEBAWD003EMapper.selectOnlyDocIdRprtList */
        SELECT T.* FROM (
	        SELECT * FROM TBBADFRE103M
	         WHERE DOC_ID = #{docId}
         	ORDER BY ACP_STEP_CD DESC
         ) T
         WHERE ROWNUM=1
    </select>
    
    <select id="downloadBmsEnforceFormHWP" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.ded.dao.GEBAWD003EMapper.downloadBmsEnforceFormHWP */
        SELECT 
			ONR_DOC_MNG_CRD_ID
		  , FL_RUT_NM
		  , SYS_FL_NM
		  , FL_NM
		  , RPRT_NM
		  , ONR_HNDL_NO
		  , B.DOC_ID
		FROM TBDCMACM103L A  INNER JOIN TBBADDED103M B
		         ON A.ONR_DOC_MNG_CRD_ID = B.APV_RQS_ID
      WHERE A.ONR_DOC_MNG_CRD_ID = #{docId}
          AND A.FL_DES='body'
       
    </select>
    
    <select id="selectWrtUserInfo" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.ded.dao.GEBAWD003EMapper.selectWrtUserInfo */
	     SELECT 
	        ( SELECT B.DPT_CD
		        FROM  TBDCMACM001M A INNER JOIN  TBDCMACM002M B
	      			 ON A.DPT_CD = B.DPT_CD
            WHERE A.USR_ID =  C.DOC_WRT_ID ) AS DPT_CD
			 FROM  TBBADFRE103M C
			  WHERE 1=1  
			  AND C.ACP_YR = #{acpYr}
			  AND C.ACP_DVSN_CD = #{acpDvsnCd}
			  AND C.ACP_SRNO = #{acpSrno}
			  AND C.RPRT_CD IN ('D10200100','E10400100') --심사/재심 결정문
    </select>
    
    <select id="selectBruchfApvYn" parameterType="paramMap" resultType="java.lang.String">
    <![CDATA[
    	/* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectBruchfApvYn */
        SELECT NVL(MAX(CASE WHEN F.USR_DFN_TXT_2 IN ('0055600','0055700','0010600','0067400') AND C.RPRT_CD = 'D10200200' THEN 'Y' --심사 편집권한 : 차장 또는 본부장 결재 전까지
                            WHEN F.USR_DFN_TXT_2 IN ('0015800','0055600','0055700','0010600','0067400') AND C.RPRT_CD IN ('E10200200','E10400200') THEN 'Y' --재심의 편집권한 : 국장 단장 실장 결재 전까지
                            ELSE 'N' END), 'N') AS BRUCHF_APV_YN
          FROM TBBADFRE103M C 
    INNER JOIN TBDCMACM023L D ON C.APV_RQS_ID = D.APV_DOC_NO
    INNER JOIN TBDCMACM001M E ON E.CNB = D.APVR_CNB
LEFT OUTER JOIN TBDCMACM013C F ON F.CMM_CD_DVSN_CD = '1000855' AND F.CD = E.INN_RANK_CD
         WHERE D.APV_SNO <> 1
           AND C.RPRT_CD IN ('D10200200', 'E10200200','E10400200')
           AND D.APVR_STA_CD IN ('202','203','204')
           AND C.DOC_ID = #{docId}
           AND D.APV_SNO = (SELECT MAX(T2.APV_SNO) 
                             FROM TBBADFRE103M T1 
                       INNER JOIN TBDCMACM023L T2 ON T1.APV_RQS_ID = T2.APV_DOC_NO
                            WHERE T2.APV_SNO <> 1
                              AND T1.RPRT_CD IN ('D10200200','E10200200','E10400200')
                              AND T2.APVR_STA_CD IN ('202','203','204')
                              AND T1.DOC_ID = #{docId})
    ]]>
    </select>
    
    <select id="selectAprvListInfo" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.bad.ded.dao.GEBAWD003EMapper.selectAprvListInfo */
        SELECT L.APV_SNO
			     , L.APV_DOC_NO
			     , CASE WHEN L.APVR_STA_CD='206' THEN  '(代)' ||
			     			F_USR_INFO(( SELECT K.APVR_CNB FROM TBDCMACM023L K
			                                   WHERE K.APV_DOC_NO =  L.APV_DOC_NO
			                                      AND K.APV_DVSN_CD =  L.APV_DVSN_CD
			                                      AND K.APV_SNO =  L.APV_SNO
			                                      AND K.APVR_STA_CD = '203'
			                                      AND K.APVR_KND_CD='6' ),'2')  ELSE F_USR_INFO (L.APVR_CNB,'2') END AS APVR_USR_NAM
			     , F_USR_INFO (L.APVR_CNB,'1') AS USR_ID
			     , DECODE(L.ONR_PST_NM, NULL, F_DPT_INFO (L.APVR_DPT_CD,'1') || ' ' || F_CODE_NM ('1000176',L.APVR_PST_CD) , L.ONR_PST_NM ) AS APVR_DPT_NM
			     , L.APVR_DPT_CD
			     , F_CODE_NM ('1000176',L.APVR_PST_CD) AS APVR_PST_NM
			     , L.APVR_PST_CD
			     , TO_CHAR(L.APV_DH, 'YYYY-MM-DD HH24:MI:SS') AS APV_DH
			     , L.APVR_STA_CD
			     , L.APVR_CNB
			     , L.APVR_KND_CD 
	   FROM TBDCMACM023L L
         WHERE APV_DOC_NO = (
         			             SELECT  APV_RQS_ID FROM TBBADDED103M C
		                                 , ( SELECT A.AUD_YR, A.AUD_NO  
		                                         FROM  TBBADFRE012M A
		                                          WHERE  A.ACP_YR = #{acpYr}
		                                          AND A.ACP_DVSN_CD = #{acpDvsnCd}
		                                         AND A.ACP_SRNO = #{acpSrno} ) D
                                 WHERE C.AUD_YR = D.AUD_YR
                                    AND C.AUD_NO = D.AUD_NO
                                    AND C.DOC_ID = #{docId}
                           )
         <if test="AssistantYn == null or AssistantYn == ''">
         AND APVR_KND_CD NOT IN ( '4','6' ) --협조자/대결자 제외
         </if>
        <if test="AssistantYn != null and AssistantYn != ''">
         AND APVR_KND_CD IN ( '4' ) --협조자만 조회
         </if>
      ORDER BY L.APV_SNO, L.APVR_KND_CD
    </select>
    
    <select id="selectAcpAddressList" parameterType="paramMap" resultType="egovMap">
    /* kr.go.bai.eip.bad.ded.dao.GEBAWD003EMapper.selectAcpAddressList */
    SELECT CASE WHEN AGT_AD IS NOT NULL THEN AGT_ZCD ELSE ZCD END AS ZCD
             , CASE WHEN AGT_AD IS NOT NULL THEN AGT_AD ELSE AD END AS AD
             , '' AS AGT_ZCD
             , '' AS AGT_AD
             , '' AS AGT_DTL_AD
             , '' AS AGT_FULL_AD
             , '' AS AGT_NM
             , CASE WHEN AGT_AD IS NOT NULL THEN AGT_ZCD ELSE ZCD END AS REQR_ZCD
             , CASE WHEN AGT_AD IS NOT NULL THEN AGT_AD ELSE AD END AS REQR_AD
             , CASE WHEN AGT_AD IS NOT NULL THEN AGT_DTL_AD ELSE DTL_AD END AS REQR_DTL_AD
             , CASE WHEN AGT_AD IS NOT NULL THEN AGT_AD || ' ' || AGT_DTL_AD ELSE AD || ' ' || DTL_AD  END AS REQR_FULL_AD
             , CASE WHEN AGT_AD IS NOT NULL THEN AGT_NM ELSE REQR_NM END AS REQR_NM
     FROM TBBADFRE012M
    WHERE 1=1
    <if test="keyList != null and keyList != '' "> 
        AND
        <foreach collection="keyList" item="keyList" index="index" separator="OR" open="(" close=")">
            ( ACP_YR = #{keyList.acpYr} AND ACP_DVSN_CD = #{keyList.acpDvsnCd} AND ACP_SRNO = #{keyList.acpSrno} )
         </foreach>
     ORDER BY ACP_YR, ACP_DVSN_CD, ACP_SRNO
    </if>
    </select>
    
    <select id="selectUsrInfo" parameterType="String" resultType="egovMap">
    /* kr.go.bai.eip.bad.ded.dao.GEBAWD003EMapper.selectUsrInfo */
    SELECT A.USR_ID
		 , A.CNB
		 , A.USR_NAM
		 , F_CODE_NM('1000173',A.RANK_CD) AS RANK_NM
	     , F_CODE_NM('1000176',A.PST_CD)  AS PST_NM
	     , F_CODE_NM('1000161',A.INN_RANK_CD)  AS INN_RANK_NM
	     , F_DPT_INFO(A.DPT_CD,'1') AS DPT_NM
	     , TO_CHAR(A.FNL_MDF_DH,'YYYY-MM-DD HH24:MI:SS') AS FNL_MDF_DH
	 	 , A.RANK_CD
	 	 , A.PST_CD
	 	 , A.INN_RANK_CD
	 	 , A.DPT_CD
	 FROM TBDCMACM001M A
	WHERE A.CNB = #{param}
    </select>
    
    
    <select id="selectLawRprtList" parameterType="paramMap" resultType="egovMap">
         /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectLawRprtList*/
         /*D10200900(E10400700):법률자문검토보고서, D10200500(E10400300):법률자문요청서, D10200800(E10400600):법률자문의견서*/
		<![CDATA[
         SELECT A.DOC_ID
              , A.RPRT_NM
              , A.RPRT_CD
              , B.LEGAL_REQ_SRNO
           FROM TBBADFRE103M A
     INNER JOIN TBBADDED126M B ON (B.WRK_YR = A.ACP_YR AND B.WRK_DVSN_CD = DECODE(A.ACP_DVSN_CD,'1','D10','2','E10','') AND B.WRK_NO = A.ACP_SRNO AND B.LEGAL_REQ_SRNO = A.REF_ID)
          WHERE 1=1
            AND A.ACP_YR = #{acpYr}
            AND A.ACP_DVSN_CD = #{acpDvsnCd}
            AND A.ACP_SRNO = #{acpSrno}
            AND A.ACP_STEP_CD IN ('D1020','E1040')
            AND A.RPRT_CD IN ('D10200900','D10200500','D10200800','E10400300','E10400600','E10400700')
            AND A.APV_STA_CD >= DECODE(A.RPRT_CD,'D10200900','30','D10200500','30','E10400700','30','E10400300','30','10')
       ORDER BY B.LEGAL_REQ_SRNO, A.RPRT_CD
       ]]>
    </select>
    
    <select id="selectAudOrgRprtYn" parameterType="paramMap" resultType="egovMap">
    /* kr.go.bai.eip.bad.ded.dao.GEBAWD003EMapper.selectAudOrgRprtYn */
        SELECT B.AUD_YR
                , B.AUD_NO
              FROM TBBADFRE103M A 
                   INNER JOIN TBBADDED001M B
                           ON B.AUD_YR  = SUBSTR(A.REF_ID, 1,4)
                          AND B.AUD_NO = SUBSTR(A.REF_ID, 6,3)
            WHERE A.ACP_YR = #{acpYr}
               AND A.ACP_DVSN_CD =#{acpDvsnCd}
               AND A.ACP_SRNO =#{acpSrno}
               AND A.DOC_ID = #{docId}
    </select>
    
    
    <select id="selectOrgEviDcmbList" parameterType="paramMap" resultType="egovMap">
	<![CDATA[
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectOrgEviDcmbList 위 */
		 SELECT T.* FROM (
			SELECT D1.AUD_YR,
				    D1.AUD_NO,
				    D1.EVI_DCMB_SNO,
                    D1.AUD_DCM_DOC_ID AS ACP_DCM_DOC_ID,
                    D1.AUD_DCM_CRE_ID,
				    D1.AUD_KND_CD,
				    D1.AUD_GRN_NO,
				    D1.EVI_DCM_DVSN_CD,
	                F_CODE_NM('1000776',D1.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM,
	                D2.FOLDER_NM,
				    D1.FILE_NM,
				    D1.ISUE_DY,
				    D1.EVI_DCMB_DVSN_CD,
				    D1.SORT_SNO,
				    D1.AFF_SNO,
	                (SELECT USR_NAM FROM TBDCMACM001M D3 WHERE D3.USR_ID = D1.AUD_DCM_CRE_ID) AS USR_NAM,
	                D1.EVI_DCM_NO,
	                D1.EVI_DCM_GRP_SNO
	 		   FROM TBBADDED108D D1
	LEFT OUTER JOIN TBBADDED108M D2 ON D1.AUD_YR = D2.AUD_YR AND D1.AUD_NO = D2.AUD_NO AND D1.EVI_DCM_GRP_SNO = D2.EVI_DCMB_SNO
	          WHERE D1.AUD_YR = #{audYr}
	            AND D1.AUD_NO = #{audNo}
	            AND D1.EVI_DCM_DVSN_CD <> '99'
	            AND D1.DOC_STA_CD = 'Y'
	            AND D1.DESTROY_YN = 'N'
	]]>
          <if test=" searchByUserYn == 'Y'.toString() ">
	            AND (#{usrId} IN ( SELECT A.AUD_DCM_SHARE_ID
                                          FROM TBBADDED108L A
                                        WHERE A.AUD_YR =D1.AUD_YR
                                           AND A.AUD_NO = D1.AUD_NO
                                           AND A.AUD_DCM_CRE_ID = D1.AUD_DCM_CRE_ID) OR D1.AUD_DCM_CRE_ID =#{usrId})
	   	   </if>
           <if test="eviDcmDvsnCd != null and eviDcmDvsnCd != ''">
           AND D1.EVI_DCM_DVSN_CD = #{eviDcmDvsnCd}
           </if>
           <if test="folderNm != null and folderNm != ''">
           AND D2.FOLDER_NM LIKE '%' || #{folderNm} || '%'
           </if>
           <if test="fileNm != null and fileNm != ''">
           AND D1.FILE_NM LIKE '%' || #{fileNm} || '%'
           </if>
           <if test="usrNam != null and usrNam != ''">
           AND  (SELECT USR_NAM FROM TBDCMACM001M D3 WHERE D3.USR_ID = D1.AUD_DCM_CRE_ID)  LIKE '%' || #{usrNam} || '%'
           </if>
            <if test="strAudDcmId != null and strAudDcmId != ''">
           AND  D1.AUD_DCM_DOC_ID IN (${strAudDcmId})
           </if>
            ) T
	  ORDER BY T.USR_NAM, T.EVI_DCM_DVSN_CD, T.EVI_DCM_NO

	</select>
	
	<insert id="insertBADFRE120M" parameterType="paramMap">
    /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.insertBADFRE120M*/
    INSERT INTO TBBADFRE120M (
    	ACP_DVSN_CD, ACP_YR, ACP_SRNO, EVI_DCM_MPP_SNO, ACP_KND_CD, ACP_GRN_NO, 
    	 DOC_ID, ACP_DCM_DOC_ID, RPRT_FILD_ID, EVI_DCMB_SNO, EVI_MPP_DVSN_CD, SORT_SNO, FRT_USR_ID, FNL_USR_ID,
          FNL_DEAL_DPT_CD, FNL_MNU_ID, FRT_REGI_DH, FNL_MDF_DH) 
          
     VALUES (#{acpDvsnCd}, 
			     #{acpYr},
			     #{acpSrno},
			 	 #{eviDcmMppSno},
			 	 #{acpKndCd},
			 	 #{acpGrnNo},
			 	 #{docId},
			 	 #{acpDcmDocId},
                 #{rprtFildId},
                 #{eviDcmbSno},
                 #{eviMppDvsnCd},
                 #{eviDcmMppSno},
                 #{usrId},
                 #{usrId},
                 #{dptCd},
                 #{menuNo}, SYSDATE, SYSDATE)
                  
    </insert>
    
	<delete id="deleteBADFRE120M" parameterType="paramMap">
    <![CDATA[
	    /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.deleteBADFRE120M*/
	    DELETE FROM TBBADFRE120M
	    WHERE 1=1
     ]]>
     <if test="mgDivCd != '10'" >
        AND ACP_DVSN_CD = #{delAcpDvsnCd}
	    AND ACP_YR = #{delAcpYr}
	    AND ACP_SRNO = #{delAcpSrno}
     </if>
     <if test="mgDivCd == '10' " >
        AND (ACP_YR, ACP_DVSN_CD, ACP_SRNO) IN (SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO 
                                                  FROM TBBADFRE012M 
                                                 WHERE MG_ACP_YR = #{delAcpYr}
                                                   AND MG_ACP_DVSN_CD = #{delAcpDvsnCd}
                                                   AND MG_ACP_SRNO = #{delAcpSrno}) 
     </if>
     <if test="delDocId != null and delDocId != ''">
     	AND DOC_ID = #{delDocId}
     </if>
    </delete>
    
    <select id="selectMaxOpinDocEviDcmMppSno" parameterType="paramMap" resultType="egovMap">
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectMaxOpinDocEviDcmMppSno*/
        SELECT NVL(MAX(EVI_DCM_MPP_SNO),0)+1 AS EVI_DCM_MPP_SNO
          FROM TBBADFRE120M
        WHERE ACP_DVSN_CD = #{acpDvsnCd}
           AND ACP_YR = #{acpYr}
           AND ACP_SRNO = #{acpSrno}
    </select>
    
    <select id="selectOpinDocEviDocList" parameterType="paramMap" resultType="egovMap">
       /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectOpinDocEviDocList 위 */
       <![CDATA[
       SELECT A.ACP_YR || '-' || DECODE(A.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || DECODE(A.ORG_ACP_SRNO, null, A.ACP_SRNO, A.ORG_ACP_SRNO) AS ACP_NO /* 분류번호 */
            ,A.ACP_DVSN_CD /*감사종류코드 */          
			,A.ACP_YR  /*감사년도 */
            ,A.ACP_SRNO /*감사번호 */
			,C.EVI_DCMB_SNO
			,C.ACP_DCM_DOC_ID		
			,C.EVI_DCM_DVSN_CD			
            ,F_CODE_NM(DECODE(A.ACP_DVSN_CD, 1, '1000810', '1000811'), C.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM		
            ,C.FILE_NM /* 파일명 */
			,C.ISUE_DY
			,C.SORT_SNO
            ,F_USR_INFO_BY_ID(C.ACP_DCM_CRE_ID ,'2') AS FRT_USR_NM /*증거서류생성자명 */
            ,TO_CHAR(A.FRT_REGI_DH,'YYYY-MM-DD') FRT_REGI_DH  /*최초등록일시 */
            ,(SELECT COUNT(*) FROM TBBADFRE118D D
               WHERE A.ACP_YR = D.ACP_YR
                 AND A.ACP_DVSN_CD = D.ACP_DVSN_CD
                 AND A.ACP_SRNO = D.ACP_SRNO) AS CNT
            ,CASE WHEN (A.ACP_YR = A.MG_ACP_YR AND A.ACP_DVSN_CD = A.MG_ACP_DVSN_CD AND A.ACP_SRNO = A.MG_ACP_SRNO) THEN '대표'
			        WHEN A.MG_DIV_CD IS NULL AND A.MG_ACP_YR IS NULL THEN '대표'
			        WHEN A.MG_DIV_CD IS NULL THEN '대표'
			        WHEN A.MG_DIV_CD = '10' THEN '병합'
			        WHEN A.MG_DIV_CD = '20' THEN '병행'
			 END AS MG_DIV_NM /* 병합병행구분명 */
            FROM TBBADFRE012M A,
                 TBBADFRE118D C
                 , (SELECT T.MG_ACP_DVSN_CD, T.MG_ACP_YR, T.MG_ACP_SRNO
                 				,T.ACP_DVSN_CD, T.ACP_YR, T.ACP_SRNO
		                FROM TBBADFRE012M T 
		               WHERE T.ACP_DVSN_CD =#{acpDvsnCd}
		               AND T.ACP_YR =#{acpYr}
		               AND T.ACP_SRNO = #{acpSrno} ) D
          WHERE 1=1
            AND C.ACP_YR = A.ACP_YR(+)
            AND C.ACP_DVSN_CD = A.ACP_DVSN_CD(+)
            AND C.ACP_SRNO = A.ACP_SRNO(+)
            
            AND A.DEL_YN IS NULL
            AND C.EVI_DCM_DVSN_CD <> '99'
            ]]>
            
          <if test="mgDivCd != '10' " >
	          AND A.ACP_DVSN_CD = D.ACP_DVSN_CD
	          AND A.ACP_YR = D.ACP_YR
	          AND A.ACP_SRNO = D.ACP_SRNO
         </if>
         <if test=" mgDivCd == '10' " >
	          AND A.MG_ACP_DVSN_CD = D.MG_ACP_DVSN_CD
	          AND A.MG_ACP_YR = D.MG_ACP_YR
	          AND A.MG_ACP_SRNO = D.MG_ACP_SRNO
         </if>
        <if test="eviDcmDvsnCd != null and eviDcmDvsnCd != ''">
           AND C.EVI_DCM_DVSN_CD = #{eviDcmDvsnCd}
       </if>        
	   <if test="fileNm != null and fileNm != ''">
	       AND C.FILE_NM LIKE '%' || #{fileNm} || '%'
	   </if>	       
	   <if test="usrNam != null and usrNam != ''">
           AND  (SELECT USR_NAM FROM TBDCMACM001M D3 WHERE D3.USR_ID = C.ACP_DCM_CRE_ID)  LIKE '%' || #{usrNam} || '%'
           </if> 
        ORDER BY C.SORT_SNO
    </select>
    
    <select id="selectOpinDocOrgEviDcmbList" parameterType="paramMap" resultType="egovMap">
	<![CDATA[
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectOpinDocOrgEviDcmbList 위 */
		 SELECT T.* FROM (
			SELECT D1.AUD_YR,
				    D1.AUD_NO,
				    D1.EVI_DCMB_SNO,
                    D1.AUD_DCM_DOC_ID AS ACP_DCM_DOC_ID,
                    D1.AUD_DCM_CRE_ID,
				    D1.AUD_KND_CD,
				    D1.AUD_GRN_NO,
				    D1.EVI_DCM_DVSN_CD,
	                F_CODE_NM('1000776',D1.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM,
				    D1.FILE_NM,
				    D1.ISUE_DY,
				    D1.EVI_DCMB_DVSN_CD,
				    D1.SORT_SNO,
				    D1.AFF_SNO,
	                (SELECT USR_NAM FROM TBDCMACM001M D3 WHERE D3.USR_ID = D1.AUD_DCM_CRE_ID) AS USR_NAM,
	                D1.EVI_DCM_NO,
	                D1.EVI_DCM_GRP_SNO
	 		   FROM TBBADDED118D D1
	          WHERE D1.AUD_YR = #{audYr}
	            AND D1.AUD_NO = #{audNo}
	            AND D1.EVI_DCM_DVSN_CD <> '99'
	            AND D1.DOC_STA_CD = 'Y'
	            AND D1.DESTROY_YN = 'N'
	]]>
          <if test=" searchByUserYn == 'Y'.toString() ">
	            AND (#{usrId} IN ( SELECT A.AUD_DCM_SHARE_ID
                                          FROM TBBADDED108L A
                                        WHERE A.AUD_YR =D1.AUD_YR
                                           AND A.AUD_NO = D1.AUD_NO
                                           AND A.AUD_DCM_CRE_ID = D1.AUD_DCM_CRE_ID) OR D1.AUD_DCM_CRE_ID =#{usrId})
	   	   </if>
           <if test="eviDcmDvsnCd != null and eviDcmDvsnCd != ''">
           AND D1.EVI_DCM_DVSN_CD = #{eviDcmDvsnCd}
           </if>
           <if test="fileNm != null and fileNm != ''">
           AND D1.FILE_NM LIKE '%' || #{fileNm} || '%'
           </if>
           <if test="usrNam != null and usrNam != ''">
           AND  (SELECT USR_NAM FROM TBDCMACM001M D3 WHERE D3.USR_ID = D1.AUD_DCM_CRE_ID)  LIKE '%' || #{usrNam} || '%'
           </if>
            <if test="strAudDcmId != null and strAudDcmId != ''">
           AND  D1.AUD_DCM_DOC_ID IN (${strAudDcmId})
           </if>
            ) T
	  ORDER BY T.USR_NAM, T.EVI_DCM_DVSN_CD, T.EVI_DCM_NO

	</select>
    
    <select id="selectOpinDocEviDcmbMapList" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.selectOpinDocEviDcmbMapList 밑 */
		 SELECT DISTINCT D1.ACP_DVSN_CD ,
		        D1.ACP_YR,
			    D1.ACP_SRNO,
			    D1.EVI_DCM_MPP_SNO,
			    D1.ACP_KND_CD,
			    D1.ACP_GRN_NO,
			    D1.DOC_ID,
			    D3.FILE_NM,
			    D3.FILE_NM AS DOC_NM,
			    D1.ACP_DCM_DOC_ID,
			    D1.RPRT_FILD_ID,
			    D1.EVI_DCMB_SNO,
			    D1.EVI_MPP_DVSN_CD,
		  	    D1.SORT_SNO,
                D1.HYPER_LINK_YN,
                D3.EVI_DCM_DVSN_CD,
                F_CODE_NM(#{cmmCdDvsnCd},D3.EVI_DCM_DVSN_CD) AS EVI_DCM_DVSN_NM
 		   FROM TBBADFRE120M D1
LEFT OUTER JOIN TBBADFRE118D D3 ON D1.ACP_DVSN_CD = D3.ACP_DVSN_CD AND D1.ACP_YR = D3.ACP_YR AND D1.ACP_SRNO = D3.ACP_SRNO AND D1.EVI_DCMB_SNO = D3.EVI_DCMB_SNO AND D1.ACP_DCM_DOC_ID = D3.ACP_DCM_DOC_ID
INNER JOIN TBBADFRE012M D4 ON D1.ACP_DVSN_CD = D4.ACP_DVSN_CD AND D1.ACP_YR = D4.ACP_YR AND D1.ACP_SRNO = D4.ACP_SRNO
		WHERE 1=1
        <if test="mgDivCd != '10' " >
            AND D4.ACP_DVSN_CD = #{acpDvsnCd}
		    AND D4.ACP_YR = #{acpYr}
		    AND D4.ACP_SRNO = #{acpSrno}
        </if>
        <if test="mgDivCd == '10' " >
            AND D4.MG_ACP_DVSN_CD = #{acpDvsnCd}
            AND D4.MG_ACP_YR = #{acpYr}
            AND D4.MG_ACP_SRNO = #{acpSrno}
        </if>
		<if test="acpDcmDocId != null and acpDcmDocId != ''">
		    AND D1.ACP_DCM_DOC_ID = #{acpDcmDocId}
		</if>
		<if test="rprtFildId != null and rprtFildId != ''">
		    AND D1.RPRT_FILD_ID = #{rprtFildId}
		</if>
        <if test="hyperLinkYn != null and hyperLinkYn != ''">
            AND D1.HYPER_LINK_YN = #{hyperLinkYn}
        </if>
        ORDER BY D1.ACP_SRNO, D1.SORT_SNO
	</select>
	
	<update id="updateOpinDocDcmFileNm" parameterType="paramMap">
        <![CDATA[
        /* kr.go.bai.eip.geb.awd.dao.GEBAWD003EMapper.updateOpinDocDcmFileNm */
          UPDATE TBBADFRE118D
             SET FILE_NM = #{fileNm}
           WHERE 1=1
             AND ACP_DVSN_CD = #{acpDvsnCd}
             AND ACP_YR = #{acpYr}
             AND ACP_SRNO = #{acpSrno}
             AND EVI_DCMB_SNO = #{eviDcmbSno}
             AND ACP_DCM_DOC_ID = #{acpDcmDocId}
        ]]>
    </update>
	
</mapper>