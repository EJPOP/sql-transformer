<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">   
<mapper namespace="kr.go.bai.eip.fdm.adm.dao.FDMADM005PMapper">	

	<resultMap id="boardMap" type="egovMap" >
        <result property="META_INF_TXT" column="META_INF_TXT" javaType="java.lang.String" jdbcType="CLOB" />
    </resultMap>

	<insert id="insertTskDocMetaInfData" parameterType="paramMap">
		/* kr.go.bai.eip.fdm.adm.dao.FDMADM005PMapper.insertTskDocMetaInfData*/
		INSERT 
		  INTO TBFDMADM004M (
					TSK_KND_CD,
					TSK_STEP_CD,
					TSK_DOC_CD,
					META_INF_SNO,
					META_INF_DES,
					ADM_YN,
					REGN_ID, 
					USE_YN,
					FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
				 ) 
				 VALUES (
				 	#{tskKndCd},
					#{tskStepCd},
					#{tskDocCd},
					(SELECT NVL(MAX(META_INF_SNO),0)+1 FROM TBFDMADM004M),
					#{metaInfDes},
					#{admYn},
					#{usrId},
					'Y',
					#{usrId},    /*세션정보*/
					#{usrId},
					#{dptCd},
					#{menuNo},
					SYSDATE,
					SYSDATE
				)
	</insert>
	
	<insert id="insertTskDraftDocData" parameterType="paramMap">
		/* kr.go.bai.eip.fdm.adm.dao.FDMADM005PMapper.insertTskDraftDocData*/
		INSERT 
		  INTO TBFDMADM005M (
					TSK_KND_CD,
					TSK_STEP_CD,
					TSK_DOC_CD,
					META_INF_SNO,
					META_INF_TXT,
					FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH 
				 ) 
				 VALUES (
				 	#{tskKndCd},
					#{tskStepCd},
					#{tskDocCd},
					(SELECT NVL(MAX(META_INF_SNO),0)+1 FROM TBFDMADM005M),
					#{tskDocData},
					#{usrId},    /*세션정보*/
					#{usrId},
					#{dptCd},
					#{menuNo},
					SYSDATE,
					SYSDATE
				)
	</insert>
	
	<select id="selectDocMetaInfData" parameterType="paramMap" resultMap="boardMap" >
		<![CDATA[
			/* kr.go.bai.eip.fdm.adm.dao.FDMADM005PMapper.selectDocMetaInfData*/
				SELECT T1.TSK_KND_CD,
					       T1.TSK_STEP_CD,
					       T1.TSK_DOC_CD,
					       T1.META_INF_SNO,
					       T1.META_INF_DES,
					       T1.ADM_YN,
					       T1.REGN_ID,
					       T1.USE_YN,
					       T2.META_INF_TXT
					  FROM TBFDMADM004M T1,
					       TBFDMADM005M T2
					 WHERE 1=1
					   AND T1.TSK_KND_CD = T2.TSK_KND_CD
					   AND T1.TSK_STEP_CD = T2.TSK_STEP_CD
					   AND T1.TSK_DOC_CD = T2.TSK_DOC_CD
					   AND T1.META_INF_SNO = T2.META_INF_SNO
		]]>
			       <if test="metaInfSno != null and metaInfSno != ''">
			  	     AND T1.META_INF_SNO = #{metaInfSno}
			       </if>
			  	     ORDER BY T1.META_INF_SNO DESC
		</select>
		
		<update id="updateTskDocMetaInfData" parameterType="paramMap">
			/* kr.go.bai.eip.fdm.adm.dao.FDMADM005PMapper.updateTskDocMetaInfData*/
			UPDATE TBFDMADM004M
			   SET META_INF_DES = #{metaInfDes},
	               FNL_MDF_DH = SYSDATE,
	               FNL_USR_ID = #{usrId},
	               FNL_DEAL_DPT_CD =#{dptCd}
			 WHERE META_INF_SNO = #{metaInfSno}
		</update>
		
		<update id="updateTskDraftDocData" parameterType="paramMap">
			/* kr.go.bai.eip.fdm.adm.dao.FDMADM005PMapper.updateTskDraftDocData*/
			UPDATE TBFDMADM005M
			   SET META_INF_TXT = #{tskDocData},
	               FNL_MDF_DH = SYSDATE,
	               FNL_USR_ID = #{usrId},
	               FNL_DEAL_DPT_CD =#{dptCd}
			 WHERE META_INF_SNO = #{metaInfSno}
		</update>
		
		<delete id="delTskDraftDocData" parameterType="paramMap">
			/* kr.go.bai.eip.fdm.adm.dao.FDMADM005PMapper.delTskDraftDocData*/
			 DELETE FROM TBFDMADM005M			   
			 WHERE 1=1 
			 	AND TSK_KND_CD = #{tskKndCd}
			 	AND TSK_STEP_CD = #{tskStepCd}
			 	AND TSK_DOC_CD = #{tskDocCd}
			 	AND META_INF_SNO = #{metaInfSno};
		</delete>
		<delete id="delTskDocMetaInfData" parameterType="paramMap">
			/* kr.go.bai.eip.fdm.adm.dao.FDMADM005PMapper.delTskDocMetaInfData*/
			 DELETE FROM TBFDMADM004M			   
			 WHERE 1=1 
			 	AND TSK_KND_CD = #{tskKndCd}
			 	AND TSK_STEP_CD = #{tskStepCd}
			 	AND TSK_DOC_CD = #{tskDocCd}
			 	AND META_INF_SNO = #{metaInfSno};
		</delete>
	
</mapper>
