<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">   
<mapper namespace="kr.go.bai.eip.fdm.adm.dao.FDMADM001EMapper">	
		
	<select id="selectAudDocList" parameterType="paramMap" resultType="egovMap" >
	/* kr.go.bai.eip.fdm.adm.dao.FDMADM001EMapper.selectAudDocList*/
	<include refid="include.pageSelct" />
			SELECT AUD_DOC_CD,
				   AUD_DOC_NM,
				   TSK_KND_CD,
				   F_CODE_NM('1000787',TSK_KND_CD) AS TSK_KND_NM,
				   AUD_STEP_CD,
				   F_CODE_NM('1000785',AUD_STEP_CD) AS AUD_STEP_NM,				   				   
				   MNT_CHO_CD,
				   F_CODE_NM('1000768',MNT_CHO_CD) AS MNT_CHO_NM,
				   APV_WAY_CD,
				   F_CODE_NM('1000767',APV_WAY_CD) AS APV_WAY_NM,
				   AUD_DOC_KND_CD,
				   F_CODE_NM('1000769',AUD_DOC_KND_CD) AS AUD_DOC_KND_NM,
				   DECODE(TRNM_POSS_YN,'Y','가능','불가능')          AS TRNM_POSS_YN,
				   DOC_PRD_DPT_CD,
				   F_CODE_NM('1000771',DOC_PRD_DPT_CD) AS DOC_PRD_DPT_NM,
				   CON_PGM_CD,
				   F_CODE_NM('1000790',CON_PGM_CD) AS CON_PGM_NM
			  FROM (
					SELECT AUD_DOC_CD,
						   F_CODE_NM('1000786',AUD_DOC_CD) AS AUD_DOC_NM, 
						   TSK_KND_CD,
						   AUD_STEP_CD,
						   MNT_CHO_CD,
						   APV_WAY_CD,
						   AUD_DOC_KND_CD,
						   TRNM_POSS_YN,
						   DOC_PRD_DPT_CD,
						   CON_PGM_CD
					  FROM TBFDMADM001M
					 WHERE 1 = 1
					   <if test="tskKndCd != null and tskKndCd != ''">
				       AND TSK_KND_CD  = #{tskKndCd}
				       </if>
					   <if test="audStepCd != null and audStepCd != ''">
				       AND AUD_STEP_CD  = #{audStepCd}
				       </if>
				  ORDER BY TSK_KND_CD, AUD_STEP_CD, AUD_DOC_CD
			  		)
			WHERE 1 = 1
			  AND AUD_STEP_CD != 'A0000' /* 문서작성기 조회제거 */
			<if test="audDocNm != null and audDocNm != ''">
		    AND AUD_DOC_NM LIKE '%' || #{audDocNm} || '%'
		    </if>
			
	<include refid="include.pageOrder" />
	</select>
	
	<select id="selectAudDocTmpList" parameterType="paramMap" resultType="egovMap" >
		/* kr.go.bai.eip.fdm.adm.dao.FDMADM001EMapper.selectAudDocTmpList*/
		 SELECT ROWNUM AS NUM,
		 		AUD_DOC_CD,
			    DTIL_AUD_DOC_NO,
			    DTIL_AUD_DOC_NM,
			    DOC_ID,
			    DOC_KND_CD,
			    F_CODE_NM('1000782',DOC_KND_CD) AS DOC_KND_NM,
			    HIDDEN_YN,
		    	CASE WHEN HIDDEN_YN = 'Y' THEN '미출력'
		             ELSE '출력' END AS ETC_DOC_DIS_YN
	       FROM TBFDMADM002M
		  WHERE AUD_DOC_CD = #{audDocCd}
	</select>
	
	<delete id="deleteFDMADM001M" parameterType="paramMap">
		/* kr.go.bai.eip.fdm.adm.dao.FDMADM001EMapper.deleteFDMADM001M*/
		DELETE 
		  FROM TBFDMADM001M 
         WHERE AUD_DOC_CD IN ( #{audDocCd} )
	</delete>
	
	<delete id="deleteFDMADM002M" parameterType="paramMap">
		/* kr.go.bai.eip.fdm.adm.dao.FDMADM001EMapper.deleteFDMADM002M*/
		DELETE 
		  FROM TBFDMADM002M 
         WHERE 1 = 1
       	 <if test="audDocCd != null and audDocCd != ''">
       	   AND AUD_DOC_CD = #{audDocCd}
       	 </if>	         	
         <if test="dtilAudDocNo != null and dtilAudDocNo != ''">
           AND DTIL_AUD_DOC_NO IN ( #{dtilAudDocNo} )
         </if>
	</delete>
	
	
	<select id="selectAudStepList" parameterType="paramMap" resultType="egovMap" >
	<![CDATA[
		/* kr.go.bai.eip.fdm.adm.dao.FDMADM001EMapper.selectAudStepList*/
			SELECT CMM_CD_DVSN_CD,
			 	   CD,
			 	   CD_NM
		      FROM TBDCMACM013C
		     WHERE 1 = 1
		       AND CD <> '000000000'
		       AND CMM_CD_DVSN_CD = #{tskKndCdDvsnCd}		       
		       AND USR_DFN_TXT_1 = #{cmmCdDvsnCd}
	]]>
		       <if test="tskKndCd != null and tskKndCd != ''">
		       AND USR_DFN_TXT_2 = #{tskKndCd}
		       </if>
  	      ORDER BY CMM_CD_DVSN_CD, CD, CD_NM	
	</select>
	
	<select id="selectDocId" parameterType="paramMap" resultType="egovMap" >
		/* kr.go.bai.eip.fdm.adm.dao.FDMADM001EMapper.selectAudStepList*/
		SELECT DECODE(#{docType},'HWP',HWP_DOC_ID,DOC_ID) AS DOC_ID
		     , DOC_ID		                              AS ODT_DOC_ID
		     , HWP_DOC_ID                                 AS HWP_DOC_ID
	      FROM TBFDMADM002M
		 WHERE AUD_DOC_CD = #{audDocCd}
		 <if test="dtilAudDocNo != null and dtilAudDocNo != ''">
		   AND DTIL_AUD_DOC_NO = #{dtilAudDocNo}
		 </if>
	</select>
	
	<select id="selectDrftDocList" parameterType="paramMap" resultType="egovMap" >
	    /* 감사문서 기안문 목록 조회 */
		/* kr.go.bai.eip.fdm.adm.dao.FDMADM001EMapper.selectDrftDocList*/
		 SELECT ROWNUM AS NUM
		 	  ,	AUD_DOC_CD
			  , DTIL_AUD_DOC_NO
			  , DRFT_DOC_NO
			  , DRFT_DOC_NM
			  , DOC_ID
			  , RULE_TXT
	       FROM TBFDMADM003M
		  WHERE AUD_DOC_CD = #{audDocCd}
		    AND DTIL_AUD_DOC_NO = #{dtilAudDocNo}
		    ORDER BY DRFT_DOC_NM DESC
	</select>
	
	<select id="selectDrftDocId" parameterType="paramMap" resultType="egovMap" >
	    /* 감사문서 기안문 DocId 조회  */
		/* kr.go.bai.eip.fdm.adm.dao.FDMADM001EMapper.selectDrftDocId*/
		SELECT DOC_ID
	      FROM TBFDMADM003M
		 WHERE AUD_DOC_CD = #{audDocCd}
		 <if test="dtilAudDocNo != null and dtilAudDocNo != ''">
		   AND DTIL_AUD_DOC_NO = #{dtilAudDocNo}
		 </if>
		  <if test="drftDocNo != null and drftDocNo != ''">
		   AND DRFT_DOC_NO = #{drftDocNo}
		 </if>
	</select>
	
	<delete id="deleteFDMADM003M" parameterType="paramMap">
	    /* 감사문서 기안문 삭제  */
		/* kr.go.bai.eip.fdm.adm.dao.FDMADM001EMapper.deleteFDMADM003M*/
		DELETE 
		  FROM TBFDMADM003M 
         WHERE 1 = 1
       	 <if test="audDocCd != null and audDocCd != ''">
       	   AND AUD_DOC_CD = #{audDocCd}
       	 </if>	         	
         <if test="dtilAudDocNo != null and dtilAudDocNo != ''">
           AND DTIL_AUD_DOC_NO IN ( #{dtilAudDocNo} )
         </if>
         <if test="drftDocNo != null and drftDocNo != ''">
		   AND DRFT_DOC_NO IN ( #{drftDocNo} )
		 </if>
	</delete>
	
</mapper>
