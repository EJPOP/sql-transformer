<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.fdm.btm.dao.FDMBTM001PMapper">
	
	<select id="getAudDocTmpData" parameterType="paramMap" resultType="egovMap">
		/* kr.go.bai.eip.fdm.btm.dao.FDMBTM001PMapper.getAudDocTmpData*/
		SELECT AUD_DOC_TMP_CD,
			   TSK_KND_CD,
			   (DECODE(#{docType},'HWP',HWP_DOC_ID,DOC_ID)) AS DOC_ID
		  FROM TBFDMBTM001M
		 WHERE AUD_DOC_TMP_CD = #{audDocTmpCd}
	</select>
		
	<insert id="insertFDMBTM001M" parameterType="paramMap">
		/* kr.go.bai.eip.fdm.btm.dao.FDMBTM001PMapper.insertFDMBTM001M*/
		INSERT INTO TBFDMBTM001M (AUD_DOC_TMP_CD,
								  TSK_KND_CD,
								  DOC_ID,
								  HWP_DOC_ID,
								  FRT_USR_ID,
								  FNL_USR_ID,
								  FNL_DEAL_DPT_CD,
								  FNL_MNU_ID,
								  FRT_REGI_DH,
								  FNL_MDF_DH)
						  VALUES (#{audDocTmpCd},
				  		          #{tskKndCd},
				  		          (DECODE(#{docType},'ODT',#{docId},'')),
				  		          (DECODE(#{docType},'HWP',#{docId},'')),
				  		          #{usrId},    /*세션정보*/
                                  #{usrId},
                                  #{dptCd},
                                  #{menuNo},
                                  SYSDATE,
                                  SYSDATE)
	</insert>
	
	<update id="updateFDMBTM001M" parameterType="paramMap">
		/* kr.go.bai.eip.fdm.btm.dao.FDMBTM001PMapper.updateFDMBTM001M*/
	<![CDATA[
		UPDATE TBFDMBTM001M 
		   SET TSK_KND_CD = #{tskKndCd}		
		   	]]>
		  <if test="docType == 'ODT'">
               ,DOC_ID = DECODE(DOC_ID,NULL,#{docId},DOC_ID)
               </if>
           <if test="docType == 'HWP'">
               ,HWP_DOC_ID = DECODE(HWP_DOC_ID,NULL,#{docId},HWP_DOC_ID)
            </if> 
		<![CDATA[
 		   		, FNL_USR_ID = #{usrId} 
 		   		, FNL_MDF_DH = SYSDATE 
		 WHERE AUD_DOC_TMP_CD = #{audDocTmpCd}
		]]>
	</update>

	<select id="selectAudDocTmpList" parameterType="paramMap" resultType="egovMap" >
	<![CDATA[
		/* kr.go.bai.eip.fdm.btm.dao.FDMBTM001PMapper.selectAudDocTmpList*/
		SELECT CMM_CD_DVSN_CD,
	 	       CD AS AUD_DOC_TMP_CD,
	 	       CD_NM
	      FROM TBDCMACM013C
	     WHERE 1 = 1
	       AND CD <> '000000000'
	       AND CMM_CD_DVSN_CD = '1000770'
	       AND CD NOT IN (SELECT AUD_DOC_TMP_CD 
			    	        FROM TBFDMBTM001M
	]]>
			    	       <if test="audDocTmpCd != null and audDocTmpCd != ''">
			    	       <![CDATA[
					       WHERE AUD_DOC_TMP_CD <> #{audDocTmpCd}
					       ]]>
					       </if>
	                     )
	</select>
	
</mapper> 