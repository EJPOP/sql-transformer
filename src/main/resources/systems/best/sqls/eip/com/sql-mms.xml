<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.com.dao.MmsMapper">

	<!-- 감사원 MMS 발신 전화번호 조회 -->
	<select id="selectMmsCallFrom" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.com.dao.MmsMapper.selectMmsCallFrom */
		<![CDATA[
			SELECT NVL(TNB,'0220112191') FROM TBDCMACM002M
   			 WHERE DPT_CD = #{fnlDealDptCd}
		]]>
	</select>
	
	<!-- 감사원 제보 MMS 발신 전화번호 조회 -->
	<select id="selectCspDcpMmsCallFrom" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.com.dao.MmsMapper.selectCspDcpMmsCallFrom */
		<![CDATA[
			SELECT NVL(USR_DFN_TXT_1,'02-2011-2191') FROM TBDCMACM013C 
			 WHERE CMM_CD_DVSN_CD = '1000144'
			   AND CD = #{ralAcpDptCd}
		]]>
	</select>
	
	<!-- 감사원 제보 MMS 발신 전화번호 조회 -->
	<select id="selectCspDcpMmsCallFrom2" parameterType="paramMap" resultType="String">
		/* kr.go.bai.eip.com.dao.MmsMapper.selectCspDcpMmsCallFrom */
		<![CDATA[
			SELECT CASE WHEN S1.USR_DFN_TXT_1 IS NULL THEN '02-2011-2191'
						WHEN LENGTH(S1.USR_DFN_TXT_1) > 4 THEN S1.USR_DFN_TXT_1
						ELSE '02-2011-' || S1.USR_DFN_TXT_1 END 
   			  FROM TBDCMACM013C S1
   			 WHERE S1.CMM_CD_DVSN_CD = '1000144'
   			   AND S1.CD = ( SELECT S2.RAL_BLT_DIV_CD FROM TBDCMACM001M S2 WHERE USR_ID = #{fnlUsrId})
		]]>
	</select>
	
	<!-- 심사청구/재심의 접수 MMS 발신, 수신 전화번호 조회 -->
    <select id="selectFreMmsTnb" parameterType="paramMap" resultType="egovMap">
    	/* kr.go.bai.eip.com.dao.MmsMapper.selectFreMmsTnb */
        SELECT REPLACE((SELECT ST.HOM_TNB FROM TBDCMACM001M ST WHERE ST.CNB = #{cnb})  ,'-','') AS CALL_TO
		     , REPLACE((SELECT ST.HNDL_CHGR_TNB_1 || ST.HNDL_CHGR_TNB_2 || ST.HNDL_CHGR_TNB_3 FROM TBBADFRE012M ST 
		     							WHERE ST.ACP_YR = #{acpYr} AND ST.ACP_DVSN_CD = #{acpDvsnCd} AND ST.ACP_SRNO = #{acpSrno} ) ,'-','') AS CALL_FROM
		  FROM DUAL
    </select>	

	<!-- 부패행위 접수 MMS 발신 내용 조회 -->
    <select id="selectCorCorMmsTxt" parameterType="paramMap" resultType="String">
    	/* kr.go.bai.eip.com.dao.MmsMapper.selectCorCorMmsTxt */
        SELECT #{smsTxt}||'접수번호 : '||(	SELECT	ACP_YR||'-'||F_CODE_NM('1000740',REQ_DVSN_CD)||'-'||RM_CVPT_ACP_NO
													FROM	TBCORCOR101M
													WHERE	REQ_DVSN_CD = #{reqDvsnCd}
													AND		ACP_YR = #{acpYr}
													AND		CVPT_ACP_NO = #{cvptAcpNo}) || #{smsTxt2} AS SMS_TXT
		  FROM DUAL
    </select>
    
	<!-- 청탁금지 접수 MMS 발신 내용 조회 -->
    <select id="selectDcpDcpMmsTxt" parameterType="paramMap" resultType="String">
    	/* kr.go.bai.eip.com.dao.MmsMapper.selectDcpDcpMmsTxt */
        SELECT #{smsTxt}||'접수번호 : '||(	SELECT	ACP_YR||'-'||F_CODE_NM('1000740',REQ_DVSN_CD)||'-'||RM_CVPT_ACP_NO
													FROM	TBDCPDCP101M
													WHERE	REQ_DVSN_CD = #{reqDvsnCd}
													AND		ACP_YR = #{acpYr}
													AND		CVPT_ACP_NO = #{cvptAcpNo}) || #{smsTxt2} AS SMS_TXT
		  FROM DUAL
    </select>
    
	<!-- 감사제보 접수 MMS 발신 내용 조회 -->
    <select id="selectCspDcpMmsTxt" parameterType="paramMap" resultType="String">
    	/* kr.go.bai.eip.com.dao.MmsMapper.selectCspDcpMmsTxt */
        SELECT #{smsTxt}||'접수번호 : '||(	SELECT (CASE WHEN A.REQ_DVSN_CD = '1' THEN DECODE(A.RM_CVPT_ACP_NO,NULL,'-',A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO) 
													 ELSE ACP_YR||'-'||F_CODE_NM('1000740',REQ_DVSN_CD)||'-'||RM_CVPT_ACP_NO
												 END) 
										  FROM TBCSPDCP101M A
										 WHERE REQ_DVSN_CD = #{reqDvsnCd}
										   AND ACP_YR = #{acpYr}
										   AND CVPT_ACP_NO = #{cvptAcpNo}) || #{smsTxt2} AS SMS_TXT
		  FROM DUAL
    </select>
    
	<!-- 감사제보 접수 MMS 발신 내용 조회 -->
    <select id="selectCspDcpMmsTxt2" parameterType="paramMap" resultType="String">
    	/* kr.go.bai.eip.com.dao.MmsMapper.selectCspDcpMmsTxt2 */
        SELECT #{smsTxt}||'(구)접수번호 : '||( SELECT DECODE(A.PRE_RM_CVPT_ACP_NO,NULL,'-',A.ACP_YR||'-'|| F_CODE_NM('1000949', A.PRE_RM_ACP_KND_CD) ||'-'||A.PRE_RM_CVPT_ACP_NO)
											 FROM TBCSPDCP101M A
											WHERE REQ_DVSN_CD = #{reqDvsnCd}
											  AND ACP_YR = #{acpYr}
											  AND CVPT_ACP_NO = #{cvptAcpNo}) || CHR(10) || 
						  '(신)접수번호 : '||(SELECT DECODE(A.RM_CVPT_ACP_NO,NULL,'-',A.ACP_YR||'-'|| F_CODE_NM('1000949', A.RM_ACP_KND_CD) ||'-'||A.RM_CVPT_ACP_NO)
											FROM TBCSPDCP101M A
										   WHERE REQ_DVSN_CD = #{reqDvsnCd}
											 AND ACP_YR = #{acpYr}
											 AND CVPT_ACP_NO = #{cvptAcpNo}) || #{smsTxt2} AS SMS_TXT
		  FROM DUAL
    </select>
    
	<!-- 감사청구 접수 MMS 발신 내용 조회 -->
    <select id="selectCspEarMmsTxt" parameterType="paramMap" resultType="String">
    	/* kr.go.bai.eip.com.dao.MmsMapper.selectCspEarMmsTxt */
        SELECT #{smsTxt}||#{acpYr}||'-'||DECODE(#{reqDvsnCd},'2','국민','공익')||'-'||#{cvptAcpNo}
		  FROM DUAL
    </select>
    
	<!-- MMS 전송 -->
	<select id="callMms" parameterType="paramMap">
		CALL NURI2_MESSAGE_SEND(#{callFrom}, #{callTo}, #{msgSbj}, #{smsTxt});
	</select>

</mapper> 
