<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.dcm.acm.dao.DCMACM038EMapper">
    <select id="selectMainList" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.dcm.acm.dao.DCMACM038EMapper.selectMainList*/
        <include refid="include.pageSelct" />
            <![CDATA[
               SELECT
                    TSK_LAG_CAT_CD
                   ,TSK_MID_CAT_CD
                   ,TSK_SALL_CAT_CD
                   ,F_RSRC_NM(TSK_LAG_CAT_CD)||'-'||F_RSRC_NM(TSK_MID_CAT_CD)||'-'||TSK_SALL_CAT_CD AS TSK /* TSK_SALL_CAT_CD 코드 생기면 F_RSRC_NM(TSK_SALL_CAT_CD) 로 대체. */
                   ,SNO
                   ,TIT
                   ,FAQ_DTM_YN
                   ,HNDL_STA_CD
                   ,F_USR_INFO_BY_ID(WRIT_PEN_NM,'2') AS WRIT_PEN_NM
                   ,TO_CHAR(WRIT_DH,'YYYY-MM-DD') AS WRIT_DH
                   ,ATT_FL_ID
                FROM TBDCMACM300M
                WHERE 1=1
            ]]>
            <if test='schLagCatCd != null and schLagCatCd != ""'>
                AND TSK_LAG_CAT_CD = #{schLagCatCd} /* 대분류 콤보박스 */
            </if>
            <if test='schMidCatCd != null and schMidCatCd != ""'>
                AND TSK_MID_CAT_CD = #{schMidCatCd} /* 중분류 콤보박스 */
            </if>
            <if test='schSallCatCd != null and schSallCatCd != ""'>
                AND TSK_SALL_CAT_CD = #{schSallCatCd} /* 소분류 콤보박스 */
            </if>
            <if test='schFaqTit != null and schFaqTit != ""'>
                AND TIT LIKE '%'||#{schFaqTit}||'%' /* 제목 */
            </if>
            <if test='schCategoryState != null and schCategoryState != ""'>
                AND HNDL_STA_CD = #{schCategoryState} /* 상태값 */
            </if>
           <if test='writDh_S != null and writDh_S != ""'>
           <![CDATA[
                AND WRIT_DH >= REPLACE(#{writDh_S},'-','')||'000000' /* 작성일자 시작 */
           ]]>
           </if>
           <if test='writDh_E != null and writDh_E != ""'>
           <![CDATA[
                AND WRIT_DH <= REPLACE(#{writDh_E},'-','')||'235959' /* 작성일자 종료 */
           ]]>
           </if>
            <if test='faqDtmYn != null and faqDtmYn != ""'>
                <if test='faqDtmYn == "y".toString()'>
                    AND FAQ_DTM_YN = 'Y' /* FAQ여부 확정 */
                </if>
                <if test='faqDtmYn == "n".toString()'>
                    AND FAQ_DTM_YN = 'N' /* FAQ여부 미확정 */
                </if>
           </if>
            
            ORDER BY SNO DESC 
		<include refid="include.pageOrder" />
    </select>
    
    <select id="selectLargeCategory" parameterType="egovMap" resultType="paramMap">
        /*kr.go.bai.eip.dcm.acm.dao.DCMACM038EMapper.selectLargeCategory*/
        SELECT   RSRC_ID AS CD
               , RSRC_DES AS CD_NM
               , RSRC_TP
        FROM     TBDCMIAM001M
        WHERE    1=1
        AND      RSRC_TP = 'COD00003'
        AND      UPPR_RSRC_ID IN (SELECT RSRC_ID
                                  FROM   TBDCMIAM001M
                                  WHERE  1=1
                                  AND    RSRC_ID = 'RES426382')
       ORDER BY MNU_SEQ ASC
    </select>
    
    <select id="selectMiddleCategory" parameterType="egovMap" resultType="paramMap">
        /*kr.go.bai.eip.dcm.acm.dao.DCMACM038EMapper.selectMiddleCategory*/
        SELECT RSRC_ID AS CD
             , RSRC_DES AS CD_NM
          FROM TBDCMIAM001M
         WHERE 1=1
           AND UPPR_RSRC_ID = #{tskLagCatCd}
         ORDER BY MNU_SEQ ASC
    </select>
    
    <delete id="deleteDCMACM301M"  parameterType="paramMap">
    /* kr.go.bai.eip.dcm.acm.dao.DCMACM038EMapper.deleteDCMACM301M*/
        DELETE 
        FROM TBDCMACM301M
        WHERE 1=1
        AND  SNO = #{sno}
        AND  TSK_LAG_CAT_CD = #{tskLagCatCd}
        AND  TSK_MID_CAT_CD = #{tskMidCatCd}
        AND  TSK_SALL_CAT_CD = #{tskSallCatCd}
    </delete>
    
    <delete id="deleteDCMACM300M"  parameterType="paramMap">
    /* kr.go.bai.eip.dcm.acm.dao.DCMACM038EMapper.deleteDCMACM300M*/
        DELETE 
        FROM TBDCMACM300M
        WHERE 1=1
        AND  SNO = #{sno}
        AND  TSK_LAG_CAT_CD = #{tskLagCatCd}
        AND  TSK_MID_CAT_CD = #{tskMidCatCd}
        AND  TSK_SALL_CAT_CD = #{tskSallCatCd}
    </delete>  
</mapper> 