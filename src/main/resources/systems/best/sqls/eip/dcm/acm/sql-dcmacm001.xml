<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper">

	<select id="dcmacm001EMessageselect" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
			SELECT MSG_CD/*메시지코드*/
			     , MSG_NM/*메시지명*/
			     , TSK_CAT_CD /*업무구분코드*/
			     , FUNC_CAT_CD||TSK_CAT_CD AS FUNC_CAT_CD /*기능분류코드*/
			     , MSG_CD AS ORG_MSG_CD
			FROM TBDCMACM012C
			WHERE 1=1
        ]]>
		<if test='msgnm != null and msgnm != ""'>
			MSG_NM LIKE '%'||#{msgnm} ||'%'
		</if>
		<if test='tskcatcd != null and tskcatcd != ""'>
			TSK_CAT_CD LIKE '%'||#{tskcatcd} ||'%'
		</if>
		<if test='funccatcd != null and funccatcd != ""'>
			FUNC_CAT_CD LIKE '%'||#{funccatcd} ||'%'
		</if>
		 <![CDATA[
		 ORDER BY MSG_CD
		 ]]>
	</select>
	<!-- 메시지관리 -->
	<insert id="dcmacm001EMessageinsert" parameterType="paramMap">
		INSERT INTO TBDCMACM012C
		(
			MSG_CD
			, MSG_NM
			, TSK_CAT_CD
			, FUNC_CAT_CD

			, FRT_USR_ID
			,
			FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
		)
		VALUES
		(
			#{msgCd}
			, #{msgNm}
			, #{tskCatCd}
			, #{funcCatCd}
			, #{frtUsrId}
			,
			#{fnlUsrId}
			, #{fnlDealDptCd}
			, #{fnlMnuId}
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!--메시지관리 update -->
	<update id="dcmacm001EMessageupdate" parameterType="paramMap">
		<![CDATA[
			UPDATE TBDCMACM012C
			   SET MSG_CD     = #{msgCd}
			     , TSK_CAT_CD = #{tskCatCd}
			     , FUNC_CAT_CD = #{funcCatCd}
                 , FNL_MDF_DH = SYSDATE
		         , FNL_USR_ID = #{fnlUsrId}
                 , FNL_DEAL_DPT_CD = #{fnlDealDptCd}
		         , FNL_MNU_ID = #{fnlMnuId}

		]]>
		<if test='msgNm != null'>
			, MSG_NM = #{msgNm}
		</if>
		WHERE 1=1
		  AND MSG_CD = #{msgCd}
		  AND TSK_CAT_CD = #{tskCatCd}
		  AND FUNC_CAT_CD =#{funcCatCd}

	</update>

	<!--메시지 delete -->
	<update id="dcmacm001EMessagedelete" parameterType="paramMap">
		DELETE FROM TBDCMACM012C
		WHERE 1=1
		AND MSG_CD = #{msgCd}
	</update>

	<!-- 로그조회 -->
	<select id="dcmacm001QLogselect" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
			SELECT *
			FROM TBDCMACM014H
			WHERE 1=1
			 AND RQS_DH BETWEEN #{rqsdhfrom}||'000000' AND #{rqsdhto}||'235959'

        ]]>
		<if test='mnuid != null and mnuid != ""'>
			MNU_ID LIKE
			'%'||#{mnuid} ||'%'
		</if>
		 <![CDATA[
		 ORDER BY RQS_DH
		 ]]>
	</select>

	<!-- 사이트코드관리 -->
	<select id="dcmacm026SiteCodeMgtSelect" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
			SELECT *
			FROM TBDCMACM016M
			WHERE 1=1
        ]]>
		<if test='sitnm != null and sitnm != ""'>
			SIT_NM LIKE '%'||#{sitnm} ||'%'
		</if>
		<if test='useyn != null and useyn != ""'>
			USE_YN LIKE '%'||#{useyn} ||'%'
		</if>
		 <![CDATA[
		 ORDER BY SIT_CD
		 ]]>
	</select>

	<!-- 접속아이피 통제 -->
	<select id="dcmacm026CtrlIpSelect" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
			SELECT CTRL_NO /*통제번호*/
			     , SIT_CD    /*사이트코드*/
			     , STR_IP_AD /*시작ip*/
			     , END_IP_AD /*종료 ip*/
			     , CNCT_PMS_STR_DH
			     , CNCT_PMS_END_DH
			     , SUBSTR(TO_CHAR(CNCT_PMS_STR_DH,'yyyymmddhh24miss'),9,14) AS CNCT_PMS_STR_HH /*시작일*/
                 , SUBSTR(TO_CHAR(CNCT_PMS_END_DH,'yyyymmddhh24miss'),9,14)AS CNCT_PMS_END_HH  /*종료일*/
			FROM TBDCMACM027L
			WHERE 1=1
			  AND SIT_CD = #{sitcd}
        ]]>
	</select>

	<!-- 접속아이피 통제 -->
	<select id="dcmacm026CtrlIpMaxSelect" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
			SELECT NVL(MAX(CTRL_NO),0)+1 AS CTRL_NO /*통제번호*/
			FROM TBDCMACM027L
			WHERE 1=1
			  AND SIT_CD = #{sitCd}
        ]]>
	</select>

	<!-- 접속아이피 통제 -->
	<select id="dcmacm026CtrlIpCnt" parameterType="paramMap" resultType="java.lang.String">
        <![CDATA[
			SELECT COUNT(*) AS CNT
			FROM TBDCMACM027L
			WHERE 1=1
			  AND SIT_CD = #{sitCd}
        ]]>
	</select>

	<!-- 사이트코드 신규 -->
	<insert id="dcmacm026SiteCodeMgtInsert" parameterType="paramMap">
		INSERT INTO TBDCMACM016M
		(
			SIT_CD
			, SIT_NM
			, URL_AD
			, SIT_DES
			, USE_YN
			, CTRL_YN
			,
			FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
		) VALUES
		(
			#{sitCd}
			, #{sitNm}
			, #{urlAd}
			, #{sitDes}
			, #{useYn}
			,
			#{ctrlYn}
			, #{frtUsrId}
			, #{fnlUsrId}
			, #{fnlDealDptCd}
			, #{fnlMnuId}
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 접속IP통제 신규 -->
	<insert id="dcmacm026CtrlIpInsert" parameterType="paramMap">
		INSERT INTO TBDCMACM027L
		(
			CTRL_NO
			, SIT_CD
			, STR_IP_AD
			, END_IP_AD
			, CNCT_PMS_STR_DH
			,
			CNCT_PMS_END_DH
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			,
			FRT_REGI_DH
			,
			FNL_MDF_DH
		) VALUES
		(
			#{ctrlNo}
			, #{sitCd}
			, #{strIpAd}
			,
			#{endIpAd}
			,
			TO_DATE(#{cnctPmsStrDh}||#{cnctPmsStrHh},'YYYYMMDDHH24:MI:SS')
			,
			TO_DATE(#{cnctPmsEndDh}||#{cnctPmsEndHh},'YYYYMMDDHH24:MI:SS')
			,
			#{frtUsrId}
			, #{fnlUsrId}
			, #{fnlDealDptCd}
			, #{fnlMnuId}
			, SYSDATE
			,
			SYSDATE
		)
	</insert>

	<!--사이트코드 update -->
	<update id="dcmacm026SiteCodeMgtUpdate" parameterType="paramMap">
		<![CDATA[
			UPDATE TBDCMACM016M
			   SET SIT_CD  = #{sitCd}
				  , FNL_MDF_DH = SYSDATE
			      , FNL_USR_ID = #{fnlUsrId}
	              , FNL_DEAL_DPT_CD = #{fnlDealDptCd}
			      , FNL_MNU_ID = #{fnlMnuId}
		]]>
				<if test='sitNm != null'>
					, SIT_NM = #{sitNm}
				</if>
				<if test='urlAd != null'>
					, URL_AD = #{urlAd}
				</if>
				<if test='sitDes != null'>
					, SIT_DES = #{sitDes}
				</if>
				<if test='useYn != null'>
					, USE_YN = #{useYn}
				</if>
				<if test='ctrlYn != null'>
					, CTRL_YN = #{ctrlYn}
				</if>
		WHERE 1=1
		AND SIT_CD = #{sitCd}
	</update>

	<!--접속ip 통제 update -->
	<update id="dcmacm026CtrlIpUpdate" parameterType="paramMap">
		<![CDATA[
			UPDATE TBDCMACM027L
			   SET CTRL_NO     = #{ctrlNo}
				  , SIT_CD     = #{sitCd}
				  , FNL_MDF_DH = SYSDATE
			      , FNL_USR_ID = #{fnlUsrId}
	              , FNL_DEAL_DPT_CD = #{fnlDealDptCd}
			      , FNL_MNU_ID = #{fnlMnuId}
		]]>
			<if test='strIpAd != null'>
				, STR_IP_AD = #{strIpAd}
			</if>
			<if test='endIpAd != null'>
				, END_IP_AD = #{endIpAd}
			</if>
			<if test='cnctPmsStrDh != null'>
				, CNCT_PMS_STR_DH =
				TO_DATE(SUBSTR(#{cnctPmsStrDh},0,8)||#{cnctPmsStrHh},'YYYYMMDDHH24:MI:SS')
			</if>
			<if test='cnctPmsEndDh != null'>
				, CNCT_PMS_END_DH =
				TO_DATE(SUBSTR(#{cnctPmsEndDh},0,8)||#{cnctPmsEndHh},'YYYYMMDDHH24:MI:SS')
			</if>
		WHERE 1=1
		AND SIT_CD = #{sitCd}
		AND CTRL_NO = #{ctrlNo}
	</update>

	<!--사이트코드 delete -->
	<update id="dcmacm026SiteCodeMgtDelete" parameterType="paramMap">
		DELETE FROM TBDCMACM016M
		WHERE 1=1
		AND SIT_CD = #{sitCd}
	</update>

	<!--접속IP통제 delete -->
	<update id="dcmacm026CtrlYnDelete" parameterType="paramMap">
		DELETE FROM TBDCMACM027L
		WHERE 1=1
		AND SIT_CD = #{sitCd}
	</update>

	<!--접속IP통제 delete -->
	<update id="dcmacm026CtrlIpDelete" parameterType="paramMap">
		DELETE FROM TBDCMACM027L
		WHERE 1=1
		AND SIT_CD = #{sitCd}
		AND CTRL_NO = #{ctrlNo}
	</update>

	<!--프로그램관리 조회 -->
	<select id="dcmacm027PgmMgtSelect" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
			SELECT *
			FROM TBDCMACM017M
			WHERE 1=1
        ]]>
		<if test='pgmid != null and pgmid != ""'>
			PGM_ID LIKE '%'|| #{pgmid} ||'%'
		</if>
		<if test='tskcatcd != null and tskcatcd != ""'>
			TSK_CAT_CD LIKE '%'||#{tskcatcd}||'%'
		</if>
		<if test='funccatcd != null and funccatcd != ""'>
			FUNC_CAT_CD LIKE '%'||#{funccatcd}||'%'
		</if>
		<if test='pgmnm != null and pgmnm != ""'>
			PGM_NM LIKE '%'||#{pgmnm} ||'%'
		</if>
		 <![CDATA[
		 ORDER BY PGM_NM
		 ]]>
	</select>

	<!--프로그램관리 추가 -->
	<insert id="dcmacm027PgmMgtInsert" parameterType="paramMap">
		INSERT INTO	TBDCMACM017M
		(
		PGM_ID
		, SIT_CD
		, TSK_CAT_CD
		, FUNC_CAT_CD
		, PGM_NM
		,
		PGM_ENG_NM
		, PGM_DVSN
		, USE_YN
		, URL
		, PGM_DES
		, FRT_USR_ID
		, FRT_REGI_DH
		)
		VALUES
		(
		#{pgmId}
		, #{sitCd}
		, #{tskCatCd}
		, #{funcCatCd}
		, #{pgmNm}
		,
		#{pgmEngNm}
		,
		#{pgmDvsn}
		, #{useYn}
		, #{url}
		, #{pgmDes}
		, #{frtUsrId}
		,
		SYSDATE
		)
	</insert>

	<!--프로그램관리 수정 -->

	<update id="dcmacm027PgmMgtUpdate" parameterType="paramMap">
		<![CDATA[
			UPDATE TBDCMACM017M
			   SET SIT_CD               = #{sitCd}
			     , PGM_ID 				= #{pgmId}
			   	 , TSK_CAT_CD = #{tskCatCd}
			   	 , FUNC_CAT_CD = #{funcCatCd}
			   	 , FNL_MDF_DH = SYSDATE
		]]>

		<if test='pgmNm != null'>
			, PGM_NM = #{pgmNm}
		</if>
		<if test='pgmEngNm != null'>
			, PGM_ENG_NM = #{pgmEngNm}
		</if>
		<if test='pgmDvsn != null'>
			, PGM_DVSN = #{pgmDvsn}
		</if>
		<if test='useYn != null'>
			, USE_YN = #{useYn}
		</if>
		<if test='url != null'>
			, URL = #{url}
		</if>
		<if test='pgmDes != null'>
			, PGM_DES = #{pgmDes}
		</if>
		<if test='fnlDealDptCd != null'>
			, FNL_DEAL_DPT_CD = #{fnlDealDptCd}
		</if>
		<if test='fnlMnuId != null'>
			, FNL_MNU_ID = #{fnlMnuId}
		</if>
		WHERE 1=1
		AND SIT_CD = #{sitCd}
		AND PGM_ID = #{pgmId}
	</update>

	<!--프로그램관리 삭제 -->
	<update id="dcmacm027PgmMgtDelete" parameterType="paramMap">
		DELETE FROM TBDCMACM017M
		WHERE 1=1
		AND SIT_CD = #{sitCd}
		AND PGM_ID = #{pgmId}
	</update>


	<!--부서코드 조회 -->
	<select id="dcmacm024DeptCodeSelect" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
			SELECT DISTINCT DPT_CD /*부서코드*/
			     , DPT_NM /*부서명*/
			     , TNB /*전화번호*/
			     , USE_YN /*사용여부*/
			     , ABR_DPT_NM_1 /*약명1*/
			     , ABR_DPT_NM_2 /*약명2*/
			     , FRML_DPT_NM /*공식부서명*/
			     , STND_DPT_CD /*표준부서명*/
			     , FAN         /*팩스번호*/
			     , OW_DVDT_TXT /*사무분장내용*/
			     , DPT_TP_CD /*부서타입코드*/
			     , IMD_CD    /*직속코드*/
			     , DPT_SNO /*부서순번*/
			     , ZCD
			     , AD
			     , DTL_AD
			     , HMP_AD
			     , SAL_DPT_CD /*급여부서*/
			     , SAL_DPT_NM /*급여부서명*/
			     , BK_DPT_NM /*이전부서명*/
			     , HIRK_DPT_CD /*상위부서코드*/
			     , F_DPT_INFO(HIRK_DPT_CD,'1') AS HIRK_DPT_NM/*상위부서명*/
			     , SRT_SNO /*정렬순번*/
			     , ORZT_DVSN_CD /*조직구분코드*/
		      FROM TBDCMACM002M A
		     WHERE 1=1
        ]]>

		<if test='dptcd != null and dptcd != ""'>
			DPT_CD LIKE
			'%'||#{dptcd} ||'%'
		</if>
		<if test='dptnm != null and dptnm != ""'>
			(DPT_NM LIKE
			'%'||#{dptnm} ||'%'OR ABR_DPT_NM_1 LIKE '%'||#{dptnm} ||'%' OR
			ABR_DPT_NM_2 LIKE '%'||#{dptnm} ||'%' OR FRML_DPT_NM LIKE '%'||#{dptnm}||'%' )
		</if>
		<if test='useyn != null and useyn != ""'>
			USE_YN LIKE
			'%'||#{useyn} ||'%'
		</if>
		<if test='treeuseyn != null and treeuseyn != ""'>
			  START WITH USE_YN = #{treeuseyn}
             CONNECT BY PRIOR HIRK_DPT_CD =DPT_CD
		</if>

		 <![CDATA[
		ORDER BY DPT_SNO, DPT_CD
		 ]]>
	</select>
	<!-- 하위부서 체크 -->

	<select id="dcmacm024DeptChildSelect" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
			SELECT COUNT(DPT_CD) AS CNT
			  FROM TBDCMACM002M
		     WHERE 1=1
			   AND HIRK_DPT_CD = #{dptCd}
		 ]]>
	</select>
	<!-- 사용자관리부서내역 부서 체크 -->
	<select id="dcmacm003UsrDptCnt" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
			SELECT COUNT(DPT_CD) AS CNT
			  FROM TBDCMACM003L
		     WHERE 1=1
			   AND DPT_CD = #{dptCd}
		 ]]>
	</select>

	<!--부서코드 등록 -->
	<insert id="dcmacm024DeptCodeInsert" parameterType="paramMap">
		DECLARE
			BEGIN
				INSERT
				INTO
				TBDCMACM002M
				(
				  DPT_CD
				, DPT_NM
				, TNB
				, USE_YN
				, ABR_DPT_NM_1
				, ABR_DPT_NM_2
				, FRML_DPT_NM
				, STND_DPT_CD
				, FAN
				, OW_DVDT_TXT
				, FRT_USR_ID
				, HIRK_DPT_CD
				, FRT_REGI_DH
				, SRT_SNO
				, ORZT_DVSN_CD
				, DPT_TP_CD
				, IMD_CD
				, FNL_MNU_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MDF_DH
				) VALUES
				(
				  #{dptCd}
				, #{dptNm}
				, #{tnb}
				, #{useYn}
				, #{abrDptNm1}
				, #{abrDptNm2}
				, #{frmlDptNm}
				, #{stndDptCd}
				, #{fan}
				, #{owDvdtTxt}
				, #{frtUsrId}
				, #{hirkDptCd}
				, SYSDATE
				, #{srtSno}
				, #{orztDvsnCd}
				, #{dptTpCd}
				, #{imdCd}
				, #{fnlMnuId}
				, #{fnlUsrId}
				, #{fnlDealDptCd}
				, SYSDATE
				);



				INSERT
				INTO
				TBDCMACM031H
				(
				  DPT_CD
				, CON_NO
				, CON_HNDL_DVSN_CD
				, USE_YN

				, FRT_USR_ID
				, FRT_REGI_DH
				, FNL_MNU_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MDF_DH
				) VALUES
				(
				  #{dptCd}
				, (	SELECT NVL(MAX(CON_NO),0)+1  AS CON_NO
					  FROM TBDCMACM031H
			       )
			    , 'C'
				, 'N'

				, #{frtUsrId}
				, SYSDATE
				, #{fnlMnuId}
				, #{fnlUsrId}
				, #{fnlDealDptCd}
				, SYSDATE
				);
		 END;

	</insert>

	<!--부서코드 수정 -->
	<update id="dcmacm024DeptCodeUpdate" parameterType="paramMap">
		<![CDATA[
		DECLARE
			BEGIN
			UPDATE TBDCMACM002M
			   SET DPT_CD               = #{dptCd}
			     , DPT_NM 				= #{dptNm}
			     , USE_YN               = #{useYn}
			     , FNL_MDF_DH = SYSDATE
				 , FNL_USR_ID = #{fnlUsrId}
                 , FNL_DEAL_DPT_CD = #{fnlDealDptCd}
				 , FNL_MNU_ID = #{fnlMnuId}
		]]>
		<if test='tnb != null'>
			, TNB = #{tnb}
		</if>
		<if test='abrDptNm1 != null'>
			, ABR_DPT_NM_1 =
			#{abrDptNm1}
		</if>
		<if test='abrDptNm2 != null'>
			, ABR_DPT_NM_2 =
			#{abrDptNm2}
		</if>
		<if test='frmlDptNm != null'>
			, FRML_DPT_NM = #{frmlDptNm}
		</if>
		<if test='stndDptCd != null'>
			, STND_DPT_CD = #{stndDptCd}
		</if>
		<if test='fan != null'>
			, FAN = #{fan}
		</if>
		<if test='owDvdtTxt != null'>
			, OW_DVDT_TXT = #{owDvdtTxt}
		</if>
		<if test='hirkDptCd != null'>
			, HIRK_DPT_CD = #{hirkDptCd}
		</if>
		<if test='srtSno != null'>
			, SRT_SNO = #{srtSno}
		</if>
		<if test='orztDvsnCd != null'>
			, ORZT_DVSN_CD =	#{orztDvsnCd}
		</if>
		<if test='dptTpCd != null'>
			, DPT_TP_CD =	#{dptTpCd}
		</if>
		<if test='imdCd != null'>
			, IMD_CD =	#{imdCd}
		</if>

		<![CDATA[
		WHERE 1=1
		AND DPT_CD = #{dptCd}

		;
			INSERT
				INTO
				TBDCMACM030H
				(
				  CON_NO 				/* 연계번호 */
				, CON_USE_YN
				, DPT_CD 				/* 부서코드 */
				, DPT_NM 				/* 부서명 */
				, TNB 					/* 전화번호 */
				, USE_YN 				/* 사용여부 */
				, ABR_DPT_NM_1			/* 약칭부서명1 */
				, ABR_DPT_NM_2 			/* 약칭부서명2 */
				, FRML_DPT_NM 			/* 공식부서명 */
				, STND_DPT_CD		 	/* 표준부서코드 */
				, FAN 					/* 팩스번호 */
				, IMD_CD 				/* 직속코드 */
				, DPT_TP_CD 			/* 부서타입코드 */
				, DPT_SNO 				/* 부서순번 */
				, ZCD 					/* 우편번호 */
				, AD 					/* 주소 */
				, DTL_AD 				/* 상세주소 */
				, HMP_AD 				/* 홈페이지주소 */
				, SAL_DPT_CD 			/* 급여부서코드 */
				, SAL_DPT_NM 			/* 급여부서명 */
				, BK_DPT_NM 			/* 이전부서명 */
				, OW_DVDT_TXT			/* 사무분장내용 */
				, HIRK_DPT_CD 			/* 상위부서코드 */
				, ORZT_DVSN_CD 			/* 조직구분코드 */
				, SRT_SNO 				/* 정렬순번 */
				, DEP_RGN_CD 			/* 출발지역코드 */
				, ENFM_WHLS_CHGR_CNB 	/* 집행전말담당자전산번호 */


				, FRT_USR_ID
				, FRT_REGI_DH
				, FNL_MNU_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MDF_DH
				) SELECT ( (SELECT NVL(MAX(CON_NO),0)+1 FROM TBDCMACM030H)) AS CON_NO /* 연계번호 */
				        , 'N' AS CON_USE_YN
						, DPT_CD
						, DPT_NM
						, TNB
						, USE_YN
						, ABR_DPT_NM_1
						, ABR_DPT_NM_2
						, FRML_DPT_NM
						, STND_DPT_CD
						, FAN
						, IMD_CD
						, DPT_TP_CD
						, DPT_SNO
						, ZCD
						, AD
						, DTL_AD
						, HMP_AD
						, SAL_DPT_CD
						, SAL_DPT_NM
						, BK_DPT_NM
						, OW_DVDT_TXT
						, HIRK_DPT_CD
						, ORZT_DVSN_CD
						, SRT_SNO
						, DEP_RGN_CD
						, ENFM_WHLS_CHGR_CNB
						, #{fnlUsrId} AS FRT_USR_ID
		                , SYSDATE AS FRT_REGI_DH
						, #{fnlMnuId} AS FNL_MNU_ID
						, #{fnlUsrId} AS FNL_USR_ID
						, #{fnlDealDptCd} AS FNL_DEAL_DPT_CD
						, SYSDATE AS FNL_MDF_DH
				    FROM TBDCMACM002M
				   WHERE DPT_CD=#{dptCd}
				   ;
				 END;
				 ]]>
	</update>


	<!--부서코드 삭제 -->
	<update id="dcmacm024DeptCodeDelete" parameterType="paramMap">
	DECLARE
		BEGIN
			DELETE
			FROM
			TBDCMACM002M
			WHERE 1=1
			AND DPT_CD = #{dptCd};


				INSERT
					INTO
					TBDCMACM031H
					(
					  DPT_CD
					, CON_NO
					, CON_HNDL_DVSN_CD
					, USE_YN

					, FRT_USR_ID
					, FRT_REGI_DH
					, FNL_MNU_ID
					, FNL_USR_ID
					, FNL_DEAL_DPT_CD
					, FNL_MDF_DH
					) VALUES
					(
					  #{dptCd}
					, (	SELECT NVL(MAX(CON_NO),0)+1  AS CON_NO
						  FROM TBDCMACM031H
				       )
				    , 'D'
					, 'N'

					, #{frtUsrId}
					, SYSDATE
					, #{fnlMnuId}
					, #{fnlUsrId}
					, #{fnlDealDptCd}
					, SYSDATE
					);
			END;

	</update>

	<!-- 부서 국 리스트 조회 -->
	<select id="dcmacm024DeptBureauSelect" parameterType="paramMap"
		resultType="egovMap">
        <![CDATA[
          SELECT DPT_CD, DPT_NM,HIRK_DPT_CD
            FROM TBDCMACM002M
           WHERE 1=1

             ]]>
		<if test='dptauth != null and dptauth != ""'>
              DPT_CD IN ( SELECT SUBSTR(DPT_CD,'1','3')||'000' FROM TABLE(F_AUTH_DEPT(#{cnb}, #{dptauth}, 'Y')))
        </if>
            AND DPT_CD  LIKE '%000'
            AND USE_YN = 'Y'
           ORDER BY DPT_CD

	</select>
	<!-- 부서 과 리스트 조회 -->
	<select id="dcmacm024DeptSectSelect" parameterType="paramMap"
		resultType="egovMap">
        <![CDATA[
           SELECT DPT_CD, DPT_NM, HIRK_DPT_CD
             FROM TBDCMACM002M
            WHERE 1=1

                 ]]>
		<if test='dptAuth != null and dptAuth != ""'>
              DPT_CD IN ( SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{cnb}, #{dptAuth}, 'Y')))
             </if>

		<if test='hirkDptCd != null and hirkDptCd != ""'>
		<if test='dptCd == null or dptCd == ""'>
				AND SUBSTR(DPT_CD, 0, 3) = SUBSTR(#{hirkDptCd}, 0, 3)
	        	</if>
		<if test='dptCd != null and dptCd != ""'>
	        	OR SUBSTR(DPT_CD, 0, 3) = SUBSTR(#{hirkDptCd}, 0, 3)
	        	</if>
			</if>

			  AND DPT_CD NOT LIKE '%000'
              AND USE_YN = 'Y'
            ORDER BY DPT_CD

	</select>

	<!--부서코드팝업 조회  -->
	<select id="dcmacm024DeptPopSelect" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.dcmacm024DeptPopSelect*/
		<include refid="include.pageSelct" />
        <![CDATA[
			SELECT DPT_CD
			     , DPT_NM
			     , TNB
			     , DECODE(USE_YN,'Y','사용','N','미사용','미사용') USE_YN
			     , ABR_DPT_NM_1
			     , ABR_DPT_NM_2
			     , FRML_DPT_NM
			     , STND_DPT_CD
			     , FAN
			     , OW_DVDT_TXT
			     , DPT_TP_CD
			     , IMD_CD
			     , DPT_SNO
			     , ZCD
			     , AD
			     , DTL_AD
			     , HMP_AD
			     , SAL_DPT_CD
			     , SAL_DPT_NM
			     , BK_DPT_NM
			     , HIRK_DPT_CD
                 , F_DPT_INFO(HIRK_DPT_CD,'1') AS HIRK_DPT_NM/*상위부서명*/
                 , ORZT_DVSN_CD
		      FROM TBDCMACM002M
		     WHERE 1=1

        ]]>
		<if test='usrdptauth != null and usrdptauth != ""'>
			AND DPT_CD IN ( SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{usrcnb}, #{usrdptauth}, 'Y')))
		</if>

		<if test='dptcd != null and dptcd != ""'>
			AND DPT_CD LIKE
			'%'||#{dptcd} ||'%'
		</if>
		<if test='dptNm != null and dptNm != ""'>
			AND (DPT_NM LIKE
			'%'||#{dptNm} ||'%'
			OR ABR_DPT_NM_1 LIKE '%'||#{dptNm} ||'%'
			OR
			ABR_DPT_NM_2 LIKE '%'||#{dptNm} ||'%'
			OR DPT_CD LIKE '%'||#{dptNm}||'%'
			OR FRML_DPT_NM LIKE '%'||#{dptNm}||'%')
		</if>
		<if test='useYn != null and useYn != ""'>
			AND USE_YN LIKE '%'||#{useYn} ||'%'
		</if>
		/* 감사원장, 감사위원, 사무총장실 제외 */
		<if test='case1Yn == Y '>
			AND DPT_CD NOT IN ('500000', '510000', '520000')
		</if>

		 ORDER BY DPT_SNO
		<include refid="include.pageOrder" />
	</select>

    <!-- 부서코드팝업 조회 2022-09-19 인사개편에 따라 실부서 조회가 필요하여 대체  -->
	<select id="dcmacm024TeamPopSelect" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.dcmacm024DeptPopSelect*/
		SELECT  DPT_CD, DPT_NM
            FROM    TBDCMACM002M
            WHERE   DPT_CD LIKE '0L0%'
            AND     USE_YN ='Y'
            AND     DPT_CD NOT IN ('0L0000')
            UNION
            SELECT CD AS DPT_CD,
            	   CASE 
            	      WHEN CD = '071110' THEN '서울센터(구)' 
            	      ELSE CD_NM
            	   END AS DPT_NM
			FROM TBDCMACM013C 
			WHERE CMM_CD_DVSN_CD = '1000144'
			AND CD IN ('0L0205','0L0315','0L0325','0L0335','071110')
	</select>

	<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
	<select id="dcmacm008CmmMaxSelect" parameterType="paramMap"
		resultType="java.lang.String">

	    SELECT  NVL(MAX(CMM_CD_DVSN_CD)+1,'1000001') AS CMM_CD_DVSN_CD
         FROM TBDCMACM013C
        WHERE 1=1
          AND CD ='000000000'

	</select>
	<!-- 공통코드 메인 조회 -->
	<select id="dcmacm008CmmSelect" parameterType="paramMap"
		resultType="egovMap">
        /*kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.dcmacm008CmmSelect*/
	<![CDATA[
       SELECT TSK_CAT_CD /*업무분류*/
            , FUNC_CAT_CD||TSK_CAT_CD AS FUNC_CAT_CD /*기능분류*/
            , CMM_CD_DVSN_CD /*코드구분*/
            , CD /*코드*/
            , CD_NM /*코드명*/
            , USE_YN
            , PRD_USE_YN
            , STR_DT
            , END_DT
            , OTPT_SEQ
            , USR_DFN_TXT_1
            , USR_DFN_TXT_2
            , USR_DFN_TXT_3
            , USR_DFN_TXT_4
            , USR_DFN_TXT_5
            , BK_CD_DVSN_NM
            , BK_CD_NM
         FROM TBDCMACM013C
        WHERE 1=1
          AND CD ='000000000'
        ]]>
		<if test='tskcatcd != null and tskcatcd != ""'>
			AND TSK_CAT_CD LIKE #{tskcatcd}||'%'
		</if>
		<if test='funccatcd != null and funccatcd != ""'>
			AND FUNC_CAT_CD LIKE #{funccatcd} ||'%'
		</if>
		<if test='cddivnm != null and cddivnm != ""'>
			AND CD_NM LIKE '%'||#{cddivnm}||'%'
		</if>
		<if test='useyn != null and useyn != ""'>
			AND USE_YN = #{useyn}
		</if>
		<if test='dtlcddivnm != null and dtlcddivnm != ""'>
			<![CDATA[
			AND CMM_CD_DVSN_CD IN (
           		 SELECT CMM_CD_DVSN_CD FROM TBDCMACM013C WHERE CD_NM LIKE '%' || #{dtlcddivnm} || '%' AND CD <> '000000000'  GROUP BY CMM_CD_DVSN_CD
          	)
			]]>
		</if>
				ORDER BY CD_NM
	</select>
	<!--공통코드 sub 조회 -->
	<select id="dcmacm008CmmDetailSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
       SELECT TSK_CAT_CD
            , FUNC_CAT_CD||TSK_CAT_CD AS FUNC_CAT_CD
            , CMM_CD_DVSN_CD
            , CD
            , CD_NM
            , USE_YN
            , PRD_USE_YN
            , STR_DT
            , END_DT
            , OTPT_SEQ
            , USR_DFN_TXT_1
            , USR_DFN_TXT_2
            , USR_DFN_TXT_3
            , USR_DFN_TXT_4
            , USR_DFN_TXT_5
            , BK_CD_DVSN_NM
            , BK_CD_NM
         FROM TBDCMACM013C
        WHERE 1=1
          AND CD <>'000000000'
		  AND CMM_CD_DVSN_CD = #{cddvsn}

	         ]]>

	</select>

	<select id="dcmacm008CmmDetailCntSelect" parameterType="paramMap" resultType="egovMap">
		SELECT COUNT(*) AS CNT
		FROM TBDCMACM013C
		WHERE 1=1
		AND CD <![CDATA[ <> ]]>
		'000000000'
		AND CMM_CD_DVSN_CD = #{cmmCdDvsnCd}
	</select>

	<!-- 공통코드 delete -->
	<update id="dcmacm008CmmDelete" parameterType="paramMap">
	DECLARE
		BEGIN
			DELETE
			TBDCMACM013C
			WHERE 1 = 1
			AND CMM_CD_DVSN_CD = #{cmmCdDvsnCd}
			AND CD =#{cd};


			INSERT
			INTO
			TBDCMACM033H
			(
			  CMM_CD_DVSN_CD
			, CD
			, CON_NO
			, CON_HNDL_DVSN_CD
			, USE_YN

			, FRT_USR_ID
			, FRT_REGI_DH
			, FNL_MNU_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MDF_DH
			) VALUES
			(
			  #{cmmCdDvsnCd}
			, #{cd}
			, (	SELECT NVL(MAX(CON_NO),0)+1  AS CON_NO
				  FROM TBDCMACM033H
			   )
			, 'D'
			, 'N'

			, #{frtUsrId}
			, SYSDATE
			, #{fnlMnuId}
			, #{fnlUsrId}
			, #{fnlDealDptCd}
			, SYSDATE
			);
		END;
	</update>
	<!-- 공통코드 insert -->
	<insert id="dcmacm008CmmInsert" parameterType="paramMap">
	DECLARE
		BEGIN
			INSERT INTO
			TBDCMACM013C
			(
			  CMM_CD_DVSN_CD
			, CD
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, CD_NM
			, USE_YN
			, PRD_USE_YN
			, STR_DT
			, END_DT
			, OTPT_SEQ
			, USR_DFN_TXT_1
			, USR_DFN_TXT_2
			, USR_DFN_TXT_3
			, USR_DFN_TXT_4
			, USR_DFN_TXT_5
			, BK_CD_DVSN_NM
			, BK_CD_NM

			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
			)
			VALUES
			(
			  #{cmmCdDvsnCd}
			, #{cd}
			, #{tskCatCd}
			, #{funcCatCd}
			, #{cdNm}
			, #{useYn}
			, #{prdUseYn}
			, #{strDt}
			, #{endDt}
			, TO_NUMBER(NVL(#{otptSeq},NULL))
			, #{usrDfnTxt1}
			, #{usrDfnTxt2}
			, #{usrDfnTxt3}
			, #{usrDfnTxt4}
			, #{usrDfnTxt5}
			, #{bkCdDvsnNm}
			, #{bkCdNm}
			, #{frtUsrId}
			, #{fnlUsrId}
			, #{fnlDealDptCd}
			, #{fnlMnuId}
			, SYSDATE
			, SYSDATE
			);

				INSERT
				INTO
				TBDCMACM033H
				(
				  CMM_CD_DVSN_CD
				, CD
				, CON_NO
				, CON_HNDL_DVSN_CD
				, USE_YN

				, FRT_USR_ID
				, FRT_REGI_DH
				, FNL_MNU_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MDF_DH
				) VALUES
				(
				  #{cmmCdDvsnCd}
				, #{cd}
				, (	SELECT NVL(MAX(CON_NO),0)+1  AS CON_NO
					  FROM TBDCMACM033H
			       )
			    , 'C'
				, 'N'

				, #{frtUsrId}
				, SYSDATE
				, #{fnlMnuId}
				, #{fnlUsrId}
				, #{fnlDealDptCd}
				, SYSDATE
				);
			END;



	</insert>
	<!-- 공통코드 업데이트 -->
	<update id="dcmacm008CmmUpdate" parameterType="paramMap">

	DECLARE
		BEGIN
			UPDATE TBDCMACM013C
			SET FNL_MDF_DH = SYSDATE
			, CMM_CD_DVSN_CD =
			#{cmmCdDvsnCd}
			, CD = #{cd}
			, FNL_USR_ID = #{fnlUsrId}
			,
			FNL_DEAL_DPT_CD = #{fnlDealDptCd}
			, FNL_MNU_ID = #{fnlMnuId}

			<if test='tskCatCd != null'>
				, TSK_CAT_CD = #{tskCatCd}
			</if>
			<if test='funcCatCd != null'>
				, FUNC_CAT_CD = #{funcCatCd}
			</if>
			<if test='cdNm != null'>
				, CD_NM = #{cdNm}
			</if>
			<if test='useYn != null'>
				, USE_YN = NVL(#{useYn},'N')
			</if>
			<if test='prdUseYn != null'>
				, PRD_USE_YN =
				NVL(#{prdUseYn},'N')
			</if>
			<if test='strDt != null'>
				, STR_DT = #{strDt}
			</if>
			<if test='endDt != null'>
				, END_DT = #{endDt}
			</if>
			<if test='otptSeq != null'>
				, OTPT_SEQ = #{otptSeq}
			</if>
			<if test='usrDfnTxt1 != null'>
				, USR_DFN_TXT_1 =
				#{usrDfnTxt1}
			</if>
			<if test='usrDfnTxt2 != null'>
				, USR_DFN_TXT_2 =
				#{usrDfnTxt2}
			</if>
			<if test='usrDfnTxt3 != null'>
				, USR_DFN_TXT_3 =
				#{usrDfnTxt3}
			</if>
			<if test='usrDfnTxt4 != null'>
				, USR_DFN_TXT_4 =
				#{usrDfnTxt4}
			</if>
			<if test='usrDfnTxt5 != null'>
				, USR_DFN_TXT_5 =
				#{usrDfnTxt5}
			</if>
			<if test='bkCdDvsnNm != null'>
				, BK_CD_DVSN_NM =
				#{bkCdDvsnNm}
			</if>
			<if test='bkCdNm != null'>
				, BK_CD_NM = #{bkCdNm}
			</if>

			WHERE 1 = 1
			AND CMM_CD_DVSN_CD = #{cmmCdDvsnCd}
			AND CD = #{cd};

			INSERT
			INTO TBDCMACM032H
			(
			   CON_NO
			 , CON_USE_YN
			 , CMM_CD_DVSN_CD
			 , CD
			 , TSK_CAT_CD
			 , FUNC_CAT_CD
			 , CD_NM
			 , USE_YN
			 , PRD_USE_YN
			 , STR_DT
			 , END_DT
			 , OTPT_SEQ
			 , USR_DFN_TXT_1
			 , USR_DFN_TXT_2
			 , USR_DFN_TXT_3
			 , USR_DFN_TXT_4
			 , USR_DFN_TXT_5
			 , BK_CD_DVSN_NM
			 , BK_CD_NM


			 , FRT_USR_ID
			 , FNL_USR_ID
			 , FNL_DEAL_DPT_CD
			 , FNL_MNU_ID
			 , FRT_REGI_DH
			 , FNL_MDF_DH
			 )
	    SELECT
			   ( (SELECT NVL(MAX(CON_NO),0)+1 FROM TBDCMACM032H)) AS CON_NO /* 연계번호 */
			 , 'N' AS CON_USE_YN
			 , CMM_CD_DVSN_CD
			 , CD
			 , TSK_CAT_CD
			 , FUNC_CAT_CD
			 , CD_NM
			 , USE_YN
			 , PRD_USE_YN
			 , STR_DT
			 , END_DT
			 , OTPT_SEQ
			 , USR_DFN_TXT_1
			 , USR_DFN_TXT_2
			 , USR_DFN_TXT_3
			 , USR_DFN_TXT_4
			 , USR_DFN_TXT_5
			 , BK_CD_DVSN_NM
			 , BK_CD_NM


			 , #{fnlUsrId} AS FNL_USR_ID
			 , #{fnlUsrId} AS FNL_USR_ID
			 , #{fnlDealDptCd} AS FNL_DEAL_DPT_CD
			 , #{fnlMnuId} AS FNL_MNU_ID
			 , SYSDATE AS FRT_REGI_DH
			 , SYSDATE AS FNL_MDF_DH
          FROM TBDCMACM013C
	     WHERE CMM_CD_DVSN_CD = #{cmmCdDvsnCd}
		   AND CD = #{cd}
			 ;
		END;
	</update>




	<!-- 공통코드팝업조회 -->
	<select id="COMcmncodelistpopSelect" parameterType="paramMap"
		resultType="egovMap">
        /*kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.COMcmncodelistpopSelect*/
        <include refid="include.pageSelct" />
        <![CDATA[
			SELECT CM013.CMM_CD_DVSN_CD,
		           CM013.CD,
		           CM013.TSK_CAT_CD,
		           F_CODE_NM('1000343',CM013.TSK_CAT_CD) AS TSK_CAT_NM,
		           CM013.FUNC_CAT_CD||CM013.TSK_CAT_CD AS FUNC_CAT_CD,
		           CM013.CD_NM,
		           CM013.USE_YN,
                   CASE WHEN CM013.CMM_CD_DVSN_CD = '1000001' THEN DECODE(CM013.USE_YN,'Y','사용','N','사용불가','사용불가') /* [SR-2022-976] 출장지역명 현행화(시스템운영과 구성룡 : 출장지는 '사용불가'로 항목변경)*/
                        ELSE DECODE(CM013.USE_YN,'Y','사용','N','미사용','미사용') 
                         END USE_YN_NM,
		           CM013.PRD_USE_YN,
		           CM013.STR_DT,
		           CM013.END_DT,
		           CM013.OTPT_SEQ,
		           CM013.USR_DFN_TXT_1,
		           CM013.USR_DFN_TXT_2,
		           CM013.USR_DFN_TXT_3,
		           CM013.USR_DFN_TXT_4,
		           CM013.USR_DFN_TXT_5,
		           CM013.BK_CD_DVSN_NM,
		           CM013.BK_CD_NM,
		           CM013.FRT_USR_ID,
		           CM013.FNL_USR_ID,
		           CM013.FNL_DEAL_DPT_CD,
		           CM013.FNL_MNU_ID,
		           CM013.FRT_REGI_DH,
		           CM013. FNL_MDF_DH,
				   DVSN.CD AS UP_CODE,
		           DVSN.CD_NM AS UP_CODE_NM
			FROM	 TBDCMACM013C CM013
		        	,(SELECT CMM_CD_DVSN_CD, CD, CD_NM FROM TBDCMACM013C WHERE CD = '000000000') DVSN

			WHERE 	1=1
			AND     CM013.CD <> '000000000'
			AND 	CM013.CMM_CD_DVSN_CD = DVSN.CMM_CD_DVSN_CD
        ]]>

		<if test='cdNm != null and cdNm != ""'>
			AND (CM013.CD_NM LIKE'%'||#{cdNm}||'%' OR CM013.CD LIKE '%'||#{cdNm} ||'%')
		</if>
		<if test='cdDvsn != null and cdDvsn != ""'>
			AND CM013.CMM_CD_DVSN_CD = #{cdDvsn}
		</if>
		<if test='tskCatCd != null and tskCatCd != ""'>
			AND CM013.TSK_CAT_CD =
			#{tskCatCd}
		</if>
		<if test='funcCatCd != null and funcCatCd != ""'>
			AND CM013.FUNC_CAT_CD
			= #{funcCatCd}
		</if>
		<if test='useYn != null and useYn != ""'>
			AND CM013.USE_YN
			= #{useYn}
		</if>
		   <![CDATA[
	       ORDER BY CM013.CMM_CD_DVSN_CD,CM013.CD
            ]]>
        <include refid="include.pageOrder" />
	</select>

	<!-- 기관코드관리 조회 -->
	<select id="dcmacm011OrgSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
       SELECT ORG_CD
            , ORG_NM
            , RGN_CD
			, F_CODE_NM('1000001',RGN_CD) AS RGN_NM
            , ORG_DVSN_CD
            , ORG_DGE_CD
            , COPT_SG_CD
            , TNB
            , ZCD
            , AD
            , DTL_AD
            , ROAD_NM_AD
            , ROAD_NM_DTL_AD
            , USE_DVSN_NO
            , ENFM_DPT_CD
            , F_DPT_INFO(ENFM_DPT_CD, '1') AS ENFM_DPT_NM
            , ORG_CAT_CD
            , SUBSTR(ZCD,1,3) 										AS ZCD1
          	, SUBSTR(ZCD,4,3) 										AS ZCD2
          	, PUB_DVSN_CD
          	, PASA_USE_YN_CD
          	, PUB_DVSN_CD

         FROM TBDCMACM015M
        WHERE 1=1
	         ]]>
		<if test='enfmdptcd != null and enfmdptcd != ""'>
			AND ENFM_DPT_CD LIKE
			   '%'||#{enfmdptcd}||'%'
		</if>
		<if test='orgnm != null and orgnm != ""'>
			AND ORG_NM LIKE '%'||#{orgnm}||'%'
		</if>
		<if test='usedvsn != null and usedvsn != ""'>
			AND USE_DVSN_NO = #{usedvsn}
		</if>
		<if test='orgdvsncd != null and orgdvsncd != ""'>
			AND ORG_DVSN_CD = #{orgdvsncd}
		</if>
		<if test='orgdge != null and orgdge != ""'>
			AND ORG_DGE_CD = #{orgdge}
		</if>

		<if test='orgcd != null and orgcd != ""'>
			AND ORG_CD = #{orgcd}
		</if>
		<if test='pasauseyn != null and pasauseyn != ""'>
			AND PASA_USE_YN_CD = #{pasauseyn}
		</if>
		<if test='coptsg != null and coptsg != ""'>
			AND COPT_SG_CD = #{coptsg}
		</if>
		<if test='orgcdfrom != null and orgcdfrom != ""'>
		<![CDATA[
			AND ORG_CD >= #{orgcdfrom}
			]]>
		</if>
		<if test='orgcdto != null and orgcdto != ""'>
		<![CDATA[
			AND ORG_CD <= #{orgcdto}
		]]>
		</if>

		<if test='orderby == null or orderby == ""'>
			ORDER BY ORG_CD,ORG_NM
			</if>
		<if test='orderby != null and orderby != ""'>
				ORDER BY $strOrderBy$
		</if>

	</select>


	<!-- 기관코드관리신규 -->
	<insert id="dcmacm011OrgInsert" parameterType="paramMap">

		DECLARE
			BEGIN
				INSERT INTO
				TBDCMACM015M
				(
				ORG_CD
				, ORG_NM
				, RGN_CD
				, ORG_DVSN_CD
				, ORG_DGE_CD
				, COPT_SG_CD
				, TNB
				, ZCD
				, AD
				, DTL_AD
				, ROAD_NM_AD
				, ROAD_NM_DTL_AD
				, USE_DVSN_NO
				, CRE_DT
				, RMK
				, ENFM_DPT_CD
				, ORG_CAT_CD
				, CVPT_TON_ORG_YN
				, CHG_DT
				, BZN
				, ABLT_DT
				, PUB_DVSN_CD
				, PASA_USE_YN_CD

				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
				)
				VALUES
				(
				#{orgCd}
				, #{orgNm}
				, #{rgnCd}
				, #{orgDvsnCd}
				, #{orgDgeCd}
				, #{coptSgCd}
				, #{tnb}
				, #{zcd}
				, #{ad}
				, #{dtlAd}
				, #{roadNmAd}
				, #{roadNmDtlAd}
				, #{useDvsnNo}
				,TO_CHAR(SYSDATE,'yyyymmdd')
				, #{rmk}
				, #{enfmDptCd}
				, #{orgCatCd}
				, #{cvptTonOrgYn}
				, TO_CHAR(SYSDATE,'yyyymmdd')
				, #{bzn}
				, #{abltDt}
				, #{pubDvsnCd}
				, #{pasaUseYnCd}
				, #{frtUsrId}
				, #{fnlUsrId}
				, #{fnlDealDptCd}
				, #{fnlMnuId}
				, SYSDATE
				, SYSDATE
				);

				INSERT
				INTO
				TBDCMACM035H
				(
				  ORG_CD
				, CON_NO
				, CON_HNDL_DVSN_CD
				, USE_YN

				, FRT_USR_ID
				, FRT_REGI_DH
				, FNL_MNU_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MDF_DH
				) VALUES
				(
				  #{orgCd}
				, (	SELECT NVL(MAX(CON_NO),0)+1  AS CON_NO
					  FROM TBDCMACM035H
			       )
			    , 'C'
				, 'N'

				, #{frtUsrId}
				, SYSDATE
				, #{fnlMnuId}
				, #{fnlUsrId}
				, #{fnlDealDptCd}
				, SYSDATE
				);
		END;

	</insert>
	<!-- 기관 수정 -->
	<update id="dcmacm011OrgUpdate" parameterType="paramMap">

	DECLARE
		BEGIN
			UPDATE TBDCMACM015M
			SET ORG_CD = ORG_CD
			, FNL_MDF_DH = SYSDATE
			,
			FNL_USR_ID = #{fnlUsrId}
			, FNL_DEAL_DPT_CD = #{fnlDealDptCd}
			,
			FNL_MNU_ID = #{fnlMnuId}

			<if test='orgNm != null'>
				, ORG_NM = #{orgNm}
			</if>
			<if test='rgnCd != null'>
				, RGN_CD = #{rgnCd}
			</if>
			<if test='orgDvsnCd != null'>
				, ORG_DVSN_CD = #{orgDvsnCd}
			</if>
			<if test='orgDgeCd != null'>
				, ORG_DGE_CD = #{orgDgeCd}
			</if>
			<if test='tnb != null'>
				, TNB = #{tnb}
			</if>
			<if test='coptSgCd != null'>
				, COPT_SG_CD = #{coptSgCd}
			</if>
			<if test='zcd != null'>
				, ZCD = #{zcd}
			</if>
			<if test='ad != null'>
				, AD =#{ad}
			</if>
			<if test='dtlAd != null'>
				, DTL_AD = #{dtlAd}
			</if>
			<if test='roadNmAd != null'>
				, ROAD_NM_AD = #{roadNmAd}
			</if>
			<if test='roadNmDtlAd != null'>
				, ROAD_NM_DTL_AD =
				#{roadNmDtlAd}
			</if>
			<if test='useDvsnNo != null'>
				, USE_DVSN_NO = #{useDvsnNo}
			</if>
			<if test='enfmDptCd != null'>
				, ENFM_DPT_CD = #{enfmDptCd}
			</if>
			<if test='pasaUseYnCd != null'>
				, PASA_USE_YN_CD = #{pasaUseYnCd}
			</if>
			<if test='pubDvsnCd != null'>
				, PUB_DVSN_CD = #{pubDvsnCd}
			</if>

			WHERE 1 = 1
			AND ORG_CD = #{orgCd};

			INSERT INTO
			TBDCMACM034H(
			   CON_NO
			 , CON_USE_YN
			 , ORG_CD
			 , ORG_NM
			 , ORG_DVSN_CD
			 , ORG_DGE_CD
			 , COPT_SG_CD
			 , TNB
			 , ZCD
			 , AD
			 , DTL_AD
			 , ROAD_NM_AD
			 , ROAD_NM_DTL_AD
			 , USE_DVSN_NO
			 , CRE_DT
			 , RMK
			 , ENFM_DPT_CD
			 , ORG_CAT_CD
			 , CVPT_TON_ORG_YN
			 , CHG_DT
			 , BZN
			 , ABLT_DT
			 , PUB_DVSN_CD
			 , SRCH_CNT
			 , PASA_USE_YN_CD
			 , FRT_USR_ID
			 , FNL_USR_ID
			 , FNL_DEAL_DPT_CD
			 , FNL_MNU_ID
			 , FRT_REGI_DH
			 , FNL_MDF_DH
			 , RGN_CD    /* 추가 - 2015.05.26 yyh */
			)
			SELECT (SELECT NVL(MAX(CON_NO),'0')+1 FROM TBDCMACM034H) AS CON_NO
			     , 'N' AS CON_USE_YN
				 , ORG_CD
				 , ORG_NM
				 , ORG_DVSN_CD
				 , ORG_DGE_CD
				 , COPT_SG_CD
				 , TNB
				 , ZCD
				 , AD
				 , DTL_AD
				 , ROAD_NM_AD
				 , ROAD_NM_DTL_AD
				 , USE_DVSN_NO
				 , CRE_DT
				 , RMK
				 , ENFM_DPT_CD
				 , ORG_CAT_CD
				 , CVPT_TON_ORG_YN
				 , CHG_DT
				 , BZN
				 , ABLT_DT
				 , PUB_DVSN_CD
				 , SRCH_CNT
				 , PASA_USE_YN_CD
				 , #{fnlUsrId} AS FRT_USR_ID
				 , #{fnlUsrId} AS FNL_USR_ID
				 , #{fnlDealDptCd} AS FNL_DEAL_DPT_CD
				 , #{fnlMnuId} AS FNL_MNU_ID
				 , SYSDATE AS FRT_REGI_DH
				 , SYSDATE AS FNL_MDF_DH
				 , RGN_CD
			 FROM TBDCMACM015M
			 WHERE ORG_CD = #{orgCd};

		END;

	</update>

	<!-- 기관코드 delete -->
	<delete id="dcmacm011OrgDelete" parameterType="paramMap">

	DECLARE
		BEGIN
			DELETE
			TBDCMACM015M
			WHERE 1 = 1
			AND ORG_CD = #{orgCd};

				INSERT
					INTO
					TBDCMACM035H
					(
					  ORG_CD
					, CON_NO
					, CON_HNDL_DVSN_CD
					, USE_YN

					, FRT_USR_ID
					, FRT_REGI_DH
					, FNL_MNU_ID
					, FNL_USR_ID
					, FNL_DEAL_DPT_CD
					, FNL_MDF_DH
					) VALUES
					(
					  #{orgCd}
					, (	SELECT NVL(MAX(CON_NO),0)+1  AS CON_NO
						  FROM TBDCMACM035H
				       )
				    , 'D'
					, 'N'

					, #{frtUsrId}
					, SYSDATE
					, #{fnlMnuId}
					, #{fnlUsrId}
					, #{fnlDealDptCd}
					, SYSDATE
					);
			END;
	</delete>


	<!-- 기관코드 팝업 국가기관조회 -->
	<select id="dcmacm014OrgNatSelect" parameterType="paramMap"
		resultType="egovMap">
		<include refid="include.pageSelct" />

	<![CDATA[
       SELECT CASE
          WHEN USE_DVSN_NO='N' THEN '(*)'||ORG_CD
           ELSE  ORG_CD
           END AS ORG_CD_YN
            , ORG_CD
            , ORG_NM
            , RGN_CD
            , F_CODE_NM('1000001',RGN_CD) AS RGN_NM
            , ORG_DVSN_CD
            , F_CODE_NM('1000119',ORG_DVSN_CD) AS ORG_DVSN_NM
            , ORG_DGE_CD
            , F_CODE_NM('1000346',ORG_DGE_CD) AS ORG_DGE_NM
            , COPT_SG_CD
            , F_ORG_HRK_NM(COPT_SG_CD) AS COPT_SG_NM
            , TNB
            , ZCD
            , AD
            , DTL_AD
			, ROAD_NM_AD
            , ROAD_NM_DTL_AD
            , USE_DVSN_NO
            , ENFM_DPT_CD
            , ORG_CAT_CD
            , PUB_DVSN_CD
            , (SELECT	F_CODE_NM('1000447',Z.USR_DFN_TXT_1)
   						FROM	TBDCMACM013C Z
   						WHERE	Z.CMM_CD_DVSN_CD ='1000128'
   						AND		Z.CD =PUB_DVSN_CD) AS PUB_DVSN_NM
         FROM TBDCMACM015M
        WHERE 1=1

         AND ORG_DVSN_CD = '10'
	         ]]>
        <if test='orgCdList != null and orgCdList != ""'>
            AND ORG_CD IN
             <foreach item="item" index="index" collection="orgCdList" open="(" close=")" separator=",">
                    #{item}
            </foreach>
        </if>
		<if test='useDvsn != null and useDvsn != ""'>
			AND USE_DVSN_NO = #{useDvsn}
		</if>
		<if test='orgNm != null and orgNm != ""'>
			AND (ORG_NM LIKE
			'%'||#{orgNm}||'%'OR ORG_CD LIKE
			'%'||#{orgNm}||'%')
		</if>
		<if test='coptSgCd != null and coptSgCd != ""'>
			AND COPT_SG_CD = #{coptSgCd}
		</if>
		<if test='orgDgeCd != null and orgDgeCd != ""'>
			AND ORG_DGE_CD = #{orgDgeCd}
		</if>
		<if test='orgDvsnCd != null and orgDvsnCd != ""'>
			AND ORG_DVSN_CD = #{orgDvsnCd}
		</if>
		<if test='coptdvsn != null and coptdvsn != ""'>
			   AND EXISTS ( SELECT 1
                  FROM TBDCMACM013C
                 WHERE CMM_CD_DVSN_CD ='1000719'
                   AND USR_DFN_TXT_1||'000000000' = TBDCMACM015M.ORG_CD)
		</if>

		<include refid="include.pageOrder" />
	</select>

	<!-- 기관코드 팝업 기타 -->
	<select id="dcmacm016OrgEtcSelect" parameterType="paramMap"
		resultType="egovMap">
		<include refid="include.pageSelct" />

	<![CDATA[
       SELECT CASE
          WHEN USE_DVSN_NO='N' THEN '(*)'||ORG_CD
           ELSE  ORG_CD
           END AS ORG_CD_YN
            , ORG_CD
            , ORG_NM
            , RGN_CD
            ,  F_CODE_NM('1000001',RGN_CD) AS RGN_NM
            , ORG_DVSN_CD
            , F_CODE_NM('1000119',ORG_DVSN_CD) AS ORG_DVSN_NM
            , ORG_DGE_CD
            , F_CODE_NM('1000346',ORG_DGE_CD) AS ORG_DGE_NM
            , COPT_SG_CD
            , F_ORG_HRK_NM(COPT_SG_CD) AS COPT_SG_NM
            , TNB
            , ZCD
            , AD
            , DTL_AD
			, ROAD_NM_AD
            , ROAD_NM_DTL_AD
            , USE_DVSN_NO
            , ENFM_DPT_CD
            , ORG_CAT_CD
            , PUB_DVSN_CD
            , (SELECT	F_CODE_NM('1000447',Z.USR_DFN_TXT_1)
   						FROM	TBDCMACM013C Z
   						WHERE	Z.CMM_CD_DVSN_CD ='1000128'
   						AND		Z.CD =PUB_DVSN_CD) AS PUB_DVSN_NM
         FROM TBDCMACM015M
        WHERE 1=1
         AND ORG_DVSN_CD IN ('58','59')


	         ]]>

        <if test='orgCdList != null and orgCdList != ""'>
            AND ORG_CD IN
             <foreach item="item" index="index" collection="orgCdList" open="(" close=")" separator=",">
                    #{item}
            </foreach>
        </if>
		<if test='useDvsn != null and useDvsn != ""'>
			AND USE_DVSN_NO = #{useDvsn}
		</if>
		<if test='orgNm != null and orgNm != ""'>
			AND (ORG_NM LIKE
			'%'||#{orgNm}||'%'OR ORG_CD LIKE
			'%'||#{orgNm}||'%')
		</if>
		<if test='coptSgCd != null and coptSgCd != ""'>
			AND COPT_SG_CD = #{coptSgCd}
		</if>
		<if test='orgDgeCd != null and orgDgeCd != ""'>
			AND ORG_DGE_CD = #{orgDgeCd}
		</if>
		<if test='orgDvsnCd != null and orgDvsnCd != ""'>
			AND ORG_DVSN_CD = #{orgDvsnCd}
		</if>

		<if test='coptdvsn != null and coptdvsn != ""'>
			   AND EXISTS ( SELECT 1
                  FROM TBDCMACM013C
                 WHERE CMM_CD_DVSN_CD ='1000719'
                   AND USR_DFN_TXT_1||'000000000' = TBDCMACM015M.ORG_CD)
		</if>
		<include refid="include.pageOrder" />
	</select>
	<!-- 기관 코드 지방자치단체 -->
	<select id="dcmacm015OrgPvcSelect" parameterType="paramMap"
		resultType="egovMap">
		<include refid="include.pageSelct" />

	<![CDATA[
       SELECT CASE
          WHEN USE_DVSN_NO='N' THEN '(*)'||ORG_CD
           ELSE  ORG_CD
           END AS ORG_CD_YN
            , ORG_CD
            , ORG_NM
            , RGN_CD
            , F_CODE_NM('1000001',RGN_CD) AS RGN_NM

            , ORG_DVSN_CD
            , F_CODE_NM('1000119',ORG_DVSN_CD) AS ORG_DVSN_NM
            , ORG_DGE_CD
            , F_CODE_NM('1000346',ORG_DGE_CD) AS ORG_DGE_NM
            , COPT_SG_CD
            , F_ORG_HRK_NM(COPT_SG_CD) AS COPT_SG_NM
            , TNB
            , ZCD
            , AD
            , DTL_AD
			, ROAD_NM_AD
            , ROAD_NM_DTL_AD
            , USE_DVSN_NO
            , ENFM_DPT_CD
            , ORG_CAT_CD
            , PUB_DVSN_CD
            , (SELECT	F_CODE_NM('1000447',Z.USR_DFN_TXT_1)
   						FROM	TBDCMACM013C Z
   						WHERE	Z.CMM_CD_DVSN_CD ='1000128'
   						AND		Z.CD =PUB_DVSN_CD) AS PUB_DVSN_NM
         FROM TBDCMACM015M
        WHERE 1=1
         AND ORG_DVSN_CD IN ('21','22')
	         ]]>
        <if test='orgCdList != null and orgCdList != ""'>
            AND ORG_CD IN
             <foreach item="item" index="index" collection="orgCdList" open="(" close=")" separator=",">
                    #{item}
            </foreach>
        </if>
		<if test='useDvsn != null and useDvsn != ""'>
			AND USE_DVSN_NO = #{useDvsn}
		</if>
		<if test='orgNm != null and orgNm != ""'>
			AND (ORG_NM LIKE
			'%'||#{orgNm}||'%'OR ORG_CD LIKE
			'%'||#{orgNm}||'%')
		</if>
		<if test='coptSgCd != null and coptSgCd != ""'>
			AND COPT_SG_CD = #{coptSgCd}
		</if>
		<if test='orgDgeCd != null and orgDgeCd != ""'>
			AND ORG_DGE_CD = #{orgDgeCd}
		</if>
		<if test='orgDvsnCd != null and orgDvsnCd != ""'>
			AND ORG_DVSN_CD = #{orgDvsnCd}
		</if>

		<if test='coptdvsn != null and coptdvsn != ""'>
			   AND EXISTS ( SELECT 1
                  FROM TBDCMACM013C
                 WHERE CMM_CD_DVSN_CD ='1000719'
                   AND USR_DFN_TXT_1||'000000000' = TBDCMACM015M.ORG_CD)
		</if>
		<include refid="include.pageOrder" />
	</select>
	<!-- 기관코드 공공기관 -->
	<select id="dcmacm017OrgPubSelect" parameterType="paramMap"
		resultType="egovMap">
		<include refid="include.pageSelct" />

	<![CDATA[
       SELECT CASE
          WHEN USE_DVSN_NO='N' THEN '(*)'||ORG_CD
           ELSE  ORG_CD
           END AS ORG_CD_YN
            , ORG_CD
            , ORG_NM
            , RGN_CD
            , F_CODE_NM('1000001',RGN_CD) AS RGN_NM
            , ORG_DVSN_CD
            , F_CODE_NM('1000119',ORG_DVSN_CD) AS ORG_DVSN_NM
            , ORG_DGE_CD
            , F_CODE_NM('1000346',ORG_DGE_CD) AS ORG_DGE_NM
            , COPT_SG_CD
            , F_ORG_HRK_NM(COPT_SG_CD) AS COPT_SG_NM
            , TNB
            , ZCD
            , AD
            , DTL_AD
			, ROAD_NM_AD
            , ROAD_NM_DTL_AD
            , USE_DVSN_NO
            , ENFM_DPT_CD
            , ORG_CAT_CD
            , PUB_DVSN_CD
            , (SELECT	F_CODE_NM('1000447',Z.USR_DFN_TXT_1)
   						FROM	TBDCMACM013C Z
   						WHERE	Z.CMM_CD_DVSN_CD ='1000128'
   						AND		Z.CD =PUB_DVSN_CD) AS PUB_DVSN_NM
         FROM TBDCMACM015M
        WHERE 1=1
         AND ORG_DVSN_CD NOT IN ('10','21','22','58','59')
	         ]]>
        <if test='orgCdList != null and orgCdList != ""'>
            AND ORG_CD IN
             <foreach item="item" index="index" collection="orgCdList" open="(" close=")" separator=",">
                    #{item}
            </foreach>
        </if>
		<if test='useDvsn != null and useDvsn != ""'>
			AND USE_DVSN_NO = #{useDvsn}
		</if>
		<if test='orgNm != null and orgNm != ""'>
			AND (ORG_NM LIKE
			'%'||#{orgNm}||'%'OR ORG_CD LIKE
			'%'||#{orgNm}||'%')
		</if>
		<if test='coptSgCd != null and coptSgCd != ""'>
			AND COPT_SG_CD = #{coptSgCd}
		</if>
		<if test='orgDgeCd != null and orgDgeCd != ""'>
			AND ORG_DGE_CD = #{orgDgeCd}
		</if>
		<if test='orgDvsnCd != null and orgDvsnCd != ""'>
			AND ORG_DVSN_CD = #{orgDvsnCd}
		</if>

		<if test='coptdvsn != null and coptdvsn != ""'>
			   AND EXISTS ( SELECT 1
                  FROM TBDCMACM013C
                 WHERE CMM_CD_DVSN_CD ='1000719'
                   AND USR_DFN_TXT_1||'000000000' = TBDCMACM015M.ORG_CD)
		</if>
		<include refid="include.pageOrder" />

	</select>
	<!-- 기관팝업 전체조회 -->
	<select id="dcmacm013OrgAllSelect" parameterType="paramMap"
		resultType="egovMap">
		<include refid="include.pageSelct" />

	<![CDATA[
       SELECT CASE
          WHEN USE_DVSN_NO='N' THEN '(*)'||ORG_CD
           ELSE  ORG_CD
           END AS ORG_CD_YN
            , ORG_CD
            , ORG_NM
            , RGN_CD
            , F_CODE_NM('1000001',RGN_CD) AS RGN_NM
            , ORG_DVSN_CD
            , F_CODE_NM('1000119',ORG_DVSN_CD) AS ORG_DVSN_NM
            , ORG_DGE_CD
            , F_CODE_NM('1000346',ORG_DGE_CD) AS ORG_DGE_NM
            , COPT_SG_CD
            , F_ORG_HRK_NM(COPT_SG_CD) AS COPT_SG_NM
            , TNB
            , ZCD
            , AD
            , DTL_AD
			, ROAD_NM_AD
            , ROAD_NM_DTL_AD
            , USE_DVSN_NO
            , ENFM_DPT_CD
            , ORG_CAT_CD
            , PUB_DVSN_CD
            , (SELECT	F_CODE_NM('1000447',Z.USR_DFN_TXT_1)
   						FROM	TBDCMACM013C Z
   						WHERE	Z.CMM_CD_DVSN_CD ='1000128'
   						AND		Z.CD =PUB_DVSN_CD) AS FNA_CLS_CD
         FROM TBDCMACM015M
        WHERE 1=1
	         ]]>
        <if test='orgCdList != null and orgCdList != ""'>
            AND ORG_CD IN
             <foreach item="item" index="index" collection="orgCdList" open="(" close=")" separator=",">
                    #{item}
            </foreach>
        </if>
		<if test='useDvsn != null and useDvsn != ""'>
			AND USE_DVSN_NO = #{useDvsn}
		</if>
		<if test='orgNm != null and orgNm != ""'>
			AND (ORG_NM LIKE
			'%'||#{orgNm}||'%'OR ORG_CD LIKE
			'%'||#{orgNm}||'%')
		</if>
		<if test='coptSgCd != null and coptSgCd != ""'>
			AND COPT_SG_CD = #{coptSgCd}
		</if>
		<if test='orgDvsnCd != null and orgDvsnCd != ""'>
			AND ORG_DVSN_CD = #{orgDvsnCd}
		</if>
		<if test='orgDgeCd != null and orgDgeCd != ""'>
			AND ORG_DGE_CD = #{orgDgeCd}
		</if>
		<if test='coptdvsn != null and coptdvsn != ""'>
			   AND EXISTS ( SELECT 1
                  FROM TBDCMACM013C
                 WHERE CMM_CD_DVSN_CD ='1000719'
                   AND USR_DFN_TXT_1||'000000000' = TBDCMACM015M.ORG_CD)
		</if>
		<include refid="include.pageOrder" />

	</select>

	<!-- 임포트 조회 -->

	<select id="dcmacm013OrgImpSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
       SELECT ORG_CD
            , ORG_NM
            , RGN_CD
            , F_CODE_NM('1000001',RGN_CD) AS RGN_NM
            , ORG_DVSN_CD
            , F_CODE_NM('1000119',ORG_DVSN_CD) AS ORG_DVSN_NM
            , ORG_DGE_CD
            , F_CODE_NM('1000346',ORG_DGE_CD) AS ORG_DGE_NM
            , COPT_SG_CD
            , F_ORG_HRK_NM(COPT_SG_CD) AS COPT_SG_NM
            , TNB
            , ZCD
            , AD

            , DTL_AD
			, ROAD_NM_AD
            , ROAD_NM_DTL_AD
            , USE_DVSN_NO
            , ENFM_DPT_CD
            , ORG_CAT_CD
            , PUB_DVSN_CD

         FROM TBDCMACM015M
        WHERE 1=1
	         ]]>
		<if test='orgnm != null and orgnm != ""'>
			AND (ORG_NM LIKE
			'%'||#{orgnm}||'%'OR ORG_CD LIKE
			'%'||#{orgnm}||'%')
		</if>
		<if test='coptsg != null and coptsg != ""'>
			AND COPT_SG_CD = #{coptsg}
		</if>
		<if test='orgdvsncd != null and orgdvsncd != ""'>
			AND ORG_DVSN_CD = #{orgdvsncd}
		</if>
		<if test='usedvsn != null and usedvsn != ""'>
			AND USE_DVSN_NO = #{usedvsn}
		</if>

		<if test='coptdvsn != null and coptdvsn != ""'>
			   AND EXISTS ( SELECT 1
                  FROM TBDCMACM013C
                 WHERE CMM_CD_DVSN_CD ='1000719'
                   AND USR_DFN_TXT_1||'000000000' = TBDCMACM015M.ORG_CD)
		</if>
	</select>
	<!-- 사용자조회 -->
	<!--2015.11.18 조석원 감사관님 요청 - 팩스번호-->
	<select id="dcmacm001UsrMgSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
 SELECT USR_DVSN_CD
            , F_CODE_NM('1000338',USR_DVSN_CD) AS USR_DVSN_NM
            , ORG_CD
            , F_ORG_INFO(ORG_CD,'1') AS ORG_NM
            , CNB
            , DPT_CD
            , F_DPT_INFO(DPT_CD,'1') AS DPT_NM
            , USR_ID
            , USR_NAM
            , RQS_STA_CD
            , RLS_DT
            , TNB
            , RANK_CD
            , F_CODE_NM('1000173',RANK_CD) AS RANK_NM
            , PST_CD
            , F_CODE_NM('1000176',PST_CD)  AS PST_NM
            , EIN
            , EML_AD

            , BAI_USR_YN
            , ZCD
            , APM_DVSN_CD
            , HOM_TNB
            , RQS_TXT
            , LOGIN_WAY_CD
            , DOC_ID
            , DOC_TYP_CD

            , DECODE(INN_RANK_CD, '60', '', INN_RANK_CD) AS INN_RANK_CD

            /*2015.01.27 박재운 감사관 요청-실소속부서 수정가능하도록.*/
            , RAL_BLT_DIV_CD                                            /*실소속코드*/
            , F_CODE_NM('1000144', RAL_BLT_DIV_CD) AS RAL_BLT_DIV_NM    /*실소속명*/

            , FAN
            , CAR_NO
         FROM TBDCMACM001M T1
         WHERE 1=1
          ]]>

		<if test='usrnam != null and usrnam != ""'>
			AND USR_NAM LIKE #{usrnam}||'%'
		</if>
		<if test='usrid != null and usrid != ""'>
			AND USR_ID LIKE #{usrid}||'%'
		</if>
		<if test='dptcd != null and dptcd != ""'>
			AND DPT_CD = #{dptcd}
		</if>
		<if test='hirkdptcd != null and hirkdptcd != ""'>
			AND	SUBSTR(DPT_CD, 0, 3) = SUBSTR(#{hirkdptcd}, 0, 3)
		</if>
		<if test='rqsstacd != null and rqsstacd != ""'>
			AND RQS_STA_CD = #{rqsstacd}
		</if>

		<if test='usrdvsn != null and usrdvsn != ""'>
			AND USR_DVSN_CD = #{usrdvsn}
		</if>

		<if test='usrcnb != null and usrcnb != ""'>
			AND CNB LIKE #{usrcnb}||'%'
		</if>
		<if test='loginwaycd != null and loginwaycd != ""'>
			AND LOGIN_WAY_CD = #{loginwaycd}
		</if>
		<if test='order != null and order != ""'>
			ORDER BY RANK_CD, CNB
		</if>
		<if test='order == null or order == ""'>
		ORDER BY USR_NAM
		</if>
	</select>



	<!-- 사용자 신규 2015.1.13 BAI_USR_YN 추가 전상철대리님 요청사항-->
	<!-- 신규 등록시 직급정렬순서명 값은 사용자구분에 상관없이 무조건 10을 넣는다. 2015.03.25 박재운감사관 요청 -->
	<insert id="dcmacm001UsrMgInsert" parameterType="paramMap">
	DECLARE
		BEGIN
			INSERT INTO
			TBDCMACM001M
			(
			CNB
			, USR_ID
			, USR_NAM
			, RANK_CD
			, PST_CD
			, DPT_CD
			, TNB
			, EIN
			, AD
			, EML_AD
			, USR_DVSN_CD
			, RQS_TXT
			, RQS_STA_CD


			, RQR_ID
			, RQS_DT

			, RLS_DT
			, LOGIN_WAY_CD
			, DOC_ID
			, ESN
			, TMP_YN
			, BAI_USR_YN
			, ORG_CD
			, INN_RANK_CD
			, HOM_TNB
	        , RAL_BLT_DIV_CD
			, FNL_MNU_ID
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FRT_REGI_DH
			, FNL_MDF_DH
			, WOK_DVSN_CD
			, RANK_SRT_SEQ_NM

			,FAN
			,CAR_NO
			)
			VALUES
			(
			  #{cnb}
			, #{usrId}
			, #{usrNam}
			, #{rankCd}
			, #{pstCd}
			, #{dptCd}
			, #{tnb}
			, #{ein}
			, #{ad}
			, #{emlAd}
			, #{usrDvsnCd}
			, #{rqsTxt}
			, '3'


			, #{frtUsrId}
			, TO_CHAR(SYSDATE,'yyyymmdd')

			,TO_CHAR(SYSDATE,'yyyymmdd')
			, #{loginWayCd}
			, #{docId}
			, #{esn}
			, 'Y'
			, 'Y'
			, '011000000000'
			, #{innRankCd}
			, #{homTnb}
	        , #{ralBltDivCd}
			, #{fnlMnuId}
			, #{frtUsrId}
			, #{fnlUsrId}
			, #{fnlDealDptCd}
			, SYSDATE
			, SYSDATE
			, DECODE(#{usrDvsnCd},'3','AAA',NULL)
			, '10'

			,#{fan}
			,#{carNo}
			);
		INSERT
				INTO
				TBDCMACM038H
				(
				  CNB
				, CON_NO
				, CON_HNDL_DVSN_CD
				, USE_YN

				, FRT_USR_ID
				, FRT_REGI_DH
				, FNL_MNU_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MDF_DH
				) VALUES
				(
				  #{cnb}
				, (	SELECT NVL(MAX(CON_NO),0)+1  AS CON_NO
					  FROM TBDCMACM038H
			       )
			    , 'C'
				, 'N'

				, #{frtUsrId}
				, SYSDATE
				, #{fnlMnuId}
				, #{fnlUsrId}
				, #{fnlDealDptCd}
				, SYSDATE
				);
		 END;

	</insert>

	<!-- 사용자 수정 -->
	<update id="dcmacm001UsrMgUpdate" parameterType="paramMap">
	DECLARE
		BEGIN
		UPDATE TBDCMACM001M
		SET CNB = #{cnb}
		, FNL_MDF_DH = SYSDATE
		, FNL_MNU_ID =
		#{fnlMnuId}
		, FNL_USR_ID = #{fnlUsrId}
		, FNL_DEAL_DPT_CD =
		#{fnlDealDptCd}
		<if test='docId != null'>
			, DOC_ID = #{docId}
		</if>
		<if test='usrId != null'>
			, USR_ID = #{usrId}
		</if>
		<if test='usrNam != null'>
			, USR_NAM = #{usrNam}
		</if>
		<if test='rankCd != null'>
			, RANK_CD = #{rankCd}
		</if>
		<if test='pstCd != null'>
			, PST_CD = #{pstCd}
		</if>
		<if test='dptCd != null'>
			, DPT_CD = #{dptCd}
		</if>
		<if test='rqsStaCd != null'>
			, RQS_STA_CD = #{rqsStaCd}
		</if>
		<if test='tnb != null'>
			, TNB = #{tnb}
		</if>
		<if test='ein != null'>
			, EIN = #{ein}
		</if>
		<if test='emlAd != null'>
			, EML_AD =#{emlAd}
		</if>
		<if test='usrDvsnCd != null'>
			, USR_DVSN_CD = #{usrDvsnCd}
		</if>
		<if test='rqsTxt != null'>
			, RQS_TXT = #{rqsTxt}
		</if>
		<if test='rqsStaCd != null'>
			, RLS_DT =
			TO_CHAR(SYSDATE,'yyyymmdd')
		</if>

		<if test='loginWayCd != null'>
			, LOGIN_WAY_CD =
			#{loginWayCd}
		</if>

		<if test='innRankCd != null'>
			, INN_RANK_CD =
			#{innRankCd}
		</if>
		<if test='homTnb != null'>
			, HOM_TNB =
			#{homTnb}
		</if>
		<!-- 2015.01.27 박재운 감사관 : 실부서코드 수정 가능하도록 요청 -->
		<if test='ralBltDivCd != null'>
			, RAL_BLT_DIV_CD = #{ralBltDivCd}
		</if>

		<if test='fan != null'>
			, FAN = #{fan}
		</if>

		<if test='carNo != null'>
			, CAR_NO = #{carNo}
		</if>

		WHERE 1 = 1
		AND CNB = #{cnb}
		;
		INSERT INTO TBDCMACM037H
		(     CON_NO
		    , CON_USE_YN
			, CNB
			, USR_ID
			, USR_NAM
			, RANK_CD
			, PST_CD
			, DPT_CD
			, TNB
			, EIN
			, EML_AD
			, USR_DVSN_CD
			, RQS_TXT
			, DOC_ID
			, DOC_TYP_CD
			, BAI_USR_YN
			, ORG_CD
			, ACP_DT
			, ZCD
			, AD
			, DTL_AD
			, ROAD_NM_AD
			, ROAD_NM_DTL_AD
			, RAL_BLT_DIV_CD
			, OCP_CD
			, PS_CD
			, PS_DT
			, RSG_DT
			, CRNT_RANK_APM_DT
			, APM_DVSN_CD
			, RSD_ZCD
			, HOM_TNB
			, WOK_DVSN_CD
			, CRNT_DPT_APM_DT
			, VAC_YN
			, RQR_ID
			, RQS_DT
			, RQS_STA_CD
			, INN_RANK_CD
			, DPT_DT
			, BZT_YN
			, RANK_SRT_SEQ_NM
			, SRT_KY_NO
			, RLS_DT
			, RANK_CD_2
			, RANK_NM_2
			, DNV_INF
			, LOGIN_WAY_CD
			, ESN
			, TMP_YN
			, FNL_CHG_DT
			, CHG_APT_DT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
			)
	   SELECT
			( (SELECT NVL(MAX(CON_NO),0)+1 FROM TBDCMACM037H)) AS CON_NO /* 연계번호 */
			, 'N' AS CON_USE_YN
			, CNB				/*전산번호(PK)       */
			, USR_ID				/*사용자ID           */
			, USR_NAM				/*사용자성명         */
			, RANK_CD				/*직급코드           */
			, PST_CD				/*직위코드           */
			, DPT_CD				/*부서코드           */
			, TNB					/*전화번호           */
			, EIN					/*암호화주민등록번호 */
			, EML_AD				/*이메일주소         */
			, USR_DVSN_CD			/*사용자구분코드     */
			, RQS_TXT				/*요청내용           */
			, DOC_ID				/*문서ID             */
			, DOC_TYP_CD			/*문서유형코드       */
			, BAI_USR_YN			/*감사원사용자여부   */
			, ORG_CD	 			/*기관코드           */
			, ACP_DT	 			/*접수일             */
			, ZCD	     			/*우편번호           */
			, AD	     			/*주소               */
			, DTL_AD				/*상세주소           */
			, ROAD_NM_AD			/*도로명주소         */
			, ROAD_NM_DTL_AD		/*도로명상세주소     */
			, RAL_BLT_DIV_CD		/*실소속과코드       */
			, OCP_CD				/*직종코드           */
			, PS_CD				    /*호봉코드           */
			, PS_DT				    /*호봉일             */
			, RSG_DT				/*퇴직일             */
			, CRNT_RANK_APM_DT	    /*현직급임용일       */
			, APM_DVSN_CD			/*임용구분코드       */
			, RSD_ZCD				/*거주지우편번호     */
			, HOM_TNB				/*자택전화번호       */
			, WOK_DVSN_CD			/*재직구분코드       */
			, CRNT_DPT_APM_DT		/*현부서임용일       */
			, VAC_YN				/*휴가여부           */
			, RQR_ID				/*요청자ID           */
			, RQS_DT				/*요청일             */
			, RQS_STA_CD			/*요청상태코드       */
			, INN_RANK_CD			/*내부직급코드       */
			, DPT_DT				/*부서일             */
			, BZT_YN				/*출장여부           */
			, RANK_SRT_SEQ_NM		/*직급정렬순서명     */
			, SRT_KY_NO			    /*정렬키번호         */
			, RLS_DT				/*해제일             */
			, RANK_CD_2			    /*직급코드2          */
			, RANK_NM_2			    /*직급명2            */
			, DNV_INF				/*정보               */
			, LOGIN_WAY_CD		    /*로그인방법코드     */
			, ESN					/*암호화비밀번호     */
			, TMP_YN				/*임시여부           */
			, FNL_CHG_DT			/*최종변경일         */
			, CHG_APT_DT			/*변경예정일         */
			, #{fnlUsrId} AS FRT_USR_ID 			/*최초사용자ID       */
			, #{fnlUsrId} AS FNL_USR_ID			/*최종사용자ID       */
			, #{fnlDealDptCd} AS FNL_DEAL_DPT_CD 		/*최종거래부서코드   */
			, #{fnlMnuId} AS FNL_MNU_ID			/*최종메뉴ID         */
			, SYSDATE AS FRT_REGI_DH			/*최초등록일시       */
			, SYSDATE AS FNL_MDF_DH			/*최종수정일시       */
		FROM TBDCMACM001M
	   WHERE CNB = #{cnb};
	   END;
	</update>

	<!-- 사용자 delete -->
	<delete id="dcmacm001UsrMgDelete" parameterType="paramMap">
	DECLARE
	  BEGIN
		DELETE
		TBDCMACM001M
		WHERE 1 = 1
		AND CNB = #{cnb};

		INSERT
				INTO
				TBDCMACM038H
				(
				  CNB
				, CON_NO
				, CON_HNDL_DVSN_CD
				, USE_YN

				, FRT_USR_ID
				, FRT_REGI_DH
				, FNL_MNU_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MDF_DH
				) VALUES
				(
				  #{cnb}
				, (	SELECT NVL(MAX(CON_NO),0)+1  AS CON_NO
					  FROM TBDCMACM038H
			       )
			    , 'D'
				, 'N'

				, #{frtUsrId}
				, SYSDATE
				, #{fnlMnuId}
				, #{fnlUsrId}
				, #{fnlDealDptCd}
				, SYSDATE
				);
			END;
	</delete>

	<!-- 사용자 delete 시 비밀번호이력 -->
	<delete id="dcmacm001PwdDelete" parameterType="paramMap">
		DELETE
		TBDCMACM028L
		WHERE 1 = 1
		AND CNB = #{cnb}
	</delete>

	<!-- 사용자 delete 시 비밀번호변경이력 삭제 -->
	<delete id="dcmacm001PwdHstDelete" parameterType="paramMap">
		DELETE
		TBDCMACM029H
		WHERE 1 = 1
		AND CNB = #{cnb}
	</delete>




	<!--사용자 아이디 유무 체크 -->
	<select id="dcmacm001UsrIdCheck" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
       SELECT USR_ID
           FROM TBDCMACM001M
         WHERE 1=1
         AND USR_ID =#{usrid}
          ]]>
	</select>


	<!-- 사용자전산번호 max+1 -->
	<select id="dcmacm001UsrCnbMax" parameterType="paramMap"
		resultType="java.lang.String">
	<![CDATA[
         SELECT LPAD(MAX(NVL(TRANSLATE(CNB, '0123456789' || CNB, '0123456789'), 0)) + 1, 4, 0) AS CNB
           FROM TBDCMACM001M
          WHERE 1 = 1
          ]]>
		<if test='usrdvsn == "7"'>
		    	AND  SUBSTR(CNB,0,1) <![CDATA[ <= ]]> #{usrdvsn}
		    </if>
		<if test='usrdvsn != "7"'>
		    	AND  SUBSTR(CNB,0,1) = #{usrdvsn}
		    </if>
	</select>


	<!-- 사용자비밀번호 재설정[주민번호뒷자리] -->
	<update id="dcmacm001UsrPwdUpdate" parameterType="paramMap">
		UPDATE TBDCMACM001M
		SET
		FNL_CHG_DT = TO_CHAR(SYSDATE,'yyyymmdd')
		, ESN=#{pwd}
		, TMP_YN = 'Y'
		,
		FNL_MDF_DH = SYSDATE
		, FNL_USR_ID = #{fnlUsrId}
		, FNL_DEAL_DPT_CD =#{fnlDealDptCd}
		, FNL_MNU_ID = #{fnlMnuId}

		WHERE CNB=#{cnb}
	</update>

	<!-- 사용자비밀번호변경이력 -->
	<insert id="dcmacm001UsrPwdHstInsert" parameterType="paramMap">
		INSERT INTO
		TBDCMACM029H
		(
		HST_DH
		, HST_DVSN_CD
		, HST_SNO
		, CNB
		, ESN
		, TMP_YN
		,
		FNL_CHG_DT
		, CHG_APT_DT

		, FNL_MNU_ID
		, FRT_USR_ID
		, FNL_USR_ID
		,
		FNL_DEAL_DPT_CD
		, FRT_REGI_DH
		,
		FNL_MDF_DH
		)
		VALUES
		(
		SYSDATE
		, #{hstDvsnCd}
		, #{hstSno}
		, #{cnb}
		, #{pwd}
		, #{tmpYn}
		,
		TO_CHAR(SYSDATE,'yyyymmdd')
		,
		#{chgAptDt}

		, #{fnlMnuId}
		, #{fnlUsrId}
		, #{fnlUsrId}
		,
		#{fnlDealDptCd}
		, SYSDATE
		, SYSDATE
		)
	</insert>
	<!-- 사용자비밀번호내역 신규 -->
	<insert id="dcmacm001UsrPwdInsert" parameterType="paramMap">
		INSERT INTO
		TBDCMACM028L
		(
		CNB
		, ESN
		, TMP_YN
		, FNL_CHG_DT
		, CHG_APT_DT

		, FNL_MNU_ID
		,
		FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FRT_REGI_DH
		,
		FNL_MDF_DH
		)
		VALUES
		(
		#{cnb}
		, #{esn}
		, #{tmpYn}
		, TO_CHAR(SYSDATE,'yyyymmdd')
		,
		#{chgAptDt}

		, #{fnlMnuId}
		, #{fnlUsrId}
		, #{fnlUsrId}
		,
		#{fnlDealDptCd}
		, SYSDATE
		, SYSDATE
		)
	</insert>



	<select id="dcmacm001PwdHstSnoMax" parameterType="paramMap"
		resultType="java.lang.String">
	<![CDATA[
          SELECT NVL(MAX(HST_SNO),0)+1 AS CNB
           FROM TBDCMACM029H
           WHERE HST_DH = SYSDATE
          ]]>
	</select>


	<!-- 사용자조회 팝업 -->
	<select id="dcmacm006UsrSelect" parameterType="paramMap" resultType="egovMap">
	<include refid="include.pageSelct" />
	<![CDATA[
       SELECT A.USR_DVSN_CD
            , A.ORG_CD
            , F_ORG_INFO(A.ORG_CD,'1') AS ORG_NM
            , A.CNB
            , A.DPT_CD
            , F_DPT_INFO(A.DPT_CD,'1') AS DPT_NM
            , A.USR_ID
            , A.USR_NAM
            , A.RQS_STA_CD
            , A.RLS_DT
            , A.TNB
            , A.RANK_CD
            , F_CODE_NM('1000173',A.RANK_CD) AS RANK_NM
            , A.PST_CD
            , F_CODE_NM('1000176',A.PST_CD)  AS PST_NM
            , A.EIN
            , SUBSTR(A.EIN,0,6)||'-*******' AS P_EIN
            , A.EML_AD
            , F_CODE_NM('1000338',A.USR_DVSN_CD) AS USR_DVSN_NM
            , A.BAI_USR_YN
            , A.ZCD
            , A.APM_DVSN_CD
            , A.HOM_TNB
            , F_DPT_INFO(A.DPT_CD, '3')  AS DEP_RGN_CD
            , F_CODE_NM('1000029', F_DPT_INFO(A.DPT_CD, '3')) AS DEP_RGN_NM
            , A.PS_CD
            , F_CODE_NM('1000177',A.PS_CD) AS PS_NM
     		, A.RAL_BLT_DIV_CD
     		, F_CODE_NM ('1000144',A.RAL_BLT_DIV_CD) AS RAL_BLT_DIV_NM
            , A.DOC_ID
            , D2.FILE_NAME AS IMG_FILE_NAME
         FROM TBDCMACM001M A
         , UBKERAPP.ECM_FILE_LIST_VIEW2 D2
         WHERE 1=1
           AND A.DOC_ID = D2.DOC_ID(+)
          ]]>

		<if test='usrNam != null and usrNam != ""'>
			AND (A.USR_NAM LIKE #{usrNam}||'%' OR
				A.USR_ID LIKE #{usrNam}||'%' OR
				A.CNB LIKE #{usrNam}||'%')
		</if>
		<if test='wrkDvsnCd != null and wrkDvsnCd != ""'>
			AND A.RQS_STA_CD = #{wrkDvsnCd}
		</if>
		<if test='usrDvsn != null and usrDvsn != ""'>
			AND A.USR_DVSN_CD = #{usrDvsn}
		</if>
		<if test='usrdptauth != null and usrdptauth != ""'>
			AND A.DPT_CD IN ( SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{usrcnb}, #{usrdptauth}, 'Y')))
		</if>
		<if test='dptCd != null and dptCd != ""'>
			AND A.DPT_CD = #{dptCd}
		</if>
        ORDER BY A.USR_NAM
		<include refid="include.pageOrder" />
	</select>

	<!-- 사용자관리부서 조회 -->

	<select id="dcmacm006UsrDptSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
       SELECT CNB
            , DPT_CD
            , F_DPT_INFO(DPT_CD,'1') AS DPT_NM
         FROM TBDCMACM003L
         WHERE 1=1
           AND CNB = #{usrcnb}
          ]]>

	</select>
	<!-- 사용자관리부서 신규 -->
	<insert id="dcmacm001UsrDptInsert" parameterType="paramMap">
		INSERT INTO
		TBDCMACM003L
		(
		CNB
		, DPT_CD
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		,
		FNL_MNU_ID
		,
		FNL_MDF_DH
		, FRT_REGI_DH

		)
		VALUES
		(
		#{cnb}
		, #{dptCd}

		,
		#{frtUsrId}
		, #{fnlUsrId}
		, #{fnlDealDptCd}
		, #{fnlMnuId}
		, SYSDATE
		,
		SYSDATE

		)
	</insert>

	<!-- 사용자관리부서 수정 -->
	<update id="dcmacm001UsrDptUpdate" parameterType="paramMap">
		UPDATE
		TBDCMACM003L
		SET CNB = #{cnb}
		, DPT_CD = #{dptCd}
		, FNL_MDF_DH = SYSDATE
		,
		FNL_MNU_ID = #{fnlMnuId}
		, FNL_USR_ID = #{fnlUsrId}
		, FNL_DEAL_DPT_CD
		= #{fnlDealDptCd}
		WHERE 1 = 1
		AND CNB = #{cnb}
		AND
		DPT_CD=#{dptCd}

	</update>

	<!-- 사용자 관리부서 delete -->
	<delete id="dcmacm001UsrDptDelete" parameterType="paramMap">
		DELETE
		TBDCMACM003L
		WHERE 1 = 1
		AND CNB = #{cnb}
		<if test='dptCd != null and dptCd != ""'>
		AND DPT_CD =#{dptCd}
		</if>
	</delete>



	<select id="dcmacm001UsrEnrGrpSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
      SELECT A.USR_ID, A.USR_NAM, C.GROUP_ID, C.GROUP_NAME, C.GROUP_DESC
       FROM TBDCMACM001M A
  	      , GROUP_USER B
  	      , GROUP_INFO C
      WHERE A.CNB = #{usrcnb}
        AND A.USR_ID = B.USER_ID
        AND B.GROUP_ID = C.GROUP_ID
          ]]>
	</select>
	<select id="dcmacm004UsrEnrRolSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
   SELECT A.USR_ID, A.USR_NAM, C.ROLE_ID, C.ROLE_NAME, C.ROLE_DESC
     FROM TBDCMACM001M A
        , ROLE_USER B
  	    , ROLE_INFO C
    WHERE A.USR_ID = B.USER_ID
      AND B.ROLE_ID = C.ROLE_ID
      AND  A.CNB = #{usrcnb}
          ]]>

	</select>
	<!-- 우편번호 -->
	<select id="dcmacm034ZipCodeMgrSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
        SELECT ZCD
             , ZCD_SRNO
             , PRV_NM
             , CITY_NM
             , TWN_NM
             , ROAD_NM
             , UDG_YN
             , BULD_NO_MAIN_NO
             , BULD_NO_SU_NO
             , CITY_BULD_NM
             , LD_CD
             , LD_NM
             , RI_NM
             , MNTN_YN
             , ALN_MAIN_NO
             , TWN_SRNO
             , ALN_SU_NO

         FROM TBDCMACM020L
         WHERE 1=1
          ]]>
		<if test='name != null and name != ""'>
			AND (LD_NM LIKE #{name}||'%' OR
			TWN_NM LIKE #{name}||'%' OR RI_NM
			LIKE #{name}||'%' OR ROAD_NM
			LIKE #{name}||'%'
			OR CITY_BULD_NM LIKE '%'||#{name}||'%'
			 )
		</if>

		<if test='zcd != null and zcd != ""'>
			ZCD LIKE
			'%'||#{zcd}||'%'
		</if>
	</select>

	<select id="dcmacm035ZipCodeSelect" parameterType="paramMap"
		resultType="egovMap">
		<include refid="include.pageSelct" />
	<![CDATA[

         SELECT PRV_NM ||' '|| CITY_NM ||' '|| ROAD_NM ||' '||BULD_NO_MAIN_NO AS ROAD_DTL_AD
              , PRV_NM ||' '|| CITY_NM || NVL2(TWN_NM,' ' || TWN_NM, '')||' '||NVL2(RI_NM,'' || RI_NM, '') ||LD_NM ||' '||ALN_MAIN_NO AS AD
              , ZCD
              , SUBSTR(ZCD,1,3) 										AS ZCD1
          	  , SUBSTR(ZCD,4,3) 										AS ZCD2

           FROM TBDCMACM020L
          WHERE 1=1


          ]]>
		<if test='name != null and name != ""'>
			AND (LD_NM LIKE #{name}||'%' OR
			TWN_NM LIKE #{name}||'%' OR RI_NM
			LIKE #{name}||'%' OR ROAD_NM
			LIKE #{name}||'%'
			OR CITY_BULD_NM LIKE '%'||#{name}||'%' )
		</if>
		<include refid="include.pageOrder" />
	</select>



	<!-- 결재구분 조회 -->
	<select id="dcmacm041ApprBizDivSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
        SELECT APV_DVSN_CD
            , TSK_CAT_CD
            , FUNC_CAT_CD||TSK_CAT_CD AS FUNC_CAT_CD
            , APV_DVSN_NM
            , SUB_PAE_RUT_NM
            , SVC_NM
            , APV_MTD_NM
            , SBM_MTD_NM
         FROM TBDCMACM021M
        WHERE 1=1
        ORDER BY APV_DVSN_CD

          ]]>

	</select>

	<!-- 우편번호 엑셀 신규 -->
	<insert id="dcmacm034ZcdInsert" parameterType="paramMap">
		INSERT INTO
		TBDCMACM020L
		(
		ZCD
		, ZCD_SRNO
		, PRV_NM
		, PRV_ENG_NM
		, CITY_NM
		, CITY_ENG_NM
		,
		TWN_NM
		,
		TWN_ENG_NM
		, ROAD_NM_CD
		, ROAD_NM
		, ROAD_ENG_NM
		, UDG_YN
		,
		BULD_NO_MAIN_NO
		, BULD_NO_SU_NO
		, BULD_MNG_NO
		, CITY_BULD_NM
		, LD_CD
		,
		LD_NM
		, RI_NM
		,
		MNTN_YN
		, ALN_MAIN_NO
		, ALN_SU_NO
		, TWN_SRNO


		, FNL_MNU_ID
		,
		FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FRT_REGI_DH
		,
		FNL_MDF_DH
		)
		VALUES
		(

		#{col1} /*ZCD*/
		, #{col2} /*ZCD_SRNO*/
		, #{col3} /*PRV_NM*/
		, #{col4} /* PRV_ENG_NM*/
		, #{col5} /*CITY_NM*/
		, #{col6} /*CITY_ENG_NM*/
		, #{col7} /*TWN_NM*/
		, #{col8} /*TWN_ENG_NM*/
		, #{col9} /*ROAD_NM_CD*/
		,
		#{col10} /*ROAD_NM*/
		, #{col11} /*ROAD_ENG_NM*/
		, #{col12} /*UDG_YN*/
		, #{col13} /*BULD_NO_MAIN_NO*/
		, #{col14} /*BULD_NO_SU_NO*/
		, #{col15} /*BULD_MNG_NO*/
		, #{col16} /*CITY_BULD_NM*/
		, #{col17} /*LD_CD*/
		, #{col18} /*LD_NM*/
		, #{col19} /*RI_NM*/
		, #{col20} /*MNTN_YN*/
		, #{col21} /*ALN_MAIN_NO*/
		, #{col22} /*ALN_SU_NO*/
		, #{col24} /*TWN_SRNO*/

		,
		#{fnlMnuId}
		, #{frtUsrId}
		, #{fnlUsrId}
		, #{fnlDealDptCd}
		, SYSDATE
		,
		SYSDATE

		)
	</insert>
	    <!-- 우편번호 엑셀 유무체크 -->
	<select id="dcmacm034ExelChk" parameterType="paramMap"
		resultType="java.lang.String">
	      SELECT COUNT(*) AS CNT
           FROM TBDCMACM020L
          WHERE 1=1
            AND ZCD             = #{col1}
            AND ZCD_SRNO        = #{col2}
            AND ROAD_NM_CD      = #{col9}
            AND UDG_YN          = #{col12}
            AND BULD_NO_MAIN_NO = #{col13}
            AND BULD_MNG_NO     = #{col15}
            AND BULD_NO_SU_NO   = #{col14}
            AND LD_CD           = #{col17}
            AND MNTN_YN         = #{col20}
            AND ALN_MAIN_NO     = #{col21}
            AND TWN_SRNO        = #{col24}
            AND ALN_SU_NO       = #{col22}
    </select>
        <!-- 우편번호 엑셀 삭제 -->
    <delete id="dcmacm034ZcdDelete" parameterType="paramMap">
	      DELETE
           FROM TBDCMACM020L
          WHERE 1=1
            AND ZCD             = #{col1}
            AND ZCD_SRNO        = #{col2}
            AND ROAD_NM_CD      = #{col9}
            AND UDG_YN          = #{col12}
            AND BULD_NO_MAIN_NO = #{col13}
            AND BULD_MNG_NO     = #{col15}
            AND BULD_NO_SU_NO   = #{col14}
            AND LD_CD           = #{col17}
            AND MNTN_YN         = #{col20}
            AND ALN_MAIN_NO     = #{col21}
            AND TWN_SRNO        = #{col24}
            AND ALN_SU_NO       = #{col22}
    </delete>
    <!-- 우편번호 엑셀 수정 -->
    <update id="dcmacm034ZcdUpdate" parameterType="paramMap">
      UPDATE TBDCMACM020L
         SET
          ZCD              = #{col1}
		, ZCD_SRNO         = #{col2}
		, PRV_NM           = #{col3}
		, PRV_ENG_NM       = #{col4}
		, CITY_NM          = #{col5}
		, CITY_ENG_NM      = #{col6}
		, TWN_NM           = #{col7}
		, TWN_ENG_NM       = #{col8}
		, ROAD_NM_CD       = #{col9}
		, ROAD_NM          = #{col10}
		, ROAD_ENG_NM      = #{col11}
		, UDG_YN           = #{col12}
		, BULD_NO_MAIN_NO  = #{col13}
		, BULD_NO_SU_NO    = #{col14}
		, BULD_MNG_NO      = #{col15}
		, CITY_BULD_NM     = #{col16}
		, LD_CD            = #{col17}
		, LD_NM            = #{col18}
		, RI_NM            = #{col19}
		, MNTN_YN          = #{col20}
		, ALN_MAIN_NO      = #{col21}
		, ALN_SU_NO        = #{col22}
		, TWN_SRNO         = #{col24}
        , FNL_MDF_DH = SYSDATE
		, FNL_USR_ID = #{fnlUsrId}
		, FNL_DEAL_DPT_CD = #{fnlDealDptCd}
		, FNL_MNU_ID = #{fnlMnuId}

          WHERE 1=1
            AND ZCD             = #{col1}
            AND ZCD_SRNO        = #{col2}
            AND ROAD_NM_CD      = #{col9}
            AND UDG_YN          = #{col12}
            AND BULD_NO_MAIN_NO = #{col13}
            AND BULD_MNG_NO     = #{col15}
            AND BULD_NO_SU_NO   = #{col14}
            AND LD_CD           = #{col17}
            AND MNTN_YN         = #{col20}
            AND ALN_MAIN_NO     = #{col21}
            AND TWN_SRNO        = #{col24}
            AND ALN_SU_NO       = #{col22}
            </update>
	<!-- 결재구분 신규 -->
	<insert id="dcmacm041ApprBizDivInsert" parameterType="paramMap">
		INSERT
		INTO
		TBDCMACM021M
		(
		APV_DVSN_CD
		, TSK_CAT_CD
		, FUNC_CAT_CD
		, APV_DVSN_NM
		,
		SUB_PAE_RUT_NM
		, SVC_NM
		,
		APV_MTD_NM
		, SBM_MTD_NM
		,FNL_MNU_ID
		, FRT_USR_ID
		,
		FNL_USR_ID
		,
		FNL_DEAL_DPT_CD
		, FRT_REGI_DH
		, FNL_MDF_DH
		)
		VALUES
		(
		#{apvDvsnCd}
		, #{tskCatCd}
		, #{funcCatCd}
		, #{apvDvsnNm}
		,
		#{subPaeRutNm}
		,
		#{svcNm}
		, #{apvMtdNm}
		, #{sbmMtdNm}
		, #{fnlMnuId}
		,
		#{frtUsrId}
		,
		#{fnlUsrId}
		, #{fnlDealDptCd}
		, SYSDATE
		, SYSDATE

		)
	</insert>

	<update id="dcmacm041ApprBizDivUpdate" parameterType="paramMap">
		UPDATE TBDCMACM021M
		SET APV_DVSN_CD = #{apvDvsnCd}
		, FNL_MDF_DH =
		SYSDATE
		, FNL_USR_ID = #{fnlUsrId}
		, FNL_DEAL_DPT_CD =
		#{fnlDealDptCd}
		, FNL_MNU_ID = #{fnlMnuId}

		<if test='tskCatCd != null'>
			, TSK_CAT_CD = #{tskCatCd}
		</if>
		<if test='funcCatCd != null'>
			, FUNC_CAT_CD = #{funcCatCd}
		</if>

		<if test='apvDvsnNm != null'>
			, APV_DVSN_NM = #{apvDvsnNm}
		</if>

		<if test='subPaeRutNm != null'>
			, SUB_PAE_RUT_NM =
			#{subPaeRutNm}
		</if>

		<if test='svcNm != null'>
			, SVC_NM = #{svcNm}
		</if>
		<if test='apvMtdNm != null'>
			, APV_MTD_NM = #{apvMtdNm}
		</if>
		<if test='sbmMtdNm != null'>
			, SBM_MTD_NM = #{sbmMtdNm}
		</if>


		WHERE 1 = 1
		AND APV_DVSN_CD = #{apvDvsnCd}

	</update>

	<!-- 결재구분 delete -->
	<delete id="dcmacm041ApprBizDivDelete" parameterType="paramMap">
		DELETE
		TBDCMACM021M
		WHERE 1 = 1
		AND APV_DVSN_CD = #{apvDvsnCd}
	</delete>

	<!-- 결재구분 사용여부 -->
	<select id="dcmacm041ApprBizChk" parameterType="paramMap"
		resultType="java.lang.String">
        <![CDATA[
			SELECT COUNT(*) AS CNT

			FROM TBDCMACM022L
			WHERE 1=1
			  AND APV_DVSN_CD = #{apvDvsnCd}
        ]]>

	</select>




	<!-- 결재문서 - 내가 받은 문서 AND T23.APVR_CNB = #{usrcnb} dcmacm043ApprDownDocumentSelect -->

	<select id="dcmacm043ApprDownDocumentSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[

		  SELECT T22.APV_DOC_NO
               , T22.APV_DVSN_CD
               , T22.TSK_KY_TXT
               , T22.APV_STA_CD
               , F_CODE_NM('1000333',T22.APV_STA_CD) AS APV_STA_NM
               , T22.APV_TIT_NM
               , T22.SBM_CNB
               , F_USR_INFO(SBM_CNB,'2') AS SBM_CNB_NM
               , T22.SBM_DH
               , T22.FNL_APV_CNB
               , T22.FNL_APV_DH
            FROM (
                    SELECT D3.APV_DOC_NO
                         , D3.APV_DVSN_CD
                      FROM (SELECT APV_DOC_NO
                                  , APV_DVSN_CD
                              FROM TBDCMACM023L
                             WHERE APVR_CNB = #{apvrcnb}
                          ) D3
                    ]]>
		<if test='usrnam != null and usrnam != ""'>
                         , (SELECT D1.APV_DOC_NO
                                 , D1.APV_DVSN_CD
                              FROM TBDCMACM023L D1
                                 , TBDCMACM001M D2
                             WHERE D1.APVR_CNB = D2.CNB
                              AND  D2.USR_NAM LIKE '%'||#{usrnam}||'%'
                          ) D4
                      WHERE D3.APV_DOC_NO = D4.APV_DOC_NO
                        AND D3.APV_DVSN_CD = D4.APV_DVSN_CD
                         </if>
                  	<![CDATA[
                  ) T23
               , TBDCMACM022L T22
               WHERE T22.APV_DOC_NO =T23.APV_DOC_NO
                AND  T22.APV_DVSN_CD = T23.APV_DVSN_CD
                AND T22.SBM_CNB <> #{apvrcnb}
                AND T22.SBM_DH BETWEEN #{sbmdyfrom}||'000000' AND #{sbmdyto}||'235959'
                      ]]>
		<if test='apvtit != null and apvtit != ""'>
			T22.APV_TIT_NM LIKE
			'%'||#{apvtit}||'%'
		</if>
		<if test='apvsta != null and apvsta != ""'>
			T22.APV_STA_CD =
			#{apvsta}
		</if>
		<if test='apvdvsncd != null and apvdvsncd != ""'>
			T22.APV_DVSN_CD =
			#{apvdvsncd}
		</if>
		ORDER BY T22.APV_STA_CD, APV_DOC_NO DESC
	</select>

	<!-- 결재문서 - 내가 올린 문서 WHERE SBN_CNB =#{usrcnb} dcmacm043ApprUpDocumentSelect -->
	<select id="dcmacm044ApprUpDocumentSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
        	  SELECT T22.APV_DOC_NO
               , T22.APV_DVSN_CD
               , T22.TSK_KY_TXT
               , T22.APV_STA_CD
               , F_CODE_NM('1000333',T22.APV_STA_CD) AS APV_STA_NM
               , T22.APV_TIT_NM
               , T22.SBM_CNB
               , F_USR_INFO(SBM_CNB,'2') AS SBM_CNB_NM
               , T22.SBM_DH
               , T22.FNL_APV_CNB
               , T22.FNL_APV_DH
            FROM (
                    SELECT D3.APV_DOC_NO
                         , D3.APV_DVSN_CD
                      FROM (SELECT APV_DOC_NO
                                  , APV_DVSN_CD
                              FROM TBDCMACM023L
                             WHERE APVR_CNB = #{apvrcnb}
                          ) D3
                    ]]>
		<if test='usrnam != null and usrnam != ""'>
                         , (SELECT D1.APV_DOC_NO
                                 , D1.APV_DVSN_CD
                              FROM TBDCMACM023L D1
                                 , TBDCMACM001M D2
                             WHERE D1.APVR_CNB = D2.CNB
                               AND  D2.USR_NAM LIKE '%'||#{usrnam}||'%'
                          ) D4
                      WHERE D3.APV_DOC_NO = D4.APV_DOC_NO
                        AND D3.APV_DVSN_CD = D4.APV_DVSN_CD
                         </if>
                  	<![CDATA[
                  ) T23
               , TBDCMACM022L T22
               WHERE T22.APV_DOC_NO =T23.APV_DOC_NO
                AND  T22.APV_DVSN_CD = T23.APV_DVSN_CD
                AND T22.SBM_CNB = #{apvrcnb}
                AND T22.SBM_DH BETWEEN #{sbmdyfrom}||'000000' AND #{sbmdyto}||'235959'
                      ]]>
		<if test='apvtit != null and apvtit != ""'>
			T22.APV_TIT_NM LIKE
			'%'||#{apvtit}||'%'
		</if>

		<if test='apvsta != null and apvsta != ""'>
			T22.APV_STA_CD = #{apvsta}
		</if>
		<if test='apvdvsncd != null and apvdvsncd != ""'>
			T22.APV_DVSN_CD =	#{apvdvsncd}
		</if>
		ORDER BY T22.APV_STA_CD, T22.APV_DOC_NO DESC
	</select>


	<select id="dcmacm042ApprAllSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
	 SELECT T22.APV_DOC_NO
		     , T22.APV_DVSN_CD
		     , T22.TSK_KY_TXT
		     , T22.APV_STA_CD
		     , F_CODE_NM('1000333',T22.APV_STA_CD) AS APV_STA_NM
		     , T22.APV_TIT_NM
		     , T22.SBM_CNB
		     , F_USR_INFO(T22.SBM_CNB,'2') AS SBM_CNB_NM
		     , T22.SBM_DH
		     , T22.FNL_APV_CNB
		     , T22.FNL_APV_DH
		  FROM TBDCMACM022L T22/*, (SELECT D1.APV_DOC_NO
                                 , D1.APV_DVSN_CD
                                 , usr_nam
                                 , apvr_cnb
                              FROM TBDCMACM023L D1
                                 , TBDCMACM001M D2
                             WHERE D1.APVR_CNB = D2.CNB
                               AND  D2.USR_NAM LIKE '%'||'오갑주'||'%') D*/

		  WHERE 1=1
		  	]]>
		<if test='usrnam != null and usrnam != ""'>
             AND T22.APV_DOC_NO IN (SELECT APV_DOC_NO FROM TBDCMACM023L WHERE APVR_CNB IN (SELECT CNB FROM TBDCMACM001M WHERE USR_NAM LIKE '%' || #{usrnam} || '%'))
			</if>
			<![CDATA[
		     AND T22.SBM_DH BETWEEN #{sbmdyfrom}||'000000' AND #{sbmdyto}||'235959'

			]]>
		<if test='apvtit != null and apvtit != ""'>
			T22.APV_TIT_NM LIKE
			'%'||#{apvtit}||'%'
		</if>
		<if test='apvsta != null and apvsta != ""'>
			T22.APV_STA_CD =
			#{apvsta}
		</if>
		<if test='apvdvsncd != null and apvdvsncd != ""'>
			T22.APV_DVSN_CD =
			#{apvdvsncd}
		</if>



		ORDER BY T22.APV_STA_CD, APV_DOC_NO DESC
	</select>

	<!-- 결재대기함 관리자 모드 조회 -->
	<select id="dcmacm042ApvAllSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
	 SELECT T22.APV_DOC_NO
		     , T22.APV_DVSN_CD
		     , T22.TSK_KY_TXT
		     , T22.APV_STA_CD
		     , F_CODE_NM('1000333',T22.APV_STA_CD) AS APV_STA_NM
		     , T22.APV_TIT_NM
		     , T22.SBM_CNB
		     , F_USR_INFO(T22.SBM_CNB,'2') AS SBM_CNB_NM
		     , T23.APVR_CNB
		     , F_USR_INFO(T23.APVR_CNB,'2') AS APVR_CNB_NM
		     , T22.SBM_DH
		     , T22.FNL_APV_CNB
		     , T22.FNL_APV_DH
		     , T23.APV_SNO
		     , T23.APVR_STA_CD
		     , T23.APVR_KND_CD
		     , T21.APV_DVSN_NM
		  FROM TBDCMACM022L T22, TBDCMACM023L T23, TBDCMACM021M T21
		  WHERE 1=1
		  AND	T22.APV_DOC_NO = T23.APV_DOC_NO
		  AND	T22.APV_DVSN_CD = T23.APV_DVSN_CD
		  AND	T23.APVR_STA_CD IN ('101','102','103','104','105')
		  AND	T22.APV_DVSN_CD = T21.APV_DVSN_CD
		  	]]>
		<if test='usrnam != null and usrnam != ""'>
             AND T23.APVR_CNB IN (SELECT CNB FROM TBDCMACM001M WHERE USR_NAM LIKE '%' || #{usrnam} || '%')
			</if>
			<![CDATA[
		     AND T22.SBM_DH BETWEEN #{sbmdyfrom}||'000000' AND #{sbmdyto}||'235959'

			]]>
		<if test='apvtit != null and apvtit != ""'>
			T22.APV_TIT_NM LIKE
			'%'||#{apvtit}||'%'
		</if>
		<if test='apvsta != null and apvsta != ""'>
			T22.APV_STA_CD =
			#{apvsta}
		</if>
		<if test='apvdvsncd != null and apvdvsncd != ""'>
			T22.APV_DVSN_CD =
			#{apvdvsncd}
		</if>



		ORDER BY T22.APV_STA_CD, T22.APV_DOC_NO DESC
	</select>

	<!-- 결재대기함 사용자 모드 조회 -->
	<select id="dcmacm042ApvUserSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
	 SELECT T22.APV_DOC_NO
		     , T22.APV_DVSN_CD
		     , T22.TSK_KY_TXT
		     , T22.APV_STA_CD
		     , F_CODE_NM('1000333',T22.APV_STA_CD) AS APV_STA_NM
		     , T22.APV_TIT_NM
		     , T22.SBM_CNB
		     , F_USR_INFO(T22.SBM_CNB,'2') AS SBM_CNB_NM
		     , T23.APVR_CNB
		     , F_USR_INFO(T23.APVR_CNB,'2') AS APVR_CNB_NM
		     , T22.SBM_DH
		     , T22.FNL_APV_CNB
		     , T22.FNL_APV_DH
		     , T23.APV_SNO
		     , T23.APVR_STA_CD
		     , T23.APVR_KND_CD
		     , T21.APV_DVSN_NM
		  FROM TBDCMACM022L T22, TBDCMACM023L T23, TBDCMACM021M T21
		  WHERE 1=1
		  AND	T22.APV_DOC_NO = T23.APV_DOC_NO
		  AND	T22.APV_DVSN_CD = T23.APV_DVSN_CD
		  AND	T23.APVR_STA_CD IN ('101','102','103','104','105')
		  AND	T23.APVR_CNB = #{apvrcnb}
		  AND	T22.APV_DVSN_CD = T21.APV_DVSN_CD
		  	]]>
		<if test='usrnam != null and usrnam != ""'>
             AND T23.APVR_CNB IN (SELECT CNB FROM TBDCMACM001M WHERE USR_NAM LIKE '%' || #{usrnam} || '%')
			</if>
			<![CDATA[
		     AND T22.SBM_DH BETWEEN #{sbmdyfrom}||'000000' AND #{sbmdyto}||'235959'

			]]>
		<if test='apvtit != null and apvtit != ""'>
			T22.APV_TIT_NM LIKE
			'%'||#{apvtit}||'%'
		</if>
		<if test='apvsta != null and apvsta != ""'>
			T22.APV_STA_CD =
			#{apvsta}
		</if>
		<if test='apvdvsncd != null and apvdvsncd != ""'>
			T22.APV_DVSN_CD =
			#{apvdvsncd}
		</if>



		ORDER BY T22.APV_STA_CD, APV_DOC_NO DESC
	</select>

	<!-- 결재상신팝업 문서정보 조회 -->
	<select id="dcmacm045ApprSugSelect" parameterType="paramMap"
		resultType="java.lang.String">
	<![CDATA[

		SELECT TO_CHAR(SYSDATE,'yyyymmddhh24miss')||LPAD(NVL(MAX(SUBSTR(APV_DOC_NO,15,20)), 0) + 1, 6, 0) AS APV_DOC_NO
		 FROM TBDCMACM022L

	]]>
	</select>

	<!-- 결재문서 신규 -->
	<insert id="dcmacm045ApprSugInsert" parameterType="paramMap">
	<![CDATA[
		INSERT INTO
		TBDCMACM022L
		(
		APV_DOC_NO
		, APV_DVSN_CD
		, APV_STA_CD
		, APV_TIT_NM
		, SBM_CNB
		, SBM_DH

		, FNL_APV_DH

		, FNL_MNU_ID
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		,
		FRT_REGI_DH
		,
		FNL_MDF_DH
		)
		VALUES
		(
		#{apvDocNo}
		, #{apvDvsnCd}
		, #{apvStaCd}
		,
		 CASE
           WHEN LENGTHB(#{apvTitNm})<100 THEN #{apvTitNm}
           ELSE SUBSTRB(#{apvTitNm},0,90)||'...'
      	 END
		, #{sbmCnb}
		, SYSDATE
		, SYSDATE
		, #{fnlMnuId}
		, #{frtUsrId}
		, #{fnlUsrId}
		, #{fnlDealDptCd}
		,  SYSDATE
		, SYSDATE
		)
		]]>
	</insert>

	<!-- 결재자 신규 -->
	<insert id="dcmacm045ApprSugAssignInsert" parameterType="paramMap">
		INSERT
		INTO
		TBDCMACM023L
		(
		APV_DOC_NO
		, APV_DVSN_CD
		, APVR_CNB
		, APVR_DPT_CD
		,
		APVR_RANK_CD
		, APVR_PST_CD
		,
		APVR_KND_CD
		, APV_SNO
		, APVR_STA_CD
		, APV_DH
		,
		APV_OPIN

		, FNL_MNU_ID
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		,
		FRT_REGI_DH
		,
		FNL_MDF_DH
		)
		VALUES
		(
		#{apvDocNo}
		, #{apvDvsnCd}
		, #{apvrCnb}
		, #{apvrDptCd}
		, #{apvrRankCd}
		,
		#{apvrPstCd}
		, #{apvrKndCd}
		,
		#{apvSno}
		, #{apvrStaCd}
		,
		DECODE(#{apvrStaCd},'201',TO_CHAR(SYSDATE,'yyyymmddhh24mIss'),NULL)
		,
		#{apvOpin}

		, #{fnlMnuId}
		, #{frtUsrId}
		,
		#{fnlUsrId}
		, #{fnlDealDptCd}
		, SYSDATE
		, SYSDATE

		)
	</insert>
	<!-- 결재자상태 업데이트 -->
	<update id="dcmacm047ApprSugAssignUpdate" parameterType="paramMap">
		UPDATE TBDCMACM023L
		SET APV_DVSN_CD = #{apvDvsnCd}
		, APV_DH =
		DECODE(SUBSTR(#{apvrStaCd},0,1), '1',
		NULL,TO_CHAR(SYSDATE,'yyyymmddhh24mIss'))
		, FNL_MDF_DH = SYSDATE
		,
		FNL_USR_ID = #{fnlUsrId}
		, FNL_DEAL_DPT_CD = #{fnlDealDptCd}
		,
		FNL_MNU_ID = #{fnlMnuId}
		<if test='apvrStaCd != null'>
			, APVR_STA_CD = #{apvrStaCd}
		</if>
		<if test='apvOpin != null'>
			, APV_OPIN = #{apvOpin}
		</if>

		WHERE 1 = 1
		AND APV_DVSN_CD = #{apvDvsnCd}
		AND APV_DOC_NO =
		#{apvDocNo}
		AND APVR_CNB =#{apvrCnb}
	</update>

	<!-- 결재문서상태업데이트 -->
	<update id="dcmacm047ApprSugUpdate" parameterType="paramMap">
		UPDATE
		TBDCMACM022L
		SET APV_STA_CD = #{apvStaCd}
		, FNL_APV_DH = SYSDATE
		,
		FNL_APV_CNB =#{fnlApvCnb}

		, FNL_MDF_DH = SYSDATE
		, FNL_USR_ID =
		#{fnlUsrId}
		, FNL_DEAL_DPT_CD = #{fnlDealDptCd}
		, FNL_MNU_ID =
		#{fnlMnuId}


		WHERE 1 = 1
		AND APV_DVSN_CD = #{apvDvsnCd}
		AND APV_DOC_NO =
		#{apvDocNo}

	</update>
	<!-- 결재상신팝업 문서정보 조회 -->
	<select id="dcmacm047ApprSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[

		   SELECT T22.APV_DOC_NO
               , T22.APV_DVSN_CD
               , T22.TSK_KY_TXT
               , T22.APV_STA_CD
               ,F_CODE_NM('1000333',T22.APV_STA_CD) AS APV_STA_NM
               , T22.APV_TIT_NM
               , T22.SBM_CNB
               , F_USR_INFO(T22.SBM_CNB,'1') AS SBM_CNB_ID
               , F_USR_INFO(SBM_CNB,'2') AS SBM_CNB_NM
               , T22.SBM_DH
               , T22.FNL_APV_CNB
               , T22.FNL_APV_DH
          FROM TBDCMACM022L T22
          WHERE 1=1
          AND T22.APV_DOC_NO=#{docno}
          AND T22.APV_DVSN_CD=#{apvdvsncd}

	]]>
	</select>

	<!-- 해당문서 결재자목록 조회 -->
	<select id="dcmacm047ApprUsrSelect" parameterType="paramMap"
		resultType="egovMap">
	<![CDATA[
	  SELECT APV_SNO
       , APV_DVSN_CD
       , APV_DOC_NO
       , F_USR_INFO(APVR_CNB,'2') AS APVR_USR_NAM
       , F_USR_INFO(APVR_CNB,'1') AS USR_ID
       , F_DPT_INFO(APVR_DPT_CD,'1') AS APVR_DPT_NM
       , F_CODE_NM('1000173',APVR_RANK_CD) AS APVR_RANK_NM
       , F_CODE_NM('1000176',APVR_PST_CD)  AS APVR_PST_NM
       , APV_DH
       , APVR_STA_CD
       , APVR_CNB
       , APV_OPIN
    FROM TBDCMACM023L
   WHERE 1=1
     AND APV_DOC_NO=#{docno}
     AND APV_DVSN_CD=#{apvdvsncd}
    ORDER BY APV_SNO

	]]>
	</select>

	<!-- 결재가능자 확인 조회 -->
	<select id="dcmacm047ApprUsrChkSelect" parameterType="paramMap"
		resultType="java.lang.String">
	<![CDATA[
		SELECT COUNT(*) AS CNT
          FROM TBDCMACM023L
	     where APV_DOC_NO =#{docno}
           AND APVR_CNB=#{apvrcnb}
           AND APVR_STA_CD < 200

	]]>
	</select>


	<!-- 사용자별메뉴 사용현황 -->
	<select id="dcmacm049UsrMenuSelect" parameterType="paramMap"
		resultType="egovMap">
		<include refid="include.pageSelct" />
	<![CDATA[
      SELECT A.SIT_CD	/* 사이트코드 */
	       , B.SIT_NM /* 사이트명 */
	       , '메뉴위치미정' AS MENU_LOC	/* 메뉴위치 */
	       , A.RQS_DH	/* 요청일시 */
	       , A.CNB	/* 전산번호 */
	       , D.DPT_CD	/* 부서코드 */
	       , D.DPT_NM	/* 부서명 */
	       , C.USR_ID	/* 아이디 */
	       , C.USR_NAM	/* 이름 */
	       , A.RQS_IP_NO	/* IP */
	       , A.RQS_SVC_ID
	       , A.RQS_SVC_PRMT_TXT	/* 파라미터 */
	       , A.LVL_MNU_NM_1
	       , A.LVL_MNU_NM_2
	       , A.LVL_MNU_NM_3
	       , A.LVL_MNU_NM_4
	       , A.LVL_MNU_NM_5
	       , E.RESOURCE_DESC AS MNU_NM
        FROM TBDCMACM014H A
  	       , TBDCMACM016M B
  	       , TBDCMACM001M C
  	       , TBDCMACM002M D
  	       , COMMON_RESOURCE E
       WHERE A.SIT_CD = B.SIT_CD
         AND A.CNB = C.CNB
         AND A.FNL_DEAL_DPT_CD = D.DPT_CD
         AND A.RQS_DH BETWEEN #{from}||'000000' AND #{to}||'235959'
         AND A.MNU_ID = E.RESOURCE_NAME
	]]>
		<if test='sitcd != null and sitcd != ""'>
			A.SIT_CD LIKE
			#{sitcd}||'%'
		</if>
		<if test='mnuid != null and mnuid != ""'>
			E.RESOURCE_DESC LIKE	#{mnuid}||'%'
		</if>
		<if test='usrcnb != null and usrcnb != ""'>
			A.CNB LIKE #{usrcnb}||'%'
		</if>
		<if test='dptcd != null and dptcd != ""'>
			D.DPT_CD LIKE
			#{dptcd}||'%'
		</if>
		<if test='ip != null and ip != ""'>
			RQS_IP_NO LIKE
			#{ip}||'%'
		</if>
		ORDER BY A.RQS_DH DESC
		<include refid="include.pageOrder" />
	</select>


	<!-- 사용자별 엑셀 export -->
	<select id="dcmacm049ExcelSelect" parameterType="paramMap"
		resultType="egovMap">
		<![CDATA[
      SELECT A.SIT_CD	/* 사이트코드 */
	       , B.SIT_NM /* 사이트명 */
	       , A.LVL_MNU_NM_1 /*메뉴뎁스1*/
	       , A.LVL_MNU_NM_2 /*메뉴뎁스2*/
	       , A.LVL_MNU_NM_3 /*메뉴뎁스3*/
	       , A.LVL_MNU_NM_4 /*메뉴뎁스4*/
	       , A.LVL_MNU_NM_5 /*메뉴뎁스5*/
	       , A.RQS_DH	/* 요청일시 */
	       , A.CNB	/* 전산번호 */
	       , C.DPT_CD	/* 부서코드 */
	       , D.DPT_NM	/* 부서명 */
	       , C.USR_ID	/* 아이디 */
	       , C.USR_NAM	/* 이름 */
	       , A.RQS_IP_NO	/* IP */
	       , A.RQS_SVC_ID
	       , A.RQS_SVC_PRMT_TXT	/* 파라미터 */
        FROM TBDCMACM014H A
  	       , TBDCMACM016M B
  	       , TBDCMACM001M C
  	       , TBDCMACM002M D
  	       , COMMON_RESOURCE E
       WHERE A.SIT_CD = B.SIT_CD
         AND A.CNB = C.CNB
         AND A.FNL_DEAL_DPT_CD = D.DPT_CD
         AND A.RQS_DH BETWEEN #{from}||'000000' AND #{to}||'235959'
          AND A.MNU_ID = E.RESOURCE_NAME
	]]>
		<if test='sitcd != null and sitcd != ""'>
			A.SIT_CD LIKE
			#{sitcd}||'%'
		</if>
		<if test='mnuid != null and mnuid != ""'>
			E.RESOURCE_DESC LIKE	#{mnuid}||'%'
		</if>
		<if test='usrcnb != null and usrcnb != ""'>
			A.CNB LIKE #{usrcnb}||'%'
		</if>
		<if test='dptcd != null and dptcd != ""'>
			D.DPT_CD LIKE
			#{dptcd}||'%'
		</if>
		<if test='ip != null and ip != ""'>
			RQS_IP_NO LIKE
			#{ip}||'%'
		</if>
	</select>

	<select id="dcmacm051UsrToLoginSelect" parameterType="paramMap" resultType="egovMap">
	<![CDATA[
        SELECT USE_DH, COUNT(USE_DH) AS CNT
         FROM (SELECT SUBSTR(TO_CHAR(LOGIN_DATE,'YYYYMMDDHH24MISS'),0,8) AS USE_DH
                 FROM PTL_LOG
                WHERE TO_CHAR(LOGIN_DATE,'YYYYMMDDHH24MISS') BETWEEN #{from}||'000000' AND #{to}||'235959'
                 AND ACTION_TYPE ='LOGIN'
               GROUP BY SUBSTR(TO_CHAR(LOGIN_DATE,'YYYYMMDDHH24MISS'),0,8), CNB
             ) A
         GROUP BY USE_DH
         ORDER BY USE_DH DESC
		]]>
	</select>

	<select id="dcmacm050UsrLoginSelect" parameterType="paramMap"	resultType="egovMap">
		<include refid="include.pageSelct" />
	<![CDATA[
      SELECT A.LOGIN_DATE
           , A.CNB
           , A.USER_ID
           , A.USER_IP
           , B.USR_NAM
           , A.ACTION_TYPE
           , B.DPT_CD
           , B.RANK_CD
           , F_CODE_NM('1000173',B.RANK_CD) AS RANK_NM
           , F_DPT_INFO(B.DPT_CD ,'1') DPT_NM

        FROM PTL_LOG A, TBDCMACM001M B
       WHERE 1=1
         AND A.CNB =B.CNB
         AND A.ACTION_TYPE ='LOGIN'
         AND A.LOGIN_DATE BETWEEN #{from}||'000000' AND #{to}||'235959'
  		]]>
		<if test='ip != null and ip != ""'>
			A.USER_IP LIKE
			#{ip}||'%'
		</if>
		<if test='dptcd != null and dptcd != ""'>
			B.DPT_CD LIKE
			#{dptcd}||'%'
		</if>
		<if test='usrcnb != null and usrcnb != ""'>
			A.CNB LIKE #{usrcnb}||'%'
		</if>
		<include refid="include.pageOrder" />
	</select>

	<select id="dcmacm050ExcelSelect" parameterType="paramMap"	resultType="egovMap">
	<![CDATA[
      SELECT A.LOGIN_DATE
           , A.CNB
           , A.USER_ID
           , A.USER_IP
           , B.USR_NAM
           , A.ACTION_TYPE
           , B.DPT_CD
           , B.RANK_CD
           , F_CODE_NM('1000173',B.RANK_CD) AS RANK_NM
           , C.DPT_NM

        FROM PTL_LOG A, TBDCMACM001M B, TBDCMACM002M C
       WHERE 1=1
         AND A.CNB =B.CNB
         AND B.DPT_CD = C.DPT_CD
         AND A.ACTION_TYPE ='LOGIN'
         AND A.LOGIN_DATE BETWEEN #{from}||'000000' AND #{to}||'235959'
  		]]>
		<if test='ip != null and ip != ""'>
			A.USER_IP LIKE
			#{ip}||'%'
		</if>
		<if test='dptcd != null and dptcd != ""'>
			B.DPT_CD LIKE
			#{dptcd}||'%'
		</if>
		<if test='usrcnb != null and usrcnb != ""'>
			A.CNB LIKE #{usrcnb}||'%'
		</if>
	</select>


	<!-- 소속부서 과장 조회 -->
	<select id="dcmacm046UsrPstSelect" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
		SELECT USR_DVSN_CD
		, F_CODE_NM('1000338',USR_DVSN_CD) AS USR_DVSN_NM
		, ORG_CD
		, F_ORG_INFO(ORG_CD,'1')
		AS ORG_NM
		, CNB
		, DPT_CD
		, F_DPT_INFO(DPT_CD,'1') AS DPT_NM
		, USR_ID
		,USR_NAM
		, RQS_STA_CD
		, RLS_DT
		, TNB
		, RANK_CD
		, F_CODE_NM('1000173',RANK_CD) AS RANK_NM
		, PST_CD
		, F_CODE_NM('1000176',PST_CD) AS PST_NM
		, EIN
		, EML_AD

		, BAI_USR_YN
		, ZCD
		, APM_DVSN_CD
		,HOM_TNB , RQS_TXT
		, LOGIN_WAY_CD
		FROM TBDCMACM001M
		WHERE DPT_CD =#{dptcd}
		AND PST_CD='0013600'
		AND RQS_STA_CD <> '4'
		AND RSG_DT IS NULL
		AND ROWNUM=1
		]]>
	</select>

	<select id="dcmacm011CoptSgSelect" parameterType="paramMap" resultType="egovMap">
		SELECT SUBSTR(ORG_CD,1,3) AS ORG_CD,
		ORG_NM
		FROM TBDCMACM015M
		WHERE ORG_CD = COPT_SG_CD||'000000000'
		AND  USE_DVSN_NO ='Y'
		ORDER BY ORG_NM
	</select>

	<!-- 결재 푸시 TO_DO_LIST INSERT -->
	<!-- 결재자 신규 -->
	<insert id="dcmacm045PushOrderListInsert" parameterType="paramMap">
		INSERT
		INTO
		PTL_ORDER_LIST
		(
		  SEQ
		, TITLE
		, CONTENT
		, CRT_DT
		, CRT_USER_ID
		, STRT_DT
		, END_DT
		, IMP_YN
		, MSN_YN
		, NA_YN
		, NA_DT
		, DOC_NO
		, APV_DVSN_CD
		, ORDER_TYPE_CD
		)
		VALUES
		(
		  #{seq}
		, #{title}
		, #{content}
		, TO_CHAR(SYSDATE,'yyyymmddhh24miss')
		, #{fnlUsrId}
		, TO_CHAR(SYSDATE,'yyyymmddhh24miss')
		, ''
		, 'N'
		, 'N'
		, ''
		, ''
		, #{apvDocNo}
		, #{apvDvsnCd}
		, '03'
		)
	</insert>

	<!-- 푸시 상신시 연계 -->
	<insert id="dcmacm045PushOrderReceiveInsert" parameterType="paramMap">
		INSERT
		INTO
		PTL_ORDER_RECEIVE_LIST
		(
			  SEQ
			, USER_ID
			, COMP_CMMT
			, CRE_DT
			, COMP_DT
	        , SRT_NO
		)
		VALUES
		(
			  #{seq}
			, #{usrId}
			, #{compCmmt}
			, TO_CHAR(SYSDATE,'yyyymmddhh24miss')
			, TO_CHAR(SYSDATE,'yyyymmddhh24miss')
			, #{srtNo}
		)
	</insert>

	<!-- 결재 푸시 다음결재자연계 -->
	<insert id="dcmacm045PushOrderNotiInsert" parameterType="paramMap">
			INSERT
			INTO
			PTL_ORDER_NOTI
			(
			  SEQ
			, NOTI_SEQ
			, USER_ID
			, TITLE
			, CRT_DT
			, IMP_YN
			, USE_YN
			)
			VALUES
			(
			  #{seq}
			, #{notiSeq}
			, #{usrId}
			, #{title}
			, TO_CHAR(SYSDATE,'yyyymmddhh24miss')
			, 'N'
			, DECODE(#{usrId},#{frtUsrId},'N','Y')
			)
	</insert>

	<update id="dcmacm045PushOrderReceiveUpdate" parameterType="paramMap">
		UPDATE PTL_ORDER_RECEIVE_LIST
		SET COMP_CMMT = #{compCmmt}
		  , COMP_DT =  TO_CHAR(SYSDATE,'yyyymmddhh24miss')
		WHERE 1 = 1
		  AND USER_ID=#{usrId}
		  AND SEQ = #{seq}
	</update>


	<update id="dcmacm045PushOrderListUpdate" parameterType="paramMap">
		UPDATE PTL_ORDER_LIST
		SET NA_YN ='Y'
		  , NA_DT= TO_CHAR(SYSDATE,'yyyymmddhh24miss')
		WHERE 1 = 1
		  AND SEQ = #{seq}
	</update>


	<update id="dcmacm045PushOrderNotiUpdate" parameterType="paramMap">
		UPDATE
		PTL_ORDER_NOTI
		SET TITLE =#{title}
		WHERE 1 = 1
		  AND USER_ID=#{usrId}
		  AND SEQ = #{seq}
	</update>

	<!-- 푸시orderlist max seq -->
	<select id="dcmacm045PushMaxSeq" parameterType="paramMap"	resultType="java.lang.String">
		SELECT NVL(MAX(SEQ),'1000000')+1 FROM PTL_ORDER_LIST
	</select>

	<!-- 푸시 noti max seq -->
	<select id="dcmacm045PushNotiMaxSeq" parameterType="paramMap"	resultType="java.lang.String">
		SELECT NVL(MAX(NOTI_SEQ),'1000000')+1 FROM ptl_order_noti
		WHERE SEQ =#{seq}
	</select>

	<!-- 문서번호에 해당하는 order seq -->
	<select id="dcmacm045PushOrderSeq" parameterType="paramMap" resultType="egovMap">
		SELECT TO_CHAR(SEQ) AS SEQ
		FROM PTL_ORDER_LIST
		WHERE DOC_No =#{apvDocNo}
	</select>

	<!-- 권한에 따른 부서 리스트 공통팝업 -->
	<select id="dcmacm006DptListselect" parameterType="paramMap"	resultType="egovMap">
		SELECT DPT_CD
		     , DPT_NM
		  FROM TBDCMACM002M
		  WHERE 1=1
		   AND USE_YN ='Y'
		<if test='usrdptauth != null and usrdptauth != ""'>
            DPT_CD IN ( SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#{usrcnb}, #{usrdptauth}, 'Y')))
        </if>
           ORDER BY DPT_CD
	</select>

	<!-- 메신저연계 max seq -->
	<select id="dcmacm045MsgMaxSeq" parameterType="paramMap"	resultType="java.lang.String">
		SELECT NVL(MAX(MSG_SNO),'0')+1 AS MSG_SNO FROM TBDCMACM026L
	</select>


	<!-- 메신저 push 대상 추가 -->
	<insert id="dcmacm045MsgPushInsert" parameterType="paramMap">
			INSERT INTO
			TBDCMACM026L
			(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
	        , MSG_TP_YN
	        , MSG_TXT_2
	        , RCNT_CNT
	        , RCNT_HIS
	        , MSG_REGI_DH
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
			)
			VALUES
			(
			  #{msgSno}
			, 'CM'
			, 'CM'
			, ''
	        , '0'
	        , #{title}
	        , #{rcntCnt}
	        , REPLACE(#{rcntHis},',','')
	        , SYSDATE
			, #{fnlUsrId}
			, #{fnlUsrId}
			, #{fnlDealDptCd}
			, #{fnlMnuId}
			, SYSDATE
			, SYSDATE
			);

	</insert>

	<!-- 소속순 직원명부 -->
	<select id="dcmportalDptUsrSelect" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT DPT_NM, DPT_CD
			  FROM (
			        SELECT DPT_CD, '['||DPT_NM||']' AS DPT_NM, DPT_CD AS DPT_SNO
			          FROM TBDCMACM002M
			         WHERE USE_YN = 'Y'
			           AND SUBSTR(DPT_CD, 3,6) = '0000'
			        UNION ALL
			        SELECT DPT_CD, '<'||ABR_DPT_NM_1||'>' AS DPT_NM, HIRK_DPT_CD||DPT_CD AS DPT_SNO
			          FROM TBDCMACM002M
			         WHERE USE_YN = 'Y'
			           AND SUBSTR(HIRK_DPT_CD, 3,6) = '0000'
			        UNION ALL
			        SELECT A.DPT_CD
			             , USR_NAM||NVL(DECODE(LENGTH(F_CODE_NM('1000173', A.RANK_CD)),2,'('||SUBSTR(F_CODE_NM('1000173', A.RANK_CD),1,1)||') ', ''),'') AS DPT_NM
			             , B.HIRK_DPT_CD||B.DPT_CD||'000'||DECODE(A.RANK_CD,'187','0',A.RANK_CD) AS DPT_SNO
			          FROM TBDCMACM001M A, TBDCMACM002M B
			         WHERE A.DPT_CD = B.DPT_CD
			           AND B.USE_YN = 'Y'
			           AND A.DPT_CD <> '880880'
			           AND A.RQS_STA_CD = '3'
			           AND A.WOK_DVSN_CD IN ('AAA','AAB','ABA','ABB')
			           AND B.DPT_CD NOT IN ('150150','150160','150170')
			 )
			 ORDER BY DPT_SNO, DPT_CD
 		]]>
	</select>

	<!-- 성명순 직원명부1 -->
	<select id="dcmportalUsr1Select" parameterType="paramMap"	resultType="egovMap">
		<![CDATA[
		SELECT USR_NAM||NVL(DECODE(LENGTH(F_CODE_NM('1000173', A.RANK_CD)),2,'('||SUBSTR(F_CODE_NM('1000173', A.RANK_CD),1,1)||') ', ''),'')||D.ABR_DPT_NM_1 AS MEM
		  FROM TBDCMACM002M D, TBDCMACM001M A
		 WHERE D.USE_YN = 'Y'
		   AND D.DPT_CD = A.DPT_CD
		   AND A.DPT_CD <> '880880'
		   AND A.WOK_DVSN_CD IN ('AAA','AAB','ABA','ABB')
		   AND A.DPT_CD NOT IN ('150150','150160','150170')
		   AND A.RQS_STA_CD = '3'
		  ORDER BY A.USR_NAM
		]]>
	</select>


	<!-- 성명순 직원명부2 -->
	<select id="dcmportalUsr2Select" parameterType="paramMap"	resultType="egovMap">
		<![CDATA[
			SELECT USR_NAM||DECODE(LENGTH(RANK_NM),2,'('||SUBSTR(RANK_NM,1,1)||')', '')||' '||TNB||' '||ABR_DPT_NM_1 AS MEM
			  FROM (
			SELECT USR_NAM
			    , F_CODE_NM('1000173', A.RANK_CD) AS RANK_NM
			    , D.ABR_DPT_NM_1
			    , CASE WHEN LENGTH(A.TNB) > 4 THEN SUBSTR(A.TNB,LENGTH(A.TNB)-3,LENGTH(A.TNB))
			           ELSE A.TNB
			       END AS TNB
			  FROM TBDCMACM002M D, TBDCMACM001M A
			 WHERE D.USE_YN = 'Y'
			   AND D.DPT_CD = A.DPT_CD
			   AND A.DPT_CD <> '880880'
			   AND A.WOK_DVSN_CD IN ('AAA','AAB','ABA','ABB')
			   AND A.DPT_CD NOT IN ('150150','150160','150170')
			   AND A.RQS_STA_CD = '3'
			       )
			  ORDER BY USR_NAM
		]]>
	</select>


	<!-- 부서벌 직원명부1 -->
	<select id="dcmacm049ReportSelect2" parameterType="paramMap"	resultType="egovMap">
		<![CDATA[
		SELECT F_DPT_INFO(FNL_DEAL_DPT_CD,'1') AS DPT_NM
		     /*, B.RESOURCE_DESC AS MNU_NM
		     , A.MNU_ID*/
		     , LVL_MNU_NM_1
		     , LVL_MNU_NM_2
		     , LVL_MNU_NM_3
		     , LVL_MNU_NM_4
		     , LVL_MNU_NM_5
		     , COUNT(A.FNL_DEAL_DPT_CD) AS CNT
		  FROM TBDCMACM014H A
		     , COMMON_RESOURCE B
		 WHERE RQS_SVC_ID ='/biz/com/auth/auth.do'
		   AND A.MNU_ID = RESOURCE_NAME
		   		 ]]>
		<if test='dptcd != null and dptcd != ""'>
		    FNL_DEAL_DPT_CD=#{dptcd}
		 </if>
		<if test='ip != null and ip != ""'>
		    RQS_IP_NO LIKE '%'||#{ip}||'%'
		 </if>
		<if test='usrcnb != null and usrcnb != ""'>
		    CNB=#{usrcnb}
		 </if>
		    AND TO_CHAR(RQS_DH,'YYYYMMDD') BETWEEN #{from} AND #{to}
		 GROUP BY FNL_DEAL_DPT_CD, MNU_ID,LVL_MNU_NM_1,
		          LVL_MNU_NM_2, LVL_MNU_NM_3,LVL_MNU_NM_4, LVL_MNU_NM_5
		 ORDER BY FNL_DEAL_DPT_CD, LVL_MNU_NM_1, LVL_MNU_NM_2, LVL_MNU_NM_3,LVL_MNU_NM_4, LVL_MNU_NM_5
	</select>


		<!-- 메뉴별 직원명부1 -->
	<select id="dcmacm049ReportSelect1" parameterType="paramMap"	resultType="egovMap">
		<![CDATA[
		SELECT
		     /*  B.RESOURCE_DESC AS MNU_NM
		     , A.MNU_ID
		     ,*/
		      LVL_MNU_NM_1
		     , LVL_MNU_NM_2
		     , LVL_MNU_NM_3
		     , LVL_MNU_NM_4
		     , LVL_MNU_NM_5
		     , COUNT(A.FNL_DEAL_DPT_CD) AS CNT
		  FROM TBDCMACM014H A
		     , COMMON_RESOURCE B
		 WHERE RQS_SVC_ID ='/biz/com/auth/auth.do'
		   AND A.MNU_ID = RESOURCE_NAME
		   		 ]]>
		<if test='dptcd != null and dptcd != ""'>
		    FNL_DEAL_DPT_CD=#{dptcd}
		 </if>
		<if test='ip != null and ip != ""'>
		    RQS_IP_NO LIKE '%'||#{ip}||'%'
		 </if>
		<if test='usrcnb != null and usrcnb != ""'>
		    CNB=#{usrcnb}
		 </if>
		    AND TO_CHAR(RQS_DH,'YYYYMMDD') BETWEEN #{from} AND #{to}
		 GROUP BY LVL_MNU_NM_1,
		          LVL_MNU_NM_2, LVL_MNU_NM_3,LVL_MNU_NM_4, LVL_MNU_NM_5
		 ORDER BY LVL_MNU_NM_1, LVL_MNU_NM_2, LVL_MNU_NM_3,LVL_MNU_NM_4, LVL_MNU_NM_5
	</select>

	<select id="dcmacm047PushCnbList" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT	APVR_CNB
			FROM	TBDCMACM023L
			WHERE	APV_DOC_NO = #{docno}
		]]>
	</select>

	<select id="DCMACM001IfSeqSelect" parameterType="paramMap" resultType="Integer">
		<![CDATA[
			SELECT	IF_SEQ.NEXTVAL
			FROM	DUAL
		]]>
	</select>

	<select id="DCMACM001IfFileSeqSelect" parameterType="paramMap" resultType="Integer">
		<![CDATA[
			SELECT	IF_FILE_SEQ.NEXTVAL
			FROM	DUAL
		]]>
	</select>

	<insert id="DCMACM001BAI_INF_DB_SND_001Insert" parameterType="paramMap">
		<![CDATA[
			INSERT INTO	BAI_INF_DB_SND_001
					(	IF_SEQ			/*연계순번*/
						,TARE_NM		/*테이블명*/
						,IF_REF_SEQ		/*참조연계순번*/
						,IF_STATUS		/*연계상태코드*/
						,IF_TRY			/*연계시도횟수*/
						,IF_RAISE_DT	/*IF_RAISE_DT*/
					)
			VALUES	(	#{ifSeq}
						,#{tareNm}
						,#{ifRefSeq}
						,'SS'
						,0
						,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
					)
		]]>
	</insert>

	<insert id="DCMACM001EH_INF_GR_AT_001Insert" parameterType="paramMap">
		<![CDATA[
			INSERT INTO	EH_INF_GR_AT_001
					(	IF_FILE_SEQ
						,IF_SEQ
						,TARE_NM
						,ATCH_FILE_ID
						,FILE_SN
						,FILE_STRE_COURS
						,STRE_FILE_NM
						,ORIGNL_FILE_NM
						,FILE_EXTSN
						,FILE_CN
						,FILE_SIZE
						,IF_FILE_CASE
						,FRT_USR_ID
					)
			VALUES	(	#{ifFileSeq}
						,#{ifSeq}
						,#{tareNm}
						,#{atchFileId}
						,#{fileSn}
						,#{fileStreCours}
						,#{streFileNm}
						,#{orignlFileNm}
						,#{fileExtsn}
						,#{fileCn}
						,#{fileSize}
						,#{ifFileCase}
						,#{frtUsrId}
					)
		]]>
	</insert>

	<select id="DCMACM001ReceiveSelect" parameterType="String" resultType="egovMap">
		<![CDATA[
			SELECT	IF_SEQ
					,TARE_NM
					,IF_REF_SEQ
					,IF_TABLE_PK
			FROM	BAI_INF_DB_RCV_001
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</select>

	<select id="DCMACM001HE_INF_EP_PS_001Select" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT	IF_SEQ
					,IF_TYPE
					,NTT_ID
					,BBS_ID
					,NTT_NO
					,NTT_SJ
					,NTT_CN
					,NTCR_NM
					,FLAG
					,FRST_REGIST_PNTTM
					,MAIN_IMG_ID
					,THUMB_IMG_ID
					,LIST_IMG_ID
			FROM	HE_INF_EP_PS_001
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</select>

	<!-- 감사교육 수신 데이터 조회 -->
	<select id="DCMACM001HE_INF_SP_AE_004Select" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT	IF_SEQ
					,IF_TYPE
					,YR
					,CRS_CD
					,CRS_CDN
					,TANE_ID
					,NAM
					,BTDT
					,DPT_NM
					,HPN
					,PST_NM
					,RANK_NM
					,SEX_CD
					,WRK_PRD_TXT
					,DMT_UE_YN
					,SNDY_LODG_YN
					,RMK_SBJ
					,ORG_CD
					,IF_SIID
					,'HOMEPAGE' AS FNL_USR_ID
					,'HOMEPAGE' AS FNL_DEAL_DPT_CD
					,'HOMEPAGE' AS FNL_MNU_ID
			FROM	HE_INF_SP_AE_004
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</select>

	<update id="DCMACM001BAI_INF_DB_RCV_001ERRORUpdate" parameterType="paramMap">
		<![CDATA[
			UPDATE	BAI_INF_DB_RCV_001
			SET		IF_STATUS = #{ifStatus}
					,IF_TABLE_PK = #{ifTablePk}
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</update>

	<resultMap type="java.util.HashMap" id="spcp008Map">
		<result property="ifSeq" column="IF_SEQ" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ifType" column="IF_TYPE" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="hmpAplNo" column="HMP_APL_NO" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="cvptrNm" column="CVPTR_NM" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="tnb" column="TNB" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="emlId" column="EML_ID" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="hpn" column="HPN" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="zcd" column="ZCD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ad" column="AD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="dtlAd" column="DTL_AD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="cpnmNm" column="CPNM_NM" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="bzn" column="BZN" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="clmNm" column="CLM_NM" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="wrkPlacNm" column="WRK_PLAC_NM" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="clmTnb" column="CLM_TNB" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="clmZcd" column="CLM_ZCD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="clmAd" column="CLM_AD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="clmDtlAd" column="CLM_DTL_AD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="cvptKndCd" column="CVPT_KND_CD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="titNm" column="TIT_NM" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="cvptTxt" column="CVPT_TXT" jdbcType="CLOB" javaType="java.lang.String" />
		<result property="acpDh" column="ACP_DH" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ifSiid" column="IF_SIID" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="cvptAcpNo" column="CVPT_ACP_NO" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="docId" column="DOC_ID" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="acpYr" column="ACP_YR" jdbcType="VARCHAR" javaType="java.lang.String" />
	</resultMap>

	<select id="DCMACM001HE_INF_SP_CP_008Select" parameterType="paramMap" resultMap="spcp008Map">
		<![CDATA[
			SELECT	IF_SEQ
					,IF_TYPE
					,HOME_REQ_ID	AS HMP_APL_NO
					,REQ_NM			AS CVPTR_NM
					,REQ_TEL		AS TNB
					,REQ_EML		AS EML_ID
					,REQ_HP			AS HPN
					,REQ_ZIP		AS ZCD
					,REQ_ADDR1		AS AD
					,REQ_ADDR2		AS DTL_AD
					,REQ_ORG		AS CPNM_NM
					,REQ_BSN_NO		AS BZN
					,RES_NM			AS CLM_NM
					,RES_ORG		AS WRK_PLAC_NM
					,RES_TEL		AS CLM_TNB
					,RES_ZIP		AS CLM_ZCD
					,RES_ADDR1		AS CLM_AD
					,RES_ADDR2		AS CLM_DTL_AD
					,JEBO_CD		AS CVPT_KND_CD
					,JEBO_TTL		AS TIT_NM
					,JEBO_CN		AS CVPT_TXT
					,JEBO_REG_DT	AS ACP_DH
					,IF_SIID		AS IF_SIID
					,(	SELECT	LPAD(TO_CHAR(NVL(MAX(TO_NUMBER(RM_CVPT_ACP_NO)),0)+1),5,0) AS RM_CVPT_ACP_NO
						FROM	TBCSPDCP101M
						WHERE	REQ_DVSN_CD = '1'
						AND		ACP_YR = SUBSTR(#{jeboRegDt}, 1,4)
					) AS CVPT_ACP_NO
					,'' AS DOC_ID
					,SUBSTR(#{jeboRegDt}, 1,4) AS ACP_YR
			FROM	HE_INF_SP_CP_008
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</select>

	<resultMap type="java.util.HashMap" id="spcp009Map">
		<result property="ifSeq" column="IF_SEQ" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ifType" column="IF_TYPE" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="hmpAplNo" column="HMP_APL_NO" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="cvptrNm" column="CVPTR_NM" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="tnb" column="TNB" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="emlId" column="EML_ID" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="hpn" column="HPN" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="zcd" column="ZCD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ad" column="AD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="dtlAd" column="DTL_AD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="cpnmNm" column="CPNM_NM" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="bzn" column="BZN" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="clmNm" column="CLM_NM" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="wrkPlacNm" column="WRK_PLAC_NM" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="clmTnb" column="CLM_TNB" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="clmZcd" column="CLM_ZCD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="clmAd" column="CLM_AD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="clmDtlAd" column="CLM_DTL_AD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="titNm" column="TIT_NM" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="cvptTxt" column="CVPT_TXT" jdbcType="CLOB" javaType="java.lang.String" />
		<result property="ifSiid" column="IF_SIID" jdbcType="VARCHAR" javaType="java.lang.String" />
	</resultMap>
	<select id="DCMACM001HE_INF_SP_CP_009Select" parameterType="paramMap" resultMap="spcp009Map">
		<![CDATA[
			SELECT	IF_SEQ
					,IF_TYPE
					,HOME_REQ_ID	AS HMP_APL_NO
					,REQ_NM			AS CVPTR_NM
					,REQ_TEL		AS TNB
					,REQ_EML		AS EML_ID
					,REQ_HP			AS HPN
					,REQ_ZIP		AS ZCD
					,REQ_ADDR1		AS AD
					,REQ_ADDR2		AS DTL_AD
					,REQ_ORG		AS CPNM_NM
					,REQ_BSN_NO		AS BZN
					,RES_NM			AS CLM_NM
					,RES_ORG		AS WRK_PLAC_NM
					,RES_TEL		AS CLM_TNB
					,RES_ZIP		AS CLM_ZCD
					,RES_ADDR1		AS CLM_AD
					,RES_ADDR2		AS CLM_DTL_AD
					,JEBO_TTL		AS TIT_NM
					,JEBO_CN		AS CVPT_TXT
					,IF_SIID		AS IF_SIID
			FROM	HE_INF_SP_CP_009
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</select>

	<select id="DCMACM001HE_INF_SP_CP_014Select" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT	IF_SEQ
					,IF_TYPE
					,HOME_REQ_ID		AS HMP_APL_NO
					,JEBO_CNCL_DT
					,IP_AD
					,E_RECV_NO			AS RM_CVPT_ACP_NO
					,E_RECV_YY			AS ACP_YR
					,IF_SIID
			FROM	HE_INF_SP_CP_014
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</select>

	<select id="DCMACM001HE_INF_SP_IS_001Select" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT	IF_SEQ
					,IF_TYPE
					,CRPT_TYP_NM
					,'' AS DOC_ID
					,DOC_TYP_CD
					,INSP_TXT
					,NAM
					,WRIT_DH
					,TIT_NM
					,HPN
					,IF_SIID
					,(SELECT NVL(MAX(SNO),0) + 1 FROM TBCSPCIS002M) AS SNO
			FROM	HE_INF_SP_IS_001
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</select>

	<select id="DCMACM001HE_HPDM010101_DM010101Select" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT	,IF_SEQ
					,IF_TYPE
					,AUD_SMT_MTRL_ID
					,AUD_SMT_MTRL_TIT_NM
					,RQR_CNB
					,SMT_DT
					,SMT_TXT
					,PRSR_NAM
					,PRSR_TNB
					,PRSR_EML_AD
					,PRSR_ORG_CD
					,SMT_ORG_CD
					,SMT_ORG_NM
					,SMT_ORG_BRDV_CD
					,SMT_ORG_BRDV_NM
					,RQR_DPT_CD
					,FRT_REGI_DH
					,IF_SIID
			FROM	HE_HPDM010101_DM010101
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</select>

	<select id="DCMACM001EH_INF_GR_AT_002Select" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT	IF_FILE_SEQ
					,IF_SEQ
					,TARE_NM
					,ATCH_FILE_ID
					,FILE_SN
					,FILE_STRE_COURS
					,STRE_FILE_NM
					,ORIGNL_FILE_NM
					,FILE_EXTSN
					,FILE_CN
					,FILE_SIZE
					,IF_FILE_CASE
					,IF_CD
					,BIGO
					,FRT_USR_ID
					,IF_SIID
			FROM	EH_INF_GR_AT_002
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</select>

	<update id="DCMACM001HE_INF_SP_CP_008DocIdUpdate" parameterType="paramMap">
		<![CDATA[
			UPDATE	TBCSPDCP101M
			SET		DOC_ID = #{docId}
			WHERE	HMP_APL_NO = #{ifTablePk}
		]]>
	</update>

	<update id="DCMACM001HE_INF_SP_IS_001DocIdUpdate" parameterType="paramMap">
		<![CDATA[
			UPDATE	TBCSPCIS002M
			SET		DOC_ID = #{docId}
			WHERE	SNO = #{ifTablePk}
		]]>
	</update>

	<update id="DCMACM001HE_HPDM010101_DM010101DocIdUpdate" parameterType="paramMap">
		<![CDATA[
			UPDATE	TBDCMIDM001L
			SET		DOC_ID = #{docId}
			WHERE	AUD_SMT_MTRL_ID = #{ifTablePk}
		]]>
	</update>

	<update id="DCMACM001BaiNewsReceiveMerge" parameterType="paramMap">
		<![CDATA[
			MERGE INTO	PTL_BAI_NEWS A
					USING	(	SELECT	#{nttId} AS NTT_ID
										,#{bbsId} AS BBS_ID
								FROM	DUAL
							) B
					ON	(		A.NTT_ID = B.NTT_ID
							AND	A.BBS_ID = B.BBS_ID
						)
				WHEN	MATCHED	THEN
					UPDATE
					SET		NTT_NO 				= #{nttNo}
							,NTT_SJ 			= #{nttSj}
							,NTT_CN 			= #{nttCn}
							,NTCR_NM 			= #{ntcrNm}
							,FRST_REGIST_PNTTM 	= #{frstRegistPnttm}
							,MAIN_IMG_ID		= #{mainImgId}
							,THUMB_IMG_ID		= #{thumbImgId}
							,LIST_IMG_ID		= #{listImgId}
				WHEN	NOT MATCHED THEN
					INSERT	(	NTT_ID
								,BBS_ID
								,NTT_NO
								,NTT_SJ
								,NTT_CN
								,NTCR_NM
								,FRST_REGIST_PNTTM
								,MAIN_IMG_ID
								,THUMB_IMG_ID
								,LIST_IMG_ID
							)
					VALUES	(	#{nttId}
								,#{bbsId}
								,#{nttNo}
								,#{nttSj}
								,#{nttCn}
								,#{ntcrNm}
								,#{frstRegistPnttm}
								,#{mainImgId}
								,#{thumbImgId}
								,#{listImgId}
							)
		]]>
	</update>

	<resultMap type="java.util.HashMap" id="enaisBoardMap">
		<result property="ifSeq" 		column="IF_SEQ"			jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="brdDvsnCd"  column="BRD_DVSN_CD" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="srno" 		column="SRNO" 			jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="grpNo" 		column="GRP_NO" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="rplSno" 		column="RPL_SNO" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="lvlCnt" 		column="LVL_CNT" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="titNm" 		column="TIT_NM" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="regiDh" 		column="REGI_DH" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="regiOrgNm" 	column="REGI_ORG_NM" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="regnId" 		column="REGN_ID" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="regnNm" 		column="REGN_NM" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="srchCnt" 	column="SRCH_CNT" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="txt" 			column="TXT" 			jdbcType="CLOB" javaType="java.lang.String" />
		<result property="docId" 		column="DOC_ID" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="docTypCd" 	column="DOC_TYP_CD" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="tnb" 			column="TNB" 			jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="emlAd" 		column="EML_AD" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="rmk" 			column="RMK" 			jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="frtRegiDh" 	column="FRT_REGI_DH" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="frtUsrId" 	column="FRT_USR_ID" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="fnlMdfDh" 	column="FNL_MDF_DH" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="fnlUsrId" 	column="FNL_USR_ID" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="fnlDealDptCd" column="FNL_DEAL_DPT_CD" jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="fnlMnuId" 	column="FNL_MNU_ID" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="atchFileId" column="ATCH_FILE_ID" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="filePath" 	column="FILE_PATH" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="fileName" 	column="FILE_NAME" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="sFileName" 	column="S_FILE_NAME" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="fileSize" 	column="FILE_SIZE" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="flag" 		column="FLAG" 			jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ifStatus" 	column="IF_STATUS" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ifTry" 		column="IF_TRY" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ifRaiseDt" 	column="IF_RAISE_DT" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ifDealDt" 	column="IF_DEAL_DT" 	jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ifMessg" 	column="IF_MESSG" 		jdbcType="VARCHAR" javaType="java.lang.String" />
		<result property="ifSiid" 		column="IF_SIID" 		jdbcType="VARCHAR" javaType="java.lang.String" />

	</resultMap>
	<select id="DCMACM001HE_ENAIS_BOARDSelect" parameterType="paramMap" resultMap="enaisBoardMap">
		<![CDATA[
			SELECT	IF_SEQ,
					BRD_DVSN_CD,
					SRNO,
					GRP_NO,
					RPL_SNO,
					LVL_CNT,
					TIT_NM,
					REGI_DH,
					REGI_ORG_NM,
					REGN_ID,
					REGN_NM,
					SRCH_CNT,
					TXT,
					DOC_ID,
					DOC_TYP_CD,
					TNB,
					EML_AD,
					RMK,
					FRT_REGI_DH,
					FRT_USR_ID,
					FNL_MDF_DH,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					ATCH_FILE_ID,
					FILE_PATH,
					FILE_NAME,
					S_FILE_NAME,
					FILE_SIZE,
					FLAG,
					IF_STATUS,
					IF_TRY,
					IF_RAISE_DT,
					IF_DEAL_DT,
					IF_MESSG,
					IF_SIID
			FROM	HE_ENAIS_BOARD
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</select>

	<insert id="DCMACM001TWFAACAV065LReceiveInsert" parameterType="paramMap">
		<![CDATA[
			INSERT INTO	TWFAACAV065L
					(	BRD_DVSN_CD
						,SRNO
						,GRP_NO
						,RPL_SNO
						,LVL_CNT
						,TIT_NM
						,REGI_DH
						,REGI_ORG_NM
						,REGN_ID
						,REGN_NM
						,SRCH_CNT
						,TXT
						,DOC_ID
						,DOC_TYP_CD
						,TNB
						,EML_AD
						,RMK
						,FRT_REGI_DH
						,FRT_USR_ID
						,FNL_MDF_DH
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
					)
			VALUES	(	#{brdDvsnCd}
						,#{srno}
						,#{grpNo}
						,#{rplSno}
						,#{lvlCnt}
						,#{titNm}
						,#{regiDh}
						,#{regiOrgNm}
						,#{regnId}
						,#{regnNm}
						,#{srchCnt}
						,#{txt}
						,''
						,''
						,#{tnb}
						,#{emlAd}
						,#{rmk}
						,SYSDATE
						,'BATCH'
						,SYSDATE
						,'BATCH'
						,'BATCH'
						,'BATCH'
					)
		]]>
	</insert>

	<update id="DCMACM001TWFAACAV065LReceiveUpdate" parameterType="paramMap">
		<![CDATA[
			UPDATE  TWFAACAV065L
			SET     TIT_NM = #{titNm},
			        SRCH_CNT = #{srchCnt},
			        TXT = #{txt},
			        DOC_ID = #{docId},
			        TNB = #{tnb},
			        EML_AD = #{emlAd}
			WHERE   BRD_DVSN_CD = #{brdDvsnCd}
			AND		SRNO = #{srno}
		]]>
	</update>

	<update id="DCMACM001TWFAACAV065LReceiveDelete" parameterType="paramMap">
		<![CDATA[
			DELETE  TWFAACAV065L
			WHERE   1=1
			AND     BRD_DVSN_CD = #{brdDvsnCd}
			AND		GRP_NO = #{grpNo}
		]]>
	</update>

	<select id="DCMACM001EnaisIfSeqSelect" parameterType="paramMap" resultType="Integer">
		<![CDATA[
			SELECT	ENAIS_IF_SEQ.NEXTVAL AS IF_SEQ
			FROM	DUAL
		]]>
	</select>

	<select id="DCMACM001_NE_ENAIS_BOARD_Select" parameterType="String" resultType="egovMap">
		<![CDATA[
			SELECT  BRD_DVSN_CD
					,SRNO
					,GRP_NO
					,RPL_SNO
					,LVL_CNT
					,TIT_NM
					,REGI_DH
					,REGI_ORG_NM
					,REGN_ID
					,REGN_NM
					,SRCH_CNT
					,TXT
					,DOC_ID
					,DOC_TYP_CD
					,TNB
					,EML_AD
					,RMK
					,FRT_REGI_DH
					,FRT_USR_ID
					,FNL_MDF_DH
					,FNL_USR_ID
					,FNL_DEAL_DPT_CD
					,FNL_MNU_ID
					,ATCH_FILE_ID
					,FILE_PATH
					,FILE_NAME
					,S_FILE_NAME
					,FILE_SIZE
					,FLAG
			FROM	NE_ENAIS_BOARD
			WHERE   IF_SEQ = #{ifSeq}
		]]>
	</select>

	<select id="DCMACM001TWFAACAV065LSelectDocID" parameterType="paramMap" resultType="egovMap">
		<![CDATA[
			SELECT DOC_ID
			  FROM TWFAACAV065L
			 WHERE BRD_DVSN_CD = #{brdDvsnCd}
			   AND SRNO = #{srno}
		]]>
	</select>

	<update id="DCMACM001TWFAACAV065LReceiveMerge" parameterType="paramMap">
		<![CDATA[
            MERGE INTO	TWFAACAV065L A
					USING	(	SELECT	#{brdDvsnCd} AS BRD_DVSN_CD
										,#{srno} AS SRNO
								FROM	DUAL
							) B
					ON	(		A.BRD_DVSN_CD = B.BRD_DVSN_CD
								AND	A.SRNO = B.SRNO
						)
				WHEN	MATCHED	THEN
					UPDATE
					SET     TIT_NM = #{titNm},
                            SRCH_CNT = #{srchCnt},
                            TXT = #{txt},
                           	DOC_ID = #{docId},
                            TNB = #{tnb},
                            EML_AD = #{emlAd}
				WHEN	NOT MATCHED THEN
					INSERT  (	BRD_DVSN_CD
                                ,SRNO
                                ,GRP_NO
                                ,RPL_SNO
                                ,LVL_CNT
                                ,TIT_NM
                                ,REGI_DH
                                ,REGI_ORG_NM
                                ,REGN_ID
                                ,REGN_NM
                                ,SRCH_CNT
                                ,TXT
                                ,DOC_ID
                                ,DOC_TYP_CD
                                ,TNB
                                ,EML_AD
                                ,RMK
                                ,FRT_REGI_DH
                                ,FRT_USR_ID
                                ,FNL_MDF_DH
                                ,FNL_USR_ID
                                ,FNL_DEAL_DPT_CD
                                ,FNL_MNU_ID
                            )
                    VALUES	(	#{brdDvsnCd}
                                ,#{srno}
                                ,#{grpNo}
                                ,#{rplSno}
                                ,#{lvlCnt}
                                ,#{titNm}
                                ,#{regiDh}
                                ,#{regiOrgNm}
                                ,#{regnId}
                                ,#{regnNm}
                                ,#{srchCnt}
                                ,#{txt}
                                ,#{docId}
                                ,'ENAIS_연계파일'
                                ,#{tnb}
                                ,#{emlAd}
                                ,#{rmk}
                                ,SYSDATE
                                ,'BATCH'
                                ,SYSDATE
                                ,'BATCH'
                                ,'BATCH'
                                ,'BATCH'
                            )
		]]>
	</update>

	<update id="DCMACM001TWFAACAV065LERRORUpdate" parameterType="paramMap">
		<![CDATA[
			UPDATE	TWFAACAV065L
			SET		IF_STATUS = #{ifStatus}
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</update>

	<select id="DCMACM001_NE_ENAIS_FILE_Select" parameterType="String" resultType="egovMap">
		<![CDATA[
			SELECT  FILE_PATH
					,FILE_NAME
					,S_FILE_NAME
			FROM    NE_ENAIS_FILE
			WHERE   IF_SEQ = #{ifSeq}
		]]>
	</select>

	<update id="DCMACM001_NE_ENAIS_FILE_ERRORUpdate" parameterType="paramMap">
		<![CDATA[
			UPDATE	NE_ENAIS_FILE
			SET		IF_STATUS = #{ifStatus}
			WHERE	IF_SEQ = #{ifSeq}
		]]>
	</update>

    <select id="selectAudBscSbj" parameterType="paramMap" resultType="egovMap" >
            /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectAudBscSbj (감사기본사항, 업무설명 조회)*/
            SELECT  A.AUD_YR /*감사년도*/
                   ,A.AUD_NO /*실연번호*/
                   ,A.AUD_GRN_NO /*감사부여번호(화면에 보여지는 번호)*/
                   ,F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-') AS AUD_YR_NO  /*감사번호*/
                   ,A.AUD_SBJ_NM  /*감사사항명*/
                   ,CASE WHEN A.AUD_YR >= #{audYr} THEN SUBSTR(A.AUD_KND_CD, 3, 1)
                         ELSE ''
                         END AS AUD_YR_NO_KND_CD  /*감사종류코드*/
                   ,CASE WHEN A.AUD_YR >= #{audYr} THEN F_CODE_NM('1000739', A.AUD_KND_CD)
                         ELSE '-'
                         END AS AUD_YR_NO_KND_NM  /*감사종류명*/
                   ,A.BZT_BGT_DVSN_CD AS BZT_BGT_DVSN_CD  /*예산구분코드*/
                   ,F_CODE_NM('1000751', A.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM /*예산구분명*/
                   ,A.SPV_BRDV_CD AS SPV_BRDV_CD /*주관국과코드*/
                   ,F_DPT_INFO(A.SPV_BRDV_CD, '1') AS SPV_BRDV_NM  /*주관국과명*/
                   ,A.ORG_DVSN_CD AS ORG_DVSN_CD /*기관구분코드*/
                   ,A.AUD_RPST_ORG_CD AS AUD_RPST_ORG_CD /*감사대표기관코드*/
                   ,F_ORG_INFO(A.AUD_RPST_ORG_CD, '1') AS AUD_RPST_ORG_NM /*대표기관명*/
                   ,A.MNG_DPT_CD AS MNG_DPT_CD /*관리부서코드*/
                   ,F_DPT_INFO(A.MNG_DPT_CD, '1') AS MNG_DPT_NM /*관리부서명*/
                   ,A.AUD_SCL_CD /*감사규모코드*/
                   ,F_CODE_NM('1000027', A.AUD_SCL_CD) AS AUD_SCL_CD_NM/*감사규모코드명*/
                   ,A.AUD_TOT_DRTR_CNB   /*감사총책임자전산번호 */
                   ,F_USR_INFO(A.AUD_TOT_DRTR_CNB, 2) AS AUD_TOT_DRTR_CNB_NM /*감사총책임자명 */
                   ,A.TOT_DRTR_RANK_CD   /*총책임자직급코드 */
                   ,F_CODE_NM('1000173',A.TOT_DRTR_RANK_CD)   AS TOT_DRTR_RANK_NM   /*총책임자직급명*/
                   ,A.TOT_DRTR_BRDV_CD   /*총책임자국과코드 */
                   ,F_DPT_INFO(A.TOT_DRTR_BRDV_CD,'1') AS TOT_DRTR_BRDV_NM /*총책임자국과명 */
                   ,F_USR_INFO(A.AUD_TOT_DRTR_CNB, 2) ||'('||F_DPT_INFO(A.TOT_DRTR_BRDV_CD,'1')||' | '||F_CODE_NM('1000173',A.TOT_DRTR_RANK_CD)||')' as TOT_DRTR_FULL /*감사단장 FULL */

                   /*여기부터 세부사항*/
                   ,A.SPVR_CNB   /*주관자전산번호 */
                   ,F_USR_INFO(A.SPVR_CNB, 2) AS SPVR_CNB_NM /*주관자명 */
                   ,A.SPVR_RANK_CD   /*주관자직급코드 */
                   ,F_CODE_NM('1000173',A.SPVR_RANK_CD)   AS SPVR_RANK_CD_NM   /*주관자직급명*/
                   ,A.SPVR_BRDV_CD   /*주관자국과코드 */
                   ,F_DPT_INFO(A.SPVR_BRDV_CD,'1') AS SPVR_BRDV_CD_NM /*주관자국과명 */
                   ,F_USR_INFO(A.SPVR_CNB, 2) ||'('|| F_DPT_INFO(A.SPVR_BRDV_CD,'1') ||' | '||F_CODE_NM('1000173',A.SPVR_RANK_CD)||')' as SPVR_FULL /*주관자 FULL */
                   ,A.AST_CNB    /*보조자전산번호 */
                   ,F_USR_INFO(A.AST_CNB, 2) AS AST_CNB_NM /*보조자명 */
                   ,A.AST_RANK_CD    /*보조자직급코드 */
                   ,F_CODE_NM('1000173',A.AST_RANK_CD)   AS AST_RANK_CD_NM   /*보조자직급명*/
                   ,A.AST_BRDV_CD    /*보조자국과코드 */
                   ,F_DPT_INFO(A.AST_BRDV_CD,'1') AS AST_BRDV_CD_NM /*보조자국과명 */
                   ,F_USR_INFO(A.AST_CNB, 2) ||'('|| F_DPT_INFO(A.AST_BRDV_CD,'1') ||' | '||F_CODE_NM('1000173',A.AST_RANK_CD)||')' as AST_FULL /*보조자 FULL */
                   ,A.AUD_TASK_CD  /*감사과제코드 */
                   ,F_CODE_NM('1000008', A.AUD_TASK_CD) AS AUD_TASK_CD_NM  /*감사과제코드명*/
                   ,A.AUD_WAY_CD   /*감사방법코드  */
                   ,F_CODE_NM('1000009', A.AUD_WAY_CD) AS AUD_WAY_CD_NM  /*감사방법코드명*/
                   ,A.EPS_TASK_CD    /*감사중점과제코드  */
                   ,F_CODE_NM_YEAR('1000005', a.EPS_TASK_CD, a.AUD_YR) as EPS_TASK_CD_NM  /*감사중점과제코드명*/
            FROM TBBADDED001M A
            WHERE 1=1
              AND A.AUD_YR = #{audYr}
            <if test='audKndCd != null and audKndCd != ""'>
                AND A.AUD_KND_CD = #{audKndCd}
            </if>
            <if test='audGrnNo != null and audGrnNo != ""'>
                AND A.AUD_GRN_NO = #{audGrnNo}
            </if>
            <if test='audNo != null and audNo != ""'>
                AND A.AUD_NO = #{audNo}
            </if>
    </select>

    <select id="selectDocumentList" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectDocumentList*/
        /*문서함(결재정보)*/
        <![CDATA[
        SELECT
            RPRT_NM,
           APV_STA_CD,
           APV_RQS_ID,
           DOC_ID,
           APV_SRNO,
           PST_NM,
           APVR_NM,
           APV_DH ,
           CASE
                WHEN ROW_NUMBER() OVER(PARTITION BY DOC_ID ORDER BY APV_SRNO) = 1 THEN COUNT(*) OVER(PARTITION BY DOC_ID)
                ELSE 0
           END ROWSPAN_CNT,
           APVR_CNB
      FROM (
           SELECT
                  A.RPRT_NM ,       /*보고서명 */
                  A.APV_STA_CD ,    /*결재상태코드 */
                  A.DOC_ID ,        /*결재문서번호 */
                  A.APV_RQS_ID,     /*결재요청ID */
                  B.APV_SRNO ,      /*결재순번 */
                  B.PST_NM ,        /*결재자직위코드 */
                  B.APVR_NM ,       /*결재자전산번호 */
                  B.APVR_STA_CD,
                  /* 문서 반려시 재상신하므로 최초결재일을 History 테이블에서 가져오도록 수정 MJ */
                  CASE
                  WHEN B.APV_DH IS NULL
                        THEN
                        CASE WHEN (SELECT MIN(TO_CHAR(APV_DH, 'YYYY-MM-DD'))
                                          FROM TBDCMACM023H ST1
                                         WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
                                           AND ST1.APVR_CNB = B.APVR_CNB
                                           AND NVL(ST1.APVR_PST_CD, 0) = NVL(B.APVR_PST_CD, 0)
                                           AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') IS NULL
                                    THEN B.APV_DH
                                  ELSE (SELECT MIN(TO_CHAR(APV_DH, 'YYYY-MM-DD'))
                                          FROM TBDCMACM023H ST1
                                         WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
                                           AND ST1.APVR_CNB = B.APVR_CNB
                                           AND NVL(ST1.APVR_PST_CD, 0) = NVL(B.APVR_PST_CD, 0)
                                           AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') END
                       WHEN B.APV_DH IS NOT NULL
                        THEN CASE WHEN (SELECT MIN(TO_CHAR(APV_DH, 'YYYY-MM-DD'))
                                          FROM TBDCMACM023H ST1
                                         WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
                                           AND ST1.APVR_CNB = B.APVR_CNB
                                           AND NVL(ST1.APVR_PST_CD, 0) = NVL(B.APVR_PST_CD, 0)
                                           AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') IS NULL
                                    THEN B.APV_DH
                                  ELSE (SELECT MIN(TO_CHAR(APV_DH, 'YYYY-MM-DD'))
                                          FROM TBDCMACM023H ST1
                                         WHERE ST1.APV_DOC_NO = B.APV_RQS_ID
                                           AND ST1.APVR_CNB = B.APVR_CNB
                                           AND NVL(ST1.APVR_PST_CD, 0) = NVL(B.APVR_PST_CD, 0)
                                           AND SUBSTR(ST1.APVR_STA_CD,0,1) = '2') END
                  END AS APV_DH /*결재일시 */
                  , B.APVR_CNB
             FROM TBBADDED103M A,
                  (
                  SELECT T1.APV_DOC_NO AS APV_RQS_ID ,
                         T1.APV_SNO AS APV_SRNO ,
                         T1.APVR_PST_CD,
                         CASE WHEN T1.APVR_PST_CD IS NULL
                              THEN T1.ONR_PST_NM
                              ELSE F_CODE_NM('1000176', T1.APVR_PST_CD) ||
                              CASE
                                 WHEN T1.ONR_PST_NM LIKE '%권한대행%' THEN ' 권한대행'
                                 ELSE ''
                                END
                         END  AS PST_NM ,
                         T1.APVR_STA_CD,
                         DECODE(T1.APVR_STA_CD, '206', F_USR_INFO(T1.APVR_CNB, '2')||'('||(
                                                     SELECT '(代)' || F_USR_INFO(T2.APVR_CNB, '2')
                                                       FROM TBDCMACM023L T2
                                                      WHERE T2.APV_DOC_NO = T1.APV_DOC_NO
                                                        AND T2.APV_SNO = T1.APV_SNO
                                                        AND T2.APVR_STA_CD = '203'
                                                    )||')', F_USR_INFO(T1.APVR_CNB, '2')) AS APVR_NM ,
                         CASE WHEN SUBSTR(APVR_STA_CD,0,1) = '2' THEN TO_CHAR(APV_DH, 'YYYY-MM-DD')
                                  ELSE ''
                         END  AS APV_DH,
                         T1.APVR_CNB
                    FROM TBDCMACM023L T1
                   WHERE T1.APV_SNO <> '1'
                   AND T1.APVR_KND_CD != '7' --결재자종류코드 6:대결, 7:제출
                   AND (T1.APVR_KND_CD NOT IN ('6', '7') OR (T1.APVR_KND_CD = '6' AND T1.APVR_PST_CD = '0067400' AND ONR_PST_NM LIKE '%권한대행%'))
                   UNION ALL
                  SELECT DH1.APV_RQS_ID,
                         DH1.APV_SRNO,
                         '',
                         (SELECT H2.PST_NM AS PST_NM
                            FROM TBDCMACM111H H1,
                                 TBDCMACM112H H2
                           WHERE 1=1
                             AND H1.RCPT_DT = H2.RCPT_DT
                             AND H1.RCPT_ID = H2.RCPT_ID
                             AND H1.ONR_DOC_MNG_CRD_ID = DH1.APV_RQS_ID
                             AND H2.APVR_ID = DH1.APVR_ID
                           GROUP BY H2.PST_NM ) AS PST_NM,
                         '' as APVR_STA_CD,
                         DH1.APVR_NM,
                         DH1.APV_DH,
                         DH1.APVR_ID AS APVR_CNB
                    FROM
                         (SELECT ONR_DOC_MNG_CRD_ID AS APV_RQS_ID,
                                 APV_HIS_SRNO AS APV_SRNO,
                                 APVR_ID,
                                 APVR_NM AS APVR_NM,
                                 TO_CHAR(APV_DH, 'YYYY-MM-DD') AS APV_DH
                            FROM TBDCMACM102L D2
                           WHERE 1=1
                             AND ONR_APV_DVSN_CD <> '10' --(기안자 제외)
                             AND NVL(ONR_APV_RSLT_CD,'hh') <>'50'
                           ORDER BY APV_RQS_ID,APV_SRNO
                         ) DH1
                  ) B
             WHERE A.AUD_YR = #{audYr}
              AND A.AUD_NO = #{audNo}
              AND A.AUD_STEP_CD = #{audStepCd}
              AND A.APV_RQS_ID = B.APV_RQS_ID
        ]]>
        <if test="audMainStepDsvnCd eq '70'.toString()">
                /* 감사위원회 부의 - 처리안 접수 심의 단계 : 주심위원설명자료, 처리안변경 검토보고서, 전부위임건 최종감사보고서 조회 */
                AND A.RPRT_CD IN ('A10700100','A10700400','A10600200','A10700110','A10700910')
                --AND SUBSTR(NVL(A.AUD_RPRT_DVSN_CD,'00'),2,1) != '1'
                AND A.REF_DY IS NULL
        </if>
        <if test="sbcnRegiReqDt != null and sbcnRegiReqDt != ''">
            AND A.REF_DY  = #{sbcnRegiReqDt}
        </if>
        <if test="rprtCd != null and rprtCd != ''">
            AND A.RPRT_CD  = #{rprtCd}
        </if>
        <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1040'.toString()">
            AND A.RPRT_CD NOT IN ('A10400300','A10400706')
        </if>
        <if test="enfDocYn != null and enfDocYn != '' and enfDocYn eq 'Y'.toString()">
            /* A10601200   수사요청서 시행문, A10601400   현지조치사항 시행문, A10601600   사실통보서 시행문, A10601800   수사참고자료 시행문 */
            AND A.RPRT_CD IN ('A10601200', 'A10601400', 'A10601600', 'A10601800')
        </if>
        ORDER BY A.SORT_SNO
        )
    </select>

    <select id="selectDocumentList2" parameterType="paramMap" resultType="egovMap" >
        /*kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectDocumentList2*/
        /*문서함(문서자체정보)*/
        <![CDATA[
          SELECT RPRT_NM
             , RPRT_CD
             , APV_STA_CD
             , APV_STA_NM
             , SORT_SNO
             , DECODE(CON_PGM_CD, '20', TEMPLATE_DOC_ID, DOC_ID) AS DOC_ID   /* 온나라결제인경우 TEMPLATE_DOC_ID 로 변경 */
             , DOC_ID                                            AS DOC_ID2  /* 삭제를 위한 DOC_ID */
             , APV_RQS_ID
             , APV_YN
             , CON_PGM_CD
             , NECES_YN
             , APV_WAY_CD
             , DOC_WRT_ID
             , AUD_RPRT_DVSN_CD
             , RLTN_ORG_CD
             , F_ORG_INFO(MIN(RLTN_ORG_CD),'1') AS RLTN_ORG_NM
             , GRT_WRT_YN
             , (SELECT DECODE(MAX(AUD_DOC_CD), 'A10500200', MIN(DTIL_AUD_DOC_NM), MAX(DTIL_AUD_DOC_NM)) FROM TBFDMADM002M WHERE AUD_DOC_CD = RPRT_CD) AS RPRT_KND_NM
             , DECODE((SELECT COUNT(1) FROM TBDCMACM023H ST1 WHERE ST1.APV_DOC_NO = APV_RQS_ID), 0, 'N', 'Y') AS EXISTS_APV_HIS_YN
             , FNL_BAI_RPRT_APV_YN
             , EDITOR_WRK_APPL_YN 
             , AUD_EXEC_HNDL_YN
             , REF_ID
             , REF_DY
             , TEMPLATE_DOC_ID
             , SYT_TRTM_DVSN_YN
             , DOC_TYPE
             , OPIN_WRK_APPL_YN
             , EDT_RQS_SRNO              /* BEST20 일련번호 */
             , EDT_RQS_APV_RQS_ID      /* BEST20 결재요청ID */
             , EDT_RQS_APV_STA_CD      /* BEST20 편집요청상태코드 */
             , EDT_RQS_APV_STA_NM      /* BEST20 편집요청상태명 */
             , EDT_RQR_ID              /* BEST20 요청자 */
             , EDT_ALLOW_DM            /* BEST20 편집허용일자 */
             , EDT_ALLOW_DH            /* BEST20 편집허용일시 */
             , (CASE WHEN EDT_ALLOW_DM IS NULL OR NVL(EDT_CMPT_YN,'N') = 'Y'                  THEN 'N' 
                       WHEN SYSDATE <= TO_DATE(EDT_ALLOW_DM||EDT_ALLOW_DH,'yyyyMMddhh24mi') THEN 'Y' ELSE 'N' END) AS EDT_YN /* BEST20 편집가능여부 */
             , (CASE WHEN EDT_ALLOW_DM IS NOT NULL THEN TO_CHAR(TO_DATE(EDT_ALLOW_DM||EDT_ALLOW_DH,'yyyyMMddhh24mi'),'yyyy-MM-dd hh24:mi') ELSE '' END) AS EDT_ALLOW_DT /* BEST20 편집허용기간 */
             , BRUCHF_APV_YN /* BEST20 차장결재 여부 */
       	  FROM (
	          SELECT
	              CASE WHEN A.RPRT_CD = 'A10700500'     /*부의안 요약 + 부의안 한줄로 처리 */
	                    THEN  A.RPRT_NM ||'<br>'|| (SELECT RPRT_NM
	                                        FROM TBBADDED103M ST1
	                                        WHERE ST1.AUD_YR = A.AUD_YR
	                                        AND ST1.AUD_NO = A.AUD_NO
	                                        AND ST1.AUD_STEP_CD = A.AUD_STEP_CD
	                                        AND ST1.AUD_KND_CD = A.AUD_KND_CD
	                                        AND ST1.REF_DY  = A.REF_DY
                                            AND ST1.REF_DOC_ID = A.REF_DOC_ID
                                            AND ST1.REF_ID = A.DOC_ID
	                                        AND ST1.RPRT_CD = 'A10700600')
                        WHEN A.RPRT_CD = 'A10700200'     /*소위원회 심의안, 소위원회 심의안 요약 */
	                    THEN  A.RPRT_NM ||'<br>'|| (SELECT RPRT_NM
	                                        FROM TBBADDED103M ST1
	                                        WHERE ST1.AUD_YR = A.AUD_YR
	                                        AND ST1.AUD_NO = A.AUD_NO
	                                        AND ST1.AUD_STEP_CD = A.AUD_STEP_CD
	                                        AND ST1.AUD_KND_CD = A.AUD_KND_CD
	                                        AND ST1.RPRT_CD = 'A10700210'
                                            AND ST1.REF_DOC_ID = A.DOC_ID)
	                    ELSE A.RPRT_NM
	               END AS RPRT_NM ,       /*보고서명 */
	               A.RPRT_CD ,       /*보고서코드*/
	               A.APV_STA_CD,    /*결재상태코드 */
	               F_CODE_NM('1000773',A.APV_STA_CD) AS APV_STA_NM ,    /*결재상태코드 */
	               A.SORT_SNO ,      /*보고서순번  */
	               A.DOC_ID,         /*결재문서번호 */
	               A.APV_RQS_ID,      /*결재ID*/
	               CASE WHEN A.RPRT_CD IN ('A10600200','A10600410','A10700500','A10700600','A10700200','A10700900')
	                   THEN DECODE(1, (
	                                  SELECT 1
	                                    FROM DUAL
	                                   WHERE EXISTS (
	                                                SELECT 1
	                                                  FROM TBBADDED111M B
	                                                 WHERE A.AUD_YR = B.AUD_YR
	                                                   AND A.AUD_NO = B.AUD_NO
	                                                   AND A.AUD_STEP_CD = B.AUD_STEP_CD
	                                                   AND A.DOC_ID = B.DOC_ID
	                                                )
	                                  ), 'N', 'Y')
	                   WHEN A.RPRT_CD = 'A10600900' THEN (
                                                          SELECT DECODE(COUNT(DOC_ID), '2', 'N', '1', 'P' ,'Y')
                                                            FROM TBBADDED111M B
                                                           WHERE A.AUD_YR = B.AUD_YR
                                                             AND A.AUD_NO = B.AUD_NO
                                                             AND A.AUD_STEP_CD = B.AUD_STEP_CD
                                                             AND A.RPRT_CD = B.RPRT_CD
                                                             AND A.REF_ID = B.REF_ID
                                                             AND A.REF_DY = B.REF_DY
                                                             AND A.DOC_ID = B.DOC_ID
                                                          )
                          WHEN A.RPRT_CD = 'A10600960' THEN (
                                                          SELECT DECODE(COUNT(DOC_ID), '1', 'N'  ,'Y')
                                                            FROM TBBADDED111M B
                                                           WHERE A.AUD_YR = B.AUD_YR
                                                             AND A.AUD_NO = B.AUD_NO
                                                             AND A.AUD_STEP_CD = B.AUD_STEP_CD
                                                             AND A.RPRT_CD = B.RPRT_CD
                                                             AND A.REF_ID = B.REF_ID
                                                             AND A.REF_DY = B.REF_DY
                                                             AND A.DOC_ID =B.DOC_ID
                                                          )
	                   ELSE 'N'
	               END AS APV_YN ,           /*결재여부 */
	               CON_PGM_CD    /*연계프로그램코드*/
	                  /*필수여부*/
	                  ,A.NECES_YN
	                  ,A.APV_WAY_CD /*결재방법코드*/
	                  , A.DOC_WRT_ID
	               ,A.AUD_RPRT_DVSN_CD
	               ,A.RLTN_ORG_CD
	               ,(
	                 SELECT CASE WHEN (
                                    CASE WHEN COUNT(T1.DOC_ID) <> 0 
                                         THEN DECODE(COUNT(T1.DOC_ID), SUM(DECODE(T2.REFLECT_YN, 'Y', 1, 'N', 1, 'PY', 1, 0)), 'Y', 'N' )
                                         ELSE 'N'
                                    END ) = 'Y'
                                THEN MAX((
                                      SELECT DECODE(COUNT(1), 0, 'Y', 'D')
                                        FROM TBBADDED103M T3
                                       WHERE T3.AUD_YR = T1.AUD_YR
                                         AND T3.AUD_NO = T1.AUD_NO
                                         AND T3.RPRT_CD = 'A10600410'
                                         AND T3.REF_ID = T1.DOC_ID
                                     ))
                                ELSE 'N'
                           END AS GRT_WRT_YN
                       FROM TBBADDED145M T1
                       LEFT OUTER JOIN TBBADDED118M T2 ON (
		                        T1.AUD_YR = T2.AUD_YR
		                    AND T1.AUD_NO = T2.AUD_NO
		                    AND T1.AUD_STEP_CD = T2.AUD_STEP_CD
		                    AND T1.DOC_ID = T2.DOC_ID 
		                    AND T1.AFF_SNO = T2.AFF_SNO )
		              WHERE T1.APVR_CD = '0013600'
		                AND T1.AUD_YR = A.AUD_YR
		                AND T1.AUD_NO = A.AUD_NO
		                AND T1.DOC_ID = A.DOC_ID
	                ) AS GRT_WRT_YN
                    , (SELECT DECODE(MAX(APV_STA_CD),'30','Y','N') 
                         FROM TBBADDED103M ST1
                        WHERE ST1.AUD_YR = A.AUD_YR
                          AND ST1.AUD_NO = A.AUD_NO
                          AND ST1.RPRT_CD = 'A10600200'
                          AND ST1.FNL_BAI_RPRT_YN = 'Y'
                          AND ST1.AUD_RPRT_DVSN_CD = '11') AS FNL_BAI_RPRT_APV_YN
                    , EDITOR_WRK_APPL_YN 
                    , (SELECT DECODE(ST.AUD_EXEC_HNDL_STA_CD,'9','Y','N') FROM TBBADDED003M ST WHERE ST.AUD_YR = A.AUD_YR AND ST.AUD_NO = A.AUD_NO) AS AUD_EXEC_HNDL_YN
                    , A.REF_ID
                    , A.REF_DY
                    , A.LINK_URL
                    , A.TEMPLATE_DOC_ID
                    , A.SYT_TRTM_DVSN_YN
                    , F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE
                    , CASE WHEN (SELECT ST.SND_DH 
                                   FROM TBBADDED111M ST 
                                  WHERE ST.AUD_YR = A.AUD_YR 
                                    AND ST.AUD_NO = A.AUD_NO 
                                    AND ST.AUD_STEP_CD = A.AUD_STEP_CD 
                                    AND ST.DOC_ID = A.DOC_ID)
                                 >= 
                                 (SELECT ST.USR_DFN_TXT_1 FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000915' AND ST.CD = '10')
                           THEN NVL(A.OPIN_WRK_APPL_YN, 'N')
                           WHEN (SELECT ST.SND_DH 
                                   FROM TBBADDED111M ST 
                                  WHERE ST.AUD_YR = A.AUD_YR 
                                    AND ST.AUD_NO = A.AUD_NO 
                                    AND ST.AUD_STEP_CD = A.AUD_STEP_CD 
                                    AND ST.DOC_ID = A.DOC_ID) IS NULL
                           THEN 'P'
                           ELSE '' END AS OPIN_WRK_APPL_YN
                    , B.SRNO             AS EDT_RQS_SRNO          /* BEST20 일련번호 */
                    , B.APV_RQS_ID     AS EDT_RQS_APV_RQS_ID  /* BEST20 결재요청ID */
                    , B.APV_STA_CD     AS EDT_RQS_APV_STA_CD  /* BEST20 편집요청상태코드 */
                    , F_CODE_NM('1000956',B.APV_STA_CD) AS EDT_RQS_APV_STA_NM  /* BEST20 편집요청상태명 */
                    , B.RQR_ID         AS EDT_RQR_ID          /* BEST20 요청자 */
                    , B.EDT_ALLOW_DM                          /* BEST20 편집허용일자 */
                    , B.EDT_ALLOW_DH                          /* BEST20 편집허용일시 */
                    , B.CMPT_YN       AS EDT_CMPT_YN     /* BEST20 문서편집요청 완료여부*/
                    , (SELECT NVL(MAX(CASE WHEN F.USR_DFN_TXT_2 IN ('0055600','0055700','0010600','0067400') --차장 또는 본부장급 이상
	                            THEN 'Y' 
	                            ELSE 'N' END), 'N') AS BRUCHF_APV_YN
			          FROM TBBADDED103M C 
			    INNER JOIN TBDCMACM023L D ON C.APV_RQS_ID = D.APV_DOC_NO
			    INNER JOIN TBDCMACM001M E ON E.CNB = D.APVR_CNB
			LEFT OUTER JOIN TBDCMACM013C F ON F.CMM_CD_DVSN_CD = '1000855' AND F.CD = E.INN_RANK_CD
			         WHERE D.APV_SNO <> 1
			           AND C.RPRT_CD = 'A10600200'
			           AND D.APVR_STA_CD IN ('202','203','204')
			           --AND D.APVR_CNB = cnb
			           AND C.DOC_ID = A.DOC_ID
			           AND D.APV_SNO = (SELECT MAX(T2.APV_SNO) 
			                             FROM TBBADDED103M T1 
			                       INNER JOIN TBDCMACM023L T2 ON T1.APV_RQS_ID = T2.APV_DOC_NO
			                            WHERE T2.APV_SNO <> 1
			                              AND T1.RPRT_CD = 'A10600200'
			                              AND T2.APVR_STA_CD IN ('202','203','204')
			                            --AND D.APVR_CNB = cnb
			                              AND T1.DOC_ID = A.DOC_ID) ) AS BRUCHF_APV_YN /* BEST20 차장 결재 여부 */ 
	           FROM TBBADDED103M AS A
	          LEFT OUTER JOIN
                    TBBADDED149M B
                 ON B.AUD_YR = A.AUD_YR
                AND B.AUD_NO = A.AUD_NO
                AND B.AUD_STEP_CD = A.AUD_STEP_CD
                AND B.DOC_ID = A.DOC_ID
                AND B.SRNO = (SELECT MAX(AA.SRNO)
                                FROM TBBADDED149M AA
                               WHERE AA.AUD_YR = B.AUD_YR
                                 AND AA.AUD_NO = B.AUD_NO
                                 AND AA.AUD_STEP_CD = B.AUD_STEP_CD
                                 AND AA.DOC_ID = B.DOC_ID)
	          WHERE A.AUD_YR = #{audYr}
	            AND A.AUD_NO = #{audNo}
	            AND A.AUD_STEP_CD = #{audStepCd}
	            AND A.AUD_KND_CD = #{audKndCd}
           	]]>
	        <if test="audMainStepDsvnCd eq '70'.toString()">
                /* 감사위원회 부의 - 처리안 접수 심의 단계 : 주심위원설명자료, 처리안변경 검토보고서 조회 OR 전부위임건인 최종감사보고서 */
                AND ((A.RPRT_CD IN ('A10700100','A10700400','A10700110','A10700910') AND SUBSTR(NVL(A.AUD_RPRT_DVSN_CD,'00'),2,1) != '1')
                        OR (SUBSTR(NVL(A.AUD_RPRT_DVSN_CD,'00'),2,1) = '1' AND (SELECT COUNT(1) 
                                                                                                                            FROM TBBADDED145M ST1
                                                                                                                           WHERE ST1.AUD_YR = A.AUD_YR
                                                                                                                             AND ST1.AUD_NO = A.AUD_NO
                                                                                                                             AND ST1.DOC_ID = A.REF_ID
                                                                                                                             AND ST1.FNL_YN ='Y'
                                                                                                                             AND ST1.REFER_DVSN_CD = 'D10') = 0))
	        </if>
            <if test="audMainStepDsvnCd != null and audMainStepDsvnCd != '' and audMainStepDsvnCd eq '71'.toString()">
                /* 감사위원회 부의 - 소위원회 단계 : 소위원회 심의안 조회 */
                AND A.RPRT_CD IN ('A10700200','A10700220','A10700230')
                AND A.RPRT_CD NOT IN ('A10700210') /*소위원회 심의안 요약 + 소위원회 심의안 한줄로 처리*/
                AND A.REF_ID = #{refId}
                AND A.REF_DY = #{refDy}
            </if>
	        <if test="sbcnRegiReqDt != null and sbcnRegiReqDt != ''">
	            AND A.REF_DY  = #{sbcnRegiReqDt}
                AND A.REF_DOC_ID = #{refDocId}
	            AND A.RPRT_CD NOT IN ('A10700600')  /*부의안 요약 + 부의안 한줄로 처리 */
	        </if>
	        <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1060'.toString() and enfDocYn neq 'Y'.toString()">
	        	<![CDATA[
	            AND A.RPRT_CD NOT IN ('A10600100', 'A10600500', 'A10600510', 'A10600520', 'A10600530', 'A10600540', 'A10601200', 'A10601400', 'A10601600'
	                                , 'A10601800', 'A10601100', 'A10601300','A10601320','A10601330','A10601340', 'A10601500', 'A10601700'
	                                , 'A10602100', 'A10602200', 'A10602300', 'A10602310', 'A10602400'
	                                , 'A10600910', 'A10600920', 'A10600930', 'A10600940', 'A10600950', 'A10600810','A10609030','A10609040','A10609050'
	            ]]>
	                                , 'A10600900', 'A10600960', 'A10700900', 'A10610100', 'A10610200', 'A10610210', 'A10610300' ) /*소명자료 검토보고서 , 적극행정면책 검토보고서, 권익보호관용 처리안, 포렌식 관련문서*/
	        </if>
	        <if test="rprtCd != null and rprtCd != ''">
	            AND A.RPRT_CD  = #{rprtCd}
	        </if>
	        <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1040'.toString()">
	            AND A.RPRT_CD NOT IN ('A10400300','A10400706')
	        </if>
            <if test="enfDocYn != null and enfDocYn != '' and enfDocYn eq 'Y'.toString()">
            /* A10601200   수사요청서 시행문, A10601400   현지조치사항 시행문, A10601600   사실통보서 시행문, A10601800   수사참고자료 시행문 */
            AND A.RPRT_CD IN ('A10601200', 'A10601400', 'A10601600', 'A10601800')
            </if>
        )
         GROUP BY RPRT_NM, RPRT_CD, APV_STA_CD, APV_STA_NM, SORT_SNO, DOC_ID, APV_RQS_ID, APV_YN, CON_PGM_CD, NECES_YN, APV_WAY_CD
             , DOC_WRT_ID, AUD_RPRT_DVSN_CD, RLTN_ORG_CD, GRT_WRT_YN, FNL_BAI_RPRT_APV_YN, EDITOR_WRK_APPL_YN, AUD_EXEC_HNDL_YN, REF_ID, REF_DY , LINK_URL, TEMPLATE_DOC_ID, SYT_TRTM_DVSN_YN, DOC_TYPE, OPIN_WRK_APPL_YN
             , EDT_RQS_SRNO, EDT_RQS_APV_RQS_ID, EDT_RQS_APV_STA_CD, EDT_RQS_APV_STA_NM, EDT_RQR_ID, EDT_ALLOW_DM, EDT_ALLOW_DH, EDT_CMPT_YN, BRUCHF_APV_YN
         ORDER BY SORT_SNO
    </select>

    <select id="selectAepPrcsList" parameterType="paramMap" resultType="egovMap" >
            /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectAepPrcsList*/
            /*감사사항별 단계 sql*/
            SELECT A.AUD_YR        /* 감사년도 */
                  ,A.AUD_NO        /* 감사연번 */
                  ,A.AUD_GRN_NO    /* 감사부여코드(감사실연번)*/
                  ,A.AUD_STEP_CD   /* 단계 코드 */
                  ,A.AUD_STEP_NM   /* 단계명 */
                  ,A.STEP_CMPT_YN  /* 단계완료상태 : NULL:미진행, P:진행 Y:완료 */
                <if test='audStepCd != null and audStepCd != ""'>
                  ,TO_CHAR(TO_DATE(A.CMPT_CLSNG_DY, 'YYYY-MM-DD'), 'YYYY-MM-DD') CMPT_CLSNG_DY  /*완료기한일자 */
                  ,A.TSK_DESC       /*업무설명 */
                </if>
                  ,A.LINK_URL       /* 링크주소 */
                  ,A.NECES_YN       /* 필수 여부 */
             FROM TBBADDED101M A
              WHERE 1=1
                <if test='audYr != null and audYr != ""'>
                    AND A.AUD_YR = #{audYr} /* PARAM : 감사년도 */
                </if>
                <if test='audNo != null and audNo != ""'>
                    AND A.AUD_NO = #{audNo}/* PARAM : 감사연번(내부  pk 번호) */
                </if>
                <if test='audKndCd != null and audKndCd != ""'>
                    AND A.AUD_KND_CD = #{audKndCd}
                    /* PARAM : 감사종류코드 실지감사일 경우  A10, 확인출장(감사종류 코드 165)일 경우  B10 */
                </if>
                <if test='audStepCd != null and audStepCd != ""'>
                    AND A.AUD_STEP_CD = #{audStepCd} /* PARAM : 감사단계코드  */
                </if>
                <![CDATA[
                AND AUD_STEP_CD <> 'A1000'/*감사계획관리 제외*/
            ORDER BY AUD_STEP_CD ASC
            ]]>
    </select>

    <select id="selectMainTskPrcsList" parameterType="paramMap" resultType="egovMap" >
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectMainTskPrcsList */
        /*실지감사 주요업무 프로세스 sql*/
        SELECT A.AUD_MAIN_STEP_ID  /*주요업무코드*/
             , A.AUD_STEP_CD /*감사단계코드*/
             , A.AUD_MAIN_STEP_SNO  /*주요업무순번 */
             , A.AUD_MAIN_SEQ_W /*주요업무순서_가로 */
             , A.AUD_MAIN_SEQ_H /*주요업무순서_세로 */
             , A.CMPT_YN /*완료여부*/
             , A.AUD_GRN_NO  /*감사부여번호*/
             , A.AUD_DOC_CD /*문서ID*/
             , TRIM(A.MAIN_JOB_NM) AS MAIN_JOB_NM /*주요업무명*/
             , TRIM(A.LINK_TYPE) AS LINK_TYPE/*링크유형*/
             , DECODE(TRIM(A.LINK_TYPE), 'NAN', ''
                                 , 'POP', A.LINK_URL
                                 , 'FNC', A.LINK_URL
                                 , (SELECT DOC_ID
                                      FROM TBFDMADM002M B
                                    WHERE A.AUD_DOC_CD = B.AUD_DOC_CD
                                       AND B.DOC_KND_CD = DECODE(A.LINK_TYPE, 'DOC', '10', '20')
                                       AND NVL(AUD_RPRT_TYPE_CD, SUBSTR(A.AUD_KND_CD, 3, 3)) = SUBSTR(A.AUD_KND_CD, 3, 3)
                                   <if test='audStepCd == "A1050"'>
                                       AND (
                                                -- 종료보고서의 경우 공익/국민감사사항 템플릿ID 분리, 나머지의 경우 동일한 템플릿ID 가져옴 
                                                (B.AUD_DOC_CD = 'A10500200' AND B.DTIL_AUD_DOC_NO = (SELECT CASE WHEN T1.REQ_DVSN_CD IN ('2', '3') THEN '394' ELSE '163' END
                                                                                                                                                  FROM TBBADDED001M T1
                                                                                                                                                 WHERE T1.AUD_YR = #{audYr}
                                                                                                                                                   AND T1.AUD_NO = #{audNo}))
                                                OR B.AUD_DOC_CD != 'A10500200'
                                               )
                                   </if>
                                   )
                     ) AS LINK_URL /*링크주소*/
                     ,F_OPEN_EDIT(LINK_URL) AS DOC_TYPE
          FROM TBBADDED102M A
         WHERE 1=1
        <if test='audYr != null and audYr != ""'>
           AND A.AUD_YR = #{audYr} /* PARAM : 감사년도 */
        </if>
        <if test='audNo != null and audNo != ""'>
           AND A.AUD_NO = #{audNo}/* PARAM : 감사연번(내부  pk 번호) */
        </if>
        <if test='audKndCd != null and audKndCd != ""'>
           AND A.AUD_KND_CD = #{audKndCd}
        </if>
        <if test='audStepCd != null and audStepCd != ""'>
           AND A.AUD_STEP_CD = #{audStepCd} /* PARAM : 감사단계코드  */
        </if>
        <if test='audStepCd == "A1060" and docType == "hancom"'>
           <if test='audMainStepSno != null and audMainStepSno != ""'>
           AND A.AUD_MAIN_STEP_SNO = #{audMainStepSno}
           </if>
        </if>
        <if test='audStepCd == "A1080"'>
	        <if test='audMainStepDsvnCd != null and audMainStepDsvnCd != ""'>
	           AND SUBSTR(A.AUD_MAIN_STEP_ID,0,2) = #{audMainStepDsvnCd} /* PARAM : 주요업무구분코드(AUD_MAIN_STEP_ID 앞 2자리) */
	        </if> 
	    </if>  
        <if test='bztBgtDvsnCdYN !="3" and audYrNoKndCd != "5" '>
        <![CDATA[
           AND A.AUD_MAIN_STEP_ID <> '100601'  /*2018.07.17 CJLEE 차장배정일때만 결정회의 보여줌*/
         ]]> 
        </if>
         ORDER BY A.AUD_MAIN_STEP_SNO, A.AUD_MAIN_SEQ_W ASC
    </select>

    <update id="updateStepCmpt" parameterType="paramMap">
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.updateStepCmpt*/
        UPDATE TBBADDED101M
            SET
            FNL_MDF_DH = SYSDATE
            ,STEP_CMPT_YN = #{stepCmptYn}
            <if test='stepCmptYn == "Y"'>
                ,STEP_CMPT_DH = SYSDATE
            </if>
            ,FNL_USR_ID = #{fnlUsrId}
            ,FNL_DEAL_DPT_CD =#{fnlDealDptCd}
            WHERE 1=1
            AND AUD_YR = #{audYr}
            AND AUD_NO = #{audNo}
            AND AUD_STEP_CD = #{audStepCd}
    </update>

    <update id="updateCmptYn" parameterType="paramMap">
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.updateCmptYn*/
        UPDATE Tbbadded102M
            SET
            FNL_MDF_DH = SYSDATE
            ,CMPT_YN  = #{cmptYn}
            ,FNL_USR_ID = #{fnlUsrId}
            ,FNL_DEAL_DPT_CD =#{fnlDealDptCd}
            WHERE 1=1
            AND AUD_YR = #{audYr}
            AND AUD_NO = #{audNo}
            AND AUD_STEP_CD = #{audStepCd}
            AND AUD_MAIN_STEP_ID  = #{audMainStepId}
            <if test='audMainStepSno != null and audMainStepSno != "" and rprtCd != "A10700100" and rprtCd != "A10700400" and rprtCd != "A10700200" '>
            AND AUD_MAIN_STEP_SNO   = #{audMainStepSno}
            </if>
            <if test='rprtCd == "A10700100" or rprtCd == "A10700400"'>
            /* 주심위원설명자료의 경우 부의사항처리부 상세 순번 = 주요업무프로세스 순번*/
            AND AUD_MAIN_STEP_SNO   = (SELECT SBCN_TRTM_DTL_SNO
                                                                FROM TBBADDED112D
                                                               WHERE AUD_YR =  #{audYr}
                                                                  AND AUD_NO =  #{audNo}
                                                                  AND DOC_ID = (SELECT REF_ID FROM TBBADDED103M WHERE DOC_ID = #{docId}))
            </if>
            <if test='rprtCd == "A10700200" '>
            /* 소위원회 심의안 114M테이블 AUD_MAIN_STEP_SNO = 주요업무프로세스 순번 */
            AND AUD_MAIN_STEP_SNO   = (SELECT AUD_MAIN_STEP_SNO
                                                                      FROM TBBADDED114M 
                                                                     WHERE AUD_YR = #{audYr}
                                                                       AND AUD_NO = #{audNo}
                                                                       AND AFF_SNO = (SELECT REF_ID FROM TBBADDED103M WHERE DOC_ID = #{docId})
                                                                       AND SBMT_SEQ = (SELECT REF_DY FROM TBBADDED103M WHERE DOC_ID = #{docId}))
            </if>
    </update>

    <select id="selectEctDocList" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectEctDocList*/
        /*실지감사 기타문서함 sql*/
        SELECT D1.TSK_KND_CD,
        	   F_CODE_NM('1000787', D1.TSK_KND_CD) AS TSK_KND_NM,
        	   D1.AUD_STEP_CD,
        	   F_CODE_NM('1000785', D1.AUD_STEP_CD) AS AUD_STEP_NM,
        	   D1.AUD_DOC_CD,
        	   --F_CODE_NM('1000786', D1.AUD_DOC_CD) AS AUD_DOC_NM,
        	   D2.DTIL_AUD_DOC_NO,
        	   D2.DTIL_AUD_DOC_NM,
        	   DOC_ID,
               CON_PGM_CD
          FROM TBFDMADM001M D1, TBFDMADM002M D2
         WHERE D1.AUD_DOC_CD = D2.AUD_DOC_CD(+)
           AND D2.HIDDEN_YN = 'N'
           AND D1.APV_WAY_CD <> '40'	  --현장징구 문서는 검색제외
           AND D1.TSK_KND_CD = 'A10'	  --실지감사
           AND D2.DOC_KND_CD <> '30'      --첨부문서는 검색제외
           AND (D1.AUD_STEP_CD = #{audStepCd} OR D1.AUD_STEP_CD ='A1095')
           AND D1.AUD_DOC_CD NOT IN ('A10600400','A10600500', 'A10601000', 'A10601300','A10601320','A10601330','A10601340', 'A10700600', 'A10600510', 'A10600520', 'A10600530', 'A10600540', 'A10610100', 'A10610200', 'A10610210', 'A10610300')
           ]]>
           <if test='dtilAudDocNm != null and dtilAudDocNm != ""'>
              AND D2.DTIL_AUD_DOC_NM like '%'||#{dtilAudDocNm}||'%'/* 문서명 */
           </if>
           AND NOT EXISTS (
                           SELECT 1
                             FROM TBBADDED102B D3
                            WHERE D3.AUD_STEP_CD = D1.AUD_STEP_CD
                              AND AUD_DOC_CD IS NOT NULL
                              AND D2.AUD_DOC_CD = D3.AUD_DOC_CD
                          )
           ORDER BY D1.AUD_STEP_CD, D2.DTIL_AUD_DOC_NO
    </select>




    <select id="selectAudStrDtChk" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        /*kr.go.bai.eip.bad.ded.dao.BADDED001EMapper.selectAudStrDtChk*/
        SELECT NVL(MIN(D1.AUD_STR_DT), '99991231') AS AUD_STR_DT /*실시시작일*/
          FROM TBBADDED002M AS D1
         INNER JOIN TBBADDED001M AS D2
            ON D1.REL_AUD_YR = D2.AUD_YR
           AND D1.REL_AUD_NO = D2.AUD_NO
          LEFT OUTER JOIN (SELECT BZT_YR
                                , BZT_SNO
                                , SUM(CASE WHEN A.STF_DVSN_CD = '0' THEN 1 ELSE 0 END) AS IN_PSON_CNT /*내부인원*/
                                , SUM(CASE WHEN A.STF_DVSN_CD = '0' THEN 0 ELSE 1 END) AS EXT_PSON_CNT /*외부인원*/
                             FROM (SELECT DISTINCT BZT_YR
                                        , BZT_SNO
                                        , PCT_CNB
                                        , STF_DVSN_CD
                                     FROM TBBADDED005L) AS A
                             GROUP BY BZT_YR, BZT_SNO ) AS D3
            ON D1.BZT_YR = D3.BZT_YR
           AND D1.BZT_SNO = D3.BZT_SNO
         WHERE D2.AUD_YR = #{audYr}
           AND D2.AUD_NO = #{audNo}
           AND D1.BZT_DVSN_CD = '1'
            ]]>
            <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1010'.toString()">
                AND D1.AUD_BZT_KND_CD IN ('00','15') /*서면감사인 경우 확인출장(15)*/
                OR (D1.REL_AUD_YR, D1.REL_AUD_NO) IN (SELECT REL_AUD_YR, REL_AUD_NO FROM TBBADDED101L WHERE AUD_YR = #{audYr} AND AUD_NO = #{audNo})
            </if>
            <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1020'.toString()">
                AND D1.AUD_BZT_KND_CD = '01'
            </if>
            <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1030'.toString()">
                AND D1.AUD_BZT_KND_CD IN ('02','03')
            </if>
            <if test="audStepCd != null and audStepCd != '' and audStepCd eq 'A1040'.toString()">
                AND D1.AUD_BZT_KND_CD IN ('02','03')
            </if>
    </select>

    <select id="selectFileDocId" parameterType="paramMap" resultType="String">
     	/*kr.go.bai.eip.bad.ded.dao.BADDED001EMapper.selectFileDocId*/
		SELECT DOC_ID AS docId
	      FROM TBFDMADM002M
		 WHERE AUD_DOC_CD = #{audDocCd}
		   AND DOC_KND_CD = #{docKndCd}
           <if test='tmpDocId != null and tmpDocId != ""'>
           AND DOC_ID = #{tmpDocId}
           </if>
           <if test='dtilAudDocNo != null and dtilAudDocNo != ""'>
           AND DTIL_AUD_DOC_NO = #{dtilAudDocNo}
           </if>
	</select>
	
	<select id="selectAttachFileDocId" parameterType="paramMap" resultType="egovMap">
     	/*kr.go.bai.eip.bad.ded.dao.BADDED001EMapper.selectAttachFileDocId*/
		SELECT DOC_ID AS docId
	      FROM TBFDMADM002M
		 WHERE AUD_DOC_CD = #{audDocCd}
		   AND DOC_KND_CD = #{docKndCd}
           <if test='tmpDocId != null and tmpDocId != ""'>
           AND DOC_ID = #{tmpDocId}
           </if>
           <if test='dtilAudDocNo != null and dtilAudDocNo != ""'>
           AND DTIL_AUD_DOC_NO = #{dtilAudDocNo}
           </if>
	</select>

    <update id="updatePrssStepCd" parameterType="paramMap">
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.updatePrssStepCd*/
        UPDATE TBBADDED001M
            SET
            FNL_MDF_DH = SYSDATE
            ,PRSS_STEP_CD  = #{audStepCd}
            ,FNL_USR_ID = #{fnlUsrId}
            ,FNL_DEAL_DPT_CD =#{fnlDealDptCd}
            WHERE AUD_YR = #{audYr}
            AND AUD_NO = #{audNo}
    </update>

    <update id="deleteDoc" parameterType="paramMap">
    /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.deleteDoc*/
    DECLARE
         BEGIN
            DELETE FROM TBBADDED103M
            WHERE
                AUD_YR  = #{audYr}
            AND AUD_NO  =#{audNo}
            AND AUD_STEP_CD  = #{audStepCd}
            AND DOC_ID  = #{docId};
            <if test='rprtCd == "A10700200" '>
            /* 소위원회 심의안 삭제 시 소위원회 심의안 요약도 같이 삭제 */
            DELETE FROM TBBADDED103M
            WHERE
                AUD_YR  = #{audYr}
            AND AUD_NO  =#{audNo}
            AND AUD_STEP_CD  = #{audStepCd}
            AND REF_DOC_ID  = #{docId};
            </if>
        END;
    </update>

    <update id="deleteDocApvData" parameterType="paramMap">
    /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.deleteDocApvData*/
    DECLARE
         BEGIN
            DELETE 
              FROM PTL_ORDER_NOTI
              WHERE seq in (SELECT SEQ
                          FROM PTL_ORDER_LIST
                         WHERE DOC_No  = #{apvRqsId}) 
            ;
            DELETE
              FROM PTL_ORDER_RECEIVE_LIST
             WHERE seq in (SELECT SEQ
                          FROM PTL_ORDER_LIST
                         WHERE DOC_No  = #{apvRqsId})
            ;
            DELETE
              from PTL_ORDER_LIST
             where seq in (SELECT SEQ
            			  FROM PTL_ORDER_LIST
            			 WHERE DOC_No  = #{apvRqsId})
            ;
            delete
              FROM TBBADDED109M A
             WHERE A.APV_RQS_ID = #{apvRqsId}
            ;
            delete
              from TBDCMACM023H
             where apv_doc_no = #{apvRqsId}
             and apv_dvsn_cd = 'fieldAudit'
             ; 
            delete
              from TBDCMACM022H
             where apv_doc_no = #{apvRqsId}
            and apv_dvsn_cd = 'fieldAudit'
             ;
            delete
              from TBDCMACM023L
             where apv_doc_no = #{apvRqsId}
             ;
            delete
              from TBDCMACM022L
             where apv_doc_no = #{apvRqsId}
             ;
         END;
    </update>

    <update id="deleteSbcnDoc" parameterType="paramMap">
    /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.deleteSbcnDoc*/
        DELETE FROM TBBADDED103M T1
        WHERE
                T1.AUD_YR = #{audYr}
           AND T1.AUD_NO = #{audNo}
           AND T1.AUD_STEP_CD = #{audStepCd}
           AND (T1.DOC_ID = #{docId} OR T1.REF_ID = #{docId})
           AND RPRT_CD IN ('A10700500','A10700600')
    </update>

    <update id="deleteReivewDoc" parameterType="paramMap">
    /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.deleteReivewDoc*/
        UPDATE TBBADDED118M
           SET REVIEW_DOC_ID = ''
              ,AFF_EST = ''
              ,HND_COU = ''
              ,LOG_SYS = ''
              ,REFER_ENT = ''
              ,DTL_OPIN = ''
              ,REFLECT_YN = ''
        WHERE
            AUD_YR  = #{audYr}
        AND AUD_NO  =#{audNo}
        AND AUD_STEP_CD  = #{audStepCd}
        AND DOC_ID  = #{rprtDocId}
        AND REVIEW_DOC_ID = #{docId}
        AND AFF_SNO = #{affSno}
    </update>

    <select id="selectAffCnt" parameterType="paramMap" resultType="egovMap">
        /*kr.go.bai.eip.bad.ded.dao.DCMACM001Mapper.selectAffCnt*/
        SELECT
            TO_CHAR((SELECT COUNT(1)
                FROM TBBADDED144M
              WHERE AUD_YR = #{audYr}
                   AND AUD_NO = #{audNo}
                   AND DOC_ID = #{docId})) AS EXPT_CNT,
            TO_CHAR((SELECT COUNT(1)
                FROM TBBADDED145M
              WHERE AUD_YR = #{audYr}
                   AND AUD_NO = #{audNo}
                   AND DOC_ID = #{docId})) AS AFF_CNT,
            TO_CHAR((SELECT COUNT(1)
                FROM TBBADDED146M
              WHERE AUD_YR = #{audYr}
                   AND AUD_NO = #{audNo}
                   AND DOC_ID = #{docId})) AS DSP_CNT,
            TO_CHAR((SELECT COUNT(1)
                FROM TBBADDED147M
              WHERE AUD_YR = #{audYr}
                   AND AUD_NO = #{audNo}
                   AND DOC_ID = #{docId})) AS MPP_CNT
        FROM DUAL
    </select>

    <select id="selectPrcsDocCmptYn" parameterType="paramMap" resultType="egovMap">
    /*kr.go.bai.eip.bad.ded.dao.DCMACM001Mapper.selectPrcsDocCmptYn*/
        SELECT COUNT(1) AS RPRT_CNT,
                NVL(MAX(
                   (SELECT CMPT_YN
                      FROM TBBADDED102M ST1
                     WHERE ST1.AUD_YR = T1.AUD_YR
                       AND ST1.AUD_NO = T1.AUD_NO
                       AND ST1.AUD_DOC_CD = T1.RPRT_CD
                       AND ST1.AUD_STEP_CD = T1.AUD_STEP_CD
                       <if test='audMainStepSno != null and audMainStepSno != "" and rprtCd != "A10700100" and rprtCd != "A10700400" and rprtCd != "A10700200" '>
                        AND ST1.AUD_MAIN_STEP_SNO   = #{audMainStepSno}
                        </if>
                        <if test='rprtCd == "A10700100" or rprtCd == "A10700400"'>
                        /* 주심위원설명자료의 경우 부의사항처리부 상세 순번 = 주요업무프로세스 순번*/
                        AND ST1.AUD_MAIN_STEP_SNO   = (SELECT SBCN_TRTM_DTL_SNO
                                                                                    FROM TBBADDED112D
                                                                                   WHERE AUD_YR =  #{audYr}
                                                                                      AND AUD_NO =  #{audNo}
                                                                                      AND DOC_ID = (SELECT REF_ID FROM TBBADDED103M WHERE DOC_ID = #{docId}))
                        </if>
                        <if test='rprtCd == "A10700200" '>
                            /* 소위원회 심의안 114M테이블 AUD_MAIN_STEP_SNO = 주요업무프로세스 순번 */
                            AND ST1.AUD_MAIN_STEP_SNO   = (SELECT AUD_MAIN_STEP_SNO
                                                                                      FROM TBBADDED114M 
                                                                                     WHERE AUD_YR = #{audYr}
                                                                                       AND AUD_NO = #{audNo}
                                                                                       AND TO_CHAR(AFF_SNO) = (SELECT REF_ID FROM TBBADDED103M WHERE DOC_ID = #{docId})
                                                                                       AND TO_CHAR(SBMT_SEQ) = (SELECT REF_DY FROM TBBADDED103M WHERE DOC_ID = #{docId}))
                       </if>
                       )
                       ),'N') AS CMPT_YN,
                  NVL(MAX(
                       (SELECT AUD_MAIN_STEP_ID
                          FROM TBBADDED102M ST1
                         WHERE ST1.AUD_YR = T1.AUD_YR
                           AND ST1.AUD_NO = T1.AUD_NO
                           AND ST1.AUD_DOC_CD = T1.RPRT_CD
                           AND ST1.AUD_STEP_CD = T1.AUD_STEP_CD
                           <if test='audMainStepSno != null and audMainStepSno != "" and rprtCd != "A10700100" and rprtCd != "A10700400" and rprtCd != "A10700200" '>
                            AND ST1.AUD_MAIN_STEP_SNO   = #{audMainStepSno}
                            </if>
                            <if test='rprtCd == "A10700100" or rprtCd == "A10700400" '>
                            /* 주심위원설명자료, 처리안 변경 검토보고서의 경우 부의사항처리부 상세 순번 = 주요업무프로세스 순번*/
                            AND ST1.AUD_MAIN_STEP_SNO   = (SELECT SBCN_TRTM_DTL_SNO
                                                                                        FROM TBBADDED112D
                                                                                       WHERE AUD_YR =  #{audYr}
                                                                                          AND AUD_NO =  #{audNo}
                                                                                          AND DOC_ID = (SELECT REF_ID FROM TBBADDED103M WHERE DOC_ID = #{docId}))
                            </if>
                            <if test='rprtCd == "A10700200" '>
                            /* 소위원회 심의안 114M테이블 AUD_MAIN_STEP_SNO = 주요업무프로세스 순번*/
                            AND ST1.AUD_MAIN_STEP_SNO   = (SELECT AUD_MAIN_STEP_SNO
                                                                                      FROM TBBADDED114M 
                                                                                     WHERE AUD_YR = #{audYr}
                                                                                       AND AUD_NO = #{audNo}
                                                                                       AND TO_CHAR(AFF_SNO) = (SELECT REF_ID FROM TBBADDED103M WHERE DOC_ID = #{docId})
                                                                                       AND TO_CHAR(SBMT_SEQ) = (SELECT REF_DY FROM TBBADDED103M WHERE DOC_ID = #{docId}))
                            </if>
                            
                           )
                           ),'N') AS AUD_MAIN_STEP_ID
          FROM TBBADDED103M T1
         WHERE T1.AUD_YR = #{audYr}
           AND T1.AUD_NO = #{audNo}
           AND T1.RPRT_CD = #{rprtCd}
           AND T1.AUD_STEP_CD = #{audStepCd}
           <if test='refDy != null and refDy != "" and rprtCd != "A10700200"'>
            AND T1.REF_DY   = #{refDy}
            </if>
            <if test='refId != null and refId != "" and rprtCd != "A10700100" and rprtCd != "A10700400" and rprtCd != "A10700200"'>
            AND T1.REF_ID   = #{refId}
            </if>
            <if test='rprtCd == "A10700100" or rprtCd == "A10700400" or rprtCd == "A10700200" '>
            AND T1.DOC_ID = #{docId}
            </if>
    </select>


    <select id="selectApvHisList" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisList*/
        /*실지감사 결재이력 sql*/
        SELECT
              A.APV_STA_CD ,    /* 결재상태코드 */
              A.APV_RQS_ID,     /* 결재요청ID */
              B.APV_SRNO ,      /* 결재순번 */
              B.PST_NM ,        /* 결재자직위코드 */
              B.APVR_NM ,       /* 결재자성명 */
              B.APV_DH ,        /* 결재일시 */
              B.APVR_STA_NM,    /* 결재상태 */
              B.APVR_CNB,       /* 결재자전산번호 */
              B.APVR_DPT_CD,    /* 결재자 부서코드 */
              F_DPT_INFO(APVR_DPT_CD, '1') AS DPT_NM,
              B.SORT_SNO,
              B.SORT_SNO_SEQ,
              B.APV_OPIN,
              B.SEQ
         FROM TBBADDED103M A INNER JOIN
              (
              SELECT
                     APV_DOC_NO AS APV_RQS_ID ,
                     APV_SNO AS APV_SRNO ,
                     NVL(F_CODE_NM('1000176', APVR_PST_CD), F_CODE_NM('1000173', APVR_RANK_CD))
                     || CASE WHEN T1.ONR_PST_NM LIKE '%권한대행%' THEN ' 권한대행' END AS PST_NM ,
                     F_USR_INFO(APVR_CNB, '2') AS APVR_NM ,
                     TO_CHAR(FNL_MDF_DH,'YYYY-MM-DD HH24:MI')  AS APV_DH,
                     DECODE(APVR_KND_CD,'9',DECODE(READ_YN, 'Y','열람완료','공석('||  F_CODE_NM('1000820', VACANCY_CD)||')'),
                     	NVL(F_CODE_NM('1000348',APVR_STA_CD), SUBSTR(F_CODE_NM('1000350',APVR_KND_CD), 1,2) ||'대기')
                     ) AS APVR_STA_NM,
                     APVR_CNB,
                     APVR_DPT_CD,
                     1 AS SORT_SNO,
                     SEQ AS SORT_SNO_SEQ,
                     APV_OPIN,
                     SEQ
                FROM TBDCMACM023H T1
               WHERE APV_DOC_NO = #{apvRqsId}

              ) B
           ON A.APV_RQS_ID = B.APV_RQS_ID
        WHERE A.APV_RQS_ID = #{apvRqsId}
        GROUP BY A.APV_STA_CD ,    /* 결재상태코드 */
                          A.APV_RQS_ID,     /* 결재요청ID */
                          B.APV_SRNO ,      /* 결재순번 */
                          B.PST_NM ,        /* 결재자직위코드 */
                          B.APVR_NM ,       /* 결재자성명 */
                          B.APV_DH ,        /* 결재일시 */
                          B.APVR_STA_NM,    /* 결재상태 */
                          B.APVR_CNB,       /* 결재자전산번호 */
                          B.APVR_DPT_CD,    /* 결재자 부서코드 */
                          F_DPT_INFO(APVR_DPT_CD, '1') ,
                          B.SORT_SNO,
                          B.SORT_SNO_SEQ,
                          B.APV_OPIN,
                          B.SEQ
        ORDER BY B.SORT_SNO, B.SORT_SNO_SEQ
           ]]>
    </select>

    <select id="selectApvHisList2" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisList3*/
        /*제보,청구,청탁 결재이력 sql*/
        SELECT
              A.APV_STA_CD ,    /* 결재상태코드 */
              A.APV_RQS_ID,     /* 결재요청ID */
              B.APV_SRNO ,      /* 결재순번 */
              B.PST_NM ,        /* 결재자직위코드 */
              B.APVR_NM ,       /* 결재자성명 */
              B.APV_DH ,        /* 결재일시 */
              B.APVR_STA_NM,    /* 결재상태 */
              B.APVR_CNB,       /* 결재자전산번호 */
              B.APVR_DPT_CD,    /* 결재자 부서코드 */
              F_DPT_INFO(APVR_DPT_CD, '1') AS DPT_NM,
              B.SORT_SNO,
              B.SORT_SNO_SEQ,
              B.APV_OPIN,
              B.SEQ
         FROM TBCSPDCP603M A INNER JOIN
              (
              SELECT
                     APV_DOC_NO AS APV_RQS_ID ,
                     APV_SNO AS APV_SRNO ,
                     NVL(F_CODE_NM('1000176', APVR_PST_CD), F_CODE_NM('1000173', APVR_RANK_CD)) AS PST_NM ,
                     F_USR_INFO(APVR_CNB, '2') AS APVR_NM ,
                     TO_CHAR(FNL_MDF_DH,'YYYY-MM-DD HH24:MI')  AS APV_DH,
                     DECODE(APVR_KND_CD,'9',DECODE(READ_YN, 'Y','열람완료','공석('||  F_CODE_NM('1000820', VACANCY_CD)||')'),
                     	NVL(F_CODE_NM('1000348',APVR_STA_CD), SUBSTR(F_CODE_NM('1000350',APVR_KND_CD), 1,2) ||'대기')
                     ) AS APVR_STA_NM,
                     APVR_CNB,
                     APVR_DPT_CD,
                     1 AS SORT_SNO,
                     SEQ AS SORT_SNO_SEQ,
                     APV_OPIN,
                     SEQ
                FROM TBDCMACM023H T1
               WHERE APV_DOC_NO = #{apvRqsId}

              ) B
           ON A.APV_RQS_ID = B.APV_RQS_ID
        WHERE A.APV_RQS_ID = #{apvRqsId}
        GROUP BY A.APV_STA_CD ,    /* 결재상태코드 */
                          A.APV_RQS_ID,     /* 결재요청ID */
                          B.APV_SRNO ,      /* 결재순번 */
                          B.PST_NM ,        /* 결재자직위코드 */
                          B.APVR_NM ,       /* 결재자성명 */
                          B.APV_DH ,        /* 결재일시 */
                          B.APVR_STA_NM,    /* 결재상태 */
                          B.APVR_CNB,       /* 결재자전산번호 */
                          B.APVR_DPT_CD,    /* 결재자 부서코드 */
                          F_DPT_INFO(APVR_DPT_CD, '1') ,
                          B.SORT_SNO,
                          B.SORT_SNO_SEQ,
                          B.APV_OPIN,
                          B.SEQ
        ORDER BY B.SORT_SNO, B.SORT_SNO_SEQ
           ]]>
    </select>

    <select id="selectApvHisList3" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisList3*/
        /*심사,재심 결재이력 sql*/
        SELECT
              A.APV_STA_CD ,    /* 결재상태코드 */
              A.APV_RQS_ID,     /* 결재요청ID */
              B.APV_SRNO ,      /* 결재순번 */
              B.PST_NM ,        /* 결재자직위코드 */
              B.APVR_NM ,       /* 결재자성명 */
              B.APV_DH ,        /* 결재일시 */
              B.APVR_STA_NM,    /* 결재상태 */
              B.APVR_CNB,       /* 결재자전산번호 */
              B.APVR_DPT_CD,    /* 결재자 부서코드 */
              F_DPT_INFO(APVR_DPT_CD, '1') AS DPT_NM,
              B.SORT_SNO,
              B.SORT_SNO_SEQ,
              B.APV_OPIN,
              B.SEQ
         FROM TBBADFRE103M A INNER JOIN
              (
              SELECT
                     APV_DOC_NO AS APV_RQS_ID ,
                     APV_SNO AS APV_SRNO ,
                     NVL(F_CODE_NM('1000176', APVR_PST_CD), F_CODE_NM('1000173', APVR_RANK_CD)) AS PST_NM ,
                     F_USR_INFO(APVR_CNB, '2') AS APVR_NM ,
                     TO_CHAR(FNL_MDF_DH,'YYYY-MM-DD HH24:MI')  AS APV_DH,
                     DECODE(APVR_KND_CD,'9',DECODE(READ_YN, 'Y','열람완료','공석('||  F_CODE_NM('1000820', VACANCY_CD)||')'),
                     	NVL(F_CODE_NM('1000348',APVR_STA_CD), SUBSTR(F_CODE_NM('1000350',APVR_KND_CD), 1,2) ||'대기')
                     ) AS APVR_STA_NM,
                     APVR_CNB,
                     APVR_DPT_CD,
                     1 AS SORT_SNO,
                     SEQ AS SORT_SNO_SEQ,
                     APV_OPIN,
                     SEQ
                FROM TBDCMACM023H T1
               WHERE APV_DOC_NO = #{apvRqsId}

              ) B
           ON A.APV_RQS_ID = B.APV_RQS_ID
        WHERE A.APV_RQS_ID = #{apvRqsId}
        GROUP BY A.APV_STA_CD ,    /* 결재상태코드 */
                          A.APV_RQS_ID,     /* 결재요청ID */
                          B.APV_SRNO ,      /* 결재순번 */
                          B.PST_NM ,        /* 결재자직위코드 */
                          B.APVR_NM ,       /* 결재자성명 */
                          B.APV_DH ,        /* 결재일시 */
                          B.APVR_STA_NM,    /* 결재상태 */
                          B.APVR_CNB,       /* 결재자전산번호 */
                          B.APVR_DPT_CD,    /* 결재자 부서코드 */
                          F_DPT_INFO(APVR_DPT_CD, '1') ,
                          B.SORT_SNO,
                          B.SORT_SNO_SEQ,
                          B.APV_OPIN,
                          B.SEQ
        ORDER BY B.SORT_SNO, B.SORT_SNO_SEQ
           ]]>
    </select>

    <select id="selectMaintenanceRole" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        SELECT CD_NM AS ROLE_NM
          FROM TBDCMACM013C
         WHERE CMM_CD_DVSN_CD = '1000842'
           AND CD != '000000000'
           AND USE_YN ='Y'
           ]]>
    </select>
    
    <select id="selectDocViewCnb" parameterType="paramMap" resultType="egovMap" >
    /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectDocViewCnb*/
    <![CDATA[
        SELECT F_USR_INFO_BY_ID(DOC_WRT_ID, '1') AS CNB /*문서 작성자 */
          FROM TBBADDED103M T1
         WHERE (DOC_ID = #{docId} OR TEMPLATE_DOC_ID = #{docId}) 
        UNION
        SELECT CNB  /*주관자, 보조자 */
          FROM TBBADDED031L T1
               INNER JOIN TBBADDED103M T2
               ON (T1.AUD_YR = T2.AUD_YR 
                   AND T1.AUD_NO = T2.AUD_NO 
                   AND (T2.DOC_ID = #{docId} OR T2.TEMPLATE_DOC_ID = #{docId}) 
                   /* 서무권한의 경우 확인출장명령부, 시행문, 공개문만 열람 가능 */
                   AND ((T1.AUDTOR_DVSN_CD = '4' AND T2.RPRT_CD IN ('A10100100','A10100110', 'A10800500','A10601200','A10601400','A10601600','A10601800','A10800200','A10800201','A10800202','A10800203','A10800204','A10800300'))
                        OR AUDTOR_DVSN_CD != '4'))
        UNION
        SELECT AUD_TOT_DRTR_CNB AS CNB /* 감사단장 */
          FROM TBBADDED001M T1
               INNER JOIN TBBADDED103M T2
               ON (T1.AUD_YR = T2.AUD_YR 
                   AND T1.AUD_NO = T2.AUD_NO 
                   AND (T2.DOC_ID = #{docId} OR T2.TEMPLATE_DOC_ID = #{docId}))
        UNION
        SELECT APVR_CNB AS CNB  /*기안자, 결재자 */
          FROM TBDCMACM023L T1
          INNER JOIN TBBADDED103M T2
          ON (T1.APV_DOC_NO = T2.APV_RQS_ID AND (T2.DOC_ID = #{docId} OR T2.TEMPLATE_DOC_ID = #{docId}))
        UNION
        SELECT CNB FROM TBDCMACM001M    /*원장, 총장님*/
         WHERE PST_CD IN ('0067400','0055700')
              AND WOK_DVSN_CD = 'AAA'
              AND INN_RANK_CD IN (11,13)
        UNION
        SELECT B.EDT_CNB   AS CNB /* 2019-04-26 LCH 문서 권한자 추가  */
          FROM TBBADDED103M A 
         INNER JOIN
               TBDCMACM202M B
            ON B.AUD_YR = A.AUD_YR
           AND B.AUD_NO = A.AUD_NO
           AND B.AUD_STEP_CD = A.AUD_STEP_CD
           AND B.DOC_ID = A.DOC_ID
         WHERE (A.DOC_ID = #{docId} OR A.TEMPLATE_DOC_ID = #{docId})
           ]]>
    </select>
    
    <select id="selectPStepList" parameterType="paramMap" resultType="egovMap" >

    <![CDATA[
    SELECT ST1.ACP_YR , ST1.ACP_SRNO, ST1.ACP_DVSN_CD, ST1.SBCN_VT_CD 
      FROM(   
           SELECT A.ACP_YR , A.ACP_SRNO, A.ACP_DVSN_CD, A.SBCN_VT_CD 
		    FROM TBBADFRE113M A, TBBADFRE012M B
		   WHERE A.ACP_YR = B.ACP_YR 
		     AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		     AND A.ACP_SRNO = B.ACP_SRNO
		     AND TO_CHAR(TO_DATE(A.SBCN_DY),'YYYYMMDD') <  TO_CHAR(SYSDATE,'YYYYMMDD')
		     AND A.SBCN_DY IS NOT NULL
		  ) ST1 , TBBADFRE101M ST2 
     WHERE ST1.ACP_YR = ST2.ACP_YR AND ST1.ACP_DVSN_CD = ST2.ACP_DVSN_CD AND ST1.ACP_SRNO = ST2.ACP_SRNO
       AND ST2.ACP_STEP_CD IN ('D1030','E1050')
	   AND ST2.STEP_CMPT_YN = 'P'
           ]]>
    </select>
    
    <select id="sbcnVtCdList" parameterType="paramMap" resultType="egovMap" >

    <![CDATA[
           SELECT A.ACP_YR , A.ACP_SRNO, A.ACP_DVSN_CD, A.SBCN_VT_CD 
		    FROM TBBADFRE113M A , TBBADFRE012M B
		     WHERE A.ACP_YR = B.ACP_YR 
		     AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		     AND A.ACP_SRNO = B.ACP_SRNO 
		     AND NVL(B.MG_ACP_YR, B.ACP_YR) = #{acpYr} 
		     AND NVL(B.MG_ACP_DVSN_CD, B.ACP_DVSN_CD) = #{acpDvsnCd} 
		     AND NVL(B.MG_ACP_SRNO, B.ACP_SRNO) = #{acpSrno}
           ]]>
    </select>

    <select id="selectApvHisInfo" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisInfo*/
        SELECT
            T3.AUD_SBJ_NM
            , T2.APV_TIT_NM
            , AGGR_CONCAT(T1.RPRT_NM ,', ') AS RPRT_NM
        FROM TBBADDED103M T1
             INNER JOIN TBDCMACM022L T2
             ON (T1.APV_RQS_ID = T2.APV_DOC_NO)
             INNER JOIN TBBADDED001M T3
             ON (T1.AUD_YR = T3.AUD_YR AND T1.AUD_NO = T3.AUD_NO)
        WHERE 1=1
          AND T1.APV_RQS_ID = #{apvRqsId}
          GROUP BY T3.AUD_SBJ_NM, T2.APV_TIT_NM
           ]]>
    </select>

    <select id="selectApvHisInfo2" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisInfo2*/
        SELECT
              NVL(T3.TIT_NM, ' ') AS AUD_SBJ_NM
            , T2.APV_TIT_NM
            , AGGR_CONCAT(T1.RPRT_NM ,', ') AS RPRT_NM
        FROM TBCSPDCP603M T1
             INNER JOIN TBDCMACM022L T2
             ON (T1.APV_RQS_ID = T2.APV_DOC_NO)
             LEFT OUTER JOIN TBCSPDCP101M T3
             ON (T1.ACP_YR = T3.ACP_YR AND T1.REQ_DVSN_CD = T3.REQ_DVSN_CD AND T1.CVPT_ACP_NO = T3.CVPT_ACP_NO)
        WHERE 1=1
          AND T1.APV_RQS_ID = #{apvRqsId}
          GROUP BY T3.TIT_NM, T2.APV_TIT_NM
    ]]>
    </select>

    <select id="selectApvHisInfo3" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisInfo3*/
        SELECT
              NVL(T3.TIT_NM, ' ') AS AUD_SBJ_NM
            , T2.APV_TIT_NM
            , AGGR_CONCAT(T1.RPRT_NM ,', ') AS RPRT_NM
        FROM TBBADFRE103M T1
             INNER JOIN TBDCMACM022L T2
             ON (T1.APV_RQS_ID = T2.APV_DOC_NO)
             INNER JOIN TBBADFRE012M T3
             ON (T1.ACP_YR = T3.ACP_YR AND T1.ACP_DVSN_CD = T3.ACP_DVSN_CD AND T1.ACP_SRNO = T3.ACP_SRNO)
        WHERE 1=1
          AND T1.APV_RQS_ID = #{apvRqsId}
    ]]>
           <if test="acpYr != null and acpYr != ''">
           AND T1.ACP_YR = #{acpYr}
           </if>
           <if test="acpDvsnCd != null and acpDvsnCd != ''">
           AND T1.ACP_DVSN_CD = #{acpDvsnCd}
           </if>
           <if test="acpSrno != null and acpSrno != ''">
           AND T1.ACP_SRNO = #{acpSrno}
           </if>
          GROUP BY T3.TIT_NM, T2.APV_TIT_NM
           
    </select>

    <select id="selectApvHisOpin" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisOpin*/
            SELECT
                NVL(F_CODE_NM('1000348', APVR_STA_CD), SUBSTR(F_CODE_NM('1000350', APVR_KND_CD), 1, 2) ||'대기') AS APVR_STA_NM,
                F_DPT_INFO(APVR_DPT_CD, '1') AS DPT_NM,
                NVL(F_CODE_NM('1000176', APVR_PST_CD), F_CODE_NM('1000173', APVR_RANK_CD)) AS PST_NM ,
                F_USR_INFO(APVR_CNB, '2') AS APVR_NM ,
                TO_CHAR(FNL_MDF_DH, 'YYYY-MM-DD HH24:MI') AS APV_DH,
                APV_OPIN
              FROM TBDCMACM023H T1
             WHERE APV_DOC_NO = #{apvRqsId}
               AND SEQ = #{seq}
           ]]>
    </select>

   <!-- 감사사항조회 팝업 -->
    <select id="dcmacm009AudSelect" parameterType="paramMap" resultType="egovMap">
    <include refid="include.pageSelct" />
    <![CDATA[
       SELECT T1.AUD_YR AS AUD_YR ,
               T1.AUD_NO AS AUD_NO ,
               T1.AUD_KND_CD AS AUD_KND_CD ,
               T1.AUD_GRN_NO AS AUD_GRN_NO ,
               F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') AS AUD_YR_NO,
               T1.AUD_SBJ_NM,
               F_CODE_NM('1000475',CASE WHEN SUBSTR(T1.AUD_KND_CD,3) = '55' THEN ''
                                      WHEN T2.AUD_EXEC_HNDL_STA_CD = '9'  THEN '10'
                                      ELSE
                                        CASE WHEN TRIM(T2.ENF_APV_DT) IS NOT NULL THEN '10'
                                             WHEN TRIM(T2.CHF_CMTR_APV_DT)IS NOT NULL THEN '09'
                                             WHEN TRIM(T2.OW_DHD_APV_DT)  IS NOT NULL THEN '08'
                                             WHEN TRIM(T2.JA_JDG_SSEC_APV_DT) IS NOT NULL THEN '07'
                                             WHEN TRIM(T2.MDT_DDG_APV_DT) IS NOT NULL THEN '06'
                                             WHEN TRIM(T2.MDT_OFER_APV_DT)IS NOT NULL THEN '05'
                                             WHEN TRIM(T2.AUD_BRDV_APV_DT)IS NOT NULL THEN '04'
                                             WHEN TRIM(T2.RTN_RPT_DT) IS NOT NULL THEN '03'
                                        ELSE
                                            (CASE WHEN
                                                        (CASE WHEN (T2.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(T2.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                              WHEN ((T2.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(T2.HNDL_DDLN_DT) IS NULL) OR T2.AUD_EXEC_HNDL_STA_CD = '3') OR (T2.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(T2.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                              WHEN T2.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(T2.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                              WHEN T2.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                              WHEN T2.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                              ELSE '8' END) = '8' AND T2.RTN_RPT_DT IS NULL AND T2.FLD_AUD_END_DT IS NULL THEN '02'
                                                  WHEN
                                                        (CASE WHEN (T2.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(T2.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                              WHEN ((T2.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(T2.HNDL_DDLN_DT) IS NULL) OR T2.AUD_EXEC_HNDL_STA_CD = '3') OR (T2.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(T2.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                              WHEN T2.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(T2.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                              WHEN T2.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                              WHEN T2.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                              ELSE '8' END) = '8' AND T2.RTN_RPT_DT IS NULL THEN '11'
                                                  WHEN
                                                        (CASE WHEN (T2.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(T2.RTN_DT) > TO_DATE(SYSDATE)) THEN '7'
                                                              WHEN ((T2.AUD_EXEC_HNDL_STA_CD = '1' AND TRIM(T2.HNDL_DDLN_DT) IS NULL) OR T2.AUD_EXEC_HNDL_STA_CD = '3') OR (T2.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(T2.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) )THEN '8'
                                                              WHEN T2.AUD_EXEC_HNDL_STA_CD = '1'AND NVL(TO_DATE(T2.HNDL_DDLN_DT),'99991231') < TO_DATE(SYSDATE) THEN '6'
                                                              WHEN T2.AUD_EXEC_HNDL_STA_CD = '3' THEN '3'
                                                              WHEN T2.AUD_EXEC_HNDL_STA_CD = '9' THEN '9'
                                                              ELSE '8' END) = '7' THEN '02'
                                                   END)
                                        END
                                      END)
                                   AS PRSS_STEP_NM,
               F_CODE_NM('1000739', T1.AUD_KND_CD) AS AUD_KND_NM,
               MNG_DPT_CD,
               F_DPT_INFO(MNG_DPT_CD,'1') AS MNG_DPT_NM
          FROM TBBADDED001M T1
               LEFT OUTER JOIN TBBADDED003M T2
               ON (T1.AUD_YR = T2.AUD_YR AND T1.AUD_NO = T2.AUD_NO)
         WHERE 1=1
          ]]>
        <if test="schAudYr != null and schAudYr != ''">
            AND T1.AUD_YR  = #{schAudYr}
        </if>
        <if test="schAudSbjNm != null and schAudSbjNm != ''">
            AND T1.AUD_SBJ_NM LIKE '%'||#{schAudSbjNm}||'%'
        </if>
        <if test="schAudYrNoKndCd != null and schAudYrNoKndCd != ''">
                AND T1.AUD_KND_CD = #{schAudYrNoKndCd}
        </if>
        <if test="schAudNo != null and schAudNo != ''">
                AND T1.AUD_GRN_NO = #{schAudNo}
        </if>
        ORDER BY T1.AUD_YR DESC, T1.AUD_KND_CD, T1.AUD_GRN_NO DESC
        <include refid="include.pageOrder" />
    </select>

    <!-- 청구사항 팝업 -->
    <select id="dcmacm010selectAcpList" parameterType="paramMap" resultType="egovMap">
    <include refid="include.pageSelct" />
    <![CDATA[
       SELECT
              A.ACP_YR || '-' || DECODE(A.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' ||A.ACP_SRNO AS ACP_YR_NO /* 분류번호 */
              ,A.MG_ACP_DVSN_CD    /*병합구분코드 1: 병합,  null 일반*/
              ,DECODE(A.MG_ACP_DVSN_CD, 1, '병합', NULL) AS MG_ACP_DVSN_NM
              ,DECODE(A.MG_ACP_DVSN_CD, NULL, NULL, A.MG_ACP_YR || '-' || DECODE(A.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' ||A.MG_ACP_SRNO) AS MG_ACP_YR_NO /* 대표번호 */
              ,A.REQR_NM /*청구인*/
              ,TO_CHAR(TO_DATE(A.ACP_DT), 'YYYY-MM-DD') AS ACP_DT		/* 접수일 */
              ,A.TIT_NM /*청구내용*/
              ,A.DPT_CD /* 부서코드 */
        	  ,F_DPT_INFO (A.DPT_CD, '1') AS DPT_NM /* 처리과 */
        	  ,A.HNDL_CHGR_NM /* 담당자 */
              ,DECODE(A.MG_ACP_DVSN_CD, NULL,A.ACP_YR,A.MG_ACP_YR) AS ACP_YR
              ,A.ACP_SRNO
              ,A.ACP_DVSN_CD
              ,DECODE(A.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') AS ACP_DVSN_NM
              ,DECODE(A.MG_ACP_DVSN_CD, NULL,A.ACP_SRNO,A.MG_ACP_SRNO) AS ACP_NO
        FROM TBBADFRE012M A
        WHERE 1=1

          ]]>
        <if test="schAcpYr != null and schAcpYr != ''">
            AND A.ACP_YR  = #{schAcpYr}
        </if>
        <if test="schTitNm != null and schTitNm != ''">
            AND A.TIT_NM LIKE '%'||#{schTitNm}||'%'
        </if>
        <if test="schAcpDvsnCd != null and schAcpDvsnCd != ''">
                AND A.ACP_DVSN_CD = #{schAcpDvsnCd}
        </if>
        <if test="schAcpNo != null and schAcpNo != ''">
                AND (A.ACP_SRNO = #{schAcpNo} OR A.MG_ACP_SRNO = #{schAcpNo})
        </if>
        ORDER BY A.ACP_YR DESC, A.ACP_SRNO, A.MG_ACP_SRNO
        <include refid="include.pageOrder" />
    </select>

	<select id="getNextStepCd" parameterType="paramMap" resultType="String">
     	/*kr.go.bai.eip.bad.ded.dao.BADDED001EMapper.getNextStepCd*/
		SELECT AUD_STEP_CD 
		  FROM TBBADDED101M 
		 WHERE AUD_YR = #{audYr}
		   AND AUD_NO = #{audNo}
		   AND SORT_SNO = (SELECT SORT_SNO+1 
		                     FROM TBBADDED101M 
		                    WHERE AUD_YR = #{audYr}
		                      AND AUD_NO = #{audNo}
		                      AND AUD_STEP_CD = #{audStepCd})
	</select>
	
    <!-- 업무 별 단계 완료 처리 -->
    <update id="updateStepCmptYn" parameterType="paramMap">
        <![CDATA[
        /*kr.go.bai.eip.dcm.acm.dao.BADDED001EMapper.updateStepCmptYn*/
            MERGE INTO TBBADDED101M X
            USING ( SELECT AUD_YR
                          ,AUD_NO
                          ,AUD_STEP_CD
                          ,STEP_CMPT_YN
                      FROM (
                        SELECT C.AUD_YR
                             ,C.AUD_NO
                             ,D.AUD_STEP_CD
                             --,C.A1010,C.A1020,C.A1030,C.A1040
                             ,DECODE(D.AUD_STEP_CD,'A1010',CASE WHEN C.A1090 = 'Y' THEN 'Y'
                                                                WHEN C.A1080 = 'Y' THEN 'Y'
                                                                WHEN C.A1070 = 'Y' THEN 'Y'
                                                                WHEN C.A1060 = 'Y' THEN 'Y'
                                                                WHEN C.A1050 = 'Y' THEN 'Y'
                                                                WHEN C.A1040 = 'Y' THEN 'Y'
                                                                WHEN C.A1030 = 'Y' THEN 'Y'
                                                                WHEN C.A1020 = 'Y' THEN 'Y'
                                                                ELSE DECODE(C.A1010, 'Y', C.A1010, 'P') END
                                                  ,'A1020',CASE WHEN C.A1090 = 'Y' THEN 'Y'
                                                                WHEN C.A1080 = 'Y' THEN 'Y'
                                                                WHEN C.A1070 = 'Y' THEN 'Y'
                                                                WHEN C.A1060 = 'Y' THEN 'Y'
                                                                WHEN C.A1050 = 'Y' THEN 'Y'
                                                                WHEN C.A1040 = 'Y' THEN 'Y'
                                                                WHEN C.A1030 = 'Y' THEN 'Y'
                                                                ELSE DECODE(C.A1020, 'Y', C.A1020, DECODE(C.A1010, 'Y', 'P', '')) END
                                                  ,'A1030',CASE WHEN C.A1090 = 'Y' THEN 'Y'
                                                                WHEN C.A1080 = 'Y' THEN 'Y'
                                                                WHEN C.A1070 = 'Y' THEN 'Y'
                                                                WHEN C.A1060 = 'Y' THEN 'Y'
                                                                WHEN C.A1050 = 'Y' THEN 'Y'
                                                                WHEN C.A1040 = 'Y' THEN 'Y'
                                                                ELSE DECODE(C.A1030, 'Y', C.A1030, DECODE(C.A1020, 'Y', 'P', '')) END
                                                  ,'A1040',CASE WHEN C.A1090 = 'Y' THEN 'Y'
                                                                WHEN C.A1080 = 'Y' THEN 'Y'
                                                                WHEN C.A1070 = 'Y' THEN 'Y'
                                                                WHEN C.A1060 = 'Y' THEN 'Y'
                                                                WHEN C.A1050 = 'Y' THEN 'Y'
                                                                ELSE DECODE(C.A1040, 'Y', C.A1040, DECODE(C.A1030, 'Y', 'P', '')) END
                                                  ,'A1050',CASE WHEN C.A1090 = 'Y' THEN 'Y'
                                                                WHEN C.A1080 = 'Y' THEN 'Y'
                                                                WHEN C.A1070 = 'Y' THEN 'Y'
                                                                WHEN C.A1060 = 'Y' THEN 'Y'
                                                                ELSE DECODE(C.A1050, 'Y', C.A1050, DECODE(C.A1040, 'Y', 'P', '')) END
                                                  ,'A1060',CASE WHEN C.A1090 = 'Y' THEN 'Y'
                                                                WHEN C.A1080 = 'Y' THEN 'Y'
                                                                WHEN C.A1070 = 'Y' THEN 'Y'
                                                                ELSE DECODE(C.A1060, 'Y', C.A1060, DECODE(C.A1050, 'Y', 'P', '')) END
                                                  ,'A1070',CASE WHEN C.A1090 = 'Y' THEN 'Y'
                                                                WHEN C.A1080 = 'Y' THEN 'Y'
                                                                ELSE DECODE(C.A1070, 'Y', C.A1070, DECODE(C.A1060, 'Y', 'P', '')) END
                                                  ,'A1080',CASE WHEN C.A1090 = 'Y' THEN 'Y'
                                                                ELSE DECODE(C.A1080, 'Y', C.A1080, DECODE(C.A1070, 'Y', 'P', '')) END
                                                  ,'A1090',DECODE(C.A1090, 'Y', C.A1090, DECODE(C.A1080, 'Y', 'P', ''))
                                                  ,'') AS STEP_CMPT_YN 
                                                  
                         FROM (
                               SELECT AUD_YR
                                     ,AUD_NO
                                     ,DECODE(SUM(DECODE(A1010, 'Y', 1, 0)), 0, 'N', 'Y') AS A1010
                                     ,DECODE(SUM(DECODE(A1020, 'Y', 1, 0)), 0, 'N', 'Y') AS A1020
                                     ,DECODE(SUM(DECODE(A1030, 'Y', 1, 0)), 0, 'N', 'Y') AS A1030
                                     ,DECODE(SUM(DECODE(A1040, 'Y', 1, 0)), 0, 'N', 'Y') AS A1040
                                     ,MAX(A1050) AS A1050
                                     ,MAX(A1060) AS A1060
                                     ,MAX(A1070) AS A1070
                                     ,MAX(A1080) AS A1080
                                     ,MAX(A1090) AS A1090
                                 FROM (
                                       SELECT B.AUD_YR
                                             ,B.AUD_NO
                                             ,CASE WHEN MAX(A.AUD_BZT_KND_CD) = '00' AND TO_NUMBER(MAX(A.AUD_END_DT)) < TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMMDD')) THEN 'Y' ELSE 'N' END AS A1010
                                             ,CASE WHEN MAX(A.AUD_BZT_KND_CD) = '01' AND TO_NUMBER(MAX(A.AUD_END_DT)) < TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMMDD')) THEN 'Y' ELSE 'N' END AS A1020
                                             ,CASE WHEN MAX(A.AUD_BZT_KND_CD)  IN ('02', '03') AND TO_NUMBER(TO_CHAR(MIN(TO_DATE(A.AUD_STR_DT)-1), 'YYYYMMDD')) < TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMMDD')) THEN 'Y' ELSE 'N' END AS A1030
                                             ,CASE WHEN MAX(A.AUD_BZT_KND_CD)  IN ('02', '03') AND TO_NUMBER(MAX(A.AUD_END_DT)) < TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMMDD')) THEN 'Y' ELSE 'N' END AS A1040
                                             ,NVL((
                                                SELECT DECODE(T1.APV_STA_CD, '30', 'Y', 'N' )
                                                  FROM TBBADDED103M T1
                                                 WHERE T1.RPRT_CD = 'A10500200'
                                                   AND T1.AUD_YR = B.AUD_YR
                                                   AND T1.AUD_NO = B.AUD_NO), 'N') AS A1050
                                             ,NVL((
                                                SELECT DECODE(T1.APV_STA_CD, '30', 'Y', 'N' )
                                                  FROM TBBADDED103M T1
                                                 WHERE T1.RPRT_CD = 'A10600200'
                                                   AND T1.AUD_RPRT_DVSN_CD = '10'
                                                   AND T1.AUD_STEP_CD = 'A1060'
                                                   AND T1.AUD_YR = B.AUD_YR
                                                   AND T1.AUD_NO = B.AUD_NO), 'N') AS A1060
                                             ,NVL((
                                                SELECT CASE WHEN SUM(DECODE(T1.REFER_DVSN_CD, 'D10', 1, 0)) > 0
                                                            THEN CASE WHEN COUNT(T3.DSP_RQ_SNO) = SUM(DECODE(T3.SBCN_VT_CD, NULL, 0, 1)) AND COUNT(T3.DSP_RQ_SNO) <> 0
                                                                      THEN 'Y'
                                                                      ELSE 'N'
                                                                 END
                                                            ELSE CASE WHEN (
                                                                            SELECT COUNT(1)
                                                                              FROM TBBADDED103M T4
                                                                             WHERE T4.AUD_YR = T1.AUD_YR
                                                                               AND T4.AUD_NO = T1.AUD_NO
                                                                               AND T4.REF_ID = T1.DOC_ID
                                                                               AND T4.RPRT_CD = 'A10700100'
                                                                               AND T4.APV_STA_CD = '30') = 0
                                                                      THEN 'N'
                                                                      ELSE 'Y'
                                                                 END
                                                       END
                                                  FROM TBBADDED145M T1
                                                 INNER JOIN TBBADDED103M T2 ON (    T1.AUD_YR = T2.AUD_YR
                                                                                AND T1.AUD_NO = T2.AUD_NO
                                                                                AND T1.DOC_ID = T2.DOC_ID)
                                                 LEFT OUTER JOIN TBBADDED113M T3 ON (    T3.AUD_YR = T1.AUD_YR
                                                                                      AND T3.AUD_NO = T1.AUD_NO
                                                                                      AND T3.DOC_ID = T1.DOC_ID
                                                                                      AND T3.AFF_SNO = T1.AFF_SNO)
                                                 WHERE T1.APVR_CD = '0010600'
                                                   AND T2.RPRT_CD = 'A10600200'
                                                   AND T2.AUD_RPRT_DVSN_CD = '10'
                                                   AND T1.AUD_YR = B.AUD_YR
                                                   AND T1.AUD_NO = B.AUD_NO
                                                 GROUP BY T1.AUD_YR, T1.AUD_NO, T1.DOC_ID), 'N') AS A1070
                                             ,NVL((
                                                SELECT CASE WHEN SUM(DECODE(T2.SND_STA_CD, '3', 1, 0)) = COUNT(T2.SND_STA_CD) AND COUNT(T2.SND_STA_CD) <> 0
                                                            THEN 'Y'
                                                            ELSE 'N'
                                                       END
                                                  FROM TBBADEAR001M T1
                                                 INNER JOIN TBBADEAR002D T2 ON (    T1.AUD_YR = T2.AUD_YR
                                                                                AND T1.AUD_NO = T2.AUD_NO
                                                                                AND T1.DSP_RQ_SNO = T2.DSP_RQ_SNO)
                                                 INNER JOIN TBBADDED146M T3 ON (    T1.AUD_YR = T3.AUD_YR
                                                                                AND T1.AUD_NO = T3.AUD_NO
                                                                                AND T1.AUD_DSP_RQ_SNO = T3.DSP_RQ_SNO)
                                                 INNER JOIN TBBADDED103M T4 ON (    T3.AUD_YR = T4.AUD_YR
                                                                                AND T3.AUD_NO = T4.AUD_NO
                                                                                AND T3.DOC_ID = T4.DOC_ID)
                                                 WHERE T3.AUD_STEP_CD = 'A1070'
                                                   AND T3.APVR_CD = 'A1070'
                                                   AND T4.RPRT_CD = 'A10600200'
                                                   AND T4.AUD_RPRT_DVSN_CD = '10'
                                                   AND T1.AUD_YR = B.AUD_YR
                                                   AND T1.AUD_NO = B.AUD_NO
                                                 GROUP BY T1.AUD_YR, T1.AUD_NO), 'N') AS A1080
                                             ,NVL((
                                                SELECT CASE WHEN SUM(DECODE(T2.DTM_STA_CD, '2', 1, 0)) = COUNT(T2.DTM_STA_CD) AND COUNT(T2.DTM_STA_CD) <> 0
                                                            THEN 'Y'
                                                            ELSE 'N'
                                                       END
                                                  FROM TBBADEAR001M T1
                                                 INNER JOIN TBBADEAR002D T2 ON (    T1.AUD_YR = T2.AUD_YR
                                                                                AND T1.AUD_NO = T2.AUD_NO
                                                                                AND T1.DSP_RQ_SNO = T2.DSP_RQ_SNO)
                                                 INNER JOIN TBBADDED146M T3 ON (    T1.AUD_YR = T3.AUD_YR
                                                                                AND T1.AUD_NO = T3.AUD_NO
                                                                                AND T1.AUD_DSP_RQ_SNO = T3.DSP_RQ_SNO)
                                                 INNER JOIN TBBADDED103M T4 ON (    T3.AUD_YR = T4.AUD_YR
                                                                                AND T3.AUD_NO = T4.AUD_NO
                                                                                AND T3.DOC_ID = T4.DOC_ID)
                                                 WHERE T3.AUD_STEP_CD = 'A1070'
                                                   AND T3.APVR_CD = 'A1070'
                                                   AND T4.RPRT_CD = 'A10600200'
                                                   AND T4.AUD_RPRT_DVSN_CD = '10'
                                                   AND T1.AUD_YR = B.AUD_YR
                                                   AND T1.AUD_NO = B.AUD_NO
                                                 GROUP BY T1.AUD_YR, T1.AUD_NO), 'N') AS A1090
                                         FROM TBBADDED001M B
                                        LEFT OUTER JOIN TBBADDED002M A ON (   A.REL_AUD_YR = B.AUD_YR
                                                                          AND A.REL_AUD_NO = B.AUD_NO
                                                                          AND A.AUD_BZT_KND_CD IN ('00','01','02', '03'))
                                        INNER JOIN TBBADDED003M C
                                                   ON (C.AUD_YR = B.AUD_YR
                                                  AND  C.AUD_NO = B.AUD_NO
                                                  AND  C.AUD_EXEC_HNDL_STA_CD <> '9')
                                        WHERE 1=1
                                          AND B.AUD_YR > '2016' -- 감사년도 OR 그 밖의 조건
                                          -- AND B.AUD_CTRL_CD = '2' 통제완료건
                                          AND SUBSTR(B.AUD_KND_CD,3,1) <> '5'
                                        GROUP BY B.AUD_YR ,B.AUD_NO, A.AUD_BZT_KND_CD )
                                GROUP BY AUD_YR, AUD_NO
                              ) C
                             ,(          SELECT 'A1010' AS AUD_STEP_CD FROM DUAL
                               UNION ALL SELECT 'A1020' AS AUD_STEP_CD FROM DUAL
                               UNION ALL SELECT 'A1030' AS AUD_STEP_CD FROM DUAL
                               UNION ALL SELECT 'A1040' AS AUD_STEP_CD FROM DUAL
                               UNION ALL SELECT 'A1050' AS AUD_STEP_CD FROM DUAL
                               UNION ALL SELECT 'A1060' AS AUD_STEP_CD FROM DUAL
                               UNION ALL SELECT 'A1070' AS AUD_STEP_CD FROM DUAL
                               UNION ALL SELECT 'A1080' AS AUD_STEP_CD FROM DUAL
                               UNION ALL SELECT 'A1090' AS AUD_STEP_CD FROM DUAL) D
                        ORDER BY C.AUD_YR,C.AUD_NO,D.AUD_STEP_CD )
                    GROUP BY AUD_YR,AUD_NO,AUD_STEP_CD,STEP_CMPT_YN
                  ) Y
               ON (    X.AUD_YR      = Y.AUD_YR
                   AND X.AUD_NO      = Y.AUD_NO
                   AND X.AUD_STEP_CD = Y.AUD_STEP_CD
                  )    
             WHEN MATCHED THEN
             UPDATE SET X.STEP_CMPT_YN = Y.STEP_CMPT_YN
                       ,X.STEP_CMPT_DH = DECODE(Y.STEP_CMPT_YN, 'Y', SYSDATE, '')
              WHERE NVL(X.STEP_CMPT_YN, 'N') <> 'Y'
                AND NVL(X.STEP_CMPT_YN, 'N') <> DECODE(Y.STEP_CMPT_YN, 'Y', 'Y', 'P')
        ]]>

    </update>
    
    <!-- 감사업무 진행단계 UPDATE -->
    <update id="updatePrssAudStepCd" parameterType="paramMap">
        <![CDATA[
            MERGE INTO TBBADDED001M TG
            USING ( SELECT G1.AUD_YR, G1.AUD_NO, G1.AUD_STEP_CD
                      FROM (
                            SELECT T1.AUD_YR
                                  ,T1.AUD_NO
                                  ,MAX(T1.AUD_STEP_CD) AS AUD_STEP_CD
                              FROM TBBADDED101M T1
                             INNER JOIN TBBADDED001M T2 ON (    T1.AUD_YR = T2.AUD_YR
                                                            AND T1.AUD_NO = T2.AUD_NO
                                                            AND T2.AUD_CTRL_CD = '2')
                             WHERE SUBSTR(T1.AUD_KND_CD,3,1) <> '5'
                               AND T1.AUD_STEP_CD <> 'A1000'
                               AND T1.STEP_CMPT_YN = 'P'
                               AND T1.AUD_YR > '2016'
                             GROUP BY T1.AUD_YR, T1.AUD_NO ) G1
                     INNER JOIN TBBADDED001M G2 ON (    G1.AUD_YR = G2.AUD_YR
                                                    AND G1.AUD_NO = G2.AUD_NO
                                                    AND G1.AUD_STEP_CD <> G2.PRSS_STEP_CD)
                  ) RF
               ON (    TG.AUD_YR = RF.AUD_YR
                   AND TG.AUD_NO = RF.AUD_NO)
             WHEN MATCHED THEN
           UPDATE 
              SET TG.PRSS_STEP_CD = RF.AUD_STEP_CD
        ]]>

    </update>
    
    <!-- 심사,재심 진행단계 UPDATE -->
    <update id="updateAcpStepCmptYn" parameterType="paramMap">
        <![CDATA[
             UPDATE TBBADFRE101M SET 
                    STEP_CMPT_YN = #{stepCmptYn}
              WHERE (ACP_YR, ACP_DVSN_CD, ACP_SRNO) IN ( SELECT ACP_YR, ACP_DVSN_CD, ACP_SRNO 
			                                                    FROM TBBADFRE012M 
			                                                    WHERE (MG_ACP_YR = #{acpYr}
			                                                    AND MG_ACP_DVSN_CD = #{acpDvsnCd}
			                                                    AND MG_ACP_SRNO = #{acpSrno}
			                                                    AND MG_DIV_CD IN ('10', '20')) OR 
			                                                    (ACP_YR = #{acpYr}
			                                                    AND ACP_DVSN_CD = #{acpDvsnCd}
			                                                    AND ACP_SRNO = #{acpSrno}
			                                                    AND MG_DIV_CD IS NULL))
                AND ACP_STEP_CD = #{acpStepCd}
        ]]>
    </update>
    
    <!--심사재심 접수테이블 진행단계 update -->
	<update id="BADFRE111EAcpHndlStaCdUpdate" parameterType="paramMap">
	<![CDATA[
		UPDATE TBBADFRE012M
   		   SET FNL_MDF_DH      	= SYSDATE				/*최종수정일시*/
			 , ACP_HNDL_STA_CD        = #{acpHndlStaCd}
	]]>
	    WHERE 1 = 1
		  AND NVL(MG_ACP_YR, ACP_YR) 		        = #{acpYr}
		  AND NVL(MG_ACP_DVSN_CD, ACP_DVSN_CD) 	= #{acpDvsnCd}
		  AND NVL(MG_ACP_SRNO, ACP_SRNO)		    = #{acpSrno}
	</update>
    
    <!-- 감사업무 진행단계 UPDATE -->
    <insert id="insertSendMessage" parameterType="paramMap">
        <![CDATA[
            INSERT INTO
            TBDCMACM026L
            (
              MSG_SNO
            , TSK_CAT_CD
            , FUNC_CAT_CD
            , SEND_ID
            , MSG_TP_YN   
            , MSG_TXT_2
            , RCNT_CNT
            , RCNT_HIS
            , MSG_REGI_DH   
            , FRT_USR_ID
            , FNL_USR_ID
            , FNL_DEAL_DPT_CD
            , FNL_MNU_ID
            , FRT_REGI_DH
            ,
            FNL_MDF_DH  
            )
            (
            SELECT
              (SELECT NVL(MAX(MSG_SNO),'0') AS MSG_SNO FROM TBDCMACM026L) + ROWNUM
            , 'CM'
            , 'CM'
            , #{usrId}
            , '0'        
            , '['||#{gubun}||']업무 별 단계 완료 처리중 오류가 발생하였습니다. 확인 부탁드립니다.'
            , 1
            , CNB
            , SYSDATE 
            , #{usrId}
            , #{usrId}
            , #{dptCd}
            , #{menuId}
            , SYSDATE
            , SYSDATE
            FROM TBDCMACM001M
            WHERE CNB IN ('9356', '9339', '9325', '9366')
            )
        ]]>
    </insert>
    
    <!-- 메신저 메시지 발송 -->
    <insert id="sendMessengerMsg" parameterType="paramMap">
        <![CDATA[
        INSERT INTO
            TBDCMACM026L
            (
              MSG_SNO
            , TSK_CAT_CD
            , FUNC_CAT_CD
            , SEND_ID
            , MSG_TP_YN
            , MSG_TXT_2
            , RCNT_CNT
            , RCNT_HIS
            , MSG_REGI_DH
            , FRT_USR_ID
            , FNL_USR_ID
            , FNL_DEAL_DPT_CD
            , FNL_MNU_ID
            , FRT_REGI_DH
            , FNL_MDF_DH    
            )
            VALUES
            (
              (SELECT NVL(MAX(MSG_SNO),'0')+1 AS MSG_SNO FROM TBDCMACM026L)
            , 'CM'
            , 'CM'
            , #{sendId}
            , '0'
            , #{sendMsg}
            , #{rcptUsrCnt}
            , #{rcptUsrCnb}
            , SYSDATE 
            , #{usrId}
            , #{usrId}
            , #{dptCd}
            , 'DCMACM001'
            , SYSDATE
            , SYSDATE 
            )
        ]]>
    </insert>
        
    <select id="selectApvHisInfo4" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisInfo4*/
        /* 감사실시계획관리 sql*/
		SELECT
		      DECODE(T1.RPRT_CD,'A11000100','업무계획 보고서','A11001800','미실시 감사현황','A11001900','조정 명세서') AS AUD_SBJ_NM
		    , T2.APV_TIT_NM
		    , AGGR_CONCAT(T1.RPRT_NM ,', ') AS RPRT_NM
		FROM TBBADDED131M T1
		     INNER JOIN TBDCMACM022L T2
		     ON (T1.APV_RQS_ID = T2.APV_DOC_NO)
		WHERE 1=1
		  AND T1.APV_RQS_ID = #{apvRqsId}
		  GROUP BY T2.APV_TIT_NM ,T1.AUD_PLAN_YR, T1.RPRT_CD
    ]]>
    </select>
    
    <select id="selectApvHisList4" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisList4*/
        /*감사실시계획관리 결재이력 sql*/
        SELECT
              A.APV_STA_CD ,    /* 결재상태코드 */
              A.APV_RQS_ID,     /* 결재요청ID */
              B.APV_SRNO ,      /* 결재순번 */
              B.PST_NM ,        /* 결재자직위코드 */
              B.APVR_NM ,       /* 결재자성명 */
              B.APV_DH ,        /* 결재일시 */
              B.APVR_STA_NM,    /* 결재상태 */
              B.APVR_CNB,       /* 결재자전산번호 */
              B.APVR_DPT_CD,    /* 결재자 부서코드 */
              F_DPT_INFO(APVR_DPT_CD, '1') AS DPT_NM,
              B.SORT_SNO,
              B.SORT_SNO_SEQ,
              B.APV_OPIN,
              B.SEQ
         FROM TBBADDED131M A INNER JOIN
              (
              SELECT
                     APV_DOC_NO AS APV_RQS_ID ,
                     APV_SNO AS APV_SRNO ,
                     NVL(F_CODE_NM('1000176', APVR_PST_CD), F_CODE_NM('1000173', APVR_RANK_CD)) AS PST_NM ,
                     F_USR_INFO(APVR_CNB, '2') AS APVR_NM ,
                     TO_CHAR(FNL_MDF_DH,'YYYY-MM-DD HH24:MI')  AS APV_DH,
                     DECODE(APVR_KND_CD,'9',DECODE(READ_YN, 'Y','열람완료','공석('||  F_CODE_NM('1000820', VACANCY_CD)||')'),
                     	NVL(F_CODE_NM('1000348',APVR_STA_CD), SUBSTR(F_CODE_NM('1000350',APVR_KND_CD), 1,2) ||'대기')
                     ) AS APVR_STA_NM,
                     APVR_CNB,
                     APVR_DPT_CD,
                     1 AS SORT_SNO,
                     SEQ AS SORT_SNO_SEQ,
                     APV_OPIN,
                     SEQ
                FROM TBDCMACM023H T1
               WHERE APV_DOC_NO = #{apvRqsId}

              ) B
           ON A.APV_RQS_ID = B.APV_RQS_ID
        WHERE A.APV_RQS_ID = #{apvRqsId}
        GROUP BY A.APV_STA_CD ,    /* 결재상태코드 */
                          A.APV_RQS_ID,     /* 결재요청ID */
                          B.APV_SRNO ,      /* 결재순번 */
                          B.PST_NM ,        /* 결재자직위코드 */
                          B.APVR_NM ,       /* 결재자성명 */
                          B.APV_DH ,        /* 결재일시 */
                          B.APVR_STA_NM,    /* 결재상태 */
                          B.APVR_CNB,       /* 결재자전산번호 */
                          B.APVR_DPT_CD,    /* 결재자 부서코드 */
                          F_DPT_INFO(APVR_DPT_CD, '1') ,
                          B.SORT_SNO,
                          B.SORT_SNO_SEQ,
                          B.APV_OPIN,
                          B.SEQ
        ORDER BY B.SORT_SNO, B.SORT_SNO_SEQ
           ]]>
    </select>
    
    
    <select id="selectDocInfo" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectDocInfo*/
        SELECT * FROM TBBADDED103M WHERE DOC_ID = #{docId}
           ]]>
    </select>
    
	
	<select id="selectAudDocNm" parameterType="paramMap" resultType="String">
     	/*kr.go.bai.eip.bad.ded.dao.DCMACM001Mapper.selectAudDocNm*/
		SELECT DTIL_AUD_DOC_NM
	      FROM TBFDMADM002M
		 WHERE AUD_DOC_CD = #{audDocCd}
		   AND DOC_KND_CD = #{docKndCd}
	</select>
	
	<select id="selectA1050StepYn" parameterType="paramMap" resultType="String">
    <![CDATA[
     	/*kr.go.bai.eip.bad.ded.dao.DCMACM001Mapper.selectA1050StepYn*/
		 SELECT DECODE(COUNT(*), 0,  'N', 'Y') AS A1050_STEP_YN
                 FROM TBBADDED101M A
                WHERE A.AUD_YR = #{audYr}
                   AND A.AUD_NO = #{audNo}
                   AND A.AUD_STEP_CD = 'A1050'
                   AND A.STEP_CMPT_YN = 'P'
                   AND NOT EXISTS ( SELECT 1
                                             FROM TBBADDED103M B
                                            WHERE B.AUD_YR = A.AUD_YR
                                               AND B.AUD_NO = A.AUD_YR
                                               AND B.RPRT_CD = 'A10500200'        
                                               AND B.APV_STA_CD <> '10'
                   )
                ]]>
	</select>
	
	<update id="updatePStepCmptYnBak" parameterType="paramMap" >
	<![CDATA[
         /*kr.go.bai.eip.bad.ded.dao.DCMACM001Mapper.updatePStepCmptYnBak*/
        DECLARE 
            BEGIN 
                UPDATE TBBADDED101M
                         SET STEP_CMPT_YN = NULL
                             , STEP_CMPT_DH = NULL
                             , FNL_MDF_DH = SYSDATE
                             , FNL_USR_ID = #{fnlUsrId}
                             , FNL_DEAL_DPT_CD = #{fnlDealDptCd}
                             , FNL_MNU_ID = #{fnlMnuId}
               WHERE AUD_YR = #{audYr}
                  AND AUD_NO = #{audNo}
                  AND AUD_STEP_CD = 'A1050';
                  
               UPDATE TBBADDED101M
                         SET STEP_CMPT_YN = 'P'
                             , STEP_CMPT_DH = SYSDATE
                             , FNL_MDF_DH = SYSDATE
                             , FNL_USR_ID = #{fnlUsrId}
                             , FNL_DEAL_DPT_CD = #{fnlDealDptCd}
                             , FNL_MNU_ID = #{fnlMnuId}
              WHERE AUD_YR =#{audYr}
                 AND AUD_NO = #{audNo}
                 AND AUD_STEP_CD = 'A1040';
            END;
          ]]>
	</update>
	
	<select id="selectRelAudPrcsChk" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectDocInfo*/
        SELECT NVL(MIN(PRCS_YN1),'N') AS PRCS_YN1
              , NVL(MIN(PRCS_YN2),'N') AS PRCS_YN2
              , NVL(MIN(PRCS_YN4),'N') AS PRCS_YN4
              , NVL(MIN(PRCS_YN5),'N') AS PRCS_YN5
              , NVL(MIN(PRCS_YN6),'N') AS PRCS_YN6
        FROM (
            SELECT MIN(DECODE(T2.RPRT_CD,'A10100100','Y','A10100110','Y',''))                 AS PRCS_YN1,
                   CASE WHEN MIN(T3.BZT_SNO) IS NOT NULL THEN 'Y' ELSE '' END AS PRCS_YN2,
                   MIN(DECODE(T2.RPRT_CD,'A10100200','Y','A10100210','Y',''))                 AS PRCS_YN4,
                   CASE WHEN T4.CALC_CNT > 0 THEN 'Y' ELSE '' END              AS PRCS_YN5,
                   CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE '' END              AS PRCS_YN6
            FROM TBBADDED101L T1
            LEFT OUTER JOIN TBBADDED103M T2 ON (T1.REL_AUD_YR = T2.AUD_YR AND T1.REL_AUD_NO = T2.AUD_NO AND T1.REL_AUD_STEP_CD = T2.AUD_STEP_CD AND T2.RPRT_CD IN ('A10100100','A10100110','A10100200','A10100210'))
            LEFT OUTER JOIN TBBADDED002M T3 ON (T3.REL_AUD_YR = T1.REL_AUD_YR AND T3.REL_AUD_NO = T1.REL_AUD_NO AND T3.BZT_DVSN_CD = 1)
            LEFT OUTER JOIN  (SELECT BZT_YR 
                                     ,BZT_SNO
                                     ,COUNT(DISTINCT PCT_CNB) AS CNT
                                     ,SUM(DECODE(CALC_YN, 'N', 1, 0)) AS CALC_CNT 
                                     ,SUM(DECODE(CALC_YN, 'Y', 1, 0)) AS ADJ_CNT
                                FROM TBBADDED011L
                               WHERE 1=1
                            GROUP BY BZT_YR, BZT_SNO ) T4 ON (T4.BZT_YR = T3.BZT_YR AND T4.BZT_SNO = T3.BZT_SNO)
            WHERE T1.AUD_YR = #{audYr}
              AND T1.AUD_NO = #{audNo}
         GROUP BY T1.REL_AUD_YR, T1.REL_AUD_NO, T4.CALC_CNT
         )
           ]]>
    </select>
    
    <!-- 소명자료, 적극행정면책 조회 -->
	<select id="selectSideMfexMenu" parameterType="paramMap" resultType="egovMap">
        SELECT
                 NVL(SUM(MFEX),0)  AS MFEX_CNT  /* 소명자료 */
	           , NVL(SUM(IMMUN),0) AS IMMUN_CNT /* 적극행정면책 */
          FROM
               (
	             SELECT
		                  DECODE(MFEX_DVSN_CD, '10', 1, 0) AS MFEX
	                 	, DECODE(MFEX_DVSN_CD, '20', 1, 0) AS IMMUN
	               FROM 
	                      TBCSPKDE103M_VIEW
	              WHERE 
	                      AUD_YR = #{audYr}
          	        AND   AUD_NO = #{audNo}
	                AND   SPV_DPT_OM_YN = 'Y' /* 주관과발신 여부 */
	                AND   NVL(CLSNG_YN, 'N') != 'F'
               )
	</select>
	
	<!-- 법률자문 조회 -->
	<!-- BEST20 2020.10.06 HBY 법률자문 업무확대에 따른 변경(변경최소화) -->
	<select id="selectSideLegalMenu" parameterType="paramMap" resultType="egovMap">
	    /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectSideLegalMenu */
        SELECT (SELECT COUNT(1) LEGAL_CNT
                  FROM TBBADDED126M
                 WHERE 1=1
                   AND WRK_YR      = #{audYr}
                   AND WRK_NO      = #{audNo}
                   AND WRK_DVSN_CD = 'A10') AS LEGAL_CNT
		     , (SELECT COUNT(1)
		          FROM TBBADDED126M
		         WHERE 1=1
		           AND WRK_YR      = #{acpYr}
		           AND WRK_NO      = #{cvptAcpNo}
		           AND WRK_DVSN_CD = 'B10') AS LEGAL_CNT_1
		     , (SELECT COUNT(1)
		          FROM TBBADDED126M
		         WHERE 1=1
		           AND WRK_YR      = #{acpYr}
		           AND WRK_NO      = #{cvptAcpNo}
		           /* 감사청구 분리로 인해 업무 구분자 추가 */
		           <if test="reqDvsnCd == 1">
		           		AND AUD_STEP_CD = 'B3011'
		           </if>
		           <if test="reqDvsnCd == 2">
		           		AND AUD_STEP_CD = 'C2012'
		           </if> 
		           <if test="reqDvsnCd == 3">
		           		AND AUD_STEP_CD = 'C2013'
		           </if>  
        	       AND WRK_DVSN_CD = 'C10') AS LEGAL_CNT_2
		     , (SELECT COUNT(1)
		          FROM TBBADDED126M
		         WHERE 1=1
		           AND WRK_YR      = #{acpYr}
		           AND WRK_NO      = #{cvptAcpNo}
		           AND WRK_DVSN_CD = 'D10') AS LEGAL_CNT_3
		     , (SELECT COUNT(1)
		          FROM TBBADDED126M
		         WHERE 1=1
		           AND WRK_YR      = #{acpYr}
		           AND WRK_NO      = #{cvptAcpNo}
		           AND WRK_DVSN_CD = 'E10') AS LEGAL_CNT_4
		     , (SELECT COUNT(1)
		          FROM TBBADDED126M
		         WHERE 1=1
		           AND WRK_YR      = #{acpYr}
		           AND WRK_NO      = #{cvptAcpNo}
		           AND WRK_DVSN_CD = 'F10') AS LEGAL_CNT_5
		     , (SELECT COUNT(1)
		          FROM TBBADDED126M
		         WHERE 1=1
		           AND WRK_YR      = #{acpYr}
		           AND WRK_NO      = #{cvptAcpNo}
		           AND WRK_DVSN_CD = 'G10') AS LEGAL_CNT_6
          FROM DUAL
	</select>
	
    <!-- 포렌식 조회 -->
	<select id="selectSideFrsMenu" parameterType="paramMap" resultType="egovMap">
        SELECT
                 COUNT(1)  AS FRS_CNT
          FROM
	             TBAEPFRS101M
	     WHERE 
	             AUD_YR = #{audYr}
           AND   AUD_NO = #{audNo}

	</select>		    
	
    <select id="selectLocation" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[    
        SELECT   REGEXP_SUBSTR(PATH_DESC, '[^>]+', 1, 1) AS LEVEL1
               , REGEXP_SUBSTR(PATH_DESC, '[^>]+', 1, 2) AS LEVEL2
               , REGEXP_SUBSTR(PATH_DESC, '[^>]+', 1, 3) AS LEVEL3
               , REGEXP_SUBSTR(PATH_DESC, '[^>]+', 1, 4) AS LEVEL4
               , REGEXP_SUBSTR(PATH_DESC, '[^>]+', 1, 5) AS LEVEL5
          FROM 
               (
                 SELECT   RESOURCE_ID, RESOURCE_NAME, RESOURCE_DESC
                        , SYS_CONNECT_BY_PATH(RESOURCE_DESC, '>') AS PATH_DESC
                   FROM 
                          COMMON_RESOURCE
                  WHERE 
                          CODE_ID = 'COD00003'
                    AND   RESOURCE_ID <> 'RES426382'
                    START WITH RESOURCE_ID2 = 'RES426382'
                          CONNECT BY PRIOR RESOURCE_ID = RESOURCE_ID2
               )
        
         WHERE RESOURCE_NAME = #{mnuId} 
         
    ]]>
    
    </select>
    
    <select id="selectOnrDocViewCnb" parameterType="paramMap" resultType="egovMap" >
    /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectOnrDocViewCnb*/
    <![CDATA[
        SELECT F_USR_INFO_BY_ID(B.APVR_ID, '1') AS CNB /*기안자, 결재자 */
		  FROM TBBADDED103M A
		     , TBDCMACM102L B
		 WHERE A.APV_RQS_ID = B.ONR_DOC_MNG_CRD_ID
		   AND (A.DOC_ID = #{docId} OR NVL(A.TEMPLATE_DOC_ID,'@') = NVL(#{docId},'@'))
           ]]>
    </select>
    
     <select id="selectBztBgtDvsnCdYN" parameterType="paramMap" resultType="String">
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectBztBgtDvsnCdYN */
          SELECT A.BZT_BGT_DVSN_CD AS bztBgtDvsnCdYN
            FROM TBBADDED001M A 
      INNER JOIN TBBADDED101L B ON (B.REL_AUD_YR = A.AUD_YR AND B.REL_AUD_NO = A.AUD_NO) /*자료수집 연결*/
           WHERE A.AUD_CTRL_CD = '2'     /*확인완료*/
             AND A.BZT_BGT_DVSN_CD = '3' /*차장배정*/
             AND B.AUD_YR = #{audYr}
             AND B.AUD_NO = #{audNo}
           GROUP BY A.BZT_BGT_DVSN_CD
        ]]>
    </select>
    
	<!-- 개별사건추적도 CMPT_YN update -->
	<update id="updateCmpt" parameterType="paramMap">
		UPDATE TBBADDED102M 
		   SET CMPT_YN = 'Y'
		 WHERE AUD_YR = #{audYr}
           AND AUD_NO = #{audNo}
           AND AUD_STEP_CD = #{audStepCd}
           AND AUD_MAIN_STEP_ID = #{audMainStepId}
	
	</update>
	
	<!-- 감사절차 클릭클릭 -->
	<select id="selectLaw" parameterType="paramMap" resultType="egovMap">
		
		<!-- 
		SELECT 
			AA.DVSN_IDX1
			, (
				SELECT MAX(DVSN_IDX2)
				FROM TBDCMACM203M_BK20190508
				WHERE DVSN_IDX1 = AA.DVSN_IDX1
			) AS ROWSPAN_OPEN
			, (
				SELECT COUNT(BB.DVSN_IDX1) 
						FROM TBDCMACM203M_BK20190508 BB
						WHERE BB.DVSN_IDX1 = AA.DVSN_IDX1
						AND BB.DVSN_IDX2 != 0
						AND BB.DVSN_PRE_IDX = 0
						AND BB.DVSN_CD = 'DV2'
						AND AA.DVSN_CD = 'DV1'
			) AS ROWSPAN_CLOSE
			, AA.DVSN_IDX2
			, AA.DVSN_PRE_IDX
			, AA.DVSN_CD
			, (
				SELECT EE.IDX2_CNT - DD.DVSN_IDX2  
				FROM TBDCMACM203M_BK20190508 DD
					,(
						SELECT MAX(PRE_CNT) AS IDX2_CNT, CC.DVSN_IDX1, CC.DVSN_IDX2
						FROM 	
							(
								SELECT AA.DVSN_IDX1, AA.DVSN_IDX2,  BB.DVSN_IDX2 AS PRE_CNT
								FROM TBDCMACM203M_BK20190508 AA
									,(
										SELECT DVSN_IDX1, DVSN_IDX2, MAX(DVSN_IDX2),  DVSN_PRE_IDX
										FROM TBDCMACM203M_BK20190508
										WHERE DVSN_CD = 'RGL'
										GROUP BY DVSN_IDX1, DVSN_IDX2, DVSN_PRE_IDX
									) BB
								WHERE 
									AA.DVSN_IDX1 = BB.DVSN_IDX1
									AND AA.DVSN_IDX2 = BB.DVSN_PRE_IDX
									AND AA.DVSN_CD = 'DV2'
								GROUP BY AA.DVSN_IDX1, AA.DVSN_IDX2, BB.DVSN_IDX2
							) CC
						GROUP BY CC.DVSN_IDX1, CC.DVSN_IDX2
					) EE
				WHERE 
				DD.DVSN_IDX1 = EE.DVSN_IDX1
				AND DD.DVSN_IDX2 = EE.DVSN_IDX2
				AND DD.DVSN_IDX1 = AA.DVSN_IDX1
				AND DD.DVSN_IDX2 = AA.DVSN_IDX2
			) AS DV2_NUM
			, AA.DVSN_SORT
			, AA.LAW_TXT 
		FROM TBDCMACM203M_BK20190508 AA
		ORDER BY DVSN_IDX1, DVSN_IDX2, DVSN_SORT
		-->
		  
		SELECT 
			AA.DVSN_IDX1
			, AA.DVSN_IDX2
			, AA.DVSN_PRE_IDX
			, AA.DVSN_CD
			, AA.DVSN_SORT
			, AA.RMK_SORT
			, AA.TBD_SORT
			, (
				SELECT EE.IDX2_CNT - DD.DVSN_IDX2  
				FROM TBDCMACM203M DD
					,(
						SELECT MAX(PRE_CNT) AS IDX2_CNT, CC.DVSN_IDX1, CC.DVSN_IDX2
						FROM 	
							(
								SELECT AA.DVSN_IDX1, AA.DVSN_IDX2,  BB.DVSN_IDX2 AS PRE_CNT
								FROM TBDCMACM203M AA
									,(
										SELECT DVSN_IDX1, DVSN_IDX2, MAX(DVSN_IDX2),  DVSN_PRE_IDX
										FROM TBDCMACM203M
										WHERE DVSN_CD = 'REGT'
										GROUP BY DVSN_IDX1, DVSN_IDX2, DVSN_PRE_IDX
									) BB
								WHERE 
									AA.DVSN_IDX1 = BB.DVSN_IDX1
									AND AA.DVSN_IDX2 = BB.DVSN_PRE_IDX
									AND AA.DVSN_CD = 'DV2'
								GROUP BY AA.DVSN_IDX1, AA.DVSN_IDX2, BB.DVSN_IDX2
							) CC
						GROUP BY CC.DVSN_IDX1, CC.DVSN_IDX2
					) EE
				WHERE 
				DD.DVSN_IDX1 = EE.DVSN_IDX1
				AND DD.DVSN_IDX2 = EE.DVSN_IDX2
				AND DD.DVSN_IDX1 = AA.DVSN_IDX1
				AND DD.DVSN_IDX2 = AA.DVSN_IDX2
			) AS DV2_NUM
			, (
				SELECT MAX(RMK_SORT) 
				FROM TBDCMACM203M 
				WHERE DVSN_IDX1 = AA.DVSN_IDX1 
				AND DVSN_IDX2 = AA.DVSN_IDX2 
				AND DVSN_CD = AA.DVSN_CD
			) AS RMK_SORT_MAX
			, (
				SELECT MAX(TBD_SORT) 
				FROM TBDCMACM203M 
				WHERE DVSN_IDX1 = AA.DVSN_IDX1 
				AND DVSN_IDX2 = AA.DVSN_IDX2 
				AND DVSN_CD = AA.DVSN_CD
				AND RMK_SORT = AA.RMK_SORT
			) AS TBD_SORT_MAX
			, AA.LAW_RMK 
			, LAW_TBD
		FROM TBDCMACM203M AA
		ORDER BY DVSN_IDX1, DVSN_IDX2, DVSN_PRE_IDX, DVSN_SORT, RMK_SORT, TBD_SORT
	 
	</select>
	
	<!-- 실지감사 기간 입력 대상 기간 여부 조회 -->
	<select id="selectRealAudDurationYn" parameterType="paramMap" resultType="java.lang.String">
	 /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectRealAudDurationYn*/
        <![CDATA[
           SELECT CASE WHEN COUNT(A.CD) > 0 THEN 'Y'
                              ELSE 'N' END AS REAL_AUD_DURATION_YN
            FROM TBDCMACM013C  A
          WHERE A.CMM_CD_DVSN_CD = '1000952'
             AND A.CD = '10'
             AND TO_DATE(A.USR_DFN_TXT_1 , 'YYYYMMDD') <= TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'))
             AND TO_DATE(A.USR_DFN_TXT_2 , 'YYYYMMDD') >= TO_DATE(TO_CHAR(SYSDATE, 'YYYYMMDD'))
        ]]>
	</select>
	
	<!-- 실지감사 기간 입력여부 조회 -->
	<select id="selectEnfocePeriodInputYn" parameterType="paramMap" resultType="java.lang.String">
	/* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectEnfocePeriodInputYn*/
        <![CDATA[
          SELECT CASE WHEN COUNT(A.BZT_SNO) > 0 THEN 'Y'
                   ELSE 'N' END AS REAL_AUD_DURATION_YN
           FROM TBBADDED002M A
          WHERE A.REL_AUD_YR = #{audYr}
             AND A.REL_AUD_NO = #{audNo}
             AND A.AUD_BZT_KND_CD = #{audBztKndCd}
        ]]>
	</select>	
	
	
	<!-- BEST20 부패행위 결재이력 조회 -->
    <select id="selectApvHisList7" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisList7*/
        /* 부패행위 결재이력 sql*/
        SELECT
              A.APV_STA_CD ,    /* 결재상태코드 */
              A.APV_RQS_ID,     /* 결재요청ID */
              B.APV_SRNO ,      /* 결재순번 */
              B.PST_NM ,        /* 결재자직위코드 */
              B.APVR_NM ,       /* 결재자성명 */
              B.APV_DH ,        /* 결재일시 */
              B.APVR_STA_NM,    /* 결재상태 */
              B.APVR_CNB,       /* 결재자전산번호 */
              B.APVR_DPT_CD,    /* 결재자 부서코드 */
              F_DPT_INFO(APVR_DPT_CD, '1') AS DPT_NM,
              B.SORT_SNO,
              B.SORT_SNO_SEQ,
              B.APV_OPIN,
              B.SEQ
         FROM TBCORCOR603M A INNER JOIN
              (
              SELECT
                     APV_DOC_NO AS APV_RQS_ID ,
                     APV_SNO AS APV_SRNO ,
                     NVL(F_CODE_NM('1000176', APVR_PST_CD), F_CODE_NM('1000173', APVR_RANK_CD)) AS PST_NM ,
                     F_USR_INFO(APVR_CNB, '2') AS APVR_NM ,
                     TO_CHAR(FNL_MDF_DH,'YYYY-MM-DD HH24:MI')  AS APV_DH,
                     DECODE(APVR_KND_CD,'9',DECODE(READ_YN, 'Y','열람완료','공석('||  F_CODE_NM('1000820', VACANCY_CD)||')'),
                     	NVL(F_CODE_NM('1000348',APVR_STA_CD), SUBSTR(F_CODE_NM('1000350',APVR_KND_CD), 1,2) ||'대기')
                     ) AS APVR_STA_NM,
                     APVR_CNB,
                     APVR_DPT_CD,
                     1 AS SORT_SNO,
                     SEQ AS SORT_SNO_SEQ,
                     APV_OPIN,
                     SEQ
                FROM TBDCMACM023H T1
               WHERE APV_DOC_NO = #{apvRqsId}

              ) B
           ON A.APV_RQS_ID = B.APV_RQS_ID
        WHERE A.APV_RQS_ID = #{apvRqsId}
        GROUP BY A.APV_STA_CD ,    /* 결재상태코드 */
                          A.APV_RQS_ID,     /* 결재요청ID */
                          B.APV_SRNO ,      /* 결재순번 */
                          B.PST_NM ,        /* 결재자직위코드 */
                          B.APVR_NM ,       /* 결재자성명 */
                          B.APV_DH ,        /* 결재일시 */
                          B.APVR_STA_NM,    /* 결재상태 */
                          B.APVR_CNB,       /* 결재자전산번호 */
                          B.APVR_DPT_CD,    /* 결재자 부서코드 */
                          F_DPT_INFO(APVR_DPT_CD, '1') ,
                          B.SORT_SNO,
                          B.SORT_SNO_SEQ,
                          B.APV_OPIN,
                          B.SEQ
        ORDER BY B.SORT_SNO, B.SORT_SNO_SEQ
           ]]>
    </select>
    
    <!-- BEST20 부패행위 결재정보 조회 -->
     <select id="selectApvHisInfo7" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisInfo7*/
        SELECT
              NVL(T3.TIT_NM, ' ') AS AUD_SBJ_NM
            , T2.APV_TIT_NM
            , AGGR_CONCAT(T1.RPRT_NM ,', ') AS RPRT_NM
        FROM TBCORCOR603M T1
             INNER JOIN TBDCMACM022L T2
             ON (T1.APV_RQS_ID = T2.APV_DOC_NO)
             LEFT OUTER JOIN TBCORCOR101M T3
             ON (T1.ACP_YR = T3.ACP_YR AND T1.REQ_DVSN_CD = T3.REQ_DVSN_CD AND T1.CVPT_ACP_NO = T3.CVPT_ACP_NO)
        WHERE 1=1
          AND T1.APV_RQS_ID = #{apvRqsId}
          GROUP BY T3.TIT_NM, T2.APV_TIT_NM
    ]]>
    </select>
    
    <!-- BEST20 청탁금지 결재이력 조회 -->
    <select id="selectApvHisList8" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisList8*/
        /* 청탁금지 결재이력 sql*/
        SELECT
              A.APV_STA_CD ,    /* 결재상태코드 */
              A.APV_RQS_ID,     /* 결재요청ID */
              B.APV_SRNO ,      /* 결재순번 */
              B.PST_NM ,        /* 결재자직위코드 */
              B.APVR_NM ,       /* 결재자성명 */
              B.APV_DH ,        /* 결재일시 */
              B.APVR_STA_NM,    /* 결재상태 */
              B.APVR_CNB,       /* 결재자전산번호 */
              B.APVR_DPT_CD,    /* 결재자 부서코드 */
              F_DPT_INFO(APVR_DPT_CD, '1') AS DPT_NM,
              B.SORT_SNO,
              B.SORT_SNO_SEQ,
              B.APV_OPIN,
              B.SEQ
         FROM TBDCPDCP603M A INNER JOIN
              (
              SELECT
                     APV_DOC_NO AS APV_RQS_ID ,
                     APV_SNO AS APV_SRNO ,
                     NVL(F_CODE_NM('1000176', APVR_PST_CD), F_CODE_NM('1000173', APVR_RANK_CD)) AS PST_NM ,
                     F_USR_INFO(APVR_CNB, '2') AS APVR_NM ,
                     TO_CHAR(FNL_MDF_DH,'YYYY-MM-DD HH24:MI')  AS APV_DH,
                     DECODE(APVR_KND_CD,'9',DECODE(READ_YN, 'Y','열람완료','공석('||  F_CODE_NM('1000820', VACANCY_CD)||')'),
                     	NVL(F_CODE_NM('1000348',APVR_STA_CD), SUBSTR(F_CODE_NM('1000350',APVR_KND_CD), 1,2) ||'대기')
                     ) AS APVR_STA_NM,
                     APVR_CNB,
                     APVR_DPT_CD,
                     1 AS SORT_SNO,
                     SEQ AS SORT_SNO_SEQ,
                     APV_OPIN,
                     SEQ
                FROM TBDCMACM023H T1
               WHERE APV_DOC_NO = #{apvRqsId}

              ) B
           ON A.APV_RQS_ID = B.APV_RQS_ID
        WHERE A.APV_RQS_ID = #{apvRqsId}
        GROUP BY A.APV_STA_CD ,    /* 결재상태코드 */
                          A.APV_RQS_ID,     /* 결재요청ID */
                          B.APV_SRNO ,      /* 결재순번 */
                          B.PST_NM ,        /* 결재자직위코드 */
                          B.APVR_NM ,       /* 결재자성명 */
                          B.APV_DH ,        /* 결재일시 */
                          B.APVR_STA_NM,    /* 결재상태 */
                          B.APVR_CNB,       /* 결재자전산번호 */
                          B.APVR_DPT_CD,    /* 결재자 부서코드 */
                          F_DPT_INFO(APVR_DPT_CD, '1') ,
                          B.SORT_SNO,
                          B.SORT_SNO_SEQ,
                          B.APV_OPIN,
                          B.SEQ
        ORDER BY B.SORT_SNO, B.SORT_SNO_SEQ
           ]]>
    </select>
    
    <!-- BEST20 청탁금지 결재정보 조회 -->
     <select id="selectApvHisInfo8" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisInfo8*/
        SELECT
              NVL(T3.TIT_NM, ' ') AS AUD_SBJ_NM
            , T2.APV_TIT_NM
            , AGGR_CONCAT(T1.RPRT_NM ,', ') AS RPRT_NM
        FROM TBDCPDCP603M T1
             INNER JOIN TBDCMACM022L T2
             ON (T1.APV_RQS_ID = T2.APV_DOC_NO)
             LEFT OUTER JOIN TBDCPDCP101M T3
             ON (T1.ACP_YR = T3.ACP_YR AND T1.REQ_DVSN_CD = T3.REQ_DVSN_CD AND T1.CVPT_ACP_NO = T3.CVPT_ACP_NO)
        WHERE 1=1
          AND T1.APV_RQS_ID = #{apvRqsId}
          GROUP BY T3.TIT_NM, T2.APV_TIT_NM
    ]]>
    </select>
    
    <!-- BEST20 문서편집요청 결재이력 조회 -->
    <select id="selectApvHisListEdtRqs" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisListEdtRqs*/
        /*문서편집요청 결재이력 sql*/
        SELECT
              C.APV_STA_CD ,    /* 결재상태코드 */
              C.APV_RQS_ID,     /* 결재요청ID */
              B.APV_SRNO ,      /* 결재순번 */
              B.PST_NM ,        /* 결재자직위코드 */
              B.APVR_NM ,       /* 결재자성명 */
              B.APV_DH ,        /* 결재일시 */
              B.APVR_STA_NM,    /* 결재상태 */
              B.APVR_CNB,       /* 결재자전산번호 */
              B.APVR_DPT_CD,    /* 결재자 부서코드 */
              F_DPT_INFO(APVR_DPT_CD, '1') AS DPT_NM,
              B.SORT_SNO,
              B.SORT_SNO_SEQ,
              B.APV_OPIN,
              B.SEQ
         FROM TBBADDED103M A 
        INNER JOIN TBBADDED149M C
                 ON C.AUD_YR = A.AUD_YR
                AND C.AUD_NO = A.AUD_NO
                AND C.AUD_STEP_CD = A.AUD_STEP_CD
                AND C.DOC_ID = A.DOC_ID
                AND C.SRNO = (SELECT MAX(AA.SRNO)
	                                FROM TBBADDED149M AA
	                               WHERE AA.AUD_YR = C.AUD_YR
	                                 AND AA.AUD_NO = C.AUD_NO
	                                 AND AA.AUD_STEP_CD = C.AUD_STEP_CD
	                                 AND AA.DOC_ID = C.DOC_ID) 
        INNER JOIN
              (
              SELECT
                     APV_DOC_NO AS APV_RQS_ID ,
                     APV_SNO AS APV_SRNO ,
                     NVL(F_CODE_NM('1000176', APVR_PST_CD), F_CODE_NM('1000173', APVR_RANK_CD)) AS PST_NM ,
                     F_USR_INFO(APVR_CNB, '2') AS APVR_NM ,
                     TO_CHAR(FNL_MDF_DH,'YYYY-MM-DD HH24:MI')  AS APV_DH,
                     DECODE(APVR_KND_CD,'9',DECODE(READ_YN, 'Y','열람완료','공석('||  F_CODE_NM('1000820', VACANCY_CD)||')'),
                     	NVL(F_CODE_NM('1000348',APVR_STA_CD), SUBSTR(F_CODE_NM('1000350',APVR_KND_CD), 1,2) ||'대기')
                     ) AS APVR_STA_NM,
                     APVR_CNB,
                     APVR_DPT_CD,
                     1 AS SORT_SNO,
                     SEQ AS SORT_SNO_SEQ,
                     APV_OPIN,
                     SEQ
                FROM TBDCMACM023H T1
               WHERE APV_DOC_NO = #{apvRqsId}

              ) B
           ON C.APV_RQS_ID = B.APV_RQS_ID
        WHERE C.APV_RQS_ID = #{apvRqsId}
        GROUP BY C.APV_STA_CD ,    /* 결재상태코드 */
                          C.APV_RQS_ID,     /* 결재요청ID */
                          B.APV_SRNO ,      /* 결재순번 */
                          B.PST_NM ,        /* 결재자직위코드 */
                          B.APVR_NM ,       /* 결재자성명 */
                          B.APV_DH ,        /* 결재일시 */
                          B.APVR_STA_NM,    /* 결재상태 */
                          B.APVR_CNB,       /* 결재자전산번호 */
                          B.APVR_DPT_CD,    /* 결재자 부서코드 */
                          F_DPT_INFO(APVR_DPT_CD, '1') ,
                          B.SORT_SNO,
                          B.SORT_SNO_SEQ,
                          B.APV_OPIN,
                          B.SEQ
        ORDER BY B.SORT_SNO, B.SORT_SNO_SEQ
           ]]>
    </select>
    
    <!-- BEST20 문서편집요청 결재정보 조회 -->
    <select id="selectApvHisInfoEdtRqs" parameterType="paramMap" resultType="egovMap" >
    <![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectApvHisInfoEdtRqs*/
        SELECT
            T3.AUD_SBJ_NM
            , T2.APV_TIT_NM
            , AGGR_CONCAT(T1.RPRT_NM ,', ') AS RPRT_NM
        FROM TBBADDED103M T1
             
             INNER JOIN TBBADDED001M T3
             ON (T1.AUD_YR = T3.AUD_YR AND T1.AUD_NO = T3.AUD_NO)
             INNER JOIN TBBADDED149M T4
                 ON T4.AUD_YR = T1.AUD_YR
                AND T4.AUD_NO = T1.AUD_NO
                AND T4.AUD_STEP_CD = T1.AUD_STEP_CD
                AND T4.DOC_ID = T1.DOC_ID
             INNER JOIN TBDCMACM022L T2
                ON (T4.APV_RQS_ID = T2.APV_DOC_NO)
        WHERE 1=1
          AND T4.APV_RQS_ID = #{apvRqsId}
          GROUP BY T3.AUD_SBJ_NM, T2.APV_TIT_NM
           ]]>
    </select>
    
	<!-- 감사감사 매뉴얼 조회 -->
	<select id="selectManualList1" parameterType="paramMap" resultType="egovMap">
	<![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectManualList1*/
		SELECT LEVEL              /* 메뉴레벨 */
		      ,MNU_ID             /* 메뉴ID */
		      ,MNU_NM             /* 메뉴명 */
		      ,MNU_DES_TXT        /* 메뉴설명 */
		      ,MNL_URL            /* 메뉴얼 URL */
		      ,SRT_SEQ            /* 정렬순서 */
		      ,UPPR_MNU_ID        /* 상위메뉴ID */
		      ,MNU_IMG            /* 메뉴얼 이미지 */
			FROM TBDCMACM070M
		WHERE USE_YN = 'Y'
	 ]]>
	 
		<if test="strNm != null and strNm != ''">
            AND MNU_NM LIKE '%'||#{strNm}||'%'
        </if>
		<![CDATA[
		 	START WITH MNU_ID =  #{strId}
			CONNECT BY PRIOR MNU_ID = UPPR_MNU_ID 
		ORDER BY SRT_SEQ
	]]>
	</select>
	
	<select id="selectManualList2" parameterType="paramMap" resultType="egovMap">
	<![CDATA[
        /* kr.go.bai.eip.dcm.acm.dao.DCMACM001Mapper.selectManualList2*/
		SELECT 
		       MNU_ID             /* 메뉴ID */
		      ,MNU_NM             /* 메뉴명 */
		      ,MNU_DES_TXT        /* 메뉴설명 */
		      ,MNL_URL            /* 메뉴얼 URL */
			FROM TBDCMACM070M
		WHERE USE_YN = 'Y'
		AND UPPR_MNU_ID = '00-00-00'
		ORDER BY SRT_SEQ
	]]>
	</select>
    
    <select id="dcmacm056selectOrgList" parameterType="paramMap" resultType="egovMap">
	<![CDATA[
       SELECT CASE
          WHEN USE_DVSN_NO='N' THEN '(*)'||ORG_CD
           ELSE  ORG_CD
           END AS ORG_CD_YN
            , ORG_CD
            , ORG_NM
            , RGN_CD
            , F_CODE_NM('1000001',RGN_CD) AS RGN_NM
            , ORG_DVSN_CD
            , F_CODE_NM('1000119',ORG_DVSN_CD) AS ORG_DVSN_NM
            , ORG_DGE_CD
            , F_CODE_NM('1000346',ORG_DGE_CD) AS ORG_DGE_NM
            , COPT_SG_CD
            , F_ORG_HRK_NM(COPT_SG_CD) AS COPT_SG_NM
            , TNB
            , ZCD
            , AD
            , DTL_AD
			, ROAD_NM_AD
            , ROAD_NM_DTL_AD
            , USE_DVSN_NO
            , ENFM_DPT_CD
            , ORG_CAT_CD
            , PUB_DVSN_CD
            , (SELECT	F_CODE_NM('1000447',Z.USR_DFN_TXT_1)
   						FROM	TBDCMACM013C Z
   						WHERE	Z.CMM_CD_DVSN_CD ='1000128'
   						AND		Z.CD =PUB_DVSN_CD) AS FNA_CLS_CD
         FROM TBDCMACM015M
        WHERE 1=1
	         ]]>
	    <choose>
	    	<when test='orgCdList != null and orgCdList != ""'>
	    		AND ORG_CD IN
	            <foreach item="item" index="index" collection="orgCdList" open="(" close=")" separator=",">
	                    #{item}
	            </foreach>
	    	</when>
	    	<otherwise>
	    		AND 1=2
	    	</otherwise>
	    </choose>
		ORDER BY ROWNUM DESC
	</select>
	
	<select id="selectMsgUsrInfo" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
			SELECT CD
			      ,CD_NM
			      ,USR_DFN_TXT_1
			      ,USR_DFN_TXT_2
			      ,USR_DFN_TXT_3
			      ,USR_DFN_TXT_4
			FROM TBDCMACM013C
			WHERE 1=1
			AND CMM_CD_DVSN_CD ='1001024'
			AND USE_YN = 'Y'
			AND CD = #{msgCd}
		 ]]>
	</select>
</mapper>
