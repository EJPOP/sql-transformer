<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.go.bai.eip.dcm.acm.dao.DCMACM045PMapper">

	<select id="selectMainList" parameterType="paramMap" resultType="egovMap" >
		<include refid="include.pageSelct" />
	    <![CDATA[
	        /* kr.go.bai.eip.dcm.acm.dao.DCMACM013PMapper.selectRprtInfoByFA*/
			SELECT 	A.MTRL_RQS_SNO,			/*자료요청순번*/
					A.MTRL_RQS_DVSN_CD,		/*자료요청구분코드*/
					F_CODE_NM('1000328',A.MTRL_RQS_DVSN_CD) AS MTRL_RQS_DVSN_NM,	/*자료요청구분코드*/
					TO_CHAR(TO_DATE(A.RQS_DT,'yyyyMMdd'),'yyyy-MM-dd') AS RQS_DT,				/*요청일*/
					D.ABR_DPT_NM_1 AS RQS_DPT_NM,	/*요청자부서명*/
					B.USR_NAM AS RQR_NAM,	/*요청자명*/
					A.RQS_TIT_NM,			/*요청제목*/
					A.RQS_TXT, /* 요청내용 */
					C.USR_NAM AS HNDL_PEN_NAM,	/*처리담당자명*/
					TO_CHAR(TO_DATE(A.HNDL_DT,'yyyyMMdd'),'yyyy-MM-dd') AS HNDL_DT,				/*처리일자*/
					A.RQR_CNB,				/*요청자전산번호*/
					A.HNDL_PEN_CNB,			/*처리자전산번호*/
					A.RQS_DPT_CD,	/*요청부서코드*/
					F_CODE_NM('1000794',A.DGE1_MNU_DVSN_CD) AS DGE1_MNU_DVSN_NM,	/*1차메뉴구분코드*/
                    A.OPEN_YN,
					A.DRTR_CNB,				/*책임자전산번호*/
					F.USR_NAM AS DRTR_NAM	/*책임자명*/
			FROM   	TBCSPIIT002M A,			/*PC장비관리테이블*/
					TBDCMACM001M B, 		/*사용자테이블(요청자)*/
					TBDCMACM001M C,			/*사용자테이블(처리자)*/
					TBDCMACM002M D,			/*부서코드(요청자)*/
					TBDCMACM002M E,			/*부서코드(처리자)*/
					TBDCMACM001M F			/*사용자테이블(책임자)*/
			WHERE	A.RQR_CNB = B.CNB(+)
			AND		A.HNDL_PEN_CNB = C.CNB(+)
			AND		A.DRTR_CNB = F.CNB(+)
			AND		A.RQS_DPT_CD = D.DPT_CD(+)
			AND		C.DPT_CD = E.DPT_CD(+)
			AND		A.COPUT_BRD_DVSN_CD = '01' /*게시판구분코드 - 전산개선요청*/
        ]]>
          <if test="rqsStrDt != null and rqsStrDt != ''"> 
			 AND	A.RQS_DT &gt;= #{rqsStrDt}
		  </if>
		   <if test="rqsEndDt != null and rqsEndDt != ''"> 
			  AND A.RQS_DT &lt;= #{rqsEndDt}
		  </if>
		   <if test="mtrlRqsDvsnCd != null and mtrlRqsDvsnCd != ''"> 
			 AND	A.MTRL_RQS_DVSN_CD = #{mtrlRqsDvsnCd}
		  </if>
		   <if test="searchNm != null and searchNm != ''"> 
			 AND	(D.DPT_NM LIKE '%'||#{searchNm}||'%'
        				OR E.DPT_NM LIKE  '%'||#{searchNm}||'%'
        				OR A.RQS_TIT_NM LIKE  '%'||#{searchNm}||'%'
        				OR A.RQS_TXT LIKE  '%'||#{searchNm}||'%'
        				OR A.HNDL_TXT LIKE  '%'||#{searchNm}||'%'
		   </if>
		   <if test="rqrNam != null and rqrNam != ''"> 
			    AND B.USR_NAM LIKE '%'||#{rqrNam}||'%'
		   </if>
		    <if test="dge1MnuDvsnCd != null and dge1MnuDvsnCd != ''"> 
			    AND A.DGE1_MNU_DVSN_CD = #{dge1MnuDvsnCd}
		   </if>
		    <if test="resultCd != null and resultCd != ''"> 
			    AND (( #{resultCd} = '1' AND	A.HNDL_DT IS NULL ) OR 
			            ( #{resultCd} = '2' AND	A.HNDL_DT IS NOT NULL))
		   </if>
		    ORDER BY 
		           TO_NUMBER(MTRL_RQS_SNO) DESC 	
	   <include refid="include.pageOrder" />
    </select>
    
    
</mapper> 