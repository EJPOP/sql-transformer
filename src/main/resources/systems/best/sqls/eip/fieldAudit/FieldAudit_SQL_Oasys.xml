<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">   
<mapper namespace="kr.go.bai.eip.fieldAudit.dao.FieldAuditMapper">
	<cache eviction="${cacheEviction}" flushInterval="${cacheFlushInterval}" size="${cacheSize}" readOnly="${cacheReadOnly}" />

	<select id="selectPrefixIdList" parameterType="paramMap" resultType="egovMap" useCache="true">	
	<![CDATA[
			SELECT '확인출장명령부'as BOARD_ID,
			       '2016-03-15'as PREFIX_ID,
			       'A' as DOC_ID
			  from dual
			 union all
			select '확인출장결과보고서',
			       '2016-04-18'
			       ,'B'
			  from dual
			 union all
			select '확인출장결과보고서2',
			       '2016-04-27'
			       ,'C'
			  from dual
	]]>			
	</select>
	<select id="selectPrefixIdList2" parameterType="paramMap" resultType="egovMap" useCache="true">		
	<![CDATA[
			WITH TEMP AS ( 
				SELECT 'A' DOC_ID, '담당' APP_ID, '결제상신' STTUS , '' STTUS_DATE FROM DUAL UNION ALL 
				SELECT 'A' DOC_ID, '국장' APP_ID, '결제완료' sttus , '20160108' STTUS_DATE  FROM DUAL UNION ALL 
				SELECT 'A' DOC_ID, '차장' APP_ID, '결제완료' sttus , '20160422' STTUS_DATE  FROM DUAL UNION ALL 
				
				SELECT 'B' DOC_ID, '국장' APP_ID, '결제완료' sttus , '20160203' STTUS_DATE  FROM DUAL UNION ALL 
				SELECT 'C' DOC_ID, '차장' APP_ID, '결제완료' sttus , '20160305' STTUS_DATE  FROM DUAL UNION ALL
				SELECT 'C' DOC_ID, '원장' APP_ID, '결제완료' sttus , '20160709' STTUS_DATE  FROM DUAL 
				
				) 
				SELECT DECODE(DOC_ID,LAG(DOC_ID,1) OVER(/*PARTITION BY DOC_ID*/ ORDER BY APP_ID),NULL,DOC_ID) DOC_ID ,APP_ID, sttus, STTUS_DATE 
				
				,CASE WHEN ROW_NUMBER() OVER(PARTITION BY DOC_ID ORDER BY APP_ID)=1 THEN COUNT(*) OVER(PARTITION BY DOC_ID) ELSE 0 END ROWSPAN_CNT 
				FROM TEMP
	]]>			
	</select>
	
	<select id="selectGuideList" parameterType="paramMap" resultType="egovMap" >		
		<include refid = "include.pageSelct"/>
	<![CDATA[
			SELECT ROWNUM AS RNUM ,
			       NOTICE_FLAG ,
				   POST_GROUP ,
			       REPLY_SORT ,
			       BOARD_ID ,
			       POST_SEQ ,
			       PARENT_POST_SEQ ,
			       REPLY_LEVEL ,
			       NOTICE_YN ,
			       PERIOD_NOTICE_YN ,
			       NOTICE_START_DT ,
			       NOTICE_END_DT ,
			       TITLE ,
			       DEL_YN ,
			       DEL_DT ,
			       DEL_USER_ID ,
			       SUBSTR(CRE_DT,0,8) AS CRE_DT ,
			       CRE_USER_ID ,
			       CRE_USER_NAME ,
			       CRE_USER_DEPT_CD ,
			       CRE_USER_DEPT_NAME ,
			       VISIT_CNT ,
			       GOOD_CNT ,
			       NO_GOOD_CNT ,
			       PREFIX_ID ,
			       PREFIX ,
			       TAG ,
			       SECRET_YN ,
			       ALLOW_CMMT_YN ,
			       PASSWORD ,
			       LAST_UPDATE ,
			       SUMMARY ,
			       FILE_CNT ,
			       CMMT_CNT ,
			       SPAM_YN ,
			       ETC0
			FROM
			(
			SELECT 'Y' AS NOTICE_FLAG ,
			       POST.POST_GROUP ,
			       POST.REPLY_SORT ,
			       POST.BOARD_ID ,
			       POST.POST_SEQ ,
			       POST.PARENT_POST_SEQ ,
			       POST.REPLY_LEVEL ,
			       POST.NOTICE_YN ,
			       POST.PERIOD_NOTICE_YN ,
			       POST.NOTICE_START_DT ,
			       POST.NOTICE_END_DT ,
			       POST.TITLE ,
			       POST.DEL_YN ,
			       POST.DEL_DT ,
			       POST.DEL_USER_ID ,
			       POST.CRE_DT ,
			       POST.CRE_USER_ID ,
			       POST.CRE_USER_NAME ,
			       POST.CRE_USER_DEPT_CD ,
			       POST.CRE_USER_DEPT_NAME ,
			       POST.VISIT_CNT ,
			       POST.GOOD_CNT ,
			       POST.NO_GOOD_CNT ,
			       POST.PREFIX_ID ,
			       POST_PREFIX.PREFIX ,
			       POST.TAG ,
			       POST.SECRET_YN ,
			       POST.ALLOW_CMMT_YN ,
			       POST.PASSWORD ,
			       POST.LAST_UPDATE ,
			       POST.SUMMARY ,
			       POST.THUMBNAIL ,
			       POST.FILE_CNT AS FILE_CNT ,
			       POST.CMMT_CNT AS CMMT_CNT ,
			       POST.SPAM_YN ,
			       POST_OPTION.ETC0 ,
			       POST_OPTION.ETC1 ,
			       POST_OPTION.ETC2 ,
			       POST_OPTION.ETC3 ,
			       POST_OPTION.ETC4 ,
			       POST_OPTION.ETC5 ,
			       POST_OPTION.ETC6 ,
			       POST_OPTION.ETC7 ,
			       POST_OPTION.ETC8 ,
			       POST_OPTION.ETC9
			  FROM CTT_POST POST ,
			       CTT_POST_PREFIX POST_PREFIX ,
			       CTT_POST_OPTION POST_OPTION
			 WHERE POST.BOARD_ID = '1577'
			   AND POST.NOTICE_YN = 'Y'
			   AND (POST.PERIOD_NOTICE_YN = 'N'
			            OR (POST.PERIOD_NOTICE_YN = 'Y'
			                   AND SYSDATE BETWEEN POST.NOTICE_START_DT AND POST.NOTICE_END_DT))
			   AND POST.BOARD_ID = POST_PREFIX.BOARD_ID(+)
			   AND POST.PREFIX_ID = POST_PREFIX.PREFIX_ID(+)
			   AND POST_OPTION.BOARD_ID(+) = POST.BOARD_ID
			   AND POST_OPTION.POST_SEQ(+) = POST.POST_SEQ
			 UNION ALL
			SELECT 'N' AS NOTICE_FLAG ,
			       POST.POST_GROUP ,
			       POST.REPLY_SORT ,
			       POST.BOARD_ID ,
			       POST.POST_SEQ ,
			       POST.PARENT_POST_SEQ ,
			       POST.REPLY_LEVEL ,
			       POST.NOTICE_YN ,
			       POST.PERIOD_NOTICE_YN ,
			       POST.NOTICE_START_DT ,
			       POST.NOTICE_END_DT ,
			       POST.TITLE ,
			       POST.DEL_YN ,
			       POST.DEL_DT ,
			       POST.DEL_USER_ID ,
			       POST.CRE_DT ,
			       POST.CRE_USER_ID ,
			       POST.CRE_USER_NAME ,
			       POST.CRE_USER_DEPT_CD ,
			       POST.CRE_USER_DEPT_NAME ,
			       POST.VISIT_CNT ,
			       POST.GOOD_CNT ,
			       POST.NO_GOOD_CNT ,
			       POST.PREFIX_ID ,
			       POST_PREFIX.PREFIX ,
			       POST.TAG ,
			       POST.SECRET_YN ,
			       POST.ALLOW_CMMT_YN ,
			       POST.PASSWORD ,
			       POST.LAST_UPDATE ,
			       POST.SUMMARY ,
			       POST.THUMBNAIL ,
			       POST.FILE_CNT AS FILE_CNT ,
			       POST.CMMT_CNT AS CMMT_CNT ,
			       POST.SPAM_YN ,
			       POST_OPTION.ETC0 ,
			       POST_OPTION.ETC1 ,
			       POST_OPTION.ETC2 ,
			       POST_OPTION.ETC3 ,
			       POST_OPTION.ETC4 ,
			       POST_OPTION.ETC5 ,
			       POST_OPTION.ETC6 ,
			       POST_OPTION.ETC7 ,
			       POST_OPTION.ETC8 ,
			       POST_OPTION.ETC9
			  FROM CTT_POST POST ,
			       CTT_POST_PREFIX POST_PREFIX ,
			       CTT_POST_OPTION POST_OPTION
			 WHERE POST.BOARD_ID = '1577'
			   AND POST.BOARD_ID = POST_PREFIX.BOARD_ID(+)
			   AND POST.PREFIX_ID = POST_PREFIX.PREFIX_ID(+)
			   AND (POST.NOTICE_YN = 'N'
			            OR (POST.PERIOD_NOTICE_YN = 'Y'
			                   AND SYSDATE NOT BETWEEN POST.NOTICE_START_DT AND POST.NOTICE_END_DT))
			   AND POST.BOARD_ID = POST_PREFIX.BOARD_ID(+)
			   AND POST.PREFIX_ID = POST_PREFIX.PREFIX_ID(+)
			   AND POST_OPTION.BOARD_ID(+) = POST.BOARD_ID
			   AND POST_OPTION.POST_SEQ(+) = POST.POST_SEQ
			 ORDER BY 1 DESC ,
			       2 DESC ,
			       3 ASC
			 )
			 WHERE 1 = 1
	]]>			
	<include refid="include.pageOrder" /> 
	</select>
	
	<select id="selectGuideDetail" parameterType="paramMap" resultType="egovMap" useCache="false">		
	<![CDATA[
			SELECT ROWNUM AS RNUM ,
			       NOTICE_FLAG ,
				   POST_GROUP ,
			       REPLY_SORT ,
			       BOARD_ID ,
			       POST_SEQ ,
			       PARENT_POST_SEQ ,
			       REPLY_LEVEL ,
			       NOTICE_YN ,
			       PERIOD_NOTICE_YN ,
			       NOTICE_START_DT ,
			       NOTICE_END_DT ,
			       TITLE ,
			       CONTENT ,
			       DEL_YN ,
			       DEL_DT ,
			       DEL_USER_ID ,
			       SUBSTR(CRE_DT,0,8) AS CRE_DT ,			       
			       CRE_USER_ID ,
			       CRE_USER_NAME ,
			       CRE_USER_DEPT_CD ,
			       CRE_USER_DEPT_NAME ,
			       VISIT_CNT ,
			       GOOD_CNT ,
			       NO_GOOD_CNT ,
			       PREFIX_ID ,
			       PREFIX ,
			       TAG ,
			       SECRET_YN ,
			       ALLOW_CMMT_YN ,
			       PASSWORD ,
			       LAST_UPDATE ,
			       SUMMARY ,
			       FILE_CNT ,
			       CMMT_CNT ,
			       SPAM_YN ,
			       ETC0
			FROM
			(
			SELECT 'Y' AS NOTICE_FLAG ,
			       POST.POST_GROUP ,
			       POST.REPLY_SORT ,
			       POST.BOARD_ID ,
			       POST.POST_SEQ ,
			       POST.PARENT_POST_SEQ ,
			       POST.REPLY_LEVEL ,
			       POST.NOTICE_YN ,
			       POST.PERIOD_NOTICE_YN ,
			       POST.NOTICE_START_DT ,
			       POST.NOTICE_END_DT ,
			       POST.TITLE ,
			       POST.CONTENT,
			       POST.DEL_YN ,
			       POST.DEL_DT ,
			       POST.DEL_USER_ID ,
			       POST.CRE_DT ,
			       POST.CRE_USER_ID ,
			       POST.CRE_USER_NAME ,
			       POST.CRE_USER_DEPT_CD ,
			       POST.CRE_USER_DEPT_NAME ,
			       POST.VISIT_CNT ,
			       POST.GOOD_CNT ,
			       POST.NO_GOOD_CNT ,
			       POST.PREFIX_ID ,
			       POST_PREFIX.PREFIX ,
			       POST.TAG ,
			       POST.SECRET_YN ,
			       POST.ALLOW_CMMT_YN ,
			       POST.PASSWORD ,
			       POST.LAST_UPDATE ,
			       POST.SUMMARY ,
			       POST.THUMBNAIL ,
			       POST.FILE_CNT AS FILE_CNT ,
			       POST.CMMT_CNT AS CMMT_CNT ,
			       POST.SPAM_YN ,
			       POST_OPTION.ETC0 ,
			       POST_OPTION.ETC1 ,
			       POST_OPTION.ETC2 ,
			       POST_OPTION.ETC3 ,
			       POST_OPTION.ETC4 ,
			       POST_OPTION.ETC5 ,
			       POST_OPTION.ETC6 ,
			       POST_OPTION.ETC7 ,
			       POST_OPTION.ETC8 ,
			       POST_OPTION.ETC9
			  FROM CTT_POST POST ,
			       CTT_POST_PREFIX POST_PREFIX ,
			       CTT_POST_OPTION POST_OPTION
			 WHERE POST.BOARD_ID = '1577'
			   AND POST.NOTICE_YN = 'Y'
			   AND (POST.PERIOD_NOTICE_YN = 'N'
			            OR (POST.PERIOD_NOTICE_YN = 'Y'
			                   AND SYSDATE BETWEEN POST.NOTICE_START_DT AND POST.NOTICE_END_DT))
			   AND POST.BOARD_ID = POST_PREFIX.BOARD_ID(+)
			   AND POST.PREFIX_ID = POST_PREFIX.PREFIX_ID(+)
			   AND POST_OPTION.BOARD_ID(+) = POST.BOARD_ID
			   AND POST_OPTION.POST_SEQ(+) = POST.POST_SEQ
			 UNION ALL
			SELECT 'N' AS NOTICE_FLAG ,
			       POST.POST_GROUP ,
			       POST.REPLY_SORT ,
			       POST.BOARD_ID ,
			       POST.POST_SEQ ,
			       POST.PARENT_POST_SEQ ,
			       POST.REPLY_LEVEL ,
			       POST.NOTICE_YN ,
			       POST.PERIOD_NOTICE_YN ,
			       POST.NOTICE_START_DT ,
			       POST.NOTICE_END_DT ,
			       POST.TITLE ,
			       POST.CONTENT,
			       POST.DEL_YN ,
			       POST.DEL_DT ,
			       POST.DEL_USER_ID ,
			       POST.CRE_DT ,
			       POST.CRE_USER_ID ,
			       POST.CRE_USER_NAME ,
			       POST.CRE_USER_DEPT_CD ,
			       POST.CRE_USER_DEPT_NAME ,
			       POST.VISIT_CNT ,
			       POST.GOOD_CNT ,
			       POST.NO_GOOD_CNT ,
			       POST.PREFIX_ID ,
			       POST_PREFIX.PREFIX ,
			       POST.TAG ,
			       POST.SECRET_YN ,
			       POST.ALLOW_CMMT_YN ,
			       POST.PASSWORD ,
			       POST.LAST_UPDATE ,
			       POST.SUMMARY ,
			       POST.THUMBNAIL ,
			       POST.FILE_CNT AS FILE_CNT ,
			       POST.CMMT_CNT AS CMMT_CNT ,
			       POST.SPAM_YN ,
			       POST_OPTION.ETC0 ,
			       POST_OPTION.ETC1 ,
			       POST_OPTION.ETC2 ,
			       POST_OPTION.ETC3 ,
			       POST_OPTION.ETC4 ,
			       POST_OPTION.ETC5 ,
			       POST_OPTION.ETC6 ,
			       POST_OPTION.ETC7 ,
			       POST_OPTION.ETC8 ,
			       POST_OPTION.ETC9
			  FROM CTT_POST POST ,
			       CTT_POST_PREFIX POST_PREFIX ,
			       CTT_POST_OPTION POST_OPTION
			 WHERE POST.BOARD_ID = '1577'
			   AND POST.BOARD_ID = POST_PREFIX.BOARD_ID(+)
			   AND POST.PREFIX_ID = POST_PREFIX.PREFIX_ID(+)
			   AND (POST.NOTICE_YN = 'N'
			            OR (POST.PERIOD_NOTICE_YN = 'Y'
			                   AND SYSDATE NOT BETWEEN POST.NOTICE_START_DT AND POST.NOTICE_END_DT))
			   AND POST.BOARD_ID = POST_PREFIX.BOARD_ID(+)
			   AND POST.PREFIX_ID = POST_PREFIX.PREFIX_ID(+)
			   AND POST_OPTION.BOARD_ID(+) = POST.BOARD_ID
			   AND POST_OPTION.POST_SEQ(+) = POST.POST_SEQ
			 ORDER BY 1 DESC ,
			       2 DESC ,
			       3 ASC
			 )
			 WHERE 1 = 1
	]]>			
			<if test='prefixId neq "" '>				
				AND PREFIX_ID = #{prefixId}				
			</if>
			<if test='postSeq neq "" '>				
				AND POST_SEQ = #{postSeq}				
			</if>
			<if test='schGType eq  "1".toString() and schGText neq "" '>
				AND TITLE LIKE '%' || #{schGText} || '%'
			</if>
			<if test='schGType eq  "2".toString() and schGText neq "" '>
				AND CONTENT LIKE '%' || #{schGText} || '%'
			</if>
			<if test='schGType eq  "3".toString() and schGText neq "" '>
				AND ( TITLE LIKE '%' || #{schGText} || '%' OR CONTENT LIKE '%' || #{schGText} || '%' )
			</if>
			<if test='schGType eq  "4".toString() and schGText neq "" '>
				AND CRE_USER_NAME LIKE '%' || #{schGText} || '%'
			</if>
			<if test='schGType eq  "" and schGText neq "" '>
				AND ( TITLE LIKE '%' || #{schGText} || '%' OR CONTENT LIKE '%' || #{schGText} || '%' OR CRE_USER_NAME LIKE '%' || #{schGText} || '%')
			</if>
			<if test='gStartDate neq "" '>
			<![CDATA[
				AND SUBSTR(CRE_DT,0,8) >= #{gStartDate}
			]]>
			</if>			
			<if test='gEndDate neq "" '>
			<![CDATA[
				AND SUBSTR(CRE_DT,0,8) <= #{gEndDate}
			]]>
			</if>
			
	</select>
	
</mapper>
