<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/bii/163">
	
	
	<!-- 연관감사정보 목록 조회 -->   
	<select id="CSPBII163PMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[       
			SELECT /* csp.bii.service.impl.CSPBII162PServiceImpl.CSPBII163PMainSelect */
			       A.YE || '-' || A.SRNO                                           AS INF_NO
			     , A.SMT_DT
			     , A.PRSR_CNB
			     , (SELECT B.USR_NAM
			          FROM TBDCMACM001M B
			         WHERE B.CNB = A.PRSR_CNB)                                     AS PRSR_NAM
			     , CASE WHEN SUBSTR(F_CODE_NM('1000097', A.INF_DVSN_CD), 1, 2) is not null THEN '(' || SUBSTR(F_CODE_NM('1000097', A.INF_DVSN_CD), 1, 2) || ')' || A.TIT_TXT
			            ELSE A.TIT_TXT
			             END AS TIT_TXT
			     , (SELECT B.ORG_NM
			          FROM TBDCMACM015M B
			         WHERE B.ORG_CD = A.REL_ORG_CD)                                AS REL_ORG_NM
			     , A.HNDL_DPT_CD
			     , (SELECT B.DPT_NM
			                 FROM TBDCMACM002M B
			                WHERE B.DPT_CD = A.HNDL_DPT_CD)                        AS HNDL_DPT_NM
			     , F_CODE_NM('1000039', A.HNDL_ORD_CD)                             AS HNDL_ORD_NM		
			     , A.AUD_INF_PRSS_STA_CD	    
			     , F_CODE_NM('1000085', A.AUD_INF_PRSS_STA_CD)                     AS AUD_INF_PRSS_STA_NM
			     , A.HNDL_DT
			     , F_CODE_NM('1000042', A.HNDL_RSLT_CD)                            AS HNDL_RSLT_NM
			     , A.OPEN_YN 
			     , A.YE
			     , A.SRNO
			     , TO_CHAR(TO_DATE(A.ACP_DT), 'YYYY-MM-DD') AS ACP_DT
			     , F_CODE_NM('1000182',GEN_ADMN_DVSN_CD) AS GEN_ADMN_DVSN_CD
			     , TO_CHAR(TO_DATE(A.DTB_DT), 'YYYY-MM-DD') AS DTB_DT
			  FROM TBCSPBII100M A
			       ,TBDCMACM001M B
			 WHERE 1=1
			   AND BLE_CHGR_CNB = #strCNB#
			   AND AUD_INF_PRSS_STA_CD IN ('10','13')
			   AND nvl(FDLTY_MNAG_SC,0) = 0 AND nvl(FDLTY_TIME_SC,0) = 0 AND nvl(FDLTY_TG_SC,0) = 0 AND nvl(FDLTY_TXT_SC,0) = 0 
			   AND nvl(FDLTY_BAS_SC,0) = 0 AND nvl(RIBLY_EVI_SC,0) = 0 AND nvl(RIBLY_IVTG_SC,0) = 0 AND nvl(UTL_INSP_SC,0) = 0 AND nvl(UTL_SPCF_SC,0) = 0 
			   AND A.PRSR_CNB = B.CNB
			   AND A.YE >= 2021
		 ORDER BY A.DTB_DT, A.ACP_DT, A.ACP_DH
		]]>

	</select>
	
	<select id="CSPBII163PMainCnt" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[       
			SELECT '일반 : '||SUM(CASE WHEN GEN_ADMN_DVSN_CD = '1' THEN 1 ELSE 0 END )||' 건, '||
				   '행정등 : '||SUM(CASE WHEN GEN_ADMN_DVSN_CD = '2' THEN 1 ELSE 0 END )||' 건, '||
				   '연구 : '||SUM(CASE WHEN GEN_ADMN_DVSN_CD = '3' THEN 1 ELSE 0 END )||' 건, '||
				   'NULL : '||SUM(CASE WHEN GEN_ADMN_DVSN_CD IS NULL THEN 1 ELSE 0 END )||' 건'  AS CNT
			  FROM TBCSPBII100M A
			       ,TBDCMACM001M B
			 WHERE 1=1
			   AND BLE_CHGR_CNB = #strCNB#
			   AND AUD_INF_PRSS_STA_CD IN ('10','13')
			   AND nvl(FDLTY_MNAG_SC,0) = 0 AND nvl(FDLTY_TIME_SC,0) = 0 AND nvl(FDLTY_TG_SC,0) = 0 AND nvl(FDLTY_TXT_SC,0) = 0 
			   AND nvl(FDLTY_BAS_SC,0) = 0 AND nvl(RIBLY_EVI_SC,0) = 0 AND nvl(RIBLY_IVTG_SC,0) = 0 AND nvl(UTL_INSP_SC,0) = 0 AND nvl(UTL_SPCF_SC,0) = 0 
			   AND A.PRSR_CNB = B.CNB
			   AND A.YE >= 2021
		
		]]>
		
	</select>
	
</sqlMap> 
