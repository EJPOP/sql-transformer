<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="aep/gkm/049">
	<resultMap class="java.util.HashMap" id="hwpDocMap">
		<result property="KNB" column="KNB" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGI_RQS_DT_Q" column="REGI_RQS_DT_Q" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGI_RQS_DT" column="REGI_RQS_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGI_DTM_DT_Q" column="REGI_DTM_DT_Q" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGI_DTM_DT" column="REGI_DTM_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KYWD_NM" column="KYWD_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KYWD_NM_1" column="KYWD_NM_1" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KYWD_NM_2" column="KYWD_NM_2" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KYWD_NM_3" column="KYWD_NM_3" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_NM" column="KLD_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_SMM_TXT" column="KLD_SMM_TXT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NEW_KLD_CAT_CD" column="NEW_KLD_CAT_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NEW_KLD_CAT_NM" column="NEW_KLD_CAT_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NEW_CAT_SPH_CD" column="NEW_CAT_SPH_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NEW_CAT_SPH_NM" column="NEW_CAT_SPH_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_SRC_NM" column="KLD_SRC_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGN_OPEN_YN" column="REGN_OPEN_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGN_OPEN_NM" column="REGN_OPEN_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_STA_CD" column="KLD_STA_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_STA_NM" column="KLD_STA_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="PRSV_WAY_CD" column="PRSV_WAY_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="PRSV_DDLN_DH" column="PRSV_DDLN_DH" jdbcType="TIMESTAMP" javaType="java.lang.String" />
		<result property="PRSV_WAY_DH" column="PRSV_WAY_DH" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_YR" column="AUD_YR" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_NO" column="AUD_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_KND_CD" column="AUD_KND_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_SBJ_NM" column="AUD_SBJ_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DSP_RQ_SNO" column="DSP_RQ_SNO" jdbcType="NUMBER" javaType="java.lang.String" />
		<result property="DSP_RQ_NM" column="DSP_RQ_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TG_ORG_CD" column="TG_ORG_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TG_ORG_NM" column="TG_ORG_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_TXT" column="KLD_TXT" jdbcType="CLOB" javaType="java.lang.String" />
		<result property="DOC_ID" column="DOC_ID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGN_NM" column="REGN_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGN_DPT_NM" column="REGN_DPT_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="EML" column="EML" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGN_CNB" column="REGN_CNB" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="COFM_YN" column="COFM_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ECL_KLD" column="ECL_KLD" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	
	
	<select id="AEPGKM049QMainselect" parameterClass="paramMap" resultMap="hwpDocMap">
		<![CDATA[  /* aep/gkm/049/AEPGKM049QMainselect */ ]]>
		SELECT  KNB,
		        TO_CHAR(TO_DATE(REGI_RQS_DT), 'YYYY-MM-DD') AS REGI_RQS_DT_Q,
		        REGI_RQS_DT,
		        TO_CHAR(TO_DATE(REGI_RQS_DT)+90, 'YYYY-MM-DD') AS REGI_DTM_DT_Q,
		        TO_CHAR(TO_DATE(REGI_RQS_DT)+90, 'YYYYMMDD') AS REGI_DTM_DT,
		        KYWD_NM_1 || 
		            (CASE WHEN TRIM(KYWD_NM_1) IS NOT NULL AND TRIM(KYWD_NM_2) IS NOT NULL
		                    THEN ' / ' || KYWD_NM_2
		            END) || 
		            (CASE WHEN (TRIM(KYWD_NM_1) IS NOT NULL OR TRIM(KYWD_NM_2) IS NOT NULL)
		                        AND TRIM(KYWD_NM_3) IS NOT NULL 
		                    THEN ' / ' || KYWD_NM_3
		            END) AS KYWD_NM,
		        KYWD_NM_1,
		        KYWD_NM_2,
		        KYWD_NM_3,
		        KLD_NM,
		        KLD_SMM_TXT,
		        NEW_KLD_CAT_CD,
		        F_CODE_NM(#cmmCdDvsnCd#, NEW_KLD_CAT_CD ) AS NEW_KLD_CAT_NM,
		        NEW_CAT_SPH_CD,
		        F_CODE_NM(#cmmCdDvsnCd2#, NEW_CAT_SPH_CD ) AS NEW_CAT_SPH_NM,
		        KLD_SRC_NM,
		        REGN_OPEN_YN,
		        DECODE(REGN_OPEN_YN,'Y','공개','비공개') AS REGN_OPEN_NM,
		        KLD_STA_CD,
		        (CASE
		            WHEN KLD_STA_CD = '7'
		            THEN F_CODE_NM('1000351', KLD_STA_CD) || ' (' || TO_CHAR(EXPR_DH, 'YYYY-MM-DD') || ')'
		            WHEN KLD_STA_CD = '8'
		            THEN F_CODE_NM('1000351', KLD_STA_CD) || ' (' || TO_CHAR(ABRG_DH, 'YYYY-MM-DD') || ')'
		            ELSE F_CODE_NM('1000351', KLD_STA_CD)
		        END) AS KLD_STA_NM,
		        PRSV_WAY_CD,
		        PRSV_DDLN_DH,
		        F_CODE_NM('1000352', PRSV_WAY_CD) || '  ' ||
		            (CASE
		                WHEN PRSV_WAY_CD = '0'
		                THEN NULL
		                ELSE TO_CHAR(PRSV_DDLN_DH, 'YYYY-MM-DD')
		             END) AS PRSV_WAY_DH,
		        AUD_YR,
		        AUD_NO,
		        AUD_KND_CD,
		        AUD_SBJ_NM,
		        DSP_RQ_SNO,
		        DSP_RQ_NM,
		        TG_ORG_CD,
		        F_ORG_INFO(TG_ORG_CD, '1') AS TG_ORG_NM,
		        KLD_TXT,
		        DOC_ID,
				F_USR_INFO(REGN_CNB, '2')||' [내선번호: '||F_USR_INFO(REGN_CNB, '6')||']' AS REGN_NM,
				REGN_DPT_NM,
				F_USR_INFO(REGN_CNB, '7') AS EML,
				REGN_CNB,
				CASE WHEN (FRT_REGI_DH+180) <![CDATA[ <= ]]> SYSTIMESTAMP THEN 'Y'
		            ELSE 'N'
		        END AS COFM_YN,
		        ECL_KLD
		FROM    TBAEPGKM001M
		WHERE	KNB = #strKnb#
	</select>
	
	<select id="AEPGKM049Qmainselect1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
	      SELECT CASE WHEN (
	              SELECT COUNT(DPT_CD) 
	                FROM TABLE(F_AUTH_DEPT(#strCnb#, 'DEPTLW', '', '')) AS IS_YN
	               WHERE 1=1
	                 AND DPT_CD = #SPV_BRDV_CD# 
	              ) >0 THEN 'Y' ELSE 'N' END AS IS_YN 
	        FROM DUAL
    	]]> 
    </select>  
	
	<update id="AEPGKM049Qdrinupdate" parameterClass="java.util.Map">
		UPDATE	TBAEPGKM001M
		SET		SRCH_CNT = (SELECT NVL(SRCH_CNT, 0) + 1 FROM TBAEPGKM001M WHERE KNB = #strKnb#)
		WHERE	KNB = #strKnb#
	</update>
	
	<insert id="AEPGKM049Qmaininsert" parameterClass="java.util.Map">
		DECLARE
			BEGIN
			INSERT INTO TBAEPGKM001M (
				KNB	/* 지식번호 */
				,KLD_NM	/* 지식명 */
				,KLD_SMM_TXT	/* 지식요약내용 */
				,KYWD_NM_1	/* 키워드명1 */
				,KYWD_NM_2	/* 키워드명2 */
				,KYWD_NM_3	/* 키워드명3 */
				,REGI_RQS_DT	/* 등록요청일 */
				,PRSV_WAY_CD	/* 보존방법코드 */
				,PRSV_DDLN_DH	/* 보존기한일시 */
				,KLD_CAT_CD	/* 지식분류코드 */
				,KLD_TXT	/* 지식내용 */
				,TG_ORG_CD	/* 대상기관코드 */
				,AUD_YR	/* 감사년도 */
				,AUD_NO	/* 감사번호 */
				,DSP_RQ_SNO	/* 처분요구순번 */
				,FUNC_SPH_CD	/* 기능분야코드 */
				,CAT_SPH_CD	/* 분류분야코드 */
				,DOC_ID	/* 문서ID */
				,DOC_TYP_CD	/* 문서유형코드 */
				,REGN_OPEN_YN	/* 등록자공개여부 */
				,KLD_STA_CD	/* 지식상태코드 */
				,SRCH_CNT	/* 조회수 */
				,EXPR_DH	/* 만기일시 */
				,ABRG_DH	/* 폐기일시 */
				,RSTR_DH	/* 복구일시 */
				,ABRG_RSN	/* 폐기사유 */
				,REGN_CNB	/* 등록자전산번호 */
				,REGN_DPT_CD	/* 등록자부서코드 */
				,REGN_DPT_NM	/* 등록자부서명 */
				,MTRL_CD	/* 자료코드 */
				,ORI_SEAT_NM	/* 원서위치명 */
				,AUD_KND_CD	/* 감사종류코드 */
				,AUD_SBJ_NM	/* 감사사항명 */
				,DSP_RQ_NM	/* 처분요구명 */
				,KLD_SRC_NM	/* 지식출처명 */
				,KLD_REGI_YR	/* 지식등록년도 */
				,FRT_USR_ID	/* 최초사용자ID */
				,FNL_USR_ID	/* 최종사용자ID */
				,FNL_DEAL_DPT_CD	/* 최종거래부서코드 */
				,FNL_MNU_ID	/* 최종메뉴ID */
				,FRT_REGI_DH	/* 최초등록일시 */
				,FNL_MDF_DH	/* 최종수정일시 */
				,NEW_KLD_CAT_CD 
				,NEW_CAT_SPH_CD
				,ECL_KLD
			)
			VALUES (
				#KNB#
				,#KLD_NM#
				,#KLD_SMM_TXT#
				,#KYWD_NM_1#
				,#KYWD_NM_2#
				,#KYWD_NM_3#
				,TO_CHAR(SYSDATE, 'YYYYMMDD')
				,#PRSV_WAY_CD#
				,#PRSV_DDLN_DH#
				,#KLD_CAT_CD#
				,#KLD_TXT#
				,#TG_ORG_CD#
				,#AUD_YR#
				,#AUD_NO#
				,#DSP_RQ_SNO#
				,#FUNC_SPH_CD#
				,#CAT_SPH_CD#
				,#DOC_ID#
				,'지식'
				,#REGN_OPEN_YN#
				,#KLD_STA_CD#
				,'0'
				,''
				,''
				,''
				,''
				,#REGN_CNB#
				,#REGN_DPT_CD#
				,#REGN_DPT_NM#
				,'6'
				,''
				,#AUD_KND_CD#
				,#AUD_SBJ_NM#
				,#DSP_RQ_NM#
				,#KLD_SRC_NM#
				,#KLD_REGI_YR#
				,#FRT_USR_ID#
				,#FNL_USR_ID#
				,#FNL_DEAL_DPT_CD#
				,#FNL_MNU_ID#
				,SYSDATE
				,SYSDATE
				,#NEW_KLD_CAT_CD#
				,#NEW_CAT_SPH_CD#
				,#ECL_KLD#
			);
			INSERT INTO TBAEPGKM018H
					(
					HST_DVSN_CD	/* 이력구분코드 */
					,HST_SNO	/* 이력순번 */
					,HST_DH	/* 이력일시 */
					,KNB	/* 지식번호 */
					,KLD_NM	/* 지식명 */
					,KLD_SMM_TXT	/* 지식요약내용 */
					,KYWD_NM_1	/* 키워드명1 */
					,KYWD_NM_2	/* 키워드명2 */
					,KYWD_NM_3	/* 키워드명3 */
					,REGI_RQS_DT	/* 등록요청일 */
					,PRSV_WAY_CD	/* 보존방법코드 */
					,PRSV_DDLN_DH	/* 보존기한일시 */
					,KLD_CAT_CD	/* 지식분류코드 */
					,KLD_TXT	/* 지식내용 */
					,TG_ORG_CD	/* 대상기관코드 */
					,AUD_YR	/* 감사년도 */
					,AUD_NO	/* 감사번호 */
					,DSP_RQ_SNO	/* 처분요구순번 */
					,FUNC_SPH_CD	/* 기능분야코드 */
					,CAT_SPH_CD	/* 분류분야코드 */
					,DOC_ID	/* 문서ID */
					,DOC_TYP_CD	/* 문서유형코드 */
					,REGN_OPEN_YN	/* 등록자공개여부 */
					,KLD_STA_CD	/* 지식상태코드 */
					,SRCH_CNT	/* 조회수 */
					,EXPR_DH	/* 만기일시 */
					,ABRG_DH	/* 폐기일시 */
					,RSTR_DH	/* 복구일시 */
					,ABRG_RSN	/* 폐기사유 */
					,REGN_CNB	/* 등록자전산번호 */
					,REGN_DPT_CD	/* 등록자부서코드 */
					,REGN_DPT_NM	/* 등록자부서명 */
					,MTRL_CD	/* 자료코드 */
					,ORI_SEAT_NM	/* 원서위치명 */
					,AUD_KND_CD	/* 감사종류코드 */
					,AUD_SBJ_NM	/* 감사사항명 */
					,KLD_SRC_NM	/* 지식출처명 */
					,KLD_REGI_YR	/* 지식등록년도 */
					,DSP_RQ_NM	/* 처분요구명 */
					,FRT_USR_ID	/* 최초사용자ID */
					,FNL_USR_ID	/* 최종사용자ID */
					,FNL_DEAL_DPT_CD	/* 최종거래부서코드 */
					,FNL_MNU_ID /* 최종메뉴ID */
					,FRT_REGI_DH /* 최초등록일시 */
					,FNL_MDF_DH /* 최종수정일시 */
					,CM_PROCESS_STATUS
					,NEW_KLD_CAT_CD 
					,NEW_CAT_SPH_CD
					,ECL_KLD
					)
			SELECT	'C' AS HST_DVSN_CD
					,(SELECT NVL(MAX(HST_SNO), 0) + 1 FROM TBAEPGKM018H WHERE HST_DH = SYSDATE) AS HST_SNO
					,SYSDATE AS HST_DH
					,KNB
					,KLD_NM
					,KLD_SMM_TXT
					,KYWD_NM_1
					,KYWD_NM_2
					,KYWD_NM_3
					,REGI_RQS_DT
					,PRSV_WAY_CD
					,PRSV_DDLN_DH
					,KLD_CAT_CD
					,KLD_TXT
					,TG_ORG_CD
					,AUD_YR
					,AUD_NO
					,DSP_RQ_SNO
					,FUNC_SPH_CD
					,CAT_SPH_CD
					,DOC_ID
					,DOC_TYP_CD
					,REGN_OPEN_YN
					,KLD_STA_CD
					,SRCH_CNT
					,EXPR_DH
					,ABRG_DH
					,RSTR_DH
					,ABRG_RSN
					,REGN_CNB
					,REGN_DPT_CD
					,REGN_DPT_NM
					,MTRL_CD
					,ORI_SEAT_NM
					,AUD_KND_CD
					,AUD_SBJ_NM
					,KLD_SRC_NM
					,KLD_REGI_YR
					,DSP_RQ_NM
					,FRT_USR_ID
					,FNL_USR_ID
					,FNL_DEAL_DPT_CD
					,FNL_MNU_ID
					,FRT_REGI_DH
					,FNL_MDF_DH
					,CM_PROCESS_STATUS
					,NEW_KLD_CAT_CD 
					,NEW_CAT_SPH_CD
					,ECL_KLD
			FROM	TBAEPGKM001M AS A
			WHERE	KNB = #KNB#;
		END;
	</insert>
	
	<delete id="AEPGKM049Qmaindelete" parameterClass="java.util.Map">
		DECLARE
			BEGIN
				INSERT INTO TBAEPGKM018H
					(
					HST_DVSN_CD	/* 이력구분코드 */
					,HST_SNO	/* 이력순번 */
					,HST_DH	/* 이력일시 */
					,KNB	/* 지식번호 */
					,KLD_NM	/* 지식명 */
					,KLD_SMM_TXT	/* 지식요약내용 */
					,KYWD_NM_1	/* 키워드명1 */
					,KYWD_NM_2	/* 키워드명2 */
					,KYWD_NM_3	/* 키워드명3 */
					,REGI_RQS_DT	/* 등록요청일 */
					,PRSV_WAY_CD	/* 보존방법코드 */
					,PRSV_DDLN_DH	/* 보존기한일시 */
					,KLD_CAT_CD	/* 지식분류코드 */
					,KLD_TXT	/* 지식내용 */
					,TG_ORG_CD	/* 대상기관코드 */
					,AUD_YR	/* 감사년도 */
					,AUD_NO	/* 감사번호 */
					,DSP_RQ_SNO	/* 처분요구순번 */
					,FUNC_SPH_CD	/* 기능분야코드 */
					,CAT_SPH_CD	/* 분류분야코드 */
					,DOC_ID	/* 문서ID */
					,DOC_TYP_CD	/* 문서유형코드 */
					,REGN_OPEN_YN	/* 등록자공개여부 */
					,KLD_STA_CD	/* 지식상태코드 */
					,SRCH_CNT	/* 조회수 */
					,EXPR_DH	/* 만기일시 */
					,ABRG_DH	/* 폐기일시 */
					,RSTR_DH	/* 복구일시 */
					,ABRG_RSN	/* 폐기사유 */
					,REGN_CNB	/* 등록자전산번호 */
					,REGN_DPT_CD	/* 등록자부서코드 */
					,REGN_DPT_NM	/* 등록자부서명 */
					,MTRL_CD	/* 자료코드 */
					,ORI_SEAT_NM	/* 원서위치명 */
					,AUD_KND_CD	/* 감사종류코드 */
					,AUD_SBJ_NM	/* 감사사항명 */
					,KLD_SRC_NM	/* 지식출처명 */
					,KLD_REGI_YR	/* 지식등록년도 */
					,DSP_RQ_NM	/* 처분요구명 */
					,FRT_USR_ID	/* 최초사용자ID */
					,FNL_USR_ID	/* 최종사용자ID */
					,FNL_DEAL_DPT_CD	/* 최종거래부서코드 */
					,FNL_MNU_ID /* 최종메뉴ID */
					,FRT_REGI_DH /* 최초등록일시 */
					,FNL_MDF_DH /* 최종수정일시 */
					,CM_PROCESS_STATUS /*공감상태코드*/
					,NEW_KLD_CAT_CD 
					,NEW_CAT_SPH_CD
					,ECL_KLD
					)
				SELECT	'D' AS HST_DVSN_CD
						,(SELECT NVL(MAX(HST_SNO), 0) + 1 FROM TBAEPGKM018H WHERE HST_DH = SYSDATE) AS HST_SNO
						,SYSDATE AS HST_DH
						,KNB
						,KLD_NM
						,KLD_SMM_TXT
						,KYWD_NM_1
						,KYWD_NM_2
						,KYWD_NM_3
						,REGI_RQS_DT
						,PRSV_WAY_CD
						,PRSV_DDLN_DH
						,KLD_CAT_CD
						,KLD_TXT
						,TG_ORG_CD
						,AUD_YR
						,AUD_NO
						,DSP_RQ_SNO
						,FUNC_SPH_CD
						,CAT_SPH_CD
						,DOC_ID
						,DOC_TYP_CD
						,REGN_OPEN_YN
						,KLD_STA_CD
						,SRCH_CNT
						,EXPR_DH
						,ABRG_DH
						,RSTR_DH
						,ABRG_RSN
						,REGN_CNB
						,REGN_DPT_CD
						,REGN_DPT_NM
						,MTRL_CD
						,ORI_SEAT_NM
						,AUD_KND_CD
						,AUD_SBJ_NM
						,KLD_SRC_NM
						,KLD_REGI_YR
						,DSP_RQ_NM
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
						,CM_PROCESS_STATUS
						,NEW_KLD_CAT_CD 
						,NEW_CAT_SPH_CD
						,ECL_KLD
				FROM	TBAEPGKM001M AS A
				WHERE	KNB = #KNB#;
				DELETE FROM TBAEPGKM001M
				WHERE KNB = #KNB#;
		END;
	</delete>
	
	<update id="AEPGKM049Qmainupdate" parameterClass="java.util.Map">
		DECLARE
			BEGIN
				UPDATE	TBAEPGKM001M
				SET		KLD_NM			= #KLD_NM#,
						KLD_SMM_TXT		= #KLD_SMM_TXT#,
						KYWD_NM_1		= #KYWD_NM_1#,
						KYWD_NM_2		= #KYWD_NM_2#,
						KYWD_NM_3		= #KYWD_NM_3#,
						PRSV_WAY_CD		= #PRSV_WAY_CD#,
						PRSV_DDLN_DH	= #PRSV_DDLN_DH#,
						KLD_CAT_CD		= #KLD_CAT_CD#,
						KLD_TXT			= #KLD_TXT#,
						TG_ORG_CD		= #TG_ORG_CD#,
						AUD_YR			= #AUD_YR#,
						AUD_NO			= #AUD_NO#,
						DSP_RQ_SNO		= #DSP_RQ_SNO#,
						FUNC_SPH_CD		= #FUNC_SPH_CD#,
						CAT_SPH_CD		= #CAT_SPH_CD#,
						DOC_ID			= #DOC_ID#,
						DOC_TYP_CD		= #DOC_TYP_CD#,
						REGN_OPEN_YN	= #REGN_OPEN_YN#,
						KLD_STA_CD		= #KLD_STA_CD#,
						AUD_KND_CD		= #AUD_KND_CD#,
						AUD_SBJ_NM		= #AUD_SBJ_NM#,
						DSP_RQ_NM		= #DSP_RQ_NM#,
						KLD_SRC_NM		= #KLD_SRC_NM#, 
						KLD_REGI_YR		= #KLD_REGI_YR#,
						FNL_USR_ID		= #FNL_USR_ID#,
						FNL_DEAL_DPT_CD	= #FNL_DEAL_DPT_CD#,
						FNL_MNU_ID		= #FNL_MNU_ID#,
						FNL_MDF_DH		= SYSDATE,
						NEW_KLD_CAT_CD	= #NEW_KLD_CAT_CD#,
						NEW_CAT_SPH_CD	= #NEW_CAT_SPH_CD#,
						ECL_KLD			= #ECL_KLD#
				WHERE	KNB				= #KNB#;
				INSERT INTO TBAEPGKM018H
					(
					HST_DVSN_CD	/* 이력구분코드 */
					,HST_SNO	/* 이력순번 */
					,HST_DH	/* 이력일시 */
					,KNB	/* 지식번호 */
					,KLD_NM	/* 지식명 */
					,KLD_SMM_TXT	/* 지식요약내용 */
					,KYWD_NM_1	/* 키워드명1 */
					,KYWD_NM_2	/* 키워드명2 */
					,KYWD_NM_3	/* 키워드명3 */
					,REGI_RQS_DT	/* 등록요청일 */
					,PRSV_WAY_CD	/* 보존방법코드 */
					,PRSV_DDLN_DH	/* 보존기한일시 */
					,KLD_CAT_CD	/* 지식분류코드 */
					,KLD_TXT	/* 지식내용 */
					,TG_ORG_CD	/* 대상기관코드 */
					,AUD_YR	/* 감사년도 */
					,AUD_NO	/* 감사번호 */
					,DSP_RQ_SNO	/* 처분요구순번 */
					,FUNC_SPH_CD	/* 기능분야코드 */
					,CAT_SPH_CD	/* 분류분야코드 */
					,DOC_ID	/* 문서ID */
					,DOC_TYP_CD	/* 문서유형코드 */
					,REGN_OPEN_YN	/* 등록자공개여부 */
					,KLD_STA_CD	/* 지식상태코드 */
					,SRCH_CNT	/* 조회수 */
					,EXPR_DH	/* 만기일시 */
					,ABRG_DH	/* 폐기일시 */
					,RSTR_DH	/* 복구일시 */
					,ABRG_RSN	/* 폐기사유 */
					,REGN_CNB	/* 등록자전산번호 */
					,REGN_DPT_CD	/* 등록자부서코드 */
					,REGN_DPT_NM	/* 등록자부서명 */
					,MTRL_CD	/* 자료코드 */
					,ORI_SEAT_NM	/* 원서위치명 */
					,AUD_KND_CD	/* 감사종류코드 */
					,AUD_SBJ_NM	/* 감사사항명 */
					,KLD_SRC_NM	/* 지식출처명 */
					,KLD_REGI_YR	/* 지식등록년도 */
					,DSP_RQ_NM	/* 처분요구명 */
					,FRT_USR_ID	/* 최초사용자ID */
					,FNL_USR_ID	/* 최종사용자ID */
					,FNL_DEAL_DPT_CD	/* 최종거래부서코드 */
					,FNL_MNU_ID /* 최종메뉴ID */
					,FRT_REGI_DH /* 최초등록일시 */
					,FNL_MDF_DH /* 최종수정일시 */
					,CM_PROCESS_STATUS /*공감상태코드*/
					,NEW_KLD_CAT_CD 
					,NEW_CAT_SPH_CD
					,ECL_KLD
					)
				SELECT	'U' AS HST_DVSN_CD
						,(SELECT NVL(MAX(HST_SNO), 0) + 1 FROM TBAEPGKM018H WHERE HST_DH = SYSDATE) AS HST_SNO
						,SYSDATE AS HST_DH
						,KNB
						,KLD_NM
						,KLD_SMM_TXT
						,KYWD_NM_1
						,KYWD_NM_2
						,KYWD_NM_3
						,REGI_RQS_DT
						,PRSV_WAY_CD
						,PRSV_DDLN_DH
						,KLD_CAT_CD
						,KLD_TXT
						,TG_ORG_CD
						,AUD_YR
						,AUD_NO
						,DSP_RQ_SNO
						,FUNC_SPH_CD
						,CAT_SPH_CD
						,DOC_ID
						,DOC_TYP_CD
						,REGN_OPEN_YN
						,KLD_STA_CD
						,SRCH_CNT
						,EXPR_DH
						,ABRG_DH
						,RSTR_DH
						,ABRG_RSN
						,REGN_CNB
						,REGN_DPT_CD
						,REGN_DPT_NM
						,MTRL_CD
						,ORI_SEAT_NM
						,AUD_KND_CD
						,AUD_SBJ_NM
						,KLD_SRC_NM
						,KLD_REGI_YR
						,DSP_RQ_NM
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
						,CM_PROCESS_STATUS
						,NEW_KLD_CAT_CD 
						,NEW_CAT_SPH_CD
						,ECL_KLD
				FROM	TBAEPGKM001M AS A
				WHERE	KNB = #KNB#;
		END;
	</update>
	
	<select id="AEPGKM049Qknbselect" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT	NVL(MAX(TO_NUMBER(KNB)), '0') + 1 AS KNB
		FROM	TBAEPGKM001M;
	</select>
	
	
	<update id="AEPGKM049Qstatusupdate" parameterClass="java.util.Map">
		UPDATE	TBAEPGKM001M
		SET		KLD_STA_CD		= #strKldStaCd#,
				<isEqual property="KLD_STA_CD" compareValue="7">
				EXPR_DH			= SYSDATE,
				</isEqual>
				<isEqual property="KLD_STA_CD" compareValue="8">
				ABRG_DH			= SYSDATE,
				</isEqual>
				<isEqual property="KLD_STA_CD" compareValue="6">
				RSTR_DH			= SYSDATE,
				</isEqual>
				FNL_USR_ID		= #FNL_USR_ID#,
				FNL_DEAL_DPT_CD	= #FNL_DEAL_DPT_CD#,
				FNL_MNU_ID		= #FNL_MNU_ID#,
				FNL_MDF_DH		= SYSDATE
		WHERE	KNB = #strKnb#
	</update>
	
	
	<select id="AepGkmCmnCodeSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
            SELECT  CMM_CD_DVSN_CD
			      , CD
			      , CD_NM
			      , CD_NM||'('||CD||')' AS CDNM_CD	      
			      , '['||CD||']'||CD_NM AS CD_CD_NM
			  FROM TBDCMACM013C
			 WHERE 1=1 
			   AND CD <> '000000000'
		       AND CMM_CD_DVSN_CD =#strCdDvsn#
		       AND CD LIKE '%000' 
		      ]]>
		      </select>
		      
	<!-- 해당지식의 댓글을 조회한다. -->
	<select id="AEPGKM049QSubselect" parameterClass="java.util.Map" resultClass="java.util.HashMap">
            SELECT D2.BOARD_ID
                 , D2.POST_SEQ
                 , D2.CMMT_SEQ
                 , D2.CONTENT                                 /*내용*/
                 , SUBSTR(D2.CRE_DT, 1, 4) || '.' || SUBSTR(D2.CRE_DT, 5, 2) || '.' || SUBSTR(D2.CRE_DT, 7, 2) AS CRE_DT /*등록일*/  
                 , D2.CRE_USER_NAME                           /*등록자*/
                 , D2.CRE_USER_ID /*등록자ID*/      
                 , '삭제' AS BTNDEL
              FROM CTT_POST D1       /*게시판*/
                 , CTT_POST_CMMT D2  /*댓글*/
             WHERE D1.BOARD_ID = D2.BOARD_ID
               AND D1.POST_SEQ = D2.POST_SEQ
               AND D1.BOARD_ID = '1550' /*고정값*/
               AND D1.POST_SEQ = #strKnb#
             ORDER BY TO_NUMBER(D2.CRE_DT) DESC
	</select>
	
	<!-- 신규건일 경우 가라 게시글이있는지 체크한다. -->
	<select id="AEPGKM049QCmmtCntselect" parameterClass="java.util.Map" resultClass="java.util.HashMap">
            SELECT TO_CHAR(COUNT(*)) AS CNT
              FROM CTT_POST          /*게시판*/
             WHERE BOARD_ID = '1550' /*고정값*/
               AND POST_SEQ = #strKnb#
	</select>
	
	<!--  신규건일 경우 가라 게시글이 없을 경우 가라게시글 만들어 줘야한다. -->
	<insert id="AEPGKM049QPostinsert" parameterClass="java.util.Map">
		INSERT 
		  INTO CTT_POST
	    	 ( 
	            BOARD_ID
	          , POST_SEQ
	          , POST_GROUP
	          , REPLY_LEVEL
	          , REPLY_SORT
	          , NOTICE_YN
	          , PERIOD_NOTICE_YN
	          , TITLE
	          , DEL_YN
	          , CRE_DT
	          , CRE_USER_ID
	          , CRE_USER_NAME
	          , CRE_USER_DEPT_CD
	          , CRE_USER_DEPT_NAME
	          , VISIT_CNT
	          , GOOD_CNT
	          , NO_GOOD_CNT
	          , SECRET_YN
              , ALLOW_CMMT_YN
	          , LAST_UPDATE
	          , FILE_CNT
	          , CMMT_CNT
	          , SPAM_YN
		 	 )
		VALUES	
		     (
		        '1550'
		      , #strKnb#
		      , #strKnb#
		      , 0
		      , '00'
		      , 'N'
		      , 'N'
		      , #strKnbNm#
		      , 'N'
		      , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
		      , #CRE_USER_ID#
		      , #CRE_USER_NAME#
		      , #CRE_USER_DEPT_CD#
		      , #CRE_USER_DEPT_NAME#
		      , 0
		      , 0
		      , 0
		      , 'N'
		      , 'N'
		      , SYSDATE
		      , 0
		      , 0
		      , 'N'
		     )
	</insert>
	
	<!-- 댓글을 등록한다. -->
	<insert id="AEPGKM049QCmmtinsert" parameterClass="java.util.Map">
		INSERT 
		  INTO CTT_POST_CMMT
	    	 ( 
				  BOARD_ID
				, POST_SEQ
				, CMMT_SEQ
				, CONTENT
				, DEL_YN
				, CRE_DT
				, CRE_USER_ID
				, CRE_USER_NAME
				, CRE_USER_DEPT_CD
				, CRE_USER_DEPT_NAME
				, SPAM_YN
		 	 )
		VALUES	
		     (
		          '1550'
		        , #strKnb#
		        , (SELECT NVL(MAX(CMMT_SEQ), 0) + 1 FROM CTT_POST_CMMT WHERE BOARD_ID = '1550' AND POST_SEQ = #strKnb#)
		        , #strContent#
		        , 'N'
		        , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
		        , #CRE_USER_ID#
		      	, #CRE_USER_NAME#
		      	, #CRE_USER_DEPT_CD#
		      	, #CRE_USER_DEPT_NAME#
		        , 'N'
		     )
	</insert>
	<update id="AEPGKM049QCmmtupdate" parameterClass="java.util.Map">
		<![CDATA[ /* AEPGKM049QupdateRcmdYn */]]>
		UPDATE	CTT_POST_CMMT
		SET		CONTENT = #strContent#
		WHERE	BOARD_ID = '1550'
		AND		POST_SEQ = #strKnb#
		AND		CMMT_SEQ = #strCmmtSeq#
	</update>
	<!-- 댓글 삭제 -->
	<delete id="AEPGKM049QCmmtdelete" parameterClass="java.util.Map">
		DELETE 
		  FROM CTT_POST_CMMT
		 WHERE BOARD_ID = '1550'
		   AND POST_SEQ = #strKnb#
		   AND CMMT_SEQ = #strCmmtSeq#
	</delete>
	
	
	<!-- 좋아요 체크 확인 -->
	<select id="AEPGKM049QselectRcmdCnt" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		<![CDATA[ /* AEPGKM049QselectRcmdCnt */]]>
		SELECT  COUNT(*) AS RCMD_YN
		FROM    TBAEPGKM021M
		WHERE	KNB = #strKnb#
		AND		CNB = #CNB#
	</select>
	
	<!-- 좋아요 체크 확인 -->
	<select id="AEPGKM049QselectRcmdYn" parameterClass="java.util.Map" resultClass="java.lang.String">
		<![CDATA[ /* AEPGKM049QselectRcmdYn */]]>
		SELECT  RCMD_YN AS ORG_RCMD_YN
		FROM    TBAEPGKM021M
		WHERE   KNB = #strKnb#
		AND     CNB = #CNB#
	</select>
	
	
	<insert id="AEPGKM049QinsertRcmdYn" parameterClass="java.util.Map">
		<![CDATA[ /* AEPGKM049QinsertRcmdYn */]]>
		INSERT 
		  INTO TBAEPGKM021M
	    	 ( 
	            KNB,
	            CNB,
	            RCMD_YN,
	            FRT_USR_ID,
	            FNL_USR_ID,
	            FNL_DEAL_DPT_CD,
	            FNL_MNU_ID,
	            FRT_REGI_DH,
	            FNL_MDF_DH
		 	 )
		VALUES	
		     (
		     	#strKnb#
		     	,#CNB#
		     	,#CHG_RCMD_YN#
				,#FRT_USR_ID#
				,#FNL_USR_ID#
				,#FNL_DEAL_DPT_CD#
				,#FNL_MNU_ID#
				,SYSDATE
				,SYSDATE
		     )
	</insert>
	
	<!--  -->
	<update id="AEPGKM049QupdateRcmdYn" parameterClass="java.util.Map">
		<![CDATA[ /* AEPGKM049QupdateRcmdYn */]]>
		UPDATE	TBAEPGKM021M
		SET		RCMD_YN = #CHG_RCMD_YN#
		WHERE	KNB = #strKnb#
		AND		CNB = #CNB#
	</update>
</sqlMap>