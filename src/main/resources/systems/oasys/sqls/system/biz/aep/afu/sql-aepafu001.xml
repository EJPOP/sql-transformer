<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="aep/afu/001">
	<select id="AEPAFU001GetEAuditApprDocInfo" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,C.AUD_STEP_NM
		      	,B.RPRT_NM
		      	,B.RPRT_CD
			  	,A.APV_RQS_ID
		      	,A.AUD_YR
		      	,A.AUD_NO
		      	,A.AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
				,F_OPEN_EDIT(B.LINK_URL) AS DOC_TYPE
				,B.RESTORE_RSN	  /* BEST20 반려사유 */ 
				,B.RESTORE_DOC_ID /* BEST20 반려시 복사된 DOC_ID */	
				,CASE 
				WHEN TRIM(B.RESTORE_RSN) IS NOT NULL THEN 'O'
         		WHEN TRIM(B.RESTORE_RSN) IS NULL THEN 'X'
			       END AS RESTORE_YN
		  FROM TBBADDED109M A
		 INNER JOIN TBBADDED103M B
		    ON A.AUD_YR = B.AUD_YR
		   AND A.AUD_NO = B.AUD_NO
		   AND A.AUD_STEP_CD = B.AUD_STEP_CD
		   AND A.DOC_ID = B.DOC_ID
		 INNER JOIN TBBADDED101M C
		    ON A.AUD_YR = C.AUD_YR
		   AND A.AUD_NO = C.AUD_NO
		   AND A.AUD_STEP_CD = C.AUD_STEP_CD
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
		   AND A.APV_DOC_DVSN_CD = #APV_DOC_DVSN_CD#
		ORDER BY A.SORT_SNO
	</select>
	
	<select id="AEPAFU001GetRequestAuditBDApprDocInfo" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,NVL(C.ACP_STEP_NM,'') AS AUD_STEP_NM
		      	,B.RPRT_NM
		      	,B.RPRT_CD
			  	,A.APV_RQS_ID
		      	,A.ACP_YR AS AUD_YR
		      	,A.ACP_SRNO AS AUD_NO
		      	,A.ACP_STEP_CD AS AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
				,A.ACP_DVSN_CD AS REQ_DVSN_CD
				,F_OPEN_EDIT(B.LINK_URL) AS DOC_TYPE 				
		  FROM TBBADFRE109M A
		 INNER JOIN TBBADFRE103M B
		    ON A.ACP_YR = B.ACP_YR
		   AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		   AND A.ACP_SRNO = B.ACP_SRNO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD
		   AND A.DOC_ID = B.DOC_ID
		 LEFT JOIN TBBADFRE101M C
		    ON A.ACP_YR = C.ACP_YR
		   AND A.ACP_DVSN_CD = C.ACP_DVSN_CD
		   AND A.ACP_SRNO = C.ACP_SRNO
		   AND A.ACP_STEP_CD = C.ACP_STEP_CD
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
		   AND A.APV_DOC_DVSN_CD = #APV_DOC_DVSN_CD#
	     ORDER BY A.SORT_SNO
	</select>
	
	<select id="AEPAFU001GetRequestAuditCPApprDocInfo" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,NVL(C.ACP_STEP_NM,'') AS AUD_STEP_NM
		      	,B.RPRT_NM
		      	,B.RPRT_CD
			  	,A.APV_RQS_ID
		      	,A.ACP_YR AS AUD_YR
		      	,A.CVPT_ACP_NO AS AUD_NO
		      	,A.ACP_STEP_CD AS AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
				,A.REQ_DVSN_CD
				,F_OPEN_EDIT(B.LINK_URL) AS DOC_TYPE 				
		  FROM TBCSPDCP609M A
		 INNER JOIN TBCSPDCP603M B
		    ON A.ACP_YR = B.ACP_YR
		   AND A.REQ_DVSN_CD = B.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD
		   AND A.DOC_ID = B.DOC_ID
		 LEFT OUTER JOIN TBCSPDCP601M C
		    ON A.ACP_YR = C.ACP_YR
		   AND A.REQ_DVSN_CD = C.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = C.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = C.ACP_STEP_CD 
		   AND B.SRNO = C.SRNO
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
		   AND A.APV_DOC_DVSN_CD = #APV_DOC_DVSN_CD#
	     ORDER BY A.SORT_SNO
	</select>
	
	<select id="AEPAFU001GetEAuditApprDocInfoByParentKey" parameterClass="paramMap" resultClass="resultMap">
		SELECT A.AUD_STEP_CD
		     , B.AUD_STEP_NM
		     , A.RPRT_NM
		     , A.RPRT_CD
		     , A.APV_RQS_ID
		      ,A.AUD_YR
		      ,A.AUD_NO
			  ,A.DOC_ID
			  ,A.APV_STA_CD
			  ,F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE			  
		  FROM TBBADDED103M A
		 INNER JOIN TBBADDED101M B
		    ON A.AUD_YR = B.AUD_YR
		   AND A.AUD_NO = B.AUD_NO
		   AND A.AUD_STEP_CD = B.AUD_STEP_CD
		 WHERE 1=1
		<isEqual property="APV_DOC_DVSN_CD" compareValue="10">
		   AND A.APV_RQS_ID IS NULL
		</isEqual> 
		<iterate property="docInfoList" prepend="AND (A.AUD_YR,A.AUD_NO,A.AUD_STEP_CD,A.DOC_ID) IN " open="(" close=")" conjunction="," >
       		(#docInfoList[].audYr#,#docInfoList[].audNo#,#docInfoList[].audStepCd#,#docInfoList[].docId#)
   		</iterate>
	</select>
	
	<select id="AEPAFU001GetRequestAuditBDApprDocInfoByParentKey" parameterClass="paramMap" resultClass="resultMap">
		SELECT  A.ACP_STEP_CD as AUD_STEP_CD
		      ,NVL(B.ACP_STEP_NM,'') as AUD_STEP_NM
		      ,A.RPRT_NM
		      ,A.RPRT_CD
		      ,A.APV_RQS_ID
		      ,A.ACP_YR as AUD_YR
		      ,A.ACP_SRNO as AUD_NO
			  ,A.DOC_ID
			  ,A.APV_STA_CD
	  	  	  ,A.ACP_DVSN_CD AS REQ_DVSN_CD
	  	  	  ,F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE	  	  	  
		  FROM TBBADFRE103M A
		  LEFT JOIN TBBADFRE101M B
		    ON A.ACP_YR = B.ACP_YR
		   AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		   AND A.ACP_SRNO = B.ACP_SRNO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD
		 WHERE 1=1
		<isEqual property="APV_DOC_DVSN_CD" compareValue="10">
		   AND A.APV_RQS_ID IS NULL
		</isEqual> 
     	   	<iterate property="docInfoList" prepend="AND (A.ACP_YR,A.ACP_DVSN_CD,A.ACP_SRNO,A.ACP_STEP_CD,A.DOC_ID) IN " open="(" close=")" conjunction="," >
				(#docInfoList[].audYr#,#docInfoList[].reqDvsnCd#,#docInfoList[].audNo#,#docInfoList[].audStepCd#,#docInfoList[].docId#)
			</iterate>
   		
	</select>
	
	<select id="AEPAFU001GetRequestAuditCPApprDocInfoByParentKey" parameterClass="paramMap" resultClass="resultMap">
		SELECT  A.ACP_STEP_CD as AUD_STEP_CD
		      ,NVL(B.ACP_STEP_NM,'') as AUD_STEP_NM
		      ,A.RPRT_NM
		      ,A.RPRT_CD
		      ,A.APV_RQS_ID
		      ,A.ACP_YR as AUD_YR
		      ,A.CVPT_ACP_NO as AUD_NO
			  ,A.DOC_ID
			  ,A.APV_STA_CD
			  ,A.REQ_DVSN_CD
			  ,F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE 			  
		  FROM TBCSPDCP603M A
		 LEFT OUTER JOIN TBCSPDCP601M B
		   ON A.ACP_YR = B.ACP_YR
		   AND A.REQ_DVSN_CD = B.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD 
		   AND A.SRNO = B.SRNO
		 WHERE 1=1
		<isEqual property="APV_DOC_DVSN_CD" compareValue="10">
		   AND A.APV_RQS_ID IS NULL
		</isEqual> 
			<iterate property="docInfoList" prepend="AND (A.ACP_YR,A.REQ_DVSN_CD,A.CVPT_ACP_NO,A.ACP_STEP_CD,A.DOC_ID) IN " open="(" close=")" conjunction="," >
				(#docInfoList[].audYr#,#docInfoList[].reqDvsnCd#,#docInfoList[].audNo#,#docInfoList[].audStepCd#,#docInfoList[].docId#)
			</iterate>
	</select>
	
	<select id="AEPAFU001GetEAuditApprAttachFileInfo" parameterClass="paramMap" resultClass="java.lang.String">
		SELECT ATTACH_FILE_ID 
		  FROM TBAEPAFU001I
		 WHERE APV_RQS_ID = #APV_DOC_NO#
	</select>
	
	<update id="AEPAFU001SaveEAuditAttachFileInfo" parameterClass="java.util.Map">
		MERGE INTO TBAEPAFU001I
		    USING DUAL
			   ON ( 
				    APV_RQS_ID  = #APV_DOC_NO#
			  	   )
			WHEN MATCHED  THEN 		
				UPDATE
				SET		ATTACH_FILE_ID 	= #NEW_ATTACH_FILE_ID#
					   ,FNL_USR_ID  	= #FNL_USR_ID#
				       ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				       ,FNL_MNU_ID 		= #FNL_MNU_ID#
				       ,FNL_MDF_DH 		= SYSDATE
		    WHEN NOT MATCHED THEN 
		        INSERT
				     ( APV_RQS_ID
				      ,ATTACH_FILE_ID
				      ,FRT_USR_ID
				      ,FNL_USR_ID
				      ,FNL_DEAL_DPT_CD
				      ,FNL_MNU_ID
				      ,FRT_REGI_DH
				      ,FNL_MDF_DH
				     )
				  VALUES
				     ( #APV_DOC_NO#					/* 결재문서코드 */
				      ,#NEW_ATTACH_FILE_ID#         /* ECM DOC_ID */
				      ,#FNL_USR_ID#                 /* 최초사용자ID */
				      ,#FNL_USR_ID#                 /* 최종사용자ID */
				      ,#FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
				      ,#FNL_MNU_ID#                 /* 최종메뉴ID */
				      ,SYSDATE                      /* 최초등록일시 */
				      ,SYSDATE                      /* 최종수정일시 */
				     )
	</update>
	
	<update id="AEPAFU001EAudInfHndlStatUpdate" parameterClass="java.util.Map">
		UPDATE /* aep.afu.service.impl.AEPAFU001ServiceImpl.AEPAFU001EAudInfHndlSbmUpdate */
			   TBBADDED103M                       
		   SET APV_RQS_ID          = #APV_DOC_ID#                 /* 결재문서번호 */
		     , APV_STA_CD 		   = #APV_STA_CD#                 /* 결재진행상태코드[2:결재중, 3:승인, 4:반려, 5:상신취소] */
		     , FNL_USR_ID          = #FNL_USR_ID#                 /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD     = #FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
		     , FNL_MNU_ID          = #FNL_MNU_ID#                 /* 최종메뉴ID */
		     , FNL_MDF_DH          = SYSDATE                      /* 최종수정일시 */
		 WHERE AUD_YR			   = REGEXP_SUBSTR(#INF_NO#, '[^|]+', 1, 1)
		   AND AUD_NO			   = REGEXP_SUBSTR(#INF_NO#, '[^|]+', 1, 2)
		   AND AUD_STEP_CD		   = REGEXP_SUBSTR(#INF_NO#, '[^|]+', 1, 3)
		   AND DOC_ID			   = REGEXP_SUBSTR(#INF_NO#, '[^|]+', 1, 4)
	</update>
	
	<delete id="AEPAFU001DeleteAllDocApprInfoByApvRqsId" parameterClass="java.util.Map">
		DELETE 
		  FROM TBBADDED109M
		 WHERE APV_RQS_ID = #APV_DOC_NO#
	</delete>
	
	<update id="AEPAFU001InitApvRqsIdByApvRqsId" parameterClass="java.util.Map">
		UPDATE TBBADDED103M
		   SET  APV_RQS_ID = NULL
		      , APV_STA_CD = '10' /*문서함 결재정보 초기화 시 작성중(10) 으로 세팅*/
		      , FNL_USR_ID          = #FNL_USR_ID#                 /* 최종사용자ID */
		      , FNL_DEAL_DPT_CD     = #FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
		      , FNL_MNU_ID          = #FNL_MNU_ID#                 /* 최종메뉴ID */
		      , FNL_MDF_DH          = SYSDATE                      /* 최종수정일시 */
		 WHERE APV_RQS_ID = #APV_DOC_NO#
	</update>
	
	<insert id="AEPAFU001InsertDocApprInfo" parameterClass="java.util.Map">
		INSERT INTO TBBADDED109M
		      ("APV_RQS_ID",
		       "AUD_YR",
		       "AUD_NO",
		       "AUD_STEP_CD",
		       "DOC_ID",
		       "APV_DVSN_CD",
		       "APV_DOC_DVSN_CD",
		       "SORT_SNO",
		       "FRT_USR_ID",
		       "FNL_USR_ID",
		       "FNL_DEAL_DPT_CD",
		       "FNL_MNU_ID",
		       "FRT_REGI_DH",
		       "FNL_MDF_DH")
		VALUES(#APV_DOC_NO#,
			   #AUD_YR#,
			   #AUD_NO#,
			   #AUD_STEP_CD#,
			   #DOC_ID#,
			   #APV_DVSN_CD#,
			   #APV_DOC_DVSN_CD#,
			   #SORT_SNO#,
			   #FRT_USR_ID#,
			   #FNL_USR_ID#,
			   #FNL_DEAL_DPT_CD#,
			   #FNL_MNU_ID#,
		       SYSDATE,
		       SYSDATE);
	</insert>
	
	<update id="AEPAFU001UpdateDocInfoByApvInfo" parameterClass="java.util.Map">
		<![CDATA[  
			UPDATE TBBADDED103M
			   SET APV_STA_CD = DECODE(#APV_STA_CD# ,'20',DECODE((SELECT COUNT(*) 
	                                                     FROM TBDCMACM023L 
	                                                    WHERE APV_DOC_NO = #APV_DOC_NO# 
	                                                      AND APVR_KND_CD <> '1' 
	                                                      AND APVR_SEQ <> 1 
	                                                      AND APV_DH IS NOT NULL
	                                                      AND SUBSTR(APVR_STA_CD, 0,1) = '2'),0,'20','25')
	                                           ,#APV_STA_CD#)
			      ,APV_RQS_ID = #APV_DOC_NO#
			      , FNL_USR_ID          = #FNL_USR_ID#                 /* 최종사용자ID */
			      , FNL_DEAL_DPT_CD     = #FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
			      , FNL_MNU_ID          = #FNL_MNU_ID#                 /* 최종메뉴ID */
			      , FNL_MDF_DH          = SYSDATE                      /* 최종수정일시 */
		]]>
			    <isNotEmpty property="RESTORE_RSN">
				  , RESTORE_RSN			= #RESTORE_RSN#  /* 반려의견 */
				</isNotEmpty> 
	    		<isNotEmpty property="RESTORE_DOC_ID">
				  , RESTORE_DOC_ID		= #RESTORE_DOC_ID#  /* 반려문서ID */
	    		</isNotEmpty>     
		<![CDATA[  
			 WHERE AUD_YR = #AUD_YR#
			   AND AUD_NO = #AUD_NO#
			   AND AUD_STEP_CD = #AUD_STEP_CD#
			   AND DOC_ID = #DOC_ID#
		]]>
	</update>
	
	<update id="AEPAFU001UpdateApvStatInfo" parameterClass="java.util.Map">
		UPDATE TBBADDED103M
		   SET APV_STA_CD = #APV_STA_CD#
		     , FNL_USR_ID          = #FNL_USR_ID#                 /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD     = #FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
		     , FNL_MNU_ID          = #FNL_MNU_ID#                 /* 최종메뉴ID */
		     , FNL_MDF_DH          = SYSDATE                      /* 최종수정일시 */
		 WHERE APV_RQS_ID = #APV_DOC_NO#
	</update>
	
	<select id="AEPAFU001SelectAudDocList" parameterClass="paramMap" resultClass="resultMap">
	       SELECT B.AUD_STEP_NM, A.RPRT_NM, A.FNL_MDF_DH, A.APV_RQS_ID, A.AUD_YR, A.AUD_NO, A.AUD_STEP_CD, A.DOC_ID, A.SORT_SNO, A.FRT_USR_ID, A.FNL_USR_ID, A.FNL_DEAL_DPT_CD, A.FNL_MNU_ID, A.FRT_REGI_DH
             FROM TBBADDED103M A
       INNER JOIN TBBADDED101M B
               ON A.AUD_YR = B.AUD_YR
              AND A.AUD_NO = B.AUD_NO
              AND A.AUD_STEP_CD = B.AUD_STEP_CD
            WHERE A.APV_RQS_ID IS NULL AND A.RPRT_NM LIKE '%' || #schText# || '%'
	</select>
	
	<update id="AEPAFU001ChangeStaApvRqsIdByApvRqsId" parameterClass="java.util.Map">
		<![CDATA[  
			UPDATE TBBADDED103M
			   SET  APV_STA_CD = DECODE(#APV_STA_CD# ,'20',DECODE((SELECT COUNT(*) 
	                                                     FROM TBDCMACM023L 
	                                                    WHERE APV_DOC_NO = #APV_DOC_NO# 
	                                                      AND APVR_KND_CD <> '1' 
	                                                      AND APVR_SEQ <> 1 
	                                                      AND APV_DH IS NOT NULL
	                                                      AND SUBSTR(APVR_STA_CD, 0,1) = '2'),0,'20','25')
	                                           ,#APV_STA_CD#)
			      , FNL_USR_ID          = #FNL_USR_ID#                 /* 최종사용자ID */
			      , FNL_DEAL_DPT_CD     = #FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
			      , FNL_MNU_ID          = #FNL_MNU_ID#                 /* 최종메뉴ID */
			      , FNL_MDF_DH          = SYSDATE                      /* 최종수정일시 */
			 WHERE APV_RQS_ID = #APV_DOC_NO#
		]]>
	</update>
	
	<select id="AEPAFU001GetApvDocKndByApvDocNo" parameterClass="paramMap" resultClass="resultMap">
			SELECT AUD_YR, AUD_NO, AUD_STEP_CD, DOC_ID, REF_ID, REF_DY, RPRT_CD, APV_STA_CD, AUD_RPRT_DVSN_CD, NVL(FNL_BAI_RPRT_YN,'N') AS FNL_BAI_RPRT_YN
			 FROM TBBADDED103M
			WHERE APV_RQS_ID = #APV_DOC_NO#
	</select>
	
	<update id="AEPAFU001AfterProcessByChfDescRprt" parameterClass="java.util.Map">
		<![CDATA[  
			 UPDATE TBBADDED102M
				SET CMPT_YN 		 = 'Y'
				WHERE AUD_YR 		 = #AUD_YR#
				AND AUD_NO		 	 = #AUD_NO#
				AND AUD_STEP_CD 	 = #AUD_STEP_CD#
				AND AUD_MAIN_STEP_ID = #AUD_MAIN_STEP_ID#
				AND AUD_MAIN_STEP_SNO = (SELECT T3.AUD_MAIN_STEP_SNO
				                        FROM 
				                            TBBADDED103M T1
				                            INNER JOIN TBBADDED112D T2
				                            ON (T1.AUD_YR = T2.AUD_YR AND T1.AUD_NO = T2.AUD_NO AND T1.REF_ID = T2.DOC_ID)
				                            INNER JOIN TBBADDED102M T3
				                            ON (T2.AUD_YR = T3.AUD_YR AND T2.AUD_NO = T3.AUD_NO AND T2.SBCN_TRTM_DTL_SNO = T3.AUD_MAIN_STEP_SNO AND T3.AUD_MAIN_STEP_ID = #AUD_MAIN_STEP_ID#)
				                        WHERE 
				                            T1.AUD_YR = #AUD_YR#
				                        AND T1.AUD_NO = #AUD_NO#
				                        AND T1.AUD_STEP_CD = #AUD_STEP_CD#
				                        AND T1.DOC_ID = #DOC_ID#)
		]]>
	</update>
	
	<update id="AEPAFU001UpdateDocEdtAuth" parameterClass="java.util.Map">
		<![CDATA[  
		 UPDATE TBBADDED103M
			SET EDT_AUTH 		 = #EDT_AUTH#
			WHERE DOC_ID 		 = #DOC_ID#
		]]>
	</update>
	
	<update id="AEPAFU001UpdateEnfCprDt" parameterClass="java.util.Map">
		<![CDATA[  
			UPDATE TBBADDED113M
			   SET ENF_JA_CPR_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
			 WHERE DOC_ID = (SELECT DOC_ID FROM TBBADDED103M
			                 WHERE DOC_ID = (SELECT REF_ID FROM TBBADDED103M
			                                  WHERE DOC_ID = (SELECT REF_ID FROM TBBADDED103M
			                                                   WHERE DOC_ID = #DOC_ID#)))
			  AND ENF_JA_CPR_DT IS NULL
		]]>
	</update>

  
  
	<update id="AEPAFU001UpdateSbcnDocApvStaCd" parameterClass="java.util.Map">
		<![CDATA[  
		 UPDATE TBBADDED103M
			SET APV_STA_CD		 = '30'
			WHERE DOC_ID 		 = #DOC_ID#
		]]>
	</update>
	
	<update id="AEPAFU001UpdateDocEdtAuthByRefId" parameterClass="java.util.Map">
		<![CDATA[  
		 UPDATE TBBADDED103M
			SET EDT_AUTH 		 = #EDT_AUTH#
			WHERE DOC_ID 		 = #REF_ID#
		]]>
	</update>
	
	<select id="AEPAFU001TrtmInsertYnByAudRprt" parameterClass="paramMap" resultClass="resultMap">
		SELECT 
		    DECODE((SELECT COUNT(1) FROM TBBADDED112M WHERE AUD_YR = #AUD_YR# AND AUD_NO = #AUD_NO#),0,'Y','N') AS TRTM_MAIN_INSERT_YN 
		    , DECODE((SELECT COUNT(1) FROM TBBADDED112D WHERE AUD_YR = #AUD_YR# AND AUD_NO = #AUD_NO# AND DOC_ID = #DOC_ID#),0,'Y','N') AS TRTM_DTL_INSERT_YN
		FROM DUAL
	</select>
	
	<select id="AEPAFU001GetApvrInfoByAudRprt" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT AUD_RPRT_DVSN_CD, DOC_ID, APVR_PST_CD, APVR_RANK_CD, APVR_CNB, APVR_DPT_CD
		  FROM (
		  		SELECT A.AUD_RPRT_DVSN_CD, A.DOC_ID, B.APVR_PST_CD, B.APVR_RANK_CD, B.APVR_CNB, B.APVR_DPT_CD
		  		  FROM TBBADDED103M A
				     , TBDCMACM023L B
				 WHERE B.APV_DOC_NO = #APV_DOC_NO#
				   AND A.APV_RQS_ID = B.APV_DOC_NO
				   AND B.APV_SNO = (
									SELECT MAX(D.APV_SNO)+1
								  	  FROM TBBADDED103M C
									  	 , TBDCMACM023L D
				 					 WHERE D.APV_DOC_NO = B.APV_DOC_NO
									   AND C.APV_RQS_ID = D.APV_DOC_NO
									   AND D.APV_SNO <> 1
									   AND C.RPRT_CD = #RPRT_CD#
									   AND D.APVR_STA_CD IN ('202','203','204')
									   AND D.APVR_CNB = #CNB#  
									)
				   AND A.RPRT_CD = #RPRT_CD#
                   AND A.DOC_ID = #DOC_ID#
				   AND B.APVR_KND_CD IN('2','3','4','9') /* 공석자 추가. 2017.08.02 sk손힘찬*/
			   )
	]]>
	</select>
	
	<select id="AEPAFU001GetApvrInfoByFrsRprt" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT AUD_RPRT_DVSN_CD, DOC_ID, APVR_PST_CD, APVR_DPT_CD
		  FROM (
		  		SELECT A.AUD_RPRT_DVSN_CD, A.DOC_ID, B.APVR_PST_CD, B.APVR_DPT_CD
		  		  FROM TBBADDED103M A
				     , TBDCMACM023L B
				 WHERE B.APV_DOC_NO = #APV_DOC_NO#
				   AND A.APV_RQS_ID = B.APV_DOC_NO
				   AND B.APV_SNO = (
									SELECT MAX(D.APV_SNO)+1
								  	  FROM TBBADDED103M C
									  	 , TBDCMACM023L D
				 					 WHERE D.APV_DOC_NO = B.APV_DOC_NO
									   AND C.APV_RQS_ID = D.APV_DOC_NO
									   AND D.APV_SNO <> 1
									   AND C.RPRT_CD = #RPRT_CD#
									   AND D.APVR_STA_CD IN ('202','203','204')
									   AND D.APVR_CNB = #CNB#  
									)
				   AND A.RPRT_CD = #RPRT_CD#
                   AND A.DOC_ID = #DOC_ID#
				   AND B.APVR_KND_CD IN('2','3','4','9')
			   )
	]]>
	</select>	
	
	<select id="AEPAFU001GetApvrInfoByAudRprt2" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT APVR_CNB,
                 APVR_DPT_CD,
                 APVR_RANK_CD,
                 APVR_PST_CD
            FROM TBDCMACM023L
           WHERE APV_DOC_NO = #APV_DOC_NO#
             AND APV_SNO = ( SELECT MAX(APV_SNO) +1
                                 FROM TBDCMACM023L
                                WHERE APV_DOC_NO = #APV_DOC_NO#
                                  AND APVR_STA_CD IN('201','202','203','204')
                                  AND APVR_CNB = #CNB#)
	]]>
	</select>
	
	<insert id="AEPAFU001InsertTBBADDED145MByAudRprt" parameterClass="java.util.Map">
	<![CDATA[
	DECLARE
		BEGIN
		INSERT INTO TBBADDED145H
				  ( HST_DVSN_CD
				  , HST_SNO
				  , HST_DH
				  , HST_USR_ID	
				  , AUD_YR
				  , AUD_NO
				  , AUD_STEP_CD
				  , DOC_ID
				  , APVR_CD
				  , AFF_SNO
				  , AUD_KND_CD
				  , AUD_GRN_NO
				  , RPRT_FILD_ID
				  , AFF_CD
				  , LIST_NO
				  , REFER_DVSN_CD
				  , AFF_SPH
				  , TITLE_NM
				  , DP_TITLE_NM
				  , QST_DOC_ISUE_YN
				  , QST_DOC_ISUE_DY
				  , AUDTOR
				  , DETL_DOC_NO
				  , MTRL_IPT_DVSN_CD
				  , SYT_TRTM_DVSN_YN
				  , SCRT_YN
				  , SORT_SNO
				  , TRTM_EXAMER_CNB 
				  , FRT_USR_ID 
				  , FNL_USR_ID
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID
				  , FRT_REGI_DH
				  , FNL_MDF_DH
				  , FNL_YN)
			( SELECT 'C',
                     TBBADDED145H_SEQ.NEXTVAL,
                     SYSDATE,
                     FRT_USR_ID,
					 AUD_YR,
					 AUD_NO,
					 AUD_STEP_CD,
					 DOC_ID,
					 APVR_CD,
					 AFF_SNO,
					 AUD_KND_CD,
					 AUD_GRN_NO,
					 RPRT_FILD_ID,
					 AFF_CD,
					 LIST_NO,
					 REFER_DVSN_CD,
					 AFF_SPH,
					 TITLE_NM,
					 TITLE_NM,
					 QST_DOC_ISUE_YN,
					 QST_DOC_ISUE_DY,
					 AUDTOR,
					 DETL_DOC_NO,
					 MTRL_IPT_DVSN_CD,
					 SYT_TRTM_DVSN_YN,
					 SCRT_YN,
					 SORT_SNO,
					 TRTM_EXAMER_CNB,
					 FRT_USR_ID,
					 FNL_USR_ID,
					 FNL_DEAL_DPT_CD,
					 FNL_MNU_ID,
					 FRT_REGI_DH,
					 FNL_MDF_DH,
					 FNL_YN                      						
	            FROM (
					 SELECT DISTINCT AA.AUD_YR
						  , AA.AUD_NO
						  , DECODE(#APVR_PST_CD#, '0010600', 'A1070', AA.AUD_STEP_CD) AS AUD_STEP_CD
						  , AA.DOC_ID
						  , #APVR_PST_CD# AS APVR_CD
						  , AA.AFF_SNO
						  , AA.AUD_KND_CD
						  , AA.AUD_GRN_NO
						  , AA.RPRT_FILD_ID
						  , AA.AFF_CD
						  , AA.LIST_NO
						  , AA.REFER_DVSN_CD
						  , AA.AFF_SPH
						  , AA.TITLE_NM
						  , AA.QST_DOC_ISUE_YN
						  , AA.QST_DOC_ISUE_DY
						  , AA.AUDTOR
						  , AA.DETL_DOC_NO
						  , AA.MTRL_IPT_DVSN_CD
						  , AA.SYT_TRTM_DVSN_YN
						  , AA.SCRT_YN
						  , AA.SORT_SNO
						  , AA.TRTM_EXAMER_CNB
						  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB) AS FRT_USR_ID
						  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB) AS FNL_USR_ID
						  , (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB) AS FNL_DEAL_DPT_CD
						  , #FNL_MNU_ID# AS FNL_MNU_ID
						  , SYSDATE AS FRT_REGI_DH
						  , SYSDATE AS FNL_MDF_DH
						  , AA.FNL_YN
				      FROM TBBADDED145M AA
					     , ( 
					       SELECT A.DOC_ID, B.APVR_CNB, 
		                          CASE WHEN B.APVR_PST_CD IN ('0058100','0035100') THEN '0015800'
		                               WHEN B.APVR_PST_CD = ('0045900') THEN '0055600'
		                               WHEN B.APVR_PST_CD IN ('0057400','0035400') THEN '0013600'
		                               ELSE B.APVR_PST_CD
		                          END AS APVR_PST_CD
						     FROM TBBADDED103M A
							    , TBDCMACM023L B
						    WHERE B.APV_DOC_NO = #APV_DOC_NO#
						      AND A.APV_RQS_ID = B.APV_DOC_NO
						      AND B.APV_SNO = (
											  SELECT MAX(D.APV_SNO)
												FROM TBBADDED103M C
												   , TBDCMACM023L D
											   WHERE D.APV_DOC_NO = B.APV_DOC_NO
												 AND C.APV_RQS_ID = D.APV_DOC_NO
												 AND D.APV_SNO <> 1
											     AND C.RPRT_CD = #RPRT_CD#
											     AND C.DOC_ID = #DOC_ID#
											     AND D.APVR_STA_CD IN ('202','203','204')
		                                         AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
											  )
						      AND A.RPRT_CD = #RPRT_CD#
						      AND B.APVR_STA_CD IN ('202','203','204')
						      AND A.DOC_ID = #DOC_ID#
						      AND ROWNUM = 1
				 		   ) BB
				 		 , TBBADDED146M CC
				 	 WHERE AA.DOC_ID = #DOC_ID#
				 	   AND AA.DOC_ID = BB.DOC_ID
				   	   AND CASE WHEN AA.APVR_CD IN ('0058100','0035100') THEN '0015800'
		                        WHEN AA.APVR_CD = ('0045900') THEN '0055600'
		                        ELSE AA.APVR_CD
		                   END = BB.APVR_PST_CD 
		               AND AA.AUD_YR = CC.AUD_YR
		               AND AA.AUD_NO = CC.AUD_NO
		               AND AA.DOC_ID = CC.DOC_ID
		               AND AA.APVR_CD = CC.APVR_CD
		               AND AA.AFF_SNO = CC.AFF_SNO
		               AND NOT EXISTS (
		                               SELECT 1 
		                                 FROM TBBADDED147M ZZ
									 INNER JOIN TBBADDED148M YY
									 		 ON ZZ.AUD_YR 		= YY.AUD_YR
											AND ZZ.AUD_NO 		= YY.AUD_NO
											AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
											AND ZZ.DOC_ID 		= YY.DOC_ID
											AND ZZ.APVR_CD 		= YY.APVR_CD
											AND ZZ.AFF_SNO 		= YY.AFF_SNO
											AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
											AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                                 
		                                WHERE ZZ.AUD_YR = AA.AUD_YR
		                                  AND ZZ.AUD_NO = AA.AUD_NO
		                                  AND ZZ.DOC_ID = AA.DOC_ID
		                                  AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || AA.AFF_CD || '-' || CC.AFF_DSP_CD
		                                  AND CASE WHEN ZZ.APVR_CD IN ('0058100','0035100') THEN '0015800'
		                                           WHEN ZZ.APVR_CD = ('0045900') THEN '0055600'
		                                           ELSE ZZ.APVR_CD
		                                      END 
		                                       = 
		                                      CASE WHEN #APVR_PST_CD# IN ('0058100','0035100') THEN '0015800'
		                                           WHEN #APVR_PST_CD# = ('0045900') THEN '0055600'
		                                           ELSE #APVR_PST_CD#
		                                      END
		                                  AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
		                              ) ) )
                  ;		
		INSERT INTO TBBADDED145M
				  ( AUD_YR
				  , AUD_NO
				  , AUD_STEP_CD
				  , DOC_ID
				  , APVR_CD
				  , AFF_SNO
				  , AUD_KND_CD
				  , AUD_GRN_NO
				  , RPRT_FILD_ID
				  , AFF_CD
				  , LIST_NO
				  , REFER_DVSN_CD
				  , AFF_SPH
				  , TITLE_NM
				  , DP_TITLE_NM
				  , QST_DOC_ISUE_YN
				  , QST_DOC_ISUE_DY
				  , AUDTOR
				  , DETL_DOC_NO
				  , MTRL_IPT_DVSN_CD
				  , SYT_TRTM_DVSN_YN
				  , SCRT_YN
				  , SORT_SNO
				  , TRTM_EXAMER_CNB 
				  , FRT_USR_ID 
				  , FNL_USR_ID
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID
				  , FRT_REGI_DH
				  , FNL_MDF_DH
				  , FNL_YN)
			(SELECT DISTINCT AA.AUD_YR
				  , AA.AUD_NO
				  , DECODE(#APVR_PST_CD#, '0010600', 'A1070', AA.AUD_STEP_CD)
				  , AA.DOC_ID
				  , #APVR_PST_CD#
				  , AA.AFF_SNO
				  , AA.AUD_KND_CD
				  , AA.AUD_GRN_NO
				  , AA.RPRT_FILD_ID
				  , AA.AFF_CD
				  , AA.LIST_NO
				  , AA.REFER_DVSN_CD
				  , AA.AFF_SPH
				  , AA.TITLE_NM
				  , AA.TITLE_NM
				  , AA.QST_DOC_ISUE_YN
				  , AA.QST_DOC_ISUE_DY
				  , AA.AUDTOR
				  , AA.DETL_DOC_NO
				  , AA.MTRL_IPT_DVSN_CD
				  , AA.SYT_TRTM_DVSN_YN
				  , AA.SCRT_YN
				  , AA.SORT_SNO
				  , AA.TRTM_EXAMER_CNB
				  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB)
				  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB)
				  , (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB)
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE
				  , AA.FNL_YN
		      FROM TBBADDED145M AA
			     , ( 
			       SELECT A.DOC_ID, B.APVR_CNB, 
                          CASE WHEN B.APVR_PST_CD IN ('0058100','0035100') THEN '0015800'
                               WHEN B.APVR_PST_CD = ('0045900') THEN '0055600'
                               WHEN B.APVR_PST_CD IN ('0057400','0035400') THEN '0013600'
                               ELSE B.APVR_PST_CD
                          END AS APVR_PST_CD
				     FROM TBBADDED103M A
					    , TBDCMACM023L B
				    WHERE B.APV_DOC_NO = #APV_DOC_NO#
				      AND A.APV_RQS_ID = B.APV_DOC_NO
				      AND B.APV_SNO = (
									  SELECT MAX(D.APV_SNO)
										FROM TBBADDED103M C
										   , TBDCMACM023L D
									   WHERE D.APV_DOC_NO = B.APV_DOC_NO
										 AND C.APV_RQS_ID = D.APV_DOC_NO
										 AND D.APV_SNO <> 1
									     AND C.RPRT_CD = #RPRT_CD#
									     AND C.DOC_ID = #DOC_ID#
									     AND D.APVR_STA_CD IN ('202','203','204')
                                         AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
									  )
				      AND A.RPRT_CD = #RPRT_CD#
				      AND B.APVR_STA_CD IN ('202','203','204')
				      AND A.DOC_ID = #DOC_ID#
				      AND ROWNUM = 1
		 		   ) BB
		 		 , TBBADDED146M CC
		 	 WHERE AA.DOC_ID = #DOC_ID#
		 	   AND AA.DOC_ID = BB.DOC_ID
		   	   AND CASE WHEN AA.APVR_CD IN ('0058100','0035100') THEN '0015800'
                        WHEN AA.APVR_CD = ('0045900') THEN '0055600'
                        ELSE AA.APVR_CD
                   END = BB.APVR_PST_CD 
               AND AA.AUD_YR = CC.AUD_YR
               AND AA.AUD_NO = CC.AUD_NO
               AND AA.DOC_ID = CC.DOC_ID
               AND AA.APVR_CD = CC.APVR_CD
               AND AA.AFF_SNO = CC.AFF_SNO
               AND NOT EXISTS (
                               SELECT 1 
                                 FROM TBBADDED147M ZZ
							 INNER JOIN TBBADDED148M YY
							 		 ON ZZ.AUD_YR 		= YY.AUD_YR
									AND ZZ.AUD_NO 		= YY.AUD_NO
									AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
									AND ZZ.DOC_ID 		= YY.DOC_ID
									AND ZZ.APVR_CD 		= YY.APVR_CD
									AND ZZ.AFF_SNO 		= YY.AFF_SNO
									AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
									AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                                 
                                WHERE ZZ.AUD_YR = AA.AUD_YR
                                  AND ZZ.AUD_NO = AA.AUD_NO
                                  AND ZZ.DOC_ID = AA.DOC_ID
                                  AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || AA.AFF_CD || '-' || CC.AFF_DSP_CD
                                  AND CASE WHEN ZZ.APVR_CD IN ('0058100','0035100') THEN '0015800'
                                           WHEN ZZ.APVR_CD = ('0045900') THEN '0055600'
                                           ELSE ZZ.APVR_CD
                                      END 
                                       = 
                                      CASE WHEN #APVR_PST_CD# IN ('0058100','0035100') THEN '0015800'
                                           WHEN #APVR_PST_CD# = ('0045900') THEN '0055600'
                                           ELSE #APVR_PST_CD#
                                      END
                                  AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
                              ) )
                    ;
             END;
	]]>
	</insert>
	
	<insert id="AEPAFU001InsertTBBADDED146MByAudRprt" parameterClass="java.util.Map">
	<![CDATA[
	DECLARE
		BEGIN
		INSERT INTO TBBADDED146H
					  ( HST_DVSN_CD
				  	  , HST_SNO
				 	  , HST_DH
				  	  , HST_USR_ID	
					  , AUD_YR
					  , AUD_NO
					  , AUD_STEP_CD
					  , DOC_ID
					  , APVR_CD
					  , AFF_SNO
					  , DSP_RQ_SNO
					  , DP_DSP_RQ_SNO
					  , AUD_KND_CD
					  , AUD_GRN_NO
					  , RPRT_FILD_ID
					  , AFF_DSP_CD
					  , RLTN_ORG_CD
					  , HND_ORG_CD
					  , REF_ORG_CD
					  , DSP_RQ_CD
					  , MTRL_IPT_DVSN_CD
					  , NOP_AM_DVSN_CD
					  , NOP_AM
					  , SORT_SNO
					  , FRT_USR_ID
					  , FNL_USR_ID
					  , FNL_DEAL_DPT_CD
					  , FNL_MNU_ID
					  , FRT_REGI_DH
					  , FNL_MDF_DH
					  , FNL_YN
					  , ACCN_INSP_CD
					  , NOP_SUM
					  , HD_AUD_STEP_CD	
					  , HD_DOC_ID	
					  , HD_APVR_CD	
					  , HD_AFF_SNO	
					  , HD_DSP_RQ_SNO
					  , KYWD1
					  , KYWD2
					  , KYWD3
					  , KYWD4
					  , KYWD5)	
				( SELECT 
						'C'
			 	 	  , TBBADDED146H_SEQ.NEXTVAL
			 	 	  , SYSDATE
			 	      , FRT_USR_ID
					  , AUD_YR
					  , AUD_NO
					  , AUD_STEP_CD
					  , DOC_ID
					  , APVR_CD
					  , AFF_SNO
					  , DSP_RQ_SNO
					  , DSP_RQ_SNO
					  , AUD_KND_CD
					  , AUD_GRN_NO
					  , RPRT_FILD_ID
					  , AFF_DSP_CD
					  , RLTN_ORG_CD
					  , HND_ORG_CD
					  , REF_ORG_CD
					  , DSP_RQ_CD
					  , MTRL_IPT_DVSN_CD
					  , NOP_AM_DVSN_CD
					  , NOP_AM
					  , SORT_SNO
					  , FRT_USR_ID
					  , FNL_USR_ID
					  , FNL_DEAL_DPT_CD
					  , FNL_MNU_ID
					  , FRT_REGI_DH
					  , FNL_MDF_DH
					  , FNL_YN
					  , ACCN_INSP_CD
					  , NOP_SUM
					  , HD_AUD_STEP_CD	
					  , HD_DOC_ID	
					  , HD_APVR_CD	
					  , HD_AFF_SNO	
					  , HD_DSP_RQ_SNO
					  , KYWD1
					  , KYWD2
					  , KYWD3
					  , KYWD4
					  , KYWD5				
					FROM (
							SELECT AA.AUD_YR
								  , AA.AUD_NO
								  , DECODE(#APVR_PST_CD#, '0010600', 'A1070', AA.AUD_STEP_CD) AS AUD_STEP_CD
								  , AA.DOC_ID
								  , #APVR_PST_CD# AS APVR_CD
								  , AA.AFF_SNO
								  , AA.DSP_RQ_SNO
								  , AA.AUD_KND_CD
								  , AA.AUD_GRN_NO
								  , AA.RPRT_FILD_ID
								  , AA.AFF_DSP_CD
								  , AA.RLTN_ORG_CD
								  , AA.HND_ORG_CD
								  , AA.REF_ORG_CD
								  , AA.DSP_RQ_CD
								  , AA.MTRL_IPT_DVSN_CD
								  , AA.NOP_AM_DVSN_CD
								  , AA.NOP_AM
								  , AA.SORT_SNO
								  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB) AS FRT_USR_ID
								  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB) AS FNL_USR_ID
								  , (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB) AS FNL_DEAL_DPT_CD
								  , #FNL_MNU_ID# AS FNL_MNU_ID
								  , SYSDATE AS FRT_REGI_DH
								  , SYSDATE AS FNL_MDF_DH
								  , AA.FNL_YN
								  , AA.ACCN_INSP_CD
								  , AA.NOP_SUM
								  , AA.HD_AUD_STEP_CD	
								  , AA.HD_DOC_ID	
								  , AA.HD_APVR_CD	
								  , AA.HD_AFF_SNO	
								  , AA.HD_DSP_RQ_SNO
								  , AA.KYWD1
								  , AA.KYWD2
								  , AA.KYWD3
								  , AA.KYWD4
								  , AA.KYWD5
						      FROM TBBADDED146M AA
							     , ( 
							       SELECT A.DOC_ID, B.APVR_CNB, 
			                          CASE WHEN B.APVR_PST_CD IN ('0058100','0035100') THEN '0015800'
			                               WHEN B.APVR_PST_CD = ('0045900') THEN '0055600'
			                               WHEN B.APVR_PST_CD IN ('0057400','0035400') THEN '0013600'
			                               ELSE B.APVR_PST_CD
			                          END AS APVR_PST_CD
								     FROM TBBADDED103M A
									    , TBDCMACM023L B
								    WHERE B.APV_DOC_NO = #APV_DOC_NO#
								      AND A.APV_RQS_ID = B.APV_DOC_NO
								      AND B.APV_SNO = (
													  SELECT MAX(D.APV_SNO)
														FROM TBBADDED103M C
														   , TBDCMACM023L D
													   WHERE D.APV_DOC_NO = B.APV_DOC_NO
														 AND C.APV_RQS_ID = D.APV_DOC_NO
														 AND D.APV_SNO <> 1
													     AND C.RPRT_CD = #RPRT_CD#
													     AND C.DOC_ID = #DOC_ID#
													     AND D.APVR_STA_CD IN ('202','203','204')
			                                             AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
													  )
								      AND A.RPRT_CD = #RPRT_CD#
								      AND A.DOC_ID = #DOC_ID#
								      AND B.APVR_STA_CD IN ('202','203','204')
								      AND ROWNUM = 1
						 		    ) BB
			                     , TBBADDED145M CC
						 	 WHERE AA.DOC_ID = #DOC_ID#
			                   AND AA.DOC_ID = BB.DOC_ID
						   	   AND CASE WHEN AA.APVR_CD IN ('0058100','0035100') THEN '0015800'
			                            WHEN AA.APVR_CD = ('0045900') THEN '0055600'
			                            ELSE AA.APVR_CD
			                       END = BB.APVR_PST_CD 
			                   AND AA.AUD_YR = CC.AUD_YR
			                   AND AA.AUD_NO = CC.AUD_NO
			                   AND AA.DOC_ID = CC.DOC_ID
			                   AND AA.APVR_CD = CC.APVR_CD
			                   AND AA.AFF_SNO = CC.AFF_SNO
			                   AND NOT EXISTS (
			                                   SELECT 1 
			                                     FROM TBBADDED147M ZZ
										 INNER JOIN TBBADDED148M YY
										 		 ON ZZ.AUD_YR 		= YY.AUD_YR
												AND ZZ.AUD_NO 		= YY.AUD_NO
												AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
												AND ZZ.DOC_ID 		= YY.DOC_ID
												AND ZZ.APVR_CD 		= YY.APVR_CD
												AND ZZ.AFF_SNO 		= YY.AFF_SNO
												AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
												AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                                        
			                                    WHERE ZZ.AUD_YR = AA.AUD_YR
			                                      AND ZZ.AUD_NO = AA.AUD_NO
			                                      AND ZZ.DOC_ID = AA.DOC_ID
			                                      AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || CC.AFF_CD || '-' || AA.AFF_DSP_CD
			                                      AND CASE WHEN ZZ.APVR_CD IN ('0058100','0035100') THEN '0015800'
			                                               WHEN ZZ.APVR_CD = ('0045900') THEN '0055600'
			                                               ELSE ZZ.APVR_CD
			                                          END 
			                                           = 
			                                          CASE WHEN #APVR_PST_CD# IN ('0058100','0035100') THEN '0015800'
			                                               WHEN #APVR_PST_CD# = ('0045900') THEN '0055600'
			                                               ELSE #APVR_PST_CD#
			                                          END
			                                      AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
			                                   ) ) )
					;
		INSERT INTO TBBADDED146M
					  ( AUD_YR
					  , AUD_NO
					  , AUD_STEP_CD
					  , DOC_ID
					  , APVR_CD
					  , AFF_SNO
					  , DSP_RQ_SNO
					  , DP_DSP_RQ_SNO
					  , AUD_KND_CD
					  , AUD_GRN_NO
					  , RPRT_FILD_ID
					  , AFF_DSP_CD
					  , RLTN_ORG_CD
					  , HND_ORG_CD
					  , REF_ORG_CD
					  , DSP_RQ_CD
					  , MTRL_IPT_DVSN_CD
					  , NOP_AM_DVSN_CD
					  , NOP_AM
					  , SORT_SNO
					  , FRT_USR_ID
					  , FNL_USR_ID
					  , FNL_DEAL_DPT_CD
					  , FNL_MNU_ID
					  , FRT_REGI_DH
					  , FNL_MDF_DH
					  , FNL_YN
					  , ACCN_INSP_CD
					  , NOP_SUM
					  , HD_AUD_STEP_CD	
					  , HD_DOC_ID	
					  , HD_APVR_CD	
					  , HD_AFF_SNO	
					  , HD_DSP_RQ_SNO
					  , KYWD1
					  , KYWD2
					  , KYWD3
					  , KYWD4
					  , KYWD5)	
				( SELECT AA.AUD_YR
					  , AA.AUD_NO
					  , DECODE(#APVR_PST_CD#, '0010600', 'A1070', AA.AUD_STEP_CD)
					  , AA.DOC_ID
					  , #APVR_PST_CD#
					  , AA.AFF_SNO
					  , AA.DSP_RQ_SNO
					  , AA.DSP_RQ_SNO
					  , AA.AUD_KND_CD
					  , AA.AUD_GRN_NO
					  , AA.RPRT_FILD_ID
					  , AA.AFF_DSP_CD
					  , AA.RLTN_ORG_CD
					  , AA.HND_ORG_CD
					  , AA.REF_ORG_CD
					  , AA.DSP_RQ_CD
					  , AA.MTRL_IPT_DVSN_CD
					  , AA.NOP_AM_DVSN_CD
					  , AA.NOP_AM
					  , AA.SORT_SNO
					  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB)
					  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB)
					  , (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB)
					  , #FNL_MNU_ID#
					  , SYSDATE
					  , SYSDATE
					  , AA.FNL_YN
					  , AA.ACCN_INSP_CD
					  , AA.NOP_SUM
					  , AA.HD_AUD_STEP_CD	
					  , AA.HD_DOC_ID	
					  , AA.HD_APVR_CD	
					  , AA.HD_AFF_SNO	
					  , AA.HD_DSP_RQ_SNO
					  , AA.KYWD1
					  , AA.KYWD2
					  , AA.KYWD3
					  , AA.KYWD4
					  , AA.KYWD5
			      FROM TBBADDED146M AA
				     , ( 
				       SELECT A.DOC_ID, B.APVR_CNB, 
                          CASE WHEN B.APVR_PST_CD IN ('0058100','0035100') THEN '0015800'
                               WHEN B.APVR_PST_CD = ('0045900') THEN '0055600'
                               WHEN B.APVR_PST_CD IN ('0057400','0035400') THEN '0013600'
                               ELSE B.APVR_PST_CD
                          END AS APVR_PST_CD
					     FROM TBBADDED103M A
						    , TBDCMACM023L B
					    WHERE B.APV_DOC_NO = #APV_DOC_NO#
					      AND A.APV_RQS_ID = B.APV_DOC_NO
					      AND B.APV_SNO = (
										  SELECT MAX(D.APV_SNO)
											FROM TBBADDED103M C
											   , TBDCMACM023L D
										   WHERE D.APV_DOC_NO = B.APV_DOC_NO
											 AND C.APV_RQS_ID = D.APV_DOC_NO
											 AND D.APV_SNO <> 1
										     AND C.RPRT_CD = #RPRT_CD#
										     AND C.DOC_ID = #DOC_ID#
										     AND D.APVR_STA_CD IN ('202','203','204')
                                             AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
										  )
					      AND A.RPRT_CD = #RPRT_CD#
					      AND A.DOC_ID = #DOC_ID#
					      AND B.APVR_STA_CD IN ('202','203','204')
					      AND ROWNUM = 1
			 		    ) BB
                     , TBBADDED145M CC
			 	 WHERE AA.DOC_ID = #DOC_ID#
                   AND AA.DOC_ID = BB.DOC_ID
			   	   AND CASE WHEN AA.APVR_CD IN ('0058100','0035100') THEN '0015800'
                            WHEN AA.APVR_CD = ('0045900') THEN '0055600'
                            ELSE AA.APVR_CD
                       END = BB.APVR_PST_CD 
                   AND AA.AUD_YR = CC.AUD_YR
                   AND AA.AUD_NO = CC.AUD_NO
                   AND AA.DOC_ID = CC.DOC_ID
                   AND AA.APVR_CD = CC.APVR_CD
                   AND AA.AFF_SNO = CC.AFF_SNO
                   AND NOT EXISTS (
                                   SELECT 1 
                                     FROM TBBADDED147M ZZ
							 INNER JOIN TBBADDED148M YY
							 		 ON ZZ.AUD_YR 		= YY.AUD_YR
									AND ZZ.AUD_NO 		= YY.AUD_NO
									AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
									AND ZZ.DOC_ID 		= YY.DOC_ID
									AND ZZ.APVR_CD 		= YY.APVR_CD
									AND ZZ.AFF_SNO 		= YY.AFF_SNO
									AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
									AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                                        
                                    WHERE ZZ.AUD_YR = AA.AUD_YR
                                      AND ZZ.AUD_NO = AA.AUD_NO
                                      AND ZZ.DOC_ID = AA.DOC_ID
                                      AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || CC.AFF_CD || '-' || AA.AFF_DSP_CD
                                      AND CASE WHEN ZZ.APVR_CD IN ('0058100','0035100') THEN '0015800'
                                               WHEN ZZ.APVR_CD = ('0045900') THEN '0055600'
                                               ELSE ZZ.APVR_CD
                                          END 
                                           = 
                                          CASE WHEN #APVR_PST_CD# IN ('0058100','0035100') THEN '0015800'
                                               WHEN #APVR_PST_CD# = ('0045900') THEN '0055600'
                                               ELSE #APVR_PST_CD#
                                          END
                                      AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
                                   ) )
                            ;
                      END;
	]]>
	</insert>
	
	<insert id="AEPAFU001InsertTBBADDED147MByAudRprt" parameterClass="java.util.Map">
	<![CDATA[
	DECLARE
		BEGIN
		INSERT INTO TBBADDED147H
				  ( HST_DVSN_CD
				  , HST_SNO
				  , HST_DH
				  , HST_USR_ID	
				  , AUD_YR		
				  , AUD_NO		
				  , AUD_STEP_CD	
				  , APVR_CD		
				  , AUD_KND_CD	
				  , AUD_GRN_NO	
				  , DOC_ID		
				  , RPRT_FILD_ID
				  , PRE_AFF_NO	
				  , AFF_NO		
				  , AFF_SNO		
				  , DSP_RQ_SNO	
				  , MPP_SEQ
				  , SORT_SNO	
				  , FRT_USR_ID	
				  , FNL_USR_ID	
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID	
				  , FRT_REGI_DH	
				  , FNL_MDF_DH)
		     ( 
		     SELECT 'C'
			 	  , TBBADDED147H_SEQ.NEXTVAL
			 	  , SYSDATE
			 	  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = T1.APVR_CNB)
		     	  ,	AUD_YR 
				  , AUD_NO 
				  , AUD_STEP_CD
				  , #APVR_PST_CD#
				  , AUD_KND_CD 
				  , AUD_GRN_NO 
				  , DOC_ID 
				  , RPRT_FILD_ID 
				  , AFF_NO 
				  , AFF_NO 
				  , AFF_SNO 
				  , DSP_RQ_SNO 
				  , SEQ_MPP.NEXTVAL
				  , SORT_SNO 	
				  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = T1.APVR_CNB)
				  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = T1.APVR_CNB)
				  , (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = T1.APVR_CNB)
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE	 
		      FROM
			    (SELECT DISTINCT AA.AUD_YR 
					  , AA.AUD_NO 
					  , DECODE(#APVR_PST_CD#, '0010600', 'A1070', AA.AUD_STEP_CD) AS AUD_STEP_CD
					  , AA.AUD_KND_CD 
					  , MAX(AA.AUD_GRN_NO) AS AUD_GRN_NO
					  , AA.DOC_ID 
					  , MAX(AA.RPRT_FILD_ID) AS RPRT_FILD_ID
					  , AA.AFF_NO 
					  , AA.AFF_SNO 
					  , AA.DSP_RQ_SNO 
					  , MIN(AA.SORT_SNO) AS SORT_SNO
					  , BB.APVR_CNB
				   FROM TBBADDED147M AA
		LEFT OUTER JOIN TBBADDED148M DD
				 		 ON AA.AUD_YR 		= DD.AUD_YR
						AND AA.AUD_NO 		= DD.AUD_NO
						AND AA.AUD_STEP_CD 	= DD.AUD_STEP_CD
						AND AA.DOC_ID 		= DD.DOC_ID
						AND AA.APVR_CD 		= DD.APVR_CD
						AND AA.AFF_SNO 		= DD.AFF_SNO
						AND AA.DSP_RQ_SNO 	= DD.DSP_RQ_SNO
						AND AA.MPP_SEQ 		= DD.MPP_SEQ			   
				     , ( 
				       SELECT A.DOC_ID, B.APVR_CNB, 
	                          CASE WHEN B.APVR_PST_CD IN ('0058100','0035100') THEN '0015800'
	                               WHEN B.APVR_PST_CD = ('0045900') THEN '0055600'
	                               WHEN B.APVR_PST_CD IN ('0057400','0035400') THEN '0013600'
	                               ELSE B.APVR_PST_CD
	                          END AS APVR_PST_CD
					     FROM TBBADDED103M A
						    , TBDCMACM023L B
					    WHERE B.APV_DOC_NO = #APV_DOC_NO#
					      AND A.APV_RQS_ID = B.APV_DOC_NO
					      AND B.APV_SNO = (
										  SELECT MAX(D.APV_SNO)
											FROM TBBADDED103M C
											   , TBDCMACM023L D
										   WHERE D.APV_DOC_NO = B.APV_DOC_NO
											 AND C.APV_RQS_ID = D.APV_DOC_NO
											 AND D.APV_SNO <> 1
										     AND C.RPRT_CD = #RPRT_CD#
										     AND C.DOC_ID = #DOC_ID#
										   /*  AND D.APVR_STA_CD IN ('202','203','204')*/
	                                         AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
										  )
					      AND A.RPRT_CD = #RPRT_CD#
					   /*   AND B.APVR_STA_CD IN ('202','203','204')*/
					      AND A.DOC_ID = #DOC_ID#
					      AND ROWNUM = 1
			 		    ) BB
			 	 WHERE AA.DOC_ID = #DOC_ID#
	               AND AA.DOC_ID = BB.DOC_ID
/*	               
			   	   AND CASE WHEN AA.APVR_CD IN ('0058100','0035100') THEN '0015800'
	                        WHEN AA.APVR_CD = ('0045900') THEN '0055600'
	                        ELSE AA.APVR_CD
	                   END = BB.APVR_PST_CD 
*/	                   
			   	   AND (DD.AFF_MPP_DVSN_CD IS NULL OR DD.AFF_MPP_DVSN_CD NOT IN ( 'D90', 'D70', 'D80', 'D99' ) )
			  GROUP BY AA.AUD_YR,
                       AA.AUD_NO,
                       AA.AUD_STEP_CD,
                       AA.AUD_KND_CD,
                       AA.DOC_ID,
                       AA.AFF_NO,
                       AA.AFF_SNO,
                       AA.DSP_RQ_SNO,
                       BB.APVR_CNB) T1)
             ;	
		INSERT INTO TBBADDED147M
				  ( AUD_YR		
				  , AUD_NO		
				  , AUD_STEP_CD	
				  , APVR_CD		
				  , AUD_KND_CD	
				  , AUD_GRN_NO	
				  , DOC_ID		
				  , RPRT_FILD_ID
				  , PRE_AFF_NO	
				  , AFF_NO		
				  , AFF_SNO		
				  , DSP_RQ_SNO	
				  , MPP_SEQ
				  , SORT_SNO	
				  , FRT_USR_ID	
				  , FNL_USR_ID	
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID	
				  , FRT_REGI_DH	
				  , FNL_MDF_DH)
		     ( 
		     SELECT AUD_YR 
				  , AUD_NO 
				  , AUD_STEP_CD
				  , #APVR_PST_CD#
				  , AUD_KND_CD 
				  , AUD_GRN_NO 
				  , DOC_ID 
				  , RPRT_FILD_ID 
				  , AFF_NO 
				  , AFF_NO 
				  , AFF_SNO 
				  , DSP_RQ_SNO 
				  , SEQ_MPP.NEXTVAL
				  , SORT_SNO 	
				  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = T1.APVR_CNB)
				  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = T1.APVR_CNB)
				  , (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = T1.APVR_CNB)
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE	 
		      FROM
			    (SELECT DISTINCT AA.AUD_YR 
					  , AA.AUD_NO 
					  , DECODE(#APVR_PST_CD#, '0010600', 'A1070', AA.AUD_STEP_CD) AS AUD_STEP_CD
					  , AA.AUD_KND_CD 
					  , MAX(AA.AUD_GRN_NO) AS AUD_GRN_NO
					  , AA.DOC_ID 
					  , MAX(AA.RPRT_FILD_ID) AS RPRT_FILD_ID
					  , AA.AFF_NO 
					  , AA.AFF_SNO 
					  , AA.DSP_RQ_SNO 
					  , MIN(AA.SORT_SNO) AS SORT_SNO
					  , BB.APVR_CNB
				   FROM TBBADDED147M AA
		LEFT OUTER JOIN TBBADDED148M DD
				 		 ON AA.AUD_YR 		= DD.AUD_YR
						AND AA.AUD_NO 		= DD.AUD_NO
						AND AA.AUD_STEP_CD 	= DD.AUD_STEP_CD
						AND AA.DOC_ID 		= DD.DOC_ID
						AND AA.APVR_CD 		= DD.APVR_CD
						AND AA.AFF_SNO 		= DD.AFF_SNO
						AND AA.DSP_RQ_SNO 	= DD.DSP_RQ_SNO
						AND AA.MPP_SEQ 		= DD.MPP_SEQ			   
				     , ( 
				       SELECT A.DOC_ID, B.APVR_CNB, 
	                          CASE WHEN B.APVR_PST_CD IN ('0058100','0035100') THEN '0015800'
	                               WHEN B.APVR_PST_CD = ('0045900') THEN '0055600'
	                               WHEN B.APVR_PST_CD IN ('0057400','0035400') THEN '0013600'
	                               ELSE B.APVR_PST_CD
	                          END AS APVR_PST_CD
					     FROM TBBADDED103M A
						    , TBDCMACM023L B
					    WHERE B.APV_DOC_NO = #APV_DOC_NO#
					      AND A.APV_RQS_ID = B.APV_DOC_NO
					      AND B.APV_SNO = (
										  SELECT MAX(D.APV_SNO)
											FROM TBBADDED103M C
											   , TBDCMACM023L D
										   WHERE D.APV_DOC_NO = B.APV_DOC_NO
											 AND C.APV_RQS_ID = D.APV_DOC_NO
											 AND D.APV_SNO <> 1
										     AND C.RPRT_CD = #RPRT_CD#
										     AND C.DOC_ID = #DOC_ID#
										   /*  AND D.APVR_STA_CD IN ('202','203','204')*/
	                                         AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
										  )
					      AND A.RPRT_CD = #RPRT_CD#
					   /*   AND B.APVR_STA_CD IN ('202','203','204')*/
					      AND A.DOC_ID = #DOC_ID#
					      AND ROWNUM = 1
			 		    ) BB
			 	 WHERE AA.DOC_ID = #DOC_ID#
	               AND AA.DOC_ID = BB.DOC_ID
/*	               
			   	   AND CASE WHEN AA.APVR_CD IN ('0058100','0035100') THEN '0015800'
	                        WHEN AA.APVR_CD = ('0045900') THEN '0055600'
	                        ELSE AA.APVR_CD
	                   END = BB.APVR_PST_CD 
*/	                   
			   	   AND (DD.AFF_MPP_DVSN_CD IS NULL OR DD.AFF_MPP_DVSN_CD NOT IN ( 'D90', 'D70', 'D80', 'D99' ) )
			  GROUP BY AA.AUD_YR,
                       AA.AUD_NO,
                       AA.AUD_STEP_CD,
                       AA.AUD_KND_CD,
                       AA.DOC_ID,
                       AA.AFF_NO,
                       AA.AFF_SNO,
                       AA.DSP_RQ_SNO,
                       BB.APVR_CNB) T1)
             ;
       END;
	]]>
	</insert>

	<insert id="AEPAFU001InsertTrtmMainData" parameterClass="java.util.Map">
      INSERT INTO TBBADDED112M(
                            AUD_YR,
                             AUD_NO,
                             AUD_KND_CD,
                             AUD_GRN_NO,
                             AUD_SBJ_NM,
                             SBCN_TRTM_REQ_DT,
                             SHARE_YN,
                             FRT_USR_ID,
                             FNL_USR_ID,
                             FNL_DEAL_DPT_CD,
                             FNL_MNU_ID,
                             FRT_REGI_DH,
                             FNL_MDF_DH)
                      VALUES(#AUD_YR#,
                             #AUD_NO#,
                             (SELECT AUD_KND_CD FROM TBBADDED001M
                                WHERE
                                    AUD_YR = #AUD_YR#
                                AND AUD_NO = #AUD_NO#),
                             (SELECT AUD_GRN_NO FROM TBBADDED001M
                                WHERE
                                    AUD_YR = #AUD_YR#
                                AND AUD_NO = #AUD_NO#),
                             (SELECT AUD_SBJ_NM FROM TBBADDED001M
                                WHERE
                                    AUD_YR = #AUD_YR#
                                AND AUD_NO = #AUD_NO#),
                             TO_CHAR(SYSDATE,'YYYYMMDD'),
                             'N',
                             #FNL_USR_ID#,
                             #FNL_USR_ID#,
                             #FNL_DEAL_DPT_CD#,
                             #FNL_MNU_ID#,
                             SYSDATE,
                             SYSDATE)
	</insert>
	
	<insert id="AEPAFU001InsertTrtmDtlData" parameterClass="java.util.Map">
		INSERT INTO TBBADDED112D(AUD_YR,AUD_NO,SBCN_TRTM_DTL_SNO,DOC_ID,SORT_SNO,FRT_USR_ID,FNL_USR_ID,FNL_DEAL_DPT_CD,FNL_MNU_ID,
                    FRT_REGI_DH,FNL_MDF_DH)
      VALUES(#AUD_YR#, #AUD_NO#, 
             (SELECT 
                LPAD(NVL(MAX(TO_NUMBER(SBCN_TRTM_DTL_SNO)),0)+1,3,0) 
              FROM TBBADDED112D 
              WHERE 
                AUD_YR = #AUD_YR# 
              AND AUD_NO =#AUD_NO# ),
           #DOC_ID#,
             (SELECT 
                LPAD(NVL(MAX(TO_NUMBER(SBCN_TRTM_DTL_SNO)),0)+1,3,0) 
              FROM TBBADDED112D 
              WHERE 
                AUD_YR = #AUD_YR#  
              AND AUD_NO =#AUD_NO# ),
           #FNL_USR_ID#,#FNL_USR_ID#,#FNL_DEAL_DPT_CD#,#FNL_MNU_ID#,SYSDATE,SYSDATE)
	</insert>
	
	<insert id="AEPAFU001InsertTrtmDtlPrcs" parameterClass="java.util.Map">
	INSERT INTO TBBADDED102M
          (
            AUD_YR
            ,AUD_NO
            ,AUD_STEP_CD
            ,AUD_MAIN_STEP_ID
            ,AUD_MAIN_STEP_SNO
            ,AUD_MAIN_SEQ_W
            ,AUD_MAIN_SEQ_H
            ,AUD_DOC_CD
            ,CMPT_YN
            ,AUD_KND_CD
            ,AUD_GRN_NO
            ,MAIN_JOB_NM 
            ,LINK_TYPE
            ,LINK_URL
            ,SORT_SNO
            ,FRT_USR_ID
            ,FNL_USR_ID
            ,FNL_DEAL_DPT_CD
            ,FNL_MNU_ID
            ,FRT_REGI_DH
            ,FNL_MDF_DH
          )
          (SELECT 
                AUD_YR, 
                AUD_NO, 
                T3.AUD_STEP_CD,
                AUD_MAIN_STEP_ID,
                SBCN_TRTM_DTL_SNO AS AUD_MAIN_STEP_SNO,
                AUD_MAIN_SEQ_W,
                AUD_MAIN_SEQ_H,
                AUD_DOC_CD,
                CMPT_YN,
                T2.AUD_KND_CD,
                AUD_GRN_NO,
                AUD_MAIN_STEP_NM AS MAIN_JOB_NM,
                LINK_TYPE,
                LINK_URL,
                NULL AS SORT_SNO,
                #FNL_USR_ID#,
                #FNL_USR_ID#,
                #FNL_DEAL_DPT_CD#,
                #FNL_MNU_ID#,
                SYSDATE,
                SYSDATE
            FROM 
                TBBADDED112D T1
                JOIN
                TBBADDED001M T2
                USING (AUD_YR, AUD_NO)
                JOIN
                TBBADDED102B T3
                ON SUBSTR(T2.AUD_KND_CD,-1) = T3.AUD_KND_CD
            WHERE 
                AUD_YR = #AUD_YR#
            AND AUD_NO = #AUD_NO#
            AND T3.AUD_STEP_CD = 'A1070'
            AND SUBSTR(T3.AUD_MAIN_STEP_ID,0,2) = '70'
            AND SBCN_TRTM_DTL_SNO NOT IN (SELECT 
                                                DISTINCT AUD_MAIN_STEP_SNO 
                                          FROM TBBADDED102M 
                                          WHERE AUD_YR = #AUD_YR# AND AUD_NO = #AUD_NO# AND SUBSTR(AUD_MAIN_STEP_ID,0,2) = '70')
           )
    </insert>
           
	<select id="AEPAFU001SelectRvwRsqDoc" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
	        SELECT 
	                T1.AUD_YR
	                ,T1.AUD_NO
	                ,T1.DOC_ID
	                ,T1.AUD_KND_CD
	                ,T1.AUD_GRN_NO
	                ,T1.RPRT_NM
	                ,T1.RPRT_CD
	                ,T1.LINK_URL
	                ,T1.REF_ID
	                ,T1.REF_DY
	            FROM 
	                TBBADDED103M T1
	                INNER JOIN
	                TBBADDED109M T2 ON (T1.DOC_ID = T2.DOC_ID)
	            WHERE 
	                T1.AUD_YR = #AUD_YR#
	            AND T1.AUD_NO = #AUD_NO#
	            AND T2.APV_RQS_ID = #APV_DOC_NO#
	            AND T1.RPRT_CD NOT IN ('A10600200')
			]]>

	</select>
	
	<insert id="AEPAFU001SaveSendRvwRsqDoc" parameterClass="java.util.Map">
		<![CDATA[
			INSERT INTO TBBADDED111M (AUD_YR,AUD_NO,AUD_STEP_CD,
				DOC_ID,SR_DOC_SNO,AUD_KND_CD,AUD_GRN_NO,RPRT_NM,RPRT_CD,
				LINK_URL,DOC_STA_CD,SND_DPT_CD,SNDR_ID,SND_DH,RCPT_DPT_CD,
				RCNT_ID,RCPT_DH,DOC_KND_CD,REF_ID,REF_DY,SORT_SNO,
				FRT_USR_ID,FNL_USR_ID,FNL_DEAL_DPT_CD,FNL_MNU_ID,FRT_REGI_DH,FNL_MDF_DH)
			VALUES (#AUD_YR#,#AUD_NO#,'A1070',
				#DOC_ID#, (SELECT 
									LPAD(NVL(MAX(TO_NUMBER(SR_DOC_SNO)),0)+1,3,0) 
								 FROM TBBADDED111M 
								 WHERE 
										AUD_YR = #AUD_YR# 
								 AND AUD_NO = #AUD_NO#
								 AND AUD_STEP_CD ='A1070'
								 AND DOC_ID = #DOC_ID# ),
				#AUD_KND_CD#,#AUD_GRN_NO#,#RPRT_NM#,#RPRT_CD#,
				#LINK_URL#,'10',#FNL_DEAL_DPT_CD#,#FNL_USR_ID#,SYSDATE,'510000',
				NULL,NULL,NULL,#REF_ID#,#REF_DY#,(SELECT 
									LPAD(NVL(MAX(TO_NUMBER(SR_DOC_SNO)),0)+1,3,0) 
								 FROM TBBADDED111M 
								 WHERE 
										AUD_YR = #AUD_YR# 
								 AND AUD_NO = #AUD_NO#
								 AND AUD_STEP_CD ='A1070'
								 AND DOC_ID = #DOC_ID# ),
				#FNL_USR_ID#,#FNL_USR_ID#,#FNL_DEAL_DPT_CD#,#FNL_MNU_ID#,SYSDATE,SYSDATE)
		]]>
	</insert>
	
	<update id="AEPAFU001saveRvwRsq" parameterClass="java.util.Map">
		<![CDATA[
			UPDATE  TBBADDED112D
				SET     
							RVW_REQ_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
							,RVW_CMPT_YN = 'N'
							, FNL_USR_ID = #FNL_USR_ID#
							, FNL_MNU_ID = #FNL_DEAL_DPT_CD#
							, FNL_MDF_DH = SYSDATE
							, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				WHERE   
							AUD_YR = #AUD_YR#
				AND     AUD_NO  = #AUD_NO#
				AND     SBCN_TRTM_DTL_SNO  = (SELECT MAX(SBCN_TRTM_DTL_SNO) AS SBCN_TRTM_DTL_SNO
											FROM TBBADDED112D T2
											WHERE 
												AUD_YR = #AUD_YR#
											AND AUD_NO = #AUD_NO#
											AND DOC_ID = #REF_ID# )
			]]>
	</update>
	
	<update id="AEPAFU001saveCmptRvwRsq" parameterClass="java.util.Map">
		<![CDATA[
			UPDATE  TBBADDED112D
				SET     
							RVW_CMPT_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
							,RVW_CMPT_YN = 'Y'
							, FNL_USR_ID = #FNL_USR_ID#
							, FNL_MNU_ID = #FNL_DEAL_DPT_CD#
							, FNL_MDF_DH = SYSDATE
							, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				WHERE   
							AUD_YR = #AUD_YR#
				AND     AUD_NO  = #AUD_NO#
				AND     SBCN_TRTM_DTL_SNO  = (SELECT MAX(SBCN_TRTM_DTL_SNO) AS SBCN_TRTM_DTL_SNO
											FROM TBBADDED112D T2
											WHERE 
												AUD_YR = #AUD_YR#
											AND AUD_NO = #AUD_NO#
											AND DOC_ID = #REF_ID# )
			]]>
	</update>
	
	<update id="AEPAFU001updateSendRvwRsqDoc" parameterClass="java.util.Map">
			<![CDATA[
				UPDATE  TBBADDED111M
					SET DOC_STA_CD = '20'
						, RCNT_ID = #FNL_USR_ID#
						, RCPT_DH = SYSDATE
			            , FNL_USR_ID = #FNL_USR_ID#
			            , FNL_MNU_ID = #FNL_USR_ID#
			            , FNL_MDF_DH = SYSDATE
			            , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					WHERE   
							AUD_YR = #AUD_YR#
					AND     AUD_NO  = #AUD_NO#
			        AND     AUD_STEP_CD = #AUD_STEP_CD#
			        AND     (DOC_ID = #REF_ID# OR REF_ID = #REF_ID#)
					AND     RCPT_DPT_CD = '510000'
			]]>
	</update>	
	
	<delete id="AEPAFU001DeleteSendRvwRsqDoc" parameterClass="java.util.Map">
		<![CDATA[
			DELETE FROM TBBADDED111M
			 WHERE DOC_ID IN (SELECT  
			                T1.DOC_ID
			            FROM 
			                TBBADDED111M T1
			                INNER JOIN
			                TBBADDED109M T2 ON (T1.DOC_ID = T2.DOC_ID)
			            WHERE 
			                T1.AUD_YR = #AUD_YR#
			            AND T1.AUD_NO = #AUD_NO#
			            AND T2.APV_RQS_ID = #APV_DOC_NO#
			            AND T1.RCPT_DPT_CD = '510000')
		]]>
	</delete>
	
	<delete id="AEPAFU001DeleteTBBADDED145MByAudRprt"	parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'D'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , 'SYSTEM'
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID
				 FROM TBBADDED145M
				 WHERE AUD_YR 	   = #AUD_YR#
				   AND AUD_NO      = #AUD_NO#
				   AND AUD_STEP_CD = #AUD_STEP_CD#
				   AND APVR_CD     = #APVR_PST_CD#
				   AND DOC_ID      = #DOC_ID#
				;			
			DELETE
			  FROM TBBADDED145M
			 WHERE AUD_YR 	   = #AUD_YR#
			   AND AUD_NO      = #AUD_NO#
			   AND AUD_STEP_CD = #AUD_STEP_CD#
			   AND APVR_CD     = #APVR_PST_CD#
			   AND DOC_ID      = #DOC_ID#
			 	;
			END;
		]]>
	</delete>
	
	<delete id="AEPAFU001DeleteTBBADDED146MByAudRprt"	parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN
			INSERT INTO TBBADDED146H
					(
					    HST_DVSN_CD
					  , HST_SNO
					  , HST_DH
					  , HST_USR_ID	
					  , AUD_YR
					  , AUD_NO
					  , AUD_STEP_CD 	
					  , DOC_ID 			
					  , APVR_CD 		
					  , AFF_SNO 		
					  , DSP_RQ_SNO 		
					  , DP_DSP_RQ_SNO 	
					  , AUD_KND_CD 		
					  , AUD_GRN_NO 		
					  , RPRT_FILD_ID 	
					  , AFF_DSP_CD 		
					  , RLTN_ORG_CD 	
					  , HND_ORG_CD 		
					  , REF_ORG_CD 		
					  , DSP_RQ_CD 		
					  , MTRL_IPT_DVSN_CD
					  , NOP_AM_DVSN_CD 	
					  , NOP_AM 			
					  , SORT_SNO		
					  , ACCN_INSP_CD	
					  , FNL_YN 			
					  , FRT_USR_ID 		
					  , FNL_USR_ID 		
					  , FNL_DEAL_DPT_CD 
					  , FNL_MNU_ID 		
					  , FRT_REGI_DH		
					  , FNL_MDF_DH 		
					  , NOP_SUM 		
					  , HD_AUD_STEP_CD 	
					  , HD_DOC_ID		
					  , HD_APVR_CD		
					  , HD_AFF_SNO 		
					  , HD_DSP_RQ_SNO	
					  , REF_DOC_ID 		
					  , DF_AUD_STEP_CD 	
					  , DF_DOC_ID 		
					  , DF_APVR_CD 		
					  , DF_AFF_SNO		
					  , DF_DSP_RQ_SNO 	
					  , KYWD1			
					  , KYWD2 			
					  , KYWD3 			
					  , KYWD4			
					  , KYWD5			
					)
				SELECT 'D'
				 	 , TBBADDED146H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , 'SYSTEM'
					 , AUD_YR
					 , AUD_NO
					 , AUD_STEP_CD 	
					 , DOC_ID 			
					 , APVR_CD 		
					 , AFF_SNO 		
					 , DSP_RQ_SNO 		
					 , DP_DSP_RQ_SNO 	
					 , AUD_KND_CD 		
					 , AUD_GRN_NO 		
					 , RPRT_FILD_ID 	
					 , AFF_DSP_CD 		
					 , RLTN_ORG_CD 	
					 , HND_ORG_CD 		
					 , REF_ORG_CD 		
					 , DSP_RQ_CD 		
					 , MTRL_IPT_DVSN_CD
					 , NOP_AM_DVSN_CD 	
					 , NOP_AM 			
					 , SORT_SNO		
					 , ACCN_INSP_CD	
					 , FNL_YN 			
					 , FRT_USR_ID 		
					 , FNL_USR_ID 		
					 , FNL_DEAL_DPT_CD 
					 , FNL_MNU_ID 		
					 , FRT_REGI_DH		
					 , FNL_MDF_DH 		
					 , NOP_SUM 		
					 , HD_AUD_STEP_CD 	
					 , HD_DOC_ID		
					 , HD_APVR_CD		
					 , HD_AFF_SNO 		
					 , HD_DSP_RQ_SNO	
					 , REF_DOC_ID 		
					 , DF_AUD_STEP_CD 	
					 , DF_DOC_ID 		
					 , DF_APVR_CD 		
					 , DF_AFF_SNO		
					 , DF_DSP_RQ_SNO 	
					 , KYWD1			
					 , KYWD2 			
					 , KYWD3 			
					 , KYWD4			
					 , KYWD5
				 FROM TBBADDED146M
				 WHERE AUD_YR 	   = #AUD_YR#
				   AND AUD_NO      = #AUD_NO#
				   AND AUD_STEP_CD = #AUD_STEP_CD#
				   AND APVR_CD     = #APVR_PST_CD#
				   AND DOC_ID      = #DOC_ID#
			;		
			DELETE
			  FROM TBBADDED146M
			 WHERE AUD_YR 	   = #AUD_YR#
			   AND AUD_NO      = #AUD_NO#
			   AND AUD_STEP_CD = #AUD_STEP_CD#
			   AND APVR_CD     = #APVR_PST_CD#
			   AND DOC_ID      = #DOC_ID#
			;
		END;
		]]>
	</delete>
	
	<delete id="AEPAFU001DeleteTBBADDED147MByAudRprt"	parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN
  		 INSERT INTO TBBADDED147H
        			(
        			    HST_DVSN_CD
					  , HST_SNO
					  , HST_DH
					  , HST_USR_ID	
                      , AUD_YR
                      , AUD_NO
                      , AUD_STEP_CD
                      , APVR_CD
                      , AUD_KND_CD
                      , PRE_AFF_NO
                      , AFF_NO
                      , AFF_SNO
                      , DSP_RQ_SNO
                      , DOC_ID
                      , MPP_SEQ
                      , SORT_SNO
                      , RPRT_FILD_ID
                      , FRT_USR_ID
                      , FNL_USR_ID
                      , FNL_DEAL_DPT_CD
                      , FNL_MNU_ID
                      , FRT_REGI_DH
                      , FNL_MDF_DH
                     )
					SELECT 'D'
						 	 , TBBADDED147H_SEQ.NEXTVAL
						 	 , SYSDATE
						 	 , 'SYSTEM'
		                     , AUD_YR
		                     , AUD_NO
		                     , AUD_STEP_CD
		                     , APVR_CD
		                     , AUD_KND_CD
		                     , PRE_AFF_NO
		                     , AFF_NO
		                     , AFF_SNO
		                     , DSP_RQ_SNO
		                     , DOC_ID
		                     , MPP_SEQ
		                     , SORT_SNO
		                     , RPRT_FILD_ID
		                     , FRT_USR_ID
		                     , FNL_USR_ID
		                     , FNL_DEAL_DPT_CD
		                     , FNL_MNU_ID
		                     , FRT_REGI_DH
		                     , FNL_MDF_DH
					  FROM TBBADDED147M
					 WHERE AUD_YR 	   = #AUD_YR#
					   AND AUD_NO      = #AUD_NO#
					   AND AUD_STEP_CD = #AUD_STEP_CD#
					   AND APVR_CD     = #APVR_PST_CD#
					   AND DOC_ID      = #DOC_ID#
		            ;			
			DELETE
			  FROM TBBADDED147M
			 WHERE AUD_YR 	   = #AUD_YR#
			   AND AUD_NO      = #AUD_NO#
			   AND AUD_STEP_CD = #AUD_STEP_CD#
			   AND APVR_CD     = #APVR_PST_CD#
			   AND DOC_ID      = #DOC_ID#
			 ;
		END;
		]]>
	</delete>

	<select id="AEPAFU001GetRecentApvData" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
	        SELECT AUD_RPRT_DVSN_CD, DOC_ID, APVR_PST_CD, APVR_DPT_CD
			  FROM (
					SELECT C.AUD_RPRT_DVSN_CD, D.APV_SNO, C.DOC_ID, D.APVR_PST_CD, D.APVR_DPT_CD
					  FROM TBBADDED103M C
						 , TBDCMACM023L D
					 WHERE C.APV_RQS_ID = D.APV_DOC_NO
					   AND D.APV_SNO <> 1
					   AND C.RPRT_CD = #RPRT_CD#
					   AND D.APV_DOC_NO = #APV_DOC_NO#
					   AND D.APVR_STA_CD IN ('202','203','204')
                       AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400','0067400')
					 ORDER BY APV_SNO DESC
				   )
			 WHERE ROWNUM = 1
			]]>

	</select>

	<insert id="AEPAFU001InsertPsdAffDataByAudRprt" parameterClass="java.util.Map">
	DECLARE
		BEGIN
		INSERT INTO TBBADDED145H
				  ( HST_DVSN_CD
				  , HST_SNO
				  , HST_DH
				  , HST_USR_ID	
				  , AUD_YR
				  , AUD_NO
				  , AUD_STEP_CD
				  , DOC_ID
				  , APVR_CD
				  , AFF_SNO
				  , AUD_KND_CD
				  , AUD_GRN_NO
				  , RPRT_FILD_ID
				  , AFF_CD
				  , LIST_NO
				  , REFER_DVSN_CD
				  , AFF_SPH
				  , TITLE_NM
				  , DP_TITLE_NM
				  , QST_DOC_ISUE_YN
				  , QST_DOC_ISUE_DY
				  , AUDTOR
				  , DETL_DOC_NO
				  , MTRL_IPT_DVSN_CD
				  , SYT_TRTM_DVSN_YN
				  , SCRT_YN
				  , SORT_SNO
				  , TRTM_EXAMER_CNB 
				  , FRT_USR_ID 
				  , FNL_USR_ID
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID
				  , FRT_REGI_DH
				  , FNL_MDF_DH
				  , FNL_YN)
			(
			SELECT 'C',
                     TBBADDED145H_SEQ.NEXTVAL,
                     SYSDATE,
                     #FNL_USR_ID#,
					 AUD_YR,
					 AUD_NO,
					 AUD_STEP_CD,
					 DOC_ID,
					 APVR_CD,
					 AFF_SNO,
					 AUD_KND_CD,
					 AUD_GRN_NO,
					 RPRT_FILD_ID,
					 AFF_CD,
					 LIST_NO,
					 REFER_DVSN_CD,
					 AFF_SPH,
					 TITLE_NM,
					 TITLE_NM,
					 QST_DOC_ISUE_YN,
					 QST_DOC_ISUE_DY,
					 AUDTOR,
					 DETL_DOC_NO,
					 MTRL_IPT_DVSN_CD,
					 SYT_TRTM_DVSN_YN,
					 SCRT_YN,
					 SORT_SNO,
					 TRTM_EXAMER_CNB,
					 FRT_USR_ID,
					 FNL_USR_ID,
					 FNL_DEAL_DPT_CD,
					 FNL_MNU_ID,
					 FRT_REGI_DH,
					 FNL_MDF_DH,
					 FNL_YN                      						
	            FROM (SELECT DISTINCT AA.AUD_YR
						  , AA.AUD_NO
						  , 'A1060' AS AUD_STEP_CD
						  , AA.DOC_ID
						  , '0055700' AS APVR_CD
						  , AA.AFF_SNO
						  , AA.AUD_KND_CD
						  , AA.AUD_GRN_NO
						  , AA.RPRT_FILD_ID
						  , AA.AFF_CD
						  , AA.LIST_NO
						  , AA.REFER_DVSN_CD
						  , AA.AFF_SPH
						  , AA.TITLE_NM
						  , AA.QST_DOC_ISUE_YN
						  , AA.QST_DOC_ISUE_DY
						  , AA.AUDTOR
						  , AA.DETL_DOC_NO
						  , AA.MTRL_IPT_DVSN_CD
						  , AA.SYT_TRTM_DVSN_YN
						  , AA.SCRT_YN
						  , AA.SORT_SNO
						  , AA.TRTM_EXAMER_CNB
						  , #FNL_USR_ID# AS FRT_USR_ID
						  , #FNL_USR_ID# AS FNL_USR_ID
						  , #FNL_DEAL_DPT_CD# AS FNL_DEAL_DPT_CD
						  , #FNL_MNU_ID# AS FNL_MNU_ID
						  , SYSDATE AS FRT_REGI_DH
						  , SYSDATE AS FNL_MDF_DH
						  , AA.FNL_YN
				      FROM TBBADDED145M AA
		                 , TBBADDED146M CC
				 	 WHERE AA.DOC_ID = #DOC_ID# 
				       AND AA.APVR_CD IN ( '0055600', '0045900')
		               AND AA.AUD_YR = CC.AUD_YR
		               AND AA.AUD_NO = CC.AUD_NO
		               AND AA.DOC_ID = CC.DOC_ID
		               AND AA.APVR_CD = CC.APVR_CD
		               AND AA.AFF_SNO = CC.AFF_SNO
		               AND NOT EXISTS (
		                               SELECT 1 
		                                 FROM TBBADDED147M ZZ
									 INNER JOIN TBBADDED148M YY
									 		 ON ZZ.AUD_YR 		= YY.AUD_YR
											AND ZZ.AUD_NO 		= YY.AUD_NO
											AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
											AND ZZ.DOC_ID 		= YY.DOC_ID
											AND ZZ.APVR_CD 		= YY.APVR_CD
											AND ZZ.AFF_SNO 		= YY.AFF_SNO
											AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
											AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                                 
		                                WHERE ZZ.AUD_YR = AA.AUD_YR
		                                  AND ZZ.AUD_NO = AA.AUD_NO
		                                  AND ZZ.DOC_ID = AA.DOC_ID
		                                  AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || AA.AFF_CD || '-' || CC.AFF_DSP_CD
		                                  AND ZZ.APVR_CD = '0055700'
		                                  AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
		                              ) ) )
                ;		
		INSERT INTO TBBADDED145M
				  ( AUD_YR
				  , AUD_NO
				  , AUD_STEP_CD
				  , DOC_ID
				  , APVR_CD
				  , AFF_SNO
				  , AUD_KND_CD
				  , AUD_GRN_NO
				  , RPRT_FILD_ID
				  , AFF_CD
				  , LIST_NO
				  , REFER_DVSN_CD
				  , AFF_SPH
				  , TITLE_NM
				  , DP_TITLE_NM
				  , QST_DOC_ISUE_YN
				  , QST_DOC_ISUE_DY
				  , AUDTOR
				  , DETL_DOC_NO
				  , MTRL_IPT_DVSN_CD
				  , SYT_TRTM_DVSN_YN
				  , SCRT_YN
				  , SORT_SNO
				  , TRTM_EXAMER_CNB 
				  , FRT_USR_ID 
				  , FNL_USR_ID
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID
				  , FRT_REGI_DH
				  , FNL_MDF_DH
				  , FNL_YN)
			(SELECT DISTINCT AA.AUD_YR
				  , AA.AUD_NO
				  , 'A1060'
				  , AA.DOC_ID
				  , '0055700'
				  , AA.AFF_SNO
				  , AA.AUD_KND_CD
				  , AA.AUD_GRN_NO
				  , AA.RPRT_FILD_ID
				  , AA.AFF_CD
				  , AA.LIST_NO
				  , AA.REFER_DVSN_CD
				  , AA.AFF_SPH
				  , AA.TITLE_NM
				  , AA.TITLE_NM
				  , AA.QST_DOC_ISUE_YN
				  , AA.QST_DOC_ISUE_DY
				  , AA.AUDTOR
				  , AA.DETL_DOC_NO
				  , AA.MTRL_IPT_DVSN_CD
				  , AA.SYT_TRTM_DVSN_YN
				  , AA.SCRT_YN
				  , AA.SORT_SNO
				  , AA.TRTM_EXAMER_CNB
				  , #FNL_USR_ID#
				  , #FNL_USR_ID#
				  , #FNL_DEAL_DPT_CD#
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE
				  , AA.FNL_YN
		      FROM TBBADDED145M AA
                 , TBBADDED146M CC
		 	 WHERE AA.DOC_ID = #DOC_ID# 
		       AND AA.APVR_CD IN ( '0055600', '0045900')
               AND AA.AUD_YR = CC.AUD_YR
               AND AA.AUD_NO = CC.AUD_NO
               AND AA.DOC_ID = CC.DOC_ID
               AND AA.APVR_CD = CC.APVR_CD
               AND AA.AFF_SNO = CC.AFF_SNO
               AND NOT EXISTS (
                               SELECT 1 
                                 FROM TBBADDED147M ZZ
							 INNER JOIN TBBADDED148M YY
							 		 ON ZZ.AUD_YR 		= YY.AUD_YR
									AND ZZ.AUD_NO 		= YY.AUD_NO
									AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
									AND ZZ.DOC_ID 		= YY.DOC_ID
									AND ZZ.APVR_CD 		= YY.APVR_CD
									AND ZZ.AFF_SNO 		= YY.AFF_SNO
									AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
									AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                                 
                                WHERE ZZ.AUD_YR = AA.AUD_YR
                                  AND ZZ.AUD_NO = AA.AUD_NO
                                  AND ZZ.DOC_ID = AA.DOC_ID
                                  AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || AA.AFF_CD || '-' || CC.AFF_DSP_CD
                                  AND ZZ.APVR_CD = '0055700'
                                  AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
                              ) )
                      ;
                  END;
	</insert>
	<insert id="AEPAFU001InsertPsdDspRqDataByAudRprt" parameterClass="java.util.Map">
	DECLARE
		BEGIN
		INSERT INTO TBBADDED146H
			  ( HST_DVSN_CD
			  , HST_SNO
			  , HST_DH
			  , HST_USR_ID	
			  , AUD_YR
			  , AUD_NO
			  , AUD_STEP_CD
			  , DOC_ID
			  , APVR_CD
			  , AFF_SNO
			  , DSP_RQ_SNO
			  , DP_DSP_RQ_SNO
			  , AUD_KND_CD
			  , AUD_GRN_NO
			  , RPRT_FILD_ID
			  , AFF_DSP_CD
			  , RLTN_ORG_CD
			  , HND_ORG_CD
			  , REF_ORG_CD
			  , DSP_RQ_CD
			  , MTRL_IPT_DVSN_CD
			  , NOP_AM_DVSN_CD
			  , NOP_AM
			  , SORT_SNO
			  , FRT_USR_ID
			  , FNL_USR_ID
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID
			  , FRT_REGI_DH
			  , FNL_MDF_DH
			  , FNL_YN
			  , ACCN_INSP_CD
			  , NOP_SUM
			  , HD_AUD_STEP_CD	
			  , HD_DOC_ID	
			  , HD_APVR_CD	
			  , HD_AFF_SNO	
			  , HD_DSP_RQ_SNO
			  , KYWD1
			  , KYWD2
			  , KYWD3
			  , KYWD4
			  , KYWD5 )
		( SELECT 'C'
			  , TBBADDED146H_SEQ.NEXTVAL
			  , SYSDATE
			  , #FNL_USR_ID#
			  , AA.AUD_YR
			  , AA.AUD_NO
			  , 'A1060'
			  , AA.DOC_ID
			  , '0055700'
			  , AA.AFF_SNO
			  , AA.DSP_RQ_SNO
			  , AA.DSP_RQ_SNO
			  , AA.AUD_KND_CD
			  , AA.AUD_GRN_NO
			  , AA.RPRT_FILD_ID
			  , AA.AFF_DSP_CD
			  , AA.RLTN_ORG_CD
			  , AA.HND_ORG_CD
			  , AA.REF_ORG_CD
			  , AA.DSP_RQ_CD
			  , AA.MTRL_IPT_DVSN_CD
			  , AA.NOP_AM_DVSN_CD
			  , AA.NOP_AM
			  , AA.SORT_SNO
			  , #FNL_USR_ID#
			  , #FNL_USR_ID#
			  , #FNL_DEAL_DPT_CD#
			  , #FNL_MNU_ID#
			  , SYSDATE
			  , SYSDATE
			  , AA.FNL_YN
			  , AA.ACCN_INSP_CD
			  , AA.NOP_SUM
			  , AA.HD_AUD_STEP_CD	
			  , AA.HD_DOC_ID	
			  , AA.HD_APVR_CD	
			  , AA.HD_AFF_SNO	
			  , AA.HD_DSP_RQ_SNO
			  , AA.KYWD1
			  , AA.KYWD2
			  , AA.KYWD3
			  , AA.KYWD4
			  , AA.KYWD5
	      FROM TBBADDED146M AA
	         , TBBADDED145M CC
	 	 WHERE AA.DOC_ID = #DOC_ID# 
	   	   AND AA.APVR_CD IN ( '0055600', '0045900')
           AND AA.AUD_YR = CC.AUD_YR
           AND AA.AUD_NO = CC.AUD_NO
           AND AA.DOC_ID = CC.DOC_ID
           AND AA.APVR_CD = CC.APVR_CD
           AND AA.AFF_SNO = CC.AFF_SNO
           AND NOT EXISTS (
                           SELECT 1 
                             FROM TBBADDED147M ZZ
						 INNER JOIN TBBADDED148M YY
						 		 ON ZZ.AUD_YR 		= YY.AUD_YR
								AND ZZ.AUD_NO 		= YY.AUD_NO
								AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
								AND ZZ.DOC_ID 		= YY.DOC_ID
								AND ZZ.APVR_CD 		= YY.APVR_CD
								AND ZZ.AFF_SNO 		= YY.AFF_SNO
								AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
								AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                             
                            WHERE ZZ.AUD_YR = AA.AUD_YR
                              AND ZZ.AUD_NO = AA.AUD_NO
                              AND ZZ.DOC_ID = AA.DOC_ID
                              AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || CC.AFF_CD || '-' || AA.AFF_DSP_CD
                              AND ZZ.APVR_CD = '0055700'
                              AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
                          ) )
                ;          		
		INSERT INTO TBBADDED146M
			  ( AUD_YR
			  , AUD_NO
			  , AUD_STEP_CD
			  , DOC_ID
			  , APVR_CD
			  , AFF_SNO
			  , DSP_RQ_SNO
			  , DP_DSP_RQ_SNO
			  , AUD_KND_CD
			  , AUD_GRN_NO
			  , RPRT_FILD_ID
			  , AFF_DSP_CD
			  , RLTN_ORG_CD
			  , HND_ORG_CD
			  , REF_ORG_CD
			  , DSP_RQ_CD
			  , MTRL_IPT_DVSN_CD
			  , NOP_AM_DVSN_CD
			  , NOP_AM
			  , SORT_SNO
			  , FRT_USR_ID
			  , FNL_USR_ID
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID
			  , FRT_REGI_DH
			  , FNL_MDF_DH
			  , FNL_YN
			  , ACCN_INSP_CD
			  , NOP_SUM
			  , HD_AUD_STEP_CD	
			  , HD_DOC_ID	
			  , HD_APVR_CD	
			  , HD_AFF_SNO	
			  , HD_DSP_RQ_SNO
			  , KYWD1
			  , KYWD2
			  , KYWD3
			  , KYWD4
			  , KYWD5 )
		( SELECT AA.AUD_YR
			  , AA.AUD_NO
			  , 'A1060'
			  , AA.DOC_ID
			  , '0055700'
			  , AA.AFF_SNO
			  , AA.DSP_RQ_SNO
			  , AA.DSP_RQ_SNO
			  , AA.AUD_KND_CD
			  , AA.AUD_GRN_NO
			  , AA.RPRT_FILD_ID
			  , AA.AFF_DSP_CD
			  , AA.RLTN_ORG_CD
			  , AA.HND_ORG_CD
			  , AA.REF_ORG_CD
			  , AA.DSP_RQ_CD
			  , AA.MTRL_IPT_DVSN_CD
			  , AA.NOP_AM_DVSN_CD
			  , AA.NOP_AM
			  , AA.SORT_SNO
			  , #FNL_USR_ID#
			  , #FNL_USR_ID#
			  , #FNL_DEAL_DPT_CD#
			  , #FNL_MNU_ID#
			  , SYSDATE
			  , SYSDATE
			  , AA.FNL_YN
			  , AA.ACCN_INSP_CD
			  , AA.NOP_SUM
			  , AA.HD_AUD_STEP_CD	
			  , AA.HD_DOC_ID	
			  , AA.HD_APVR_CD	
			  , AA.HD_AFF_SNO	
			  , AA.HD_DSP_RQ_SNO
			  , AA.KYWD1
			  , AA.KYWD2
			  , AA.KYWD3
			  , AA.KYWD4
			  , AA.KYWD5
	      FROM TBBADDED146M AA
	         , TBBADDED145M CC
	 	 WHERE AA.DOC_ID = #DOC_ID# 
	   	   AND AA.APVR_CD IN ( '0055600', '0045900')
           AND AA.AUD_YR = CC.AUD_YR
           AND AA.AUD_NO = CC.AUD_NO
           AND AA.DOC_ID = CC.DOC_ID
           AND AA.APVR_CD = CC.APVR_CD
           AND AA.AFF_SNO = CC.AFF_SNO
           AND NOT EXISTS (
                           SELECT 1 
                             FROM TBBADDED147M ZZ
						 INNER JOIN TBBADDED148M YY
						 		 ON ZZ.AUD_YR 		= YY.AUD_YR
								AND ZZ.AUD_NO 		= YY.AUD_NO
								AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
								AND ZZ.DOC_ID 		= YY.DOC_ID
								AND ZZ.APVR_CD 		= YY.APVR_CD
								AND ZZ.AFF_SNO 		= YY.AFF_SNO
								AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
								AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                             
                            WHERE ZZ.AUD_YR = AA.AUD_YR
                              AND ZZ.AUD_NO = AA.AUD_NO
                              AND ZZ.DOC_ID = AA.DOC_ID
                              AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || CC.AFF_CD || '-' || AA.AFF_DSP_CD
                              AND ZZ.APVR_CD = '0055700'
                              AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
                          ) )
                   ;
             END;
	</insert>
	<insert id="AEPAFU001InsertPsdMppDataByAudRprt" parameterClass="java.util.Map">
	<![CDATA[
	DECLARE
		BEGIN
		INSERT INTO TBBADDED147H
			  ( HST_DVSN_CD
			  , HST_SNO
			  , HST_DH
			  , HST_USR_ID	
			  , AUD_YR		
			  , AUD_NO		
			  , AUD_STEP_CD	
			  , APVR_CD		
			  , AUD_KND_CD	
			  , AUD_GRN_NO	
			  , DOC_ID		
			  , RPRT_FILD_ID
			  , PRE_AFF_NO	
			  , AFF_NO		
			  , AFF_SNO		
			  , DSP_RQ_SNO	
			  , MPP_SEQ	
			  , SORT_SNO	
			  , FRT_USR_ID	
			  , FNL_USR_ID	
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID	
			  , FRT_REGI_DH	
			  , FNL_MDF_DH)
	     ( 
	     SELECT 'C'
			  , TBBADDED147H_SEQ.NEXTVAL
			  , SYSDATE
			  , #FNL_USR_ID#
	      	  , AUD_YR 
			  , AUD_NO 
			  , 'A1060'
			  , '0055700'
			  , AUD_KND_CD 
			  , AUD_GRN_NO
			  , DOC_ID 
			  , RPRT_FILD_ID 
			  , AFF_NO 
			  , AFF_NO 
			  , AFF_SNO 
			  , DSP_RQ_SNO 
			  , SEQ_MPP.NEXTVAL
			  , SORT_SNO 
			  , #FNL_USR_ID#
			  , #FNL_USR_ID#
			  , #FNL_DEAL_DPT_CD#
			  , #FNL_MNU_ID#
			  , SYSDATE
			  , SYSDATE	 
	       FROM
			     (SELECT DISTINCT AA.AUD_YR 
					  , AA.AUD_NO 
					  , AA.AUD_KND_CD 
					  , MAX(AA.AUD_GRN_NO) AS AUD_GRN_NO
					  , AA.DOC_ID 
					  , MAX(AA.RPRT_FILD_ID) AS RPRT_FILD_ID
					  , AA.AFF_NO 
					  , AA.AFF_SNO 
					  , AA.DSP_RQ_SNO 
					  , MIN(AA.SORT_SNO) AS SORT_SNO
				   FROM TBBADDED147M AA
		LEFT OUTER JOIN TBBADDED148M BB
			 		 ON AA.AUD_YR 		= BB.AUD_YR
					AND AA.AUD_NO 		= BB.AUD_NO
					AND AA.AUD_STEP_CD 	= BB.AUD_STEP_CD
					AND AA.DOC_ID 		= BB.DOC_ID
					AND AA.APVR_CD 		= BB.APVR_CD
					AND AA.AFF_SNO 		= BB.AFF_SNO
					AND AA.DSP_RQ_SNO 	= BB.DSP_RQ_SNO
					AND AA.MPP_SEQ 		= BB.MPP_SEQ
			 	 WHERE AA.DOC_ID = #DOC_ID# 
			   	   AND AA.APVR_CD IN ( '0055600', '0045900')
			   	   AND (BB.AFF_MPP_DVSN_CD IS NULL OR BB.AFF_MPP_DVSN_CD NOT IN('D90', 'D70', 'D80', 'D99' ) ) 
			  GROUP BY AA.AUD_YR 
					  , AA.AUD_NO 
					  , AA.AUD_KND_CD 
					  , AA.DOC_ID 
					  , AA.AFF_NO 
					  , AA.AFF_SNO 
					  , AA.DSP_RQ_SNO) )
			;		  		
		INSERT INTO TBBADDED147M
			  ( AUD_YR		
			  , AUD_NO		
			  , AUD_STEP_CD	
			  , APVR_CD		
			  , AUD_KND_CD	
			  , AUD_GRN_NO	
			  , DOC_ID		
			  , RPRT_FILD_ID
			  , PRE_AFF_NO	
			  , AFF_NO		
			  , AFF_SNO		
			  , DSP_RQ_SNO	
			  , MPP_SEQ	
			  , SORT_SNO	
			  , FRT_USR_ID	
			  , FNL_USR_ID	
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID	
			  , FRT_REGI_DH	
			  , FNL_MDF_DH)
	     ( 
	     SELECT  AUD_YR 
			  , AUD_NO 
			  , 'A1060'
			  , '0055700'
			  , AUD_KND_CD 
			  , AUD_GRN_NO
			  , DOC_ID 
			  , RPRT_FILD_ID 
			  , AFF_NO 
			  , AFF_NO 
			  , AFF_SNO 
			  , DSP_RQ_SNO 
			  , SEQ_MPP.NEXTVAL
			  , SORT_SNO 
			  , #FNL_USR_ID#
			  , #FNL_USR_ID#
			  , #FNL_DEAL_DPT_CD#
			  , #FNL_MNU_ID#
			  , SYSDATE
			  , SYSDATE	 
	       FROM
			     (SELECT DISTINCT AA.AUD_YR 
					  , AA.AUD_NO 
					  , AA.AUD_KND_CD 
					  , MAX(AA.AUD_GRN_NO) AS AUD_GRN_NO
					  , AA.DOC_ID 
					  , MAX(AA.RPRT_FILD_ID) AS RPRT_FILD_ID
					  , AA.AFF_NO 
					  , AA.AFF_SNO 
					  , AA.DSP_RQ_SNO 
					  , MIN(AA.SORT_SNO) AS SORT_SNO
				   FROM TBBADDED147M AA
		LEFT OUTER JOIN TBBADDED148M BB
			 		 ON AA.AUD_YR 		= BB.AUD_YR
					AND AA.AUD_NO 		= BB.AUD_NO
					AND AA.AUD_STEP_CD 	= BB.AUD_STEP_CD
					AND AA.DOC_ID 		= BB.DOC_ID
					AND AA.APVR_CD 		= BB.APVR_CD
					AND AA.AFF_SNO 		= BB.AFF_SNO
					AND AA.DSP_RQ_SNO 	= BB.DSP_RQ_SNO
					AND AA.MPP_SEQ 		= BB.MPP_SEQ
			 	 WHERE AA.DOC_ID = #DOC_ID# 
			   	   AND AA.APVR_CD IN ( '0055600', '0045900')
			   	   AND (BB.AFF_MPP_DVSN_CD IS NULL OR BB.AFF_MPP_DVSN_CD NOT IN('D90', 'D70', 'D80', 'D99' ) ) 
			  GROUP BY AA.AUD_YR 
					  , AA.AUD_NO 
					  , AA.AUD_KND_CD 
					  , AA.DOC_ID 
					  , AA.AFF_NO 
					  , AA.AFF_SNO 
					  , AA.DSP_RQ_SNO) )
				;
			END;
	]]>
	</insert>
	
	<insert id="AEPAFU001InsertCmtrAffDataByAudRprt" parameterClass="java.util.Map">
	DECLARE
		BEGIN
		INSERT INTO TBBADDED145H
			  ( HST_DVSN_CD
			  , HST_SNO
			  , HST_DH
			  , HST_USR_ID	
			  , AUD_YR
			  , AUD_NO
			  , AUD_STEP_CD
			  , DOC_ID
			  , APVR_CD
			  , AFF_SNO
			  , AUD_KND_CD
			  , AUD_GRN_NO
			  , RPRT_FILD_ID
			  , AFF_CD
			  , LIST_NO
			  , REFER_DVSN_CD
			  , AFF_SPH
			  , TITLE_NM
			  , DP_TITLE_NM
			  , QST_DOC_ISUE_YN
			  , QST_DOC_ISUE_DY
			  , AUDTOR
			  , DETL_DOC_NO
			  , MTRL_IPT_DVSN_CD
			  , SYT_TRTM_DVSN_YN
			  , SCRT_YN
			  , SORT_SNO
			  , TRTM_EXAMER_CNB 
			  , FRT_USR_ID 
			  , FNL_USR_ID
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID
			  , FRT_REGI_DH
			  , FNL_MDF_DH
			  , FNL_YN
			  , REF_DOC_ID)
			(SELECT 'C',
                     TBBADDED145H_SEQ.NEXTVAL,
                     SYSDATE,
                     FRT_USR_ID,
					 AUD_YR,
					 AUD_NO,
					 AUD_STEP_CD,
					 DOC_ID,
					 APVR_CD,
					 AFF_SNO,
					 AUD_KND_CD,
					 AUD_GRN_NO,
					 RPRT_FILD_ID,
					 AFF_CD,
					 LIST_NO,
					 REFER_DVSN_CD,
					 AFF_SPH,
					 TITLE_NM,
					 TITLE_NM,
					 QST_DOC_ISUE_YN,
					 QST_DOC_ISUE_DY,
					 AUDTOR,
					 DETL_DOC_NO,
					 MTRL_IPT_DVSN_CD,
					 SYT_TRTM_DVSN_YN,
					 SCRT_YN,
					 SORT_SNO,
					 TRTM_EXAMER_CNB,
					 FRT_USR_ID,
					 FNL_USR_ID,
					 FNL_DEAL_DPT_CD,
					 FNL_MNU_ID,
					 FRT_REGI_DH,
					 FNL_MDF_DH,
					 FNL_YN,
					 REF_DOC_ID                      						
	            FROM (SELECT AA.AUD_YR
						  , AA.AUD_NO
						  , 'A1070' 			AS AUD_STEP_CD
						  , AA.DOC_ID
						  , #TARGET_APVR_CD# 	AS APVR_CD
						  , AA.AFF_SNO
						  , AA.AUD_KND_CD
						  , AA.AUD_GRN_NO
						  , AA.RPRT_FILD_ID
						  , AA.AFF_CD
						  , AA.LIST_NO
						  , AA.REFER_DVSN_CD
						  , AA.AFF_SPH
						  , AA.TITLE_NM
						  , AA.QST_DOC_ISUE_YN
						  , AA.QST_DOC_ISUE_DY
						  , AA.AUDTOR
						  , AA.DETL_DOC_NO
						  , AA.MTRL_IPT_DVSN_CD
						  , AA.SYT_TRTM_DVSN_YN
						  , AA.SCRT_YN
						  , AA.SORT_SNO
						  , AA.TRTM_EXAMER_CNB
						  , #FNL_USR_ID# 		AS FRT_USR_ID
						  , #FNL_USR_ID# 		AS FNL_USR_ID
						  , #FNL_DEAL_DPT_CD# 	AS FNL_DEAL_DPT_CD
						  , #FNL_MNU_ID# 		AS FNL_MNU_ID
						  , SYSDATE 			AS FRT_REGI_DH
						  , SYSDATE 			AS FNL_MDF_DH
						  , AA.FNL_YN
						  , #copyAudRptId#		AS REF_DOC_ID
				      FROM TBBADDED145M AA
			             , TBBADDED146M CC
				 	 WHERE AA.DOC_ID = #DOC_ID# 
				       AND AA.APVR_CD = #APVR_CD#
			           AND AA.AUD_YR = CC.AUD_YR
			           AND AA.AUD_NO = CC.AUD_NO
			           AND AA.DOC_ID = CC.DOC_ID
			           AND AA.APVR_CD = CC.APVR_CD
			           AND AA.AFF_SNO = CC.AFF_SNO
			           AND NOT EXISTS (
			                           SELECT 1 
			                             FROM TBBADDED147M ZZ
							 	 INNER JOIN TBBADDED148M YY
								 		 ON ZZ.AUD_YR 		= YY.AUD_YR
										AND ZZ.AUD_NO 		= YY.AUD_NO
										AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
										AND ZZ.DOC_ID 		= YY.DOC_ID
										AND ZZ.APVR_CD 		= YY.APVR_CD
										AND ZZ.AFF_SNO 		= YY.AFF_SNO
										AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
										AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                            
			                            WHERE ZZ.AUD_YR = AA.AUD_YR
			                              AND ZZ.AUD_NO = AA.AUD_NO
			                              AND ZZ.DOC_ID = AA.DOC_ID
			                              AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || AA.AFF_CD || '-' || CC.AFF_DSP_CD
			                              AND ZZ.APVR_CD = #TARGET_APVR_CD#
			                              AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
			                          ) ) )
              ;            		
		INSERT INTO TBBADDED145M
			  ( AUD_YR
			  , AUD_NO
			  , AUD_STEP_CD
			  , DOC_ID
			  , APVR_CD
			  , AFF_SNO
			  , AUD_KND_CD
			  , AUD_GRN_NO
			  , RPRT_FILD_ID
			  , AFF_CD
			  , LIST_NO
			  , REFER_DVSN_CD
			  , AFF_SPH
			  , TITLE_NM
			  , DP_TITLE_NM
			  , QST_DOC_ISUE_YN
			  , QST_DOC_ISUE_DY
			  , AUDTOR
			  , DETL_DOC_NO
			  , MTRL_IPT_DVSN_CD
			  , SYT_TRTM_DVSN_YN
			  , SCRT_YN
			  , SORT_SNO
			  , TRTM_EXAMER_CNB 
			  , FRT_USR_ID 
			  , FNL_USR_ID
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID
			  , FRT_REGI_DH
			  , FNL_MDF_DH
			  , FNL_YN
			  , REF_DOC_ID)
		(SELECT DISTINCT AA.AUD_YR
			  , AA.AUD_NO
			  , 'A1070'
			  , AA.DOC_ID
			  , #TARGET_APVR_CD#
			  , AA.AFF_SNO
			  , AA.AUD_KND_CD
			  , AA.AUD_GRN_NO
			  , AA.RPRT_FILD_ID
			  , AA.AFF_CD
			  , AA.LIST_NO
			  , AA.REFER_DVSN_CD
			  , AA.AFF_SPH
			  , AA.TITLE_NM
			  , AA.TITLE_NM
			  , AA.QST_DOC_ISUE_YN
			  , AA.QST_DOC_ISUE_DY
			  , AA.AUDTOR
			  , AA.DETL_DOC_NO
			  , AA.MTRL_IPT_DVSN_CD
			  , AA.SYT_TRTM_DVSN_YN
			  , AA.SCRT_YN
			  , AA.SORT_SNO
			  , AA.TRTM_EXAMER_CNB
			  , #FNL_USR_ID#
			  , #FNL_USR_ID#
			  , #FNL_DEAL_DPT_CD#
			  , #FNL_MNU_ID#
			  , SYSDATE
			  , SYSDATE
			  , AA.FNL_YN
			  , #copyAudRptId#
	      FROM TBBADDED145M AA
             , TBBADDED146M CC
	 	 WHERE AA.DOC_ID = #DOC_ID# 
	       AND AA.APVR_CD = #APVR_CD#
           AND AA.AUD_YR = CC.AUD_YR
           AND AA.AUD_NO = CC.AUD_NO
           AND AA.DOC_ID = CC.DOC_ID
           AND AA.APVR_CD = CC.APVR_CD
           AND AA.AFF_SNO = CC.AFF_SNO
           AND NOT EXISTS (
                           SELECT 1 
                             FROM TBBADDED147M ZZ
				 	 INNER JOIN TBBADDED148M YY
					 		 ON ZZ.AUD_YR 		= YY.AUD_YR
							AND ZZ.AUD_NO 		= YY.AUD_NO
							AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
							AND ZZ.DOC_ID 		= YY.DOC_ID
							AND ZZ.APVR_CD 		= YY.APVR_CD
							AND ZZ.AFF_SNO 		= YY.AFF_SNO
							AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
							AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                            
                            WHERE ZZ.AUD_YR = AA.AUD_YR
                              AND ZZ.AUD_NO = AA.AUD_NO
                              AND ZZ.DOC_ID = AA.DOC_ID
                              AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || AA.AFF_CD || '-' || CC.AFF_DSP_CD
                              AND ZZ.APVR_CD = #TARGET_APVR_CD#
                              AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
                          ) )
                   ;
             END;
	</insert>
	<insert id="AEPAFU001InsertCmtrDspRqDataByAudRprt" parameterClass="java.util.Map">
	DECLARE
		BEGIN
		INSERT INTO TBBADDED146H
			  ( HST_DVSN_CD
			  , HST_SNO
			  , HST_DH
			  , HST_USR_ID	
			  , AUD_YR
			  , AUD_NO
			  , AUD_STEP_CD
			  , DOC_ID
			  , APVR_CD
			  , AFF_SNO
			  , DSP_RQ_SNO
			  , DP_DSP_RQ_SNO
			  , AUD_KND_CD
			  , AUD_GRN_NO
			  , RPRT_FILD_ID
			  , AFF_DSP_CD
			  , RLTN_ORG_CD
			  , HND_ORG_CD
			  , REF_ORG_CD
			  , DSP_RQ_CD
			  , MTRL_IPT_DVSN_CD
			  , NOP_AM_DVSN_CD
			  , NOP_AM
			  , SORT_SNO
			  , FRT_USR_ID
			  , FNL_USR_ID
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID
			  , FRT_REGI_DH
			  , FNL_MDF_DH
			  , FNL_YN
			  , ACCN_INSP_CD
			  , REF_DOC_ID
			  , NOP_SUM
			  , HD_AUD_STEP_CD	
			  , HD_DOC_ID	
			  , HD_APVR_CD	
			  , HD_AFF_SNO	
			  , HD_DSP_RQ_SNO
			  , KYWD1
			  , KYWD2
			  , KYWD3
			  , KYWD4
			  , KYWD5
			  )
		( SELECT 'C'
			  , TBBADDED146H_SEQ.NEXTVAL
			  , SYSDATE
			  , #FNL_USR_ID#
			  , AA.AUD_YR
			  , AA.AUD_NO
			  , 'A1070'
			  , AA.DOC_ID
			  , #TARGET_APVR_CD#
			  , AA.AFF_SNO
			  , AA.DSP_RQ_SNO
			  , AA.DSP_RQ_SNO
			  , AA.AUD_KND_CD
			  , AA.AUD_GRN_NO
			  , AA.RPRT_FILD_ID
			  , AA.AFF_DSP_CD
			  , AA.RLTN_ORG_CD
			  , AA.HND_ORG_CD
			  , AA.REF_ORG_CD
			  , AA.DSP_RQ_CD
			  , AA.MTRL_IPT_DVSN_CD
			  , AA.NOP_AM_DVSN_CD
			  , AA.NOP_AM
			  , AA.SORT_SNO
			  , #FNL_USR_ID#
			  , #FNL_USR_ID#
			  , #FNL_DEAL_DPT_CD#
			  , #FNL_MNU_ID#
			  , SYSDATE
			  , SYSDATE
			  , AA.FNL_YN
			  , AA.ACCN_INSP_CD
			  , #copyAudRptId#
			  , AA.NOP_SUM
			  , AA.HD_AUD_STEP_CD	
			  , AA.HD_DOC_ID	
			  , AA.HD_APVR_CD	
			  , AA.HD_AFF_SNO	
			  , AA.HD_DSP_RQ_SNO
			  , AA.KYWD1
			  , AA.KYWD2
			  , AA.KYWD3
			  , AA.KYWD4
			  , AA.KYWD5
	      FROM TBBADDED146M AA
	         , TBBADDED145M CC
	 	 WHERE AA.DOC_ID = #DOC_ID# 
	   	   AND AA.APVR_CD = #APVR_CD#
           AND AA.AUD_YR = CC.AUD_YR
           AND AA.AUD_NO = CC.AUD_NO
           AND AA.DOC_ID = CC.DOC_ID
           AND AA.APVR_CD = CC.APVR_CD
           AND AA.AFF_SNO = CC.AFF_SNO
           AND NOT EXISTS (
                           SELECT 1 
                             FROM TBBADDED147M ZZ
						 INNER JOIN TBBADDED148M YY
						 		 ON ZZ.AUD_YR 		= YY.AUD_YR
								AND ZZ.AUD_NO 		= YY.AUD_NO
								AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
								AND ZZ.DOC_ID 		= YY.DOC_ID
								AND ZZ.APVR_CD 		= YY.APVR_CD
								AND ZZ.AFF_SNO 		= YY.AFF_SNO
								AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
								AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                             
                            WHERE ZZ.AUD_YR = AA.AUD_YR
                              AND ZZ.AUD_NO = AA.AUD_NO
                              AND ZZ.DOC_ID = AA.DOC_ID
                              AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || CC.AFF_CD || '-' || AA.AFF_DSP_CD
                              AND ZZ.APVR_CD = #TARGET_APVR_CD#
                              AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
                          ) )
              ;            		
		INSERT INTO TBBADDED146M
			  ( AUD_YR
			  , AUD_NO
			  , AUD_STEP_CD
			  , DOC_ID
			  , APVR_CD
			  , AFF_SNO
			  , DSP_RQ_SNO
			  , DP_DSP_RQ_SNO
			  , AUD_KND_CD
			  , AUD_GRN_NO
			  , RPRT_FILD_ID
			  , AFF_DSP_CD
			  , RLTN_ORG_CD
			  , HND_ORG_CD
			  , REF_ORG_CD
			  , DSP_RQ_CD
			  , MTRL_IPT_DVSN_CD
			  , NOP_AM_DVSN_CD
			  , NOP_AM
			  , SORT_SNO
			  , FRT_USR_ID
			  , FNL_USR_ID
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID
			  , FRT_REGI_DH
			  , FNL_MDF_DH
			  , FNL_YN
			  , ACCN_INSP_CD
			  , REF_DOC_ID
			  , NOP_SUM
			  , HD_AUD_STEP_CD	
			  , HD_DOC_ID	
			  , HD_APVR_CD	
			  , HD_AFF_SNO	
			  , HD_DSP_RQ_SNO
			  , KYWD1
			  , KYWD2
			  , KYWD3
			  , KYWD4
			  , KYWD5
			  )
		( SELECT AA.AUD_YR
			  , AA.AUD_NO
			  , 'A1070'
			  , AA.DOC_ID
			  , #TARGET_APVR_CD#
			  , AA.AFF_SNO
			  , AA.DSP_RQ_SNO
			  , AA.DSP_RQ_SNO
			  , AA.AUD_KND_CD
			  , AA.AUD_GRN_NO
			  , AA.RPRT_FILD_ID
			  , AA.AFF_DSP_CD
			  , AA.RLTN_ORG_CD
			  , AA.HND_ORG_CD
			  , AA.REF_ORG_CD
			  , AA.DSP_RQ_CD
			  , AA.MTRL_IPT_DVSN_CD
			  , AA.NOP_AM_DVSN_CD
			  , AA.NOP_AM
			  , AA.SORT_SNO
			  , #FNL_USR_ID#
			  , #FNL_USR_ID#
			  , #FNL_DEAL_DPT_CD#
			  , #FNL_MNU_ID#
			  , SYSDATE
			  , SYSDATE
			  , AA.FNL_YN
			  , AA.ACCN_INSP_CD
			  , #copyAudRptId#
			  , AA.NOP_SUM
			  , AA.HD_AUD_STEP_CD	
			  , AA.HD_DOC_ID	
			  , AA.HD_APVR_CD	
			  , AA.HD_AFF_SNO	
			  , AA.HD_DSP_RQ_SNO
			  , AA.KYWD1
			  , AA.KYWD2
			  , AA.KYWD3
			  , AA.KYWD4
			  , AA.KYWD5
	      FROM TBBADDED146M AA
	         , TBBADDED145M CC
	 	 WHERE AA.DOC_ID = #DOC_ID# 
	   	   AND AA.APVR_CD = #APVR_CD#
           AND AA.AUD_YR = CC.AUD_YR
           AND AA.AUD_NO = CC.AUD_NO
           AND AA.DOC_ID = CC.DOC_ID
           AND AA.APVR_CD = CC.APVR_CD
           AND AA.AFF_SNO = CC.AFF_SNO
           AND NOT EXISTS (
                           SELECT 1 
                             FROM TBBADDED147M ZZ
						 INNER JOIN TBBADDED148M YY
						 		 ON ZZ.AUD_YR 		= YY.AUD_YR
								AND ZZ.AUD_NO 		= YY.AUD_NO
								AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
								AND ZZ.DOC_ID 		= YY.DOC_ID
								AND ZZ.APVR_CD 		= YY.APVR_CD
								AND ZZ.AFF_SNO 		= YY.AFF_SNO
								AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
								AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                             
                            WHERE ZZ.AUD_YR = AA.AUD_YR
                              AND ZZ.AUD_NO = AA.AUD_NO
                              AND ZZ.DOC_ID = AA.DOC_ID
                              AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, AA.AUD_KND_CD, '-') || '-' || CC.AFF_CD || '-' || AA.AFF_DSP_CD
                              AND ZZ.APVR_CD = #TARGET_APVR_CD#
                              AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
                          ) )
                     ;
                END;
	</insert>
	
	<insert id="AEPAFU001InsertCmtrMppDataByAudRprt" parameterClass="java.util.Map">
	<![CDATA[
	DECLARE
		BEGIN
		INSERT INTO TBBADDED147H
			  ( HST_DVSN_CD
			  , HST_SNO
			  , HST_DH
			  , HST_USR_ID	
			  , AUD_YR		
			  , AUD_NO		
			  , AUD_STEP_CD	
			  , APVR_CD		
			  , AUD_KND_CD	
			  , AUD_GRN_NO	
			  , DOC_ID		
			  , RPRT_FILD_ID
			  , PRE_AFF_NO	
			  , AFF_NO		
			  , AFF_SNO		
			  , DSP_RQ_SNO		
			  , MPP_SEQ
			  , SORT_SNO	
			  , FRT_USR_ID	
			  , FNL_USR_ID	
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID	
			  , FRT_REGI_DH	
			  , FNL_MDF_DH)
	     ( SELECT 'C'
				  , TBBADDED147H_SEQ.NEXTVAL
				  , SYSDATE
				  , #FNL_USR_ID#
	     		  , AUD_YR 
				  , AUD_NO 
				  , 'A1070' 
				  , #TARGET_APVR_CD#
				  , AUD_KND_CD 
				  , AUD_GRN_NO 
				  , DOC_ID 
				  , RPRT_FILD_ID 
				  , AFF_NO 
				  , AFF_NO 
				  , AFF_SNO 
				  , DSP_RQ_SNO 
				  , SEQ_MPP.NEXTVAL
				  , SORT_SNO 
				  , #FNL_USR_ID#
				  , #FNL_USR_ID#
				  , #FNL_DEAL_DPT_CD#
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE	 
	         FROM (SELECT DISTINCT AA.AUD_YR 
					  , AA.AUD_NO 
					  , AA.AUD_KND_CD 
					  , MAX(AA.AUD_GRN_NO) AS AUD_GRN_NO 
					  , AA.DOC_ID 
					  , MAX(AA.RPRT_FILD_ID) AS RPRT_FILD_ID
					  , AA.AFF_NO 
					  , AA.AFF_SNO 
					  , AA.DSP_RQ_SNO 
					  , MIN(AA.SORT_SNO) AS SORT_SNO  
				   FROM TBBADDED147M AA
		LEFT OUTER JOIN TBBADDED148M BB
			 		 ON AA.AUD_YR 		= BB.AUD_YR
					AND AA.AUD_NO 		= BB.AUD_NO
					AND AA.AUD_STEP_CD 	= BB.AUD_STEP_CD
					AND AA.DOC_ID 		= BB.DOC_ID
					AND AA.APVR_CD 		= BB.APVR_CD
					AND AA.AFF_SNO 		= BB.AFF_SNO
					AND AA.DSP_RQ_SNO 	= BB.DSP_RQ_SNO
					AND AA.MPP_SEQ 		= BB.MPP_SEQ		   
			 	 WHERE AA.DOC_ID = #DOC_ID# 
			   	   AND AA.APVR_CD = #APVR_CD#
			   	   AND (BB.AFF_MPP_DVSN_CD IS NULL OR BB.AFF_MPP_DVSN_CD NOT IN('D90', 'D70', 'D80', 'D99' ) ) 
			  GROUP BY AA.AUD_YR 
					  , AA.AUD_NO 
					  , AA.AUD_KND_CD 
					  , AA.DOC_ID 
					  , AA.AFF_NO 
					  , AA.AFF_SNO 
					  , AA.DSP_RQ_SNO ) )
				;		
		INSERT INTO TBBADDED147M
			  ( AUD_YR		
			  , AUD_NO		
			  , AUD_STEP_CD	
			  , APVR_CD		
			  , AUD_KND_CD	
			  , AUD_GRN_NO	
			  , DOC_ID		
			  , RPRT_FILD_ID
			  , PRE_AFF_NO	
			  , AFF_NO		
			  , AFF_SNO		
			  , DSP_RQ_SNO		
			  , MPP_SEQ
			  , SORT_SNO	
			  , FRT_USR_ID	
			  , FNL_USR_ID	
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID	
			  , FRT_REGI_DH	
			  , FNL_MDF_DH)
	     ( SELECT  AUD_YR 
				  , AUD_NO 
				  , 'A1070' 
				  , #TARGET_APVR_CD#
				  , AUD_KND_CD 
				  , AUD_GRN_NO 
				  , DOC_ID 
				  , RPRT_FILD_ID 
				  , AFF_NO 
				  , AFF_NO 
				  , AFF_SNO 
				  , DSP_RQ_SNO 
				  , SEQ_MPP.NEXTVAL
				  , SORT_SNO 
				  , #FNL_USR_ID#
				  , #FNL_USR_ID#
				  , #FNL_DEAL_DPT_CD#
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE	 
	         FROM (SELECT DISTINCT AA.AUD_YR 
					  , AA.AUD_NO 
					  , AA.AUD_KND_CD 
					  , MAX(AA.AUD_GRN_NO) AS AUD_GRN_NO 
					  , AA.DOC_ID 
					  , MAX(AA.RPRT_FILD_ID) AS RPRT_FILD_ID
					  , AA.AFF_NO 
					  , AA.AFF_SNO 
					  , AA.DSP_RQ_SNO 
					  , MIN(AA.SORT_SNO) AS SORT_SNO  
				   FROM TBBADDED147M AA
		LEFT OUTER JOIN TBBADDED148M BB
			 		 ON AA.AUD_YR 		= BB.AUD_YR
					AND AA.AUD_NO 		= BB.AUD_NO
					AND AA.AUD_STEP_CD 	= BB.AUD_STEP_CD
					AND AA.DOC_ID 		= BB.DOC_ID
					AND AA.APVR_CD 		= BB.APVR_CD
					AND AA.AFF_SNO 		= BB.AFF_SNO
					AND AA.DSP_RQ_SNO 	= BB.DSP_RQ_SNO
					AND AA.MPP_SEQ 		= BB.MPP_SEQ		   
			 	 WHERE AA.DOC_ID = #DOC_ID# 
			   	   AND AA.APVR_CD = #APVR_CD#
			   	   AND (BB.AFF_MPP_DVSN_CD IS NULL OR BB.AFF_MPP_DVSN_CD NOT IN('D90', 'D70', 'D80', 'D99' ) ) 
			  GROUP BY AA.AUD_YR 
					  , AA.AUD_NO 
					  , AA.AUD_KND_CD 
					  , AA.DOC_ID 
					  , AA.AFF_NO 
					  , AA.AFF_SNO 
					  , AA.DSP_RQ_SNO ) )
			;
		END;
	]]>
	</insert>

    <insert id="AEPAFU001InsertCmtrMppDataBySptHndlRprt" parameterClass="java.util.Map">
    <![CDATA[
    DECLARE
    	BEGIN
        INSERT INTO TBBADDED147H
              ( HST_DVSN_CD
			  , HST_SNO
			  , HST_DH
			  , HST_USR_ID	
			  , AUD_YR      
              , AUD_NO      
              , AUD_STEP_CD 
              , APVR_CD     
              , AUD_KND_CD  
              , AUD_GRN_NO  
              , DOC_ID      
              , RPRT_FILD_ID
              , PRE_AFF_NO  
              , AFF_NO      
              , AFF_SNO     
              , DSP_RQ_SNO    
              , MPP_SEQ
              , SORT_SNO    
              , FRT_USR_ID  
              , FNL_USR_ID  
              , FNL_DEAL_DPT_CD
              , FNL_MNU_ID  
              , FRT_REGI_DH 
              , FNL_MDF_DH)
         ( SELECT 'C'
				  , TBBADDED147H_SEQ.NEXTVAL
				  , SYSDATE
				  , #FNL_USR_ID#
         		  , AUD_YR 
	              , AUD_NO 
	              , #PARAM_AUD_STEP_CD#  
	              , #PARAM_APVR_CD#
	              , AUD_KND_CD 
	              , AUD_GRN_NO 
	              , DOC_ID 
	              , RPRT_FILD_ID 
	              , AFF_NO 
	              , '' 
	              , AFF_SNO 
	              , DSP_RQ_SNO 
	              , SEQ_MPP.NEXTVAL
	              , SORT_SNO 
	              , #FNL_USR_ID#
	              , #FNL_USR_ID#
	              , #FNL_DEAL_DPT_CD#
	              , #FNL_MNU_ID#
	              , SYSDATE
	              , SYSDATE  
             FROM(SELECT DISTINCT AA.AUD_YR 
		              , AA.AUD_NO 
		              , AA.AUD_KND_CD 
		              , MAX(AA.AUD_GRN_NO) AS AUD_GRN_NO
		              , AA.DOC_ID 
		              , MAX(AA.RPRT_FILD_ID) AS RPRT_FILD_ID 
		              , AA.AFF_NO 
		              , AA.AFF_SNO 
		              , AA.DSP_RQ_SNO 
		              , MIN(AA.SORT_SNO) AS SORT_SNO
		           FROM TBBADDED147M AA
		LEFT OUTER JOIN TBBADDED148M BB
			 		 ON AA.AUD_YR 		= BB.AUD_YR
					AND AA.AUD_NO 		= BB.AUD_NO
					AND AA.AUD_STEP_CD 	= BB.AUD_STEP_CD
					AND AA.DOC_ID 		= BB.DOC_ID
					AND AA.APVR_CD 		= BB.APVR_CD
					AND AA.AFF_SNO 		= BB.AFF_SNO
					AND AA.DSP_RQ_SNO 	= BB.DSP_RQ_SNO
					AND AA.MPP_SEQ 		= BB.MPP_SEQ          
		         WHERE AA.DOC_ID = #DOC_ID# 
		           AND AA.APVR_CD = #APVR_CD#
			   	   AND (BB.AFF_MPP_DVSN_CD IS NULL OR BB.AFF_MPP_DVSN_CD NOT IN('D90', 'D70', 'D80', 'D99') ) 
		   	 GROUP BY AA.AUD_YR 
		              , AA.AUD_NO 
		              , AA.AUD_KND_CD 
		              , AA.DOC_ID 
		              , AA.AFF_NO 
		              , AA.AFF_SNO 
		              , AA.DSP_RQ_SNO ) )
		      ;    	
        INSERT INTO TBBADDED147M
              ( AUD_YR      
              , AUD_NO      
              , AUD_STEP_CD 
              , APVR_CD     
              , AUD_KND_CD  
              , AUD_GRN_NO  
              , DOC_ID      
              , RPRT_FILD_ID
              , PRE_AFF_NO  
              , AFF_NO      
              , AFF_SNO     
              , DSP_RQ_SNO    
              , MPP_SEQ
              , SORT_SNO    
              , FRT_USR_ID  
              , FNL_USR_ID  
              , FNL_DEAL_DPT_CD
              , FNL_MNU_ID  
              , FRT_REGI_DH 
              , FNL_MDF_DH)
         ( SELECT  AUD_YR 
	              , AUD_NO 
	              , #PARAM_AUD_STEP_CD#  
	              , #PARAM_APVR_CD#
	              , AUD_KND_CD 
	              , AUD_GRN_NO 
	              , DOC_ID 
	              , RPRT_FILD_ID 
	              , AFF_NO 
	              , '' 
	              , AFF_SNO 
	              , DSP_RQ_SNO 
	              , SEQ_MPP.NEXTVAL
	              , SORT_SNO 
	              , #FNL_USR_ID#
	              , #FNL_USR_ID#
	              , #FNL_DEAL_DPT_CD#
	              , #FNL_MNU_ID#
	              , SYSDATE
	              , SYSDATE  
             FROM(SELECT DISTINCT AA.AUD_YR 
		              , AA.AUD_NO 
		              , AA.AUD_KND_CD 
		              , MAX(AA.AUD_GRN_NO) AS AUD_GRN_NO
		              , AA.DOC_ID 
		              , MAX(AA.RPRT_FILD_ID) AS RPRT_FILD_ID 
		              , AA.AFF_NO 
		              , AA.AFF_SNO 
		              , AA.DSP_RQ_SNO 
		              , MIN(AA.SORT_SNO) AS SORT_SNO
		           FROM TBBADDED147M AA
		LEFT OUTER JOIN TBBADDED148M BB
			 		 ON AA.AUD_YR 		= BB.AUD_YR
					AND AA.AUD_NO 		= BB.AUD_NO
					AND AA.AUD_STEP_CD 	= BB.AUD_STEP_CD
					AND AA.DOC_ID 		= BB.DOC_ID
					AND AA.APVR_CD 		= BB.APVR_CD
					AND AA.AFF_SNO 		= BB.AFF_SNO
					AND AA.DSP_RQ_SNO 	= BB.DSP_RQ_SNO
					AND AA.MPP_SEQ 		= BB.MPP_SEQ          
		         WHERE AA.DOC_ID = #DOC_ID# 
		           AND AA.APVR_CD = #APVR_CD#
			   	   AND (BB.AFF_MPP_DVSN_CD IS NULL OR BB.AFF_MPP_DVSN_CD NOT IN('D90', 'D70', 'D80', 'D99') ) 
		   	 GROUP BY AA.AUD_YR 
		              , AA.AUD_NO 
		              , AA.AUD_KND_CD 
		              , AA.DOC_ID 
		              , AA.AFF_NO 
		              , AA.AFF_SNO 
		              , AA.DSP_RQ_SNO ) )
		         ;
		   END;
    ]]>
    </insert>

	<update id="AEPAFU001UpdateAffFnlYnReSetByAudRprt" parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN			
			UPDATE TBBADDED145M
			   SET FNL_YN = 'N'
			 WHERE DOC_ID = #DOC_ID#	
		;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , 'SYSTEM'
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID
				 FROM TBBADDED145M
			 	WHERE DOC_ID = #DOC_ID#	
				;
		END;
		]]>
	</update>
	<update id="AEPAFU001UpdateDSpFnlYnReSetByAudRprt" parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN
			UPDATE TBBADDED146M
			   SET FNL_YN = 'N'
			 WHERE DOC_ID = #DOC_ID#
		;
		INSERT INTO TBBADDED146H
				(
				    HST_DVSN_CD
				  , HST_SNO
				  , HST_DH
				  , HST_USR_ID	
				  , AUD_YR
				  , AUD_NO
				  , AUD_STEP_CD 	
				  , DOC_ID 			
				  , APVR_CD 		
				  , AFF_SNO 		
				  , DSP_RQ_SNO 		
				  , DP_DSP_RQ_SNO 	
				  , AUD_KND_CD 		
				  , AUD_GRN_NO 		
				  , RPRT_FILD_ID 	
				  , AFF_DSP_CD 		
				  , RLTN_ORG_CD 	
				  , HND_ORG_CD 		
				  , REF_ORG_CD 		
				  , DSP_RQ_CD 		
				  , MTRL_IPT_DVSN_CD
				  , NOP_AM_DVSN_CD 	
				  , NOP_AM 			
				  , SORT_SNO		
				  , ACCN_INSP_CD	
				  , FNL_YN 			
				  , FRT_USR_ID 		
				  , FNL_USR_ID 		
				  , FNL_DEAL_DPT_CD 
				  , FNL_MNU_ID 		
				  , FRT_REGI_DH		
				  , FNL_MDF_DH 		
				  , NOP_SUM 		
				  , HD_AUD_STEP_CD 	
				  , HD_DOC_ID		
				  , HD_APVR_CD		
				  , HD_AFF_SNO 		
				  , HD_DSP_RQ_SNO	
				  , REF_DOC_ID 		
				  , DF_AUD_STEP_CD 	
				  , DF_DOC_ID 		
				  , DF_APVR_CD 		
				  , DF_AFF_SNO		
				  , DF_DSP_RQ_SNO 	
				  , KYWD1			
				  , KYWD2 			
				  , KYWD3 			
				  , KYWD4			
				  , KYWD5			
				)
			SELECT 'U'
			 	 , TBBADDED146H_SEQ.NEXTVAL
			 	 , SYSDATE
			 	 , 'SYSTEM'
				 , AUD_YR
				 , AUD_NO
				 , AUD_STEP_CD 	
				 , DOC_ID 			
				 , APVR_CD 		
				 , AFF_SNO 		
				 , DSP_RQ_SNO 		
				 , DP_DSP_RQ_SNO 	
				 , AUD_KND_CD 		
				 , AUD_GRN_NO 		
				 , RPRT_FILD_ID 	
				 , AFF_DSP_CD 		
				 , RLTN_ORG_CD 	
				 , HND_ORG_CD 		
				 , REF_ORG_CD 		
				 , DSP_RQ_CD 		
				 , MTRL_IPT_DVSN_CD
				 , NOP_AM_DVSN_CD 	
				 , NOP_AM 			
				 , SORT_SNO		
				 , ACCN_INSP_CD	
				 , FNL_YN 			
				 , FRT_USR_ID 		
				 , FNL_USR_ID 		
				 , FNL_DEAL_DPT_CD 
				 , FNL_MNU_ID 		
				 , FRT_REGI_DH		
				 , FNL_MDF_DH 		
				 , NOP_SUM 		
				 , HD_AUD_STEP_CD 	
				 , HD_DOC_ID		
				 , HD_APVR_CD		
				 , HD_AFF_SNO 		
				 , HD_DSP_RQ_SNO	
				 , REF_DOC_ID 		
				 , DF_AUD_STEP_CD 	
				 , DF_DOC_ID 		
				 , DF_APVR_CD 		
				 , DF_AFF_SNO		
				 , DF_DSP_RQ_SNO 	
				 , KYWD1			
				 , KYWD2 			
				 , KYWD3 			
				 , KYWD4			
				 , KYWD5
			 FROM TBBADDED146M
			WHERE DOC_ID = #DOC_ID#
				;
		END;			
		]]>
	</update>
	
	<update id="AEPAFU001UpdateAffFnlYnReSetByRefDocId" parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN
			UPDATE TBBADDED145M
			   SET FNL_YN = 'Y'
			 WHERE REF_DOC_ID = #DOC_ID#	
			   AND APVR_CD = 'A1070'
			;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , 'SYSTEM'
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID
				 FROM TBBADDED145M
			 	WHERE REF_DOC_ID = #DOC_ID#	
			   	  AND APVR_CD = 'A1070'
				;
		END;			   
		]]>
	</update>
	<update id="AEPAFU001UpdateDspFnlYnReSetByRefDocId" parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN
			UPDATE TBBADDED146M
			   SET FNL_YN = 'Y'
			 WHERE REF_DOC_ID = #DOC_ID#	
			   AND APVR_CD = 'A1070'
			;
	INSERT INTO TBBADDED146H
				(
				    HST_DVSN_CD
				  , HST_SNO
				  , HST_DH
				  , HST_USR_ID	
				  , AUD_YR
				  , AUD_NO
				  , AUD_STEP_CD 	
				  , DOC_ID 			
				  , APVR_CD 		
				  , AFF_SNO 		
				  , DSP_RQ_SNO 		
				  , DP_DSP_RQ_SNO 	
				  , AUD_KND_CD 		
				  , AUD_GRN_NO 		
				  , RPRT_FILD_ID 	
				  , AFF_DSP_CD 		
				  , RLTN_ORG_CD 	
				  , HND_ORG_CD 		
				  , REF_ORG_CD 		
				  , DSP_RQ_CD 		
				  , MTRL_IPT_DVSN_CD
				  , NOP_AM_DVSN_CD 	
				  , NOP_AM 			
				  , SORT_SNO		
				  , ACCN_INSP_CD	
				  , FNL_YN 			
				  , FRT_USR_ID 		
				  , FNL_USR_ID 		
				  , FNL_DEAL_DPT_CD 
				  , FNL_MNU_ID 		
				  , FRT_REGI_DH		
				  , FNL_MDF_DH 		
				  , NOP_SUM 		
				  , HD_AUD_STEP_CD 	
				  , HD_DOC_ID		
				  , HD_APVR_CD		
				  , HD_AFF_SNO 		
				  , HD_DSP_RQ_SNO	
				  , REF_DOC_ID 		
				  , DF_AUD_STEP_CD 	
				  , DF_DOC_ID 		
				  , DF_APVR_CD 		
				  , DF_AFF_SNO		
				  , DF_DSP_RQ_SNO 	
				  , KYWD1			
				  , KYWD2 			
				  , KYWD3 			
				  , KYWD4			
				  , KYWD5			
				)
			SELECT 'U'
			 	 , TBBADDED146H_SEQ.NEXTVAL
			 	 , SYSDATE
			 	 , 'SYSTEM'
				 , AUD_YR
				 , AUD_NO
				 , AUD_STEP_CD 	
				 , DOC_ID 			
				 , APVR_CD 		
				 , AFF_SNO 		
				 , DSP_RQ_SNO 		
				 , DP_DSP_RQ_SNO 	
				 , AUD_KND_CD 		
				 , AUD_GRN_NO 		
				 , RPRT_FILD_ID 	
				 , AFF_DSP_CD 		
				 , RLTN_ORG_CD 	
				 , HND_ORG_CD 		
				 , REF_ORG_CD 		
				 , DSP_RQ_CD 		
				 , MTRL_IPT_DVSN_CD
				 , NOP_AM_DVSN_CD 	
				 , NOP_AM 			
				 , SORT_SNO		
				 , ACCN_INSP_CD	
				 , FNL_YN 			
				 , FRT_USR_ID 		
				 , FNL_USR_ID 		
				 , FNL_DEAL_DPT_CD 
				 , FNL_MNU_ID 		
				 , FRT_REGI_DH		
				 , FNL_MDF_DH 		
				 , NOP_SUM 		
				 , HD_AUD_STEP_CD 	
				 , HD_DOC_ID		
				 , HD_APVR_CD		
				 , HD_AFF_SNO 		
				 , HD_DSP_RQ_SNO	
				 , REF_DOC_ID 		
				 , DF_AUD_STEP_CD 	
				 , DF_DOC_ID 		
				 , DF_APVR_CD 		
				 , DF_AFF_SNO		
				 , DF_DSP_RQ_SNO 	
				 , KYWD1			
				 , KYWD2 			
				 , KYWD3 			
				 , KYWD4			
				 , KYWD5
			 FROM TBBADDED146M
			 WHERE REF_DOC_ID = #DOC_ID#	
			   AND APVR_CD = 'A1070'
				;
		END;	
		]]>
	</update>
	
	<update id="AEPAFU001UpdateAffFnlYnSetByAudRprt" parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN
			UPDATE TBBADDED145M
			   SET FNL_YN = 'Y'
			 WHERE DOC_ID = #DOC_ID#
			   AND APVR_CD = (SELECT MAX(B.APVR_PST_CD)
							    FROM TBBADDED103M A
								   , TBDCMACM023L B
							   WHERE B.APV_DOC_NO = #APV_DOC_NO#
							     AND A.APV_RQS_ID = B.APV_DOC_NO
							     AND B.APV_SNO = (
											  SELECT MAX(D.APV_SNO)
												FROM TBBADDED103M C
												   , TBDCMACM023L D
											   WHERE D.APV_DOC_NO = B.APV_DOC_NO
												 AND C.APV_RQS_ID = D.APV_DOC_NO
												 AND D.APV_SNO <> 1
											     AND C.RPRT_CD = #RPRT_CD#
											     AND C.DOC_ID = #DOC_ID#
											     AND D.APVR_STA_CD IN ('202','203','204')
                                                 AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
												  )
							     AND A.RPRT_CD = #RPRT_CD#
							     AND B.APVR_STA_CD IN ('202','203','204')
							     AND ROWNUM = 1)
					;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , 'SYSTEM'
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID
				 FROM TBBADDED145M
				 WHERE DOC_ID = #DOC_ID#
				   AND APVR_CD = (SELECT MAX(B.APVR_PST_CD)
								    FROM TBBADDED103M A
									   , TBDCMACM023L B
								   WHERE B.APV_DOC_NO = #APV_DOC_NO#
								     AND A.APV_RQS_ID = B.APV_DOC_NO
								     AND B.APV_SNO = (
												  SELECT MAX(D.APV_SNO)
													FROM TBBADDED103M C
													   , TBDCMACM023L D
												   WHERE D.APV_DOC_NO = B.APV_DOC_NO
													 AND C.APV_RQS_ID = D.APV_DOC_NO
													 AND D.APV_SNO <> 1
												     AND C.RPRT_CD = #RPRT_CD#
												     AND C.DOC_ID = #DOC_ID#
												     AND D.APVR_STA_CD IN ('202','203','204')
	                                                 AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
													  )
								     AND A.RPRT_CD = #RPRT_CD#
								     AND B.APVR_STA_CD IN ('202','203','204')
								     AND ROWNUM = 1)
				;
		END;			
		]]>
	</update>
	<update id="AEPAFU001UpdateDSpFnlYnSetByAudRprt" parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN
			UPDATE TBBADDED146M
			   SET FNL_YN = 'Y'
			 WHERE DOC_ID = #DOC_ID#
			   AND APVR_CD = (SELECT MAX(B.APVR_PST_CD)
							    FROM TBBADDED103M A
								   , TBDCMACM023L B
							   WHERE B.APV_DOC_NO = #APV_DOC_NO#
							     AND A.APV_RQS_ID = B.APV_DOC_NO
							     AND B.APV_SNO = (
											  SELECT MAX(D.APV_SNO)
												FROM TBBADDED103M C
												   , TBDCMACM023L D
											   WHERE D.APV_DOC_NO = B.APV_DOC_NO
												 AND C.APV_RQS_ID = D.APV_DOC_NO
												 AND D.APV_SNO <> 1
											     AND C.RPRT_CD = #RPRT_CD#
											     AND C.DOC_ID = #DOC_ID#
											     AND D.APVR_STA_CD IN ('202','203','204')
                                                 AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
												  )
							     AND A.RPRT_CD = #RPRT_CD#
							     AND B.APVR_STA_CD IN ('202','203','204')
							     AND ROWNUM = 1)
							;
				INSERT INTO TBBADDED146H
						(
						    HST_DVSN_CD
						  , HST_SNO
						  , HST_DH
						  , HST_USR_ID	
						  , AUD_YR
						  , AUD_NO
						  , AUD_STEP_CD 	
						  , DOC_ID 			
						  , APVR_CD 		
						  , AFF_SNO 		
						  , DSP_RQ_SNO 		
						  , DP_DSP_RQ_SNO 	
						  , AUD_KND_CD 		
						  , AUD_GRN_NO 		
						  , RPRT_FILD_ID 	
						  , AFF_DSP_CD 		
						  , RLTN_ORG_CD 	
						  , HND_ORG_CD 		
						  , REF_ORG_CD 		
						  , DSP_RQ_CD 		
						  , MTRL_IPT_DVSN_CD
						  , NOP_AM_DVSN_CD 	
						  , NOP_AM 			
						  , SORT_SNO		
						  , ACCN_INSP_CD	
						  , FNL_YN 			
						  , FRT_USR_ID 		
						  , FNL_USR_ID 		
						  , FNL_DEAL_DPT_CD 
						  , FNL_MNU_ID 		
						  , FRT_REGI_DH		
						  , FNL_MDF_DH 		
						  , NOP_SUM 		
						  , HD_AUD_STEP_CD 	
						  , HD_DOC_ID		
						  , HD_APVR_CD		
						  , HD_AFF_SNO 		
						  , HD_DSP_RQ_SNO	
						  , REF_DOC_ID 		
						  , DF_AUD_STEP_CD 	
						  , DF_DOC_ID 		
						  , DF_APVR_CD 		
						  , DF_AFF_SNO		
						  , DF_DSP_RQ_SNO 	
						  , KYWD1			
						  , KYWD2 			
						  , KYWD3 			
						  , KYWD4			
						  , KYWD5			
						)
					SELECT 'U'
					 	 , TBBADDED146H_SEQ.NEXTVAL
					 	 , SYSDATE
					 	 , 'SYSTEM'
						 , AUD_YR
						 , AUD_NO
						 , AUD_STEP_CD 	
						 , DOC_ID 			
						 , APVR_CD 		
						 , AFF_SNO 		
						 , DSP_RQ_SNO 		
						 , DP_DSP_RQ_SNO 	
						 , AUD_KND_CD 		
						 , AUD_GRN_NO 		
						 , RPRT_FILD_ID 	
						 , AFF_DSP_CD 		
						 , RLTN_ORG_CD 	
						 , HND_ORG_CD 		
						 , REF_ORG_CD 		
						 , DSP_RQ_CD 		
						 , MTRL_IPT_DVSN_CD
						 , NOP_AM_DVSN_CD 	
						 , NOP_AM 			
						 , SORT_SNO		
						 , ACCN_INSP_CD	
						 , FNL_YN 			
						 , FRT_USR_ID 		
						 , FNL_USR_ID 		
						 , FNL_DEAL_DPT_CD 
						 , FNL_MNU_ID 		
						 , FRT_REGI_DH		
						 , FNL_MDF_DH 		
						 , NOP_SUM 		
						 , HD_AUD_STEP_CD 	
						 , HD_DOC_ID		
						 , HD_APVR_CD		
						 , HD_AFF_SNO 		
						 , HD_DSP_RQ_SNO	
						 , REF_DOC_ID 		
						 , DF_AUD_STEP_CD 	
						 , DF_DOC_ID 		
						 , DF_APVR_CD 		
						 , DF_AFF_SNO		
						 , DF_DSP_RQ_SNO 	
						 , KYWD1			
						 , KYWD2 			
						 , KYWD3 			
						 , KYWD4			
						 , KYWD5
					 FROM TBBADDED146M
					 WHERE DOC_ID = #DOC_ID#
					   AND APVR_CD = (SELECT MAX(B.APVR_PST_CD)
									    FROM TBBADDED103M A
										   , TBDCMACM023L B
									   WHERE B.APV_DOC_NO = #APV_DOC_NO#
									     AND A.APV_RQS_ID = B.APV_DOC_NO
									     AND B.APV_SNO = (
													  SELECT MAX(D.APV_SNO)
														FROM TBBADDED103M C
														   , TBDCMACM023L D
													   WHERE D.APV_DOC_NO = B.APV_DOC_NO
														 AND C.APV_RQS_ID = D.APV_DOC_NO
														 AND D.APV_SNO <> 1
													     AND C.RPRT_CD = #RPRT_CD#
													     AND C.DOC_ID = #DOC_ID#
													     AND D.APVR_STA_CD IN ('202','203','204')
		                                                 AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
														  )
									     AND A.RPRT_CD = #RPRT_CD#
									     AND B.APVR_STA_CD IN ('202','203','204')
									     AND ROWNUM = 1)
						;
				END;							
		]]>
	</update>
	
	<update id="AEPAFU001UpdateAffFnlYnSetByParam" parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN
			UPDATE TBBADDED145M
			   SET FNL_YN = 'Y'
			 WHERE DOC_ID = #DOC_ID#
			   AND APVR_CD = #APVR_CD#
			;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , 'SYSTEM'
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID
				 FROM TBBADDED145M
				 WHERE DOC_ID = #DOC_ID#
				   AND APVR_CD = #APVR_CD#
				;
		END;			   
		]]>
	</update>
	<update id="AEPAFU001UpdateDSpFnlYnSetByParam" parameterClass="java.util.Map">
		<![CDATA[
		DECLARE
			BEGIN
			UPDATE TBBADDED146M
			   SET FNL_YN = 'Y'
			 WHERE DOC_ID = #DOC_ID#
			   AND APVR_CD = #APVR_CD#
			   ;
		INSERT INTO TBBADDED146H
				(
				    HST_DVSN_CD
				  , HST_SNO
				  , HST_DH
				  , HST_USR_ID	
				  , AUD_YR
				  , AUD_NO
				  , AUD_STEP_CD 	
				  , DOC_ID 			
				  , APVR_CD 		
				  , AFF_SNO 		
				  , DSP_RQ_SNO 		
				  , DP_DSP_RQ_SNO 	
				  , AUD_KND_CD 		
				  , AUD_GRN_NO 		
				  , RPRT_FILD_ID 	
				  , AFF_DSP_CD 		
				  , RLTN_ORG_CD 	
				  , HND_ORG_CD 		
				  , REF_ORG_CD 		
				  , DSP_RQ_CD 		
				  , MTRL_IPT_DVSN_CD
				  , NOP_AM_DVSN_CD 	
				  , NOP_AM 			
				  , SORT_SNO		
				  , ACCN_INSP_CD	
				  , FNL_YN 			
				  , FRT_USR_ID 		
				  , FNL_USR_ID 		
				  , FNL_DEAL_DPT_CD 
				  , FNL_MNU_ID 		
				  , FRT_REGI_DH		
				  , FNL_MDF_DH 		
				  , NOP_SUM 		
				  , HD_AUD_STEP_CD 	
				  , HD_DOC_ID		
				  , HD_APVR_CD		
				  , HD_AFF_SNO 		
				  , HD_DSP_RQ_SNO	
				  , REF_DOC_ID 		
				  , DF_AUD_STEP_CD 	
				  , DF_DOC_ID 		
				  , DF_APVR_CD 		
				  , DF_AFF_SNO		
				  , DF_DSP_RQ_SNO 	
				  , KYWD1			
				  , KYWD2 			
				  , KYWD3 			
				  , KYWD4			
				  , KYWD5			
				)
			SELECT 'U'
			 	 , TBBADDED146H_SEQ.NEXTVAL
			 	 , SYSDATE
			 	 , 'SYSTEM'
				 , AUD_YR
				 , AUD_NO
				 , AUD_STEP_CD 	
				 , DOC_ID 			
				 , APVR_CD 		
				 , AFF_SNO 		
				 , DSP_RQ_SNO 		
				 , DP_DSP_RQ_SNO 	
				 , AUD_KND_CD 		
				 , AUD_GRN_NO 		
				 , RPRT_FILD_ID 	
				 , AFF_DSP_CD 		
				 , RLTN_ORG_CD 	
				 , HND_ORG_CD 		
				 , REF_ORG_CD 		
				 , DSP_RQ_CD 		
				 , MTRL_IPT_DVSN_CD
				 , NOP_AM_DVSN_CD 	
				 , NOP_AM 			
				 , SORT_SNO		
				 , ACCN_INSP_CD	
				 , FNL_YN 			
				 , FRT_USR_ID 		
				 , FNL_USR_ID 		
				 , FNL_DEAL_DPT_CD 
				 , FNL_MNU_ID 		
				 , FRT_REGI_DH		
				 , FNL_MDF_DH 		
				 , NOP_SUM 		
				 , HD_AUD_STEP_CD 	
				 , HD_DOC_ID		
				 , HD_APVR_CD		
				 , HD_AFF_SNO 		
				 , HD_DSP_RQ_SNO	
				 , REF_DOC_ID 		
				 , DF_AUD_STEP_CD 	
				 , DF_DOC_ID 		
				 , DF_APVR_CD 		
				 , DF_AFF_SNO		
				 , DF_DSP_RQ_SNO 	
				 , KYWD1			
				 , KYWD2 			
				 , KYWD3 			
				 , KYWD4			
				 , KYWD5
			 FROM TBBADDED146M
			 WHERE DOC_ID = #DOC_ID#
			   AND APVR_CD = #APVR_CD#
				;
		END;				   
		]]>
	</update>
	
	<update id="AEPAFU001UpdateCmptYnByAudRprt" parameterClass="java.util.Map">
		UPDATE TBBADDED102M 
		   SET CMPT_YN = 'Y'
		 WHERE AUD_YR = (
						 SELECT MAX(AUD_YR)
			               FROM TBBADDED103M
			              WHERE APV_RQS_ID = #APV_DOC_NO#
			            )
		   AND AUD_NO = (
						 SELECT MAX(AUD_NO)
			               FROM TBBADDED103M
			              WHERE APV_RQS_ID = #APV_DOC_NO#
			            )
		   AND AUD_STEP_CD = 'A1060'
		   AND AUD_MAIN_STEP_ID = '600301'
		   AND AUD_MAIN_STEP_SNO = 1
	</update>
	
	<update id="AEPAFU001UpdateCmptYnByAudRprtInsertTBBADDED146m" parameterClass="java.util.Map">
		UPDATE TBBADDED102M 
		   SET CMPT_YN = 'Y'
		 WHERE AUD_YR = (
						 SELECT MAX(AUD_YR)
			               FROM TBBADDED103M
			              WHERE APV_RQS_ID = #APV_DOC_NO#
			            )
		   AND AUD_NO = (
						 SELECT MAX(AUD_NO)
			               FROM TBBADDED103M
			              WHERE APV_RQS_ID = #APV_DOC_NO#
			            )
		   AND AUD_STEP_CD IN ('A1060','A1070')
		   AND AUD_MAIN_STEP_ID IN ('601101','700701','720801')
	</update>	
	
	<update id="AEPAFU001UpdateCmptYnByFnlAudRprt" parameterClass="java.util.Map">
		UPDATE TBBADDED102M 
		   SET CMPT_YN = 'Y'
		 WHERE AUD_YR = #AUD_YR#
		   AND AUD_NO = #AUD_NO#
		   AND AUD_STEP_CD = 'A1070'
		   AND AUD_MAIN_STEP_ID = '720601'
		   AND AUD_MAIN_STEP_SNO = #audMainStepSno#
	</update>
	
	<update id="AEPAFU001UpdateAffRqsRefDocId" parameterClass="java.util.Map">
		DECLARE
            BEGIN
                MERGE INTO TBBADDED146M T1
                USING (SELECT DISTINCT AUD_YR, AUD_NO, DOC_ID
                         FROM TBBADDED113M
                        WHERE AUD_YR = #AUD_YR#
                          AND AUD_NO = #AUD_NO#
                          AND DOC_ID = #audRprtDocId#
                          AND SBCN_REGI_REQ_DT = #refDy#) T2
                   ON (     
                        T1.AUD_YR = T2.AUD_YR
                       AND T1.AUD_NO = T2.AUD_NO
                       AND T1.DOC_ID = T2.DOC_ID
                       AND T1.APVR_CD = 'A1070'
                      ) 
                 WHEN MATCHED THEN 
                    UPDATE 
                       SET REF_DOC_ID   = #copyAudRptId#;
                       
                 MERGE INTO TBBADDED145M T1
                    USING (SELECT DISTINCT AUD_YR, AUD_NO, DOC_ID
                             FROM TBBADDED113M
                            WHERE AUD_YR = #AUD_YR#
                          	  AND AUD_NO = #AUD_NO#
                              AND SBCN_REGI_REQ_DT = #refDy#) T2
                       ON (     
                            T1.AUD_YR = T2.AUD_YR
                           AND T1.AUD_NO = T2.AUD_NO
                           AND T1.DOC_ID = T2.DOC_ID
                           AND T1.APVR_CD = 'A1070'
                          ) 
                             WHEN MATCHED THEN 
                                UPDATE 
                                   SET REF_DOC_ID   = #copyAudRptId#;
             END;
	</update>
	
	
	<select id="AEPAFU001getDocIdByApvDocNo" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
	         SELECT DOC_ID
	           FROM TBBADDED103M
	          WHERE APV_RQS_ID = #apvDocNo#
		]]>
	</select>
	
	<select id="AEPAFU001getApvrInfo" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
	          SELECT 	
	                F_USR_INFO(APVR_CNB, '2') AS USR_NAM
        	       ,APVR_PST_CD
        	       ,F_CODE_NM('1000176',APVR_PST_CD) AS APVR_PST_NM
        	       ,APVR_STA_CD
        	       ,F_CODE_NM('1000348',APVR_STA_CD) AS APVR_STA_NM
        	    FROM (
		           SELECT *
        		     FROM TBDCMACM023L
        		    WHERE APV_DOC_NO = #apvDocNo#
        		      AND SUBSTR(APVR_STA_CD,0,1) >= '2'
        		      AND SUBSTR(APVR_STA_CD,0,1) <> '3'
        		    ORDER BY APV_DH DESC, APVR_KND_CD DESC
        		 ) 
        	   WHERE ROWNUM = 1
      		 UNION
      		  SELECT
      		        F_USR_INFO(APVR_CNB, '2') AS USR_NAM 
      		       ,APVR_PST_CD
      		       ,F_CODE_NM ('1000176',APVR_PST_CD) AS APVR_PST_NM
      		       ,APVR_STA_CD
      		       ,F_CODE_NM ('1000348',APVR_STA_CD) AS APVR_STA_NM
      		    FROM ( 
		           SELECT *
      		             FROM TBDCMACM023L
      		            WHERE APV_DOC_NO = #apvDocNo#
      		              AND APVR_STA_CD = '301'
      		              AND APV_SNO = '1'		 
      		            ORDER BY APV_DH DESC, APVR_KND_CD DESC )
      		   WHERE ROWNUM = 1
		]]>
	</select>
	
	<update id="AEPAFU001UpdateFnlCmptYnByAudRprt" parameterClass="java.util.Map">
		UPDATE TBBADDED102M 
		   SET CMPT_YN = 'Y'
		 WHERE AUD_YR = (
						 SELECT MAX(AUD_YR)
			               FROM TBBADDED103M
			              WHERE APV_RQS_ID = #APV_DOC_NO#
			            )
		   AND AUD_NO = (
						 SELECT MAX(AUD_NO)
			               FROM TBBADDED103M
			              WHERE APV_RQS_ID = #APV_DOC_NO#
			            )
		   AND AUD_STEP_CD = 'A1060'
		   AND AUD_MAIN_STEP_ID = '600601'
		   AND AUD_MAIN_STEP_SNO = 1
	</update>
	
	<update id="AEPAFU001UpdateCmptVtSbcnFnlYn" parameterClass="java.util.Map">
	DECLARE
		BEGIN
		UPDATE TBBADDED145M MT1
		   SET MT1.FNL_YN = 'Y'
		      , MT1.FNL_USR_ID = #FNL_USR_ID#
		      , MT1.FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD# 
		      , MT1.FNL_MNU_ID = #FNL_MNU_ID# 
		      , MT1.FNL_MDF_DH = SYSDATE
		WHERE MT1.AUD_YR = #AUD_YR#
		  AND MT1.AUD_NO = #AUD_NO#
		  AND MT1.APVR_CD = 'A1070'
		  AND EXISTS (SELECT 1
		                FROM TBBADDED113M T1
		                     INNER JOIN TBBADDED145M T2
		                     ON (T1.AUD_YR = T2.AUD_YR
		                        AND T1.AUD_NO = T2.AUD_NO
		                        AND T1.APVR_CD = T2.APVR_CD
		                        AND T1.DOC_ID = T2.DOC_ID
		                        AND T1.AFF_SNO = T2.AFF_SNO
		                        AND T2.FNL_YN = 'Y'
		                        AND T2.APVR_CD = '0010600')
		                     INNER JOIN TBBADDED146M T3
		                     ON (T1.AUD_YR = T3.AUD_YR
		                        AND T1.AUD_NO = T3.AUD_NO
		                        AND T2.AUD_STEP_CD = T3.AUD_STEP_CD
		                        AND T1.APVR_CD = T3.APVR_CD
		                        AND T1.DOC_ID = T3.DOC_ID
		                        AND T1.AFF_SNO = T3.AFF_SNO
		                        AND T1.DSP_RQ_SNO = T3.DSP_RQ_SNO
		                        AND T2.FNL_YN = 'Y'
		                        AND T2.APVR_CD = '0010600')
		                     INNER JOIN TBBADDED147M T4
		                     ON (T4.AUD_YR = T1.AUD_YR
		                        AND T4.AUD_NO = T1.AUD_NO
		                        AND T4.APVR_CD = 'A1070'
		                        AND T4.PRE_AFF_NO = F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') || '-' || T2.AFF_CD || '-' || T3.AFF_DSP_CD)
		                WHERE T1.AUD_YR = MT1.AUD_YR
		                AND T1.AUD_NO =  MT1.AUD_NO
		                AND T1.DOC_ID = MT1.DOC_ID
		                AND T4.AFF_SNO = MT1.AFF_SNO
		                AND T1.SBCN_VT_CD IS NOT NULL)
		             ;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , #FNL_USR_ID#
					 , MT1.AUD_YR			
					 , MT1.AUD_NO			
					 , MT1.AUD_STEP_CD	
					 , MT1.DOC_ID			
					 , MT1.APVR_CD		
					 , MT1.AFF_SNO		
					 , MT1.AUD_KND_CD		
					 , MT1.AUD_GRN_NO		
					 , MT1.RPRT_FILD_ID	
					 , MT1.AFF_CD			
					 , MT1.LIST_NO		
					 , MT1.REFER_DVSN_CD	
					 , MT1.AFF_SPH		
					 , MT1.TITLE_NM		
					 , MT1.DP_TITLE_NM	
					 , MT1.QST_DOC_ISUE_YN
					 , MT1.QST_DOC_ISUE_DY
					 , MT1.AUDTOR			
					 , MT1.DETL_DOC_NO	
					 , MT1.MTRL_IPT_DVSN_CD
					 , MT1.SYT_TRTM_DVSN_YN
					 , MT1.SCRT_YN		
					 , MT1.SORT_SNO		
					 , MT1.TRTM_EXAMER_CNB
					 , MT1.FNL_YN			
					 , MT1.FRT_USR_ID		
					 , MT1.FNL_USR_ID		
					 , MT1.FNL_DEAL_DPT_CD
					 , MT1.FNL_MNU_ID		
					 , MT1.FRT_REGI_DH	
					 , MT1.FNL_MDF_DH		
					 , MT1.REF_DOC_ID
				 FROM TBBADDED145M MT1
				WHERE MT1.AUD_YR = #AUD_YR#
				  AND MT1.AUD_NO = #AUD_NO#
				  AND MT1.APVR_CD = 'A1070'
				  AND EXISTS (SELECT 1
				                FROM TBBADDED113M T1
				                     INNER JOIN TBBADDED145M T2
				                     ON (T1.AUD_YR = T2.AUD_YR
				                        AND T1.AUD_NO = T2.AUD_NO
				                        AND T1.APVR_CD = T2.APVR_CD
				                        AND T1.DOC_ID = T2.DOC_ID
				                        AND T1.AFF_SNO = T2.AFF_SNO
				                        AND T2.FNL_YN = 'Y'
				                        AND T2.APVR_CD = '0010600')
				                     INNER JOIN TBBADDED146M T3
				                     ON (T1.AUD_YR = T3.AUD_YR
				                        AND T1.AUD_NO = T3.AUD_NO
				                        AND T2.AUD_STEP_CD = T3.AUD_STEP_CD
				                        AND T1.APVR_CD = T3.APVR_CD
				                        AND T1.DOC_ID = T3.DOC_ID
				                        AND T1.AFF_SNO = T3.AFF_SNO
				                        AND T1.DSP_RQ_SNO = T3.DSP_RQ_SNO
				                        AND T2.FNL_YN = 'Y'
				                        AND T2.APVR_CD = '0010600')
				                     INNER JOIN TBBADDED147M T4
				                     ON (T4.AUD_YR = T1.AUD_YR
				                        AND T4.AUD_NO = T1.AUD_NO
				                        AND T4.APVR_CD = 'A1070'
				                        AND T4.PRE_AFF_NO = F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') || '-' || T2.AFF_CD || '-' || T3.AFF_DSP_CD)
				                WHERE T1.AUD_YR = MT1.AUD_YR
				                AND T1.AUD_NO =  MT1.AUD_NO
				                AND T1.DOC_ID = MT1.DOC_ID
				                AND T4.AFF_SNO = MT1.AFF_SNO
				                AND T1.SBCN_VT_CD IS NOT NULL)
				;
		END;		         
	</update>
	
	<update id="AEPAFU001UpdateCmptVtChfFnlYn" parameterClass="java.util.Map">
	DECLARE
		BEGIN
		UPDATE TBBADDED145M T1
		   SET T1.FNL_YN = 'N'
		      , T1.FNL_USR_ID = #FNL_USR_ID#
		      , T1.FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD# 
		      , T1.FNL_MNU_ID = #FNL_MNU_ID# 
		      , T1.FNL_MDF_DH = SYSDATE
		WHERE T1.AUD_YR = #AUD_YR#
		  AND T1.AUD_NO = #AUD_NO#
		  AND T1.APVR_CD = '0010600'
		  AND EXISTS (SELECT 1
		                FROM TBBADDED113M ST1
		               WHERE ST1.AUD_YR = T1.AUD_YR
		                 AND ST1.AUD_NO = T1.AUD_NO
		                 AND ST1.DOC_ID = T1.DOC_ID
		                 AND ST1.APVR_CD = T1.APVR_CD
		                 AND ST1.AFF_SNO = T1.AFF_SNO
		                 AND ST1.SBCN_VT_CD IS NOT NULL)
		     ;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , #FNL_USR_ID#
					 , T1.AUD_YR			
					 , T1.AUD_NO			
					 , T1.AUD_STEP_CD	
					 , T1.DOC_ID			
					 , T1.APVR_CD		
					 , T1.AFF_SNO		
					 , T1.AUD_KND_CD		
					 , T1.AUD_GRN_NO		
					 , T1.RPRT_FILD_ID	
					 , T1.AFF_CD			
					 , T1.LIST_NO		
					 , T1.REFER_DVSN_CD	
					 , T1.AFF_SPH		
					 , T1.TITLE_NM		
					 , T1.DP_TITLE_NM	
					 , T1.QST_DOC_ISUE_YN
					 , T1.QST_DOC_ISUE_DY
					 , T1.AUDTOR			
					 , T1.DETL_DOC_NO	
					 , T1.MTRL_IPT_DVSN_CD
					 , T1.SYT_TRTM_DVSN_YN
					 , T1.SCRT_YN		
					 , T1.SORT_SNO		
					 , T1.TRTM_EXAMER_CNB
					 , T1.FNL_YN			
					 , T1.FRT_USR_ID		
					 , T1.FNL_USR_ID		
					 , T1.FNL_DEAL_DPT_CD
					 , T1.FNL_MNU_ID		
					 , T1.FRT_REGI_DH	
					 , T1.FNL_MDF_DH		
					 , T1.REF_DOC_ID
				 FROM TBBADDED145M T1
				WHERE T1.AUD_YR = #AUD_YR#
				  AND T1.AUD_NO = #AUD_NO#
				  AND T1.APVR_CD = '0010600'
				  AND EXISTS (SELECT 1
				                FROM TBBADDED113M ST1
				               WHERE ST1.AUD_YR = T1.AUD_YR
				                 AND ST1.AUD_NO = T1.AUD_NO
				                 AND ST1.DOC_ID = T1.DOC_ID
				                 AND ST1.APVR_CD = T1.APVR_CD
				                 AND ST1.AFF_SNO = T1.AFF_SNO
				                 AND ST1.SBCN_VT_CD IS NOT NULL)
				;
		END;		     
	</update>
	
	<update id="AEPAFU001UpdateDlgSbcnFnlYn" parameterClass="java.util.Map">
	DECLARE
		BEGIN
		UPDATE TBBADDED145M
		SET FNL_YN = 'Y'
		      , FNL_USR_ID = #FNL_USR_ID#
		      , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD# 
		      , FNL_MNU_ID = #FNL_MNU_ID# 
		      , FNL_MDF_DH = SYSDATE
		WHERE AUD_YR = #AUD_YR#
		AND AUD_NO =  #AUD_NO#
		AND APVR_CD = 'A1070'
		AND REFER_DVSN_CD = 'E10'
		AND DOC_ID IN (SELECT DISTINCT DOC_ID FROM TBBADDED145M
		                WHERE AUD_YR = #AUD_YR#
		                AND AUD_NO =  #AUD_NO#
		                AND APVR_CD = '0010600'
		                AND REFER_DVSN_CD = 'D10')
		    ;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , 'SYSTEM'
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID
				 FROM TBBADDED145M
				WHERE AUD_YR = #AUD_YR#
				  AND AUD_NO =  #AUD_NO#
				  AND APVR_CD = 'A1070'
				  AND REFER_DVSN_CD = 'E10'
				  AND DOC_ID IN (SELECT DISTINCT DOC_ID FROM TBBADDED145M
					                WHERE AUD_YR = #AUD_YR#
					                AND AUD_NO =  #AUD_NO#
					                AND APVR_CD = '0010600'
					                AND REFER_DVSN_CD = 'D10')
				;
		END;	
	</update>
	
	<update id="AEPAFU001UpdateDlgChfFnlYn" parameterClass="java.util.Map">
	DECLARE
		BEGIN
		UPDATE TBBADDED145M 
		SET FNL_YN = 'N'
		  , FNL_USR_ID = #FNL_USR_ID#
		  , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD# 
		  , FNL_MNU_ID = #FNL_MNU_ID# 
		  , FNL_MDF_DH = SYSDATE
		WHERE AUD_YR = #AUD_YR#
		AND AUD_NO =  #AUD_NO#
		AND APVR_CD = '0010600'
		AND REFER_DVSN_CD = 'E10'
		AND FNL_YN = 'Y'
		AND DOC_ID IN (SELECT DISTINCT DOC_ID FROM TBBADDED145M
		                WHERE AUD_YR = #AUD_YR#
		                AND AUD_NO =  #AUD_NO#
		                AND APVR_CD = '0010600'
		                AND REFER_DVSN_CD = 'D10')
		   	;
           INSERT INTO TBBADDED145H
					(
					   HST_DVSN_CD
					 , HST_SNO
					 , HST_DH
					 , HST_USR_ID	
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID		
					)
				SELECT 'U'
				 	 , TBBADDED145H_SEQ.NEXTVAL
				 	 , SYSDATE
				 	 , #FNL_USR_ID#
					 , AUD_YR			
					 , AUD_NO			
					 , AUD_STEP_CD	
					 , DOC_ID			
					 , APVR_CD		
					 , AFF_SNO		
					 , AUD_KND_CD		
					 , AUD_GRN_NO		
					 , RPRT_FILD_ID	
					 , AFF_CD			
					 , LIST_NO		
					 , REFER_DVSN_CD	
					 , AFF_SPH		
					 , TITLE_NM		
					 , DP_TITLE_NM	
					 , QST_DOC_ISUE_YN
					 , QST_DOC_ISUE_DY
					 , AUDTOR			
					 , DETL_DOC_NO	
					 , MTRL_IPT_DVSN_CD
					 , SYT_TRTM_DVSN_YN
					 , SCRT_YN		
					 , SORT_SNO		
					 , TRTM_EXAMER_CNB
					 , FNL_YN			
					 , FRT_USR_ID		
					 , FNL_USR_ID		
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID		
					 , FRT_REGI_DH	
					 , FNL_MDF_DH		
					 , REF_DOC_ID
				 FROM TBBADDED145M
				WHERE AUD_YR = #AUD_YR#
					AND AUD_NO =  #AUD_NO#
					AND APVR_CD = '0010600'
					AND REFER_DVSN_CD = 'E10'
					AND FNL_YN = 'Y'
					AND DOC_ID IN (SELECT DISTINCT DOC_ID FROM TBBADDED145M
					                WHERE AUD_YR = #AUD_YR#
					                AND AUD_NO =  #AUD_NO#
					                AND APVR_CD = '0010600'
					                AND REFER_DVSN_CD = 'D10')
				;
		END;		   	
	</update>
	
	<update id="AEPAFU001UpdateMatchFnlYn" parameterClass="java.util.Map">
		UPDATE
		     (
		         SELECT 
		            T1.FNL_YN AS AFF_FNL_YN
		            , T2.FNL_YN AS DSP_FNL_YN
		            , T2.FNL_USR_ID AS FNL_USR_ID
		            , T2.FNL_DEAL_DPT_CD AS FNL_DEAL_DPT_CD
		            , T2.FNL_MNU_ID AS FNL_MNU_ID
		            , T2.FNL_MDF_DH AS FNL_MDF_DH
		         FROM
		             TBBADDED145M T1
		             INNER JOIN TBBADDED146M T2
		             ON (T1.AUD_YR = T2.AUD_YR
		                 AND T1.AUD_NO = T2.AUD_NO
		                 AND T1.AUD_STEP_CD = T2.AUD_STEP_CD
		                 AND T1.DOC_ID = T2.DOC_ID
		                 AND T1.APVR_CD = T2.APVR_CD
		                 AND T1.AFF_SNO = T2.AFF_SNO)
		         WHERE
		          T1.AUD_YR = #AUD_YR#
		         AND T1.AUD_NO =  #AUD_NO#
		         AND T1.APVR_CD IN ('0010600', 'A1070')
		     )
		 SET
		     DSP_FNL_YN = AFF_FNL_YN
		    , FNL_USR_ID = #FNL_USR_ID#
		    , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD# 
		    , FNL_MNU_ID = #FNL_MNU_ID# 
		    , FNL_MDF_DH = SYSDATE
	</update>
	
	<select id="AEPAFU001GetApvDocBySbcnRprt" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT AUD_YR, AUD_NO, AUD_STEP_CD, DOC_ID, REF_ID, RPRT_CD, APV_STA_CD
			  FROM TBBADDED103M
			 WHERE AUD_YR = #AUD_YR#
			   AND AUD_NO = #AUD_NO#
			   AND AUD_STEP_CD = #AUD_STEP_CD#
			   AND REF_ID = #DOC_ID#
			   AND RPRT_CD = 'A10700600'
		]]>
	</select>
	
	<select id="AEPAFU001GetApvDocBySbmtRprt" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT AUD_YR, AUD_NO, AUD_STEP_CD, DOC_ID, RPRT_CD, APV_STA_CD
			  FROM TBBADDED103M
			 WHERE AUD_YR = #AUD_YR#
			   AND AUD_NO = #AUD_NO#
			   AND AUD_STEP_CD = #AUD_STEP_CD#
			   AND REF_DOC_ID = #DOC_ID#
			   AND RPRT_CD = 'A10700210'
		]]>
	</select>
	
	
	<select id="AEPAFU001getApprSbmInfo" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT USR.USR_ID AS USER_ID,
			       USR.USR_NAM AS USER_NM,
			       USR.DPT_CD AS DEPT_CD,
			       F_DPT_INFO(USR.DPT_CD, '1') AS DEPT_NM,
			       APPR.APV_STA_CD AS APV_STA_CD
			  FROM TBDCMACM022L APPR
			     , TBDCMACM001M USR
			 WHERE APPR.SBM_CNB = USR.CNB
			   AND APPR.APV_DOC_NO = #APV_DOC_NO#
		]]>
	</select>
	
	<insert id="AEPAFU001InsertCopySbmtRptRprt" parameterClass="java.util.Map">
		INSERT INTO TBBADDED103M (
			       AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,DOC_ID 
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM
			      ,LINK_URL
			      ,NECES_YN
			      ,APV_STA_CD
			      ,RPRT_CD
			      ,APV_RQS_ID
			      ,SND_DOC_YN
			      ,DOC_KND_CD   
			      ,AUD_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,SORT_SNO
			      ,SYT_TRTM_DVSN_YN
			      ,AUD_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,FRT_REGI_DH
			      ,FNL_MDF_DH
			      ,EDT_AUTH
			      ,REF_DOC_ID
			      ,TEMPLATE_DOC_ID
			)
			SELECT AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,#copySbmtRptId#
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM||'(보고자용)'
			      ,LINK_URL
			      ,NECES_YN
			      ,'10'
			      ,'A10700220'
			      ,''
			      ,'N'
			      ,DOC_KND_CD   
			      ,AUD_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,(SELECT MAX(SORT_SNO)+1 FROM TBBADDED103M B  WHERE AUD_YR = #AUD_YR# AND AUD_NO = #AUD_NO# AND AUD_STEP_CD = #AUD_STEP_CD#) AS SORT_SNO
			      ,SYT_TRTM_DVSN_YN
			      ,AUD_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,SYSDATE
			      ,SYSDATE
			      ,''
			      ,REF_DOC_ID
			      ,TEMPLATE_DOC_ID
			FROM TBBADDED103M A
			WHERE AUD_YR = #AUD_YR#
			 AND AUD_NO = #AUD_NO#
			 AND AUD_STEP_CD = #AUD_STEP_CD#
			 AND RPRT_CD = #RPRT_CD#
			 AND DOC_ID = #DOC_ID#
	 </insert>
	
	<insert id="AEPAFU001InsertCopySbmtLedgRprt" parameterClass="java.util.Map">
		INSERT INTO TBBADDED103M (
			       AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,DOC_ID 
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM
			      ,LINK_URL
			      ,NECES_YN
			      ,APV_STA_CD
			      ,RPRT_CD
			      ,APV_RQS_ID
			      ,SND_DOC_YN
			      ,DOC_KND_CD   
			      ,AUD_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,SORT_SNO
			      ,SYT_TRTM_DVSN_YN
			      ,AUD_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,FRT_REGI_DH
			      ,FNL_MDF_DH
			      ,EDT_AUTH
			      ,REF_DOC_ID
			      ,TEMPLATE_DOC_ID
			)
			SELECT AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,#copySbmtLedgId#
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM||'(회의용)'
			      ,LINK_URL
			      ,NECES_YN
			      ,'10'
			      ,'A10700230'
			      ,''
			      ,'N'
			      ,DOC_KND_CD   
			      ,AUD_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,(SELECT MAX(SORT_SNO)+1 FROM TBBADDED103M B  WHERE AUD_YR = #AUD_YR# AND AUD_NO = #AUD_NO# AND AUD_STEP_CD = #AUD_STEP_CD#) AS SORT_SNO
			      ,SYT_TRTM_DVSN_YN
			      ,AUD_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,SYSDATE
			      ,SYSDATE
			      ,''
			      ,REF_DOC_ID
			      ,TEMPLATE_DOC_ID
			FROM TBBADDED103M A
			WHERE AUD_YR = #AUD_YR#
			 AND AUD_NO = #AUD_NO#
			 AND AUD_STEP_CD = #AUD_STEP_CD#
			 AND RPRT_CD = #RPRT_CD#
			 AND DOC_ID = #DOC_ID#
	 </insert>
	<insert id="AEPCFR001InsertCopySbcnRptRprt" parameterClass="java.util.Map">
		INSERT INTO TBBADDED103M (
			       AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,DOC_ID 
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM
			      ,LINK_URL
			      ,NECES_YN
			      ,APV_STA_CD
			      ,RPRT_CD
			      ,APV_RQS_ID
			      ,SND_DOC_YN
			      ,DOC_KND_CD   
			      ,AUD_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,SORT_SNO
			      ,SYT_TRTM_DVSN_YN
			      ,AUD_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,FRT_REGI_DH
			      ,FNL_MDF_DH
			      ,EDT_AUTH
			      ,REF_DOC_ID
			      ,TEMPLATE_DOC_ID
			)
			SELECT AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,#copySbcnRptId#
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM||'(보고자용)'
			      ,LINK_URL
			      ,NECES_YN
			      ,'10'
			      ,'A10700700'
			      ,''
			      ,'N'
			      ,DOC_KND_CD   
			      ,AUD_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,(SELECT MAX(SORT_SNO)+1 FROM TBBADDED103M B  WHERE AUD_YR = #AUD_YR# AND AUD_NO = #AUD_NO# AND AUD_STEP_CD = #AUD_STEP_CD#) AS SORT_SNO
			      ,SYT_TRTM_DVSN_YN
			      ,AUD_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,SYSDATE
			      ,SYSDATE
			      ,''
			      ,REF_DOC_ID
			      ,TEMPLATE_DOC_ID
			FROM TBBADDED103M A
			WHERE AUD_YR = #AUD_YR#
			 AND AUD_NO = #AUD_NO#
			 AND AUD_STEP_CD = #AUD_STEP_CD#
			 AND RPRT_CD = #RPRT_CD#
			 AND DOC_ID = #DOC_ID#
	 </insert>
	 
	 <insert id="AEPCFR001InsertCopySbcnLedgRprt" parameterClass="java.util.Map">
		 INSERT INTO TBBADDED103M (
			       AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,DOC_ID 
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM
			      ,LINK_URL
			      ,NECES_YN
			      ,APV_STA_CD
			      ,RPRT_CD
			      ,APV_RQS_ID
			      ,SND_DOC_YN
			      ,DOC_KND_CD   
			      ,AUD_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,SORT_SNO
			      ,SYT_TRTM_DVSN_YN
			      ,AUD_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,FRT_REGI_DH
			      ,FNL_MDF_DH
			      ,EDT_AUTH
			      ,REF_DOC_ID
			      ,TEMPLATE_DOC_ID
			)
			 SELECT AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,#copySbcnLedgId#
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM||'(회의용)'
			      ,LINK_URL
			      ,NECES_YN
			      ,'10'
			      ,'A10700800'
			      ,''
			      ,'N'
			      ,DOC_KND_CD   
			      ,AUD_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,(SELECT MAX(SORT_SNO)+1 FROM TBBADDED103M B  WHERE AUD_YR = #AUD_YR# AND AUD_NO = #AUD_NO# AND AUD_STEP_CD = #AUD_STEP_CD#) AS SORT_SNO
			      ,SYT_TRTM_DVSN_YN
			      ,AUD_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,SYSDATE
			      ,SYSDATE
			      ,''
			      ,REF_DOC_ID
			      ,TEMPLATE_DOC_ID
			FROM TBBADDED103M A
			WHERE AUD_YR = #AUD_YR#
			 AND AUD_NO = #AUD_NO#
			 AND AUD_STEP_CD = #AUD_STEP_CD#
			 AND RPRT_CD = #RPRT_CD#
			 AND DOC_ID = #DOC_ID#
	</insert>
	
	<insert id="AEPAFU001InsertCopyAudRprt" parameterClass="java.util.Map">
		 INSERT INTO TBBADDED103M (
			       AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,DOC_ID 
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM
			      ,LINK_URL
			      ,NECES_YN
			      ,APV_STA_CD
			      ,RPRT_CD
			      ,APV_RQS_ID
			      ,SND_DOC_YN
			      ,DOC_KND_CD   
			      ,AUD_RPRT_DVSN_CD
			      ,REF_ID
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,SORT_SNO
			      ,SYT_TRTM_DVSN_YN
			      ,AUD_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,FRT_REGI_DH
			      ,FNL_MDF_DH
			      ,EDT_AUTH
			      ,FNL_BAI_RPRT_YN
			      ,TEMPLATE_DOC_ID
			)
			 SELECT AUD_YR
			      ,AUD_NO
			      ,'A1070'
			      ,#copyAudRptId#
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM||'(최종)'
			      ,REPLACE(REPLACE(LINK_URL,'audStepCd=A1060','audStepCd=A1070'),'docId='||DOC_ID,'docId='||#copyAudRptId#)
			      ,NECES_YN
			      ,'30'
			      ,RPRT_CD
			      ,''
			      ,'N'
			      ,DOC_KND_CD   
			      ,TO_CHAR(TO_NUMBER(AUD_RPRT_DVSN_CD) + 1)
			      ,#REF_ID#
			      ,REF_DY
			      ,RLTN_ORG_CD
			      ,(SELECT MAX(SORT_SNO)+1 FROM TBBADDED103M B  WHERE AUD_YR = #AUD_YR# AND AUD_NO = #AUD_NO# AND AUD_STEP_CD = #AUD_STEP_CD#) AS SORT_SNO
			      ,SYT_TRTM_DVSN_YN
			      ,AUD_DOC_KND_CD
			      ,CON_PGM_CD
			      ,APV_WAY_CD
			      ,DOC_WRT_ID
			      ,ONR_HNDL_NO
			      ,FRT_USR_ID
			      ,FNL_USR_ID
			      ,FNL_DEAL_DPT_CD
			      ,FNL_MNU_ID
			      ,SYSDATE
			      ,SYSDATE
			      ,''
			      ,'Y'
			      ,TEMPLATE_DOC_ID
			FROM TBBADDED103M A
			WHERE AUD_YR = #AUD_YR#
			 AND AUD_NO = #AUD_NO#
			 AND AUD_STEP_CD = 'A1060'
			 AND RPRT_CD = 'A10600200'
			 AND DOC_ID = #DOC_ID#
	</insert>
	
	<insert id="AEPAFU001InsertFnlAudRprt" parameterClass="java.util.Map">
	<![CDATA[
		 INSERT INTO TBBADDED103M (
                   AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,DOC_ID 
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,LINK_URL
                  ,NECES_YN
                  ,APV_STA_CD
                  ,RPRT_CD
                  ,APV_RQS_ID
                  ,SND_DOC_YN
                  ,DOC_KND_CD   
                  ,AUD_RPRT_DVSN_CD
                  ,REF_ID
                  ,REF_DY
                  ,RLTN_ORG_CD
                  ,SORT_SNO
                  ,SYT_TRTM_DVSN_YN
                  ,AUD_DOC_KND_CD
                  ,CON_PGM_CD
                  ,APV_WAY_CD
                  ,DOC_WRT_ID
                  ,ONR_HNDL_NO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH
                  ,EDT_AUTH
                  ,FNL_BAI_RPRT_YN
                  ,REF_DOC_ID
                  ,TEMPLATE_DOC_ID
            )
             SELECT AUD_YR
                  ,AUD_NO
                  ,'A1070'
                  ,#copyAudRptId#
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM||'(최종)'
                  ,REPLACE(REPLACE(REPLACE(LINK_URL,'docId='||DOC_ID,'docId='||#copyAudRptId#),'&rprtCd=A10600200',''),'audStepCd=A1060','audStepCd=A1070&rprtCd=A10600200')
                  ,NECES_YN
                  ,'10'
                  ,RPRT_CD
                  ,''
                  ,'N'
                  ,DOC_KND_CD   
                  ,TO_CHAR(TO_NUMBER(AUD_RPRT_DVSN_CD) + 1)
                  ,#audRprtDocId#
                  ,#refDy#
                  ,RLTN_ORG_CD
                  ,(SELECT MAX(SORT_SNO)+1 FROM TBBADDED103M B  WHERE AUD_YR = #AUD_YR# AND AUD_NO = #AUD_NO# AND AUD_STEP_CD = 'A1070') AS SORT_SNO
                  ,SYT_TRTM_DVSN_YN
                  ,AUD_DOC_KND_CD
                  ,CON_PGM_CD
                  ,APV_WAY_CD
                  ,DOC_WRT_ID
                  ,ONR_HNDL_NO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH
                  ,''
                  ,'Y'
                  ,#audRprtDocId#
                  ,TEMPLATE_DOC_ID
            FROM TBBADDED103M A
            WHERE AUD_YR = #AUD_YR#
             AND AUD_NO = #AUD_NO#
             AND AUD_STEP_CD = 'A1060'
             AND RPRT_CD = 'A10600200'
             AND DOC_ID = #audRprtDocId#
             ]]>
	</insert>
	
	<select id="AEPAFU001GetFnlRprtYn" parameterClass="java.util.Map" resultClass="java.lang.String">
		<![CDATA[
		SELECT DECODE(COUNT(1),0,'N','Y') AS FNL_AUD_RPRT_EXIST_YN
		  FROM TBBADDED103M
		 WHERE AUD_YR = #AUD_YR#
	       AND AUD_NO = #AUD_NO#
	       AND AUD_STEP_CD = 'A1070'
	       AND RPRT_CD = 'A10600200'
	       AND SUBSTR(AUD_RPRT_DVSN_CD,2,1) = '1'
	       AND REF_DOC_ID = #DOC_ID#
	       AND REF_DY = #refDy#
		]]>
	</select>
	
	<select id="AEPAFU001CheakAbleYnByAfterProcess" parameterClass="java.util.Map" resultClass="java.lang.String">
		<![CDATA[
		SELECT DECODE(CNT,0,'Y','N') AS AFTER_PRCS_YN
		  FROM (SELECT COUNT(1) AS CNT
		          FROM 
		                (SELECT APV_DOC_NO, 
		                        DECODE(APVR_PST_CD, '0035100', '0015800', '0058100', '0015800', '0045900', '0055600', APVR_PST_CD) AS APVR_PST_CD,
		                        APVR_DPT_CD, 
		                        APV_DH
		                   FROM (
		                        SELECT APV_DOC_NO, APVR_PST_CD, APVR_DPT_CD, APV_DH
		                          FROM TBDCMACM023L
		                         WHERE APV_DOC_NO = #APV_DOC_NO#
		                           AND SUBSTR(APVR_STA_CD,0,1) >= '2'
		                           AND SUBSTR(APVR_STA_CD,0,1) <> '3'
			                       AND APVR_KND_CD <> '6'	                           
		                         ORDER BY APV_DH DESC, APVR_KND_CD DESC
		                         ) 
		                 WHERE ROWNUM = 1 ) APVR
		                ,(SELECT APV_DOC_NO,
		                         DECODE(APVR_PST_CD, '0035100', '0015800', '0058100', '0015800', '0045900', '0055600', APVR_PST_CD) AS APVR_PST_CD,
		                         APVR_DPT_CD, 
		                         APV_DH
		                    FROM TBDCMACM023H
		                   WHERE APV_DOC_NO = #APV_DOC_NO#
		                     AND SUBSTR(APVR_STA_CD,0,1) = '2') HIST
		          WHERE APVR.APV_DOC_NO = HIST.APV_DOC_NO
		            AND APVR.APVR_PST_CD = HIST.APVR_PST_CD
		            AND APVR.APVR_DPT_CD = HIST.APVR_DPT_CD
		            AND APVR.APV_DH <> HIST.APV_DH)
		]]>
	</select>
	
	<select id="AEPAFU001CheakAbleYnByAfterProcessCheck" parameterClass="java.util.Map" resultClass="java.lang.String">
		<![CDATA[
		SELECT DECODE(CNT,0,'Y','N') AS AFTER_PRCS_YN_CHECK
		  FROM (SELECT COUNT(1) AS CNT
		          FROM 
		                (SELECT APV_DOC_NO,
		                		APVR_KND_CD, 
		                        DECODE(APVR_PST_CD, '0035100', '0015800', '0058100', '0015800', '0045900', '0055600', APVR_PST_CD) AS APVR_PST_CD,
		                        APVR_DPT_CD, 
		                        APV_DH
		                   FROM (
		                        SELECT APV_DOC_NO, APVR_KND_CD, APVR_PST_CD, APVR_DPT_CD, APV_DH
		                          FROM TBDCMACM023L
		                         WHERE APV_DOC_NO = #APV_DOC_NO#
		                           AND SUBSTR(APVR_STA_CD,0,1) >= '2'
		                           AND SUBSTR(APVR_STA_CD,0,1) <> '3'
			                       AND APVR_KND_CD <> '6'	                           
		                         ORDER BY APV_DH DESC, APVR_KND_CD DESC
		                         ) 
		                 WHERE ROWNUM = 1 ) APVR
		                ,(SELECT APV_DOC_NO,
		                		 APVR_KND_CD,
		                         DECODE(APVR_PST_CD, '0035100', '0015800', '0058100', '0015800', '0045900', '0055600', APVR_PST_CD) AS APVR_PST_CD,
		                         APVR_DPT_CD, 
		                         APV_DH
		                    FROM TBDCMACM023H
		                   WHERE APV_DOC_NO = #APV_DOC_NO#
		                     AND SUBSTR(APVR_STA_CD,0,1) = '2') HIST
		          WHERE APVR.APV_DOC_NO = HIST.APV_DOC_NO
		            AND APVR.APVR_PST_CD = HIST.APVR_PST_CD
		            AND APVR.APVR_DPT_CD = HIST.APVR_DPT_CD
		            AND APVR.APVR_KND_CD = HIST.APVR_KND_CD
		            AND APVR.APV_DH <> HIST.APV_DH)
		]]>
	</select>
	
	
	<update id="AEPAFU001UpdatehndlPrdMngDt" parameterClass="java.util.Map">
        UPDATE TBBADDED003M
           SET FNL_USR_ID = #FNL_USR_ID#
             , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD# 
             , FNL_MNU_ID = #FNL_MNU_ID# 
             , FNL_MDF_DH = SYSDATE
         <dynamic>
            <isNotEmpty property="RTN_RPT_DT">
             , RTN_RPT_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
            </isNotEmpty>
            <isNotEmpty property="AUD_BRDV_APV_DT">
             , AUD_BRDV_APV_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
            </isNotEmpty>
            <isNotEmpty property="JA_JDG_SSEC_APV_DT">
             , JA_JDG_SSEC_APV_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
            </isNotEmpty>
            <isNotEmpty property="OW_DHD_APV_DT">
             , OW_DHD_APV_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
            </isNotEmpty>
            <isNotEmpty property="OW_PSD_APV_DT">
             , OW_PSD_APV_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
            </isNotEmpty>
            <isNotEmpty property="CHF_CMTR_APV_DT">
             , CHF_CMTR_APV_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
            </isNotEmpty>
         WHERE AUD_YR = #AUD_YR#
           AND AUD_NO = #AUD_NO#
        </dynamic>
    </update>
    
    <update id="AEPAFU001UpdateConData" parameterClass="java.util.Map">
        DECLARE 
            V_IF_SEQ NUMBER(18);
            V_IF_REF_SEQ NUMBER(18);   
            V_DATA_CNT NUMBER(1);
            V_SAVE_INF_YN CHAR(1);
         BEGIN
            SELECT  COUNT(1) INTO V_DATA_CNT 
               FROM TBCSPTSM001M
              WHERE FMDA_AUD_YR = #AUD_YR#
               AND FMDA_AUD_NO = #AUD_NO#;
                       
            IF V_DATA_CNT > 0 THEN

              SELECT NVL(FMDA_PUBLIC_YN,'N') INTO V_SAVE_INF_YN   /*공개여부에 따라 연계 처리 여부 체크*/
                FROM TBCSPTSM001M
               WHERE FMDA_AUD_YR = #AUD_YR#
                 AND FMDA_AUD_NO = #AUD_NO#;
               
              UPDATE TBCSPTSM001M T1
                 SET FMDA_PROC = #FMDA_PROC#
                   , FMDA_UP_DT = SYSDATE
                  <isNotEmpty property="FMDA_PUBLIC_DT">
	           , FMDA_PUBLIC_DT = TO_DATE(#FMDA_PUBLIC_DT#, 'YYYY/MM/DD HH24:MI:SS')
	          </isNotEmpty>
               WHERE FMDA_AUD_YR = #AUD_YR#
                 AND FMDA_AUD_NO = #AUD_NO#;
                 
               IF V_SAVE_INF_YN = 'Y' THEN  /*단계 업데이트 시 FMDA_PUBLIC_YN 값이 'Y' 인 경우 연계처리 하도록 수정 2017.07.24 kimsy*/     
	              SELECT  IF_SEQ.NEXTVAL INTO V_IF_SEQ FROM   DUAL;
	              
	              SELECT  NULL INTO V_IF_REF_SEQ FROM   DUAL;  
	              
	              INSERT INTO EH_INF_SP_HP_002
	                          (   IF_SEQ         
	                              ,IF_TYPE       
	                              ,IF_SIID 
	                              ,DVSN_CD       
	                              ,FMDA_IDX       
	                              ,FMDA_AUDIT_ST   
	                              ,FMDA_AUDIT_ET  
	                              ,FMDA_DEPT       
	                              ,FMDA_PART       
	                              ,FMDA_PROC      
	                              ,FMDA_DT         
	                              ,FMDA_TXT      
	                              ,ATCH_FILE_ID        
	                              ,FMDA_SJ        
	                              ,FMDA_RDCNT     
	                              ,FMDA_OPN_REGCNT 
	                              ,FMDA_UP_DT      
	                              ,USE_AT         
	                              ,FMDA_PUBLIC_DT  
	                              ,FMDA_PUBLIC_YN  
	                              ,FLAG            
	                          )
	                  SELECT V_IF_SEQ
	                              ,'SND'
	                              ,''
	                              ,'COMTMEDIA'
	                              ,FMDA_IDX
	                              ,FMDA_AUDIT_ST
	                              ,FMDA_AUDIT_ET
	                              ,FMDA_DEPT
	                              ,FMDA_PART
	                              ,FMDA_PROC
	                              ,FMDA_DT
	                              ,FMDA_TXT
	                              ,ATCH_FILE_ID
	                              ,FMDA_SJ
	                              ,FMDA_RDCNT
	                              ,FMDA_OPN_REGCNT
	                              ,FMDA_UP_DT
	                              ,USE_AT
	                              ,FMDA_PUBLIC_DT
	                              ,FMDA_PUBLIC_YN
	                              ,'U'
	                      FROM TBCSPTSM001M T1
	                    WHERE T1.FMDA_AUD_YR =  #AUD_YR#
	                         AND T1.FMDA_AUD_NO = #AUD_NO#;
	             
	              INSERT INTO BAI_INF_DB_SND_001
	                          (   IF_SEQ          /*연계순번*/
	                              ,TARE_NM        /*테이블명*/
	                              ,IF_REF_SEQ     /*참조연계순번*/
	                              ,IF_STATUS      /*연계상태코드*/
	                              ,IF_TRY         /*연계시도횟수*/
	                              ,IF_RAISE_DT    /*IF_RAISE_DT*/
	                          )
	                  VALUES  (   V_IF_SEQ
	                              ,'EH_INF_SP_HP_002'
	                              ,V_IF_REF_SEQ
	                              ,'SS'
	                              ,0
	                              ,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
	                          ) ;
	           END IF;
            END IF;
          END;
    </update>
    
    <!--실지감사 결재문서별 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByApvDocNo" parameterClass="paramMap"	resultClass="resultMap">
	    SELECT DISTINCT RPRT_CD, TEMPLATE_DOC_ID, SUBSTR(AUD_KND_CD, 3, 1) AS AUD_KND_CD
		  FROM TBBADDED103M
		 WHERE APV_RQS_ID = #strDocNo#
		   AND ROWNUM = 1
	</select>
	
    <!-- 결재자 PST_CD 조회 -->
	<select id="AEPAFU001GetApvrCdByCnb" parameterClass="paramMap"	resultClass="java.lang.String">
	 	SELECT MAX(PST_CD) AS APVR_CD
		  FROM TBDCMACM001M
		 WHERE CNB = #CNB#
	</select>

 
	<!-- 실지감사 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByParentKey" parameterClass="paramMap"	resultClass="resultMap">
		SELECT RPRT_CD, TEMPLATE_DOC_ID, SUBSTR(AUD_KND_CD, 3, 1) AS AUD_KND_CD
		  FROM TBBADDED103M
		 WHERE AUD_YR = #AUD_YR#
		   AND AUD_NO = #AUD_NO#
		   AND AUD_STEP_CD = #AUD_STEP_CD#
		   AND DOC_ID = #DOC_ID#
	</select>
	
	<!--심사.재심의 결재문서별 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByRequestAuditBDAndApvDocNo" parameterClass="paramMap"	resultClass="resultMap">
		SELECT DISTINCT RPRT_CD, TEMPLATE_DOC_ID
		  FROM TBBADFRE103M
		 WHERE APV_RQS_ID = #strDocNo#
		   AND ROWNUM = 1
	</select>
	
	<!-- 심사.재심의 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByRequestAuditBDAndParentKey" parameterClass="paramMap"	resultClass="resultMap">
		SELECT RPRT_CD, TEMPLATE_DOC_ID
		  FROM TBBADFRE103M
		 WHERE ACP_YR = #ACP_YR#
		   AND ACP_DVSN_CD = #ACP_DVSN_CD#
		   AND ACP_SRNO = #ACP_SRNO#
		   AND ACP_STEP_CD = #ACP_STEP_CD#
		   AND DOC_ID = #DOC_ID#
	</select>
	
	<!--재보,청구,청탁 결재문서별 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByRequestAuditCPAndApvDocNo" parameterClass="paramMap"	resultClass="resultMap">
		SELECT DISTINCT RPRT_CD, TEMPLATE_DOC_ID
		  FROM TBCSPDCP603M
		 WHERE APV_RQS_ID = #strDocNo#
		   AND ROWNUM = 1
	</select>
	
	<!-- 재보,청구,청탁 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByRequestAuditCPAndParentKey" parameterClass="paramMap"	resultClass="resultMap">
		SELECT RPRT_CD, TEMPLATE_DOC_ID
		  FROM TBCSPDCP603M
		 WHERE ACP_YR = #ACP_YR#
		   AND REQ_DVSN_CD = #REQ_DVSN_CD#
		   AND CVPT_ACP_NO = #CVPT_ACP_NO#
		   AND ACP_STEP_CD = #ACP_STEP_CD#
		   AND DOC_ID = #DOC_ID#
	</select>
	
    <!-- 감사보고서 국장 결재 여부 조회 -->
    <select id="AEPAFU001GetBruchfApvYn" parameterClass="paramMap" resultClass="java.lang.String">
    <![CDATA[
        SELECT NVL(MAX(CASE WHEN D.APVR_PST_CD IN ('0015800', '0035100', '0058100') THEN 'Y'
                            ELSE 'N'
                   END), 'N') AS BRUCHF_APV_YN
          FROM TBBADDED103M C
             , TBDCMACM023L D
         WHERE D.APV_DOC_NO = #APV_DOC_NO#
           AND C.APV_RQS_ID = D.APV_DOC_NO
           AND D.APV_SNO <> 1
           AND C.RPRT_CD = 'A10600200'
           AND D.APVR_STA_CD IN ('202','203','204')
           AND D.APVR_CNB = #CNB#
    ]]>
    </select>
    
    <!-- 감사보고서 수정가능 여부 Update -->
    <update id="AEPAFU001UpdateAudRprtEdtAuth" parameterClass="java.util.Map">
        UPDATE TBBADDED103M
           SET EDT_AUTH = #EDT_AUTH#
             , FNL_USR_ID = #FNL_USR_ID#
             , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD# 
             , FNL_MNU_ID = #FNL_MNU_ID# 
             , FNL_MDF_DH = SYSDATE
         WHERE APV_RQS_ID = #APV_DOC_NO#
    </update>
    
    
    <!-- 감사보고서 반려여부 조회 -->
    <select id="AEPAFU001GetApvBackYn" parameterClass="paramMap" resultClass="java.lang.String">
    <![CDATA[
        SELECT DECODE(COUNT(D.APV_DOC_NO), 0, 'N', 'Y') AS BACK_YN
          FROM TBBADDED103M C
             , TBDCMACM023L D
         WHERE D.APV_DOC_NO = #APV_DOC_NO#
           AND C.APV_RQS_ID = D.APV_DOC_NO
           AND D.APV_SNO <> 1
           AND C.RPRT_CD = 'A10600200'
           AND D.APVR_STA_CD IN ('401')
           AND D.APVR_CNB = #CNB#
    ]]>
    </select>
    
    <!-- 감사보고서 부의여부 조회 -->
    <select id="AEPAFU001GetSbcnYn" parameterClass="paramMap" resultClass="java.lang.String">
    <![CDATA[
        SELECT 
		    DECODE(SUM(DECODE(REFER_DVSN_CD,'D10',1,0)),0,'N','Y') AS SBCN_YN
		  FROM TBBADDED103M T1
		       INNER JOIN TBBADDED145M T2
		       ON (T1.AUD_YR = T2.AUD_YR
		           AND T1.AUD_NO = T2.AUD_NO
		           AND T1.DOC_ID = T2.DOC_ID)
		 WHERE T1.RPRT_CD = 'A10600200'
		   AND T1.DOC_ID = #DOC_ID#
		   AND T2.FNL_YN = 'Y'
    ]]>
    </select>
    
    <!-- 감사보고서 구분코드 조회 -->
    <select id="AEPAFU001GetAudRprtDvsnCd" parameterClass="paramMap" resultClass="java.lang.String">
    <![CDATA[
        SELECT 
		    MIN(AUD_RPRT_DVSN_CD) AS AUD_RPRT_DVSN_CD
		  FROM TBBADDED103M T1
		 WHERE T1.RPRT_CD = 'A10600200'
		   AND T1.DOC_ID = #DOC_ID#
    ]]>
    </select>
    
        <!-- 실지감사 보고서 docId 조회 -->
	<select id="AEPAFU001GetDocIdListByFAAndApvDocNo" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,C.AUD_STEP_NM
		      	,B.RPRT_NM
			  	,A.APV_RQS_ID
		      	,A.AUD_YR
		      	,A.AUD_NO
		      	,A.AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
		  FROM TBBADDED109M A
		 INNER JOIN TBBADDED103M B
		    ON A.AUD_YR = B.AUD_YR
		   AND A.AUD_NO = B.AUD_NO
		   AND A.AUD_STEP_CD = B.AUD_STEP_CD
		   AND A.DOC_ID = B.DOC_ID
		 INNER JOIN TBBADDED101M C
		    ON A.AUD_YR = C.AUD_YR
		   AND A.AUD_NO = C.AUD_NO
		   AND A.AUD_STEP_CD = C.AUD_STEP_CD
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
	</select>
	
	<!-- 심사,재심의 보고서 docId 조회 -->
	<select id="AEPAFU001GetDocIdListByBDAndApvDocNo" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,NVL(C.ACP_STEP_NM,'') AS AUD_STEP_NM
		      	,B.RPRT_NM
			  	,A.APV_RQS_ID
		      	,A.ACP_YR AS AUD_YR
		      	,A.ACP_SRNO AS AUD_NO
		      	,A.ACP_STEP_CD AS AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
				,A.ACP_DVSN_CD AS REQ_DVSN_CD
		  FROM TBBADFRE109M A
		 INNER JOIN TBBADFRE103M B
		    ON A.ACP_YR = B.ACP_YR
		   AND A.ACP_DVSN_CD = B.ACP_DVSN_CD
		   AND A.ACP_SRNO = B.ACP_SRNO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD
		   AND A.DOC_ID = B.DOC_ID
		 LEFT JOIN TBBADFRE101M C
		    ON A.ACP_YR = C.ACP_YR
		   AND A.ACP_DVSN_CD = C.ACP_DVSN_CD
		   AND A.ACP_SRNO = C.ACP_SRNO
		   AND A.ACP_STEP_CD = C.ACP_STEP_CD
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
	</select>
	
	<!-- 제보,청구 보고서 docId 조회 -->
	<select id="AEPAFU001GetDocIdListByCPAndApvDocNo" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,NVL(C.ACP_STEP_NM,'') AS AUD_STEP_NM
		      	,B.RPRT_NM
			  	,A.APV_RQS_ID
		      	,A.ACP_YR AS AUD_YR
		      	,A.CVPT_ACP_NO AS AUD_NO
		      	,A.ACP_STEP_CD AS AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
				,A.REQ_DVSN_CD
		  FROM TBCSPDCP609M A
		 INNER JOIN TBCSPDCP603M B
		    ON A.ACP_YR = B.ACP_YR
		   AND A.REQ_DVSN_CD = B.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD
		   AND A.DOC_ID = B.DOC_ID
		 LEFT OUTER JOIN TBCSPDCP601M C
		    ON A.ACP_YR = C.ACP_YR
		   AND A.REQ_DVSN_CD = C.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = C.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = C.ACP_STEP_CD 
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
	</select>
	
	<!-- 사용자정보 조회 -->
	<select id="AEPAFU001GetUserInfoByUserId" parameterClass="paramMap" resultClass="resultMap">
		SELECT 'S001' AS SIT_CD /* 사이트코드 */
			 , CNB /* 전산번호 */
			 , USR_ID	/* 사용자ID */
			 , USR_NAM	/* 사용자성명 */
			 , RANK_CD	/* 직급코드 */
			 , F_CODE_NM('1000173', RANK_CD) AS RANK_NAM	/*직급명*/
			 , DPT_CD	/* 부서코드 */
			 , F_DPT_INFO(DPT_CD, '1') AS DPT_NAM	/*부서명*/	
			 , EML_AD	/* 메일주소 */
			 , (CASE WHEN INSTR(EML_AD, '@') > 0 THEN SUBSTR(EML_AD, 0, INSTR(EML_AD, '@') - 1) ELSE '' END) AS EML_ID	/* 메일아이디 */
			 , (CASE WHEN INSTR(EML_AD, '@') > 0 THEN SUBSTR(EML_AD, INSTR(EML_AD, '@') + 1) ELSE '' END) AS EML_DOMAIN	/* 메일도메인 */
			 , PST_CD
             , F_CODE_NM('1000176', PST_CD) AS PST_NM
             , TNB 
             , INN_RANK_CD
             , ONR_PST_NM		/*기안문표시 직위명*/
		  FROM TBDCMACM001M
		 WHERE USR_ID = #USR_ID#
	</select>
	
   	<!-- 문서함 문서정보 조회(실지감사용) -->
    <select id="AEPAFU001GetDocInfoByDocIdAndFA" parameterClass="paramMap"   resultClass="resultMap">
    	SELECT AUD_YR, AUD_NO, AUD_STEP_CD, DOC_ID, RPRT_CD, REF_ID, RPRT_NM
		  FROM TBBADDED103M
		 WHERE DOC_ID = #DOC_ID#
    </select>
    
    <!-- 문서함 문서정보 조회(심사,재심의용) -->
    <select id="AEPAFU001GetDocInfoByDocIdAndBD" parameterClass="paramMap"   resultClass="resultMap">
     	SELECT ACP_YR, ACP_SRNO, ACP_STEP_CD, DOC_ID, RPRT_CD, RPRT_NM
		  FROM TBBADFRE103M
		 WHERE DOC_ID = #DOC_ID#
    </select>
    
    <!-- 문서함 문서정보 조회(제보,청구용) -->
    <select id="AEPAFU001GetDocInfoByDocIdAndCP" parameterClass="paramMap"   resultClass="resultMap">
    	SELECT ACP_YR, CVPT_ACP_NO, ACP_STEP_CD, DOC_ID, RPRT_CD, RPRT_NM
		  FROM TBCSPDCP603M
		 WHERE DOC_ID = #DOC_ID#
    </select>
    
    <!-- 변경의결사항대조표(A10800100) 관련 감사보고서 docId조회-->
    <select id="AEPAFU001GetRefDocInfoByChfRprt" parameterClass="paramMap"   resultClass="java.lang.String">
    	SELECT MAX(DOC_ID)
		  FROM TBBADDED103M
		 WHERE AUD_YR = #AUD_YR#
		   AND AUD_NO = #AUD_NO#
		   AND AUD_STEP_CD = 'A1070'
		   AND RPRT_CD = 'A10600200'
		   AND SUBSTR(AUD_RPRT_DVSN_CD,2,1) = '1'
		   AND REF_DY = (SELECT REF_DY 
		                   FROM TBBADDED103M 
		                  WHERE AUD_YR = #AUD_YR#
		                    AND AUD_NO = #AUD_NO#
		                    AND DOC_ID = #DOC_ID#)
    </select>
    
    <!-- 감사보고서(A10600200) 관련 처리안검토의견서 docId조회-->
    <select id="AEPAFU001GetRefDocInfoByAudRprt" parameterClass="paramMap"	resultClass="java.lang.String">
    	SELECT T2.REVIEW_DOC_ID /* 처리안검토의견서 */
		  FROM TBBADDED103M T1
		 INNER JOIN TBBADDED118M T2 ON
		 		T1.AUD_YR = T2.AUD_YR
		 	AND T1.AUD_NO = T2.AUD_NO
		 	AND T1.DOC_ID = #DOC_ID# /* 감사보고서 DOC_ID */
		 	AND T1.DOC_ID = T2.DOC_ID
		 	AND T1.RPRT_CD = 'A10600200'
		 UNION ALL
		SELECT T1.DOC_ID  /* 처리안검토의견서(취합본) */
		  FROM TBBADDED103M T1
		 WHERE T1.REF_ID = #DOC_ID# /* 감사보고서 DOC_ID */
		   AND T1.RPRT_CD = 'A10600410'
    </select>
    
	<select id="AEPAFU001GetAudRprtDocId" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
		SELECT 
			T1.REF_ID AS SBCN_RPRT_DOC_ID /* 변경의결사항대조표의 REF_ID : 부의안 DOC_ID*/
			, T1.REF_DOC_ID AS AUD_RPRT_DOC_ID /* 변경의결사항대조표의 REF_DOC_ID : 감사보고서 DOC_ID*/
			, T1.REF_DY
			, (SELECT TO_CHAR(MAX(ST1.AUD_MAIN_STEP_SNO))
			     FROM TBBADDED113M ST1
			    WHERE ST1.AUD_YR = T1.AUD_YR
			      AND ST1.AUD_NO = T1.AUD_NO
			      AND ST1.DOC_ID = T1.REF_DOC_ID
			      AND ST1.SBCN_REGI_REQ_DT = T1.REF_DY) AS AUD_MAIN_STEP_SNO
		  FROM TBBADDED103M T1
		 WHERE T1.DOC_ID = #DOC_ID#
		]]>
	</select>
	
	<!-- 결재 히스토리중 협조완료 존재여부 조회 -->
    <select id="selectHistCmptCorpYn" parameterClass="paramMap"	resultClass="java.lang.String">
		SELECT DECODE(COUNT(APV_DOC_NO), 0 , 'N', 'Y') AS CMPT_COPR_YN
		  FROM (
				SELECT APV_DOC_NO
				  FROM TBDCMACM023H 
				 WHERE APVR_STA_CD = '204' 
				   AND APV_DOC_NO = #strDocNo#
				   AND APV_DVSN_CD = #strApvDvsnCd#
				UNION
				SELECT /*대결로 협조한 경우*/ APV_DOC_NO
				  FROM TBDCMACM023L
				 WHERE APVR_KND_CD = '4'
				   AND APV_SNO IN (
				   					SELECT APV_SNO 
				   					  FROM TBDCMACM023L 
				   					 WHERE APVR_CNB IN (
									   					SELECT APVR_CNB
													      FROM TBDCMACM023H 
													     WHERE APVR_KND_CD = '6' 
													       AND APVR_STA_CD = '203'
														   AND APV_DOC_NO = #strDocNo#
														   AND APV_DVSN_CD = #strApvDvsnCd#
														   )
									  AND APV_DOC_NO = #strDocNo#
						  		      AND APV_DVSN_CD = #strApvDvsnCd#
						  		      AND APVR_KND_CD = '6'
								  )
				   AND APV_DOC_NO = #strDocNo#
				   AND APV_DVSN_CD = #strApvDvsnCd#
				 )
    </select>
    
    <!-- 다음 결재자 순번 조회 -->
	<select id="getNextApvSnoByAutoCmptCorpYn" parameterClass="paramMap"	resultClass="java.lang.Integer">
		<![CDATA[
			SELECT NVL(MIN(A.APV_SNO),0) AS APV_SNO
			  FROM TBDCMACM023L A
			 WHERE A.APV_DOC_NO = #APV_DOC_NO#
			   AND A.APV_DVSN_CD = #APV_DVSN_CD#
			   AND A.APV_SNO > #CURRENT_APV_SNO#
			   AND A.APV_SNO NOT IN (
									SELECT  APV_SNO
									  FROM (
											SELECT APV_DOC_NO,APV_DVSN_CD,APV_SNO,APVR_CNB,APVR_KND_CD,MIN(APV_DH) AS HIST_APV_DH
											  FROM TBDCMACM023H 
											 WHERE APVR_STA_CD = '204' 
											   AND APV_DOC_NO = #APV_DOC_NO#
											   AND APV_DVSN_CD = #APV_DVSN_CD#
											 GROUP BY APV_DOC_NO,APV_DVSN_CD,APV_SNO,APVR_CNB,APVR_KND_CD
											UNION
											SELECT AA.APV_DOC_NO,AA.APV_DVSN_CD,AA.APV_SNO,AA.APVR_CNB,AB.APVR_KND_CD,AB.HIST_APV_DH
											  FROM TBDCMACM023L AA
											      ,(
													SELECT APV_DOC_NO,APV_DVSN_CD,APV_SNO,APVR_CNB,APVR_KND_CD,MIN(APV_DH) AS HIST_APV_DH
												      FROM TBDCMACM023H 
												     WHERE APVR_KND_CD = '6' 
												       AND APVR_STA_CD = '203'
													   AND APV_DOC_NO = #APV_DOC_NO#
													   AND APV_DVSN_CD = #APV_DVSN_CD#
												     GROUP BY APV_DOC_NO,APV_DVSN_CD,APV_SNO,APVR_CNB,APVR_KND_CD
												   ) AB
											 WHERE AA.APV_DOC_NO = AB.APV_DOC_NO
											   AND AA.APV_DVSN_CD = AB.APV_DVSN_CD
											   AND AA.APVR_CNB = AB.APVR_CNB
											   AND AA.APV_DOC_NO = #APV_DOC_NO#
											   AND AA.APV_DVSN_CD = #APV_DVSN_CD#
											   AND AA.APVR_KND_CD = '6'
											)
									)
		]]>
	</select>
	
	 <!-- 자동 협조 완료 처리할 목록 조회 -->
    <select id="getAutoCmptCorpList" parameterClass="paramMap"   resultClass="resultMap">
	    <![CDATA[
	    	SELECT  APV_DOC_NO
					,APV_DVSN_CD
					,APV_SNO
					,APVR_CNB
					,APVR_KND_CD
					,HIST_APV_DH
			  FROM (
					SELECT APV_DOC_NO,APV_DVSN_CD,APV_SNO,APVR_CNB,APVR_KND_CD,MIN(APV_DH) AS HIST_APV_DH
					  FROM TBDCMACM023H 
					 WHERE APVR_STA_CD = '204' 
					   AND APV_DOC_NO = #APV_DOC_NO#
					   AND APV_DVSN_CD = #APV_DVSN_CD#
					 GROUP BY APV_DOC_NO,APV_DVSN_CD,APV_SNO,APVR_CNB,APVR_KND_CD
					UNION
					SELECT A.APV_DOC_NO,A.APV_DVSN_CD,A.APV_SNO,A.APVR_CNB,B.APVR_KND_CD,B.HIST_APV_DH
					  FROM TBDCMACM023L A
					      ,(
							SELECT APV_DOC_NO,APV_DVSN_CD,APV_SNO,APVR_CNB,APVR_KND_CD,MIN(APV_DH) AS HIST_APV_DH
						      FROM TBDCMACM023H 
						     WHERE APVR_KND_CD = '6' 
						       AND APVR_STA_CD = '203'
							   AND APV_DOC_NO = #APV_DOC_NO#
							   AND APV_DVSN_CD = #APV_DVSN_CD#
						     GROUP BY APV_DOC_NO,APV_DVSN_CD,APV_SNO,APVR_CNB,APVR_KND_CD
						   ) B
					 WHERE A.APV_DOC_NO = B.APV_DOC_NO
					   AND A.APV_DVSN_CD = B.APV_DVSN_CD
					   AND A.APVR_CNB = B.APVR_CNB
					   AND A.APV_DOC_NO = #APV_DOC_NO#
					   AND A.APV_DVSN_CD = #APV_DVSN_CD#
					   AND A.APVR_KND_CD = '6'
					)
			WHERE APV_SNO > #CURRENT_APV_SNO#
	 		  AND APV_SNO < #NEXT_APV_SNO#
 		    ORDER BY APV_SNO ASC, HIST_APV_DH DESC 
		 ]]>
    </select>
    
    <select id="AEPAFU001SelectFnlApvrCnb" parameterClass="paramMap" resultClass="String">
    	<![CDATA[
    		SELECT	T2.APVR_CNB
    		FROM	TBDCMACM022L T1
    				,TBDCMACM023L T2
    		WHERE	T1.APV_DVSN_CD = T2.APV_DVSN_CD
    		AND		T1.APV_DOC_NO = #APV_DOC_NO#
    		AND		T1.APV_DOC_NO = T2.APV_DOC_NO
    		AND		APV_SNO = (	SELECT  MAX(APV_SNO)
    							FROM	TBDCMACM022L S1
    									,TBDCMACM023L S2
    							WHERE	S1.APV_DVSN_CD = S2.APV_DVSN_CD
					    		AND		S1.APV_DOC_NO = #APV_DOC_NO#
					    		AND		S1.APV_DOC_NO = S2.APV_DOC_NO
					    		AND		SUBSTR(S2.APVR_STA_CD,1,1) = '2'
					    	 )
    	]]>
    </select>
    
    <select id="AEPAFU001SelectUsrInfo" parameterClass="paramMap" resultClass="resultMap">
    	<![CDATA[
    		SELECT	USR_ID, USR_NAM
    		FROM	TBDCMACM001M
    		WHERE	CNB = #R_FNL_APV_CNB#
    	]]>
    </select>

    <select id="defAvprListByAudDocSelect" parameterClass="paramMap" resultClass="resultMap">
    	<![CDATA[
    	SELECT DISTINCT DT.APVR_SNO
				, DT.CNB
				, DT.DPT_CD
				, F_DPT_INFO(DT.DPT_CD,'1') AS DPT_NM
				, DT.USR_ID
				, DT.USR_NAM
				, DT.RANK_CD
				, F_CODE_NM('1000173',DT.RANK_CD) AS RANK_NM
				, DT.PST_CD
				, F_CODE_NM('1000176',DT.PST_CD) AS PST_NM
				, DT.APVR_KND_CD
				, F_CODE_NM('1000350',DT.APVR_KND_CD) AS APVR_KND_NM
				, DT.ONR_PST_NM		/*전자감사 기안문에 표시될 직위명*/
		  FROM (
			    SELECT 	1 AS APVR_SNO
						, CNB
						, DPT_CD
						, USR_ID
						, USR_NAM
						, RANK_CD
						, PST_CD
						, '1' AS APVR_KND_CD
						, ONR_PST_NM
				  FROM TBDCMACM001M
				 WHERE CNB = #strSessCnb#
				UNION
				SELECT  BASE.APVR_SNO
						, BASE.CNB
						, BASE.DPT_CD
						, BASE.USR_ID
						, BASE.USR_NAM
						, BASE.RANK_CD
						, USR.PST_CD
						, BASE.APVR_KND_CD
						, BASE.ONR_PST_NM
				   FROM 
				 	    TBDCMACM001M USR
					 	,(SELECT APVR.APVR_SNO, B.CNB, B.DPT_CD, B.USR_ID, B.USR_NAM, B.RANK_CD, B.PST_CD, APVR.APVR_KND_CD, B.ONR_PST_NM
					 	  FROM 
						    (
							    /*기안자가 아니고 지정타입이 직위인 경우*/
						     	SELECT APVR_SNO, APNT_PST_CD, APVR_KND_CD, AUD_DOC_CD
						     	  FROM TBDCMACM019L
						     	 WHERE APVR_KND_CD <> '1'
						     	   AND APNT_DVSN_CD = '1'
						     	   AND AUD_DOC_CD = #strRprtCd#
		]]>
							<isNotEmpty property="strTemplateDocId">		     	   
						     	   AND DTIL_AUD_DOC_NO = (
						     	   							SELECT D.DTIL_AUD_DOC_NO
						     	   							  FROM TBFDMADM002M D
						     	   							 WHERE D.AUD_DOC_CD = #strRprtCd#
						     	   							   AND D.DOC_ID = #strTemplateDocId#
						     	   						  )
							</isNotEmpty>
							<isEmpty property="strTemplateDocId">
									AND DTIL_AUD_DOC_NO = 0
							</isEmpty>
		<![CDATA[
						     ) APVR 
					   		,(
					   			/*기안자 상위 부서 직위자 조회*/
								SELECT DISTINCT A.CNB,A.DPT_CD,A.USR_ID,A.USR_NAM,A.RANK_CD, A.PST_CD
									  ,DECODE(A.PST_CD,'0013600','1' /*과장*/
									                  ,'0035400','1' /*담당관*/
									                  ,'0047900','1' /*부장*/
									                  ,'0096800','1' /*팀장*/
									                  ,'0015800','2' /*국장*/
									                  ,'0035100','2' /*단장*/
									                  ,'0058100','2' /*실장*/
									                  ,'0013900','2' /*관리관*/
									                  ,'0010300','2' /*감찰관*/
		  							                  ,'0067400','2' /*감사교육원장*/
									                  ,'0055600','3' /*사무차장*/
									                  ,'0045900','3' /*본부장*/
									                  ,A.PST_CD) AS APNT_PST_CD /*직위를 지정직위로 치환(공통코드 1000827)*/
									  ,A.ONR_PST_NM
								  FROM TBDCMACM001M A
								     , TBDCMACM002M B
								 WHERE A.DPT_CD = B.DPT_CD
								   AND B.USE_YN = 'Y'
								   AND A.PST_CD IS NOT NULL
								   AND A.RQS_STA_CD = '3'
							       AND A.RSG_DT IS NULL 
								 START WITH B.DPT_CD = #strDptCd#
								 CONNECT BY PRIOR B.HIRK_DPT_CD = B.DPT_CD
								UNION
								SELECT A.CNB,A.DPT_CD,A.USR_ID,A.USR_NAM,A.RANK_CD, A.PST_CD
								      ,'4' AS APNT_PST_CD 
								      ,A.ONR_PST_NM 
								  FROM TBDCMACM001M A
								 WHERE A.DPT_CD = '520000'
								   AND A.PST_CD = '0055700' /*사무총장*/	   
								   AND A.RQS_STA_CD = '3'
							       AND A.RSG_DT IS NULL 
								UNION
								SELECT A.CNB,A.DPT_CD,A.USR_ID,A.USR_NAM,A.RANK_CD, A.PST_CD
								      ,'5' AS APNT_PST_CD
								      ,A.ONR_PST_NM 
								  FROM TBDCMACM001M A
								 WHERE A.DPT_CD = '500000'
								   AND A.PST_CD = '0067400' /*원장*/
								   AND A.RQS_STA_CD = '3'
							       AND A.RSG_DT IS NULL 
						     ) B	     
						WHERE APVR.APNT_PST_CD = B.APNT_PST_CD 
					   ) BASE
				   WHERE USR.CNB = BASE.CNB
				UNION
				SELECT  APVR.APVR_SNO
						, A.CNB
						, A.DPT_CD
						, A.USR_ID
						, A.USR_NAM
						, A.RANK_CD
						, A.PST_CD
						, APVR.APVR_KND_CD
						, A.ONR_PST_NM
				  FROM  TBDCMACM001M A  	    
				  	    ,(
					  	    /*기안자가 아니고 지정타입이 사용자인 경우*/
					     	SELECT APVR_SNO, APVR_CNB, APVR_KND_CD
					     	  FROM TBDCMACM019L
					     	 WHERE APVR_KND_CD <> '1'
					     	   AND APNT_DVSN_CD = '2'
					     	   AND AUD_DOC_CD = #strRprtCd#
		]]>					     	   
							<isNotEmpty property="strTemplateDocId">		     	   
						     	   AND DTIL_AUD_DOC_NO = (
						     	   							SELECT D.DTIL_AUD_DOC_NO
						     	   							  FROM TBFDMADM002M D
						     	   							 WHERE D.AUD_DOC_CD = #strRprtCd#
						     	   							   AND D.DOC_ID = #strTemplateDocId#
						     	   						  )
							</isNotEmpty>
							<isEmpty property="strTemplateDocId">
									AND DTIL_AUD_DOC_NO = 0
							</isEmpty>
		<![CDATA[							
					     ) APVR
				  WHERE A.CNB = APVR.APVR_CNB
				) DT
			ORDER BY DT.APVR_SNO
		]]>
    </select>
    
    <!--감사계획관리 결재문서별 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByAudExecPlanMngAndApvDocNo" parameterClass="paramMap"	resultClass="resultMap">
		SELECT DISTINCT RPRT_CD, TEMPLATE_DOC_ID
		  FROM TBBADDED131M
		 WHERE APV_RQS_ID = #strDocNo#
		   AND ROWNUM = 1
	</select>
	
	<!-- 감사계획관리 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByAudExecPlanMngAndParentKey" parameterClass="paramMap"	resultClass="resultMap">
		SELECT RPRT_CD, TEMPLATE_DOC_ID
		  FROM TBBADDED131M
		 WHERE AUD_PLAN_YR = #AUD_PLAN_YR#
		   AND AUD_PLAN_SNO = #AUD_PLAN_SNO#
		   AND DPT_CD = #DPT_CD#
		   AND DOC_ID = #DOC_ID#
	</select>
	
	<!-- 감사계획관리 결재문서목록 조회 -->
	<select id="AEPAFU001GetAudExecPlanMngApprDocInfo" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,'' AS AUD_STEP_NM
		      	,B.RPRT_NM
		      	,B.RPRT_CD
			  	,A.APV_RQS_ID
		      	,A.AUD_PLAN_YR AS AUD_YR
		      	,A.AUD_PLAN_SNO AS AUD_NO
		      	,A.DPT_CD AS AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
				,F_OPEN_EDIT(B.LINK_URL) AS DOC_TYPE 				
		  FROM TBBADDED132M A
		 INNER JOIN TBBADDED131M B
		    ON A.AUD_PLAN_YR = B.AUD_PLAN_YR
		   AND A.AUD_PLAN_SNO = B.AUD_PLAN_SNO
		   AND A.DPT_CD = B.DPT_CD
		   AND A.DOC_ID = B.DOC_ID
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
		   AND A.APV_DOC_DVSN_CD = #APV_DOC_DVSN_CD#
		ORDER BY A.SORT_SNO
	</select>
	
	<!-- 감사계획관리 결재문서별 문서목록 조회 -->
	<select id="AEPAFU001GetAudExecPlanMngApprDocInfoByParentKey" parameterClass="paramMap" resultClass="resultMap">
		SELECT A.DPT_CD AS AUD_STEP_CD
		     , '' AS AUD_STEP_NM
		     , A.RPRT_NM
		     , A.RPRT_CD
		     , A.APV_RQS_ID
		      ,A.AUD_PLAN_YR AS AUD_YR
		      ,A.AUD_PLAN_SNO AS AUD_NO
			  ,A.DOC_ID
			  ,A.APV_STA_CD
			  ,F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE			  
		  FROM TBBADDED131M A
		  WHERE 1=1
		<isEqual property="APV_DOC_DVSN_CD" compareValue="10">
		   AND A.APV_RQS_ID IS NULL
		</isEqual> 
		<iterate property="docInfoList" prepend="AND (A.AUD_PLAN_YR,A.AUD_PLAN_SNO,A.DPT_CD,A.DOC_ID) IN " open="(" close=")" conjunction="," >
       		(#docInfoList[].audYr#,#docInfoList[].audNo#,#docInfoList[].audStepCd#,#docInfoList[].docId#)
   		</iterate>
	</select>
	
	<insert id="AEPAFU001InsertAudRptSndData" parameterClass="paramMap" >
		INSERT INTO TBBADDED111M (
                   AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,DOC_ID
                  ,SR_DOC_SNO
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,DOC_STA_CD
                  ,SND_DPT_CD
                  ,SNDR_ID
                  ,SND_DH
                  ,RCPT_DPT_CD
                  ,RCPT_DH
                  ,AUD_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH)    
			 (SELECT AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,#DOC_ID# AS DOC_ID
			      , (SELECT LPAD(NVL(MAX(TO_NUMBER(T1.SR_DOC_SNO)),0)+1,3,0) 
                       FROM TBBADDED111M T1
                      WHERE T1.AUD_YR = #AUD_YR#
                        AND T1.AUD_NO = #AUD_NO#
                        AND T1.AUD_STEP_CD = #AUD_STEP_CD#
                        AND T1.DOC_ID = #DOC_ID# ) AS SR_DOC_SNO
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM
			      ,RPRT_CD
			      ,'20' AS DOC_STA_CD
			      ,#DPT_CD# AS SND_DPT_CD
			      ,#USR_ID# AS SNDR_ID
			      ,SYSDATE AS SND_DH
			      ,'160200' AS RCPT_DPT_CD
			      ,SYSDATE AS RCPT_DH
			      ,AUD_RPRT_DVSN_CD
			      ,DOC_KND_CD   
			      ,REF_ID
			      ,#USR_ID# AS FRT_USR_ID
                  ,#USR_ID# AS FNL_USR_ID
                  ,#DPT_CD# AS FNL_DEAL_DPT_CD
                  ,#CURRENT_MENU_ID# AS FNL_MNU_ID
                  ,SYSDATE AS FRT_REGI_DH
                  ,SYSDATE AS FNL_MDF_DH
			FROM TBBADDED103M A
			WHERE AUD_YR = #AUD_YR#
			 AND AUD_NO = #AUD_NO#
			 AND AUD_STEP_CD = 'A1060'
			 AND RPRT_CD = 'A10600200'
			 AND DOC_ID = #DOC_ID#)
	</insert>
	
		<insert id="AEPAFU001InsertAudRptSndData2" parameterClass="paramMap" >
		INSERT INTO TBBADDED111M (
                   AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,DOC_ID
                  ,SR_DOC_SNO
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,SND_DPT_CD
                  ,SNDR_ID
                  ,SND_DH
                  ,AUD_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH)    
			 (SELECT AUD_YR
			      ,AUD_NO
			      ,AUD_STEP_CD
			      ,#COPY_AUD_RPT_ID# AS DOC_ID
			      , (SELECT LPAD(NVL(MAX(TO_NUMBER(T1.SR_DOC_SNO)),0)+1,3,0) 
                       FROM TBBADDED111M T1
                      WHERE T1.AUD_YR = #AUD_YR#
                        AND T1.AUD_NO = #AUD_NO#
                        AND T1.AUD_STEP_CD = #AUD_STEP_CD#
                        AND T1.DOC_ID = #DOC_ID# ) AS SR_DOC_SNO
			      ,AUD_KND_CD
			      ,AUD_GRN_NO
			      ,RPRT_NM
			      ,RPRT_CD
			      ,#DPT_CD# AS SND_DPT_CD
			      ,#USR_ID# AS SNDR_ID
			      ,SYSDATE AS SND_DH
			      ,AUD_RPRT_DVSN_CD
			      ,DOC_KND_CD   
			      ,#DOC_ID# AS REF_ID
			      ,#USR_ID# AS FRT_USR_ID
                  ,#USR_ID# AS FNL_USR_ID
                  ,#DPT_CD# AS FNL_DEAL_DPT_CD
                  ,#CURRENT_MENU_ID# AS FNL_MNU_ID
                  ,SYSDATE AS FRT_REGI_DH
                  ,SYSDATE AS FNL_MDF_DH
			FROM TBBADDED103M A
			WHERE AUD_YR = #AUD_YR#
			 AND AUD_NO = #AUD_NO#
			 AND AUD_STEP_CD = 'A1060'
			 AND RPRT_CD = 'A10600200'
			 AND DOC_ID = #DOC_ID#)
	</insert>
	
	
	<select id="selectEditorWrkApplYn" parameterClass="paramMap" resultClass="String">
    	<![CDATA[
    		SELECT (CASE WHEN ALL_CNT = 0 THEN 'NULL'
                         WHEN ALL_CNT > 0 AND ALL_CNT = Y_CNT THEN 'Y' 
                         ELSE 'N' END)
              FROM (
                   SELECT COUNT(1) AS ALL_CNT, SUM(DECODE(EDITOR_WRK_APPL_YN,'Y',1,0)) AS Y_CNT
                   FROM (
                     SELECT DOC_ID, RPRT_CD, EDITOR_WRK_APPL_YN
                       FROM TBBADDED103M A
                      WHERE AUD_STEP_CD = 'A1060'
                        AND RPRT_CD = 'A10600200'
			            AND APV_RQS_ID = #strDocNo#
			         UNION ALL
                      SELECT DOC_ID, RPRT_CD, EDITOR_WRK_APPL_YN
                       FROM TBBADFRE103M A
                      WHERE ACP_STEP_CD = 'D1020'
                        AND RPRT_CD = 'D10200200'
			            AND APV_RQS_ID = #strDocNo#
			       ))
    	]]>
    </select>
    
    <select id="selectOpinWrkApplYn" parameterClass="paramMap" resultClass="String">
    	<![CDATA[
    		SELECT (CASE WHEN ALL_CNT = 0 THEN 'NULL'
                         WHEN ALL_CNT > 0 AND ALL_CNT = Y_CNT THEN 'Y' 
                         ELSE 'N' END)
              FROM (
                   SELECT COUNT(1) AS ALL_CNT, SUM(DECODE(OPIN_WRK_APPL_YN,'Y',1,0)) AS Y_CNT
                   FROM (
                     SELECT A.DOC_ID,
                          A.RPRT_CD,
                          A.OPIN_WRK_APPL_YN
                     FROM TBBADDED103M A
               INNER JOIN TBBADDED111M B ON (A.AUD_YR = B.AUD_YR AND A.AUD_NO = B.AUD_NO AND A.AUD_STEP_CD = B.AUD_STEP_CD AND A.DOC_ID = B.DOC_ID)
                      WHERE A.AUD_STEP_CD = 'A1060'
                        AND A.RPRT_CD = 'A10600200'
			            AND A.APV_RQS_ID = #strDocNo#
			            AND TO_CHAR(B.SND_DH,'YYYYMMDD') >= ( SELECT ST.USR_DFN_TXT_1 FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000915' AND ST.CD = '10' )
			            )
			       )
    	]]>
    </select>
    
    <select id="selectAudtorInfo" parameterClass="paramMap" resultClass="resultMap">
    	<![CDATA[
             SELECT  D1.CNB
                   , D2.RPRT_NM
                   , D2.RPRT_CD
                   , F_MNG_KND_AUDYRNO(D2.AUD_YR, D2.AUD_NO, D2.AUD_KND_CD, '-') AS AUD_YR_NO
                   , (SELECT ST.AUD_SBJ_NM FROM TBBADDED001M ST WHERE ST.AUD_YR = D2.AUD_YR AND ST.AUD_NO = D2.AUD_NO) AS AUD_SBJ_NM
              FROM TBBADDED031L D1
        INNER JOIN TBBADDED103M D2 ON D2.AUD_YR = D1.AUD_YR AND D2.AUD_NO = D1.AUD_NO
             WHERE D2.APV_RQS_ID = #strDocNo#
               AND D1.AUDTOR_DVSN_CD IN ('1' ,'2')
          GROUP BY D1.CNB, D2.RPRT_NM, D2.AUD_YR, D2.AUD_NO, D2.AUD_KND_CD, D2.RPRT_CD
          UNION ALL
             SELECT  D1.HNDL_CHGR_CD AS CNB
                   , D2.RPRT_NM
                   , D2.RPRT_CD
                   , D2.ACP_YR || '-' || DECODE(D2.ACP_DVSN_CD, '1','심사','재심') || '-' || D2.ACP_SRNO AS AUD_YR_NO
                   , D1.TIT_NM  AS AUD_SBJ_NM
              FROM TBBADFRE012M D1
        INNER JOIN TBBADFRE103M D2 ON D2.ACP_YR = D1.ACP_YR AND D2.ACP_DVSN_CD = D1.ACP_DVSN_CD AND D2.ACP_SRNO = D1.ACP_SRNO
             WHERE D2.APV_RQS_ID = #strDocNo#
          GROUP BY D1.HNDL_CHGR_CD, D2.RPRT_NM, D2.RPRT_CD, D2.ACP_YR, D2.ACP_DVSN_CD, D2.ACP_SRNO, D1.TIT_NM
          ]]>
    </select>
    
    
    
    <select id="AEPAFU001getAudInfo" parameterClass="paramMap" resultClass="resultMap">
    	<![CDATA[
          SELECT F_DPT_INFO(B.MNG_DPT_CD, '1') AS MNG_DPT_NM
                 , F_MNG_KND_AUDYRNO(B.AUD_YR, B.AUD_NO, B.AUD_KND_CD, '-') AS AUD_YR_NO
                 , B.AUD_SBJ_NM
                 , A.RPRT_NM || '(' || F_CODE_NM('1000788', A.AUD_RPRT_DVSN_CD) || ')' AS RPRT_NM 
                 , (SELECT nvl(AGGR_CONCAT(ST.CD_NM,''), '000') FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000914' AND ST.USR_DFN_TXT_1 = '30') AS RCPT_USR_CNB
                 , (SELECT COUNT(ST.CD_NM) FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000914' AND ST.USR_DFN_TXT_1 = '30') AS RCPT_USR_CNT
            FROM TBBADDED103M A 
      INNER JOIN TBBADDED001M B ON (B.AUD_YR = A.AUD_YR AND B.AUD_NO = A.AUD_NO)
           WHERE A.AUD_YR = #AUD_YR#
             AND A.AUD_NO = #AUD_NO#
             AND A.AUD_STEP_CD = #AUD_STEP_CD#
             AND A.DOC_ID = #DOC_ID#
    	]]>
    </select>
    
    <select id="AEPAFU001getExamerInfo" parameterClass="paramMap" resultClass="resultMap">
    	<![CDATA[
          SELECT F_DPT_INFO(B.MNG_DPT_CD, '1') AS MNG_DPT_NM
                 , F_MNG_KND_AUDYRNO(B.AUD_YR, B.AUD_NO, B.AUD_KND_CD, '-') AS AUD_YR_NO
                 , B.AUD_SBJ_NM
                 , A.RPRT_NM || '(' || F_CODE_NM('1000788', A.AUD_RPRT_DVSN_CD) || ')' AS RPRT_NM 
                 , (SELECT nvl(AGGR_CONCAT(ST.CD_NM,''), '000') FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000914' AND ST.USR_DFN_TXT_1 = '20' AND ST.USE_YN = 'Y') AS RCPT_USR_CNB
                 , (SELECT COUNT(ST.CD) FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000914' AND ST.USR_DFN_TXT_1 = '20') AS RCPT_USR_CNT
                 , (SELECT ST.DPT_NM FROM TBDCMACM002M ST WHERE ST.DPT_CD = #FNL_DEAL_DPT_CD#) AS APVR_DPT_NM
                 , (SELECT F_DPT_INFO(ST.HIRK_DPT_CD, '1') FROM TBDCMACM002M ST WHERE ST.DPT_CD = B.MNG_DPT_CD) AS HIRK_DPT_NM
                 , TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI') AS APV_DH
            FROM TBBADDED103M A 
      INNER JOIN TBBADDED001M B ON (B.AUD_YR = A.AUD_YR AND B.AUD_NO = A.AUD_NO)
           WHERE A.AUD_YR = #AUD_YR#
             AND A.AUD_NO = #AUD_NO#
             AND A.AUD_STEP_CD = #AUD_STEP_CD#
             AND A.DOC_ID = #DOC_ID#
    	]]>
    </select>
    
    <update id="AEPAFU001UpdatePrcsCmpt" parameterClass="java.util.Map">
		UPDATE /* aep.afu.service.impl.AEPAFU001ServiceImpl.AEPAFU001UpdatePrcsCmpt */
			   TBBADDED102M                       
		   SET CMPT_YN          = 'Y'                 /* 완료여부 */
		 WHERE AUD_YR = #AUD_YR#
           AND AUD_NO = #AUD_NO#
           AND AUD_STEP_CD = #AUD_STEP_CD#
		   AND AUD_MAIN_STEP_ID = #AUD_MAIN_STEP_ID#
	</update>
	
	<update id="AEPAFU001UpdateRprtEditYn" parameterClass="java.util.Map">
	    UPDATE TBBADDED103M
			   SET EDT_AUTH             = #EDT_AUTH#         
			      , FNL_USR_ID          = #FNL_USR_ID#                 /* 최종사용자ID */
			      , FNL_DEAL_DPT_CD     = #FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
			      , FNL_MNU_ID          = #FNL_MNU_ID#                 /* 최종메뉴ID */
			      , FNL_MDF_DH          = SYSDATE                      /* 최종수정일시 */
			 WHERE AUD_YR = #AUD_YR#
			   AND AUD_NO = #AUD_NO#
			   AND AUD_STEP_CD = #AUD_STEP_CD#
			   AND DOC_ID = #DOC_ID#
	</update>
	
	<insert id="insertSendDoc" parameterClass="java.util.Map">
		INSERT INTO TBBADDED111M (
                   AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,DOC_ID
                  ,SR_DOC_SNO
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,DOC_STA_CD
                  ,SND_DPT_CD
                  ,SNDR_ID
                  ,SND_DH
                  ,RCPT_DPT_CD
                  ,RCNT_ID
                  ,RCPT_DH
                  ,AUD_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH )
           (SELECT AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,NVL(#NEW_DOC_ID#, DOC_ID) 
                  ,(
                    SELECT NVL(MAX(SR_DOC_SNO), 0) + 1
                      FROM TBBADDED111M T2
                     WHERE T2.AUD_YR = T1.AUD_YR
                       AND T2.AUD_NO = T1.AUD_NO
                       AND T2.DOC_ID = T1.DOC_ID
                   )
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,'20'
                  ,#FNL_DEAL_DPT_CD#
                  ,#FNL_USR_ID#
                  ,SYSDATE
                  ,#RCPT_DPT_CD# 
                  ,''
                  ,SYSDATE
                  ,AUD_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,#FNL_USR_ID#
                  ,#FNL_USR_ID#
                  ,#FNL_DEAL_DPT_CD#
                  ,#FNL_MNU_ID#
                  ,SYSDATE
                  ,SYSDATE 
              FROM TBBADDED103M T1
             WHERE T1.AUD_YR = #AUD_YR#
               AND T1.AUD_NO = #AUD_NO#
               AND T1.DOC_ID = #DOC_ID#
               AND T1.RPRT_CD = #RPRT_CD#
             )
	</insert>
	
	<select id="selectSendDoc" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT C.DPT_CD
		     , C.DPT_NM
		     , B.RPRT_CD
		     , B.RPRT_NM
		     , D.DOC_ID AS SND_DOC_ID
		     , B.DOC_ID
		     , (CASE WHEN D.DOC_ID IS NOT NULL                           THEN 'N'
		             WHEN C.DPT_CD = '510000' AND E.CHF_CMTR_CNB IS NULL THEN 'N'
		                                                                 ELSE 'Y'
		         END) AS SND_INFO
		     , (CASE WHEN C.DPT_CD = '510000' AND E.CHF_CMTR_CNB IS NULL THEN '주심위원 지정전' ELSE '' END) AS ETC
		     , A.AUD_YR
		     , A.AUD_NO
		  FROM TBCSPKDE103M_VIEW A
		 INNER JOIN 
		       TBBADDED103M B
		    ON B.AUD_YR = A.AUD_YR
		   AND B.AUD_NO = A.AUD_NO
		   AND B.RPRT_CD = #RPRT_CD#
		   AND B.DOC_ID = #DOC_ID#
		   AND ((#RPRT_CD# = 'A10700900' AND (B.REF_ID = (A.SRNO || A.MFEX_DVSN_CD) OR B.REF_ID IN (SELECT AA.AFF_SNO
																							   	        FROM TBCSPKDE106M AA
																							           WHERE AA.AUD_YR = A.AUD_YR
																								         AND AA.AUD_NO = A.AUD_NO
																								         AND AA.SRNO = A.SRNO )) ) OR
		        (#RPRT_CD# != 'A10700900' AND (B.REF_DY = (A.SRNO || A.MFEX_DVSN_CD) OR B.REF_DY IN (SELECT AA.AFF_SNO
																							   	         FROM TBCSPKDE106M AA
																							            WHERE AA.AUD_YR = A.AUD_YR
																								          AND AA.AUD_NO = A.AUD_NO
																								          AND AA.SRNO = A.SRNO )) ))
		 INNER JOIN
		       (SELECT AA.DPT_CD
		             , AA.DPT_NM 
		          FROM TBDCMACM002M AA
		         WHERE AA.DPT_CD IN ('180130','510000')) C
		    ON (1=1)
		 LEFT OUTER JOIN 
		      TBBADDED111M D 
		   ON D.AUD_YR = A.AUD_YR 
		  AND D.AUD_NO = A.AUD_NO 
		  AND D.RCPT_DPT_CD = C.DPT_CD 
		  AND D.RPRT_CD = #RPRT_CD#
		  AND NVL(D.REF_ID, '99999') = NVL(B.REF_ID, '99999') 
		  AND NVL(D.REF_DY, '99999') = NVL(B.REF_DY, '99999')
		 LEFT OUTER JOIN 
		      TBBADDED116L E 
		   ON E.AUD_YR = A.AUD_YR 
		  AND E.AUD_NO = A.AUD_NO 
		  AND E.TASK_DVSN_CD = '9'
		  AND E.SRNO = (SELECT MAX(SRNO) 
		                  FROM TBBADDED116L 
		                 WHERE AUD_YR = A.AUD_YR 
		                   AND AUD_NO = A.AUD_NO 
		                   AND TASK_DVSN_CD = '9')
		 WHERE A.AUD_YR = #AUD_YR#
		   AND A.AUD_NO = #AUD_NO#
		   AND ((#RPRT_CD# = 'A10700900' AND B.REF_ID = #REF_ID# ) OR
		        (#RPRT_CD# != 'A10700900' AND B.REF_DY = #REF_DY#))
	]]>
	</select>
	
	<insert id="sendMessengerMsg" parameterClass="java.util.Map">
		<![CDATA[
        INSERT INTO
            TBDCMACM026L
            (
              MSG_SNO
            , TSK_CAT_CD
            , FUNC_CAT_CD
            , SEND_ID
            , MSG_TP_YN
            , MSG_TXT_2
            , RCNT_CNT
            , RCNT_HIS
            , MSG_REGI_DH
            , FRT_USR_ID
            , FNL_USR_ID
            , FNL_DEAL_DPT_CD
            , FNL_MNU_ID
            , FRT_REGI_DH
            , FNL_MDF_DH    
            )
            VALUES
            (
              (SELECT NVL(MAX(MSG_SNO),'0')+1 AS MSG_SNO FROM TBDCMACM026L)
            , 'CM'
            , 'CM'
            , #SEND_ID#
            , '0'
            , #SEND_MSG#
            , #RCPT_USR_CNT#
            , #RCPT_USR_CNB#
            , SYSDATE 
            , #FNL_USR_ID#
            , #FNL_USR_ID#
            , #FNL_DEAL_DPT_CD#
            , #FNL_MNU_ID#
            , SYSDATE
            , SYSDATE 
            )
        ]]>
	</insert>
	
	<update id="updateReqStatCd" parameterClass="java.util.Map">
	   <![CDATA[
            UPDATE TBBADDED126M
               SET REQ_STAT_CD          = '20'
                 , REQ_STAT_CHG_DH      = SYSDATE
                 , LEGAL_REQ_DH         = SYSDATE
                 , FNL_USR_ID           = #FNL_USR_ID#
                 , FNL_DEAL_DPT_CD      = #FNL_DEAL_DPT_CD#
                 , FNL_MNU_ID           = #FNL_MNU_ID#
                 , FNL_MDF_DH           = SYSDATE
             WHERE WRK_DVSN_CD          = 'A10'
               AND WRK_YR               = #AUD_YR#
               AND WRK_NO               = #AUD_NO#
               AND AUD_STEP_CD          = 'A1060'
               AND LEGAL_REQ_SRNO       = #REF_ID#
               AND LEGAL_REQ_DVSN_CD    = #REF_DY#
        ]]>
	</update>
	
	<update id="updateFrsReqStatCd" parameterClass="java.util.Map">
	   <![CDATA[
            UPDATE TBAEPFRS101M
               SET REQ_STAT_CD      = '10'
                 , REQ_DH           = SYSDATE
                 , FNL_USR_ID       = #FNL_USR_ID#
                 , FNL_DEAL_DPT_CD  = #FNL_DEAL_DPT_CD#
                 , FNL_MNU_ID       = #FNL_MNU_ID#
                 , FNL_MDF_DH       = SYSDATE
             WHERE AUD_YR           = #AUD_YR#
               AND AUD_NO           = #AUD_NO#
               AND AUD_STEP_CD      = 'A1098'
               AND FRS_REQ_SRNO     = #REF_ID#
               AND FRS_REQ_DVSN_CD  = #REF_DY#
        ]]>
	</update>		
	
	<select id="selectAudInfoForMsg" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
            SELECT F_DPT_INFO(A.MNG_DPT_CD, '1') AS MNG_DPT_NM
                 , F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-') AS AUD_YR_NO
                 , A.AUD_SBJ_NM
                 , F_CODE_NM('1000828', #REF_DY#) AS LEGAL_REQ_DVSN_NM
                 , (SELECT NVL(AGGR_CONCAT(ST.USR_DFN_TXT_2,''), '000') FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000859' AND  ST.CD = #DVSN_CD#) AS RCPT_USR_CNB
                 , (SELECT COUNT(ST.USR_DFN_TXT_1) FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000859' AND   ST.CD = #DVSN_CD#) AS RCPT_USR_CNT
            FROM TBBADDED001M A 
           WHERE A.AUD_YR = #AUD_YR#
             AND A.AUD_NO = #AUD_NO#
        ]]>
	</select>
	
	<select id="selectAudSendMsg" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
            SELECT F_DPT_INFO(A.MNG_DPT_CD, '1') AS MNG_DPT_NM
                 , F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-') AS AUD_YR_NO
                 , A.AUD_SBJ_NM
                 , (SELECT NVL(AGGR_CONCAT(ST.USR_DFN_TXT_1,''), '000') FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000998') AS RCPT_USR_CNB
                 , (SELECT COUNT(ST.USR_DFN_TXT_1) FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000998') AS RCPT_USR_CNT
            FROM TBBADDED001M A 
           WHERE A.AUD_YR = #AUD_YR#
             AND A.AUD_NO = #AUD_NO#
        ]]>
	</select>	
	
	<insert id="insertSendRqsDoc" parameterClass="java.util.Map">
		INSERT INTO TBBADDED111M (
                   AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,DOC_ID
                  ,SR_DOC_SNO
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,DOC_STA_CD
                  ,SND_DPT_CD
                  ,SNDR_ID
                  ,SND_DH
                  ,RCPT_DPT_CD
                  ,RCNT_ID
                  ,RCPT_DH
                  ,AUD_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH )
           (SELECT AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,DOC_ID
                  ,(
                    SELECT NVL(MAX(SR_DOC_SNO), 0) + 1
                      FROM TBBADDED111M T2
                     WHERE T2.AUD_YR = T1.AUD_YR
                       AND T2.AUD_NO = T1.AUD_NO
                       AND T2.DOC_ID = T1.DOC_ID
                   )
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,'10'
                  ,#FNL_DEAL_DPT_CD#
                  ,#FNL_USR_ID#
                  ,SYSDATE
                  ,'160100'
                  ,''
                  ,SYSDATE
                  ,AUD_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  , #FNL_USR_ID#
		          , #FNL_USR_ID#
		          , #FNL_DEAL_DPT_CD#
		          , #FNL_MNU_ID#
                  ,SYSDATE
                  ,SYSDATE 
              FROM TBBADDED103M T1
             WHERE T1.AUD_YR = #AUD_YR#
               AND T1.AUD_NO = #AUD_NO#
               AND T1.DOC_ID = #DOC_ID#
               AND T1.RPRT_CD = #RPRT_CD#
             )
	</insert>
	
	<select id="selectFrsRqsDoc" parameterClass="paramMap" resultClass="java.lang.String">
		<![CDATA[
		SELECT (    SELECT DECODE(NVL(MAX(SR_DOC_SNO), 0) + 1,'1','Y')
                      FROM TBBADDED111M T2
                     WHERE T2.AUD_YR = T1.AUD_YR
                       AND T2.AUD_NO = T1.AUD_NO
                       AND T2.DOC_ID = T1.DOC_ID
               )
              FROM TBBADDED103M T1
             WHERE T1.AUD_YR = #AUD_YR#
               AND T1.AUD_NO = #AUD_NO#
               AND T1.RPRT_CD = #RPRT_CD#
               AND T1.APV_RQS_ID = #APV_DOC_NO#
        ]]>
	</select>
	
	<insert id="insertSendFrsRqsDoc" parameterClass="java.util.Map">
		INSERT INTO TBBADDED111M (
                   AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,DOC_ID
                  ,SR_DOC_SNO
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,SND_DPT_CD
                  ,SNDR_ID
                  ,SND_DH
                  ,RCPT_DPT_CD
                  ,AUD_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH )
           (SELECT AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,DOC_ID
                  ,(
                    SELECT NVL(MAX(SR_DOC_SNO), 0) + 1
                      FROM TBBADDED111M T2
                     WHERE T2.AUD_YR = T1.AUD_YR
                       AND T2.AUD_NO = T1.AUD_NO
                       AND T2.DOC_ID = T1.DOC_ID
                   )
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,(SELECT DPT_CD FROM TBDCMACM001M WHERE USR_ID = T1.DOC_WRT_ID)
                  ,DOC_WRT_ID
                  ,SYSDATE
                  ,#RCPT_DPT_CD#
                  ,AUD_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  , #FNL_USR_ID#
		          , #FNL_USR_ID#
		          , #FNL_DEAL_DPT_CD#
		          , #FNL_MNU_ID#
                  ,SYSDATE
                  ,SYSDATE 
              FROM TBBADDED103M T1
             WHERE T1.AUD_YR = #AUD_YR#
               AND T1.AUD_NO = #AUD_NO#
               AND T1.RPRT_CD = #RPRT_CD#
               AND T1.APV_RQS_ID = #APV_DOC_NO#
             )
	</insert>	
	
	<insert id="AEPAFU001InsertTBBADDED146DByAudRprt" parameterClass="java.util.Map">
	<![CDATA[
	    INSERT INTO TBBADDED146D (
		                AUD_YR
					  , AUD_NO
					  , AUD_STEP_CD
					  , DOC_ID
					  , APVR_CD
					  , AFF_SNO
					  , DSP_RQ_SNO
					  , CNDIDAT_SRNO
					  , CNDIDT_NM
					  , CNDIDT_YMD
					  , CNDIDT_RANK_CD
					  , CNDIDT_ORG_CD
					  , CNDIDT_DPT_NM
					  , FRT_USR_ID
					  , FNL_USR_ID
					  , FNL_DEAL_DPT_CD
					  , FNL_MNU_ID
					  , FRT_REGI_DH
					  , FNL_MDF_DH )	
				( SELECT AA.AUD_YR
					  , AA.AUD_NO
					  , DECODE(#APVR_PST_CD#, '0010600', 'A1070', AA.AUD_STEP_CD)
					  , AA.DOC_ID
					  , #APVR_PST_CD#
					  , AA.AFF_SNO
					  , AA.DSP_RQ_SNO
					  , (SELECT NVL(MAX(ST.CNDIDAT_SRNO),0)+1
                               FROM TBBADDED146D ST
                              WHERE ST.AUD_YR = AA.AUD_YR
                                AND ST.AUD_NO = AA.AUD_NO
                                AND ST.AUD_STEP_CD = AA.AUD_STEP_CD
                                AND ST.DOC_ID = AA.DOC_ID
                                AND ST.APVR_CD = #APVR_PST_CD#
                                AND ST.AFF_SNO = AA.AFF_SNO
                                AND ST.DSP_RQ_SNO = AA.DSP_RQ_SNO) AS CNDIDAT_SRNO
					  , AA.CNDIDT_NM
					  , AA.CNDIDT_YMD
					  , AA.CNDIDT_RANK_CD
					  , AA.CNDIDT_ORG_CD
					  , AA.CNDIDT_DPT_NM
					  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB)
					  , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB)
					  , (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = BB.APVR_CNB)
					  , #FNL_MNU_ID#
					  , SYSDATE
					  , SYSDATE
			      FROM TBBADDED146D AA
				     , ( 
				       SELECT A.DOC_ID, B.APVR_CNB, 
                          CASE WHEN B.APVR_PST_CD IN ('0058100','0035100') THEN '0015800'
                               WHEN B.APVR_PST_CD = ('0045900') THEN '0055600'
                               WHEN B.APVR_PST_CD IN ('0057400','0035400') THEN '0013600'
                               ELSE B.APVR_PST_CD
                          END AS APVR_PST_CD
					     FROM TBBADDED103M A
						    , TBDCMACM023L B
					    WHERE B.APV_DOC_NO = #APV_DOC_NO#
					      AND A.APV_RQS_ID = B.APV_DOC_NO
					      AND B.APV_SNO = (
										  SELECT MAX(D.APV_SNO)
											FROM TBBADDED103M C
											   , TBDCMACM023L D
										   WHERE D.APV_DOC_NO = B.APV_DOC_NO
											 AND C.APV_RQS_ID = D.APV_DOC_NO
											 AND D.APV_SNO <> 1
										     AND C.RPRT_CD = #RPRT_CD#
										     AND C.DOC_ID = #DOC_ID#
										     AND D.APVR_STA_CD IN ('202','203','204')
                                             AND D.APVR_PST_CD IN ('0013600','0035400','0015800','0058100','0035100','0045900','0055600','0055700','0057400')
										  )
					      AND A.RPRT_CD = #RPRT_CD#
					      AND A.DOC_ID = #DOC_ID#
					      AND B.APVR_STA_CD IN ('202','203','204')
					      AND ROWNUM = 1
			 		    ) BB
                     , TBBADDED145M CC
			 	 WHERE AA.DOC_ID = #DOC_ID#
                   AND AA.DOC_ID = BB.DOC_ID
			   	   AND CASE WHEN AA.APVR_CD IN ('0058100','0035100') THEN '0015800'
                            WHEN AA.APVR_CD = ('0045900') THEN '0055600'
                            ELSE AA.APVR_CD
                       END = BB.APVR_PST_CD 
                   AND AA.AUD_YR = CC.AUD_YR
                   AND AA.AUD_NO = CC.AUD_NO
                   AND AA.DOC_ID = CC.DOC_ID
                   AND AA.APVR_CD = CC.APVR_CD
                   AND AA.AFF_SNO = CC.AFF_SNO
                   AND NOT EXISTS ( SELECT 1
                                          FROM TBBADDED146D ZZ
                                         WHERE ZZ.AUD_YR = AA.AUD_YR
                                           AND ZZ.AUD_NO = AA.AUD_NO
                                           AND ZZ.AUD_STEP_CD = AA.AUD_STEP_CD
                                           AND ZZ.DOC_ID = AA.DOC_ID
                                           AND ZZ.APVR_CD = #APVR_PST_CD#
                                           AND ZZ.AFF_SNO = AA.AFF_SNO
                                           AND ZZ.DSP_RQ_SNO = AA.DSP_RQ_SNO
                                           AND ZZ.CNDIDT_NM = AA.CNDIDT_NM
                                           AND ZZ.CNDIDT_YMD = AA.CNDIDT_YMD )
                   AND NOT EXISTS (
                                   SELECT 1 
                                     FROM TBBADDED147M ZZ
							 INNER JOIN TBBADDED148M YY
							 		 ON ZZ.AUD_YR 		= YY.AUD_YR
									AND ZZ.AUD_NO 		= YY.AUD_NO
									AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
									AND ZZ.DOC_ID 		= YY.DOC_ID
									AND ZZ.APVR_CD 		= YY.APVR_CD
									AND ZZ.AFF_SNO 		= YY.AFF_SNO
									AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
									AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                                        
                                    WHERE ZZ.AUD_YR = AA.AUD_YR
                                      AND ZZ.AUD_NO = AA.AUD_NO
                                      AND ZZ.DOC_ID = AA.DOC_ID
                                      AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, CC.AUD_KND_CD, '-') || '-' || CC.AFF_CD || '-' || (SELECT ST.AFF_DSP_CD FROM TBBADDED146M ST WHERE ST.AUD_YR = AA.AUD_YR AND ST.AUD_NO = AA.AUD_NO AND ST.AUD_STEP_CD = AA.AUD_STEP_CD AND ST.DOC_ID = AA.DOC_ID AND ST.APVR_CD = AA.APVR_CD AND ST.AFF_SNO = AA.AFF_SNO AND ST.DSP_RQ_SNO = AA.DSP_RQ_SNO)
                                      AND CASE WHEN ZZ.APVR_CD IN ('0058100','0035100') THEN '0015800'
                                               WHEN ZZ.APVR_CD = ('0045900') THEN '0055600'
                                               ELSE ZZ.APVR_CD
                                          END 
                                           = 
                                          CASE WHEN #APVR_PST_CD# IN ('0058100','0035100') THEN '0015800'
                                               WHEN #APVR_PST_CD# = ('0045900') THEN '0055600'
                                               ELSE #APVR_PST_CD#
                                          END
                                      AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
                                   ) )
	]]>
	</insert>
	
	
	<insert id="AEPAFU001InsertTbbadded146dPsdByAudRprt" parameterClass="java.util.Map">
	<![CDATA[
	    INSERT INTO TBBADDED146D (
		                AUD_YR
					  , AUD_NO
					  , AUD_STEP_CD
					  , DOC_ID
					  , APVR_CD
					  , AFF_SNO
					  , DSP_RQ_SNO
					  , CNDIDAT_SRNO
					  , CNDIDT_NM
					  , CNDIDT_YMD
					  , CNDIDT_RANK_CD
					  , CNDIDT_ORG_CD
					  , CNDIDT_DPT_NM
					  , FRT_USR_ID
					  , FNL_USR_ID
					  , FNL_DEAL_DPT_CD
					  , FNL_MNU_ID
					  , FRT_REGI_DH
					  , FNL_MDF_DH )	
				( 
		         SELECT AA.AUD_YR
					  , AA.AUD_NO
					  , 'A1060'
					  , AA.DOC_ID
					  , '0055700'
					  , AA.AFF_SNO
					  , AA.DSP_RQ_SNO
					  , (SELECT NVL(MAX(ST.CNDIDAT_SRNO),0)+1
                               FROM TBBADDED146D ST
                              WHERE ST.AUD_YR = AA.AUD_YR
                                AND ST.AUD_NO = AA.AUD_NO
                                AND ST.AUD_STEP_CD = AA.AUD_STEP_CD
                                AND ST.DOC_ID = AA.DOC_ID
                                AND ST.APVR_CD = '0055700'
                                AND ST.AFF_SNO = AA.AFF_SNO
                                AND ST.DSP_RQ_SNO = AA.DSP_RQ_SNO) AS CNDIDAT_SRNO
					  , AA.CNDIDT_NM
					  , AA.CNDIDT_YMD
					  , AA.CNDIDT_RANK_CD
					  , AA.CNDIDT_ORG_CD
					  , AA.CNDIDT_DPT_NM
					  , #FNL_USR_ID#
					  , #FNL_USR_ID#
					  , #FNL_DEAL_DPT_CD#
					  , #FNL_MNU_ID#
					  , SYSDATE
					  , SYSDATE
			      FROM TBBADDED146D AA
			         , TBBADDED145M CC
			 	 WHERE AA.DOC_ID = #DOC_ID# 
			   	   AND AA.APVR_CD IN ( '0055600', '0045900')
		           AND AA.AUD_YR = CC.AUD_YR
		           AND AA.AUD_NO = CC.AUD_NO
		           AND AA.DOC_ID = CC.DOC_ID
		           AND AA.APVR_CD = CC.APVR_CD
		           AND AA.AFF_SNO = CC.AFF_SNO
		           AND NOT EXISTS ( SELECT 1
                                          FROM TBBADDED146D ZZ
                                         WHERE ZZ.AUD_YR = AA.AUD_YR
                                           AND ZZ.AUD_NO = AA.AUD_NO
                                           AND ZZ.AUD_STEP_CD = AA.AUD_STEP_CD
                                           AND ZZ.DOC_ID = AA.DOC_ID
                                           AND ZZ.APVR_CD = '0055700'
                                           AND ZZ.AFF_SNO = AA.AFF_SNO
                                           AND ZZ.DSP_RQ_SNO = AA.DSP_RQ_SNO
                                           AND ZZ.CNDIDT_NM = AA.CNDIDT_NM
                                           AND ZZ.CNDIDT_YMD = AA.CNDIDT_YMD )
		           AND NOT EXISTS (
		                           SELECT 1 
		                             FROM TBBADDED147M ZZ
								 INNER JOIN TBBADDED148M YY
								 		 ON ZZ.AUD_YR 		= YY.AUD_YR
										AND ZZ.AUD_NO 		= YY.AUD_NO
										AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
										AND ZZ.DOC_ID 		= YY.DOC_ID
										AND ZZ.APVR_CD 		= YY.APVR_CD
										AND ZZ.AFF_SNO 		= YY.AFF_SNO
										AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
										AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                             
		                            WHERE ZZ.AUD_YR = AA.AUD_YR
		                              AND ZZ.AUD_NO = AA.AUD_NO
		                              AND ZZ.DOC_ID = AA.DOC_ID
		                              AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, CC.AUD_KND_CD, '-') || '-' || CC.AFF_CD || '-' || (SELECT ST.AFF_DSP_CD FROM TBBADDED146M ST WHERE ST.AUD_YR = AA.AUD_YR AND ST.AUD_NO = AA.AUD_NO AND ST.AUD_STEP_CD = AA.AUD_STEP_CD AND ST.DOC_ID = AA.DOC_ID AND ST.APVR_CD = AA.APVR_CD AND ST.AFF_SNO = AA.AFF_SNO AND ST.DSP_RQ_SNO = AA.DSP_RQ_SNO)
		                              AND ZZ.APVR_CD = '0055700'
		                              AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
		                          ) )
	]]>
	</insert>
	
	
	
	<insert id="AEPAFU001InsertTbbadded146dCmtrByAudRprt" parameterClass="java.util.Map">
	<![CDATA[
	    INSERT INTO TBBADDED146D (
		                AUD_YR
					  , AUD_NO
					  , AUD_STEP_CD
					  , DOC_ID
					  , APVR_CD
					  , AFF_SNO
					  , DSP_RQ_SNO
					  , CNDIDAT_SRNO
					  , CNDIDT_NM
					  , CNDIDT_YMD
					  , CNDIDT_RANK_CD
					  , CNDIDT_ORG_CD
					  , CNDIDT_DPT_NM
					  , FRT_USR_ID
					  , FNL_USR_ID
					  , FNL_DEAL_DPT_CD
					  , FNL_MNU_ID
					  , FRT_REGI_DH
					  , FNL_MDF_DH )	
				( 
					SELECT AA.AUD_YR
						  , AA.AUD_NO
						  , 'A1070'
						  , AA.DOC_ID
						  , #TARGET_APVR_CD#
						  , AA.AFF_SNO
						  , AA.DSP_RQ_SNO
						  , (SELECT NVL(MAX(ST.CNDIDAT_SRNO),0)+1
                               FROM TBBADDED146D ST
                              WHERE ST.AUD_YR = AA.AUD_YR
                                AND ST.AUD_NO = AA.AUD_NO
                                AND ST.AUD_STEP_CD = AA.AUD_STEP_CD
                                AND ST.DOC_ID = AA.DOC_ID
                                AND ST.APVR_CD = #TARGET_APVR_CD#
                                AND ST.AFF_SNO = AA.AFF_SNO
                                AND ST.DSP_RQ_SNO = AA.DSP_RQ_SNO) AS CNDIDAT_SRNO
						  , AA.CNDIDT_NM
						  , AA.CNDIDT_YMD
						  , AA.CNDIDT_RANK_CD
						  , AA.CNDIDT_ORG_CD
						  , AA.CNDIDT_DPT_NM
						  , #FNL_USR_ID#
						  , #FNL_USR_ID#
						  , #FNL_DEAL_DPT_CD#
						  , #FNL_MNU_ID#
						  , SYSDATE
						  , SYSDATE
				      FROM TBBADDED146D AA
				         , TBBADDED145M CC
				 	 WHERE AA.DOC_ID = #DOC_ID# 
				   	   AND AA.APVR_CD = #APVR_CD#
			           AND AA.AUD_YR = CC.AUD_YR
			           AND AA.AUD_NO = CC.AUD_NO
			           AND AA.DOC_ID = CC.DOC_ID
			           AND AA.APVR_CD = CC.APVR_CD
			           AND AA.AFF_SNO = CC.AFF_SNO
			           AND NOT EXISTS ( SELECT 1
                                          FROM TBBADDED146D ZZ
                                         WHERE ZZ.AUD_YR = AA.AUD_YR
                                           AND ZZ.AUD_NO = AA.AUD_NO
                                           AND ZZ.AUD_STEP_CD = AA.AUD_STEP_CD
                                           AND ZZ.DOC_ID = AA.DOC_ID
                                           AND ZZ.APVR_CD = #TARGET_APVR_CD#
                                           AND ZZ.AFF_SNO = AA.AFF_SNO
                                           AND ZZ.DSP_RQ_SNO = AA.DSP_RQ_SNO
                                           AND ZZ.CNDIDT_NM = AA.CNDIDT_NM
                                           AND ZZ.CNDIDT_YMD = AA.CNDIDT_YMD )
			           AND NOT EXISTS (
			                           SELECT 1 
			                             FROM TBBADDED147M ZZ
									 INNER JOIN TBBADDED148M YY
									 		 ON ZZ.AUD_YR 		= YY.AUD_YR
											AND ZZ.AUD_NO 		= YY.AUD_NO
											AND ZZ.AUD_STEP_CD 	= YY.AUD_STEP_CD
											AND ZZ.DOC_ID 		= YY.DOC_ID
											AND ZZ.APVR_CD 		= YY.APVR_CD
											AND ZZ.AFF_SNO 		= YY.AFF_SNO
											AND ZZ.DSP_RQ_SNO 	= YY.DSP_RQ_SNO
											AND ZZ.MPP_SEQ 		= YY.MPP_SEQ                             
			                            WHERE ZZ.AUD_YR = AA.AUD_YR
			                              AND ZZ.AUD_NO = AA.AUD_NO
			                              AND ZZ.DOC_ID = AA.DOC_ID
			                              AND ZZ.PRE_AFF_NO = F_MNG_KND_AUDYRNO(AA.AUD_YR, AA.AUD_NO, CC.AUD_KND_CD, '-') || '-' || CC.AFF_CD || '-' || (SELECT ST.AFF_DSP_CD FROM TBBADDED146M ST WHERE ST.AUD_YR = AA.AUD_YR AND ST.AUD_NO = AA.AUD_NO AND ST.AUD_STEP_CD = AA.AUD_STEP_CD AND ST.DOC_ID = AA.DOC_ID AND ST.APVR_CD = AA.APVR_CD AND ST.AFF_SNO = AA.AFF_SNO AND ST.DSP_RQ_SNO = AA.DSP_RQ_SNO)
			                              AND ZZ.APVR_CD = #TARGET_APVR_CD#
			                              AND YY.AFF_MPP_DVSN_CD IN ( 'D90', 'D70', 'D80', 'D99' )
			                          ) )
	    ]]>
	</insert>
	
	
	<select id="selectDptInfoByAudYrNo" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
			SELECT T.DPT_CD
     			 , T.LV
     			 , DECODE(T.DPT_CD , S.USR_DFN_TXT_1, 'Y', 'N') AS PLAN_DEPT_YN
     			 , DECODE(LV ,2 , 'Y', 'N') AS DIR_DEPT_YN
 			 FROM (
				SELECT A.DPT_CD, LEVEL LV
  				  FROM TBDCMACM002M A
  				 WHERE 1=1
    			   AND CONNECT_BY_ISLEAF = 1
 			CONNECT BY PRIOR A.HIRK_DPT_CD = A.DPT_CD
   		    START WITH A.DPT_CD =  (SELECT T1.MNG_DPT_CD 
   		                              FROM TBBADDED001M T1 
   		                             WHERE T1.AUD_YR = #AUD_YR# 
   		                               AND T1.AUD_NO = #AUD_NO# )   
   			)  T 
   			LEFT OUTER JOIN TBDCMACM013C S
                ON S.CMM_CD_DVSN_CD = '1000000'
               AND S.CD = '2'
               AND S.USR_DFN_TXT_1 = T.DPT_CD
	]]>
	</select>
	
	
	<select id="audRprtSndYn" parameterClass="paramMap" resultClass="java.lang.String">
	            SELECT CASE WHEN COUNT(AUD_YR) > 0 THEN 'Y' ELSE 'N' END
        		  FROM TBBADDED111M 
        		 WHERE AUD_YR = #AUD_YR#
        		   AND AUD_NO = #AUD_NO#
        		   AND AUD_STEP_CD = #AUD_STEP_CD#
        		   AND DOC_ID = #DOC_ID#
	</select>
	
	<!-- BEST20 부패행위 문서 조회 -->
	<select id="AEPAFU001GetRequestAuditCPApprDocInfoByCor" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,NVL(C.ACP_STEP_NM,'') AS AUD_STEP_NM
		      	,B.RPRT_NM
		      	,B.RPRT_CD
			  	,A.APV_RQS_ID
		      	,A.ACP_YR AS AUD_YR
		      	,A.CVPT_ACP_NO AS AUD_NO
		      	,A.ACP_STEP_CD AS AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
				,A.REQ_DVSN_CD
				,F_OPEN_EDIT(B.LINK_URL) AS DOC_TYPE 				
		  FROM TBCORCOR609M A
		 INNER JOIN TBCORCOR603M B
		    ON A.ACP_YR = B.ACP_YR
		   AND A.REQ_DVSN_CD = B.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD
		   AND A.DOC_ID = B.DOC_ID
		 LEFT OUTER JOIN TBCORCOR601M C
		    ON A.ACP_YR = C.ACP_YR
		   AND A.REQ_DVSN_CD = C.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = C.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = C.ACP_STEP_CD 
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
		   AND A.APV_DOC_DVSN_CD = #APV_DOC_DVSN_CD#
	     ORDER BY A.SORT_SNO
	</select>
	
	<!-- BEST20 부패행위  -->
	<select id="AEPAFU001GetRequestAuditCPApprDocInfoByParentKeyByCor" parameterClass="paramMap" resultClass="resultMap">
		SELECT  A.ACP_STEP_CD as AUD_STEP_CD
		      ,NVL(B.ACP_STEP_NM,'') as AUD_STEP_NM
		      ,A.RPRT_NM
		      ,A.RPRT_CD
		      ,A.APV_RQS_ID
		      ,A.ACP_YR as AUD_YR
		      ,A.CVPT_ACP_NO as AUD_NO
			  ,A.DOC_ID
			  ,A.APV_STA_CD
			  ,A.REQ_DVSN_CD
			  ,F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE 			  
		  FROM TBCORCOR603M A
		 LEFT OUTER JOIN TBCORCOR601M B
		   ON A.ACP_YR = B.ACP_YR
		   AND A.REQ_DVSN_CD = B.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD 
		 WHERE 1=1
		<isEqual property="APV_DOC_DVSN_CD" compareValue="10">
		   AND A.APV_RQS_ID IS NULL
		</isEqual> 
			<iterate property="docInfoList" prepend="AND (A.ACP_YR,A.REQ_DVSN_CD,A.CVPT_ACP_NO,A.ACP_STEP_CD,A.DOC_ID) IN " open="(" close=")" conjunction="," >
				(#docInfoList[].audYr#,#docInfoList[].reqDvsnCd#,#docInfoList[].audNo#,#docInfoList[].audStepCd#,#docInfoList[].docId#)
			</iterate>
	</select>
	
	<!--BEST20 부패방지 결재문서별 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByRequestAuditCPAndApvDocNoByCor" parameterClass="paramMap"	resultClass="resultMap">
		SELECT DISTINCT RPRT_CD, TEMPLATE_DOC_ID
		  FROM TBCORCOR603M
		 WHERE APV_RQS_ID = #strDocNo#
		   AND ROWNUM = 1
	</select>
	
	<!-- BEST20 부패방지 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByRequestAuditCPAndParentKeyByCor" parameterClass="paramMap"	resultClass="resultMap">
		SELECT RPRT_CD, TEMPLATE_DOC_ID
		  FROM TBCORCOR603M
		 WHERE ACP_YR = #ACP_YR#
		   AND REQ_DVSN_CD = #REQ_DVSN_CD#
		   AND CVPT_ACP_NO = #CVPT_ACP_NO#
		   AND ACP_STEP_CD = #ACP_STEP_CD#
		   AND DOC_ID = #DOC_ID#
	</select>
	
	<!-- BEST20 부패방지 보고서 docId 조회 -->
	<select id="AEPAFU001GetDocIdListByCPAndApvDocNoByCor" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,NVL(C.ACP_STEP_NM,'') AS AUD_STEP_NM
		      	,B.RPRT_NM
			  	,A.APV_RQS_ID
		      	,A.ACP_YR AS AUD_YR
		      	,A.CVPT_ACP_NO AS AUD_NO
		      	,A.ACP_STEP_CD AS AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
				,A.REQ_DVSN_CD
		  FROM TBCORCOR609M A
		 INNER JOIN TBCORCOR603M B
		    ON A.ACP_YR = B.ACP_YR
		   AND A.REQ_DVSN_CD = B.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD
		   AND A.DOC_ID = B.DOC_ID
		 LEFT OUTER JOIN TBCORCOR601M C
		    ON A.ACP_YR = C.ACP_YR
		   AND A.REQ_DVSN_CD = C.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = C.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = C.ACP_STEP_CD 
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
	</select>
	
	<!-- BEST20 청탁금지 문서 조회 -->
	<select id="AEPAFU001GetRequestAuditCPApprDocInfoByDcp" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,NVL(C.ACP_STEP_NM,'') AS AUD_STEP_NM
		      	,B.RPRT_NM
		      	,B.RPRT_CD
			  	,A.APV_RQS_ID
		      	,A.ACP_YR AS AUD_YR
		      	,A.CVPT_ACP_NO AS AUD_NO
		      	,A.ACP_STEP_CD AS AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
				,A.REQ_DVSN_CD
				,F_OPEN_EDIT(B.LINK_URL) AS DOC_TYPE 				
		  FROM TBDCPDCP609M A
		 INNER JOIN TBDCPDCP603M B
		    ON A.ACP_YR = B.ACP_YR
		   AND A.REQ_DVSN_CD = B.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD
		   AND A.DOC_ID = B.DOC_ID
		 LEFT OUTER JOIN TBDCPDCP601M C
		    ON A.ACP_YR = C.ACP_YR
		   AND A.REQ_DVSN_CD = C.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = C.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = C.ACP_STEP_CD 
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
		   AND A.APV_DOC_DVSN_CD = #APV_DOC_DVSN_CD#
	     ORDER BY A.SORT_SNO
	</select>
	
	<!-- BEST20 청탁금지  -->
	<select id="AEPAFU001GetRequestAuditCPApprDocInfoByParentKeyByDcp" parameterClass="paramMap" resultClass="resultMap">
		SELECT  A.ACP_STEP_CD as AUD_STEP_CD
		      ,NVL(B.ACP_STEP_NM,'') as AUD_STEP_NM
		      ,A.RPRT_NM
		      ,A.RPRT_CD
		      ,A.APV_RQS_ID
		      ,A.ACP_YR as AUD_YR
		      ,A.CVPT_ACP_NO as AUD_NO
			  ,A.DOC_ID
			  ,A.APV_STA_CD
			  ,A.REQ_DVSN_CD
			  ,F_OPEN_EDIT(A.LINK_URL) AS DOC_TYPE 			  
		  FROM TBDCPDCP603M A
		 LEFT OUTER JOIN TBDCPDCP601M B
		   ON A.ACP_YR = B.ACP_YR
		   AND A.REQ_DVSN_CD = B.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD 
		 WHERE 1=1
		<isEqual property="APV_DOC_DVSN_CD" compareValue="10">
		   AND A.APV_RQS_ID IS NULL
		</isEqual> 
			<iterate property="docInfoList" prepend="AND (A.ACP_YR,A.REQ_DVSN_CD,A.CVPT_ACP_NO,A.ACP_STEP_CD,A.DOC_ID) IN " open="(" close=")" conjunction="," >
				(#docInfoList[].audYr#,#docInfoList[].reqDvsnCd#,#docInfoList[].audNo#,#docInfoList[].audStepCd#,#docInfoList[].docId#)
			</iterate>
	</select>
	
	<!--BEST20 청탁금지 결재문서별 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByRequestAuditCPAndApvDocNoByDcp" parameterClass="paramMap"	resultClass="resultMap">
		SELECT DISTINCT RPRT_CD, TEMPLATE_DOC_ID
		  FROM TBDCPDCP603M
		 WHERE APV_RQS_ID = #strDocNo#
		   AND ROWNUM = 1
	</select>
	
	<!-- BEST20 청탁금지 보고서코드 조회 -->
	<select id="AEPAFU001GetRprtCdByRequestAuditCPAndParentKeyByDcp" parameterClass="paramMap"	resultClass="resultMap">
		SELECT RPRT_CD, TEMPLATE_DOC_ID
		  FROM TBDCPDCP603M
		 WHERE ACP_YR = #ACP_YR#
		   AND REQ_DVSN_CD = #REQ_DVSN_CD#
		   AND CVPT_ACP_NO = #CVPT_ACP_NO#
		   AND ACP_STEP_CD = #ACP_STEP_CD#
		   AND DOC_ID = #DOC_ID#
	</select>
	
	<!-- BEST20 청탁금지 보고서 docId 조회 -->
	<select id="AEPAFU001GetDocIdListByCPAndApvDocNoByDcp" parameterClass="paramMap" resultClass="resultMap">
		SELECT	 A.SORT_SNO
				,NVL(C.ACP_STEP_NM,'') AS AUD_STEP_NM
		      	,B.RPRT_NM
			  	,A.APV_RQS_ID
		      	,A.ACP_YR AS AUD_YR
		      	,A.CVPT_ACP_NO AS AUD_NO
		      	,A.ACP_STEP_CD AS AUD_STEP_CD
				,A.DOC_ID
				,A.APV_DVSN_CD
				,A.APV_DOC_DVSN_CD
				,A.REQ_DVSN_CD
		  FROM TBDCPDCP609M A
		 INNER JOIN TBDCPDCP603M B
		    ON A.ACP_YR = B.ACP_YR
		   AND A.REQ_DVSN_CD = B.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = B.ACP_STEP_CD
		   AND A.DOC_ID = B.DOC_ID
		 LEFT OUTER JOIN TBDCPDCP601M C
		    ON A.ACP_YR = C.ACP_YR
		   AND A.REQ_DVSN_CD = C.REQ_DVSN_CD
		   AND A.CVPT_ACP_NO = C.CVPT_ACP_NO
		   AND A.ACP_STEP_CD = C.ACP_STEP_CD 
		 WHERE A.APV_RQS_ID = #APV_DOC_NO#
	</select>
	
    <!-- 포렌식 의견서 복사 -->
    <insert id="insertFrsCopyDoc" parameterClass="java.util.Map">
    /* aep.afu.service.impl.AEPAFU001ServiceImpl.insertFrsCopyDoc */
            INSERT INTO TBBADDED103M (
                 AUD_YR
                ,AUD_NO
                ,AUD_STEP_CD
                ,DOC_ID
                ,AUD_KND_CD
                ,AUD_GRN_NO
                ,RPRT_NM
                ,LINK_URL
                ,NECES_YN
                ,APV_STA_CD
                ,RPRT_CD
                ,REF_ID
                ,SYT_TRTM_DVSN_YN
                ,AUD_DOC_KND_CD
                ,CON_PGM_CD
                ,APV_WAY_CD
                ,DOC_WRT_ID
                ,ONR_HNDL_NO
                ,FRT_USR_ID
                ,FNL_USR_ID
                ,FNL_DEAL_DPT_CD
                ,FNL_MNU_ID
                ,FRT_REGI_DH
                ,FNL_MDF_DH
                ,EDT_AUTH
                ,SECU_RPT_YN
                ,TEMPLATE_DOC_ID
                ,SORT_SNO
                ,SND_DOC_YN
                )
                (SELECT 
                 AUD_YR
                ,AUD_NO
                ,AUD_STEP_CD
                ,#NEW_DOC_ID#
                ,AUD_KND_CD
                ,AUD_GRN_NO
                ,RPRT_NM || '(협조)'
                ,REPLACE(REPLACE(LINK_URL,'edit=Y','edit=N'),'docId='||DOC_ID,'docId='||#NEW_DOC_ID#)
                ,NECES_YN
                ,'25'
                ,'A10610210'
                ,REF_ID
                ,SYT_TRTM_DVSN_YN
                ,AUD_DOC_KND_CD
                ,CON_PGM_CD
                ,APV_WAY_CD
                ,DOC_WRT_ID
                ,ONR_HNDL_NO
                ,#FNL_USR_ID#
                ,#FNL_USR_ID#
                ,#FNL_DEAL_DPT_CD#
                ,#FNL_MNU_ID#
                ,SYSDATE
                ,SYSDATE
                ,EDT_AUTH
                ,SECU_RPT_YN
                ,TEMPLATE_DOC_ID 
                ,(SELECT MAX(A.SORT_SNO)+1 FROM TBBADDED103M A WHERE A.APV_RQS_ID = #APV_DOC_NO#) 
                ,SND_DOC_YN
              FROM TBBADDED103M
             WHERE APV_RQS_ID = #APV_DOC_NO#
               AND RPRT_CD = #RPRT_CD#
             )
    </insert>
    
    <!-- 포렌식 의견서 복사 -->
    <insert id="insertFrsCopyDoc2" parameterClass="java.util.Map">
    /* aep.afu.service.impl.AEPAFU001ServiceImpl.insertFrsCopyDoc2 */
		INSERT INTO TBBADDED111M (
                   AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,DOC_ID
                  ,SR_DOC_SNO
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM
                  ,RPRT_CD
                  ,LINK_URL
                  ,SND_DPT_CD
                  ,SNDR_ID
                  ,DOC_STA_CD
                  ,SND_DH
                  ,RCPT_DPT_CD
                  ,AUD_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  ,FRT_USR_ID
                  ,FNL_USR_ID
                  ,FNL_DEAL_DPT_CD
                  ,FNL_MNU_ID
                  ,FRT_REGI_DH
                  ,FNL_MDF_DH )
           (SELECT AUD_YR
                  ,AUD_NO
                  ,AUD_STEP_CD
                  ,#NEW_DOC_ID#
                  ,(
                    SELECT NVL(MAX(SR_DOC_SNO), 0) + 1
                      FROM TBBADDED111M T2
                     WHERE T2.AUD_YR = T1.AUD_YR
                       AND T2.AUD_NO = T1.AUD_NO
                       AND T2.DOC_ID = #NEW_DOC_ID#
                   )
                  ,AUD_KND_CD
                  ,AUD_GRN_NO
                  ,RPRT_NM || '(협조)'
                  ,'A10610210'
                  ,REPLACE(REPLACE(LINK_URL,'edit=Y','edit=N'),'docId='||DOC_ID,'docId='||#NEW_DOC_ID#)
                  ,(SELECT DPT_CD FROM TBDCMACM001M WHERE USR_ID = T1.DOC_WRT_ID)
                  ,DOC_WRT_ID
                  ,'10'
                  ,SYSDATE
                  ,#RCPT_DPT_CD#
                  ,AUD_RPRT_DVSN_CD
                  ,DOC_KND_CD
                  ,REF_ID
                  ,REF_DY
                  ,SORT_SNO
                  , #FNL_USR_ID#
		          , #FNL_USR_ID#
		          , #FNL_DEAL_DPT_CD#
		          , #FNL_MNU_ID#
                  ,SYSDATE
                  ,SYSDATE 
              FROM TBBADDED103M T1
             WHERE T1.AUD_YR = #AUD_YR#
               AND T1.AUD_NO = #AUD_NO#
               AND T1.RPRT_CD = #RPRT_CD#
               AND T1.APV_RQS_ID = #APV_DOC_NO#
             )
    </insert>    
    
	<!-- 포렌식 의견서(협조) 수신 여부 -->
	<select id="selectRcptDoc" parameterClass="paramMap" resultClass="resultMap">
	/* aep.afu.service.impl.AEPAFU001ServiceImpl.selectRcptDoc */
           SELECT RCPT_DH
              FROM TBBADDED111M 
             WHERE AUD_YR = #AUD_YR#
               AND AUD_NO = #AUD_NO#
               AND RPRT_CD = 'A10610210'
               AND REF_ID = (SELECT MAX(REF_ID) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
		
	</select>
	
    <update id="updateRcptDoc" parameterClass="java.util.Map">
    /* kr.go.bai.eip.aep.frs.dao.AEPAFU001ServiceImpl.updateRcptDoc */
        <![CDATA[
        UPDATE TBBADDED111M
           SET DOC_STA_CD      = '20'
             , RCPT_DH         = SYSDATE
             , RCPT_DPT_CD     = (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = (SELECT SBM_CNB FROM TBDCMACM022L WHERE APV_DOC_NO = #APV_DOC_NO#))
             , RCNT_ID         = (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = (SELECT SBM_CNB FROM TBDCMACM022L WHERE APV_DOC_NO = #APV_DOC_NO#))
             , FNL_USR_ID      = #FNL_USR_ID#
             , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
             , FNL_MNU_ID      = #FNL_MNU_ID#
             , FNL_MDF_DH      = SYSDATE
		 WHERE AUD_YR		   = (SELECT MAX(AUD_YR) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
		   AND AUD_NO		   = (SELECT MAX(AUD_NO) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
		   AND FRS_REQ_SRNO	   = (SELECT MAX(REF_ID) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
           AND RPRT_CD         = 'A10610210'
        ]]>
    </update>	    
    
	<!-- 포렌식 협조 단계 조회 -->
	<select id="selectFrsRqsStep" parameterClass="paramMap" resultClass="java.lang.String">
	/* aep.afu.service.impl.AEPAFU001ServiceImpl.selectFrsRqsStep */
    SELECT MAX(CASE WHEN APVR_DPT_CD = '160100' AND APVR_KND_CD = '4' THEN '160100'
                    ELSE '0'
                     END) AS APVR_DPT_CD
                     FROM TBDCMACM023L
	          WHERE APV_DOC_NO = #APV_DOC_NO#
	            AND APV_SNO = (SELECT MIN(APV_SNO) FROM TBDCMACM023L
	                                              WHERE APV_DOC_NO = #APV_DOC_NO#
	                                                AND APV_DH IS NULL)
		
	</select>
	
	<!-- 포렌식 협조 법무담당관 유무 조회 -->
	<select id="selectFrsRqsYn" parameterClass="paramMap" resultClass="java.lang.String">
	/* aep.afu.service.impl.AEPAFU001ServiceImpl.selectFrsRqsStep */
	    SELECT NVL2(APVR_DPT_CD,'Y','N') AS DPT_YN FROM TBDCMACM023L 
	          WHERE APV_DOC_NO = #APV_DOC_NO#
	            AND APVR_DPT_CD = '160100'
		
	</select>		
	
	<!-- 포렌식 요청서 발신 -->
	<update id="updateFrsSendDt" parameterClass="java.util.Map">
		UPDATE /* aep.afu.service.impl.AEPAFU001ServiceImpl.updateFrsSendDt */
			   TBAEPFRS101M                       
		   SET REQ_STAT_CD         = '20'                         /* 상태변경 */
		     , REQ_OM_DH           = SYSDATE                      /* 요청서발신일자 */
		     , FNL_USR_ID          = #FNL_USR_ID#                 /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD     = #FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
		     , FNL_MNU_ID          = #FNL_MNU_ID#                 /* 최종메뉴ID */
		     , FNL_MDF_DH          = SYSDATE                      /* 최종수정일시 */
		 WHERE AUD_YR			   = (SELECT MAX(AUD_YR) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
		   AND AUD_NO			   = (SELECT MAX(AUD_NO) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
		   AND FRS_REQ_SRNO		   = (SELECT MAX(REF_ID) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
	</update>
	
	<!-- 포렌식 의견서 발신 -->
	<update id="updateFrsMfexDt" parameterClass="java.util.Map">
		UPDATE /* aep.afu.service.impl.AEPAFU001ServiceImpl.updateFrsMfexDt */
			   TBAEPFRS101M                       
		   SET REQ_STAT_CD         = '50'                         /* 상태변경 */
		     , REV_OPT_OM_DH       = SYSDATE                      /* 의견서발신일자 */
		     , REV_OPT_OM_YN       = 'Y'                          /* 의견서발신여부 */
		     , FNL_USR_ID          = #FNL_USR_ID#                 /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD     = #FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
		     , FNL_MNU_ID          = #FNL_MNU_ID#                 /* 최종메뉴ID */
		     , FNL_MDF_DH          = SYSDATE                      /* 최종수정일시 */
		 WHERE AUD_YR			   = (SELECT MAX(AUD_YR) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
		   AND AUD_NO			   = (SELECT MAX(AUD_NO) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
		   AND FRS_REQ_SRNO		   = (SELECT MAX(REF_ID) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
	</update>		
	
	<insert id="insertFrsApvDoc" parameterClass="java.util.Map">
	/* aep.afu.service.impl.AEPAFU001ServiceImpl.insertFrsApvDoc */
		INSERT INTO TBBADDED109M
		      (APV_RQS_ID,
		       AUD_YR,
		       AUD_NO,
		       AUD_STEP_CD,
		       DOC_ID,
		       APV_DVSN_CD,
		       APV_DOC_DVSN_CD,
		       SORT_SNO,
		       FRT_USR_ID,
		       FNL_USR_ID,
		       FNL_DEAL_DPT_CD,
		       FNL_MNU_ID,
		       FRT_REGI_DH,
		       FNL_MDF_DH)
		(SELECT APV_RQS_ID
		      , AUD_YR
		      , AUD_NO
		      , AUD_STEP_CD
		      , #NEW_DOC_ID#
		      , (SELECT MAX(APV_DVSN_CD) FROM TBBADDED109M WHERE APV_RQS_ID = A.APV_RQS_ID)
		      , (SELECT MAX(APV_DOC_DVSN_CD) FROM TBBADDED109M WHERE APV_RQS_ID = A.APV_RQS_ID)
		      , (SELECT MAX(SORT_SNO)+1 FROM TBBADDED109M WHERE APV_RQS_ID = A.APV_RQS_ID)
		      , #FNL_USR_ID#
		      , #FNL_USR_ID#
		      , #FNL_DEAL_DPT_CD#
		      , #FNL_MNU_ID#
		      , SYSDATE
		      , SYSDATE
		  FROM TBBADDED103M A
		 WHERE (A.AUD_YR, A.AUD_NO, A.AUD_STEP_CD, A.REF_ID) 
		       IN (SELECT AUD_YR, AUD_NO, AUD_STEP_CD, REF_ID
		             FROM TBBADDED103M
		            WHERE APV_RQS_ID = #APV_DOC_NO# )
		   AND A.RPRT_CD IN ('A10610100') )
		            
	</insert>	
	
	<!-- 포렌식 의견서 수신 -->
	<update id="updateFrsRqsEnd" parameterClass="java.util.Map">
		UPDATE /* aep.afu.service.impl.AEPAFU001ServiceImpl.updateFrsRqsEnd */
			   TBAEPFRS101M                       
		   SET REQ_STAT_CD         = '60'                         /* 상태변경 */
		     , REV_OPT_RCV_DH      = NVL2(REV_OPT_RCV_DH, REV_OPT_RCV_DH, SYSDATE)
		     , REV_OPT_RCV_YN      = 'Y'
		     , FNL_USR_ID          = #FNL_USR_ID#                 /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD     = #FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
		     , FNL_MNU_ID          = #FNL_MNU_ID#                 /* 최종메뉴ID */
		     , FNL_MDF_DH          = SYSDATE                      /* 최종수정일시 */
		 WHERE AUD_YR			   = (SELECT MAX(AUD_YR) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
		   AND AUD_NO			   = (SELECT MAX(AUD_NO) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
		   AND FRS_REQ_SRNO		   = (SELECT MAX(REF_ID) FROM TBBADDED103M WHERE APV_RQS_ID = #APV_DOC_NO#)
	</update>	
	
	<select id="selectMfexInfo" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
            SELECT F_DPT_INFO(A.MNG_DPT_CD, '1') AS MNG_DPT_NM
			     , F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-') AS AUD_YR_NO
			     , A.AUD_SBJ_NM
			     , C.MFEX_NO  /*소명자료 관리번호*/
			     , C.IMMUN_NO  /*적극행정면책관리번호*/ 
			     , (SELECT DISTINCT 'Y' 
			          FROM TBBADDED103M T1, TBDCMACM023L T2
			         WHERE T1.APV_RQS_ID = T2.APV_DOC_NO
			           AND T1.AUD_YR = A.AUD_YR
			           AND T1.AUD_NO = A.AUD_NO
			           AND T1.AUD_STEP_CD = 'A1060'
			           AND T1.RPRT_CD = 'A10600200'
			           AND T2.APVR_PST_CD = '0055700'
			           AND T2.APVR_STA_CD IN ('202','203') ) AS APV_YN /* 개별처리안 사무총장 결재 여부 */ 
			      , (SELECT T1.ADV_COMMIT_END_YN 
			           FROM TBCSPKDE109M T1 
			          WHERE T1.ADV_COMMIT_YY = (SELECT MAX(ADV_COMMIT_YY) FROM TBCSPKDE103M WHERE AUD_YR = C.AUD_YR AND AUD_NO = C.AUD_NO AND SRNO = C.SRNO)  
			            AND T1.ADV_COMMIT_SRNO = (SELECT MAX(ADV_COMMIT_SRNO) FROM TBCSPKDE103M WHERE AUD_YR = C.AUD_YR AND AUD_NO = C.AUD_NO AND SRNO = C.SRNO) ) AS ADV_YN /*자문위원회 종료 여부*/
			      , (SELECT NVL(AGGR_CONCAT(ST.USR_DFN_TXT_1,''), '000') FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000860' AND  ST.CD = '20') AS RCPT_USR_CNB
			      , (SELECT COUNT(ST.USR_DFN_TXT_1) FROM TBDCMACM013C ST WHERE ST.CMM_CD_DVSN_CD = '1000860' AND   ST.CD = '20') AS RCPT_USR_CNT
			  FROM TBBADDED001M A 
			     , TBBADDED103M B
			     , TBCSPKDE103M_VIEW C
			 WHERE A.AUD_YR = B.AUD_YR
			   AND A.AUD_NO = B.AUD_NO
			   AND B.AUD_YR = C.AUD_YR
			   AND B.AUD_NO = C.AUD_NO
			   AND B.REF_DY = (C.SRNO || C.MFEX_DVSN_CD)
			   AND A.AUD_YR = #AUD_YR#
			   AND A.AUD_NO = #AUD_NO#
			   AND B.DOC_ID = #DOC_ID#
			   AND B.RPRT_CD = #RPRT_CD#
        ]]>
	</select>
	
	
	<select id="selectAudMfexInfo" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
            SELECT MNG_DPT_CD, AUD_YR_NO, AUD_SBJ_NM, RCNT_HIS, RCNT_CNT
			     , DECODE(RPRT_CD, 'A10600960', 'A10600900', RPRT_CD) AS RPRT_CD
			     , SUM(CASE WHEN RPRT_CD = 'A10600900' AND APV_YN = 'Y' AND RCNT_CNT > 0 THEN 1
			               WHEN RPRT_CD = 'A10600960' AND APV_YN = 'Y' AND RCNT_CNT > 0 AND ADV_YN = 'Y' THEN 1
			               ELSE 0
			           END) AS MFEX_CT
			     , SUM(CASE WHEN RPRT_CD = 'A10601000' AND IMMUN_NO IS NULL AND RCNT_CNT > 0 AND APV_YN = 'Y' THEN 1
			                WHEN RPRT_CD = 'A10601000' AND IMMUN_NO IS NOT NULL AND RCNT_CNT > 0 AND APV_YN = 'Y' AND ADV_YN = 'Y' THEN 1
			           ELSE 0
			           END) AS PRCT_CT
			  FROM (
			        SELECT MAX(A.MNG_DPT_CD) AS MNG_DPT_CD
						     , F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-') AS AUD_YR_NO
						     , A.AUD_SBJ_NM
						     , C.MFEX_NO  AS MFEX_NO /*소명자료 관리번호*/
						     , C.IMMUN_NO AS IMMUN_NO /*적극행정면책관리번호*/ 
						     , MAX((SELECT DISTINCT 'Y' 
						          FROM TBBADDED103M T1, TBDCMACM023L T2
						         WHERE T1.APV_RQS_ID = T2.APV_DOC_NO
						           AND T1.AUD_YR = A.AUD_YR
						           AND T1.AUD_NO = A.AUD_NO
						           AND T1.AUD_STEP_CD = 'A1060'
						           AND T1.RPRT_CD = 'A10600200'
						           AND T1.AUD_RPRT_DVSN_CD = '10'
						           AND T2.APVR_PST_CD = '0055700'
						           AND T2.APVR_STA_CD IN ('202','203') )) AS APV_YN /* 개별처리안 사무총장 결재 여부 */ 
						      , MAX((SELECT T1.ADV_COMMIT_END_YN 
						           FROM TBCSPKDE109M T1 
						          WHERE T1.ADV_COMMIT_YY = C.ADV_COMMIT_YY
						            AND T1.ADV_COMMIT_SRNO = C.ADV_COMMIT_SRNO)) AS ADV_YN /*자문위원회 종료 여부*/
						      , MAX(CASE WHEN RPRT_CD IN ('A10600900', 'A10600960') THEN 
			                            (SELECT NVL(AGGR_CONCAT(ST.USR_DFN_TXT_1,''), '') 
			                               FROM TBDCMACM013C ST 
			                              WHERE ST.CMM_CD_DVSN_CD = '1000860' 
			                              AND  ST.CD = '20'
			                              AND EXISTS (SELECT 1
			                                            FROM TBBADDED103M INC
			                                               , TBBADDED111M IND
			                                           WHERE INC.AUD_YR = B.AUD_YR
			                                             AND INC.AUD_NO = B.AUD_NO
			                                             AND INC.DOC_ID = B.DOC_ID
			                                             AND INC.AUD_YR = IND.AUD_YR
			                                             AND INC.AUD_NO = IND.AUD_NO
			                                             AND IND.RCPT_DPT_CD ='180130'
			                                             AND INC.RPRT_CD IN ('A10600900', 'A10600960')) )
			                        WHEN RPRT_CD = 'A10601000' THEN
			                            (SELECT AGGR_CONCAT(APVR_CNB, '')
			                               FROM TBBADDED103M INA 
			                                  , TBDCMACM023L INB
			                             WHERE INA.APV_RQS_ID = INB.APV_DOC_NO
			                               AND INA.AUD_YR = B.AUD_YR
			                               AND INA.AUD_NO = B.AUD_NO
			                               AND INA.AUD_STEP_CD = 'A1060'
			                               AND INA.RPRT_CD = 'A10600200'
			                               AND INA.AUD_RPRT_DVSN_CD = '10'
			                               AND INB.APVR_STA_CD IN ('202', '203')
			                               AND INB.APVR_PST_CD IN ('0013600', '0015800', '0055600', '0045900')
			                               AND EXISTS (SELECT 1
			                                             FROM TBBADDED103M INC
			                                                , TBBADDED111M IND
			                                            WHERE INC.AUD_YR = B.AUD_YR
			                                              AND INC.AUD_NO = B.AUD_NO
			                                              AND INC.DOC_ID = B.DOC_ID
			                                              AND INC.AUD_YR = IND.AUD_YR
			                                              AND INC.AUD_NO = IND.AUD_NO
			                                              AND IND.RCPT_DPT_CD ='180130'
			                                              AND INC.RPRT_CD = 'A10601000'))
			                          ELSE ''
			                    END) AS RCNT_HIS
					      , MAX(CASE WHEN RPRT_CD IN ('A10600900', 'A10600960') THEN 
			                            (SELECT COUNT(ST.USR_DFN_TXT_1) 
			                              FROM TBDCMACM013C ST 
			                             WHERE ST.CMM_CD_DVSN_CD = '1000860' 
			                               AND  ST.CD = '20'
			                               AND EXISTS (SELECT 1
			                                             FROM TBBADDED103M INC
			                                                , TBBADDED111M IND
			                                            WHERE INC.AUD_YR = B.AUD_YR
			                                              AND INC.AUD_NO = B.AUD_NO
			                                              AND INC.DOC_ID = B.DOC_ID
			                                              AND INC.AUD_YR = IND.AUD_YR
			                                              AND INC.AUD_NO = IND.AUD_NO
			                                              AND IND.RCPT_DPT_CD ='180130'
			                                              AND INC.RPRT_CD IN ('A10600900', 'A10600960')) )
			                        WHEN RPRT_CD = 'A10601000' THEN
			                            (SELECT COUNT(*)
			                               FROM TBBADDED103M INA 
			                                  , TBDCMACM023L INB
			                             WHERE INA.APV_RQS_ID = INB.APV_DOC_NO
			                               AND INA.AUD_YR = B.AUD_YR
			                               AND INA.AUD_NO = B.AUD_NO
			                               AND INA.AUD_STEP_CD = 'A1060'
			                               AND INA.RPRT_CD = 'A10600200'
			                               AND INA.AUD_RPRT_DVSN_CD = '10'
			                               AND INB.APVR_STA_CD IN ('202', '203')
			                               AND INB.APVR_PST_CD IN ('0013600', '0015800', '0055600', '0045900')
			                               AND EXISTS (SELECT 1
			                                            FROM TBBADDED103M INC
			                                               , TBBADDED111M IND
			                                           WHERE INC.AUD_YR = B.AUD_YR
			                                             AND INC.AUD_NO = B.AUD_NO
			                                             AND INC.DOC_ID = B.DOC_ID
			                                             AND INC.AUD_YR = IND.AUD_YR
			                                             AND INC.AUD_NO = IND.AUD_NO
			                                             AND IND.RCPT_DPT_CD = '180130'
			                                             AND INC.RPRT_CD = 'A10601000'))
			                          ELSE 0
			                    END) AS RCNT_CNT
						      , B.RPRT_CD
			                  
						  FROM TBBADDED001M A 
						     , TBBADDED103M B
						     , TBCSPKDE103M_VIEW C
						 WHERE A.AUD_YR = B.AUD_YR
						   AND A.AUD_NO = B.AUD_NO
						   AND B.AUD_YR = C.AUD_YR
						   AND B.AUD_NO = C.AUD_NO
			               AND (B.REF_DY = C.SRNO||C.MFEX_DVSN_CD OR B.REF_ID = C.SRNO)
						   AND A.AUD_YR = #AUD_YR#
						   AND A.AUD_NO = #AUD_NO#
						   AND B.RPRT_CD IN ('A10601000', 'A10600900','A10600960')
				         GROUP BY F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-')
				                , A.AUD_SBJ_NM
			                    , C.MFEX_NO
			                    , C.IMMUN_NO
			                    , B.RPRT_CD)
			  GROUP BY MNG_DPT_CD, AUD_YR_NO, AUD_SBJ_NM, RCNT_HIS, RCNT_CNT
			         , DECODE(RPRT_CD, 'A10600960', 'A10600900', RPRT_CD) 
        ]]>
	</select>
	
</sqlMap>