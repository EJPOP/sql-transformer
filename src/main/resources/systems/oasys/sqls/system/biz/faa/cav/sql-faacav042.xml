<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/cav/042"> 
	 
	<parameterMap id="prcAmCCountParm" class="java.util.HashMap">
		<parameter property="i_acnt_year"		jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="vRetCode"	jdbcType="VARCHAR"	javaType="java.lang.String" mode="OUT" />
		<parameter property="vUserMessage"	jdbcType="VARCHAR"	javaType="java.lang.String" mode="OUT" />		
	</parameterMap>
		
	<!-- 기금수입결산-->
	<procedure id="FAACAV042EMainCreate1" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/042/FAACAV042EMainCreate1 */ ]]>
		{ CALL BTJ_AA_AV_009_21(?, ?, ?) }
	</procedure>
	
	<!-- 기금지출결산-->		
	<procedure id="FAACAV042EMainCreate2" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/042/FAACAV042EMainCreate2 */ ]]>
		{ CALL BTJ_AA_AV_009_22(?, ?, ?) }
	</procedure>
	
	<!-- 지출결산-->	
	<procedure id="FAACAV042EMainCreate3" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/042/FAACAV042EMainCreate3 */ ]]>
		{ CALL BTJ_AA_AV_009_17(?, ?, ?) }
	</procedure>
	
	<!-- 세입결산-->	
	<procedure id="FAACAV042EMainCreate4" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/042/FAACAV042EMainCreate4 */ ]]>
		{ CALL BTJ_AA_AV_009_12(?, ?, ?) }
	</procedure>
	
	<select id="FAACAV042EMainselect1" parameterClass="paramMap" 	resultClass="resultMap">
		<![CDATA[  /* faa/cav/042/FAACAV042EMainselect1 */ ]]>
		<include refid="include.pageSelct" />	
	 <![CDATA[
	 SELECT
        F_AV_BLL_COPT_CD_NM(A.COPT_CD) COPT_CD_NM,F_AV_ACNT_CD_NM(A.ACNT_CD) ACNT_CD_NM , 
        F_AV_ACCMN_NM(A.COPT_CD,A.ACNT_CD,A.BLL_CD, A.PROF_DRTR_SRNO, A.DL_XPN_RCDB_PBSVT_SRNO) ORG_NM,
        A.MDF_PEN_NM||'('||TNB||')' MDF_PEN_NM,A.COPT_CD||'-'||A.ACNT_CD||'-'||A.BLL_CD||'-'||A.PROF_DRTR_SRNO||'-'|| A.DL_XPN_RCDB_PBSVT_SRNO AS PROF_DRTR_CD,
        CASE WHEN A.CRE_DT = '999999' THEN '' ELSE SUBSTRING(A.CRE_DT,0,4)||'.'||SUBSTRING(A.CRE_DT,5,2) END AS CRE_DT,
        CASE WHEN A.ABLT_DT = '999999' THEN '' ELSE SUBSTRING(A.ABLT_DT,0,4)||'.'||SUBSTRING(A.ABLT_DT,5,2) END AS ABLT_DT,
        A.COPT_CD,A.ACNT_CD,A.BLL_CD, A.PROF_DRTR_SRNO, A.DL_XPN_RCDB_PBSVT_SRNO
    FROM    TWFAACAV003M A
    WHERE    BLL_CD = '21'
      AND    ABLT_DT >= #strYr#||'0000' 
      AND    CRE_DT  <= #strYr#||'9999'
      AND	 A.MDF_DVSN_CD != 'D'
      AND NOT EXISTS(
         SELECT  1   
         FROM    TWFAACAV026L B
        WHERE    B.COPT_CD = A.COPT_CD
          AND    B.ACNT_CD = A.ACNT_CD
          AND    B.BLL_CD =  A.BLL_CD
          AND    B.PROF_DRTR_SRNO  = A.PROF_DRTR_SRNO
          AND    B.DL_XPN_RCDB_PBSVT_SRNO = A.DL_XPN_RCDB_PBSVT_SRNO
          AND    B.PROF_YM = ( CASE WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '04') THEN #strYr#||'01'
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '07') THEN #strYr#||'02'
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '10') THEN #strYr#||'03'
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) >= '10') THEN #strYr#||'04'
                                    ELSE #strYr#||'04' END))
	 ]]>
			<include refid="include.pageOrder" />	 
			ORDER BY  COPT_CD, ACNT_CD, BLL_CD, PROF_DRTR_SRNO, DL_XPN_RCDB_PBSVT_SRNO 
	</select>
	<select id="FAACAV042EMainselect2" parameterClass="paramMap" 	resultClass="resultMap">
		<![CDATA[  /* faa/cav/042/FAACAV042EMainselect2 */ ]]>
		<include refid="include.pageSelct" />	
	 <![CDATA[  
    SELECT
        F_AV_BLL_COPT_CD_NM(A.COPT_CD) COPT_CD_NM,F_AV_ACNT_CD_NM(A.ACNT_CD) ACNT_CD_NM , 
        F_AV_ACCMN_NM(A.COPT_CD,A.ACNT_CD,A.BLL_CD, A.PROF_DRTR_SRNO, A.DL_XPN_RCDB_PBSVT_SRNO) ORG_NM,
        A.MDF_PEN_NM||'('||TNB||')' MDF_PEN_NM,A.COPT_CD||'-'||A.ACNT_CD||'-'||A.BLL_CD||'-'||A.PROF_DRTR_SRNO||'-'|| A.DL_XPN_RCDB_PBSVT_SRNO AS PROF_DRTR_CD,
        CASE WHEN A.CRE_DT = '999999' THEN '' ELSE SUBSTRING(A.CRE_DT,0,4)||'.'||SUBSTRING(A.CRE_DT,5,2) END AS CRE_DT,
        CASE WHEN A.ABLT_DT = '999999' THEN '' ELSE SUBSTRING(A.ABLT_DT,0,4)||'.'||SUBSTRING(A.ABLT_DT,5,2) END AS ABLT_DT,
        A.COPT_CD,A.ACNT_CD,A.BLL_CD, A.PROF_DRTR_SRNO, A.DL_XPN_RCDB_PBSVT_SRNO
    FROM    TWFAACAV003M A
    WHERE   BLL_CD IN('22','23','24')
      AND   DL_XPN_RCDB_PBSVT_SRNO = '000'
      AND   ABLT_DT >= #strYr#||'00' 
      AND   CRE_DT  <= #strYr#||'99'
      AND	A.MDF_DVSN_CD != 'D'
      AND NOT EXISTS(
         SELECT  1   
         FROM    TWFAACAV027L B 
        WHERE    B.COPT_CD = A.COPT_CD
          AND    B.ACNT_CD = A.ACNT_CD
          AND    B.BLL_CD =  A.BLL_CD
          AND    B.PROF_DRTR_SRNO  = A.PROF_DRTR_SRNO
          AND    B.DL_XPN_RCDB_PBSVT_SRNO = A.DL_XPN_RCDB_PBSVT_SRNO
          AND    B.PROF_YM = ( CASE WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '04') THEN #strYr#||'01'
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '07') THEN #strYr#||'02'
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '10') THEN #strYr#||'03'
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) >= '10') THEN #strYr#||'04'
                                    ELSE #strYr#||'04' END))
	 ]]>
			<include refid="include.pageOrder" />	 
			ORDER BY  COPT_CD, ACNT_CD, BLL_CD, PROF_DRTR_SRNO, DL_XPN_RCDB_PBSVT_SRNO 
	</select>
	
	
	<select id="FAACAV042EMainselect3" parameterClass="paramMap" 	resultClass="resultMap">
		<![CDATA[  /* faa/cav/042/FAACAV042EMainselect3 */ ]]>
		<include refid="include.pageSelct" />	
	 <![CDATA[  
    SELECT
        F_AV_BLL_COPT_CD_NM(A.COPT_CD) COPT_CD_NM,F_AV_ACNT_CD_NM(A.ACNT_CD) ACNT_CD_NM , 
        F_AV_ACCMN_NM(A.COPT_CD,A.ACNT_CD,A.BLL_CD, A.PROF_DRTR_SRNO, A.DL_XPN_RCDB_PBSVT_SRNO) ORG_NM,
        A.MDF_PEN_NM||'('||TNB||')' MDF_PEN_NM,A.COPT_CD||'-'||A.ACNT_CD||'-'||A.BLL_CD||'-'||A.PROF_DRTR_SRNO||'-'|| A.DL_XPN_RCDB_PBSVT_SRNO AS PROF_DRTR_CD,
        CASE WHEN A.CRE_DT = '999999' THEN '' ELSE SUBSTRING(A.CRE_DT,0,4)||'.'||SUBSTRING(A.CRE_DT,5,2) END AS CRE_DT,
        CASE WHEN A.ABLT_DT = '999999' THEN '' ELSE SUBSTRING(A.ABLT_DT,0,4)||'.'||SUBSTRING(A.ABLT_DT,5,2) END AS ABLT_DT,
        A.COPT_CD,A.ACNT_CD,A.BLL_CD, A.PROF_DRTR_SRNO, A.DL_XPN_RCDB_PBSVT_SRNO
    FROM    TWFAACAV003M A
    WHERE    BLL_CD IN('17','18','26','27')
      AND    ABLT_DT >= #strYr#||'00' 
      AND    CRE_DT  <= #strYr#||'99'
      AND    DL_XPN_RCDB_PBSVT_SRNO = '000'
      AND	 A.MDF_DVSN_CD != 'D'
      AND NOT EXISTS(
         SELECT  1   
         FROM    TWFAACAV048L B 
        WHERE    B.COPT_CD = A.COPT_CD
          AND    B.ACNT_CD = A.ACNT_CD
          AND    B.BLL_CD =  A.BLL_CD
          AND    B.PROF_DRTR_SRNO  = A.PROF_DRTR_SRNO
          AND    B.DL_XPN_RCDB_PBSVT_SRNO = A.DL_XPN_RCDB_PBSVT_SRNO
          AND    B.PROF_YM = ( CASE WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '12') THEN #strYr#||SUBSTR(A.ABLT_DT,5,2)
                                    ELSE #strYr#||'13' END)) 
       AND NOT EXISTS(
         SELECT  1   
         FROM    TWFAACAV049L C 
        WHERE    C.COPT_CD = A.COPT_CD
          AND    C.ACNT_CD = A.ACNT_CD
          AND    C.BLL_CD =  A.BLL_CD
          AND    C.PROF_DRTR_SRNO  = A.PROF_DRTR_SRNO
          AND    C.DL_XPN_RCDB_PBSVT_SRNO = A.DL_XPN_RCDB_PBSVT_SRNO
          AND    C.PROF_YM = ( CASE WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '12') THEN #strYr#||SUBSTR(A.ABLT_DT,5,2)
                                    ELSE #strYr#||'13' END)) 
	 ]]>
			<include refid="include.pageOrder" />	 
			ORDER BY  COPT_CD, ACNT_CD, BLL_CD, PROF_DRTR_SRNO, DL_XPN_RCDB_PBSVT_SRNO	 
	</select>
	
	
	<select id="FAACAV042EMainselect4" parameterClass="paramMap" 	resultClass="resultMap">
		<![CDATA[  /* faa/cav/042/FAACAV042EMainselect4 */ ]]>
		<include refid="include.pageSelct" />	
	 <![CDATA[  
    SELECT
        F_AV_BLL_COPT_CD_NM(A.COPT_CD) COPT_CD_NM,F_AV_ACNT_CD_NM(A.ACNT_CD) ACNT_CD_NM , 
        F_AV_ACCMN_NM(A.COPT_CD,A.ACNT_CD,A.BLL_CD, A.PROF_DRTR_SRNO, A.DL_XPN_RCDB_PBSVT_SRNO) ORG_NM,
        A.MDF_PEN_NM||'('||TNB||')' MDF_PEN_NM,A.COPT_CD||'-'||A.ACNT_CD||'-'||A.BLL_CD||'-'||A.PROF_DRTR_SRNO||'-'|| A.DL_XPN_RCDB_PBSVT_SRNO AS PROF_DRTR_CD,
        CASE WHEN A.CRE_DT = '999999' THEN '' ELSE SUBSTRING(A.CRE_DT,0,4)||'.'||SUBSTRING(A.CRE_DT,5,2) END AS CRE_DT,
        CASE WHEN A.ABLT_DT = '999999' THEN '' ELSE SUBSTRING(A.ABLT_DT,0,4)||'.'||SUBSTRING(A.ABLT_DT,5,2) END AS ABLT_DT,
        A.COPT_CD,A.ACNT_CD,A.BLL_CD, A.PROF_DRTR_SRNO, A.DL_XPN_RCDB_PBSVT_SRNO
    FROM    TWFAACAV003M A
    WHERE    A.BLL_CD IN('11','12')
      AND    A.ABLT_DT >= #strYr#||'00' 
      AND    A.CRE_DT  <= #strYr#||'99'
      AND	 A.MDF_DVSN_CD != 'D'
      AND NOT EXISTS(
         SELECT  1   
         FROM    TWFAACAV053L B 
        WHERE    B.COPT_CD = A.COPT_CD
          AND    B.ACNT_CD = A.ACNT_CD
          AND    B.BLL_CD =  A.BLL_CD
          AND    B.PROF_DRTR_SRNO  = A.PROF_DRTR_SRNO
          AND    B.DL_XPN_RCDB_PBSVT_SRNO = A.DL_XPN_RCDB_PBSVT_SRNO
          AND    B.PROF_YM = ( CASE WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '04') THEN #strYr#||'01' 
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '07') THEN #strYr#||'02'
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '10') THEN #strYr#||'03'
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) >= '10') THEN #strYr#||'04'
                                    ELSE #strYr#||'04' END))
       AND NOT EXISTS(
         SELECT  1   
         FROM    TWFAACAV055L C 
        WHERE    C.COPT_CD = A.COPT_CD
          AND    C.ACNT_CD = A.ACNT_CD
          AND    C.BLL_CD =  A.BLL_CD
          AND    C.PROF_DRTR_SRNO  = A.PROF_DRTR_SRNO
          AND    C.DL_XPN_RCDB_PBSVT_SRNO = A.DL_XPN_RCDB_PBSVT_SRNO
          AND    C.PROF_YM = ( CASE WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '04') THEN #strYr#||'01' 
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '07') THEN #strYr#||'02'
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) < '10') THEN #strYr#||'03'
                                    WHEN (SUBSTR(A.ABLT_DT,1,4) <= #strYr# AND SUBSTR(A.ABLT_DT,5,2) >= '10') THEN #strYr#||'04'
                                    ELSE #strYr#||'04' END)) 
	 ]]>
			<include refid="include.pageOrder" />	 
			ORDER BY  COPT_CD, ACNT_CD, BLL_CD, PROF_DRTR_SRNO, DL_XPN_RCDB_PBSVT_SRNO	 
	</select>
	

</sqlMap> 
