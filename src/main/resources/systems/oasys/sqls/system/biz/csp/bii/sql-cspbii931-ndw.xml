<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="csp/bii/931-ndw">
	<!-- 온나라자료 목록 조회-->
	<select id="CSPBII931QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		SELECT A.*
		  FROM (SELECT T.* 
		             , ROW_NUMBER() OVER(ORDER BY PJTDEPTID) AS NUM 
		          FROM (SELECT DT.*
		                     , COUNT(1) OVER() AS TOT_CNT
		                  FROM (SELECT B.ORGNAME
		                             , A.PJTDEPTNAME
		                             , A.PJTNAME
		                             , A.PJTTYPE
		                             , B.DOCTITLE
		                             , SUBSTR(B.SENDDT, 1, 8) AS SENDDT
			                         , B.DOCNO
			                         , SUBSTR(B.REGDT, 1, 8)  AS REGDT
			                         , AUTHORDEPTDISPNAME
			                         , B.AUTHORDEPTNAME
			                         , B.AUTHORDEPTID
			                         , B.AUTHORNAME
			                         , B.APPROVAL_USERNAME
			                         , B.OPENCDNAME
			                         , B.PAPERFLAG
			                         , B.ENFGUBUN
			                         , B.OPENLISTFLAG			     
			                         , B.SENDNAME
			                         , B.DOCTYPE
			                         , B.APPRDOCNUMBER
			                         , B.DOCRMPPERIOD
			                         , B.SENDRECVID
			                         , B.SENDRECVNAME
			                         , B.PJTCARDID
			                         , B.BIZCARDNAME
			                         , B.STATUS
			                         , A.PJTID
		                             , A.PJTDEPTID
		                             , B.DOCID
		                          FROM AM_ONNARA_PJT A
		                             , AM_ONNARA_DOC B
		                         WHERE A.PJTID     = B.PJTID			
		                           AND A.PJTDEPTID = B.PJTDEPTID			

		                        <!-- 기관코드 -->
		                        <isNotEmpty property="strGccOrgCd">
		                        	AND B.ORGID = #strGccOrgCd#
		                        </isNotEmpty>
		
		                        <!-- 부서코드 -->
		                        <isNotEmpty property="strGccDeptCd">
			                        AND A.PJTDEPTID = #strGccDeptCd#
		                        </isNotEmpty>
		
		                        <!-- 과제명 -->
		                        <isNotEmpty property="strPjtName">
		                        	AND A.PJTNAME LIKE #strPjtName# || '%'
		                        </isNotEmpty>
		
		                        <!-- 추진실적제목 -->
		                        <isNotEmpty property="strDocTitle">
		                        	AND B.DOCTITLE LIKE #strDocTitle# || '%'
		                        </isNotEmpty>
		                       ) DT
		          	   ) T
		       ) A
		 WHERE NUM BETWEEN (((convert(numeric, #currPage#)- 1) * convert(numeric, #pageSize#)) + 1) AND (convert(numeric, #currPage#) * convert(numeric, #pageSize#))
	</select>
</sqlMap>