<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/gsu/001">
 
 	<select id="CSPGSU001EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.PRPS_ACP_NO		/*접수번호*/
					,A.PRPS_TIT_NM		/*제안제목*/
					,A.PRPS_PEN_NAM		/*제안자명*/
					,A.PRPS_PEN_CNB		/*제안자전산번호*/
					,A.ACP_DT			/*접수일자*/
					,A.PRPS_STA_CD		/*제안상태코드*/
					,A.PRPS_YE			/*제안연도*/
					,A.PRPS_SLN			/*제안연번*/
					,A.ORDER_NO
					,A.EXAM_DT
					,A.EXAM_DPT_NM
			FROM	( 
						SELECT	DECODE(A.PRPS_ACP_NO,NULL,'',A.PRPS_YE||'-'||A.PRPS_ACP_NO) AS PRPS_ACP_NO	/*접수번호*/
								,A.PRPS_TIT_NM		/*제안제목*/
								,F_USR_INFO(A.PRPS_PEN_CNB,'2') AS PRPS_PEN_NAM	/*제안자명*/
								,A.PRPS_PEN_CNB		/*제안자전산번호*/
								,A.ACP_DT			/*접수일자*/
								,A.PRPS_STA_CD		/*제안상태코드*/
								,A.PRPS_YE			/*제안연도*/
								,A.PRPS_SLN			/*제안연번*/
								,'1' ORDER_NO
								,A.PRPS_ACP_NO AS ACP_NO
								,A.EXAM_DT
								,F_DPT_INFO(A.EXAM_DPT_CD,'1') AS EXAM_DPT_NM
						FROM	TBCSPGSU001M A		/*도서자료기본*/
						WHERE	1=1
						AND		PRPS_PEN_CNB = #strCNB#
					]]>
					<dynamic>
						<isNotEmpty property="strPRPS_STA_CD">
							AND	A.PRPS_STA_CD = #strPRPS_STA_CD#
						</isNotEmpty>
						<isNotEmpty property="strACP_DTS">
							AND	A.ACP_DT &gt;= #strACP_DTS#
						</isNotEmpty>
						<isNotEmpty property="strACP_DTE">
							AND	A.ACP_DT &lt;= #strACP_DTE#
						</isNotEmpty>
						<isNotEmpty property="strPRPS_TIT_NM">
							AND	A.PRPS_TIT_NM LIKE '%'||#strPRPS_TIT_NM#||'%'
						</isNotEmpty>
					</dynamic> 
					<![CDATA[
						UNION
						SELECT	DECODE(A.PRPS_ACP_NO,NULL,'',A.PRPS_YE||'-'||A.PRPS_ACP_NO) AS PRPS_ACP_NO	/*접수번호*/
								,A.PRPS_TIT_NM		/*제안제목*/
								,SUBSTR(F_USR_INFO(A.PRPS_PEN_CNB,'2'),1,1)||'OO' AS PRPS_PEN_NAM	/*제안자명*/
								,A.PRPS_PEN_CNB		/*제안자전산번호*/
								,A.ACP_DT			/*접수일자*/
								,A.PRPS_STA_CD		/*제안상태코드*/
								,A.PRPS_YE			/*제안연도*/
								,A.PRPS_SLN			/*제안연번*/
								,'2' ORDER_NO
								,A.PRPS_ACP_NO AS ACP_NO
								,A.EXAM_DT
								,F_DPT_INFO(A.EXAM_DPT_CD,'1') AS EXAM_DPT_NM
						FROM	TBCSPGSU001M A		/*도서자료기본*/
						WHERE	1=1
						AND		A.PRPS_PEN_CNB <> #strCNB#
						AND		A.PRPS_STA_CD IN ('N','M')
						AND		#strSEARCH_CD# IS NULL
					]]>
					<dynamic>
						<isNotEmpty property="strPRPS_STA_CD">
							AND	A.PRPS_STA_CD = #strPRPS_STA_CD#
						</isNotEmpty>
						<isNotEmpty property="strACP_DTS">
							AND	A.ACP_DT &gt;= #strACP_DTS#
						</isNotEmpty>
						<isNotEmpty property="strACP_DTE">
							AND	A.ACP_DT &lt;= #strACP_DTE#
						</isNotEmpty>
						<isNotEmpty property="strPRPS_TIT_NM">
							AND	A.PRPS_TIT_NM LIKE '%'||#strPRPS_TIT_NM#||'%'
						</isNotEmpty>
					</dynamic> 
		<![CDATA[
					) A
			ORDER BY A.ORDER_NO ASC, TO_NUMBER(A.PRPS_YE) DESC, 
					DECODE(A.ORDER_NO,'1',TO_NUMBER(A.PRPS_SLN),TO_NUMBER(A.ACP_NO)) DESC
		]]>
	</select>
	<select id="CSPGSU001ECheckSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	PRPS_STA_CD	/*진행상태*/
			FROM	TBCSPGSU001M
			WHERE	PRPS_YE = #PRPS_YE#
			AND		PRPS_SLN = #PRPS_SLN#
		]]>
	</select>
	<update id="CSPGSU001ESubmitUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPGSU001M
			SET		SMT_DT = TO_CHAR(SYSDATE,'YYYYMMDD')	/*제출일자*/
					,PRPS_STA_CD = 'B'		/*진행상태*/
					,FNL_USR_ID = #FNL_USR_ID#	/*최종사용자ID*/
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#	/*최종부서*/
					,FNL_MNU_ID = #FNL_MNU_ID#		/*최종메뉴*/
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/
			WHERE	PRPS_YE = #PRPS_YE#
			AND		PRPS_SLN = #PRPS_SLN#
		]]>
	</update>
	
	<update id="CSPGSU001ESubmitCancleUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPGSU001M
			SET		SMT_DT = ''				/*제출일자*/
					,PRPS_STA_CD = 'A'		/*진행상태*/
					,FNL_USR_ID = #FNL_USR_ID#	/*최종사용자ID*/
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#	/*최종부서*/
					,FNL_MNU_ID = #FNL_MNU_ID#		/*최종메뉴*/
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/
			WHERE	PRPS_YE = #PRPS_YE#
			AND		PRPS_SLN = #PRPS_SLN#
		]]>
	</update>
	<select id="CSPGSU001EKeySelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT 	TO_CHAR(NVL(MAX(TO_NUMBER(PRPS_SLN))+1,1)) AS PRPS_SLN
			FROM	TBCSPGSU001M
			WHERE	PRPS_YE = #PRPS_YE#
		]]>
	</select>
	
	<select id="CSPGSU001ERvwKeySelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT 	TO_CHAR(NVL(MAX(TO_NUMBER(PRPS_SLN))+1,1)) AS RVW_PRPS_SLN
			FROM	TBCSPGSU001M
			WHERE	PRPS_YE = #RVW_PRPS_YE#
		]]>
	</select>
	
	<insert id="CSPGSU003EMainInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPGSU001M
					(
						PRPS_YE				/*제안연도*/
						,PRPS_SLN			/*제안연번*/
						,PRPS_PEN_CNB		/*제안자전산번호*/
						,PRPS_TIT_NM		/*제안제목명*/
						,CUR_SYE_TXT		/*현행제도내용*/
						,PRB_TXT			/*문제점내용*/
						,IMP_ATV_TXT		/*개선대안내용*/
						,IMP_EFCT_TXT		/*개선효과내용*/
						,PRPS_STA_CD		/*제안상태코드*/
						,FRT_USR_ID			/*최초사용자ID*/
						,FNL_USR_ID			/*최종사용자ID*/
						,FNL_DEAL_DPT_CD	/*최종거래부서코드*/
						,FNL_MNU_ID			/*최종메뉴ID*/
						,FRT_REGI_DH		/*최초등록일시*/
						,FNL_MDF_DH			/*최종수정일시*/
						,PRPS_DPT_CD
					)
				VALUES	(
							#PRPS_YE#			/*제안연도*/
							,#PRPS_SLN#			/*제안연번*/
							,#PRPS_PEN_CNB#		/*제안자전산번호*/
							,#PRPS_TIT_NM#		/*제안제목명*/
							,#CUR_SYE_TXT#		/*현행제도내용*/
							,#PRB_TXT#			/*문제점내용*/
							,#IMP_ATV_TXT#		/*개선대안내용*/
							,#IMP_EFCT_TXT#		/*개선효과내용*/
							,'A'				/*제안상태코드*/
							,#FRT_USR_ID#		/*최초사용자ID*/
							,#FNL_USR_ID#		/*최종사용자ID*/
							,#FNL_DEAL_DPT_CD#	/*최종거래부서코드*/
							,#FNL_MNU_ID#		/*최종메뉴ID*/
							,SYSDATE			/*최초등록일시*/
							,SYSDATE			/*최종수정일시*/
							,#PRPS_DPT_CD#
						)
		]]>
	</insert>
	<insert id="CSPGSU003ETBCSPGSU002LInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPGSU002L
					(
						PRPS_YE				/*제안연도*/
						,PRPS_SLN			/*제안연번*/
						,PRPS_PEN_CNB		/*제안자전산번호*/
						,CTB_RTE			/*기여율*/
						,SNO				/*순번*/
						,FRT_USR_ID			/*최초사용자ID*/
						,FNL_USR_ID			/*최종사용자ID*/
						,FNL_DEAL_DPT_CD	/*최종거래부서코드*/
						,FNL_MNU_ID			/*최종메뉴ID*/
						,FRT_REGI_DH		/*최초등록일시*/
						,FNL_MDF_DH			/*최종수정일시*/
					)
				VALUES	(
							#PRPS_YE#			/*제안연도*/
							,#PRPS_SLN#			/*제안연번*/
							,#PRPS_PEN_CNB#		/*제안자전산번호*/
							,#CTB_RTE#				/*기여율*/
							,(SELECT NVL(MAX(SNO)+1,1) FROM TBCSPGSU002L WHERE PRPS_YE = #PRPS_YE# AND PRPS_SLN = #PRPS_SLN#)
							,DECODE(#FRT_USR_ID#,NULL,#FNL_USR_ID#,#FRT_USR_ID#)		/*최초사용자ID*/
							,#FNL_USR_ID#		/*최종사용자ID*/
							,#FNL_DEAL_DPT_CD#	/*최종거래부서코드*/
							,#FNL_MNU_ID#		/*최종메뉴ID*/
							,SYSDATE			/*최초등록일시*/
							,SYSDATE			/*최종수정일시*/
						)
		]]>
	</insert>
	
	
	<insert id="CSPGSU003EFileInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPGSU004M
					(
						PRPS_YE				/*제안연도*/
						,PRPS_SLN			/*제안연번*/
						,PRPS_ATT_FL_DVSN_CD	/*제안천부파일구분코드*/
						,DOC_ID				/*첨부파일문서ID*/
						,DOC_TYP_CD			/*문서유형코드*/
						,FRT_USR_ID			/*최초사용자ID*/
						,FNL_USR_ID			/*최종사용자ID*/
						,FNL_DEAL_DPT_CD	/*최종거래부서코드*/
						,FNL_MNU_ID			/*최종메뉴ID*/
						,FRT_REGI_DH		/*최초등록일시*/
						,FNL_MDF_DH			/*최종수정일시*/
					)
				VALUES	(
							#PRPS_YE#			/*제안연도*/
							,#PRPS_SLN#			/*제안연번*/
							,'1'				/*제안천부파일구분코드*/
							,#DOC_ID#			/*첨부파일문서ID*/
							,''					/*문서유형코드*/
							,F_USR_INFO(#S_CNB#,'1')		/*최초사용자ID*/
							,#FNL_USR_ID#		/*최종사용자ID*/
							,#FNL_DEAL_DPT_CD#	/*최종거래부서코드*/
							,#FNL_MNU_ID#		/*최종메뉴ID*/
							,SYSDATE			/*최초등록일시*/
							,SYSDATE			/*최종수정일시*/
						)
		]]>
	</insert>
	<select id="CSPGSU003EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.PRPS_TIT_NM		/*제안제목*/
					,DECODE(A.PRPS_PEN_CNB,#strCNB#,F_USR_INFO(A.PRPS_PEN_CNB,'2'),
							NULL) AS PRPS_PEN_NAM	/*제안자명*/
					,DECODE(A.PRPS_PEN_CNB,#strCNB#,A.PRPS_PEN_CNB,NULL) AS PRPS_PEN_CNB		/*제안자전산번호*/
					,DECODE(A.PRPS_PEN_CNB,#strCNB#,B.JNT_PRPS_PEN_NAM,NULL) AS JNT_PRPS_PEN_NAM	/*공동제안자*/
					,F_CODE_NM('1000075',A.PRPS_STA_CD) AS PRPS_STA_NM
					,A.PRPS_STA_CD		/*제안상태코드*/
					,A.CUR_SYE_TXT		/*현행제도내용*/
					,A.PRB_TXT			/*문제점내용*/
					,A.IMP_ATV_TXT		/*개선대안내용*/
					,A.IMP_EFCT_TXT		/*개선효과내용*/
					,A.PRPS_YE			/*제안연도*/
					,A.PRPS_SLN			/*제안연번*/
					,(SELECT 	Z.DOC_ID	
						FROM	TBCSPGSU004M Z
						WHERE	Z.PRPS_YE = A.PRPS_YE
						AND		Z.PRPS_SLN = A.PRPS_SLN
						AND		Z.PRPS_ATT_FL_DVSN_CD = '1') AS DOC_ID	/*첨부파일 문서*/
					,F_DPT_INFO(A.EXAM_DPT_CD,'1') AS EXAM_DPT_NM		/*검토부서*/
					,A.EXAM_DT 			/*검토일자*/
					,DECODE(A.PRPS_PEN_CNB,#strCNB#,F_USR_INFO(A.EXAM_PEN_CNB,'2'),NULL) AS EXAM_PEN_NAM		/*검토자*/
					,A.EXAM_TXT
					,F_CODE_NM('1000077',A.EXAM_RSLT_CD) AS EXAM_RSLT_NM
					,(SELECT 	Z.DOC_ID	
						FROM	TBCSPGSU004M Z
						WHERE	Z.PRPS_YE = A.PRPS_YE
						AND		Z.PRPS_SLN = A.PRPS_SLN
						AND		Z.PRPS_ATT_FL_DVSN_CD = '2') AS EXAM_DOC_ID	/*검토첨부파일 문서*/
					,DECODE(A.PRPS_STA_CD,'M','종료(불채택)','N','종료(채택)','') AS PRPS_STA_YN	/*채택여부*/
					,A.JDG_DT			/*위원회일자*/
					,F_CODE_NM('1000076',A.RK_CD) AS RK_NM
					,A.PRPS_ASC
					,F_CODE_NM('1000286',A.CNTR_PRPS_RCMD_DVSN_CD) AS CNTR_PRPS_RCMD_DVSN_NM
					,A.PRPS_DPT_CD
			FROM	TBCSPGSU001M A		/*도서자료기본*/
					, (	SELECT 	PRPS_YE, PRPS_SLN, AGGR_CONCAT(F_USR_INFO (A.PRPS_PEN_CNB,'2'),'/') AS JNT_PRPS_PEN_NAM
						FROM 	TBCSPGSU002L A WHERE 1=1
					    AND 	A.PRPS_YE = #strPRPS_YE#
					    AND 	A.PRPS_SLN = #strPRPS_SLN#
					    AND		A.SNO <> 1
					    GROUP BY PRPS_YE, PRPS_SLN) B
			WHERE	1=1
			AND		A.PRPS_YE = #strPRPS_YE#
			AND		A.PRPS_SLN = #strPRPS_SLN#
			AND	 	A.PRPS_YE = B.PRPS_YE(+)
		    AND 	A.PRPS_SLN = B.PRPS_SLN(+)
		]]>
	</select>
	
	
	<update id="CSPGSU003EMainUpdate" parameterClass="paramMap">
		UPDATE	TBCSPGSU001M
		SET		PRPS_TIT_NM = #PRPS_TIT_NM#			/*제안제목명*/
				,CUR_SYE_TXT = #CUR_SYE_TXT#		/*현행제도내용*/
				,PRB_TXT = #PRB_TXT#				/*문제점내용*/
				,IMP_ATV_TXT = #IMP_ATV_TXT#		/*개선대안내용*/
				,IMP_EFCT_TXT = #IMP_EFCT_TXT#		/*개선효과내용*/
				,FNL_USR_ID = #FNL_USR_ID#
				,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				,FNL_MNU_ID = #FNL_MNU_ID#
				,FNL_MDF_DH = SYSDATE
		WHERE	PRPS_YE = #PRPS_YE#
		AND		PRPS_SLN = #PRPS_SLN#
	</update>
	
	<!-- 제안 삭제 시 첨부파일 테이블 삭제 -->
	<delete id="CSPGSU003EFileDelete" parameterClass="paramMap">
	<![CDATA[
		DELETE 
		FROM	TBCSPGSU004M
		WHERE	PRPS_YE = #PRPS_YE#
		AND		PRPS_SLN = #PRPS_SLN#
	]]>
	</delete>
	
	<!-- 제안 삭제시 제안실적 내역 삭제 -->
	<delete id="CSPGSU003ETBCSPGSU002LDelete" parameterClass="paramMap">
	<![CDATA[
		DELETE 
		FROM	TBCSPGSU002L
		WHERE	PRPS_YE = #PRPS_YE#
		AND		PRPS_SLN = #PRPS_SLN#
	]]>
	</delete>
	
	<!-- 제안 삭제시 제안테이블 내역 삭제 -->
	<delete id="CSPGSU003EMainDelete" parameterClass="paramMap">
	<![CDATA[
		DELETE 
		FROM	TBCSPGSU001M
		WHERE	PRPS_YE = #PRPS_YE#
		AND		PRPS_SLN = #PRPS_SLN#
	]]>
	</delete>
	
	<select id="CSPGSU004PUsrSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	USR_ID, USR_NAM, DPT_CD, F_DPT_INFO(DPT_CD,'1') DPT_NM, CNB AS PRPS_PEN_CNB , 100 AS CTB_RTE
					,'' PRPS_YE, '' PRPS_SLN
			FROM	TBDCMACM001M
			WHERE	1=1
		]]>
		<dynamic>
			<isNotEmpty property="strUSR_NAM">
				AND	USR_NAM LIKE '%'||#strUSR_NAM#||'%'
			</isNotEmpty>
			<isNotEmpty property="strCNB">
				AND	CNB = #strCNB#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="CSPGSU004PSubSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	F_USR_INFO(A.PRPS_PEN_CNB, '1') AS USR_ID 
					,F_USR_INFO(A.PRPS_PEN_CNB, '2') AS USR_NAM 
					,F_USR_INFO(A.PRPS_PEN_CNB, '5') AS DPT_CD 
					,F_DPT_INFO(F_USR_INFO(A.PRPS_PEN_CNB, '5'),'1') AS DPT_NM 
					,PRPS_PEN_CNB
					,CTB_RTE
					,PRPS_YE, PRPS_SLN
			FROM	TBCSPGSU002L A
			WHERE	1=1
			AND		PRPS_YE = #strPRPS_YE#
			AND		PRPS_SLN = #strPRPS_SLN#
			ORDER BY SNO ASC
		]]>
	</select>
	
	<select id="CSPGSU001EReportSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.PRPS_ACP_NO		/*접수번호*/
					,A.PRPS_TIT_NM		/*제안제목*/
					,A.PRPS_PEN_NAM		/*제안자명*/
					,TO_CHAR(TO_DATE(A.ACP_DT),'YYYY-MM-DD') AS ACP_DT			/*접수일자*/
					,F_CODE_NM('1000075', A.PRPS_STA_CD) AS PRPS_STA_NM		/*제안상태코드*/
			FROM	( 
						SELECT	DECODE(A.PRPS_ACP_NO,NULL,'',A.PRPS_YE||'-'||A.PRPS_ACP_NO) AS PRPS_ACP_NO	/*접수번호*/
								,A.PRPS_TIT_NM		/*제안제목*/
								,F_USR_INFO(A.PRPS_PEN_CNB,'2') AS PRPS_PEN_NAM	/*제안자명*/
								,A.PRPS_PEN_CNB		/*제안자전산번호*/
								,A.ACP_DT			/*접수일자*/
								,A.PRPS_STA_CD		/*제안상태코드*/
								,A.PRPS_YE			/*제안연도*/
								,A.PRPS_SLN			/*제안연번*/
								,'1' ORDER_NO
								,A.PRPS_ACP_NO AS ACP_NO
						FROM	TBCSPGSU001M A		/*도서자료기본*/
						WHERE	1=1
						AND		PRPS_PEN_CNB = #strCNB#
					]]>
					<dynamic>
						<isNotEmpty property="strPRPS_STA_CD">
							AND	A.PRPS_STA_CD = #strPRPS_STA_CD#
						</isNotEmpty>
						<isNotEmpty property="strACP_DTS">
							AND	A.ACP_DT &gt;= #strACP_DTS#
						</isNotEmpty>
						<isNotEmpty property="strACP_DTE">
							AND	A.ACP_DT &lt;= #strACP_DTE#
						</isNotEmpty>
						<isNotEmpty property="strPRPS_TIT_NM">
							AND	A.PRPS_TIT_NM LIKE '%'||#strPRPS_TIT_NM#||'%'
						</isNotEmpty>
					</dynamic> 
					<![CDATA[
						UNION
						SELECT	DECODE(A.PRPS_ACP_NO,NULL,'',A.PRPS_YE||'-'||A.PRPS_ACP_NO) AS PRPS_ACP_NO	/*접수번호*/
								,A.PRPS_TIT_NM		/*제안제목*/
								,SUBSTR(F_USR_INFO(A.PRPS_PEN_CNB,'2'),1,1)||'OO' AS PRPS_PEN_NAM	/*제안자명*/
								,A.PRPS_PEN_CNB		/*제안자전산번호*/
								,A.ACP_DT			/*접수일자*/
								,A.PRPS_STA_CD		/*제안상태코드*/
								,A.PRPS_YE			/*제안연도*/
								,A.PRPS_SLN			/*제안연번*/
								,'2' ORDER_NO
								,A.PRPS_ACP_NO AS ACP_NO
						FROM	TBCSPGSU001M A		/*도서자료기본*/
						WHERE	1=1
						AND		A.PRPS_PEN_CNB <> #strCNB#
						AND		A.PRPS_STA_CD IN ('N','M')
						AND		#strSEARCH_CD# IS NULL
					]]>
					<dynamic>
						<isNotEmpty property="strPRPS_STA_CD">
							AND	A.PRPS_STA_CD = #strPRPS_STA_CD#
						</isNotEmpty>
						<isNotEmpty property="strACP_DTS">
							AND	A.ACP_DT &gt;= #strACP_DTS#
						</isNotEmpty>
						<isNotEmpty property="strACP_DTE">
							AND	A.ACP_DT &lt;= #strACP_DTE#
						</isNotEmpty>
						<isNotEmpty property="strPRPS_TIT_NM">
							AND	A.PRPS_TIT_NM LIKE '%'||#strPRPS_TIT_NM#||'%'
						</isNotEmpty>
					</dynamic> 
		<![CDATA[
					) A
			ORDER BY A.ORDER_NO ASC, TO_NUMBER(A.PRPS_YE) DESC, 
					DECODE(A.ORDER_NO,'1',TO_NUMBER(A.PRPS_SLN),TO_NUMBER(A.ACP_NO)) DESC
		]]>
	</select>
	
	<select id="CSPGSU003EReportSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.PRPS_TIT_NM		/*제안제목*/
					,DECODE(A.PRPS_PEN_CNB,#strCNB#,F_USR_INFO(A.PRPS_PEN_CNB,'2'),
							SUBSTR(F_USR_INFO(A.PRPS_PEN_CNB,'2'),1,1)||'OO') AS PRPS_PEN_NAM	/*제안자명*/
					,B.JNT_PRPS_PEN_NAM	/*공동제안자*/
					,F_CODE_NM('1000075',A.PRPS_STA_CD) AS PRPS_STA_NM
					,TO_CHAR(TO_DATE(A.SMT_DT),'YYYY-MM-DD') AS SMT_DT		/*제안상태코드*/
					,TO_CHAR(TO_DATE(A.ACP_DT),'YYYY-MM-DD') AS ACP_DT		/*제안상태코드*/
					,A.CUR_SYE_TXT		/*현행제도내용*/
					,A.PRB_TXT			/*문제점내용*/
					,A.IMP_ATV_TXT		/*개선대안내용*/
					,A.IMP_EFCT_TXT		/*개선효과내용*/
					,F_DPT_INFO(A.EXAM_DPT_CD,'1') AS EXAM_DPT_NM		/*검토부서*/
					,TO_CHAR(TO_DATE(A.EXAM_DT),'YYYY-MM-DD') AS EXAM_DT 			/*검토일자*/
					,F_USR_INFO(A.EXAM_PEN_CNB,'2') AS EXAM_PEN_NAM		/*검토자*/
					,A.EXAM_TXT
					,F_CODE_NM('1000077',A.EXAM_RSLT_CD) AS EXAM_RSLT_NM
					,DECODE(A.PRPS_STA_CD,'M','종료(불채택)','N','종료(채택)','') AS PRPS_STA_YN	/*채택여부*/
					,TO_CHAR(TO_DATE(A.JDG_DT),'YYYY-MM-DD') AS JDG_DT			/*위원회일자*/
					,F_CODE_NM('1000076',A.RK_CD) AS RK_NM
					,A.PRPS_ASC
					,F_CODE_NM('1000286',A.CNTR_PRPS_RCMD_DVSN_CD) AS CNTR_PRPS_RCMD_DVSN_NM
			FROM	TBCSPGSU001M A		/*제안*/
					, (	SELECT 	PRPS_YE, PRPS_SLN, AGGR_CONCAT(F_USR_INFO (A.PRPS_PEN_CNB,'2'),'/') AS JNT_PRPS_PEN_NAM 
						FROM 	TBCSPGSU002L A WHERE 1=1
					    AND 	A.PRPS_YE = #strPRPS_YE#
					    AND 	A.PRPS_SLN = #strPRPS_SLN#
					    AND		A.SNO <> 1
					    GROUP BY PRPS_YE, PRPS_SLN) B
			WHERE	1=1
			AND		A.PRPS_YE = #strPRPS_YE#
			AND		A.PRPS_SLN = #strPRPS_SLN#
			AND	 	A.PRPS_YE = B.PRPS_YE(+)
		    AND 	A.PRPS_SLN = B.PRPS_SLN(+)
		]]>
	</select>
	
	<insert id="CSPGSU001EMsg206Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO
			TBDCMACM026L
			(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
	        , MSG_TP_YN
	  
	        , MSG_TXT_2
	        , RCNT_CNT
	        , RCNT_HIS
	        , MSG_REGI_DH
	
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
	
			)
			VALUES
			(
			  (SELECT NVL(MAX(MSG_SNO),0)+1 FROM TBDCMACM026L)
			, 'SP'
			, 'SU'
			, #FNL_USR_ID#
	        , '0'
	     
	        , '신규제안이 제출되었습니다.'
	        , 1
	        , '3129'
	        , SYSDATE
	        
	        
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
	
			);
			
		]]>
	</insert>
</sqlMap> 
