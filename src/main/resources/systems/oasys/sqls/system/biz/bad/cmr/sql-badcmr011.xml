<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/cmr/011">


	
	
	<!-- 결재문서 신규 -->
	<insert id="badcmr011EMidCatinsert" parameterClass="paramMap">
		INSERT INTO
		TBBADCMR002M
		(
		YE
		, LAG_CAT_SNO
		, MID_CAT_SNO
		, MID_CAT_TIT_NM
		, MID_CAT_TXT
		, REGI_DT
		, REGN_ID
		, MDF_DT
		, MDF_PEN_ID
		, DEL_YN
		
		, FNL_MNU_ID
		, FRT_USR_ID
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FRT_REGI_DH
		, FNL_MDF_DH
		)
		VALUES
		(
		#YE#
		, #LAG_CAT_SNO#
		, #MID_CAT_SNO#
		, #MID_CAT_TIT_NM#
		, #MID_CAT_TXT#
		
		, TO_CHAR(SYSDATE,'YYYYMMDD')
		, #S_CNB#
		, TO_CHAR(SYSDATE,'YYYYMMDD')
		, #S_CNB#
		,'N'

		
		, #FNL_MNU_ID#
		, #FRT_USR_ID#
		, #FNL_USR_ID#
		, #FNL_DEAL_DPT_CD#
		, SYSDATE
		, SYSDATE
		)
	</insert>


	<!-- 결재자상태 업데이트 -->
	<update id="badcmr011EMidCatupdate" parameterClass="paramMap">
		UPDATE TBBADCMR002M
		SET YE = #YE#
		, LAG_CAT_SNO =#LAG_CAT_SNO#
		, MID_CAT_SNO=#MID_CAT_SNO#
		, MID_CAT_TIT_NM=#MID_CAT_TIT_NM#
		, FNL_MDF_DH = SYSDATE
		, FNL_USR_ID = #FNL_USR_ID#
		, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		, FNL_MNU_ID = #FNL_MNU_ID#
		<isNotNull prepend="," property="MID_CAT_TXT">
			MID_CAT_TXT = #MID_CAT_TXT#
		</isNotNull>
		WHERE 1 = 1
		AND YE = #YE#
		AND LAG_CAT_SNO =#LAG_CAT_SNO#
		AND MID_CAT_SNO =#MID_CAT_SNO#

	</update>
          
     <select id="badcmr011PMidCatMaxselect" parameterClass="paramMap"
	resultClass="java.lang.String">
        <![CDATA[    
			 SELECT LPAD(NVL(MAX(MID_CAT_SNO), 0) + 1, 3, 0) AS LAG_CAT_SNO
			  FROM TBBADCMR002M
			 WHERE 1=1
			   AND YE = #strYear#
			    AND LAG_CAT_SNO = #strLagCatSno#
			  ]]>
          </select>
          
   
</sqlMap> 
