<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ear/050">

	<!-- 감사사항 조회-->
	<select id="BADEAR050QMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT	TO_CHAR(TO_DATE(IF_RAISE_DT),'YYYY-MM-DD') AS IF_RAISE_DT
					,SEND_SERVER_NM
					,REV_SERVER_NM
					, SUM(SUCCESS_CNT) AS SUCCESS_CNT
					, SUM(FAIL_CNT) AS FAIL_CNT
			FROM    (
						SELECT	SUBSTR(IF_RAISE_DT,0,8) AS IF_RAISE_DT
        						,'오아시스' AS SEND_SERVER_NM
        						,'홈페이지' AS REV_SERVER_NM
        						, CASE WHEN  IF_STATUS = 'SC' THEN 1 ELSE 0 END AS SUCCESS_CNT
        						, CASE WHEN IF_STATUS = 'SE' THEN 1 ELSE 0 END AS FAIL_CNT
						FROM	BAI_INF_DB_SND_001 D1
						UNION ALL
						SELECT  SUBSTR(IF_RAISE_DT,0,8) AS IF_RAISE_DT
        						,'홈페이지' AS SEND_SERVER_NM
        						,'오아시스' AS REV_SERVER_NM
        						, CASE WHEN  IF_STATUS = 'RC' THEN 1 ELSE 0 END AS SUCCESS_CNT
        						, CASE WHEN IF_STATUS = 'RE' THEN 1 ELSE 0 END AS FAIL_CNT
						FROM	BAI_INF_DB_RCV_001
        			
        			) A
        	WHERE	1=1
		]]>	
        	<isNotEmpty property="strIF_RAISE_DTS">
				AND	A.IF_RAISE_DT &gt;= #strIF_RAISE_DTS#
			</isNotEmpty>
			<isNotEmpty property="strIF_RAISE_DTE">
				AND	A.IF_RAISE_DT &lt;= #strIF_RAISE_DTE#
			</isNotEmpty>
			<isEqual property="strSERVER_CD" compareValue="1">
				AND	SEND_SERVER_NM = '오아시스'
			</isEqual>
			<isEqual property="strSERVER_CD" compareValue="2">
				AND	SEND_SERVER_NM = '홈페이지'
			</isEqual>
			
        <![CDATA[
        	GROUP BY IF_RAISE_DT,SEND_SERVER_NM,REV_SERVER_NM
        	ORDER BY IF_RAISE_DT DESC
		]]>
	</select>
	
</sqlMap> 
