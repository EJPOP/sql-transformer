<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ded/010">

	<!--감사출장상황 조회-->
	<select id="BADDED010EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT F_MNG_KND_AUDYRNO(D2.AUD_YR, D2.AUD_NO, D2.AUD_KND_CD, '-') 
			       ||'('|| D1.AUD_STEP_SNO || ')'       AS AUD_YR_NO            /*감사년번호 - 수정(2015.12.17-yyh)*/		
			     , CASE WHEN D2.AUD_YR >= '2016' 
			                 THEN SUBSTR(D2.AUD_KND_CD,3,1)
			            ELSE '' 
			        END                                 AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.18 yyh*/			       	
			     , D1.BZT_YR							AS BZT_YR				/*출장년도*/
			     , D1.BZT_SNO                           AS BZT_SNO              /*출장순번*/
			     , D2.AUD_KND_CD                        AS AUD_KND_CD           /*감사종류코드*/    
			     , F_CODE_NM('1000007',D2.AUD_KND_CD)   AS AUD_KND_NM           /*감사종류명*/
			     , D1.BZT_DVSN_CD                       AS BZT_DVSN_CD          /*출장구분코드*/
			     , D1.AUD_BZT_KND_CD                    AS AUD_BZT_KND_CD       /*감사출장종류코드*/
			     , F_CODE_NM('1000030',D1.AUD_BZT_KND_CD) AS AUD_BZT_KND_NM     /*감사출장종류코드*/
			     , D1.BZT_TL_CNB                        AS BZT_TL_CNB           /*출장반장전산번호*/
			     , D1.BZT_TL_BRDV_CD                    AS BZT_TL_BRDV_CD       /*출장반장국과코드*/    
			     , D1.BZT_TL_RANK_CD                    AS BZT_TL_RANK_CD       /*출장반장직급코드*/
			     , F_USR_INFO(D1.BZT_TL_CNB,'2')        AS BZT_TL_CNB_NM        /*출장반장명*/    
			     , F_DPT_INFO(D1.BZT_TL_BRDV_CD,'1')    AS BZT_TL_BRDV_NM       /*출장반장국과명*/
			     , F_CODE_NM('1000173',D1.BZT_TL_RANK_CD)   AS BZT_TL_RANK_NM   /*출장반장직급명*/
			     , D1.TIT_TXT                           AS TIT_TXT              /*제목내용*/
			     , D1.BZT_BRDV_CD                       AS BZT_BRDV_CD          /*출장국과코드*/
			     , F_DPT_INFO(D1.BZT_BRDV_CD,'1')       AS BZT_BRDV_NM          /*출장국과명*/
			     , D1.HLDY_ACTV_DVSN_CD                 AS HLDY_ACTV_DVSN_CD    /*휴일활동구분코드*/
			     , F_CODE_NM('1000019',D1.HLDY_ACTV_DVSN_CD)                 AS HLDY_ACTV_DVSN_NM    /*휴일활동구분코드*/
			     , D1.REL_AUD_YR                        AS REL_AUD_YR           /*관련감사년도*/
			     , D1.REL_AUD_NO                        AS REL_AUD_NO           /*관련감사번호*/
			     , D2.AUD_GRN_NO                        AS AUD_GRN_NO           /*감사부여번호 - 2016.05.27 yyh*/
			     , D1.AUD_STEP_SNO                      AS AUD_STEP_SNO         /*감사단계순번*/
			     , D1.BZT_TXT                           AS BZT_TXT              /*출장내용*/
			     , D1.CTRL_YN                           AS CTRL_YN              /*통제여부*/
			     , D1.BZT_YR ||'-'||D1.SPRT_NO          AS SPRT_NM              /*지원번호*/
			     , D1.SPRT_NO                           AS SPRT_NO              /*지원번호*/
			     , D1.GEN_BZT_KND_CD                    AS GEN_BZT_KND_CD       /*일반출장구분코드*/
			     , D1.REGI_DT                           AS REGI_DT              /*등록일*/
			     , D1.AUD_STR_DT                        AS AUD_STR_DT           /*감사시작일*/
			     , D1.AUD_END_DT                        AS AUD_END_DT           /*감사종료일*/
			     , D1.AUD_DCN                           AS AUD_DCN              /*감사일수*/
			     , D1.LEAD_EXS_PMT_YN                   AS LEAD_EXS_PMT_YN      /*지휘비지급여부*/
			     , D1.CTRL_TG_YN                        AS CTRL_TG_YN           /*통제대상여부*/
			     , D1.CTRL_DT                           AS CTRL_DT              /*통제일*/
			     , D1.SND_YN                            AS SND_YN               /*송부여부*/
			     , D1.SND_DT                            AS SND_DT               /*송부일*/
			     , D1.FLD_AUD_STEP_NO                   AS FLD_AUD_STEP_NO      /*실지감사단계번호*/
			     , D2.AUD_YR                            AS AUD_YR               /*감사년도*/
			     , D2.AUD_NO                            AS AUD_NO               /*감사번호*/   
			     , F_DPT_INFO(D2.SPV_BRDV_CD,'1')       AS SPV_BRDV_NM          /*주관부서명*/
				 , F_DPT_INFO(D2.MNG_DPT_CD,'1')        AS MNG_DPT_NM           /*관리부서명*/			     
			     , F_DPT_INFO((SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = D2.SPV_BRDV_CD), '1') AS SPV_BRDV_UP_NM  /*주관부서명(국)*/
			     , TO_CHAR(TO_DATE(D1.AUD_STR_DT),'YYYY-MM-DD')||'~'|| TO_CHAR(TO_DATE(D1.AUD_END_DT),'YYYY-MM-DD')    AS AUD_ST_END_DT        /*실시기간*/
			     , D2.AUD_SBJ_NM					   AS AUD_SBJ_NM			/*감사사항명*/
                 , CASE WHEN NVL(D1.CTRL_TG_YN,'N') = 'N' THEN '-'
                        WHEN NVL(D1.CTRL_TG_YN,'N') = 'Y' AND NVL(D1.CTRL_YN,'N') = 'Y' THEN 'O' 
                        WHEN NVL(D1.CTRL_TG_YN,'N') = 'Y' AND NVL(D1.CTRL_YN,'N') = 'N' THEN 'X'
                    END AS CTRL_YN_DISP
                 , CASE WHEN NVL(D1.SND_YN,'N') = 'Y' THEN 'O' ELSE 'X' END AS SND_YN_DISP	
                 , (SELECT CASE WHEN COUNT(1)>0 THEN 'Y' ELSE 'N' END  
                      FROM TBBADDED011L
                     WHERE 1=1
                       AND BZT_YR  = D1.BZT_YR
                       AND BZT_SNO = D1.BZT_SNO
                    )  	AS EXP_YN 		/*수정가능여부를 판단하기 위함.*/	 
                 , '' 	AS SEL_YN		/*선택여부를 판단하기위함.(통제화면)*/        
                 , NVL(D3.IN_PSON_CNT,0)    AS IN_PSON_CNT
			     , NVL(D3.EXT_PSON_CNT,0)   AS EXT_PSON_CNT
			     , NVL(D3.IN_PSON_CNT,0)+ NVL(D3.EXT_PSON_CNT,0) AS PSON_CNT
			     , NVL(D3.IN_PSON_CNT,0)||'/'||NVL(D3.EXT_PSON_CNT,0)||'/'||(NVL(D3.IN_PSON_CNT,0)+ NVL(D3.EXT_PSON_CNT,0)) AS ALL_PSON_CNT 
			     , F_ORG_CNT_NM_AUD(D1.BZT_YR,D1.BZT_SNO,'BZT') AS ORG_CNT_NM
                 , (SELECT CASE WHEN COUNT(1)>0 THEN 'Y' ELSE 'N' END  
                      FROM TBBADDED004L
                     WHERE 1=1
                       AND BZT_YR  = D1.BZT_YR
                       AND BZT_SNO = D1.BZT_SNO
                    )  	AS TEAM_YN
                
                , TO_CHAR(TO_DATE(D1.AUD_STR_DT),'YYYY-MM-DD')||'~'|| TO_CHAR(TO_DATE(D1.AUD_END_DT),'YYYY-MM-DD') 
                  || '(' || D1.AUD_DCN || ')'                                                                      AS AUD_ST_END_DT_DCN  /*실시기간+일수 - 2015.06.02 yyh*/
                
                /* 출장예산구분 추가 - 2016.05.27 yyh */
                , D2.BZT_BGT_DVSN_CD                      AS BZT_BGT_DVSN_CD
                , F_CODE_NM('1000751',D2.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM
			  FROM TBBADDED002M D1
			     , TBBADDED001M D2
			     , (
			        SELECT BZT_YR
			             , BZT_SNO
			             , SUM( CASE WHEN A.STF_DVSN_CD = '0' THEN 1 ELSE 0 END) AS IN_PSON_CNT  /*내부인원*/
			             , SUM( CASE WHEN A.STF_DVSN_CD = '0' THEN 0 ELSE 1 END) AS EXT_PSON_CNT /*외부인원*/
			          FROM (SELECT DISTINCT BZT_YR
			                     , BZT_SNO
			                     , PCT_CNB
			                     , STF_DVSN_CD
			                  FROM TBBADDED005L) A
			         GROUP BY BZT_YR, BZT_SNO 
			     ) D3			     
			WHERE 1=1
			  AND D1.BZT_DVSN_CD = '1' /*감사출장*/
			  AND D1.REL_AUD_YR = D2.AUD_YR
			  AND D1.REL_AUD_NO = D2.AUD_NO
			  AND D1.BZT_YR     = D3.BZT_YR(+)
			  AND D1.BZT_SNO    = D3.BZT_SNO(+)
			  AND D2.MNG_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#)))   /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/   		
		]]>			 
		<isNotEmpty property="strSpvBrdvCd">
			  AND D2.MNG_DPT_CD  = #strSpvBrdvCd#
		</isNotEmpty>      
		<isNotEmpty property="BZT_DVSN_CD">
			  AND D1.BZT_DVSN_CD = #BZT_DVSN_CD#
		</isNotEmpty>	  
		<isNotEmpty property="strAudYr">	 
			  AND D1.REL_AUD_YR      = #strAudYr#
		</isNotEmpty>
		<isNotEmpty property="strAudNo">	 	
			  AND D1.REL_AUD_NO      = #strAudNo#
		</isNotEmpty>
		
		<isNotNull property="strAudYrNoKndCd">
			<isNotEmpty property="strAudYrNoKndCd">	 	
	              /* 감사연번종류코드 - 2015.12.18 yyh */
				  AND SUBSTR(D2.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
			</isNotEmpty>		
		</isNotNull>
		
		<isNotEmpty property="strAudGrnNo">
			  /* 감사부여번호 추가 - 2016.05.27 yyh */	 	
			  AND D2.AUD_GRN_NO      = #strAudGrnNo#
		</isNotEmpty>	
				
		<isNotEmpty property="strAudSbjNm">	 	   
			  AND D2.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty property="strAudKndCd">	 
			  AND D2.AUD_KND_CD  = #strAudKndCd#		/*감사종류코드*/ 
		</isNotEmpty>
		<isNotEmpty property="strBztKndCd">	 
			  AND D1.AUD_BZT_KND_CD  = #strBztKndCd#		/*출장종류코드*/ 
		</isNotEmpty>
		<isNotEmpty property="strSpvBrdvCd">	 
			  AND D1.BZT_BRDV_CD = #strSpvBrdvCd#		 /*출장국과코드*/
		</isNotEmpty>   
		<isEqual property="strCtrlYn" compareValue="Y">
			  AND D1.CTRL_YN = 'Y'
		</isEqual>
		<isEqual property="strCtrlYn" compareValue="N">
			  AND NVL(D1.CTRL_YN,'N') = 'N'
		</isEqual>	
		<isEqual property="strSndYn" compareValue="Y">
			  AND D1.SND_YN = 'Y'
		</isEqual>
		<isEqual property="strSndYn" compareValue="N">
			  AND NVL(D1.SND_YN,'N') = 'N'
		</isEqual>					
		<isNotEmpty property="BZT_SNO">
			  AND D1.BZT_SNO = #BZT_SNO#
		</isNotEmpty>		
		<isNotEmpty property="BZT_YR">
			  AND D1.BZT_YR = #BZT_YR#
		</isNotEmpty>	
		<isEqual property="MASTER_YN" compareValue="MASTER" >
			 AND D1.CTRL_TG_YN = 'Y'
			 AND D1.SND_YN = 'Y'
		</isEqual>
		<isNotEmpty property="TIT_TXT">
			 AND D1.TIT_TXT LIKE #TIT_TXT#||'%'
		</isNotEmpty>
        <![CDATA[       
			 ORDER BY D1.REL_AUD_NO DESC , D1.AUD_STEP_SNO DESC
        ]]>
	</select>
	
	
	<!--감사출장상황 조회 페이징 2016.01.06 yyh-->
	<select id="BADDED010EMainSelectPaging" parameterClass="paramMap" resultClass="resultMap">
		<include refid="include.pageSelct" />
		
        <![CDATA[       
			SELECT F_MNG_KND_AUDYRNO(D2.AUD_YR, D2.AUD_NO, D2.AUD_KND_CD, '-') 
			       ||'('|| D1.AUD_STEP_SNO || ')'       AS AUD_YR_NO            /*감사년번호 - 수정(2015.12.17-yyh)*/		
			     , CASE WHEN D2.AUD_YR >= '2016' 
			                 THEN SUBSTR(D2.AUD_KND_CD,3,1)
			            ELSE '' 
			        END                                 AS AUD_YR_NO_KND_CD     /*감사연번호종류코드 추가 - 2015.12.18 yyh*/			       	
			     , D1.BZT_YR							AS BZT_YR				/*출장년도*/
			     , D1.BZT_SNO                           AS BZT_SNO              /*출장순번*/
			     , D2.AUD_KND_CD                        AS AUD_KND_CD           /*감사종류코드*/    
			     , F_CODE_NM('1000007',D2.AUD_KND_CD)   AS AUD_KND_NM           /*감사종류명*/
			     , D1.BZT_DVSN_CD                       AS BZT_DVSN_CD          /*출장구분코드*/
			     , D1.AUD_BZT_KND_CD                    AS AUD_BZT_KND_CD       /*감사출장종류코드*/
			     , F_CODE_NM('1000030',D1.AUD_BZT_KND_CD) AS AUD_BZT_KND_NM     /*감사출장종류코드*/
			     , D1.BZT_TL_CNB                        AS BZT_TL_CNB           /*출장반장전산번호*/
			     , D1.BZT_TL_BRDV_CD                    AS BZT_TL_BRDV_CD       /*출장반장국과코드*/    
			     , D1.BZT_TL_RANK_CD                    AS BZT_TL_RANK_CD       /*출장반장직급코드*/
			     , F_USR_INFO(D1.BZT_TL_CNB,'2')        AS BZT_TL_CNB_NM        /*출장반장명*/    
			     , F_DPT_INFO(D1.BZT_TL_BRDV_CD,'1')    AS BZT_TL_BRDV_NM       /*출장반장국과명*/
			     , F_CODE_NM('1000173',D1.BZT_TL_RANK_CD)   AS BZT_TL_RANK_NM   /*출장반장직급명*/
			     , D1.TIT_TXT                           AS TIT_TXT              /*제목내용*/
			     , D1.BZT_BRDV_CD                       AS BZT_BRDV_CD          /*출장국과코드*/
			     , F_DPT_INFO(D1.BZT_BRDV_CD,'1')       AS BZT_BRDV_NM          /*출장국과명*/
			     , D1.HLDY_ACTV_DVSN_CD                 AS HLDY_ACTV_DVSN_CD    /*휴일활동구분코드*/
			     , F_CODE_NM('1000019',D1.HLDY_ACTV_DVSN_CD)                 AS HLDY_ACTV_DVSN_NM    /*휴일활동구분코드*/
			     , D1.REL_AUD_YR                        AS REL_AUD_YR           /*관련감사년도*/
			     , D1.REL_AUD_NO                        AS REL_AUD_NO           /*관련감사번호*/
			     , D2.AUD_GRN_NO                        AS AUD_GRN_NO           /*감사부여번호 - 2016.05.27 yyh*/
			     , D1.AUD_STEP_SNO                      AS AUD_STEP_SNO         /*감사단계순번*/
			     , D1.BZT_TXT                           AS BZT_TXT              /*출장내용*/
			     , D1.CTRL_YN                           AS CTRL_YN              /*통제여부*/
			     , D1.BZT_YR ||'-'||D1.SPRT_NO          AS SPRT_NM              /*지원번호*/
			     , D1.SPRT_NO                           AS SPRT_NO              /*지원번호*/
			     , D1.GEN_BZT_KND_CD                    AS GEN_BZT_KND_CD       /*일반출장구분코드*/
			     , D1.REGI_DT                           AS REGI_DT              /*등록일*/
			     , D1.AUD_STR_DT                        AS AUD_STR_DT           /*감사시작일*/
			     , D1.AUD_END_DT                        AS AUD_END_DT           /*감사종료일*/
			     , D1.AUD_DCN                           AS AUD_DCN              /*감사일수*/
			     , D1.LEAD_EXS_PMT_YN                   AS LEAD_EXS_PMT_YN      /*지휘비지급여부*/
			     , D1.CTRL_TG_YN                        AS CTRL_TG_YN           /*통제대상여부*/
			     , D1.CTRL_DT                           AS CTRL_DT              /*통제일*/
			     , D1.SND_YN                            AS SND_YN               /*송부여부*/
			     , D1.SND_DT                            AS SND_DT               /*송부일*/
			     , D1.FLD_AUD_STEP_NO                   AS FLD_AUD_STEP_NO      /*실지감사단계번호*/
			     , D2.AUD_YR                            AS AUD_YR               /*감사년도*/
			     , D2.AUD_NO                            AS AUD_NO               /*감사번호*/   
			     , F_DPT_INFO(D2.SPV_BRDV_CD,'1')       AS SPV_BRDV_NM          /*주관부서명*/
				 , F_DPT_INFO(D2.MNG_DPT_CD,'1')        AS MNG_DPT_NM           /*관리부서명*/			     
			     , F_DPT_INFO((SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = D2.SPV_BRDV_CD), '1') AS SPV_BRDV_UP_NM  /*주관부서명(국)*/
			     , TO_CHAR(TO_DATE(D1.AUD_STR_DT),'YYYY-MM-DD')||'~'|| TO_CHAR(TO_DATE(D1.AUD_END_DT),'YYYY-MM-DD')    AS AUD_ST_END_DT        /*실시기간*/
			     , D2.AUD_SBJ_NM					   AS AUD_SBJ_NM			/*감사사항명*/
                 , CASE WHEN NVL(D1.CTRL_TG_YN,'N') = 'N' THEN '-'
                        WHEN NVL(D1.CTRL_TG_YN,'N') = 'Y' AND NVL(D1.CTRL_YN,'N') = 'Y' THEN 'O' 
                        WHEN NVL(D1.CTRL_TG_YN,'N') = 'Y' AND NVL(D1.CTRL_YN,'N') = 'N' THEN 'X'
                    END AS CTRL_YN_DISP
                 , CASE WHEN NVL(D1.SND_YN,'N') = 'Y' THEN 'O' ELSE 'X' END AS SND_YN_DISP	
                 , (SELECT CASE WHEN D1.CALC_DTM_YN = 'Y' 
                                      THEN '확정'
                                ELSE  CASE WHEN COUNT(1)>0 THEN 'Y' ELSE 'N' END
                            END   
                      FROM TBBADDED011L
                     WHERE 1=1
                       AND BZT_YR  = D1.BZT_YR
                       AND BZT_SNO = D1.BZT_SNO
                    )  	AS EXP_YN 		/*수정가능여부를 판단하기 위함.*/	 
                 , '' 	AS SEL_YN		/*선택여부를 판단하기위함.(통제화면)*/        
                 , NVL(D3.IN_PSON_CNT,0)    AS IN_PSON_CNT
			     , NVL(D3.EXT_PSON_CNT,0)   AS EXT_PSON_CNT
			     , NVL(D3.IN_PSON_CNT,0)+ NVL(D3.EXT_PSON_CNT,0) AS PSON_CNT
			     , NVL(D3.IN_PSON_CNT,0)||'/'||NVL(D3.EXT_PSON_CNT,0)||'/'||(NVL(D3.IN_PSON_CNT,0)+ NVL(D3.EXT_PSON_CNT,0)) AS ALL_PSON_CNT 
			     , F_ORG_CNT_NM_AUD(D1.BZT_YR,D1.BZT_SNO,'BZT') AS ORG_CNT_NM
                 , (SELECT CASE WHEN COUNT(1)>0 THEN 'Y' ELSE 'N' END  
                      FROM TBBADDED004L
                     WHERE 1=1
                       AND BZT_YR  = D1.BZT_YR
                       AND BZT_SNO = D1.BZT_SNO
                    )  	AS TEAM_YN
                
                , TO_CHAR(TO_DATE(D1.AUD_STR_DT),'YYYY-MM-DD')||'~'|| TO_CHAR(TO_DATE(D1.AUD_END_DT),'YYYY-MM-DD') 
                  || '(' || D1.AUD_DCN || ')'                                                                      AS AUD_ST_END_DT_DCN  /*실시기간+일수 - 2015.06.02 yyh*/
                
                /* 출장예산구분 추가 - 2016.05.27 yyh */
                , D2.BZT_BGT_DVSN_CD                      AS BZT_BGT_DVSN_CD
                , F_CODE_NM('1000751',D2.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM                                                                            
			  FROM TBBADDED002M D1
			     , TBBADDED001M D2
			     , (
			        SELECT BZT_YR
			             , BZT_SNO
			             , SUM( CASE WHEN A.STF_DVSN_CD = '0' THEN 1 ELSE 0 END) AS IN_PSON_CNT  /*내부인원*/
			             , SUM( CASE WHEN A.STF_DVSN_CD = '0' THEN 0 ELSE 1 END) AS EXT_PSON_CNT /*외부인원*/
			          FROM (SELECT DISTINCT BZT_YR
			                     , BZT_SNO
			                     , PCT_CNB
			                     , STF_DVSN_CD
			                  FROM TBBADDED005L) A
			         GROUP BY BZT_YR, BZT_SNO 
			     ) D3			     
			WHERE 1=1
			  AND D1.BZT_DVSN_CD = '1' /*감사출장*/
			  AND D1.REL_AUD_YR = D2.AUD_YR
			  AND D1.REL_AUD_NO = D2.AUD_NO
			  AND D1.BZT_YR     = D3.BZT_YR(+)
			  AND D1.BZT_SNO    = D3.BZT_SNO(+)
			  AND D2.MNG_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#)))   /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/   		
		]]>			 
		<isNotEmpty property="strSpvBrdvCd">
			  AND D2.MNG_DPT_CD  = #strSpvBrdvCd#
		</isNotEmpty>      
		<isNotEmpty property="BZT_DVSN_CD">
			  AND D1.BZT_DVSN_CD = #BZT_DVSN_CD#
		</isNotEmpty>	  
		<isNotEmpty property="strAudYr">	 
			  AND D1.REL_AUD_YR      = #strAudYr#
		</isNotEmpty>
		<isNotEmpty property="strAudNo">	 	
			  AND D1.REL_AUD_NO      = #strAudNo#
		</isNotEmpty>
		
		<isNotNull property="strAudYrNoKndCd">
			<isNotEmpty property="strAudYrNoKndCd">	 	
	              /* 감사연번종류코드 - 2015.12.18 yyh */
				  AND SUBSTR(D2.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
			</isNotEmpty>		
		</isNotNull>
		
		<isNotEmpty property="strAudGrnNo">
			  /* 감사부여번호 추가 - 2016.05.27 yyh */	 	
			  AND D2.AUD_GRN_NO      = #strAudGrnNo#
		</isNotEmpty>		
		
		<isNotEmpty property="strAudSbjNm">	 	   
			  AND D2.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty property="strAudKndCd">	 
			  AND D2.AUD_KND_CD  = #strAudKndCd#		/*감사종류코드*/ 
		</isNotEmpty>
		<isNotEmpty property="strBztKndCd">	 
			  AND D1.AUD_BZT_KND_CD  = #strBztKndCd#		/*출장종류코드*/ 
		</isNotEmpty>
		<isNotEmpty property="strSpvBrdvCd">	 
			  AND D1.BZT_BRDV_CD = #strSpvBrdvCd#		 /*출장국과코드*/
		</isNotEmpty>   
		<isEqual property="strCtrlYn" compareValue="Y">
			  AND D1.CTRL_YN = 'Y'
		</isEqual>
		<isEqual property="strCtrlYn" compareValue="N">
			  AND NVL(D1.CTRL_YN,'N') = 'N'
		</isEqual>	
		<isEqual property="strSndYn" compareValue="Y">
			  AND D1.SND_YN = 'Y'
		</isEqual>
		<isEqual property="strSndYn" compareValue="N">
			  AND NVL(D1.SND_YN,'N') = 'N'
		</isEqual>					
		<isNotEmpty property="BZT_SNO">
			  AND D1.BZT_SNO = #BZT_SNO#
		</isNotEmpty>		
		<isNotEmpty property="BZT_YR">
			  AND D1.BZT_YR = #BZT_YR#
		</isNotEmpty>	
		<isEqual property="MASTER_YN" compareValue="MASTER" >
			 AND D1.CTRL_TG_YN = 'Y'
			 AND D1.SND_YN = 'Y'
		</isEqual>
		<isNotEmpty property="TIT_TXT">
			 AND D1.TIT_TXT LIKE #TIT_TXT#||'%'
		</isNotEmpty>
        
    	<include refid="include.pageOrder" />
	</select>
	
		
	<!--감사사항관리 insert-->
	<insert id="BADDED010EMainInsert" parameterClass="paramMap">
		INSERT INTO TBBADDED002M ( 
		      BZT_YR
		    , BZT_SNO
		    , BZT_DVSN_CD
		    , BZT_TL_CNB
		    , BZT_TL_BRDV_CD
		    , BZT_TL_RANK_CD
		    , TIT_TXT
		    , BZT_BRDV_CD
		    , HLDY_ACTV_DVSN_CD
		    , REL_AUD_YR
		    , REL_AUD_NO
		    , AUD_STEP_SNO
		    , BZT_TXT
		    , CTRL_YN
		    , SPRT_NO
		    , GEN_BZT_KND_CD
		    , REGI_DT
		    , AUD_STR_DT
		    , AUD_END_DT
		    , AUD_DCN
		    , AUD_BZT_KND_CD
		    , LEAD_EXS_PMT_YN
		    , CTRL_TG_YN
		    , CTRL_DT
		    , SND_YN
		    , SND_DT
		    , FLD_AUD_STEP_NO
		    , CALC_DTM_YN       /* 계산확정여부 - 2016.09.27 yyh */
		    , USE_VHCLE  
		    , FRT_USR_ID
		    , FNL_USR_ID
		    , FNL_DEAL_DPT_CD
		    , FNL_MNU_ID
		    , FRT_REGI_DH
		    , FNL_MDF_DH 
		) VALUES (
		      #BZT_YR#
		    , #BZT_SNO#
		    , #BZT_DVSN_CD#
		    , #BZT_TL_CNB#
		    , #BZT_TL_BRDV_CD#
		    , #BZT_TL_RANK_CD#
		    , #TIT_TXT#
		    , #BZT_BRDV_CD#
		    , #HLDY_ACTV_DVSN_CD#
		    , #REL_AUD_YR#
		    , #REL_AUD_NO#
		    , #AUD_STEP_SNO#
		    , #BZT_TXT#
		    , #CTRL_YN#
		    , #SPRT_NO#
		    , #GEN_BZT_KND_CD#
		    , #REGI_DT#
		    , #AUD_STR_DT#
		    , #AUD_END_DT#
		    , #AUD_DCN#
		    , #AUD_BZT_KND_CD#
		    , #LEAD_EXS_PMT_YN#
		    , #CTRL_TG_YN#
		    , #CTRL_DT#
		    , #SND_YN#
		    , #SND_DT#
		    , #FLD_AUD_STEP_NO#
		    , 'N'
		    , nvl(#USE_VHCLE#,'N')
		    , #FRT_USR_ID#
		    , #FNL_USR_ID#
		    , #FNL_DEAL_DPT_CD#
		    , #FNL_MNU_ID#
		    , SYSDATE
		    , SYSDATE
		)

	</insert>
	
	<!--감사사항관리 update-->
	<update id="BADDED010EMainUpdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBBADDED002M
			   SET BZT_YR                 = #BZT_YR# 
			     , BZT_SNO                = #BZT_SNO# 		
			   
		]]>	    
		<isNotNull prepend="," property="BZT_DVSN_CD">
			   	   BZT_DVSN_CD            = #BZT_DVSN_CD#
		</isNotNull>
		<isNotNull prepend="," property="BZT_TL_CNB">	       
			       BZT_TL_CNB            = #BZT_TL_CNB#
		</isNotNull>
		<isNotNull prepend="," property="BZT_TL_BRDV_CD">	       
			       BZT_TL_BRDV_CD           = #BZT_TL_BRDV_CD#
		</isNotNull>			       
		<isNotNull prepend="," property="BZT_TL_RANK_CD">	       
			       BZT_TL_RANK_CD                  = #BZT_TL_RANK_CD#
		</isNotNull>				       
		<isNotNull prepend="," property="TIT_TXT">	       
			       TIT_TXT                  = #TIT_TXT#             
		</isNotNull>	       
		<isNotNull prepend="," property="BZT_BRDV_CD">	       
			       BZT_BRDV_CD            = #BZT_BRDV_CD#            
		</isNotNull>		
		<isNotNull prepend="," property="HLDY_ACTV_DVSN_CD">	       
			       HLDY_ACTV_DVSN_CD             = #HLDY_ACTV_DVSN_CD#       
		</isNotNull>		
		<isNotNull prepend="," property="REL_AUD_YR">	       
			       REL_AUD_YR           = #REL_AUD_YR#     
		</isNotNull>			
		<isNotNull prepend="," property="REL_AUD_NO">	       
			       REL_AUD_NO         = #REL_AUD_NO#
		</isNotNull>			
		<isNotNull prepend="," property="AUD_STEP_SNO">	       
			       AUD_STEP_SNO            = #AUD_STEP_SNO#
		</isNotNull>			
		<isNotNull prepend="," property="BZT_TXT">	       
			        BZT_TXT          = #BZT_TXT#
		</isNotNull>			
		<isNotNull prepend="," property="CTRL_YN">	       
			        CTRL_YN          = #CTRL_YN#
		</isNotNull>			
		<isNotNull prepend="," property="SPRT_NO">	       
			        SPRT_NO           = #SPRT_NO#
		</isNotNull>				
		<isNotNull prepend="," property="GEN_BZT_KND_CD">	       
			         GEN_BZT_KND_CD     = #GEN_BZT_KND_CD#
		</isNotNull>				
		<isNotNull prepend="," property="REGI_DT">	       
			        REGI_DT     = #REGI_DT#    
		</isNotNull>			
		<isNotNull prepend="," property="AUD_STR_DT">	       
			        AUD_STR_DT   = #AUD_STR_DT#      
		</isNotNull>		
		<isNotNull prepend="," property="AUD_END_DT">	       
			        AUD_END_DT        = #AUD_END_DT#
		</isNotNull>		
		<isNotNull prepend="," property="AUD_DCN">	       
			       AUD_DCN        = #AUD_DCN#
		</isNotNull>	
		<isNotNull prepend="," property="AUD_BZT_KND_CD">	       
			       AUD_BZT_KND_CD   = #AUD_BZT_KND_CD#
		</isNotNull>	
		<isNotNull prepend="," property="LEAD_EXS_PMT_YN">	       
			       LEAD_EXS_PMT_YN         = #LEAD_EXS_PMT_YN#
		</isNotNull>	
		<isNotNull prepend="," property="CTRL_TG_YN">	       
			      CTRL_TG_YN    = #CTRL_TG_YN#
		</isNotNull>	
		<isNotNull prepend="," property="CTRL_DT">	       
			      CTRL_DT         = #CTRL_DT#
		</isNotNull>		
		<isNotNull prepend="," property="USE_VHCLE">	       
			     USE_VHCLE                 = nvl(#USE_VHCLE#,'N')
		</isNotNull>		
		<isNotNull prepend="," property="SND_YN">	       
			     SND_YN               = #SND_YN#
		</isNotNull>		
		<isNotNull prepend="," property="SND_DT">	       
			     SND_DT                 = #SND_DT#
		</isNotNull>
		<isNotNull prepend="," property="FLD_AUD_STEP_NO">	       
			     FLD_AUD_STEP_NO                 = #FLD_AUD_STEP_NO#
		</isNotNull>
		<isNotNull prepend="," property="FNL_USR_ID">	       
			     FNL_USR_ID                 = #FNL_USR_ID#
		</isNotNull>	
		<isNotNull prepend="," property="FNL_DEAL_DPT_CD">	       
			     FNL_DEAL_DPT_CD                 = #FNL_DEAL_DPT_CD#
		</isNotNull>		
		<isNotNull prepend="," property="FNL_MNU_ID">	       
			     FNL_MNU_ID                 = #FNL_MNU_ID#
		</isNotNull>
				  , FNL_MDF_DH              = SYSDATE						
			  WHERE 1=1
				AND BZT_YR                 = #BZT_YR# 
			    AND BZT_SNO                = #BZT_SNO#     
	</update>
	
	<!--감사사항관리 delete-->
	<update id="BADDED010EMainDelete" parameterClass="paramMap">
		   DELETE 
			 FROM 	TBBADDED002M
			WHERE 1=1
			  AND BZT_YR                 = #BZT_YR# 
		      AND BZT_SNO                = #BZT_SNO# 
	</update>
	
	<!-- 출장순번 Max값 찾기 -->
	<select id="BADDED010EMainMaxSnoSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(BZT_SNO)),0)+1) AS MAX_SEQ
				  FROM TBBADDED002M
				 WHERE 1=1
					AND BZT_YR = #BZT_YR#
		]]>
	</select>
	
	<!-- 감사단계 Max값 찾기 -->
	<select id="BADDED010EAudStepMaxSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(AUD_STEP_SNO)),0)+1) AS MAX_AUD_STEP_SNO
				  FROM TBBADDED002M
				 WHERE 1=1
					AND REL_AUD_YR = #REL_AUD_YR#
					AND REL_AUD_NO = #REL_AUD_NO#
		]]>
	</select>	


	<!-- 출장조를 조회한다.  -->
	<select id="BADDED010ETeamSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[   	
			SELECT D1.TEAM_SNO		AS TEAM_SNO		/*조순번*/
			     , D1.BZT_SNO		AS BZT_SNO		/*출장순번*/
			     , D1.BZT_YR		AS BZT_YR		/*출장년도*/
			     , D1.TEAM_NM		AS TEAM_NM		/*조명*/
			     , D1.DVDT_TSK_TXT 	AS DVDT_TSK_TXT	/*분장업무내용*/
			  FROM TBBADDED004L D1
			 WHERE 1=1
			   AND D1.BZT_SNO = #strBztSno#
			   AND D1.BZT_YR  = #strBztYr#
		]]>
	</select>	


	<!--출장조 insert-->
	<insert id="BADDED010ETeamInsert" parameterClass="paramMap">
		INSERT INTO TBBADDED004L(
		      TEAM_SNO
		    , BZT_SNO
		    , BZT_YR
		    , TEAM_NM
		    , DVDT_TSK_TXT
		    , FRT_USR_ID
		    , FNL_USR_ID
		    , FNL_DEAL_DPT_CD
		    , FNL_MNU_ID
		    , FRT_REGI_DH
		    , FNL_MDF_DH 
		)VALUES (
		     #TEAM_SNO#
		    ,#BZT_SNO#
		    ,#BZT_YR#
		    ,#TEAM_NM#
		    ,#DVDT_TSK_TXT#
		    ,#FRT_USR_ID#
		    ,#FNL_USR_ID#
		    ,#FNL_DEAL_DPT_CD#
		    ,#FNL_MNU_ID#
		    ,SYSDATE
		    ,SYSDATE
		) 
	</insert>

	<!--출장조 update-->
	<update id="BADDED010ETeamUpdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBBADDED004L
			   SET TEAM_SNO          = #TEAM_SNO# 
			     , BZT_SNO           = #BZT_SNO# 		
			     , BZT_YR			 = #BZT_YR# 		
		]]>	    
		<isNotNull prepend="," property="TEAM_NM">
			   	   TEAM_NM            = #TEAM_NM#
		</isNotNull>
		<isNotNull prepend="," property="DVDT_TSK_TXT">	       
			       DVDT_TSK_TXT            = #DVDT_TSK_TXT#
		</isNotNull>
		<isNotNull prepend="," property="FNL_USR_ID">	       
			     FNL_USR_ID                 = #FNL_USR_ID#
		</isNotNull>	
		<isNotNull prepend="," property="FNL_DEAL_DPT_CD">	       
			     FNL_DEAL_DPT_CD                 = #FNL_DEAL_DPT_CD#
		</isNotNull>		
		<isNotNull prepend="," property="FNL_MNU_ID">	       
			     FNL_MNU_ID                 = #FNL_MNU_ID#
		</isNotNull>		
				  , FNL_MDF_DH              = SYSDATE							
			  WHERE 1=1
			    AND TEAM_SNO			   = #TEAM_SNO# 
				AND BZT_YR                 = #BZT_YR# 
			    AND BZT_SNO                = #BZT_SNO#     
	</update>


	<!--출장조 delete-->
	<update id="BADDED010ETeamDelete" parameterClass="paramMap">
		   DELETE 
			 FROM 	TBBADDED004L
			WHERE 1=1
			    AND TEAM_SNO			   = #TEAM_SNO# 
				AND BZT_YR                 = #BZT_YR# 
			    AND BZT_SNO                = #BZT_SNO#     
	</update>

	<!-- 출장조 순번 Max값 찾기 -->
	<select id="BADDED010ETeamMaxSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(TEAM_SNO)),0)+1) AS MAX_TEAM_SNO
				  FROM TBBADDED004L
				 WHERE 1=1
				   AND BZT_YR   = #BZT_YR# 
				   AND BZT_SNO  = #BZT_SNO#     
		]]>
	</select>	
    

	<!-- 대상기관을 조회한다.  -->
	<select id="BADDED010EOrgSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[   	
			SELECT D1.TEAM_SNO              AS TEAM_SNO         /*조순번*/
			     , D1.BGRP_TG_ORG_SNO       AS BGRP_TG_ORG_SNO  /*조별대상기관순번*/  
			     , D1.BZT_SNO               AS BZT_SNO          /*출장순번*/
			     , D1.BZT_YR                AS BZT_YR           /*출장년도*/
			     , D1.ORG_CD                AS ORG_CD           /*기관코드*/
			     , F_ORG_INFO(D1.ORG_CD,'1')                    AS ORG_NM           /*기관명*/
			     , D1.RGN_CD                AS RGN_CD           /*지역코드*/
			     , F_CODE_NM('1000001',D1.RGN_CD)               AS RGN_NM           /*지역명*/
			     , D1.AUD_STR_DT            AS AUD_STR_DT       /*감사시작일*/
			     , D1.AUD_END_DT            AS AUD_END_DT       /*감사종료일*/
			     , D1.AUDT_DPT_NM           AS AUDT_DPT_NM      /*수감부서명*/
			     , D1.LODG_YN               AS LODG_YN          /*숙박여부*/
			     , D1.STGT_MV_AREA_YN       AS STGT_MV_AREA_YN  /*연속이동지여부*/
			     
			     , D2.PSON_CNT              AS PSON_CNT         /*인원   - 2015.06.02 yyh*/
			     , D2.MAN_DAY               AS MAN_DAY          /*연인원 - 2015.06.02 yyh*/
			     , D2.AUD_DAYS              AS AUD_DAYS         /*일수   - 2015.06.02 yyh*/
			  FROM TBBADDED008L D1
			      ,(SELECT  BZT_YR
					      , BZT_SNO
					      , TEAM_SNO
					      , BGRP_TG_ORG_SNO
					      , COUNT(*)         AS PSON_CNT
					      , SUM(AUD_DCN)     AS MAN_DAY
					      , MAX(AUD_DCN)     AS AUD_DAYS
					  FROM TBBADDED006L
					 WHERE 1=1
       ]]>
       
				<isNotEmpty property="strTeamSno">	 
					   AND TEAM_SNO = #strTeamSno#
				</isNotEmpty>   		
				<isNotEmpty property="strBztSno">	 
					   AND BZT_SNO = #strBztSno#
				</isNotEmpty>  
				<isNotEmpty property="strBztYr">	 
					   AND BZT_YR = #strBztYr#
				</isNotEmpty>  					  
		 		<isNotEmpty property="TEAM_SNO">	 
					   AND TEAM_SNO = #TEAM_SNO#
				</isNotEmpty>   		
				<isNotEmpty property="BZT_SNO">	 
					   AND BZT_SNO = #BZT_SNO#
				</isNotEmpty>  
				<isNotEmpty property="BZT_YR">	 
					   AND BZT_YR = #BZT_YR#
				</isNotEmpty>  		
       <![CDATA[					   
					 GROUP BY BZT_YR
					         ,BZT_SNO
					         ,TEAM_SNO
					         ,BGRP_TG_ORG_SNO) D2
			 WHERE 1=1
			   AND D1.BZT_YR          = D2.BZT_YR(+)
			   AND D1.BZT_SNO         = D2.BZT_SNO(+)
			   AND D1.TEAM_SNO        = D2.TEAM_SNO(+)
			   AND D1.BGRP_TG_ORG_SNO = D2.BGRP_TG_ORG_SNO(+)
		]]>			 
		<isNotEmpty property="strTeamSno">	 
			   AND D1.TEAM_SNO = #strTeamSno#
		</isNotEmpty>   		
		<isNotEmpty property="strBztSno">	 
			   AND D1.BZT_SNO = #strBztSno#
		</isNotEmpty>  
		<isNotEmpty property="strBztYr">	 
			   AND D1.BZT_YR = #strBztYr#
		</isNotEmpty>  					  
 		<isNotEmpty property="TEAM_SNO">	 
			   AND D1.TEAM_SNO = #TEAM_SNO#
		</isNotEmpty>   		
		<isNotEmpty property="BZT_SNO">	 
			   AND D1.BZT_SNO = #BZT_SNO#
		</isNotEmpty>  
		<isNotEmpty property="BZT_YR">	 
			   AND D1.BZT_YR = #BZT_YR#
		</isNotEmpty>  					  
			 ORDER BY D1.TEAM_SNO     
			        , D1.BZT_SNO
			        , D1.BZT_YR
			        , D1.BGRP_TG_ORG_SNO
	</select>	

	<!--대상기관 insert-->
	<insert id="BADDED010EOrgInsert" parameterClass="paramMap">
		INSERT INTO TBBADDED008L ( 
		      TEAM_SNO     
		    , BGRP_TG_ORG_SNO       
		    , BZT_SNO      
		    , BZT_YR       
		    , ORG_CD       
		    , RGN_CD       
		    , AUD_STR_DT   
		    , AUD_END_DT           
		    , AUDT_DPT_NM          
		    , LODG_YN      
		    , STGT_MV_AREA_YN 
		    , FRT_USR_ID
		    , FNL_USR_ID
		    , FNL_DEAL_DPT_CD
		    , FNL_MNU_ID
		    , FRT_REGI_DH
		    , FNL_MDF_DH 
		)VALUES( 
		      #TEAM_SNO#
		    , #BGRP_TG_ORG_SNO#
		    , #BZT_SNO#
		    , #BZT_YR#
		    , #ORG_CD#
		    , #RGN_CD#
		    , #AUD_STR_DT#
		    , #AUD_END_DT#
		    , #AUDT_DPT_NM#
		    , #LODG_YN#
		    , #STGT_MV_AREA_YN#
		    , #FRT_USR_ID#
		    , #FNL_USR_ID#
		    , #FNL_DEAL_DPT_CD#
		    , #FNL_MNU_ID#
		    , SYSDATE
		    , SYSDATE
		)
	</insert>

	<!--대상기관  update-->
	<update id="BADDED010EOrgUpdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBBADDED008L
			   SET TEAM_SNO          = #TEAM_SNO# 
			     , BZT_SNO           = #BZT_SNO# 		
			     , BZT_YR			 = #BZT_YR#     
    			 , BGRP_TG_ORG_SNO   = #BGRP_TG_ORG_SNO# 	
		]]>	    
		<isNotNull prepend="," property="ORG_CD">
			   	   ORG_CD            = #ORG_CD#
		</isNotNull>
		<isNotNull prepend="," property="RGN_CD">	       
			       RGN_CD            = #RGN_CD#
		</isNotNull>
		<isNotNull prepend="," property="AUD_STR_DT">
			   	   AUD_STR_DT            = #AUD_STR_DT#
		</isNotNull>
		<isNotNull prepend="," property="AUD_END_DT">	       
			       AUD_END_DT            = #AUD_END_DT#
		</isNotNull>
		<isNotNull prepend="," property="AUDT_DPT_NM">
			   	   AUDT_DPT_NM            = #AUDT_DPT_NM#
		</isNotNull>
		<isNotNull prepend="," property="LODG_YN">	       
			       LODG_YN            = #LODG_YN#
		</isNotNull>
		<isNotNull prepend="," property="STGT_MV_AREA_YN">
			   	   STGT_MV_AREA_YN            = #STGT_MV_AREA_YN#
		</isNotNull>
		<isNotNull prepend="," property="FNL_USR_ID">	       
			     FNL_USR_ID                 = #FNL_USR_ID#
		</isNotNull>	
		<isNotNull prepend="," property="FNL_DEAL_DPT_CD">	       
			     FNL_DEAL_DPT_CD                 = #FNL_DEAL_DPT_CD#
		</isNotNull>		
		<isNotNull prepend="," property="FNL_MNU_ID">	       
			     FNL_MNU_ID                 = #FNL_MNU_ID#
		</isNotNull>		
				  , FNL_MDF_DH              = SYSDATE							
			  WHERE 1=1
			    AND TEAM_SNO	= #TEAM_SNO# 
				AND BZT_YR      = #BZT_YR# 
			    AND BZT_SNO     = #BZT_SNO#    
    			AND BGRP_TG_ORG_SNO  	= #BGRP_TG_ORG_SNO# 	  
	</update>


	<!--대상기관 delete-->
	<update id="BADDED010EOrgDelete" parameterClass="paramMap">
		   DELETE 
			 FROM 	TBBADDED008L
			WHERE 1=1
			    AND BZT_YR                 = #BZT_YR# 
			    AND BZT_SNO                = #BZT_SNO#
		<isNotEmpty property="TEAM_SNO">			     
    			AND TEAM_SNO			   = #TEAM_SNO#
    	</isNotEmpty>	
    	<isNotEmpty property="BGRP_TG_ORG_SNO">	
    			AND BGRP_TG_ORG_SNO  	   = #BGRP_TG_ORG_SNO#
    	</isNotEmpty>		 	    
	</update>

	<!-- 대상기관 순번 Max값 찾기 -->
	<select id="BADDED010EOrgMaxSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(BGRP_TG_ORG_SNO)),0)+1) AS MAX_BGRP_TG_ORG_SNO
				  FROM TBBADDED008L
				 WHERE 1=1
			       AND TEAM_SNO			   = #TEAM_SNO# 
				   AND BZT_YR              = #BZT_YR# 
			       AND BZT_SNO             = #BZT_SNO#  
		]]>
	</select>	
	
	
	
	<!-- 출장자를 조회한다.  -->
	<select id="BADDED010EPerSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[   	
			SELECT D1.TEAM_SNO         AS TEAM_SNO         /*조순번*/
			     , D1.PCT_ALC_SNO      AS PCT_ALC_SNO      /*출장자배정순번*/
			     , D1.BZT_SNO          AS BZT_SNO          /*출장순번*/
			     , D1.BZT_YR           AS BZT_YR           /*출장년도*/
			     , D1.STF_DVSN_CD      AS STF_DVSN_CD      /*직원구분코드*/
			     , D1.PCT_CNB          AS PCT_CNB          /*출장자전산번호*/
			     , D1.PCT_NM           AS PCT_NM           /*출장자명*/        
			     , D1.BLT_BRDV_CD      AS BLT_BRDV_CD      /*소속국과코드*/
			     , F_DPT_INFO(D1.BLT_BRDV_CD,'1')          AS BLT_BRDV_NM      /*소속국과명*/ 
			     , D1.PCT_RANK_CD      AS PCT_RANK_CD      /*직급코드*/
			     , F_CODE_NM('1000173', D1.PCT_RANK_CD)    AS RANK_NM          /*직급명*/
			     , D1.DEP_RGN_CD       AS DEP_RGN_CD       /*출발지역코드*/
			     , D1.BZT_STR_DT       AS BZT_STR_DT       /*출장시작일*/
			     , D1.BZT_END_DT       AS BZT_END_DT       /*출장종료일*/
			     , D1.TEAM_CHIF_YN     AS TEAM_CHIF_YN     /*조장여부*/
			     , D1.PCT_OCP_CD       AS PCT_OCP_CD       /*직종코드*/
			     , D1.EXTL_ORG_CD      AS EXTL_ORG_CD      /*외부기관코드*/
			     , D1.EXTL_ORG_NM      AS EXTL_ORG_NM      /*외부기관명*/
			     , (SELECT MAX(SUM(D2.BZT_DCN)) AS BZT_DCN 
					  FROM TBBADDED006L D2
					 WHERE D2.BZT_YR      = D1.BZT_YR
					   AND D2.BZT_SNO     = D1.BZT_SNO
					   AND D2.TEAM_SNO    = D1.TEAM_SNO
					   AND D2.PCT_ALC_SNO = D1.PCT_ALC_SNO
					 GROUP BY D2.BZT_YR
					         ,D2.BZT_SNO
					         ,D2.TEAM_SNO
					         ,D2.PCT_ALC_SNO) AS BZT_DCN /* 출장일수 - 2015.06.02 yyh */
			  FROM TBBADDED005L D1
			 WHERE 1=1
		]]>			 
		<isNotEmpty property="strTeamSno">	 
			   AND D1.TEAM_SNO = #strTeamSno#
		</isNotEmpty> 
		<isNotEmpty property="strBztSno">	 
			   AND D1.BZT_SNO  = #strBztSno#
		</isNotEmpty> 
		<isNotEmpty property="strBztYr">	 
			   AND D1.BZT_YR   = #strBztYr#	
		</isNotEmpty> 
		<isNotEmpty property="TEAM_SNO">	 
			   AND D1.TEAM_SNO = #TEAM_SNO#
		</isNotEmpty>   		
		<isNotEmpty property="BZT_SNO">	 
			   AND D1.BZT_SNO = #BZT_SNO#
		</isNotEmpty>  
		<isNotEmpty property="BZT_YR">	 
			   AND D1.BZT_YR = #BZT_YR#
		</isNotEmpty>  						   
        <![CDATA[  			   	 
			 ORDER BY D1.TEAM_SNO     
			        , D1.BZT_SNO
			        , D1.BZT_YR
			        , D1.PCT_ALC_SNO
		]]>
	</select>	

	<!--출장자 insert-->
	<insert id="BADDED010EPerInsert" parameterClass="paramMap">
		INSERT INTO TBBADDED005L ( 
		      TEAM_SNO
		    , PCT_ALC_SNO
		    , BZT_SNO
		    , BZT_YR
		    , STF_DVSN_CD
		    , PCT_CNB
		    , PCT_NM
		    , BLT_BRDV_CD
		    , PCT_RANK_CD
		    , DEP_RGN_CD
		    , BZT_STR_DT
		    , BZT_END_DT
		    , TEAM_CHIF_YN
		    , PCT_OCP_CD
		    , EXTL_ORG_CD
		    , EXTL_ORG_NM
		    , FRT_USR_ID
		    , FNL_USR_ID
		    , FNL_DEAL_DPT_CD
		    , FNL_MNU_ID
		    , FRT_REGI_DH
		    , FNL_MDF_DH
		 ) VALUES ( 
		      #TEAM_SNO#
		    , #PCT_ALC_SNO#
		    , #BZT_SNO#
		    , #BZT_YR#
		    , #STF_DVSN_CD#
		    , #PCT_CNB#
		    , #PCT_NM#
		    , #BLT_BRDV_CD#
		    , #PCT_RANK_CD#
		    , #DEP_RGN_CD#
		    , #BZT_STR_DT#
		    , #BZT_END_DT#
		    , #TEAM_CHIF_YN#
		    , #PCT_OCP_CD#
		    , #EXTL_ORG_CD#
		    , #EXTL_ORG_NM#
		    , #FRT_USR_ID#
		    , #FNL_USR_ID#
		    , #FNL_DEAL_DPT_CD#
		    , #FNL_MNU_ID#
		    , SYSDATE
		    , SYSDATE
		 ) 
	</insert>

	<!--출장자  update-->
	<update id="BADDED010EPerUpdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBBADDED005L
			   SET TEAM_SNO          = #TEAM_SNO# 
			     , BZT_SNO           = #BZT_SNO# 		
			     , BZT_YR			 = #BZT_YR#     
    			 , PCT_ALC_SNO  	 = #PCT_ALC_SNO# 	
		]]>	    
		<isNotNull prepend="," property="STF_DVSN_CD">
			   	   STF_DVSN_CD            = #STF_DVSN_CD#
		</isNotNull>
		<isNotNull prepend="," property="PCT_CNB">	       
			       PCT_CNB            = #PCT_CNB#
		</isNotNull>
		<isNotNull prepend="," property="PCT_NM">
			   	   PCT_NM            = #PCT_NM#
		</isNotNull>
		<isNotNull prepend="," property="BLT_BRDV_CD">	       
			       BLT_BRDV_CD            = #BLT_BRDV_CD#
		</isNotNull>
		<isNotNull prepend="," property="PCT_RANK_CD">
			   	   PCT_RANK_CD            = #PCT_RANK_CD#
		</isNotNull>
		<isNotNull prepend="," property="DEP_RGN_CD">	       
			       DEP_RGN_CD            = #DEP_RGN_CD#
		</isNotNull>
		<isNotNull prepend="," property="BZT_STR_DT">
			   	   BZT_STR_DT            = #BZT_STR_DT#
		</isNotNull>
		<isNotNull prepend="," property="BZT_END_DT">
			   	   BZT_END_DT            = #BZT_END_DT#
		</isNotNull>
		<isNotNull prepend="," property="TEAM_CHIF_YN">
			   	   TEAM_CHIF_YN            = #TEAM_CHIF_YN#
		</isNotNull>
		<isNotNull prepend="," property="PCT_OCP_CD">
			   	   PCT_OCP_CD            = #PCT_OCP_CD#
		</isNotNull>
		<isNotNull prepend="," property="EXTL_ORG_CD">
			   	   EXTL_ORG_CD            = #EXTL_ORG_CD#
		</isNotNull>
		<isNotNull prepend="," property="EXTL_ORG_NM">
			   	   EXTL_ORG_NM            = #EXTL_ORG_NM#
		</isNotNull>
		<isNotNull prepend="," property="FNL_USR_ID">	       
			     FNL_USR_ID                 = #FNL_USR_ID#
		</isNotNull>	
		<isNotNull prepend="," property="FNL_DEAL_DPT_CD">	       
			     FNL_DEAL_DPT_CD                 = #FNL_DEAL_DPT_CD#
		</isNotNull>		
		<isNotNull prepend="," property="FNL_MNU_ID">	       
			     FNL_MNU_ID                 = #FNL_MNU_ID#
		</isNotNull>		
				  , FNL_MDF_DH              = SYSDATE						
			  WHERE 1=1
			    AND TEAM_SNO	= #TEAM_SNO# 
				AND BZT_YR      = #BZT_YR# 
			    AND BZT_SNO     = #BZT_SNO#    
    			AND PCT_ALC_SNO	= #PCT_ALC_SNO# 	  
	</update>


	<!--출장자 delete-->
	<update id="BADDED010EPerDelete" parameterClass="paramMap">
		   DELETE 
			 FROM TBBADDED005L
			WHERE 1=1
				AND BZT_YR                 = #BZT_YR# 
			    AND BZT_SNO                = #BZT_SNO# 
		<isNotEmpty property="TEAM_SNO">		    
			    AND TEAM_SNO			   = #TEAM_SNO# 
    	</isNotEmpty>	
    	<isNotEmpty property="PCT_ALC_SNO">		
    			AND PCT_ALC_SNO  		   = #PCT_ALC_SNO# 	    
    	</isNotEmpty>		
	</update>

	<!-- 출장자 순번 Max값 찾기 -->
	<select id="BADDED010EPerMaxSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(PCT_ALC_SNO)),0)+1) AS MAX_PCT_ALC_SNO
				  FROM TBBADDED005L
				 WHERE 1=1
			       AND TEAM_SNO			   = #TEAM_SNO# 
				   AND BZT_YR              = #BZT_YR# 
			       AND BZT_SNO             = #BZT_SNO#  
		]]>
	</select>	

	<!-- 외부자일경우 전산번호 찾기 -->	
	<select id="BADDED010EPctCnbSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     		
			SELECT MAX(PCT_CNB) AS PCT_CNB
			  FROM( 	
					SELECT PCT_CNB
					  FROM TBBADDED005L
					 WHERE PCT_NM      = #PCT_NM#
					   AND EXTL_ORG_CD = #EXTL_ORG_CD#
				    UNION ALL 
				    SELECT PCT_CNB 
				      FROM TBBADDED010L
				     WHERE PCT_NM      = #PCT_NM#
				       AND EXTL_ORG_CD = #EXTL_ORG_CD#			   
				 ) 				   	
		]]>
	</select>	
	
	<!-- 외부인의 경우 Max전산번호 찾아 부여하기 -->	
	<select id="BADDED010EMaxPctCnbSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     		
			SELECT NVL(MAX(TO_NUMBER(PCT_CNB)),0) + 1 AS MAX_PCT_CNB
			  FROM (
			  		SELECT PCT_CNB 
			  		  FROM TBBADDED005L
			  		UNION ALL
			  		SELECT PCT_CNB 
			  		  FROM TBBADDED010L
			  ) 
		]]>
	</select>	

	<select id="BADDED010ECountHoliday" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     		
			SELECT COUNT(1) AS HOL_CNT 
			  FROM TBBADDED013B
			 WHERE 1=1
			   AND YE||MD BETWEEN #strFromDt# AND #strToDt#
		]]>
	</select>	


	<select id="BADDED010EIsHoliday" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     		
			SELECT COUNT(1)	AS HOL_CNT
			  FROM TBBADDED013B
			 WHERE 1=1
			   AND YE||MD = #strDate# 
		]]>
	</select>	


	<select id="BADDED010ESelectRgn" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			SELECT DEP_RGN_CD        /*출발지역코드*/
			     , ARV_RGN_CD        /*도착지역코드*/
			     , RGN_DVSN_CD       /*지역구분코드*/
			     , MDF_DT            /*수정일*/
			     , CPRG_LN_DVSN_CD   /*수도권거리구분코드 - 2015.04.23 yyh */
			  FROM TBBADDED014B
			 WHERE 1=1
			   AND DEP_RGN_CD = #DEP_RGN_CD#
			   AND ARV_RGN_CD = #ARV_RGN_CD#
		]]>
	</select>	
	
	<select id="BADDED010ESelectRgn1" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			SELECT CD
			      ,CD_NM
			      ,USR_DFN_TXT_1 /*사용자정의내용 - 서울:1, 광역시:2, 지방:3 으로 분리*/
			  FROM TBDCMACM013C 			  
			 WHERE 1=1
			   AND CMM_CD_DVSN_CD = '1000001'
			   AND CD             = #ARV_RGN_CD#
		]]>
	</select>
	
	
	<!--개인별출장내역 select-->
	<select id="BADDED010EPerBztSelect" parameterClass="paramMap"
		resultClass="resultMap">	
        <![CDATA[    		
			SELECT D1.TEAM_SNO     /*조순번*/
			     , D1.PCT_ALC_SNO  /*출장자배정순번*/
			     , D1.BGRP_TG_ORG_SNO      /*조별대상기관순번*/    
			     , D1.BZT_SNO      /*출장순번*/
			     , D1.BZT_YR       /*출장년도*/
			     , D1.BZT_STR_DT   /*출장시작일*/
			     , D1.BZT_END_DT   /*출장종료일*/
			     , D1.BZT_DCN      /*출장일수*/
			     , D1.AUD_STR_DT   /*감사시작일*/
			     , D1.AUD_END_DT   /*감사종료일*/
			     , D1.AUD_DCN      /*감사일수*/
			     , D1.LODG_DCN     /*숙박일수*/
                 , D2.STF_DVSN_CD 
                 , D2.PCT_CNB
                 , D2.PCT_NM||'('||D2.PCT_CNB||')' AS PCT_CNB_NM
                 , F_DPT_INFO(D2.BLT_BRDV_CD,'1')||'/'||F_CODE_NM('1000173',D2.PCT_RANK_CD) AS DPT_AND_RANK
                 , SUBSTR(D1.BZT_STR_DT,1,4)||'-'||SUBSTR(D1.BZT_STR_DT,5,2)||'-'||SUBSTR(D1.BZT_STR_DT,7,2)||'~'
                  ||SUBSTR(D1.BZT_END_DT,1,4)||'-'||SUBSTR(D1.BZT_END_DT,5,2)||'-'||SUBSTR(D1.BZT_END_DT,7,2)
                  ||'('||D1.BZT_DCN||'일)'  AS BZT_DT_AND_DCN
                 , SUBSTR(D1.AUD_STR_DT,1,4)||'-'||SUBSTR(D1.AUD_STR_DT,5,2)||'-'||SUBSTR(D1.AUD_STR_DT,7,2)||'~'
                  ||SUBSTR(D1.AUD_END_DT,1,4)||'-'||SUBSTR(D1.AUD_END_DT,5,2)||'-'||SUBSTR(D1.AUD_END_DT,7,2)
                  ||'('||D1.AUD_DCN||'일)'  AS AUD_DT_AND_DCN       
                 , D1.LODG_DCN ||'일' AS LODG_DCN_NM
			  FROM TBBADDED006L D1
                 , TBBADDED005L D2
            WHERE 1=1
              AND D1.TEAM_SNO    = D2.TEAM_SNO
              AND D1.PCT_ALC_SNO = D2.PCT_ALC_SNO
              AND D1.BZT_SNO     = D2.BZT_SNO
              AND D1.BZT_YR      = D2.BZT_YR
		]]>
		<isNotEmpty property="BGRP_TG_ORG_SNO">
				AND D1.BGRP_TG_ORG_SNO = #BGRP_TG_ORG_SNO#
		</isNotEmpty>	
		<isNotEmpty property="TEAM_SNO">
				AND D1.TEAM_SNO = #TEAM_SNO#
		</isNotEmpty>		
		<isNotEmpty property="BZT_SNO">
				AND D1.BZT_SNO = #BZT_SNO#
		</isNotEmpty>		
		<isNotEmpty property="BZT_YR">
				AND D1.BZT_YR = #BZT_YR#
		</isNotEmpty>		
		   ORDER BY D1.PCT_ALC_SNO	 
	</select>
		

	<!--개인별출장내역 delete-->
	<update id="BADDED010EPerBztDelete" parameterClass="paramMap">
		   DELETE 
			 FROM TBBADDED006L
			WHERE 1=1
			  AND BZT_YR        = #BZT_YR# 
			  AND BZT_SNO       = #BZT_SNO# 
		<isNotEmpty property="TEAM_SNO">
			  AND TEAM_SNO		= #TEAM_SNO# 
		</isNotEmpty>	  
		<isNotEmpty property="BGRP_TG_ORG_SNO">
			  AND BGRP_TG_ORG_SNO       = #BGRP_TG_ORG_SNO# 
		</isNotEmpty>	
		<isNotEmpty property="PCT_ALC_SNO">
			  AND PCT_ALC_SNO       = #PCT_ALC_SNO#
		</isNotEmpty>		  	  
	</update>

	<!--개인별출장내역 insert-->
	<insert id="BADDED010EPerBztInsert" parameterClass="paramMap">
		 INSERT INTO TBBADDED006L(
		       TEAM_SNO
		     , PCT_ALC_SNO
		     , BGRP_TG_ORG_SNO
		     , BZT_SNO
		     , BZT_YR
		     , BZT_STR_DT
		     , BZT_END_DT
		     , BZT_DCN
		     , AUD_STR_DT
		     , AUD_END_DT
		     , AUD_DCN
		     , LODG_DCN
		     , FRT_USR_ID
		     , FNL_USR_ID
		     , FNL_DEAL_DPT_CD
		     , FNL_MNU_ID
		     , FRT_REGI_DH
		     , FNL_MDF_DH 
		 ) VALUES(
		       #TEAM_SNO#
		     , #PCT_ALC_SNO#
		     , #BGRP_TG_ORG_SNO#
		     , #BZT_SNO#
		     , #BZT_YR#
		     , #BZT_STR_DT#
		     , #BZT_END_DT#
		     , #BZT_DCN#
		     , #AUD_STR_DT#
		     , #AUD_END_DT#
		     , #AUD_DCN#
		     , #LODG_DCN#
		     , #FRT_USR_ID#
		     , #FNL_USR_ID#
		     , #FNL_DEAL_DPT_CD#
		     , #FNL_MNU_ID#
		     , SYSDATE
		     , SYSDATE
		 )		 
	</insert>

	<!--개인별출장내역 UPDATE-->
	<update id="BADDED010EBztUpdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBBADDED006L
			   SET TEAM_SNO          = #TEAM_SNO# 
			     , BZT_SNO           = #BZT_SNO# 		
			     , BZT_YR			 = #BZT_YR#     
    			 , BGRP_TG_ORG_SNO   = #BGRP_TG_ORG_SNO# 
    			 , PCT_ALC_SNO    = #PCT_ALC_SNO#	
		]]>	    
		<isNotNull prepend="," property="BZT_STR_DT">
			   	   BZT_STR_DT            = #BZT_STR_DT#
		</isNotNull>
		<isNotNull prepend="," property="BZT_END_DT">	       
			       BZT_END_DT            = #BZT_END_DT#
		</isNotNull>
		<isNotNull prepend="," property="BZT_DCN">
			   	   BZT_DCN            = #BZT_DCN#
		</isNotNull>
		<isNotNull prepend="," property="AUD_STR_DT">	       
			       AUD_STR_DT            = #AUD_STR_DT#
		</isNotNull>
		<isNotNull prepend="," property="AUD_END_DT">
			   	   AUD_END_DT            = #AUD_END_DT#
		</isNotNull>
		<isNotNull prepend="," property="AUD_DCN">	       
			       AUD_DCN            = #AUD_DCN#
		</isNotNull>
		<isNotNull prepend="," property="LODG_DCN">
			   	   LODG_DCN            = #LODG_DCN#
		</isNotNull>
		<isNotNull prepend="," property="FNL_USR_ID">	       
			     FNL_USR_ID                 = #FNL_USR_ID#
		</isNotNull>	
		<isNotNull prepend="," property="FNL_DEAL_DPT_CD">	       
			     FNL_DEAL_DPT_CD                 = #FNL_DEAL_DPT_CD#
		</isNotNull>		
		<isNotNull prepend="," property="FNL_MNU_ID">	       
			     FNL_MNU_ID                 = #FNL_MNU_ID#
		</isNotNull>		
				  , FNL_MDF_DH              = SYSDATE						
			  WHERE 1=1
			    AND TEAM_SNO	= #TEAM_SNO# 
				AND BZT_YR      = #BZT_YR# 
			    AND BZT_SNO     = #BZT_SNO#    
    			AND BGRP_TG_ORG_SNO  	= #BGRP_TG_ORG_SNO# 	
    			AND PCT_ALC_SNO = #PCT_ALC_SNO# 	  
	</update>

	<!-- 지역코드의 역명  -->
	<select id="BADDED010ESelectStationNm" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			SELECT STN_NM 
			  FROM TBBADDED015B
			 WHERE 1=1
			   AND RGN_CD = #RGN_CD#
		]]>
	</select>	

	<!-- 철도기준요금조회 -->
	<select id="BADDED010ESelectTrainFareStd" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			SELECT DEP_STAD_STN_NM  /*출발기준역명*/  
			     , ARV_STAD_STN_NM  /*도착기준역명*/
			     , CHRG_DVSN_CD     /*요금구분코드*/
			     , TFE_KND_CD    	/*교통편종류코드*/    
			     , CHRG             /*요금*/
			     , CHRG_STAD_RMK    /*요금기준비고*/
			     , MDF_DT           /*수정일*/
			     , SPE_RM_CHRG      /*특별실요금*/
			  FROM TBBADDED016B 
			 WHERE 1=1
			   AND BZT_DVSN_CD = #BZT_DVSN_CD# /* 출장구분관리코드(1:감사출장, 2:일반출장) 추가 - 2017.02.06 yyh*/			 
		]]>
		<isNotEmpty property="DEP_STAD_STN_NM">
				AND DEP_STAD_STN_NM LIKE #DEP_STAD_STN_NM#||'%'
		</isNotEmpty>			 
		<isNotEmpty property="ARV_STAD_STN_NM">
				AND ARV_STAD_STN_NM LIKE #ARV_STAD_STN_NM#||'%'
		</isNotEmpty>		
		<isNotEmpty property="CHRG_DVSN_CD">
				AND CHRG_DVSN_CD    = #CHRG_DVSN_CD#
		</isNotEmpty>		
		<isNotEmpty property="TFE_KND_CD">
				AND TFE_KND_CD    = #TFE_KND_CD#
		</isNotEmpty>	
			  ORDER BY DEP_STAD_STN_NM		
	</select>	


	<!--철도구간내역 select-->
	<select id="BADDED010ETrainSelect" parameterClass="paramMap"
		resultClass="resultMap">	
        <![CDATA[    		
				SELECT TEAM_SNO         /*조순번*/
				     , BGRP_TG_ORG_SNO  /*조별대상기관순번*/
				     , RL_SCO_SNO   	/*철도구간순번*/
				     , BZT_SNO          /*출장순번*/
				     , BZT_YR           /*출장년도*/
				     , RID_DT           /*승차일*/
				     , TRIN_KND_CD      /*열차종류코드*/    
				     , CHRG_DVSN_CD     /*요금구분코드*/
				     , DEP_STN_NM       /*출발역명*/
				     , ARV_STN_NM       /*도착역명*/
				     , RL_FR_EXS        /*철도운임비*/
				     , STND_CHRG_YN     /*표준요금여부*/
				     , BGNG_APD_CD      /*초기출발지코드*/
				  FROM TBBADDED009L
				 WHERE 1=1
		]]>
		<isNotEmpty property="BGRP_TG_ORG_SNO">
				AND BGRP_TG_ORG_SNO = #BGRP_TG_ORG_SNO#
		</isNotEmpty>	
		<isNotEmpty property="TEAM_SNO">
				AND TEAM_SNO = #TEAM_SNO#
		</isNotEmpty>		
		<isNotEmpty property="BZT_SNO">
				AND BZT_SNO = #BZT_SNO#
		</isNotEmpty>		
		<isNotEmpty property="BZT_YR">
				AND BZT_YR = #BZT_YR#
		</isNotEmpty>			 
	</select>
	
	
	<!--철도구간내역 delete-->
	<update id="BADDED010ETrainDelete" parameterClass="paramMap">
		   DELETE 
			 FROM TBBADDED009L
			WHERE 1=1
			  AND BZT_YR        = #BZT_YR# 
			  AND BZT_SNO       = #BZT_SNO#     
		<isNotEmpty property="TEAM_SNO">
			  AND TEAM_SNO		= #TEAM_SNO# 	
		</isNotEmpty>	  
		<isNotEmpty property="BGRP_TG_ORG_SNO">
			  AND BGRP_TG_ORG_SNO       = #BGRP_TG_ORG_SNO#
		</isNotEmpty>		       
		<isNotEmpty property="RL_SCO_SNO">
			  AND RL_SCO_SNO       = #RL_SCO_SNO#
		</isNotEmpty>		  
	</update>

	<!--철도구간내역 insert-->
	<insert id="BADDED010ETrainInsert" parameterClass="paramMap">
			INSERT INTO TBBADDED009L ( 
			       TEAM_SNO
			     , BGRP_TG_ORG_SNO
			     , RL_SCO_SNO
			     , BZT_SNO
			     , BZT_YR
			     , RID_DT
			     , TRIN_KND_CD
			     , CHRG_DVSN_CD
			     , DEP_STN_NM
			     , ARV_STN_NM
			     , RL_FR_EXS
			     , STND_CHRG_YN
			     , BGNG_APD_CD
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH
                 , SEQ_NO        /* 순서번호 추가(쓰는곳은 없고 단순히 테이블 입력시 쫑나지 않게) - 2017.10.27 yyh */			     
			) VALUES(
			       #TEAM_SNO#
			     , #BGRP_TG_ORG_SNO#
			     , #RL_SCO_SNO#
			     , #BZT_SNO#
			     , #BZT_YR#
			     , #RID_DT#
			     , #TRIN_KND_CD#
			     , #CHRG_DVSN_CD#
			     , #DEP_STN_NM#
			     , #ARV_STN_NM#
			     , #RL_FR_EXS#
			     , #STND_CHRG_YN#
			     , #BGNG_APD_CD#
			     , #FRT_USR_ID#
			     , #FNL_USR_ID#
			     , #FNL_DEAL_DPT_CD#
			     , #FNL_MNU_ID#
			     , SYSDATE
			     , SYSDATE
                 , (SELECT NVL(MAX(SEQ_NO),0) + 1 
                      FROM TBBADDED009L)			     
			) 
	</insert>	
	
	<select id="BADDED010EKtxMaxSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     		
			SELECT LPAD(NVL(MAX(RL_SCO_SNO),0) + 1,4,'0') AS MAX_RL_SCO_SNO
			  FROM TBBADDED009L
			 WHERE 1=1
			   AND TEAM_SNO= #TEAM_SNO#
			   AND BGRP_TG_ORG_SNO= #BGRP_TG_ORG_SNO#
			   AND BZT_SNO= #BZT_SNO#
			   AND BZT_YR= #BZT_YR#
		]]>
	</select>
	
	<!--철도구간내역 UPDATE-->
	<update id="BADDED010EKtxUpdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBBADDED009L
			   SET TEAM_SNO          = #TEAM_SNO# 
			     , BZT_SNO           = #BZT_SNO# 		
			     , BZT_YR			 = #BZT_YR#     
    			 , BGRP_TG_ORG_SNO   = #BGRP_TG_ORG_SNO# 
    			 , RL_SCO_SNO    	 = #RL_SCO_SNO#	
		]]>	    
		<isNotNull prepend="," property="RID_DT">
			   	   RID_DT            = #RID_DT#
		</isNotNull>
		<isNotNull prepend="," property="TRIN_KND_CD">	       
			       TRIN_KND_CD            = #TRIN_KND_CD#
		</isNotNull>
		<isNotNull prepend="," property="CHRG_DVSN_CD">
			   	   CHRG_DVSN_CD            = #CHRG_DVSN_CD#
		</isNotNull>
		<isNotNull prepend="," property="DEP_STN_NM">	       
			       DEP_STN_NM            = #DEP_STN_NM#
		</isNotNull>
		<isNotNull prepend="," property="ARV_STN_NM">
			   	   ARV_STN_NM            = #ARV_STN_NM#
		</isNotNull>
		<isNotNull prepend="," property="RL_FR_EXS">	       
			       RL_FR_EXS            = #RL_FR_EXS#
		</isNotNull>
		<isNotNull prepend="," property="STND_CHRG_YN">
			   	   STND_CHRG_YN            = #STND_CHRG_YN#
		</isNotNull>
		<isNotNull prepend="," property="BGNG_APD_CD">
			   	   BGNG_APD_CD            = #BGNG_APD_CD#
		</isNotNull>
		<isNotNull prepend="," property="FNL_USR_ID">	       
			     FNL_USR_ID                 = #FNL_USR_ID#
		</isNotNull>	
		<isNotNull prepend="," property="FNL_DEAL_DPT_CD">	       
			     FNL_DEAL_DPT_CD                 = #FNL_DEAL_DPT_CD#
		</isNotNull>		
		<isNotNull prepend="," property="FNL_MNU_ID">	       
			     FNL_MNU_ID                 = #FNL_MNU_ID#
		</isNotNull>		
				  , FNL_MDF_DH              = SYSDATE						
			  WHERE 1=1
			    AND TEAM_SNO	= #TEAM_SNO# 
				AND BZT_YR      = #BZT_YR# 
			    AND BZT_SNO     = #BZT_SNO#    
    			AND BGRP_TG_ORG_SNO  	= #BGRP_TG_ORG_SNO# 	
    			AND RL_SCO_SNO  		= #RL_SCO_SNO# 	  
	</update>

	<!--송부처리 UPDATE-->
	<update id="BADDED010ESendUpdate" parameterClass="paramMap">
			UPDATE TBBADDED002M 
			   SET SND_YN = 'Y'  
			     , SND_DT = TO_CHAR(SYSDATE,'YYYYMMDD') 
		<isNotNull prepend="," property="FNL_USR_ID">	       
			     FNL_USR_ID                 = #FNL_USR_ID#
		</isNotNull>	
		<isNotNull prepend="," property="FNL_DEAL_DPT_CD">	       
			     FNL_DEAL_DPT_CD                 = #FNL_DEAL_DPT_CD#
		</isNotNull>		
		<isNotNull prepend="," property="FNL_MNU_ID">	       
			     FNL_MNU_ID                 = #FNL_MNU_ID#
		</isNotNull>		
				  , FNL_MDF_DH              = SYSDATE	
			 WHERE 1=1
			   AND BZT_YR  = #strBztYr# 
			   AND BZT_SNO = #strBztSno#
	</update>
	
	<!-- 출장상황카드 조회 -->
	<select id="BADDED010EBztCardselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[   	
			SELECT AUD.AUD_YR,
			       AUD.AUD_NO,
			       SITU.AUD_STEP_SNO,
			       AUD.AUD_YR || '-' || SUBSTR(AUD.AUD_TASK_CD,-1) || '-' || AUD.ORG_DVSN_CD || '-' || SUBSTR(AUD.AUD_KND_CD, -1) || '-' || AUD.SPV_BRDV_CD || '-' || SUBSTR(AUD.AUD_WAY_CD,-1) || '-' || AUD.AUD_NO || '-' || SITU.AUD_STEP_SNO AS AUD_NO_FULL,  /*감사연번호*/
			       SITU.TIT_TXT,  /*감사사항명*/
			       PSON.AUD_STR_DT,  /*감사기간 FROM*/
			       PSON.AUD_END_DT,  /*감사기간 TO*/
			       PSON.AUD_DCN,  /*감사일수*/
			       PSON.MAN_DAY,  /*연인원*/
			       PSON.PSON_CNT,  /*인원*/
			       SITU.BZT_TXT,  /*출장내용(감사중점에 배치)*/
			       USR.USR_NAM AS REP_NM, /*출장책임자*/
			       DEPT.DPT_NM REP_DPT_NM,  /*출장책임자 주관부서명*/
			       TTO.ORG_CNT,  /*대상기관수*/
			       ORG.ORG_NM AS REP_ORG_NM  /*대상기관명*/
			  FROM TBBADDED001M AUD,
			       TBBADDED002M SITU,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               MIN(AUD_STR_DT) AS AUD_STR_DT,
			               MAX(AUD_END_DT) AS AUD_END_DT,
			               MAX(AUD_DCN) AS AUD_DCN,
			               SUM(AUD_DCN) AS MAN_DAY,
			               COUNT(*) AS PSON_CNT
			          FROM (SELECT TMA.BZT_YR,
			                       TMA.BZT_SNO,
			                       TMA.PCT_CNB,
			                       MIN(PTD.AUD_STR_DT) AS AUD_STR_DT,
			                       MAX(PTD.AUD_END_DT) AS AUD_END_DT,
			                       SUM(PTD.AUD_DCN) AS AUD_DCN
			                  FROM TBBADDED005L TMA,
			                       TBBADDED006L PTD
			                 WHERE PTD.BZT_YR = TMA.BZT_YR
			                   AND PTD.BZT_SNO = TMA.BZT_SNO
			                   AND PTD.TEAM_SNO = TMA.TEAM_SNO
			                   AND PTD.PCT_ALC_SNO = TMA.PCT_ALC_SNO
			                   AND PTD.BZT_YR = #strAudYr# /*화면 인자값 감사년도*/
			                 GROUP BY TMA.BZT_YR,
			                       TMA.BZT_SNO,
			                       TMA.PCT_CNB) PTD1
			         GROUP BY BZT_YR,
			               BZT_SNO ) PSON,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               MIN(ORG_CD) AS REP_ORG_CD,
			               COUNT(*) AS ORG_CNT
			          FROM TBBADDED008L
			         WHERE BZT_YR = #strAudYr# /*화면 인자값 감사년도*/
			         GROUP BY BZT_YR,
			               BZT_SNO) TTO,
			       TBDCMACM001M USR,
			       TBDCMACM002M DEPT,
			       TBDCMACM015M ORG
			 WHERE SITU.REL_AUD_YR   = #strAudYr#  /*화면 인자값 감사년도*/
			   AND SITU.REL_AUD_NO   = #strAudNo#   /*화면 인자값 감사순번*/
			   AND SITU.AUD_STEP_SNO = #strAudStepSno#   /*화면 인자값 감사단계*/
			   AND AUD.AUD_YR = SITU.REL_AUD_YR
			   AND AUD.AUD_NO = SITU.REL_AUD_NO
			   AND SITU.BZT_DVSN_CD ='1'
			   AND PSON.BZT_YR = SITU.BZT_YR
			   AND PSON.BZT_SNO = SITU.BZT_SNO
			   AND TTO.BZT_YR(+) = SITU.BZT_YR
			   AND TTO.BZT_SNO(+) = SITU.BZT_SNO
			   AND USR.CNB(+) = SITU.BZT_TL_CNB
			   AND DEPT.DPT_CD(+) = SITU.BZT_TL_BRDV_CD
			   AND ORG.ORG_CD(+) = TTO.REP_ORG_CD 
		]]>
	</select>
	
	<!-- 실지감사출장상황표 조회 -->
	<select id="BADDED010EBztChartselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[   	
			SELECT F_CODE_NM('1000001',TTO.RGN_CD) LCL_NM,  /*지역명*/
			       F_ORG_INFO(TTO.ORG_CD,'1') ORG_NM,  /*대상기관*/
			       AUD.TSK_CAT_CD,  /*업무분류코드*/
			       F_CODE_NM('1000120',AUD.TSK_CAT_CD) TASK_CATE_NM,  /*업무분류명*/
			       SUBSTRB(AUD.TSK_CAT_CD, 1, 2)||'-'||SUBSTRB(AUD.TSK_CAT_CD, 3, 2)||'-'||SUBSTRB(AUD.TSK_CAT_CD, 5, 2) ||CHR(10)||F_CODE_NM('1000120',AUD.TSK_CAT_CD) TSK_CAT_CD_NM,  /*감사사항*/
			       SUBSTRB(PT.AUD_STR_DT, 5, 2)||'.'||SUBSTRB(PT.AUD_STR_DT, 7, 2)||'~'||CHR(10)||'   '|| SUBSTRB(PT.AUD_END_DT, 5, 2)||'.'||SUBSTRB(PT.AUD_END_DT, 7, 2)||'('||PT.AUD_DCN||')' AUD_GIGAN, /*감사(일간)*/
			       SUBSTRB(PT.BZT_STR_DT, 5, 2)||'.'||SUBSTRB(PT.BZT_STR_DT, 7, 2)||'~'||CHR(10)||'   '|| SUBSTRB(PT.BZT_END_DT, 5, 2)||'.'||SUBSTRB(PT.BZT_END_DT, 7, 2)||'('||PT.BZT_DCN||')' TRIP_GIGAN,  /*출장(일간)*/
			       TMA.BLT_BRDV_CD,  /*소속*/
			       F_CODE_NM('1000173',TMA.PCT_RANK_CD) POS_CLASS_NM,  /*직급명*/
			       TMA.PCT_NM,  /*출장자명(성명)*/
			       TMA.PCT_CNB  /*전산번호*/
			  FROM TBBADDED006L PT,
			       TBBADDED005L TMA,
			       TBBADDED008L TTO,
			       TBBADDED002M SITU,
			       TBBADDED001M AUD
			 WHERE AUD.AUD_YR = #strAudYr#  /*화면 인자값 감사년도*/
			   AND AUD.AUD_NO = #strAudNo#   /*화면 인자값 감사순번*/
			   AND SITU.REL_AUD_YR = AUD.AUD_YR
			   AND SITU.REL_AUD_NO = AUD.AUD_NO
			   AND SITU.AUD_STEP_SNO = #strAudStepSno# /*화면 인자값 감사단계 */
			   AND PT.BZT_YR = SITU.BZT_YR
			   AND PT.BZT_SNO = SITU.BZT_SNO
			   AND TMA.BZT_YR = PT.BZT_YR
			   AND TMA.BZT_SNO = PT.BZT_SNO
			   AND TMA.TEAM_SNO = PT.TEAM_SNO
			   AND TMA.PCT_ALC_SNO = PT.PCT_ALC_SNO
			   AND TTO.BZT_YR = PT.BZT_YR
			   AND TTO.BZT_SNO = PT.BZT_SNO
			   AND TTO.TEAM_SNO = PT.TEAM_SNO
			   AND TTO.BGRP_TG_ORG_SNO = PT.BGRP_TG_ORG_SNO 
			   ORDER BY ORG_NM,LCL_NM,TSK_CAT_CD_NM
		]]>
	</select>
	
	<!--출장자의 기간 중복을 체크한다. -->
	<select id="BADDED010ECheckSave" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[   
			SELECT TMA.BZT_YR
			     , TMA.BZT_SNO
			     , TMA.TEAM_SNO
			     , TMA.PCT_ALC_SNO
			     , TMA.STF_DVSN_CD
			     , TMA.PCT_CNB 
			     , TMA.PCT_NM
			     , TMA.BLT_BRDV_CD
			     , TMA.PCT_RANK_CD
			     , TMA.DEP_RGN_CD
			     , TMA.BZT_STR_DT
			     , TMA.BZT_END_DT
			  FROM TBBADDED006L PTD
			     , TBBADDED005L TMA
			 WHERE PTD.BZT_YR = TMA.BZT_YR
			   AND PTD.BZT_SNO = TMA.BZT_SNO
			   AND PTD.TEAM_SNO = TMA.TEAM_SNO
			   AND PTD.PCT_ALC_SNO = TMA.PCT_ALC_SNO
			   AND TMA.PCT_CNB  =#PCT_CNB#
			   AND ( (PTD.BZT_STR_DT BETWEEN #BZT_STR_DT# AND #BZT_END_DT#)
			            OR (PTD.BZT_END_DT BETWEEN #BZT_STR_DT# AND #BZT_END_DT#)
			            OR (PTD.BZT_STR_DT > #BZT_STR_DT#
			                   AND PTD.BZT_END_DT < #BZT_END_DT#) ) 
			   AND NOT EXISTS (
			                    SELECT * 
			                      FROM TBBADDED006L
			                     WHERE 1=1
			                       AND BZT_YR   = PTD.BZT_YR
			                       AND BZT_SNO  = PTD.BZT_SNO
			                       AND TEAM_SNO = PTD.TEAM_SNO
			                       AND BZT_YR   = #BZT_YR#
			                       AND BZT_SNO  = #BZT_SNO#
			                       AND TEAM_SNO = #TEAM_SNO#
			                  ) 
			   
		]]>
	</select>			
	
	<!--감사출장상황 상세조회-->
	<select id="BADDED012PMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT D1.REL_AUD_YR||'-'||D1.REL_AUD_NO||'-'||D1.AUD_STEP_SNO    AS AUD_YR_NO            /*감사연번호*/
			     , D1.BZT_YR							AS BZT_YR				/*출장년도*/
			     , D1.BZT_SNO                           AS BZT_SNO              /*출장순번*/
			     , D2.AUD_KND_CD                        AS AUD_KND_CD           /*감사종류코드*/    
			     , F_CODE_NM('1000007',D2.AUD_KND_CD)   AS AUD_KND_NM           /*감사종류명*/
			     , D1.BZT_DVSN_CD                       AS BZT_DVSN_CD          /*출장구분코드*/
			     , D1.AUD_BZT_KND_CD                    AS AUD_BZT_KND_CD       /*감사출장종류코드*/
			     , F_CODE_NM('1000030',D1.AUD_BZT_KND_CD) AS AUD_BZT_KND_NM       /*감사출장종류코드*/
			     , D1.BZT_TL_CNB                        AS BZT_TL_CNB           /*출장반장전산번호*/
			     , D1.BZT_TL_BRDV_CD                    AS BZT_TL_BRDV_CD       /*출장반장국과코드*/    
			     , D1.BZT_TL_RANK_CD                    AS BZT_TL_RANK_CD       /*출장반장직급코드*/
			     , F_USR_INFO(D1.BZT_TL_CNB,'2')        AS BZT_TL_CNB_NM        /*출장반장명*/    
			     , F_DPT_INFO(D1.BZT_TL_BRDV_CD,'1')    AS BZT_TL_BRDV_NM       /*출장반장국과명*/
			     , F_CODE_NM('1000173',D1.BZT_TL_RANK_CD)   AS BZT_TL_RANK_NM   /*출장반장직급명*/
			     , D1.TIT_TXT                           AS TIT_TXT              /*제목내용*/
			     , D1.BZT_BRDV_CD                       AS BZT_BRDV_CD          /*출장국과코드*/
			     , F_DPT_INFO(D1.BZT_BRDV_CD,'1')       AS BZT_BRDV_NM          /*출장국과명*/
			     , D1.HLDY_ACTV_DVSN_CD                 AS HLDY_ACTV_DVSN_CD    /*휴일활동구분코드*/
			     , F_CODE_NM('1000019',D1.HLDY_ACTV_DVSN_CD)                 AS HLDY_ACTV_DVSN_NM    /*휴일활동구분코드*/
			     , D1.REL_AUD_YR                        AS REL_AUD_YR           /*관련감사년도*/
			     , D1.REL_AUD_NO                        AS REL_AUD_NO           /*관련감사번호*/
			     , D2.AUD_GRN_NO                        AS AUD_GRN_NO           /*감사부여번호 - 2016.05.27 yyh*/
			     , D1.AUD_STEP_SNO                      AS AUD_STEP_SNO         /*감사단계순번*/
			     , D1.BZT_TXT                           AS BZT_TXT              /*출장내용*/
			     , D1.CTRL_YN                           AS CTRL_YN              /*통제여부*/
			     , D1.BZT_YR ||'-'||D1.SPRT_NO          AS SPRT_NM              /*지원번호*/
			     , D1.SPRT_NO                           AS SPRT_NO              /*지원번호*/
			     , D1.GEN_BZT_KND_CD                    AS GEN_BZT_KND_CD       /*일반출장구분코드*/
			     , D1.REGI_DT                           AS REGI_DT              /*등록일*/
			     , D1.AUD_STR_DT                        AS AUD_STR_DT           /*감사시작일*/
			     , D1.AUD_END_DT                        AS AUD_END_DT           /*감사종료일*/
			     , '('||NVL(D1.AUD_DCN,0)||'일)'          AS AUD_DCN              /*감사일수*/
			     , D1.LEAD_EXS_PMT_YN                   AS LEAD_EXS_PMT_YN      /*지휘비지급여부*/
			     , D1.CTRL_TG_YN                        AS CTRL_TG_YN           /*통제대상여부*/
			     , D1.CTRL_DT                           AS CTRL_DT              /*통제일*/
			     , D1.SND_YN                            AS SND_YN               /*송부여부*/
			     , D1.SND_DT                            AS SND_DT               /*송부일*/
			     , D1.FLD_AUD_STEP_NO                   AS FLD_AUD_STEP_NO      /*실지감사단계번호*/
			     , D2.AUD_YR                            AS AUD_YR               /*감사년도*/
			     , D2.AUD_NO                            AS AUD_NO               /*감사번호*/   
			     , F_DPT_INFO(D2.SPV_BRDV_CD,'1')       AS SPV_BRDV_NM          /*주관부서명*/
			     , F_DPT_INFO((SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = D2.SPV_BRDV_CD), '1') AS SPV_BRDV_UP_NM  /*주관부서명(국)*/
			     , TO_CHAR(TO_DATE(D1.AUD_STR_DT),'YYYY-MM-DD')||'~'|| TO_CHAR(TO_DATE(D1.AUD_END_DT),'YYYY-MM-DD')    AS AUD_ST_END_DT        /*실시기간*/
			     , D2.AUD_SBJ_NM					   AS AUD_SBJ_NM			/*감사사항명*/
                 , CASE WHEN NVL(D1.CTRL_TG_YN,'N') = 'N' THEN '-'
                        WHEN NVL(D1.CTRL_TG_YN,'N') = 'Y' AND NVL(D1.CTRL_YN,'N') = 'Y' THEN 'O' 
                        WHEN NVL(D1.CTRL_TG_YN,'N') = 'Y' AND NVL(D1.CTRL_YN,'N') = 'N' THEN 'X'
                    END AS CTRL_YN_DISP
                 , CASE WHEN NVL(D1.SND_YN,'N') = 'Y' THEN 'O' ELSE 'X' END AS SND_YN_DISP	
                 , (SELECT CASE WHEN COUNT(1)>0 THEN 'Y' ELSE 'N' END  
                      FROM TBBADDED011L
                     WHERE 1=1
                       AND BZT_YR  = D1.BZT_YR
                       AND BZT_SNO = D1.BZT_SNO
                    )  	AS EXP_YN 		/*수정가능여부를 판단하기 위함.*/	 
                 , '' 	AS SEL_YN		/*선택여부를 판단하기위함.(통제화면)*/        
                 , NVL(D3.IN_PSON_CNT,0)    AS IN_PSON_CNT
			     , NVL(D3.EXT_PSON_CNT,0)   AS EXT_PSON_CNT
			     , NVL(D3.IN_PSON_CNT,0)+ NVL(D3.EXT_PSON_CNT,0) AS PSON_CNT
			     , NVL(D3.IN_PSON_CNT,0)||'/'||NVL(D3.EXT_PSON_CNT,0)||'/'||(NVL(D3.IN_PSON_CNT,0)+ NVL(D3.EXT_PSON_CNT,0)) AS ALL_PSON_CNT 
			     , F_ORG_CNT_NM_AUD(D1.BZT_YR,D1.BZT_SNO,'BZT') AS ORG_CNT_NM
			     , '내부 : '||TO_CHAR(NVL(D3.IN_PSON_CNT,0)) || '명('|| TO_CHAR(NVL(D4.IN_PSON_CNT1,0))||'명)  외부 : '||TO_CHAR(NVL(D3.EXT_PSON_CNT,0))||'명('||TO_CHAR(NVL(D4.EXT_PSON_CNT1,0))||'명)' AS DIS_PSON_CNT
			     , CASE WHEN D2.AUD_YR >= '2016'
			                 THEN (SELECT CD_NM
                                     FROM TBDCMACM013C
                                    WHERE CMM_CD_DVSN_CD = '1000739'
                                      AND CD             = D2.AUD_KND_CD)
                        ELSE '-'
                    END                                                                 AS AUD_YR_NO_KND_NM  		     
			  FROM TBBADDED002M D1
			     , TBBADDED001M D2
			     , (
			        SELECT BZT_YR
			             , BZT_SNO
			             , SUM( CASE WHEN A.STF_DVSN_CD = '0' THEN 1 ELSE 0 END) AS IN_PSON_CNT  /*내부인원*/
			             , SUM( CASE WHEN A.STF_DVSN_CD = '0' THEN 0 ELSE 1 END) AS EXT_PSON_CNT /*외부인원*/
			          FROM (SELECT DISTINCT BZT_YR
			                     , BZT_SNO
			                     , PCT_CNB
			                     , STF_DVSN_CD
			                  FROM TBBADDED005L) A
			         GROUP BY BZT_YR, BZT_SNO 
			     ) D3	
                 , (
                         SELECT D1.BZT_YR
                              , D1.BZT_SNO
                              , SUM(AUD_DCN) 
                              , SUM( CASE WHEN D2.STF_DVSN_CD = '0' THEN D1.AUD_DCN ELSE 0 END) AS IN_PSON_CNT1 
                             , SUM( CASE WHEN D2.STF_DVSN_CD = '0' THEN 0 ELSE D1.AUD_DCN END) AS EXT_PSON_CNT1 /*외부인원*/
                           FROM TBBADDED006L D1
                              , TBBADDED005L D2
                         WHERE 1=1
                           AND D1.BZT_YR        = D2.BZT_YR
                           AND D1.BZT_SNO       = D2.BZT_SNO
                           AND D1.TEAM_SNO      = D2.TEAM_SNO
                           AND D1.PCT_ALC_SNO   = D2.PCT_ALC_SNO
                           AND D1.BZT_YR  = #BZT_YR#
                           AND D1.BZT_SNO = #BZT_SNO#
                       GROUP BY D1.BZT_YR, D1.BZT_SNO     
                  ) D4 
             WHERE 1=1
			  AND D1.REL_AUD_YR = D2.AUD_YR
			  AND D1.REL_AUD_NO = D2.AUD_NO
			  AND D1.BZT_YR     = D3.BZT_YR(+)
			  AND D1.BZT_SNO    = D3.BZT_SNO(+)  
			  AND D1.BZT_YR     = D4.BZT_YR(+)
			  AND D1.BZT_SNO    = D4.BZT_SNO(+)             
		]]>
		<isNotEmpty property="BZT_SNO">
			  AND D1.BZT_SNO = #BZT_SNO#
		</isNotEmpty>		
		<isNotEmpty property="BZT_YR">
			  AND D1.BZT_YR = #BZT_YR#
		</isNotEmpty>	
	</select>	


	<select id="BADDED010EOrgSelectAuto" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
	         SELECT BZT_YR
	              , BZT_SNO 
	              , PCT_CNB
	              , BZT_EXS_SNO
	              , ORG_CD
	              , RGN_CD
	              , RGN_DVSN_CD
	              , BZT_STR_DT      AS AUD_STR_DT
	              , BZT_END_DT      AS AUD_END_DT
	           FROM TBBADDED011L
	          WHERE 1=1
	            AND CALC_YN = 'Y' 
	            AND BZT_YR  = #BZT_YR#
	            AND BZT_SNO = #BZT_SNO#
	            AND PCT_CNB = #PCT_CNB#
	           ORDER BY   BZT_STR_DT
        ]]>
	</select>	
	
	<select id="BADDED010EPerSelectAuto" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
	          SELECT BZT_YR
	               , BZT_SNO 
	               , PCT_CNB
	               , DEP_RGN_CD
	            FROM TBBADDED010L
	           WHERE 1=1
	            AND BZT_YR  = #BZT_YR#
	            AND BZT_SNO = #BZT_SNO#
	            AND PCT_CNB = #PCT_CNB#       
		]]>
	</select>			
</sqlMap> 

