<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/cmr/001">

	<!-- 정책모니터링 조회(담당부서별) 조회한다. -->
	<!-- <select id="BADCMR001Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[   
			SELECT DPT_CD  /*담당부서 상위코드*/
			     , F_DPT_INFO(DPT_CD, '1') AS DPT_NM /*담당부서*/
			     , NVL(SUM(DETP_ALL), 0) AS DETP_ALL  /*합계*/
			     , NVL(SUM(DETP01), 0) AS DETP01  /*1과*/
			     , NVL(SUM(DETP02), 0) AS DETP02  /*2과*/
			     , NVL(SUM(DETP03), 0) AS DETP03  /*3과*/
			     , NVL(SUM(DETP04), 0) AS DETP04  /*4과*/
			     , NVL(SUM(DETP05), 0) AS DETP05  /*5과*/
			     , NVL(SUM(DETP06), 0) AS DETP06  /*6과*/
			     , NVL(SUM(DETP07), 0) AS DETP07  /*7과*/
			     , #strYe#     AS SEARCH_YE
			     , #strCpltYn# AS SEARCH_CPLT_YN
			FROM 
			   (SELECT CHR_DPT_CD /*담당부서코드*/
                     , SUBSTR(CHR_DPT_CD, 1, 2) || '0000' AS DPT_CD /*담당부서코드 상위코드*/
                     , 1 AS DETP_ALL 
                     , CASE WHEN SUBSTR(CHR_DPT_CD, 4, 2) IN ('10', '11', '20', '21') THEN 1 END AS DETP01 
                     , CASE WHEN SUBSTR(CHR_DPT_CD, 4, 2) IN ('12', '22') THEN 1 END AS DETP02 
                     , CASE WHEN SUBSTR(CHR_DPT_CD, 4, 2) IN ('13', '23') THEN 1 END AS DETP03 
                     , CASE WHEN SUBSTR(CHR_DPT_CD, 4, 2) IN ('14', '24') THEN 1 END AS DETP04 
                     , CASE WHEN SUBSTR(CHR_DPT_CD, 4, 2) IN ('15', '25') THEN 1 END AS DETP05 
                     , CASE WHEN SUBSTR(CHR_DPT_CD, 4, 2) = '16' THEN 1 END AS DETP06 
                     , CASE WHEN SUBSTR(CHR_DPT_CD, 4, 2) = '17' THEN 1 END AS DETP07 
			      FROM TBBADCMR003M 
			     WHERE 1=1 
			       AND YE = #strYe#
			       AND CHR_DPT_CD IS NOT NULL /*널인 데이터도 있다*/
		]]>		
		<isNotEmpty property="strCpltYn">
			AND NVL(CPLT_YN, 'N') = #strCpltYn#
		</isNotEmpty>			            
		<![CDATA[ 			       
			    )
			WHERE 1=1 
			GROUP BY DPT_CD
			ORDER BY DPT_CD
		]]>
	</select> -->
	
	<select id="BADCMR001Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[   
			SELECT DPT_CD  /*담당부서 상위코드*/
			     , F_DPT_INFO(DPT_CD, '1') AS DPT_NM /*담당부서*/
			     , NVL(SUM(DETP_ALL), 0) AS DETP_ALL  /*합계*/
			     , NVL(SUM(DETP01), 0) AS DETP01  /*1과*/
			     , NVL(SUM(DETP02), 0) AS DETP02  /*2과*/
			     , NVL(SUM(DETP03), 0) AS DETP03  /*3과*/
			     , NVL(SUM(DETP04), 0) AS DETP04  /*4과*/
			     , NVL(SUM(DETP05), 0) AS DETP05  /*5과*/
			     , NVL(SUM(DETP06), 0) AS DETP06  /*6과*/
			     , NVL(SUM(DETP07), 0) AS DETP07  /*7과*/
			     , #strYe#     AS SEARCH_YE
			     , #strCpltYn# AS SEARCH_CPLT_YN
			FROM 
			   (SELECT CHR_DPT_CD /*담당부서코드*/
                    , SUBSTR(CHR_DPT_CD, 1, 3) || '000' AS DPT_CD /*담당부서코드 상위코드*/
                     , 1 AS DETP_ALL 
                     , CASE WHEN D2.SRT_SNO = '1' THEN 1 END AS DETP01 
                     , CASE WHEN D2.SRT_SNO = '2' THEN 1 END AS DETP02 
                     , CASE WHEN D2.SRT_SNO = '3' THEN 1 END AS DETP03 
                     , CASE WHEN D2.SRT_SNO = '4' THEN 1 END AS DETP04 
                     , CASE WHEN D2.SRT_SNO = '5' THEN 1 END AS DETP05 
                     , CASE WHEN D2.SRT_SNO = '6' THEN 1 END AS DETP06 
                     , CASE WHEN D2.SRT_SNO = '7' THEN 1 END AS DETP07 
			      FROM TBBADCMR003M D1
			      		,TBDCMACM002M D2
			     WHERE 1=1 
			       AND YE = #strYe#
			       AND CHR_DPT_CD IS NOT NULL /*널인 데이터도 있다*/
			       AND D1.CHR_DPT_CD = D2.DPT_CD
		]]>		
		<isNotEmpty property="strCpltYn">
			AND NVL(CPLT_YN, 'N') = #strCpltYn#
		</isNotEmpty>			            
		<![CDATA[ 			       
			    )
			WHERE 1=1 
			GROUP BY DPT_CD
			ORDER BY DPT_CD
		]]>
	</select>
	
	<!-- 주요정책 모니터링 과제 목록 조회한다. -->
	<!-- <select id="BADCMR001Qsubselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[   
			SELECT A.YE || '-' || A.LAG_CAT_SNO || '-' || A.MID_CAT_SNO || '-' || A.SALL_CAT_SNO AS SUBJ_NO /*과제번호*/
			     , A.SALL_CAT_TIT_NM /*과제명*/
			     , F_DPT_INFO(A.CHR_DPT_CD, '1') AS DPT_NM /*담당부서*/
			     , A.CHR_DPT_CD
			     , F_USR_INFO(A.CHGR_ID, '2') AS CHGR_NM /*전담자*/
			     , (SELECT SUBSTR(MAX(PLCY_MDF_DH), 0, 8) FROM TBBADCMR004D WHERE YE = A.YE AND SALL_CAT_SNO = A.SALL_CAT_SNO AND REGI_DT BETWEEN #strYe# ||'0101' AND #strYe# ||'0401' ) AS FIRST_HALF_MDF_DH  /*상반기*/
			     , (SELECT SUBSTR(MAX(PLCY_MDF_DH), 0, 8) FROM TBBADCMR004D WHERE YE = A.YE AND SALL_CAT_SNO = A.SALL_CAT_SNO AND REGI_DT BETWEEN #strYe# ||'0402' AND #strYe# ||'1001' ) AS SECOND_HALF_MDF_DH  /*하반기*/
			     , NVL(A.CPLT_YN, 'N') AS CPLT_YN /*완료*/
			     , A.YE
			     , A.SALL_CAT_SNO
			     , A.LAG_CAT_SNO
			     , A.MID_CAT_SNO
			     , A.CHGR_ID
			  FROM TBBADCMR003M A 
			 WHERE A.YE = #strYe#
			
		]]>		
		
		<isNotEmpty property ="strDeptCd">
			<isNotEmpty property="strDept2Cd">
				AND ( A.CHR_DPT_CD = #strDeptCd# OR A.CHR_DPT_CD = #strDept2Cd# )
			</isNotEmpty>
			<isEmpty property="strDept2Cd">
				AND A.CHR_DPT_CD LIKE  #strDeptCd#||'%'
			</isEmpty>
		</isNotEmpty>
		<isNotEmpty property="strCpltYn">
			AND NVL(CPLT_YN, 'N') = #strCpltYn#
		</isNotEmpty>			            
		<![CDATA[ 
			 ORDER BY YE, SALL_CAT_SNO
		]]>
	</select> -->
	
	<select id="BADCMR001Qsubselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[   
			SELECT A.YE || '-' || A.LAG_CAT_SNO || '-' || A.MID_CAT_SNO || '-' || A.SALL_CAT_SNO AS SUBJ_NO /*과제번호*/
			     , A.SALL_CAT_TIT_NM /*과제명*/
			     , F_DPT_INFO(A.CHR_DPT_CD, '1') AS DPT_NM /*담당부서*/
			     , A.CHR_DPT_CD
			     , F_USR_INFO(A.CHGR_ID, '2') AS CHGR_NM /*전담자*/
			     , (SELECT SUBSTR(MAX(PLCY_MDF_DH), 0, 8) FROM TBBADCMR004D WHERE YE = A.YE AND SALL_CAT_SNO = A.SALL_CAT_SNO AND REGI_DT BETWEEN #strYe# ||'0101' AND #strYe# ||'0401' ) AS FIRST_HALF_MDF_DH  /*상반기*/
			     , (SELECT SUBSTR(MAX(PLCY_MDF_DH), 0, 8) FROM TBBADCMR004D WHERE YE = A.YE AND SALL_CAT_SNO = A.SALL_CAT_SNO AND REGI_DT BETWEEN #strYe# ||'0402' AND #strYe# ||'1001' ) AS SECOND_HALF_MDF_DH  /*하반기*/
			     , NVL(A.CPLT_YN, 'N') AS CPLT_YN /*완료*/
			     , A.YE
			     , A.SALL_CAT_SNO
			     , A.LAG_CAT_SNO
			     , A.MID_CAT_SNO
			     , A.CHGR_ID
			     , A.CPR_CHGR_ID
			     , F_USR_INFO(A.CPR_CHGR_ID,'2')AS CPR_CHGR_NM
					, A.CPR_DPT_CD
					, F_DPT_INFO(A.CPR_DPT_CD,'1') AS CPR_DPT_NM
					, A.STD_CHGR_ID
					, F_USR_INFO(A.STD_CHGR_ID,'2')AS STD_CHGR_NM
					, A.STD_DPT_CD
					, F_DPT_INFO(A.STD_DPT_CD,'1') AS STD_DPT_NM 
					, NVL(A.EPS_MNG_YN,'N') AS EPS_MNG_YN
			  FROM TBBADCMR003M A 
			  		,TBDCMACM002M B
			 WHERE A.YE = #strYe#
			AND		A.CHR_DPT_CD = B.DPT_CD
			AND A.CHR_DPT_CD LIKE  #strDeptCd#||'%'
		]]>		
		
		<isNotEmpty property ="strDept2Cd">
			AND B.SRT_SNO =  #strDept2Cd#
		</isNotEmpty>
		<isNotEmpty property="strCpltYn">
			AND NVL(CPLT_YN, 'N') = #strCpltYn#
		</isNotEmpty>			            
		<![CDATA[ 
			 ORDER BY YE, SALL_CAT_SNO
		]]>
	</select>
	
	<!-- 주요정책 모니터링 과제 목록 조회한다. -->
	<!-- <select id="BADCMR001QsubAllselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[   
			SELECT A.YE || '-' || A.LAG_CAT_SNO || '-' || A.MID_CAT_SNO || '-' || A.SALL_CAT_SNO AS SUBJ_NO /*과제번호*/
			     , A.SALL_CAT_TIT_NM /*과제명*/
			     , F_DPT_INFO(A.CHR_DPT_CD, '1') AS DPT_NM /*담당부서*/
			     , A.CHR_DPT_CD
			     , F_USR_INFO(A.CHGR_ID, '2') AS CHGR_NM /*전담자*/
			     , (SELECT SUBSTR(MAX(PLCY_MDF_DH), 0, 8) FROM TBBADCMR004D WHERE YE = A.YE AND SALL_CAT_SNO = A.SALL_CAT_SNO AND REGI_DT BETWEEN #strYe# ||'0101' AND #strYe# ||'0401' ) AS FIRST_HALF_MDF_DH  /*상반기*/
			     , (SELECT SUBSTR(MAX(PLCY_MDF_DH), 0, 8) FROM TBBADCMR004D WHERE YE = A.YE AND SALL_CAT_SNO = A.SALL_CAT_SNO AND REGI_DT BETWEEN #strYe# ||'0402' AND #strYe# ||'1001' ) AS SECOND_HALF_MDF_DH  /*하반기*/
			     , NVL(A.CPLT_YN, 'N') AS CPLT_YN /*완료*/
			     , A.YE
			     , A.SALL_CAT_SNO
			     , A.LAG_CAT_SNO
			     , A.MID_CAT_SNO
			  FROM TBBADCMR003M A 
			 WHERE A.YE = #strYe#
		]]>	
		<isNotEmpty property ="strDeptCd">
			<isNotEmpty property="strDept3Cd">
				AND ( A.CHR_DPT_CD LIKE '%' || #strDeptCd# OR A.CHR_DPT_CD LIKE '%' || #strDept2Cd# OR A.CHR_DPT_CD LIKE '%' || #strDept3Cd# )
			</isNotEmpty>		
			<isEmpty property="strDept3Cd">
				<isNotEmpty property="strDept2Cd">
					AND ( A.CHR_DPT_CD LIKE '%' || #strDeptCd# OR A.CHR_DPT_CD LIKE '%' || #strDept2Cd# )
				</isNotEmpty>
				<isEmpty property="strDept2Cd">
					AND A.CHR_DPT_CD LIKE '%' || #strDeptCd#
				</isEmpty>
			</isEmpty>
		</isNotEmpty>
				
		<isNotEmpty property="strCpltYn">
			AND NVL(CPLT_YN, 'N') = #strCpltYn#
		</isNotEmpty>			            
		<![CDATA[ 
			 ORDER BY YE, SALL_CAT_SNO
		]]>
	</select> -->
	
	<!-- 주요정책 모니터링 과제 목록 조회한다. -->
	<select id="BADCMR001QsubAllselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[   
			SELECT A.YE || '-' || A.LAG_CAT_SNO || '-' || A.MID_CAT_SNO || '-' || A.SALL_CAT_SNO AS SUBJ_NO /*과제번호*/
			     , A.SALL_CAT_TIT_NM /*과제명*/
			     , F_DPT_INFO(A.CHR_DPT_CD, '1') AS DPT_NM /*담당부서*/
			     , A.CHR_DPT_CD
			     , F_USR_INFO(A.CHGR_ID, '2') AS CHGR_NM /*전담자*/
			     , (SELECT SUBSTR(MAX(PLCY_MDF_DH), 0, 8) FROM TBBADCMR004D WHERE YE = A.YE AND SALL_CAT_SNO = A.SALL_CAT_SNO AND REGI_DT BETWEEN #strYe# ||'0101' AND #strYe# ||'0401' ) AS FIRST_HALF_MDF_DH  /*상반기*/
			     , (SELECT SUBSTR(MAX(PLCY_MDF_DH), 0, 8) FROM TBBADCMR004D WHERE YE = A.YE AND SALL_CAT_SNO = A.SALL_CAT_SNO AND REGI_DT BETWEEN #strYe# ||'0402' AND #strYe# ||'1001' ) AS SECOND_HALF_MDF_DH  /*하반기*/
			     , NVL(A.CPLT_YN, 'N') AS CPLT_YN /*완료*/
			     , A.YE
			     , A.SALL_CAT_SNO
			     , A.LAG_CAT_SNO
			     , A.MID_CAT_SNO
			     , A.CPR_CHGR_ID
			     , F_USR_INFO(A.CPR_CHGR_ID,'2')AS CPR_CHGR_NM
					, A.CPR_DPT_CD
					, F_DPT_INFO(A.CPR_DPT_CD,'1') AS CPR_DPT_NM
					, A.STD_CHGR_ID
					, F_USR_INFO(A.STD_CHGR_ID,'2')AS STD_CHGR_NM
					, A.STD_DPT_CD
					, F_DPT_INFO(A.STD_DPT_CD,'1') AS STD_DPT_NM
					, NVL(EPS_MNG_YN,'N') AS EPS_MNG_YN
			  FROM TBBADCMR003M A 
			  		,TBDCMACM002M B
			 WHERE A.YE = #strYe#
			 AND	A.CHR_DPT_CD = B.DPT_CD
		]]>	
		<isNotEmpty property="strDept2Cd">
			AND B.SRT_SNO = #strDept2Cd#
		</isNotEmpty>
				
		<isNotEmpty property="strCpltYn">
			AND NVL(CPLT_YN, 'N') = #strCpltYn#
		</isNotEmpty>			            
		<![CDATA[ 
			 ORDER BY YE, SALL_CAT_SNO
		]]>
	</select>
        
</sqlMap> 
