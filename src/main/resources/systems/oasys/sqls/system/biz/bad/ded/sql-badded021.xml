<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ded/021">

<select id="badded021EMoniteringselect" parameterClass="paramMap" resultClass="resultMap">
    <![CDATA[       
            SELECT A.AUD_YR,
                   A.AUD_NO,
                   F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-')  AS AUD_YR_NO,
                   A.AUD_KND_CD,
                   F_CODE_NM('1000007',A.AUD_KND_CD)                             AS AUD_KND_NM,
                   F_DPT_INFO(A.MNG_DPT_CD,'1')                                  AS SPV_BRDV_NM,
                   A.MNG_DPT_CD,
                   AUD_WAY_CD                                                    AS AUD_WAY_CD,
                   A.AUD_SBJ_NM,
                   (CASE WHEN A.AUD_NO >= '900' THEN '0' || A.AUD_NO
                         ELSE '1'|| A.AUD_NO
                     END)                                                        AS SORTER
              FROM TBBADDED001M A 
             WHERE 1=1
               AND AUD_YR=#strYear#
               AND A.AUD_KND_CD LIKE '%9' 
    ]]>
    <isNotEmpty property="strUpSpvBrdvCd">	 
               AND A.MNG_DPT_CD like SUBSTR(#strUpSpvBrdvCd#,1,3)||'%'		
    </isNotEmpty>   
    <isNotEmpty property="strSpvBrdvCd">	 
               AND A.MNG_DPT_CD =#strSpvBrdvCd#		
    </isNotEmpty>   
    <isNotEmpty property="strAudGrnNo">	 
               AND A.AUD_GRN_NO  <![CDATA[<=#strAudGrnNo#	 ]]>	
    </isNotEmpty>   
             ORDER BY A.AUD_YR DESC, SORTER ASC
</select>

<!--메시지관리 update -->
<update id="badded021EMoniteringupdate" parameterClass="paramMap">
    <![CDATA[ 	
            UPDATE TBBADDED001M
               SET AUD_WAY_CD = (CASE WHEN SPV_BRDV_CD IN (SELECT CD FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD='1000034') THEN SUBSTR(#AUD_YR#,3,2)||'4' ELSE #AUD_WAY_CD# END)
             WHERE AUD_YR = #AUD_YR#
               AND AUD_NO  = #AUD_NO#
    ]]>
</update>

</sqlMap> 
