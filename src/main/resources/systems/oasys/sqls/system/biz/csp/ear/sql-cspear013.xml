<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/ear/013">

	<resultMap class="java.util.HashMap" id="CSPEAR013">
 		<result property="REQ_DVSN_CD" column="REQ_DVSN_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ACP_YR" column="ACP_YR"                             jdbcType="VARCHAR2"  javaType="java.lang.String" /> 
		<result property="CVPT_ACP_NO" column="CVPT_ACP_NO"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="REQ_DOC_KND_CD" column="REQ_DOC_KND_CD"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ONR_DOC_MNG_CRD_ID" column="ONR_DOC_MNG_CRD_ID"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CVPT_OPM_APV_HNDL_STA_CD" column="CVPT_OPM_APV_HNDL_STA_CD"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="OPM_TXT" column="OPM_TXT"                                 jdbcType="CLOB"  javaType="java.lang.String" />
		<result property="AD" column="AD"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RECEIVER" column="RECEIVER"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
		<result property="ZCD" column="ZCD"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
		<result property="CVPTR_NM" column="CVPTR_NM"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
		<result property="TEL" column="TEL"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
		<result property="FL_RUT_NM" column="FL_RUT_NM"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
		<result property="SYS_FL_NM" column="SYS_FL_NM"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
 	</resultMap>
 	
 	<select id="CSPEAR013PMainSelect" parameterClass="paramMap"
		resultMap="CSPEAR013">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,#strREQ_DOC_KND_CD# AS REQ_DOC_KND_CD
   					,C.ONR_DOC_MNG_CRD_ID
   					,C.CVPT_OPM_APV_HNDL_STA_CD
				   	,C.OPM_TXT
				   	,A.AD||' '||A.DTL_AD AS AD
				   	,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) || ' 귀하 (우'||A.ZCD || ' ' || A.AD || ' ' || A.DTL_AD || ')' AS RECEIVER
   					,A.ZCD
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,DECODE(A.TNB,NULL,A.HPN,A.TNB) AS TEL
   					, D.FL_RUT_NM
					, D.SYS_FL_NM
   			FROM	TBCSPDCP101M A
   					,TBCSPEAR001M B
   					,TBCSPEAR002M C
   					, TBDCMACM103L D
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = #strREQ_DVSN_CD#
			AND		A.ACP_YR = #strACP_YR#
			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		C.REQ_DOC_KND_CD(+) = #strREQ_DOC_KND_CD#
   			AND		C.ONR_DOC_MNG_CRD_ID = D.ONR_DOC_MNG_CRD_ID(+)
		]]>
	</select>
	
	<insert id="CSPEAR013PEAR002OnrInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPEAR002M
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, OPM_TXT
        					, REQ_DOC_KND_CD
        					, ONR_DOC_MNG_CRD_ID
        					, CVPT_OPM_APV_HNDL_STA_CD
        					, ADMN_INF_HNDL_NO
        					, ONR_APV_RQS_DH
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
        					, #ACP_YR#
        					, #CVPT_ACP_NO#
        					, #OPM_TXT#
        					, #REQ_DOC_KND_CD#
					   		, #ONR_DOC_MNG_CRD_ID#
					   		, '20'
					   		, #ADMN_INF_HNDL_NO#
					   		, SYSDATE
        					, F_USR_INFO(#S_CNB#, '1')
        					, #FNL_USR_ID#
        					, #FNL_DEAL_DPT_CD#
        					, #FNL_MNU_ID#
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>
	
	<select id="CSPEAR013POnrUserInfoSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	/*CSPDCP418POnrUserInfoSelect*/
					D1.USR_ID, 
					D1.EML_AD,
					F_DPT_INFO(D1.DPT_CD,'6') AS DEPT_CD,
					D2.FRML_DPT_NM AS DEPT_NM,	
					'CSPDCP' AS BIZ_GUBUN,
					D1.USR_NAM, 
					D1.RANK_NM_2 AS POSITION_NM
			FROM	TBDCMACM001M D1
					,TBDCMACM002M D2
			WHERE 	USR_ID = #FNL_USR_ID#
			AND		D1.DPT_CD = D2.DPT_CD
		]]>
	</select>
</sqlMap> 
