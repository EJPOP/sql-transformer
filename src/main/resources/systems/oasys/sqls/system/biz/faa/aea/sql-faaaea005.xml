<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/aea/005">
	<select id="FAAAEA005EMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<include refid="include.pageSelct" />
		<![CDATA[
			SELECT T1.SRNO
			       ,F_CODE_NM('1000854',T1.MTRL_DVSN_CD) AS MTRL_DVSN_NM
			       ,T1.MTRL_DVSN_CD
			       ,F_ORG_INFO(T1.ORG_CD,'1') AS ORG_NM
			       ,T1.ORG_CD
			       ,T1.TIT_NM
			       ,F_USR_INFO(T1.REGN_CNB,'2') AS REGN_NM
			       ,T1.REGN_CNB
			       ,TO_CHAR(T1.FRT_REGI_DH,'YYYY-MM-DD') AS FRT_REGI_DT
			       ,T1.DTL_TXT
			       ,T1.DOC_ID
			  FROM TBFAAAEA043M T1, TBDCMACM015M T2
			  
			 WHERE 1=1 
			 AND T1.ORG_CD = T2.ORG_CD
		]]>
		
		<dynamic>
			<isNotEmpty property="strMTRL_DVSN_CD">
				AND T1.MTRL_DVSN_CD = #strMTRL_DVSN_CD#
			</isNotEmpty>
			<isNotEmpty property="strORG_CD">
				AND T1.ORG_CD = #strORG_CD#
			</isNotEmpty>
			<isNotEmpty property="strTIT_NM">
				AND T1.TIT_NM LIKE '%'||#strTIT_NM#||'%'
			</isNotEmpty>
			<isNotEmpty property="strSRNO">
				AND T1.SRNO = #strSRNO#
			</isNotEmpty>
			<isNotEmpty property="strFRT_REGI_DT1">
				AND TO_CHAR(T1.FRT_REGI_DH,'YYYYMMDD') <![CDATA[ >= ]]> #strFRT_REGI_DT1#
			</isNotEmpty>
			<isNotEmpty property="strFRT_REGI_DT2">
				AND TO_CHAR(T1.FRT_REGI_DH,'YYYYMMDD') <![CDATA[ <= ]]>  #strFRT_REGI_DT2#
			</isNotEmpty>
			<isNotEmpty property="strORG_DVSN_CD">
				AND T1.ORG_CD IN 
					(SELECT A1.ORG_CD  FROM TBDCMACM015M A1 
						WHERE A1.ORG_DVSN_CD IN (SELECT CD FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD='1000119' AND USR_DFN_TXT_2= #strORG_DVSN_CD#)
						GROUP BY A1.ORG_CD)
			</isNotEmpty>
			<isNotEmpty property="strORG_CHK">
			<isEqual property="strDPT_TP_CD" compareValue="A">
				AND T2.ENFM_DPT_CD = #strDPT_CD#
			</isEqual>
			</isNotEmpty>
		</dynamic>
		
		<include refid="include.pageOrder" />
	</select>
	
	
	<select id="FAAAEA005EMainDetailSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.SRNO
			       ,F_CODE_NM('1000854',T1.MTRL_DVSN_CD) AS MTRL_DVSN_NM
			       ,T1.MTRL_DVSN_CD
			       ,F_ORG_INFO(T1.ORG_CD,'1') AS ORG_NM
			       ,T1.ORG_CD
			       ,T1.TIT_NM
			       ,F_USR_INFO(T1.REGN_CNB,'2') AS REGN_NM
			       ,T1.REGN_CNB
			       ,TO_CHAR(T1.FRT_REGI_DH,'YYYY-MM-DD') AS FRT_REGI_DT
			       ,T1.DTL_TXT
			       ,T1.DOC_ID
			  FROM TBFAAAEA043M T1
			 WHERE 1=1
		]]>
		
		<dynamic>
			<isNotEmpty property="strSRNO">
				AND T1.SRNO = #strSRNO#
			</isNotEmpty>
		</dynamic>
		
	</select>
		
	
	<select id="FAAAEA006EKeySelect" parameterClass="paramMap" resultClass="integer">
		<![CDATA[
			SELECT FAAAEA043_SEQ.NEXTVAL FROM DUAL
		]]>
	</select>
	
	
	<insert id="FAAAEA006EMainInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBFAAAEA043M
						(	 SRNO
						    ,MTRL_DVSN_CD
						    ,ORG_CD
						    ,TIT_NM
						    ,DTL_TXT
						    ,DOC_ID
						    ,REGN_CNB
						    ,FRT_USR_ID
						    ,FNL_USR_ID
						    ,FNL_DEAL_DPT_CD
						    ,FNL_MNU_ID
						    ,FRT_REGI_DH
						    ,FNL_MDF_DH
						)
					VALUES (	 #SRNO#
								,#MTRL_DVSN_CD#
						        ,#ORG_CD#
						    	,#TIT_NM#
						    	,#DTL_TXT#
						    	,#DOC_ID#
						    	,#S_CNB#
						    	,#FRT_USR_ID#
						    	,#FNL_USR_ID#
						    	,#FNL_DEAL_DPT_CD#
						   	 	,#FNL_MNU_ID#
						    	,SYSDATE
						    	,SYSDATE
						   )
		]]>
	</insert>
	
	<update id="FAAAEA006EMainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBFAAAEA043M T1
			   SET MTRL_DVSN_CD = #MTRL_DVSN_CD#
			      ,ORG_CD = #ORG_CD#
			      ,TIT_NM = #TIT_NM#
			      ,DTL_TXT = #DTL_TXT#
			      ,DOC_ID = #DOC_ID#
			      ,FNL_USR_ID = #FNL_USR_ID#
			      ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			      ,FNL_MNU_ID = #FNL_MNU_ID#
			      ,FNL_MDF_DH = SYSDATE
			 WHERE T1.SRNO = #SRNO#
		]]>
	</update>
	
	<delete id="FAAAEA006EMainDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE
			  FROM TBFAAAEA043M T1
			 WHERE T1.SRNO = #SRNO#
		]]>
	</delete>
	<select id="FAAAEA005QExcelExportSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT  ROW_NUMBER() OVER( ORDER BY SRNO DESC ) AS NUM
			       ,T1.MTRL_DVSN_CD/*자료구분코드*/
			       ,F_CODE_NM('1000854',T1.MTRL_DVSN_CD) AS MTRL_DVSN_NM/*자료구분*/
			       ,T2.ORG_DVSN_CD
			       ,T1.ORG_CD /*기관코드*/
			       ,F_ORG_INFO(T1.ORG_CD,'1') AS ORG_NM /*기관명*/
			       ,T1.TIT_NM  /*제목*/
			       ,F_USR_INFO(T1.REGN_CNB,'2') AS REGN_NM /*작성자*/
			       ,TO_CHAR(T1.FRT_REGI_DH,'YYYY-MM-DD') AS FRT_REGI_DT/*등록일*/
			       ,T1.SRNO
			       ,T1.REGN_CNB
			       ,T1.DTL_TXT
			       ,T1.DOC_ID
			  FROM TBFAAAEA043M T1, TBDCMACM015M T2
			 WHERE 1=1
			 AND T1.ORG_CD = T2.ORG_CD(+)
		]]>
		
		<dynamic>
			<isNotEmpty property="strMTRL_DVSN_CD">
				AND T1.MTRL_DVSN_CD = #strMTRL_DVSN_CD#
			</isNotEmpty>
			<isNotEmpty property="strORG_CD">
				AND T1.ORG_CD = #strORG_CD#
			</isNotEmpty>
			<isNotEmpty property="strTIT_NM">
				AND T1.TIT_NM LIKE '%'||#strTIT_NM#||'%'
			</isNotEmpty>
			<isNotEmpty property="strSRNO">
				AND T1.SRNO = #strSRNO#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 유저의 부서가 감사부서 인지를 조회한다 -->
	<select id="FAAAEA005QDptTpCdSelect" parameterClass="paramMap" resultClass="String">
		<![CDATA[	
			SELECT DPT_TP_CD
			  FROM TBDCMACM002M
			WHERE DPT_CD = #strDPT_CD# AND USE_YN='Y'
		]]>
	</select>
	
</sqlMap> 
