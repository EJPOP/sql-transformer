<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/gda/012">
    
	<!--실시구분 조회-->
	<select id="BADGDA012PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
        
                SELECT TSK_DVSN_CD
                      ,TSK_DVSN_NM
                      ,YR_NO
                      ,KND_NM
                      ,YR
                      ,NO
                      ,AUD_GRN_NO                      
                      ,DPT_CD
                      ,DPT_NM        
                      ,TIT_NM
                 FROM (
                         SELECT '1'                                                           AS TSK_DVSN_CD
                               ,'실지감사'                                                     AS TSK_DVSN_NM
                               ,F_MNG_KND_AUDYRNO(AUD_YR, AUD_NO, AUD_KND_CD, '-')            AS YR_NO
                               ,CASE WHEN AUD_YR >= '2016' 
              	    	             THEN F_CODE_NM('1000739',SUBSTR(AUD_KND_CD,3,1))
              	    	             ELSE '' 
              	    	         END                                                          AS KND_NM              
                               ,AUD_YR                                                        AS YR           
                               ,AUD_NO                                                        AS NO
                               ,AUD_GRN_NO                                                    AS AUD_GRN_NO
                               ,SPV_BRDV_CD                                                   AS DPT_CD
                               ,F_DPT_INFO(SPV_BRDV_CD,'1')                                   AS DPT_NM             
                               ,AUD_SBJ_NM                                                    AS TIT_NM
                           FROM TBBADDED001M
                          WHERE AUD_YR = #strYr#
        ]]>                               
					<isNotEmpty property="strTskDvsnCd">	 
							AND '1' = #strTskDvsnCd#
					</isNotEmpty>	
					<isNotEmpty property="strDptCd">	 
							AND SPV_BRDV_CD = #strDptCd#
					</isNotEmpty>								
					<isNotEmpty property="strTitNm">	 
							AND AUD_SBJ_NM LIKE '%' || #strTitNm# || '%'
					</isNotEmpty>	                          
                     
  		<![CDATA[                           
                          
                        UNION ALL 
                         
                         SELECT '2'                                                           AS TSK_DVSN_CD
                               ,'손망실'                                                       AS TSK_DVSN_NM                         
                                ,YR||'-손망-'||ACP_NO                                          AS YR_NO  
                                ,'손망실'                                                      AS KND_NM       
                                ,YR                                                           AS YR 
                                ,TO_CHAR(ACP_NO)                                              AS NO
                                ,''                                                           AS AUD_GRN_NO                                
                                ,DPT_CD                                                       AS DPT_CD
                                ,F_DPT_INFO(DPT_CD,'1')                                       AS DPT_NM                 
                                ,TIT_NM                                                       AS TIT_NM
                            FROM TBBADGDA001M
                           WHERE YR          = #strYr#
                             AND NTF_DVSN_CD = '2'            /* 손망실 */
                             AND OGN_DVSN_CD IN ('3','4','5') /* 망실,훼손,멸실 */
                             
        ]]>                               
					<isNotEmpty property="strTskDvsnCd">	 
							 AND '2' = #strTskDvsnCd#
					</isNotEmpty>		
					<isNotEmpty property="strDptCd">	 
							 AND DPT_CD = #strDptCd#
					</isNotEmpty>						
					<isNotEmpty property="strTitNm">	 
							 AND TIT_NM LIKE '%' || #strTitNm# || '%'
					</isNotEmpty>	                          
                     
  		<![CDATA[     
                         UNION ALL
                            
                          SELECT '3'                                                          AS TSK_DVSN_CD
                               ,'판정청구'                                                     AS TSK_DVSN_NM                          
                                ,YR||'-판청-'||ACP_NO                                         AS YR_NO  
                                ,'판정청구'                                                    AS KND_NM                           
                                ,YR                                                           AS YR         
                                ,TO_CHAR(ACP_NO)                                              AS NO   
                                ,''                                                           AS AUD_GRN_NO                                      
                                ,DPT_CD                                                       AS DPT_CD     
                                ,F_DPT_INFO(DPT_CD,'1')                                       AS DPT_NM                               
                                ,TIT_NM                                                       AS TIT_NM     
                            FROM TBBADGDA001M
                           WHERE YR          = #strYr#
                             AND NTF_DVSN_CD = '2' /* 손망실 */
                             AND OGN_DVSN_CD = '6' /* 판정청구 */
        ]]>                               
					<isNotEmpty property="strTskDvsnCd">	 
							 AND '3' = #strTskDvsnCd#
					</isNotEmpty>		
					<isNotEmpty property="strDptCd">	 
							 AND DPT_CD = #strDptCd#
					</isNotEmpty>						
					<isNotEmpty property="strTitNm">	 
							 AND TIT_NM LIKE '%' || #strTitNm# || '%'
					</isNotEmpty>	                          
                     
  		<![CDATA[  
                )
                   
                WHERE 1=1    
                ORDER BY TSK_DVSN_CD
                        ,YR
                        ,NO  
        ]]>
	</select>
</sqlMap> 
