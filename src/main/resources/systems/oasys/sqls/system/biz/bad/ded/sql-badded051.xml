<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ded/051">
	<!-- 서면/모니터링감사를 조회한다. -->
	<select id="BADDED051EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			   SELECT D1.AUD_YR                   		AS AUD_YR           /*감사년도*/
			        , D1.AUD_NO                   		AS AUD_NO           /*감사번호*/
			        , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-') 
			        	                                AS AUD_YR_NO        /*감사년번호*/
			        , D1.AUD_KND_CD               		AS AUD_KND_CD       /*감사종류코드*/
                    , F_CODE_NM_YEAR('1000007', D1.AUD_KND_CD, D1.AUD_YR) AS AUD_KND_NM 
			        , D1.SPV_BRDV_CD              		AS SPV_BRDV_CD      /*주관국과코드*/
			        , F_DPT_INFO(D1.SPV_BRDV_CD,'1')	AS SPV_BRDV_NM  	/*주관국과명*/
			        , D1.AUD_SBJ_NM               		AS AUD_SBJ_NM       /*감사사항명*/
				FROM TBBADDED001M D1
		       WHERE 1=1
		         AND D1.AUD_NO LIKE '9%' /*서면모니터링*/
		         AND SUBSTR(D1.AUD_KND_CD,3,1) = '9' /* 추가 - 2015.12.23 yyh*/
		]]>
		<isNotEmpty property="AUD_YR">	 
			     AND D1.AUD_YR      = #AUD_YR#
		</isNotEmpty>
        <![CDATA[       
			   ORDER BY D1.AUD_NO 
        ]]>
	</select>


	<!-- 서면/모니터링감사를 일괄생성한다. -->
	<insert id="BADDED051EMainInsert" parameterClass="paramMap">
		<![CDATA[  
			INSERT INTO TBBADDED001M
			 (
			       AUD_YR
			     , AUD_NO
			     , AUD_KND_CD
			     , SPV_BRDV_CD
			     , AUD_SBJ_NM
			     , MNG_DPT_CD
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH  
			)
			SELECT #AUD_YR#
			     ,  '9'||SUBSTR(DPT_CD,2,1)||SUBSTR(DPT_CD,5,1)
			     , SUBSTR(#AUD_YR#,3,2)||'9'
			     , DPT_CD
			     , DPT_NM ||' 서면감사/모니터링'
			     , DPT_CD
			     , #FRT_USR_ID#
			     , #FNL_USR_ID#
			     , #FNL_DEAL_DPT_CD#
			     , #FNL_MNU_ID#
			     , SYSDATE
			     , SYSDATE			     
			  FROM TBDCMACM002M
			 WHERE 1=1
			   AND DPT_CD NOT LIKE '%000'
			   AND USE_YN = 'Y'
   			   AND DPT_TP_CD = 'A'
		]]>
	</insert>
	
	<!-- 서면/모니터링감사를 삭제한다. -->
	<update id="BADDED051EMainDelete" parameterClass="paramMap">
		<![CDATA[  
			DELETE 
			  FROM TBBADDED001M
			 WHERE 1=1
			   AND AUD_YR = #AUD_YR#
			   AND AUD_NO LIKE '9%'
		       AND SUBSTR(AUD_KND_CD,3,1) = '9' /* 추가 - 2015.12.23 yyh*/			   
		]]>	   
	</update>

</sqlMap> 

