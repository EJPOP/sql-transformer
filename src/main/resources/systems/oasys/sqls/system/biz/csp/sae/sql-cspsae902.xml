<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/sae/902">

	<select id="CSPSAE902QCbbYr" parameterClass="paramMap" resultClass="resultMap">
		/*cspsae902 CSPSAE902QCbbYr*/
        <![CDATA[
            SELECT 	YYYY AS YR_CD, 
					YYYY AS YR_NM 
			FROM	(
						SELECT TO_CHAR(SYSDATE,'YYYY') - LEVEL + 1 YYYY 
						FROM DUAL 
						CONNECT BY TO_CHAR(SYSDATE,'YYYY') - LEVEL + 1 >= 1980
					)
        ]]>
	</select>
	
	<select id="CSPSAE902QMainList" parameterClass="paramMap" resultClass="resultMap">
		/*cspsae902 CSPSAE902QMainList*/
		<![CDATA[
		  SELECT ROWNUM AS NUM , T.*
			FROM
			( SELECT
			       A.DVSN_CD,
			       F_CODE_NM('1001014',A.DVSN_CD) AS DVSN_NM,
			       A.TIT_NM,
			       A.ORG_CD,
			       A.FRT_REGI_DH,
			       F_ORG_INFO(A.ORG_CD,'1') AS ORG_NM,
			       F_USR_INFO(A.CNB, '2') AS USR_NAM,
			       A.SNO,
			       A.SRCH_CNT,
			       A.CNB,
			       A.APL_WAY_CD,
			       F_CODE_NM('1001015',A.APL_WAY_CD) AS APL_WAY_NM
			  FROM TBCSPSAE902M A
			  WHERE 1=1
		]]>
		<dynamic>
			 <isNotEmpty property="strYR_CD">
		     	AND SUBSTR(A.FRT_REGI_DH,1,4) = #strYR_CD#
		     </isNotEmpty>
		     <isNotEmpty property="strDVSN_CD">
		     	AND A.DVSN_CD = #strDVSN_CD#
		     </isNotEmpty>
		     <isNotEmpty property="strORG_CD">
		     	AND A.ORG_CD = #strORG_CD#
		     </isNotEmpty>
	     </dynamic>
		<![CDATA[
		  ORDER BY TO_NUMBER(A.SNO)
		  ) T ORDER BY NUM DESC
		]]>
	</select>
	
	<update id="CSPSAE902QSrchCntUp" parameterClass="paramMap">
		/*cspsae902 CSPSAE902QSrchCntUp*/
		<![CDATA[
			UPDATE TBCSPSAE902M 
				SET SRCH_CNT = (SELECT SRCH_CNT+1 FROM TBCSPSAE902M WHERE SNO = #strSNO#)
                WHERE SNO = #strSNO#
		]]>
	</update>
	
	<select id="CSPSAE902EselectMain" parameterClass="paramMap" resultClass="resultMap">
		/*cspsae902 CSPSAE902EselectMain*/
		<![CDATA[
			SELECT  
			     A.ORG_CD
			    ,F_ORG_INFO(A.ORG_CD,'1') AS ORG_NM
			    ,A.TIT_NM
			    ,A.TXT
			    ,A.DVSN_CD
			    ,A.SNO
			    ,A.DOC_ID
			    ,A.APL_WAY_CD
			FROM TBCSPSAE902M A
			WHERE
			    A.SNO = #strSNO#
		]]>  
	</select>
	
	<insert id="CSPSAE902EMainInsert" parameterClass="paramMap">
		/*cspsae902 CSPSAE902EMainInsert*/
		<selectKey keyProperty="SNO" resultClass="java.lang.String" type="pre" >
			SELECT TO_CHAR(NVL(MAX(TO_NUMBER(SNO)),0)+1)
				  FROM TBCSPSAE902M
		</selectKey>
		<![CDATA[   
			INSERT INTO TBCSPSAE902M
        	(		SNO,
					DVSN_CD,
					APL_WAY_CD,
					TIT_NM,
					ORG_CD,
					CNB,
					TXT,
					DOC_ID,
					
        			FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
        	) VALUES (
        			#SNO#,
					#DVSN_CD#,
					#APL_WAY_CD#,
					#TIT_NM#,
					#ORG_CD#,
					#S_CNB#,
					#TXT#,
					#DOC_ID#,
                    
					#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
                    SYSDATE
             )
        ]]>
	</insert>
	
	<delete id="CSPSAE902EMainDelete" parameterClass="paramMap">
		/*cspsae902 CSPSAE902EMainDelete*/
        <![CDATA[     	
			DELETE FROM TBCSPSAE902M 
			 WHERE SNO = #SNO#
		]]>
	</delete>
	
	<update id="CSPSAE902EMainUpdate" parameterClass="paramMap">
		/*cspsae902 CSPSAE902EMainUpdate*/
		<![CDATA[
			UPDATE TBCSPSAE902M
				SET DVSN_CD = #DVSN_CD#
					,APL_WAY_CD = #APL_WAY_CD#
					,TIT_NM = #TIT_NM#
					,ORG_CD = #ORG_CD#
					,TXT = #TXT#
					,FNL_USR_ID = #FNL_USR_ID#
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID = #FNL_MNU_ID#
					,FNL_MDF_DH = SYSDATE
				WHERE SNO = #SNO#
		]]>
	</update>
	<update id="CSPSAE902EFileUpdate" parameterClass="paramMap">
		/*cspsae902 CSPSAE902EFileUpdate*/
		<![CDATA[
			UPDATE TBCSPSAE902M
				SET DOC_ID = #DOC_ID#
				WHERE SNO = #SNO#
		]]>
	</update>
	
	<select id="CSPSAE902QExcelSelect" parameterClass="paramMap"
		resultClass="resultMap">
		/*cspsae902 CSPSAE902QExcelSelect*/
        <![CDATA[     	
			    SELECT ROWNUM AS NUM , T.*
			FROM
			( SELECT
			       F_CODE_NM('1001014',A.DVSN_CD) AS DVSN_NM,
			       F_CODE_NM('1001015',A.APL_WAY_CD) AS APL_WAY_NM,
			       A.TIT_NM,
			       F_ORG_INFO(A.ORG_CD,'1') AS ORG_NM,
			       F_USR_INFO(A.CNB, '2') AS USR_NM,
			       TO_CHAR(A.FRT_REGI_DH,'YYYY-MM-DD') AS FRT_REGI_DH,
			       A.SRCH_CNT
			  FROM TBCSPSAE902M A
			  WHERE 1=1
		]]>
		<dynamic>
			 <isNotEmpty property="strYR_CD">
		     	AND SUBSTR(A.FRT_REGI_DH,1,4) = #strYR_CD#
		     </isNotEmpty>
		     <isNotEmpty property="strDVSN_CD">
		     	AND A.DVSN_CD = #strDVSN_CD#
		     </isNotEmpty>
		     <isNotEmpty property="strORG_CD">
		     	AND A.ORG_CD = #strORG_CD#
		     </isNotEmpty>
	     </dynamic>
		<![CDATA[
		  ORDER BY TO_NUMBER(A.SNO)
		  ) T ORDER BY NUM DESC
		]]>
	</select>
	
</sqlMap> 
