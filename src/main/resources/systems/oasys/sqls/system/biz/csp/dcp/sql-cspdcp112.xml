<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/112">

	<select id="CSPDCP112PSmgKeySelect" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT	SMG_FRT_CON_NO
			FROM	TBCSPDCP101M
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR	= #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</select>
	
	<select id="CSPDCP112PSmgKeySelect2" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT	A.INTERFACE_KEY
			FROM	T_IC_TARGET_SRC_INTERFACE A
					,TBCSPDCP101M B
			WHERE	B.REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		B.ACP_YR	= #ACP_YR#
			AND		B.CVPT_ACP_NO = #CVPT_ACP_NO#
			AND		A.PETI_NO = B.SMG_CVPT_APL_NO
			AND		A.PETI_GUBUN = B.SMG_FRT_HNDL_STA_CD
		]]>
	</select>
	
	<update id="CSPDCP112P101Update" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPDCP101M
			SET		CVPT_HNDL_STA_CD = '80'
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR	= #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	<insert id="CSPDCP112P107Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	TBCSPDCP107H
        				(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,SRNO
        					,BACK_RSN
        					,BACK_GCC_ORG_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
							,#ACP_YR#
							,#CVPT_ACP_NO#
							,(	SELECT NVL(MAX(SRNO),0)+1
								  FROM TBCSPDCP107H
								 WHERE 1=1
							       AND REQ_DVSN_CD = #REQ_DVSN_CD#
							       AND ACP_YR = #ACP_YR#
							       AND CVPT_ACP_NO = #CVPT_ACP_NO#
							 )
							,#BACK_RSN#
							,'1140100'
							,F_USR_INFO(#S_CNB#,'1')
							,#FNL_USR_ID#
							,#FNL_DEAL_DPT_CD#
							,#FNL_MNU_ID#
							,SYSDATE
							,SYSDATE
						)
		]]>
	</insert>
	
	<insert id="CSPDCP112P202Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	TBCSPDCP202H
        				(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,CVPT_DTB_HST_SRNO
        					,DTB_DPT_CD
        					,DTB_PEN_ID
        					,CVPT_HNDL_STA_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
							,#ACP_YR#
							,#CVPT_ACP_NO#
							,(	SELECT NVL(MAX(CVPT_DTB_HST_SRNO),0)+1
								  FROM TBCSPDCP202H
								 WHERE 1=1
							       AND REQ_DVSN_CD = #REQ_DVSN_CD#
							       AND ACP_YR = #ACP_YR#
							       AND CVPT_ACP_NO = #CVPT_ACP_NO#
							 )
							,#FNL_DEAL_DPT_CD#
							,F_USR_INFO(#S_CNB#,'1')
							,'80'
							,F_USR_INFO(#S_CNB#,'1')
							,#FNL_USR_ID#
							,#FNL_DEAL_DPT_CD#
							,#FNL_MNU_ID#
							,SYSDATE
							,SYSDATE
						)
		]]>	
	</insert>
	
	<insert id="CSPDCP112PSmgReInsert" parameterClass="paramMap">
		INSERT INTO	T_IC_TARGET_SRC_INTERFACE
						(	INTERFACE_KEY
							,APP_ORGAN_CODE		/*최초 민원 신청 기관코드(GCC)*/
							,PETI_NO			/*민원신청번호*/
							,REC_SEQ			/*분류이력일련번호*/
							,CIVIL_NO			/*민원접수번호*/
							,PETI_GUBUN			/*민원구분 (500고정,담당자부서지정) */
							,USER_NAME			/*민원신청인명*/
							,ZIP_CODE
							,ADDRESS
							,EMAIL
							,HP
							,TEL
							,APP_TITLE
							,APP_CONTENTS
							,OPEN_YN
							,APP_REG_DATE
							,APP_CONTENTS_ATTACH_YN
							,APP_ATTACH_FILE_SIZE
							,APP_ATTACH_FILE_PATH1
							,APP_ATTACH_FILE_PATH2
							,APP_ATTACH_FILE_PATH3
							,APP_ATTACH_FILE_PATH4
							,APP_ATTACH_FILE_PATH5
							,ANSWER_TYPE
							,CIVIL_REL_NAME
							,CIVIL_REL_TEL_NO
							,CIVIL_REL_ZIPCODE
							,CIVIL_REL_ADDR
							,CANCEL_PCD_STATUS
							,CANCEL_STATUS
							,PCD_CONTENTS_ATTACH_YN
							,RECOM_ORGAN_CODE
							,ORGAN_CNT
							,DO_SEQ
							,APP_BRANCH_KEY
							,PROPOSAL_GUBUN
							,DEPT_LOG
							,DEPT_NM_LOG
							,DUTY_LOG
							,DUTY_EMAIL_LOG
							,DUTY_TEL_LOG
							,SRCORGCD
							,TGTORGCD
							,WRITE_TIME
							,SND_RCV_GUBUN
							,SND_RCV_TIME
							,SEND_YN
							,APPLY_GUBUN
							,APPLY_TIME
							,RESELECT_CNT
							,CVPL_SE
							,RECOM_REASON
						)
				SELECT	TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF2') || LPAD(ROUND(DBMS_RANDOM.VALUE(1, 999999999)), 9, '0')
						,APP_ORGAN_CODE		/*최초 민원 신청 기관코드(GCC)*/
						,PETI_NO			/*민원신청번호*/
						,REC_SEQ			/*분류이력일련번호*/
						,CIVIL_NO			/*민원접수번호*/
						,'140'			/*민원구분 (500고정,담당자부서지정) */
						,USER_NAME			/*민원신청인명*/
						,ZIP_CODE
						,ADDRESS
						,EMAIL
						,HP
						,TEL
						,APP_TITLE
						,APP_CONTENTS
						,OPEN_YN
						,APP_REG_DATE
						,APP_CONTENTS_ATTACH_YN
						,APP_ATTACH_FILE_SIZE
						,APP_ATTACH_FILE_PATH1
						,APP_ATTACH_FILE_PATH2
						,APP_ATTACH_FILE_PATH3
						,APP_ATTACH_FILE_PATH4
						,APP_ATTACH_FILE_PATH5
						,ANSWER_TYPE
						,CIVIL_REL_NAME
						,CIVIL_REL_TEL_NO
						,CIVIL_REL_ZIPCODE
						,CIVIL_REL_ADDR
						,CANCEL_PCD_STATUS
						,CANCEL_STATUS
						,PCD_CONTENTS_ATTACH_YN
						,'1140100'
						,ORGAN_CNT
						,DO_SEQ
						,APP_BRANCH_KEY
						,PROPOSAL_GUBUN
						,DEPT_LOG
						,DEPT_NM_LOG
						,DUTY_LOG
						,DUTY_EMAIL_LOG
						,DUTY_TEL_LOG
						,'1040000'
						,'1140100'
						,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
						,'1'
						,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
						,'N'
						,APPLY_GUBUN
						,APPLY_TIME
						,RESELECT_CNT
						,CVPL_SE
						,#BACK_RSN#
				FROM	T_IC_TARGET_SRC_INTERFACE
				WHERE	INTERFACE_KEY = #SMG_FRT_CON_NO#
	</insert>	
</sqlMap> 
