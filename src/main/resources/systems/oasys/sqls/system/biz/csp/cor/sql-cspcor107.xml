<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/cor/107">
 	
 	<update id="CSPCOR107IHndlApvSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPCOR104M
			SET		HNDL_APV_DOC_NO = #APV_DOC_NO#
					,HNDL_APV_STA_CD = #HNDL_APV_STA_CD#
					,INSPC_DPT_TRNF_DT = CASE WHEN #HNDL_APV_STA_CD# = '102' THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE NULL END 
			WHERE	1=1
		]]>
			<dynamic>
				<isEmpty property="CORR_DVSN_CD">
					<![CDATA[
					AND HNDL_APV_DOC_NO = #APV_DOC_NO#
					]]>
				</isEmpty>
				<isNotEmpty property="CORR_DVSN_CD">
					<![CDATA[
					AND     CORR_DVSN_CD = #CORR_DVSN_CD#
					AND		ACP_YR = #ACP_YR#
					AND		CORR_ACP_NO = #CORR_ACP_NO#
					]]>
				</isNotEmpty>
			</dynamic>
	</update>
	
	
	<update id="CSPCOR107ITBCSPCOR101MHndlStaCdUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPCOR101M
			SET		HNDL_STA_CD = CASE WHEN #HNDL_APV_STA_CD# = '102' THEN '40' ELSE HNDL_STA_CD END
			WHERE	1=1
		]]>
			<dynamic>
				<isEmpty property="CORR_DVSN_CD">
					<![CDATA[
					AND (CORR_DVSN_CD, ACP_YR, CORR_ACP_NO) IN ( SELECT CORR_DVSN_CD, ACP_YR, CORR_ACP_NO
					        									   FROM TBCSPCOR104M S1
					                                              WHERE S1.HNDL_APV_DOC_NO = #APV_DOC_NO#
					                                            )
					]]>
				</isEmpty>
				<isNotEmpty property="CORR_DVSN_CD">
					<![CDATA[
					AND     CORR_DVSN_CD = #CORR_DVSN_CD#
					AND		ACP_YR = #ACP_YR#
					AND		CORR_ACP_NO = #CORR_ACP_NO#
					]]>
				</isNotEmpty>
			</dynamic>
	</update>
	
	<update id="CSPCOR107ITBCSPCOR101MHndlStaCdSucUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPCOR101M
			SET		HNDL_STA_CD = CASE WHEN #HNDL_APV_STA_CD# = '102' THEN '40' ELSE HNDL_STA_CD END
			WHERE	(CORR_DVSN_CD, ACP_YR, CORR_ACP_NO) 
				 IN ( SELECT S1.SUC_CORR_DVSN_CD, SUC_ACP_YR, SUC_CORR_ACP_NO
			            FROM TBCSPCOR107L S1
			           WHERE 1=1
		]]>
			<dynamic>
				<isEmpty property="CORR_DVSN_CD">
					<![CDATA[
					     AND (CORR_DVSN_CD, ACP_YR, CORR_ACP_NO) IN ( SELECT S2.CORR_DVSN_CD, S2.ACP_YR, S2.CORR_ACP_NO
					        									        FROM TBCSPCOR104M S2
					                                                   WHERE S2.HNDL_APV_DOC_NO = #APV_DOC_NO#
					                                                 )
					]]>
				</isEmpty>
				<isNotEmpty property="CORR_DVSN_CD">
					<![CDATA[
			             AND S1.CORR_DVSN_CD = #CORR_DVSN_CD#
			             AND S1.ACP_YR = #ACP_YR#
			             AND S1.CORR_ACP_NO = #CORR_ACP_NO#
			     
			        ]]>
				</isNotEmpty>
			</dynamic>
			<![CDATA[
				)
			]]>
	</update>
</sqlMap> 
