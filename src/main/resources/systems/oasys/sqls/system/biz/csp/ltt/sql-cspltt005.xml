<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/ltt/005">
 
 	<select id="CSPLTT005EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	DECODE(A.ACP_NO,NULL,'',A.ACP_YE||'-'||A.ACP_NO) AS ACP_NO	/*접수번호*/
					,A.TIT_NM		/*제목*/
					,CASE WHEN NAM_OPEN_YN = 'Y' THEN F_USR_INFO(DGUARD.DECRYPT('TB_ENC','EAN', A.CNB) ,'2') 
                  	      ELSE '익명' END AS USR_NAM	/*제안자명*/
                  	,A.NAM_OPEN_YN
					,CASE WHEN NAM_OPEN_YN = 'Y' THEN F_DPT_INFO(DGUARD.DECRYPT('TB_ENC','EAN', A.DPT_CD),'1') 
					      ELSE '' END AS DPT_NM
					,A.SMT_DT			/*제출일자*/
					,A.EXAM_DPT_CD		/*검토부서코드*/
					,CASE WHEN NVL(A.MDT_YN,'N') = 'Y' AND A.PRSS_STA_CD IN ('M', 'N') THEN F_DPT_INFO(A.MDT_DPT_CD, 1)
	     			      ELSE F_DPT_INFO(A.EXAM_DPT_CD, 1) END AS EXAM_DPT_NM					
					,A.OPEN_DT          /*공개일자*/
					,60 - (TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) - TO_DATE(A.OPEN_DT)) AS DEL_DT /*숨김일자*/
					,A.PRSS_STA_CD		/*진행상태코드*/
					,F_CODE_NM('1000992',A.PRSS_STA_CD) AS PRSS_STA_NM
					,A.TK_YE			/*생각연도*/
					,A.TK_SLN			/*생각연번*/
					,(SELECT 	Z.DOC_ID	
						FROM	TBCSPLTT002M Z
						WHERE	Z.TK_YE = A.TK_YE
						AND		Z.TK_SLN = A.TK_SLN
						AND		Z.ATT_FL_DVSN_CD = '1') AS DOC_ID	/*첨부파일 문서*/
					,A.EXAM_DT					
					,NVL(A.SRCH_CNT, 0) AS SRCH_CNT
					,NVL(B.CMMT_CNT, 0) AS CMMT_CNT
					,NVL(B.CMMT_PED_CNT, 0) AS CMMT_PED_CNT
                    ,NVL(C.RCMD_CNT, 0) AS RCMD_CNT
                    ,NVL(C.DCMD_CNT, 0) AS DCMD_CNT
                    , CASE WHEN TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) < TO_DATE(A.OPEN_DT)+3 THEN 'Y'
					       ELSE 'N' END AS NEW_YN
					, CASE WHEN (SELECT COUNT(*) FROM TBCSPLTT004M S1 WHERE (TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) < TO_DATE(TO_CHAR(FRT_REGI_DH,'YYYYMMDD')) + 3) AND S1.TK_YE = A.TK_YE AND S1.TK_SLN = A.TK_SLN) > 0 THEN 'Y'
					       ELSE 'N' END AS CMT_NEW_YN
					, CASE WHEN NVL(A.MDT_YN,'N') = 'Y' AND A.PRSS_STA_CD IN ('M', 'N') AND TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) < TO_DATE(A.MDT_CHOS_DCS_DT)+7 THEN 'Y' 
					       WHEN NVL(A.MDT_YN,'N') = 'Y' AND A.PRSS_STA_CD IN ('P', 'G', 'H', 'I', 'J', 'K') AND TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) < TO_DATE(A.CHOS_DCS_DT)+7 THEN 'Y'
					       WHEN NVL(A.MDT_YN,'N') <> 'Y' AND A.PRSS_STA_CD IN ('M', 'N') AND TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) < TO_DATE(A.CHOS_DCS_DT)+7 THEN 'Y'
					       ELSE 'N' END AS EXAM_NEW_YN
					,NVL(A.MDT_YN,'N') AS MDT_YN
			FROM	TBCSPLTT001M A,		/*함께 생각합시다 기본*/
					(SELECT TK_YE,
							TK_SLN,
                            COUNT(*) AS CMMT_CNT,
                            SUM(CASE WHEN DEL_YN IS NULL THEN 1 ELSE 0 END ) AS CMMT_PED_CNT
                       FROM TBCSPLTT004M
                   GROUP BY TK_YE, TK_SLN) B,
                    (SELECT TK_YE,
							TK_SLN,
							SUM(CASE WHEN RCMD_YN = 'Y' THEN 1 ELSE 0 END ) AS RCMD_CNT,
						    SUM(CASE WHEN RCMD_YN = 'N' THEN 1 ELSE 0 END ) AS DCMD_CNT
					   FROM TBCSPLTT003M
		    	   GROUP BY TK_YE, TK_SLN) C
			WHERE	1=1
			  AND   A.TK_YE = B.TK_YE(+)
			  AND   A.TK_SLN = B.TK_SLN(+)
			  AND   A.TK_YE = C.TK_YE(+)
			  AND   A.TK_SLN = C.TK_SLN(+)			  
		]]>
		<dynamic>
			<isEmpty property="strPRSS_STA_CD">
				AND A.PRSS_STA_CD  &gt;= 'B' 
			</isEmpty>
			<isNotEmpty property="strPRSS_STA_CD">
				AND A.PRSS_STA_CD = #strPRSS_STA_CD#
			</isNotEmpty>
			<isNotEmpty property="strSMT_DTS">
				AND	(A.SMT_DT &gt;= #strSMT_DTS# OR A.SMT_DT IS NULL)
			</isNotEmpty>
			<isNotEmpty property="strSMT_DTE">
				AND	(A.SMT_DT &lt;= #strSMT_DTE# OR A.SMT_DT IS NULL)
			</isNotEmpty>
			<isNotEmpty property="strCNB">
				AND	DGUARD.DECRYPT('TB_ENC','EAN', A.CNB) = #strCNB#
				AND A.NAM_OPEN_YN = 'Y'
			</isNotEmpty>
			<isNotEmpty property="strTIT_NM">
				AND	A.TIT_NM LIKE '%'||#strTIT_NM#||'%'
			</isNotEmpty>
		</dynamic>
		<![CDATA[
			ORDER BY  TO_NUMBER(A.TK_YE) DESC , TO_NUMBER(A.ACP_NO) DESC
		]]>
	</select>
	
	<update id="CSPLTT005EOpenUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPLTT001M
			SET		OPEN_DT = TO_CHAR(SYSDATE,'YYYYMMDD')	/*제출일자*/
					,OPEN_YN = 'Y'          /*글 공개여부*/
					,PRSS_STA_CD = 'D'		/*진행상태 = D : 공개*/
					,ACP_YE = TO_CHAR(SYSDATE, 'YYYY')
					,ACP_NO = (SELECT	TO_CHAR(NVL(MAX(TO_NUMBER(ACP_NO))+1,1)) AS ACP_NO
									FROM	TBCSPLTT001M 
									WHERE	ACP_YE = TO_CHAR(SYSDATE, 'YYYY')
									)
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/
			WHERE	TK_YE = #TK_YE#
			AND		TK_SLN = #TK_SLN#
		]]>
	</update>
	
	<update id="CSPLTT005EActHideUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPLTT001M
			SET		OPEN_YN = 'N'
					,PRSS_STA_CD = 'C'		/*진행상태*/					
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/
					,MSG_TXT = #MSG_TXT#
			WHERE	TK_YE = #TK_YE#
			AND		TK_SLN = #TK_SLN#
		]]>
	</update>
	
	<update id="CSPLTT005EExamUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPLTT001M
			SET		PRSS_STA_CD = 'G'		/*진행상태*/
					,EXAM_DPT_CD = #EXAM_DPT_CD#
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/
			WHERE	TK_YE = #TK_YE#
			AND		TK_SLN = #TK_SLN#
		]]>
	</update>
	
	<update id="CSPLTT005EMdtUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPLTT001M
			SET		PRSS_STA_CD = 'G'		/*진행상태*/
					,MDT_DPT_CD = #MDT_DPT_CD#
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/
			WHERE	TK_YE = #TK_YE#
			AND		TK_SLN = #TK_SLN#
		]]>
	</update>
	
	<update id="CSPLTT005EExamCancleUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPLTT001M
			SET		PRSS_STA_CD = 'D'		/*진행상태*/
					,EXAM_DPT_CD = NULL
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/
					,EXAM_TXT = NULL
					,EXAM_CNB = NULL
					,EXAM_RSLT_CD = NULL
					,EXAM_DT= NULL
					,EXAM_APV_DOC_NO = NULL
			WHERE	TK_YE = #TK_YE#
			AND		TK_SLN = #TK_SLN#
		]]>
	</update>
	
	<update id="CSPLTT005EMdtCancleUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPLTT001M
			SET		PRSS_STA_CD = 'P'		/*진행상태*/
					,MDT_DPT_CD = NULL
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/
					,MDT_TXT = NULL
					,MDT_CNB = NULL
					,MDT_RSLT_CD = NULL
					,MDT_DT= NULL
					,MDT_APV_DOC_NO = NULL
			WHERE	TK_YE = #TK_YE#
			AND		TK_SLN = #TK_SLN#
		]]>
	</update>
	
	<resultMap class="java.util.HashMap" id="CSPLTT006EMainSelect">
			<result property="ACP_NO" 			 	column="ACP_NO" 			    	jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="SMT_DT" 			 	column="SMT_DT" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="TIT_NM" 			 	column="TIT_NM" 			    	jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="USR_NAM" 			 	column="USR_NAM" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="DPT_NM" 	 		 	column="DPT_NM" 	     			jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="NAM_OPEN_YN" 			column="NAM_OPEN_YN" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="OPEN_DT" 				column="OPEN_DT" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="DEL_DT" 		 		column="DEL_DT" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="PRSS_STA_NM" 		 	column="PRSS_STA_NM" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="PRSS_STA_CD" 		 	column="PRSS_STA_CD" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="PRB_TXT" 			 	column="PRB_TXT" 					jdbcType="CLOB" 	javaType="java.lang.String" />
			<result property="WSH_IMP_TXT" 			column="WSH_IMP_TXT" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MSG_TXT" 		 		column="MSG_TXT" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="DOC_ID" 		 		column="DOC_ID" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EXAM_DPT_NM" 		 	column="EXAM_DPT_NM" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EXAM_DPT_CD" 		 	column="EXAM_DPT_CD" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EXAM_DT" 		 		column="EXAM_DT" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EXEC_APT_DT" 		 	column="EXEC_APT_DT" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EXAM_NAM" 		 	column="EXAM_NAM" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EXAM_TXT" 			column="EXAM_TXT" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EXAM_RPL_TXT" 		column="EXAM_RPL_TXT" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EXAM_RSLT_NM" 		column="EXAM_RSLT_NM" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EXAM_DOC_ID" 		 	column="EXAM_DOC_ID" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="PRSS_STA_YN" 		 	column="PRSS_STA_YN" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MDT_YN" 		 		column="MDT_YN" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MDT_DPT_NM" 		 	column="MDT_DPT_NM" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MDT_DPT_CD" 		 	column="MDT_DPT_CD" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MDT_DT" 		 		column="MDT_DT" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MDT_EXEC_APT_DT" 		column="MDT_EXEC_APT_DT" 			jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MDT_NAM" 		 		column="MDT_NAM" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MDT_TXT" 		 		column="MDT_TXT" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MDT_RPL_TXT" 		 	column="MDT_RPL_TXT" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MDT_RSLT_NM" 		 	column="MDT_RSLT_NM" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="MDT_DOC_ID" 		 	column="MDT_DOC_ID" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="TK_YE" 		 		column="TK_YE" 						jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="TK_SLN" 		 		column="TK_SLN" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RCMD_CNT" 		 	column="RCMD_CNT" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="SRCH_CNT" 		 	column="SRCH_CNT" 					jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="CMMT_CNT" 		 	column="CMMT_CNT" 		    		jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="DCMD_CNT" 		 	column="DCMD_CNT" 			    	jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
 
 	<select id="CSPLTT006EMainSelect" parameterClass="paramMap" resultMap="CSPLTT006EMainSelect">
		<![CDATA[
			SELECT	DECODE(A.ACP_NO,NULL,'',A.ACP_YE||'-'||A.ACP_NO) AS ACP_NO	/*접수번호*/
					,A.SMT_DT			/*제출일자*/
					,A.TIT_NM		/*제목*/
					,CASE WHEN NAM_OPEN_YN = 'Y' THEN F_USR_INFO(DGUARD.DECRYPT('TB_ENC','EAN', A.CNB),'2') 
                  	      ELSE '익명' END AS USR_NAM	/*제안자명*/
					,CASE WHEN NAM_OPEN_YN = 'Y' THEN F_DPT_INFO(DGUARD.DECRYPT('TB_ENC','EAN', A.DPT_CD),'1') 
					      ELSE '' END AS DPT_NM
                  	,A.NAM_OPEN_YN
					,A.OPEN_DT
					,61 - (TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) - TO_DATE(A.OPEN_DT)) AS DEL_DT /*숨김일자*/
					,F_CODE_NM('1000992',A.PRSS_STA_CD) AS PRSS_STA_NM	/*진행단계*/
					,A.PRSS_STA_CD		/*진행상태코드*/
					,A.PRB_TXT			/*문제점내용*/
					,A.WSH_IMP_TXT		/*희망개선내용*/
					,A.MSG_TXT			/*숨김사유*/
					,(SELECT 	Z.DOC_ID	
						FROM	TBCSPLTT002M Z
						WHERE	Z.TK_YE = A.TK_YE
						AND		Z.TK_SLN = A.TK_SLN
						AND		Z.ATT_FL_DVSN_CD = '1') AS DOC_ID	/*첨부파일 문서*/
					,F_DPT_INFO(A.EXAM_DPT_CD,'1') AS EXAM_DPT_NM		/*검토부서*/
					,A.EXAM_DPT_CD		/*검토부서코드*/
					,A.EXAM_DT			/*검토일자*/
					,A.EXEC_APT_DT		/*실시예정일자*/
					,F_USR_INFO(A.EXAM_CNB,'2') AS EXAM_NAM		/*검토자*/
					,A.EXAM_TXT			/*검토의견*/
					,A.EXAM_RPL_TXT		/*검토회신내용*/
					,F_CODE_NM('1000077',A.EXAM_RSLT_CD) AS EXAM_RSLT_NM
					,(SELECT 	Z.DOC_ID	
						FROM	TBCSPLTT002M Z
						WHERE	Z.TK_YE = A.TK_YE
						AND		Z.TK_SLN = A.TK_SLN
						AND		Z.ATT_FL_DVSN_CD = '2') AS EXAM_DOC_ID	/*검토첨부파일 문서*/
					,DECODE(A.PRSS_STA_CD,'N','Y','M','N','') AS PRSS_STA_YN	/*채택여부*/
					,A.MDT_YN
					,F_DPT_INFO(A.MDT_DPT_CD,'1') AS MDT_DPT_NM		/*검토부서*/
					,A.MDT_DPT_CD		/*검토부서코드*/
					,A.MDT_DT			/*검토일자*/
					,A.MDT_EXEC_APT_DT		/*실시예정일자*/
					,F_USR_INFO(A.MDT_CNB,'2') AS MDT_NAM		/*검토자*/
					,A.MDT_TXT			/*검토의견*/
					,A.MDT_RPL_TXT		/*검토회신내용*/
					,F_CODE_NM('1000077',A.MDT_RSLT_CD) AS MDT_RSLT_NM
					,(SELECT 	Z.DOC_ID	
						FROM	TBCSPLTT002M Z
						WHERE	Z.TK_YE = A.TK_YE
						AND		Z.TK_SLN = A.TK_SLN
						AND		Z.ATT_FL_DVSN_CD = '3') AS MDT_DOC_ID	/*검토첨부파일 문서*/
					,A.TK_YE			/*생각연도*/
					,A.TK_SLN			/*생각연번*/
					,NVL(A.SRCH_CNT, 0) AS SRCH_CNT
					,NVL(B.CMMT_CNT, 0) AS CMMT_CNT
                    ,NVL(C.RCMD_CNT, 0) AS RCMD_CNT
                    ,NVL(C.DCMD_CNT, 0) AS DCMD_CNT
			FROM	TBCSPLTT001M A, /*함께 생각합시다 기본*/
					(SELECT TK_YE,
							TK_SLN,
                            COUNT(*) AS CMMT_CNT
                       FROM TBCSPLTT004M
                   GROUP BY TK_YE, TK_SLN) B,
                    (SELECT TK_YE,
							TK_SLN,
							SUM(CASE WHEN RCMD_YN = 'Y' THEN 1 ELSE 0 END ) AS RCMD_CNT,
						    SUM(CASE WHEN RCMD_YN = 'N' THEN 1 ELSE 0 END ) AS DCMD_CNT
					   FROM TBCSPLTT003M
		    	   GROUP BY TK_YE, TK_SLN) C
			WHERE	1=1
			  AND   A.TK_YE = B.TK_YE(+)
			  AND   A.TK_SLN = B.TK_SLN(+)
			  AND   A.TK_YE = C.TK_YE(+)
			  AND   A.TK_SLN = C.TK_SLN(+)	
		      AND 	A.TK_YE = #strTK_YE#
		      AND 	A.TK_SLN = #strTK_SLN#
		]]>
	</select>
	
	<!-- 함께합시다 댓글 조회 -->
	<select id="CSPLTT006ECommentSelect" parameterClass="paramMap" resultClass="resultMap">
<![CDATA[
			SELECT /* csp.ltt.service.impl.CSPLTT006EServiceImpl.CSPLTT006ECommentSelect */
				   ROW_NUMBER() OVER (ORDER BY A.TK_YE, A.TK_SLN, A.CMMT_SEQ) AS NO
			     , A.TK_YE    /* 생각연도 */
			     , A.TK_SLN   /* 생각연번 */
			     , A.CMMT_SEQ /* 생각연번 */
			     , CASE WHEN NAM_OPEN_YN = 'Y' THEN F_USR_INFO(DGUARD.DECRYPT('TB_ENC','EAN',  A.CRE_CNB), 2)
			            WHEN NAM_OPEN_YN = 'N' THEN '익명'
			            ELSE '익명'
			             END AS CRE_NM /* 등록자명 */
			     , CASE WHEN NAM_OPEN_YN = 'Y' THEN F_DPT_INFO(DGUARD.DECRYPT('TB_ENC','EAN', A.CRE_USR_DPT_CD), 1)
			            WHEN NAM_OPEN_YN = 'N' THEN ''
			            ELSE ''
			             END AS CRE_USR_DPT_NM /* 부서명 */
			     , A.NAM_OPEN_YN  /* 실명공개여부 */
			     , A.CONTENT  /* 댓글내용 */
			     , TO_CHAR(A.FRT_REGI_DH, 'YYYY-MM-DD HH24:MI') AS FRT_REGI_DH /* 등록일 */
			     , A.DEL_YN /* 삭제여부 */
			     , A.DEL_RSN /* 삭제사유 */
			     , CASE WHEN DGUARD.DECRYPT('TB_ENC','EAN',  A.CRE_CNB) = #S_CNB# THEN 'Y'
			            ELSE 'N'
			             END AS WR_YN
			     , CASE WHEN TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD')) < TO_DATE(TO_CHAR(A.FRT_REGI_DH,'YYYYMMDD'))+3 THEN 'Y'
			            ELSE 'N' END AS CMMT_NEW_YN         
			  FROM TBCSPLTT004M A
	         ]]>
			 WHERE A.TK_YE = #strTK_YE#
			   AND A.TK_SLN = #strTK_SLN#
		    <isNotEmpty property="strCMMT_SEQ">
				AND A.CMMT_SEQ = #strCMMT_SEQ#
			</isNotEmpty>
	      ORDER BY A.TK_YE, A.TK_SLN, A.CMMT_SEQ
</select>
	
	<!-- 함께합시다 댓글 공개 -->
	<update id="CSPLTT006ECommentOpenUpdate" parameterClass="paramMap">
	/* csp.ltt.service.impl.CSPLTT006EServiceImpl.CSPLTT006ECommentOpenUpdate */
		UPDATE TBCSPLTT004M SET 
		                    DEL_YN = 'N'
		                   ,FNL_MDF_DH = SYSDATE
			          WHERE TK_YE    = #strTK_YE#
			            AND TK_SLN   = #strTK_SLN#
			            AND CMMT_SEQ = #strCMMT_SEQ#
	</update>
	
	<!-- 함께합시다 댓글 숨김 -->
	<update id="CSPLTT006ECommentHideUpdate" parameterClass="paramMap">
	/* csp.ltt.service.impl.CSPLTT006EServiceImpl.CSPLTT006ECommentHideUpdate */
		UPDATE TBCSPLTT004M SET 
		                    DEL_YN = 'Y'
		                   ,DEL_RSN = #DEL_RSN#
		                   ,FNL_MDF_DH = SYSDATE
			          WHERE TK_YE    = #TK_YE#
			            AND TK_SLN   = #TK_SLN#
			            AND CMMT_SEQ = #CMMT_SEQ#
	</update>
	
	<insert id="CSPLTT006EMsg206Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO
			TBDCMACM026L
			(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
	        , MSG_TP_YN
	  
	        , MSG_TXT_2
	        , RCNT_CNT
	        , RCNT_HIS
	        , MSG_REGI_DH
	
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
	
			)
			VALUES
			(
			  (SELECT NVL(MAX(MSG_SNO),0)+1 FROM TBDCMACM026L)
			, 'SP'
			, 'SU'
			, #FNL_USR_ID#
	        , '0'
	     
	        , #MSG_TXT#
	        , 1
	        , (SELECT DGUARD.DECRYPT('TB_ENC','EAN', CRE_CNB) AS CRE_CNB FROM TBCSPLTT004M WHERE TK_YE = #TK_YE# AND TK_SLN = #TK_SLN# AND CMMT_SEQ = #CMMT_SEQ#)
	        , SYSDATE
	        
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
			);
			
		]]>
	</insert>
	
	<update id="CSPLTT006EResultUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPLTT001M
			SET		PRSS_STA_CD = DECODE(#PRSS_STA_YN#,'Y','N','N','M')		/*진행상태*/
					,CHOS_DCS_DT = DECODE(#PRSS_STA_YN#,'Y',TO_CHAR(SYSDATE,'YYYYMMDD'),'')
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/
			WHERE	TK_YE = #TK_YE#
			AND		TK_SLN = #TK_SLN#
		]]>
	</update>
	
	
	<!-- <select id="CSPLTT005EReportSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	DECODE(A.ACP_NO,NULL,'',TK_YE||'-'||A.ACP_NO) AS ACP_NO	/*접수번호*/
					,A.TIT_NM		/*제목*/
					,F_USR_INFO(A.CNB,'2') AS USR_NAM	/*제안자명*/
					,TO_CHAR(TO_DATE(A.SMT_DT),'YYYY-MM-DD') AS SMT_DT			/*제출일자*/
					,F_CODE_NM('1000992', A.PRSS_STA_CD) AS PRSS_STA_NM		/*진행상태코드*/
					,F_DPT_INFO(A.EXAM_DPT_CD,'1') AS EXAM_DPT_NM
			FROM	TBCSPLTT001M A		/*함께 생각합시다 기본*/
			WHERE	1=1
		]]>
		<dynamic>
			<isEmpty property="strPRSS_STA_CD">
				AND A.PRSS_STA_CD  &gt;= 'B' 
			</isEmpty>
			<isNotEmpty property="strPRSS_STA_CD">
				AND A.PRSS_STA_CD = #strPRSS_STA_CD#
			</isNotEmpty>
			<isNotEmpty property="strSMT_DTS">
				AND	(A.SMT_DT &gt;= #strSMT_DTS# OR A.SMT_DT IS NULL)
			</isNotEmpty>
			<isNotEmpty property="strSMT_DTE">
				AND	(A.SMT_DT &lt;= #strSMT_DTE# OR A.SMT_DT IS NULL)
			</isNotEmpty>
			<isNotEmpty property="strCNB">
				AND	A.CNB = #strCNB#
			</isNotEmpty>
			<isNotEmpty property="strTIT_NM">
				AND	A.TIT_NM LIKE '%'||#strTIT_NM#||'%'
			</isNotEmpty>
		</dynamic>
		<![CDATA[
			ORDER BY  TO_NUMBER(A.TK_YE) DESC , TO_NUMBER(A.ACP_NO) DESC
		]]>
	</select>
	
	<select id="CSPLTT006EReportSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	DECODE(A.ACP_NO,NULL,'',A.TK_YE||'-'||A.ACP_NO) AS ACP_NO	/*접수번호*/
					,TO_CHAR(TO_DATE(A.SMT_DT),'YYYY-MM-DD') AS SMT_DT			/*제출일자*/
					,TO_CHAR(TO_DATE(A.SMT_DT),'YYYY-MM-DD') AS SMT_DT			/*제출일자*/
					,A.TIT_NM		/*제목*/
					,F_USR_INFO(A.CNB,'2')	AS USR_NAM /*제안자명*/
					,B.JNT_USR_NAM	/*공동제안자*/
					,F_CODE_NM('1000992',A.PRSS_STA_CD) AS PRSS_STA_NM	/*진행단계*/
					,A.PRB_TXT			/*문제점내용*/
					,A.WSH_IMP_TXT		/*희망개선내용*/
					,F_DPT_INFO(A.EXAM_DPT_CD,'1') AS EXAM_DPT_NM		/*검토부서*/
					,TO_CHAR(TO_DATE(A.EXAM_DT),'YYYY-MM-DD') AS EXAM_DT			/*검토일자*/
					,F_USR_INFO(A.EXAM_CNB,'2') AS EXAM_PEN_NAM		/*검토자*/
					,A.EXAM_TXT			/*검토의견*/
					,F_CODE_NM('1000077',A.EXAM_RSLT_CD) AS EXAM_RSLT_NM
					,DECODE(A.PRSS_STA_CD,'M','종료(불채택)','N','종료(채택)','') AS PRSS_STA_YN	/*채택여부*/
			FROM	TBCSPLTT001M A /*함께 생각합시다 기본*/
			WHERE 	1=1
		    AND 	A.TK_YE = #strTK_YE#
		    AND 	A.TK_SLN = #strTK_SLN#
		]]>
	</select> -->
	
	
	<update id="CSPLTT005EReExamMainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPLTT001M
			SET		MDT_YN = 'Y'
					,PRSS_STA_CD = 'P'
					,FNL_MDF_DH = SYSDATE		
			WHERE	TK_YE = #TK_YE#
		    AND 	TK_SLN = #TK_SLN#
		]]>
	</update>
	
	<select id="CSPLTT001EexamCancleCheckSelect" parameterClass="paramMap"
		resultClass="Integer">
		<![CDATA[
			SELECT	COUNT(*)	/*진행상태*/
			FROM	TBCSPLTT001M
			WHERE	TK_YE = #TK_YE#
			AND		TK_SLN = #TK_SLN#
			AND		PRSS_STA_CD IN ('G','H')
		]]>
	</select>
	
	<insert id="CSPLTT005EMsg206Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO
			TBDCMACM026L
			(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
	        , MSG_TP_YN
	  
	        , MSG_TXT_2
	        , RCNT_CNT
	        , RCNT_HIS
	        , MSG_REGI_DH
	
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
	
			)
			VALUES
			(
			  (SELECT NVL(MAX(MSG_SNO),0)+1 FROM TBDCMACM026L)
			, 'SP'
			, 'SU'
			, #FNL_USR_ID#
	        , '0'
	     
	        , #MSG_TXT#
	        , 1
	        , (SELECT DGUARD.DECRYPT('TB_ENC','EAN', CNB) AS CNB FROM TBCSPLTT001M WHERE TK_YE = #TK_YE# AND TK_SLN = #TK_SLN#)
	        , SYSDATE
	        
	        
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
	
			);
			
		]]>
	</insert>
	
	
	<update id="CSPLTT005EExamDocIdUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPLTT002M
			SET		DOC_ID =  #EXAM_DOC_ID#		/*진행상태*/					
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/					
			WHERE	TK_YE = #TK_YE#
			AND		TK_SLN = #TK_SLN#
			AND 	ATT_FL_DVSN_CD = '2'
		]]>
	</update>
	<update id="CSPLTT005EMdtDocIdUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPLTT002M
			SET		DOC_ID =  #MDT_DOC_ID#		/*진행상태*/					
					,FNL_MDF_DH = SYSDATE			/*최종수정일시*/					
			WHERE	TK_YE = #TK_YE#
			AND		TK_SLN = #TK_SLN#
			AND 	ATT_FL_DVSN_CD = '3'
		]]>
	</update>
	
	
	<update id="CSPLTT005EMainUpdate" parameterClass="paramMap">
		UPDATE	TBCSPLTT001M
		SET		TIT_NM = #TIT_NM#			/*제목명*/
				,PRB_TXT = #PRB_TXT#				/*문제점내용*/
				,WSH_IMP_TXT = #WSH_IMP_TXT#		/*희망개선내용*/
				,FNL_MDF_DH = SYSDATE
				,CNB = DGUARD.ENCRYPT('TB_ENC','EAN', #CNB#)
		WHERE	TK_YE = #TK_YE#
		AND		TK_SLN = #TK_SLN#
	</update>
	
</sqlMap> 
