<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/iit/044">
	
	<select id="CSPIIT044EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<include refid = "include.pageSelct"/> 
        <![CDATA[
			SELECT 	
					A.SW_MNG_CD,
					A.SW_SERIALNO,
			 		A.SW_MAKER,
			 		A.SW_VERSION,
			 		(	SELECT CD_NM 
                		FROM    TBDCMACM013C S1
               			WHERE   S1.CMM_CD_DVSN_CD ='1000144'
                		AND     S1.CD <> '000000000'
                		AND     S1.CD = A.DPT_CD
                	) AS DPT_NM,
			 		A.GET_VERSION,
			 		A.USE_VERSION,
			 		A.LI_DVSN_TXT,
			 		A.LI_GET_CNT,
			 		A.LI_USE_CNT,
			 		A.LI_STR_DT,
			 		A.LI_END_DT,
			 		TO_CHAR(TO_DATE(A.LI_STR_DT),'YYYY-MM-DD')||'~'||TO_CHAR(TO_DATE(A.LI_END_DT),'YYYY-MM-DD') AS LI_DT,
			 		A.ITDC_DT,          /*도입일*/
			 		A.ABRG_DT,          /*폐기일*/
			 		A.DPT_CD,		/*부서코드*/
			 		A.ETC_SBJ
			FROM   	TBCSPIIT024M A	
			WHERE	1=1
        ]]>
        <dynamic>
        	<isNotEmpty property="strDPT_CD">
        		AND	A.DPT_CD = #strDPT_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	( UPPER(A.SW_MNG_CD) LIKE '%' ||UPPER(#strSEARCH_NM#)||'%'
        				OR UPPER(A.SW_VERSION) LIKE '%'||UPPER(#strSEARCH_NM#)||'%'
        				OR UPPER(A.SW_MAKER) LIKE '%'||UPPER(#strSEARCH_NM#)||'%'
        				OR UPPER(A.SW_SerialNo) LIKE '%'   ||UPPER(#strSEARCH_NM#)||'%')
        	</isNotEmpty>
        	<isNotEmpty property="strITDC_DTS">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ITDC_DT),'YYYYMMDD') >= #strITDC_DTS# ]]>
        	</isNotEmpty>
        	<isNotEmpty property="strITDC_DTE">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ITDC_DT),'YYYYMMDD') <= #strITDC_DTE#]]> 
        	</isNotEmpty>
        	<isNotEmpty property="strABRG_DTS">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ABRG_DT),'YYYYMMDD') >= #strABRG_DTS# ]]>
        	</isNotEmpty>
        	<isNotEmpty property="strABRG_DTE">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ABRG_DT),'YYYYMMDD') <= #strABRG_DTE#]]> 
        	</isNotEmpty>
        </dynamic>
        <include refid = "include.pageOrder"/> 
	</select>        
	
	
	<!-- PC장비관리 엑셀다운 -->
	<select id="CSPIIT044EExcelExportSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
			SELECT 	A.SW_MNG_CD,
					A.SW_SERIALNO,
			 		A.SW_MAKER,
			 		A.SW_VERSION,
			 		(	SELECT CD_NM 
                		FROM    TBDCMACM013C S1
               			WHERE   S1.CMM_CD_DVSN_CD ='1000144'
                		AND     S1.CD <> '000000000'
                		AND     S1.CD = A.DPT_CD
                	) AS DPT_NM,
			 		A.GET_VERSION,
			 		A.USE_VERSION,
			 		A.LI_DVSN_TXT,
			 		A.LI_GET_CNT,
			 		A.LI_USE_CNT,
			 		A.LI_STR_DT,
			 		A.LI_END_DT,
			 		TO_CHAR(TO_DATE(A.LI_STR_DT),'YYYY-MM-DD')||'~'||TO_CHAR(TO_DATE(A.LI_END_DT),'YYYY-MM-DD') AS LI_DT,
			 		A.ITDC_DT,          /*도입일*/
			 		A.ABRG_DT,          /*폐기일*/
       				A.ETC_SBJ
			FROM   	TBCSPIIT024M A
			WHERE	1=1
			
        ]]>
        <dynamic>
        	<isNotEmpty property="strDPT_CD">
        		AND	A.DPT_CD = #strDPT_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	(UPPER(A.SW_MNG_CD) LIKE '%' ||UPPER(#strSEARCH_NM#)||'%'
        				OR UPPER(A.SW_VERSION) LIKE '%'||UPPER(#strSEARCH_NM#)||'%'
        				OR UPPER(A.SW_MAKER) LIKE '%'||UPPER(#strSEARCH_NM#)||'%'
        				OR UPPER(A.SW_SerialNo) LIKE '%'   ||UPPER(#strSEARCH_NM#)||'%')
        	</isNotEmpty>
        	<isNotEmpty property="strITDC_DTS">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ITDC_DT),'YYYYMMDD') >= #strITDC_DTS# ]]>
        	</isNotEmpty>
        	<isNotEmpty property="strITDC_DTE">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ITDC_DT),'YYYYMMDD') <= #strITDC_DTE#]]> 
        	</isNotEmpty>
        	<isNotEmpty property="strABRG_DTS">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ABRG_DT),'YYYYMMDD') >= #strABRG_DTS# ]]>
        	</isNotEmpty>
        	<isNotEmpty property="strABRG_DTE">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ABRG_DT),'YYYYMMDD') <= #strABRG_DTE#]]> 
        	</isNotEmpty>
        	
        </dynamic>
	</select>    
	
	<insert id="CSPIIT044EMainInsert" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPIIT024M       
			(	
					SW_MNG_CD,          /*소프트웨어 고유번호     */
					DPT_CD,              /*부서코드       */
					SW_VERSION,
					SW_MAKER,
					SW_SERIALNO,
					ITDC_DT,             /*도입일         */
					GET_VERSION,
					USE_VERSION,
					LI_DVSN_TXT,
					LI_GET_CNT,
					LI_USE_CNT,
					LI_STR_DT,
					LI_END_DT,
					ABRG_DT,
					FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH,
					ETC_SBJ
			) VALUES (
					#SW_MNG_CD#,                      
					#DPT_CD#, 
					#SW_VERSION#,
					#SW_MAKER#, 
					#SW_SERIALNO#, 
					#ITDC_DT#, 
					#GET_VERSION#, 
					#USE_VERSION#, 
					#LI_DVSN_TXT#,
					#LI_GET_CNT#,
					#LI_USE_CNT#,
					#LI_STR_DT#,
					#LI_END_DT#,
					#ABRG_DT#,
					#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE,
					#ETC_SBJ#
					
			)
        ]]>
	</insert>        
	<update id="CSPIIT044EMainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPIIT024M  					/*소프트웨어 관리 대장 테이블*/
			SET		DPT_CD = #DPT_CD#, 				/*부서코드*/
					SW_VERSION = #SW_VERSION#,		/*소프트웨어 버전*/
					SW_MAKER = #SW_MAKER#,			/*소프트웨어 저작사*/
					ITDC_DT = #ITDC_DT#,			/*도입일*/
					GET_VERSION = #GET_VERSION#,	/*도입시 버전*/
					USE_VERSION = #USE_VERSION#,	/*이용가능 버전*/
					LI_DVSN_TXT = #LI_DVSN_TXT#,	/*라이선스 유형*/
					LI_GET_CNT = #LI_GET_CNT#,		/*도입 수량*/
					LI_USE_CNT = #LI_USE_CNT#,		/*설치 수량*/
					LI_STR_DT = #LI_STR_DT#,		/*라이선스 시작일자*/
					LI_END_DT = #LI_END_DT#,		/*라이선스 종료일자*/
					ABRG_DT = #ABRG_DT#,			/*폐기일*/
					ETC_SBJ = #ETC_SBJ#,			/*변경사항*/
					FNL_USR_ID = #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID = #FNL_MNU_ID#,
					FNL_MDF_DH = SYSDATE
			WHERE	SW_MNG_CD = #SW_MNG_CD#
			  AND   SW_SERIALNO = #SW_SERIALNO#	
		]]>
	</update>
	
	<delete id="CSPIIT044EMainDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE	FROM TBCSPIIT024M
			WHERE	SW_MNG_CD = #SW_MNG_CD#
			  AND   SW_SERIALNO = #SW_SERIALNO#	
		]]>
	</delete>

	
	<select id="CSPIIT044EKeySelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
        	SELECT	SW_MNG_CD
        	FROM	TBCSPIIT024M
        	WHERE	SW_MNG_CD = #SW_MNG_CD#
			  AND   SW_SERIALNO = #SW_SERIALNO#	
        ]]> 
	</select>
	
	<select id="CSPIIT044EReportSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
			SELECT 	A.SW_MNG_CD,
					A.SW_SERIALNO,
			 		A.SW_MAKER,
			 		A.SW_VERSION,
			 		(	SELECT CD_NM 
                		FROM    TBDCMACM013C S1
               			WHERE   S1.CMM_CD_DVSN_CD ='1000144'
                		AND     S1.CD <> '000000000'
                		AND     S1.CD = A.DPT_CD
                	) AS DPT_NM,
			 		A.GET_VERSION,
			 		A.USE_VERSION,
			 		A.LI_DVSN_TXT,
			 		A.LI_GET_CNT,
			 		A.LI_USE_CNT,
			 		A.LI_STR_DT,
			 		A.LI_END_DT,
			 		TO_CHAR(TO_DATE(A.LI_STR_DT),'YYYY-MM-DD')||' ~ '||TO_CHAR(TO_DATE(A.LI_END_DT),'YYYY-MM-DD') AS LI_DT,
			 		A.ITDC_DT,          /*도입일*/
			 		A.ABRG_DT,          /*폐기일*/
			 		A.DPT_CD,		/*부서코드*/
			 		A.ETC_SBJ
			FROM   	TBCSPIIT024M A	
			WHERE	1=1
        ]]>
        	<dynamic>
        	<isNotEmpty property="strDPT_CD">
        		AND	A.DPT_CD = #strDPT_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	(UPPER(A.SW_MNG_CD) LIKE '%' ||UPPER(#strSEARCH_NM#)||'%'
        				OR UPPER(A.SW_VERSION) LIKE '%'||UPPER(#strSEARCH_NM#)||'%'
        				OR UPPER(A.SW_MAKER) LIKE '%'||UPPER(#strSEARCH_NM#)||'%'
        				OR UPPER(A.SW_SerialNo) LIKE '%'   ||UPPER(#strSEARCH_NM#)||'%')
        	</isNotEmpty>
        	<isNotEmpty property="strITDC_DTS">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ITDC_DT),'YYYYMMDD') >= #strITDC_DTS# ]]>
        	</isNotEmpty>
        	<isNotEmpty property="strITDC_DTE">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ITDC_DT),'YYYYMMDD') <= #strITDC_DTE#]]> 
        	</isNotEmpty>
        	<isNotEmpty property="strABRG_DTS">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ABRG_DT),'YYYYMMDD') >= #strABRG_DTS# ]]>
        	</isNotEmpty>
        	<isNotEmpty property="strABRG_DTE">
        		<![CDATA[ AND	TO_CHAR(TO_DATE(ABRG_DT),'YYYYMMDD') <= #strABRG_DTE#]]> 
        	</isNotEmpty>
        </dynamic>
	</select>
	
	
	
	
</sqlMap> 
