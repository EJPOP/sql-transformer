<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/bii/144">
		
	<!-- 감사사항 조회 -->
	<select id="CSPBII144PAudSbjNmSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[       
			SELECT ROWNUM     AS CD
			     , AUD_SBJ_NM AS CD_NM
			  FROM (SELECT DISTINCT 
			               A.AUD_YR
			             , A.AUD_NO
			             , A.AUD_SBJ_NM
			             , A.AUD_SCL_CD
			          FROM TBBADDED001M A /* 감사사항 */
			         WHERE A.AUD_SCL_CD = '1'
			           AND (A.AUD_YR, A.AUD_NO) IN (SELECT B.REL_AUD_YR
			                                             , B.REL_AUD_NO
			                                          FROM TBBADDED002M B /* 출장상황 */
			                                         WHERE B.AUD_STR_DT >= TO_CHAR(ADD_MONTHS(SYSDATE, -3), 'YYYYMMDD')
			                                           AND B.REL_AUD_YR     = A.AUD_YR
			                                           AND B.REL_AUD_NO     = A.AUD_NO)
			           
			        UNION ALL
			        
			        SELECT A.AUD_YR
			             , A.AUD_NO
			             , A.AUD_SBJ_NM
			             , A.AUD_SCL_CD
			          FROM TBBADDED001M A /* 감사사항 */
			         WHERE A.SPV_BRDV_CD LIKE SUBSTR(#strDptCd#, 1, 3)||'%'
			           AND A.AUD_SCL_CD = '2'
			           AND (A.AUD_YR, A.AUD_NO) IN (SELECT B.REL_AUD_YR
			                                             , B.REL_AUD_NO
			                                          FROM TBBADDED002M B /* 출장상황 */
			                                         WHERE B.AUD_STR_DT >= TO_CHAR(ADD_MONTHS(SYSDATE, -3), 'YYYYMMDD')
			                                           AND B.REL_AUD_YR     = A.AUD_YR
			                                           AND B.REL_AUD_NO     = A.AUD_NO)
			        
			        UNION ALL
			        
			        SELECT A.AUD_YR
			             , A.AUD_NO
			             , A.AUD_SBJ_NM
			             , A.AUD_SCL_CD
			          FROM TBBADDED001M A /* 감사사항 */
			         WHERE A.SPV_BRDV_CD = #strDptCd#
			           AND A.AUD_SCL_CD = '3'
			           AND (A.AUD_YR, A.AUD_NO) IN (SELECT B.REL_AUD_YR
			                                             , B.REL_AUD_NO
			                                          FROM TBBADDED002M B /* 출장상황 */
			                                         WHERE B.AUD_STR_DT >= TO_CHAR(ADD_MONTHS(SYSDATE, -3), 'YYYYMMDD')
			                                           AND B.REL_AUD_YR     = A.AUD_YR
			                                           AND B.REL_AUD_NO     = A.AUD_NO) 
			        UNION ALL
			        
			        SELECT '9999'   AS AUD_YR
			             , '999'    AS AUD_NO
			             , '직접입력'  AS AUD_SBJ_NM
			             , '4'      AS AUD_SCL_CD
			          FROM DUAL
			        ORDER BY AUD_SCL_CD
			               , AUD_YR
			               , AUD_NO)
		]]>
	</select>	
</sqlMap> 
