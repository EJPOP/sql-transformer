<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<!-- 감사사무처리부관리(자동)  -->
<sqlMap namespace="bad/fre/032">
	<!--재심의심사청구 상세조회-->
	<select id="BADFRE032PDtlselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
                SELECT T1.ACP_YR			/*접수년도*/
                     , T1.ACP_DVSN_CD		/*접수구분코드*/
                     , T1.ACP_SRNO			/*접수일련번호*/
                     , T1.ACP_DT			/*접수일*/
                     , T1.REQ_DT			/*청구일*/
                     , T1.TIT_NM			/*제목명*/
                     , T1.DPT_CD			/*부서코드*/
                     , F_DPT_INFO(T1.DPT_CD, '1') AS DPT_NM /*부서코드*/
                     , T1.RPT_DT			/*보고일*/
                     , T1.HNDL_DDLN_DT		/*처리기한일*/
                     , CASE WHEN (T3.ENF_DT IS NULL AND T2.SBCN_DT IS  NULL)
		        			THEN  TO_DATE(SYSDATE) - TO_DATE(T1.ACP_DT) || '일'
		        	   ELSE 
		        	 		CASE WHEN  TRIM(T2.SBCN_DT) IS NOT NULL
		        	 			 	THEN TO_DATE(T2.SBCN_DT) - TO_DATE(T1.ACP_DT)	 || '일'
		        	 			 ELSE 
			        	 			 TO_DATE(T3.ENF_DT) - TO_DATE(T1.ACP_DT) || '일'
		        	 		END	 		
		          	   END AS ELP_DT /*경과일수*/
                     , T1.JDG_REQ_DVSN_CD	/*심사청구구분코드*/
					 , F_CODE_NM('1000043', T1.JDG_REQ_DVSN_CD) AS JDG_REQ_DVSN_NM 
                     , T1.REL_AM			/*관련금액*/
                     , T1.DFNT_CNT			/*관계자수*/
                     , T1.ORG_CD 			/*기관코드*/
					 , F_ORG_INFO(T1.ORG_CD, '1') AS ORG_NM					   
                     , T1.REQR_NM			/*청구인명*/
                     , T1.AGT_NM 			/*대리인명*/
                     , T1.PSN_CRP_DVSN_CD	/*개인법인구분코드*/
                     , F_CODE_NM ('1000436', T1.PSN_CRP_DVSN_CD) AS PSN_CRP_DVSN /*개인법인구분*/
                     , T1.EIN			/*청구인주민등록번호*/
                     , T1.ISU_TXT			/*쟁점내용*/
                     , T1.HNDL_CHGR_NM		/*처리담당자*/
                     , T1.AUD_YR			/*감사년도*/
                     , T1.AUD_NO			/*감사번호*/
                     , T1.DSP_RQ_SNO		/*처분요구순번*/
                     , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, '', '-') ||'-'|| T1.DSP_RQ_SNO AS AUD_YR_NO /* 2017.01.08  yyh*/
                     , F_DPT_INFO(T1.BAI_DSP_DIV_CD, '1') AS BAI_DSP_DIV_NM
                     , T1.BAI_DSP_YN		/*원처분여부*/	
                     , (SELECT S1.ENF_DT                                                                                         
                          FROM TBBADEAR002D S1                                                                                 
                         WHERE S1.AUD_YR 		= T1.AUD_YR                                                                       
                           AND S1.AUD_NO  		= T1.AUD_NO                                                                        
                           AND S1.DSP_RQ_SNO 	= T1.DSP_RQ_SNO                                                                       
                        ) AS DSP_RQ_ENF_DT
                     ,(SELECT F_CODE_NM('1000002', S1.DSP_RQ_KND_CD)                                                                                    
                         FROM TBBADEAR001M S1
                        WHERE S1.AUD_YR		= T1.AUD_YR                                                                       
                          AND S1.AUD_NO  	= T1.AUD_NO                                                                        
                          AND S1.DSP_RQ_SNO = T1.DSP_RQ_SNO
                       ) AS DSP_RQ_KND_NM	/*처분요구종류*/
                     ,(SELECT S1.TIT_TXT                                                                                         
                         FROM TBBADEAR001M S1                                                                               
                        WHERE S1.AUD_YR 		= T1.AUD_YR                                                                       
                          AND S1.AUD_NO  		= T1.AUD_NO                                                                        
                          AND S1.DSP_RQ_SNO 	= T1.DSP_RQ_SNO                                                                       
                        ) AS DSP_RQ_TIT_NM
                     , T1.ZCD				/*우편번호*/
                     , T1.AD				/*주소*/
                     , T1.DTL_AD			/*상세주소*/
                     , T1.HP_TNB_1			/*핸드폰번호1*/
                     , T1.HP_TNB_2			/*핸드폰번호2*/
                     , T1.HP_TNB_3			/*핸드폰번호3*/
                     , T1.TNB_1				/*전화번호1*/	
                     , T1.TNB_2				/*전화번호2*/
                     , T1.TNB_3				/*전화번호3*/
                     , T1.HNDL_CHGR_TNB_1	/*처리담당자전화번호1*/	
                     , T1.HNDL_CHGR_TNB_2	/*처리담당자전화번호2*/
                     , T1.HNDL_CHGR_TNB_3	/*처리담당자전화번호3*/
                     , T1.BAI_DSP_DIV_CD	/*원처분과코드*/
                     , F_DPT_INFO(T1.BAI_DSP_DIV_CD, '1') as BAI_DSP_DIV_NM /*원처분과*/
                     , T2.CMT_CHF_CMTR_NM	/*위원회주심위원명*/
                     , T2.JDG_RVW_HNDL_DVSN_CD	/*심사심의처리구분코드*/
                     , T2.VT_KND_CD			/*의결종류코드*/ 
                     , F_CODE_NM ('1000045', T2.VT_KND_CD) AS VT_KND /*의결종류*/                        
                     , T2.SBCN_NO			/*부의번호*/
                     , T2.SBCN_NBC			/*부의횟수*/
                     , T2.SBCN_DT			/*부의일*/
                     , TO_DATE(TRIM(T2.SBCN_DT)) - TO_DATE(TRIM(T1.ACP_DT)) || '일' AS SBCN_HNDL_DT /*부의처리기간*/
                     , T2.DCS_DT			/*결정일*/
                     , T2.DCS_SBJ			/*결정사항*/
                     , T2.AMIT_AM			/*용인금액*/
                     , T2.DCS_YR			/*결정년도*/
                     , T2.DCS_DVSN_CD		/*결정구분코드*/
                     , T2.DCS_NO			/*결정번호*/
                     , T2.DOC_ID			/*파일조회*/                                                   
                     , T2.DVCHF_APV_DT		/*과장결재일*/
                     , TO_DATE(TRIM(T2.DVCHF_APV_DT)) - TO_DATE(TRIM(T1.ACP_DT)) || '일' AS DVCHF_HNDL_DT /*과장처리기간*/
                     , T2.DDG_APV_DT		/*심의관결재일*/
                     , TO_DATE(TRIM(T2.DDG_APV_DT)) - TO_DATE(TRIM(T1.ACP_DT)) || '일' AS DDG_HNDL_DT /*심의관처리기간*/
                     , T2.BRUCHF_APV_DT		/*국장결재일*/
                     , TO_DATE(TRIM(T2.BRUCHF_APV_DT)) - TO_DATE(TRIM(T1.ACP_DT)) || '일' AS BRUCHF_HNDL_DT /*국장처리기간*/
                     , T2.OW_PSD_APV_DT		/*사무총장결재일*/
                     , TO_DATE(TRIM(T2.OW_PSD_APV_DT)) - TO_DATE(TRIM(T1.ACP_DT)) || '일' AS OW_PSD_HNDL_DT /*사무총장처리기간*/
                     , T2.LEDG_APV_DT		/*원장결재일*/
                     , TO_DATE(TRIM(T2.LEDG_APV_DT)) - TO_DATE(TRIM(T1.ACP_DT)) || '일' AS LEDG_HNDL_DT /*원장처리기간*/
                     , T2.CMTR_APV_DT		/*위원결재일*/
                     , TO_DATE(TRIM(T2.CMTR_APV_DT)) - TO_DATE(TRIM(T1.ACP_DT)) || '일' AS CMTR_HNDL_DT /*위원처리기간*/
                     , T2.RMK_SBJ				/*비고*/
                     , T3.ENF_DT			/*시행일*/
                     , TO_DATE(TRIM(T3.ENF_DT)) - TO_DATE(TRIM(T1.ACP_DT)) || '일' AS ENF_HNDL_DT /*시행처리기간*/
                     , T3.ENFM_DT			/*집행일*/
                     , T3.ENFM_TXT			/*집행내용*/
                     , T3.LWS_INST_DT		/*소송제기일*/
                     , T3.JUDG_DT			/*판결일*/
                     , T3.JUDG_TXT			/*판결내용*/
                     , T3.DF_DT				/*보류일*/
                     , T3.RLS_DT			/*해제일*/
                     , T3.UN_HNDL_RSN		/*미처리사유*/
                     , T1.EXTN_RSN			/*연장사유*/
                     , T3.HNDL_PLN_TXT		/*처리계획내용*/
                     , T3.ODOC_NO			/*공문서번호*/
                     , T1.CVPT_SEN_ACP_NO   /* 민원발송접수번호 */
                     
                     , DECODE(T1.ACP_NO_SMS_SEN_YN,'Y','발송','미발송') AS ACP_NO_SMS_SEN_YN
			    	 , T1.WRTANS_SEN_YN
			    	 , T1.STTC_CNT
			    	 
                     , NVL2(T2.DCS_YR, T2.DCS_YR||'-'||T2.DCS_DVSN_CD||'-'||T2.DCS_NO, '') AS TMP_NO1
                     , NVL2(T2.SBCN_NO, T2.SBCN_NO||'-'||T2.SBCN_NBC||'-'||T2.SBCN_DT, '') AS TMP_NO2
                     
                  FROM  TBBADFRE012M T1                                                                                   
                     ,  TBBADFRE012D T2                                                                                   
                     ,  TBBADFRE013D T3                                                                                   
                 WHERE  1=1                                                                                                   
                   AND  T1.ACP_YR         = T2.ACP_YR(+)                                                                     
                   AND  T1.ACP_DVSN_CD    = T2.ACP_DVSN_CD(+)                                                                  
                   AND  T1.ACP_SRNO       = T2.ACP_SRNO(+)      
                   AND  T1.DPT_CD		  = T2.DPT_CD(+)                                                                  
                   AND  T1.ACP_YR         = T3.ACP_YR(+)                                                                     
                   AND  T1.ACP_DVSN_CD    = T3.ACP_DVSN_CD(+)                                                                  
                   AND  T1.ACP_SRNO       = T3.ACP_SRNO(+)
                   AND  T1.DPT_CD		  = T3.DPT_CD(+)  
                   AND  T1.AUD_YR         = #strAudYr#
                   AND  T1.AUD_NO         = #strAudNo#
                   AND  T1.DSP_RQ_SNO     = #strDspRqSno#
ORDER BY T1.ACP_YR DESC
       , T1.ACP_SRNO DESC
		 ]]>
 	</select>
</sqlMap> 
