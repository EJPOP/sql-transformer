<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ear/045">

	<resultMap class="java.util.HashMap" id="hwpDocMap">
		<result property="ENF_DT_NM" column="ENF_DT_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="ENF_DT" column="ENF_DT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="WRDO_TYP_CD" column="WRDO_TYP_CD" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="RLTN_ORG_CD" column="RLTN_ORG_CD" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="RLTN_ORG_NM" column="RLTN_ORG_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="TIT_TXT" column="TIT_TXT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="DSP_RQ_KND_CD" column="DSP_RQ_KND_CD" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="DSP_RQ_KND_NM" column="DSP_RQ_KND_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="COPT_ORG_DVSN_CD" column="COPT_ORG_DVSN_CD" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="COPT_ORG_DVSN_NM" column="COPT_ORG_DVSN_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="DSP_RQ_HND_SBJ" column="DSP_RQ_HND_SBJ" jdbcType="CLOB"
			javaType="java.lang.String" />
		<result property="SUMPRT_ALL_TXT" column="SUMPRT_ALL_TXT" jdbcType="CLOB"
			javaType="java.lang.String" />
		<result property="RESULT" column="RESULT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
	</resultMap>

	<!--요약전 내용조회-->
	<select id="BADEAR045PMainSelect" parameterClass="paramMap"
		resultMap="hwpDocMap">
        <![CDATA[       
			SELECT TO_CHAR(TO_DATE(D2.ENF_DT),'YYYY. MM. DD')   AS ENF_DT_NM        /*실행일자*/
			     , D2.ENF_DT                                    AS ENF_DT           /*시행일자*/
			     , D2.WRDO_TYP_CD							AS WRDO_TYP_CD /*비위유형코드*/
			     , D3.RLTN_ORG_CD                               AS RLTN_ORG_CD      /*관계기관*/
			     , D3.RLTN_ORG_NM                               AS RLTN_ORG_NM      /*관계기관명*/
			     , D5.COPT_ORG_DVSN_CD                               AS COPT_ORG_DVSN_CD      /*소관청*/
			     , D5.COPT_ORG_DVSN_NM                               AS COPT_ORG_DVSN_NM      /*소관청명*/
			     , D1.TIT_TXT                                   AS TIT_TXT          /*제목*/
			     , D1.DSP_RQ_KND_CD                             AS DSP_RQ_KND_CD    /*처분요구종류*/    
			     , F_CODE_NM('1000002',D1.DSP_RQ_KND_CD )       AS DSP_RQ_KND_NM    /*처분요구종류명*/
		         , (CASE WHEN NVL(DBMS_LOB.GETLENGTH(D4.DSP_RQ_HND_SBJ_TXT),0) = 0 THEN D4.DSP_RQ_HND_SBJ
		              ELSE D4.DSP_RQ_HND_SBJ_TXT
		           END) AS DSP_RQ_HND_SBJ   
			     , D4.SUMPRT_ALL_TXT                                AS SUMPRT_ALL_TXT       /*요약전내용*/
			     , F_ENFO_INFO(D1.AUD_YR, D1.AUD_NO, D1.DSP_RQ_SNO, D3.RLTN_ORG_CD )                                           AS RESULT
			  FROM TBBADEAR001M D1
			     , TBBADEAR002D D2
			     , (
			        SELECT AUD_YR           AS AUD_YR
			             , AUD_NO           AS AUD_NO
			             , DSP_RQ_SNO       AS DSP_RQ_SNO
			             , MIN(RLTN_ORG_CD) AS RLTN_ORG_CD
			             , F_ORG_INFO(MIN(RLTN_ORG_CD),'1')  AS RLTN_ORG_NM
			          FROM TBBADEAR006M
			         GROUP BY AUD_YR , AUD_NO, DSP_RQ_SNO
			      ) D3
			      , TBBADEAR005M D4
			      , 	(
			        SELECT AUD_YR           AS AUD_YR
			             , AUD_NO           AS AUD_NO
			             , DSP_RQ_SNO       AS DSP_RQ_SNO
			             , MIN(RLTN_ORG_CD) AS COPT_ORG_DVSN_CD
			             , F_ORG_INFO(MIN(RLTN_ORG_CD),'1')  AS COPT_ORG_DVSN_NM
			          FROM TBBADEAR008M
			         GROUP BY AUD_YR , AUD_NO, DSP_RQ_SNO
			      ) D5
			 WHERE 1=1
			   AND D1.AUD_YR     = D2.AUD_YR        
			   AND D1.AUD_NO     = D2.AUD_NO
			   AND D1.DSP_RQ_SNO = D2.DSP_RQ_SNO
			   AND D1.AUD_YR     = D3.AUD_YR(+)        
			   AND D1.AUD_NO     = D3.AUD_NO(+)
			   AND D1.DSP_RQ_SNO = D3.DSP_RQ_SNO(+)
			   AND D1.AUD_YR     = D4.AUD_YR(+)        
			   AND D1.AUD_NO     = D4.AUD_NO(+)
			   AND D1.DSP_RQ_SNO = D4.DSP_RQ_SNO(+)
			   AND D1.AUD_YR     = D5.AUD_YR(+)        
			   AND D1.AUD_NO     = D5.AUD_NO(+)
			   AND D1.DSP_RQ_SNO = D5.DSP_RQ_SNO(+)
			   AND D1.AUD_YR     = #strAudYr#        
			   AND D1.AUD_NO     = #strAudNo#
			   AND D1.DSP_RQ_SNO = #strDspRqSno#			   
		]]>			   
	</select>

</sqlMap> 
