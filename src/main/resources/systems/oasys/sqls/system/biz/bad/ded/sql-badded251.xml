<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ded/251">
	
	<select id="BADDED251QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT SUBSTR(A.GPC_NO,1,4) || '-' || SUBSTR(A.GPC_NO,5,4) || '-' || SUBSTR(A.GPC_NO,9,4) || '-' || SUBSTR(A.GPC_NO,13,4) AS GPC_NO
				  ,A.SNO
			      ,A.DPT_CD
			      ,B.DPT_NM
			      ,A.PCT_CNB 									   AS CNB
			      ,A.GPC_USR_NAM 								   AS USR_NAM
			      ,TO_CHAR(TO_DATE(A.GPC_USE_STR_DT),'YYYY-MM-DD') AS GPC_USE_STR_DT
			      ,TO_CHAR(A.FRT_REGI_DH,'YYYY-MM-DD') 			   AS FRT_REGI_DH
			  FROM TBBADDED035M A
			      ,TBDCMACM002M B
			 WHERE 1=1
			   AND A.USE_RQS_STA_CD = 'ING'
			   AND A.DPT_CD = B.DPT_CD
			   
		]]>
			<isNotEmpty property="cnb">	 	   
			   AND A.PCT_CNB = #cnb#
			</isNotEmpty>
			<isNotEmpty property="strSpvBrdvCd">	 	   
			   AND B.HIRK_DPT_CD = #strUpSpvBrdvCd#
			   AND A.DPT_CD = #strSpvBrdvCd#
			</isNotEmpty>
			<isEmpty property="strSpvBrdvCd">	 	   
			   AND (B.HIRK_DPT_CD = #strUpSpvBrdvCd#
			   OR A.DPT_CD = #strUpSpvBrdvCd#)
			</isEmpty>
	</select>
	
	<select id="BADDED251EUserInfoSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT 	A.USR_NAM,
			 		A.CNB, 
			 		A.DPT_CD, 
			 		B.DPT_NM,
			 		F_CODE_NM('1000176', A.PST_CD) AS PST_NM, /* 직위 */
			 		F_CODE_NM('1000173', A.RANK_CD) AS RANK_NM, /* 직급 */
			 		F_CODE_NM('1000177', A.PS_CD) AS PS_NM,
			 		F_CODE_NM('1000173', A.RANK_CD) || ' - ' ||F_CODE_NM('1000177', A.PS_CD) AS RANK_PS_NM
			  FROM 	TBDCMACM001M A,
			  		TBDCMACM002M B
			 WHERE 	1=1
			   AND 	A.DPT_CD = B.DPT_CD
			   AND	A.CNB = #cnb#
		]]>
	</select>
	
	<!-- 출납공무원이 승인 후 승인상태 업데이트한다 -->
	<update id="BADDED251QChfApvStaCdupdate" parameterClass="paramMap">
           UPDATE TBBADDED035M      		/* 정부구매카드사용자정보 */ 
              SET USE_RQS_STA_CD  = 'COFM'	/* 승인상태 코드: 'ING' : 승인신청 진행중 'CNL' : 승인신청 취소 'COFM' : 승인 */
              	 ,USE_YN          = 'Y'
              	 ,GPC_USE_COFMR   = #S_USR_ID#
              	 ,GPC_USE_COFM_DH = SYSDATE
              	 ,FNL_USR_ID	  = #S_USR_ID#
              	 ,FNL_MDF_DH      = SYSDATE
           WHERE 1=1 
          	 AND GPC_NO  = REPLACE(#GPC_NO# , '-', '')
          	 AND PCT_CNB = #CNB#
          	 AND SNO 	 = #SNO#
	</update>
	
	<select id="BADDED251ESelectRcdbPbsvtYn" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT RCDB_PBSVT_YN
			  FROM TBDCMACM001M
			 WHERE 1=1
			   AND CNB = #strCnb#
		]]>
	</select>
	
</sqlMap> 