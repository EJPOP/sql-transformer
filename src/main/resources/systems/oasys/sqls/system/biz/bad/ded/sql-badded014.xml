<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ded/014">

	<!-- 조회조건 데이터 조회  -->
	<select id="BADDED014QSearchBoxselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       		         
		       SELECT 
		              F_MNG_KND_AUDYRNO(REL_AUD_YR, REL_AUD_NO, T1.AUD_KND_CD, ' - ') || ' (' || AUD_STEP_SNO || ')'  AS AUD_YR_NO_SNO /*감사연번호*/
		            , CASE WHEN AUD_STR_DT IS NOT NULL THEN SUBSTR(AUD_STR_DT, 0, 4) || '.' || SUBSTR(AUD_STR_DT, 5, 2) || '.' || SUBSTR(AUD_STR_DT, 7, 2) ELSE '' END
		              || ' ~ ' ||
		              CASE WHEN AUD_END_DT IS NOT NULL THEN SUBSTR(AUD_END_DT, 0, 4) || '.' || SUBSTR(AUD_END_DT, 5, 2) || '.' || SUBSTR(AUD_END_DT, 7, 2) ELSE '' END
		              || CASE WHEN AUD_DCN IS NOT NULL THEN '(' || AUD_DCN || '일)' ELSE '' END AS SITU_AUD_DT /*출장기간*/
		            , TIT_TXT || ' (' ||  F_CODE_NM('1000030', AUD_BZT_KND_CD) ||')' AS TIT_TXT /*출장상황명*/
		            , F_DPT_INFO(BZT_BRDV_CD, '1') || ' (' || BZT_BRDV_CD || ')' AS BZT_BRDV_NM /*출장부서*/
		            , F_DPT_INFO(BZT_TL_BRDV_CD, '1') || ' ' || F_CODE_NM('1000173', BZT_TL_RANK_CD) || ' ' || F_USR_INFO(BZT_TL_CNB, '2') || '( ' || BZT_TL_CNB || ' )' AS BZT_TL_BRDV_INFO 
		            , REL_AUD_YR /*관련감사년도*/
		            , REL_AUD_NO /*관련감사번호*/
		            , AUD_STEP_SNO /*감사단계순번*/
		            , BZT_YR /*출장년도*/
		            , BZT_SNO /*출장순번*/
		        FROM TBBADDED002M
		            ,TBBADDED001M T1
		       WHERE REL_AUD_YR   = #strAudYr#
		         AND REL_AUD_NO   = #strAudNo#
		         AND AUD_STEP_SNO = #strAudStepSno#
		         AND REL_AUD_YR   = T1.AUD_YR
		         AND REL_AUD_NO   = T1.AUD_NO 
        ]]>
	</select>
	
	<!-- #################################### 실지감사출장 상황표(여비) 조회 시작 ################################# -->
	
	<select id="BADDED014QMasterselect1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT SITU.BZT_YR,
			       SITU.BZT_SNO,
			       AUD.AUD_YR,
			       AUD.AUD_NO,
			       SITU.AUD_STEP_SNO,
			       F_MNG_KND_AUDYRNO(AUD.AUD_YR, AUD.AUD_NO, AUD.AUD_KND_CD, ' - ') || '(' || SITU.AUD_STEP_SNO  || ')' AS AUD_NO_FULL,
			       F_DPT_INFO(SITU.BZT_BRDV_CD,'1') AS DPT_NM,
			       AUD.TSK_CAT_CD,
			       F_CODE_NM('1000120',AUD.TSK_CAT_CD) AS TASK_CATE_NM,
			       F_CODE_NM('1000751',AUD.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM /* 예산구분 추가 - 2016.06.22 yyh */
			  FROM TBBADDED001M AUD,
			       TBBADDED002M SITU
			 WHERE SITU.REL_AUD_YR   = #strAudYr#
			   AND SITU.REL_AUD_NO   = #strAudNo#
			   AND SITU.AUD_STEP_SNO = #strAudStepSno#
			   AND AUD.AUD_YR = SITU.REL_AUD_YR
			   AND AUD.AUD_NO = SITU.REL_AUD_NO
			   AND SITU.BZT_DVSN_CD = '1'
        ]]>
	</select>	
	
	<select id="BADDED014QDtlselect1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			 SELECT TEAM.TEAM_SNO
			  FROM TBBADDED004L TEAM,
			       TBBADDED002M SITU
			 WHERE TEAM.BZT_YR = SITU.BZT_YR
			   AND TEAM.BZT_SNO = SITU.BZT_SNO
			   AND SITU.BZT_DVSN_CD = '1'
			   AND SITU.REL_AUD_YR = #strAudYr#
			   AND SITU.REL_AUD_NO = #strAudNo#
			   AND SITU.AUD_STEP_SNO = #strAudStepSno#
        ]]>
	</select>	

	<select id="BADDED014Qselect1_2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TTO.BZT_YR,
			       TTO.BZT_SNO,
			       TTO.TEAM_SNO,
			       F_ORG_INFO(TTO.ORG_CD,'1') ORG_NM,
			       TTO.RGN_CD,
			       F_CODE_NM('1000001',TTO.RGN_CD) AS LCL_NM,
			       TTO.AUD_STR_DT,
			       TTO.AUD_END_DT,
			       PSON.AUD_DCN,
			       PSON.BZT_STR_DT,
			       PSON.BZT_END_DT,
			       PSON.BZT_DCN
			  FROM TBBADDED008L TTO,
			       TBBADDED002M SITU,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               TEAM_SNO,
			               BGRP_TG_ORG_SNO,
			               MIN(AUD_STR_DT) AS AUD_STR_DT,
			               MAX(AUD_END_DT) AS AUD_END_DT,
			               MAX(AUD_DCN) AUD_DCN,
			               MIN(BZT_STR_DT) AS BZT_STR_DT,
			               MAX(BZT_END_DT) AS BZT_END_DT,
			               MAX(BZT_DCN) BZT_DCN
			          FROM TBBADDED006L
			         WHERE BZT_YR = #strAudYr#
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               TEAM_SNO,
			               BGRP_TG_ORG_SNO) PSON
			 WHERE TTO.BZT_YR = SITU.BZT_YR
			   AND TTO.BZT_SNO = SITU.BZT_SNO
			   AND PSON.BZT_YR = TTO.BZT_YR
			   AND PSON.BZT_SNO = TTO.BZT_SNO
			   AND PSON.TEAM_SNO = TTO.TEAM_SNO
			   AND PSON.BGRP_TG_ORG_SNO = TTO.BGRP_TG_ORG_SNO
			   AND SITU.BZT_DVSN_CD = '1'
			   AND SITU.REL_AUD_YR = #strAudYr#
			   AND SITU.REL_AUD_NO = #strAudNo#
			   AND SITU.AUD_STEP_SNO = #strAudStepSno#
			   AND TTO.TEAM_SNO = #MASTER_TEAM_SNO#
        ]]>
	</select>	
	
	<select id="BADDED014Qselect1_3" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			  SELECT TMA.BZT_YR, /*출장년도*/
				     TMA.BZT_SNO,  /*출장순번*/
				     TMA.TEAM_SNO,  /*팀번호*/
				     TMA.PCT_CNB,  /*전산번호*/
				     F_DPT_INFO(TMA.BLT_BRDV_CD,'4') DPT_NM,  /*부서명 약칭1*/
				     TMA.PCT_RANK_CD,  /*출장자직급코드*/
				     F_CODE_NM('1000173',TMA.PCT_RANK_CD) AS RANK_NM, /*출장자직급명*/
				     TMA.PCT_NM  /*출장자*/
				FROM TBBADDED005L TMA, TBBADDED002M SITU
			   WHERE TMA.BZT_YR = SITU.BZT_YR 
				 AND TMA.BZT_SNO = SITU.BZT_SNO  
				 AND SITU.BZT_DVSN_CD ='1'  /*감사출장*/  
				 AND SITU.REL_AUD_YR   = #strAudYr#
				 AND SITU.REL_AUD_NO   = #strAudNo#
				 AND SITU.AUD_STEP_SNO = #strAudStepSno#
				 AND TMA.TEAM_SNO = #MASTER_TEAM_SNO#
        ]]>
	</select>
	
	<select id="BADDED014Qselect1_4" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT M.TEAM_SNO,
			       MIN(M.AUD_STR_DT) AUD_STR_DT,
			       MAX(M.AUD_END_DT) AUD_END_DT,
			       SUM(M.AUD_DCN) AUD_DCN,
			       MIN(M.BZT_STR_DT) BZT_STR_DT,
			       MAX(M.BZT_END_DT) BZT_END_DT,
			       SUM(M.BZT_DCN) BZT_DCN
			  FROM (SELECT PTD.BZT_YR,
			               PTD.BZT_SNO,
			               PTD.TEAM_SNO,
			               PTD.BGRP_TG_ORG_SNO,
			               MIN(PTD.AUD_STR_DT) AUD_STR_DT,
			               MAX(PTD.AUD_END_DT) AUD_END_DT,
			               MAX(PTD.AUD_DCN) AUD_DCN,
			               MIN(PTD.BZT_STR_DT) BZT_STR_DT,
			               MAX(PTD.BZT_END_DT) BZT_END_DT,
			               MAX(PTD.BZT_DCN) BZT_DCN
			          FROM TBBADDED006L PTD,
			               TBBADDED002M SITU
			         WHERE PTD.BZT_YR = SITU.BZT_YR
			           AND PTD.BZT_SNO = SITU.BZT_SNO
			           AND SITU.BZT_DVSN_CD ='1'
			           AND SITU.REL_AUD_YR = #strAudYr#
			           AND SITU.REL_AUD_NO = #strAudNo#
			           AND SITU.AUD_STEP_SNO = #strAudStepSno#
			           AND PTD.TEAM_SNO = #MASTER_TEAM_SNO#
			         GROUP BY PTD.BZT_YR,
			               PTD.BZT_SNO,
			               PTD.TEAM_SNO,
			               PTD.BGRP_TG_ORG_SNO ) M
			 GROUP BY M.TEAM_SNO 
        ]]>
	</select>
	
	<select id="BADDED014Qselect1_5" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
             SELECT T1.BZT_YR                                       		AS BZT_YR       
                     , T1.BZT_SNO                                    		AS BZT_SNO 
                     , T1.TEAM_SNO                                    		AS TEAM_SNO
                     , T1.PCT_ALC_SNO                                 		AS PCT_ALC_SNO
                     , T1.PCT_CNB                                       	AS PCT_CNB
                     , T1.PCT_NM                                        	AS PCT_NM
                     , T1.STF_DVSN_CD                                 		AS STF_DVSN_CD
                     , T1.EX_SNO                                        	AS EX_SNO      
                     , T1.BZT_EX_STR_DT  									AS BZT_EX_STR_DT
                     , T1.BZT_EX_END_DT 									AS BZT_EX_END_DT
                     , T1.BZT_EX_DCN                                     	AS BZT_EX_DCN
                     , T1.BZT_EX_KND_CD                                		AS BZT_EX_KND_CD           
                     , F_CODE_NM('1000833', T1.BZT_EX_KND_CD)   			AS BZT_EX_KND_NM
                     , T1.BZT_EX_RSN_TXT                               		AS BZT_EX_RSN_TXT      
                     , F_DPT_INFO(T2.BLT_BRDV_CD,'4') 				   		AS DPT_NM    	/*부서명 약칭1*/
          		 	 , F_CODE_NM('1000173',T2.PCT_RANK_CD) 					AS RANK_NM 	/*출장자직급명*/
              FROM TBBADDED032L T1
       INNER JOIN TBBADDED005L T2 ON T2.BZT_YR 	= T1.BZT_YR 
            						  		AND T2.BZT_SNO 	= T1.BZT_SNO  
                  					  		AND T2.PCT_CNB 	= T1.PCT_CNB
                  					  		AND T2.PCT_ALC_SNO = T1.PCT_ALC_SNO
                  					  		AND T2.TEAM_SNO = T1.TEAM_SNO
             WHERE T1.BZT_YR      	= #strBztYr#
                AND T1.BZT_SNO     	= #strBztSno#
                AND T1.IPT_DVSN_CD 	= '1'
                AND T1.TEAM_SNO    	= #MASTER_TEAM_SNO#
             ORDER BY T1.PCT_CNB
                         , T1.BZT_EX_STR_DT
                         , T1.BZT_EX_END_DT
                         , T1.EX_SNO
        ]]>
    </select>  	
	
	<!-- #################################### 실지감사출장 상황표(여비) 조회 끝 ################################# -->
	
	<!-- #################################### 감사출장여비 계산 목록 조회 시작 ################################# -->
	<!--  감사출장여비 계산 목록 조회 - master  -->
	<select id="BADDED014QMainselect2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT SITU.BZT_YR,
			       SITU.BZT_SNO,
			       F_MNG_KND_AUDYRNO(AUD.AUD_YR, AUD.AUD_NO, AUD.AUD_KND_CD, '-') ||' ('|| SITU.AUD_STEP_SNO ||')' AS AUD_YR_SNO,
			       AUD.AUD_YR,
			       AUD.AUD_NO,
			       SITU.AUD_STEP_SNO,       
			       F_CODE_NM('1000007',AUD.AUD_KND_CD) AUD_EXEC_DVSN_CD_NM,
			       F_CODE_NM('1000030',SITU.AUD_BZT_KND_CD) AS AUD_BZT_KND_NM,   	/*감사출장종류명 - 2017.12.27 yyh */
			       F_CODE_NM('1000027',AUD.AUD_SCL_CD) AS AUD_SCL_NM,   	        /*감사규모 - 2018.01.27 yyh */ 
			       SITU.TIT_TXT,
			       PSON.AUD_STR_DT,
			       PSON.AUD_END_DT,
			       PSON.AUD_DCN,
			       PSON.MAN_DAY,
			       PSON.PSON_CNT,
			       F_CODE_NM('1000751',AUD.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM /* 예산구분명 추가 - 2016.06.22 yyh */
			  FROM TBBADDED001M AUD,
			       TBBADDED002M SITU,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               MIN(AUD_STR_DT) AS AUD_STR_DT,
			               MAX(AUD_END_DT) AS AUD_END_DT,
			               MAX(AUD_DCN) AS AUD_DCN,
			               SUM(AUD_DCN) AS MAN_DAY,
			               COUNT(*) AS PSON_CNT
			          FROM (SELECT TMA.BZT_YR,
			                       TMA.BZT_SNO,
			                       TMA.PCT_CNB,
			                       MIN(PTD.AUD_STR_DT) AS AUD_STR_DT,
			                       MAX(PTD.AUD_END_DT) AS AUD_END_DT,
			                       SUM(PTD.AUD_DCN) AS AUD_DCN
			                  FROM TBBADDED005L TMA,
			                       TBBADDED006L PTD
			                 WHERE PTD.BZT_YR = TMA.BZT_YR
			                   AND PTD.BZT_SNO = TMA.BZT_SNO
			                   AND PTD.TEAM_SNO = TMA.TEAM_SNO
			                   AND PTD.PCT_ALC_SNO = TMA.PCT_ALC_SNO
			                   AND PTD.BZT_YR = #strBztYr#
			                   AND PTD.BZT_SNO = #strBztSno#
			                 GROUP BY TMA.BZT_YR,
			                       TMA.BZT_SNO,
			                       TMA.PCT_CNB) PTD1
			         GROUP BY BZT_YR,
			               BZT_SNO ) PSON
			 WHERE SITU.BZT_YR = #strBztYr#
			   AND SITU.BZT_SNO = #strBztSno#
			   AND AUD.AUD_YR = SITU.REL_AUD_YR
			   AND AUD.AUD_NO = SITU.REL_AUD_NO
			   AND PSON.BZT_YR = SITU.BZT_YR
			   AND PSON.BZT_SNO = SITU.BZT_SNO       
        ]]>
	</select>
	
	<!--  감사출장여비 계산 목록 조회 - sub  -->
	<select id="BADDED014QSubselect2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			  SELECT TER.BZT_YR, 
			       TER.BZT_SNO,
			       TER.PCT_CNB,  /*전산번호*/
			       TER.PCT_NM,  /*성명*/
			       TER.PCT_RANK_CD,  /*직급코드*/
			       F_CODE_NM('1000173',TER.PCT_RANK_CD) PCT_RANK_NM,  /*직급명*/
			       TER.STF_DVSN_CD,   /*직원구분코드*/
			       F_DPT_INFO(BL.BLT_BRDV_CD,'4') BLT_BRDV_NM, /*소속*/
			       BL.BLT_BRDV_CD,  /*소속부서*/
			       NVL(TE.IN_EXP, 0) IN_EXP,  /*국내여비*/
			       NVL(TE.SPM_XPN, 0) AS SPM_XPN,  /*현장보충경비*/
			       NVL(TE.BZT_DCN, 0) BZT_DCN,  /*출장일수*/
			       NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS,0) RL_FR_EXS,  /*철도임+수도권운임비*/
			       NVL(TE.IN_EXP, 0) + NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS,0) AS IN_EXP_FR_EXS_TOT, /*국내여비+철도임 소계 - 2016.06.08 yyh*/
			       (
			       CASE
			         WHEN F_LEAD_EXS_RCV_EXS_RCIT_CNB(TER.BZT_YR,TER.BZT_SNO) = TER.PCT_CNB THEN TER2.LEAD_EXS
			         ELSE 0
			       END) AS LEAD_EXS,  /*지휘비*/
			       (
			       CASE
			         WHEN F_LEAD_EXS_RCV_EXS_RCIT_CNB(TER.BZT_YR,TER.BZT_SNO) = TER.PCT_CNB THEN TER2.AUD_ACTV_RCV_EXS  /*감사활동수용비*/
			         ELSE 0
			       END) AS AUD_ACTV_RCV_EXS,
			       NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS,0) + NVL(TE.IN_EXP, 0) + NVL(TE.SPM_XPN, 0) + (
			       CASE
			         WHEN F_LEAD_EXS_RCV_EXS_RCIT_CNB(TER.BZT_YR,TER.BZT_SNO) = TER.PCT_CNB THEN TER2.LEAD_EXS + TER2.AUD_ACTV_RCV_EXS
			         ELSE 0
			       END) AS SUM_ALL,  /*합계*/
			       (
			       CASE
			         WHEN SITU.BZT_TL_CNB = TER.PCT_CNB THEN '0' + TER.PCT_CNB
			         ELSE '1'+TER.PCT_CNB
			       END) AS SORTER
			  FROM TBBADDED010L TER,
			       TBBADDED002M SITU,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               NVL(SUM(TE0.FDEX), 0) AS FDEX,
			               NVL(SUM(TE0.DT_EXS), 0) AS DT_EXS,
			               NVL(SUM(TE0.LDC), 0) AS LDC,
			               NVL(SUM(TE0.CPRG_FR_EXS), 0) AS CPRG_FR_EXS, /*수도권운임비추가 - 2015.05.06 yyh*/
			               SUM(TE0.SPM_XPN) AS SPM_XPN,
			               NVL(SUM(TE0.FDEX), 0) + NVL(SUM(TE0.DT_EXS), 0) + NVL(SUM(TE0.LDC), 0) AS IN_EXP, 
			               NVL(SUM(TE0.BZT_DCN), 0) AS BZT_DCN
			          FROM TBBADDED011L TE0
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			           AND CALC_YN = 'N'
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB) TE,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               SUM(NVL(LEAD_EXS, 0)) AS LEAD_EXS ,
			               SUM(NVL(AUD_ACTV_RCV_EXS, 0)) AS AUD_ACTV_RCV_EXS
			          FROM TBBADDED011L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			           AND CALC_YN = 'N'
			         GROUP BY BZT_YR,
			               BZT_SNO) TER2,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               SUM(RL_FR_EXS) AS RL_FR_EXS
			          FROM TBBADDED017L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			           AND CALC_YN = 'N'
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB ) TFD,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               MAX(BLT_BRDV_CD) AS BLT_BRDV_CD
			          FROM TBBADDED005L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB) BL
			 WHERE TER.BZT_YR = #strBztYr#
			   AND TER.BZT_SNO = #strBztSno#
			   AND TE.BZT_YR(+) = TER.BZT_YR
			   AND TE.BZT_SNO(+) = TER.BZT_SNO
			   AND TE.PCT_CNB(+) = TER.PCT_CNB
			   AND TFD.BZT_YR(+) = TER.BZT_YR
			   AND TFD.BZT_SNO(+) = TER.BZT_SNO
			   AND TFD.PCT_CNB(+) = TER.PCT_CNB
			   AND TER2.BZT_YR = TER.BZT_YR
			   AND TER2.BZT_SNO = TER.BZT_SNO
			   AND SITU.BZT_YR = TER.BZT_YR
			   AND SITU.BZT_SNO = TER.BZT_SNO
			   AND BL.BZT_YR(+) = TER.BZT_YR
			   AND BL.BZT_SNO(+) = TER.BZT_SNO
			   AND BL.PCT_CNB(+) = TER.PCT_CNB
			 ORDER BY SORTER    
        ]]>
	</select>
	<!-- #################################### 감사출장여비 계산 목록 조회 끝 ################################# -->
	
	<!-- ####################################  청구 내역표 조회 시작 ################################# -->
	<select id="BADDED014QMainselect3-1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT AUD.AUD_YR,
			       AUD.AUD_NO,
			       AUD.AUD_GRN_NO,
			       SITU.AUD_STEP_SNO,
			       CASE WHEN AUD.AUD_YR >= '2016' 
			                 THEN '-'||F_CODE_NM('1000739',SUBSTR(AUD.AUD_KND_CD,3,1))||'-'
			            ELSE '-' 
			        END     AS AUD_YR_NO_KND_NM,			       
			       F_CODE_NM('1000007',AUD.AUD_KND_CD) AUD_EXEC_DVSN_CD_NM,
			       F_DPT_INFO(SITU.BZT_BRDV_CD,'1') DPT_NM,
			       F_CODE_NM('1000751',AUD.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM /* 예산구분명 추가 - 2016.06.22 yyh */
			
			  FROM TBBADDED001M AUD,
			       TBBADDED002M SITU
			 WHERE SITU.BZT_YR  = #strBztYr#
			   AND SITU.BZT_SNO = #strBztSno#
			   AND AUD.AUD_YR = SITU.REL_AUD_YR
			   AND AUD.AUD_NO = SITU.REL_AUD_NO       
        ]]>
	</select>	
	
	<select id="BADDED014QMainselect3-2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TE.RGN_DVSN_CD,
			       F_CODE_NM('1000023',TE.RGN_DVSN_CD) AREA_KIND_NM,
			       SUM(TE.AUD_DCN) AS MAN_DAY,
			       SUM(NVL(TE.LEAD_EXS, 0)) LEAD_EXS,
			       SUM(NVL(TE.AUD_ACTV_RCV_EXS, 0)) AUD_ACTV_RCV_EXS,
			       SUM(NVL(TE.SPM_XPN, 0)) SPM_XPN,
			       SUM(NVL(TE.LEAD_EXS, 0)) + SUM(NVL(TE.SPM_XPN, 0)) + SUM(NVL(TE.AUD_ACTV_RCV_EXS, 0)) AS SUM_ALL
			  FROM TBBADDED011L TE
			 WHERE TE.BZT_YR  = #strBztYr#
			   AND TE.BZT_SNO = #strBztSno#
			   AND TE.CALC_YN = 'N'
			 GROUP BY TE.RGN_DVSN_CD
			 ORDER BY 1,2       
        ]]>
	</select>
	
	<select id="BADDED014QMainselect3-3" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			 SELECT SITU.REL_AUD_YR ,
			       SITU.REL_AUD_NO,
			       SITU.AUD_STEP_SNO,
			       CASE WHEN AUD.AUD_YR >= '2016' 
			                 THEN F_CODE_NM('1000739',SUBSTR(AUD.AUD_KND_CD,3,1))
			            ELSE '-' 
			        END                                AS AUD_YR_NO_KND_NM,			       
			       F_CODE_NM('1000007',AUD.AUD_KND_CD) AUD_EXEC_DVSN_CD_NM
			  FROM TBBADDED001M AUD,
			       TBBADDED002M SITU
			 WHERE SITU.BZT_YR  = #strBztYr#
			   AND SITU.BZT_SNO = #strBztSno#
			   AND AUD.AUD_YR = SITU.REL_AUD_YR
			   AND AUD.AUD_NO = SITU.REL_AUD_NO       
        ]]>
	</select>
	
	<select id="BADDED014QMainselect3-4" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT F_CODE_NM('1000023',RGN_DVSN_CD) AREA_KIND_NM,
			       SUM(TE.AUD_DCN) AS MAN_DAY,
			       SUM(TE.FDEX)+ SUM(TE.DT_EXS) + SUM(TE.LDC) AS IN_EXP,
			       NVL(SUM(TFD.RL_FR_EXS), 0) + NVL(SUM(TE.CPRG_FR_EXS), 0) AS RL_FR_EXS, /* 수도권운임 추가 - 2015.05.11 yyh */
			       SUM(TE.FDEX)+ SUM(TE.DT_EXS) + SUM(TE.LDC) + NVL(SUM(TFD.RL_FR_EXS), 0) + NVL(SUM(TE.CPRG_FR_EXS), 0) AS SUM_ALL /* 수도권운임 추가 - 2015.05.11 yyh */
			  FROM TBBADDED011L TE,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               BZT_EXS_SNO,
			               CALC_YN,
			               SUM(RL_FR_EXS) AS RL_FR_EXS
			          FROM TBBADDED017L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               BZT_EXS_SNO,
			               CALC_YN ) TFD
			 WHERE TE.BZT_YR  = #strBztYr#
			   AND TE.BZT_SNO = #strBztSno#
			   AND TE.CALC_YN = 'N'
			   AND TFD.BZT_YR(+) = TE.BZT_YR
			   AND TFD.BZT_SNO(+) = TE.BZT_SNO
			   AND TFD.PCT_CNB(+) = TE.PCT_CNB
			   AND TFD.BZT_EXS_SNO(+) = TE.BZT_EXS_SNO
			   AND TFD.CALC_YN(+) = TE.CALC_YN
			 GROUP BY TE.RGN_DVSN_CD
			 ORDER BY 1       
        ]]>
	</select>
	
	<!-- ####################################  청구 내역표 조회 끝 ################################# -->
	
	<!-- #################################### 여비 명세서1(국내여비 등) 조회 시작 ################################# -->
	<select id="BADDED014Qselect4-1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT SITU.BZT_YR,
			       SITU.BZT_SNO,
			       AUD.AUD_YR,
			       AUD.AUD_NO,
			       F_MNG_KND_AUDYRNO(AUD.AUD_YR, AUD.AUD_NO, AUD.AUD_KND_CD, '-') || '(' || SITU.AUD_STEP_SNO || ')' AS AUD_YR_NO_KND_NM,
			       SITU.AUD_STEP_SNO,
			       F_CODE_NM('1000007',AUD.AUD_KND_CD) AUD_EXEC_DVSN_CD_NM,
			       F_CODE_NM('1000173',SITU.BZT_TL_RANK_CD) POS_CLASS_NM,
			       F_USR_INFO(SITU.BZT_TL_CNB,'2') TRIP_LEADER_NM,
			       SITU.TIT_TXT,
			       PSON.BZT_STR_DT,
			       PSON.BZT_END_DT,
			       PSON.BZT_DCN,
			       PSON.PSON_CNT,
			       F_DPT_INFO(SITU.BZT_BRDV_CD,'1') DPT_NM,
			       F_CODE_NM('1000751',AUD.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM, /* 예산구분명 추가 - 2016.06.22 yyh */
			       CASE WHEN SITU.TREXP_PL_CFM_CD = '2' THEN '확인완료'
			            ELSE ' '
			        END                                     AS TREXP_PL_CFM_NM    /* 2018.07.18 yyh */					       
			  FROM TBBADDED001M AUD,
			       TBBADDED002M SITU,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               MIN(BZT_STR_DT) AS BZT_STR_DT,
			               MAX(BZT_END_DT) AS BZT_END_DT,
			               MAX(BZT_DCN) AS BZT_DCN,
			               COUNT(*) AS PSON_CNT
			          FROM (SELECT TMA.BZT_YR,
			                       TMA.BZT_SNO,
			                       TMA.PCT_CNB,
			                       MIN(PTD.BZT_STR_DT) AS BZT_STR_DT,
			                       MAX(PTD.BZT_END_DT) AS BZT_END_DT,
			                       SUM(PTD.BZT_DCN) AS BZT_DCN
			                  FROM TBBADDED005L TMA,
			                       TBBADDED006L PTD
			                 WHERE PTD.BZT_YR = TMA.BZT_YR
			                   AND PTD.BZT_SNO = TMA.BZT_SNO
			                   AND PTD.TEAM_SNO = TMA.TEAM_SNO
			                   AND PTD.PCT_ALC_SNO = TMA.PCT_ALC_SNO
			                   AND PTD.BZT_YR = #strBztYr#
			                   AND PTD.BZT_SNO = #strBztSno#
			                 GROUP BY TMA.BZT_YR,
			                       TMA.BZT_SNO,
			                       TMA.PCT_CNB) PTD1
			         GROUP BY BZT_YR,
			               BZT_SNO ) PSON
			 WHERE SITU.BZT_YR = #strBztYr#
			   AND SITU.BZT_SNO = #strBztSno#
			   AND AUD.AUD_YR = SITU.REL_AUD_YR
			   AND AUD.AUD_NO = SITU.REL_AUD_NO
			   AND PSON.BZT_YR = SITU.BZT_YR
			   AND PSON.BZT_SNO = SITU.BZT_SNO       
        ]]>
	</select>	
	
	<!-- 전산번호 가져오기 -->
	<select id="BADDED014Qselect4-2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TER.PCT_CNB
			  FROM TBBADDED010L TER,
			       TBBADDED011L TE,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               MAX(BLT_BRDV_CD) AS BLT_BRDV_CD
			          FROM TBBADDED005L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB) BL
			 WHERE TER.BZT_YR = #strBztYr#
			   AND TER.BZT_SNO = #strBztSno#
			   AND BL.BZT_YR(+) = TER.BZT_YR
			   AND BL.BZT_SNO(+) = TER.BZT_SNO
			   AND BL.PCT_CNB(+) = TER.PCT_CNB
			   AND TE.BZT_YR = TER.BZT_YR
			   AND TE.BZT_SNO = TER.BZT_SNO
			   AND TE.PCT_CNB = TER.PCT_CNB
			 GROUP BY TER.PCT_CNB
			 ORDER BY 1       
        ]]>
	</select>	
	
	<select id="BADDED014Qselect4-3" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TER.BZT_YR,
			       TER.BZT_SNO,
			       TER.PCT_CNB,
			       TER.PCT_NM,
			       F_CODE_NM('1000173',TER.PCT_RANK_CD) POS_CLASS_NM,
			       TE.FDEX,
			       TE.LDC,
			       TE.DT_EXS,
			       NVL(TE.CPRG_FR_EXS,0) AS CPRG_FR_EXS, /*수도권운임비추가 - 2015.05.06 yyh*/
			       NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS,0) AS RL_FR_EXS,
			       TE.FDEX + TE.LDC + TE.DT_EXS + NVL(TE.CPRG_FR_EXS,0) + NVL(TFD.RL_FR_EXS, 0) AS SUM_ALL, /*수도권운임비추가 - 2015.05.06 yyh*/
			       TE.LODG_DCN,
			       F_CODE_NM('1000001',TE.RGN_CD) 
			       || (SELECT '(' || SUBSTR(F_CODE_NM('1000727',CPRG_LN_DVSN_CD),4) || ')'
			            FROM TBBADDED014B
			           WHERE DEP_RGN_CD = TER.DEP_RGN_CD
			             AND ARV_RGN_CD = TE.RGN_CD
			             AND CPRG_LN_DVSN_CD != '90'
			             AND ROWNUM = 1)    AS LCL_NM,
			       TE.BZT_DCN,
			       TE.BZT_STR_DT,
			       TE.BZT_END_DT,
			       F_DPT_INFO(BL.BLT_BRDV_CD,'4') DPT_NM
			  FROM TBBADDED010L TER,
			       TBBADDED011L TE,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               BZT_EXS_SNO,
			               SUM(RL_FR_EXS) AS RL_FR_EXS
			          FROM TBBADDED017L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			           AND CALC_YN= 'N'
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               BZT_EXS_SNO ) TFD,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               MAX(BLT_BRDV_CD) AS BLT_BRDV_CD
			          FROM TBBADDED005L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB) BL
			 WHERE TER.BZT_YR = #strBztYr#
			   AND TER.BZT_SNO = #strBztSno#
			   AND BL.BZT_YR(+) = TER.BZT_YR
			   AND BL.BZT_SNO(+) = TER.BZT_SNO
			   AND BL.PCT_CNB(+) = TER.PCT_CNB
			   AND TE.BZT_YR = TER.BZT_YR
			   AND TE.BZT_SNO = TER.BZT_SNO
			   AND TE.PCT_CNB = TER.PCT_CNB
			   AND TE.CALC_YN = 'N'
			   AND TFD.BZT_YR(+) = TE.BZT_YR
			   AND TFD.BZT_SNO(+) = TE.BZT_SNO
			   AND TFD.PCT_CNB(+) = TE.PCT_CNB
			   AND TFD.BZT_EXS_SNO(+) = TE.BZT_EXS_SNO
			   AND TER.PCT_CNB = #MASTER_PCT_CNB#      
            ORDER BY TE.BZT_STR_DT DESC
			        ,TE.BZT_END_DT /* 정렬추가 - 2018.03.05 yyh */  
        ]]>
	</select>	

	<!-- 맨 뒷장 합계 -->
	<select id="BADDED014Qselect4-4" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT SUM(FDEX) AS FDEX,  /*식비*/
			       SUM(DT_EXS) AS DT_EXS,  /*일비*/
			       SUM(LDC) AS LDC,  /*숙박비*/
			       SUM(CPRG_FR_EXS) AS CPRG_FR_EXS,  /*수도권운임비추가 - 2015.05.06 yyh*/
			       SUM(RL_FR_EXS) AS RL_FR_EXS5, /*철도임*/
			       SUM(LODG_DCN) AS LODG_DCN,  /*숙박일수*/
			       SUM(BZT_DCN) AS BZT_DCN,  /*일수*/
			       SUM(SUM_ALL) AS SUM_ALL,  /*지급액*/
			       MAX(TER.PSON_CNT) AS PSON_CNT  /*출장자*/
			  FROM (SELECT TE.BZT_DCN,
			               TE.FDEX,
			               TE.LDC,
			               TE.DT_EXS,
			               NVL(TE.CPRG_FR_EXS, 0) AS CPRG_FR_EXS,  /*수도권운임비추가 - 2015.05.06 yyh*/
			               NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS,0) AS RL_FR_EXS, /*철도비+수도권운임비*/
			               TE.FDEX + TE.LDC + TE.DT_EXS + NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS, 0) AS SUM_ALL,
			               TE.LODG_DCN
			          FROM TBBADDED011L TE,
			               (SELECT BZT_YR,
			                       BZT_SNO,
			                       PCT_CNB,
			                       BZT_EXS_SNO,
			                       SUM(RL_FR_EXS) AS RL_FR_EXS
			                  FROM TBBADDED017L
			                 WHERE BZT_YR = #strBztYr#
			                   AND BZT_SNO = #strBztSno#
			                   AND CALC_YN= 'N'
			                 GROUP BY BZT_YR,
			                       BZT_SNO,
			                       PCT_CNB,
			                       BZT_EXS_SNO ) TFD
			         WHERE TE.BZT_YR = #strBztYr#
			           AND TE.BZT_SNO = #strBztSno#
			           AND TE.CALC_YN = 'N'
			           AND TFD.BZT_YR(+) = TE.BZT_YR
			           AND TFD.BZT_SNO(+) = TE.BZT_SNO
			           AND TFD.PCT_CNB(+) = TE.PCT_CNB
			           AND TFD.BZT_EXS_SNO(+) = TE.BZT_EXS_SNO ) AGGR,
			       (SELECT COUNT(*) AS PSON_CNT
			          FROM TBBADDED010L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#) TER        
        ]]>
	</select>
	
	<select id="BADDED014Qselect4-5" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
             SELECT T1.BZT_YR                                       		AS BZT_YR       
                     , T1.BZT_SNO                                    		AS BZT_SNO 
                     , T1.TEAM_SNO                                    		AS TEAM_SNO
                     , T1.PCT_ALC_SNO                                 		AS PCT_ALC_SNO
                     , T1.PCT_CNB                                       		AS PCT_CNB
                     , T1.PCT_NM                                        	AS PCT_NM
                     , T1.STF_DVSN_CD                                 		AS STF_DVSN_CD
                     , T1.EX_SNO                                        		AS EX_SNO      
                     , T1.BZT_EX_STR_DT  									AS BZT_EX_STR_DT
                     , T1.BZT_EX_END_DT 									AS BZT_EX_END_DT
                     , T1.BZT_EX_DCN                                     	AS BZT_EX_DCN
                     , T1.BZT_EX_KND_CD                                	AS BZT_EX_KND_CD           
                     , F_CODE_NM('1000833', T1.BZT_EX_KND_CD)   	AS BZT_EX_KND_NM
                     , T1.BZT_EX_RSN_TXT                               	AS BZT_EX_RSN_TXT      
                     ,  F_DPT_INFO(T2.BLT_BRDV_CD,'4') 				   	AS DPT_NM    	/*부서명 약칭1*/
          		 	 ,  F_CODE_NM('1000173',T2.PCT_RANK_CD) 		AS RANK_NM 	/*출장자직급명*/
              FROM TBBADDED032L T1
       INNER JOIN TBBADDED005L T2 ON T2.BZT_YR 	= T1.BZT_YR 
            						  		AND T2.BZT_SNO 	= T1.BZT_SNO  
                  					  		AND T2.PCT_CNB 	= T1.PCT_CNB
                  					  		AND T2.PCT_ALC_SNO = T1.PCT_ALC_SNO
                  					  		AND T2.TEAM_SNO = T1.TEAM_SNO
             WHERE T1.BZT_YR      	= #strBztYr#
                AND T1.BZT_SNO     	= #strBztSno#
                AND T1.IPT_DVSN_CD 	= '1'
			    AND T1.PCT_CNB = #MASTER_PCT_CNB#
             ORDER BY T1.PCT_CNB
                         , T1.BZT_EX_STR_DT DESC
                         , T1.BZT_EX_END_DT
                         , T1.EX_SNO     
        ]]>
	</select>	
	
	<!-- #################################### 여비 명세서1(국내여비 등) 조회 끝 ################################# -->
	
	<!-- #################################### 여비 명세서2(현장보충경비 등) 조회 시작 ################################# -->
	<select id="BADDED014Qselect5-1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT SITU.BZT_YR,
			       SITU.BZT_SNO,
			       F_MNG_KND_AUDYRNO(AUD.AUD_YR, AUD.AUD_NO, AUD.AUD_KND_CD, '-') || '(' ||  SITU.AUD_STEP_SNO || ')' AUD_NO,  /*감사연번호*/
			       F_CODE_NM('1000007',AUD.AUD_KND_CD) AS AUD_EXEC_DVSN_CD_NM,  /*감사종류명*/
			       F_CODE_NM('1000173',SITU.BZT_TL_RANK_CD) AS POS_CLASS_NM,  /*감사반장 직급*/
			       F_USR_INFO(SITU.BZT_TL_CNB,'2') AS TRIP_LEADER_NM,  /*감사반장 이름*/
			       SITU.TIT_TXT,  /*감사사항*/
			       PSON.BZT_STR_DT,  /*출장기간 FROM*/
			       PSON.BZT_END_DT,  /*출장기간 TO*/
			       PSON.BZT_DCN,     /*출장일수*/
			       PSON.PSON_CNT,    /*출장인원*/
			       F_DPT_INFO(SITU.BZT_BRDV_CD,'1') DPT_NM,  /*주관국과*/
			       F_CODE_NM('1000751',AUD.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM, /* 예산구분명 추가 - 2016.06.22 yyh */
			       CASE WHEN SITU.TREXP_PL_CFM_CD = '2' THEN '확인완료'
			            ELSE ' '
			        END                                     AS TREXP_PL_CFM_NM    /* 2018.07.18 yyh */				       
			  FROM TBBADDED001M AUD,
			       TBBADDED002M SITU,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               MIN(BZT_STR_DT) AS BZT_STR_DT,
			               MAX(BZT_END_DT) AS BZT_END_DT,
			               MAX(BZT_DCN) AS BZT_DCN,
			               COUNT(*) AS PSON_CNT
			          FROM (SELECT TMA.BZT_YR,
			                       TMA.BZT_SNO,
			                       TMA.PCT_CNB,
			                       MIN(PTD.BZT_STR_DT) AS BZT_STR_DT,
			                       MAX(PTD.BZT_END_DT) AS BZT_END_DT,
			                       SUM(PTD.BZT_DCN) AS BZT_DCN
			                  FROM TBBADDED005L TMA,
			                       TBBADDED006L PTD
			                 WHERE PTD.BZT_YR = TMA.BZT_YR
			                   AND PTD.BZT_SNO = TMA.BZT_SNO
			                   AND PTD.TEAM_SNO = TMA.TEAM_SNO
			                   AND PTD.PCT_ALC_SNO = TMA.PCT_ALC_SNO
			                   AND PTD.BZT_YR = #strBztYr#
			                   AND PTD.BZT_SNO = #strBztSno#
			                 GROUP BY TMA.BZT_YR,
			                       TMA.BZT_SNO,
			                       TMA.PCT_CNB) PTD1
			         GROUP BY BZT_YR,
			               BZT_SNO ) PSON
			 WHERE SITU.BZT_YR = #strBztYr#
			   AND SITU.BZT_SNO = #strBztSno#
			   AND AUD.AUD_YR = SITU.REL_AUD_YR
			   AND AUD.AUD_NO = SITU.REL_AUD_NO
			   AND PSON.BZT_YR = SITU.BZT_YR
			   AND PSON.BZT_SNO = SITU.BZT_SNO       
        ]]>
	</select>	
	
	<select id="BADDED014Qselect5-2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TER.BZT_YR,
			       TER.BZT_SNO,
			       TER.PCT_CNB,  /*전산번호*/
			       TER.PCT_NM,   /*성명*/
			       F_CODE_NM('1000173',TER.PCT_RANK_CD) AS POS_CLASS_NM,  /*직급*/
			       DEPT.ABR_DPT_NM_1 AS DPT_NM, /*소속*/
			       TE.SPM_XPN,  /*보충경비*/
			       (
			         CASE
			           WHEN F_LEAD_EXS_RCV_EXS_RCIT_CNB(TER.BZT_YR,TER.BZT_SNO) = TER.PCT_CNB THEN TER2.LEAD_EXS
			           ELSE 0
			         END) AS LEAD_EXS,  /*지휘비*/
			       (
			         CASE
			           WHEN F_LEAD_EXS_RCV_EXS_RCIT_CNB(TER.BZT_YR,TER.BZT_SNO) = TER.PCT_CNB THEN TER2.AUD_ACTV_RCV_EXS
			           ELSE 0
			         END) AS AUD_ACTV_RCV_EXS,  /*감사활동수용비*/
			       TE.SPM_XPN+ (
			                     CASE
			                       WHEN F_LEAD_EXS_RCV_EXS_RCIT_CNB(TER.BZT_YR,TER.BZT_SNO) = TER.PCT_CNB THEN TER2.LEAD_EXS + TER2.AUD_ACTV_RCV_EXS
			                       ELSE 0
			                     END) AS SUM_ALL, /*지급액*/
			       TE.BZT_DCN,
			       TE.BZT_STR_DT,  /*출장기간 FROM */
			       TE.BZT_END_DT,  /*출장기간 TO*/
			       '' RECIPIENT    /*영수인*/
			  FROM TBBADDED010L TER,
			       TBBADDED002M SITU,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               SUM(TE0.SPM_XPN) AS SPM_XPN,
			               SUM(TE0.BZT_DCN) AS BZT_DCN,
			               MIN(TE0.BZT_STR_DT) AS BZT_STR_DT,
			               MAX(TE0.BZT_END_DT) AS BZT_END_DT
			          FROM TBBADDED011L TE0
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			           AND CALC_YN= 'N'
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB) TE,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               SUM(NVL(LEAD_EXS, 0)) AS LEAD_EXS,
			               SUM(NVL(AUD_ACTV_RCV_EXS, 0)) AS AUD_ACTV_RCV_EXS
			          FROM TBBADDED011L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			           AND CALC_YN= 'N'
			         GROUP BY BZT_YR,
			               BZT_SNO) TER2,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               SUM(RL_FR_EXS) AS RL_FR_EXS
			          FROM TBBADDED017L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			           AND CALC_YN= 'N'
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB ) TFD,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               MAX(BLT_BRDV_CD) AS BLT_BRDV_CD
			          FROM TBBADDED005L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB) BL,
			       TBDCMACM002M DEPT
			 WHERE TER.BZT_YR = #strBztYr#
			   AND TER.BZT_SNO = #strBztSno#
			   AND TE.BZT_YR(+) = TER.BZT_YR
			   AND TE.BZT_SNO(+) = TER.BZT_SNO
			   AND TE.PCT_CNB(+) = TER.PCT_CNB
			   AND TFD.BZT_YR(+) = TER.BZT_YR
			   AND TFD.BZT_SNO(+) = TER.BZT_SNO
			   AND TFD.PCT_CNB(+) = TER.PCT_CNB
			   AND TER2.BZT_YR = TER.BZT_YR
			   AND TER2.BZT_SNO = TER.BZT_SNO
			   AND SITU.BZT_YR = TER.BZT_YR
			   AND SITU.BZT_SNO = TER.BZT_SNO
			   AND BL.BZT_YR(+) = TER.BZT_YR
			   AND BL.BZT_SNO(+) = TER.BZT_SNO
			   AND BL.PCT_CNB(+) = TER.PCT_CNB
			   AND DEPT.DPT_CD(+) = BL.BLT_BRDV_CD       
        ]]>
	</select>	
	<!-- #################################### 여비 명세서2(현장보충경비 등) 조회 끝 ################################# -->
	
	<!-- #################################### 개인별 운임명세서 조회 시작 ################################# -->
	<select id="BADDED014Qselect6-1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT BZT_YR,
			       BZT_SNO,
			       REL_AUD_YR,
			       REL_AUD_NO,
			       AUD_STEP_SNO,
			       SPRT_NO,
                   F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') || '(' || AUD_STEP_SNO || ')' AS AUD_YR_NO_KND_NM,
                   F_CODE_NM('1000751',T1.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM /* 예산구분명 추가 - 2016.06.22 yyh */
			  FROM TBBADDED002M
			      ,TBBADDED001M T1 
			 WHERE BZT_YR = #strBztYr#
			   AND BZT_SNO = #strBztSno#
			   AND REL_AUD_YR = T1.AUD_YR
			   AND REL_AUD_NO = T1.AUD_NO    
        ]]>
	</select>
	
	<select id="BADDED014Qselect6-sub" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TL.TEAM_SNO,
			       TL.BGNG_APD_CD,
			       NVL(TO_CHAR(TL.PCT_ALC_SNO),'N') AS PCT_ALC_SNO /* TBBADDED009L에 대상기관별로 들어가던 구간내역이 인별로 들어가서 추가함 - 2019.05.14 chm  */
			  FROM TBBADDED009L TL
			 WHERE TL.BZT_YR = #strBztYr#
			   AND TL.BZT_SNO = #strBztSno#    
			 GROUP BY TL.BZT_YR,
			       TL.BZT_SNO,
			       TL.TEAM_SNO,
			       TL.BGNG_APD_CD,
			       TL.PCT_ALC_SNO
			 ORDER BY TL.TEAM_SNO,
			          TL.BGNG_APD_CD,
			          TL.PCT_ALC_SNO			       
        ]]>
	</select>
	
	<select id="BADDED014Qselect6-2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TL.BZT_YR,
			       TL.BZT_SNO,
			       TL.TEAM_SNO,
			       TL.RID_DT,  /*승차일*/
			       F_CODE_NM('1000025',TL.TRIN_KND_CD) AS TRAIN_TYPE_NM,  /*교통종류명*/
			       F_CODE_NM('1000026',TL.CHRG_DVSN_CD) AS CHRG_TYPE_NM,  /*요금종류명*/
			       TL.DEP_STN_NM,  /*출발지명*/
			       TL.ARV_STN_NM,  /*도착지명*/
			       TL.RL_FR_EXS,  /*교통비*/
			       DECODE(TL.STND_CHRG_YN,'N','미승인','')  AS STD_YN,
			       NVL(TO_CHAR(TL.PCT_ALC_SNO),'N')      AS PCT_ALC_SNO, /* 출장자배정순번*/
			       TL.BZT_SNO||TL.TEAM_SNO||NVL(TO_CHAR(TL.PCT_ALC_SNO),'N') AS KEY			       
			  FROM TBBADDED009L TL
        INNER JOIN TBBADDED005L T2 ON T2.BZT_YR 	 = TL.BZT_YR 
							  	  AND T2.BZT_SNO 	 = TL.BZT_SNO  
	      					  	  AND T2.PCT_ALC_SNO = TL.PCT_ALC_SNO
	      					  	  AND T2.TEAM_SNO 	 = TL.TEAM_SNO					  
			 WHERE TL.BZT_YR = #strBztYr#
			   AND TL.BZT_SNO = #strBztSno#  
			   AND TL.TEAM_SNO    = #MASTER_TEAM_SNO#
			   AND TL.BGNG_APD_CD = #MASTER_BGNG_APD_CD#
       		   AND T2.STF_DVSN_CD <> '9'	/*차출자 조회하지 않도록 - 2019.05.13 chm*/
			   AND NVL(TO_CHAR(TL.PCT_ALC_SNO),'N') = #PCT_ALC_SNO# /* TBBADDED009L에 대상기관별로 들어가던 구간내역이 인별로 들어가서 추가함 - 2019.05.14 chm  */       				   
        ]]>
	</select>
	
	<select id="BADDED014Qselect6-3" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TMA.BZT_YR,
			       TMA.BZT_SNO,
			       TMA.TEAM_SNO,
			       TMA.PCT_CNB,  /*전산번호*/
			       F_DPT_INFO(TMA.BLT_BRDV_CD,'4') DPT_NM,  /*소속*/
			       F_CODE_NM('1000173',TMA.PCT_RANK_CD) AS PCT_RANK_NM,  /*직급*/
			       TMA.PCT_NM,   /*성명*/
			       TMA.PCT_ALC_SNO, /*출장자배정순번*/
			       (SELECT SUM(A.RL_FR_EXS )
                      FROM TBBADDED009L A
                     WHERE TMA.BZT_YR = A.BZT_YR
                       AND TMA.BZT_SNO = A.BZT_SNO
                       AND TMA.TEAM_SNO = A.TEAM_SNO
                       AND TMA.PCT_ALC_SNO = A.PCT_ALC_SNO) AS SUM_RL_FR_EXS   
			  FROM TBBADDED005L TMA
			 WHERE TMA.BZT_YR = #strBztYr#
			   AND TMA.BZT_SNO = #strBztSno#  
			   AND TMA.TEAM_SNO = #MASTER_TEAM_SNO#
			   AND TMA.DEP_RGN_CD = #MASTER_BGNG_APD_CD#
			   AND TMA.STF_DVSN_CD <> '9' /*차출자 조회하지 않도록 - 2019.05.13 chm*/
        ]]>
		<isNotEqual property="PCT_ALC_SNO" compareValue="N">
		   	   AND TO_CHAR(TMA.PCT_ALC_SNO) = #PCT_ALC_SNO# /* TBBADDED009L에 PCT_ALC_SNO 컬럼이 추가되어 이 컬럼에 값이 있을경우 만 조건을 걸어준다. - 2019.05.14 chm  */
		</isNotEqual>         
	</select>
	
	<select id="BADDED014Qselect6-4" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TL.BZT_YR,
			       TL.BZT_SNO,
			       TL.TEAM_SNO,
			       TL.BGNG_APD_CD,
			       TL.PCT_ALC_SNO,
			       SUM(TL.RL_FR_EXS) RL_FR_EXS  /*합계*/
			  FROM TBBADDED009L TL
			 WHERE TL.BZT_YR = #strBztYr#
			   AND TL.BZT_SNO = #strBztSno#  
			   AND TL.TEAM_SNO = #MASTER_TEAM_SNO#
			   AND TL.BGNG_APD_CD = #MASTER_BGNG_APD_CD# 
			   AND NVL(TO_CHAR(TL.PCT_ALC_SNO),'N') = #PCT_ALC_SNO# /* TBBADDED009L에 대상기관별로 들어가던 구간내역이 인별로 들어가서 추가함 - 2019.05.14 chm  */
			 GROUP BY TL.BZT_YR,
			       TL.BZT_SNO,
			       TL.TEAM_SNO,
			       TL.BGNG_APD_CD,
			       TL.PCT_ALC_SNO       
        ]]>
	</select>
	
	<select id="BADDED014Qselect6-5" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TL.BZT_YR,
			       TL.BZT_SNO,
			       TL.TEAM_SNO,
			       TL.RID_DT,  /*승차일*/
			       F_CODE_NM('1000025',TL.TRIN_KND_CD) AS TRAIN_TYPE_NM,  /*교통종류명*/
			       F_CODE_NM('1000026',TL.CHRG_DVSN_CD) AS CHRG_TYPE_NM,  /*요금종류명*/
			       TL.DEP_STN_NM,  /*출발지명*/
			       TL.ARV_STN_NM,  /*도착지명*/
			       TL.RL_FR_EXS,  /*교통비*/
			       DECODE(TL.STND_CHRG_YN,'N','미승인','-')  AS STD_YN,
			       NVL(TO_CHAR(TL.PCT_ALC_SNO),'N')         AS PCT_ALC_SNO, /* 출장자배정순번*/
			       TL.BZT_SNO||TL.TEAM_SNO||NVL(TO_CHAR(TL.PCT_ALC_SNO),'N') AS KEY
			  FROM TBBADDED009L TL
       INNER JOIN TBBADDED005L T2 ON T2.BZT_YR 		= TL.BZT_YR 
									  		AND T2.BZT_SNO 		= TL.BZT_SNO  
			      					  		AND T2.PCT_ALC_SNO = TL.PCT_ALC_SNO
			      					  		AND T2.TEAM_SNO 	= TL.TEAM_SNO					  
			 WHERE TL.BZT_YR = #strBztYr#
			   AND TL.BZT_SNO = #strBztSno#  
			   AND TL.TEAM_SNO    = #MASTER_TEAM_SNO#
			   AND TL.BGNG_APD_CD = #MASTER_BGNG_APD_CD# 
       		   AND T2.STF_DVSN_CD = '9'	/*차출자만 조회하도록  - 2019.05.13 chm*/
			   AND NVL(TO_CHAR(TL.PCT_ALC_SNO),'N') = #PCT_ALC_SNO# /* TBBADDED009L에 대상기관별로 들어가던 구간내역이 인별로 들어가서 추가함 - 2019.05.14 chm  */       		     
        ]]>
	</select>
	
	<select id="BADDED014Qselect6-6" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TMA.BZT_YR,
			       TMA.BZT_SNO,
			       TMA.TEAM_SNO,
			       TMA.PCT_CNB,  /*전산번호*/
			       F_DPT_INFO(TMA.BLT_BRDV_CD,'4') DPT_NM,  /*소속*/
			       F_CODE_NM('1000173',TMA.PCT_RANK_CD) AS PCT_RANK_NM,  /*직급*/
			       TMA.PCT_NM,   /*성명*/
                   TMA.PCT_ALC_SNO, /*출장자배정순번*/
                   TMA.PCT_NM,   /*성명*/
                   (SELECT SUM(A.RL_FR_EXS )
                      FROM TBBADDED009L A
                     WHERE TMA.BZT_YR = A.BZT_YR
                       AND TMA.BZT_SNO = A.BZT_SNO
                       AND TMA.TEAM_SNO = A.TEAM_SNO
                       AND TMA.PCT_ALC_SNO = A.PCT_ALC_SNO) AS SUM_RL_FR_EXS                   			       
			  FROM TBBADDED005L TMA
			 WHERE TMA.BZT_YR = #strBztYr#
			   AND TMA.BZT_SNO = #strBztSno#  
			   AND TMA.TEAM_SNO = #MASTER_TEAM_SNO#
			   AND TMA.DEP_RGN_CD = #MASTER_BGNG_APD_CD# 
			   AND TMA.STF_DVSN_CD = '9' /*차출자만 조회하도록 - 2019.05.13 chm*/
        ]]>
		<isNotEqual property="PCT_ALC_SNO" compareValue="N">
		   	   AND TO_CHAR(TMA.PCT_ALC_SNO) = #PCT_ALC_SNO# /* TBBADDED009L에 PCT_ALC_SNO 컬럼이 추가되어 이 컬럼에 값이 있을경우 만 조건을 걸어준다. - 2019.05.14 chm  */
		</isNotEqual> 
	</select>	
	<!-- #################################### 개인별 운임명세서 조회 끝 ################################# -->		
</sqlMap> 

