<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="csp/nbk/721">
	
	<select id="CSPNBK721QSetteleYearSelect" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT	/* CSPNBK721QSetteleYearSelect */
				2003 + LVL AS SETTLE_YY
		FROM	(
					SELECT	LEVEL AS LVL
					FROM	DUAL 
					CONNECT BY LEVEL <= TO_NUMBER(TO_CHAR(SYSDATE,'YYYY')) - 2003
				) D1
		ORDER BY SETTLE_YY DESC
	]]>
	</select>
	
	<insert id="CSPNBK721QBsBackForSettleUpHndlBySettleYrInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* CSPNBK721QBsBackForSettleUpHndlBySettleYrInsert */ TBCSPNBK502M
		(
			DEAL_DT
			, MNST_CLU_CD
			, TAX_SITM_CD
			, AM
			, CRDT_AGG_AM
			, CRDT_NOC
			, DS_AGG_AM
			, DS_NOC
			, YRLY_CRDT_AGG_AM
			, YRLY_CRDT_NOC
			, YRLY_DS_AGG_AM
			, YRLY_DS_NOC
			, CLSNG_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT	#settleYy# || #settleTargetDate# AS DEAL_DT
				, D1.MNST_CLU_CD
				, D1.TAX_SITM_CD
				, D1.AM
				, D1.CRDT_AGG_AM
				, D1.CRDT_NOC
				, D1.DS_AGG_AM
				, D1.DS_NOC
				, D1.YRLY_CRDT_AGG_AM
				, D1.YRLY_CRDT_NOC
				, D1.YRLY_DS_AGG_AM
				, D1.YRLY_DS_NOC
				, 'Y' AS CLSNG_YN
				, #USR_ID# AS FRT_USR_ID
				, #USR_ID# AS FNL_USR_ID
				, #DPT_CD# AS FNL_DEAL_DPT_CD
				, #MNU_ID# AS FNL_MNU_ID
				, SYSDATE AS FRT_REGI_DH
				, SYSDATE AS FNL_MDF_DH
		FROM	TBCSPNBK502M D1
		WHERE	D1.DEAL_DT = #settleYy# || #settleSrcDate#
	]]>
	</insert>
	
	<select id="CSPNBK721QSmbInfoPreSettleBySettleYrSelect" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT	/* CSPNBK721QSmbInfoPreSettleBySettleYrSelect */
				D1.SMB_DEAL_DT
				, D1.SMB_SLN
				, D1.AM
				, D1.DEPTS_PMT_DVSN_CD
				, D1.LEDG_KND_CD
				, D1.CRDT_MNST_CLU_CD
				, D1.CRDT_TAX_SITM_CD
				, D1.DS_MNST_CLU_CD 
				, D1.DS_TAX_SITM_CD
		FROM	TBCSPNBK301M D1
		WHERE	D1.SMB_DEAL_DT = #settleYy# || '1231'
		AND		LEDG_KND_CD = '4'
	]]>
	</select>
</sqlMap>