<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ded/125">

	<select id="badded125pMainSelect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
       SELECT 
		      AUD_SBJ_NM  /*감사사항*/
		     ,F_DPT_INFO(SPV_BRDV_CD,'1') SPV_BRDV_NM /*주관부서*/
		     , CASE WHEN trim(A.ENF_APV_DT)         IS NOT NULL THEN '시행'
		           WHEN trim(A.CHF_CMTR_APV_DT)    IS NOT NULL THEN '검토(주심위원)'
		           WHEN trim(A.OW_DHD_APV_DT)      IS NOT NULL THEN '검토(총*차장)'
		           WHEN trim(A.JA_JDG_SSEC_APV_DT) IS NOT NULL THEN '검토(심의실장)'
		           WHEN trim(A.MDT_DDG_APV_DT)     IS NOT NULL THEN '검토(조정담당관)'
		           WHEN trim(A.MDT_OFER_APV_DT)    IS NOT NULL THEN '검토(조정담당자)'
		           WHEN trim(A.AUD_BRDV_APV_DT)    IS NOT NULL THEN '검토(감사국과)'
		           WHEN trim(A.RTN_RPT_DT)         IS NOT NULL THEN '검토(귀청보고)'
		     ELSE '실지감사중'
		     END AS GRADE /*현처리단계*/
		    ,CASE 
		         WHEN trim(A.ENF_APV_DT)         IS NOT NULL THEN '-'  /* 시행결재일자가 있으면 지연일수 없음*/
		         WHEN trim(A.CHF_CMTR_APV_DT)    IS NOT NULL THEN to_char(to_date(sysdate)-to_date(A.ENF_APV_DDLN_DT)) 
		         WHEN trim(A.OW_DHD_APV_DT)      IS NOT NULL THEN to_char(to_date(sysdate)-to_date(A.CHF_CMTR_APV_DDLN_DT)) 
		         WHEN trim(A.JA_JDG_SSEC_APV_DT) IS NOT NULL THEN to_char(to_date(sysdate)-to_date(A.TOT_DHD_APV_DDLN_DT)) 
		         WHEN trim(A.MDT_DDG_APV_DT)     IS NOT NULL THEN to_char(to_date(sysdate)-to_date(A.RVW_RM_APV_DDLN_DT)) 
		         WHEN trim(A.MDT_OFER_APV_DT)    IS NOT NULL THEN to_char(to_date(sysdate)-to_date(A.MDT_OFER_APV_DDLN_DT))
		         WHEN trim(A.AUD_BRDV_APV_DT)    IS NOT NULL THEN to_char(to_date(sysdate)-to_date(A.MDT_CHGR_APV_DDLN_DT))
		         WHEN trim(A.RTN_RPT_DT)         IS NOT NULL THEN to_char(to_date(sysdate)-to_date(A.BRDV_HNDL_DDLN_DT))
		         WHEN trim(A.RTN_RPT_DT)         IS NULL THEN to_char(to_date(sysdate)-to_date(A.RPT_DDLN_DT))
		         ELSE '-'
	    	  END delay_cnt  /*지연일수*/     
		    ,A.HNDL_SITU_HIS  /*지연사유*/
		FROM TBBADDED003M A
		    ,TBBADDED001M B
		WHERE 1=1
		  AND A.AUD_YR(+) = B.AUD_YR
		  AND A.AUD_NO(+) = B.AUD_NO
		  AND ((A.AUD_EXEC_HNDL_STA_CD = '1' AND TO_DATE(NVL(A.RTN_DT ,'99991231')) - TO_DATE(SYSDATE) <= 0)
		  AND SUBSTRING(B.SPV_BRDV_CD, 1, 1) = '0'
		    OR  A.AUD_EXEC_HNDL_STA_CD = '3')
        ]]>
		  AND SUBSTRB(SPV_BRDV_CD, 1, 3) || '000' = #strDptCd# /*화면의 부서국코드*/
     </select>
</sqlMap> 
