<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/bii/413">
	<!-- 기본정보 조회 -->  
	
	<select id="CSPBII413QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT A.ACP_YR || '-부방-' || LPAD(STTM_ACP_NO, 3, '0') AS MTRL_NO       
			     , A.ACP_DH
			     , A.CLC_RUT_NM
			     , (SELECT B.ORG_NM
			          FROM TBDCMACM015M B
			         WHERE B.ORG_CD = A.REL_ORG_CD) AS REL_ORG_NM
			     , A.TIT_NM
			     , A.ACP_YR
			     , A.STTM_DVSN_CD
			     , A.STTM_ACP_NO  
			  FROM TBCSPDCP811T A  /* 부패방지자료정보내역 */
			 WHERE 1=1			
		]]>
			<isNotEmpty property="strStrAcpDt">
				AND A.ACP_DH >= #strStrAcpDt#
			</isNotEmpty>
			<isNotEmpty property="strEndAcpDt">
				AND A.ACP_DH &lt;= #strEndAcpDt#
			</isNotEmpty>
			<isNotEmpty property="strRelOrgCd">
				AND A.REL_ORG_CD = #strRelOrgCd#
			</isNotEmpty>			
			<isNotEmpty property="strSchTxt">
				AND (A.ACP_YR, A.RM_STTM_ACP_NO) IN (SELECT B.RM_STTM_ACP_NO
				                            , B.STTM_ACP_NO
				                         FROM TBCSPDCP811T B 
				                        WHERE B.CLC_RUT_NM LIKE '%' || #strSchTxt# || '%'
				                       
				                       UNION ALL
				                       
				                       SELECT B.ACP_YR
				                            , B.STTM_ACP_NO
				                         FROM TBCSPDCP811T B 
				                        WHERE B.TIT_NM LIKE '%' || #strSchTxt# || '%'				                       
				                       )
			</isNotEmpty>
			ORDER BY MTRL_NO DESC
	</select>
</sqlMap> 
