<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/cav/053"> 
	 
	<!--조회(공통테이블과 증명책임자부호 테이블 기관명 틀린것 조회-->
	<select id="FAACAV053EMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/053/FAACAV053EMainSelect */ ]]>
		<include refid="include.pageSelct" />		
        <![CDATA[
			SELECT  DISTINCT ROWNUM AS KEY,
			        A.ORG_CD AS ORG_CD,
			        A.ORG_NM AS ORG_NM,
			        B.ORG_CD AS CMM_ORG_CD,
			        B.ORG_NM AS CMM_ORG_NM,
			        C.COPT_CD||'-'||C.ACNT_CD||'-'||C.BLL_CD||'-'||C.PROF_DRTR_SRNO||'-'||C.DL_XPN_RCDB_PBSVT_SRNO AS ACCMN_ID,
                    C.COPT_CD,
                    C.ACNT_CD,
                    C.BLL_CD,
                    C.PROF_DRTR_SRNO,
                    C.DL_XPN_RCDB_PBSVT_SRNO,
                    C.CRE_DT,
                    C.ORGCHF_NM,
                    C.PST_NM,
                    C.ABLT_DT,
                    C.BR_CD,
                    C.DIV_CD,
                    C.MDF_DT,
                    C.MDF_DVSN_CD,
                    C.DOC_ENF_NO,
                    C.DOC_ENF_DT,
                    C.FNCR_EIN,
                    C.FNCR_NM,
                    C.EXPN_SSEC_EIN,
                    C.EXPN_SSEC_NM,
                    C.MDF_PEN_EIN,
                    C.MDF_PEN_NM,
                    C.TNB,
                    C.ZCD,
                    C.AD,
                    C.BZN,
                    C.ACP_DVSN_CD,
                    C.FNL_MDF_DH,
                    C.FRT_USR_ID,
                    C.FNL_USR_ID,
                    C.FNL_DEAL_DPT_CD,
                    C.FNL_MNU_ID,
                    C.ENS_USE_YN 
			FROM    TWFAACAV003M A,
			        TBDCMACM015M B,
                    TWFAACAV003M C
			WHERE   A.ORG_CD = B.ORG_CD
			AND     A.ORG_NM <> B.ORG_NM
            AND     A.COPT_CD = C.COPT_CD
            AND     A.ACNT_CD = C.ACNT_CD
            AND     A.BLL_CD  = C.BLL_CD
            AND     A.PROF_DRTR_SRNO = C.PROF_DRTR_SRNO
            AND     A.DL_XPN_RCDB_PBSVT_SRNO = C.DL_XPN_RCDB_PBSVT_SRNO
            AND		A.ABLT_DT = '999999'
            AND		A.MDF_DVSN_CD != 'D'
		]]>
		<include refid="include.pageOrder" />
			ORDER BY ACCMN_ID, KEY
	</select>	
	
	<!--증명자부호 기관명 update-->
	<update id="FAACAV053EMainUpdate" parameterClass="paramMap">
		<![CDATA[  /* faa/cav/053/FAACAV053EMainUpdate */ ]]>
		UPDATE	TWFAACAV003M SET
				ORG_NM = #CMM_ORG_NM#
		WHERE	ORG_CD = #CMM_ORG_CD#
		AND		COPT_CD = #COPT_CD#
		AND		ACNT_CD = #ACNT_CD#
		AND		BLL_CD  = #BLL_CD#
		AND		PROF_DRTR_SRNO = #PROF_DRTR_SRNO#
		AND		DL_XPN_RCDB_PBSVT_SRNO = #DL_XPN_RCDB_PBSVT_SRNO#
	</update>
	
	<insert id="FAACAV053E_EN_ENAIS_TWFAACAV003M_UpdateDelete" parameterClass="paramMap">
		<![CDATA[  /* faa/cav/053/FAACAV030E_EN_ENAIS_TWFAACAV003M_UpdateDelete */ ]]>
		INSERT INTO EN_ENAIS_TWFAACAV003M (
						IF_SEQ
			            ,COPT_CD
						,ACNT_CD
						,BLL_CD
						,PROF_DRTR_SRNO
						,DL_XPN_RCDB_PBSVT_SRNO
						,CRE_DT
						,ORG_CD
						,ORG_NM
						,ORGCHF_NM
						,PST_NM
						,ABLT_DT
						,BR_CD
						,DIV_CD
						,MDF_DT
						,MDF_DVSN_CD
						,DOC_ENF_NO
						,DOC_ENF_DT
						,FNCR_EIN
						,FNCR_NM
						,EXPN_SSEC_EIN
						,EXPN_SSEC_NM
						,MDF_PEN_EIN
						,MDF_PEN_NM
						,TNB
						,ZCD
						,AD
						,BZN
						,ACP_DVSN_CD
						,ENS_USE_YN
						,FRT_REGI_DH
						,FRT_USR_ID
						,FNL_MDF_DH
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
			            ,FLAG
			            ,IF_STATUS
			            ,IF_TRY
			            ,IF_RAISE_DT
			            ,IF_DEAL_DT
			            ,IF_MESSG
			            ,IF_SIID
					) VALUES (
			            #IF_SEQ#
						,#COPT_CD#
			            ,#ACNT_CD#
			            ,#BLL_CD#
			            ,#PROF_DRTR_SRNO#
			            ,#DL_XPN_RCDB_PBSVT_SRNO#
			            ,#CRE_DT#
			            ,#ORG_CD#
			            ,#CMM_ORG_NM#
			            ,#ORGCHF_NM#
			            ,#PST_NM#
			            ,#ABLT_DT#
			            ,RPAD(#BR_CD#,3,'0')
			            ,RPAD(#DIV_CD#,3,'0')
			            ,#MDF_DT#
						,#MDF_DVSN_CD#
						,#DOC_ENF_NO#
						,#DOC_ENF_DT#
						,#FNCR_EIN#
						,#FNCR_NM#
						,#EXPN_SSEC_EIN#
						,#EXPN_SSEC_NM#
						,#MDF_PEN_EIN#
						,#MDF_PEN_NM#
						,#TNB#
						,#ZCD#
						,#AD#
						,#BZN#
						,#ACP_DVSN_CD#
						,#ENS_USE_YN#
						,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
						,#FRT_USR_ID#
						,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
						,#FNL_USR_ID#
						,#FNL_DEAL_DPT_CD#
						,#FNL_MNU_ID#
			            ,#FLAG#
			            ,'SS'
			            ,'0'
			            ,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			            ,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			            ,''
			            ,''
					)
	</insert>
	
</sqlMap> 
