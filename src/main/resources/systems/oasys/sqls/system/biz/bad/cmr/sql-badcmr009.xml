<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/cmr/009">

  
  <select id="badcmr009ELagCatselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[    
			 SELECT YE         /*연도*/
			     , LAG_CAT_SNO /*대분류순번*/
			     , '['||LAG_CAT_SNO||']'||LAG_CAT_TIT_NM AS LAG_CAT_TIT_NM/*대분류제목명*/
			     , LAG_CAT_TXT   /*대분류내용*/
			     , REGI_DT    /*등록일*/
			     , REGN_ID		/*등록자ID*/
			     , MDF_DT		/*수정일*/
			     , MDF_PEN_ID	/*수정자ID*/	
			     , DEL_YN		/*삭제여부*/
			  FROM TBBADCMR001M
			 WHERE 1=1
			   AND YE = #strYear#
			  ]]>
          </select>
          
    <select id="badcmr009EMidCatselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[    
			 SELECT YE         		/*연도*/
			     , LAG_CAT_SNO 		/*대분류순번*/
			     , MID_CAT_SNO		/*중분류순번*/
			     , '['||LAG_CAT_SNO||'-'||MID_CAT_SNO||']'||MID_CAT_TIT_NM AS MID_CAT_TIT	/*중분류제목명*/
			     , MID_CAT_TIT_NM
			     , MID_CAT_TXT		/*중분류내용*/
			     , CHR_DPT_CD		/*담당부서코드*/
			     , F_DPT_INFO(CHR_DPT_CD,'1') AS CHR_DPT_NM
			     , REGI_DT    /*등록일*/
			     , REGN_ID		/*등록자ID*/
			     , MDF_DT		/*수정일*/
			     , MDF_PEN_ID	/*수정자ID*/	
			     , DEL_YN		/*삭제여부*/
			  FROM TBBADCMR002M
			 WHERE 1=1
			   AND YE = #strYear#	
			   AND LAG_CAT_SNO =#strLagCatSno#
			  ]]>
		<isNotEmpty prepend="AND" property="strMidCatSno">
			MID_CAT_SNO = #strMidCatSno#
		</isNotEmpty>
          </select>
     
       <select id="badcmr009ESmlCatselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[    
			 SELECT T3.YE               /*연도*/
			     , T3.LAG_CAT_SNO      /*대분류순번*/
				 , T3.MID_CAT_SNO	    /*중분류순번*/
				 , T3.SALL_CAT_SNO		/*소분류순번*/
				 , T3.SALL_CAT_TIT_NM	/*소분류제목명*/
				 , '['||T3.LAG_CAT_SNO||'-'||T3.MID_CAT_SNO||'-'||T3.SALL_CAT_SNO||']' AS CAT_SNO
				 , T3.SALL_CAT_TXT		/*소분류내용*/
				 , T3.CHR_DPT_CD		/*담당부서코드*/
				 , T3.CHGR_ID		/*담당자ID*/
			     , T3.REGI_DT      /*등록일*/
			     , T3.REGN_ID		/*등록자ID*/
			     , T3.MDF_DT		/*수정일*/
			     , T3.MDF_PEN_ID	/*수정자ID*/	
			     , T3.DEL_YN		/*삭제여부*/
			     , T3.YE ||'-'||T3.LAG_CAT_SNO||'-'||T3.MID_CAT_SNO||'-'||T3.SALL_CAT_SNO  AS SNO
			     , F_USR_INFO(T3.CHGR_ID,'2')AS CHGR_NM
			     , F_DPT_INFO(T3.CHR_DPT_CD,'1') AS CHR_DPT_NM
			     , T3.CMPT_YN
			     , CASE WHEN T4.CNT>0 THEN '○'
                        ELSE 'X'
                    END AS FILE_CHECK
			     , T3.CPR_CHGR_ID
			     , F_USR_INFO(T3.CPR_CHGR_ID,'2')AS CPR_CHGR_NM
					, T3.CPR_DPT_CD
					, F_DPT_INFO(T3.CPR_DPT_CD,'1') AS CPR_DPT_NM
					, T3.STD_CHGR_ID
					, F_USR_INFO(T3.STD_CHGR_ID,'2')AS STD_CHGR_NM
					, T3.STD_DPT_CD
					, F_DPT_INFO(T3.STD_DPT_CD,'1') AS STD_DPT_NM
					, NVL(T3.EPS_MNG_YN,'N') AS EPS_MNG_YN
			  FROM TBBADCMR003M T3, (SELECT SUM(CASE
                  WHEN (SELECT PAGE_TITLE
                          FROM UBKERAPP.XR_PAGE
                         WHERE DOC_ID = TBBADCMR004D.DOC_ID
                           AND PAGE_TITLE IS NOT NULL
                           AND ROWNUM=1) IS NOT NULL THEN 1
                                         ELSE 0
                                       END) AS CNT
             , YE
             , SALL_CAT_SNO
          FROM TBBADCMR004D
         WHERE YE=#strYear#
           AND MAIN_PLCY_DTL_DVSN_CD ='b'
         GROUP BY YE , SALL_CAT_SNO ) T4
         
			 WHERE 1=1
			  AND T3.YE = T4.YE(+)
   			  AND T3.SALL_CAT_SNO = T4.SALL_CAT_SNO(+)
			  AND T3.YE = #strYear#
			  AND T3.LAG_CAT_SNO = #strLagCatSno#
			  AND T3.MID_CAT_SNO = #strMidCatSno#
			  ]]>
			 <isNotEmpty prepend="AND" property="strSallCatSno">
			T3.SALL_CAT_SNO = #strSallCatSno#
		</isNotEmpty> 
			  
          </select>          
          
             
    <update id="badcmr009ELagCatdelete" parameterClass="paramMap">
		DELETE
		FROM
		TBBADCMR001M
		WHERE 1=1
		AND YE = #YE#
		AND LAG_CAT_SNO =#LAG_CAT_SNO#

	</update>
	
	  <update id="badcmr009EMidCatdelete" parameterClass="paramMap">
		DELETE
		FROM
		TBBADCMR002M
		WHERE 1=1
		AND YE = #YE#
		AND LAG_CAT_SNO =#LAG_CAT_SNO#
        AND MID_CAT_SNO = #strMidCatSno#
	</update>
	
	<update id="badcmr009ESalCatdelete" parameterClass="paramMap">
	
	DECLARE
			BEGIN
				DELETE
				FROM
				TBBADCMR005B
				WHERE 1=1
				AND YE = #YE#
				AND SALL_CAT_SNO =#SALL_CAT_SNO#;
		        
		        DELETE
		        FROM TBBADCMR004D
		        WHERE 1=1
		        AND SALL_CAT_SNO=#SALL_CAT_SNO#
		        AND YE =#YE#;
		        
		        DELETE
		        FROM TBBADCMR008L
		        WHERE 1=1
		        AND SALL_CAT_SNO=#SALL_CAT_SNO#
		        AND YE =#YE#;
		        
		        DELETE
		        FROM TBBADCMR007L
		        WHERE 1=1
		        AND SALL_CAT_SNO=#SALL_CAT_SNO#
		        AND YE =#YE#;
		        
		        DELETE
		        FROM TBBADCMR003M
		        WHERE 1=1
		        AND SALL_CAT_SNO=#SALL_CAT_SNO#
		        AND YE =#YE#
		        AND LAG_CAT_SNO= #LAG_CAT_SNO#
		        AND MID_CAT_SNO = #MID_CAT_SNO#;
		        
		        
		 	END;
		        
	</update>
	
	
	 <select id="badcmr009ESmlEvlselect" parameterClass="paramMap"
		resultClass="java.lang.String">
        <![CDATA[    
			 SELECT COUNT(EVL_NO) AS CNT               /*연도*/
			  FROM TBBADCMR006L
			 WHERE 1=1
			 	AND YE = #strYear#
			    AND SALL_CAT_SNO = #strSallCatSno#
			  ]]>

          </select>          
  
	
</sqlMap> 
