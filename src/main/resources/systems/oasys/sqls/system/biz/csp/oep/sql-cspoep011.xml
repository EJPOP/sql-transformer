<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/oep/011">

	<select id="CSPOEP011EinitSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT YYYY AS CD, 
				       YYYY AS CDNM 
				  FROM (
				        SELECT TO_CHAR(SYSDATE,'YYYY') - LEVEL + 2 YYYY 
				          FROM DUAL 
				        CONNECT BY TO_CHAR(SYSDATE,'YYYY') - LEVEL + 2 >= 1980
				       )
		]]>
        
	</select>
	
	<select id="CSPOEP011EMainHeaderSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT 
			CC.YYYYMMDD
			,CC.TOTALDAY
			,(CASE WHEN CC.TOTALDAY = (SELECT YE || MD FROM TBBADDED013B WHERE YE || MD = CC.TOTALDAY) THEN '1' ELSE '0' END) HOLIDAY
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#SELECTED_DAY#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD')
					)
			)CC
		]]>
        
	</select>
	

	<select id="CSPOEP011EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[   	
SELECT C.LOUNGE_ID
     , C.LOUNGE_SRCH_SEQ
     , C.LOUNGE_NM 
	 , C.DAY1_1    
     , C.DAY2_1      
     , C.DAY3_1        
     , C.DAY4_1    
     , C.DAY5_1
     , C.DAY6_1
     , C.DAY7_1  
     , C.DAY8_1     
     , C.DAY9_1    
     , C.DAY10_1    
     , C.DAY11_1     
     , C.DAY12_1    
     , C.DAY13_1     
     , C.DAY14_1 
     , CASE WHEN C.DAY1 > 0  THEN C.DAY1 ELSE NULL END DAY1
     , CASE WHEN C.DAY2 > 0  THEN C.DAY2 ELSE NULL END DAY2
     , CASE WHEN C.DAY3 > 0  THEN C.DAY3 ELSE NULL END DAY3
     , CASE WHEN C.DAY4 > 0  THEN C.DAY4 ELSE NULL END DAY4  
     , CASE WHEN C.DAY5 > 0  THEN C.DAY5 ELSE NULL END DAY5
     , CASE WHEN C.DAY6 > 0  THEN C.DAY6 ELSE NULL END DAY6
     , CASE WHEN C.DAY7 > 0  THEN C.DAY7 ELSE NULL END DAY7
     , CASE WHEN C.DAY8 > 0  THEN C.DAY8 ELSE NULL END DAY8
     , CASE WHEN C.DAY9 > 0  THEN C.DAY9 ELSE NULL END DAY9  
     , CASE WHEN C.DAY10 > 0  THEN C.DAY10 ELSE NULL END DAY10
     , CASE WHEN C.DAY11 > 0  THEN C.DAY11 ELSE NULL END DAY11
     , CASE WHEN C.DAY12 > 0  THEN C.DAY12 ELSE NULL END DAY12
     , CASE WHEN C.DAY13 > 0  THEN C.DAY13 ELSE NULL END DAY13
     , CASE WHEN C.DAY14 > 0  THEN C.DAY14 ELSE NULL END DAY14
	 , C.RESERVE_USER_ID 
     
  FROM
(               SELECT   A.LOUNGE_ID
			            ,A.LOUNGE_SRCH_SEQ
					    ,A.LOUNGE_NM
					    ,B.RESERVE_USER_ID						   
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#),'YYYYMMDD')  AND LOUNGE_ID = A.LOUNGE_ID ) DAY1	   
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#),'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID ) DAY1_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +1,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID  ) DAY2
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +1,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID  ) DAY2_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +2,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID ) DAY3
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +2,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND LOUNGE_ID = A.LOUNGE_ID ) DAY3_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +3,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID  ) DAY4
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +3,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID  ) DAY4_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +4,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID  ) DAY5
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +4,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID  ) DAY5_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +5,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID  ) DAY6
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +5,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID  ) DAY6_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +6,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID ) DAY7
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +6,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID ) DAY7_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +7,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID ) DAY8
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +7,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND LOUNGE_ID = A.LOUNGE_ID ) DAY8_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +8,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID ) DAY9
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +8,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND LOUNGE_ID = A.LOUNGE_ID ) DAY9_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +9,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID  ) DAY10
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +9,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID  ) DAY10_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +10,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID  ) DAY11
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +10,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID  ) DAY11_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +11,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID  ) DAY12
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +11,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID  ) DAY12_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +12,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID  ) DAY13
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +12,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID  ) DAY13_1
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD') AND LOUNGE_ID = A.LOUNGE_ID ) DAY14
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND LOUNGE_ID = A.LOUNGE_ID ) DAY14_1
					    
			  FROM     TBCSPOEP011M A	/*휴게실 관리 기본*/
				      ,TBCSPOEP012M B	/*휴게실 예약 기본*/
			 WHERE   A.LOUNGE_ID = B.LOUNGE_ID(+) AND B.RESERVE_USER_ID(+) =  #USER_ID# 
		]]>
		
		<![CDATA[  
		 	 GROUP BY A.LOUNGE_ID ,A.LOUNGE_SRCH_SEQ , A.LOUNGE_NM, B.RESERVE_USER_ID 
             ORDER BY A.LOUNGE_SRCH_SEQ
) C
 		]]>
        
	</select>

	
	<delete id="CSPOEP011EDelete" parameterClass="paramMap">
			DELETE FROM TBCSPOEP012M
			 WHERE 1 = 1
			   AND LOUNGE_ID = #LOUNGE_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</delete>
	

	<select id="CSPOEP011EResvDuplicationCheckSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
				SELECT COUNT(A.LOUNGE_ID) AS CNT
				  FROM
				       (SELECT LOUNGE_ID FROM TBCSPOEP012M 
						 WHERE 1=1
						   AND LOUNGE_ID = #LOUNGE_ID#
						   AND BOKG_DT = REPLACE(#BOKG_DT#, '-', '')
						  /* AND COFM_CD = '1' */
				   		  
						)A
		]]>
	</select>

	
	<update id="CSPOEP011EUpdate" parameterClass="paramMap">
		UPDATE TBCSPOEP012M 
		   SET FNL_USR_ID = #FNL_USR_ID#
		    <isNotNull prepend="," property="FNL_DEAL_DPT_CD">
		       FNL_DEAL_DPT_CD      = #FNL_DEAL_DPT_CD#
		    </isNotNull>
		    <isNotNull prepend="," property="FNL_MNU_ID">
		       FNL_MNU_ID      = #FNL_MNU_ID#
		    </isNotNull>
		    <isNotNull prepend="," property="TNB">
		       TNB      = #TNB#
		    </isNotNull>
			<isNotNull prepend="," property="TIT_NM">
		       TIT_NM   = #TIT_NM#
		    </isNotNull>			
		       ,FNL_MDF_DH      = SYSDATE
		 WHERE 1=1
		   AND LOUNGE_ID = #LOUNGE_ID#
		   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>
	
	<select id="CSPOEP011EResvSubListSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT A.BOKG_APL_DH,
				       A.LOUNGE_ID,
				   	   B.LOUNGE_NM,
				   	   A.BOKG_PEN_ID AS USR_ID,
					   C.USR_NAM,
					   D.DPT_NM,
					   TO_CHAR(TO_DATE(A.BOKG_DT), 'YYYY-MM-DD') AS BOKG_DT,
					   A.TIT_NM,
					   A.TNB,
					   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_NM,
					   A.APV_DOC_NO,
					   A.HNDL_STEP,
					   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000881' AND CD = A.HNDL_STEP) AS HNDL_STEP_NM,
					   A.COFM_CD
				  FROM TBCSPOEP012M A,
				       TBCSPOEP011M B,
				       TBDCMACM001M C,
				       TBDCMACM002M D
				 WHERE 1=1
				   AND A.LOUNGE_ID = #LOUNGE_ID#
				   AND A.LOUNGE_ID = B.LOUNGE_ID
				   AND A.BOKG_PEN_ID = C.USR_ID
				   AND C.DPT_CD = D.DPT_CD
				   AND BOKG_DT = #YYYYMMDD#  /* 예약일 */
				 ORDER BY  BOKG_APL_DH
		]]>
        
	</select>
	
	
	
	<select id="CSPOEP011EResvApvListSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT A.BOKG_APL_DH,
				       A.LOUNGE_ID,
				   	   B.LOUNGE_NM,
				   	   A.BOKG_PEN_ID AS USR_ID,
					   C.USR_NAM,
					   D.DPT_NM,
					   TO_CHAR(TO_DATE(A.BOKG_DT), 'YYYY-MM-DD') AS BOKG_DT,
					   A.TIT_NM,
					   A.TNB,
					   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_NM,
					   A.APV_DOC_NO,
					   A.HNDL_STEP,
					   A.COFM_CD
				  FROM TBCSPOEP012M A,
				       TBCSPOEP011M B,
				       TBDCMACM001M C,
				       TBDCMACM002M D
				 WHERE 1=1
				   AND A.LOUNGE_ID = B.LOUNGE_ID
				   AND A.BOKG_PEN_ID = C.USR_ID
				   AND C.DPT_CD = D.DPT_CD
		]]>
			
			<isNotEmpty property="strBOKG_APL_DH">
				AND A.BOKG_APL_DH =#strBOKG_APL_DH# 
			</isNotEmpty>
			
			<isNotEmpty property="strLOUNGE_ID">
				AND A.LOUNGE_ID =#strLOUNGE_ID# 
			</isNotEmpty>
			 
			<isNotEmpty property="strAPV_DOC_NO">
				AND A.APV_DOC_NO =#strAPV_DOC_NO# 
			</isNotEmpty>   
		<![CDATA[
				 ORDER BY  BOKG_APL_DH
		]]>
        
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	<select id="CSPOEP011EValidate" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(SYSDATE, 'YYYYMMDDHH24MI') AS VALIDATION
			  FROM DUAL
		]]>
	</select>
	
	
	<select id="CSPOEP011ESelectMaxDay" parameterClass="String"	resultClass="resultMap">
		<![CDATA[
		SELECT MAX(TOTALDAY) AS MAX_DAY FROM (
		SELECT 
			CC.TOTALDAY			
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#SELECTED_DAY#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#SELECTED_DAY#) + 14,'YYYYMMDD')
					)
			)CC )
		]]>
        
	</select>	

	<select id="CSPOEP006EAllDaySelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
		SELECT 
			CC.YYYYMMDD
			,CC.TOTALDAY
			,(CASE WHEN CC.TOTALDAY = (SELECT YE || MD FROM TBBADDED013B WHERE YE || MD = CC.TOTALDAY) THEN '1' ELSE '0' END) HOLIDAY
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#BOKG_DT#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#RESERVE_END_DAY#),'YYYYMMDD')
					)
			)CC
		]]>
        
	</select>	


	<select id="CSPOEP011EAllDaySelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
		SELECT 
			CC.YYYYMMDD
			,CC.TOTALDAY
			,(CASE WHEN CC.TOTALDAY = (SELECT YE || MD FROM TBBADDED013B WHERE YE || MD = CC.TOTALDAY) THEN '1' ELSE '0' END) HOLIDAY
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#BOKG_DT#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#RESERVE_END_DAY#),'YYYYMMDD')
					)
			)CC
		]]>
        
	</select>	

	<insert id="CSPOEP011EResvInsert" parameterClass="paramMap">
        <![CDATA[       
				INSERT INTO TBCSPOEP012M
				(BOKG_APL_DH, 
				 LOUNGE_ID, 
				 BOKG_PEN_ID, TNB, 
				 BOKG_DT, 
				 TIT_NM, 
				 FRT_REGI_DH,
				 FRT_USR_ID,
				 FNL_USR_ID,
				 FNL_DEAL_DPT_CD,
				 FNL_MNU_ID,
				 FNL_MDF_DH )
				VALUES
				(
				(SELECT 'RE'|| TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHHMMSSFF4') FROM DUAL),
				 #LOUNGE_ID#, 
				 #FRT_USR_ID#, #TNB#, 
				 #BOKG_DT#, 
				 #TIT_NM#,
				 SYSDATE,
				 #FRT_USR_ID#,
				 #FNL_USR_ID#,
				 #FNL_DEAL_DPT_CD#,
				 #FNL_MNU_ID#,
				 SYSDATE
				)
        ]]>
	</insert>

	<!-- 결재처리정보를 수정한다 -->
	<update id="CSPOEP011EApvInfoupdate" parameterClass="paramMap">
           UPDATE TBCSPOEP012M  
              SET APV_DOC_NO   = #APV_DOC_NO#,		/* 결재문서번호 */
                  HNDL_STEP    = #APV_STA_CD#
                <isNotEmpty property="COFM_CD">
				,COFM_CD      = #COFM_CD#
				</isNotEmpty>
			 
           WHERE  
              BOKG_APL_DH      = #BOKG_APL_DH#	
              AND LOUNGE_ID    = #LOUNGE_ID#
	</update>
	<select id="CSPOEP011EUpdateSelect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[
        	SELECT	A.BOKG_APL_DH, 
        			A.LOUNGE_ID,  			
        			A.BOKG_DT	 
        	FROM	TBCSPOEP012M A 
        	WHERE 1=1 
        	 	AND A.APV_DOC_NO = #APV_DOC_NO#
		]]>
	</select>	
	<select id="CSPOEP011ESendCnbSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT USR_DFN_TXT_1 AS CNB
			  FROM TBDCMACM013C
			 WHERE 1=1
			   AND CMM_CD_DVSN_CD = '1000916'
               AND CD = '10'
		]]>
	</select>
	
	<insert id="CSPOEP011EMsgInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO
			TBDCMACM026L
			(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
	        , MSG_TP_YN
	        , MSG_TXT_2
	        , RCNT_CNT
	        , RCNT_HIS
	        , MSG_REGI_DH
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
			)
			VALUES
			(
			  (SELECT NVL(MAX(MSG_SNO),0)+1 FROM TBDCMACM026L)
			, 'SP'
			, 'BO'
			, #FNL_USR_ID#
	        , '0'
	        , #MSG_TXT#
	        , 1
	        , #APL_CNB#
	        , SYSDATE
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
			);
			
		]]>
	</insert>
	






























	<select id="CSPOEP003EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT A.LOUNGE_ID,
			       A.LOUNGE_SRCH_SEQ,
			       A.CFR_RM_INSPC_RNM,
			       TO_CHAR(NVL(A.RCV_NOP_CNT,0) ) || '명' AS RCV_NOP_CNT,
			       A.DES_TXT,
			       A.MNG_DPT_CD,
			       B.DPT_NM,
			       ( SELECT USR_NAM FROM TBDCMACM001M WHERE USR_ID = ADM_ID_1) AS NAM1,
			       DECODE(A.ADM_TNB_1, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1), A.ADM_TNB_1) AS TNB1,
			       ( SELECT USR_NAM FROM TBDCMACM001M WHERE USR_ID = ADM_ID_2) AS NAM2,
			       DECODE(A.ADM_TNB_2, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2), A.ADM_TNB_2) AS TNB2
			  FROM TBCSPOEP011M A, 
			       TBDCMACM002M B
			 WHERE 1=1
			   AND A.MNG_DPT_CD = B.DPT_CD(+)
               AND A.CFR_RM_INSPC_RM_DVSN_CD IN ('1','2')
			  ORDER BY A.LOUNGE_SRCH_SEQ
		]]>
	</select>
	
	<select id="CSPOEP003EDeleteCheck" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT COUNT(BOKG_APL_DH) AS CNT
			  FROM TBCSPOEP012M 
			 WHERE BOKG_DT >= (SELECT TO_CHAR(SYSDATE, 'YYYYMMDD') FROM DUAL)
			   AND LOUNGE_ID = #LOUNGE_ID# 
		]]>
	</select>
	
	<delete id="CSPOEP003EDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE TBCSPOEP011M
			 WHERE 1 = 1
			   AND LOUNGE_ID = #LOUNGE_ID#
		]]>
	</delete>
	
	<delete id="CSPOEP003E002Delete" parameterClass="paramMap">
		<![CDATA[
			DELETE TBCSPOEP012M
			 WHERE 1 = 1
			   AND LOUNGE_ID = #LOUNGE_ID#
		]]>
	</delete>
	
	<update id="CSPOEP003EUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPOEP011M
			   SET LOUNGE_SRCH_SEQ = #LOUNGE_SRCH_SEQ#,
			  	   CFR_RM_INSPC_RNM = #CFR_RM_INSPC_RNM#,
			       FNL_USR_ID = #FNL_USR_ID#,
			       FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			       FNL_MNU_ID = #FNL_MNU_ID#,
			       FNL_MDF_DH = SYSDATE
			 WHERE 1 = 1
			   AND LOUNGE_ID = #LOUNGE_ID#
		]]>
	</update>
	
	

	
	
	
	
	
		<select id="CSPOEP011EMainHeaderSelect2" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
		SELECT 
			CC.YYYYMMDD
			,CC.TOTALDAY
			,(CASE WHEN CC.TOTALDAY = (SELECT YE || MD FROM TBBADDED013B WHERE YE || MD = CC.TOTALDAY) THEN '1' ELSE '0' END) HOLIDAY
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#SELECTED_DAY#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#SELECTED_DAY#) +14,'YYYYMMDD')
					)
			)CC
		]]>
        
	</select>
	
	
	
	
	

	
	<select id="CSPOEP002EinitSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT CD, CD_NM 
				  FROM
				      (select * from TBDCMACM013C where CMM_CD_DVSN_CD ='1000291' AND CD IN ('1', '2') )
				 ORDER BY CD
				 
		]]>
        
	</select>
	
	
	<select id="CSPOEP002EMainListSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT A.BOKG_APL_DH,
				       A.LOUNGE_ID,
				   	   B.CFR_RM_INSPC_RNM,
					   C.USR_NAM,
					   D.DPT_NM,
					   TO_CHAR(TO_DATE(A.BOKG_DT), 'YYYY-MM-DD') AS BOKG_DT,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') AS STR_HM,
					   TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS END_HM,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS HM,
					   TO_CHAR(TO_DATE(A.BOKG_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') || '  ' ||TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS YYYYMMDDHHMI,
					   A.TIT_NM,
					   A.DES_TXT,
					   A.RQS_SBJ_TXT,
					   A.TNB,
				   	   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_CD_NM,
				  	   (SELECT CD FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_CD
				  FROM TBCSPOEP012M A,
				       TBCSPOEP011M B,
				       TBDCMACM001M C,
				       TBDCMACM002M D
				 WHERE 1=1
				   AND A.LOUNGE_ID = B.LOUNGE_ID
				   AND A.BOKG_PEN_ID = C.USR_ID
				   AND C.DPT_CD = D.DPT_CD
				   AND B.CFR_RM_INSPC_RM_DVSN_CD IN ('1','2')
		]]>
			<dynamic>
				<isNotEmpty property="cbbDvsn">
			   		AND B.CFR_RM_INSPC_RM_DVSN_CD =#cbbDvsn# /*회의실조사실 구분*/
				</isNotEmpty>
			</dynamic>  		   
			<dynamic>
				<isNotEmpty property="rdbState">
			   		 AND A.COFM_CD = #rdbState# 	/* 상태값*/
				</isNotEmpty>
			</dynamic>  		   
			<dynamic>
				<isNotEmpty property="fromYmd">
			   		  AND A.BOKG_DT &gt;= #fromYmd#  
				</isNotEmpty>
			</dynamic>  		   
			<dynamic>
				<isNotEmpty property="toYmd">
			   		  AND A.BOKG_DT &lt;= #toYmd#  
				</isNotEmpty>			
			</dynamic>
		<![CDATA[
				 ORDER BY  BOKG_DT
		]]>
        
	</select>
	
	<delete id="CSPOEP002EDelete" parameterClass="paramMap">
			DELETE FROM TBCSPOEP012M
			 WHERE 1 = 1
			   AND LOUNGE_ID = #LOUNGE_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</delete>

	<update id="CSPOEP002EApproveUpdate" parameterClass="paramMap">
		UPDATE TBCSPOEP012M 
			   SET COFM_CD = '1',
				   FNL_USR_ID = #FNL_USR_ID#,
			       FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			       FNL_MNU_ID = #FNL_MNU_ID#,
			       FNL_MDF_DH = SYSDATE
			 WHERE 1=1
			   AND LOUNGE_ID = #LOUNGE_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>

	<update id="CSPOEP002ERejectUpdate" parameterClass="paramMap">
			UPDATE TBCSPOEP012M 
			   SET COFM_CD = '3',
			       FNL_USR_ID = #FNL_USR_ID#,
			       FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			       FNL_MNU_ID = #FNL_MNU_ID#,
			       FNL_MDF_DH = SYSDATE
			 WHERE 1=1
			   AND LOUNGE_ID = #LOUNGE_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>
	
	<insert id="CSPOEP004PInsert" parameterClass="paramMap">
        <![CDATA[       
				INSERT INTO TBCSPOEP011M
				(
				LOUNGE_ID,
				CFR_RM_INSPC_RM_DVSN_CD,
				CFR_RM_INSPC_RNM,
				LOUNGE_SRCH_SEQ,
				RCV_NOP_CNT,
				DES_TXT,
				MNG_DPT_CD,
				ADM_ID_1,
				ADM_TNB_1,
				ADM_ID_2,
				ADM_TNB_2,
				DOC_ID,
				DOC_TYP_CD,
				USE_YN,
				FRT_USR_ID,
				FNL_USR_ID,
				FNL_DEAL_DPT_CD,
				FNL_MNU_ID,
				FRT_REGI_DH,
				FNL_MDF_DH
				)
				VALUES
				(
				 #LOUNGE_ID#,
				 #CFR_RM_INSPC_RM_DVSN_CD#,
				 #CFR_RM_INSPC_RNM#,
				 (SELECT NVL(MAX(LOUNGE_SRCH_SEQ), 0) + 1 FROM TBCSPOEP011M),
				 #RCV_NOP_CNT#,
				 #DES_TXT#,
				 #MNG_DPT_CD#,
				 #ADM_ID_1#,
				 #ADM_TNB_1#,
				 #ADM_ID_2#,
				 #ADM_TNB_2#,
				 #DOC_ID#,
				 #DOC_TYP_CD#,
				 'Y',
				 #FRT_USR_ID#,
				 #FNL_USR_ID#,
				 #FNL_DEAL_DPT_CD#,
				 #FNL_MNU_ID#,
				 SYSDATE,
				 SYSDATE
				 )
        ]]>
	</insert>
	
	
	<select id="CSPOEP004PSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT  A.LOUNGE_ID, 
						A.CFR_RM_INSPC_RM_DVSN_CD, 
						A.CFR_RM_INSPC_RNM, 
						A.LOUNGE_SRCH_SEQ, 
						A.RCV_NOP_CNT, 
						A.DES_TXT, 
						A.MNG_DPT_CD,
						(SELECT  DPT_NM FROM TBDCMACM002M WHERE DPT_CD = A.MNG_DPT_CD) AS MNG_DPT_NM, 
						A.ADM_ID_1,
						(SELECT USR_NAM FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1) AS ADM_NAM1,
						(SELECT CNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1) AS ADM_CNB1,
						DECODE(A.ADM_TNB_1, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1), A.ADM_TNB_1) AS ADM_TNB_1,
						A.ADM_ID_2, 
						(SELECT USR_NAM FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2) AS ADM_NAM2,
						(SELECT CNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2) AS ADM_CNB2,
						DECODE(A.ADM_TNB_2, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2), A.ADM_TNB_2) AS ADM_TNB_2,
						A.DOC_ID, 
						A.DOC_TYP_CD, 
						A.USE_YN, 
						A.FRT_USR_ID, 
						A.FNL_USR_ID, 
						A.FNL_DEAL_DPT_CD, 
						A.FNL_MNU_ID, 
						A.FRT_REGI_DH, 
						A.FNL_MDF_DH
				   FROM TBCSPOEP011M A
				  WHERE LOUNGE_ID = #LOUNGE_ID#
		]]>
	</select>
	
	<update id="CSPOEP004PUpdate" parameterClass="paramMap">
		UPDATE TBCSPOEP011M 
		   SET CFR_RM_INSPC_RM_DVSN_CD = #CFR_RM_INSPC_RM_DVSN_CD#
		       ,CFR_RM_INSPC_RNM      = #CFR_RM_INSPC_RNM#
		       ,RCV_NOP_CNT   = #RCV_NOP_CNT#
		       ,DES_TXT   = #DES_TXT#
		       ,MNG_DPT_CD   = #MNG_DPT_CD#
		       ,ADM_ID_1  = #ADM_ID_1#
		       ,ADM_TNB_1 = #ADM_TNB_1# 
		       ,ADM_ID_2 = #ADM_ID_2#
		       ,ADM_TNB_2 = #ADM_TNB_2#
			   ,DOC_ID = #DOC_ID# 
			   ,DOC_TYP_CD = #DOC_TYP_CD#
		       ,FNL_USR_ID = #FNL_USR_ID#
		       ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		       ,FNL_MNU_ID = #FNL_MNU_ID#
		       ,FNL_MDF_DH = SYSDATE
		 WHERE 1=1
		   AND LOUNGE_ID = #LOUNGE_ID#
	</update>
	
	<select id="CSPOEP003SelectId" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT  A.DOC_ID
				   FROM TBCSPOEP011M A
				  WHERE LOUNGE_ID = #LOUNGE_ID#
		]]>
	</select>
	
	<select id="CSPOEP004PSelectInit" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT 'RS'|| TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHHMMSSFF4') AS LOUNGE_ID FROM DUAL
		]]>
	</select>
	
	<insert id="CSPOEP002EMsg206Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO
			TBDCMACM026L
			(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
	        , MSG_TP_YN
	  
	        , MSG_TXT_2
	        , RCNT_CNT
	        , RCNT_HIS
	        , MSG_REGI_DH
	
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
	
			)
			VALUES
			(
			  (SELECT NVL(MAX(MSG_SNO),0)+1 FROM TBDCMACM026L)
			, 'SP'
			, 'MR'
			, #FNL_USR_ID#
	        , '0'
	     
	        , #MSG#
	        , 1
	        , #MSG_CNB#
	        , SYSDATE
	        
	        
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
	
			);
			
		]]>
	</insert>
	
	<select id="CSPOEP002ESelectCnb" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT B.CNB
			  FROM TBCSPOEP012M A,
			  	   TBDCMACM001M B
			 WHERE A.BOKG_APL_DH = #BOKG_APL_DH#
			   AND A.LOUNGE_ID = #LOUNGE_ID#
			   AND A.BOKG_PEN_ID = B.USR_ID  
		]]>
	</select>
	
	<select id="CSPOEP002EExcelExportSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	B.CFR_RM_INSPC_RNM,
					D.DPT_NM,
					COUNT(*) AS CNT
			FROM	TBCSPOEP012M A,
					TBCSPOEP011M B,
					TBDCMACM001M C,
					TBDCMACM002M D
			WHERE	1=1
			AND		A.LOUNGE_ID = B.LOUNGE_ID
			AND		A.BOKG_PEN_ID = C.USR_ID
			AND		C.DPT_CD = D.DPT_CD
			AND		A.COFM_CD = '1'
            AND     B.CFR_RM_INSPC_RM_DVSN_CD IN ('1','2')
			AND		A.BOKG_DT BETWEEN #fromYmd# AND #toYmd#
			GROUP BY B.CFR_RM_INSPC_RNM, D.DPT_NM
			ORDER BY B.CFR_RM_INSPC_RNM, D.DPT_NM
		]]>
	</select>
	
	<select id="CSPOEP006EinitSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT YYYY AS CD, 
				       YYYY AS CDNM 
				  FROM (
				        SELECT TO_CHAR(SYSDATE,'YYYY') - LEVEL + 2 YYYY 
				          FROM DUAL 
				        CONNECT BY TO_CHAR(SYSDATE,'YYYY') - LEVEL + 2 >= 1980
				       )
		]]>
        
	</select>

	
	<select id="CSPOEP006EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[   	
SELECT C.LOUNGE_ID
     , C.LOUNGE_SRCH_SEQ
     , C.CFR_RM_INSPC_RNM
     , C.CFR_RM_INSPC_RM_DVSN_CD
     , (CASE WHEN C.DAY1_TIME >='900' THEN '●' || TO_CHAR(DAY1_COUNT) WHEN  C.DAY1_TIME < '900' THEN '△' || TO_CHAR(DAY1_COUNT)   ELSE CASE WHEN DAY1_COUNT > 0 THEN TO_CHAR(DAY1_COUNT) ELSE '' END END) DAY1 
     , (CASE WHEN C.DAY2_TIME >= '900' THEN '●' || TO_CHAR(DAY2_COUNT) WHEN  C.DAY2_TIME < '900' THEN '△' || TO_CHAR(DAY2_COUNT)   ELSE CASE WHEN DAY2_COUNT > 0 THEN TO_CHAR(DAY2_COUNT) ELSE '' END END) DAY2 
     , (CASE WHEN C.DAY3_TIME >= '900' THEN '●' || TO_CHAR(DAY3_COUNT) WHEN  C.DAY3_TIME < '900' THEN '△' || TO_CHAR(DAY3_COUNT)   ELSE CASE WHEN DAY3_COUNT > 0 THEN TO_CHAR(DAY3_COUNT) ELSE '' END END) DAY3
     , (CASE WHEN C.DAY4_TIME >= '900' THEN '●' || TO_CHAR(DAY4_COUNT) WHEN  C.DAY4_TIME < '900' THEN '△' || TO_CHAR(DAY4_COUNT)   ELSE CASE WHEN DAY4_COUNT > 0 THEN TO_CHAR(DAY4_COUNT) ELSE '' END END) DAY4
     , (CASE WHEN C.DAY5_TIME >= '900' THEN '●' || TO_CHAR(DAY5_COUNT) WHEN  C.DAY5_TIME < '900' THEN '△' || TO_CHAR(DAY5_COUNT)   ELSE CASE WHEN DAY5_COUNT > 0 THEN TO_CHAR(DAY5_COUNT) ELSE '' END END) DAY5 
     , (CASE WHEN C.DAY6_TIME >= '900' THEN '●' || TO_CHAR(DAY6_COUNT) WHEN  C.DAY6_TIME < '900' THEN '△' || TO_CHAR(DAY6_COUNT)   ELSE CASE WHEN DAY6_COUNT > 0 THEN TO_CHAR(DAY6_COUNT) ELSE '' END END) DAY6 
     , (CASE WHEN C.DAY7_TIME >= '900' THEN '●' || TO_CHAR(DAY7_COUNT) WHEN  C.DAY7_TIME < '900' THEN '△' || TO_CHAR(DAY7_COUNT)   ELSE CASE WHEN DAY7_COUNT > 0 THEN TO_CHAR(DAY7_COUNT) ELSE '' END END) DAY7 
     , (CASE WHEN C.DAY8_TIME >= '900' THEN '●' || TO_CHAR(DAY8_COUNT) WHEN  C.DAY8_TIME < '900' THEN '△' || TO_CHAR(DAY8_COUNT)   ELSE CASE WHEN DAY8_COUNT > 0 THEN TO_CHAR(DAY8_COUNT) ELSE '' END END) DAY8 
     , (CASE WHEN C.DAY9_TIME >= '900' THEN '●' || TO_CHAR(DAY9_COUNT) WHEN  C.DAY9_TIME < '900' THEN '△' || TO_CHAR(DAY9_COUNT)   ELSE CASE WHEN DAY9_COUNT > 0 THEN TO_CHAR(DAY9_COUNT) ELSE '' END END) DAY9 
     , (CASE WHEN C.DAY10_TIME >= '900' THEN '●' || TO_CHAR(DAY10_COUNT) WHEN  C.DAY10_TIME < '900' THEN '△'|| TO_CHAR(DAY10_COUNT)   ELSE CASE WHEN DAY10_COUNT > 0 THEN TO_CHAR(DAY10_COUNT) ELSE '' END END) DAY10 
     , (CASE WHEN C.DAY11_TIME >= '900' THEN '●' || TO_CHAR(DAY11_COUNT) WHEN  C.DAY11_TIME < '900' THEN '△'|| TO_CHAR(DAY11_COUNT)   ELSE CASE WHEN DAY11_COUNT > 0 THEN TO_CHAR(DAY11_COUNT) ELSE '' END END) DAY11 
     , (CASE WHEN C.DAY12_TIME >= '900' THEN '●' || TO_CHAR(DAY12_COUNT) WHEN  C.DAY12_TIME < '900' THEN '△'|| TO_CHAR(DAY12_COUNT)   ELSE CASE WHEN DAY12_COUNT > 0 THEN TO_CHAR(DAY12_COUNT) ELSE '' END END) DAY12 
     , (CASE WHEN C.DAY13_TIME >= '900' THEN '●' || TO_CHAR(DAY13_COUNT) WHEN  C.DAY13_TIME < '900' THEN '△'|| TO_CHAR(DAY13_COUNT)   ELSE CASE WHEN DAY13_COUNT > 0 THEN TO_CHAR(DAY13_COUNT) ELSE '' END END) DAY13 
     , (CASE WHEN C.DAY14_TIME >= '900' THEN '●' || TO_CHAR(DAY14_COUNT) WHEN  C.DAY14_TIME < '900' THEN '△'|| TO_CHAR(DAY14_COUNT)   ELSE CASE WHEN DAY14_COUNT > 0 THEN TO_CHAR(DAY14_COUNT) ELSE '' END END) DAY14 
	 
	 
	 , C.DAY1_1    
     , C.DAY2_1      
     , C.DAY3_1        
     , C.DAY4_1    
     , C.DAY5_1
     , C.DAY6_1
     , C.DAY7_1  
     , C.DAY8_1     
     , C.DAY9_1    
     , C.DAY10_1    
     , C.DAY11_1     
     , C.DAY12_1    
     , C.DAY13_1     
     , C.DAY14_1 
	 , C.RESERVE_USER_ID 
     
  FROM
(               SELECT   A.LOUNGE_ID
			            ,A.LOUNGE_SRCH_SEQ
					    ,A.CFR_RM_INSPC_RNM
					    ,A.CFR_RM_INSPC_RM_DVSN_CD
					    ,B.RESERVE_USER_ID
					    ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT=#SELECTED_DAY# 
                            AND (STR_HM >= '0900' OR END_HM >= '1800') AND LOUNGE_ID = A.LOUNGE_ID ) DAY1_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT=#SELECTED_DAY# 
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY1_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#),'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND LOUNGE_ID = A.LOUNGE_ID ) DAY1_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +1,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY2_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +1,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY2_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +1,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND LOUNGE_ID = A.LOUNGE_ID  ) DAY2_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +2,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY3_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +2,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY3_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +2,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID ) DAY3_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +3,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A. LOUNGE_ID ) DAY4_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +3,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY4_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +3,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND LOUNGE_ID = A.LOUNGE_ID  ) DAY4_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +4,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY5_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +4,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY5_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +4,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND LOUNGE_ID = A.LOUNGE_ID  ) DAY5_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +5,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY6_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +5,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY6_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +5,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND LOUNGE_ID = A.LOUNGE_ID  ) DAY6_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +6,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY7_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +6,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY7_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +6,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID ) DAY7_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +7,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY8_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +7,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY8_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +7,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID ) DAY8_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +8,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY9_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +8,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY9_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +8,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID ) DAY9_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +9,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY10_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +9,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY10_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +9,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND LOUNGE_ID = A.LOUNGE_ID  ) DAY10_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +10,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY11_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +10,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY11_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +10,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND LOUNGE_ID = A.LOUNGE_ID  ) DAY11_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +11,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY12_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +11,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY12_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +11,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND LOUNGE_ID = A.LOUNGE_ID  ) DAY12_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +12,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY13_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +12,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY13_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +12,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND LOUNGE_ID = A.LOUNGE_ID  ) DAY13_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND LOUNGE_ID = A.LOUNGE_ID ) DAY14_TIME 
					    ,(SELECT COUNT(*) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD')
                            AND LOUNGE_ID = A.LOUNGE_ID ) DAY14_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPOEP012M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID#  AND LOUNGE_ID = A.LOUNGE_ID ) DAY14_1
					    
			  FROM     TBCSPOEP011M A	/*회의실/조사실 관리 기본*/
				      ,TBCSPOEP012M B	/*회의실/조사실 예약 기본*/
			 WHERE   A.LOUNGE_ID = B.LOUNGE_ID(+) AND  A.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') AND B.RESERVE_USER_ID(+) =  #USER_ID#
		]]>
			<dynamic>
				<isNotEmpty property="DVSN_CD">
			   AND  A.CFR_RM_INSPC_RM_DVSN_CD = #DVSN_CD#
				</isNotEmpty>
			</dynamic>
		<![CDATA[  
			 GROUP BY A.LOUNGE_ID ,A.LOUNGE_SRCH_SEQ ,A.CFR_RM_INSPC_RNM,B.RESERVE_USER_ID ,A.CFR_RM_INSPC_RM_DVSN_CD
             ORDER BY A.CFR_RM_INSPC_RM_DVSN_CD, A.LOUNGE_SRCH_SEQ
) C
 		]]>
        
	</select>
	

		<select id="CSPOEP006EMainHeaderSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
		SELECT 
			CC.YYYYMMDD
			,CC.TOTALDAY
			,(CASE WHEN CC.TOTALDAY = (SELECT YE || MD FROM TBBADDED013B WHERE YE || MD = CC.TOTALDAY) THEN '1' ELSE '0' END) HOLIDAY
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#SELECTED_DAY#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD')
					)
			)CC
		]]>
        
	</select>	



	<select id="CSPOEP006EResvSubListSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT A.BOKG_APL_DH,
				       A.LOUNGE_ID,
				   	   B.CFR_RM_INSPC_RNM,
				   	   A.BOKG_PEN_ID AS USR_ID,
					   C.USR_NAM,
					   D.DPT_NM,
					   TO_CHAR(TO_DATE(A.BOKG_DT), 'YYYY-MM-DD') AS BOKG_DT,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24MI') AS STR_HM,
					   TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24MI') AS END_HM,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS HM,
					   A.TIT_NM,
					   A.DES_TXT,
					   A.RQS_SBJ_TXT,
					   A.TNB,
					   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_NM,
					   A.COFM_CD,					   
					   (SELECT USR_NAM FROM TBDCMACM001M  WHERE USR_ID = A.RESERVE_USER_ID) AS RESERVE_NM,
					   (SELECT CNB FROM TBDCMACM001M  WHERE USR_ID = A.RESERVE_USER_ID) AS RESERVE_CNB,
					   TO_CHAR(A.CHECKIN_DH,'HH24:MI') || ' ~ ' || TO_CHAR(A.CHECKOUT_DH,'HH24:MI') AS USING_HM,
					   A.USER_IP
				  FROM TBCSPOEP012M A,
				       TBCSPOEP011M B,
				       TBDCMACM001M C,
				       TBDCMACM002M D
				 WHERE 1=1
				   AND A.LOUNGE_ID = #LOUNGE_ID#
				   AND A.LOUNGE_ID = B.LOUNGE_ID
				   AND A.BOKG_PEN_ID = C.USR_ID
				   AND C.DPT_CD = D.DPT_CD
				   AND BOKG_DT = #YYYYMMDD#  /* 예약일 */
				 ORDER BY  BOKG_APL_DH
		]]>
        
	</select>
	
	<select id="CSPOEP006EValidate" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(SYSDATE, 'YYYYMMDDHH24MI') AS VALIDATION
			  FROM DUAL
		]]>
	</select>
	
	<select id="CSPOEP006EValidate2" parameterClass="String"	resultClass="resultMap">
		<![CDATA[
			SELECT   TO_CHAR(TO_DATE(SYSDATE) + #valDayCnt#,'YYYYMMDD') AS VALIDATION
			  FROM DUAL
		]]>
	</select>
	<select id="CSPOEP006EValidate3" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
		SELECT COUNT(*) AS VALIDATION 
		FROM TBCSPOEP012M B ,
			( SELECT LOUNGE_ID,BOKG_DT,RESERVE_USER_ID 
				FROM TBCSPOEP012M A
			  WHERE BOKG_DT=#RESERVE_DAY#
			  AND RESERVE_USER_ID=#USER_ID# 
			  GROUP BY LOUNGE_ID, BOKG_DT, RESERVE_USER_ID ) A
        WHERE  B.BOKG_DT=A.BOKG_DT 
        AND B.RESERVE_USER_ID= A.RESERVE_USER_ID
        AND A.LOUNGE_ID <> #LOUNGE_ID# 
		]]>
		
	</select>
	<update id="CSPOEP006EUpdate" parameterClass="paramMap">
		UPDATE TBCSPOEP012M 
		   SET FNL_USR_ID = #FNL_USR_ID#
		    <isNotNull prepend="," property="FNL_DEAL_DPT_CD">
		       FNL_DEAL_DPT_CD      = #FNL_DEAL_DPT_CD#
		    </isNotNull>
		    <isNotNull prepend="," property="FNL_MNU_ID">
		       FNL_MNU_ID      = #FNL_MNU_ID#
		    </isNotNull>
			<isNotNull prepend="," property="STR_HM">
		       STR_HM   = #STR_HM#
		    </isNotNull>
			<isNotNull prepend="," property="END_HM">
		       END_HM   = #END_HM#
		    </isNotNull>
			<isNotNull prepend="," property="TIT_NM">
		       TIT_NM   = #TIT_NM#
		    </isNotNull>
			<isNotNull prepend="," property="DES_TXT">
		       DES_TXT  = #DES_TXT#
		    </isNotNull>
			<isNotNull prepend="," property="RQS_SBJ_TXT">
		       RQS_SBJ_TXT = #RQS_SBJ_TXT#
		    </isNotNull>
			<isNotNull prepend="," property="RESERVE_CNB">
		       RESERVE_USER_ID = (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = #RESERVE_CNB#)
		    </isNotNull>
		       ,FNL_MDF_DH      = SYSDATE
		       ,TNB      = (SELECT HOM_TNB FROM TBDCMACM001M WHERE CNB = #RESERVE_CNB#)
		 WHERE 1=1
		   AND LOUNGE_ID = #LOUNGE_ID#
		   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>
	
	<delete id="CSPOEP006EDelete" parameterClass="paramMap">
			DELETE FROM TBCSPOEP012M
			 WHERE 1 = 1
			   AND LOUNGE_ID = #LOUNGE_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</delete>
	
	
	
	<select id="CSPOEP006EResvDuplicationCheckSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
				SELECT COUNT(*) AS CNT
				  FROM
				       (SELECT LOUNGE_ID FROM TBCSPOEP012M 
						 WHERE 1=1
						   AND LOUNGE_ID = #LOUNGE_ID#
						   AND BOKG_DT = REPLACE(#BOKG_DT#, '-', '')
						   AND COFM_CD = '1'
				   		   AND (
		       					(STR_HM > #STR_HM# AND STR_HM < #END_HM#) OR 
		       					(STR_HM <= #STR_HM# AND END_HM >= #END_HM#) OR
		       					(END_HM > #STR_HM# AND END_HM < #END_HM#) OR 
		       					(STR_HM = #STR_HM# AND END_HM = #END_HM#)
		       				   )
						)A
		]]>
	</select>
	
	<select id="CSPOEP008EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT A.LOUNGE_ID,
			       A.LOUNGE_SRCH_SEQ,
			       SUBSTR(A.CFR_RM_INSPC_RNM,0,2) AS OFFICE_NM,
			       A.CFR_RM_INSPC_RNM,
			       TO_CHAR(NVL(A.RCV_NOP_CNT,0) ) || '명' AS RCV_NOP_CNT,
			       A.DES_TXT,
			       A.MNG_DPT_CD,
			       B.DPT_NM,
			       ( SELECT USR_NAM FROM TBDCMACM001M WHERE USR_ID = ADM_ID_1) AS NAM1,
			       DECODE(A.ADM_TNB_1, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1), A.ADM_TNB_1) AS TNB1,
			       ( SELECT USR_NAM FROM TBDCMACM001M WHERE USR_ID = ADM_ID_2) AS NAM2,
			       DECODE(A.ADM_TNB_2, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2), A.ADM_TNB_2) AS TNB2
			  FROM TBCSPOEP011M A, 
			       TBDCMACM002M B
			 WHERE 1=1
			   AND A.MNG_DPT_CD = B.DPT_CD(+)
               AND A.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2')
			  ORDER BY A.CFR_RM_INSPC_RM_DVSN_CD,A.LOUNGE_SRCH_SEQ
		]]>
	</select>
	
	
	<select id="CSPOEP007EExcelExportSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  
		SELECT   A.BOKG_DT,
		 		 B.CFR_RM_INSPC_RNM,
		 		    (SELECT   COUNT(BOKG_DT)      FROM          
                        TBCSPOEP012M T1, TBCSPOEP011M T2
							WHERE	1=1
							AND		T1.LOUNGE_ID = T2.LOUNGE_ID 
				            AND     T2.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') AND T1.BOKG_DT= A.BOKG_DT) AS RESERV_CNT, /*예약자수*/
				     (SELECT   COUNT(BOKG_DT)      FROM          
                        TBCSPOEP012M T1, TBCSPOEP011M T2
							WHERE	1=1
							AND		T1.LOUNGE_ID = T2.LOUNGE_ID 
				            AND     T2.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') AND T1.BOKG_DT= A.BOKG_DT AND T1.CHECKIN_DH IS NOT NULL) AS USE_CNT, /*이용자수*/
            
					D.DPT_NM,                   
			        F_CODE_NM('1000173', C.RANK_CD) AS RANK_NAM,
					C.USR_NAM,
                    A.TIT_NM,
                    (CASE WHEN A.CHECKIN_DH  IS NULL THEN '이용 안함'  ELSE '' END) CHECKIN_DH 
			FROM	TBCSPOEP012M A,
					TBCSPOEP011M B,
					TBDCMACM001M C,
					TBDCMACM002M D
			WHERE	1=1
			AND		A.LOUNGE_ID = B.LOUNGE_ID
			AND		A.RESERVE_USER_ID  = C.USR_ID
			AND		C.DPT_CD = D.DPT_CD
            AND     B.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2')
           ]]> 
            <dynamic>
				<isNotEmpty property="cbbDvsn">
			   		   AND     B.CFR_RM_INSPC_RM_DVSN_CD = #cbbDvsn#
				</isNotEmpty>
			</dynamic>	
		<![CDATA[  
			AND		A.BOKG_DT BETWEEN  #toYmd# AND  #fromYmd#
			GROUP BY A.BOKG_DT, D.DPT_NM, C.USR_NAM, C.RANK_CD,A.TIT_NM,CHECKIN_DH,B.CFR_RM_INSPC_RNM
			ORDER BY A.BOKG_DT, D.DPT_NM
		]]>
	</select>
	
	<select id="CSPOEP007EMainListSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT A.BOKG_APL_DH,
				       A.LOUNGE_ID,
				   	   B.CFR_RM_INSPC_RNM,
					   C.USR_NAM,
					   D.DPT_NM,
					   TO_CHAR(TO_DATE(A.BOKG_DT), 'YYYY-MM-DD') AS BOKG_DT,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') AS STR_HM,
					   TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS END_HM,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS HM,
					   TO_CHAR(TO_DATE(A.BOKG_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') || '  ' ||TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS YYYYMMDDHHMI,
					   A.TIT_NM,
					   A.DES_TXT,
					   A.RQS_SBJ_TXT,
					   A.TNB,
				   	   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_CD_NM,
				  	   (SELECT CD FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_CD,
				  	   TO_CHAR(A.CHECKIN_DH,'HH24:MI') || ' ~ ' || TO_CHAR(A.CHECKOUT_DH,'HH24:MI') AS USING_HM,
					   A.USER_IP
				  FROM TBCSPOEP012M A,
				       TBCSPOEP011M B,
				       TBDCMACM001M C,
				       TBDCMACM002M D
				 WHERE 1=1
				   AND A.LOUNGE_ID = B.LOUNGE_ID
				   AND A.BOKG_PEN_ID = C.USR_ID
				   AND C.DPT_CD = D.DPT_CD
				   AND B.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') /*연락사무소 좌석조회 (회의실 조사실 제외)*/
		]]>
			<dynamic>
				<isNotEmpty property="cbbDvsn">
			   		AND B.CFR_RM_INSPC_RM_DVSN_CD =#cbbDvsn# /*좌석구분 구분*/
				</isNotEmpty>
			</dynamic>
			<dynamic>
				<isNotEmpty property="fromYmd">
			   		  AND A.BOKG_DT &gt;= #fromYmd#  
				</isNotEmpty>
			</dynamic>  		   
			<dynamic>
				<isNotEmpty property="toYmd">
			   		  AND A.BOKG_DT &lt;= #toYmd#  
				</isNotEmpty>
			</dynamic>
		<![CDATA[
				 ORDER BY  BOKG_DT DESC
		]]>
        
	</select>
	
	
	
	<delete id="CSPOEP007EDelete" parameterClass="paramMap">
			DELETE FROM TBCSPOEP012M
			 WHERE 1 = 1
			   AND LOUNGE_ID = #LOUNGE_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</delete>

	<update id="CSPOEP007EApproveUpdate" parameterClass="paramMap">
		UPDATE TBCSPOEP012M 
			   SET COFM_CD = '1',
				   FNL_USR_ID = #FNL_USR_ID#,
			       FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			       FNL_MNU_ID = #FNL_MNU_ID#,
			       FNL_MDF_DH = SYSDATE
			 WHERE 1=1
			   AND LOUNGE_ID = #LOUNGE_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>

	<update id="CSPOEP007ERejectUpdate" parameterClass="paramMap">
			UPDATE TBCSPOEP012M 
			   SET COFM_CD = '3',
			       FNL_USR_ID = #FNL_USR_ID#,
			       FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			       FNL_MNU_ID = #FNL_MNU_ID#,
			       FNL_MDF_DH = SYSDATE
			 WHERE 1=1
			   AND LOUNGE_ID = #LOUNGE_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>
	
	
	
	
	
	
</sqlMap> 
