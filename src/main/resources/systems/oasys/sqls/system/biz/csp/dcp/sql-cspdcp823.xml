<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/823">
	<select id="CSPDCP823PMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.STTM_DVSN_CD
					,A.ACP_YR
   					,A.STTM_ACP_NO
   					,A.ACP_YR||'-청금-'||A.RM_STTM_ACP_NO AS ACP_NO
   					,F_CODE_NM('1000758',A.STTM_KND_CD) AS STTM_KND_NM
   					,F_CODE_NM('1000759',A.STTM_KND_DTL_CD) AS STTM_KND_DTL_NM
   					,A.TIT_NM
   					,A.NAM
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
   					,A.HNDL_STA_CD
   					,A.ACP_RUT_CD
   					,A.TNB
   					,A.RM_STTM_ACP_NO
   			FROM	TBCSPDCP811M A
   					,TBCSPDCP813M B
   			WHERE	1=1
   			AND		A.STTM_DVSN_CD = '1'
   			AND		A.STTM_DVSN_CD = B.STTM_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.STTM_ACP_NO = B.STTM_ACP_NO
   			AND		B.HNDL_DPT_CD = #strDPT_CD#
   			AND		B.HNDL_CHGR_ID = #strUSR_ID#
   			AND		(A.STTM_DVSN_CD, A.ACP_YR, A.STTM_ACP_NO) NOT IN (	SELECT 	STTM_DVSN_CD, ACP_YR, STTM_ACP_NO 
   																		FROM	TBCSPDCP818M S1
   																		WHERE S1.IFM_DVSN_CD = '10'
   																		) 
   			AND		A.HNDL_STA_CD IN ('3','5')
   			AND		(A.STTM_DVSN_CD, A.ACP_YR, A.STTM_ACP_NO) NOT IN (	SELECT	#strSTTM_DVSN_CD#,#strACP_YR#,#strSTTM_ACP_NO#
   																		FROM	DUAL )
   			AND		((A.STTM_DVSN_CD, A.ACP_YR, A.STTM_ACP_NO) NOT IN (	SELECT 	STTM_DVSN_CD, ACP_YR, STTM_ACP_NO 
   																		FROM	TBCSPDCP819L) 
   					AND (A.STTM_DVSN_CD, A.ACP_YR, A.STTM_ACP_NO) NOT IN (	SELECT 	SUC_STTM_DVSN_CD, SUC_ACP_YR, SUC_STTM_ACP_NO 
   																			FROM	TBCSPDCP819L) )
		]]>
	</select>
	
	<select id="CSPDCP823PSucSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	B.STTM_DVSN_CD
					,B.ACP_YR
   					,B.STTM_ACP_NO
   					,A.ACP_YR||'-청금-'||A.RM_STTM_ACP_NO AS ACP_NO
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
   					,A.TIT_NM
   					,A.NAM
   					,B.SUC_STTM_DVSN_CD
   					,B.SUC_ACP_YR
   					,B.SUC_STTM_ACP_NO
   					,A.HNDL_STA_CD
   					,A.ACP_RUT_CD
   					,A.TNB
   					,F_CODE_NM('1000758',A.STTM_KND_CD) AS STTM_KND_NM
   					,F_CODE_NM('1000759',A.STTM_KND_DTL_CD) AS STTM_KND_DTL_NM
   			FROM	TBCSPDCP811M A, TBCSPDCP819L B
   			WHERE	B.STTM_DVSN_CD = #strSTTM_DVSN_CD#
   			AND		B.ACP_YR = #strACP_YR#
   			AND		B.STTM_ACP_NO = #strSTTM_ACP_NO#
   			AND		B.SUC_STTM_DVSN_CD = A.STTM_DVSN_CD
   			AND		B.SUC_ACP_YR = A.ACP_YR
   			AND		B.SUC_STTM_ACP_NO = A.STTM_ACP_NO
   		]]>
   	</select>
   	
   	<insert id="CSPDCP823P819SucInsert" parameterClass="paramMap">
   		<![CDATA[
   			INSERT INTO	TBCSPDCP819L
	   					(	STTM_DVSN_CD
	   						,ACP_YR
	   						,STTM_ACP_NO
	   						,SUC_STTM_DVSN_CD
	   						,SUC_ACP_YR
	   						,SUC_STTM_ACP_NO
	   						,FRT_USR_ID
	       					,FNL_USR_ID
	       					,FNL_DEAL_DPT_CD
	       					,FNL_MNU_ID
	       					,FRT_REGI_DH
	       					,FNL_MDF_DH
	       				)
       			VALUES	(	#STTM_DVSN_CD#
	   						,#ACP_YR#
	   						,#STTM_ACP_NO#
	   						,#SUC_STTM_DVSN_CD#
	   						,#SUC_ACP_YR#
	   						,#SUC_STTM_ACP_NO#
	   						,#FRT_USR_ID#
	       					,#FNL_USR_ID#
	       					,#FNL_DEAL_DPT_CD#
	       					,#FNL_MNU_ID#
	       					,SYSDATE
	       					,SYSDATE
	       				)
   		]]>
   	</insert>
   	
   	<!-- <update id="CSPDCP823P819SucUpdate" parameterClass="paramMap">
   		<![CDATA[
   			UPDATE	TBCSPDCP815L A
   			SET		A.HNDL_DVSN_CD = (SELECT 	Z.HNDL_DVSN_CD 
   										FROM 	TBCSPDCP815L Z 
   										WHERE 	Z.STTM_DVSN_CD = #STTM_DVSN_CD#
   										AND		Z.ACP_YR = #ACP_YR#
   										AND		Z.STTM_ACP_NO = #STTM_ACP_NO#)
   					,A.TRNF_DPT_CD = (SELECT 	Z.TRNF_DPT_CD 
   										FROM 	TBCSPDCP815L Z 
   										WHERE 	Z.STTM_DVSN_CD = #STTM_DVSN_CD#
   										AND		Z.ACP_YR = #ACP_YR#
   										AND		Z.STTM_ACP_NO = #STTM_ACP_NO#)
   					,A.DOC_ID = (SELECT 	Z.DOC_ID 
   										FROM 	TBCSPDCP815L Z 
   										WHERE 	Z.STTM_DVSN_CD = #STTM_DVSN_CD#
   										AND		Z.ACP_YR = #ACP_YR#
   										AND		Z.STTM_ACP_NO = #STTM_ACP_NO#)
   			WHERE	A.STTM_DVSN_CD = #SUC_STTM_DVSN_CD#
   			AND		A.ACP_YR = #SUC_ACP_YR#
   			AND		A.STTM_ACP_NO = #SUC_STTM_ACP_NO#
   		]]>
   	</update> -->
   	
   	<update id="CSPDCP823P819Update" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPDCP811M A
			SET		A.HNDL_STA_CD = '5'
					,A.FNL_USR_ID = #FNL_USR_ID#
   					,A.FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,A.FNL_MNU_ID = #FNL_MNU_ID#
   					,A.FNL_MDF_DH = SYSDATE
			WHERE	A.STTM_DVSN_CD = #SUC_STTM_DVSN_CD#
			AND		A.ACP_YR = #SUC_ACP_YR#
			AND		A.STTM_ACP_NO = #SUC_STTM_ACP_NO#
		]]>
	</update>
	
	<delete id="CSPDCP823P816Delete" parameterClass="paramMap">
		<![CDATA[
			DELETE	/*CSPDCP823P816Delete*/
			FROM	TBCSPDCP816L
			WHERE	STTM_DVSN_CD = #SUC_STTM_DVSN_CD#
			AND		ACP_YR = #SUC_ACP_YR#
			AND		STTM_ACP_NO = #SUC_STTM_ACP_NO#
		]]>
	</delete>

	
	<insert id="CSPDCP823PTBCSPDCP816Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	TBCSPDCP816L
						(	STTM_DVSN_CD
        					,ACP_YR
        					,STTM_ACP_NO
        					,HNDL_ORG_SRNO
        					,SRNO
        					,ORG_CD
        					,PUB_DVSN_CD
        					,COPT_SG_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		SELECT #SUC_STTM_DVSN_CD#
        		      ,#SUC_ACP_YR#
        		      ,#SUC_STTM_ACP_NO#
        		      ,HNDL_ORG_SRNO
   					  ,SRNO
   					  ,ORG_CD
   					  ,PUB_DVSN_CD
   					  ,COPT_SG_CD
   					  ,FRT_USR_ID
   					  ,FNL_USR_ID
   					  ,FNL_DEAL_DPT_CD
   					  ,FNL_MNU_ID
   					  ,FRT_REGI_DH
   					  ,FNL_MDF_DH
        	      FROM TBCSPDCP816L
        	     WHERE (STTM_DVSN_CD,ACP_YR,STTM_ACP_NO) IN (SELECT #STTM_DVSN_CD#,#ACP_YR#,#STTM_ACP_NO# 
        													  FROM DUAL ) 
        						
		]]>
	</insert>
	
	<delete id="CSPDCP823P819SucDelete" parameterClass="paramMap">
	   	<![CDATA[
	   		DELETE	/*CSPDCP823P819SucDelete*/
	   		FROM	TBCSPDCP819L
	   		WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
	   		AND		ACP_YR = #ACP_YR#
	   		AND		STTM_ACP_NO = #STTM_ACP_NO#
	   		AND		SUC_STTM_DVSN_CD = #SUC_STTM_DVSN_CD#
	   		AND		SUC_ACP_YR = #SUC_ACP_YR#
	   		AND		SUC_STTM_ACP_NO = #SUC_STTM_ACP_NO#
	   	]]>
   	</delete>
   	
   	<delete id="CSPDCP823P815Delete" parameterClass="paramMap">
		<![CDATA[
			DELETE	/*CSPDCP823P815Delete*/
			FROM	TBCSPDCP815L
			WHERE	STTM_DVSN_CD = #SUC_STTM_DVSN_CD#
			AND		ACP_YR = #SUC_ACP_YR#
			AND		STTM_ACP_NO = #SUC_STTM_ACP_NO#
		]]>
	</delete>
	
	<insert id="CSPDCP823P815SucInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	/*CSPDCP823P815SucInsert*/
						TBCSPDCP815L
						(	STTM_DVSN_CD
        					,ACP_YR
        					,STTM_ACP_NO
        					,SRNO
        					,HNDL_DVSN_CD
        					,TRNF_DPT_CD
        					,DOC_ID
        					,DOC_TYP_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		SELECT	#SUC_STTM_DVSN_CD#
	        			,#SUC_ACP_YR#
	        			,#SUC_STTM_ACP_NO#
       					,SRNO
       					,HNDL_DVSN_CD
       					,TRNF_DPT_CD
       					,DOC_ID
       					,DOC_TYP_CD
       					,FRT_USR_ID
       					,FNL_USR_ID
       					,FNL_DEAL_DPT_CD
       					,FNL_MNU_ID
       					,SYSDATE
       					,SYSDATE
        		FROM	TBCSPDCP815L
        		WHERE	(STTM_DVSN_CD,ACP_YR,STTM_ACP_NO) IN ( 	SELECT	#STTM_DVSN_CD#,#ACP_YR#,#STTM_ACP_NO# 
        														FROM 	DUAL )
		]]>
	</insert>
	
 </sqlMap> 

