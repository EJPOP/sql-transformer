<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/fpl/001">

	<!-- 질의서목록 조회 -->
	<select id="CSPFPL001WrtQueListSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT D1.QSTNAI_NO         AS QSTNAI_NO			/*질의서번호*/
			     , D1.QSTNAI_YR   AS QSTNAI_YR	/*연도*/
			     , D1.QSTNAI_YR||D1.QSTNAI_NO    AS QSTNAI_YR_NO        /*질의서연번호*/
			     , D1.CMTR_NM   AS CMTR_NM	/*위원명*/
			     , D1.CMT_CD     AS CMT_CD		/*위원회명*/
			     , D1.RQ_DT     AS RQ_DT		/*요구일자*/
			     , D1.SMT_RQ_DT     AS SMT_RQ_DT		/*제출일자*/
			     , D1.NTAS_RQ_MTRL_DVSN_CD     AS MTRL_DVSN_CD		/*자료구분코드*/
			     , D1.RQ_SHP_CD     AS RQ_SHP_CD		/*요구형태코드*/
			     , D1.NTAS_RQ_MTRL_HNDL_STA_CD     AS NTAS_RQ_MTRL_HNDL_STA_CD		/*처리상태코드*/
			     , D1.QSTNAI_TIT_NM     AS QSTNAI_TIT_NM		/*질의서제목*/
			     , D1.SITT_NO     AS SITT_NO		/*회기번호*/
			     , D1.NTAS_SMT_DDLN_DT     AS NTAS_SMT_DDLN_DT		/*국회제출기한*/
			     , D1.RQR_NM     AS RQR_NM		/*요청자명*/
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A1') AS QSTNAIPDF_DOC_ID
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A2') AS QSTNAIHWP_DOC_ID
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A3') AS QSTNAIETC_DOC_ID
			  FROM TBCSPFPL001M D1
			  
			  where 1=1
			  
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strYear">
				D1.QSTNAI_YR =
				#strYear#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnai">
				D1.QSTNAI_NO =
				#strQstnai#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnaiTitleNm">
				D1.QSTNAI_TIT_NM LIKE '%'||#strQstnaiTitleNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strSittNo">
				D1.SITT_NO LIKE '%'||#strSittNo#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqrNm">
				D1.RQR_NM LIKE '%'||#strRqrNm#||'%'
			</isNotEmpty>						
			<isNotEmpty prepend="AND" property="strCmtrNm">
				D1.CMTR_NM =
				#strCmtrNm#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtFrom">
				D1.RQ_DT >=
				#strRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtTo">
				D1.RQ_DT &lt;=
				#strRqDtTo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtrNm">
				D1.CMTR_NM =
				#strCmtrNm#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtCd">
				D1.CMT_CD = #strCmtCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strMtrlDvsnCd">
				D1.NTAS_RQ_MTRL_DVSN_CD =
				#strMtrlDvsnCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqShpCd">
				D1.RQ_SHP_CD =
				#strRqShpCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strNtasRqMtrlHndlStaCd">
				D1.NTAS_RQ_MTRL_HNDL_STA_CD = #strNtasRqMtrlHndlStaCd#
			</isNotEmpty>
		</dynamic>
		<![CDATA[       
			ORDER BY D1.QSTNAI_NO ASC
		]]>
	</select>

	<!-- 질의서목록 엑셀출력 -->
	<select id="CSPFPL001EEexcelExportSelect" parameterClass="paramMap"  resultClass="resultMap">
        <![CDATA[       
			SELECT  D1.QSTNAI_YR||'-'||D1.QSTNAI_NO AS QSTNAI_YR_NO,	/*질의서번호*/
       				D1.QSTNAI_TIT_NM AS QSTNAI_TIT_NM, 					/*질의서제목*/
       				F_CODE_NM('1000374',D1.NTAS_RQ_MTRL_HNDL_STA_CD) AS NTAS_RQ_MTRL_HNDL_STA_NM, /*처리상태명*/
       				D1.SITT_NO AS SITT_NO /*회기번호*/,
       				D1.RQR_NM AS RQR_NM /*요청자명*/,
       				D1.CMTR_NM AS CMTR_NM /*위원명*/,
       				D1.CMT_CD AS CMT_CD /*위원회코드*/,
       				F_CODE_NM('1000091',D1.CMT_CD) AS CMT_NM /*위원회명*/,
       				D1.RQ_DT AS RQ_DT /*요구일자*/,
       				D1.SMT_RQ_DT AS SMT_RQ_DT /*실국제출기한*/,
       				D1.NTAS_SMT_DDLN_DT AS NTAS_SMT_DDLN_DT /*국회제출기한*/,
       				F_CODE_NM('1000092',D1.NTAS_RQ_MTRL_DVSN_CD) AS NTAS_RQ_MTRL_DVSN_NM /*자료구분명*/,
       				F_CODE_NM('1000093',D1.RQ_SHP_CD) AS RQ_SHP_NM /*요구형태명*/
			  FROM TBCSPFPL001M D1
			  where 1=1
			  
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strYear">
				D1.QSTNAI_YR =
				#strYear#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnai">
				D1.QSTNAI_NO =
				#strQstnai#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnaiTitleNm">
				D1.QSTNAI_TIT_NM LIKE '%'||#strQstnaiTitleNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strSittNo">
				D1.SITT_NO LIKE '%'||#strSittNo#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqrNm">
				D1.RQR_NM LIKE '%'||#strRqrNm#||'%'
			</isNotEmpty>						
			<isNotEmpty prepend="AND" property="strCmtrNm">
				D1.CMTR_NM =
				#strCmtrNm#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtFrom">
				D1.RQ_DT >=
				#strRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtTo">
				D1.RQ_DT &lt;=
				#strRqDtTo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtrNm">
				D1.CMTR_NM =
				#strCmtrNm#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtCd">
				D1.CMT_CD = #strCmtCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strMtrlDvsnCd">
				D1.NTAS_RQ_MTRL_DVSN_CD =
				#strMtrlDvsnCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqShpCd">
				D1.RQ_SHP_CD =
				#strRqShpCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strNtasRqMtrlHndlStaCd">
				D1.NTAS_RQ_MTRL_HNDL_STA_CD = #strNtasRqMtrlHndlStaCd#
			</isNotEmpty>
		</dynamic>
		<![CDATA[       
			ORDER BY D1.QSTNAI_NO ASC
		]]>
	</select>
	
	

	<!-- 질의서목록 삭제 -->
	<delete id="CSPFPL001WrtQueListDelete" parameterClass="paramMap">
		DELETE
		FROM TBCSPFPL001M
		WHERE 1=1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND
		QSTNAI_YR=#QSTNAI_YR#
	</delete>
	
	<!-- 질의서목록 삭제 시 세부답변번호도 삭제-->
	<delete id="CSPFPL001WrtQueListDetailDelete" parameterClass="paramMap">
		DELETE
		FROM TBCSPFPL002M
		WHERE 1=1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND
		QSTNAI_YR=#QSTNAI_YR#
	</delete>
		
	<!-- 질의서목록 삭제 시 세부답변번호의 첨부파일도 삭제-->
	<delete id="CSPFPL001WrtQueListDetailEcmDelete" parameterClass="paramMap">
		DELETE
		FROM TBCSPFPL007M
		WHERE 1=1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND
		QSTNAI_YR=#QSTNAI_YR#
	</delete>
		
	<!-- 질의서목록 삭제 시 답변자료취합 삭제-->
	<delete id="CSPFPL001WrtQueAnsListDelete" parameterClass="paramMap">
		DELETE
		FROM TBCSPFPL003M
		WHERE 1=1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND
		QSTNAI_YR=#QSTNAI_YR#
	</delete>
		
	<!-- 질의서목록 삭제 시 답변자료취합 첨부파일도 삭제-->
	<delete id="CSPFPL001WrtQueAnsListEcmDelete" parameterClass="paramMap">
		DELETE
		FROM TBCSPFPL008M
		WHERE 1=1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND
		QSTNAI_YR=#QSTNAI_YR#
	</delete>	

	<!-- 신규등록 전 중복된 정보가 있는지 체크한다. -->
	<select id="CSPFPL001Cntselect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPFPL001M D1
			WHERE 1=1 
			AND QSTNAI_NO=#QSTNAI_NO#
		]]>
	</select>
	<!-- 질의서 신규등록 -->
	<insert id="CSPFPL001maininsert" parameterClass="paramMap">
		INSERT INTO
		TBCSPFPL001M
		(
		QSTNAI_NO
		, QSTNAI_YR
		, CMTR_NM
		, CMT_CD
		, RQ_DT
		, SMT_RQ_DT
		, NTAS_RQ_MTRL_DVSN_CD
		, RQ_SHP_CD
		, QSTNAI_TIT_NM
		, NTAS_RQ_MTRL_HNDL_STA_CD
		, SITT_NO
		, NTAS_SMT_DDLN_DT	
		, RQR_NM		
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, FRT_USR_ID
		)
		VALUES
		(
		#QSTNAI_NO#
		, #QSTNAI_YR#
		, #CMTR_NM#
		, #CMT_CD#
		, #RQ_DT#
		,
		#SMT_RQ_DT#
		,
		#MTRL_DVSN_CD#
		, #RQ_SHP_CD#
		, #QSTNAI_TIT_NM#
		,#NTAS_RQ_MTRL_HNDL_STA_CD#
		, #SITT_NO#
		, #NTAS_SMT_DDLN_DT#
		,#RQR_NM#		
		, #FNL_USR_ID#
		, #FNL_DEAL_DPT_CD#
		,
		#FNL_MNU_ID#
		, SYSDATE
		, SYSDATE
		, #FRT_USR_ID#
		)
	</insert>

	<!-- 질의서정보 수정 -->
	<update id="CSPFPL001mainupdate" parameterClass="paramMap">
		UPDATE TBCSPFPL001M
		SET FNL_MDF_DH = SYSDATE
		, QSTNAI_NO = #QSTNAI_NO#
		,
		QSTNAI_YR = #QSTNAI_YR#
		<isNotEmpty prepend="," property="CMTR_NM">
			CMTR_NM = #CMTR_NM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CMT_CD">
			CMT_CD =
			#CMT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RQ_DT">
			RQ_DT = #RQ_DT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SMT_RQ_DT">
			SMT_RQ_DT = #SMT_RQ_DT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="MTRL_DVSN_CD">
			NTAS_RQ_MTRL_DVSN_CD =
			#MTRL_DVSN_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RQ_SHP_CD">
			RQ_SHP_CD = #RQ_SHP_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="QSTNAI_TIT_NM">
			QSTNAI_TIT_NM =
			#QSTNAI_TIT_NM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="MTRL_DVSN_CD">
			SITT_NO =
			#SITT_NO#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RQ_SHP_CD">
			NTAS_SMT_DDLN_DT = #NTAS_SMT_DDLN_DT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="QSTNAI_TIT_NM">
			RQR_NM =
			#RQR_NM#
		</isNotEmpty>		
		<isNotEmpty prepend="," property="FNL_MDF_DH">
			FNL_MDF_DH = SYSDATE
		</isNotEmpty>
		WHERE 1 = 1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
	</update>

	<!-- 질의서번호 Max값 찾기 -->
	<select id="CSPFPL001MainMaxSnoSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT LPAD(NVL(MAX(TO_NUMBER(QSTNAI_NO)),0)+1,4,0) AS MAX_SEQ
				  FROM TBCSPFPL001M
				 WHERE 1=1
				   AND QSTNAI_YR               = #QSTNAI_YR# 
		]]>
	</select>





	<!-- 세부질의서목록 조회 -->
	<select id="CSPFPL001WrtQueDetSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT D2.QSTNAI_YR||'-'||D2.QSTNAI_NO||'-'||D2.DTIL_ANS_NO||'-'||D2.DTIL_DVSN_NO         AS TOTAL_ANS_NO			/*세부질의번호*/
			     , D2.QSTNAI_YR   AS QSTNAI_YR  	/*질의서년도*/
			     , D2.QSTNAI_NO   AS QSTNAI_NO  	/*질의서번호*/
			     , D2.DTIL_ANS_NO   AS DTIL_ANS_NO  	/*세부답변번호*/
			     , D2.DTIL_DVSN_NO   AS DTIL_DVSN_NO  	/*세부구분번호*/
			     , D2.CHGR_CNB   AS CHGR_CNB  	/*담당자전산번호명*/
			     , D2.CHGR_NM   AS CHGR_NM  	/*담당자명*/
			     , D2.CHGR_ID   AS CHGR_ID  	/*담당자ID*/
			     , D2.CHR_DPT_NM    AS CHR_DPT_NM        /*담당부서명*/
			     , D2.CHR_DPT_CD    AS CHR_DPT_CD        /*담당부서코드 - 2018.06.27 yyh*/
			     , D2.DTIL_QUE_TIT_NM   AS DTIL_QUE_TIT_NM	/*세부질의제목*/
			     , D2.QUE_TXT     AS QUE_TXT		/*질의내용*/
			     , D2.NTAS_RQ_MTRL_HNDL_STA_CD     AS NTAS_RQ_MTRL_HNDL_STA_CD		/*처리상태코드*/
				 , '' AS SMS_MSG
				 , (SELECT A1.HOM_TNB AS TNB FROM TBDCMACM001M A1 WHERE D2.CHGR_CNB = A1.CNB) AS TNB
   			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D2.QSTNAI_YR=D6.QSTNAI_YR and D2.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A1') AS QSTNAIPDF_DOC_ID
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D2.QSTNAI_YR=D6.QSTNAI_YR and D2.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A2') AS QSTNAIHWP_DOC_ID
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D2.QSTNAI_YR=D6.QSTNAI_YR and D2.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A3') AS QSTNAIETC_DOC_ID
			  FROM TBCSPFPL002M D2			  
			  where 1=1
		]]>
				<dynamic>
			<isNotEmpty prepend="AND" property="strQstnaiYrNo">
				D2.QSTNAI_YR||'-'||D2.QSTNAI_NO =
				#strQstnaiYrNo#
			</isNotEmpty>
		</dynamic>
		
		<![CDATA[       
			ORDER BY D2.DTIL_ANS_NO, D2.DTIL_DVSN_NO ASC
		]]>
	</select>

	<delete id="CSPFPL001WrtQueDetDelete" parameterClass="paramMap">
		DELETE
		FROM TBCSPFPL002M
		WHERE 1=1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
		AND DTIL_ANS_NO=#DTIL_ANS_NO#
		AND DTIL_DVSN_NO=#DTIL_DVSN_NO#
	</delete>

	<!-- 신규등록 전 중복된 정보가 있는지 체크한다. -->
	<select id="CSPFPL002Cntselect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPFPL001M D1
			WHERE 1=1 
			AND QSTNAI_NO=#QSTNAI_NO#
		]]>
	</select>
	<!-- 세부질의서 신규등록 -->
	<insert id="CSPFPL001WrtQueDetInsert" parameterClass="paramMap">
		INSERT INTO
		TBCSPFPL002M
		(
		DTIL_ANS_NO
		, QSTNAI_NO
		, CHGR_CNB
		, CHGR_NM
		, CHGR_ID
		, CHR_DPT_NM
		, CHR_DPT_CD
		, QSTNAI_YR
		, DTIL_DVSN_NO
		, DTIL_QUE_TIT_NM
		, QUE_TXT
		, NTAS_SMT_HNDL_STA_CD
		, NTAS_RQ_MTRL_HNDL_STA_CD
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, FRT_USR_ID
		)
		VALUES
		(
		#DTIL_ANS_NO#
		, #QSTNAI_NO#
		, #CHGR_CNB#
		, #CHGR_NM#
		, #CHGR_ID#
		, #CHR_DPT_NM#
		, #CHR_DPT_CD# /* 부서코드 추가 - 2018.06.26 yyh*/
		, #QSTNAI_YR#
		, #DTIL_DVSN_NO#
		, #DTIL_QUE_TIT_NM#
		, #QUE_TXT#
		, '10'
		, #NTAS_RQ_MTRL_HNDL_STA_CD#
		, #FNL_USR_ID#
		, #FNL_DEAL_DPT_CD#
		, #FNL_MNU_ID#
		, SYSDATE
		, SYSDATE
		, #FRT_USR_ID#
		)
	</insert>

	<!-- 세부질의서 수정 후 신규등록 -->
	<insert id="CSPFPL001WrtQueDetUpInsert" parameterClass="paramMap">
		INSERT INTO
		TBCSPFPL002M
		(
		DTIL_ANS_NO
		, QSTNAI_NO
		, CHGR_CNB
		, CHGR_NM
		, CHGR_ID
		, CHR_DPT_NM
		, CHR_DPT_CD
		, QSTNAI_YR
		, DTIL_DVSN_NO
		, DTIL_QUE_TIT_NM
		, QUE_TXT
		, NTAS_RQ_MTRL_HNDL_STA_CD
		, NTAS_SMT_HNDL_STA_CD
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FRT_REGI_DH
		, FNL_MDF_DH
		, FRT_USR_ID
		)
		VALUES
		(
		#DTIL_ANS_NO#
		, #QSTNAI_NO#
		, #CHGR_CNB#
		, #CHGR_NM#
		, #CHGR_ID#
		, #CHR_DPT_NM#
		, #CHR_DPT_CD# /* 부서코드 추가 - 2018.06.26 yyh*/
		, #QSTNAI_YR#
		, #DTIL_DVSN_NO#
		, #DTIL_QUE_TIT_NM#
		, #QUE_TXT#
		, #NTAS_RQ_MTRL_HNDL_STA_CD#
		, '10'
		, #FNL_USR_ID#
		, #FNL_DEAL_DPT_CD#
		, #FNL_MNU_ID#
		, SYSDATE
		, SYSDATE
		, #FNL_USR_ID#
		)
	</insert>

	<!-- 세부질의서정보 수정 -->
	<update id="CSPFPL001WrtQueDetUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL002M
		SET FNL_MDF_DH = SYSDATE
			 , CHGR_CNB = #CHGR_CNB#
			 , CHGR_NM = #CHGR_NM#
			 , CHGR_ID = #CHGR_ID#
			 , CHR_DPT_NM = #CHR_DPT_NM#
			 , CHR_DPT_CD = #CHR_DPT_CD#  /* 부서코드 추가 - 2018.06.26 yyh*/
			 ,DTIL_QUE_TIT_NM = #DTIL_QUE_TIT_NM#
			 ,QUE_TXT = #QUE_TXT#
	 		, FNL_USR_ID = #FNL_USR_ID#
			, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			, FNL_MNU_ID = #FNL_MNU_ID#
		WHERE 1 = 1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
		AND DTIL_ANS_NO = #DTIL_ANS_NO#
		AND DTIL_DVSN_NO = #DTIL_DVSN_NO#
		]]>
	</update>

	<!-- 질의서세부정보상태 수정(배분완료) -->
	<update id="CSPFPL001WrtQueStatusUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL002M
		SET FNL_MDF_DH = SYSDATE
			 ,NTAS_RQ_MTRL_HNDL_STA_CD = #strQstnaiStatus#
		WHERE 1 = 1
		AND QSTNAI_NO=#strNo#
		AND QSTNAI_YR=#strYear#
		]]>
	</update>
	
		<!-- 질의서메인정보상태 수정(배분완료) -->
	<update id="CSPFPL001WrtQueMainStatusUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL001M
		SET FNL_MDF_DH = SYSDATE
			 ,NTAS_RQ_MTRL_HNDL_STA_CD = #strQstnaiStatus#
		WHERE 1 = 1
		AND QSTNAI_NO=#strNo#
		AND QSTNAI_YR=#strYear#
		]]>
	</update>
	
	<!-- 질의서번호 Max값 찾기 -->
	<select id="CSPFPL002MainMaxSnoSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT LPAD(NVL(MAX(TO_NUMBER(DTIL_ANS_NO)),0)+1,3,0) AS MAX_SEQ
				  FROM TBCSPFPL002M
				 WHERE 1=1
				   AND QSTNAI_YR               = #QSTNAI_YR# 
				   AND QSTNAI_NO               = #QSTNAI_NO# 
		]]>
	</select>

	<!-- 질의서번호 Max값 찾기 -->
	<select id="CSPFPL002MainMaxSnoSubSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT LPAD(NVL(MAX(TO_NUMBER(DTIL_DVSN_NO)),0)+1,2,0) AS MAX_SEQ1
				  FROM TBCSPFPL002M
				 WHERE 1=1
				   AND QSTNAI_YR               = #QSTNAI_YR# 
				   AND QSTNAI_NO               = #QSTNAI_NO# 
				   AND DTIL_ANS_NO               = #DTIL_ANS_NO# 
		]]>
	</select>
	
	
	
		<!-- 기획담당자 조회 -->
	<select id="CSPFPL001ChgrListSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
		 select A1.CHGR_NM,
		        A1.CHGR_CNB,
                A1.CHR_DPT_CD,
		        A1.CHR_DPT_NM,
		        A1.CHGR_ID,
		        A1.DIV
		   FROM ( select D1.CHGR_NM                 as CHGR_NM,
		                 D1.CHGR_CNB                as CHGR_CNB,
                         D1.CHR_DPT_CD              as CHR_DPT_CD,
		                 D1.CHR_DPT_NM              as CHR_DPT_NM,
		                 D1.CHGR_ID                 as CHGR_ID,
		                 '기획담당자'               as DIV
		            from tbcspfpl004m D1
		           UNION
		          select D2.USR_NAM                 as CHGR_NM,
		                 D2.CNB                     as CHGR_CNB,
                         D2.DPT_CD                  as CHR_DPT_CD,
		                 F_DPT_INFO(D2.DPT_CD, '1') as CHR_DPT_NM,
		                 D2.USR_ID                  as CHGR_ID,
		                 '일반사용자'               as DIV
		            from tbdcmacm001m D2) A1
		  where 1=1
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strChgrNm">
				A1.CHGR_NM LIKE '%'||#strChgrNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strChgrDptNm">
				A1.CHR_DPT_NM LIKE '%'||#strChgrDptNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strChgrCnb">
				A1.CHGR_CNB LIKE '%'||#strChgrCnb#||'%'
			</isNotEmpty>			
			<isNotEmpty prepend="AND" property="strDiv">
				A1.DIV = #strDiv#
			</isNotEmpty>
		</dynamic>
		<![CDATA[       
			ORDER BY A1.DIV
		]]>
	</select>

		<!-- 기획담당자 조회 -->
	<select id="CSPFPL001ChgrSubListSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			 select d1.CHGR_NM,
                    d1.CHR_DPT_CD,
			        d1.CHR_DPT_NM,
			        d1.CHGR_ID
			   from tbcspfpl002m d1,
			        tbdcmacm001m D2
			  where 1=1
			    and d1.CHGR_NM = D2.USR_NAM
			    and d1.CHGR_ID = USR_ID
			 	and D1.CHR_DPT_NM = F_DPT_INFO (D2.DPT_CD,'1')
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strQstnaiYr">
				d1.qstnai_yr = #strQstnaiYr#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnaiNo">
				d1.qstnai_no = #strQstnaiNo#
			</isNotEmpty>			
			<isNotEmpty prepend="AND" property="strDtilAnsNo">
				d1.dtil_ans_no = #strDtilAnsNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strDtilDvsnNo">
				d1.dtil_dvsn_no = #strDtilDvsnNo#
			</isNotEmpty>
		</dynamic>
		<![CDATA[       
			ORDER BY d1.CHGR_NM
		]]>
	</select>
	
	<insert id="CSPFPL001EcmFileInsert" parameterClass="paramMap">
	       <![CDATA[
	       	INSERT INTO TBCSPFPL006M
	       	(
	       			QSTNAI_NO,			/*질의서번호*/
	       			QSTNAI_YR,		/*질의서연도*/
	       			NTAS_RQ_MTRL_DOC_KND_CD,		/*국회요구자료문서구분코드*/
	       			DOC_ID,			/*문서코드*/
  					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH,
					FRT_USR_ID
	       	) VALUES (
	       			#QSTNAI_NO#,
				    #QSTNAI_YR#,
	        		'A1',
	        		#QSTNAIPDF_DOC_ID#,
      				#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE,
					#FRT_USR_ID#
	       	)
	       ]]>
	</insert>		
	
	<insert id="CSPFPL001EcmFileInsert1" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPFPL006M
        	(
        			QSTNAI_NO,			/*질의서번호*/
        			QSTNAI_YR,		/*질의서연도*/
        			NTAS_RQ_MTRL_DOC_KND_CD,		/*국회요구자료문서구분코드*/
        			DOC_ID,			/*문서코드*/
  					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH,
					FRT_USR_ID
        	) VALUES (
        			#QSTNAI_NO#,
				    #QSTNAI_YR#,
	        		'A2',
	        		#QSTNAIHWP_DOC_ID#,
     				#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE,
					#FRT_USR_ID#	        		
        	)
        ]]>
	</insert>		
	
	<insert id="CSPFPL001EcmFileInsert2" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPFPL006M
        	(
        			QSTNAI_NO,			/*질의서번호*/
        			QSTNAI_YR,		/*질의서연도*/
        			NTAS_RQ_MTRL_DOC_KND_CD,		/*국회요구자료문서구분코드*/
        			DOC_ID,			/*문서코드*/
  					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH,
					FRT_USR_ID        			
        	) VALUES (
        			#QSTNAI_NO#,
				    #QSTNAI_YR#,
	        		'A3',
	        		#QSTNAIETC_DOC_ID#,
     				#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE,
					#FRT_USR_ID#	        		
        	)
        ]]>
	</insert>
	
	<delete id="CSPFPL001EcmFileDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE	
			FROM	TBCSPFPL006M
			WHERE	QSTNAI_NO = #QSTNAI_NO#
			AND		QSTNAI_YR = #QSTNAI_YR#
		]]>
	</delete>
	
	<!-- 세부질의내용 업데이트시 담당자여러명 지정시 기존세부답변번호 삭제-->
	<delete id="CSPFPL002WrtQueListDetailDelete" parameterClass="paramMap">
		DELETE
		FROM TBCSPFPL002M
		WHERE 1=1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
		AND DTIL_ANS_NO=#DTIL_ANS_NO#		
		AND DTIL_DVSN_NO=#DTIL_DVSN_NO#		
	</delete>		

	<!-- 세부질의내용 삭제시 등록되어있는 ECM 삭제-->
	<delete id="CSPFPL002WrtQueEcmDelete" parameterClass="paramMap">
		DELETE
		FROM TBCSPFPL007M
		WHERE 1=1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
		AND DTIL_ANS_NO=#DTIL_ANS_NO#		
		AND DTIL_DVSN_NO=#DTIL_DVSN_NO#
	</delete>
	<!-- SMS서비스 Insert-->
	<insert id="CSPFPL002ESendSms" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO MSG_DATA 
	 			      ( MSG_SEQ
	 			      , REQ_DATE
	 			      , CUR_STATE
	 			      , CALL_TO
	 			      , CALL_FROM
	 			      , SMS_TXT
	 			      , MSG_TYPE
	 			      , CONT_SEQ)
 			      VALUES (
 			            MSG_DATA_SEQ.NEXTVAL
 			          , SYSDATE
 			          , 0
 			          , REPLACE(#CALL_TO#, '-')
 			          , REPLACE(#CALL_FROM#, '-')
 			          , ''
 			          ,6
 			          ,#CONT_SEQ#)
        ]]>
	</insert>
	
	
	<insert id="CSPFPL002ESendSmsMms" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MMS_CONTENTS_INFO 
				 	(	CONT_SEQ
				 		, FILE_CNT
				 		, MMS_BODY
				 		, MMS_SUBJECT
				 	) 
			VALUES (	#CONT_SEQ#
						, 1
						, #SMS_TXT#
						, '감사원 국회요구자료 문자통보'
					)
		]]>
	</insert>	
	
		
	<insert id="CSPFPL002EInsertMSGSend" parameterClass="paramMap">
		<![CDATA[
			CALL NURI2_MESSAGE_SEND(#CALL_FROM#, #CALL_TO#, #SMS_TLT#, #SMS_TXT#)
		]]>
	</insert>
	
			
</sqlMap> 