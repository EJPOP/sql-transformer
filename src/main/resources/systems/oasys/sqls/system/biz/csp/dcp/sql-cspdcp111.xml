<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/111">
 	<resultMap class="java.util.HashMap" id="cspdcpMap">
 		<result property="REQ_DVSN_CD" column="REQ_DVSN_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ACP_YR" column="ACP_YR"                             jdbcType="VARCHAR2"  javaType="java.lang.String" /> 
		<result property="CVPT_ACP_NO" column="CVPT_ACP_NO"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_NO" column="ACP_NO"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RM_CVPT_ACP_NO" column="RM_CVPT_ACP_NO"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CVPT_KND_CD" column="CVPT_KND_CD"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="REQR_KND_CD" column="REQR_KND_CD"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_RUT_CD" column="ACP_RUT_CD"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_RUT_DTL_CD" column="ACP_RUT_DTL_CD"             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CVPTR_NM" column="CVPTR_NM"                         jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="BTDT" column="BTDT"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="JB_NM" column="JB_NM"                               jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RPST_PEN_NM" column="RPST_PEN_NM"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="BZN" column="BZN"                                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CPNM_NM" column="CPNM_NM"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ZCD" column="ZCD"                                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AD" column="AD"                                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="DTL_AD" column="DTL_AD"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TNB1" column="TNB1"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TNB2" column="TNB2"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TNB3" column="TNB3"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HPN1" column="HPN1"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HPN2" column="HPN2"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HPN3" column="HPN3"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HPN" column="HPN"                                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="EML_ID" column="EML_ID"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="EML_DMI_NM" column="EML_DMI_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="OPEN_YN" column="OPEN_YN"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="MNG_TYP_CD" column="MNG_TYP_CD"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RSLT_NTF_WAY_CD" column="RSLT_NTF_WAY_CD"           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TIT_NM" column="TIT_NM"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_DPT_CD" column="ACP_DPT_CD"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_DPT_NM" column="ACP_DPT_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RCEP_ID" column="RCEP_ID"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RCEP_NM" column="RCEP_NM"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_DH" column="ACP_DH"                             jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="CVPT_HNDL_STA_CD" column="CVPT_HNDL_STA_CD"         jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AUD_INF_TG_YN" column="AUD_INF_TG_YN"               jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="SMG_CVPT_APL_NO" column="SMG_CVPT_APL_NO"           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="SMG_CVPT_ACP_NO" column="SMG_CVPT_ACP_NO"           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="SMG_FNL_HNDL_STA_CD" column="SMG_FNL_HNDL_STA_CD"   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="SMG_CVPT_APL_DH" column="SMG_CVPT_APL_DH"           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="SMG_FRT_CVPT_APL_GCC_ORG_CD" column="SMG_FRT_CVPT_APL_GCC_ORG_CD"           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="SMG_CAT_HST_SRNO" column="SMG_CAT_HST_SRNO"           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CVPT_WDW_DH" column="CVPT_WDW_DH"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CVPT_WDW_RSN" column="CVPT_WDW_RSN"                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CVPT_TXT" column="CVPT_TXT"                         jdbcType="CLOB"      javaType="java.lang.String" />
		<result property="CVPT_SBT" column="CVPT_SBT"                         jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CLM_NM" column="CLM_NM"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="WRK_PLAC_NM" column="WRK_PLAC_NM"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CLM_TNB1" column="CLM_TNB1"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CLM_TNB2" column="CLM_TNB2"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CLM_TNB3" column="CLM_TNB3"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CLM_ZCD" column="CLM_ZCD"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CLM_AD" column="CLM_AD"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CLM_DTL_AD" column="CLM_DTL_AD"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="DOC_ID" column="DOC_ID"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CVPT_HNDL_STA_NM" column="CVPT_HNDL_STA_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HMP_APL_NO" column="HMP_APL_NO"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HMP_SMG_APL_NO" column="HMP_SMG_APL_NO"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		
 	</resultMap>
 	
 	<select id="CSPDCP111ERmCvptAcpNoSelect" parameterClass="paramMap" resultClass="String">
 		<![CDATA[
 			SELECT	LPAD(TO_CHAR(NVL(MAX(TO_NUMBER(RM_CVPT_ACP_NO)),0)+1),5,0) AS RM_CVPT_ACP_NO
			FROM	TBCSPDCP101M
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
 		]]>
 	</select>
 	
 	<select id="CSPDCP111EMainSelect" parameterClass="paramMap"
		resultMap="cspdcpMap">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,DECODE(A.RM_CVPT_ACP_NO,NULL,NULL,A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||A.RM_CVPT_ACP_NO) AS ACP_NO
   					,A.RM_CVPT_ACP_NO
   					,A.CVPT_KND_CD
   					,A.REQR_KND_CD
   					,A.ACP_RUT_CD
   					,A.ACP_RUT_DTL_CD
   					,A.CVPTR_NM
   					,A.BTDT
   					,A.JB_NM
   					,A.RPST_PEN_NM
   					,A.BZN
   					,A.CPNM_NM
   					,A.ZCD
   					,A.AD
   					,A.DTL_AD
   					,DECODE(A.TNB,NULL,'',SUBSTR(A.TNB,1,INSTR(A.TNB,'-',1,1)-1)) TNB1
   					,DECODE(A.TNB,NULL,'',SUBSTR(A.TNB,INSTR(A.TNB,'-',1,1)+1,INSTR(A.TNB,'-',1,2)-INSTR(A.TNB,'-',1,1)-1)) AS TNB2
   					,DECODE(A.TNB,NULL,'',SUBSTR(A.TNB,INSTR(A.TNB,'-',1,2)+1)) TNB3
   					,DECODE(A.HPN,NULL,'',SUBSTR(HPN,1,INSTR(HPN,'-',1,1)-1)) HPN1
   					,DECODE(A.HPN,NULL,'',SUBSTR(A.HPN,INSTR(A.HPN,'-',1,1)+1,INSTR(A.HPN,'-',1,2)-INSTR(A.HPN,'-',1,1)-1)) AS HPN2
   					,DECODE(A.HPN,NULL,'',SUBSTR(A.HPN,INSTR(A.HPN,'-',1,2)+1)) HPN3
   					,A.HPN
   					,A.EML_ID
   					,A.EML_DMI_NM
   					,A.OPEN_YN
   					,A.MNG_TYP_CD
   					,A.RSLT_NTF_WAY_CD
   					,A.TIT_NM
   					,A.ACP_DPT_CD
   					,F_DPT_INFO(A.ACP_DPT_CD,'1') AS ACP_DPT_NM
   					,A.RCEP_ID
   					,F_USR_INFO_BY_ID(A.RCEP_ID,'2') AS RCEP_NM
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
   					,A.CVPT_HNDL_STA_CD
   					,A.AUD_INF_TG_YN
   					,A.SMG_CVPT_APL_NO
   					,A.SMG_CVPT_ACP_NO
   					,A.SMG_FNL_HNDL_STA_CD
   					,A.SMG_CVPT_APL_DH
   					,A.SMG_FRT_CVPT_APL_GCC_ORG_CD
   					,A.SMG_CAT_HST_SRNO
   					,TO_CHAR(A.CVPT_WDW_DH,'YYYY-MM-DD HH24:MI') AS CVPT_WDW_DH
   					,A.CVPT_WDW_RSN
   					,B.CVPT_TXT
   					,B.CVPT_SBT
   					,C.CLM_NM
   					,C.WRK_PLAC_NM
   					,DECODE(C.TNB,NULL,'',SUBSTR(C.TNB,1,INSTR(C.TNB,'-',1,1)-1)) CLM_TNB1
   					,DECODE(C.TNB,NULL,'',SUBSTR(C.TNB,INSTR(C.TNB,'-',1,1)+1,INSTR(C.TNB,'-',1,2)-INSTR(C.TNB,'-',1,1)-1)) AS CLM_TNB2
   					,DECODE(C.TNB,NULL,'',SUBSTR(C.TNB,INSTR(C.TNB,'-',1,2)+1)) CLM_TNB3
   					,C.ZCD AS CLM_ZCD
   					,C.AD AS CLM_AD
   					,C.DTL_AD AS CLM_DTL_AD
   					,A.DOC_ID
   					,F_CODE_NM('1000361',A.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
   					,A.HMP_APL_NO
   					,NVL(A.HMP_APL_NO,A.SMG_CVPT_APL_NO) AS HMP_SMG_APL_NO
   					,TO_CHAR(A.CVPT_WDW_DH,'YYYY-MM-DD HH24:MI') AS CVPT_WDW_DH
   			FROM	TBCSPDCP101M A
   					,TBCSPDCP102M B
   					,TBCSPDCP103M C
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
		]]>
		<dynamic>
			<isEmpty property="strRM_CVPT_ACP_NO">
				AND	A.CVPT_ACP_NO = #strCVPT_ACP_NO#
			</isEmpty>
			<isNotEmpty property="strRM_CVPT_ACP_NO">
				AND	A.RM_CVPT_ACP_NO = #strRM_CVPT_ACP_NO#
			</isNotEmpty>
		</dynamic>
			
	</select>
	
	<select id="CSPDCP111EOrgSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.AUD_TG_ORG_CD
   					,B.ORG_NM
   					,(	SELECT	Z.USR_DFN_TXT_1
   						FROM	TBDCMACM013C Z
   						WHERE	Z.CMM_CD_DVSN_CD ='1000128'
   						AND		Z.CD = B.PUB_DVSN_CD) AS PUB_DVSN_CD
   					,F_ORG_HRK_NM(B.COPT_SG_CD) AS COPT_SG_NM
   					,(	SELECT	F_CODE_NM('1000447',Z.USR_DFN_TXT_1)
   						FROM	TBDCMACM013C Z
   						WHERE	Z.CMM_CD_DVSN_CD ='1000128'
   						AND		Z.CD = B.PUB_DVSN_CD) AS PUB_DVSN_NM
   			FROM	TBCSPDCP104L A 
   					,TBDCMACM015M B
   					,TBCSPDCP101M C
   			WHERE	1=1
   			AND		C.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		C.ACP_YR = #strACP_YR#
   			AND		C.REQ_DVSN_CD = A.REQ_DVSN_CD
   			AND		C.ACP_YR = A.ACP_YR
   			AND		C.CVPT_ACP_NO = A.CVPT_ACP_NO 
   			AND		A.AUD_TG_ORG_CD = B.ORG_CD
		]]>
			<isEmpty property="strRM_CVPT_ACP_NO">
				AND	C.CVPT_ACP_NO = #strCVPT_ACP_NO#
			</isEmpty>
			<isNotEmpty property="strRM_CVPT_ACP_NO">
				AND	C.RM_CVPT_ACP_NO = #strRM_CVPT_ACP_NO#
			</isNotEmpty>
			
	</select>
	
	<insert id="CSPDCP111EMainInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPDCP101M
        				(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,CVPT_KND_CD
        					,REQR_KND_CD
        					,ACP_RUT_CD
        					,ACP_RUT_DTL_CD
        					,CVPTR_NM
        					,BTDT
        					,JB_NM
        					,RPST_PEN_NM
        					,BZN
        					,CPNM_NM
        					,ZCD
        					,AD
        					,DTL_AD
        					,TNB
        					,HPN
        					,EML_ID
        					,EML_DMI_NM
        					,OPEN_YN
        					,MNG_TYP_CD
        					,RSLT_NTF_WAY_CD
        					,TIT_NM
        					,ACP_DPT_CD
        					,RCEP_ID
        					,ACP_DH
        					,CVPT_HNDL_STA_CD
        					,AUD_INF_TG_YN
        					,SMG_CVPT_APL_NO
        					,SMG_CVPT_ACP_NO
        					,SMG_FNL_HNDL_STA_CD
        					,SMG_CVPT_APL_DH
        					,CVPT_WDW_DH
        					,CVPT_WDW_RSN
        					,DOC_ID
        					,DOC_TYP_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        					,RM_CVPT_ACP_NO
        				)
        		VALUES	(	#REQ_DVSN_CD#
							,#ACP_YR#
							,#CVPT_ACP_NO#
							,#CVPT_KND_CD#
							,#REQR_KND_CD#
							,#ACP_RUT_CD#
							,#ACP_RUT_DTL_CD#
							,#CVPTR_NM#
							,#BTDT#
							,#JB_NM#
							,#RPST_PEN_NM#
							,#BZN#
							,#CPNM_NM#
							,#ZCD#
							,#AD#
							,#DTL_AD#
							,DECODE(#TNB1#,NULL,'',#TNB1#||'-'||#TNB2#||'-'||#TNB3#)
							,DECODE(#HPN1#,NULL,'',#HPN1#||'-'||#HPN2#||'-'||#HPN3#)
							,#EML_ID#
							,#EML_DMI_NM#
							,#OPEN_YN#
							,#MNG_TYP_CD#
							,NVL(#RSLT_NTF_WAY_CD#,'003')
							,#TIT_NM#
							,#ACP_DPT_CD#
							,#RCEP_ID#
							,SYSDATE
							,DECODE(#REQ_DVSN_CD#,'1','20','10')
							,#AUD_INF_TG_YN#
							,#SMG_CVPT_APL_NO#
							,#SMG_CVPT_ACP_NO#
							,#SMG_FNL_HNDL_STA_CD#
							,#SMG_CVPT_APL_DH#
							,#CVPT_WDW_DH#
							,#CVPT_WDW_RSN#
							,#DOC_ID#
							,#DOC_TYP_CD#
							,#FRT_USR_ID#
							,#FNL_USR_ID#
							,#FNL_DEAL_DPT_CD#
							,#FNL_MNU_ID#
							,SYSDATE
							,SYSDATE
							,#RM_CVPT_ACP_NO#
        				)
		]]>
	</insert>
	
	<insert id="CSPDCP111EDCP102Insert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPDCP102M
        				(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,CVPT_TXT
        					,CVPT_SBT
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
							,#ACP_YR#
							,#CVPT_ACP_NO#
							,#CVPT_TXT#
							,#CVPT_SBT#
							,#FRT_USR_ID#
							,#FNL_USR_ID#
							,#FNL_DEAL_DPT_CD#
							,#FNL_MNU_ID#
							,SYSDATE
							,SYSDATE
						)
        ]]>
	</insert>
	
	<insert id="CSPDCP111EDCP103Insert" parameterClass="paramMap">
        <![CDATA[
        	MERGE INTO 	TBCSPDCP103M A
        	USING 	(	SELECT 	#REQ_DVSN_CD# AS REQ_DVSN_CD 
        						,#ACP_YR# AS ACP_YR
        						,#CVPT_ACP_NO# AS CVPT_ACP_NO
        				FROM DUAL
        			) B
        	ON		(	A.REQ_DVSN_CD = B.REQ_DVSN_CD
        				AND	A.ACP_YR = B.ACP_YR
        				AND A.CVPT_ACP_NO = B.CVPT_ACP_NO
        			)
        	WHEN MATCHED THEN
        			UPDATE	
        			SET		CLM_NM = #CLM_NM#
        					,WRK_PLAC_NM = #WRK_PLAC_NM#
        					,TNB = DECODE(#CLM_TNB1#,NULL,'',#CLM_TNB1#||'-'||#CLM_TNB2#||'-'||#CLM_TNB3#)
        					,ZCD = #CLM_ZCD#
        					,AD = #CLM_AD#
        					,DTL_AD = #CLM_DTL_AD#
        					,FNL_USR_ID = #FNL_USR_ID#
        					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
        					,FNL_MNU_ID = #FNL_MNU_ID#
        					,FNL_MDF_DH = SYSDATE
        	WHEN NOT MATCHED THEN
		        	INSERT 		(	REQ_DVSN_CD
		        					,ACP_YR
		        					,CVPT_ACP_NO
		        					,CLM_NM
		        					,WRK_PLAC_NM
		        					,TNB
		        					,ZCD
		        					,AD
		        					,DTL_AD
		        					,FRT_USR_ID
		        					,FNL_USR_ID
		        					,FNL_DEAL_DPT_CD
		        					,FNL_MNU_ID
		        					,FRT_REGI_DH
		        					,FNL_MDF_DH
		        				)
		        		VALUES	(	#REQ_DVSN_CD#
									,#ACP_YR#
									,#CVPT_ACP_NO#
									,#CLM_NM#
		        					,#WRK_PLAC_NM#
		        					,DECODE(#CLM_TNB1#,NULL,'',#CLM_TNB1#||'-'||#CLM_TNB2#||'-'||#CLM_TNB3#)
		        					,#CLM_ZCD#
		        					,#CLM_AD#
		        					,#CLM_DTL_AD#
									,NVL(#FRT_USR_ID#,#FNL_USR_ID#)
									,#FNL_USR_ID#
									,#FNL_DEAL_DPT_CD#
									,#FNL_MNU_ID#
									,SYSDATE
									,SYSDATE
								)
        ]]>
	</insert>
	
	<insert id="CSPDCP111EDCP104Insert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPDCP104L
        				(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,AUD_TG_ORG_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
							,#ACP_YR#
							,#CVPT_ACP_NO#
							,#AUD_TG_ORG_CD#
							,#FRT_USR_ID#
							,#FNL_USR_ID#
							,#FNL_DEAL_DPT_CD#
							,#FNL_MNU_ID#
							,SYSDATE
							,SYSDATE 
						)
        ]]>
	</insert>
	
	<select id="CSPDCP111EKeySelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT LPAD(TO_CHAR(NVL(MAX(TO_NUMBER(CVPT_ACP_NO)),0)+1),5,0) AS CVPT_ACP_NO
				  FROM TBCSPDCP101M
				 WHERE 1=1
			       AND REQ_DVSN_CD = #REQ_DVSN_CD#
			       AND ACP_YR = #ACP_YR#
		]]>
	</select>
	
	
	<update id="CSPDCP111EMainUpdate" parameterClass="paramMap">
        <![CDATA[
        	UPDATE	TBCSPDCP101M
        	SET		CVPT_KND_CD = #CVPT_KND_CD#
   					,REQR_KND_CD =#REQR_KND_CD#
   					,ACP_RUT_CD =#ACP_RUT_CD#
   					,ACP_RUT_DTL_CD = #ACP_RUT_DTL_CD#
   					,CVPTR_NM = #CVPTR_NM#
   					,BTDT = #BTDT#
   					,JB_NM = #JB_NM#
   					,RPST_PEN_NM = #RPST_PEN_NM#
   					,BZN = #BZN#
   					,CPNM_NM = #CPNM_NM#
   					,ZCD = #ZCD#
   					,AD = #AD#
   					,DTL_AD = #DTL_AD#
   					,TNB = DECODE(#TNB1#,NULL,'',#TNB1#||'-'||#TNB2#||'-'||#TNB3#)
   					,HPN = DECODE(#HPN1#,NULL,'',#HPN1#||'-'||#HPN2#||'-'||#HPN3#)
   					,EML_ID = #EML_ID#
   					,EML_DMI_NM = #EML_DMI_NM#
   					,OPEN_YN = #OPEN_YN#
   					,MNG_TYP_CD = #MNG_TYP_CD#
   					,RSLT_NTF_WAY_CD = NVL(#RSLT_NTF_WAY_CD#,'003')
   					,TIT_NM = #TIT_NM#
   					,CVPT_HNDL_STA_CD = DECODE(#REQ_DVSN_CD#,'2','10','3','10',DECODE(#CVPT_HNDL_STA_CD#,'20','20','21','20','10','20',CVPT_HNDL_STA_CD))
   					,AUD_INF_TG_YN = #AUD_INF_TG_YN#
   					,DOC_ID = #DOC_ID#
   					,DOC_TYP_CD = #DOC_TYP_CD#
   					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
   		]]>
   			<isEqual property="ACP_RUT_CD" compareValue="8" >
   				<isEqual property="CVPT_HNDL_STA_CD" compareValue="10">
   					,RCEP_ID = F_USR_INFO(#S_CNB#,'1')
	   				,ACP_DPT_CD = #FNL_DEAL_DPT_CD#
	   				,ACP_DH = SYSDATE
	   				,RM_CVPT_ACP_NO = #RM_CVPT_ACP_NO#
   				</isEqual>
   				<isEqual property="CVPT_HNDL_STA_CD" compareValue="21">
   					,RCEP_ID = F_USR_INFO(#S_CNB#,'1')
	   				,ACP_DPT_CD = #FNL_DEAL_DPT_CD#
   				</isEqual>
   			</isEqual>
   			<isEqual property="ACP_RUT_CD" compareValue="7" >
   				<isEqual property="CVPT_HNDL_STA_CD" compareValue="10">
   					,RCEP_ID = F_USR_INFO(#S_CNB#,'1')
	   				,ACP_DPT_CD = #FNL_DEAL_DPT_CD#
	   				,ACP_DH = SYSDATE
	   				,RM_CVPT_ACP_NO = #RM_CVPT_ACP_NO#
   				</isEqual>
   				<isEqual property="CVPT_HNDL_STA_CD" compareValue="21">
   					,RCEP_ID = F_USR_INFO(#S_CNB#,'1')
	   				,ACP_DPT_CD = #FNL_DEAL_DPT_CD#
   				</isEqual>
   			</isEqual>
   		<![CDATA[
   			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
   			AND		ACP_YR = #ACP_YR#
   			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
       	]]>
	</update>
	
	<update id="CSPDCP111EDCP102Update" parameterClass="paramMap">
        <![CDATA[
        	UPDATE	TBCSPDCP102M
        	SET		CVPT_TXT = #CVPT_TXT#
   					,CVPT_SBT =#CVPT_SBT#
   					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
   			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
   			AND		ACP_YR = #ACP_YR#
   			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
       	]]>
	</update>
	
	<delete id="CSPDCP111EDCP104Delete" parameterClass="paramMap">
        <![CDATA[
        	DELETE	
        	FROM	TBCSPDCP104L
        	WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
   			AND		ACP_YR = #ACP_YR#
   			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
   			AND		AUD_TG_ORG_CD = #AUD_TG_ORG_CD#
       	]]>
	</delete>
	
	<insert id="CSPDCP111EDCP202Insert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPDCP202H
        				(	REQ_DVSN_CD
        					,ACP_YR
        					,CVPT_ACP_NO
        					,CVPT_DTB_HST_SRNO
        					,DTB_DPT_CD
        					,DTB_PEN_ID
        					,CVPT_HNDL_STA_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
							,#ACP_YR#
							,#CVPT_ACP_NO#
							,(	SELECT NVL(MAX(CVPT_DTB_HST_SRNO),0)+1
								  FROM TBCSPDCP202H
								 WHERE 1=1
							       AND REQ_DVSN_CD = #REQ_DVSN_CD#
							       AND ACP_YR = #ACP_YR#
							       AND CVPT_ACP_NO = #CVPT_ACP_NO#
							 )
							,#FNL_DEAL_DPT_CD#
							,F_USR_INFO(#S_CNB#,'1')
							,DECODE(#REQ_DVSN_CD#,'1','20','10')
							,F_USR_INFO(#S_CNB#,'1')
							,#FNL_USR_ID#
							,#FNL_DEAL_DPT_CD#
							,#FNL_MNU_ID#
							,SYSDATE
							,SYSDATE
						)
        ]]>
	</insert>
	
	
	<select id="CSPDCP111EReportSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||A.RM_CVPT_ACP_NO AS ACP_NO
					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD') AS ACP_DH
					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
					,CASE WHEN A.ACP_DPT_CD = '071100'
						 THEN '감사원 종합상담실'
						ELSE F_DPT_INFO(A.ACP_DPT_CD,'1')||' 종합상담실' END AS ACP_DPT_NM
   			FROM	TBCSPDCP101M A 
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
		]]>
	</select>
	
	
	
	<insert id="CSPDCP111ESMGInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	T_IC_TARGET_SRC_INTERFACE
						(	INTERFACE_KEY
							,APP_ORGAN_CODE		/*최초 민원 신청 기관코드(GCC)*/
							,PETI_NO			/*민원신청번호*/
							,REC_SEQ			/*분류이력일련번호*/
							,CIVIL_NO			/*민원접수번호*/
							,PETI_GUBUN			/*민원구분 (500고정,담당자부서지정) */
							,CANCEL_STATUS		/*민원취하여부(Default N)*/
							,PCD_DEPT			/*GCC 부서코드 (접수부서코드)*/
							,PCD_DEPT_NM		/*GCC 부서명 (접수부서명)*/
							,PCD_DUTY_ID		/*접수자명*/
							,PCD_EMAIL			/*접수 이메일 (대표이메일 사용, 감청국, 센터 로 분류)*/
							,PCD_TEL			/*접수자 전화번호 (대표전화 사용: 감청국, 센터로 분류)*/
							,PCD_ORGAN_CODE 	/*실처리기관코드 (감사원 GCC 코드로 고정)*/
							,SRCORGCD			/*소스기관코드 (감사원 GCC 코드로 고정)*/
							,TGTORGCD			/*타겟기관코드 (신문고 GCC 코드로 고정)*/
							,WRITE_TIME			/*등록일자*/
							,SND_RCV_GUBUN		/*송수신구분 (1:송신, 2:수신)*/
							,SND_RCV_TIME		/*송수신일자*/
							,SEND_YN			/*송신여부 (N DEFAULT, EAI 가 송신후 Y로 변경함)*/
						)
				VALUES	(	TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHH24MISSFF2') || LPAD(ROUND(DBMS_RANDOM.VALUE(1, 999999999)), 9, '0')
							,#SMG_FRT_CVPT_APL_GCC_ORG_CD#
							,#SMG_CVPT_APL_NO#
							,#SMG_CAT_HST_SRNO#
							,#SMG_CVPT_ACP_NO#
							,'500'
							,'N'
							,F_DPT_INFO(#FNL_DEAL_DPT_CD#,'6')
							,F_DPT_INFO(#FNL_DEAL_DPT_CD#,'7')
							,F_USR_INFO(#S_CNB#,'2')
							,''
							,'02-2011-2191'
							,'1040000'
							,'1040000'
							,'1140100'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS' )
							,'1'
							,TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
							,'N'
						)
		]]>
	</insert>
	
	<insert id="CSPDCP111EMsg206Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO
			TBDCMACM026L
			(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
	        , MSG_TP_YN
	  
	        , MSG_TXT_2
	        , RCNT_CNT
	        , RCNT_HIS
	        , MSG_REGI_DH
	
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
	
			)
			VALUES
			(
			  (SELECT NVL(MAX(MSG_SNO),0)+1 FROM TBDCMACM026L)
			, 'SP'
			, 'AR'
			, #FNL_USR_ID#
	        , '0'
	     
	        , '공익감사청구사항이 신규 신청되었습니다.'
	        , 1
	        , #RCNT_HIS#
	        , SYSDATE
	        
	        
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
	
			);
			
		]]>
	</insert>
	
	
	<insert id="CSPDCP111EMsgInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MSG_DATA
				 	(	MSG_SEQ
				 		, CUR_STATE
				 		, REQ_DATE
				 		, CALL_TO
				 		, CALL_FROM
				 		, SMS_TXT
				 		, MSG_TYPE
				 		, CONT_SEQ
				 		, USERDATA
				 	) 
			VALUES (	MSG_DATA_SEQ.NEXTVAL
						, 0
						, SYSDATE
						, REPLACE(#HPN#,'-','')
						, '0220112191'
						, ''
						, 6
						, #CONT_SEQ#
						, #REQ_DVSN_CD#||#ACP_YR#||#CVPT_ACP_NO#
					)
		]]>
	</insert>
	
</sqlMap> 
