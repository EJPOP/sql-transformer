<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/513">
 	
 		
	<resultMap class="java.util.HashMap" id="CSPDCP513Map">
	<result property="RSLT_RPRT_HNDL_RSLT_CD" column="RSLT_RPRT_HNDL_RSLT_CD" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="HNDL_DPT_NM" column="HNDL_DPT_NM" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="HNDL_DPT_CD" column="HNDL_DPT_CD" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="HNDL_PEN_ID" column="HNDL_PEN_ID" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="USR_NAM" column="USR_NAM" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="FRT_REGI_DH" column="FRT_REGI_DH" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="INSPC_RSLT_UNQ_TXT" column="INSPC_RSLT_UNQ_TXT" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="DOC_ID" column="DOC_ID" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="REQ_DVSN_CD" column="REQ_DVSN_CD" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="ACP_YR" column="ACP_YR" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="CVPT_ACP_NO" column="CVPT_ACP_NO" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="DGE" column="DGE" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="SMG_CVPT_HNDL_DVSN_CD" column="SMG_CVPT_HNDL_DVSN_CD" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="OPM_NTF_DVSN_CD" column="OPM_NTF_DVSN_CD" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="ANS_TXT" column="ANS_TXT" jdbcType="CLOB"	javaType="java.lang.String" />
	<result property="ANS_DOC_ID" column="ANS_DOC_ID" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="DOC_NM" column="DOC_NM" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="REPORT_YN" column="REPORT_YN" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="ANS_YN" column="ANS_YN" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="HNDL_RSLT_NTF_YN" column="HNDL_RSLT_NTF_YN" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="ACP_RUT_CD" column="ACP_RUT_CD" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="RSLT_NTF_WAY_CD" column="RSLT_NTF_WAY_CD" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="EML_ID" column="EML_ID" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="CVPT_OPM_SRNO" column="CVPT_OPM_SRNO" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="CVPT_OPM_APV_HNDL_STA_CD" column="CVPT_OPM_APV_HNDL_STA_CD" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="ONR_DOC_MNG_CRD_ID" column="ONR_DOC_MNG_CRD_ID" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="REPORT_RESULT_YN" column="REPORT_RESULT_YN" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="REPORT_ONR_APV_RQS_DH" column="REPORT_ONR_APV_RQS_DH" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="REPORT_ONR_APV_CMPT_DH" column="REPORT_ONR_APV_CMPT_DH" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="CD1" column="CD1" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="CD2" column="CD2" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="ONR_APV_CMPT_DH" column="ONR_APV_CMPT_DH" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="CVPT_HNDL_STA_CD" column="CVPT_HNDL_STA_CD" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	<result property="REPORT_CNT" column="REPORT_CNT" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	
	</resultMap>
	<select id="CSPDCP513ETabSelect" parameterClass="paramMap"
		resultMap="CSPDCP513Map">
		<![CDATA[
		SELECT D2.RSLT_RPRT_HNDL_RSLT_CD
		      ,F_DPT_INFO(D1.HNDL_DPT_CD, '1') AS HNDL_DPT_NM
		      ,D1.HNDL_DPT_CD
		      ,D1.HNDL_PEN_ID
		      ,F_USR_INFO_BY_ID(D1.HNDL_PEN_ID,'2') AS USR_NAM
		      ,D1.FRT_REGI_DH
		      ,D1.INSPC_RSLT_UNQ_TXT
		      ,D1.DOC_ID
		      ,D1.REQ_DVSN_CD 
		      ,D1.ACP_YR      
		      ,D1.CVPT_ACP_NO 
		      ,D1.DGE
		      ,D1.SMG_CVPT_HNDL_DVSN_CD
              ,NVL(D1.OPM_NTF_DVSN_CD,'N') AS OPM_NTF_DVSN_CD
              , CASE WHEN D1.ANS_TXT IS NULL THEN (SELECT  Z.CVPT_DOC_TXT
														FROM 	TBCSPDCP203M Z 
														WHERE 	D1.REQ_DVSN_CD = Z.REQ_DVSN_CD
														AND		D1.ACP_YR = Z.ACP_YR
														AND		D1.CVPT_ACP_NO = Z.CVPT_ACP_NO
														AND		D1.DGE = Z.DGE
														AND		Z.CVPT_DOC_DVSN_CD = 'B4')
						ELSE D1.ANS_TXT END AS ANS_TXT
              ,D1.ANS_DOC_ID
		      ,'첨부파일' AS DOC_NM
		      ,CASE WHEN D6.ONR_DOC_MNG_CRD_ID IS NOT NULL THEN 'Y' ELSE 'N' END  AS REPORT_YN
		       ,CASE WHEN D1.OPM_NTF_DVSN_CD ='Y' AND D6.CVPT_OPM_APV_HNDL_STA_CD = '30' THEN 'Y'
		       		WHEN D1.OPM_NTF_DVSN_CD = 'N' THEN 'Y'
		       		ELSE 'N' END AS ANS_YN
				,D1.HNDL_RSLT_NTF_YN
				,D4.ACP_RUT_CD
				,D4.RSLT_NTF_WAY_CD
				,D4.EML_ID
				,D5.CVPT_OPM_SRNO
				,D5.CVPT_OPM_APV_HNDL_STA_CD
				,D5.ONR_DOC_MNG_CRD_ID
				,CASE WHEN D6.CVPT_OPM_APV_HNDL_STA_CD = '30' THEN 'Y'
						ELSE 'N' END AS REPORT_RESULT_YN
				,TO_CHAR(D6.ONR_APV_RQS_DH,'YYYY-MM-DD HH24:MI') AS REPORT_ONR_APV_RQS_DH
				,TO_CHAR(D6.ONR_APV_CMPT_DH,'YYYY-MM-DD HH24:MI') AS REPORT_ONR_APV_CMPT_DH
				,CASE WHEN D2.RSLT_RPRT_HNDL_RSLT_CD IN ('81','82','83') THEN '80'
						ELSE RSLT_RPRT_HNDL_RSLT_CD END AS CD1
				, RSLT_RPRT_HNDL_RSLT_CD AS CD2
				, TO_CHAR(D5.ONR_APV_CMPT_DH,'YYYY-MM-DD HH24:MI') AS ONR_APV_CMPT_DH
				, D4.CVPT_HNDL_STA_CD
				, (	SELECT 	COUNT(*)
					FROM	TBCSPDCP203M Z
					WHERE	Z.REQ_DVSN_CD = D1.REQ_DVSN_CD
					AND		Z.ACP_YR = D1.ACP_YR
					AND		Z.CVPT_ACP_NO = D1.CVPT_ACP_NO
					AND		Z.DGE = D1.DGE
					) AS REPORT_CNT
		  FROM TBCSPDCP401H D1
		      ,TBCSPDCP402L D2
		      ,TBCSPDCP101M D4
		      ,TBCSPDCP301M D5
		      ,TBCSPDCP301M D6
		 WHERE 1=1
		   AND D4.REQ_DVSN_CD = #strREQ_DVSN_CD#
		   AND D4.ACP_YR      = #strACP_YR#
		   AND D4.CVPT_ACP_NO = #strCVPT_ACP_NO#
		   AND D4.REQ_DVSN_CD = D1.REQ_DVSN_CD
		   AND D4.ACP_YR = D1.ACP_YR
		   AND D4.CVPT_ACP_NO = D1.CVPT_ACP_NO
		   AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
		   AND D1.ACP_YR      = D2.ACP_YR
		   AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
		   AND D1.DGE         = D2.DGE
		   AND D1.REQ_DVSN_CD = D5.REQ_DVSN_CD(+)
		   AND D1.ACP_YR      = D5.ACP_YR(+)
		   AND D1.CVPT_ACP_NO = D5.CVPT_ACP_NO(+)
		   AND D1.DGE         = D5.DGE(+)
		   AND D5.CVPT_IFM_DVSN_CD(+) = 'B'
		   AND D1.REQ_DVSN_CD = D6.REQ_DVSN_CD(+)
		   AND D1.ACP_YR      = D6.ACP_YR(+)
		   AND D1.CVPT_ACP_NO = D6.CVPT_ACP_NO(+)
		   AND D1.DGE         = D6.DGE(+)
		   AND D6.CVPT_IFM_DVSN_CD(+) = 'D'
		   ORDER BY D1.DGE
	]]>
	</select>
	
	<!-- 처분요구 조회 -->
	<select id="CSPDCP513EDspSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	REQ_DVSN_CD
					,ACP_YR
					,CVPT_ACP_NO
					,DGE
					,SRNO
					,DSP_ORG_CD
					,DSP_ORG_NM
					,DSP_RQ_KND_CD
					,NOP_CNT
					,PNL_DRIN_PSVT_AM
			FROM	TBCSPDCP405L
			WHERE	REQ_DVSN_CD = #strREQ_DVSN_CD#
			AND		ACP_YR = #strACP_YR#
			AND		CVPT_ACP_NO = #strCVPT_ACP_NO#
			AND		DGE = #strDGE#
		]]>
	</select>
	
	<!-- 관련법령조회 -->
	<select id="CSPDCP513ELawSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT /*CSPDCP512ESelectLawList*/ D1.REQ_DVSN_CD
			      ,D1.ACP_YR
			      ,D1.CVPT_ACP_NO
			      ,D1.DGE
			      ,D1.LAW_HIS_SRNO
			      ,D1.LAW_LNK_ID
			      ,D1.LAW_DTL_TXT
			      , (	SELECT	Z.LAW_NM
						FROM	TBBADCMR013M Z
						WHERE	D1.LAW_LNK_ID = Z.LAW_LNK_ID) AS LAW_NM
			 FROM TBCSPDCP204L D1
			WHERE 1=1
			  AND D1.REQ_DVSN_CD = #strREQ_DVSN_CD#
			  AND D1.ACP_YR      = #strACP_YR#
			  AND D1.CVPT_ACP_NO = #strCVPT_ACP_NO#
			  AND D1.DGE         = #strDGE#
		  ]]>
	</select>
	
	<!-- 위탁기관 조사결과 이력 401 저장 -->
	<insert id="CSPDCP513EInsertTBCSPDCP401H" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO TBCSPDCP401H
		           (	REQ_DVSN_CD
			           ,ACP_YR
			           ,CVPT_ACP_NO
			           ,DGE
			           ,HNDL_DPT_CD
			           ,HNDL_PEN_ID
			           ,INSPC_RSLT_UNQ_TXT
			           ,DOC_ID
			           ,FRT_USR_ID
			           ,FNL_USR_ID
			           ,FNL_DEAL_DPT_CD
			           ,FNL_MNU_ID
			           ,FRT_REGI_DH
			           ,FNL_MDF_DH
		           )
	           VALUES (
			           #REQ_DVSN_CD#
			           ,#ACP_YR#
			           ,#CVPT_ACP_NO#
			           ,#DGE#
			           ,#FNL_DEAL_DPT_CD#
			           ,#FNL_USR_ID#
			           ,#INSPC_RSLT_UNQ_TXT#
			           ,#DOC_ID#
			           ,#FRT_USR_ID#
			           ,#FNL_USR_ID#
			           ,#FNL_DEAL_DPT_CD#
			           ,#FNL_MNU_ID#
			           ,SYSDATE
			           ,SYSDATE
		           )
		           ]]>
	</insert>
	
	
	<!-- 위탁기관 조사결과 이력 401 합건내역 저장 -->
	<insert id="CSPDCP513ESucInsertTBCSPDCP401H" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO TBCSPDCP401H
		           (	REQ_DVSN_CD
			           ,ACP_YR
			           ,CVPT_ACP_NO
			           ,DGE
			           ,HNDL_DPT_CD
			           ,HNDL_PEN_ID
			           ,INSPC_RSLT_UNQ_TXT
			           ,DOC_ID
			           ,FRT_USR_ID
			           ,FNL_USR_ID
			           ,FNL_DEAL_DPT_CD
			           ,FNL_MNU_ID
			           ,FRT_REGI_DH
			           ,FNL_MDF_DH
		           )
			SELECT	SUC_REQ_DVSN_CD
					,SUC_ACP_YR
					,SUC_CVPT_ACP_NO
					,#DGE#
					,#FNL_DEAL_DPT_CD#
					,#FNL_USR_ID#
					,#INSPC_RSLT_UNQ_TXT#
					,#DOC_ID#
		           	,#FRT_USR_ID#
		           	,#FNL_USR_ID#
		           	,#FNL_DEAL_DPT_CD#
		           	,#FNL_MNU_ID#
		           	,SYSDATE
		           	,SYSDATE
			FROM	TBCSPDCP105L
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</insert>
	
	<!-- 위탁기관 조사결과 내역 상세 402 저장 -->
	<insert id="CSPDCP513EInsertTBCSPDCP402L" parameterClass="paramMap">
	<![CDATA[
					INSERT INTO TBCSPDCP402L
				        (REQ_DVSN_CD
				        ,ACP_YR
				        ,CVPT_ACP_NO
				        ,DGE
				        ,RSLT_RPRT_HNDL_RSLT_CD   
				        ,FRT_USR_ID
				        ,FNL_USR_ID
				        ,FNL_DEAL_DPT_CD
				        ,FNL_MNU_ID
				        ,FRT_REGI_DH
				        ,FNL_MDF_DH 
				        )
				        VALUES (
				        #REQ_DVSN_CD#
				        ,#ACP_YR#
				        ,#CVPT_ACP_NO#
				        ,#DGE#
				        ,#RSLT_RPRT_HNDL_RSLT_CD#
				        ,#FRT_USR_ID#
				        ,#FNL_USR_ID#
				        ,#FNL_DEAL_DPT_CD#
				        ,#FNL_MNU_ID#
				        ,SYSDATE
				        ,SYSDATE
				        )
				        ]]>
	
	</insert>
	
	
	<!-- 위탁기관 조사결과 내역 상세 402 합건내역 저장 -->
	<insert id="CSPDCP513ESucInsertTBCSPDCP402L" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPDCP402L
		        (REQ_DVSN_CD
		        ,ACP_YR
		        ,CVPT_ACP_NO
		        ,DGE
		        ,RSLT_RPRT_HNDL_RSLT_CD   
		        ,FRT_USR_ID
		        ,FNL_USR_ID
		        ,FNL_DEAL_DPT_CD
		        ,FNL_MNU_ID
		        ,FRT_REGI_DH
		        ,FNL_MDF_DH 
		        )
			SELECT	SUC_REQ_DVSN_CD
					,SUC_ACP_YR
					,SUC_CVPT_ACP_NO
					,#DGE#
					,#RSLT_RPRT_HNDL_RSLT_CD#
					,#FRT_USR_ID#
			        ,#FNL_USR_ID#
			        ,#FNL_DEAL_DPT_CD#
			        ,#FNL_MNU_ID#
			        ,SYSDATE
			        ,SYSDATE
			FROM	TBCSPDCP105L S1
			WHERE	S1.REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		S1.ACP_YR = #ACP_YR#
			AND		S1.CVPT_ACP_NO = #CVPT_ACP_NO#	
        ]]>
	
	</insert>
	
	<!-- 위탁조사결과 처분요구내역 저장 -->
	<insert id="CSPDCP513E405DspInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	TBCSPDCP405L
					(	REQ_DVSN_CD
						,ACP_YR
						,CVPT_ACP_NO
						,DGE
						,SRNO
						,DSP_ORG_CD
						,DSP_ORG_NM
						,DSP_RQ_KND_CD
						,NOP_CNT
						,PNL_DRIN_PSVT_AM
						,FRT_USR_ID
				        ,FNL_USR_ID
				        ,FNL_DEAL_DPT_CD
				        ,FNL_MNU_ID
				        ,FRT_REGI_DH
				        ,FNL_MDF_DH
					)
			VALUES	(	#REQ_DVSN_CD#
						,#ACP_YR#
						,#CVPT_ACP_NO#
						,#DGE#
						,(	SELECT	NVL(MAX(SRNO)+1,1)
							FROM	TBCSPDCP405L
							WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
							AND		ACP_YR = #ACP_YR#
							AND		CVPT_ACP_NO = #CVPT_ACP_NO#
							AND		DGE = #DGE#
						)
						,#DSP_ORG_CD#
						,#DSP_ORG_NM#
						,#DSP_RQ_KND_CD#
						,#NOP_CNT#
						,#PNL_DRIN_PSVT_AM#	
						,#FRT_USR_ID#
				        ,#FNL_USR_ID#
				        ,#FNL_DEAL_DPT_CD#
				        ,#FNL_MNU_ID#
				        ,SYSDATE
				        ,SYSDATE
				       )
		]]>
	</insert>
	
	<update id="CSPDCP513E405DspUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPDCP405L
			SET		DSP_ORG_CD = #DSP_ORG_CD#
					,DSP_ORG_NM = #DSP_ORG_NM#
					,DSP_RQ_KND_CD = #DSP_RQ_KND_CD#
					,NOP_CNT = #NOP_CNT#
					,PNL_DRIN_PSVT_AM = #PNL_DRIN_PSVT_AM#
					,FNL_USR_ID = #FNL_USR_ID#
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID = #FNL_MNU_ID#
					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
			AND		DGE = #DGE#
			AND		SRNO = #SRNO#
		]]>
	</update>
	
	<delete id="CSPDCP513E405DspDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE
			FROM	TBCSPDCP405L
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
			AND		DGE = #DGE#
			AND		SRNO = #SRNO#
		]]>
	</delete>
	
	<delete id="CSPDCP513EDeleteDgeAll405L" parameterClass="paramMap">
		<![CDATA[
			DELETE
			FROM	TBCSPDCP405L
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
			AND		DGE = #DGE#
		]]>
	</delete>
	
	
</sqlMap> 
