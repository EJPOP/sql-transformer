<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/fpl/003">


	<select id="CSPFPL003WrtQueListSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT D1.QSTNAI_NO         AS QSTNAI_NO			/*질의서번호*/
			     , D1.QSTNAI_YR   AS QSTNAI_YR	/*연도*/
			     , D1.QSTNAI_YR||D1.QSTNAI_NO    AS QSTNAI_YR_NO        /*질의서연번호*/
			     , D1.CMTR_NM   AS CMTR_NM	/*위원명*/
			     , D1.CMT_CD     AS CMT_CD		/*위원회명*/
			     , D1.RQ_DT     AS RQ_DT		/*요구일자*/
			     , D1.SMT_RQ_DT     AS SMT_RQ_DT		/*제출일자*/
			     , D1.NTAS_RQ_MTRL_DVSN_CD     AS MTRL_DVSN_CD		/*자료구분코드*/
			     , D1.RQ_SHP_CD     AS RQ_SHP_CD		/*요구형태코드*/
			     , D1.NTAS_RQ_MTRL_HNDL_STA_CD     AS NTAS_RQ_MTRL_HNDL_STA_CD		/*처리상태코드*/
			     , D1.QSTNAI_TIT_NM     AS QSTNAI_TIT_NM		/*질의서제목*/
			     , D1.SITT_NO     AS SITT_NO		/*회기번호*/
			     , D1.NTAS_SMT_DDLN_DT     AS NTAS_SMT_DDLN_DT		/*국회제출기한*/
			     , D1.RQR_NM     AS RQR_NM		/*요청자명*/
			     , D1.FNL_WRTANS_REGI_DT     AS FNL_WRTANS_REGI_DT		/*답변서등록일자*/
			     , D1.WRTANS_PRSR_NM     AS WRTANS_PRSR_NM		/*답변서제출자명*/
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A1') AS QSTNAIPDF_DOC_ID
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A2') AS QSTNAIHWP_DOC_ID
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A3') AS QSTNAIETC_DOC_ID
		         , ( SELECT ( select COUNT(*)
		                      from tbcspfpl002m C1
		                     where D1.QSTNAI_YR = C1.QSTNAI_YR
		                       and D1.QSTNAI_NO = C1.QSTNAI_NO
		                       and NTAS_RQ_MTRL_HNDL_STA_CD = '50') || '건 / ' || ( SELECT COUNT(*)
		                                                                          FROM TBCSPFPL002M C2
		                                                                         where D1.QSTNAI_YR = C2.QSTNAI_YR
		                                                                           and D1.QSTNAI_NO = C2.QSTNAI_NO)||'건' as CNT
		             FROM DUAL) as CNT
			  FROM TBCSPFPL001M D1
			  where 1=1
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strYear">
				D1.QSTNAI_YR =
				#strYear#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnai">
				D1.QSTNAI_NO LIKE '%'||#strQstnai#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnaiTitleNm">
				D1.QSTNAI_TIT_NM LIKE '%'||#strQstnaiTitleNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtrNm">
				D1.CMTR_NM LIKE '%'||#strCmtrNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strSittNo">
				D1.SITT_NO LIKE '%'||#strSittNo#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqrNm">
				D1.RQR_NM LIKE '%'||#strRqrNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtFrom">
				D1.RQ_DT >
				#strRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtTo">
				D1.RQ_DT &lt;
				#strRqDtTo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtCd">
				D1.CMT_CD = #strCmtCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strMtrlDvsnCd">
				D1.NTAS_RQ_MTRL_DVSN_CD =
				#strMtrlDvsnCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqShpCd">
				D1.RQ_SHP_CD =
				#strRqShpCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strNtasRqMtrlHndlStaCd">
				D1.NTAS_RQ_MTRL_HNDL_STA_CD = #strNtasRqMtrlHndlStaCd#
			</isNotEmpty>
		</dynamic>
		<![CDATA[       
			ORDER BY D1.QSTNAI_NO ASC
		]]>
	</select>

	<resultMap class="java.util.HashMap" id="hwpDocMap">
		
		<result property="TOTAL_ANS_NO" column="TOTAL_ANS_NO" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="QSTNAI_YR" column="QSTNAI_YR" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="QSTNAI_NO" column="QSTNAI_NO" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="DTIL_ANS_NO" column="DTIL_ANS_NO" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="DTIL_DVSN_NO" column="DTIL_DVSN_NO" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="CHGR_NM" column="CHGR_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="CHGR_ID" column="CHGR_ID" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="CHR_DPT_NM" column="CHR_DPT_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="DTIL_QUE_TIT_NM" column="DTIL_QUE_TIT_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="QUE_TXT" column="QUE_TXT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="CMTR_NM" column="CMTR_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="RQ_DT" column="RQ_DT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="SMT_RQ_DT" column="SMT_RQ_DT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="SMT_DT" column="SMT_DT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="HWP_BUT" column="HWP_BUT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="NTAS_RQ_MTRL_HNDL_STA_CD" column="NTAS_RQ_MTRL_HNDL_STA_CD" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="QSTNAIPDF_DOC_ID" column="QSTNAIPDF_DOC_ID" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="QSTNAIHWP_DOC_ID" column="QSTNAIHWP_DOC_ID" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="QSTNAIETC_DOC_ID" column="QSTNAIETC_DOC_ID" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="HWP_DOC_ID" column="HWP_DOC_ID" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="ETC_DOC_ID" column="ETC_DOC_ID" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
			<result property="HWP_TEXT" column="HWP_TEXT" jdbcType="CLOB"
			javaType="java.lang.String" />
	</resultMap>

	<!-- 질의서목록 조회 -->
	<select id="CSPFPL003GtrPopUpSelect" parameterClass="paramMap"
		resultMap="hwpDocMap">
        <![CDATA[       
			SELECT D2.QSTNAI_YR||'-'||D2.QSTNAI_NO||'-'||D2.DTIL_ANS_NO||'-'||D2.DTIL_DVSN_NO         AS TOTAL_ANS_NO			/*세부질의번호*/
			     , D2.QSTNAI_YR   AS QSTNAI_YR  	/*질의서년도*/
			     , D2.QSTNAI_NO   AS QSTNAI_NO  	/*질의서번호*/
			     , D2.DTIL_ANS_NO   AS DTIL_ANS_NO  	/*세부답변번호*/
			     , D2.DTIL_DVSN_NO   AS DTIL_DVSN_NO  	/*세부구분번호*/
			     , D2.CHGR_NM   AS CHGR_NM  	/*담당자명*/
			     , D2.CHGR_ID   AS CHGR_ID  	/*담당자ID*/
			     , D2.CHR_DPT_NM    AS CHR_DPT_NM        /*담당부서명*/
			     , D2.DTIL_QUE_TIT_NM   AS DTIL_QUE_TIT_NM	/*세부질의제목*/
			     , D2.QUE_TXT     AS QUE_TXT		/*질의내용*/
			     , D2.ANS_MTRL_TXT     AS HWP_TEXT		/*답변내용*/
			     , D2.SMT_DT     AS SMT_DT		/*제출일자*/
			     , '답변자료' AS HWP_BUT 			/*답변자료 버튼 명*/
			     , F_CODE_NM ('1000374',decode(D2.NTAS_RQ_MTRL_HNDL_STA_CD, '20', '30', D2.NTAS_RQ_MTRL_HNDL_STA_CD)) AS NTAS_RQ_MTRL_HNDL_STA_CD /*처리상태코드*/
		        ,( SELECT Z1.CMTR_NM
		             FROM TBCSPFPL001M Z1
		            WHERE Z1.QSTNAI_YR=D2.QSTNAI_YR
		              and Z1.QSTNAI_NO=D2.QSTNAI_NO) AS CMTR_NM /*위원명*/,
		        ( SELECT Z1.RQ_DT
		             FROM TBCSPFPL001M Z1
		            WHERE Z1.QSTNAI_YR=D2.QSTNAI_YR
		              and Z1.QSTNAI_NO=D2.QSTNAI_NO) AS RQ_DT /*요청일자*/,
		        ( SELECT Z1.SMT_RQ_DT
		             FROM TBCSPFPL001M Z1
		            WHERE Z1.QSTNAI_YR=D2.QSTNAI_YR
		              and Z1.QSTNAI_NO=D2.QSTNAI_NO) AS SMT_RQ_DT /*제출일자*/,
		        ( SELECT D6.DOC_ID AS DOC_ID
		             FROM TBCSPFPL006M D6
		            WHERE D2.QSTNAI_YR=D6.QSTNAI_YR
		              and D2.QSTNAI_NO=D6.QSTNAI_NO
		              AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A1') AS QSTNAIPDF_DOC_ID,
		        ( SELECT D6.DOC_ID AS DOC_ID
		             FROM TBCSPFPL006M D6
		            WHERE D2.QSTNAI_YR=D6.QSTNAI_YR
		              and D2.QSTNAI_NO=D6.QSTNAI_NO
		              AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A2') AS QSTNAIHWP_DOC_ID,
		        ( SELECT D6.DOC_ID AS DOC_ID
		             FROM TBCSPFPL006M D6
		            WHERE D2.QSTNAI_YR=D6.QSTNAI_YR
		              and D2.QSTNAI_NO=D6.QSTNAI_NO
		              AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A3') AS QSTNAIETC_DOC_ID,
		        ( SELECT D7.DOC_ID AS DOC_ID
		             FROM TBCSPFPL007M D7
		            WHERE D2.QSTNAI_YR=D7.QSTNAI_YR
		              and D2.QSTNAI_NO=D7.QSTNAI_NO
		              and D2.DTIL_ANS_NO=D7.DTIL_ANS_NO
		              and D2.DTIL_DVSN_NO=D7.DTIL_DVSN_NO
		              AND D7.NTAS_RQ_MTRL_DOC_KND_CD = 'B1') AS HWP_DOC_ID,
		        ( SELECT D7.DOC_ID AS DOC_ID
		             FROM TBCSPFPL007M D7
		            WHERE D2.QSTNAI_YR=D7.QSTNAI_YR
		              and D2.QSTNAI_NO=D7.QSTNAI_NO
		              and D2.DTIL_ANS_NO=D7.DTIL_ANS_NO
		              and D2.DTIL_DVSN_NO=D7.DTIL_DVSN_NO
		              AND D7.NTAS_RQ_MTRL_DOC_KND_CD = 'B2') AS ETC_DOC_ID
			  FROM TBCSPFPL002M D2
			  where 1=1
				AND QSTNAI_YR=#strQstnaiYr#
				AND QSTNAI_NO=#strQstnaiNo#
				order by D2.DTIL_ANS_NO asc
		]]>
	</select>
	
	<!-- 질의서목록 조회 -->
	<select id="CSPFPL003GtrPopUpFrfSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT D1.QSTNAI_NO         AS QSTNAI_NO			/*질의서번호*/
			     , D1.QSTNAI_YR   AS QSTNAI_YR	/*연도*/
			     , D1.QSTNAI_YR||'-'||D1.QSTNAI_NO    AS QSTNAI_YR_NO        /*질의서연번호*/
			     , D1.CMTR_NM   AS CMTR_NM	/*위원명*/
			     , D1.RQ_DT     AS RQ_DT		/*요구일자*/
			     , D1.SMT_RQ_DT     AS SMT_RQ_DT		/*제출일자*/
			     , F_CODE_NM ('1000374',D1.NTAS_RQ_MTRL_HNDL_STA_CD)     AS NTAS_RQ_MTRL_HNDL_STA_CD		/*처리상태코드*/
			     , D1.QSTNAI_TIT_NM     AS QSTNAI_TIT_NM		/*질의서제목*/
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A1') AS QSTNAIPDF_DOC_ID
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A2') AS QSTNAIHWP_DOC_ID
			     , (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A3') AS QSTNAIETC_DOC_ID
			  FROM TBCSPFPL001M D1
			  
			  where 1=1	
				AND QSTNAI_YR=#strQstnaiYr#
				AND QSTNAI_NO=#strQstnaiNo# 
			  ]]> 
	</select>		

	<update id="CSPFPL010mainupdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL002M
		SET FNL_MDF_DH = SYSDATE
			 , RET_RSN_TXT = #RET_RSN_TXT#
			 , NTAS_RQ_MTRL_HNDL_STA_CD = #NTAS_RQ_MTRL_HNDL_STA_CD#
	 		, FNL_USR_ID = #FNL_USR_ID#
			, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			, WRTANS_NO = #WRTANS_NO#
		WHERE 1 = 1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
		AND DTIL_ANS_NO = #DTIL_ANS_NO#
		AND DTIL_DVSN_NO = #DTIL_DVSN_NO#
		]]>
	</update>	


	<resultMap class="java.util.HashMap" id="hwpDocMap1">
		<result property="GTR_TXT" column="GTR_TXT" jdbcType="CLOB"
			javaType="java.lang.String" />
		<result property="WRTANS_TXT" column="WRTANS_TXT" jdbcType="CLOB"
			javaType="java.lang.String" />
		<result property="QSTNAI_YR" column="QSTNAI_YR" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="QSTNAI_NO" column="QSTNAI_NO" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="WRTANS_NO" column="WRTANS_NO" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="CHR_DPT_INF_TXT" column="CHR_DPT_INF_TXT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="CHGR_NM" column="CHGR_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="SMT_TIT_NM" column="SMT_TIT_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="WRTANS_PRSR_NM" column="WRTANS_PRSR_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="WRTANS_REGI_DT" column="WRTANS_REGI_DT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="NTAS_RQ_MTRL_HNDL_STA_CD" column="NTAS_RQ_MTRL_HNDL_STA_CD" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="ECM_DOC_ID" column="ECM_DOC_ID" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
	</resultMap>

	<!-- 질의서목록 조회 -->
	<select id="CSPFPL008mainSelect" parameterClass="paramMap"
		resultMap="hwpDocMap1">
        <![CDATA[       
			SELECT  D3.QSTNAI_YR   AS QSTNAI_YR  	/*질의서년도*/
			     , D3.QSTNAI_NO   AS QSTNAI_NO  	/*질의서번호*/
			     , D3.WRTANS_NO   AS WRTANS_NO  	/*답변서번호*/
			     , D3.CHR_DPT_INF_TXT   AS CHR_DPT_INF_TXT  	/*담당부서정보내용*/
			     , D3.CHGR_NM    AS CHGR_NM        /*담당자*/
			     , D3.SMT_TIT_NM   AS SMT_TIT_NM	/*제출제목명*/
			     , D3.WRTANS_PRSR_NM     AS WRTANS_PRSR_NM		/*답변서제출자명*/
			     , D3.WRTANS_TXT     AS WRTANS_TXT		/*답변자료내용*/
			     , D3.WRTANS_REGI_DT     AS WRTANS_REGI_DT		/*답변서등록일*/
			     , D3.GTR_TXT     AS GTR_TXT		/*취합내용*/
			     , F_CODE_NM ('1000374',decode(D3.NTAS_RQ_MTRL_HNDL_STA_CD, '20', '30', D3.NTAS_RQ_MTRL_HNDL_STA_CD)) AS NTAS_RQ_MTRL_HNDL_STA_CD /*처리상태코드*/
		         , ( SELECT D8.DOC_ID AS DOC_ID
		             FROM TBCSPFPL008M D8
		            WHERE D3.QSTNAI_YR=D8.QSTNAI_YR
		              and D3.QSTNAI_NO=D8.QSTNAI_NO
		              and D3.WRTANS_NO=D8.WRTANS_NO
		              AND D8.NTAS_RQ_MTRL_DOC_KND_CD = 'C1') AS ECM_HWP_DOC_ID
		         , ( SELECT D8.DOC_ID AS DOC_ID
		             FROM TBCSPFPL008M D8
		            WHERE D3.QSTNAI_YR=D8.QSTNAI_YR
		              and D3.QSTNAI_NO=D8.QSTNAI_NO
		              and D3.WRTANS_NO=D8.WRTANS_NO
		              AND D8.NTAS_RQ_MTRL_DOC_KND_CD = 'C2') AS ECM_DOC_ID		              
			  FROM TBCSPFPL003M D3
			  where 1=1
				AND QSTNAI_YR=#strQstnaiYr#
				AND QSTNAI_NO=#strQstnaiNo#
				order by D3.WRTANS_NO desc
		]]>
	</select>
	
	<select id="CSPFPL003MaxWrtAnsSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT LPAD(NVL(MAX(TO_NUMBER(WRTANS_NO)),0)+1,3,0) AS MAX_SEQ
				  FROM TBCSPFPL003M
				 WHERE 1=1
				   AND QSTNAI_YR               = #QSTNAI_YR# 
				   AND QSTNAI_NO               = #QSTNAI_NO# 
		]]>
	</select>
	
	<!-- 답변서 등록 -->
	<insert id="CSPFPL008MainInsert" parameterClass="paramMap">
		INSERT INTO
		TBCSPFPL003M
		(
		QSTNAI_YR
		,QSTNAI_NO
		,WRTANS_NO
		,SMT_TIT_NM
		,WRTANS_TXT
		,GTR_TXT
		,WRTANS_REGI_DT
		,CHR_DPT_INF_TXT
		,NTAS_RQ_MTRL_HNDL_STA_CD
		,WRTANS_PRSR_NM
		,FNL_USR_ID
		,FNL_DEAL_DPT_CD
		,FNL_MNU_ID
		,FRT_REGI_DH
		,FNL_MDF_DH
		,FRT_USR_ID
		)
		VALUES
		(
		#QSTNAI_YR#
		,#QSTNAI_NO#
		,#WRTANS_NO#
		,#SMT_TIT_NM#
		,#WRTANS_TXT#
		,#GTR_TXT#
		,#WRTANS_REGI_DT#
		,#CHR_DPT_INF_TXT#
		,#NTAS_RQ_MTRL_HNDL_STA_CD#
		,#WRTANS_PRSR_NM#
		,#FNL_USR_ID#
		,#FNL_DEAL_DPT_CD#
		,#FNL_MNU_ID#
		, SYSDATE
		, SYSDATE
		,#FRT_USR_ID#
		)
	</insert>
	
	<update id="CSPFPL008MainUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL003M
		SET FNL_MDF_DH = SYSDATE
			 , SMT_TIT_NM = #SMT_TIT_NM#
			 , WRTANS_TXT = #WRTANS_TXT#
			 , GTR_TXT = #GTR_TXT#
			 , WRTANS_REGI_DT = #WRTANS_REGI_DT#
			 , FNL_WRTANS_REGI_DT = #FNL_WRTANS_REGI_DT#
			 , CHR_DPT_INF_TXT = #CHR_DPT_INF_TXT#
			 , NTAS_RQ_MTRL_HNDL_STA_CD = #NTAS_RQ_MTRL_HNDL_STA_CD#
	 		, FNL_USR_ID = #FNL_USR_ID#
			, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		WHERE 1 = 1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
		AND WRTANS_NO=#WRTANS_NO#
		]]>
	</update>
	
	<insert id="CSPFPL008EcmFileInsert" parameterClass="paramMap">
	       <![CDATA[
	       	INSERT INTO TBCSPFPL008M
	       	(
	       			QSTNAI_NO,			/*질의서번호*/
	       			QSTNAI_YR,		/*질의서연도*/
	       			WRTANS_NO,		/*질의서연도*/
	       			NTAS_RQ_MTRL_DOC_KND_CD,		/*국회요구자료문서구분코드*/
	       			DOC_ID,			/*문서코드*/
  					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH,
					FRT_USR_ID
	       	) VALUES (
	       			#QSTNAI_NO#,
				    #QSTNAI_YR#,
				    #WRTANS_NO#,
	        		'C2',
	        		#DOC_ID#,
      				#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE,
					#FNL_USR_ID#
	       	)
	       ]]>
	</insert>				

	<insert id="CSPFPL008EcmHwpFileInsert" parameterClass="paramMap">
	       <![CDATA[
	       	INSERT INTO TBCSPFPL008M
	       	(
	       			QSTNAI_NO,			/*질의서번호*/
	       			QSTNAI_YR,		/*질의서연도*/
	       			WRTANS_NO,		/*질의서연도*/
	       			NTAS_RQ_MTRL_DOC_KND_CD,		/*국회요구자료문서구분코드*/
	       			DOC_ID,			/*문서코드*/
  					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH,
					FRT_USR_ID
	       	) VALUES (
	       			#QSTNAI_NO#,
				    #QSTNAI_YR#,
				    #WRTANS_NO#,
	        		'C1',
	        		#DOC_ID#,
      				#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE,
					#FNL_USR_ID#
	       	)
	       ]]>
	</insert>		
	
	<update id="CSPFPL008EcmHwpFileUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL008M
		SET DOC_ID = #DOC_ID#
		WHERE 1 = 1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
		AND WRTANS_NO=#WRTANS_NO#
		AND NTAS_RQ_MTRL_DOC_KND_CD= 'C1'
		]]>
	</update>	

	<update id="CSPFPL008StatusUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL003M
		SET FNL_MDF_DH = SYSDATE
			 , NTAS_RQ_MTRL_HNDL_STA_CD = #NTAS_RQ_MTRL_HNDL_STA_CD#
	 		, FNL_USR_ID = #FNL_USR_ID#
			, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		WHERE 1 = 1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
		]]>
	</update>	
	
	<update id="CSPFPL008StatusUpdate2" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL002M
		SET FNL_MDF_DH = SYSDATE
			 , NTAS_SMT_HNDL_STA_CD = '30'
	 		, FNL_USR_ID = #FNL_USR_ID#
			, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		WHERE 1 = 1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
		]]>
	</update>	
	
	<!-- 질의서메인정보상태 수정(취합중,제출,완료) -->
	<update id="CSPFPL008WrtQueMainStatusUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL001M
		SET FNL_MDF_DH = SYSDATE
			 ,NTAS_RQ_MTRL_HNDL_STA_CD = #NTAS_RQ_MTRL_HNDL_STA_CD#
			 ,WRTANS_PRSR_NM = #WRTANS_PRSR_NM#
			 ,FNL_WRTANS_REGI_DT = #FNL_WRTANS_REGI_DT#
		WHERE 1 = 1
		AND QSTNAI_NO=#QSTNAI_NO#
		AND QSTNAI_YR=#QSTNAI_YR#
		]]>
	</update>	

	<!-- 질의서메인정보상태 수정(취합중,제출,완료) -->
	<update id="CSPFPL008WrtQueAnsUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL002M
		SET 
			 WRTANS_NO = #WRTANS_NO#
		WHERE 1 = 1
		AND QSTNAI_YR||'-'||QSTNAI_NO||'-'||DTIL_ANS_NO||'-'||DTIL_DVSN_NO=#TOTAL_ANS_NO#
		]]>
	</update>	

	<select id="CSPFPL008CurByMaxCntSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
		SELECT ( select COUNT(*)
		            from tbcspfpl002m
		           where qstnai_yr = #strQstnaiYr#
		             and qstnai_no = #strQstnaiNo#
		             and NTAS_RQ_MTRL_HNDL_STA_CD = '50') || '/' || ( SELECT COUNT(*)
		                                                                FROM TBCSPFPL002M
		                                                               where qstnai_yr = #strQstnaiYr#
		                                                                 and qstnai_no = #strQstnaiNo#) AS BB
		   FROM DUAL;
		]]>
	</select>
</sqlMap> 