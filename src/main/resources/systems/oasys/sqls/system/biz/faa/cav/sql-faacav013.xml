<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/cav/013"> 

	<parameterMap id="prcAmCCountParm" class="java.util.HashMap">
		<parameter property="p_prov_year"		jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="p_prov_mon"		jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="p_gye_gubun"		jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="p_from_sokwan"		jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="p_to_sokwan"		jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />		
		<parameter property="vRetCode"	        jdbcType="VARCHAR"	javaType="java.lang.String" mode="OUT" />
		<parameter property="vUserMessage"	    jdbcType="VARCHAR"	javaType="java.lang.String" mode="OUT" />		
	</parameterMap>
		
	<!-- 세입징수액계산서내역_외-->
	<procedure id="FAACAV013EMainCreate1" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate1 */ ]]>
		{ CALL BTJ_AA_AV_005_02(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
	
	<!-- 세입징수액계산서(세)-->		
	<procedure id="FAACAV013EMainCreate2" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate2 */ ]]>
		{ CALL BTJ_AA_AV_005_01(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
	
	<!-- 환급금지급액계산서-->		
	<procedure id="FAACAV013EMainCreate3" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate3 */ ]]>
		{ CALL BTJ_AA_AV_005_05(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
	
	<!-- 환급금결정액계산서-->		
	<procedure id="FAACAV013EMainCreate4" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate4 */ ]]>
		{ CALL BTJ_AA_AV_005_06(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
	
	<!-- 지출계산서-->		
	<procedure id="FAACAV013EMainCreate5" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate5 */ ]]>
		{ CALL BTJ_AA_AV_005_03(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
			
	<!-- 관서운영경비출납계산서-->		
	<procedure id="FAACAV013EMainCreate6" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate6 */ ]]>
		{ CALL BTJ_AA_AV_005_04(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
	
	<!-- 선사용자금명령액계산서-->		
	<procedure id="FAACAV013EMainCreate7" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate7 */ ]]>
		{ CALL BTJ_AA_AV_005_12(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
	
	<!-- 기금수입계산서-->		
	<procedure id="FAACAV013EMainCreate8" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate8 */ ]]>
		{ CALL BTJ_AA_AV_005_07(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
	
	<!-- 기금지출계산서-->		
	<procedure id="FAACAV013EMainCreate9" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate9 */ ]]>
		{ CALL BTJ_AA_AV_005_08(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
			
	<!-- 기금관서운영경비출납계산서-->		
	<procedure id="FAACAV013EMainCreate10" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate10 */ ]]>
		{ CALL BTJ_AA_AV_005_10(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
	
	<!-- 선사용자금관서운영경비출납계산서-->		
	<procedure id="FAACAV013EMainCreate11" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate11 */ ]]>
		{ CALL BTJ_AA_AV_005_11(?, ?, ?, ?, ?, ?, ?) }
	</procedure>
	
	<!-- 수입대체경비출납계산서-->		
	<procedure id="FAACAV013EMainCreate12" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainCreate12 */ ]]>
		{ CALL BTJ_AA_AV_005_09(?, ?, ?, ?, ?, ?, ?) }
	</procedure>		
	
	<!--월계자료재구축 미존재계좌내역 조회-->
	<select id="FAACAV013EMainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/013/FAACAV013EMainselect */ ]]>
		<include refid="include.pageSelct" />
       <![CDATA[       
            SELECT   ROWNUM AS KEY, 
            		 F_AV_BLL_CD_NM(BLL_CD, DL_XPN_RCDB_PBSVT_SRNO) AS BLLNM ,F_COPT_NM(COPT_CD) AS COPTNM, F_AV_ACNT_CD_NM(ACNT_CD) AS ACNTNM,
                      F_AV_ACCMN_NM(COPT_CD,ACNT_CD,BLL_CD,PROF_DRTR_SRNO,DL_XPN_RCDB_PBSVT_SRNO) AS ORGNM,
                      COPT_CD||'-'||ACNT_CD||'-'||BLL_CD||'-'||PROF_DRTR_SRNO||'-'|| DL_XPN_RCDB_PBSVT_SRNO AS PROF_DRTR_SRNO,PROF_YM
            FROM    TWFAACAV001M hn
            WHERE    PROF_YM = #strYm#
            AND    BLL_HNDL_STA_CD <> 'S'  
       ]]>
       <isEqual property="strBllDvsn" compareValue="11">           
            AND exists ( SELECT 'x' FROM TWFAACAV053L rc
       </isEqual> 
       <isEqual property="strBllDvsn" compareValue="12">           
            AND exists ( SELECT 'x' FROM TWFAACAV055L rc
       </isEqual>
       <isEqual property="strBllDvsn" compareValue="15">           
            AND exists ( SELECT 'x' FROM TWFAACAV051L rc
       </isEqual> 
       <isEqual property="strBllDvsn" compareValue="16">           
            AND exists ( SELECT 'x' FROM TWFAACAV018L rc
       </isEqual>
       <isEqual property="strBllDvsn" compareValue="17">           
            AND exists ( SELECT 'x' FROM TWFAACAV048L rc
       </isEqual> 
       <isEqual property="strBllDvsn" compareValue="18">           
            AND exists ( SELECT 'x' FROM TWFAACAV029L rc
       </isEqual>
       <isEqual property="strBllDvsn" compareValue="19">           
            AND exists ( SELECT 'x' FROM TWFAACAV059L rc
       </isEqual> 
       <isEqual property="strBllDvsn" compareValue="21">           
            AND exists ( SELECT 'x' FROM TWFAACAV026L rc
       </isEqual>
       <isEqual property="strBllDvsn" compareValue="22">           
            AND exists ( SELECT 'x' FROM TWFAACAV027L rc
       </isEqual> 
       <isEqual property="strBllDvsn" compareValue="23">           
            AND exists ( SELECT 'x' FROM TWFAACAV028L rc
       </isEqual>
       <isEqual property="strBllDvsn" compareValue="25">           
            AND exists ( SELECT 'x' FROM TWFAACAV030L rc
       </isEqual> 
       <isEqual property="strBllDvsn" compareValue="29">           
            AND exists ( SELECT 'x' FROM TWFAACAV034L rc
       </isEqual>
       <![CDATA[                                 
                    WHERE   rc.SUM_DVSN_ID = '51'
                    AND     rc.PROF_YM = hn.PROF_YM
                    AND     rc.COPT_CD = hn.COPT_CD
                    AND     rc.ACNT_CD = hn.ACNT_CD
                    AND     rc.BLL_CD = hn.BLL_CD
                    AND     rc.PROF_DRTR_SRNO = hn.PROF_DRTR_SRNO
                    AND     rc.DL_XPN_RCDB_PBSVT_SRNO = hn.DL_XPN_RCDB_PBSVT_SRNO)
        ]]>            
		<isEqual property="strBllDvsn" compareValue="18">                    
		    AND NOT EXISTS ( SELECT 'x' FROM    TWFAACAV016M rc /*검산오류내역*/
		          WHERE     rc.HNDL_STA_YN = 'Y' 
		            AND     rc.PROF_YM = hn.PROF_YM
		            AND     rc.COPT_CD = hn.COPT_CD
		            AND     rc.ACNT_CD = hn.ACNT_CD
		            AND     rc.BLL_CD = hn.BLL_CD
		            AND     rc.PROF_DRTR_SRNO = hn.PROF_DRTR_SRNO
		            AND     rc.DL_XPN_RCDB_PBSVT_SRNO &lt;&gt; '000')  
	     </isEqual>	 
		<isEqual property="strBllDvsn" compareValue="21">                    
		    AND NOT EXISTS ( SELECT 'x' FROM    TWFAACAV016M rc /*검산오류내역*/
		          WHERE     rc.HNDL_STA_YN = 'Y' 
		            AND     rc.PROF_YM = hn.PROF_YM
		            AND     rc.COPT_CD = hn.COPT_CD
		            AND     rc.ACNT_CD = hn.ACNT_CD
		            AND     rc.BLL_CD = hn.BLL_CD
		            AND     rc.PROF_DRTR_SRNO = hn.PROF_DRTR_SRNO
		            AND        rc.DL_XPN_RCDB_PBSVT_SRNO = hn.DL_XPN_RCDB_PBSVT_SRNO)
	     </isEqual>	
		<isEqual property="strBllDvsn" compareValue="23">                    
		    AND NOT EXISTS ( SELECT 'x' FROM    TWFAACAV016M rc /*검산오류내역*/
		          WHERE     rc.HNDL_STA_YN = 'Y' 
		            AND     rc.PROF_YM = hn.PROF_YM
		            AND     rc.COPT_CD = hn.COPT_CD
		            AND     rc.ACNT_CD = hn.ACNT_CD
		            AND     rc.BLL_CD = hn.BLL_CD
		            AND     rc.PROF_DRTR_SRNO = hn.PROF_DRTR_SRNO
		            AND        rc.DL_XPN_RCDB_PBSVT_SRNO &lt;&gt; '000') 
	     </isEqual>	
	     <![CDATA[    	     	                                
            AND NOT EXISTS(SELECT 'x' FROM TWFAACAV062L rm  /*국고계좌내역*/
                 WHERE  rm.ACNT_YR = #strYr#
                   AND  rm.COPT_CD = hn.COPT_CD
                   AND  rm.ACNT_CD = hn.ACNT_CD
                   AND  rm.BLL_CD = hn.BLL_CD
                   AND  rm.PROF_DRTR_SRNO = hn.PROF_DRTR_SRNO
                   AND  rm.DL_XPN_RCDB_PBSVT_SRNO = hn.DL_XPN_RCDB_PBSVT_SRNO)
            AND   hn.COPT_CD between #strSokwanFrom# and #strSokwanTo#         
		
		]]>		
	<include refid="include.pageOrder" />
	ORDER BY PROF_DRTR_SRNO
	</select>
		

	
</sqlMap> 
