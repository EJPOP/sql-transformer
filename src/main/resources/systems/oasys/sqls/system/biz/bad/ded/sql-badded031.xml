<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ded/031">


	
	<!-- #################################### 개인내역(국내여행비 등) 시작 ################################# -->
	
	<select id="BADDED031Qselect1_1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CNB,
			       USR_NAM,
			       DPT_CD,
			       F_DPT_INFO(USR.DPT_CD,'1') DPT_NM,
			       F_CODE_NM('1000173',USR.RANK_CD) POS_RANK_CD_NM      
			  FROM TBDCMACM001M USR
			  WHERE CNB = #strUserCnb#
        ]]>
	</select>	
	
	<select id="BADDED031Qselect1_2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
		SELECT SITU.BZT_YR||'-'||SITU.BZT_SNO BZT_YR_BZT_SNO,
		       F_CODE_NM('1000021',SITU.GEN_BZT_KND_CD) GEN_TRIP_CATE_NM,
		       SITU.TIT_TXT,
		       TE.BZT_STR_DT,
		       TE.BZT_END_DT,
		       TE.BZT_DCN,
		       TE.LODG_DCN,
		       TE.FDEX,
		       TE.DT_EXS,
		       TE.LDC,
		       NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS,0) AS RL_FR_EXS,
		       '' STT_RMK_EXP,
		       TE.FDEX + TE.DT_EXS + TE.LDC + NVL(TFD.RL_FR_EXS, 0) +  NVL(TE.CPRG_FR_EXS,0)   AS SUM_ALL
		  FROM TBBADDED002M SITU,
		       (SELECT BZT_YR,
		               BZT_SNO,
		               PCT_CNB,
		               MIN(BZT_STR_DT) AS BZT_STR_DT,
		               MAX(BZT_END_DT) AS BZT_END_DT,
		               SUM(BZT_DCN) AS BZT_DCN,
		               SUM(LODG_DCN) AS LODG_DCN,
		               SUM(FDEX) AS FDEX,
		               SUM(DT_EXS) AS DT_EXS,
		               SUM(LDC) AS LDC,
		               SUM(CPRG_FR_EXS) AS CPRG_FR_EXS /*수도권운임비 추가 - 2015.05.11 yyh*/
		          FROM TBBADDED011L
		         WHERE 1=1
		           AND PCT_CNB = #strUserCnb# /*전산번호*/
		           AND BZT_STR_DT >= #strBztStrDt#  /*화면 출장일자 FROM*/
		           AND BZT_END_DT <= #strBztEndDt#  /*화면 출장일자 TO*/
		           AND FNL_YN = 'Y'
		         GROUP BY BZT_YR,
		               BZT_SNO,
		               PCT_CNB) TE,
		       (SELECT BZT_YR,
		               BZT_SNO,
		               PCT_CNB,
		               SUM(RL_FR_EXS) AS RL_FR_EXS
		          FROM TBBADDED017L
		         WHERE 1=1
		           AND PCT_CNB = #strUserCnb# /*전산번호*/
		           AND FNL_YN = 'Y'
		         GROUP BY BZT_YR,
		               BZT_SNO,
		               PCT_CNB) TFD
		 WHERE 1=1
		   AND TE.PCT_CNB = #strUserCnb# /*전산번호*/
		   AND TFD.BZT_YR(+) = TE.BZT_YR
		   AND TFD.BZT_SNO(+) = TE.BZT_SNO
		   AND TFD.PCT_CNB (+) = TE.PCT_CNB
		   AND SITU.BZT_YR = TE.BZT_YR
		   AND SITU.BZT_SNO = TE.BZT_SNO
		   AND SITU.BZT_DVSN_CD = '2'  /*일반출장*/
        ]]>
	</select>	
	
	
</sqlMap> 

