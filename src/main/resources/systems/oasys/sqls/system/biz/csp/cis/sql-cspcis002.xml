<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/cis/002">

	<resultMap class="java.util.HashMap" id="CSPCIS008PMainSelect">
		<result property="INSP_REGI_DT" column="INSP_REGI_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_REGI_NO" column="INSP_REGI_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_LVL_CNT" column="INSP_LVL_CNT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DVSN_CD" column="INSP_DVSN_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_TIT_ENN" column="INSP_TIT_ENN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ENTX" column="INSP_ENTX" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ECN" column="INSP_ECN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_EID" column="INSP_USR_EID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_NAM" column="INSP_USR_NAM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ATT_FL_EID" column="INSP_ATT_FL_EID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DOC_TYP_CD" column="INSP_DOC_TYP_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="STA_YN" column="STA_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	<select id="CSPCIS008PMainSelect" parameterClass="paramMap" resultMap="CSPCIS008PMainSelect">
		<![CDATA[
			 SELECT A.INSP_REGI_DT,
			        A.INSP_REGI_NO,
			        A.INSP_LVL_CNT,
			        A.INSP_DVSN_CD,
			        A.INSP_TIT_ENN,
			        A.INSP_ENTX,
			        A.INSP_ECN,
			        A.INSP_USR_EID,
			        A.INSP_USR_NAM,
			        A.INSP_ATT_FL_EID,
			        A.INSP_DOC_TYP_CD,
			        A.STA_YN
			   FROM TBCSPCIS001M A
			  WHERE 1=1
			  AND (A.INSP_ECN = #cnb#
			  OR (A.INSP_REGI_DT , A.INSP_REGI_NO) 
			  IN (SELECT  A.INSP_REGI_DT , A.INSP_REGI_NO  FROM TBCSPCIS001M A WHERE A.INSP_ECN = #cnb#))
			 ORDER	BY INSP_REGI_DT DESC, INSP_REGI_NO DESC, INSP_LVL_CNT
		]]>
	</select>
	
	<resultMap class="java.util.HashMap" id="CSPCIS008PDetailSelectList">
		<result property="INSP_REGI_DT" column="INSP_REGI_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_REGI_NO" column="INSP_REGI_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_LVL_CNT" column="INSP_LVL_CNT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DVSN_CD" column="INSP_DVSN_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_TIT_ENN" column="INSP_TIT_ENN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ENTX" column="INSP_ENTX" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ECN" column="INSP_ECN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_EID" column="INSP_USR_EID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_NAM" column="INSP_USR_NAM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ATT_FL_EID" column="INSP_ATT_FL_EID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DOC_TYP_CD" column="INSP_DOC_TYP_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="STA_YN" column="STA_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	<select id="CSPCIS008PDetailSelectList" parameterClass="paramMap" resultMap="CSPCIS008PDetailSelectList">
		<![CDATA[
			SELECT	
					INSP_REGI_DT,
					INSP_REGI_NO,
					INSP_LVL_CNT,
					INSP_DVSN_CD,
					INSP_TIT_ENN,
					INSP_ENTX,
					INSP_ECN,
					INSP_USR_EID,
					INSP_USR_NAM,
					INSP_ATT_FL_EID,
					INSP_DOC_TYP_CD,
					STA_YN
			  FROM 	TBCSPCIS001M
			 WHERE	1=1
			   AND	INSP_REGI_DT = #dt#
			   AND	INSP_REGI_NO = #no#
			   AND	INSP_LVL_CNT = #lvl#
		]]>
	</select>
	
	<insert id="CSPCIS008PInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPCIS001M
			(
				 INSP_REGI_DT
				,INSP_REGI_NO
				,INSP_LVL_CNT
				,INSP_DVSN_CD
				,INSP_TIT_ENN
				,INSP_ENTX
				,INSP_ECN
				,INSP_USR_EID
				,INSP_USR_NAM
				,INSP_ATT_FL_EID
				,STA_YN
				
			)
			VALUES
			(
				 TO_CHAR(SYSDATE, 'YYYYMMDD')
				,(SELECT NVL(MAX(INSP_REGI_NO)+1,1) FROM TBCSPCIS001M)
				,0
				,#INSP_DVSN_CD#
				,#INSP_TIT_ENN#
				,#INSP_ENTX#
				,#S_CNB#
				,#FNL_USR_ID#
				,#S_USR_NAM#
				,#INSP_ATT_FL_EID#
				,'N'
			)
		]]>
	</insert>
	
	<update id="CSPCIS008PUpdate" parameterClass="paramMap" >
		<![CDATA[
		 UPDATE TBCSPCIS001M
			SET  INSP_DVSN_CD 	= #INSP_DVSN_CD#
				,INSP_TIT_ENN 	= #INSP_TIT_ENN#
				,INSP_ENTX		= #INSP_ENTX#
				,INSP_ECN		= #INSP_ECN#
				,INSP_USR_EID	= #INSP_USR_EID#
				,INSP_USR_NAM	= #INSP_USR_NAM#
				,INSP_ATT_FL_EID= #INSP_ATT_FL_EID#
				,STA_YN			= 'N'
			WHERE	INSP_REGI_DT    =   #INSP_REGI_DT#
			  AND	INSP_REGI_NO    =   #INSP_REGI_NO#
			  AND	INSP_LVL_CNT    =   0
		]]>
	</update>
	
	 <resultMap class="java.util.HashMap" 	id="CSPCIS009PMainSelect">
		<result property="INSP_REGI_DT" 	column="INSP_REGI_DT" 		jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_REGI_NO" 	column="INSP_REGI_NO" 		jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_LVL_CNT" 	column="INSP_LVL_CNT" 		jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DVSN_CD" 	column="INSP_DVSN_CD" 		jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="CD_NM" 			column="CD_NM" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_TIT_ENN" 	column="INSP_TIT_ENN" 		jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ENTX" 		column="INSP_ENTX" 			jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ECN" 		column="INSP_ECN" 			jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_EID" 	column="INSP_USR_EID" 		jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_NAM" 	column="INSP_USR_NAM" 		jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ATT_FL_EID" 	column="INSP_ATT_FL_EID" 	jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DOC_TYP_CD" 	column="INSP_DOC_TYP_CD" 	jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="STA_YN" 			column="STA_YN" 			jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REPLY_YN" 		column="REPLY_YN" 			jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_DT" 			column="B_DT" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_NO" 			column="B_NO" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_CNT" 			column="B_CNT" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_CD" 			column="B_CD" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_ENN" 			column="B_ENN" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_ENTX" 			column="B_ENTX" 			jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_ECN" 			column="B_ECN" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_EID" 			column="B_EID" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_NAM" 			column="B_NAM" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_YN" 			column="B_YN" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	<select id="CSPCIS009PMainSelect" parameterClass="paramMap" resultMap="CSPCIS009PMainSelect">
		<![CDATA[
			SELECT 	A.INSP_REGI_DT,
					A.INSP_REGI_NO,
					A.INSP_LVL_CNT,
					A.INSP_DVSN_CD,
					F_CODE_NM('1000308', A.INSP_DVSN_CD) AS CD_NM,
					A.INSP_TIT_ENN,
					A.INSP_ENTX,
					A.INSP_ECN,
					A.INSP_USR_EID,
					A.INSP_USR_NAM,
					A.INSP_ATT_FL_EID,
					A.INSP_DOC_TYP_CD,
					A.STA_YN,
					DECODE(B.INSP_REGI_DT,NULL,'N','Y') AS REPLY_YN,
					B.INSP_REGI_DT AS B_DT,
					B.INSP_REGI_NO AS B_NO, 
					B.INSP_LVL_CNT AS B_CNT,
					A.INSP_DVSN_CD AS B_CD,
					B.INSP_TIT_ENN AS B_ENN,
					B.INSP_ENTX AS B_ENTX,
					B.INSP_ECN AS B_ECN,
					B.INSP_USR_EID AS B_EID,
					B.INSP_USR_NAM AS B_NAM,
					B.STA_YN AS B_YN
			FROM
				(SELECT * FROM TBCSPCIS001M A WHERE INSP_LVL_CNT = 0) A, 
				(SELECT * FROM TBCSPCIS001M A WHERE INSP_LVL_CNT <> 0 ) B 
			WHERE A.INSP_REGI_DT = B.INSP_REGI_DT(+)
			AND A.INSP_REGI_NO = B.INSP_REGI_NO(+)
		]]>
		<dynamic>
			<isNotEmpty property="readYn">
				AND	A.STA_YN = #readYn#
			</isNotEmpty>
			<isNotEmpty property="dt">
				AND A.INSP_REGI_DT = #dt#
			</isNotEmpty>
			<isNotEmpty property="no">
				AND A.INSP_REGI_NO = #no#
			</isNotEmpty>
		</dynamic>
		<![CDATA[
			ORDER BY A.INSP_REGI_DT DESC, A.INSP_REGI_NO DESC
		]]>
	</select>
	
	<update id="CSPCIS009PUpdate" parameterClass="paramMap" >
		<![CDATA[
			MERGE INTO TBCSPCIS001M A
			USING ( SELECT  #B_DT# AS INSP_REGI_DT
			               ,#B_NO# AS INSP_REGI_NO
			               ,1 AS INSP_LVL_CNT
			          FROM DUAL 
			       ) B
			ON (    A.INSP_REGI_DT = B.INSP_REGI_DT 
			    AND	A.INSP_REGI_NO = B.INSP_REGI_NO
			    AND	A.INSP_LVL_CNT = B.INSP_LVL_CNT
				)
			WHEN MATCHED THEN 
			UPDATE SET 
					 INSP_DVSN_CD 	= #B_CD#
					,INSP_TIT_ENN 	= #B_ENN#
					,INSP_ENTX		= #B_ENTX#
			WHEN NOT MATCHED THEN 
			INSERT (		
					 INSP_REGI_DT
					,INSP_REGI_NO
					,INSP_LVL_CNT
					,INSP_DVSN_CD
					,INSP_TIT_ENN
					,INSP_ENTX
					,INSP_ECN
					,INSP_USR_EID
					,INSP_USR_NAM
					,STA_YN
					)
			VALUES (				 
					 #INSP_REGI_DT#
					,#INSP_REGI_NO#
					,1
					,#B_CD#
					,#B_ENN#
					,#B_ENTX#
					,#S_CNB#
					,#FNL_USR_ID#
					,#S_USR_NAM#
					,'N'
					)
		]]>
	</update>
	
	<update id="CSPCIS009PStaYnUpdate" parameterClass="paramMap" >
		<![CDATA[
		 UPDATE TBCSPCIS001M
			SET  STA_YN 	= 'Y'
			WHERE	INSP_REGI_DT    =   #dt#
			  AND	INSP_REGI_NO    =   #no#
			  AND	INSP_LVL_CNT    =   0
		]]>
	</update>
	
	<insert id="CSPCIS009PInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPCIS001M
			(
				 INSP_REGI_DT
				,INSP_REGI_NO
				,INSP_LVL_CNT
				,INSP_DVSN_CD
				,INSP_TIT_ENN
				,INSP_ENTX
				,INSP_ECN
				,INSP_USR_EID
				,INSP_USR_NAM
				,STA_YN
				
			)
			VALUES
			(
				 #INSP_REGI_DT#
				,#INSP_REGI_NO#
				,1
				,#B_CD#
				,#B_ENN#
				,#B_ENTX#
				,#S_CNB#
				,#FNL_USR_ID#
				,#S_USR_NAM#
				,'N'
			)
		]]>
	</insert>
	
	<update id="CSPCIS008PStaYnUpdate" parameterClass="paramMap" >
		<![CDATA[
			UPDATE 	TBCSPCIS001M
			   SET 	STA_YN 	= 'Y'
			 WHERE	INSP_REGI_DT    =   #dt#
			   AND	INSP_REGI_NO    =   #no#
			   AND	INSP_LVL_CNT    =   1
		]]>
	</update>
	
	<select id="CSPCIS008PSelectMaxMMSSeq" parameterClass="paramMap" resultClass="String">
        <![CDATA[
   			SELECT MMS_CONTENTS_INFO_SEQ.NEXTVAL AS SEQ FROM DUAL
       	]]>
	</select>
	
	<insert id="CSPCIS008PInsertSms" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO MSG_DATA 
	 			      ( MSG_SEQ
	 			      , REQ_DATE
	 			      , CUR_STATE
	 			      , CALL_TO
	 			      , CALL_FROM
	 			      , SMS_TXT
	 			      , MSG_TYPE
	 			      , CONT_SEQ)
 			      VALUES (
 			            MSG_DATA_SEQ.NEXTVAL
 			          , SYSDATE
 			          , 0
 			          , REPLACE(#CALL_TO#, '-')
 			          , '감사원장'
 			          , '원장님이 글을 확인하였습니다.'
 			          , 4
 			          , #CONT_SEQ#)
        ]]>
	</insert>
	
	<select id="CSPCIS008PSelectHomTnb" parameterClass="paramMap" resultClass="String">
        <![CDATA[
   			SELECT HOM_TNB FROM TBDCMACM001M WHERE CNB = #toCnb#
       	]]>
	</select>
	
	<insert id="CSPCIS008PInsertMSGSend" parameterClass="paramMap">
		<![CDATA[
			CALL NURI2_MESSAGE_SEND(#CALL_FROM#, #CALL_TO#, #SMS_TLT#, #SMS_TXT#)
		]]>
	</insert>
	
</sqlMap> 
