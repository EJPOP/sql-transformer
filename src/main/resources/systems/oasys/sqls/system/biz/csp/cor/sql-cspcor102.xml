<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/cor/102">
 	
 	<resultMap class="java.util.HashMap" id="CSPDCP102">
 		<result property="CORR_DVSN_CD" column="CORR_DVSN_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ACP_YR" column="ACP_YR"                             jdbcType="VARCHAR2"  javaType="java.lang.String" /> 
		<result property="CORR_ACP_NO" column="CORR_ACP_NO"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_NO" column="ACP_NO"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RM_CORR_ACP_NO" column="RM_CORR_ACP_NO"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HMP_APL_NO" column="HMP_APL_NO"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="NAM" column="NAM"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TIT_NM" column="TIT_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_DH" column="ACP_DH"             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="FRT_REGI_DH" column="FRT_REGI_DH"                         jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_RUT_CD" column="ACP_RUT_CD"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_RUT_NM" column="ACP_RUT_NM"                               jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HNDL_STA_CD" column="HNDL_STA_CD"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HNDL_STA_NM" column="HNDL_STA_NM"                                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="EIN" column="EIN"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TNB" column="TNB"                                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="BLT_ORG_NM" column="BLT_ORG_NM"                                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="BLT_DPT_NM" column="BLT_DPT_NM"                                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AD" column="AD"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="DTL_AD" column="DTL_AD"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="DOC_ID" column="DOC_ID"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CORR_TXT" column="CORR_TXT"                                 jdbcType="CLOB"  javaType="java.lang.String" />
		<result property="CORR_EXCU_TXT" column="CORR_EXCU_TXT"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="PEROPEN_AGR_YN" column="PEROPEN_AGR_YN"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="OTHER_SUB_YN" column="OTHER_SUB_YN"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="OTHER_SUB_TXT" column="OTHER_SUB_TXT"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ADMINI_YN" column="ADMINI_YN"                                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_DPT_CD" column="ACP_DPT_CD"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_DPT_NM" column="ACP_DPT_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RCEP_ID" column="RCEP_ID"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RCEP_NM" column="RCEP_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RES_NAM" column="RES_NAM"           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RES_TNB" column="RES_TNB"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RES_POS" column="RES_POS"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RES_JB_NM" column="RES_JB_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RES_AD" column="RES_AD"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RES_DTL_AD" column="RES_DTL_AD"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="DTY_YN" column="DTY_YN"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="DTY_TXT" column="DTY_TXT"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HNDL_DDLN_DT" column="HNDL_DDLN_DT"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="APV_DOC_NO" column="APV_DOC_NO"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="APV_STA_CD" column="APV_STA_CD"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
 	</resultMap>
 	
 	<select id="CSPCOR102EMainSelect" parameterClass="paramMap" resultMap="CSPDCP102">
		<![CDATA[
			SELECT	T1.CORR_DVSN_CD
					,T1.ACP_YR
					,T1.CORR_ACP_NO
					,T1.RM_CORR_ACP_NO
					,DECODE(T1.RM_CORR_ACP_NO,NULL,NULL,T1.ACP_YR||'-부감-'||T1.RM_CORR_ACP_NO) AS ACP_NO
					,T1.HMP_APL_NO
					,T1.NAM
					,T1.TIT_NM
					,TO_CHAR(T1.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
					,TO_CHAR(T1.FRT_REGI_DH,'YYYY-MM-DD HH24:MI') AS FRT_REGI_DH
					,T1.ACP_RUT_CD
					,F_CODE_NM('1000885',T1.ACP_RUT_CD) AS ACP_RUT_NM
					,T1.HNDL_STA_CD
					,F_CODE_NM('1000886',T1.HNDL_STA_CD) AS HNDL_STA_NM
					,T1.RM_CORR_ACP_NO
					,T1.EIN
					,T1.TNB
					,T1.BLT_ORG_NM
					,T1.BLT_DPT_NM
					,T1.AD
					,T1.DTL_AD
					,T1.DOC_ID
					,T1.CORR_TXT
					,T1.CORR_EXCU_TXT
					,T1.PEROPEN_AGR_YN
					,T1.OTHER_SUB_YN
					,T1.OTHER_SUB_TXT
					,T1.ADMINI_YN
					,T1.ACP_DPT_CD
					,F_DPT_INFO(T1.ACP_DPT_CD, '1') AS ACP_DPT_NM
					,T1.RCEP_ID
					,F_USR_INFO_BY_ID(T1.RCEP_ID, '2') AS RCEP_NM
					,T2.RES_NAM
					,T2.RES_TNB
					,T2.RES_POS
					,T2.RES_JB_NM
					,T2.RES_AD
					,T2.RES_DTL_AD
					,T1.DTY_YN
					,T1.DTY_TXT
					,TO_CHAR(TO_DATE(T1.HNDL_DDLN_DT),'YYYY-MM-DD') AS HNDL_DDLN_DT
					,T1.APV_DOC_NO
					,T1.APV_STA_CD
			FROM	TBCSPCOR101M T1
			       ,TBCSPCOR102M T2
			WHERE	T1.CORR_DVSN_CD = #strCORR_DVSN_CD#
			  AND   T1.ACP_YR = #strACP_YR#
			  AND   T1.CORR_ACP_NO = #strCORR_ACP_NO#
			  AND   T1.CORR_DVSN_CD = T2.CORR_DVSN_CD 
			  AND   T1.ACP_YR = T2.ACP_YR
			  AND   T1.CORR_ACP_NO = T2.CORR_ACP_NO
		]]>
		
	</select>
	
	<select id="CSPCOR102EKeySelect" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT NVL(MAX(TO_NUMBER(T1.RM_CORR_ACP_NO)),0)+1
			  FROM TBCSPCOR101M T1
			 WHERE T1.CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND T1.ACP_YR = #ACP_YR#
		]]>
	</select>
	
	<select id="CSPCOR102EPkSelect" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT NVL(MAX(TO_NUMBER(T1.CORR_ACP_NO)),0)+1
			  FROM TBCSPCOR101M T1
			 WHERE T1.CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND T1.ACP_YR = #ACP_YR#
		]]>
	</select>
	
	
	<update id="CSPCOR102ETBCSPCOR101MUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR101M T1
			   SET HMP_APL_NO = #HMP_APL_NO#
			      ,NAM = #NAM#
			      ,EIN = #EIN#
			      ,BLT_ORG_NM = #BLT_ORG_NM#
			      ,AD = #AD#
			      ,DTL_AD = #DTL_AD#
			      ,TIT_NM = #TIT_NM#
			      ,DOC_ID = #DOC_ID#
			      ,CORR_EXCU_TXT = #CORR_EXCU_TXT#
			      ,PEROPEN_AGR_YN = NVL(#PEROPEN_AGR_YN#,'N')
			      ,OTHER_SUB_YN = NVL(#OTHER_SUB_YN#,'N')
			      ,OTHER_SUB_TXT = #OTHER_SUB_TXT#
			      ,ADMINI_YN = NVL(#ADMINI_YN#,'N')
			      ,ACP_DH = CASE WHEN T1.HNDL_STA_CD = '10' THEN TO_TIMESTAMP(SYSDATE) ELSE TO_TIMESTAMP(ACP_DH) END
			      ,ACP_RUT_CD = #ACP_RUT_CD#
			      ,HNDL_STA_CD = CASE WHEN T1.HNDL_STA_CD ='10' THEN '20' ELSE HNDL_STA_CD END
			      ,RM_CORR_ACP_NO = #RM_CORR_ACP_NO#
			      ,ACP_DPT_CD = CASE WHEN T1.HNDL_STA_CD = '10' THEN #FNL_DEAL_DPT_CD# ELSE ACP_DPT_CD END
			      ,RCEP_ID = CASE WHEN T1.HNDL_STA_CD = '10' THEN #FNL_USR_ID# ELSE RCEP_ID END
			      ,FNL_USR_ID = #FNL_USR_ID#
			      ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			      ,FNL_MNU_ID = #FNL_MNU_ID#
			      ,FNL_MDF_DH = SYSDATE
			      ,BLT_DPT_NM = #BLT_DPT_NM#
			      ,DTY_YN = NVL(#DTY_YN#,'N')
			      ,DTY_TXT = #DTY_TXT#
			      ,HNDL_DDLN_DT = CASE WHEN T1.HNDL_STA_CD = '10' THEN F_GET_WORK_DT(TO_CHAR(SYSDATE+60,'YYYYMMDD')) ELSE HNDL_DDLN_DT END 
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
		]]>
	</update>
	
	<update id="CSPCOR102ETBCSPCOR101MUpdate2" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR101M T1
			   SET CORR_TXT = #CORR_TXT#
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
		]]>
	</update>
	
	<update id="CSPCOR102ETBCSPCOR102MUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR102M T1
			   SET RES_NAM = #RES_NAM#
			      ,RES_TNB = #RES_TNB#
			      ,RES_POS = #RES_POS#
			      ,RES_JB_NM = #RES_JB_NM#
			      ,RES_AD = #RES_AD#
			      ,FNL_USR_ID = #FNL_USR_ID#
			      ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			      ,FNL_MNU_ID = #FNL_MNU_ID#
			      ,FNL_MDF_DH = SYSDATE
			      ,RES_DTL_AD = #RES_DTL_AD#
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
		]]>
	</update>
	
	<insert id="CSPCOR102ETBCSPCOR103HInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPCOR103H
					( CORR_DVSN_CD
					 ,ACP_YR
					 ,CORR_ACP_NO
					 ,SRNO
					 ,PET_DPT_CD
					 ,PET_ID
					 ,PET_TXT
					 ,FRT_USR_ID
					 ,FNL_USR_ID
					 ,FNL_DEAL_DPT_CD
					 ,FNL_MNU_ID
					 ,FRT_REGI_DH
					 ,FNL_MDF_DH
					)
				VALUES ( #CORR_DVSN_CD#
				        ,#ACP_YR#
				        ,#CORR_ACP_NO#
				        ,(SELECT NVL(MAX(S1.SRNO),0)+1
				            FROM TBCSPCOR103H S1
				           WHERE S1.CORR_DVSN_CD = #CORR_DVSN_CD#
				             AND S1.ACP_YR = #ACP_YR#
				             AND S1.CORR_ACP_NO = #CORR_ACP_NO#
				         )
				        ,#FNL_DEAL_DPT_CD#
				        ,#FNL_USR_ID#
				        ,#PET_TXT#
				        ,#FNL_USR_ID#
				        ,#FNL_USR_ID#
				        ,#FNL_DEAL_DPT_CD#
				        ,#FNL_MNU_ID#
				        ,SYSDATE
				        ,SYSDATE
				       )
		]]>
	</insert>
	
	<update id="CSPCOR102EMmsMsgInsert2" parameterClass ="paramMap">
			INSERT INTO MMS_CONTENTS_INFO 
				 	(	CONT_SEQ
				 		, FILE_CNT
				 		, MMS_BODY
				 		, MMS_SUBJECT
				 	) 
			VALUES (	#CONT_SEQ#
						, 1
						, #SMS_TXT#
						, '감사원 부패행위 신고 문자통보'
					)
	</update>
	
	<insert id="CSPCOR102EMsgInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MSG_DATA
				 	(	MSG_SEQ
				 		, CUR_STATE
				 		, REQ_DATE
				 		, CALL_TO
				 		, CALL_FROM
				 		, SMS_TXT
				 		, MSG_TYPE
				 		, CONT_SEQ
				 	) 
			VALUES (	MSG_DATA_SEQ.NEXTVAL
						, 0
						, SYSDATE
						, REPLACE(#HPN#,'-','')
						, NVL((	SELECT	S1.TNB
   						FROM 	TBDCMACM002M S1
   						WHERE 	S1.DPT_CD = #FNL_DEAL_DPT_CD#
   						) ,'0220112191')
						, ''
						, 6
						, #CONT_SEQ#
					)
		]]>
	</insert>
	
	
	<insert id="CSPCOR102ETBCSPCOR101MInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPCOR101M
					( CORR_DVSN_CD
					 ,ACP_YR
					 ,CORR_ACP_NO
					 ,HMP_APL_NO
					 ,NAM
					 ,EIN
					 ,BLT_ORG_NM
					 ,AD
					 ,DTL_AD
					 ,TNB
					 ,TIT_NM
					 ,DOC_ID
					 ,CORR_TXT
					 ,CORR_EXCU_TXT
					 ,PEROPEN_AGR_YN
					 ,OTHER_SUB_YN
					 ,OTHER_SUB_TXT
					 ,ADMINI_YN
					 ,ACP_DH
					 ,ACP_RUT_CD
					 ,HNDL_STA_CD
					 ,HNDL_DH
					 ,DELETE_DH
					 ,FRT_REGN_IP
					 ,FRT_USR_ID
					 ,FNL_USR_ID
					 ,FNL_DEAL_DPT_CD
					 ,FNL_MNU_ID
					 ,FRT_REGI_DH
					 ,FNL_MDF_DH
					 ,RM_CORR_ACP_NO
					 ,ACP_DPT_CD
					 ,RCEP_ID
					 ,BLT_DPT_NM
					 ,DTY_YN
					 ,DTY_TXT
					 ,HNDL_DDLN_DT
					)
				VALUES (
				        #CORR_DVSN_CD#
				        ,#ACP_YR#
				        ,#CORR_ACP_NO#
				        ,#HMP_APL_NO#
				        ,#NAM#
				        ,#EIN#
				        ,#BLT_ORG_NM#
				        ,#AD#
				        ,#DTL_AD#
				        ,#TNB#
				        ,#TIT_NM#
				        ,#DOC_ID#
				        ,#CORR_TXT#
				        ,#CORR_EXCU_TXT#
				        ,NVL(#PEROPEN_AGR_YN#,'N')
				        ,NVL(#OTHER_SUB_YN#,'N')
				        ,#OTHER_SUB_TXT#
				        ,NVL(#ADMINI_YN#,'N')
				        ,SYSDATE
				        ,#ACP_RUT_CD#
				        ,'20'
				        ,NULL
				        ,NULL
				        ,NULL
				        ,#FRT_USR_ID#
				        ,#FNL_USR_ID#
				        ,#FNL_DEAL_DPT_CD#
				        ,#FNL_MNU_ID#
				        ,SYSDATE
				        ,SYSDATE
				        ,#RM_CORR_ACP_NO#
				        ,#FNL_DEAL_DPT_CD#
				        ,#FNL_USR_ID#
				        ,#BLT_DPT_NM#
				        ,NVL(#DTY_YN#,'N')
				        ,#DTY_TXT#
				        ,F_GET_WORK_DT(TO_CHAR(SYSDATE+60,'YYYYMMDD'))
				       )
		]]>
	</insert>
	
	<insert id="CSPCOR102ETBCSPCOR102MInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPCOR102M
					( CORR_DVSN_CD
					 ,ACP_YR
					 ,CORR_ACP_NO
					 ,SRNO
					 ,RES_NAM
					 ,RES_TNB
					 ,RES_POS
					 ,RES_JB_NM
					 ,RES_AD
					 ,RES_DTL_AD
					 ,FRT_USR_ID
					 ,FNL_USR_ID
					 ,FNL_DEAL_DPT_CD
					 ,FNL_MNU_ID
					 ,FRT_REGI_DH
					 ,FNL_MDF_DH
					)
				VALUES (
				        #CORR_DVSN_CD#
				        ,#ACP_YR#
				        ,#CORR_ACP_NO#
				        ,1
				        ,#RES_NAM#
				        ,#RES_TNB#
				        ,#RES_POS#
				        ,#RES_JB_NM#
				        ,#RES_AD#
				        ,#RES_DTL_AD#
				        ,#FRT_USR_ID#
				        ,#FNL_USR_ID#
				        ,#FNL_DEAL_DPT_CD#
				        ,#FNL_MNU_ID#
				        ,SYSDATE
				        ,SYSDATE
				       )
		]]>
	</insert>
	
	
	<select id="CSPCOR102EReportSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.ACP_YR||'-부감-'||A.RM_CORR_ACP_NO||'호' AS ACP_NO
					,TO_CHAR(A.ACP_DH,'YYYY. MM. DD.') AS ACP_DH
					,A.TIT_NM
					,A.NAM
   			FROM	TBCSPCOR101M A 
   			WHERE	1=1
   			AND		A.CORR_DVSN_CD = #strCORR_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CORR_ACP_NO = #strCORR_ACP_NO#
		]]>
	</select>
	
	<update id="CSPCOR102ETBCSPCOR101MDeleteUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR101M T1
			   SET HNDL_STA_CD ='100'
			      ,HNDL_DH = SYSDATE
			      ,WDW_RSN_TXT = #WDW_RSN_TXT#
			      ,FNL_USR_ID = #FNL_USR_ID#
			      ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			      ,FNL_MNU_ID = #FNL_MNU_ID#
			      ,FNL_MDF_DH = SYSDATE
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
		]]>
	</update>
	
	<select id="CSPCOR102PWdWSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	T1.CORR_DVSN_CD
					,T1.ACP_YR
					,T1.CORR_ACP_NO
					,T1.WDW_RSN_TXT
					,T1.HNDL_STA_CD
					,T1.TNB
					,T1.RM_CORR_ACP_NO
					,T1.HMP_APL_NO
			FROM	TBCSPCOR101M T1
			WHERE	T1.CORR_DVSN_CD = #strCORR_DVSN_CD#
			  AND   T1.ACP_YR = #strACP_YR#
			  AND   T1.CORR_ACP_NO = #strCORR_ACP_NO#
		]]>
		
	</select>
	
	<select id="CSPCOR102EApvSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT MAX(CASE WHEN ROW_ID = 1 THEN PST_NM ELSE NULL END) AS PST_NM1
				  ,MAX(CASE WHEN ROW_ID = 2 THEN PST_NM ELSE NULL END) AS PST_NM2
       			  ,MAX(CASE WHEN ROW_ID = 3 THEN PST_NM ELSE NULL END) AS PST_NM3
       			  ,MAX(CASE WHEN ROW_ID = 4 THEN PST_NM ELSE NULL END) AS PST_NM4
       			  ,MAX(CASE WHEN ROW_ID = 5 THEN PST_NM ELSE NULL END) AS PST_NM5
       			  ,MAX(CASE WHEN ROW_ID = 6 THEN PST_NM ELSE NULL END) AS PST_NM6
       			  ,MAX(CASE WHEN ROW_ID = 7 THEN PST_NM ELSE NULL END) AS PST_NM7
       			  ,MAX(CASE WHEN ROW_ID = 1 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM1
                  ,MAX(CASE WHEN ROW_ID = 2 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM2
                  ,MAX(CASE WHEN ROW_ID = 3 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM3
                  ,MAX(CASE WHEN ROW_ID = 4 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM4
                  ,MAX(CASE WHEN ROW_ID = 5 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM5
                  ,MAX(CASE WHEN ROW_ID = 6 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM6
                  ,MAX(CASE WHEN ROW_ID = 7 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM7
			  FROM ( SELECT APV_DOC_NO
			               ,APV_SNO
			               ,APVR_NM
			               ,APV_DH
			               ,PST_NM
			               ,ROW_NUMBER() OVER (ORDER BY APV_SNO) AS ROW_ID
			           FROM ( SELECT APV_DOC_NO
			                        ,APV_SNO
			                        ,CASE WHEN APVR_PST_CD IS NULL THEN ONR_PST_NM
			                           ELSE F_CODE_NM('1000176', APVR_PST_CD)
			                         END AS PST_NM
			                        ,F_USR_INFO(APVR_CNB, '2') AS APVR_NM
			                        ,CASE WHEN SUBSTR(APVR_STA_CD, 0, 1) = '2' THEN TO_CHAR(APV_DH, 'YYYY-MM-DD')
			                           ELSE NULL
			                         END AS APV_DH
			                    FROM TBDCMACM023L
			                   WHERE APV_SNO <> '1'
			                     AND APVR_KND_CD NOT IN ('4','6','7')
			                     AND APV_DOC_NO = ( SELECT APV_DOC_NO
			                                          FROM TBCSPCOR101M S1 
			                                         WHERE S1.CORR_DVSN_CD = #strCORR_DVSN_CD#
			                                           AND S1.ACP_YR = #strACP_YR#
			                                           AND S1.CORR_ACP_NO = #strCORR_ACP_NO#
			                                      )
			                )
			  	   )
		]]>
	</select>
	
	<select id="CSPCOR102IMainSelect" parameterClass="paramMap" resultMap="CSPDCP102">
		<![CDATA[
			SELECT	T1.CORR_DVSN_CD
					,T1.ACP_YR
					,T1.CORR_ACP_NO
					,T1.RM_CORR_ACP_NO
					,DECODE(T1.RM_CORR_ACP_NO,NULL,NULL,T1.ACP_YR||'-부감-'||T1.RM_CORR_ACP_NO) AS ACP_NO
					,T1.HMP_APL_NO
					,T1.NAM
					,T1.TIT_NM
					,TO_CHAR(T1.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
					,TO_CHAR(T1.FRT_REGI_DH,'YYYY-MM-DD HH24:MI') AS FRT_REGI_DH
					,T1.ACP_RUT_CD
					,F_CODE_NM('1000885',T1.ACP_RUT_CD) AS ACP_RUT_NM
					,T1.HNDL_STA_CD
					,F_CODE_NM('1000886',T1.HNDL_STA_CD) AS HNDL_STA_NM
					,T1.RM_CORR_ACP_NO
					,T1.EIN
					,T1.TNB
					,T1.BLT_ORG_NM
					,T1.BLT_DPT_NM
					,T1.AD
					,T1.DTL_AD
					,T1.DOC_ID
					,T1.CORR_TXT
					,T1.CORR_EXCU_TXT
					,T1.PEROPEN_AGR_YN
					,T1.OTHER_SUB_YN
					,T1.OTHER_SUB_TXT
					,T1.ADMINI_YN
					,T1.ACP_DPT_CD
					,F_DPT_INFO(T1.ACP_DPT_CD, '1') AS ACP_DPT_NM
					,T1.RCEP_ID
					,F_USR_INFO_BY_ID(T1.RCEP_ID, '2') AS RCEP_NM
					,T2.RES_NAM
					,T2.RES_TNB
					,T2.RES_POS
					,T2.RES_JB_NM
					,T2.RES_AD
					,T2.RES_DTL_AD
					,T1.DTY_YN
					,T1.DTY_TXT
					,TO_CHAR(TO_DATE(T1.HNDL_DDLN_DT),'YYYY-MM-DD') AS HNDL_DDLN_DT
					,T1.APV_DOC_NO
					,T1.APV_STA_CD
			FROM	TBCSPCOR101M T1
			       ,TBCSPCOR102M T2
			WHERE	T1.CORR_DVSN_CD = T2.CORR_DVSN_CD 
			  AND   T1.ACP_YR = T2.ACP_YR
			  AND   T1.CORR_ACP_NO = T2.CORR_ACP_NO
		]]>
			<dynamic>
				<isEmpty property="CORR_DVSN_CD">
					<![CDATA[
					AND T1.APV_DOC_NO = #APV_DOC_NO#
					]]>
				</isEmpty>
				<isNotEmpty property="CORR_DVSN_CD">
					<![CDATA[
					AND     T1.CORR_DVSN_CD = #CORR_DVSN_CD#
					AND		T1.ACP_YR = #ACP_YR#
					AND		T1.CORR_ACP_NO = #CORR_ACP_NO#
					]]>
				</isNotEmpty>
			</dynamic>
	</select>
	
	
	<update id="CSPCOR102IApvSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPCOR101M
			SET		APV_DOC_NO = #APV_DOC_NO#
					,APV_STA_CD = #APV_STA_CD#
					,HNDL_STA_CD = CASE WHEN #APV_STA_CD# = '102' AND HNDL_STA_CD = '20' THEN '20' ELSE HNDL_STA_CD END
			WHERE	1=1
		]]>
			<dynamic>
				<isEmpty property="CORR_DVSN_CD">
					<![CDATA[
					AND APV_DOC_NO = #APV_DOC_NO#
					]]>
				</isEmpty>
				<isNotEmpty property="CORR_DVSN_CD">
					<![CDATA[
					AND     CORR_DVSN_CD = #CORR_DVSN_CD#
					AND		ACP_YR = #ACP_YR#
					AND		CORR_ACP_NO = #CORR_ACP_NO#
					]]>
				</isNotEmpty>
			</dynamic>
	</update>
</sqlMap> 
