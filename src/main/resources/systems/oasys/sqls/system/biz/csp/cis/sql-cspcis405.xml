<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/cis/405">
	
	
	<select id="CSPCIS405EMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	SRNO
					,T1.NAM
					,T1.JB_NM
					,T1.PST_NM
					,T1.TNB
					,T1.EXTL_LCT_TYP_CD
					,T1.ACTV_TYP_CD
					,T1.ORG_NM
					,T1.RPST_PEN_NM
					,T1.CHR_DPT_NM
					,T1.RQR_TNB
					,T1.TIT_NM
					,T1.RQS_RSN_TXT
					,T1.THM_TXT
					,T1.RQS_DH
					,T1.RQS_PLC_NM
					,T1.CAS_TAM
					,T1.CAS_AV_AM
					,T1.RM_EXS_TAM
					,T1.RM_EXS_AV_AM
					,T1.EXCS_CAS_AM
					,T1.RTRN_TXT
					,T1.RMK_TXT
					,T1.DOC_ID
					,T1.ANS_TXT
					,T1.ANS_PEN_CNB
					,T1.HNDL_STA_CD
					,F_CODE_NM('1000760',T1.HNDL_STA_CD) AS HNDL_STA_NM
					,TO_CHAR(T1.FRT_REGI_DH,'YYYY-MM-DD HH24:MI') FRT_REGI_DH
			FROM	TBCSPCIS404M T1
			WHERE	1=1
		]]>
		
		<dynamic>
			<isNotEmpty property="strNAM">
				AND T1.NAM LIKE '%'||#strNAM#||'%'
			</isNotEmpty>
		</dynamic>
		ORDER BY SRNO DESC
	</select>
	
	
	<!-- 진행상태 체크 -->
	<select id="CSPCIS405MHndlCdCheck" parameterClass="paramMap" resultClass="Integer">
		<![CDATA[
			SELECT	/*CSPCIS405MHndlCdCheck*/
					COUNT(*)
			FROM	TBCSPCIS404M T1
			WHERE	T1.SRNO = #SRNO#
			AND		T1.HNDL_STA_CD = '1'	/*신청인 자료는 진행상태가 10이다.*/
		]]>
	</select>
	
	<!-- 접수처리한다. -->
	<update id="CSPCIS405MAcceptSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE	/*CSPCIS405MAcceptSave*/
					TBCSPCIS404M T1
			SET		T1.HNDL_STA_CD = '2'	/*상태 값이 20인자료가 접수 이다.*/
					,T1.ANS_PEN_CNB = #S_CNB#
					,T1.FNL_USR_ID = #FNL_USR_ID#
					,T1.FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,T1.FNL_MNU_ID = #FNL_MNU_ID#
					,T1.FNL_MDF_DH = SYSDATE
			WHERE	T1.SRNO = #SRNO#
		]]>
	</update>
	
	<!-- 답변을 저장 한다. -->
	<update id="CSPCIS405MAanSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE	/*CSPCIS405MAanSave*/
					TBCSPCIS404M T1
			SET		T1.ANS_TXT = #ANS_TXT#
					,T1.FNL_USR_ID = #FNL_USR_ID#
					,T1.FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,T1.FNL_MNU_ID = #FNL_MNU_ID#
					,T1.FNL_MDF_DH = SYSDATE
			WHERE	T1.SRNO = #SRNO#
		]]>
	</update>
	
	<!-- 접수처리한다. -->
	<update id="CSPCIS405MAcceptCancleSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE	/*CSPCIS405MAcceptCancleSave*/
					TBCSPCIS404M T1
			SET		T1.HNDL_STA_CD = '1'	
					,T1.ANS_TXT = NULL
					,T1.FNL_USR_ID = #FNL_USR_ID#
					,T1.FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,T1.FNL_MNU_ID = #FNL_MNU_ID#
					,T1.FNL_MDF_DH = SYSDATE
			WHERE	T1.SRNO = #SRNO#
		]]>
	</update>
</sqlMap> 
