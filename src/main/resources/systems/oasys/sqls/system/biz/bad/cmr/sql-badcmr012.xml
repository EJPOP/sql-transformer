<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/cmr/012">


	
	
	<!-- 소분류 신규 -->
	<insert id="badcmr012ESalCatinsert" parameterClass="paramMap">
		INSERT INTO
		TBBADCMR003M
		(
		YE                         /*연도*/
		, LAG_CAT_SNO              /*대분류*/
		, MID_CAT_SNO              /*중분류*/
		, SALL_CAT_SNO              /*소분류*/
		, SALL_CAT_TIT_NM           /*소분류제목명*/
		, SALL_CAT_TXT              /*소분류 내용*/
		, CHR_DPT_CD                /*담당부서*/
		, CHGR_ID                   /*담당자*/
		, CMPT_YN                   /*완료여부*/
		, REGI_DT                   /*등록일*/
		, REGN_ID                   /*등록자*/
		                            /**/
		, MDF_DT                    /*수정일*/
		, MDF_PEN_ID                /*수정자*/
		, DEL_YN                    /*삭제여부*/
		, CPLT_YN
		                            
		, FNL_MNU_ID               
		, FRT_USR_ID               
		, FNL_USR_ID              
		, FNL_DEAL_DPT_CD          
		, FRT_REGI_DH               
		, FNL_MDF_DH                
		, CPR_CHGR_ID
		, CPR_DPT_CD
		, STD_CHGR_ID
		, STD_DPT_CD
		, EPS_MNG_YN
		)                          
		VALUES                      
		(                           
		#YE#                        
		, #LAG_CAT_SNO#            
		, #MID_CAT_SNO#            
		, #SALL_CAT_SNO#            
		, #SALL_CAT_TIT_NM#         
		, #SALL_CAT_TXT#            
		, #CHR_DPT_CD#              
		, #CHGR_ID#                 
		, #CMPT_YN#                 
		, TO_CHAR(SYSDATE,'YYYYMMDD')
		, #S_CNB#
		
		, TO_CHAR(SYSDATE,'YYYYMMDD')
		, #S_CNB#
		,'N'
		,'N'

		
		, #FNL_MNU_ID#
		, #FRT_USR_ID#
		, #FNL_USR_ID#
		, #FNL_DEAL_DPT_CD#
		, SYSDATE
		, SYSDATE
		, #CPR_CHGR_ID#
		, (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = #CPR_CHGR_ID#)
		, #STD_CHGR_ID#
		, (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = #STD_CHGR_ID#) 
		, #EPS_MNG_YN#
		)
	</insert>


	<!-- 소분류 업데이트 -->
	<update id="badcmr012ESalCatupdate" parameterClass="paramMap">
		UPDATE TBBADCMR003M
		SET YE = #YE#
		, LAG_CAT_SNO =#LAG_CAT_SNO#
		, MID_CAT_SNO=#MID_CAT_SNO#
		, SALL_CAT_SNO =#SALL_CAT_SNO#
		, SALL_CAT_TIT_NM=#SALL_CAT_TIT_NM#
		, CMPT_YN = #CMPT_YN#
		
		
		, MDF_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
		, MDF_PEN_ID = #S_CNB#
		
		, FNL_MDF_DH = SYSDATE
		, FNL_USR_ID = #FNL_USR_ID#
		, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		, FNL_MNU_ID = #FNL_MNU_ID#
		, CPR_CHGR_ID = #CPR_CHGR_ID#
		, CPR_DPT_CD = (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = #CPR_CHGR_ID#)
		, STD_CHGR_ID = #STD_CHGR_ID#
		, STD_DPT_CD = (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = #STD_CHGR_ID#) 
		, EPS_MNG_YN = #EPS_MNG_YN#
		,SALL_CAT_TXT = #SALL_CAT_TXT#
		,CHR_DPT_CD = #CHR_DPT_CD#
		,CHGR_ID = #CHGR_ID#
		WHERE 1 = 1
		AND YE = #YE#
		AND LAG_CAT_SNO =#LAG_CAT_SNO#
		AND MID_CAT_SNO =#MID_CAT_SNO#
		AND SALL_CAT_SNO =#SALL_CAT_SNO#

	</update>
     
     <!-- 소분류 max sno -->     
     <select id="badcmr012ESalCatMaxselect" parameterClass="paramMap"
	resultClass="java.lang.String">
        <![CDATA[    
			 SELECT LPAD(NVL(MAX(SALL_CAT_SNO), 0) + 1, 3, 0) AS SALL_CAT_SNO
			  FROM TBBADCMR003M
			 WHERE 1=1
			   AND YE = #strYear#

			  ]]>
          </select>
     <!-- 소분류에해당하는 부처삭제 -->     
     <update id="badcmr012ESalDptdelete" parameterClass="paramMap">    
          
                  DELETE
		        FROM TBBADCMR008L
		        WHERE 1=1
		        AND SALL_CAT_SNO=#SALL_CAT_SNO#
		        AND YE =#YE#;
	 </update>
	  <!-- 소분류에해당하는 대상기관삭제 -->  
     <update id="badcmr012ESalOrgdelete" parameterClass="paramMap">               
		        DELETE
		        FROM TBBADCMR007L
		        WHERE 1=1
		        AND SALL_CAT_SNO=#SALL_CAT_SNO#
		        AND YE =#YE#;	        
     </update> 
     <!-- 소분류에해당하는 부처추가 -->  
   	<insert id="badcmr012ESallDptinsert" parameterClass="paramMap">
		INSERT INTO
		TBBADCMR008L
		(
		YE                         /*연도*/
		, GD_CD              /*부처코드*/
		, SALL_CAT_SNO              /*소분류*/

		                            
		, FNL_MNU_ID               
		, FRT_USR_ID               
		, FNL_USR_ID              
		, FNL_DEAL_DPT_CD          
		, FRT_REGI_DH               
		, FNL_MDF_DH                
		)                          
		VALUES                      
		(                           
		#YE#                                  
		, #GD_CD#            
		, #SALL_CAT_SNO#            
	

		
		, #FNL_MNU_ID#
		, #FRT_USR_ID#
		, #FNL_USR_ID#
		, #FNL_DEAL_DPT_CD#
		, SYSDATE
		, SYSDATE
		)
	</insert>
	  <!-- 소분류에해당하는 대상기관추가 -->  
		<insert id="badcmr012ESallOrginsert" parameterClass="paramMap">
		INSERT INTO
		TBBADCMR007L
		(
		YE                         /*연도*/
		, ORG_CD              /*기관코드*/
		, SALL_CAT_SNO              /*소분류*/
	
		                            
		, FNL_MNU_ID               
		, FRT_USR_ID               
		, FNL_USR_ID              
		, FNL_DEAL_DPT_CD          
		, FRT_REGI_DH               
		, FNL_MDF_DH                
		)                          
		VALUES                      
		(                           
		#YE#                              
		, #ORG_CD#            
		, #SALL_CAT_SNO#            
	

		
		, #FNL_MNU_ID#
		, #FRT_USR_ID#
		, #FNL_USR_ID#
		, #FNL_DEAL_DPT_CD#
		, SYSDATE
		, SYSDATE
		)
	</insert>
	  <!-- 소분류에해당하는부처조회 -->  
	  <select id="badcmr012SallDptselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[    
	        SELECT YE         		/*연도*/
	             , GD_CD
	             , F_ORG_INFO(GD_CD,'1') AS GD_NM
			     , SALL_CAT_SNO
			     , GD_CD AS GD_CD_OLD
			     , F_DPT_INFO(GD_CD,'5') AS AD
			  FROM TBBADCMR008L 
			 WHERE 1=1
			   AND YE = #strYear#	
			   AND SALL_CAT_SNO =#strSallCatSno#
			  ]]>

          </select>
          <!-- 소분류에해당하는 대상기관조회 -->    
       <select id="badcmr012SallOrgselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[    
			 SELECT YE         		/*연도*/
	             , ORG_CD
	             , F_ORG_INFO(ORG_CD,'1') AS ORG_NM
			     , SALL_CAT_SNO
			     , ORG_CD AS ORG_CD_OLD
			     , F_ORG_INFO(ORG_CD,'5') AS AD
			  FROM TBBADCMR007L
			 WHERE 1=1
			   AND YE = #strYear#	
			   AND SALL_CAT_SNO =#strSallCatSno#
			  ]]>

          </select>
          
          
          <!-- 결재자상태 업데이트 -->
	<update id="badcmr012ESallDptupdate" parameterClass="paramMap">
		UPDATE TBBADCMR008L
		SET YE = #YE#
		, SALL_CAT_SNO =#SALL_CAT_SNO#
		, GD_CD=#GD_CD#
		
		, FNL_MDF_DH = SYSDATE
		, FNL_USR_ID = #FNL_USR_ID#
		, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		, FNL_MNU_ID = #FNL_MNU_ID#

		WHERE 1 = 1
		AND YE = #YE#
		AND GD_CD =#GD_CD_OLD#
		AND SALL_CAT_SNO =#SALL_CAT_SNO#

	</update>
	<!-- 결재자상태 업데이트 -->
	<update id="badcmr012ESallOrgupdate" parameterClass="paramMap">
		UPDATE TBBADCMR007L
		SET YE = #YE#
		, SALL_CAT_SNO =#SALL_CAT_SNO#
		, ORG_CD=#ORG_CD#

		
		, FNL_MDF_DH = SYSDATE
		, FNL_USR_ID = #FNL_USR_ID#
		, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		, FNL_MNU_ID = #FNL_MNU_ID#

		WHERE 1 = 1
		AND YE = #YE#
		AND ORG_CD =#ORG_CD_OLD#
		AND SALL_CAT_SNO =#SALL_CAT_SNO#

	</update>
	
	<update id="badcmr012ESallDptdelete" parameterClass="paramMap">
		DELETE TBBADCMR008L

		WHERE 1 = 1
		AND YE = #YE#
		AND GD_CD =#GD_CD#
		AND SALL_CAT_SNO =#SALL_CAT_SNO#

	</update>

	<update id="badcmr012ESallOrgdelete" parameterClass="paramMap">
		DELETE TBBADCMR007L

		WHERE 1 = 1
		AND YE = #YE#
		AND ORG_CD =#ORG_CD#
		AND SALL_CAT_SNO =#SALL_CAT_SNO#

	</update>
     
	
</sqlMap> 
