<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/aoe/001">
	<!-- 공통적으로 쓰는 쿼리 -->
	<!-- 평가기간관리기본에 등록된 평가년도를 가져온다. -->
	<select id="CSPAOECommonEvlYrListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT /* CSPAOECommonEvlYrListselect */
				   EVL_YR AS CD
			     , EVL_YR AS CD_NM
			  FROM TBCSPAOE001M
			 GROUP BY EVL_YR
			 ORDER BY EVL_YR
		  ]]>
	</select>

	<!-- 평가기간관리기본에 등록된 평가년도에 따른 반기구분코드를 가져온다. -->
	<select id="CSPAOECommonHlyrDvsnCdListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT /* CSPAOECommonHlyrDvsnCdListselect */
				   EVL_YR                             AS KEY 
			     , HLYR_DVSN_CD                       AS CD
			     , F_CODE_NM('1000268', HLYR_DVSN_CD) AS CD_NM
			  FROM TBCSPAOE001M
			 GROUP BY EVL_YR, HLYR_DVSN_CD 
			 ORDER BY EVL_YR, HLYR_DVSN_CD
		  ]]>
	</select>

	<!-- 감사종류 - 공통종류 빼고 -->
	<select id="CSPAOECommonAudKndCdListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT /* CSPAOECommonAudKndCdListselect */
				   CD 
			     , CD_NM
			  FROM TBDCMACM013C 
			 WHERE 1=1
			   AND CMM_CD_DVSN_CD = '1000270'
			   AND CD NOT IN ('000000000', '10000')
			   AND USE_YN = 'Y'
			 ORDER BY OTPT_SEQ, CD 
		  ]]>
	</select>
	
	<!-- 업무종류 - 공통종류 빼고 -->
	<select id="CSPAOECommonAudKndCdOtherListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT /* CSPAOECommonAudKndCdOtherListselect */
				   CD 
			     , CD_NM
			  FROM TBDCMACM013C 
			 WHERE 1=1
			   AND CMM_CD_DVSN_CD = '1000272'
			   AND CD NOT IN ('000000000', '10000')
			   AND USE_YN = 'Y'
			 ORDER BY SUBSTR(CD_NM, 0, 4), OTPT_SEQ, CD 
		  ]]>
	</select>

	<!-- 사용자에 따라 메뉴 권한을 조회한다. -->
	<select id="CSPAOECommonMenuAuthselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT /* CSPAOECommonMenuAuthselect */
				   CHGR_DVSN_CD
			  FROM TBCSPAOE017D
			WHERE 1=1
			  AND EVL_YR         = #strEvlYr#
			  AND HLYR_DVSN_CD   = #strHlyrDvsnCd#
			  AND TSK_DVSN_CD    = #strTskDvsnCd#
			  AND CHGR_CNB       = #strChgrCnb#
		  ]]>
		<isNotEmpty property="strAudTskKndCd">
			AND AUD_TSK_KND_CD = #strAudTskKndCd#
		</isNotEmpty>
		<isNotEmpty property="strChgrDvsnCd">
			AND CHGR_DVSN_CD = #strChgrDvsnCd#
		</isNotEmpty>
		<![CDATA[	
			UNION
			SELECT /* CSPAOECommonMenuAuthselect */
				   CHGR_DVSN_CD
			  FROM TBCSPAOE017D
			WHERE 1=1
			  AND EVL_YR         = #strNowEvlYr#
			  AND HLYR_DVSN_CD   = #strNowHlyrDvsnCd#
			  AND TSK_DVSN_CD    = #strTskDvsnCd#
			  AND CHGR_CNB       = #strChgrCnb#
		]]>
		<isNotEmpty property="strAudTskKndCd">
			AND AUD_TSK_KND_CD = #strAudTskKndCd#
		</isNotEmpty>
		<isNotEmpty property="strChgrDvsnCd">
			AND CHGR_DVSN_CD = #strChgrDvsnCd#
		</isNotEmpty>
	</select>

	<!-- 지원부서 리스트만 가져온다 -->
	<select id="CSPAOECommonDeptCdListselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
   			SELECT /* CSPAOECommonDeptCdListselect */
   				   D1.DPT_CD AS DEPT_CD
                 , F_DPT_INFO(D1.DPT_CD, '1') AS DEPT_NM
                 , NVL(D2.HIRK_DPT_CD, D1.DPT_CD) AS UP_DEPT_CD
              FROM (
		                SELECT DPT_CD 
		                  FROM TBDCMACM002M
		                 WHERE DPT_TP_CD = 'S' /*지원부서만 가져온다.*/
		                   AND USE_YN = 'Y'
		                 GROUP BY DPT_CD
		                 
		                 UNION
		                 
		                 SELECT CHR_DPT_CD
		                  FROM TBCSPAOE026M
		                 GROUP BY CHR_DPT_CD /*부서테이블에서 지원부서이면서 사용여부가 와이인 데이터만 가져오게 되면 이미 등록된 부서이지만 폐지됬을 경우를 대비해서 26테이블로 유니온 한다*/
	               ) D1
	               , TBDCMACM002M D2
            WHERE D1.DPT_CD = D2.DPT_CD
            ORDER BY D1.DPT_CD
		]]>
	</select>

	<!-- 조회기간 유효성 체크 -->
	<select id="CSPAOECommonSearchTermselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[  
			SELECT /* CSPAOECommonSearchTermselect */
				   'Y' AS SEARCH_YN
			  FROM TBCSPAOE001M
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND SYSDATE BETWEEN SRCH_STR_DT AND SRCH_END_DT
		]]>
	</select>

	<!-- 확정취소한다. -->
	<update id="CSPAOECommonNoConfupdate" parameterClass="paramMap">
		<![CDATA[	
			DELETE /* CSPAOECommonNoConfupdate */
				   TBCSPAOE035M
			 WHERE 1=1
			   AND EVL_YR          = #EVL_YR#
			   AND HLYR_DVSN_CD    = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD     = #TSK_DVSN_CD#
			   AND AUD_TSK_KND_CD  = #AUD_TSK_KND_CD#
			   AND TSK_NO          = #TSK_NO#
		]]>
	</update>

	<!-- 국/단명 -->
	<select id="CSPAOECommonDeptUpCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT /* CSPAOECommonDeptUpCdselect */
				   F_DPT_INFO(DPT_CD_1, '1') AS DEPT_NM
			     , DPT_CD_1                  AS DEPT_CD
			  FROM TBCSPAOE035M
			 WHERE 1=1              
               AND TSK_DVSN_CD IN ('10000','10001') /*150708_kmh추가_감사지원,감사외*/
			 GROUP BY DPT_CD_1
		  ]]>
	</select>

	<!-- 과/팀명 -->
	<select id="CSPAOECommonDeptCdselect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[	
			SELECT /* CSPAOECommonDeptCdselect */
				   F_DPT_INFO(DPT_CD, '1') AS DEPT_NM
			     , DPT_CD                  AS DEPT_CD
			     , DPT_CD_1                AS DEPT_UP_CD
			  FROM TBCSPAOE035M
			 WHERE 1=1              
               AND TSK_DVSN_CD IN ('10000','10001') /*150708_kmh추가_감사지원,감사외*/
			 GROUP BY DPT_CD_1, DPT_CD		
		  ]]>
	</select>

	<!-- 평가기간관리기본에 등록된 max값 가져온다.(임포트 화면에서 사용) -->
	<select id="CSPAOECommonSearchBoxSetDataselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT /* CSPAOECommonSearchBoxSetDataselect */
				   MAX(EVL_YR)       AS EVL_YR
			     , MAX(HLYR_DVSN_CD) AS HLYR_DVSN_CD
			  FROM TBCSPAOE001M		
			 WHERE EVL_YR = (SELECT MAX(EVL_YR) FROM TBCSPAOE001M)
		  ]]>
	</select>
	
	<!-- 조회조건 평가년도랑 반기구분으로 평가기간 정보 조회하기 -->
	<select id="CSPAOECommonFromToselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT /* CSPAOECommonFromToselect */
				   EVL_STR_DT
			     , EVL_END_DT
			  FROM TBCSPAOE001M
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		]]>
	</select>
	
	<!-- 국/단명 -->
	<select id="CSPAOECommonAudDeptUpCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT HIRK_DPT_CD AS DEPT_CD
			     , F_DPT_INFO(HIRK_DPT_CD, '1') AS DEPT_NM
			  FROM TBDCMACM002M
			 WHERE DPT_TP_CD = 'A' /*지원부서만 가져온다. USE_YN컬럼을 안건 이유는 그것을 걸 경우 폐지된 부서는 볼수 없기 때문이다*/
			   AND HIRK_DPT_CD IS NOT NULL
			 GROUP BY HIRK_DPT_CD		
		  ]]>
	</select>

	<!-- 과/팀명 -->
	<select id="CSPAOECommonAudDeptCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT DPT_CD AS DEPT_CD
			     , F_DPT_INFO(DPT_CD, '1') AS DEPT_NM
			     , HIRK_DPT_CD AS DEPT_UP_CD
			  FROM TBDCMACM002M
			 WHERE DPT_TP_CD = 'A' /*지원부서만 가져온다. USE_YN컬럼을 안건 이유는 그것을 걸 경우 폐지된 부서는 볼수 없기 때문이다*/
			   AND SUBSTR(DPT_CD, 3) != '0000'		
		  ]]>
	</select>
	<!-- ############################# 평가기간관리 시작(CSPAOE001E) ############################### -->

	<!-- 평가기간 정보 조회 -->
	<select id="CSPAOE001Emainselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR         AS EVL_YR			/*평가년도*/
			     , HLYR_DVSN_CD   AS HLYR_DVSN_CD	/*반기구분코드*/ 
			     , EVL_STR_DT     AS EVL_STR_DT		/*평가시작일*/
			     , EVL_END_DT     AS EVL_END_DT		/*평가종료일*/
			     , SRCH_STR_DT		/*조회시작일*/
			     , SRCH_END_DT 		/*조회종료일*/
			  FROM TBCSPAOE001M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			 ORDER BY EVL_YR DESC, HLYR_DVSN_CD ASC
		]]>
	</select>

	<!-- 신규등록 전 중복된 정보가 있는지 체크한다. -->
	<select id="CSPAOE001ECntselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE001M D1
			 WHERE EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		]]>
	</select>
	
	<!-- 정상적인 시작일자인지 종료일자인지 체크한다. -->
	<select id="CSPAOE001ECntDateselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE001M
			 WHERE EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = DECODE(#HLYR_DVSN_CD#, '20', '10', '20')
			   AND ( #EVL_STR_DT# BETWEEN EVL_STR_DT AND  EVL_END_DT
			      OR #EVL_END_DT# BETWEEN EVL_STR_DT AND  EVL_END_DT)
		]]>
	</select>

	<!-- 평가기간 신규등록 -->
	<insert id="CSPAOE001Emaininsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPAOE001M
			(
				EVL_YR
				, HLYR_DVSN_CD
				, EVL_STR_DT
				, EVL_END_DT
				, SRCH_STR_DT
				, SRCH_END_DT
				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
			) VALUES
			(
				#EVL_YR#
				, #HLYR_DVSN_CD#
				, #EVL_STR_DT#
				, #EVL_END_DT#
				, #SRCH_STR_DT#
				, #SRCH_END_DT#
				, #FRT_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
			)
		]]>
	</insert>

	<!-- 평가기간 정보 수정 -->
	<update id="CSPAOE001Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE001M
		SET 
			FNL_MDF_DH = SYSDATE
			, EVL_STR_DT = #EVL_STR_DT#
			, EVL_END_DT = #EVL_END_DT#
			, SRCH_STR_DT = #SRCH_STR_DT#
			, SRCH_END_DT = #SRCH_END_DT#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</update>

	<!-- 평가기간 정보 삭제 -->
	<delete id="CSPAOE001Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE001M
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- ############################# 평가기간관리 끝 (CSPAOE001E) ##################################### -->

	<!-- ############################# 평가지표별 기준관리 시작(CSPAOE002E) ############################## -->

	<!-- 평가지표별 기준 정보 조회 -->
	<select id="CSPAOE002Emainselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT D2.EVL_YR        AS EVL_YR         /* 평가년도*/
			     , D2.HLYR_DVSN_CD  AS HLYR_DVSN_CD   /* 반기구분코드*/
			     , D1.EVL_STR_DT    AS EVL_STR_DT     /* 평가시작일*/
			     , D1.EVL_END_DT    AS EVL_END_DT     /* 평가종료일*/
			     , D2.EVL_INDEX_CD  AS EVL_INDEX_CD   /* 평가지표코드*/
			     , D2.EVL_INDEX_NM  AS EVL_INDEX_NM   /* 평가지표명*/
			     , D2.WGT_RTE       AS WGT_RTE        /* 비중율*/
			  FROM TBCSPAOE001M D1
			     , TBCSPAOE002M D2
			 WHERE D1.EVL_YR (+)       = D2.EVL_YR
			   AND D1.HLYR_DVSN_CD (+) = D2.HLYR_DVSN_CD
			   AND D2.EVL_YR           = #strEvlYr#
			   AND D2.HLYR_DVSN_CD     = #strHlyrDvsnCd#
			 ORDER BY D2.EVL_INDEX_CD
		]]>
	</select>

	<!-- 평가지표별 기준 정보 조회 -->
	<select id="CSPAOE002EMainInsertDataselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_STR_DT       AS EVL_STR_DT   /* 평가년도*/
			     , EVL_END_DT       AS EVL_END_DT   /* 반기구분코드*/
			  FROM TBCSPAOE001M
			 WHERE EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		]]>
	</select>

	<!-- 평가지표별 기준관리 신규등록 전 중복데이터 유무 체크 -->
	<select id="CSPAOE002ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE002M
			 WHERE 1=1
			   AND EVL_YR        = #EVL_YR#
			   AND HLYR_DVSN_CD  = #HLYR_DVSN_CD#
			   AND EVL_INDEX_CD  = #EVL_INDEX_CD#
		]]>
	</select>

	<!-- 평가지표별 기준관리 신규등록 -->
	<insert id="CSPAOE002Emaininsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	TBCSPAOE002M
			(
				EVL_YR
				, HLYR_DVSN_CD
				, EVL_INDEX_CD
				, EVL_INDEX_NM
				, WGT_RTE
				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
			) VALUES
			(
				#EVL_YR#
				, #HLYR_DVSN_CD#
				, UPPER(#EVL_INDEX_CD#)
				, #EVL_INDEX_NM#
				, #WGT_RTE#
				, #FRT_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
			)
		]]>
	</insert>

	<!-- 평가지표별 기준관리 정보 수정 -->
	<update id="CSPAOE002Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE002M
		SET 
			FNL_MDF_DH = SYSDATE
			, EVL_INDEX_NM = #EVL_INDEX_NM#
			, WGT_RTE = #WGT_RTE#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND EVL_INDEX_CD = #EVL_INDEX_CD#
	</update>

	<!-- 평가지표별 기준관리 정보 삭제하기전 자식테이블에 데이터가 있는지 체크 -->
	<select id="CSPAOE002ECntdelete" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE003D
			 WHERE 1 = 1
			   AND EVL_YR        = #EVL_YR#
			   AND HLYR_DVSN_CD  = #HLYR_DVSN_CD#
			   AND EVL_INDEX_CD  = #EVL_INDEX_CD#
		]]>
	</select>

	<!-- 평가지표별 기준관리 정보 삭제 -->
	<delete id="CSPAOE002Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE002M
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND EVL_INDEX_CD = #EVL_INDEX_CD#
	</delete>

	<!-- 평가기준 항목상세 조회 -->
	<select id="CSPAOE002Esubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.EVL_YR        AS EVL_YR         /* 평가년도*/
			     , D1.HLYR_DVSN_CD  AS HLYR_DVSN_CD   /* 반기구분코드*/
			     , D1.EVL_INDEX_CD  AS EVL_INDEX_CD   /* 평가지표코드*/
			     , D1.EVL_INDEX_NM  AS EVL_INDEX_NM   /* 평가지표명*/
			     , D2.EVL_STAD_CD   AS EVL_STAD_CD    /* 평가기준코드*/
			     , D2.EVL_STAD_NM   AS EVL_STAD_NM    /* 평가기준명*/
			  FROM TBCSPAOE002M D1
			     , TBCSPAOE003D D2
			 WHERE 1=1
			   AND D1.EVL_YR        = D2.EVL_YR
			   AND D1.HLYR_DVSN_CD  = D2.HLYR_DVSN_CD
			   AND D1.EVL_INDEX_CD  = D2.EVL_INDEX_CD
			   AND D1.EVL_YR        = #strEvlYr#
			   AND D1.HLYR_DVSN_CD  = #strHlyrDvsnCd#
			   AND D1.EVL_INDEX_CD  = #strEvlIndexCd#
			 ORDER BY D2.EVL_STAD_CD
		]]>
	</select>

	<!-- 평가기준 항목상세 신규등록 전 중복데이터 유무 체크 -->
	<select id="CSPAOE002ECntsubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE003D 
			 WHERE 1=1
			   AND EVL_YR        = #EVL_YR#
			   AND HLYR_DVSN_CD  = #HLYR_DVSN_CD#
			   AND EVL_INDEX_CD  = #EVL_INDEX_CD#
			   AND EVL_STAD_CD   = #EVL_STAD_CD#
		]]>
	</select>

	<!-- 평가기준 항목상세 신규등록 -->
	<insert id="CSPAOE002Esubinsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPAOE003D
			(
				EVL_YR
				, HLYR_DVSN_CD
				, EVL_INDEX_CD
				, EVL_STAD_CD
				, EVL_STAD_NM
				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
			) VALUES
			(
				#EVL_YR#
				, #HLYR_DVSN_CD#
				, UPPER(#EVL_INDEX_CD#)
				, UPPER(#EVL_STAD_CD#)
				, #EVL_STAD_NM#
				, #FRT_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
			)
		]]>
	</insert>

	<!-- 평가기준 항목상세 정보 수정 -->
	<update id="CSPAOE002Esubupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE003D
		SET 
			FNL_MDF_DH = SYSDATE
			, EVL_STAD_NM = #EVL_STAD_NM#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND EVL_INDEX_CD = #EVL_INDEX_CD#
		  AND EVL_STAD_CD = #EVL_STAD_CD#
	</update>

	<!-- 평가기준 항목상세 정보 삭제 -->
	<delete id="CSPAOE002Esubdelete" parameterClass="paramMap">
		DELETE TBCSPAOE003D
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND EVL_INDEX_CD = #EVL_INDEX_CD#
		<isNotEmpty prepend="AND" property="EVL_STAD_CD">
			EVL_STAD_CD = #EVL_STAD_CD#
		</isNotEmpty>
	</delete>

	<!-- ################################# 평가지표별 기준관리 끝(CSPAOE002E) ##################################### -->

	<!-- ################################# 감사업무종류별 평점수식관리 시작(CSPAOE003E) ############################ -->

	<!-- 항목명 조회 -->
	<select id="CSPAOE03ECluCdselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT CD 
			     , CD_NM || '(' || CD || ')' AS CD_NM
			  FROM TBDCMACM013C
			 WHERE 1=1
			   AND CD             <> '000000000'
			   AND CMM_CD_DVSN_CD ='1000281'
			   AND USE_YN         = 'Y'
			 ORDER BY OTPT_SEQ, CD 
		]]>
	</select>

	<!-- 감사업무종류별 평점수식 정보 조회 -->
	<select id="CSPAOE003Emainselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR             AS EVL_YR             /* 평가년도        */
			     , HLYR_DVSN_CD       AS HLYR_DVSN_CD       /* 반기구분코드    */
			     , TSK_DVSN_CD        AS TSK_DVSN_CD        /* 업무구분코드    */
			     , AUD_KND_CD         AS AUD_KND_CD         /* 감사종류코드    */
			     , STAD_MNDY_LES_CNT  AS STAD_MNDY_LES_CNT  /* 기준 연인원 이하*/
			  FROM TBCSPAOE004M
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD  = #strTskDvsnCd#
			 ORDER BY AUD_KND_CD
		]]>
	</select>

	<!-- 표준평점수식 상세 조회 -->
	<select id="CSPAOE003Esubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR                    AS EVL_YR                    /* 평가년도                */
			     , HLYR_DVSN_CD              AS HLYR_DVSN_CD              /* 반기구분코드            */
			     , TSK_DVSN_CD               AS TSK_DVSN_CD               /* 업무구분코드            */
			     , AUD_KND_CD                AS AUD_KND_CD                /* 감사종류코드            */
			     , SRNO                		 AS SRNO                /* 일련번호            */
			     , MNDY_CNT_1                AS MNDY_CNT_1                /* 연인원 1            */
			     , MNDY_CNT_2                AS MNDY_CNT_2                /* 연인원 2            */
			     , CLU_CD                    AS CLU_CD                    /* 항목코드                */
			     , STND_ASC_FML_TXT          AS STND_ASC_FML_TXT          /* 표준평점수식            */
			     , SYT_TRTM_STND_ASC_FML_TXT AS SYT_TRTM_STND_ASC_FML_TXT /* 종합처리안 표준평점수식 */
			     , IDVT_TRTM_STND_ASC_FML_TXT							  /* 개별처리안 표준평점수식*/
			  FROM TBCSPAOE044M 
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD  = #strTskDvsnCd#
			   AND AUD_KND_CD   = #strAudKndCd#
			 ORDER BY AUD_KND_CD, MNDY_CNT_1
		]]>
	</select>

	<!-- 감사업무종류별 평점수식 신규등록 전 중복 데이터 체크 -->
	<select id="CSPAOE003ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE004M
			 WHERE 1=1
			   AND EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD  = #TSK_DVSN_CD#
			   AND AUD_KND_CD   = #AUD_KND_CD#
		]]>
	</select>

	<!-- 감사업무종류별 평점수식 신규등록 -->
	<insert id="CSPAOE003Emaininsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPAOE004M
			(
				EVL_YR
				, HLYR_DVSN_CD
				, TSK_DVSN_CD
				, AUD_KND_CD
				, STAD_MNDY_LES_CNT
				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
			) VALUES
			(
				#EVL_YR#
				, #HLYR_DVSN_CD#
				, #TSK_DVSN_CD#
				, #AUD_KND_CD#
				, #STAD_MNDY_LES_CNT#
				, #FRT_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
			)
		]]>
	</insert>

	<!-- 감사업무종류별 평점수식 정보 수정 -->
	<update id="CSPAOE003Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE004M
		SET 
			FNL_MDF_DH = SYSDATE
			, STAD_MNDY_LES_CNT = #STAD_MNDY_LES_CNT#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD = #TSK_DVSN_CD#
		  AND AUD_KND_CD = #AUD_KND_CD#
	</update>

	<!-- 감사업무종류별 평점수식 삭제시 자식테이블에 데이터있는지 확인하거나 표준평점수식 상세 정보 신규 등록시 중복데이터 유무 체크 -->
	<select id="CSPAOE003ECntsubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE044M
			 WHERE EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD  = #TSK_DVSN_CD#
			   AND AUD_KND_CD   = #AUD_KND_CD#
	   ]]>
			<isNotEmpty prepend="AND" property="MNDY_CNT_1">
				 ( (MNDY_CNT_1 BETWEEN #MNDY_CNT_1# AND #MNDY_CNT_2#) 
						OR
					  (MNDY_CNT_2 BETWEEN #MNDY_CNT_1# AND #MNDY_CNT_2#)
					)
			</isNotEmpty>
	</select>

	<!-- 감사업무종류별 평점수식 삭제 -->
	<delete id="CSPAOE003Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE004M
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD = #TSK_DVSN_CD#
		   AND AUD_KND_CD = #AUD_KND_CD#
	</delete>

	<!-- 표준평점수식상세 신규등록 -->
	<insert id="CSPAOE003Esubinsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPAOE044M
			(
				EVL_YR
				, HLYR_DVSN_CD
				, TSK_DVSN_CD
				, AUD_KND_CD
				, SRNO
				, MNDY_CNT_1
				, MNDY_CNT_2
				, CLU_CD
				, STND_ASC_FML_TXT
				, SYT_TRTM_STND_ASC_FML_TXT
				, IDVT_TRTM_STND_ASC_FML_TXT
				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
			) VALUES
			(
				#EVL_YR#
				, #HLYR_DVSN_CD#
				, #TSK_DVSN_CD#
				, #AUD_KND_CD#
				, (SELECT	NVL(MAX(TO_NUMBER(SRNO)),0)+1
					FROM	TBCSPAOE044M S1
					WHERE 	S1.EVL_YR = #EVL_YR#
					AND		S1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
					AND		S1.TSK_DVSN_CD = #TSK_DVSN_CD#
					AND		S1.AUD_KND_CD = #AUD_KND_CD#
					)
				, #MNDY_CNT_1#
				, #MNDY_CNT_2#
				, #CLU_CD#
				, #STND_ASC_FML_TXT#
				, #SYT_TRTM_STND_ASC_FML_TXT#
				, #IDVT_TRTM_STND_ASC_FML_TXT#
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
			)
		]]>	
	</insert>

	<!-- 표준평점수식상세 정보 수정 -->
	<update id="CSPAOE003Esubupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE005D
		SET 
			FNL_MDF_DH = SYSDATE
			, CLU_CD = #CLU_CD#
			, STND_ASC_FML_TXT = #STND_ASC_FML_TXT#
			, SYT_TRTM_STND_ASC_FML_TXT = #SYT_TRTM_STND_ASC_FML_TXT#
			, IDVT_TRTM_STND_ASC_FML_TXT = #IDVT_TRTM_STND_ASC_FML_TXT#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD = #TSK_DVSN_CD#
		  AND AUD_KND_CD = #AUD_KND_CD#
		  AND SRNO = #SRNO#
	</update>

	<!-- 표준평점수식상세 삭제 -->
	<delete id="CSPAOE003Esubdelete" parameterClass="paramMap">
		DELETE TBCSPAOE044M
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD = #TSK_DVSN_CD#
		   AND AUD_KND_CD = #AUD_KND_CD#
		<isNotEmpty prepend="AND" property="SRNO">
			SRNO = #SRNO#
		</isNotEmpty>
	</delete>
	<!-- ############################ 감사업무종류별 평점수식관리 끝(CSPAOE003E) ##################################### -->

	<!-- ############################ 감사외업무 종류별 표준평점관리 시작(CSPAOE004E) ##################################### -->

	<!-- 감사외업무 종류별 표준평점 정보 조회 -->
	<select id="CSPAOE004Emainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.EVL_YR         AS EVL_YR			/*평가년도*/
			     , D1.HLYR_DVSN_CD   AS HLYR_DVSN_CD	/*반기구분코드*/
			     , D1.TSK_DVSN_CD    AS TSK_DVSN_CD		/*업무구분코드*/
			     , D1.TSK_KND_CD     AS TSK_KND_CD		/*업무종류코드*/
			     , D1.STND_ASC       AS STND_ASC        /*표준평점*/
			     , D1.STND_ASC_1     AS STND_ASC_1      /*표준평점1*/
			     , D1.STND_ASC_2     AS STND_ASC_2      /*표준평점2*/
			     , D1.STND_ASC_3     AS STND_ASC_3      /*표준평점3*/
			  FROM TBCSPAOE006M D1
			 WHERE 1=1
			   AND D1.EVL_YR       = #strEvlYr#
			   AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND D1.TSK_DVSN_CD  = #strTskDvsnCd#
			 ORDER BY D1.TSK_KND_CD
		]]>
	</select>

	<!-- 감사외업무 종류별 표준평점 신규전 중복된 데이터 있는지 체크 -->
	<select id="CSPAOE004ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE006M D1
			 WHERE 1=1
			   AND D1.EVL_YR       = #EVL_YR#
			   AND D1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND D1.TSK_DVSN_CD  = #TSK_DVSN_CD#
			   AND D1.TSK_KND_CD   = #TSK_KND_CD#
		]]>
	</select>

	<!-- 감사외업무 종류별 표준평점 신규등록 -->
	<insert id="CSPAOE004Emaininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE006M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, TSK_KND_CD
			, STND_ASC
			, STND_ASC_1
			, STND_ASC_2
			, STND_ASC_3
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #TSK_KND_CD#
			, #STND_ASC#
			, #STND_ASC_1#
			, #STND_ASC_2#
			, #STND_ASC_3#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사외업무 종류별 표준평점 정보 수정 -->
	<update id="CSPAOE004Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE006M
		SET 
			FNL_MDF_DH = SYSDATE
			, STND_ASC = #STND_ASC#
		<isNotEmpty prepend="," property="STND_ASC_1">
			STND_ASC_1 = #STND_ASC_1#
		</isNotEmpty>
		<isNotEmpty prepend="," property="STND_ASC_2">
			STND_ASC_2 = #STND_ASC_2#
		</isNotEmpty>
		<isNotEmpty prepend="," property="STND_ASC_3">
			STND_ASC_3 = #STND_ASC_3#
		</isNotEmpty>
		<isEmpty prepend="," property="STND_ASC_1">
			STND_ASC_1 = 0
		</isEmpty>
		<isEmpty prepend="," property="STND_ASC_2">
			STND_ASC_2 = 0
		</isEmpty>
		<isEmpty prepend="," property="STND_ASC_3">
			STND_ASC_3 = 0
		</isEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_DVSN_CD = #TSK_DVSN_CD#
		AND TSK_KND_CD = #TSK_KND_CD#
	</update>

	<!-- 감사외업무 종류별 표준평점 정보 삭제 -->
	<delete id="CSPAOE004Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE006M
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD = #TSK_DVSN_CD#
		   AND TSK_KND_CD = #TSK_KND_CD#
	</delete>

	<!-- ########################### 감사외업무 종류별 표준평점관리 끝(CSPAOE004E) ################################### -->

	<!-- ################################### 감단계별 기준관리 시작(CSPAOE005E) ##################################### -->

	<!-- 감사단계별 기준관리 정보 조회 -->
	<select id="CSPAOE005EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR         AS EVL_YR			/*평가년도*/
			     , HLYR_DVSN_CD   AS HLYR_DVSN_CD	/*반기구분코드*/
			     , TSK_DVSN_CD    AS TSK_DVSN_CD	    /*업무구분코드*/
			     , AUD_KND_CD     AS AUD_KND_CD		/*감사종류코드*/
			  FROM TBCSPAOE007M D1
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD  = #strTskDvsnCd#
			 ORDER BY D1.AUD_KND_CD
		]]>
	</select>

	<!-- 감사단계별 기준관리 신규 등록시 중복데이터 유무 체크 -->
	<select id="CSPAOE005ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE007M
			 WHERE 1=1
			   AND EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD  = #TSK_DVSN_CD#
			   AND AUD_KND_CD   = #AUD_KND_CD#
	   ]]>
	</select>

	<!-- 감사단계별 기준관리 신규등록 -->
	<insert id="CSPAOE005EMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE007M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_KND_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #AUD_KND_CD#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사단계별 기준관리 정보 삭제 -->
	<delete id="CSPAOE005EMainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE007M
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD = #TSK_DVSN_CD#
		   AND AUD_KND_CD = #AUD_KND_CD#
	</delete>

	<!-- 감사단계 기준상세 조회 -->
	<select id="CSPAOE005ESubSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR                   AS EVL_YR			     /*평가년도*/
			     , HLYR_DVSN_CD             AS HLYR_DVSN_CD	         /*반기구분코드*/
			     , TSK_DVSN_CD              AS TSK_DVSN_CD	         /*업무구분코드*/
			     , AUD_KND_CD               AS AUD_KND_CD		     /*감사종류코드*/
			     , AUD_STEP_CD              AS AUD_STEP_CD           /*감사단계코드*/
			     , AUD_STEP_CD              AS AUD_STEP_NM           /*감사단계코드*/
			     , DRIVE_RTE                AS DRIVE_RTE             /*추진율*/
			     , STAD_PRD_DCN             AS STAD_PRD_DCN          /*기준기간일수*/
			     , ELY_ADPT_STAD_RK_CD      AS ELY_ADPT_STAD_RK_CD   /*조기가점 기준등급코드*/
			     , NVL(EVLT_ASG_YN, 'N')    AS EVLT_ASG_YN           /*평가자 지정여부*/
			  FROM TBCSPAOE008D 
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD  = #strTskDvsnCd#
			   AND AUD_KND_CD   = #strAudKndCd#
			 ORDER BY AUD_STEP_CD 
		]]>
	</select>

	<!-- 감사단계 기준상세 신규등록 -->
	<insert id="CSPAOE005ESubInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE008D
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_KND_CD
			, AUD_STEP_CD
			, DRIVE_RTE
			, STAD_PRD_DCN
			, ELY_ADPT_STAD_RK_CD
			, EVLT_ASG_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #AUD_KND_CD#
			, #AUD_STEP_CD#
			, #DRIVE_RTE#
			, #STAD_PRD_DCN#
			, #ELY_ADPT_STAD_RK_CD#
			, NVL(#EVLT_ASG_YN#, 'N')
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사단계 기준상세 정보 수정 -->
	<update id="CSPAOE005ESubUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE008D
		SET 
			FNL_MDF_DH = SYSDATE
			, DRIVE_RTE = #DRIVE_RTE#
			, ELY_ADPT_STAD_RK_CD = #ELY_ADPT_STAD_RK_CD#
			, STAD_PRD_DCN = #STAD_PRD_DCN#
			, EVLT_ASG_YN = NVL(#EVLT_ASG_YN#, 'N')
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_DVSN_CD = #TSK_DVSN_CD#
		AND AUD_KND_CD = #AUD_KND_CD#
		AND AUD_STEP_CD = #AUD_STEP_CD#
	</update>

	<!-- 감사단계별 기준관리 삭제시 자식테이블에 데이터있는지 확인하거나 감사단계 기준상세 정보 신규 등록시 중복데이터 유무 체크 -->
	<select id="CSPAOE005ECntsubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE008D
			 WHERE 1=1
			   AND EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD  = #TSK_DVSN_CD#
			   AND AUD_KND_CD   = #AUD_KND_CD#
	   ]]>
			<isNotEmpty prepend="AND" property="AUD_STEP_CD">
				AUD_STEP_CD = #AUD_STEP_CD#
			</isNotEmpty>
	</select>

	<!-- 감사단계 기준상세 삭제 -->
	<delete id="CSPAOE005ESubDelete" parameterClass="paramMap">
		DELETE TBCSPAOE008D
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD = #TSK_DVSN_CD#
		   AND AUD_KND_CD = #AUD_KND_CD#
		<isNotEmpty prepend="AND" property="AUD_STEP_CD">
			AUD_STEP_CD = #AUD_STEP_CD#
		</isNotEmpty>
	</delete>

	<!-- ############################ 감단계별 기준관리 끝(CSPAOE005E) ##################################### -->

	<!-- ############################ 평가등급별 기준관리 시작(CSPAOE006E) ##################################### -->

	<!-- 평가등급별 기준관리 정보 조회 -->
	<select id="CSPAOE006EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR          AS EVL_YR          /* 평가년도         */
			     , HLYR_DVSN_CD    AS HLYR_DVSN_CD    /* 반기구분코드     */
			     , TSK_DVSN_CD     AS TSK_DVSN_CD     /* 업무구분코드     */
			     , AUD_TSK_KND_CD  AS AUD_TSK_KND_CD  /* 감사업무종류코드 */
			  FROM TBCSPAOE009M
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD  = #strTskDvsnCd#
			 ORDER BY AUD_TSK_KND_CD
		]]>
	</select>

	<!-- 평가등급 상세 조회 -->
	<select id="CSPAOE006ESubSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR          AS EVL_YR          /* 평가년도                */
			     , HLYR_DVSN_CD    AS HLYR_DVSN_CD    /* 반기구분코드            */
			     , TSK_DVSN_CD     AS TSK_DVSN_CD     /* 업무구분코드            */
			     , AUD_TSK_KND_CD  AS AUD_TSK_KND_CD  /* 감사업무종류코드        */
			     , RK_CD           AS RK_CD           /* 등급코드                */
			     , RK_CD           AS RK_NM           /* 등급코드                */
			     , RK_ASC          AS RK_ASC          /* 등급평점                */
			     , IDVT_INDEX_VAL  AS IDVT_INDEX_VAL  /* 성과가중치 개별지표     */
			     , SUM_INDEX_VAL   AS SUM_INDEX_VAL   /* 성과가중치 합계지표     */
			     , EVL_STAD_TXT    AS EVL_STAD_TXT    /* 평가기준내용            */
			     , IDCT_YN         AS IDCT_YN         /* 표시여부                */
			  FROM TBCSPAOE010D 
			 WHERE 1=1
			   AND EVL_YR           = #strEvlYr#
			   AND HLYR_DVSN_CD     = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD      = #strTskDvsnCd#
			   AND AUD_TSK_KND_CD   = #strAudTskKndCd#
			 ORDER BY RK_CD
		]]>
	</select>

	<!-- 신규 등록 전에 중복데이터 체크 -->
	<select id="CSPAOE006ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE009M
			 WHERE 1=1
			   AND EVL_YR           = #EVL_YR#
			   AND HLYR_DVSN_CD     = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD      = #TSK_DVSN_CD#
			   AND AUD_TSK_KND_CD   = #AUD_TSK_KND_CD#
		]]>
	</select>

	<!-- 평가등급별 기준 신규등록 -->
	<insert id="CSPAOE006EMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE009M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #AUD_TSK_KND_CD#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 평가등급별 기준 삭제 -->
	<delete id="CSPAOE006Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE009M
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD = #TSK_DVSN_CD#
		   AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
	</delete>

	<!-- 평가등급 상세 신규등록 -->
	<insert id="CSPAOE006ESubInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE010D
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, RK_CD
			, RK_ASC
			, IDVT_INDEX_VAL
			, SUM_INDEX_VAL
			, EVL_STAD_TXT
			, IDCT_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #AUD_TSK_KND_CD#
			, #RK_CD#
			, #RK_ASC#
			, #IDVT_INDEX_VAL#
			, #SUM_INDEX_VAL#
			, #EVL_STAD_TXT#
			, NVL(#IDCT_YN#, 'N')
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 평가등급 상세 정보 수정 -->
	<update id="CSPAOE006ESubUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE010D
		SET 
			FNL_MDF_DH = SYSDATE
			, RK_ASC = #RK_ASC#
			, IDVT_INDEX_VAL = #IDVT_INDEX_VAL#
			, SUM_INDEX_VAL = #SUM_INDEX_VAL#
			, EVL_STAD_TXT = #EVL_STAD_TXT#
			, IDCT_YN = NVL(#IDCT_YN#, 'N')
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_DVSN_CD = #TSK_DVSN_CD#
		AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		AND RK_CD = #RK_CD#
	</update>

	<!-- 평가등급 상세 삭제 -->
	<delete id="CSPAOE006ESubDelete" parameterClass="paramMap">
		DELETE TBCSPAOE010D
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD = #TSK_DVSN_CD#
		   AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		<isNotEmpty prepend="AND" property="RK_CD">
			RK_CD = #RK_CD#
		</isNotEmpty>
	</delete>

	<!-- 신규 등록 전에 중복데이터 체크 -->
	<!-- 마스터 삭제전 디테일 카운트 -->
	<select id="CSPAOE006ECntsubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE010D
			 WHERE 1=1
			   AND EVL_YR           = #EVL_YR#
			   AND HLYR_DVSN_CD     = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD      = #TSK_DVSN_CD#
			   AND AUD_TSK_KND_CD   = #AUD_TSK_KND_CD#
		]]>
			<isNotEmpty property="RK_CD">
				AND RK_CD = #RK_CD#
			</isNotEmpty>
	</select>
	
	<!-- ##################################### 평가등급별 기준관리 끝(CSPAOE006E) ##################################### -->

	<!-- ##################################### 특별가산점관리 시작(CSPAOE007E) ##################################### -->

	<!-- 특별가산점 정보 조회 -->
	<select id="CSPAOE007Emainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.EVL_YR            AS EVL_YR	    /*평가년도*/
			     , D1.HLYR_DVSN_CD      AS HLYR_DVSN_CD	/*반기구분코드*/
			     , D1.CLU_CD            AS CLU_CD		/*항목코드*/
			     , D1.CLU_NM            AS CLU_NM		/*항목명*/
			     , D1.CLU_SC            AS CLU_SC		/*항목점수*/
			     , D1.CLU_TXT           AS CLU_TXT		/*항목내용*/
			     , NVL(D1.USE_YN, 'N')  AS USE_YN		/*사용여부*/
			  FROM TBCSPAOE011M D1
			 WHERE 1=1
			   AND D1.EVL_YR       = #strEvlYt#
			   AND D1.HLYR_DVSN_CD = #strHlytDvsnCd#		]]>
		<isNotEmpty property="strUseYn">
			   AND D1.USE_YN = #strUseYn#
		</isNotEmpty>
             ORDER BY D1.CLU_CD
	</select>

	<!-- 특별가산점 신규등록시 중복테이터 체크 -->
	<select id="CSPAOE007ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE011M D1
			 WHERE 1=1
			   AND D1.EVL_YR       = #EVL_YR#
			   AND D1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND D1.CLU_CD       = #CLU_CD#
		]]>
	</select>

	<!-- 특별가산점 신규등록 -->
	<insert id="CSPAOE007Emaininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE011M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, CLU_CD
			, CLU_NM
			, CLU_SC
			, CLU_TXT
			, USE_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, UPPER(#CLU_CD#)
			, #CLU_NM#
			, #CLU_SC#
			, #CLU_TXT#
			, NVL(#USE_YN#, 'N')
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 특별가산점 정보 수정 -->
	<update id="CSPAOE007Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE011M
		SET 
			FNL_MDF_DH = SYSDATE
			, CLU_NM = #CLU_NM#
			, CLU_SC = #CLU_SC#
			, CLU_TXT = #CLU_TXT#
			, USE_YN = NVL(#USE_YN#, 'N')
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND CLU_CD = #CLU_CD#
	</update>

	<!-- 특별가산점 정보 삭제 -->
	<delete id="CSPAOE007Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE011M
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND CLU_CD = #CLU_CD#
	</delete>

	<!-- ##################################### 특별가산점관리 끝 (CSPAOE007E) ##################################### -->

	<!-- ########################## 조기/지연처리 가감점관리 시작(CSPAOE008E) ##################################### -->

	<!-- 조기/지연처리 가감점 정보 조회 -->
	<select id="CSPAOE008Emainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR                       AS EVL_YR	         /*평가년도*/
			     , HLYR_DVSN_CD                 AS HLYR_DVSN_CD	     /*반기구분코드*/
			     , HNDL_PRD_CD                  AS HNDL_PRD_CD	     /*처리기간코드*/
			     , HNDL_PRD_DVSN_CD             AS HNDL_PRD_DVSN_CD  /*처리기간구분코드*/
			     , HNDL_PRD_DCN                 AS HNDL_PRD_DCN	     /*처리기간일자*/
			     , DLAY_DT_NM                   AS DLAY_DT_NM        /*지연일명*/  
			     , TO_CHAR(ASP_RTE,'FM999.00')  AS ASP_RTE	         /*가감점율*/
			  FROM TBCSPAOE012M
			 WHERE 1=1
			   AND EVL_YR           = #strEvlYr#
			   AND HLYR_DVSN_CD     = #strHlyrDvsnCd#		]]>
			<isNotEmpty property="strHndlPrdDvsnCd">
				AND HNDL_PRD_DVSN_CD = #strHndlPrdDvsnCd#
			</isNotEmpty>
			  ORDER BY TO_NUMBER(SUBSTR(HNDL_PRD_CD,3))
	</select>

	<!-- 조기/지연처리 가감점 신규등록 전 중복된 데이터 체크 -->
	<select id="CSPAOE008ECntselect01" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE012M
			 WHERE 1=1
			   AND EVL_YR           = #EVL_YR#
			   AND HLYR_DVSN_CD     = #HLYR_DVSN_CD#
			   AND HNDL_PRD_DCN     = #HNDL_PRD_DCN#
		]]>
	</select>

	<!-- 조기/지연처리 가감점 신규등록 전 중복된 데이터 체크 -->
	<select id="CSPAOE008ECntselect02" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE012M
			 WHERE 1=1
			   AND EVL_YR           = #EVL_YR#
			   AND HLYR_DVSN_CD     = #HLYR_DVSN_CD#
			   AND HNDL_PRD_DVSN_CD = #HNDL_PRD_DVSN_CD#
			   AND HNDL_PRD_DCN     = #HNDL_PRD_DCN#
		]]>
	</select>

	<!-- 조기/지연처리 가감점 신규등록 -->
	<insert id="CSPAOE008Emaininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE012M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, HNDL_PRD_CD
			, HNDL_PRD_DVSN_CD
			, HNDL_PRD_DCN
			, DLAY_DT_NM
			, ASP_RTE
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, UPPER(#HNDL_PRD_CD#)
			, #HNDL_PRD_DVSN_CD#
			, #HNDL_PRD_DCN#
			, #DLAY_DT_NM#
			, #ASP_RTE#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 조기/지연처리 가감점 정보 수정 -->
	<update id="CSPAOE008Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE012M
		SET 
			FNL_MDF_DH = SYSDATE
			, DLAY_DT_NM = #DLAY_DT_NM#
			, ASP_RTE = #ASP_RTE#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND HNDL_PRD_CD = #HNDL_PRD_CD#
		AND HNDL_PRD_DVSN_CD = #HNDL_PRD_DVSN_CD#
		AND HNDL_PRD_DCN = #HNDL_PRD_DCN#
	</update>

	<!-- 조기/지연처리 가감점 정보 삭제 -->
	<delete id="CSPAOE008Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE012M
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND HNDL_PRD_CD = #HNDL_PRD_CD#
		   AND HNDL_PRD_DVSN_CD = #HNDL_PRD_DVSN_CD#
		   AND HNDL_PRD_DCN = #HNDL_PRD_DCN#
	</delete>

	<!-- ########################### 조기/지연처리 가감점관리 끝 (CSPAOE008E) ############################# -->

	<!-- ##################################### 담당자관리 시작 (CSPAOE013E) ################################ -->
	<!-- 감사업무종류 조회 -->
	<select id="CSPAOE013EAudTskKndCdListselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CD
			     , CD_NM
			     , CMM_CD_DVSN_CD AS CD_KEY
			  FROM TBDCMACM013C 
			WHERE CMM_CD_DVSN_CD = '1000270'
			  AND NVL(USE_YN, 'N') = 'Y'
			  AND CD <> '000000000'
			  AND CD <> '10000'
			UNION ALL
			SELECT CD
			     , CD_NM
			     , CMM_CD_DVSN_CD
			  FROM TBDCMACM013C 
			WHERE CMM_CD_DVSN_CD = '1000272'
			  AND NVL(USE_YN, 'N') = 'Y'
			  AND CD <> '000000000'
			  AND CD <> '10000'
			UNION ALL
			SELECT CD
			     , CD_NM
			     , '1000277' AS CD_KEY
			  FROM TBDCMACM013C 
			WHERE CMM_CD_DVSN_CD = '1000270'
			  AND NVL(USE_YN, 'N') = 'Y'
			  AND CD = '10000'			
		]]>
	</select>

	<!-- 온로드시 업무구분 코드 조회 단 운영직업무코드는 제외(다른 화면에서 관리) -->
	<select id="CSPAOE013ETskDvsnCdListselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CD
			     , CD_NM
			     , CMM_CD_DVSN_CD
			  FROM TBDCMACM013C 
			 WHERE 1=1
			   AND CMM_CD_DVSN_CD = '1000269'
			   AND NVL(USE_YN, 'N') = 'Y'
			   AND CD NOT IN ('10003', '000000000') /*운영직업무코드 제외*/
		]]>
	</select>
	
	<!-- 조회하기전 디폴트값 세팅을 위해 카운트 -->
	<select id="selectmainListCnt" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE016M
			 WHERE 1=1
			   AND EVL_YR           = #strEvlYr#
			   AND HLYR_DVSN_CD     = #strHlyrDvsnCd#
		]]>
	</select>

	<!-- 담당자관리 조회한다. -->
	<select id="CSPAOE013Emainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR             AS EVL_YR	           /*평가년도*/
			     , HLYR_DVSN_CD       AS HLYR_DVSN_CD	   /*반기구분코드*/
			     , TSK_DVSN_CD        AS TSK_DVSN_CD	   /*업무구분코드*/
			     , F_CODE_NM ('1000272', AUD_TSK_KND_CD) AS TSK_DVSN_NM
			     , AUD_TSK_KND_CD     AS AUD_TSK_KND_CD    /*감사업무종류코드*/
			     , CHGR_DVSN_CD       AS CHGR_DVSN_CD	   /*담당자구분코드*/
			     , CHGR_DVSN_NM       AS CHGR_DVSN_NM      /*담당자구분명*/  
			  FROM TBCSPAOE016M
			 WHERE 1=1
			   AND EVL_YR           = #strEvlYr#
			   AND HLYR_DVSN_CD     = #strHlyrDvsnCd#
		]]>
			<isNotEmpty property="strTskDvsnCd">
				AND TSK_DVSN_CD = #strTskDvsnCd#
			</isNotEmpty>
			  ORDER BY TSK_DVSN_CD,  TO_NUMBER(SUBSTR(CHGR_DVSN_CD, 3))
	</select>

	<!-- 담당자관리_ 담당자 상세 조회 -->
	<select id="CSPAOE013Esubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR                        AS EVL_YR	        /*평가년도*/
			     , HLYR_DVSN_CD                  AS HLYR_DVSN_CD	/*반기구분코드*/
			     , TSK_DVSN_CD                   AS TSK_DVSN_CD	    /*업무구분코드*/
			     , AUD_TSK_KND_CD                AS AUD_TSK_KND_CD	/*감사업무종류코드*/
			     , CHGR_DVSN_CD                  AS CHGR_DVSN_CD	/*담당자구분코드*/
			     , CHGR_CNB                      AS CHGR_CNB        /*담당자 전산번호*/  
			     , EVL_CMTR_NO                   AS EVL_CMTR_NO     /*평가위원번호*/  
			     , BLT_DPT_CD                    AS BLT_DPT_CD      /*소속부서코드*/  
			     , F_DPT_INFO(BLT_DPT_CD, '1')   AS BLT_DPT_NM      /*소속부서명*/
			     , RANK_CD                       AS RANK_CD         /*직급코드*/ 
			     , F_CODE_NM('1000173', RANK_CD) AS RANK_NM         /*직급명*/
			     , F_USR_INFO(CHGR_CNB, '2')     AS NAM             /*성명*/ 
			     , CHGR_CNB                      AS CHGR_CNB_BAK    /*담당자 전산번호 뺵업 최원형 감사관님 요청사항 : 부서목록은 다 보이도록*/ 
			     , END_AUTH_YN                   AS END_AUTH_YN     /*감사종료권한여부*/ 
			  FROM TBCSPAOE017D 
			 WHERE 1=1
			   AND EVL_YR           = #strEvlYr#
			   AND HLYR_DVSN_CD     = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD      = #strTskDvsnCd#
			   AND AUD_TSK_KND_CD   = #strAudTskKndCd#
			   AND CHGR_DVSN_CD     = #strChgrDvsnCd#
			 ORDER BY BLT_DPT_CD, CHGR_CNB, EVL_CMTR_NO
		]]>
	</select>

	<!-- 담당자관리 삭제하기 전 하위 테이블에 데이터가 존재 여부 체크 -->
	<select id="CSPAOE013ECntdelete" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE017D 
			 WHERE 1 = 1
			   AND EVL_YR         = #EVL_YR#
			   AND HLYR_DVSN_CD   = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD    = #TSK_DVSN_CD#
			   AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
			   AND CHGR_DVSN_CD   = #CHGR_DVSN_CD#
		]]>
	</select>

	<!-- 담당자관리 정보 삭제 -->
	<delete id="CSPAOE013Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE016M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_DVSN_CD = #TSK_DVSN_CD#
		AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		AND CHGR_DVSN_CD = #CHGR_DVSN_CD#
	</delete>

	<!-- 담당자 정보 신규등록 전 중복 데이터 체크 -->
	<select id="CSPAOE013ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE016M 
			 WHERE 1 = 1
			   AND EVL_YR         = #EVL_YR#
			   AND HLYR_DVSN_CD   = #HLYR_DVSN_CD#
			   AND CHGR_DVSN_CD   = #CHGR_DVSN_CD#
		]]>
	</select>

	<!-- 담당자관리_담당자 정보 등록 -->
	<insert id="CSPAOE013Emaininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE016M
			(
				  EVL_YR
				, HLYR_DVSN_CD
				, TSK_DVSN_CD
				, AUD_TSK_KND_CD
				, CHGR_DVSN_CD
				, CHGR_DVSN_NM
				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
			)
			VALUES
			(
				  #EVL_YR#
				, #HLYR_DVSN_CD#
				, #TSK_DVSN_CD#
				, #AUD_TSK_KND_CD#
				, UPPER(#CHGR_DVSN_CD#)
				, #CHGR_DVSN_NM#
				, #FRT_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
			)
	</insert>

	<!-- 담당자관리_담당자 정보 수정 -->
	<update id="CSPAOE013Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE016M
		   SET 
		   	   FNL_MDF_DH = SYSDATE
		     , CHGR_DVSN_NM = #CHGR_DVSN_NM#
			<isNotEmpty prepend="," property="FNL_USR_ID">
				FNL_USR_ID = #FNL_USR_ID#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
				FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_MNU_ID">
				FNL_MNU_ID = #FNL_MNU_ID#
			</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR         = #EVL_YR#
		  AND HLYR_DVSN_CD   = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD    = #TSK_DVSN_CD#
		  AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		  AND CHGR_DVSN_CD   = #CHGR_DVSN_CD#
	</update>

	<!-- 신규등록전 중복데이터 유무 체크 -->
	<select id="CSPAOE013ECntsubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE017D 
			 WHERE 1 = 1
			   AND EVL_YR         = #EVL_YR#
			   AND HLYR_DVSN_CD   = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD    = #TSK_DVSN_CD#
			   AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
			   AND CHGR_DVSN_CD   = #CHGR_DVSN_CD#
			   AND CHGR_CNB       = #CHGR_CNB#
			   AND BLT_DPT_CD     = #BLT_DPT_CD#
		]]>
	</select>

	<!-- 담당자관리_담당자 상세 신규등록 -->
	<insert id="CSPAOE013Esubinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE017D
			(
				  EVL_YR
				, HLYR_DVSN_CD
				, TSK_DVSN_CD
				, AUD_TSK_KND_CD
				, CHGR_DVSN_CD
				, CHGR_CNB
				, EVL_CMTR_NO
				, BLT_DPT_CD
				, RANK_CD
				, FRT_USR_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MNU_ID
				, FRT_REGI_DH
				, FNL_MDF_DH
				, END_AUTH_YN
			) 
			VALUES
			(
				  #EVL_YR#
				, #HLYR_DVSN_CD#
				, #TSK_DVSN_CD#
				, #AUD_TSK_KND_CD#
				, UPPER(#CHGR_DVSN_CD#)
				, #CHGR_CNB#
				, (SELECT NVL(MAX(EVL_CMTR_NO), 0) + 1 AS EVL_CMTR_NO
					 FROM TBCSPAOE017D
					WHERE EVL_YR         = #EVL_YR#
					  AND HLYR_DVSN_CD   = #HLYR_DVSN_CD#
					  AND TSK_DVSN_CD    = #TSK_DVSN_CD#
					  AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
					  AND CHGR_DVSN_CD   = #CHGR_DVSN_CD#
					)
				, #BLT_DPT_CD#
				, #RANK_CD#
				, #FRT_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
				, #END_AUTH_YN#
			)
	</insert>
	
	<!-- 평가자 등록한다.-->
	<update id="CSPAOE013Esubupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE017D
	       SET 
	       	   FNL_MDF_DH = SYSDATE
		     , CHGR_CNB   = #CHGR_CNB#
			<isNotEmpty prepend="," property="FNL_USR_ID">
				FNL_USR_ID = #FNL_USR_ID#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
				FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_MNU_ID">
				FNL_MNU_ID = #FNL_MNU_ID#
			</isNotEmpty>
			<isNotEmpty prepend="," property="END_AUTH_YN">
				END_AUTH_YN = #END_AUTH_YN#
			</isNotEmpty>
		 WHERE 1=1
		   AND EVL_YR         = #EVL_YR#
		   AND HLYR_DVSN_CD   = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD    = #TSK_DVSN_CD#
		   AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		   AND CHGR_DVSN_CD   = #CHGR_DVSN_CD#
		   AND CHGR_CNB       = #CHGR_CNB_BAK#
		   AND BLT_DPT_CD     = #BLT_DPT_CD#
	</update>

	<!-- 담당자 상세정보 삭제 -->
	<delete id="CSPAOE013Esubdelete" parameterClass="paramMap">
		DELETE TBCSPAOE017D
		 WHERE 1=1
		   AND EVL_YR         = #EVL_YR#
		   AND HLYR_DVSN_CD   = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD    = #TSK_DVSN_CD#
		   AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		   AND CHGR_DVSN_CD   = #CHGR_DVSN_CD#
		   AND CHGR_CNB       = #CHGR_CNB#
		   AND BLT_DPT_CD     = #BLT_DPT_CD#
	</delete>	
	
	<!-- ################################## 담당자관리 끝 (CSPAOE013E) ##################################### -->

	<!-- ########################### 사용자정보 조회(팝업) 시작 (CSPAOE083P) ############################### -->

	<!-- 팝업 임포트에서 사용자정보조회데이터를 미리 조회해본다. -->
	<select id="CSPAOE083Pmainselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT D1.EVL_YR                                   /*평가년도*/
			     , D1.HLYR_DVSN_CD                             /*반기구분코드*/
			     , D1.EVL_DPT_CD                               /*평가부서코드*/
			     , D1.CNB                                      /*전산번호*/
			     , D1.EVL_DPT_NM                               /*평가부서명*/
			     , D1.PST_CD                                   /*직위코드*/
			     , F_CODE_NM('1000176', D1.PST_CD) AS PST_NM   /*직위명*/
			     , D1.NAM                                      /*성명*/
			     , D1.RANK_CD                                  /*직급코드*/
			     , F_CODE_NM('1000173', D1.RANK_CD) AS RANK_NM /*직급명*/ 
			     , D1.BLT_DPT_CD                               /*소속부서코드*/
			     , D1.BLT_DPT_NM                               /*소속부서명*/
			     , D1.HRA_MV_DT                                /*인사이동일자*/
			  FROM TBCSPAOE041M D1      /*[성과평가]인사이력관리 테이블*/
			 WHERE 1 = 1
		]]>
		<isNotEmpty property="strEvlYr">
			AND D1.EVL_YR = #strEvlYr#
		</isNotEmpty>
		<isNotEmpty property="strHlyrDvsnCd">
			AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
		</isNotEmpty>
		<isNotEmpty property="strEvlDptCd">
			AND D1.EVL_DPT_CD = #strEvlDptCd#
		</isNotEmpty>
		<isNotEmpty property="strName">
			AND ( D1.NAM LIKE '%' || #strName# || '%' OR D1.CNB LIKE '%' ||
			#strName# || '%' )
		</isNotEmpty>
        <![CDATA[       
			  ORDER BY D1.EVL_DPT_CD, CNB
        ]]>
	</select>

	<!-- 평가부서명 조회 -->
	<select id="CSPAOE083PEvlDptNmListselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT MAX(EVL_DPT_NM) AS DPT_NM       /*평가부서명-부서명이 바뀔수도 있으니깐.*/
			     , EVL_DPT_CD AS DPT_CD            /*평가부서코드*/
			  FROM TBCSPAOE041M 
		 	  WHERE 1 = 1
			  GROUP BY EVL_DPT_CD
			  ORDER BY DPT_NM
		]]>
	</select>
	<!-- ########################### 사용자정보 조회(팝업) 끝 (CSPAOE083P) ############################### -->

	<!-- ########################### 운영직업무 평가군관리 시작 (CSPAOE014E) ############################# -->

	<!-- 온로드시 평가군명을 가져온다 -->
	<select id="CSPAOE014EEvlGpCdListselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_GP_CD      AS CD       /*평가군코드*/
			     , MAX(EVL_GP_NM) AS CD_NM    /*평가군명 - 평가군명이 바꼈을수도 있으니깐?*/
			  FROM TBCSPAOE018M 
		 	 WHERE 1 = 1
			 GROUP BY EVL_GP_CD
			 ORDER BY CD_NM
		]]>
	</select>

	<!-- 운영직업무 평가군관리 조회 -->
	<select id="CSPAOE014Emainselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[    
      		SELECT D1.EVL_YR                             /*년도*/ 
			     , D1.HLYR_DVSN_CD                       /*반기구분*/
			     , D1.EVL_GP_CD                          /*평가군코드*/
			     , D1.EVL_GP_NM                          /*평가군명*/
			     , NVL(D2.EVLT_CNT, 0) AS EVLT_CNT       /*평가자 인원*/
			     , NVL(D3.NEVLT_CNT, 0) AS NEVLT_CNT     /*피평가자 인원*/
			     , DECODE(NVL(D3.NEVLT_CNT, 0), '0', 'N', 'Y') AS FINISH_YN
			 FROM TBCSPAOE018M D1 
                , (
                    SELECT EVL_YR
                         , HLYR_DVSN_CD
                         , EVL_GP_CD
                         , COUNT(*) AS EVLT_CNT
                      FROM TBCSPAOE019D
                     GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_GP_CD
                ) D2
                , (
                    SELECT EVL_YR
                         , HLYR_DVSN_CD
                         , EVL_GP_CD
                         , COUNT(*) AS NEVLT_CNT
                      FROM TBCSPAOE020D
                     GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_GP_CD
                ) D3            
		   	WHERE D1.EVL_YR       = D2.EVL_YR (+)
              AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD (+)
              AND D1.EVL_GP_CD    = D2.EVL_GP_CD (+)
              AND D1.EVL_YR       = D3.EVL_YR (+)
              AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD (+)
              AND D1.EVL_GP_CD    = D3.EVL_GP_CD (+)
              AND D1.EVL_YR       = #strEvlYr#
              AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
         ]]>
		<isNotEmpty property="strEvlGrpCd">
			AND D1.EVL_GP_CD = #strEvlGrpCd#
		</isNotEmpty> 
		<![CDATA[                
			ORDER BY D1.EVL_GP_CD		]]>
	</select>

	<!-- 삭제하기 전에 자식 테이블에 데이터가 있는지 체크한다. TBCSPAOE019D -->
	<select id="CSPAOE014EEvltCntdelete" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE019D 
		     WHERE 1=1
		       AND EVL_YR       = #EVL_YR#
		       AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		       AND EVL_GP_CD    = #EVL_GP_CD#
		]]>
	</select>

	<!-- 운영직업무 평가군관리 삭제 -->
	<delete id="CSPAOE014Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE018M
		 WHERE 1=1
		   AND EVL_YR       = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND EVL_GP_CD    = #EVL_GP_CD#
	</delete>

	<!-- 신규등록하기 전에 자식 테이블에 데이터가 있는지 체크한다. TBCSPAOE018M -->
	<select id="CSPAOE014ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE018M 
		     WHERE 1=1
		       AND EVL_YR       = #EVL_YR#
		       AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		       AND EVL_GP_CD    = #EVL_GP_CD#
		]]>
	</select>

	<!-- 운영직업무 평가군관리 정보 신규등록 -->
	<insert id="CSPAOE014Emaininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE018M
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, EVL_GP_CD
			, EVL_GP_NM
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		 VALUES
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, UPPER(#EVL_GP_CD#)
			, #EVL_GP_NM#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 운영직업무 평가군관리 정보 수정 -->
	<update id="CSPAOE014Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE018M
	       SET FNL_MDF_DH = SYSDATE
		     , EVL_GP_NM = #EVL_GP_NM#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR       = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND EVL_GP_CD    = #EVL_GP_CD#
	</update>

	<!-- 평가자 목록을 조회한다. -->
	<select id="CSPAOE014Esubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[    
			SELECT EVL_YR                                   /*평가년도*/
			     , HLYR_DVSN_CD                             /*반기구분코드*/
			     , EVL_GP_CD                                /*평가군코드*/
			     , EVLT_CNB                                 /*평가자 전산자번호*/
			     , BLT_DPT_CD                               /*소속부서코드(평가)*/
			     , F_DPT_INFO(BLT_DPT_CD, '1') AS DPT_NM    /*부서명*/
			     , RANK_CD                                  /*직급코드*/
			     , F_CODE_NM('1000173', RANK_CD) AS RANK_NM /*직급명*/ 
			     , F_USR_INFO(EVLT_CNB, '2')     AS NAM     /*성명*/
			  FROM TBCSPAOE019D
		     WHERE 1=1
		       AND EVL_YR       = #strEvlYr#
		       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		       AND EVL_GP_CD    = #strEvlGpCd#
		     ORDER BY BLT_DPT_CD
		]]>
	</select>

	<!-- 삭제하기 전에 자식 테이블에 데이터가 있는지 체크한다. TBCSPAOE020D -->
	<select id="CSPAOE014ENevltCntdelete" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE020D 
		     WHERE 1=1
		       AND EVL_YR       = #EVL_YR#
		       AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		       AND EVL_GP_CD    = #EVL_GP_CD#
		 ]]>
			<isNotEmpty prepend="AND" property="EVLT_CNB">
				EVLT_CNB = #EVLT_CNB#
			</isNotEmpty>		 
			<isNotEmpty prepend="AND" property="NEVLT_CNB">
				NEVLT_CNB = #NEVLT_CNB#
			</isNotEmpty>
	</select>
	
	<!-- 평가자 목록 삭제시 업무비중입력자료 등록됬을 경우 널처리한다. -->
	<update id="CSPAOE014EnevltEvltCnbupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE020D
	       SET 
	       	   FNL_MDF_DH = SYSDATE
		     , EVLT_CNB = NULL
			<isNotEmpty prepend="," property="FNL_USR_ID">
				FNL_USR_ID = #FNL_USR_ID#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
				FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_MNU_ID">
				FNL_MNU_ID = #FNL_MNU_ID#
			</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR       = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND EVL_GP_CD    = #EVL_GP_CD#
		  AND EVLT_CNB     = #EVLT_CNB#
	</update>

	<!-- 평가자목록 조회 -->
	<delete id="CSPAOE014Esubdelete" parameterClass="paramMap">
		DELETE TBCSPAOE019D
		 WHERE 1=1
		   AND EVL_YR       = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND EVL_GP_CD    = #EVL_GP_CD#
		   AND EVLT_CNB     = #EVLT_CNB#
	</delete>

	<!-- 신규등록 하기 전에 중복 데이터가 있는지 체크한다. TBCSPAOE019D -->
	<select id="CSPAOE014ECntsubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE019D 
		     WHERE 1=1
		       AND EVL_YR       = #EVL_YR#
		       AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		       AND EVL_GP_CD    = #EVL_GP_CD#
		       AND EVLT_CNB     = #EVLT_CNB#
		]]>
	</select>

	<!-- 평가자 신규 등록 -->
	<insert id="CSPAOE014Esubinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE019D
		(
		      EVL_YR
			, HLYR_DVSN_CD
			, EVL_GP_CD
			, EVLT_CNB
			, BLT_DPT_CD
			, RANK_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		VALUES
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, UPPER(#EVL_GP_CD#)
			, #EVLT_CNB#
			, #BLT_DPT_CD#
			, #RANK_CD#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 피평가자를 조회한다 -->
	<select id="CSPAOE014ENevlselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT EVL_YR                                        /*평가년도*/
			     , HLYR_DVSN_CD                                  /*반기구분코드*/
			     , EVL_GP_CD                                     /*평가군코드*/
			     , EVLT_CNB                                      /*평가자 전산자번호*/
			     , NEVLT_CNB                                     /*피평가자 전산번호*/
			     , BLT_DPT_CD                                    /*소속부서코드*/
			     , F_DPT_INFO(BLT_DPT_CD, '1')   AS BLT_DPT_NM   /*부서명*/
			     , RANK_CD                                       /*직급코드*/
			     , F_CODE_NM('1000173', RANK_CD) AS RANK_NM      /*직급명*/ 
			     , F_USR_INFO(NEVLT_CNB, '2')    AS NAM          /*성명*/
			  FROM TBCSPAOE020D
		     WHERE 1=1
		       AND EVL_YR        = #strEvlYr#
		       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
		       AND EVL_GP_CD     = #strEvlGpCd#
		     ORDER BY BLT_DPT_CD, NAM
		]]>
	</select>
	
	<!-- 업무비중 입력자 리스트를 가져온다. -->
	<select id="CSPAOE014EEvlCnbListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  
			SELECT EVLT_CNB                  AS CD
			     , F_USR_INFO(EVLT_CNB, '2') AS CD_NM
			  FROM TBCSPAOE019D
			 WHERE 1=1
			   AND EVL_YR        = #strEvlYr#
			   AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
			   AND EVL_GP_CD     = #strEvlGpCd#
		   ]]>
	</select>

	<!-- 피평가자목록 삭제 -->
	<delete id="CSPAOE014Enevltdelete" parameterClass="paramMap">
		DELETE TBCSPAOE020D
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND EVL_GP_CD = #EVL_GP_CD#
		AND NEVLT_CNB = #NEVLT_CNB#
	</delete>
	
	<!-- 피평가자목록 업데이트 -->
	<update id="CSPAOE014Enevltupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE020D
		  SET 
		  	  EVLT_CNB = #EVLT_CNB#
		    , FNL_MDF_DH = SYSDATE
			<isNotEmpty prepend="," property="FNL_USR_ID">
				FNL_USR_ID = #FNL_USR_ID#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
				FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_MNU_ID">
				FNL_MNU_ID = #FNL_MNU_ID#
			</isNotEmpty>		    
		WHERE 1 = 1
		AND EVL_YR       = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND EVL_GP_CD    = #EVL_GP_CD#
		AND NEVLT_CNB    = #NEVLT_CNB#
	</update>

	<!-- 피평가자 신규 등록 -->
	<insert id="CSPAOE014Enevltinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE020D
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, EVL_GP_CD
			, EVLT_CNB
			, NEVLT_CNB
			, BLT_DPT_CD
			, RANK_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		VALUES
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, UPPER(#EVL_GP_CD#)
			, #EVLT_CNB#
			, #NEVLT_CNB#
			, #BLT_DPT_CD#
			, #RANK_CD#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>
	
	<!-- [현행 인사정보 가져오기-국장] -->
	<insert id="CSPAOE014getInfoListinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE020D
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, EVL_GP_CD
			, EVLT_CNB
			, NEVLT_CNB
			, BLT_DPT_CD
			, RANK_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #strEvlYr#
			 , #strHlyrDvsnCd#
			 , #strEvlGpCd#
			 , (SELECT MAX(EVLT_CNB) 
			      FROM TBCSPAOE019D 
		         WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND EVL_GP_CD = #strEvlGpCd#
		           AND BLT_DPT_CD = DPT_CD)
			 , CNB
			 , DPT_CD
			 , RANK_CD
			 , #FRT_USR_ID#
			 , #FNL_USR_ID#
			 , #FNL_DEAL_DPT_CD#
			 , #FNL_MNU_ID#
			 , SYSDATE
			 , SYSDATE
		  FROM TBDCMACM001M
		 WHERE DPT_CD IN (SELECT BLT_DPT_CD FROM TBCSPAOE019D 
		                   WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND EVL_GP_CD = #strEvlGpCd#)
		   AND NVL(PST_CD, '999') NOT IN ('0013600', '0015800') /*과장, 국장들은 제외한다. 평가자니깐*/
		   AND RANK_CD_2 IN ('17336', '17337', '17338', '17339', '17352', '17353', '17354', '17355', '17414', '17415', '17416', '17417', '17390', '17391', '17392', '17393', '17356', '17357', '17358', '17359', '17361', '17362', '17363', '17364', '17382', '17383', '17384', '17385', '17400', '17401', '17402', '17403', '17348', '17349', '17350', '17351', '17409', '17410', '17411', '17412', '17340', '17341', '17342', '17343', '99006', '04486', '04487', '04488', '04489','00095','24036','17648','00094','17650','00093','99259','99156','99258') /*2015.01.30 최원형감사관요청 지정한 직류별 직급만*/
	</insert>
	<!-- ############################ 운영직업무 평가군관리 끝 (CSPAOE014E) ############################## -->

	<!-- ############################ 기준항목관리 시작 (CSPAOE090E) ##################################### -->

	<!-- 기준항목관리를 조회한다. -->
	<select id="CSPAOE090Emainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.EVL_YR                                      /*평가년도*/
			     , D1.HLYR_DVSN_CD                                /*반기구분코드*/
			     , D1.STAD_CLU_CD                                 /*기준항목코드*/
			     , D1.EVL_STAD_CLU_NM                             /*평가기준항목명*/
			     , NVL(D1.CP_YN, 'N')   AS CP_YN                  /*복사여부*/
                 , TO_CHAR(D2.DATA_CNT) AS DATA_CNT               /*데이터존재여부*/
			  FROM TBCSPAOE039M D1
                 , (
                    SELECT 'PBCD01' AS STAD_CLU_CD /*평가지표별 기준관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE002M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	
                     UNION ALL
                    SELECT 'PBCD02' AS STAD_CLU_CD /*감사업무종류별 평점수식관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE004M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	
                     UNION ALL
                    SELECT 'PBCD03' AS STAD_CLU_CD /*감사외업무종류별 표준평점관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE006M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	
                     UNION ALL
                    SELECT 'PBCD04' AS STAD_CLU_CD /*감사단계별 기준관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE007M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	
                     UNION ALL
                    SELECT 'PBCD05' AS STAD_CLU_CD /*평가등급별 기준관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE009M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	
                     UNION ALL
                    SELECT 'PBCD06' AS STAD_CLU_CD /*특별가산점관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE011M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	 
                     UNION ALL
                    SELECT 'PBCD07' AS STAD_CLU_CD /*조기/지연처리 가감점관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE012M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	 
                      UNION ALL
                    SELECT 'PBCD08' AS STAD_CLU_CD /*감사업무별 평점항목관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE013M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	 
                      UNION ALL
                    SELECT 'PBCD09' AS STAD_CLU_CD /*참여인원별 개인기여율 상한관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE015M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	 
                      UNION ALL
                    SELECT 'PBCD10' AS STAD_CLU_CD /*담당자관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE016M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	  
                      UNION ALL
                    SELECT 'PBCD11' AS STAD_CLU_CD /*운영직업무 평가군관리*/
                         , COUNT(*) AS DATA_CNT
                      FROM TBCSPAOE018M 
                     WHERE EVL_YR        = #strEvlYr#
                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#	                  
                 ) D2
		     WHERE D1.STAD_CLU_CD   = D2.STAD_CLU_CD 
		       AND D1.EVL_YR        = #strEvlYr#
		       AND D1.HLYR_DVSN_CD  = #strHlyrDvsnCd#
		]]>
	</select>

	<!-- 기준항목관리 인서트하기 전에 중복된 데이터가 있는지 체크한다 -->
	<select id="CSPAOE090ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE039M 
		     WHERE 1 = 1
		       AND EVL_YR       = #EVL_YR#
		       AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		       AND STAD_CLU_CD  = #STAD_CLU_CD#
		]]>
	</select>

	<!-- 기준항목관리 신규 등록 -->
	<insert id="CSPAOE090Emaininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE039M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, STAD_CLU_CD
			, EVL_STAD_CLU_NM
			, CP_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, UPPER(#STAD_CLU_CD#)
			, #EVL_STAD_CLU_NM#
			, 'N'
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<delete id="CSPAOE090Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE039M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND STAD_CLU_CD = #STAD_CLU_CD#
	</delete>

	<!-- 복사하기전 복사될 년도 반기구분에 데이터가 있는지 다시 확인한다. -->
	<select id="CSPAOE090ECntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE039M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strEvlYr#
		       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		]]>
	</select>

	<!-- 복사하기전 복사할 년도 반기구분에 데이터가 있는지 확인한다. -->
	<select id="CSPAOE090ECntCopyDataselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE039M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- 직전 기준항목관리를 복사한다 -->
	<insert id="CSPAOE090ECopyinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE039M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, STAD_CLU_CD
			, EVL_STAD_CLU_NM
			, CP_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #strEvlYr#
				, #strHlyrDvsnCd#
				, STAD_CLU_CD
				, EVL_STAD_CLU_NM
				, 'N'
				, #FRT_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE039M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>
	<!-- ##################################### 기준항목관리 끝 (CSPAOE090E) ##################################### -->

	<!-- ##################################### 기준일괄복사 시작 (CSPAOE081E) ##################################### -->

	<select id="CSPAOE081Emainselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT D1.EVL_YR /*평가년도*/
			, D1.HLYR_DVSN_CD /*반기구분코드*/
			, D1.STAD_CLU_CD /*기준항목코드*/
			, D1.EVL_STAD_CLU_NM /*평가기준항목명*/
			, NVL(D1.CP_YN, 'N') AS CP_YN /*복사여부*/
			, TO_CHAR(D2.DATA_CNT) AS DATA_CNT /*데이터존재여부*/
		FROM TBCSPAOE039M D1
		, (
			SELECT 'PBCD01' AS STAD_CLU_CD /*평가지표별 기준관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE002M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			UNION ALL
			SELECT 'PBCD02' AS STAD_CLU_CD /*감사업무종류별 평점수식관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE004M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			UNION ALL
			SELECT 'PBCD03' AS STAD_CLU_CD /*감사외업무종류별 표준평점관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE006M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			UNION ALL
			SELECT 'PBCD04' AS STAD_CLU_CD /*감사단계별 기준관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE007M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			UNION ALL
			SELECT 'PBCD05' AS STAD_CLU_CD /*평가등급별 기준관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE009M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			UNION ALL
			SELECT 'PBCD06' AS STAD_CLU_CD /*특별가산점관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE011M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			UNION ALL
			SELECT 'PBCD07' AS STAD_CLU_CD /*조기/지연처리 가감점관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE012M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			UNION ALL
			SELECT 'PBCD08' AS STAD_CLU_CD /*감사업무별 평점항목관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE013M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			UNION ALL
			SELECT 'PBCD09' AS STAD_CLU_CD /*참여인원별 개인기여율 상한관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE015M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			UNION ALL
			SELECT 'PBCD10' AS STAD_CLU_CD /*담당자관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE016M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			UNION ALL
			SELECT 'PBCD11' AS STAD_CLU_CD /*운영직업무 평가군관리*/
			, COUNT(*) AS DATA_CNT
			FROM TBCSPAOE018M
			WHERE EVL_YR = #strEvlYr#
			AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			) D2
		WHERE 1=1
		AND D1.STAD_CLU_CD = D2.STAD_CLU_CD
		AND D1.EVL_YR = #strEvlYr#
		AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
	</select>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd01CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE002M
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- 평가지표별 기준관리 정보 삭제 [성과평가]평가지표 기준항목 상세 -->
	<delete id="CSPAOE081EPbcd01subdelete" parameterClass="paramMap">
		DELETE TBCSPAOE003D
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 평가지표별 기준관리 정보 삭제 [성과평가]평가지표별 기준관리 -->
	<delete id="CSPAOE081EPbcd01maindelete" parameterClass="paramMap">
		DELETE TBCSPAOE002M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 평가지표별 기준관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd01maininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE002M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, EVL_INDEX_CD
			, EVL_INDEX_NM
			, WGT_RTE
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, EVL_INDEX_CD
				, EVL_INDEX_NM
				, WGT_RTE
				, #FNL_USR_ID# /*상태값이 U로 넘어 오므로 FRT_USR_ID 파라미터 값은 널로 넘어오넹.. */
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE002M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 평가지표별 기준항목 상세 일괄복사 -->
	<insert id="CSPAOE081EPbcd01subinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE003D
		(
			EVL_YR
			, HLYR_DVSN_CD
			, EVL_INDEX_CD
			, EVL_STAD_CD
			, EVL_STAD_NM
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, EVL_INDEX_CD
				, EVL_STAD_CD
				, EVL_STAD_NM
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE003D
		WHERE 1=1
		AND EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd02CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE004M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- [성과평가]표준평점수식 상세 -->
	<delete id="CSPAOE081EPbcd02subdelete" parameterClass="paramMap">
		DELETE TBCSPAOE044M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- [성과평가]감사업무종류별 평점수식관리 -->
	<delete id="CSPAOE081EPbcd02maindelete" parameterClass="paramMap">
		DELETE TBCSPAOE004M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 감사업무별 평점수식관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd02maininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE004M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_KND_CD
			, STAD_MNDY_LES_CNT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
			, #HLYR_DVSN_CD#
			, TSK_DVSN_CD
			, AUD_KND_CD
			, STAD_MNDY_LES_CNT
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		FROM TBCSPAOE004M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 감사업무종류별 평점수식관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd02subinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE044M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_KND_CD
			, SRNO
			, CLU_CD
			, MNDY_CNT_1
			, MNDY_CNT_2
			, STND_ASC_FML_TXT
			, SYT_TRTM_STND_ASC_FML_TXT
			, IDVT_TRTM_STND_ASC_FML_TXT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, TSK_DVSN_CD
				, AUD_KND_CD
				, SRNO
				, CLU_CD
				, MNDY_CNT_1
				, MNDY_CNT_2
				, STND_ASC_FML_TXT
				, SYT_TRTM_STND_ASC_FML_TXT
				, IDVT_TRTM_STND_ASC_FML_TXT
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE044M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd03CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE006M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- [성과평가]감사외업무종류별 표준평점관리 -->
	<delete id="CSPAOE081EPbcd03delete" parameterClass="paramMap">
		DELETE TBCSPAOE006M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 감사외업무종류별 표준평점관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd03insert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE006M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, TSK_KND_CD
			, STND_ASC
			, STND_ASC_1
			, STND_ASC_2
			, STND_ASC_3
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, TSK_DVSN_CD
				, TSK_KND_CD
				, STND_ASC
				, STND_ASC_1
				, STND_ASC_2
				, STND_ASC_3
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE006M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd04CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE007M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- [성과평가]감사단계기준 상세 -->
	<delete id="CSPAOE081EPbcd04subdelete" parameterClass="paramMap">
		DELETE TBCSPAOE008D
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- [성과평가]감사단계기준 상세 -->
	<delete id="CSPAOE081EPbcd04maindelete" parameterClass="paramMap">
		DELETE TBCSPAOE007M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 감사단계별 기준관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd04maininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE007M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_KND_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, TSK_DVSN_CD
				, AUD_KND_CD
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE007M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 감사단계별 기준관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd04subinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE008D
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_KND_CD
			, AUD_STEP_CD
			, STAD_PRD_DCN
			, DRIVE_RTE
			, ELY_ADPT_STAD_RK_CD
			, EVLT_ASG_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, TSK_DVSN_CD
				, AUD_KND_CD
				, AUD_STEP_CD
				, STAD_PRD_DCN
				, DRIVE_RTE
				, ELY_ADPT_STAD_RK_CD
				, EVLT_ASG_YN
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE008D
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd05CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE009M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- [성과평가]평가등급기준 상세 -->
	<delete id="CSPAOE081EPbcd05subdelete" parameterClass="paramMap">
		DELETE TBCSPAOE010D
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- [성과평가]평가등급별 기준관리 -->
	<delete id="CSPAOE081EPbcd05maindelete" parameterClass="paramMap">
		DELETE TBCSPAOE009M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 평가등급별 기준관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd05maininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE009M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, TSK_DVSN_CD
				, AUD_TSK_KND_CD
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE009M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 감사단계별 기준관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd05subinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE010D
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, RK_CD
			, RK_ASC
			, IDVT_INDEX_VAL
			, SUM_INDEX_VAL
			, EVL_STAD_TXT
			, IDCT_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, TSK_DVSN_CD
				, AUD_TSK_KND_CD
				, RK_CD
				, RK_ASC
				, IDVT_INDEX_VAL
				, SUM_INDEX_VAL
				, EVL_STAD_TXT
				, NVL(IDCT_YN, 'N')
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE010D
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd06CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE011M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- [성과평가]특별가산점관리 -->
	<delete id="CSPAOE081EPbcd06delete" parameterClass="paramMap">
		DELETE TBCSPAOE011M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 특별가산점관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd06insert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE011M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, CLU_CD
			, CLU_NM
			, CLU_SC
			, CLU_TXT
			, USE_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, CLU_CD
				, CLU_NM
				, CLU_SC
				, CLU_TXT
				, NVL(USE_YN, 'N')
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE011M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd07CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE012M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- [성과평가]조기/지연처리 가감점관리 -->
	<delete id="CSPAOE081EPbcd07delete" parameterClass="paramMap">
		DELETE TBCSPAOE012M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 조기/지연처리 가감점관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd07insert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE012M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, HNDL_PRD_CD
			, HNDL_PRD_DVSN_CD
			, HNDL_PRD_DCN
			, DLAY_DT_NM
			, ASP_RTE
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, HNDL_PRD_CD
				, HNDL_PRD_DVSN_CD
				, HNDL_PRD_DCN
				, DLAY_DT_NM
				, ASP_RTE
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE012M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd08CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE013M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- [성과평가]감사업무 평가항목 상세 -->
	<delete id="CSPAOE081EPbcd08subdelete" parameterClass="paramMap">
		DELETE TBCSPAOE014D
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- [성과평가]감사업무별 평점항목관리 -->
	<delete id="CSPAOE081EPbcd08maindelete" parameterClass="paramMap">
		DELETE TBCSPAOE013M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 감사업무별 평점항목관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd08maininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE013M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, FML_TXT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, TSK_DVSN_CD
				, FML_TXT
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE013M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 감사업무 평가항목 상세 일괄복사 -->
	<insert id="CSPAOE081EPbcd08subinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE014D
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, FML_CLU_CD
			, FML_CLU_NM
			, USE_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, TSK_DVSN_CD
				, FML_CLU_CD
				, FML_CLU_NM
				, NVL(USE_YN, 'N')
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE014D
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd09CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE015M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- [성과평가]참여인원별 개인기여율 상한관리 -->
	<delete id="CSPAOE081EPbcd09delete" parameterClass="paramMap">
		DELETE TBCSPAOE015M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 참여인원별 개인기여율 상한관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd09insert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE015M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, SEQ_NO
			, JON_NOP_MORE_CNT
			, JON_NOP_LES_CNT
			, MAXM_RT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, SEQ_NO
				, JON_NOP_MORE_CNT
				, JON_NOP_LES_CNT
				, MAXM_RT
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE015M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd10CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE016M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- [성과평가]담당자 상세 -->
	<delete id="CSPAOE081EPbcd10subdelete" parameterClass="paramMap">
		DELETE TBCSPAOE017D
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- [성과평가]담당자관리 -->
	<delete id="CSPAOE081EPbcd10maindelete" parameterClass="paramMap">
		DELETE TBCSPAOE016M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 담당자관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd10maininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE016M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, CHGR_DVSN_CD
			, CHGR_DVSN_NM
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, TSK_DVSN_CD
				, AUD_TSK_KND_CD
				, CHGR_DVSN_CD
				, CHGR_DVSN_NM
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE016M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 담당자 상세 일괄복사 -->
	<insert id="CSPAOE081EPbcd10subinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE017D
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, CHGR_DVSN_CD
			, CHGR_CNB
			, EVL_CMTR_NO
			, BLT_DPT_CD
			, RANK_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, TSK_DVSN_CD
				, AUD_TSK_KND_CD
				, CHGR_DVSN_CD
				, CHGR_CNB
				, EVL_CMTR_NO
				, BLT_DPT_CD
				, RANK_CD
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE017D
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 복사할 데이터가 있는지 체크한다. -->
	<select id="CSPAOE081EPbcd11CntCopyselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE018M 
		     WHERE 1 = 1
		       AND EVL_YR       = #strCopyEvlYr#
		       AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
		]]>
	</select>

	<!-- [성과평가]피평가자 목록 -->
	<delete id="CSPAOE081EPbcd11subsubdelete" parameterClass="paramMap">
		DELETE TBCSPAOE020D
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>


	<!-- [성과평가]평가자 목록 -->
	<delete id="CSPAOE081EPbcd11subdelete" parameterClass="paramMap">
		DELETE TBCSPAOE019D
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- [성과평가]운영직업무 평가군관리 -->
	<delete id="CSPAOE081EPbcd11maindelete" parameterClass="paramMap">
		DELETE TBCSPAOE018M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</delete>

	<!-- 운영직업무 평가군관리 일괄복사 -->
	<insert id="CSPAOE081EPbcd11maininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE018M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, EVL_GP_CD
			, EVL_GP_NM
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, EVL_GP_CD
				, EVL_GP_NM
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE018M
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 평가자 목록 일괄복사 -->
	<insert id="CSPAOE081EPbcd11subinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE019D
		(
			EVL_YR
			, HLYR_DVSN_CD
			, EVL_GP_CD
			, EVLT_CNB
			, BLT_DPT_CD
			, RANK_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, EVL_GP_CD
				, EVLT_CNB
				, BLT_DPT_CD
				, RANK_CD
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE019D
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 피평가자 목록 일괄복사 -->
	<insert id="CSPAOE081EPbcd11subsubinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE020D
		(
			EVL_YR
			, HLYR_DVSN_CD
			, EVL_GP_CD
			, EVLT_CNB
			, NEVLT_CNB
			, BLT_DPT_CD
			, RANK_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #EVL_YR#
				, #HLYR_DVSN_CD#
				, EVL_GP_CD
				, EVLT_CNB
				, NEVLT_CNB
				, BLT_DPT_CD
				, RANK_CD
				, #FNL_USR_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, #FNL_MNU_ID#
				, SYSDATE
				, SYSDATE
		FROM TBCSPAOE020D
		WHERE EVL_YR = #strCopyEvlYr#
		AND HLYR_DVSN_CD = #strCopyHlyrDvsnCd#
	</insert>

	<!-- 일괄복사완료한후 일괄복사 여부를 Y로 업데이트 해준다. -->
	<update id="CSPAOE081ECopyYnupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE039M
		SET 
			FNL_MDF_DH = SYSDATE
			, CP_YN = 'Y'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND STAD_CLU_CD = #STAD_CLU_CD#
	</update>
	<!-- ##################################### 기준일괄복사 끝 (CSPAOE081E) ##################################### -->

	<!-- ##################################### 인사이력관리 시작 (CSPAOE082E) ##################################### -->
	<!-- 인사이력관리를 조회한다. -->
	<select id="CSPAOE082Emainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.EVL_YR /* CSPAOE082Emainselect */             /*평가년도*/ 
			     , D1.HLYR_DVSN_CD                                  /*반기구분코드*/ 
			     , D1.CNB                                           /*전산번호*/ 
			     , D1.DPT_DVSN_CD                                   /*부서구분코드*/ 
			     , D1.EVL_DPT_CD                                    /*평가부서코드*/ 
			     , D1.EVL_DPT_NM                                    /*평가부서명*/
			     , D1.PST_CD                                        /*직위코드*/ 
			     , D1.NAM                                           /*성명*/
			     , D1.RANK_CD                                       /*직급코드*/
			     , D1.WOK_DVSN_CD                                   /*재직구분코드*/
			     , D1.WRK_STR_DT                                    /*근무시작일*/
			     , D1.WRK_END_DT                                    /*근무종료일*/
			     , D1.WRK_DCN                                       /*근무일수*/
			     , D1.RMK                                           /*비고*/
			     , D1.WRK_DCN_TXT                                   /*평가기간내 근무일수 2015.03.03 권효정 감사관 요청*/
			     , D1.EVL_TG_YN                                     /*평가대상여부*/
			     , D1.WRK_EXMP_DCN                                  /*근무제외일수*/
			  FROM TBCSPAOE041M D1 
			     , TBDCMACM002M D2
			 WHERE D1.EVL_DPT_CD = D2.DPT_CD (+)
			   AND D1.EVL_YR       = #strEvlYr#
			   AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
		]]>
			<isNotEmpty property="strDeptSectCd">
				AND D2.DPT_CD = #strDeptSectCd#
			</isNotEmpty>
			<isNotEmpty property="strDeptBureauCd">
				AND ( D2.HIRK_DPT_CD = #strDeptBureauCd# OR EVL_DPT_CD = #strDeptBureauCd# )
			</isNotEmpty>
			<isNotEmpty property="strNam">
				AND D1.NAM LIKE '%' || #strNam# || '%'
			</isNotEmpty>
			<![CDATA[  
				ORDER BY D1.SEQ_NO /* D1.EVL_DPT_CD, D1.DPT_DVSN_CD, D1.CNB */
			]]>
	</select>

	<!-- 인사이력 정보 수정 -->
	<update id="CSPAOE082Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE041M
		   SET FNL_MDF_DH = SYSDATE
			 , DPT_DVSN_CD = #DPT_DVSN_CD#
			 , EVL_DPT_CD = #EVL_DPT_CD#
			 , EVL_DPT_NM = #EVL_DPT_NM#
			 , PST_CD = #PST_CD#
			 , NAM = #NAM#
			 , RANK_CD = #RANK_CD#
			 , WOK_DVSN_CD = #WOK_DVSN_CD#
			 , WRK_STR_DT = #WRK_STR_DT#
			 , WRK_END_DT = #WRK_END_DT#
			 , WRK_DCN = GREATEST((TO_DATE(#WRK_END_DT#, 'YYYYMMDD') - TO_NUMBER(#WRK_EXMP_DCN#)) - TO_DATE(#WRK_STR_DT#, 'YYYYMMDD')) + 1 /*근무제외일수를 뺀 근무일수를 계산한다*/
			 , RMK = #RMK#
			 , EVL_TG_YN    = DECODE(NVL(#EVL_TG_YN#, 'Y'), '', 'N', #EVL_TG_YN#)
			 , WRK_EXMP_DCN = NVL(#WRK_EXMP_DCN#, 0)
			 , WRK_DCN_TXT  = #WRK_DCN_TXT#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND CNB = #CNB#
	</update>

	<!-- 인사이력 정보 신규등록 전에 이전데이터 삭제 -->
	<delete id="CSPAOE082Emaindelete" parameterClass="paramMap">
        <![CDATA[  
			DELETE TBCSPAOE041M
			 WHERE EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		]]>
	</delete>

	<!-- 인사이력 정보 신규 등록 -->
	<insert id="CSPAOE082Emaininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE041M
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, CNB
			, DPT_DVSN_CD
			, EVL_DPT_CD
			, EVL_DPT_NM
			, PST_CD
			, NAM
			, RANK_CD
			, WOK_DVSN_CD
			, WRK_STR_DT
			, WRK_END_DT
			, WRK_DCN
			, RMK
			, EVL_TG_YN    
			, WRK_EXMP_DCN 
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
			, WRK_DCN_TXT
			, SEQ_NO
		) VALUES
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, #CNB#
			, #DPT_DVSN_CD#
			, #EVL_DPT_CD#
			, #EVL_DPT_NM#
			, #PST_CD#
			, #NAM#
			, #RANK_CD#
			, #WOK_DVSN_CD#
			, #WRK_STR_DT#
			, #WRK_END_DT#
			, #WRK_DCN#
			, #RMK#
			, NVL(#EVL_TG_YN#, 'Y')
			, NVL(TO_NUMBER(#WRK_EXMP_DCN#), 0)
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
			, #WRK_DCN_TXT#
			, #SEQ_NO#
		)
	</insert>
	
	<select id="CSPAOE082EExelUploadselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
			SELECT #EVL_YR# AS EVL_YR /* CSPAOE082EExelUploadselect */
			     , #HLYR_DVSN_CD# AS HLYR_DVSN_CD
			     , #COL3# AS CNB
			     , DPT_DVSN_CD AS DPT_DVSN_CD /*부서구분코드*/
                 , EVL_DPT_CD  /*평가부서코드*/
			     , EVL_DPT_NM /*평가부서명*/
			     , PST_CD /*직위코드*/
			     , NAM /*성명*/
			     , RANK_CD /*직급코드*/
			     , WOK_DVSN_CD /*재직구분코드*/
			     , WRK_STR_DT /*근무시작일*/
			     , WRK_END_DT /*근무종료일*/
                 , NVL(TO_NUMBER(#COL9#), 0) AS WRK_EXMP_DCN /*근무제외일수*/
                 , NVL(#COL11#, 'Y') AS EVL_TG_YN /*평가대상여부*/
                 , NVL(TRIM(#COL10#), F_GET_WRK_DCN_TEXT(#EVL_YR#, #HLYR_DVSN_CD#, WRK_STR_DT, TO_CHAR(TO_DATE(WRK_END_DT, 'YYYYMMDD') - NVL( TO_NUMBER(NVL(#COL9#, 0)), 0), 'YYYYMMDD'))) AS WRK_DCN_TXT /*평가기간내 근무일수*/
                 , GREATEST((TO_DATE(WRK_END_DT, 'YYYYMMDD') - TO_NUMBER(NVL(#COL9#, 0))) - TO_DATE(WRK_STR_DT, 'YYYYMMDD')) + 1  AS WRK_DCN
			     , RMK
			 FROM ( 
				SELECT MAX(DPT_DVSN_CD) AS DPT_DVSN_CD /*부서구분코드*/
				     , TRIM(#COL2#) AS EVL_DPT_NM /*평가부서명*/
				     , MAX(EVL_DPT_CD) AS EVL_DPT_CD  /*평가부서코드*/
				     , MAX(PST_CD) AS PST_CD /*직위코드*/
				     , MAX(NAM) AS NAM /*성명*/
				     , MAX(RANK_CD) AS RANK_CD /*직급코드*/
				     , MAX(WOK_DVSN_CD) AS WOK_DVSN_CD /*재직구분코드*/
				     , CASE WHEN TRIM(#COL7#) IS NULL  THEN (SELECT EVL_STR_DT FROM TBCSPAOE001M WHERE EVL_YR = #EVL_YR# AND HLYR_DVSN_CD = #HLYR_DVSN_CD#)
				            ELSE TRIM(#COL7#) END AS WRK_STR_DT /*근무시작일*/
				     , CASE WHEN TRIM(#COL8#) IS NULL THEN (SELECT EVL_END_DT FROM TBCSPAOE001M WHERE EVL_YR = #EVL_YR# AND HLYR_DVSN_CD = #HLYR_DVSN_CD#)
				            ELSE TRIM(#COL8#) END AS WRK_END_DT /*근무종료일*/
				     , #COL12# AS RMK
				  FROM (
                    SELECT D3.EVL_DPT_CD
                         , CASE WHEN #COL1# IS NOT NULL THEN DECODE(TRIM(#COL1#), 'S', '20', 'A', '10', '')
                                WHEN D4.DPT_TP_CD IS NOT NULL THEN D4.DPT_TP_CD 
                                ELSE D3.DPT_DVSN_CD END AS DPT_DVSN_CD
				         , '' AS PST_CD
				         , '' AS NAM
				         , '' AS RANK_CD
				         , '' AS WOK_DVSN_CD                         
                      FROM ( 
                        SELECT DPT_CD AS EVL_DPT_CD 
                             , DECODE(DPT_TP_CD, 'S', '20', 'A', '10', '') AS DPT_DVSN_CD
                             , '' AS PST_CD
                             , '' AS NAM
                             , '' AS RANK_CD
                             , '' AS WOK_DVSN_CD
                          FROM TBDCMACM002M 
                         WHERE DPT_NM = TRIM(#COL2#)
                         AND    USE_YN = 'Y'
                        ) D3
                        , (
                         SELECT DPT_TP_CD
                              , DPT_CD
                           FROM (
                             SELECT '20' AS DPT_TP_CD
                                  , CHR_DPT_CD AS DPT_CD
                              FROM TBCSPAOE026M
                             WHERE EVL_YR = #EVL_YR#
                               AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
                             GROUP BY CHR_DPT_CD /*지원부서*/
                               
                             UNION ALL
                             
                            SELECT '10' AS DPT_TP_CD
                                 , D1.HNDL_DIV_DPT_CD AS DPT_CD
                              FROM TBCSPAOE021M D1
                                 , (
                                SELECT AUD_YR
                                     , TSK_NO
                                  FROM TBCSPAOE022M
                                 WHERE CMPT_DT IS NOT NULL
                                   AND CMPT_DT BETWEEN ( SELECT EVL_STR_DT FROM TBCSPAOE001M WHERE EVL_YR = #EVL_YR# AND HLYR_DVSN_CD = #HLYR_DVSN_CD# ) 
                                               AND ( SELECT EVL_END_DT FROM TBCSPAOE001M WHERE EVL_YR = #EVL_YR# AND HLYR_DVSN_CD = #HLYR_DVSN_CD# )
                                 GROUP BY AUD_YR, TSK_NO     
                                 ) D2
                             WHERE D1.AUD_YR = D2.AUD_YR
                               AND D1.TSK_NO = D2.TSK_NO
                             GROUP BY D1.HNDL_DIV_DPT_CD        
                             )
                            WHERE ROWNUM = 1    
                        ) D4
                    WHERE D3.EVL_DPT_CD = D4.DPT_CD  (+)                   
				
				     UNION ALL
				
				    SELECT '' AS EVL_DPT_CD
				         , '' AS DPT_DVSN_CD
				         , D2.CD AS PST_CD /*직위코드*/
				         , DECODE( TRIM(#COL4#), '', USR_NAM, TRIM(#COL4#)) AS NAM
				         , DECODE( TRIM(#COL5#), '', RANK_CD, (SELECT CD FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000173' AND CD != '214'/*5급이 2개 있어서 추가함*/ AND CD_NM = TRIM(#COL5#))) AS RANK_CD
				         , WOK_DVSN_CD /*재직구분코드*/
				      FROM TBDCMACM001M D1
                         , TBDCMACM013C D2
				     WHERE D1.PST_CD = D2.CD (+)
                       AND D2.CMM_CD_DVSN_CD (+) = '1000176' 
				       AND D1.CNB = TRIM(#COL3#)
				    ) 
			    )
			]]>
	</select>
	<!-- ##################################### 인사이력관리 끝 (CSPAOE082E) ##################################### -->
	
	<!-- ##################################### 감사외업무관리 시작 (CSPAOE029E) ##################################### -->

	<!-- 감사외업무관리 조회 -->
	<select id="CSPAOE029Emainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
			SELECT D1.EVL_YR                                    /*평가년도*/
			     , D1.HLYR_DVSN_CD                              /*반기구분코드*/
			     , D1.TSK_KND_CD                                /*업무종류코드*/
			     , F_CODE_NM ('1000272', D1.TSK_KND_CD) AS TSK_KND_NM	 /*업무종류명*/
			     , CHR_DPT_CD                                   /*담당부서코드*/
			     , F_DPT_INFO(D1.CHR_DPT_CD, '1') AS CHR_DPT_NM /*담당부서명*/
			     , D1.TSK_NO                                    /*업무번호*/
			     , D1.TSK_NM                                    /*업무명*/
			     , D1.JUD_PNSH_CRCT_NOC							/*판정징계시정건수*/
			     , D1.IMP_RDA_NTF_NOC							/*개선권고통보건수*/
			     , D1.SPCN_MNG_NOC								/*특수관리건수*/
			     , D1.TSK_TXT                                   /*업무내용*/
			     , F_CODE_NM('1000279', DECODE(D2.EVL_STEP_CD, '', '600', '600', '700', D2.EVL_STEP_CD))  AS EVL_STEP_NM  /*평가단계코드-현재 아무도 평가를 안했다면 평가자 단계일꺼고 평가자가 완료했다면 평가자 다음인 확인자 단계*/
			     , (
			            SELECT DECODE(COUNT(*), 0, 'N', 'Y') 
			              FROM TBCSPAOE029M
			             WHERE EVL_YR         = D1.EVL_YR
			               AND HLYR_DVSN_CD   = D1.HLYR_DVSN_CD
			               AND TSK_DVSN_CD    = '10001' /*감사외업무*/
			               AND AUD_TSK_KND_CD = D1.TSK_KND_CD
			               AND NVL(EVL_STA_CD, '100') != '100'  /*미평가가 아닌것*/      
			       ) AS EVL_YN
			     , (
			            SELECT DECODE(COUNT(*), 0, 'N', 'Y') 
			              FROM TBCSPAOE029M
			             WHERE EVL_YR         = D1.EVL_YR
			               AND HLYR_DVSN_CD   = D1.HLYR_DVSN_CD
			               AND TSK_DVSN_CD    = '10001' /*감사외업무*/
			               AND AUD_TSK_KND_CD = D1.TSK_KND_CD
			               AND EVL_DTM_YN = 'Y'  /*미평가가 아닌것*/      
			       ) AS A_EVL_DTM_YN
			     , CASE WHEN D2.EVL_DTM_YN IS NULL THEN '미평가'
                        WHEN D2.EVL_STEP_CD = '700' AND D2.EVL_DTM_YN = 'Y' THEN '평가완료'		
                        ELSE '평가중' END AS EVL_DTM_STA 		/*평가진행단계*/	     
			  FROM TBCSPAOE024M D1
			     , (
			         SELECT EVL_YR
			              , HLYR_DVSN_CD
			              , AUD_TSK_KND_CD
			              , MAX(EVL_STEP_CD) AS EVL_STEP_CD
			              , EVL_DTM_YN
			              , AUD_YR
			              , TSK_NO
			           FROM TBCSPAOE029M
			          WHERE 1 = 1 
					]]>
					<!-- 관리자는 평가기간으로 조회 가능하다. -->
					<isNotEmpty property="strFromEvlYr">
						AND EVL_YR || HLYR_DVSN_CD BETWEEN #strFromEvlYr# || #strFromHlyrDvsnCd# AND #strToEvlYr# || #strToHlyrDvsnCd#
					</isNotEmpty>
					<isEmpty property="strFromEvlYr">
						AND EVL_YR = #strEvlYr#
					    AND HLYR_DVSN_CD = #strHlyrDvsnCd#
					</isEmpty>
					<![CDATA[ 				          
			            AND TSK_DVSN_CD  = '10001' /*감사외업무*/
			          GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_TSK_KND_CD, EVL_DTM_YN, AUD_YR, TSK_NO			     
				   ) D2
	               , 
	               (
	                SELECT CD 
	                     , CD_NM
	                     , OTPT_SEQ
	                     , CMM_CD_DVSN_CD
	                  FROM TBDCMACM013C 
	                 WHERE CMM_CD_DVSN_CD = '1000272'
	                   AND CD NOT IN ('000000000', '10000')
	                   AND USE_YN = 'Y'                
	               ) D3 /*정렬때문에 조인 2015.02.03 최원형 감사관 요청*/		     
			 WHERE 1=1
			   AND D1.EVL_YR = D2.EVL_YR (+)
			   AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD (+)
			   AND D1.TSK_KND_CD = D2.AUD_TSK_KND_CD (+)
			   AND D1.TSK_NO = D2.TSK_NO (+)
			   AND D1.EVL_YR = D2.AUD_YR (+)
			   AND D1.TSK_KND_CD = D3.CD
			]]>
			<isNotEqual property="strDptCd" compareValue="ALL">
			   AND CHR_DPT_CD = #DPT_CD#
			</isNotEqual>
		<!-- 관리자는 평가기간으로 조회 가능하다. -->
		<isNotEmpty property="strFromEvlYr">
			AND D1.EVL_YR || D1.HLYR_DVSN_CD BETWEEN #strFromEvlYr# || #strFromHlyrDvsnCd# AND #strToEvlYr# || #strToHlyrDvsnCd#
		</isNotEmpty>
		<isEmpty property="strFromEvlYr">
			AND D1.EVL_YR = #strEvlYr#
		    AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
		</isEmpty>
		<isNotEmpty property="strTskKndCd">
			AND D1.TSK_KND_CD = #strTskKndCd#
		</isNotEmpty>
		<isNotEmpty property="strTskTxt">
			AND D1.TSK_NM LIKE '%' || #strTskTxt# || '%'
		</isNotEmpty>	
		<![CDATA[  
		 	ORDER BY SUBSTR(D3.CD_NM, 0, 4), D3.OTPT_SEQ, TSK_KND_NM, D1.CHR_DPT_CD, D1.TSK_NO
		]]>
	</select>

	<!-- 감사외업무관리 삭제 전 자식 테이블 데이터 유무 체크 -->
	<select id="CSPAOE029ECntdelete" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE025M
			 WHERE 1=1
			   AND EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_KND_CD   = #TSK_KND_CD#
			   AND TSK_NO       = #TSK_NO#
		]]>
			<isNotEmpty property="PTCPT_CNB">
				AND PTCPT_CNB = #PTCPT_CNB#
			</isNotEmpty>
	</select>

	<!-- [성과평가]감사외업무관리 삭제 -->
	<delete id="CSPAOE029Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE024M
		 WHERE 1=1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND TSK_KND_CD = #TSK_KND_CD#
		   AND TSK_NO = #TSK_NO#
	</delete>

	<!-- [성과평가]감사외업무관리 신규등록전 중복정보 체크 -->
	<select id="CSPAOE029ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE024M
			 WHERE 1=1
			   AND EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_KND_CD   = #TSK_KND_CD#
			   AND TSK_NO       = #TSK_NO#
		]]>
	</select>

	<!-- [성과평가]감사외업무관리 신규등록 -->
	<insert id="CSPAOE029Emaininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE024M
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, TSK_KND_CD
			, TSK_NO
			, CHR_DPT_CD
			, TSK_NM
			, TSK_TXT
			, JUD_PNSH_CRCT_NOC
			, IMP_RDA_NTF_NOC
			, SPCN_MNG_NOC
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)VALUES
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_KND_CD#
			, (SELECT NVL(MAX(TSK_NO), 10000) + 1 AS TSK_NO
			     FROM TBCSPAOE024M
			    WHERE EVL_YR       = #EVL_YR#
			      AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			)
			, #CHR_DPT_CD#
			, #TSK_NM#
			, #TSK_TXT#
			, #JUD_PNSH_CRCT_NOC#
			, #IMP_RDA_NTF_NOC#
			, #SPCN_MNG_NOC#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- [성과평가]감사외업무관리 정보 수정 -->
	<update id="CSPAOE029Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE024M
		SET 
			FNL_MDF_DH = SYSDATE
			, CHR_DPT_CD = #CHR_DPT_CD#
			, TSK_NM = #TSK_NM#
			, TSK_TXT = #TSK_TXT#
			, JUD_PNSH_CRCT_NOC = #JUD_PNSH_CRCT_NOC#
			, IMP_RDA_NTF_NOC = #IMP_RDA_NTF_NOC#
			, SPCN_MNG_NOC = #SPCN_MNG_NOC#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_KND_CD = #TSK_KND_CD#
		AND TSK_NO = #TSK_NO#
	</update>

	<select id="CSPAOE029Esubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.EVL_YR                                    /*평가년도*/
			     , D1.HLYR_DVSN_CD                              /*반기구분코드*/
			     , D1.TSK_KND_CD                                /*업무종류코드*/
			     , D1.CHR_DPT_CD                                /*담당부서코드*/
			     , F_DPT_INFO(D1.CHR_DPT_CD, '1') AS CHR_DPT_NM /*담당부서명*/
			     , D1.TSK_NO                                    /*업무번호*/
			     , D1.PTCPT_CNB                                 /*참여자 전산번호*/
			     , D1.RANK_CD                                   /*직급코드*/
			     , F_CODE_NM('1000173', D1.RANK_CD) AS RANK_NM  /*직급명*/
			     , D1.CTB_RTE                                   /*기여율*/
			     , D1.EVL_RFR_SBJ_TXT                           /*평가참고사항*/
			     , F_USR_INFO(D1.PTCPT_CNB, '2') AS NAM         /*성명*/
			  FROM TBCSPAOE025M D1
			 WHERE 1=1
			   AND D1.EVL_YR       = #strEvlYr#
			   AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND D1.TSK_KND_CD   = #strTskKndCd#
			   AND D1.TSK_NO       = #strTskNo#
			  ORDER BY D1.CHR_DPT_CD, D1.PTCPT_CNB
		]]>
	</select>

	<!-- [성과평가]감사외업무 참여인원 및 기여율관리 삭제 -->
	<delete id="CSPAOE029Esubdelete" parameterClass="paramMap">
		DELETE TBCSPAOE025M
		WHERE 1=1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_KND_CD = #TSK_KND_CD#
		AND TSK_NO = #TSK_NO#
		AND PTCPT_CNB = #PTCPT_CNB#
	</delete>
	
	<!-- [성과평가]감사외업무 참여인원 및 기여율관리 삭제 -->
	<delete id="CSPAOE029EsubdeleteAll" parameterClass="paramMap">
		DELETE TBCSPAOE025M
		WHERE 1=1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_KND_CD = #TSK_KND_CD#
		AND TSK_NO = #TSK_NO#
	</delete>

	<!-- [성과평가]감사외업무 참여인원 및 기여율관리 신규등록 -->
	<insert id="CSPAOE029Esubinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE025M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_KND_CD
			, TSK_NO
			, PTCPT_CNB
			, CHR_DPT_CD
			, RANK_CD
			, CTB_RTE
			, EVL_RFR_SBJ_TXT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_KND_CD#
			, #TSK_NO#
			, #PTCPT_CNB#
			, #CHR_DPT_CD#
			, #RANK_CD#
			, #CTB_RTE#
			, #EVL_RFR_SBJ_TXT#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- [성과평가]감사외업무 참여인원 및 기여율관리 정보 수정 -->
	<update id="CSPAOE029Esubupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE025M
		SET 
			FNL_MDF_DH = SYSDATE
			, CHR_DPT_CD = #CHR_DPT_CD#
			, RANK_CD = #RANK_CD#
			, CTB_RTE = #CTB_RTE#
			, EVL_RFR_SBJ_TXT = #EVL_RFR_SBJ_TXT#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_KND_CD = #TSK_KND_CD#
		AND TSK_NO = #TSK_NO#
		AND PTCPT_CNB = #PTCPT_CNB#
	</update>
	
	<!-- 평가를 했는지 안했는지 체크한다. -->
	<select id="CSPAOE029EEvlYnselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT DECODE(COUNT(*), 0, 'N', 'Y') AS EVL_YN
			  FROM TBCSPAOE029M
			 WHERE 1=1
			   AND EVL_YR         = #strEvlYr#
			   AND HLYR_DVSN_CD   = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD    = '10001' /*감사외업무*/
			   AND AUD_TSK_KND_CD = #strTskKndCd#
			   AND NVL(EVL_STA_CD, '100') != '100' /*미평가가 아닌것*/
		]]>
	</select>
	
	<!-- 신규시 필터링을 위해 그리드용 업무종류 -->
	<select id="CSPAOE029ETskKndCdselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.CD
			     , D1.CD_NM
			     , CASE WHEN D2.AUD_TSK_KND_CD IS NOT NULL THEN 'N' ELSE 'Y' END AS NEW_YN
			  FROM (SELECT CD 
					     , CD_NM
					     , OTPT_SEQ
					  FROM TBDCMACM013C d1
					 WHERE CMM_CD_DVSN_CD = '1000272'
					   AND CD NOT IN ('000000000', '10000')
					   AND USE_YN = 'Y'	     
				   ) D1
			  	  ,(SELECT AUD_TSK_KND_CD
				      FROM TBCSPAOE029M
				     WHERE EVL_YR                  = #strEvlYr#
				       AND HLYR_DVSN_CD            = #strHlyrDvsnCd#
				       AND TSK_DVSN_CD             = '10001'
				       AND NVL(EVL_STA_CD, '100') != '100'  
				     GROUP BY AUD_TSK_KND_CD 
				   ) D2
			WHERE D1.CD = D2.AUD_TSK_KND_CD (+)
			ORDER BY D1.OTPT_SEQ, D1.CD 
		]]>
	</select>
	
	<!-- 엑셀데이터 가져오기 -->
	<select id="CSPAOE029EExelUploadselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT F_DPT_INFO(DPT_CD, '1') AS CHR_DPT_NM
			     , F_CODE_NM('1000173', RANK_CD) AS RANK_NM 
			     , USR_NAM        AS NAM
			     , #COL6#         AS CTB_RTE
			     , #COL7#         AS EVL_RFR_SBJ_TXT
			     , #EVL_YR#       AS EVL_YR
			     , #HLYR_DVSN_CD# AS HLYR_DVSN_CD
			     , #TSK_KND_CD#   AS TSK_KND_CD
			     , DPT_CD         AS CHR_DPT_CD
			     , #TSK_NO#       AS TSK_NO
			     , CNB            AS PTCPT_CNB
			     , RANK_CD
			  FROM TBDCMACM001M
			 WHERE CNB = #COL5#
		]]>
	</select>
	<!-- ##################################### 감사외업무관리 끝 (CSPAOE029E) ##################################### -->

	<!-- ##################################### 지원업무관리 끝 (CSPAOE030E) ##################################### -->

	<!-- 지원부서 리스트 조회 -->
	<select id="CSPAOE030EdeptCdselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
        	select DEPT_CD,DEPT_NM
        	from(
   			SELECT DPT_CD AS DEPT_CD
                 , F_DPT_INFO(DPT_CD, '1') AS DEPT_NM
                 ,DPT_SNO
              FROM (
		                SELECT DPT_CD ,DPT_SNO
		                  FROM TBDCMACM002M
		                 WHERE DPT_TP_CD = 'S' /*지원부서만 가져온다.*/
		                   AND USE_YN = 'Y'
		                   AND DPT_CD NOT IN('141010', '141020', '141030',  /* 150522_혁신전략팀,감사혁신,조직혁신팀 */
                  					'120000', '080000', '0D0000', '140000', '100000','300210','300220','300230',
                  					'160000', '1A0000', '170000', '190000',	'150000','140150','080190','190160',
                  					'200000', '300000', '400000', '500000', '510000','100100','080180','080220','200010',
                  					'520000', '530000', '540000', '550000', '150170','150160','770770','300010','150150',
                  					'121100', '121200', '122100','122200','122300','122400','150180','140130'
                                    , '071110', '071120','071130','071140','122500','071000'
                                    ,'081000', '081100', '081200', '081300', '081400' ,'071100', '071300'
                                    , '180000', '180100', '180110', '180120', '170300', '170320' )
                  					/*평가자평가_지원업무평가관리의 부서명과 동일하게 출력되도록 요청_150911*/
		                 GROUP BY DPT_CD ,DPT_SNO
                         UNION 
                         SELECT DPT_CD ,DPT_SNO
		                  FROM TBDCMACM002M
                         WHERE DPT_CD IN ('062500','062600','062700','062800')
                           AND USE_YN = 'Y'
                         
		             )
             ORDER BY DPT_SNO
             )      
		]]>
	</select>

	<!-- 지원업무관리 조회 -->
	<select id="CSPAOE030Emainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT EVL_YR                                      /*평가년도*/
			     , HLYR_DVSN_CD                                /*반기구분코드*/
			     , CHR_DPT_CD                                  /*담당부서코드*/
			     , F_DPT_INFO(CHR_DPT_CD, '1') AS CHR_DPT_NM   /*담당부서명*/
			     , TSK_NO                                      /*업무번호*/
			     , WGT_RTE                                     /*비중*/
			     , TSK_NM                                      /*업무명*/
			     , TSK_TXT                                     /*업무내용*/
			  FROM TBCSPAOE026M 
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		]]>
			<isNotEmpty property="strDeptCd">
				AND CHR_DPT_CD = #strDeptCd#
			</isNotEmpty>
		<![CDATA[  
		 	ORDER BY TSK_NO		]]>
	</select>

	<!-- 참여인원 및 기여율 조회 -->
	<select id="CSPAOE030Esubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT T1.EVL_YR                                        /*평가년도*/
			     , T1.HLYR_DVSN_CD                                  /*반기구분코드*/
			     , T1.CHR_DPT_CD                                    /*담당부서코드*/
			     , F_DPT_INFO(T1.CHR_DPT_CD, '1')   AS CHR_DPT_NM   /*담당부서명*/
			     , T1.TSK_NO                                        /*업무번호*/
			     , T1.PTCPT_CNB                                     /*참여자전산번호*/
			     , T1.RANK_CD                                       /*직급코드*/
			     , F_CODE_NM('1000173', T1.RANK_CD) AS RANK_NM      /*직급명*/
			     , T1.CTB_RTE                                       /*기여율*/
			     , F_USR_INFO(T1.PTCPT_CNB, '2')    AS NAM          /*이름*/
			  FROM TBCSPAOE027M T1
			  		,TBDCMACM001M T2
			 WHERE 1 = 1
			   AND T1.EVL_YR       = #strEvlYr#
			   AND T1.HLYR_DVSN_CD = #strHlyrDvsnCd#	
			   AND T1.PTCPT_CNB = T2.CNB
			   		   ]]>
		   <isNotEqual property="strChrDptCd" compareValue="141000">
			   <isEqual property="strChrDptCd" compareValue="121000">
				   AND T1.CHR_DPT_CD   in ('121100', '121200', '121000')
			   </isEqual>
			   <isNotEqual property="strChrDptCd" compareValue="121000">
				   <isEqual property="strChrDptCd" compareValue="122000">
					   AND T1.CHR_DPT_CD   in ('122100', '122200', '122300', '122400', '122000')
				   </isEqual>
				   <isNotEqual property="strChrDptCd" compareValue="122000">
				   		AND T1.CHR_DPT_CD   = #strChrDptCd#
				   </isNotEqual>
			   </isNotEqual>
		   </isNotEqual>
		   <isEqual property="strChrDptCd" compareValue="141000">
			   AND T1.CHR_DPT_CD   in ('141010', '141020', '141030')
		   </isEqual>
		   <![CDATA[  
			   AND T1.TSK_NO       = #strTskNo#
			 ORDER BY NVL(INN_RANK_CD,'50'), RANK_SRT_SEQ_NM, CRNT_RANK_APM_DT, SRT_KY_NO, CRNT_DPT_APM_DT, EIN									]]>
	</select>

	<!-- 삭제하기 전에 자식 테이블에 데이터가 있는지 체크한다. -->
	<!-- 인서트하기 전에 중복된 데이터가 있는지 체크한다 -->
	<select id="CSPAOE030ECntdelete" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE027M
			 WHERE 1=1
			   AND EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND CHR_DPT_CD   = #CHR_DPT_CD#
			   AND TSK_NO       = #TSK_NO#		]]>
			<isNotEmpty property="PTCPT_CNB">
				AND PTCPT_CNB = #PTCPT_CNB#
			</isNotEmpty>
	</select>

	<!-- [성과평가]지원업무관리 삭제 -->
	<delete id="CSPAOE030Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE026M
		WHERE 1=1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND CHR_DPT_CD = #CHR_DPT_CD#
		AND TSK_NO = #TSK_NO#
	</delete>

	<!-- [성과평가]지원업무관리 신규등록 -->
	<insert id="CSPAOE030Emaininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE026M
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, CHR_DPT_CD
			, TSK_NO
			, TSK_NM
			, TSK_TXT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)VALUES
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, #CHR_DPT_CD#
			, (SELECT NVL(MAX(TSK_NO), 10000) + 1 AS TSK_NO
			     FROM TBCSPAOE026M
			    WHERE EVL_YR       = #EVL_YR#
			      AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			)
			, #TSK_NM#
			, #TSK_TXT#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- [성과평가]지원업무관리 수정 -->
	<update id="CSPAOE030Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE026M
		SET 
			FNL_MDF_DH = SYSDATE
			, WGT_RTE = #WGT_RTE#
			, TSK_NM = #TSK_NM#
			, TSK_TXT = #TSK_TXT#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND CHR_DPT_CD = #CHR_DPT_CD#
		AND TSK_NO = #TSK_NO#
	</update>

	<!-- [성과평가]지원업무 참여인원 및 기여율관리 삭제 -->
	<delete id="CSPAOE030Esubdelete" parameterClass="paramMap">
		DELETE TBCSPAOE027M
		WHERE EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND CHR_DPT_CD = #CHR_DPT_CD#
		AND TSK_NO = #TSK_NO#
		AND PTCPT_CNB = #PTCPT_CNB#
	</delete>

	<!-- [성과평가]지원업무 참여인원 및 기여율관리 신규등록 -->
	<insert id="CSPAOE030Esubinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE027M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, CHR_DPT_CD
			, TSK_NO
			, PTCPT_CNB
			, RANK_CD
			, CTB_RTE
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #CHR_DPT_CD#
			, #TSK_NO#
			, #PTCPT_CNB#
			, #RANK_CD#
			, 0
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- [성과평가]지원업무 참여인원 및 기여율관리 수정 -->
	<update id="CSPAOE030Esubupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE027M
		SET 
			FNL_MDF_DH = SYSDATE
			, RANK_CD = #RANK_CD#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND CHR_DPT_CD = #CHR_DPT_CD#
		AND TSK_NO = #TSK_NO#
		AND PTCPT_CNB = #PTCPT_CNB#
	</update>

	<!-- [현행 인사정보 가져오기] 자체평가자 -->
	<insert id="CSPAOE030EInfoinsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE027M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, CHR_DPT_CD
			, TSK_NO
			, PTCPT_CNB
			, RANK_CD
			, CTB_RTE
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #strEvlYr#
			 , #strHlyrDvsnCd#
			 , DPT_CD
			 , #strTskNo#
			 , CNB
			 , RANK_CD
			 , 0
			 , #FRT_USR_ID#
			 , #FNL_USR_ID#
			 , #FNL_DEAL_DPT_CD#
			 , #FNL_MNU_ID#
			 , SYSDATE
			 , SYSDATE
		  FROM TBDCMACM001M
		<isEqual property="strChrDptCd" compareValue="141000">
		 WHERE DPT_CD in ('141010', '141020', '141030')
		</isEqual>
		<isNotEqual property="strChrDptCd" compareValue="141000">
			<isEqual property="strChrDptCd" compareValue="121000">
			 	WHERE DPT_CD in ('121100', '121200')
			</isEqual>
			<isNotEqual property="strChrDptCd" compareValue="121000">
				<isEqual property="strChrDptCd" compareValue="122000">
				 	WHERE DPT_CD in ('122100', '122200', '122300', '122400')
				</isEqual>
				<isNotEqual property="strChrDptCd" compareValue="122000">
					WHERE DPT_CD = #strChrDptCd#
				</isNotEqual>
			</isNotEqual>
		</isNotEqual>
		   AND NVL(PST_CD, '1') != '0013600' /*과장제외*/
	</insert>
	<!-- ##################################### 지원업무관리 끝 (CSPAOE030E) ##################################### -->

	<!-- ##################################### 운영직업무관리 시작 (CSPAOE031E) ##################################### -->

	<!-- 운영직업무 정보 조회 -->
	<select id="CSPAOE031Emainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT EVL_YR       /*평가년도*/
			     , HLYR_DVSN_CD /*반기구분코드*/
			     , PTCPT_CNB    /*참여자 전산번호*/
			     , TSK_NO       /*업무번호*/
			     , BLT_DPT_CD   /*소속부서코드*/
			     , RANK_CD      /*직급코드*/
			     , TSK_NM       /*업무명*/
			     , TSK_TXT      /*업무내용*/
			  FROM TBCSPAOE028M
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND PTCPT_CNB    = #strPtcptCnb#
			 ORDER BY TSK_NO
		]]>
	</select>
	
	<!-- 관리운영직등 피평가자 목록 조회 -->
	<select id="CSPAOE031EPtcptselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.EVL_YR
			     , D1.HLYR_DVSN_CD
			     , F_USR_INFO(D1.NEVLT_CNB, '2') AS NEVLT_NM
			     , D1.NEVLT_CNB
			     , F_DPT_INFO(D1.BLT_DPT_CD, '1') AS BLT_DPT_NM
			     , F_CODE_NM('1000173', D1.RANK_CD) AS RANK_NM
			     , D1.BLT_DPT_CD
			     , D1.RANK_CD
                 , CASE WHEN D3.NEVLT_CNB IS NOT NULL THEN '평가완료'
                        WHEN D2.NEVLT_CNB IS NOT NULL THEN '평가중'
                        ELSE '미평가' 
                 END AS NEVLT_DIV /*평가진행상황 : 2015.01.26 최원형감사관 요청*/
                 , CASE 
			     	WHEN (SELECT count(*) FROM TBCSPAOE028M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND PTCPT_CNB = D1.NEVLT_CNB) = 0 THEN '미입력'
			     	ELSE '입력'
			     END AS PTCPT_DIV
			  FROM TBCSPAOE020D D1
                 , (
                  SELECT NEVLT_CNB
                   FROM TBCSPAOE032M
                  WHERE EVL_YR = #strEvlYr#
                    AND HLYR_DVSN_CD = #strHlyrDvsnCd#
					]]>	
					<isNotEmpty property="strPtcptCnb">
						AND NEVLT_CNB = #strPtcptCnb#
					</isNotEmpty>
			        <![CDATA[                     
                  GROUP BY NEVLT_CNB                
                 ) D2 /*평가중인 피평가자 목록*/
                 , (
                SELECT NEVLT_CNB
                 FROM TBCSPAOE035M
                WHERE EVL_YR = #strEvlYr#
                  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                  AND TSK_DVSN_CD = '10003' /*관리운영직*/
				]]>	
				<isNotEmpty property="strPtcptCnb">
					AND NEVLT_CNB = #strPtcptCnb#
				</isNotEmpty>
		        <![CDATA[                     
                GROUP BY NEVLT_CNB                 
                 ) D3 /*평가완료된 피평가자 목록*/
			 WHERE D1.NEVLT_CNB = D2.NEVLT_CNB (+)
               AND D1.NEVLT_CNB = D3.NEVLT_CNB (+)
			   AND D1.EVL_YR       = #strEvlYr#
			   AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#  
		]]>	
		<isNotEmpty property="strPtcptCnb">
			AND D1.NEVLT_CNB = #strPtcptCnb#
		</isNotEmpty>
        <![CDATA[  		   
			 ORDER BY D1.BLT_DPT_CD, D1.NEVLT_CNB    		]]>
	</select>
	
	
	<!-- 피평가자인지 체크 -->
	<select id="CSPAOE031ECntNevltCntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT COUNT(*) AS CNT_NEVLT_CNB
   			  FROM TBCSPAOE020D
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND NEVLT_CNB    = #strPtcptCnb#
		]]>
	</select>

	<!-- [성과평가]운영직업무관리 삭제 -->
	<delete id="CSPAOE031Emaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE028M
		WHERE EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND PTCPT_CNB = #PTCPT_CNB#
		AND TSK_NO = #TSK_NO#
	</delete>

	<!-- 관리운영직등 피평가자 목록 조회 -->
	<select id="CSPAOE031ETskNoselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(NVL(MAX(TSK_NO), 10000) + 1) AS TSK_NO
			  FROM TBCSPAOE028M
			 WHERE EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		]]>
	</select>
	
	<!-- [성과평가]운영직업무관리 신규등록 -->
	<insert id="CSPAOE031Emaininsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE028M
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, PTCPT_CNB
			, TSK_NO
			, BLT_DPT_CD
			, RANK_CD
			, TSK_NM
			, TSK_TXT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, #PTCPT_CNB#
			, #TSK_NO#
			, #BLT_DPT_CD#
			, #RANK_CD#
			, #TSK_NM#
			, #TSK_TXT#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- [성과평가]운영직업무관리 수정 -->
	<update id="CSPAOE031Emainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE028M
		SET 
			FNL_MDF_DH = SYSDATE
			, TSK_NM = #TSK_NM#
			, TSK_TXT = #TSK_TXT#
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND PTCPT_CNB = #PTCPT_CNB#
		AND TSK_NO = #TSK_NO#
	</update>

	<!-- ##################################### 운영직업무관리 끝 (CSPAOE031E) ##################################### -->

	<!-- ##################################### 업무별 평가진행상황 탭 시작 (CSPAOE032Q) ##################################### -->

	<!-- 감사업무 탭 -->
	<!-- 담당자 정보 조회한다. -->
	<select id="CSPAOE032QmainAuditselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
            SELECT D6.CHGR_DVSN_NM               AS CHGR_DVSN_NM  /*담당자구분명*/
                 , F_USR_INFO(D6.CHGR_CNB, '2')  AS NAM      /*담당자명*/
                 , NVL(D6.COFM_N, 0)             AS COFM_N   /*확인완료건수*/
                 , NVL(D6.COFM_Y, 0)             AS COFM_Y  /*미확인 건수*/
                 , NVL(D6.COFM_ALL, 0)           AS COFM_ALL /*합계건수*/
                 , D6.EVL_YR                     AS EVL_YR /*평가년도*/
			     , D6.HLYR_DVSN_CD               AS HLYR_DVSN_CD /*반기구분코드*/
                 , D6.CHGR_DVSN_CD               AS CHGR_DVSN_CD /*담당자구분코드*/
                 , D6.CHGR_CNB                   AS CHGR_CNB /*담당자 전산번호*/                                
              FROM (
                SELECT D3.EVL_YR 
                     , D3.HLYR_DVSN_CD 
                     , D3.CHGR_DVSN_CD 
                     , D3.CHGR_CNB 
                     , D3.EVL_STEP_CD
                     , D3.CHGR_DVSN_NM
                     , SUM(DECODE( NVL(D5.EVL_STA_CD, 0), 0, 1, '100', 1, '200', 1, 0)) AS COFM_N
                     , SUM(DECODE( NVL(D5.EVL_STA_CD, 0), 1, 0, '300', 1, 0)) AS COFM_Y 
                     , SUM(DECODE( NVL(D5.EVL_STA_CD, 0), 0, 1, '100', 1, '200', 1, '300', 1, 0)) AS COFM_ALL /*합계건수*/
                  FROM (
                    SELECT D2.EVL_YR
                         , D2.HLYR_DVSN_CD
                         , D1.TSK_NO
                         , D1.AUD_YR
                         , D2.CHGR_DVSN_CD
                         , '200' AS EVL_STEP_CD
                         , D2.CHGR_CNB
                         , D2.CHGR_DVSN_NM
                      FROM (
                        SELECT TSK_NO
                             , AUD_YR
                          FROM (
                            SELECT AUD_YR 
                                 , TSK_NO 
                                 , MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                                 , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                              FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */
                             WHERE 1 = 1
                               AND CMPT_DT IS NOT NULL
                               AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                             GROUP BY AUD_YR, TSK_NO
                        )
                        WHERE AUD_STEP_CD_MAX = '10010'
                       ) D1
                       , (
                            SELECT D4.CHGR_DVSN_CD
                                 , D4.CHGR_CNB
                                 , D3.CHGR_DVSN_NM
                                 , D3.EVL_YR
                                 , D3.HLYR_DVSN_CD
                             FROM TBCSPAOE016M D3
                                , TBCSPAOE017D D4
                            WHERE D3.EVL_YR = D4.EVL_YR
                              AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
                              AND D3.TSK_DVSN_CD = D4.TSK_DVSN_CD
                              AND D3.AUD_TSK_KND_CD = D4.AUD_TSK_KND_CD
                              AND D3.CHGR_DVSN_CD = D4.CHGR_DVSN_CD
                              AND D3.EVL_YR = #strEvlYr#
                              AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd#
                              AND D3.TSK_DVSN_CD = '10000'
                              AND D3.CHGR_DVSN_CD = 'CD34'
                       ) D2
                      
                    UNION ALL

                    SELECT D2.EVL_YR
                         , D2.HLYR_DVSN_CD
                         , D1.TSK_NO
                         , D1.AUD_YR
                         , D2.CHGR_DVSN_CD
                         , '100' AS EVL_STEP_CD
                         , D2.CHGR_CNB
                         , D2.CHGR_DVSN_NM
                      FROM (
                        SELECT TSK_NO
                             , AUD_YR
                          FROM (
                            SELECT AUD_YR 
                                 , TSK_NO 
                                 , MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                                 , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                              FROM TBCSPAOE022M BASE /* 감사업무처리단계관리기본 */
                             WHERE 1 = 1
                               AND CMPT_DT IS NOT NULL
                               AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                               AND 0 = (
                                     SELECT COUNT(*)  
                                     FROM TBCSPAOE029M
                                    WHERE EVL_YR || HLYR_DVSN_CD != #strEvlYr# || #strHlyrDvsnCd# 
                                      AND EVL_STEP_CD = '100'
                                      AND EVL_CMTR_DVSN_CD = 'CD33'  
                                      AND AUD_YR = BASE.AUD_YR
                                      AND TSK_NO = BASE.TSK_NO
                               ) /*이전에 귀청보고 평가 받지 않은 감사사항만*/
                             GROUP BY AUD_YR, TSK_NO
                        )
                       WHERE ( TO_NUMBER(AUD_STEP_CD_MAX) BETWEEN 10004 AND 10009 AND TO_NUMBER(AUD_STEP_CD_MIN) <= 10004 ) /*귀청보고 ~ ( 귀청보고 - 국장/단장) */
                          OR AUD_STEP_CD_MAX  = '10010'                      
                       ) D1
                       , (
                            SELECT D4.CHGR_DVSN_CD
                                 , D4.CHGR_CNB
                                 , D3.CHGR_DVSN_NM
                                 , D3.EVL_YR
                                 , D3.HLYR_DVSN_CD
                             FROM TBCSPAOE016M D3
                                , TBCSPAOE017D D4
                            WHERE D3.EVL_YR = D4.EVL_YR
                              AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
                              AND D3.TSK_DVSN_CD = D4.TSK_DVSN_CD
                              AND D3.AUD_TSK_KND_CD = D4.AUD_TSK_KND_CD
                              AND D3.CHGR_DVSN_CD = D4.CHGR_DVSN_CD
                              AND D3.EVL_YR = #strEvlYr#
                              AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd#
                              AND D3.TSK_DVSN_CD = '10000'
                              AND D3.CHGR_DVSN_CD = 'CD33'
                       ) D2                       

                    ) D3
                    , TBCSPAOE029M D5
                WHERE D3.EVL_YR          = D5.EVL_YR           (+)
                  AND D3.HLYR_DVSN_CD    = D5.HLYR_DVSN_CD     (+)
                  AND D5.TSK_DVSN_CD (+) = '10000' /*감사업무*/
                  AND D3.EVL_STEP_CD     = D5.EVL_STEP_CD      (+)
                  AND D3.CHGR_CNB        = D5.EVL_CMTR_CNB     (+)
                  AND D3.TSK_NO          = D5.TSK_NO           (+)
                  AND D3.AUD_YR          = D5.AUD_YR           (+)
                  AND D3.CHGR_DVSN_CD    = D5.EVL_CMTR_DVSN_CD (+)
                GROUP BY D3.EVL_YR, D3.HLYR_DVSN_CD, D3.CHGR_DVSN_CD, D3.CHGR_CNB, D3.EVL_STEP_CD, D3.CHGR_DVSN_NM
                ) D6
            ORDER BY CHGR_DVSN_CD, NAM
		]]>
	</select>

	<!-- 감사사항 목록 조회한다. -->
	<select id="CSPAOE032QsubAuditselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[  
                SELECT NVL(F_MNG_KND_AUDYRNO(D3.AUD_YR, D3.TSK_NO, D7.AUD_KND_CD, '-'),D3.AUD_YR || '-' || D3.TSK_NO) AS YR_TSK_NO /*감사연번호*/
                     , ( SELECT AUD_SBJ_NM FROM TBCSPAOE021M WHERE AUD_YR = D3.AUD_YR AND TSK_NO = D3.TSK_NO ) AS AUD_SBJ_NM /*감사사항명*/
                     , F_CODE_NM('1000279', D3.EVL_STEP_CD) AS EVL_STEP_NM /*평가단계*/
                     , F_CODE_NM('1000280', NVL(D5.EVL_STA_CD, '100')) AS EVL_STA_NM /*평가상태*/
                     , F_DPT_INFO(D6.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM /*처리과 - 2015.01.04 최원형감사관 요청*/
                  FROM (
                    SELECT D2.EVL_YR
                         , D2.HLYR_DVSN_CD
                         , D1.TSK_NO
                         , D1.AUD_YR
                         , D2.CHGR_DVSN_CD
                         , '200' AS EVL_STEP_CD
                         , D2.CHGR_CNB
                      FROM (
                        SELECT TSK_NO
                             , AUD_YR
                          FROM (
                            SELECT AUD_YR 
                                 , TSK_NO 
                                 , MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                                 , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                              FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */
                             WHERE 1 = 1
                               AND CMPT_DT IS NOT NULL
                               AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                             GROUP BY AUD_YR, TSK_NO
                        )
                        WHERE AUD_STEP_CD_MAX = '10010'
                       ) D1
                       , TBCSPAOE017D D2
                    WHERE D2.EVL_YR = #strEvlYr#
                      AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
                      AND D2.TSK_DVSN_CD = '10000'
                      AND D2.CHGR_DVSN_CD = 'CD34'
                      AND D2.CHGR_DVSN_CD = #strEvlDvsnCd#   
                      AND D2.CHGR_CNB = #strEvlCmtrCnb#  
                      
                    UNION ALL

                    SELECT D2.EVL_YR
                         , D2.HLYR_DVSN_CD
                         , D1.TSK_NO
                         , D1.AUD_YR
                         , D2.CHGR_DVSN_CD
                         , '100' AS EVL_STEP_CD
                         , D2.CHGR_CNB
                      FROM (
                        SELECT TSK_NO
                             , AUD_YR
                          FROM (
                            SELECT AUD_YR 
                                 , TSK_NO 
                                 , MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                                 , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                              FROM TBCSPAOE022M BASE /* 감사업무처리단계관리기본 */
                             WHERE 1 = 1
                               AND CMPT_DT IS NOT NULL
                               AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                               AND 0 = (
                                     SELECT COUNT(*)
                                     FROM TBCSPAOE029M
                                    WHERE EVL_YR || HLYR_DVSN_CD != #strEvlYr# || #strHlyrDvsnCd#
                                      AND EVL_STEP_CD = '100'
                                      AND EVL_CMTR_DVSN_CD = 'CD33'  
                                      AND AUD_YR = BASE.AUD_YR
                                      AND TSK_NO = BASE.TSK_NO
                               )                               
                             GROUP BY AUD_YR, TSK_NO
                        )
                       WHERE ( TO_NUMBER(AUD_STEP_CD_MAX) BETWEEN 10004 AND 10009 AND TO_NUMBER(AUD_STEP_CD_MIN) <= 10004 ) /*귀청보고 ~ ( 귀청보고 - 국장/단장) */
                          OR AUD_STEP_CD_MAX  = '10010'
                       ) D1
                       , TBCSPAOE017D D2
                    WHERE D2.EVL_YR = #strEvlYr#
                      AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
                      AND D2.TSK_DVSN_CD = '10000'
                      AND D2.CHGR_DVSN_CD = 'CD33'
                      AND D2.CHGR_DVSN_CD = #strEvlDvsnCd#  
                      AND D2.CHGR_CNB = #strEvlCmtrCnb#  
                    ) D3
                    , TBCSPAOE029M D5
                    , TBCSPAOE021M D6
                    , TBBADDED001M D7
                WHERE D3.EVL_YR          = D5.EVL_YR           (+)
                  AND D3.HLYR_DVSN_CD    = D5.HLYR_DVSN_CD     (+)
                  AND D5.TSK_DVSN_CD (+) = '10000' /*감사업무*/
                  AND D3.EVL_STEP_CD     = D5.EVL_STEP_CD      (+)
                  AND D3.CHGR_CNB        = D5.EVL_CMTR_CNB     (+)
                  AND D3.TSK_NO          = D5.TSK_NO           (+)
                  AND D3.AUD_YR          = D5.AUD_YR           (+)
                  AND D3.CHGR_DVSN_CD    = D5.EVL_CMTR_DVSN_CD (+)
                  AND D3.AUD_YR          = D6.AUD_YR
                  AND D3.TSK_NO          = D6.TSK_NO
                  AND D3.TSK_NO = D7.AUD_NO (+)
				  AND D3.AUD_YR = D7.AUD_YR (+)
                  AND NVL(D5.EVL_STA_CD, '100') in ('100', '200') /*평가상태코드가 100인 미확인인것만 조회한다.*/
                ORDER BY D6.HNDL_DIV_DPT_CD, D3.AUD_YR, D3.TSK_NO 			 
		]]>
	</select>

	<!-- 감사외업무 탭 -->
	<!-- 담당자 정보 조회한다. -->
	<select id="CSPAOE032QmainOAuditselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT ( SELECT CHGR_DVSN_NM FROM TBCSPAOE016M WHERE EVL_YR = D6.EVL_YR AND HLYR_DVSN_CD = D6.HLYR_DVSN_CD AND CHGR_DVSN_CD = D6.CHGR_DVSN_CD) AS CHGR_DVSN_NM /*담당자구분명*/
			     , F_USR_INFO(D6.CHGR_CNB, '2')  AS NAM             /*담당자명*/
			     , NVL(D6.COFM_Y, 0)             AS COFM_Y          /*확인완료건수*/ 
			     , NVL(D6.COFM_N, 0)             AS COFM_N          /*미확인 건수*/
			     , NVL(D6.COFM_ALL, 0)           AS COFM_ALL        /*합계건수*/
			     , D6.EVL_YR                     AS EVL_YR          /*평가년도*/
			     , D6.HLYR_DVSN_CD               AS HLYR_DVSN_CD    /*반기구분코드*/
			     , D6.CHGR_DVSN_CD               AS CHGR_DVSN_CD    /*담당자구분코드*/
			     , D6.CHGR_CNB                   AS CHGR_CNB        /*담당자 전산번호*/
			     , D6.EVL_STEP_CD                AS EVL_STEP_CD     /*평가단계 코드*/
			     , D6.TSK_KND_CD                 AS AUD_TSK_KND_CD  /*감사업무종류코드*/
			  FROM (
			    SELECT D3.EVL_YR
			         , D3.HLYR_DVSN_CD
			         , D3.TSK_KND_CD
			         , D3.CHGR_DVSN_CD
			         , D3.EVL_STEP_CD
			         , SUM(DECODE( NVL(D5.EVL_STA_CD, 0), 0, 1, '100', 1, '200', 1, 0))           AS COFM_N   /*미확인 건수*/
			         , SUM(DECODE(D5.EVL_STA_CD, '300', 1, 0))                          AS COFM_Y   /*확인완료건수*/ 
			         , SUM(DECODE( NVL(D5.EVL_STA_CD, 0), 0, 1, '100', 1, '200', 1, '300', 1, 0)) AS COFM_ALL /*합계건수*/ 
			         , D3.CHGR_CNB
			      FROM (
			        SELECT D1.EVL_YR
			             , D1.HLYR_DVSN_CD
			             , D1.TSK_KND_CD
			             , D1.TSK_NO
			             , D2.CHGR_DVSN_CD
			             , DECODE(MOD(SUBSTR(D2.CHGR_DVSN_CD, 4), 2), 1, '600', '700') AS EVL_STEP_CD  /*홀수면 평가자, 짝수면 확인자*/
			             , D2.CHGR_CNB
			          FROM TBCSPAOE024M D1
			             , TBCSPAOE017D D2
			        WHERE D1.EVL_YR       = D2.EVL_YR
			          AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			          AND D2.TSK_DVSN_CD  = '10001' /*감사외업무*/
			          AND D1.TSK_KND_CD   = D2.AUD_TSK_KND_CD
			          AND D1.EVL_YR       = #strEvlYr#
			          AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			          AND D2.CHGR_DVSN_CD NOT IN ('CD33', 'CD34') /*감사업무쪽 코드임*/
			     ) D3
			    , (
			       SELECT EVL_YR
			            , HLYR_DVSN_CD
			            , TSK_KND_CD
			            , TSK_NO
			         FROM TBCSPAOE025M
			        WHERE EVL_YR       = #strEvlYr#
			          AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			        GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_KND_CD, TSK_NO                  
			    ) D4 /*감사외 업무 참여인원이 등록되지 않음 카운트 제외*/
			    , TBCSPAOE029M D5
			    WHERE D3.EVL_YR          = D4.EVL_YR
			      AND D3.HLYR_DVSN_CD    = D4.HLYR_DVSN_CD
			      AND D3.TSK_KND_CD      = D4.TSK_KND_CD
			      AND D3.TSK_NO          = D4.TSK_NO
			      AND D3.EVL_YR          = D5.EVL_YR           (+)
			      AND D3.HLYR_DVSN_CD    = D5.HLYR_DVSN_CD     (+)
			      AND D5.TSK_DVSN_CD (+) = '10001'
			      AND D3.TSK_KND_CD      = D5.AUD_TSK_KND_CD   (+)
			      AND D3.EVL_STEP_CD     = D5.EVL_STEP_CD      (+)
			      AND D3.CHGR_CNB        = D5.EVL_CMTR_CNB     (+)
			      AND D3.TSK_NO          = D5.TSK_NO           (+)
			      AND D3.CHGR_DVSN_CD    = D5.EVL_CMTR_DVSN_CD (+)
			    GROUP BY D3.EVL_YR, D3.HLYR_DVSN_CD, D3.TSK_KND_CD, D3.CHGR_DVSN_CD, D3.EVL_STEP_CD, D3.CHGR_CNB
			) D6
			ORDER BY SUBSTR(CHGR_DVSN_NM, 0, 4), CASE WHEN SUBSTR(CHGR_DVSN_NM, 0, 4) = '기타업무' THEN TO_NUMBER(SUBSTR(CHGR_DVSN_CD, 3)) ELSE 0 END,  D6.CHGR_CNB /*2014.02.04 최원형 감사관 요청*/
		]]>
	</select>

	<!-- 업무 목록 조회한다. -->
	<select id="CSPAOE032QsubOAuditselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
			SELECT MAN.TSK_NM                  AS TSK_NM      /*업무 명*/
			     , F_CODE_NM('1000279', MAN.EVL_STEP_CD) AS EVL_STEP_NM /*평가단계*/
			     , F_CODE_NM('1000280', NVL(D3.EVL_STA_CD, '100')) AS EVL_STA_NM  /*평가상태 - 미확인만 뽑는거니깐.*/
			     , F_DPT_INFO(MAN.CHR_DPT_CD, '1') AS CHR_DPT_NM /*담당부서명 2015.02.04 최원형 감사관 요청*/
			  FROM (
			        SELECT D1.EVL_YR
			             , D1.HLYR_DVSN_CD
			             , D1.TSK_KND_CD
			             , D1.CHGR_DVSN_CD
			             , D1.TSK_NO
			             , D1.TSK_NM
			             , D1.EVL_STEP_CD
			             , D1.CHGR_CNB
			             , D1.CHR_DPT_CD
			         FROM (
			                SELECT D1.EVL_YR
			                     , D1.HLYR_DVSN_CD
			                     , D1.TSK_KND_CD
			                     , D1.TSK_NO
			                     , D1.TSK_NM
			                     , D2.CHGR_DVSN_CD
			                     , DECODE(MOD(SUBSTR(D2.CHGR_DVSN_CD, 4), 2), 1, '600', '700') AS EVL_STEP_CD  /*홀수면 평가자, 짝수면 확인자*/
			                     , D2.CHGR_CNB
			                     , D1.CHR_DPT_CD
			                  FROM TBCSPAOE024M D1
			                     , TBCSPAOE017D D2
			                WHERE D1.EVL_YR       = D2.EVL_YR
			                  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			                  AND D2.TSK_DVSN_CD  = '10001'
			                  AND D1.TSK_KND_CD   = D2.AUD_TSK_KND_CD
			                  AND D1.EVL_YR       = #strEvlYr#
			                  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			                  AND D1.TSK_KND_CD   = #strAudTskKndCd#
			                  AND D2.CHGR_DVSN_CD = #strEvlDvsnCd#
			                  AND D2.CHGR_DVSN_CD NOT IN ('CD33', 'CD34') /*감사업무쪽 코드임*/
			               )D1
			               , (
			                      SELECT EVL_YR
			                         , HLYR_DVSN_CD
			                         , TSK_KND_CD
			                         , TSK_NO
			                      FROM TBCSPAOE025M
			                     WHERE EVL_YR       = #strEvlYr#
			                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			                       AND TSK_KND_CD   = #strAudTskKndCd#
			                     GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_KND_CD, TSK_NO                            
			                ) D5 /*감사외 업무 팜여인원이 등록되지 않음 업무명 보여줄 필요 없다.*/			               
			            WHERE D1.EVL_YR           = D5.EVL_YR
                          AND D1.HLYR_DVSN_CD     = D5.HLYR_DVSN_CD
                          AND D1.TSK_KND_CD       = D5.TSK_KND_CD
                          AND D1.TSK_NO           = D5.TSK_NO                  
			    ) MAN
			    , TBCSPAOE029M D3
            WHERE MAN.EVL_YR                = D3.EVL_YR           (+)
			  AND MAN.HLYR_DVSN_CD          = D3.HLYR_DVSN_CD     (+)
			  AND D3.TSK_DVSN_CD (+)        = '10001' /*감사외업무*/
			  AND MAN.TSK_KND_CD            = D3.AUD_TSK_KND_CD   (+)
			  AND MAN.EVL_STEP_CD           = D3.EVL_STEP_CD      (+)
			  AND MAN.CHGR_CNB              = D3.EVL_CMTR_CNB     (+)
			  AND MAN.TSK_NO                = D3.TSK_NO           (+)
			  AND MAN.CHGR_DVSN_CD          = D3.EVL_CMTR_DVSN_CD (+)
			  AND NVL(D3.EVL_STA_CD, '100') IN ('100', '200') /*평가상태코드가 100인 미확인인것만 조회한다.*/
			ORDER BY MAN.CHR_DPT_CD
		]]>
	</select>

	<!-- 지원업무 탭 -->
	<!-- 담당자 정보 조회한다. -->
	<select id="CSPAOE032QmainSuppselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT 	
				  A.CHGR_DVSN_CD /*담당자구분코드*/
				, (SELECT CHGR_DVSN_NM FROM  TBCSPAOE016M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND CHGR_DVSN_CD = A.CHGR_DVSN_CD) AS CHGR_DVSN_NM /*담당자구분명*/
				, A.CHGR_CNB /*담당자 전산번호*/
				, F_USR_INFO(A.CHGR_CNB,'2') AS NAM /*담당자명*/
				, NOCNT AS COFM_N /*미확인 건수*/
				, OKCNT AS COFM_Y /*확인완료건수*/
				, (NOCNT + OKCNT) AS COFM_ALL /*합계건수*/
				, #strEvlYr# AS EVL_YR /*평가년도*/
				, #strHlyrDvsnCd# AS HLYR_DVSN_CD /*반기구분코드*/
			FROM	
				(
				/*CD01:자체평가자 - 지원부서 과장(각 부서마다 과장들이 있다)*/
				SELECT  
					  A.CHGR_CNB
					, A.CHGR_DVSN_CD
					, B.CHR_DPT_CD
					, SUM(CASE WHEN C.EVL_DTM_YN IS NULL OR EVL_DTM_YN = 'N' THEN 1 ELSE 0 END) AS NOCNT
					, SUM(CASE WHEN C.EVL_DTM_YN ='Y' THEN 1 ELSE 0 END) AS OKCNT
				FROM
					  TBCSPAOE017D A
					, (SELECT EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD
						 FROM TBCSPAOE026M
						WHERE EVL_YR = '2015'
						  AND HLYR_DVSN_CD = '10'
						GROUP BY EVL_YR, HLYR_DVSN_CD,CHR_DPT_CD
					) B
					, (SELECT EVL_YR
							  , HLYR_DVSN_CD
							  , EVL_DTM_YN
							  , EVL_CMTR_CNB
							  , EVL_CMTR_DVSN_CD
						 FROM TBCSPAOE031M
						WHERE EVL_CMTR_DVSN_CD = 'CD01'
						  AND EVL_YR = #strEvlYr# 
						  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
						GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_CNB, EVL_CMTR_DVSN_CD
					) C
				WHERE 1 = 1
				AND A.EVL_YR = B.EVL_YR(+)
				AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD(+)
				AND A.BLT_DPT_CD = CHR_DPT_CD(+)
				AND A.EVL_YR = C.EVL_YR(+)
				AND A.HLYR_DVSN_CD = C.HLYR_DVSN_CD(+)
				AND A.CHGR_DVSN_CD = C.EVL_CMTR_DVSN_CD(+)
				AND A.CHGR_CNB = C.EVL_CMTR_CNB(+)
				AND A.EVL_YR = #strEvlYr# 
				AND A.HLYR_DVSN_CD = #strHlyrDvsnCd#
				AND A.TSK_DVSN_CD = '10002'
				AND A.CHGR_DVSN_CD = 'CD01'
				GROUP BY A.CHGR_CNB, A.CHGR_DVSN_CD, B.CHR_DPT_CD
				
				UNION ALL
				
				/*CD02:상급자평가 - 지원부서 국장이기 때문에 국장의 부서코드는 업코드가 들어가있으므로 하위 부서코드를 가져와야한다.*/
				SELECT 
					  A.CHGR_CNB
					, A.CHGR_DVSN_CD
					, A.BLT_DPT_CD AS CHR_DPT_CD
					, SUM(CASE WHEN C.EVL_DTM_YN IS NULL OR EVL_DTM_YN = 'N' THEN 1 ELSE 0 END) AS NOCNT
					, SUM(CASE WHEN C.EVL_DTM_YN = 'Y' THEN 1 ELSE 0 END) AS OKCNT
				FROM
					  TBCSPAOE017D A
					, (SELECT EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD
						 FROM TBCSPAOE026M
						WHERE EVL_YR = '2015'
						  AND HLYR_DVSN_CD = '10'
						GROUP BY EVL_YR, HLYR_DVSN_CD,CHR_DPT_CD
					) B
					, (SELECT EVL_YR
							  , HLYR_DVSN_CD
							  , EVL_DTM_YN
							  , EVL_CMTR_CNB
							  , EVL_CMTR_DVSN_CD
						 FROM TBCSPAOE031M
						WHERE EVL_CMTR_DVSN_CD = 'CD02'
						  AND EVL_YR = #strEvlYr# 
						  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
						GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_CNB, EVL_CMTR_DVSN_CD
					) C
				WHERE 1 = 1
				AND A.EVL_YR = B.EVL_YR(+)
				AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD(+)
				AND SUBSTR(A.BLT_DPT_CD, 1 ,3) = SUBSTR(CHR_DPT_CD(+), 1 ,3)
				AND A.EVL_YR = C.EVL_YR(+)
				AND A.HLYR_DVSN_CD = C.HLYR_DVSN_CD(+)
				AND A.CHGR_DVSN_CD = C.EVL_CMTR_DVSN_CD(+)
				AND A.CHGR_CNB = C.EVL_CMTR_CNB(+)
				AND A.EVL_YR = #strEvlYr# 
				AND	A.HLYR_DVSN_CD = #strHlyrDvsnCd#
				AND	A.TSK_DVSN_CD = '10002'
				AND	A.CHGR_DVSN_CD = 'CD02'
				GROUP BY A.CHGR_CNB, A.CHGR_DVSN_CD, A.BLT_DPT_CD
				
				UNION ALL
				
				/*CD03:지원부서 평가위원 - 부서코드랑 연결할 필요가 없다. 이사람들은 원장, 차장 이런사람들이라서..*/
				SELECT  
					  A.CHGR_CNB
					, A.CHGR_DVSN_CD
					, '' AS CHR_DPT_CD
					, SUM(CASE WHEN C.EVL_DTM_YN IS NULL OR EVL_DTM_YN = 'N' THEN 1 ELSE 0 END) AS NOCNT
					, SUM(CASE WHEN C.EVL_DTM_YN = 'Y' THEN 1 ELSE 0 END) AS OKCNT
				FROM
					(SELECT 
						  A.EVL_YR
						, A.HLYR_DVSN_CD
						, A.CHGR_CNB
						, A.CHGR_DVSN_CD
						, B.CHR_DPT_CD
					FROM 
						  TBCSPAOE017D A
						, (SELECT EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD
					         FROM TBCSPAOE026M
					        WHERE EVL_YR = #strEvlYr#
					          AND HLYR_DVSN_CD = #strHlyrDvsnCd#
					        GROUP BY EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD) B
					WHERE 1 = 1
					AND A.EVL_YR = B.EVL_YR 
					AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD 
					AND A.EVL_YR = #strEvlYr#
					AND A.HLYR_DVSN_CD = #strHlyrDvsnCd#
					AND A.TSK_DVSN_CD = '10002'
					AND A.CHGR_DVSN_CD = 'CD03'
					) A 
					, (SELECT EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_DVSN_CD, EVL_CMTR_CNB, DPT_CD
					     FROM TBCSPAOE031M
					    WHERE EVL_CMTR_DVSN_CD = 'CD03'
					      AND EVL_YR = #strEvlYr# 
					      AND HLYR_DVSN_CD = #strHlyrDvsnCd#
					    GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_DVSN_CD, EVL_CMTR_CNB,DPT_CD
					) C
					WHERE A.EVL_YR = C.EVL_YR(+)
					AND A.HLYR_DVSN_CD = C.HLYR_DVSN_CD(+)
					AND A.CHGR_CNB = C.EVL_CMTR_CNB(+)
					AND A.CHR_DPT_CD = C.DPT_CD(+)
					GROUP BY A.CHGR_CNB, A.CHGR_DVSN_CD
				) A
			ORDER BY A.CHGR_DVSN_CD, A.CHGR_CNB
		]]>
	</select>

	<!-- 업무 목록 조회한다. -->
	<select id="CSPAOE032QsubSuppselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT 	
				  A.CHGR_DVSN_CD AS EVL_STEP_CD /*담당자구분코드*/
				, (SELECT CHGR_DVSN_NM FROM  TBCSPAOE016M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND CHGR_DVSN_CD = A.CHGR_DVSN_CD) AS EVL_STEP_NM /*담당자구분명*/
				, A.CHR_DPT_CD
				, F_DPT_INFO( A.CHR_DPT_CD, '1') AS DPT_NM      /*담당부서명*/
				, NVL(A.EVL_STA_CD, '100') AS EVL_STA_CD
				, F_CODE_NM('1000280', NVL(A.EVL_STA_CD, '100')) AS EVL_STA_NM  /*평가상태*/
			FROM	
				(
				/*CD01:자체평가자 - 지원부서 과장(각 부서마다 과장들이 있다)*/
				SELECT  
					  A.CHGR_CNB
					, A.CHGR_DVSN_CD
					, C.EVL_STA_CD
					, NVL(B.CHR_DPT_CD, A.BLT_DPT_CD) AS CHR_DPT_CD
					, SUM(CASE WHEN C.EVL_DTM_YN IS NULL OR EVL_DTM_YN = 'N' THEN 1 ELSE 0 END) AS NOCNT
					, SUM(CASE WHEN C.EVL_DTM_YN ='Y' THEN 1 ELSE 0 END) AS OKCNT
				FROM
					  TBCSPAOE017D A
					, (SELECT EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD
						 FROM TBCSPAOE026M
						WHERE EVL_YR = #strEvlYr#
						  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
						GROUP BY EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD
					)B
					, (SELECT EVL_YR
							  , HLYR_DVSN_CD
							  , EVL_DTM_YN
							  , EVL_CMTR_CNB
							  , EVL_CMTR_DVSN_CD
							  , EVL_STA_CD
						 FROM TBCSPAOE031M
						WHERE EVL_CMTR_DVSN_CD = 'CD01'
						  AND EVL_YR = #strEvlYr# 
						  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
						GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_CNB, EVL_CMTR_DVSN_CD, EVL_STA_CD
					) C
				WHERE 1 = 1
				AND A.EVL_YR = B.EVL_YR(+)
				AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD(+)
				AND A.BLT_DPT_CD = CHR_DPT_CD(+)
				AND A.EVL_YR = C.EVL_YR(+)
				AND A.HLYR_DVSN_CD = C.HLYR_DVSN_CD(+)
				AND A.CHGR_DVSN_CD = C.EVL_CMTR_DVSN_CD(+)
				AND A.CHGR_CNB = C.EVL_CMTR_CNB(+)
				AND A.EVL_YR = #strEvlYr# 
				AND A.HLYR_DVSN_CD = #strHlyrDvsnCd#
				AND A.TSK_DVSN_CD = '10002'
				AND A.CHGR_DVSN_CD = 'CD01'
				GROUP BY A.CHGR_CNB, A.CHGR_DVSN_CD, C.EVL_STA_CD, NVL(B.CHR_DPT_CD, A.BLT_DPT_CD)
				
				UNION ALL
				
				/*CD02:상급자평가 - 지원부서 국장이기 때문에 국장의 부서코드는 업코드가 들어가있으므로 하위 부서코드를 가져와야한다.*/
				SELECT 
					  A.CHGR_CNB
					, A.CHGR_DVSN_CD
					, C.EVL_STA_CD
					, B.CHR_DPT_CD
					, SUM(CASE WHEN C.EVL_DTM_YN IS NULL OR EVL_DTM_YN = 'N' THEN 1 ELSE 0 END) AS NOCNT
					, SUM(CASE WHEN C.EVL_DTM_YN = 'Y' THEN 1 ELSE 0 END) AS OKCNT
				FROM
					  TBCSPAOE017D A
					, (SELECT EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD
						 FROM TBCSPAOE026M
						WHERE EVL_YR = #strEvlYr#
						  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
						GROUP BY EVL_YR, HLYR_DVSN_CD,CHR_DPT_CD
					)B
					, (SELECT EVL_YR
							  , HLYR_DVSN_CD
							  , EVL_DTM_YN
							  , EVL_CMTR_CNB
							  , EVL_CMTR_DVSN_CD
							  , EVL_STA_CD
						 FROM TBCSPAOE031M
						WHERE EVL_CMTR_DVSN_CD = 'CD02'
						  AND EVL_YR = #strEvlYr# 
						  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
						GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_CNB, EVL_CMTR_DVSN_CD, EVL_STA_CD
					) C
				WHERE 1 = 1
				AND A.EVL_YR = B.EVL_YR(+)
				AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD(+)
				AND SUBSTR(A.BLT_DPT_CD, 1 ,3) = SUBSTR(CHR_DPT_CD(+), 1 ,3)
				AND A.EVL_YR = C.EVL_YR(+)
				AND A.HLYR_DVSN_CD = C.HLYR_DVSN_CD(+)
				AND A.CHGR_DVSN_CD = C.EVL_CMTR_DVSN_CD(+)
				AND A.CHGR_CNB = C.EVL_CMTR_CNB(+)
				AND A.EVL_YR = #strEvlYr# 
				AND	A.HLYR_DVSN_CD = #strHlyrDvsnCd#
				AND	A.TSK_DVSN_CD = '10002'
				AND	A.CHGR_DVSN_CD = 'CD02'
				GROUP BY A.CHGR_CNB, A.CHGR_DVSN_CD, C.EVL_STA_CD, B.CHR_DPT_CD
				
				UNION ALL
				
				/*CD03:지원부서 평가위원 - 부서코드랑 연결할 필요가 없다. 이사람들은 원장, 차장 이런사람들이라서..*/
				SELECT  
					  A.CHGR_CNB
					, A.CHGR_DVSN_CD
					, C.EVL_STA_CD
					, A.CHR_DPT_CD
					, SUM(CASE WHEN C.EVL_DTM_YN IS NULL OR EVL_DTM_YN = 'N' THEN 1 ELSE 0 END) AS NOCNT
					, SUM(CASE WHEN C.EVL_DTM_YN = 'Y' THEN 1 ELSE 0 END) AS OKCNT
				FROM
					(SELECT 
						  A.EVL_YR
						, A.HLYR_DVSN_CD
						, A.CHGR_CNB
						, A.CHGR_DVSN_CD
						, B.CHR_DPT_CD
					FROM 
						  TBCSPAOE017D A
						, (SELECT EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD
					         FROM TBCSPAOE026M
					        WHERE EVL_YR = #strEvlYr#
					          AND HLYR_DVSN_CD = #strHlyrDvsnCd#
					        GROUP BY EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD) B
					WHERE 1 = 1
					AND A.EVL_YR = B.EVL_YR 
					AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD 
					AND A.EVL_YR = #strEvlYr#
					AND A.HLYR_DVSN_CD = #strHlyrDvsnCd#
					AND A.TSK_DVSN_CD = '10002'
					AND A.CHGR_DVSN_CD = 'CD03'
					) A
					, (SELECT EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_DVSN_CD, EVL_CMTR_CNB, DPT_CD, EVL_STA_CD
					     FROM TBCSPAOE031M
					    WHERE EVL_CMTR_DVSN_CD = 'CD03'
					      AND EVL_YR = #strEvlYr# 
					      AND HLYR_DVSN_CD = #strHlyrDvsnCd#
					    GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_DTM_YN, EVL_CMTR_DVSN_CD, EVL_CMTR_CNB, DPT_CD, EVL_STA_CD
					) C
				WHERE 1 = 1
				AND A.EVL_YR = C.EVL_YR(+)
				AND A.HLYR_DVSN_CD = C.HLYR_DVSN_CD(+)
				AND A.CHGR_CNB = C.EVL_CMTR_CNB(+)
				AND A.CHR_DPT_CD = C.DPT_CD(+)
				GROUP BY A.CHGR_CNB, A.CHGR_DVSN_CD, A.CHR_DPT_CD, C.EVL_STA_CD
				) A
			WHERE  1 = 1
			AND A.CHGR_DVSN_CD = #strEvlDvsnCd#
			AND A.CHGR_CNB = #strEvlCmtrCnb# /*평가위원 전산번호*/
			AND NVL(A.EVL_STA_CD, '100') IN ('100', '200') /*평가상태코드가 100인 미확인인것만 조회한다.*/
			ORDER BY A.CHR_DPT_CD
		]]>
	</select>

	<!-- 운영직업무 탭 -->
	<!-- 담당자 정보 조회한다. -->
	<select id="CSPAOE032QmainRunselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[
			SELECT MAN.EVL_GP_NM                                                     AS CHGR_DVSN_NM /*평가군명*/
			     , F_USR_INFO(MAN.EVLT_CNB, '2')                                     AS NAM          /*담당자명*/
			     , SUM(DECODE( NVL(EVL.EVL_STA_CD, 0), 0, 1, '100', 1, '200', 1, 0))           AS COFM_N       /*미확인 건수*/
			     , SUM(DECODE(EVL.EVL_STA_CD, '300', 1, 0))                          AS COFM_Y       /*확인완료건수*/
			     , SUM(DECODE( NVL(EVL.EVL_STA_CD, 0), 0, 1, '100', 1, '200', 1, '300', 1, 0)) AS COFM_ALL     /*합계건수*/ 
			     , MAX(MAN.EVL_YR)                                                   AS EVL_YR       /*평가년도*/
			     , MAX(MAN.HLYR_DVSN_CD)                                             AS HLYR_DVSN_CD /*반기구분코드*/
			     , MAN.EVL_GP_CD                                                     AS CHGR_DVSN_CD /*평가군코드*/
			     , MAN.EVLT_CNB                                                      AS CHGR_CNB     /*담당자 전산번호*/
			  FROM (
			   SELECT D6.EVL_YR
			        , D6.HLYR_DVSN_CD
			        , D6.EVL_GP_CD
			        , D6.EVL_GP_NM
			        , D6.EVLT_CNB  /*평가자 전산번호*/
			        , D7.NEVLT_CNB /*피평가자 전산번호*/
			      FROM (
			        SELECT D4.EVL_YR
			             , D4.HLYR_DVSN_CD
			             , D4.EVL_GP_CD
			             , D4.EVL_GP_NM
			             , D4.EVLT_CNB   /*평가자 전산번호*/
			             , D4.BLT_DPT_CD /*평가자 소속부서코드*/
			          FROM (
			            SELECT D2.EVL_YR
			                 , D2.HLYR_DVSN_CD
			                 , D2.EVL_GP_CD
			                 , D1.EVL_GP_NM
			                 , D2.EVLT_CNB   /*평가자 전산번호*/
			                 , D2.BLT_DPT_CD /*평가자 소속부서코드*/
			              FROM TBCSPAOE018M D1
			                 , TBCSPAOE019D D2
			             WHERE D1.EVL_YR       = D2.EVL_YR
			               AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			               AND D1.EVL_GP_CD    = D2.EVL_GP_CD 
			               AND D2.EVL_YR       = #strEvlYr#
			               AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			            ) D4
			            , TBDCMACM002M D5
			        WHERE D4.BLT_DPT_CD = D5.DPT_CD
			          AND D5.USE_YN     = 'Y'
			        ) D6
			        , TBCSPAOE020D D7
			    WHERE D6.EVL_YR       = D7.EVL_YR
			      AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD
			      AND D6.EVL_GP_CD    = D7.EVL_GP_CD			      
			    ) MAN /*운영직업무 평가자 리스트*/
			    , (
			        SELECT EVL_YR
			             , HLYR_DVSN_CD
			             , NEVLT_CNB
			             , EVL_CMTR_CNB
			             , MIN(EVL_STA_CD)       AS EVL_STA_CD
			             , MIN(EVL_CMTR_DVSN_CD) AS EVL_CMTR_DVSN_CD
			             , MIN(TSK_DVSN_CD)      AS TSK_DVSN_CD
			          FROM TBCSPAOE032M
			         WHERE EVL_YR       = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			         GROUP BY EVL_YR, HLYR_DVSN_CD, NEVLT_CNB, EVL_CMTR_CNB   
			    ) EVL
			WHERE MAN.EVL_YR          = EVL.EVL_YR           (+)
			  AND MAN.HLYR_DVSN_CD    = EVL.HLYR_DVSN_CD     (+)
			  AND MAN.NEVLT_CNB       = EVL.NEVLT_CNB        (+)
			  AND MAN.EVLT_CNB        = EVL.EVL_CMTR_CNB     (+)
			  AND MAN.EVL_GP_CD       = EVL.EVL_CMTR_DVSN_CD (+)
			  AND EVL.TSK_DVSN_CD (+) = '10003' /*운영직업무*/
			GROUP BY MAN.EVL_GP_CD, MAN.EVL_GP_NM, MAN.EVLT_CNB
		]]>
	</select>

	<!-- 피평가자 목록 조회한다. -->
	<select id="CSPAOE032QsubRunselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
			SELECT F_DPT_INFO(MAN.BLT_DPT_CD, '1')                  AS DPT_NM     /*피평가자 소속부서 코드*/
			     , F_CODE_NM('1000173', MAN.RANK_CD)                AS RANK_NM    /*피평가자 직급 코드*/
			     , F_USR_INFO(MAN.NEVLT_CNB, '2')                   AS EVLT_NAM   /*피평가자 성명*/
			     , F_CODE_NM('1000280', NVL(EVL.EVL_STA_CD, '100')) AS EVL_STA_NM /*평가상태*/
			  FROM (
			   SELECT D6.EVL_YR
			        , D6.HLYR_DVSN_CD
			        , D6.EVL_GP_CD
			        , D6.EVL_GP_NM
			        , D6.EVLT_CNB  /*평가자 전산번호*/
			        , D7.NEVLT_CNB /*피평가자 전산번호*/
			        , (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = D7.NEVLT_CNB) AS BLT_DPT_CD
			        , D7.RANK_CD   /*피평가자 직급*/
			      FROM (
			        SELECT D4.EVL_YR
			             , D4.HLYR_DVSN_CD
			             , D4.EVL_GP_CD
			             , D4.EVL_GP_NM
			             , D4.EVLT_CNB   /*평가자 전산번호*/
			             , D4.BLT_DPT_CD /*평가자 소속부서코드*/
			          FROM (
			            SELECT D2.EVL_YR
			                 , D2.HLYR_DVSN_CD
			                 , D2.EVL_GP_CD
			                 , D1.EVL_GP_NM
			                 , D2.EVLT_CNB   /*평가자 전산번호*/
			                 , D2.BLT_DPT_CD /*평가자 소속부서코드*/
			              FROM TBCSPAOE018M D1
			                 , TBCSPAOE019D D2
			             WHERE D1.EVL_YR       = D2.EVL_YR
			               AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			               AND D1.EVL_GP_CD    = D2.EVL_GP_CD 
			               AND D2.EVL_YR       = #strEvlYr#
			               AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			            ) D4
			            , TBDCMACM002M D5
			        WHERE D4.BLT_DPT_CD = D5.DPT_CD
			          AND D5.USE_YN     = 'Y'
			        ) D6
			        , TBCSPAOE020D D7
			    WHERE D6.EVL_YR       = D7.EVL_YR
			      AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD
			      AND D6.EVL_GP_CD    = D7.EVL_GP_CD
			  ) MAN
			    , (
			        SELECT EVL_YR
			             , HLYR_DVSN_CD
			             , NEVLT_CNB
			             , EVL_CMTR_CNB
			             , MIN(EVL_STA_CD)       AS EVL_STA_CD
			             , MIN(EVL_CMTR_DVSN_CD) AS EVL_CMTR_DVSN_CD
			             , MIN(TSK_DVSN_CD)      AS TSK_DVSN_CD
			          FROM TBCSPAOE032M
			         WHERE EVL_YR       = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			         GROUP BY EVL_YR, HLYR_DVSN_CD, NEVLT_CNB, EVL_CMTR_CNB   
			    ) EVL 
			WHERE MAN.EVL_YR                 = EVL.EVL_YR (+)
			  AND MAN.HLYR_DVSN_CD           = EVL.HLYR_DVSN_CD (+)
			  AND MAN.NEVLT_CNB              = EVL.NEVLT_CNB  (+)
			  AND MAN.EVLT_CNB               = EVL.EVL_CMTR_CNB (+)
			  AND MAN.EVL_GP_CD              = EVL.EVL_CMTR_DVSN_CD (+)
			  AND MAN.EVL_GP_CD              = #strEvlDvsnCd#  /*평가군코드*/
			  AND MAN.EVLT_CNB               = #strEvlCmtrCnb# /*평가자 전산번호*/
			  AND EVL.TSK_DVSN_CD (+)        = '10003' /*운영직업무*/
			  AND NVL(EVL.EVL_STA_CD, '100') IN ('100', '200') /*평가상태코드가 100인 미확인인것만 조회한다.*/
			ORDER BY MAN.BLT_DPT_CD /*2015.02.04 최원형 감사관 요청*/
		]]>
	</select>
	<!-- ##################################### 업무별 평가진행상황 탭 끝 (CSPAOE032Q) ##################################### -->

	<!-- ##################################### 감사자료 입력검증 시작 (CSPAOE037Q) ##################################### -->

	<!-- 감사자료 입력검증 조회한다. -->
	<select id="CSPAOE037Qmainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
		    SELECT NVL(F_MNG_KND_AUDYRNO(D3.AUD_YR, D3.TSK_NO, D5.AUD_KND_CD, '-'),D3.AUD_YR || '-' || D3.TSK_NO)       AS EVL_YR_NO    /*감사연번호*/  
		         , D3.AUD_SBJ_NM                                        /*감사사항명*/ 
		         , F_CODE_NM('1000270', D3.AUD_KND_CD)  AS AUD_KND_NM   /*감사종류*/
		         , D3.MNDY_CNT                                          /*연인원*/
		         , F_CODE_NM('1000273', D3.AUD_STEP_CD) AS AUD_STEP_NM  /*감사단계*/ 
		         , D3.RMK_1_YN                                          /*지적,문제*/
		         , D3.RMK_2_YN                                          /*성과,기대*/
		         , D3.RMK_3_YN                                          /*애로,특기기여도사유*/
		         , D4.DOC_ID                                            /*첨부파일 아이디*/     
		         , D4.DOC_TYP_CD
		         , D4.DOC_NM                                            /*첨부파일 명*/      
                 , D3.AUD_STEP_CD 
                 , F_DPT_INFO(D3.HNDL_DIV_DPT_CD, '1')   AS HNDL_DIV_DPT_NM /*처리과부서명 2015.02.04 최원형감사관 요청*/
		      FROM ( 
		        SELECT D1.AUD_YR
		             , D1.TSK_NO     
		             , D1.AUD_SBJ_NM                                        
		             , D1.AUD_KND_CD  
		             , D1.MNDY_CNT                                         
		             , D2.AUD_STEP_CD AS AUD_STEP_CD
		             , DECODE(LENGTH(TRIM(D1.MAIN_INDC_SBJ_PRB_TXT)), 0, 'N', '', 'N', 'Y')                AS RMK_1_YN
		             , DECODE(LENGTH(TRIM(D1.MAIN_AUD_RSLT_EPT_EFCT_TXT)), 0, 'N', '', 'N', 'Y')           AS RMK_2_YN
		             , DECODE(LENGTH(TRIM(D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT)), 0, 'N', '', 'N', 'Y') AS RMK_3_YN
		             , D1.HNDL_DIV_DPT_CD
		         FROM (
                        SELECT AUD_YR
                            , TSK_NO
                            , MAX(AUD_STEP_CD) AS AUD_STEP_CD
                         FROM TBCSPAOE022M 
                        WHERE 1 = 1
                          AND CMPT_DT BETWEEN ( SELECT EVL_STR_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# ) 
                                          AND ( SELECT EVL_END_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# )
						 	                        
                          AND CMPT_DT IS NOT NULL                          
                        GROUP BY AUD_YR, TSK_NO 			         
		         ) D2
		         , TBCSPAOE021M D1
		        WHERE D2.AUD_YR       = D1.AUD_YR
		          AND D2.TSK_NO       = D1.TSK_NO
				]]>
					<isNotEmpty property="strAudKndCdList">
						AND D1.AUD_KND_CD = #strAudKndCdList#
					</isNotEmpty>
		        <![CDATA[ 			          
               ) D3
		    , (
                   SELECT AUD_YR
                        , TSK_NO
                        , DOC_ID
                        , DOC_TYP_CD
                        , '[' || F_CODE_NM('1000273', DECODE( DOC_TYP_CD, 'SP-OE-001', '10000', 'SP-OE-002', '10001', 'SP-OE-003', '10004', 'SP-OE-004', '10004', 'SP-OE-005', '10010', 'SP-OE-006', '10010', 'SP-OE-007', '10010')) || ']' || DOC_NM AS DOC_NM
                    FROM (
                      SELECT D6.FILE_NAME AS DOC_NM
                           , D5.AUD_YR
                           , D5.TSK_NO
                           , D5.DOC_ID
                           , D5.DOC_TYP_CD
                        FROM TBCSPAOE040M D5
                           , UBKERAPP.ECM_FILE_LIST_VIEW  D6
                       WHERE D5.DOC_ID = D6.DOC_ID
                       )
                   WHERE DOC_NM IS NOT NULL
               ) D4
               ,TBBADDED001M D5
		    WHERE D3.AUD_YR       = D4.AUD_YR         (+)
		      AND D3.TSK_NO       = D4.TSK_NO         (+)
		      AND D3.AUD_YR = D5.AUD_YR (+)
   				AND D3.TSK_NO = D5.AUD_NO (+)
   				]]>
						<isNotEmpty property="strAudYr">
							AND AUD_YR = #strAudYr#
						</isNotEmpty>
						<isNotEmpty property="strTskNo">
							AND CASE WHEN LENGTH(#strTskNo#) = 3 AND D5.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D3.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
						</isNotEmpty>
						<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
							D5.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1)
						</isNotEmpty>
			        <![CDATA[
		    ORDER BY D3.HNDL_DIV_DPT_CD, D3.AUD_YR, D3.TSK_NO DESC,  D3.AUD_STEP_CD    
			]]>
	</select>
	<!-- ##################################### 감사자료 입력검증 끝 (CSPAOE037Q) ##################################### -->

	<!-- ##################################### 감사외업무 평가관리 시작 (CSPAOE041E) ##################################### -->
	
	<!-- 온로드시 업무종류(공통업무 제외) -->
	<select id="CSPAOE055EKskKndCdListselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CD
			     , CD_NM
			  FROM TBDCMACM013C 
			 WHERE 1=1
			   AND CMM_CD_DVSN_CD = '1000272'
			   AND NVL(USE_YN, 'N') = 'Y'
			   AND CD != '10000' /*공통업무 제외*/
			   AND CD != '000000000'
		]]>
			<isNotEmpty property="CD_NM">
				AND CD_NM LIKE #CD_NM# || '%'
			</isNotEmpty>
		<![CDATA[ 
			 ORDER BY SUBSTR(CD_NM, 0, 4), OTPT_SEQ, CD
		]]>
	</select>
	
	<!-- 평가년도 반기구분에 따라 등록된 평가등급이 조회된다. -->
	<select id="CSPAOE046Echkselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT COUNT(NEVLT_CNB) AS ChkNevltCnb
			  FROM TBCSPAOE035M
			 WHERE 1 = 1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD = '10003'
			   AND AUD_YR = #EVL_YR#
			   AND TSK_NO = #TSK_NO#
			   AND NEVLT_CNB = #NEVLT_CNB#
		]]>
	</select>
	
	<update id="CSPAOE046EAvgPsnTskAscupdate" parameterClass="paramMap">
		<![CDATA[	
			UPDATE TBCSPAOE035M
			   SET PSN_TSK_ASC   = #PSN_TSK_ASC#
		   WHERE 1=1
		     AND EVL_YR          = #EVL_YR#
			 AND HLYR_DVSN_CD    = #HLYR_DVSN_CD#
			 AND TSK_DVSN_CD     = '10003'
			 AND AUD_TSK_KND_CD  = '10000'
			 AND TSK_NO          = #TSK_NO#
			 AND NEVLT_CNB       = #NEVLT_CNB#
		]]>
	</update>	
	
	<!-- 개인별 평점관리 테이블 신규 or 수정된 정보를 저장한다. -->
	<update id="CSPAOE041E046Confinsertupdate" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO TBCSPAOE035M
		    USING DUAL
			   ON (   
					    EVL_YR          = #EVL_YR#
					AND HLYR_DVSN_CD    = #HLYR_DVSN_CD#
					AND TSK_DVSN_CD     = #TSK_DVSN_CD#
					AND AUD_YR			= #EVL_YR#
					AND TSK_NO          = #TSK_NO#
					AND NEVLT_CNB       = #NEVLT_CNB#
					AND AUD_TSK_KND_CD  = #AUD_TSK_KND_CD#
			  	   )
			WHEN MATCHED  THEN 		
				UPDATE 
				   SET FNL_MDF_DH  = SYSDATE
		             , DPT_CD_1    = #DPT_CD_1#
		             , DPT_CD      = #DPT_CD#
		             , RANK_CD     = #RANK_CD#
		             , PSN_TSK_ASC = #PSN_TSK_ASC#
		             , EVLT_CNB = #EVLT_CNB#
		]]>
		<isNotEmpty prepend="," property="AUD_SPRT_ASC">
			AUD_SPRT_ASC = #AUD_SPRT_ASC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		<![CDATA[
            WHEN NOT MATCHED THEN 
				INSERT 
				    (
				       EVL_YR
					 , HLYR_DVSN_CD
					 , TSK_DVSN_CD
					 , AUD_YR
					 , TSK_NO
					 , NEVLT_CNB
					 , EVLT_CNB
					 , AUD_TSK_KND_CD
					 , DPT_CD_1
					 , DPT_CD
					 , RANK_CD
					 , PSN_TSK_ASC
				]]>
				<isNotEmpty prepend="," property="SPRT_CVS_ASC">
					SPRT_CVS_ASC
				</isNotEmpty>
				<![CDATA[					 
				 	 , FRT_USR_ID
				 	 , FNL_USR_ID
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID
					 , FRT_REGI_DH
					 , FNL_MDF_DH
					)  VALUES 
					(
				       #EVL_YR#
					 , #HLYR_DVSN_CD#
					 , #TSK_DVSN_CD#
					 , #EVL_YR#
					 , #TSK_NO#
					 , #NEVLT_CNB#
					 , #EVLT_CNB#
					 , #AUD_TSK_KND_CD#
					 , #DPT_CD_1#
					 , #DPT_CD# 
					 , #RANK_CD#
					 , #PSN_TSK_ASC#
				]]>
				<isNotEmpty prepend="," property="SPRT_CVS_ASC">
					#SPRT_CVS_ASC#
				</isNotEmpty>
				<![CDATA[	
					 , #FNL_USR_ID#
					 , #FNL_USR_ID#
					 , #FNL_DEAL_DPT_CD#
					 , #FNL_MNU_ID#
					 , SYSDATE
					 , SYSDATE	
					 )
		]]>
	</update>

	
	<!-- ##################################### 감사외업무 평가관리 끝 (CSPAOE041E) ##################################### -->

	<!-- ##################################### 지원업무 평가관리 끝 (CSPAOE042E) ##################################### -->
	<!-- 평가년도 반기구분에 따라 등록된 평가등급이 조회된다. -->
	<select id="CSPAOE042EEvlRkCdselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.RK_CD                       AS CD    /*등급코드*/
			     , F_CODE_NM('1000274', D1.RK_CD) AS CD_NM /* 등급명 */
			  FROM TBCSPAOE010D D1
                 , TBDCMACM013C D2
			 WHERE 1=1
			   AND D1.RK_CD = D2.CD
               AND D2.CD <> '000000000'
               AND D2.CMM_CD_DVSN_CD ='1000274'
               AND D2.USE_YN = 'Y'
               AND D1.EVL_YR         = #strEvlYr#
			   AND D1.HLYR_DVSN_CD   = #strHlyrDvsnCd#
			   AND D1.TSK_DVSN_CD    = '10002'  /*지원업무*/
			   AND D1.AUD_TSK_KND_CD = '10000' /*공통업무*/
			   AND D1.IDCT_YN = 'Y'
             ORDER BY D2.OTPT_SEQ, D2.CD 
		]]>
	</select>
	
	<!-- 지원부서 리스트만 가져온다 -->
	<select id="CSPAOE042EDeptCdListselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.DEPT_CD 
			     , D1.DEPT_NM || DECODE(EVL_STA_NM, '', ' (미평가)', ' ( '|| EVL_STA_NM || ')' ) AS DEPT_NM
			     , D1.UP_DEPT_CD
			  FROM (
                 SELECT D4.DPT_CD  AS DEPT_CD 
                      , D4.DPT_NM  AS DEPT_NM
                      , DECODE(D4.DPT_CD,'141000','141000','121000','121000','122000','122000','200110','200010','200100','200010','200120','200010', NVL(D4.HIRK_DPT_CD, D4.DPT_CD)) AS UP_DEPT_CD
                   FROM (
                    SELECT CHR_DPT_CD      
                      FROM TBCSPAOE026M 
                      WHERE EVL_YR      = #strEvlYr#
                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                     GROUP BY CHR_DPT_CD
                      ) D3
                      , TBDCMACM002M D4
                WHERE D3.CHR_DPT_CD = D4.DPT_CD 
			 ) D1 
			 , (
			     SELECT F_CODE_NM('1000280', NVL(EVL_STA_CD, '100')) AS EVL_STA_NM
			         , EVL_STA_CD
			         , DPT_CD
			      FROM TBCSPAOE031M
			     WHERE EVL_YR       = #strEvlYr#
			       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			       AND EVL_STEP_CD  = #strEvlStepCd#
		]]>
		
		
			<isNotEmpty property="strEvlCmtrCnb">
				AND EVL_CMTR_CNB = #strEvlCmtrCnb#
			</isNotEmpty>
		<![CDATA[			       
			     GROUP BY DPT_CD, EVL_STA_CD 
			 ) D2
			 , (SELECT BLT_DPT_CD
		          FROM TBCSPAOE017D
		         WHERE EVL_YR = #strEvlYr#
	               AND HLYR_DVSN_CD = #strHlyrDvsnCd#
	               AND TSK_DVSN_CD = '10002'
		]]>
			<isNotEmpty property="strEvlCmtrCnb">
	               AND CHGR_CNB = #strEvlCmtrCnb#
	        </isNotEmpty>
		<![CDATA[	
	         ) D3
	         
			]]>
	         
			WHERE D1.DEPT_CD = D2.DPT_CD(+)
			<isEqual property="strEvlStepCd" compareValue="300">
			  AND D1.DEPT_CD = D3.BLT_DPT_CD
			</isEqual>
			<isEqual property="strEvlStepCd" compareValue="400">
			  AND D1.UP_DEPT_CD = D3.BLT_DPT_CD
			  AND D1.DEPT_CD IN  (
					SELECT 	DPT_CD
		           	FROM 	TBCSPAOE031M
		           	WHERE 	EVL_YR = #strEvlYr#
		           	AND 	HLYR_DVSN_CD = #strHlyrDvsnCd#
		           	AND 	EVL_STEP_CD = '300'
		           	AND 	EVL_STA_CD = '300'
			)
			</isEqual>
			<isEqual property="strEvlStepCd" compareValue="500">
				AND D1.DEPT_CD IN  (
					SELECT 	DPT_CD
		           	FROM 	TBCSPAOE031M
		           	WHERE 	EVL_YR = #strEvlYr#
		           	AND 	HLYR_DVSN_CD = #strHlyrDvsnCd#
		           	AND 	EVL_STEP_CD = '400'
		           	AND 	EVL_STA_CD = '300'
			)
			</isEqual>
			<![CDATA[	  
			ORDER BY NVL(D2.EVL_STA_CD, '100'),  D1.DEPT_CD
		]]>
	</select>
	
	<!-- 지원부서 리스트만 가져온다 (관리자일경우) -->
	<select id="CSPAOE042EDeptCdCancleListselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.DEPT_CD 
			     , D1.DEPT_NM || DECODE(EVL_STA_NM, '', ' (미평가)', EVL_STA_NM ) AS DEPT_NM
			     , D1.UP_DEPT_CD
			  FROM (
                 SELECT D4.DPT_CD  AS DEPT_CD 
                      , D4.DPT_NM  AS DEPT_NM
                      , DECODE(D4.DPT_CD,'141000','141000','121000','121000','122000','122000','200110','200010','200120','200010','200100','200010', NVL(D4.HIRK_DPT_CD, D4.DPT_CD)) AS UP_DEPT_CD
                   FROM (
                    SELECT CHR_DPT_CD      
                      FROM TBCSPAOE026M 
                      WHERE EVL_YR      = #strEvlYr#
                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                     GROUP BY CHR_DPT_CD
                      ) D3
                      , TBDCMACM002M D4
                WHERE D3.CHR_DPT_CD = D4.DPT_CD 
			 ) D1
			 , (
            SELECT BASE.EVL_YR
                 , BASE.HLYR_DVSN_CD
                 , BASE.CHR_DPT_CD
                 , DECODE( SUM(DECODE(EVL.EVL_STA_CD, '300', '', '200', 1, '100', 0, 0)), '', 99, 0, 55, 77) AS EVL_STA_CD
                 , DECODE( SUM(DECODE(EVL.EVL_STA_CD, '300', '', '200', 1, '100', 0, 0)), '', '(평가완료)', 0, '(미평가)', '(평가중)') AS EVL_STA_NM
              FROM (
                SELECT EVLDPT.EVL_YR
                     , EVLDPT.HLYR_DVSN_CD
                     , EVLDPT.CHR_DPT_CD
                     , EVLMAN.CHGR_CNB
                  FROM (
                    SELECT EVL_YR
                         , HLYR_DVSN_CD
                         , CHR_DPT_CD
                      FROM TBCSPAOE026M
                     WHERE EVL_YR       = #strEvlYr#
                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                     GROUP BY EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD
                  ) EVLDPT /*평가받을 부서*/
                  , (
                    SELECT EVL_YR
                         , HLYR_DVSN_CD
                         , CHGR_CNB
                      FROM TBCSPAOE017D
                     WHERE EVL_YR       = #strEvlYr#
                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                       AND TSK_DVSN_CD  = '10002'
                       AND CHGR_DVSN_CD = 'CD03'  
                  ) EVLMAN /*위원평가자 리스트*/
                WHERE EVLDPT.EVL_YR = EVLMAN.EVL_YR
                  AND EVLDPT.HLYR_DVSN_CD = EVLMAN.HLYR_DVSN_CD
              ) BASE 
              , (
                SELECT EVL_YR
                     , HLYR_DVSN_CD
                     , DPT_CD
                     , EVL_CMTR_CNB
                     , EVL_STA_CD
                 FROM TBCSPAOE031M
                WHERE EVL_YR       = #strEvlYr#
                  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                  AND EVL_STEP_CD  = '500'
                GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD, EVL_CMTR_CNB, EVL_STA_CD  
              ) EVL
            WHERE BASE.EVL_YR       = EVL.EVL_YR
              AND BASE.HLYR_DVSN_CD = EVL.HLYR_DVSN_CD 
              AND BASE.CHR_DPT_CD   = EVL.DPT_CD
              AND BASE.CHGR_CNB     = EVL.EVL_CMTR_CNB
            GROUP BY  BASE.EVL_YR, BASE.HLYR_DVSN_CD, BASE.CHR_DPT_CD 
			 ) D2
			WHERE D1.DEPT_CD = D2.CHR_DPT_CD (+)
			ORDER BY NVL(D2.EVL_STA_CD, 55),  D1.DEPT_CD
		]]>
	</select>

	<!-- 자체평가 탭 시작 -->
	<!-- 상단그리드 조회 -->
	<select id="CSPAOE042EmainFselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D3.EVL_YR                          AS EVL_YR       /* 평가년도 */
			     , D3.HLYR_DVSN_CD                    AS HLYR_DVSN_CD /* 반기구분코드 */
			     , D3.CHR_DPT_CD                      AS DPT_CD       /* 부서코드 */
			     , D3.PTCPT_DPT_CD
			     , D3.TSK_NO                          AS TSK_NO       /* 업무번호 */
			     , DECODE(ROW_N , 1, D3.TSK_NM , '')  AS TSK_NM       /* 업무명 */
			     , DECODE(ROW_N , 1, D3.WGT_RTE , '') AS WGT_RTE      /*비중*/
			     , F_USR_INFO(D3.PTCPT_CNB, '2')      AS NAM          /*성명*/
			     , D3.CTB_RTE                         AS CTB_RTE      /*기여율*/
			     , D3.TSK_TXT                         AS TSK_TXT      /*업무내용상세*/
			     , D5.EVL_OPIN                        AS EVL_OPIN     /*자체평가의견*/
			     , NVL(D5.EVL_STA_CD, '100')          AS EVL_STA_CD   /*널이면 평가상태코드가 미평가다.*/
			     , NVL(D5.EVL_RK_CD, '600')           AS EVL_RK_CD    /*지원업무는 평가등급이 보통이다. */
			     , D3.PTCPT_CNB                       AS NEVLT_CNB    /*참여자 전산번호*/
			     , ROW_N                              AS ROW_N        /*이게 1인것만 비중컬럼 활성화*/
			     , #strEvlCmtrCnb#                    AS EVL_CMTR_CNB /*평가위원 전산번호(로그인한사람)*/
			     , F_CODE_NM('1000280', NVL(D5.EVL_STA_CD, '100'))  AS EVL_STA_NM  /*평가상태*/
			     , DENSE_RANK() OVER(PARTITION BY D3.EVL_YR ORDER BY D3.TSK_NO) AS RANK_NUM
			     , MOD(DENSE_RANK() OVER(PARTITION BY D3.EVL_YR ORDER BY D3.TSK_NO) , 2) AS BACK_GROUD_NUM /*백그라운드 색깔 주기 위해서*/
			  FROM (
			    SELECT D1.EVL_YR
			         , D1.HLYR_DVSN_CD
			         , D1.CHR_DPT_CD
			         , D2.CHR_DPT_CD AS PTCPT_DPT_CD
			         , D1.TSK_NO
			         , D1.TSK_TXT
			         , D2.PTCPT_CNB /*참여자 전산번호*/
			         , D2.CTB_RTE
			         , D1.TSK_NM  
			         , D1.WGT_RTE
			         , ROW_NUMBER() OVER(PARTITION BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.TSK_NO ORDER BY NVL(D3.INN_RANK_CD,'50'), D3.RANK_SRT_SEQ_NM, D3.CRNT_RANK_APM_DT, D3.SRT_KY_NO, D3.CRNT_DPT_APM_DT, D3.EIN) AS ROW_N
			         /*로우넘버를 한 이유 : 여러로우가 나와도 중복된 데이터는 맨 윗줄만 나오고 나머진 널로 처리해야해서.*/
			      FROM TBCSPAOE026M D1
			         , TBCSPAOE027M D2
			         , TBDCMACM001M D3
			    WHERE D1.EVL_YR       = D2.EVL_YR
			      AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			      AND D2.PTCPT_CNB = D3.CNB
			      ]]>
			      <isNotEqual property="strDeptCd" compareValue="141000">
			      		
			      		<isEqual property="strDeptCd" compareValue="121000">
				      		AND SUBSTR(D1.CHR_DPT_CD, 0, 3)   = SUBSTR(D2.CHR_DPT_CD, 0, 3)
				      	</isEqual>
				      	<isNotEqual property="strDeptCd" compareValue="121000">
				      		<isEqual property="strDeptCd" compareValue="122000">
					      		AND SUBSTR(D1.CHR_DPT_CD, 0, 3)   = SUBSTR(D2.CHR_DPT_CD, 0, 3)
					      		AND D2.CHR_DPT_CD IN ('122100','122200','122300','122400','122000')
					      	</isEqual>
					      	<isNotEqual property="strDeptCd" compareValue="122000">
					      		AND D1.CHR_DPT_CD   = D2.CHR_DPT_CD
					      	</isNotEqual>
				      	</isNotEqual>
			      </isNotEqual>
			      <isEqual property="strDeptCd" compareValue="141000">
			      		AND SUBSTR(D1.CHR_DPT_CD, 0, 3)   = SUBSTR(D2.CHR_DPT_CD, 0, 3)
			      </isEqual>
			      <![CDATA[  
			      AND D1.TSK_NO       = D2.TSK_NO
			      AND D1.EVL_YR       = #strEvlYr#
			      AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			      AND D1.CHR_DPT_CD   = #strDeptCd#
			  ) D3 /*지원업무 참여인원및 기여율*/
			  , TBCSPAOE031M D5
			WHERE D3.EVL_YR                 = D5.EVL_YR (+)
			  AND D3.HLYR_DVSN_CD           = D5.HLYR_DVSN_CD (+)
			  AND D5.EVL_STEP_CD  (+)       = '300' /*평가단계코드*/
			  AND D3.CHR_DPT_CD             = D5.DPT_CD (+)
			  AND D3.TSK_NO                 = D5.TSK_NO (+)
			  AND D5.EVL_CMTR_DVSN_CD  (+)  = 'CD01' /*자체평가자 코드*/
			  /* AND D5.EVL_CMTR_CNB (+)  = strEvlCmtrCnb 로그인한 평가자의 전산번호- 자체평가자는 부서별로 한명씩 있기 때문에 전산번호는 필요 없다.*/
   		]]>
		<![CDATA[
			ORDER BY TSK_NO, ROW_N 
		]]>
	</select>

	<!-- 자체평가에서 상급자 평가로 갈수 있는지 체크 , 평가자가 평가를 다 했어야지만 넘어간다. -->
	<!-- 자체평가 평가자가 확정을 했는가? 0일땐 모두 확정한거임. // Y인걸 0점 -->
	<select id="CSPAOE042EnextTapYnFselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT TO_CHAR(SUM(DECODE(NVL(EVL_DTM_YN, 'N'), 'Y', 0, 1))) AS EVL_DTM_YN 
			  FROM (
			    SELECT D1.EVL_YR
			         , D1.HLYR_DVSN_CD
			         , D1.TSK_NO
			         , D3.CHGR_DVSN_CD
			         , '300' AS EVL_STEP_CD /*자체평가*/
			         , D3.CHGR_CNB
			         , D1.CHR_DPT_CD
			      FROM TBCSPAOE026M D1
			         , (
			            SELECT EVL_YR
			                 , HLYR_DVSN_CD
			                 , CHR_DPT_CD
			                 , TSK_NO
			              FROM TBCSPAOE027M
			             WHERE EVL_YR      = #strEvlYr#
			              AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			            GROUP BY EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD, TSK_NO         
			         ) D2
			         , TBCSPAOE017D D3
			    WHERE D1.EVL_YR         = D2.EVL_YR
			      AND D1.HLYR_DVSN_CD   = D2.HLYR_DVSN_CD
			      AND D1.CHR_DPT_CD     = D2.CHR_DPT_CD
			      AND D1.TSK_NO         = D2.TSK_NO
			      AND D1.EVL_YR         = D3.EVL_YR
			      AND D1.HLYR_DVSN_CD   = D3.HLYR_DVSN_CD
			      AND D3.TSK_DVSN_CD    = '10002' /*지원업무*/
			      AND D3.AUD_TSK_KND_CD = '10000' /*공통*/
			      AND D1.CHR_DPT_CD     = D3.BLT_DPT_CD 
			      AND D1.EVL_YR         = #strEvlYr#
			      AND D1.HLYR_DVSN_CD   = #strHlyrDvsnCd#
			      AND D3.CHGR_DVSN_CD   = 'CD01' /*CD01:자체평가자 - 지원부서 과장(각 부서마다 과장들이 있다)*/
			    ) EVAL
			    , TBCSPAOE031M D3     
			WHERE EVAL.EVL_YR       = D3.EVL_YR (+)
			  AND EVAL.HLYR_DVSN_CD = D3.HLYR_DVSN_CD (+)
			  AND EVAL.EVL_STEP_CD  = D3.EVL_STEP_CD (+)
			  AND EVAL.TSK_NO       = D3.TSK_NO (+)
			  AND EVAL.CHGR_CNB     = D3.EVL_CMTR_CNB (+)
			  AND EVAL.CHGR_DVSN_CD = D3.EVL_CMTR_DVSN_CD (+)
			  AND EVAL.CHR_DPT_CD   = D3.DPT_CD (+)
		]]>
	</select>

	<!-- 자체평가자가 확정취소를 할 수 있는가 0이상이면 상급자평가자가 한명이라도 확정을 한거다. -->
	<!-- 상급자평가 탭에서 위원평가 탭으로 이동할수 있는가? 0이면 모두다 확정을 했으므로 위원평가 탭으로 이동 가능. -->
	<select id="CSPAOE042EEvlDtmYnFselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT NVL(TO_CHAR(SUM(DECODE(NVL(EVL_DTM_YN, 'N'), #strEvlDtmYn#, 0, 1))), 0) AS EVL_DTM_YN
			  FROM (
			    SELECT D3.EVL_YR
			         , D3.HLYR_DVSN_CD
			         , D3.TSK_NO
			         , D4.CHGR_DVSN_CD
			         , '400' AS EVL_STEP_CD /*상급자평가*/
			         , D4.CHGR_CNB
			         , D3.CHR_DPT_CD
			      FROM TBCSPAOE026M D3
          			 , (
 			            SELECT EVL_YR
			                 , HLYR_DVSN_CD
			                 , CHR_DPT_CD
			                 , TSK_NO
			              FROM TBCSPAOE027M
			             WHERE EVL_YR       = #EVL_YR#
			               AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			             GROUP BY EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD, TSK_NO           
					) D5	/*참여인원이 있는경우 경우만 뽑아내기 위해서.*/		      
			         , (
			            SELECT D2.HIRK_DPT_CD
			                 , D2.DPT_CD
			                 , D1.CHGR_CNB
			                 , D1.EVL_YR
			                 , D1.HLYR_DVSN_CD
			                 , D1.TSK_DVSN_CD
			                 , D1.CHGR_DVSN_CD
			             FROM TBCSPAOE017D D1
			                , TBDCMACM002M D2
			            WHERE D1.BLT_DPT_CD   = D2.HIRK_DPT_CD
			              AND D1.CHGR_DVSN_CD = 'CD02'
			              AND D1.EVL_YR       = #EVL_YR#
			              AND D1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
			              AND D2.USE_YN       = 'Y'             
			         ) D4
			    WHERE D3.EVL_YR       = D5.EVL_YR
			      AND D3.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
			      /*AND D3.CHR_DPT_CD   = D5.CHR_DPT_CD 20160525*/
			      AND D3.TSK_NO       = D5.TSK_NO
			      AND D3.EVL_YR       = D4.EVL_YR
			      AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
			      AND D4.TSK_DVSN_CD  = '10002' /*지원업무*/
			      AND D3.CHR_DPT_CD   = D4.DPT_CD
			      AND D3.EVL_YR       = #EVL_YR#
			      AND D3.HLYR_DVSN_CD = #HLYR_DVSN_CD#
			      AND D4.CHGR_DVSN_CD = 'CD02' /*CD02:상급자평가 - 지원부서 국장이기 때문에 국장의 부서코드는 업코드가 들어가있으므로 하위 부서코드를 가져와야한다.*/
			      ) EVAL
			    , TBCSPAOE031M D3     
			WHERE EVAL.EVL_YR       = D3.EVL_YR (+)
			  AND EVAL.HLYR_DVSN_CD = D3.HLYR_DVSN_CD (+)
			  AND EVAL.EVL_STEP_CD  = D3.EVL_STEP_CD (+)
			  AND EVAL.TSK_NO       = D3.TSK_NO (+)
			  AND EVAL.CHGR_CNB     = D3.EVL_CMTR_CNB (+)
			  AND EVAL.CHGR_DVSN_CD = D3.EVL_CMTR_DVSN_CD (+)
			  AND EVAL.CHR_DPT_CD   = D3.DPT_CD (+)
			  ]]>
		      <isNotEqual property="DPT_CD" compareValue="141000">
			  		<isEqual property="DPT_CD" compareValue="121000">
			      		AND SUBSTR(EVAL.CHR_DPT_CD, 0 ,3) = SUBSTR(#DPT_CD#, 0 ,3)
			      	</isEqual>
			      	<isNotEqual property="DPT_CD" compareValue="121000">
			      		<isEqual property="DPT_CD" compareValue="122000">
				      		AND SUBSTR(EVAL.CHR_DPT_CD, 0 ,3) = SUBSTR(#DPT_CD#, 0 ,3)
				      	</isEqual>
				      	<isNotEqual property="DPT_CD" compareValue="122000">
				      		AND EVAL.CHR_DPT_CD   = #DPT_CD#
				      	</isNotEqual>
			      	</isNotEqual>
			  </isNotEqual>
		      <isEqual property="DPT_CD" compareValue="141000">
		      		AND SUBSTR(EVAL.CHR_DPT_CD, 0 ,3) = SUBSTR(#DPT_CD#, 0 ,3)
		      </isEqual>
	</select>

	<!-- 상급자 평가자가 확정취소를 할 수 있는가 0이상이면 위원평가자가 한명이라도 확정을 한거다. 
	<select id="CSPAOE042EEvlDtmYnSselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
			SELECT TO_CHAR(SUM(DECODE(NVL(EVL_DTM_YN, 'N'), #strEvlDtmYn#, 0, 1))) AS EVL_DTM_YN
			  FROM (
			    SELECT D1.EVL_YR
			         , D1.HLYR_DVSN_CD
			         , D1.TSK_NO
			         , D3.CHGR_DVSN_CD
			         , '500' AS EVL_STEP_CD /*평가위원*/
			         , D3.CHGR_CNB
			         , D1.CHR_DPT_CD
			      FROM TBCSPAOE026M D1
			         , (
 			            SELECT EVL_YR
			                 , HLYR_DVSN_CD
			                 , CHR_DPT_CD
			                 , TSK_NO
			              FROM TBCSPAOE027M
			             WHERE EVL_YR      = #EVL_YR#
			              AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			            GROUP BY EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD, TSK_NO           
			          ) D2     
			         , TBCSPAOE017D D3
			    WHERE D1.EVL_YR       = D2.EVL_YR
			      AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			      AND D1.CHR_DPT_CD   = D2.CHR_DPT_CD
			      AND D1.TSK_NO       = D2.TSK_NO
			      AND D1.EVL_YR       = D3.EVL_YR
			      AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
			      AND D3.TSK_DVSN_CD  = '10002' /*지원업무*/
			      AND D1.EVL_YR       = #EVL_YR#
			      AND D1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
			      
			      AND D3.CHGR_DVSN_CD = 'CD03' /*CD03:지원부서 평가위원 - 부서코드랑 연결할 필요가 없다. 이사람들은 원장, 차장 이런사람들이라서..*/
			      ) EVAL
			      , TBCSPAOE031M D3
			 WHERE EVAL.EVL_YR       = D3.EVL_YR           (+)
			   AND EVAL.HLYR_DVSN_CD = D3.HLYR_DVSN_CD     (+)
			   AND EVAL.EVL_STEP_CD  = D3.EVL_STEP_CD      (+)
			   AND EVAL.TSK_NO       = D3.TSK_NO           (+)
			   AND EVAL.CHGR_CNB     = D3.EVL_CMTR_CNB     (+)
			   AND EVAL.CHGR_DVSN_CD = D3.EVL_CMTR_DVSN_CD (+)
			   AND EVAL.CHR_DPT_CD   = D3.DPT_CD           (+)     
			   AND EVAL.CHR_DPT_CD = #DPT_CD#  
		]]>
	</select>
	-->
	<select id="CSPAOE042EEvlDtmYnSselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
			SELECT TO_CHAR(SUM(DECODE(NVL(EVL_DTM_YN, 'N'), #strEvlDtmYn#, 0, 1))) AS EVL_DTM_YN
			  FROM (
			    SELECT D1.EVL_YR
			         , D1.HLYR_DVSN_CD
			         , D1.TSK_NO
			         , D3.CHGR_DVSN_CD
			         , '500' AS EVL_STEP_CD /*평가위원*/
			         , D3.CHGR_CNB
			         , D1.CHR_DPT_CD
			      FROM TBCSPAOE026M D1
			         , (
 			            SELECT EVL_YR
			                 , HLYR_DVSN_CD
			                 , CHR_DPT_CD
			                 , TSK_NO
			              FROM TBCSPAOE027M
			             WHERE EVL_YR      = #EVL_YR#
			              AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			            GROUP BY EVL_YR, HLYR_DVSN_CD, CHR_DPT_CD, TSK_NO           
			          ) D2     
			         , TBCSPAOE017D D3
			    WHERE D1.EVL_YR       = D2.EVL_YR
			      AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			      AND D1.CHR_DPT_CD   = D2.CHR_DPT_CD
			      AND D1.TSK_NO       = D2.TSK_NO
			      AND D1.EVL_YR       = D3.EVL_YR
			      AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
			      AND D3.TSK_DVSN_CD  = '10002' /*지원업무*/
			      AND D1.EVL_YR       = #EVL_YR#
			      AND D1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
			      AND D3.CHGR_DVSN_CD = 'CD03' /*CD03:지원부서 평가위원 - 부서코드랑 연결할 필요가 없다. 이사람들은 원장, 차장 이런사람들이라서..*/
			      ) EVAL
			      , TBCSPAOE031M D3
			 WHERE EVAL.EVL_YR       = D3.EVL_YR           (+)
			   AND EVAL.HLYR_DVSN_CD = D3.HLYR_DVSN_CD     (+)
			   AND EVAL.EVL_STEP_CD  = D3.EVL_STEP_CD      (+)
			   AND EVAL.TSK_NO       = D3.TSK_NO           (+)
			   AND EVAL.CHGR_CNB     = D3.EVL_CMTR_CNB     (+)
			   AND EVAL.CHGR_DVSN_CD = D3.EVL_CMTR_DVSN_CD (+)
			   AND EVAL.CHR_DPT_CD   = D3.DPT_CD           (+)      
			   AND EVAL.CHR_DPT_CD(+) = #DPT_CD#   
		]]>
	</select>

	<select id="CSPAOE042EnextTapYnselect01" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
		    SELECT TO_CHAR(SUM(DECODE( NVL(EVL_DTM_YN, 'N'), 'N', 1, 0))) AS EVL_DTM_YN
		      FROM TBCSPAOE017D D1
		         , TBCSPAOE031M D2
		     WHERE 1=1
		       AND D1.EVL_YR = D2.EVL_YR (+)
		       AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD (+)
		       AND D2.EVL_STEP_CD (+) = '300'
		       AND D1.BLT_DPT_CD = D2.DPT_CD 
		       AND D1.BLT_DPT_CD = #strDeptCd#
		       AND D1.CHGR_DVSN_CD = D2.EVL_CMTR_DVSN_CD (+)
		       AND D1.EVL_YR = #strEvlYr#
		       AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
		       AND D1.TSK_DVSN_CD = '10002'
		       AND D1.AUD_TSK_KND_CD = '10000'
		       AND D1.CHGR_DVSN_CD = 'CD01'
		]]>
	</select>

	<select id="CSPAOE042EnextTapYnselect02" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
		   SELECT TO_CHAR(SUM(DECODE( NVL(EVL_DTM_YN, 'N'), 'N', 1, 0))) AS EVL_DTM_YN
		     FROM TBCSPAOE017D D1
		        , TBCSPAOE031M D2
		    WHERE 1=1
		      AND D1.EVL_YR = D2.EVL_YR (+)
		      AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD (+)
		      AND D2.EVL_STEP_CD (+) = '400'
		      AND D2.DPT_CD = #strDeptCd#
		      AND D1.CHGR_DVSN_CD = D2.EVL_CMTR_DVSN_CD (+)
		      AND D1.EVL_YR = #strEvlYr#
		      AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
		      AND D1.TSK_DVSN_CD = '10002'
		      AND D1.AUD_TSK_KND_CD = '10000'
		      AND D1.CHGR_DVSN_CD = 'CD02'
		]]>
	</select>

	<!-- 참여인원 및 기여율 조회 -->
	<select id="CSPAOE042Esubselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.PTCPT_CNB                          AS PTCPT_CNB  /*참여자 전산번호*/
			     , F_DPT_INFO(#strDeptCd#, '1')          AS DPT_NM     /*소속부서*/
			     , F_CODE_NM('1000173', MAX(D1.RANK_CD)) AS RANK_NM    /*혹시나.. 직급 바뀔까봐서...*/
			     , SUM(D2.WGT_RTE * D1.CTB_RTE / 100)    AS CTB_RTE    /*기여율 총 합*/
			     , F_USR_INFO(D1.PTCPT_CNB, 2)           AS NAM        /*이름*/
			  FROM TBCSPAOE026M D2
     			 , TBCSPAOE027M D1
			 WHERE D2.EVL_YR = D1.EVL_YR
			   AND D2.HLYR_DVSN_CD = D1.HLYR_DVSN_CD
			   ]]>
		       <isNotEqual property="strDeptCd" compareValue="141000">
			   
			   		<isEqual property="strDeptCd" compareValue="121000">
			       		AND SUBSTR(D2.CHR_DPT_CD, 0 ,3) = SUBSTR(D1.CHR_DPT_CD, 0 ,3)
			       		AND D2.CHR_DPT_CD   = #strDeptCd#
			       </isEqual>
			       <isNotEqual property="strDeptCd" compareValue="121000">
			       		<isEqual property="strDeptCd" compareValue="122000">
			       			AND SUBSTR(D2.CHR_DPT_CD, 0 ,3) = SUBSTR(D1.CHR_DPT_CD, 0 ,3)
			       			AND D2.CHR_DPT_CD   = #strDeptCd#
			       		</isEqual>
			       		<isNotEqual property="strDeptCd" compareValue="122000">
			       			AND D2.CHR_DPT_CD = D1.CHR_DPT_CD
			  			 	AND D2.CHR_DPT_CD   = #strDeptCd#
			       		</isNotEqual>
			       </isNotEqual>
			   </isNotEqual>
		       <isEqual property="strDeptCd" compareValue="141000">
		       		AND SUBSTR(D2.CHR_DPT_CD, 0 ,3) = SUBSTR(D1.CHR_DPT_CD, 0 ,3)
		       		AND D2.CHR_DPT_CD   = #strDeptCd#
		       </isEqual>
		       <![CDATA[ 
			   AND D2.TSK_NO = D1.TSK_NO 
			   AND D1.EVL_YR = #strEvlYr#
			   AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			 GROUP BY D1.PTCPT_CNB
		]]>
	</select>

	<!-- 등급평점을 가져온다. -->
	<select id="CSPAOE042ERkAscselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT RK_CD           AS RK_CD         /* 등급코드 */
			     , TO_CHAR(RK_ASC) AS RK_ASC        /* 등급평점 */
			  FROM TBCSPAOE010D
			 WHERE 1=1
			   AND EVL_YR         = #EVL_YR#
			   AND HLYR_DVSN_CD   = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD    = '10002'    /*지원업무*/
			   AND AUD_TSK_KND_CD = '10000' /*공통*/
			   AND RK_CD = '600' /*지원업무는 등급이 보통밖에 없다.*/
		]]>
	</select>

	<update id="CSPAOE042ECancleupdate" parameterClass="paramMap">
		<![CDATA[	
			UPDATE TBCSPAOE031M
			   SET FNL_MDF_DH  = SYSDATE
				 , EVL_DTM_YN  = 'N' /*확정취소*/
				 , EVL_STA_CD  = '200'
				 , FNL_USR_ID = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID = #FNL_MNU_ID#
             WHERE 1=1
               AND EVL_YR            = #EVL_YR#
			   AND HLYR_DVSN_CD      = #HLYR_DVSN_CD#
			   AND EVL_STEP_CD       = #EVL_STEP_CD#  /*평가단계 - 자체평가*/
			   AND DPT_CD            = #DPT_CD#
			   AND EVL_CMTR_DVSN_CD  = #EVL_CMTR_DVSN_CD#
		]]>
	</update>
	
	<!-- 지원업무 평가관리 신규 or 수정된 정보를 저장한다. -->
	<update id="CSPAOE042EmainFupdate" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO TBCSPAOE031M
		    USING DUAL
			   ON ( 
					    EVL_YR             = #EVL_YR#
					AND HLYR_DVSN_CD       = #HLYR_DVSN_CD#
					AND EVL_STEP_CD        = '300'  /*평가단계 - 자체평가*/
					AND DPT_CD             = #DPT_CD#
					AND TSK_NO             = #TSK_NO#
					AND EVL_CMTR_DVSN_CD   = 'CD01' /*자체평가자 코드*/
					AND EVL_CMTR_CNB       = #EVL_CMTR_CNB#
			  	   )
			WHEN MATCHED THEN 		
				UPDATE 
				   SET FNL_MDF_DH  = SYSDATE
		             , EVL_OPIN    = #EVL_OPIN#
		             , TSK_ASC     = TO_NUMBER(#WGT_RTE#) * (TO_NUMBER(#RK_ASC#)/100) /*비중 * (등급평점/100) */
					 , EVL_DTM_YN  = #EVL_DTM_YN#
					 , EVL_STA_CD  = #EVL_STA_CD#
		]]>
					<isNotEmpty prepend="," property="FNL_USR_ID">
						FNL_USR_ID = #FNL_USR_ID#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
						FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_MNU_ID">
						FNL_MNU_ID = #FNL_MNU_ID#
					</isNotEmpty>
		<![CDATA[
            WHEN NOT MATCHED THEN 
				INSERT 
				    (
				       EVL_YR
					 , HLYR_DVSN_CD
					 , EVL_STEP_CD
					 , DPT_CD
					 , TSK_NO
					 , EVL_CMTR_DVSN_CD
					 , EVL_CMTR_CNB
					 , EVL_STA_CD
					 , EVL_RK_CD
					 , EVL_OPIN
					 , TSK_ASC
					 , EVL_DTM_YN
				 	 , FRT_USR_ID
				 	 , FNL_USR_ID
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID
					 , FRT_REGI_DH
					 , FNL_MDF_DH
					)  VALUES 
					(
				       #EVL_YR#
					 , #HLYR_DVSN_CD#
					 , '300'
					 , #DPT_CD#
					 , #TSK_NO#
					 , 'CD01'
					 , #EVL_CMTR_CNB#
					 , #EVL_STA_CD#
					 , #EVL_RK_CD# 
					 , #EVL_OPIN#
					 , TO_NUMBER(#WGT_RTE#) * (TO_NUMBER(#RK_ASC#)/100)
					 , #EVL_DTM_YN#
					 , #FNL_USR_ID#
					 , #FNL_USR_ID#
					 , #FNL_DEAL_DPT_CD#
					 , #FNL_MNU_ID#
					 , SYSDATE
					 , SYSDATE	
					 )
		]]>
	</update>

	<!-- 비중 업뎃. -->
	<update id="CSPAOE042EmainWgtupdate" parameterClass="paramMap">
		<![CDATA[	
				UPDATE TBCSPAOE026M
				   SET FNL_MDF_DH  = SYSDATE
		             , WGT_RTE     = #WGT_RTE#
		]]>
					<isNotEmpty prepend="," property="FNL_USR_ID">
						FNL_USR_ID = #FNL_USR_ID#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
						FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_MNU_ID">
						FNL_MNU_ID = #FNL_MNU_ID#
					</isNotEmpty>
		<![CDATA[
		   WHERE 1=1
		     AND EVL_YR        = #EVL_YR#
			 AND HLYR_DVSN_CD  = #HLYR_DVSN_CD#
			 AND CHR_DPT_CD    = #DPT_CD#
			 AND TSK_NO        = #TSK_NO#
		]]>
	</update>
	
	<!-- 기여율 업뎃. -->
	<update id="CSPAOE042EmainCtbRteupdate" parameterClass="paramMap">
		<![CDATA[	
				UPDATE TBCSPAOE027M
				   SET FNL_MDF_DH  = SYSDATE
		             , CTB_RTE     = #CTB_RTE#
		]]>
					<isNotEmpty prepend="," property="FNL_USR_ID">
						FNL_USR_ID = #FNL_USR_ID#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
						FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_MNU_ID">
						FNL_MNU_ID = #FNL_MNU_ID#
					</isNotEmpty>
		<![CDATA[
		   WHERE 1=1
		     AND EVL_YR        = #EVL_YR#
			 AND HLYR_DVSN_CD  = #HLYR_DVSN_CD#
			 AND CHR_DPT_CD    = #DPT_CD#
			 AND TSK_NO        = #TSK_NO#
			 AND PTCPT_CNB     = #NEVLT_CNB#
		]]>
	</update>

	<!-- 상급자평가 탭 시작 -->
	<!-- 상단그리드 조회 -->
	<select id="CSPAOE042EmainSselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D3.EVL_YR                          AS EVL_YR       /*평가년도 */
			     , D3.HLYR_DVSN_CD                    AS HLYR_DVSN_CD /*반기구분코드 */
			     , D3.CHR_DPT_CD                      AS DPT_CD       /*부서코드 */
			     , D3.TSK_NO                          AS TSK_NO       /*업무번호 */
			     , DECODE(ROW_N , 1, D3.TSK_NM , '')  AS TSK_NM       /*업무명 */
			     , DECODE(ROW_N , 1, D3.WGT_RTE , '') AS WGT_RTE      /*비중*/
			     , F_USR_INFO(D3.PTCPT_CNB, '2')      AS NAM          /*성명*/ 
			     , D3.CTB_RTE                         AS CTB_RTE      /*기여율*/
			     , D3.TSK_TXT                         AS TSK_TXT      /*업무내용상세*/
			     , D6.EVL_OPIN                        AS EVL_OPIN_TXT /*자체평가의견*/
			     , NVL(D5.EVL_STA_CD, '100')          AS EVL_STA_CD   /*널이면 평가상태코드가 미평가다.*/
			     , NVL(D5.EVL_RK_CD, '600')           AS EVL_RK_CD    /*지원업무는 평가등급이 보통이다. */
			     , D3.PTCPT_CNB                       AS NEVLT_CNB    /*참여자 전산번호*/
			     , ROW_N                              AS ROW_N        /*이게 1인것만 비중컬럼 활성화*/
			     , #strEvlCmtrCnb#                    AS EVL_CMTR_CNB /*평가위원 전산번호(로그인한사람)*/
			     , D5.EVL_OPIN                        AS EVL_OPIN     /*자체평가의견*/
			     , F_CODE_NM('1000280', NVL(D5.EVL_STA_CD, '100'))  AS EVL_STA_NM  /*평가상태*/
			     , MOD(DENSE_RANK() OVER(PARTITION BY D3.EVL_YR ORDER BY D3.TSK_NO) , 2) AS BACK_GROUD_NUM /*백그라운드 색깔 주기 위해서*/
                 , DENSE_RANK() OVER(PARTITION BY D3.EVL_YR ORDER BY D3.TSK_NO) AS RANK_NUM 
			  FROM (
			    SELECT D1.EVL_YR
			         , D1.HLYR_DVSN_CD
			         , D1.CHR_DPT_CD
			         , D1.TSK_NO
			         , D1.TSK_TXT
			         , D2.PTCPT_CNB /*참여자 전산번호*/
			         , D2.CTB_RTE
			         , D1.TSK_NM  
			         , D1.WGT_RTE
			         , ROW_NUMBER() OVER(PARTITION BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.TSK_NO ORDER BY D2.PTCPT_CNB) AS ROW_N
			         /*로우넘버를 한 이유 : 여러로우가 나와도 중복된 데이터는 맨 윗줄만 나오고 나머진 널로 처리해야해서.*/
			      FROM TBCSPAOE026M D1
			         , TBCSPAOE027M D2
			    WHERE D1.EVL_YR       = D2.EVL_YR
			      AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			      ]]>
			      <isNotEqual property="strDeptCd" compareValue="141000">
			      
			      		<isEqual property="strDeptCd" compareValue="121000">
			      			AND SUBSTR(D1.CHR_DPT_CD, 0, 3)   = SUBSTR(D2.CHR_DPT_CD, 0, 3)
			      		</isEqual>
			      		<isNotEqual property="strDeptCd" compareValue="121000">
			      			<isEqual property="strDeptCd" compareValue="122000">
				      			AND SUBSTR(D1.CHR_DPT_CD, 0, 3)   = SUBSTR(D2.CHR_DPT_CD, 0, 3)
				      			AND D2.CHR_DPT_CD IN ('122100','122200','122300','122400','122000')
				      		</isEqual>
				      		<isNotEqual property="strDeptCd" compareValue="122000">
				      			AND D1.CHR_DPT_CD   = D2.CHR_DPT_CD
				      		</isNotEqual>
			      		</isNotEqual>
			      </isNotEqual>
			      <isEqual property="strDeptCd" compareValue="141000">
			      		AND SUBSTR(D1.CHR_DPT_CD, 0, 3)   = SUBSTR(D2.CHR_DPT_CD, 0, 3)
			      </isEqual>
			      <![CDATA[  
			      AND D1.TSK_NO       = D2.TSK_NO
			      AND D1.EVL_YR       = #strEvlYr#
			      AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			      AND D1.CHR_DPT_CD   = #strDeptCd# 
			  ) D3 /*지원업무 참여인원및 기여율*/
			  , TBCSPAOE031M D5
			  , (
			    SELECT EVL_YR
			         , HLYR_DVSN_CD
			         , EVL_STEP_CD
			         , DPT_CD
			         , TSK_NO
			         , EVL_OPIN
			      FROM TBCSPAOE031M
			     WHERE EVL_YR            = #strEvlYr#
			       AND HLYR_DVSN_CD      = #strHlyrDvsnCd#
			       AND EVL_STEP_CD       = '300' /*자체평가*/
			       AND DPT_CD            = #strDeptCd#
			       AND EVL_CMTR_DVSN_CD  = 'CD01'  /*어짜피 자체평가자는 한명뿐이다.*/
			      ) D6
			WHERE D3.EVL_YR                 = D5.EVL_YR (+)
			  AND D3.HLYR_DVSN_CD           = D5.HLYR_DVSN_CD (+)
			  AND D5.EVL_STEP_CD  (+)       = '400' /*상급자평가 코드*/
			  AND D3.CHR_DPT_CD             = D5.DPT_CD (+)
			  AND D3.TSK_NO                 = D5.TSK_NO (+)
			  AND D5.EVL_CMTR_DVSN_CD (+)   = 'CD02' /*상급자평가자 코드*/
			  /* AND D5.EVL_CMTR_CNB 로그인한 평가자의 전산번호 각 부서에 상급자 평가자는 한명이므로 조회조건에 필요없다.*/
			  AND D3.EVL_YR                 = D6.EVL_YR (+)
			  AND D3.HLYR_DVSN_CD           = D6.HLYR_DVSN_CD (+)
			  AND D3.CHR_DPT_CD             = D6.DPT_CD (+)
			  AND D3.TSK_NO                 = D6.TSK_NO (+) /*자체평가자가 아직 평가 전에 상급자혹은 위원평가자가 로그인 할수 있으므로*/
   		]]>
		<![CDATA[   
			ORDER BY TSK_NO, ROW_N
		]]>
	</select>

	<!-- 지원업무 평가관리 신규 or 수정된 정보를 저장한다. -->
	<update id="CSPAOE042EmainSupdate" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO TBCSPAOE031M
		    USING DUAL
			   ON ( 
					    EVL_YR           = #EVL_YR#
					AND HLYR_DVSN_CD     = #HLYR_DVSN_CD#
					AND EVL_STEP_CD      = '400'  /*평가단계 - 상급자 평가*/
					AND DPT_CD           = #DPT_CD#
					AND TSK_NO           = #TSK_NO#
					AND EVL_CMTR_DVSN_CD = 'CD02' /*상급자 평가자 코드*/
					AND EVL_CMTR_CNB     = #EVL_CMTR_CNB#
			  	   )
			WHEN MATCHED THEN 		
				UPDATE 
				   SET FNL_MDF_DH  = SYSDATE
		             , EVL_OPIN    = #EVL_OPIN#
		             , TSK_ASC     = TO_NUMBER(#WGT_RTE#) * (TO_NUMBER(#RK_ASC#)/100) /*비중 * (등급평점/100) */
					 , EVL_DTM_YN  = #EVL_DTM_YN#
					 , EVL_STA_CD  = #EVL_STA_CD#
		]]>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		<![CDATA[
            WHEN NOT MATCHED THEN 
				INSERT 
				    (
				       EVL_YR
					 , HLYR_DVSN_CD
					 , EVL_STEP_CD
					 , DPT_CD
					 , TSK_NO
					 , EVL_CMTR_DVSN_CD 
					 , EVL_CMTR_CNB
					 , EVL_STA_CD
					 , EVL_RK_CD
					 , EVL_OPIN
					 , TSK_ASC
					 , EVL_DTM_YN
				 	 , FRT_USR_ID
				 	 , FNL_USR_ID
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID
					 , FRT_REGI_DH
					 , FNL_MDF_DH
					)  VALUES 
					(
				       #EVL_YR#
					 , #HLYR_DVSN_CD#
					 , '400'
					 , #DPT_CD#
					 , #TSK_NO#
					 , 'CD02'
					 , #EVL_CMTR_CNB#
					 , #EVL_STA_CD#
					 , #EVL_RK_CD# 
					 , #EVL_OPIN#
					 , TO_NUMBER(#WGT_RTE#) * (TO_NUMBER(#RK_ASC#)/100)
					 , #EVL_DTM_YN#
					 , #FNL_USR_ID#
					 , #FNL_USR_ID#
					 , #FNL_DEAL_DPT_CD#
					 , #FNL_MNU_ID#
					 , SYSDATE
					 , SYSDATE	
					 )
		]]>
	</update>

	<!-- 위원 평가 탭 시작 -->
	
	<!-- 관리자일때 지원업무 조회 -->
	<select id="CSPAOE042EmainTCancleselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.EVL_YR        AS EVL_YR       /*평가년도 */
			     , D1.HLYR_DVSN_CD  AS HLYR_DVSN_CD /*반기구분코드 */
			     , D1.CHR_DPT_CD    AS DPT_CD       /*부서코드 */
			     , D1.TSK_NO        AS TSK_NO       /*업무번호 */
			     , D1.TSK_NM        AS TSK_NM       /*업무명 */
			     , D1.WGT_RTE       AS WGT_RTE      /*비중*/
			     , NVL(D2.EVL_STA_CD, '100') AS EVL_STA_CD   /*평가상태코드*/
			     , ''                        AS TSK_ASC      /*업무평점*/
			     , ''                        AS EVL_RK_CD    /*평가등급코드*/
			     , D1.TSK_TXT                AS TSK_TXT      /*업무내용상세*/
			     , ''      AS EVL_OPIN_1   /*자체평가 의견*/
			     , ''      AS EVL_OPIN_2   /*상급자평가 의견*/
			     , ''      AS EVL_OPIN     /*종합평가의견*/
			     , ''  AS RK_ASC_100  
		         , ''  AS RK_ASC_200   
			     , ''  AS RK_ASC_300
			     , ''  AS RK_ASC_400
			     , ''  AS RK_ASC_500
			     , ''  AS RK_ASC_600
			     , ''  AS RK_ASC_700
			     , ''  AS RK_ASC_800
			     , #strEvlCmtrCnb#            AS EVL_CMTR_CNB /*평가위원 전산번호(로그인한사람)*/
			  FROM TBCSPAOE026M D1      
                 , (
                    SELECT EVL.EVL_YR
                         , EVL.HLYR_DVSN_CD
                         , DECODE( SUM(DECODE(EVL.EVL_STA_CD, '300', '', '200', 1, '100', 0, 0)), '', '300', 0, '100', '200') AS EVL_STA_CD
                      FROM (
                        SELECT EVL_YR
                             , HLYR_DVSN_CD
                             , EVL_CMTR_CNB
                             , EVL_STA_CD
                         FROM TBCSPAOE031M
                        WHERE EVL_YR       = #strEvlYr#
                          AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                          AND EVL_STEP_CD  = '500'
                          AND DPT_CD       = #strDeptCd#
                        GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD, EVL_CMTR_CNB, EVL_STA_CD              
                      ) EVL 
                      , (
                        SELECT EVL_YR
                             , HLYR_DVSN_CD
                             , CHGR_CNB
                          FROM TBCSPAOE017D
                         WHERE EVL_YR       = #strEvlYr#
                           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                           AND TSK_DVSN_CD  = '10002'
                           AND CHGR_DVSN_CD = 'CD03'  
                      ) BASE
                    WHERE EVL.EVL_YR        = BASE.EVL_YR
                      AND EVL.HLYR_DVSN_CD  = BASE.HLYR_DVSN_CD 
                      AND EVL.EVL_CMTR_CNB  = BASE.CHGR_CNB
                    GROUP BY  EVL.EVL_YR, EVL.HLYR_DVSN_CD                   
                 ) D2
			WHERE D1.EVL_YR = D2.EVL_YR
              AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD 
              AND D1.EVL_YR                 = #strEvlYr#
              AND D1.HLYR_DVSN_CD           = #strHlyrDvsnCd#
              AND D1.CHR_DPT_CD             = #strDeptCd#       
			ORDER BY D1.TSK_NO
		]]>
	</select>
	
	<!-- 그리드 조회 -->
	<select id="CSPAOE042EmainTselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D1.EVL_YR        AS EVL_YR       /*평가년도 */
			     , D1.HLYR_DVSN_CD  AS HLYR_DVSN_CD /*반기구분코드 */
			     , D1.CHR_DPT_CD    AS DPT_CD       /*부서코드 */
			     , D1.TSK_NO        AS TSK_NO       /*업무번호 */
			     , D1.TSK_NM        AS TSK_NM       /*업무명 */
			     , D1.WGT_RTE       AS WGT_RTE      /*비중*/
			     , NVL(D2.EVL_STA_CD, '100') AS EVL_STA_CD   /*평가상태코드*/
			     , TSK_ASC          AS TSK_ASC      /*업무평점*/
			     , D2.EVL_RK_CD     AS EVL_RK_CD    /*평가등급코드*/
			     , D1.TSK_TXT       AS TSK_TXT      /*업무내용상세*/
			     , D3.EVL_OPIN      AS EVL_OPIN_1   /*자체평가 의견*/
			     , D4.EVL_OPIN      AS EVL_OPIN_2   /*상급자평가 의견*/
			     , D2.EVL_OPIN      AS EVL_OPIN     /*종합평가의견*/
			     , D1.WGT_RTE * (D5.RK_ASC_100 /100)  AS RK_ASC_100   /*평가 등급별 점수 (화면단에서 평가등급을 바꿀시 자동계산된 값을 보여주려고)*/
			     , D1.WGT_RTE * (D5.RK_ASC_200 /100)  AS RK_ASC_200   /*위원평가탭에서는 비중의 값을 바꾸지 않기 때문에 미리 계산해 둬두 된다.*/
			     , D1.WGT_RTE * (D5.RK_ASC_300 /100)  AS RK_ASC_300
			     , D1.WGT_RTE * (D5.RK_ASC_400 /100)  AS RK_ASC_400
			     , D1.WGT_RTE * (D5.RK_ASC_500 /100)  AS RK_ASC_500
			     , D1.WGT_RTE * (D5.RK_ASC_600 /100)  AS RK_ASC_600
			     , D1.WGT_RTE * (D5.RK_ASC_700 /100)  AS RK_ASC_700
			     , D1.WGT_RTE * (D5.RK_ASC_800 /100)  AS RK_ASC_800
			     , #strEvlCmtrCnb#                    AS EVL_CMTR_CNB /*평가위원 전산번호(로그인한사람)*/
			  FROM TBCSPAOE026M D1
			     , TBCSPAOE031M D2
				 , (
				    SELECT EVL_YR
				         , HLYR_DVSN_CD
				         , EVL_STEP_CD
				         , DPT_CD
				         , TSK_NO
				         , EVL_OPIN
				      FROM TBCSPAOE031M
				     WHERE EVL_YR           = #strEvlYr#
				       AND HLYR_DVSN_CD     = #strHlyrDvsnCd#
				       AND EVL_STEP_CD      = '300' /*자체평가*/
				       AND DPT_CD           = #strDeptCd#
				       AND EVL_CMTR_DVSN_CD = 'CD01'  /*어짜피 자체평가자는 한명뿐이다.*/
				     ) D3
				 , (
				    SELECT EVL_YR
				         , HLYR_DVSN_CD
				         , EVL_STEP_CD
				         , DPT_CD
				         , TSK_NO
				         , EVL_OPIN
				      FROM TBCSPAOE031M
				     WHERE EVL_YR           = #strEvlYr#
				       AND HLYR_DVSN_CD     = #strHlyrDvsnCd#
				       AND EVL_STEP_CD      = '400' /*상급자평가*/
				       AND DPT_CD           = #strDeptCd#
				       AND EVL_CMTR_DVSN_CD = 'CD02'  /*어짜피 상급자평가자는 한명뿐이다.*/
				     ) D4	
	        	 , (
			        SELECT EVL_YR                               AS EVL_YR         /* 평가년도 */
			             , HLYR_DVSN_CD                         AS HLYR_DVSN_CD   /* 반기구분코드 */
			             , TSK_DVSN_CD                          AS TSK_DVSN_CD    /* 업무구분코드 */
			             , AUD_TSK_KND_CD                       AS AUD_TSK_KND_CD /* 감사업무종류코드 */
			             , SUM(DECODE(RK_CD, '100', RK_ASC, 0)) AS RK_ASC_100     
			             , SUM(DECODE(RK_CD, '200', RK_ASC, 0)) AS RK_ASC_200
			             , SUM(DECODE(RK_CD, '300', RK_ASC, 0)) AS RK_ASC_300
			             , SUM(DECODE(RK_CD, '400', RK_ASC, 0)) AS RK_ASC_400
			             , SUM(DECODE(RK_CD, '500', RK_ASC, 0)) AS RK_ASC_500
			             , SUM(DECODE(RK_CD, '600', RK_ASC, 0)) AS RK_ASC_600
			             , SUM(DECODE(RK_CD, '700', RK_ASC, 0)) AS RK_ASC_700
			             , SUM(DECODE(RK_CD, '800', RK_ASC, 0)) AS RK_ASC_800
			          FROM TBCSPAOE010D 
			         WHERE EVL_YR         = #strEvlYr#
			           AND HLYR_DVSN_CD   = #strHlyrDvsnCd#
			           AND TSK_DVSN_CD    = '10002' /*지원업무*/
			           AND AUD_TSK_KND_CD = '10000' /*공통업무*/
			           AND IDCT_YN        = 'Y'
			         GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_DVSN_CD, AUD_TSK_KND_CD
		           ) D5		      
			WHERE D1.EVL_YR                 = D2.EVL_YR (+)
			  AND D1.HLYR_DVSN_CD           = D2.HLYR_DVSN_CD (+)
			  AND D2.EVL_STEP_CD (+)        = '500' /*위원평가 코드*/
			  AND D1.CHR_DPT_CD             = D2.DPT_CD (+)
			  AND D1.TSK_NO                 = D2.TSK_NO (+)
			  AND D2.EVL_CMTR_DVSN_CD (+)   = 'CD03' /*위원평가자*/
			  AND D2.EVL_CMTR_CNB (+)       = #strEvlCmtrCnb# /*로그인한 평가자의 전산번호*/
			  AND D1.EVL_YR                 = D3.EVL_YR (+)
			  AND D1.HLYR_DVSN_CD           = D3.HLYR_DVSN_CD (+)
			  AND D1.CHR_DPT_CD             = D3.DPT_CD (+)
			  AND D1.TSK_NO                 = D3.TSK_NO (+) /*자체평가자가 아직 평가 전에 상급자혹은 위원평가자가 로그인 할수 있으므로*/
			  AND D1.EVL_YR                 = D4.EVL_YR (+)
			  AND D1.HLYR_DVSN_CD           = D4.HLYR_DVSN_CD (+)
			  AND D1.CHR_DPT_CD             = D4.DPT_CD (+)
			  AND D1.TSK_NO                 = D4.TSK_NO (+) /*위원평가자가 아직 평가 전에 상급자 평가자가 로그인 할수 있으므로*/
			  AND D1.EVL_YR                 = D5.EVL_YR (+)
			  AND D1.HLYR_DVSN_CD           = D5.HLYR_DVSN_CD (+)
              AND D1.EVL_YR                 = #strEvlYr#
              AND D1.HLYR_DVSN_CD           = #strHlyrDvsnCd#
              AND D1.CHR_DPT_CD             = #strDeptCd#
 		]]>
		<![CDATA[             
			ORDER BY D1.TSK_NO
		]]>
	</select>

	<!-- 지원업무 평가관리 신규 or 수정된 정보를 저장한다. -->
	<update id="CSPAOE042EmainTupdate" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO TBCSPAOE031M
		    USING DUAL
			   ON ( 
					    EVL_YR           = #EVL_YR#
					AND HLYR_DVSN_CD     = #HLYR_DVSN_CD#
					AND EVL_STEP_CD      = '500'  /*평가단계 - 상급자 평가*/
					AND DPT_CD           = #DPT_CD#
					AND TSK_NO           = #TSK_NO#
					AND EVL_CMTR_DVSN_CD = 'CD03' /*상급자 평가자 코드*/
					AND EVL_CMTR_CNB     = #EVL_CMTR_CNB#
			  	   )
			WHEN MATCHED THEN 		
				UPDATE 
				   SET FNL_MDF_DH  = SYSDATE
		             , EVL_OPIN    = #EVL_OPIN#
		             , TSK_ASC     = #TSK_ASC# /*비중 * (등급평점/100) */
					 , EVL_DTM_YN  = #EVL_DTM_YN#
					 , EVL_STA_CD  = #EVL_STA_CD#
		]]>
		<isNotEmpty prepend="," property="EVL_RK_CD">
			EVL_RK_CD = #EVL_RK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		<![CDATA[
            WHEN NOT MATCHED THEN 
				INSERT 
				    (
				       EVL_YR
					 , HLYR_DVSN_CD
					 , EVL_STEP_CD
					 , DPT_CD
					 , TSK_NO
					 , EVL_CMTR_DVSN_CD
					 , EVL_CMTR_CNB
					 , EVL_STA_CD
					 , EVL_RK_CD
					 , EVL_OPIN
					 , TSK_ASC
					 , EVL_DTM_YN
				 	 , FRT_USR_ID
				 	 , FNL_USR_ID
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID
					 , FRT_REGI_DH
					 , FNL_MDF_DH
					)  VALUES 
					(
				       #EVL_YR#
					 , #HLYR_DVSN_CD#
					 , '500'
					 , #DPT_CD#
					 , #TSK_NO#
					 , 'CD03'
					 , #EVL_CMTR_CNB#
					 , #EVL_STA_CD#
					 , #EVL_RK_CD# 
					 , #EVL_OPIN#
					 , #TSK_ASC#
					 , #EVL_DTM_YN#
					 , #FNL_USR_ID#
					 , #FNL_USR_ID#
					 , #FNL_DEAL_DPT_CD#
					 , #FNL_MNU_ID#
					 , SYSDATE
					 , SYSDATE
					 )
		]]>
	</update>

	<!-- 확정할때 피평가자 정보를 가져온다. -->
	<select id="CSPAOE042ENevltInfoListselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT D3.EVL_YR        /*평가년도*/
			     , D3.HLYR_DVSN_CD  /*반기구분코드*/
			     , D3.NEVLT_CNB     /*피평가자 전산번호*/
			     , D3.TSK_NO        /*업무번호*/
			     , #EVL_CMTR_CNB#   AS EVLT_CNB      /*평가자전산번호 */
			     , D3.DPT_CD_1      /*부서코드1*/
			     , D3.DPT_CD        /*부서코드*/
			     , D3.RANK_CD       /*직급코드*/
			     , D5.DPT_TP_CD
			     , DECODE( D5.DPT_TP_CD, 'S', D3.PSN_TSK_ASC, 0) AS PSN_TSK_ASC /*개인업무평점*/
			     , DECODE( D5.DPT_TP_CD, 'A', D3.PSN_TSK_ASC, 0) AS SPRT_CVS_ASC /*현 소속부서가 감사부서므로 감사지원평점*/
			  FROM (         
				SELECT D1.EVL_YR        AS EVL_YR        /*평가년도*/
				     , D1.HLYR_DVSN_CD  AS HLYR_DVSN_CD  /*반기구분코드*/
				     , D1.PTCPT_CNB     AS NEVLT_CNB     /*피평가자 전산번호*/
				     , D1.TSK_NO        AS TSK_NO        /*업무번호*/
				     , D2.HIRK_DPT_CD   AS DPT_CD_1      /*부서코드1*/
				     , D1.CHR_DPT_CD    AS DPT_CD        /*부서코드*/
				     , D1.RANK_CD       AS RANK_CD       /*직급코드*/
				     , ROUND( TO_NUMBER(#TSK_ASC#) * (D1.CTB_RTE/100), 2) AS PSN_TSK_ASC    /*개인업무평점*/
				  FROM TBCSPAOE027M D1
				     , TBDCMACM002M D2
				 WHERE D1.CHR_DPT_CD = D2.DPT_CD
				   AND D1.EVL_YR = #EVL_YR#
				   AND D1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
				   AND D1.CHR_DPT_CD = #DPT_CD#
				   AND D1.TSK_NO = #TSK_NO#
			   ) D3
	          , TBDCMACM001M D4
	          , TBDCMACM002M D5
	      WHERE D3.NEVLT_CNB = D4.CNB
	        AND D4.DPT_CD    = D5.DPT_CD
		]]>
	</select>

	<!-- 확정취소한다. -->
	<update id="CSPAOE042ENoConfupdate" parameterClass="paramMap">
		<![CDATA[	
				UPDATE TBCSPAOE035M
				   SET FNL_MDF_DH  = SYSDATE
		             , EVL_DTM_YN  = 'N'
		]]>
					<isNotEmpty prepend="," property="FNL_USR_ID">
						FNL_USR_ID = #FNL_USR_ID#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
						FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_MNU_ID">
						FNL_MNU_ID = #FNL_MNU_ID#
					</isNotEmpty>
		<![CDATA[
		   WHERE 1=1
		     AND EVL_YR          = #EVL_YR#
			 AND HLYR_DVSN_CD    = #HLYR_DVSN_CD#
			 AND TSK_DVSN_CD     = '10002'
			 AND AUD_TSK_KND_CD  = '10000'
			 AND TSK_NO          = #TSK_NO#
		]]>
	</update>
	<!-- ##################################### 지원업무 평가관리 끝 (CSPAOE042E) ################################### -->

	<!-- ########################### 관리운영직등 업무 평가관리 시작 (CSPAOE046E) ################################## -->
	<!-- 로그인한 평가자가 국장인지 과장인지 직위를 가져오는 쿼리 -->
	<select id="CSPAOE046EEvltPstCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT PST_CD
			  FROM TBDCMACM001M
			 WHERE CNB  = #strEvlCnb#	
		 ]]>
	</select>

	<!-- "평가등급별 기준관리" 화면에서 운영직업무 - 공통관리에 해당하는 평가등급 리스트를 가져온다. -->
	<select id="CSPAOE046ERkCdListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT D1.RK_CD          AS CD /* 등급코드 */
			     , D2.CD_NM          AS CD_NM
			 FROM TBCSPAOE010D D1
			    , TBDCMACM013C D2
			WHERE 1=1
			  AND D1.RK_CD          = D2.CD
			  AND D2.CD             <> '000000000'
			  AND D2.CMM_CD_DVSN_CD = '1000274'
			  AND D2.USE_YN         = 'Y'
			  AND D1.EVL_YR         = #strEvlYr#
			  AND D1.HLYR_DVSN_CD   = #strHlyrDvsnCd#
			  AND D1.TSK_DVSN_CD    = '10003' /*운영직업무*/
              AND D1.AUD_TSK_KND_CD = '10000' /*공통*/
			  AND D1.IDCT_YN        = 'Y'
            ORDER BY D2.OTPT_SEQ, D2.CD	
		 ]]>
	</select>

	<!-- 피평가자 목록을 조회한다. -->
	<select id="CSPAOE046Emainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_DPT_INFO(MAN.BLT_DPT_CD , '1')                  AS BLT_DPT_NM /*피평가자 소속 부서명*/
			     , F_CODE_NM('1000173', MAN.RANK_CD)                 AS RANK_NM /*피평가자 직급명*/
			     , F_USR_INFO(MAN.NEVLT_CNB, '2')                    AS  NEVLT_NM /*피평가자 이름*/
			     , F_CODE_NM('1000280', NVL(EVL.EVL_STA_CD, '100'))  AS EVL_STA_NM  /*평가상태*/
			     , MAN.NEVLT_CNB													/*피평가자 전산번호*/
			     , MAN.EVL_GP_CD                                     AS EVL_GP_CD   /*평가군 코드*/
			     , MAN.EVL_YR                                        AS EVL_YR
			     , MAN.HLYR_DVSN_CD                                  AS HLYR_DVSN_CD
			     , MAN.EVLT_CNB										 AS EVLT_CNB /*평가자 전산번호*/
			     , F_USR_INFO (MAN.EVLT_CNB,'2') 					 AS EVLT_NM  /*평가자 이름*/
			  FROM (
			    /*각 부서의 과장들이 평가할 리스트*/
			    SELECT D1.EVL_YR
			         , D1.HLYR_DVSN_CD
			         , D1.EVL_GP_CD
			         , D1.EVL_GP_NM
			         , D2.EVLT_CNB   /*평가자 전산번호*/
			         , D3.NEVLT_CNB  /*피평가자 전산번호*/
			         , D3.BLT_DPT_CD /*피평가자 소속부서코드*/
			         , D3.RANK_CD    /*피평가자 직급코드*/
			         , d3.EVLT_CNB as W_EVLT_CNB
			      FROM TBCSPAOE018M D1
			         , TBCSPAOE019D D2
			         , TBCSPAOE020D D3
			     WHERE D1.EVL_YR      = D2.EVL_YR
			       AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			       AND D1.EVL_GP_CD    = D2.EVL_GP_CD
			       AND D1.EVL_YR       = D3.EVL_YR
			       AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
			       AND D1.EVL_GP_CD    = D3.EVL_GP_CD
			       AND D1.EVL_YR       = #strEvlYr#
			       AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
				]]>
				<isNotEqual property="strDptCd" compareValue="ALL">
				   AND D2.EVLT_CNB     = #strEvlCnb# /*로그인한 평가자 전산번호*/
				</isNotEqual>
				<![CDATA[
			    ) MAN /*운영직업무 평가자 리스트*/
			    , (
			        SELECT EVL_YR
			             , HLYR_DVSN_CD
			             , NEVLT_CNB
			             , EVL_CMTR_CNB
			             , MIN(EVL_STA_CD)       AS EVL_STA_CD
			             , MIN(EVL_CMTR_DVSN_CD) AS EVL_CMTR_DVSN_CD
			          FROM TBCSPAOE032M
			         WHERE EVL_YR       = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			         GROUP BY EVL_YR, HLYR_DVSN_CD, NEVLT_CNB, EVL_CMTR_CNB   
			    ) EVL
			WHERE MAN.EVL_YR       = EVL.EVL_YR (+)
			  AND MAN.HLYR_DVSN_CD = EVL.HLYR_DVSN_CD (+)
			  AND MAN.NEVLT_CNB    = EVL.NEVLT_CNB  (+)
			  AND MAN.EVLT_CNB     = EVL.EVL_CMTR_CNB (+)
			  AND MAN.EVL_GP_CD    = EVL.EVL_CMTR_DVSN_CD (+)
			  and case when MAN.W_EVLT_CNB = man.EVLT_CNB then 1 
     when MAN.W_EVLT_CNB <> man.EVLT_CNB  and 
        (select count(1) from TBCSPAOE032M s1 where man.evl_yr = s1.evl_yr and MAN.HLYR_DVSN_CD = s1.HLYR_DVSN_CD
    and man.NEVLT_CNB = s1.NEVLT_CNB and man.W_EVLT_CNB = s1.EVL_CMTR_CNB and man.EVL_GP_CD = s1.EVL_CMTR_DVSN_CD) > 0 then 1
   else 0 end = 1
		   ]]>
		<isNotEmpty property="strEvlStaCd">
			AND NVL(EVL.EVL_STA_CD, '100') = #strEvlStaCd#
		</isNotEmpty>
	</select>

	<!-- 국장은 부장이 확정을 하지 않았으므로 평가 확정을 할 수 없다. 즉 부장이 확정 했는지 안했는지 체크 -->
	<select id="CSPAOE046EConfYnselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT (CASE WHEN COUNT(*) > 0 THEN 'N' ELSE 'Y' END) AS EVL_DTM_YN
			  FROM (
			    SELECT D1.EVL_YR 
			         , D1.HLYR_DVSN_CD 
			         , D1.EVL_GP_CD 
			         , D2.EVLT_CNB   /*평가자 전산번호*/
			         , D1.NEVLT_CNB  /*피평가자 전산번호*/
			         , D1.BLT_DPT_CD 
			         , D1.RANK_CD
			      FROM TBCSPAOE020D D1
			         , TBCSPAOE019D D2
			     WHERE D1.EVL_YR       = D2.EVL_YR
			       AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			       AND D1.EVL_GP_CD    = D2.EVL_GP_CD
			       AND D1.EVL_YR       = #strEvlYr#
			       AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			       AND D1.EVL_GP_CD    = #strEvlGpCd#
			       AND D1.NEVLT_CNB    = #strNevltCnb#
			       AND D2.EVLT_CNB    != #strEvlCmtrCnb# /*국장 본인이 안한건 빼야한다*/
			    ) MAN
			    , TBCSPAOE032M EVL
			WHERE MAN.EVL_YR                = EVL.EVL_YR (+)
			  AND MAN.HLYR_DVSN_CD          = EVL.HLYR_DVSN_CD (+)
			  AND MAN.NEVLT_CNB             = EVL.NEVLT_CNB (+)
			  AND MAN.EVLT_CNB              = EVL.EVL_CMTR_CNB (+)
			  AND NVL(EVL.EVL_DTM_YN, 'N') != 'Y' /*확정된거 제외*/
		 ]]>
	</select>

	<!-- 국장은 부장이 확정을 하지 않았으므로 평가 확정을 할 수 없다. 즉 부장이 확정 했는지 안했는지 체크 -->
	<select id="CSPAOE046EAuthSearchYnselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT 'Y' AS AUTH_SEARCH_YN
			  FROM TBCSPAOE019D
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND EVLT_CNB     = #strEvlCnb#
		 ]]>
	</select>
	
	<!-- 비중 수정 권한이 있는지 가져온다 -->
	<select id="CSPAOE046EWgtRateYnselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT (CASE WHEN COUNT(*) > 0 THEN '1' ELSE '0' END) AS WGT_RTE_YN
			  FROM TBCSPAOE020D
			 WHERE 1=1
			   AND EVL_YR       = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND EVL_GP_CD    = #strEvlGpCd#
			   AND NEVLT_CNB    = #strNevltCnb#
			   AND EVLT_CNB     = #strEvlCmtrCnb#
		 ]]>
	</select>

	<!-- 업무목록 -->
	<select id="CSPAOE046Esubselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT D1.EVL_YR        AS EVL_YR
			     , D1.HLYR_DVSN_CD  AS HLYR_DVSN_CD
			     , D1.PTCPT_CNB     AS NEVLT_CNB /*피평가자 전산번호*/
			     , D1.TSK_NO        AS TSK_NO
			     , D1.BLT_DPT_CD    AS BLT_DPT_CD
			     , D1.RANK_CD       AS RANK_CD
			     , D1.WGT_RTE       AS WGT_RTE
			     , D1.TSK_NM        AS TSK_NM
			     , D1.TSK_TXT       AS TSK_TXT
			     , NVL(D2.EVL_STA_CD, '100')                        AS EVL_STA_CD
			     , F_CODE_NM('1000280', NVL(D2.EVL_STA_CD, '100'))  AS EVL_STA_NM  /*평가상태*/
			     , D2.TSK_ASC       AS TSK_ASC
			     , D2.EVL_RK_CD     AS EVL_RK_CD
			     , #strEvlCmtrCnb#  AS EVL_CMTR_CNB     /*평가위원 전산번호*/
			     , #strEvlGpCd#     AS EVL_CMTR_DVSN_CD /*평가위원구분코드(평가군코드)*/
			     , #strEvlDptCd#    AS EVL_DPT_CD       /*평가귀원 부서코드*/
		         , D3.RK_ASC_100    AS RK_ASC_100       
		         , D3.RK_ASC_200    AS RK_ASC_200
		         , D3.RK_ASC_300    AS RK_ASC_300
		         , D3.RK_ASC_400    AS RK_ASC_400
		         , D3.RK_ASC_500    AS RK_ASC_500
		         , D3.RK_ASC_600    AS RK_ASC_600
		         , D3.RK_ASC_700    AS RK_ASC_700 
		         , D3.RK_ASC_800    AS RK_ASC_800	     
			  FROM TBCSPAOE028M D1
			     , TBCSPAOE032M D2
			     , (
			        SELECT EVL_YR                               AS EVL_YR         /* 평가년도 */
			             , HLYR_DVSN_CD                         AS HLYR_DVSN_CD   /* 반기구분코드 */
			             , TSK_DVSN_CD                          AS TSK_DVSN_CD    /* 업무구분코드 */
			             , AUD_TSK_KND_CD                       AS AUD_TSK_KND_CD /* 감사업무종류코드 */
			             , SUM(DECODE(RK_CD, '100', RK_ASC, 0)) AS RK_ASC_100     
			             , SUM(DECODE(RK_CD, '200', RK_ASC, 0)) AS RK_ASC_200
			             , SUM(DECODE(RK_CD, '300', RK_ASC, 0)) AS RK_ASC_300
			             , SUM(DECODE(RK_CD, '400', RK_ASC, 0)) AS RK_ASC_400
			             , SUM(DECODE(RK_CD, '500', RK_ASC, 0)) AS RK_ASC_500
			             , SUM(DECODE(RK_CD, '600', RK_ASC, 0)) AS RK_ASC_600
			             , SUM(DECODE(RK_CD, '700', RK_ASC, 0)) AS RK_ASC_700
			             , SUM(DECODE(RK_CD, '800', RK_ASC, 0)) AS RK_ASC_800
			          FROM TBCSPAOE010D 
			         WHERE EVL_YR         = #strEvlYr#
			           AND HLYR_DVSN_CD   = #strHlyrDvsnCd#
			           AND TSK_DVSN_CD    = '10003' /*운영직업무*/
                       AND AUD_TSK_KND_CD = '10000' /*공통*/
			           AND IDCT_YN        = 'Y'
			         GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_DVSN_CD, AUD_TSK_KND_CD			     
			     ) D3 /*평가등급별 기준관리에 등록된 등급평점 값을 가져온다.*/
			WHERE 1=1
			  AND D1.EVL_YR           = D2.EVL_YR (+)
			  AND D1.HLYR_DVSN_CD     = D2.HLYR_DVSN_CD (+)
			  AND D1.PTCPT_CNB        = D2.NEVLT_CNB (+)
			  AND D2.EVL_CMTR_CNB (+) = #strEvlCmtrCnb# /*평가자(로그인한)*/
			  AND D1.TSK_NO           = D2.TSK_NO (+)
			  AND D1.EVL_YR           = D3.EVL_YR
              AND D1.HLYR_DVSN_CD     = D3.HLYR_DVSN_CD
			  AND D1.EVL_YR           = #strEvlYr#
			  AND D1.HLYR_DVSN_CD     = #strHlyrDvsnCd#
			  AND D1.PTCPT_CNB        = #strNevltCnb# /*피평가자 전산번호*/
		  ]]>
	</select>

	<!-- 지원업무 평가관리 신규 or 수정된 정보를 저장한다. -->
	<update id="CSPAOE046Emaininsertupdate" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO TBCSPAOE032M
		    USING DUAL
			   ON ( 
					    EVL_YR        = #EVL_YR#
					AND HLYR_DVSN_CD  = #HLYR_DVSN_CD#
                    AND NEVLT_CNB     = #NEVLT_CNB#
                    AND EVL_CMTR_CNB  = #EVL_CMTR_CNB#
					AND TSK_NO        = #TSK_NO#
			  	   )
			WHEN MATCHED THEN 		
				UPDATE 
				   SET FNL_MDF_DH  = SYSDATE
		             , TSK_ASC     = #TSK_ASC# /*비중 * (등급평점/100) */
					 , EVL_DTM_YN  = #EVL_DTM_YN#
					 , EVL_STA_CD  = #EVL_STA_CD#
					 , EVL_RK_CD   = #EVL_RK_CD#
		]]>
					<isNotEmpty prepend="," property="FNL_USR_ID">
						FNL_USR_ID = #FNL_USR_ID#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
						FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_MNU_ID">
						FNL_MNU_ID = #FNL_MNU_ID#
					</isNotEmpty>
		<![CDATA[
            WHEN NOT MATCHED THEN 
				INSERT 
				    (
				       EVL_YR
					 , HLYR_DVSN_CD
					 , NEVLT_CNB
					 , EVL_CMTR_CNB
					 , TSK_NO
					 , BLT_DPT_CD
					 , RANK_CD
					 , TSK_DVSN_CD
					 , EVL_CMTR_DVSN_CD
					 , EVL_STA_CD
					 , EVL_RK_CD
					 , TSK_ASC
					 , EVL_DTM_YN
				 	 , FRT_USR_ID
				 	 , FNL_USR_ID
					 , FNL_DEAL_DPT_CD
					 , FNL_MNU_ID
					 , FRT_REGI_DH
					 , FNL_MDF_DH
					)  VALUES 
					(
				       #EVL_YR#
					 , #HLYR_DVSN_CD#
					 , #NEVLT_CNB#
					 , #EVL_CMTR_CNB#
					 , #TSK_NO#
					 , #BLT_DPT_CD#
					 , #RANK_CD#
					 , '10003' /*운영직업무*/
					 , #EVL_CMTR_DVSN_CD# 
					 , #EVL_STA_CD#
					 , #EVL_RK_CD#
					 , #TSK_ASC#
					 , #EVL_DTM_YN#
					 , #FNL_USR_ID#
					 , #FNL_USR_ID#
					 , #FNL_DEAL_DPT_CD#
					 , #FNL_MNU_ID#
					 , SYSDATE
					 , SYSDATE
					 )
		]]>
	</update>

	<!-- 비중 업뎃. -->
	<update id="CSPAOE046EmainWgtupdate" parameterClass="paramMap">
		<![CDATA[	
				UPDATE TBCSPAOE028M
				   SET FNL_MDF_DH  = SYSDATE
		             , WGT_RTE     = NVL(#WGT_RTE#, 0)
		]]>
					<isNotEmpty prepend="," property="FNL_USR_ID">
						FNL_USR_ID = #FNL_USR_ID#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
						FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_MNU_ID">
						FNL_MNU_ID = #FNL_MNU_ID#
					</isNotEmpty>
		<![CDATA[
		   WHERE EVL_YR        = #EVL_YR#
			 AND HLYR_DVSN_CD  = #HLYR_DVSN_CD#
			 AND PTCPT_CNB     = #NEVLT_CNB#
			 AND TSK_NO        = #TSK_NO#
		]]>
	</update>
	
	<!-- 비중 업뎃. -->
	<update id="CSPAOE046ETskAscReCalupdate" parameterClass="paramMap">
		<![CDATA[	
			 UPDATE /*+ bypass_ujvc */
			     (
			    SELECT ROUND(D3.RK_ASC * (NVL(D1.WGT_RTE, 0)/100), 2) AS RE_TSK_ASC
			         , D2.EVL_YR
			         , D2.HLYR_DVSN_CD
			         , D2.NEVLT_CNB
			         , D2.EVL_CMTR_CNB
			         , D2.TSK_NO
			         , D2.TSK_ASC
			         , #FNL_USR_ID#      AS FNL_USR_ID_A
			         , #FNL_DEAL_DPT_CD# AS FNL_DEAL_DPT_CD_A
			         , #FNL_MNU_ID#      AS FNL_MNU_ID_A
			         , D2.FNL_USR_ID
			         , D2.FNL_DEAL_DPT_CD
			         , D2.FNL_MNU_ID
			      FROM TBCSPAOE028M D1
			         , TBCSPAOE032M D2
			         , TBCSPAOE010D D3
			     WHERE D1.EVL_YR       = D2.EVL_YR
			       AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			       AND D1.PTCPT_CNB    = D2.NEVLT_CNB
			       AND D1.TSK_NO       = D2.TSK_NO
			       AND D2.EVL_YR       = D3.EVL_YR
			       AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD  
			       AND D2.EVL_RK_CD    = D3.RK_CD
			       AND D1.EVL_YR       = #EVL_YR#
			       AND D1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
			       AND D1.PTCPT_CNB    = #NEVLT_CNB#
			       AND D1.TSK_NO       = #TSK_NO#
			       AND D3.TSK_DVSN_CD  = '10003'
			     )
			  SET TSK_ASC = RE_TSK_ASC
			    , FNL_USR_ID = FNL_USR_ID_A
			    , FNL_DEAL_DPT_CD = FNL_DEAL_DPT_CD_A
			    , FNL_MNU_ID = FNL_MNU_ID_A
		]]>
	</update>

	<!-- 확정취소한다. -->
	<update id="CSPAOE046ENoConfupdate" parameterClass="paramMap">
		<![CDATA[	
				UPDATE TBCSPAOE035M
				   SET FNL_MDF_DH  = SYSDATE
		             , EVL_DTM_YN  = 'N'
		]]>
					<isNotEmpty prepend="," property="FNL_USR_ID">
						FNL_USR_ID = #FNL_USR_ID#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
						FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					</isNotEmpty>
					<isNotEmpty prepend="," property="FNL_MNU_ID">
						FNL_MNU_ID = #FNL_MNU_ID#
					</isNotEmpty>
		<![CDATA[
		   WHERE 1=1
		     AND EVL_YR          = #EVL_YR#
			 AND HLYR_DVSN_CD    = #HLYR_DVSN_CD#
			 AND TSK_DVSN_CD     = '10003'
			 AND AUD_TSK_KND_CD  = '10000'
			 AND TSK_NO          = #TSK_NO#
		]]>
	</update>
	
	<!-- 부장, 국장들이 평가한 총 평균 개인평점을 구해온다. -->
	<select id="CSPAOE046EAvgPsnTskAscselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
		   SELECT TO_CHAR(ROUND(SUM(D1.TSK_ASC) / D2.EVL_CNT, 2)) AS TSK_ASC
			 FROM TBCSPAOE032M D1
			    , (
				    SELECT COUNT(*) AS EVL_CNT 
				         , #EVL_YR# AS EVL_YR
				         , #HLYR_DVSN_CD# AS HLYR_DVSN_CD
				      FROM TBCSPAOE019D
				     WHERE EVL_YR       = #EVL_YR#
				       AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
				       AND EVL_GP_CD    = #EVL_CMTR_DVSN_CD#    
			    ) D2
			WHERE 1=1
			  AND D1.EVL_YR       = D2.EVL_YR
			  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			  AND D1.EVL_YR       = #EVL_YR#
			  AND D1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
			  AND D1.NEVLT_CNB    = #NEVLT_CNB#
			GROUP BY D2.EVL_CNT
		  ]]>
	</select>
	<!-- ############################### 관리운영직등 업무 평가관리 끝 (CSPAOE046E) ################################## -->

	<!-- ##################################### 감사사항별 실적명세 시작 (CSPAOE050Q) ################################# -->
	<!-- 감사사항별 실적명세를 조회한다. -->	
	<select id="CSPAOE050Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_DPT_INFO(D11.HNDL_DIV_DPT_CD, '1')      AS HNDL_DIV_DPT_NM   /*처리과부서코드*/
			     , F_USR_INFO(D11.SPVR_CNB, '2')             AS SPVR_NM           /*주관자명*/
			     , F_CODE_NM('1000270', D11.AUD_KND_CD)      AS AUD_KND_NM        /*감사종류*/ 
                 , D11.SYT_TRTM_YN                                                /*종합처리안 여부*/
			     , NVL(F_MNG_KND_AUDYRNO(D11.AUD_YR, D11.TSK_NO, D2.AUD_KND_CD, '-'),D11.AUD_YR || '-' || TSK_NO) AS EVL_YR_TSK                      /*감사연번호*/
			     , D11.AUD_SBJ_NM                                                 /*감사사항명*/
			     , F_CODE_NM('1000273', D11.AUD_STEP_CD_MIN) AS  AUD_STEP_CD_MIN  /*감사단계 - 단계기초*/
			     , F_CODE_NM('1000273', D11.AUD_STEP_CD_MAX) AS  AUD_STEP_CD_MAX  /*감사단계 - 단계기말*/
			     , D11.MNDY_CNT                                                   /*연인원*/
			     , D11.NMPTCPT_CNT                                                /*참여인원*/
			     , D11.RSV_INSPC_LUNH_DT	                                      /*예비조사단계 착수일*/
			     , D11.STND_ASC        AS STND_ASC          /*표준평점*/ 
			     , F_CODE_NM('1000274',D11.SYT_EVL_RK_CD)    AS SYT_EVL_RK_NM     /*종합평가 등급코드. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/  
			     , D11.SYT_EVL_ADVL_VAL  AS SYT_EVL_ADVL_VAL  /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
			     , D11.DRIVE_RTE_SUM     AS DRIVE_RTE_SUM     /*추진율*/      
			     , DLY_DT_SUM /*지연일*/
			     , ( CASE WHEN INSTR(DLY_DT_SUM, '-') = 0 AND ASP_RTE = 0 THEN '0.00'
                          WHEN INSTR(DLY_DT_SUM, '-') = 0 THEN  TO_CHAR(ASP_RTE,'FM99990.00')
			              ELSE '-' || TO_CHAR(ASP_RTE,'FM99990.00') END) AS ASP_RTE  /*가감점율*/
			     , ASP_STND_ASC      AS ASP_STND_ASC      /*가감평점*/
			     , SPE_ADD_SC        AS SPE_ADD_SC        /*특별가산점*/
			     , MDT_ASC           AS MDT_ASC           /*조정평점*/
			     /*, DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC AS TSK_ASC_SUM 최종평점(표준평점*성과가중치*추진율+가감평점+특별가산점+조정평점) - 가점일 경우엔 기준등급의 가중치에 따라 가점의 유무가 달라진다.*/
			     , CASE WHEN #strEvlYr# != '2019' THEN DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC
			            ELSE D11.STND_ASC
			            END TSK_ASC_SUM /*최종평점*/
			     , HNDL_DIV_DPT_CD
			     , (SELECT A.DPT_SNO
			     	  FROM (SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , NVL((SELECT B.DPT_SNO FROM TBDCMACM002M B WHERE B.DPT_CD = A.HIRK_DPT_CD), '36') AS DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) <> '000'
							   AND A.DPT_CD NOT IN ('150150', '150160', '150170', '150180')
							UNION
							SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , A.DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) = '000') A
					 WHERE DPT_CD = HNDL_DIV_DPT_CD) AS DPT_SNO
				 , (SELECT (CASE WHEN A.DPT_SNO != '32' THEN '0'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '150' THEN '1'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '141' THEN '2'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '100' THEN '3'
							END) DPT_SNO2
			     	  FROM (SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , NVL((SELECT B.DPT_SNO FROM TBDCMACM002M B WHERE B.DPT_CD = A.HIRK_DPT_CD), '36') AS DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) <> '000'
							   AND A.DPT_CD NOT IN ('150150', '150160', '150170', '150180')
							UNION
							SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , A.DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) = '000') A
					 WHERE DPT_CD = HNDL_DIV_DPT_CD) AS DPT_SNO2
				 , TO_CHAR(ROUND(ADVL_ASC, 2), 'FM99990.00') AS ADVL_ASC /* 가중평점 */
				 , TO_CHAR(DRIVE_RTE_ASC, 'FM99990.00') AS DRIVE_RTE_ASC /* (추진율 조정평점(추진평점) */
			  FROM (
			    SELECT HNDL_DIV_DPT_CD
			         , SPVR_CNB
			         , AUD_KND_CD
			         , AUD_YR
			         , TSK_NO
			         , AUD_SBJ_NM
			         , AUD_STEP_CD_MIN
			         , AUD_STEP_CD_MAX
			         , MNDY_CNT
			         , NMPTCPT_CNT /*참여인원*/
			         , RSV_INSPC_LUNH_DT	/*예비조사단계 착수일*/
			         , STND_ASC /*표준평점*/
			         , SYT_EVL_RK_CD
			         , SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
			         , DRIVE_RTE_SUM  /*추진율*/      
			         , DLY_DT_SUM /*지연일*/
			         , NVL(ASP_RTE, 0) AS ASP_RTE  /*가감점율*/
			         , SYT_TRTM_YN /*종합처리안 여부*/
			         , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, AUD_KND_CD, AUD_STEP_CD_MAX, DLY_DT_SUM, SYT_EVL_ADVL_VAL, TO_NUMBER(ASP_STND_ASC), AUD_YR, TSK_NO) AS ASP_STND_ASC /*가감평점*/
			         , SPE_ADD_SC /*특별가산점*/
			         , MDT_ASC /*조정평점*/
			         , STND_ASC * SYT_EVL_ADVL_VAL AS ADVL_ASC /* 가중평점 */
			         , DRIVE_RTE_ASC
			     FROM (			  
				    SELECT HNDL_DIV_DPT_CD
				         , SPVR_CNB
				         , AUD_KND_CD
				         , AUD_YR
				         , TSK_NO
				         , AUD_SBJ_NM
				         , AUD_STEP_CD_MIN
				         , AUD_STEP_CD_MAX
				         , MNDY_CNT
				         , NMPTCPT_CNT /*참여인원*/
				         , RSV_INSPC_LUNH_DT	/*예비조사단계 착수일*/
				         , STND_ASC /*표준평점*/
				         , SYT_EVL_RK_CD
				         , SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
				         , DRIVE_RTE_SUM  /*추진율*/      
				         , DLY_DT_SUM /*지연일*/
				         , NVL(ASP_RTE, 0) AS ASP_RTE  /*가감점율*/
				         , SYT_TRTM_YN /*종합처리안 여부*/
				         , DECODE(INSTR(DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN DRIVE_RTE_ASC IS NOT NULL THEN TO_CHAR(ROUND(DRIVE_RTE_ASC * NVL(ASP_RTE, 0) / 100, 2),'FM99990.00') 
				                ELSE TO_CHAR(ROUND(STND_ASC * SYT_EVL_ADVL_VAL * ( DRIVE_RTE_SUM / 100)  * (NVL(ASP_RTE, 0)/ 100)  , 2),'FM99990.00') END AS ASP_STND_ASC /*가감평점*/
				         , SPE_ADD_SC /*특별가산점*/
				         , MDT_ASC /*조정평점*/
				         , DRIVE_RTE_ASC
				     FROM (
				        SELECT HNDL_DIV_DPT_CD
				             , SPVR_CNB
				             , AUD_KND_CD
				             , AUD_YR
				             , TSK_NO
				             , AUD_SBJ_NM
				             , AUD_STEP_CD_MIN
				             , AUD_STEP_CD_MAX
				             , MNDY_CNT
				             , NMPTCPT_CNT /*참여인원*/
				             , RSV_INSPC_LUNH_DT	/*예비조사단계 착수일*/
				             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
				             , SYT_EVL_RK_CD
				             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
				             , DRIVE_RTE_SUM  /*추진율*/      
				             , DLY_DT_SUM /*지연일*/
				             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
				             , SYT_TRTM_YN /*종합처리안 여부*/
				             , NVL(SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS SPE_ADD_SC
				             , NVL(MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS MDT_ASC
				             , F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_KND_CD, AUD_STEP_CD_MIN, AUD_STEP_CD_MAX, MNDY_CNT, SYT_TRTM_YN, NVL(SYT_EVL_ADVL_VAL, 0)) AS DRIVE_RTE_ASC /*추진율 조정평점*/
				          FROM (
				            SELECT D5.HNDL_DIV_DPT_CD
				                 , D5.SPVR_CNB
				                 , D5.AUD_KND_CD
				                 , D5.AUD_YR
				                 , D5.TSK_NO
				                 , D5.AUD_SBJ_NM
				                 , D5.AUD_STEP_CD_MIN
				                 , D5.AUD_STEP_CD_MAX
				                 , D5.MNDY_CNT
				                 , ( SELECT COUNT(*) FROM TBCSPAOE023M WHERE AUD_YR = D5.AUD_YR AND TSK_NO = D5.TSK_NO AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ) AS NMPTCPT_CNT /*참여인원*/
				                 , ( SELECT LUNH_DT FROM TBCSPAOE022M WHERE AUD_YR = D5.AUD_YR AND TSK_NO = D5.TSK_NO AND AUD_STEP_CD = (SELECT MIN(AUD_STEP_CD) FROM TBCSPAOE022M WHERE AUD_YR = D5.AUD_YR AND TSK_NO = D5.TSK_NO AND LUNH_DT IS NOT NULL)) AS RSV_INSPC_LUNH_DT	/*예비조사단계 착수일 - 예비조사 제외 감사종류때문에 이렇게 쿼리가 지저분하지만 22TL에서 가장 감사단계 코드가 MIN인 것으로.. */
				                 , F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) AS STND_ASC /*표준평점*/
				                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
				                                          , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
				                                                     AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
				                                          , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
				                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D6.EVL_RK_CD, '200', D6.SYT_EVL_RK_CD, 'X', (SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ), 0) AS SYT_EVL_RK_CD
				                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
				                      FROM TBCSPAOE008D 
				                     WHERE EVL_YR        = #strEvlYr#
				                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
				                       AND TSK_DVSN_CD   = '10000' 
				                       AND AUD_KND_CD    = D5.AUD_KND_CD   
				                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
				                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
				                      FROM TBCSPAOE022M
				                     WHERE AUD_YR = D5.AUD_YR
				                       AND TSK_NO = D5.TSK_NO
				                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
				                 , D5.SYT_TRTM_YN /*종합처리안 여부*/
				                 , D6.SPE_ADD_SC
				                 , D6.MDT_ASC
				             FROM (
				                    SELECT D2.HNDL_DIV_DPT_CD
				                         , D2.SPVR_CNB
				                         , D2.AUD_KND_CD
				                         , D2.AUD_YR
				                         , D2.TSK_NO
				                         , D2.AUD_SBJ_NM
				                         , D1.AUD_STEP_CD_MIN
				                         , D1.AUD_STEP_CD_MAX
				                         , D2.MNDY_CNT
				                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
				                      FROM (
				                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
				                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
				                             , AUD_YR
				                             , TSK_NO
				                          FROM TBCSPAOE022M
				                         WHERE CMPT_DT IS NOT NULL
				                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
										  
				                         GROUP BY AUD_YR, TSK_NO
				                     ) D1
				                     , TBCSPAOE021M D2
				                 WHERE D1.AUD_YR = D2.AUD_YR
				                   AND D1.TSK_NO = D2.TSK_NO
								  ]]>			                   
			                   		<isNotEmpty property="strAudSbjNm">
										AND D2.AUD_SBJ_NM LIKE '%' || #strAudSbjNm# || '%'
									</isNotEmpty>
								<![CDATA[									
				                  ) D5
				                  , (
				                    SELECT D8.AUD_TSK_KND_CD
				                         , D8.AUD_YR
				                         , D8.TSK_NO
				                         , D8.SYT_EVL_ADVL_VAL
				                         , D8.EVL_YR
				                         , D8.HLYR_DVSN_CD
				                         , D8.TSK_DVSN_CD
				                         , D8.EVL_RK_CD
				                         , D8.SYT_EVL_RK_CD
				                         , D8.EVL_STEP_CD
				                         , D8.DRIVE_RTE_ASC /*추진율평점 - 표준평점*종합평점가중치*추진율*/
				                         , D8.SPE_ADD_SC
				                         , D8.MDT_ASC
				                       FROM (
				                        SELECT AUD_TSK_KND_CD
				                             , AUD_YR
				                             , TSK_NO
				                             , MAX(EVL_STEP_CD) AS EVL_STEP_CD
				                             , EVL_YR 
				                             , HLYR_DVSN_CD
				                             , TSK_DVSN_CD
				                          FROM TBCSPAOE029M
				                         WHERE TSK_DVSN_CD  = '10000' /*감사업무*/
				                           AND EVL_STA_CD   = '300' /*평가완료*/
				                           AND (AUD_YR, TSK_NO, EVL_STEP_CD) 
                                                   IN (SELECT AUD_YR, TSK_NO, MAX(EVL_STEP_CD)
                                                       FROM TBCSPAOE029M 
                                                       WHERE  (AUD_YR,TSK_NO) IN (SELECT
                                                       AUD_YR ,
                                                       TSK_NO
                                                  FROM TBCSPAOE022M
                                                 WHERE CMPT_DT IS NOT NULL
                                                   AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                 GROUP BY AUD_YR,
                                                       TSK_NO )
                                                       GROUP BY AUD_YR, TSK_NO  )
				                         GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_DVSN_CD, AUD_TSK_KND_CD, AUD_YR, TSK_NO /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
				                     ) D7
				                     , TBCSPAOE029M D8
				                    WHERE D7.EVL_YR = D8.EVL_YR
				                      AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
				                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
				                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
				                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
				                      AND D7.AUD_YR = D8.AUD_YR
				                      AND D7.TSK_NO = D8.TSK_NO
				                ) D6 /*감사사항 평가관리*/
				                , TBCSPAOE010D D7
				            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
				              AND D5.AUD_YR          = D6.AUD_YR         (+)
				              AND D5.TSK_NO          = D6.TSK_NO         (+)
				              AND D6.EVL_YR = D7.EVL_YR (+) 
				              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
				              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
				              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
				              AND D6.EVL_RK_CD = D7.RK_CD (+)
						  ]]>			                   
							<isNotEmpty property="strSytTrtmYn">
								AND NVL(D5.SYT_TRTM_YN, 'N') = #strSytTrtmYn#
							</isNotEmpty>
						<![CDATA[			              
				          ) D9
				      ) D10
			      ) D12
			  ) D11 , TBBADDED001M D2
		WHERE 1 = 1  
		AND D11.AUD_YR = D2.AUD_YR(+)
 		AND D11.TSK_NO = D2.AUD_NO(+)
 		]]>
			<isNotEmpty property="strAudYr">
				AND D11.AUD_YR = #strAudYr#
			</isNotEmpty>
			<isNotEmpty property="strTskNo">
				AND CASE WHEN LENGTH(#strTskNo#) = 3 AND D2.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D11.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			D2.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1)
		</isNotEmpty>
										<![CDATA[
	    ORDER BY DPT_SNO, DPT_SNO2, HNDL_DIV_DPT_CD, EVL_YR_TSK
		  ]]>
	</select>
	<!-- ##################################### 감사사항별 실적명세 끝 (CSPAOE050Q) ################################ -->

	<!-- ##################################### 감사업무 개인별 기여율 시작 (CSPAOE051Q) ############################ -->
	<select id="CSPAOE051Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D2.AUD_KND_CD, '-'),D1.EVL_YR_TSK_NO) AS EVL_YR_TSK_NO   /*감사연변호*/
			     , D1.AUD_SBJ_NM      /*감사사항명*/
			     , D1.HIRK_DPT_NM     /*국*/  
			     , D1.HNDL_DIV_DPT_NM /*과*/
			     , D1.AUD_KND_NM      /*감사종류*/
			     , D1.MNDY_CNT        /*연인원*/
			     , D1.PTCPT_CNT       /*단계기말 참여인원수*/
			     , D1.DPT_DIV         /*구분*/
			     , D1.BLT_DPT_NM      /*소속부서*/
			     , D1.RANK_CD
			     , D1.RANK_NM         /*직급명*/
			     , D1.PTCPT_NM        /*성명*/
			     , D1.PTCPT_CNB
			     , D1.JON_DVSN_CD
			     , D1.JON_DVSN_NM     /*참여구분*/
			     , D1.CTB_RTE         /*기여율*/
			     , D1.EVL_RFR_SBJ_TXT /*평가참고사항내용*/
			     , DECODE(CTB_RTE_A, 0, 0||'(' || 0 || '/' || 0 || ')', ROUND(CTB_RTE_A/PTCPT_CNT_A, 2) || '(' || CTB_RTE_A || '/' || PTCPT_CNT_A || ')' ) AS CTB_RTE_SUM_A /*주관부서 기여율 합계*/
			     , DECODE(CTB_RTE_B, 0, 0||'(' || 0 || '/' || 0 || ')', ROUND(CTB_RTE_B/PTCPT_CNT_B, 2) || '(' || CTB_RTE_B || '/' || PTCPT_CNT_B || ')' ) AS CTB_RTE_SUM_B /*지원부서 기여율 합계*/
			     , DENSE_RANK() OVER(ORDER BY EVL_YR_TSK_NO) AS RANK_NUM
			     , D1.HNDL_DIV_DPT_CD
			     , (SELECT A.DPT_SNO
			     	  FROM (SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , NVL((SELECT B.DPT_SNO FROM TBDCMACM002M B WHERE B.DPT_CD = A.HIRK_DPT_CD), '36') AS DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) <> '000'
							   AND A.DPT_CD NOT IN ('150150', '150160', '150170', '150180')
							UNION
							SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , A.DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) = '000') A
					 WHERE DPT_CD = HNDL_DIV_DPT_CD) AS DPT_SNO
				 , (SELECT (CASE WHEN A.DPT_SNO != '32' THEN '0'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '150' THEN '1'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '141' THEN '2'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '100' THEN '3'
							END) DPT_SNO2
			     	  FROM (SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , NVL((SELECT B.DPT_SNO FROM TBDCMACM002M B WHERE B.DPT_CD = A.HIRK_DPT_CD), '36') AS DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) <> '000'
							   AND A.DPT_CD NOT IN ('150150', '150160', '150170', '150180')
							UNION
							SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , A.DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) = '000') A
					 WHERE DPT_CD = HNDL_DIV_DPT_CD) AS DPT_SNO2
				 , BLT_DPT_CD
				 , (SELECT A.DPT_SNO
			     	  FROM (SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , NVL((SELECT B.DPT_SNO FROM TBDCMACM002M B WHERE B.DPT_CD = A.HIRK_DPT_CD), '36') AS DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) <> '000'
							   AND A.DPT_CD NOT IN ('150150', '150160', '150170', '150180')
							UNION
							SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , A.DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) = '000') A
					 WHERE DPT_CD = BLT_DPT_CD) AS DPT_SNO3
				 , (SELECT (CASE WHEN A.DPT_SNO != '32' THEN '0'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '150' THEN '1'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '141' THEN '2'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '100' THEN '3'
							END) DPT_SNO2
			     	  FROM (SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , NVL((SELECT B.DPT_SNO FROM TBDCMACM002M B WHERE B.DPT_CD = A.HIRK_DPT_CD), '36') AS DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) <> '000'
							   AND A.DPT_CD NOT IN ('150150', '150160', '150170', '150180')
							UNION
							SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , A.DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) = '000') A
					 WHERE DPT_CD = BLT_DPT_CD) AS DPT_SNO4
			  FROM (
			    SELECT D3.AUD_YR || '-' || D3.TSK_NO AS EVL_YR_TSK_NO /*감사연변호*/
			    	 , D3.AUD_YR
			         , D3.AUD_SBJ_NM      /*감사사항명*/
			         , D3.HIRK_DPT_NM     /*국*/  
			         , D3.HNDL_DIV_DPT_CD
			         , D3.HNDL_DIV_DPT_NM /*과*/
			         , F_CODE_NM('1000270', D3.AUD_KND_CD) AS AUD_KND_NM /*감사종류*/
			         , D3.MNDY_CNT        /*연인원*/
			         , (
			             SELECT COUNT(PTCPT_CNB) AS PTCPT_CNT
			               FROM TBCSPAOE023M
			              WHERE AUD_YR       = D3.AUD_YR
			                AND TSK_NO       = D3.TSK_NO
			                AND AUD_STEP_CD  = D3.AUD_STEP_CD_MAX    
			         ) AS PTCPT_CNT /*단계기말 참여인원수*/
			         , (
			             SELECT COUNT(PTCPT_CNB) AS PTCPT_CNT
			               FROM TBCSPAOE023M
			              WHERE AUD_YR       = D3.AUD_YR
			                AND TSK_NO       = D3.TSK_NO
			                AND AUD_STEP_CD  = D3.AUD_STEP_CD_MAX  
			                AND BLT_DPT_CD   = D3.HNDL_DIV_DPT_CD  
			         ) AS PTCPT_CNT_A /*주관부서 단계기말 참여인원수*/
			         , (
			             SELECT COUNT(PTCPT_CNB) AS PTCPT_CNT
			               FROM TBCSPAOE023M
			              WHERE AUD_YR       = D3.AUD_YR
			                AND TSK_NO       = D3.TSK_NO
			                AND AUD_STEP_CD  = D3.AUD_STEP_CD_MAX  
			                AND BLT_DPT_CD  != D3.HNDL_DIV_DPT_CD    
			         ) AS PTCPT_CNT_B /*지원부서 단계기말 참여인원수*/
			         , D3.DPT_DIV   /*구분*/
			         , D3.BLT_DPT_CD
			         , F_DPT_INFO(D3.BLT_DPT_CD, '1')       AS BLT_DPT_NM  /*소속부서*/
			         , D3.RANK_CD
			         , F_CODE_NM('1000173', D3.RANK_CD)     AS RANK_NM     /*직급명*/
			         , F_USR_INFO(D3.PTCPT_CNB, '2')        AS PTCPT_NM    /*성명*/
			         , D3.PTCPT_CNB
			         , D3.JON_DVSN_CD
			         , F_CODE_NM('1000278', D3.JON_DVSN_CD) AS JON_DVSN_NM /*참여구분*/
			         , D3.CTB_RTE         /*기여율*/
			         , D3.EVL_RFR_SBJ_TXT /*평가참고사항내용*/
			         , (SELECT NVL(SUM(CTB_RTE), 0) 
			              FROM TBCSPAOE023M 
			             WHERE AUD_YR = D3.AUD_YR AND TSK_NO = D3.TSK_NO AND AUD_STEP_CD = D3.AUD_STEP_CD_MAX 
                           AND BLT_DPT_CD = D3.HNDL_DIV_DPT_CD ) AS CTB_RTE_A /*주관부서 기여율 합계*/
                     , (SELECT NVL(SUM(CTB_RTE), 0) 
                          FROM TBCSPAOE023M 
                         WHERE AUD_YR = D3.AUD_YR AND TSK_NO = D3.TSK_NO AND AUD_STEP_CD = D3.AUD_STEP_CD_MAX 
                           AND BLT_DPT_CD != D3.HNDL_DIV_DPT_CD ) AS CTB_RTE_B /*지원부서 기여율 합계*/
			         , D3.TSK_NO
			      FROM (
			            /*주관부서 평균*/
			            SELECT D1.AUD_YR /*평가년도*/
			                 , D1.TSK_NO /*업무번호*/
			                 , D1.AUD_SBJ_NM AS AUD_SBJ_NM /*감사사항명*/
			                 , D1.HNDL_DIV_DPT_CD
			                 , F_DPT_INFO(DECODE(D3.HIRK_DPT_CD, NULL, D1.HNDL_DIV_DPT_CD, D3.HIRK_DPT_CD), '1') AS HIRK_DPT_NM /*국*/  
			                 , F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM /*과*/
			                 , D1.AUD_KND_CD /*감사종류*/
			                 , D1.MNDY_CNT AS MNDY_CNT /*연인원*/
			                 , '주관부서' AS DPT_DIV
			                 , D2.BLT_DPT_CD /*소속부서*/
			                 , D2.RANK_CD /*직급명*/
			                 , D2.PTCPT_CNB /*성명*/
			                 , D2.JON_DVSN_CD /*참여구분*/
			                 , D2.CTB_RTE /*기여율*/
			                 , D2.EVL_RFR_SBJ_TXT /*평가참고사항내용*/
			                 , D2.AUD_STEP_CD AS AUD_STEP_CD_MAX /*단계*/
			                 , 1 AS ORD
			              FROM TBCSPAOE021M D1
			                 , (
		                    SELECT D6.AUD_YR
		                         , D6.TSK_NO
		                         , D6.BLT_DPT_CD /*소속부서*/
		                         , D6.RANK_CD /*직급명*/
		                         , D6.PTCPT_CNB /*성명*/
		                         , D6.JON_DVSN_CD /*참여구분*/
		                         , D6.CTB_RTE /*기여율*/
		                         , D6.EVL_RFR_SBJ_TXT /*평가참고사항내용*/
		                         , D6.AUD_STEP_CD /*단계*/
		                      FROM (		                      
                                SELECT AUD_YR 
                                     , TSK_NO 
                                     , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                  FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */
                                 WHERE 1 = 1
                                   AND CMPT_DT IS NOT NULL
                                   AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                 GROUP BY AUD_YR, TSK_NO		                       		                       
		                        ) D5
		                        , TBCSPAOE023M D6
		                    WHERE D5.AUD_YR = D6.AUD_YR
		                      AND D5.TSK_NO = D6.TSK_NO
		                      AND D5.AUD_STEP_CD_MAX = D6.AUD_STEP_CD     			                 
			                 ) D2
			                 , TBDCMACM002M D3
			             WHERE D1.AUD_YR          = D2.AUD_YR
			               AND D1.TSK_NO          = D2.TSK_NO
			               AND D1.HNDL_DIV_DPT_CD = D2.BLT_DPT_CD
			               AND D1.HNDL_DIV_DPT_CD = D3.DPT_CD
			               
			            UNION ALL
			            
			            /*지원부서 평균*/
			            SELECT D1.AUD_YR /*평가년도*/
			                 , D1.TSK_NO /*업무번호*/
			                 , D1.AUD_SBJ_NM AS AUD_SBJ_NM /*감사사항명*/
			                 , D1.HNDL_DIV_DPT_CD
			                 , F_DPT_INFO(DECODE(D3.HIRK_DPT_CD, NULL, D1.HNDL_DIV_DPT_CD, D3.HIRK_DPT_CD), '1') AS HIRK_DPT_NM /*국*/  
			                 , F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM /*과*/
			                 , D1.AUD_KND_CD /*감사종류*/
			                 , D1.MNDY_CNT AS MNDY_CNT /*연인원*/
			                 , '지원부서' AS DPT_DIV
			                 , D2.BLT_DPT_CD /*소속부서*/
			                 , D2.RANK_CD /*직급명*/
			                 , D2.PTCPT_CNB /*성명*/
			                 , D2.JON_DVSN_CD /*참여구분*/
			                 , D2.CTB_RTE /*기여율*/
			                 , D2.EVL_RFR_SBJ_TXT /*평가참고사항내용*/
			                 , D2.AUD_STEP_CD AS AUD_STEP_CD_MAX /*단계*/
			                 , 2 AS ORD
			              FROM TBCSPAOE021M D1
			                 , (
		                    SELECT D6.AUD_YR
		                         , D6.TSK_NO
		                         , D6.BLT_DPT_CD /*소속부서*/
		                         , D6.RANK_CD /*직급명*/
		                         , D6.PTCPT_CNB /*성명*/
		                         , D6.JON_DVSN_CD /*참여구분*/
		                         , D6.CTB_RTE /*기여율*/
		                         , D6.EVL_RFR_SBJ_TXT /*평가참고사항내용*/
		                         , D6.AUD_STEP_CD /*단계*/
		                      FROM (
                                SELECT AUD_YR 
                                     , TSK_NO 
                                     , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                  FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */
                                 WHERE 1 = 1
                                   AND CMPT_DT IS NOT NULL
                                   AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                 GROUP BY AUD_YR, TSK_NO
		                        ) D5
		                        , TBCSPAOE023M D6
		                    WHERE D5.AUD_YR = D6.AUD_YR
		                      AND D5.TSK_NO = D6.TSK_NO
		                      AND D5.AUD_STEP_CD_MAX = D6.AUD_STEP_CD     			                 
			                 ) D2
			                 , TBDCMACM002M D3
			             WHERE D1.AUD_YR           = D2.AUD_YR
			               AND D1.TSK_NO           = D2.TSK_NO
			               AND D1.HNDL_DIV_DPT_CD != D2.BLT_DPT_CD
			               AND D1.HNDL_DIV_DPT_CD  = D3.DPT_CD
			            ORDER BY HNDL_DIV_DPT_CD, ORD, JON_DVSN_CD
			    ) D3 
		    WHERE 1 = 1
		  ]]>
		<isNotEmpty property="strAudYr">
			AND D3.AUD_YR = #strAudYr#
		</isNotEmpty>
		
		<isNotEmpty property="strAudSbjNm">
			AND D3.AUD_SBJ_NM LIKE '%' || #strAudSbjNm# || '%'
		</isNotEmpty>
		<![CDATA[	
			  ) D1 ,TBBADDED001M D2
		  WHERE 1 = 1
		  AND D1.AUD_YR = D2.AUD_YR(+)
 		  AND D1.TSK_NO = D2.AUD_NO(+)
 		]]>
 		<isNotEmpty property="strTskNo">
			AND CASE WHEN LENGTH(#strTskNo#) = 3 AND D2.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D1.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			D2.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1)
		</isNotEmpty>
 		<![CDATA[
		  ORDER BY DPT_SNO, DPT_SNO2, HNDL_DIV_DPT_CD, EVL_YR_TSK_NO, JON_DVSN_CD DESC, DPT_SNO3, DPT_SNO4, BLT_DPT_CD, RANK_CD
		  ]]>
	</select>
	<!-- ############################## 감사업무 개인별 기여율 끝 (CSPAOE051Q) ##################################### -->

	<!-- ############################### 감사업무 과별 기여율 시작 (CSPAOE052Q) ##################################### -->
	<select id="CSPAOE052Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT EVL_YR || '-' || TSK_NO  AS EVL_YR_TSK_NO /*감사연번호*/
			     , AUD_SBJ_NM                                /*감사사항명*/
			     , F_DPT_INFO(BLT_DPT_CD, '1') AS BLT_DPT_NM /*부서명*/
			     , PTCPT_CNT                                 /*참여인원*/
			     , DPT_DIV                                   /*구분*/
			     , BLT_DPT_PTCPT_CNT                         /*과별 참여인원*/ 
			     , BLT_DPT_PTCPT_CNT * 100 / PTCPT_ALL_CNT AS BLT_DPT_PTCPT_RTE                 /*과별 참여율*/
			     , CTB_RTE_SUM                               /*과별 기여율*/
			     , CTB_RTE_SUM / (BLT_DPT_PTCPT_CNT * 100 / PTCPT_ALL_CNT) AS BLT_DPT_CTB_RTE /*기여율 배분수치*/
			  FROM (
			    SELECT D3.EVL_YR
			         , D3.HLYR_DVSN_CD
			         , D3.TSK_NO
			         , D3.AUD_SBJ_NM
			         , D3.DPT_DIV
			         , D3.BLT_DPT_CD
			         , D3.BLT_DPT_PTCPT_CNT  /*과별 참여인원*/ 
			         , D3.CTB_RTE_SUM        /*과별 기여율*/
			         , (
			             SELECT COUNT(PTCPT_CNB) AS PTCPT_CNT
			               FROM TBCSPAOE023M
			              WHERE EVL_YR       = D4.EVL_YR
			                AND HLYR_DVSN_CD = D4.HLYR_DVSN_CD
			                AND TSK_NO       = D4.TSK_NO
			                AND AUD_STEP_CD  = D4.AUD_STEP_CD_MAX    
			         ) AS PTCPT_CNT     /*단계기말 참여인원수*/
			         , D4.PTCPT_ALL_CNT /*전체 참여 인원수*/
			         , D3.ORD    
			      FROM (
			        /*주관부서*/
			        SELECT D1.EVL_YR
			             , D1.HLYR_DVSN_CD
			             , D1.TSK_NO
			             , MAX(D1.AUD_SBJ_NM) AS AUD_SBJ_NM /*감사사항명*/
			             , '주관부서' AS DPT_DIV
			             , D2.BLT_DPT_CD
			             , COUNT(*) OVER(PARTITION BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.TSK_NO, D2.BLT_DPT_CD) AS BLT_DPT_PTCPT_CNT /*과별 참여인원*/ 
			             , SUM(CTB_RTE) AS CTB_RTE_SUM /*과별 기여율*/
			             , 1 AS ORD
			          FROM TBCSPAOE021M D1
			             , TBCSPAOE023M D2
			        WHERE D1.EVL_YR          = D2.EVL_YR
			          AND D1.HLYR_DVSN_CD    = D2.HLYR_DVSN_CD
			          AND D1.TSK_NO          = D2.TSK_NO
			          AND D1.HNDL_DIV_DPT_CD = D2.BLT_DPT_CD
			          AND D1.EVL_YR          = #strEvlYr#
			          AND D1.HLYR_DVSN_CD    = #strHlyrDvsnCd#
			        GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.TSK_NO, D2.BLT_DPT_CD  
			
			        UNION ALL
			
			        /*지원부서*/
			        SELECT D1.EVL_YR
			             , D1.HLYR_DVSN_CD
			             , D1.TSK_NO
			             , MAX(D1.AUD_SBJ_NM) AS AUD_SBJ_NM /*감사사항명*/
			             , '지원부서' AS DPT_DIV
			             , D2.BLT_DPT_CD
			             , COUNT(*) OVER(PARTITION BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.TSK_NO, D2.BLT_DPT_CD) AS BLT_DPT_PTCPT_CNT /*과별 참여인원*/ 
			             , SUM(CTB_RTE) AS CTB_RTE_SUM /*과별 참여율*/
			             , 2 AS ORD
			          FROM TBCSPAOE021M D1
			             , TBCSPAOE023M D2
			        WHERE D1.EVL_YR           = D2.EVL_YR
			          AND D1.HLYR_DVSN_CD     = D2.HLYR_DVSN_CD
			          AND D1.TSK_NO           = D2.TSK_NO
			          AND D1.HNDL_DIV_DPT_CD != D2.BLT_DPT_CD
			          AND D1.EVL_YR           = #strEvlYr#
			          AND D1.HLYR_DVSN_CD     = #strHlyrDvsnCd#
			        GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.TSK_NO, D2.BLT_DPT_CD
			    ) D3
			    , (
			        SELECT MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX
			             , EVL_YR
			             , HLYR_DVSN_CD
			             , TSK_NO
			             , COUNT(*) AS PTCPT_ALL_CNT
			          FROM TBCSPAOE023M 
			         WHERE EVL_YR       = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			         GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_NO
			    ) D4 /*단계기말 참여인원수*/
			    WHERE D3.EVL_YR       = D4.EVL_YR
			      AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD 
			      AND D3.TSK_NO       = D4.TSK_NO 
			)
		  WHERE 1 = 1
		  ORDER BY EVL_YR || TSK_NO, ORD
		  ]]>
	</select>
	<!-- ##################################### 감사업무 과별 기여율 끝 (CSPAOE052Q) ##################################### -->

	<!-- ##################################### 감사사항별 가중치 시작 (CSPAOE053Q) ##################################### -->
	<select id="CSPAOE053Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_CODE_NM('1000270', D1.AUD_TSK_KND_CD) AS AUD_TSK_KND_NM /*감사종류*/
			     , NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D2.AUD_KND_CD, '-'),D1.AUD_YR || '-' || D1.TSK_NO)           AS EVL_YR_TSK_NO  /*감사연번호*/
			     , D1.AUD_SBJ_NM     /*감사사항명*/
			     , F_CODE_NM('1000274', D1.EVL_RK_CD)      AS EVL_RK_NM      /*귀청보고 평가등급*/
			     , EVL_INDEX_NM_PJCD01
			     , EVL_INDEX_NM_PJCD02
			     , EVL_INDEX_NM_PJCD03
			     , EVL_INDEX_NM_PJCD04
			     , EVL_INDEX_NM_PJCD05
			     , EVL_INDEX_NM_PJCD06
			     , F_CODE_NM('1000274', EVL_RK_CD_PJCD01) AS EVL_RK_CD_PJCD01
			     , F_CODE_NM('1000274', EVL_RK_CD_PJCD02) AS EVL_RK_CD_PJCD02
			     , F_CODE_NM('1000274', EVL_RK_CD_PJCD03) AS EVL_RK_CD_PJCD03
			     , F_CODE_NM('1000274', EVL_RK_CD_PJCD04) AS EVL_RK_CD_PJCD04
			     , F_CODE_NM('1000274', EVL_RK_CD_PJCD05) AS EVL_RK_CD_PJCD05
			     , F_CODE_NM('1000274', EVL_RK_CD_PJCD06) AS EVL_RK_CD_PJCD06
			     , F_CODE_NM('1000274', SYT_EVL_RK_CD)    AS SYT_EVL_RK_CD  /*종합평가등급코드*/
			     , TO_CHAR(SYT_EVL_ADVL_VAL,'FM99999.00') AS SYT_EVL_ADVL_VAL /*종합평가가중치값*/
			     , F_DPT_INFO(HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM /*2014.02.04 최원형 감사관 요청*/
			 FROM (    		
				SELECT D3.AUD_TSK_KND_CD /*감사종류*/
				     , D3.AUD_YR 
				     , D3.TSK_NO          
				     , (SELECT AUD_SBJ_NM FROM TBCSPAOE021M WHERE AUD_YR = D3.AUD_YR AND TSK_NO = D3.TSK_NO) AS AUD_SBJ_NM     /*감사사항명*/
				     , D3.EVL_RK_CD     /*귀청보고 평가등급*/
				     , D6.EVL_INDEX_NM_PJCD01
				     , D6.EVL_INDEX_NM_PJCD02
				     , D6.EVL_INDEX_NM_PJCD03
				     , D6.EVL_INDEX_NM_PJCD04
				     , D6.EVL_INDEX_NM_PJCD05
				     , D6.EVL_INDEX_NM_PJCD06
				     , D6.EVL_RK_CD_PJCD01
				     , D6.EVL_RK_CD_PJCD02
				     , D6.EVL_RK_CD_PJCD03
				     , D6.EVL_RK_CD_PJCD04
				     , D6.EVL_RK_CD_PJCD05
				     , D6.EVL_RK_CD_PJCD06
				     , D3.SYT_EVL_RK_CD
				     , D3.SYT_EVL_ADVL_VAL    
				     , D7.HNDL_DIV_DPT_CD                                    
				  FROM (
				    SELECT D1.EVL_YR
				         , D1.HLYR_DVSN_CD
				         , D1.TSK_DVSN_CD
				         , D1.AUD_TSK_KND_CD
				         , D1.EVL_STEP_CD
				         , D1.EVL_CMTR_CNB
	                     , D1.AUD_YR
				         , D1.TSK_NO
				         , D1.SYT_EVL_RK_CD
				         , D1.SYT_EVL_ADVL_VAL
	                     , CASE WHEN  EVL_STEP_CD = '100' THEN D1.EVL_RK_CD
		                        ELSE (SELECT S1.EVL_RK_CD 
		                                FROM TBCSPAOE029M S1
		                               WHERE S1.AUD_YR = D1.AUD_YR
		                               AND S1.TSK_NO = D1.TSK_NO
		                               AND S1.EVL_STEP_CD = '100') END EVL_RK_CD
				      FROM TBCSPAOE029M D1
				     WHERE 1 = 1
				       AND D1.TSK_DVSN_CD  = '10000' /*감사업무*/
				       AND D1.EVL_DTM_YN   = 'Y'
				       AND (AUD_YR, TSK_NO, EVL_STEP_CD) 
                                                   IN (SELECT AUD_YR, TSK_NO, MAX(EVL_STEP_CD)
                                                       FROM TBCSPAOE029M 
                                                       WHERE  (AUD_YR,TSK_NO) IN (SELECT
                                                       AUD_YR ,
                                                       TSK_NO
                                                  FROM TBCSPAOE022M,
                                                  (SELECT EVL_STR_DT,
			                                               EVL_END_DT
			                                          FROM TBCSPAOE001M
			                                         WHERE EVL_YR = '2018'
			                                           AND HLYR_DVSN_CD = '10') SS
                                                 WHERE CMPT_DT IS NOT NULL
                                                   AND CMPT_DT BETWEEN SS.EVL_STR_DT AND SS.EVL_END_DT
                                                 GROUP BY AUD_YR,
                                                       TSK_NO )
                                                       GROUP BY AUD_YR, TSK_NO  ) 
			  ]]>
			<isNotEmpty property="strAudTskKndCd">
				AND D1.AUD_TSK_KND_CD = #strAudTskKndCd#
			</isNotEmpty>
			<isNotEmpty property="strAudYr">
				AND D1.AUD_YR = #strAudYr#
			</isNotEmpty>
			
			<![CDATA[				      
				) D3 /*평가완료한 것만 보여준다*/
				,(
					SELECT EVL_YR
					     , HLYR_DVSN_CD
					     , TSK_DVSN_CD
					     , AUD_TSK_KND_CD
					     , EVL_STEP_CD
					     , EVL_CMTR_CNB
					     , TSK_NO
					     , AUD_YR
					     , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD01) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD01, 1, INSTR(EVL_INDEX_NM_PJCD01, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD01, (INSTR(EVL_INDEX_NM_PJCD01, ' ')+1))
					            ELSE EVL_INDEX_NM_PJCD01 END EVL_INDEX_NM_PJCD01
					     , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD02) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD02, 1, INSTR(EVL_INDEX_NM_PJCD02, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD02, (INSTR(EVL_INDEX_NM_PJCD02, ' ')+1))
					            ELSE EVL_INDEX_NM_PJCD02 END EVL_INDEX_NM_PJCD02
					     , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD03) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD03, 1, INSTR(EVL_INDEX_NM_PJCD03, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD03, (INSTR(EVL_INDEX_NM_PJCD03, ' ')+1))
					            ELSE EVL_INDEX_NM_PJCD03 END EVL_INDEX_NM_PJCD03
					     , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD04) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD04, 1, INSTR(EVL_INDEX_NM_PJCD04, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD04, (INSTR(EVL_INDEX_NM_PJCD04, ' ')+1))
					            ELSE EVL_INDEX_NM_PJCD04 END EVL_INDEX_NM_PJCD04
					     , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD05) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD05, 1, INSTR(EVL_INDEX_NM_PJCD05, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD05, (INSTR(EVL_INDEX_NM_PJCD05, ' ')+1))
					            ELSE EVL_INDEX_NM_PJCD05 END EVL_INDEX_NM_PJCD05
					     , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD06) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD06, 1, INSTR(EVL_INDEX_NM_PJCD06, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD06, (INSTR(EVL_INDEX_NM_PJCD06, ' ')+1))
					            ELSE EVL_INDEX_NM_PJCD06 END EVL_INDEX_NM_PJCD06
					     , EVL_RK_CD_PJCD01
					     , EVL_RK_CD_PJCD02
					     , EVL_RK_CD_PJCD03
					     , EVL_RK_CD_PJCD04
					     , EVL_RK_CD_PJCD05
					     , EVL_RK_CD_PJCD06
					  FROM (
					    SELECT D5.EVL_YR
					         , D5.HLYR_DVSN_CD
					         , D5.TSK_DVSN_CD
					         , D5.AUD_TSK_KND_CD
					         , D5.EVL_STEP_CD
					         , D5.EVL_CMTR_CNB
					         , D5.TSK_NO
					         , D5.AUD_YR
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD01', D6.EVL_INDEX_NM, '' )) AS EVL_INDEX_NM_PJCD01
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD02', D6.EVL_INDEX_NM, '' )) AS EVL_INDEX_NM_PJCD02
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD03', D6.EVL_INDEX_NM, '' )) AS EVL_INDEX_NM_PJCD03
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD04', D6.EVL_INDEX_NM, '' )) AS EVL_INDEX_NM_PJCD04
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD05', D6.EVL_INDEX_NM, '' )) AS EVL_INDEX_NM_PJCD05
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD06', D6.EVL_INDEX_NM, '' )) AS EVL_INDEX_NM_PJCD06
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD01', EVL_RK_CD, '' )) AS EVL_RK_CD_PJCD01
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD02', EVL_RK_CD, '' )) AS EVL_RK_CD_PJCD02
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD03', EVL_RK_CD, '' )) AS EVL_RK_CD_PJCD03
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD04', EVL_RK_CD, '' )) AS EVL_RK_CD_PJCD04
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD05', EVL_RK_CD, '' )) AS EVL_RK_CD_PJCD05
					         , MAX(DECODE(D5.EVL_INDEX_CD, 'PJCD06', EVL_RK_CD, '' )) AS EVL_RK_CD_PJCD06
					      FROM TBCSPAOE030M D5
					         , TBCSPAOE002M D6
					     WHERE D5.EVL_YR = D6.EVL_YR
					       AND D5.HLYR_DVSN_CD = D6.HLYR_DVSN_CD
					       AND D5.EVL_INDEX_CD = D6.EVL_INDEX_CD
					       AND D5.EVL_YR       = #strEvlYr#
				           AND D5.HLYR_DVSN_CD = #strHlyrDvsnCd#
					     GROUP BY D5.EVL_YR, D5.HLYR_DVSN_CD, D5.TSK_DVSN_CD, D5.AUD_TSK_KND_CD, D5.EVL_STEP_CD, D5.EVL_CMTR_CNB, D5.TSK_NO, D5.AUD_YR
					     )
				) D6	
				, TBCSPAOE021M D7		
				WHERE 1 = 1
				  AND D3.EVL_YR         = D6.EVL_YR         (+)
				  AND D3.HLYR_DVSN_CD   = D6.HLYR_DVSN_CD   (+)
				  AND D3.TSK_DVSN_CD    = D6.TSK_DVSN_CD    (+)
				  AND D3.AUD_TSK_KND_CD = D6.AUD_TSK_KND_CD (+)
				  AND D3.EVL_STEP_CD    = D6.EVL_STEP_CD    (+)
				  AND D3.EVL_CMTR_CNB   = D6.EVL_CMTR_CNB   (+)
				  AND D3.AUD_YR         = D6.AUD_YR         (+)
	              AND D3.TSK_NO         = D6.TSK_NO         (+)
	              AND D3.AUD_YR         = D7.AUD_YR         
	              AND D3.TSK_NO         = D7.TSK_NO    
              ) D1, TBBADDED001M D2
             WHERE 1 = 1
             AND D1.AUD_YR = D2.AUD_YR(+)
			 AND D1.TSK_NO = D2.AUD_NO(+)
		  ]]>
		<isNotEmpty property="strAudSbjNm">
			AND D1.AUD_SBJ_NM LIKE '%' || #strAudSbjNm# || '%'
		</isNotEmpty>
		<isNotEmpty property="strTskNo">
				AND CASE WHEN LENGTH(#strTskNo#) = 3 AND D2.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D1.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			D2.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1)
		</isNotEmpty>
		<![CDATA[	
			ORDER BY D1.HNDL_DIV_DPT_CD, D1.AUD_YR, D1.TSK_NO
		  ]]>
	</select>
	<!-- ############################## 감사사항별 가중치 끝 (CSPAOE053Q) ##################################### -->

	<!-- ############################## 주관/지원부서간 기여율 시작 (CSPAOE054Q) ############################## -->
	<select id="CSPAOE054Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT D3.EVL_YR || '-' || D3.TSK_NO            AS EVL_YR_TSK_NO     /*감사연번호*/
			     , D3.AUD_SBJ_NM                            AS AUD_SBJ_NM        /*감사사항명*/
			     , F_DPT_INFO(D3.HNDL_DIV_DPT_CD, '1')      AS HNDL_DIV_DPT_NM   /*처리과*/
			     , F_CODE_NM('1000273', D3.AUD_STEP_CD_MIN) AS AUD_STEP_CD_MIN   /*단계기초*/
			     , F_CODE_NM('1000273', D3.AUD_STEP_CD_MAX) AS AUD_STEP_CD_MAX   /*단계기말*/
			     , D4.DRIVE_RTE_SUM                         AS DRIVE_RTE_SUM     /*추진율*/
			     , D3.PTCPT_CNT_MAIN + D3.PTCPT_CNT_OTHER   AS PTCPT_CNT_ALL     /*전체참여인원*/
			     , D3.PTCPT_CNT_MAIN                        AS PTCPT_CNT_MAIN    /*주관부서 인원*/
			     , D3.CTB_RTE_MAIN                          AS CTB_RTE_MAIN      /*주관부서 기여율*/
			     , CASE WHEN D3.CTB_RTE_MAIN != 0 AND D3.PTCPT_CNT_MAIN != 0 THEN ROUND(D3.CTB_RTE_MAIN / D3.PTCPT_CNT_MAIN, 2)
			             ELSE 0 END                         AS AVG_CTB_RTE_MAIN  /*주관부서_인당 평균기여율*/
			     , D3.PTCPT_CNT_OTHER                       AS PTCPT_CNT_OTHER   /*지원부서 인원*/
			     , D3.CTB_RTE_OTHER                         AS CTB_RTE_OTHER     /*지원부서 기여율*/
			     , CASE WHEN D3.CTB_RTE_OTHER != 0 AND D3.PTCPT_CNT_OTHER != 0 THEN ROUND(D3.CTB_RTE_OTHER / D3.PTCPT_CNT_OTHER, 2)
			             ELSE 0 END                         AS AVG_CTB_RTE_OTHER /*지원부서_인당 평균기여율*/
			     , CASE WHEN D3.CTB_RTE_MAIN != 0 AND D3.PTCPT_CNT_MAIN != 0 AND D3.CTB_RTE_OTHER != 0 AND D3.PTCPT_CNT_OTHER != 0 
			            THEN ROUND( (D3.CTB_RTE_MAIN / D3.PTCPT_CNT_MAIN) /  (D3.CTB_RTE_OTHER / D3.PTCPT_CNT_OTHER)  , 2)
			            ELSE 0 END                          AS AVG_CTB_RTE       /*기여율배분율(1인당 평균기여율 기준)*/
			  FROM (
			    SELECT D1.EVL_YR
			         , D1.HLYR_DVSN_CD
			         , D1.TSK_NO
			         , MAX(D1.AUD_KND_CD)      AS AUD_KND_CD
			         , MAX(D1.AUD_SBJ_NM)      AS AUD_SBJ_NM /*감사사항명*/
			         , MAX(D1.HNDL_DIV_DPT_CD) AS HNDL_DIV_DPT_CD /*처리과*/
			         , MIN(D2.AUD_STEP_CD)     AS AUD_STEP_CD_MIN /*단계기초*/
			         , MAX(D2.AUD_STEP_CD)     AS AUD_STEP_CD_MAX  /*단계기말*/
			         , SUM(CASE WHEN D2.BLT_DPT_CD = D1.HNDL_DIV_DPT_CD THEN 1 ELSE 0 END) AS PTCPT_CNT_MAIN /*주관부서 인원*/
			         , SUM(CASE WHEN D2.BLT_DPT_CD = D1.HNDL_DIV_DPT_CD THEN D2.CTB_RTE ELSE 0 END) AS CTB_RTE_MAIN /*주관부서 기여율*/
			         , SUM(CASE WHEN D2.BLT_DPT_CD != D1.HNDL_DIV_DPT_CD THEN 1 ELSE 0 END) AS PTCPT_CNT_OTHER /*지원부서 인원*/
			         , SUM(CASE WHEN D2.BLT_DPT_CD != D1.HNDL_DIV_DPT_CD THEN D2.CTB_RTE ELSE 0 END) AS CTB_RTE_OTHER /*지원부서 기여율*/
			      FROM TBCSPAOE021M D1
			         , TBCSPAOE023M D2
			    WHERE D1.EVL_YR       = D2.EVL_YR
			      AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			      AND D1.TSK_NO       = D2.TSK_NO
			      AND D1.EVL_YR       = #strEvlYr#
			      AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			    GROUP BY  D1.EVL_YR, D1.HLYR_DVSN_CD, D1.TSK_NO
			) D3
			,(
			    SELECT EVL_YR
			         , HLYR_DVSN_CD
			         , AUD_KND_CD /*감사종류*/
			         , SUM(DRIVE_RTE) AS DRIVE_RTE_SUM /*추진율 합*/
			      FROM TBCSPAOE008D
			     WHERE EVL_YR       = #strEvlYr#
			       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			       AND TSK_DVSN_CD  = '10000' /*감사업무*/
			     GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_KND_CD
			)D4
			WHERE D3.EVL_YR       = D4.EVL_YR (+)
			  AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD (+)
			  AND D3.AUD_KND_CD   = D4.AUD_KND_CD (+)
			ORDER BY D3.TSK_NO
		  ]]>
	</select>
	<!-- ################################ 주관/지원부서간 기여율 끝 (CSPAOE054Q) ##################################### -->

	<!-- ################################ 감사외업무종류별 실적명세 시작 (CSPAOE055Q) ################################ -->
	<select id="CSPAOE055Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT MAN.TSK_NM                                      AS TSK_NM         /*업무명*/
			     , F_DPT_INFO(MAN.CHR_DPT_CD, '1')                 AS CHR_DPT_NM     /*담당부서코드*/
			     , F_CODE_NM('1000272', MAN.TSK_KND_CD)            AS TSK_KND_NM     /*업무종류*/
			     , D9.STND_ASC                                     AS STND_ASC       /*표준평점*/
			     , F_CODE_NM('1000280', NVL(D7.EVL_STA_CD, '100')) AS EVL_STA_NM     /*평가상태*/
			     , D8.IDVT_INDEX_VAL                               AS IDVT_INDEX_VAL /*가중치*/
			     , ROUND(D9.STND_ASC * D8.IDVT_INDEX_VAL, 2)       AS STAD_ASC       /*평점 - (표준평점*가중치)*/
			  FROM ( 
			    SELECT D5.EVL_YR 
			         , D5.HLYR_DVSN_CD
			         , D5.TSK_KND_CD
			         , D5.TSK_NM
			         , D5.CHR_DPT_CD
			         , D5.EVL_CMTR_DVSN_CD
			         , D6.CHGR_CNB
			         , D5.TSK_NO
			      FROM (
			        /*평가자가 평가 완료한 리스트를 걸러낸다.*/
			        SELECT D3.EVL_YR
			             , D3.HLYR_DVSN_CD
			             , D3.TSK_KND_CD
			             , D3.TSK_NM
			             , D3.CHR_DPT_CD
			             , D3.TSK_NO
			             , 'CD' || LPAD(TO_NUMBER(SUBSTR(D4.EVL_CMTR_DVSN_CD,3)) + 1, 2,0) AS EVL_CMTR_DVSN_CD /*확인자 구분코드 (평가자 다음 코드가 확인자)*/
			          FROM TBCSPAOE024M D3
			             , TBCSPAOE029M D4
			        WHERE D3.EVL_YR       = D4.EVL_YR
			          AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
			          AND D4.TSK_DVSN_CD  = '10001' /*감사외업무*/
			          AND D3.TSK_KND_CD   = D4.AUD_TSK_KND_CD
			          AND D4.EVL_STEP_CD  = '600' /*평가자*/
			          AND D3.TSK_NO       = D4.TSK_NO
			          AND D4.EVL_STA_CD   = '300' /*평가완료*/
			          AND D3.EVL_YR       = #strEvlYr#
			          AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd#
		  ]]>
		<isNotEmpty property="strTskKndCd">
			AND D3.TSK_KND_CD = #strTskKndCd#
		</isNotEmpty>
		<![CDATA[			          			          
			    ) D5
			    , (
			       SELECT D1.EVL_YR 
			            , D1.HLYR_DVSN_CD 
			            , D1.TSK_DVSN_CD 
			            , D1.AUD_TSK_KND_CD 
			            , D1.CHGR_DVSN_CD 
			            , D2.CHGR_CNB 
			         FROM TBCSPAOE016M D1 
			            , TBCSPAOE017D D2 
			       WHERE D1.EVL_YR         = D2.EVL_YR
			         AND D1.HLYR_DVSN_CD   = D2.HLYR_DVSN_CD
			         AND D1.TSK_DVSN_CD    = D2.TSK_DVSN_CD
			         AND D1.AUD_TSK_KND_CD = D2.AUD_TSK_KND_CD
			         AND D1.CHGR_DVSN_CD   = D2.CHGR_DVSN_CD
			         AND D1.TSK_DVSN_CD    = '10001' /*감사외업무*/
			         AND D1.EVL_YR         = #strEvlYr#
			         AND D1.HLYR_DVSN_CD   = #strHlyrDvsnCd#
	]]>
		<isNotEmpty property="strTskKndCd">
			AND D1.AUD_TSK_KND_CD = #strTskKndCd#
		</isNotEmpty>
	<![CDATA[				         
			         AND TO_NUMBER(SUBSTR(D2.CHGR_DVSN_CD, 3)) BETWEEN 5 AND 200 /*감사외 업무 평가자 및 확인자는 CD05 ~ CD152*/
			         AND MOD(SUBSTR(D2.CHGR_DVSN_CD, 4), 2) = 0 /*확인자 리스트만 뽑아낸다.*/
			         AND D2.CHGR_DVSN_CD NOT IN ('CD33','CD34') /*감사업무쪽 코드임*/
			    ) D6 /*담당관리자에 등록된 확인자 리스트*/
			    WHERE D5.EVL_YR          = D6.EVL_YR
			     AND D5.HLYR_DVSN_CD     = D6.HLYR_DVSN_CD
			     AND D5.TSK_KND_CD       = D6.AUD_TSK_KND_CD
			     AND D5.EVL_CMTR_DVSN_CD = D6.CHGR_DVSN_CD
			 ) MAN
			 , TBCSPAOE029M D7
			 , TBCSPAOE010D D8
			 , TBCSPAOE006M D9
			WHERE MAN.EVL_YR           = D7.EVL_YR           (+)
			  AND MAN.HLYR_DVSN_CD     = D7.HLYR_DVSN_CD     (+)
			  AND D7.TSK_DVSN_CD (+)   = '10001'
			  AND MAN.TSK_KND_CD       = D7.AUD_TSK_KND_CD   (+)
			  AND D7.EVL_STEP_CD (+)   = '700' /*확인자 단계*/
			  AND MAN.CHGR_CNB         = D7.EVL_CMTR_CNB     (+)
			  AND MAN.TSK_NO           = D7.TSK_NO           (+)
			  AND MAN.EVL_CMTR_DVSN_CD = D7.EVL_CMTR_DVSN_CD (+)
			  AND D7.EVL_YR            = D8.EVL_YR           (+)
			  AND D7.HLYR_DVSN_CD      = D8.HLYR_DVSN_CD     (+)
			  AND D7.TSK_DVSN_CD       = D8.TSK_DVSN_CD      (+)
			  AND D7.AUD_TSK_KND_CD    = D8.AUD_TSK_KND_CD   (+) 
			  AND D7.EVL_RK_CD         = D8.RK_CD            (+)
			  AND MAN.EVL_YR           = D9.EVL_YR
			  AND MAN.HLYR_DVSN_CD     = D9.HLYR_DVSN_CD
			  AND D9.TSK_DVSN_CD       = '10001'
			  AND MAN.TSK_KND_CD       = D9.TSK_KND_CD
			ORDER BY MAN.TSK_NO
		  ]]>
	</select>
	<!-- ############################ 감사외업무종류별 실적명세 끝 (CSPAOE055Q) ################################## -->

	<!-- ############################# 감사외업무 개인별 기여율 시작 (CSPAOE056Q) ################################# -->
	<select id="CSPAOE056Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_DPT_INFO(D1.CHR_DPT_CD, '1')      AS CHR_DPT_NM      /*담당부서명*/
			     , F_CODE_NM('1000272', D1.TSK_KND_CD) AS TSK_KND_NM      /*업무종류*/
			     , D1.TSK_NM                           AS TSK_NM          /*업무명*/
			     , F_DPT_INFO(D2.CHR_DPT_CD, '1')      AS PTCPT_DPT_NM    /*소속부서명*/
			     , F_CODE_NM('1000173', D2.RANK_CD)    AS RANK_NM         /*직급명*/
			     , F_USR_INFO(D2.PTCPT_CNB, '2')       AS PTCPT_NM        /*성명*/
			     , D2.CTB_RTE                          AS CTB_RTE         /*기여율*/
			     , D2.EVL_RFR_SBJ_TXT                  AS EVL_RFR_SBJ_TXT /*평가참고사항내용*/
			 FROM TBCSPAOE024M D1
			    , TBCSPAOE025M D2
			WHERE D1.EVL_YR       = D2.EVL_YR
			  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			  AND D1.TSK_KND_CD   = D2.TSK_KND_CD
			  AND D1.TSK_NO       = D2.TSK_NO
			  AND D1.EVL_YR       = #strEvlYr#
			  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
	]]>
		<isNotEmpty property="strTskKndCd">
			AND D1.TSK_KND_CD = #strTskKndCd#
		</isNotEmpty>
	<![CDATA[			  
			ORDER BY D1.EVL_YR
		  ]]>
	</select>
	<!-- ############################ 감사외업무 개인별 기여율 끝 (CSPAOE056Q)##################################### -->

	<!-- ############################ 지원업무 부서별 실적평가 시작 (CSPAOE057Q)#################################### -->
	<!-- 지원업무 부서별 실적평가를 조회한다. -->
	<select id="CSPAOE057Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_DPT_INFO(DEPT.HIRK_DPT_CD, '1') AS UP_DPT_NM  /*부서명(국)*/
			     , F_DPT_INFO(BASE.DPT_CD, '1')      AS DPT_NM     /*부서명(과)*/
			     , F_CODE_NM('1000274', '600')       AS EVL_RK_NM  /*상급자 평가등급 - 보통*/
			     , BASE.SUM_TSK_ASC_1                              /*평가위원 평점 1 ~ 25명*/
			     , BASE.SUM_TSK_ASC_2
			     , BASE.SUM_TSK_ASC_3
			     , BASE.SUM_TSK_ASC_4
			     , BASE.SUM_TSK_ASC_5
			     , BASE.SUM_TSK_ASC_6
			     , BASE.SUM_TSK_ASC_7
			     , BASE.SUM_TSK_ASC_8
			     , BASE.SUM_TSK_ASC_9
			     , BASE.SUM_TSK_ASC_10
			     , BASE.SUM_TSK_ASC_11
			     , BASE.SUM_TSK_ASC_12
			     , BASE.SUM_TSK_ASC_13
			     , BASE.SUM_TSK_ASC_14
			     , BASE.SUM_TSK_ASC_15
			     , BASE.SUM_TSK_ASC_16
			     , BASE.SUM_TSK_ASC_17
			     , BASE.SUM_TSK_ASC_18
			     , BASE.SUM_TSK_ASC_19
			     , BASE.SUM_TSK_ASC_20
			     , BASE.SUM_TSK_ASC_21
			     , BASE.SUM_TSK_ASC_22
			     , BASE.SUM_TSK_ASC_23
			     , BASE.SUM_TSK_ASC_24
			     , BASE.SUM_TSK_ASC_25
			     , CASE WHEN CNT > 2 THEN ROUND(SUM_TSK_ASC - SUM_TSK_ASC_MIN - SUM_TSK_ASC_MAX, 2)
			            ELSE NULL END AS SUM_TSK_ASC /*총점 - 3명 이상이 평가 했어야지 최고점과 최저점을 뺄수 있으니깐.*/
			     , CASE WHEN CNT > 2 THEN ROUND((SUM_TSK_ASC - SUM_TSK_ASC_MIN - SUM_TSK_ASC_MAX) / CNT, 2)
			            ELSE NULL END AS AVG_TSK_ASC /*평균 - 총점/평가인원*/
			  FROM (
			    SELECT D1.EVL_YR
			         , D1.HLYR_DVSN_CD
			         , D1.DPT_CD
			         , SUM(DECODE(D2.EVL_CMTR_NO, 1, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_1
			         , SUM(DECODE(D2.EVL_CMTR_NO, 2, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_2
			         , SUM(DECODE(D2.EVL_CMTR_NO, 3, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_3
			         , SUM(DECODE(D2.EVL_CMTR_NO, 4, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_4
			         , SUM(DECODE(D2.EVL_CMTR_NO, 5, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_5
			         , SUM(DECODE(D2.EVL_CMTR_NO, 6, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_6
			         , SUM(DECODE(D2.EVL_CMTR_NO, 7, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_7
			         , SUM(DECODE(D2.EVL_CMTR_NO, 8, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_8
			         , SUM(DECODE(D2.EVL_CMTR_NO, 9, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_9
			         , SUM(DECODE(D2.EVL_CMTR_NO, 10, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_10
			         , SUM(DECODE(D2.EVL_CMTR_NO, 11, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_11
			         , SUM(DECODE(D2.EVL_CMTR_NO, 12, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_12
			         , SUM(DECODE(D2.EVL_CMTR_NO, 13, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_13
			         , SUM(DECODE(D2.EVL_CMTR_NO, 14, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_14
			         , SUM(DECODE(D2.EVL_CMTR_NO, 15, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_15
			         , SUM(DECODE(D2.EVL_CMTR_NO, 16, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_16
			         , SUM(DECODE(D2.EVL_CMTR_NO, 17, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_17
			         , SUM(DECODE(D2.EVL_CMTR_NO, 18, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_18
			         , SUM(DECODE(D2.EVL_CMTR_NO, 19, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_19
			         , SUM(DECODE(D2.EVL_CMTR_NO, 20, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_20
			         , SUM(DECODE(D2.EVL_CMTR_NO, 21, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_21
			         , SUM(DECODE(D2.EVL_CMTR_NO, 22, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_22
			         , SUM(DECODE(D2.EVL_CMTR_NO, 23, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_23
			         , SUM(DECODE(D2.EVL_CMTR_NO, 24, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_24
			         , SUM(DECODE(D2.EVL_CMTR_NO, 25, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_25
			      FROM (
			        SELECT EVL_YR 
			             , HLYR_DVSN_CD
			             , DPT_CD                      /*평가 부서코드*/
			             , EVL_CMTR_CNB                /*평가위원전산번호*/
			             , SUM(TSK_ASC) AS SUM_TSK_ASC /*업무평점 합*/
			          FROM TBCSPAOE031M D1
			         WHERE 1 = 1
			           AND EVL_STEP_CD  = '500' /*위원평가*/
			           AND EVL_DTM_YN   = 'Y'   /*평가확정*/
			           AND EVL_YR       = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				]]>
		<isNotEmpty property="strDeptCd">
			AND DPT_CD = #strDeptCd#
		</isNotEmpty>
				<![CDATA[			           
			         GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD, EVL_CMTR_CNB     
			       ) D1
			       , (     
			        /*평가자 리스트*/
			        SELECT EVL_YR
			             , HLYR_DVSN_CD
			             , CHGR_CNB
			             , EVL_CMTR_NO
			          FROM TBCSPAOE017D
			         WHERE 1 = 1
			           AND EVL_YR         = #strEvlYr#
			           AND HLYR_DVSN_CD   = #strHlyrDvsnCd#
			           AND TSK_DVSN_CD    = '10002'
			           AND AUD_TSK_KND_CD = '10000'
			           AND CHGR_DVSN_CD   = 'CD03' 
			       ) D2
			    WHERE D1.EVL_YR       = D2.EVL_YR 
			      AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD 
			      AND D1.EVL_CMTR_CNB = D2.CHGR_CNB 
			    GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.DPT_CD  
			) BASE
			, (
			    SELECT EVL_YR 
			         , HLYR_DVSN_CD
			         , DPT_CD /*평가 부서코드*/
			         , MIN(SUM_TSK_ASC) AS SUM_TSK_ASC_MIN
			         , MAX(SUM_TSK_ASC) AS SUM_TSK_ASC_MAX
			         , SUM(SUM_TSK_ASC) AS SUM_TSK_ASC
			         , MAX(CNT)         AS CNT /*평균을 구하기 위해서 총 평가자 수*/
			      FROM (
			    SELECT EVL_YR 
			         , HLYR_DVSN_CD
			         , DPT_CD       /*평가 부서코드*/
			         , EVL_CMTR_CNB /*평가위원전산번호*/
			         , SUM(TSK_ASC) AS SUM_TSK_ASC /*업무평점 합*/
			         , COUNT(*) OVER(PARTITION BY EVL_YR, HLYR_DVSN_CD, DPT_CD) AS CNT
			      FROM TBCSPAOE031M D1
			     WHERE 1 = 1
			       AND EVL_STEP_CD  = '500' /*위원평가*/
			       AND EVL_DTM_YN   = 'Y'   /*평가확정*/
			       AND EVL_YR       = #strEvlYr#
			       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				]]>
		<isNotEmpty property="strDeptCd">
			AND DPT_CD = #strDeptCd#
		</isNotEmpty>
				<![CDATA[			       
			     GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD, EVL_CMTR_CNB  
			     )
			    GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD
			) JUMSU /*총점과 최고점과 최저점*/
			, TBDCMACM002M DEPT
		WHERE BASE.EVL_YR       = JUMSU.EVL_YR
		  AND BASE.HLYR_DVSN_CD = JUMSU.HLYR_DVSN_CD
		  AND BASE.DPT_CD       = JUMSU.DPT_CD
		  AND BASE.DPT_CD       = DEPT.DPT_CD
		ORDER BY BASE.DPT_CD
	 	 ]]>
	</select>

	<!-- 평가자 리스트를 가져온다. -->
	<select id="CSPAOE057QChgrInfoselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_USR_INFO(CHGR_CNB, '2') AS CHGR_NM
			     , EVL_CMTR_NO               AS EVL_CMTR_NO
			  FROM TBCSPAOE017D
			 WHERE 1 = 1
			   AND EVL_YR         = #strEvlYr#
			   AND HLYR_DVSN_CD   = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD    = '10002'
			   AND AUD_TSK_KND_CD = '10000'
			   AND CHGR_DVSN_CD   = 'CD03' 
			 ORDER BY EVL_CMTR_NO
		  ]]>
	</select>
	<!-- ############################## 지원업무 부서별 실적평가 끝 (CSPAOE057Q) ##################################### -->

	<!-- ############################## 지원업무 개인별 기여율 시작 (CSPAOE058Q) ##################################### -->
	<!-- 지원업무 부서별 실적평가를 조회한다. -->
	<select id="CSPAOE058Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_DPT_INFO(D3.CHR_DPT_CD, '1')   AS CHR_DPT_NM   /*부서명*/
			     , F_CODE_NM('1000173', D3.RANK_CD) AS RANK_NM      /*직급명*/
			     , F_USR_INFO(D3.PTCPT_CNB, '2')    AS NAM          /*이름*/
			     , D3.TSK_NM                        AS TSK_NM       /*업무명*/
			     , D3.WGT_RTE                       AS WGT_RTE      /*비중*/
			     , D3.CTB_RTE                       AS CTB_RTE      /*기여율*/
			     , D4.CTB_RTE_SUM                   AS CTB_RTE_SUM  /*합계*/
			  FROM (
			    SELECT D1.CHR_DPT_CD
			         , D2.RANK_CD
			         , D2.PTCPT_CNB
			         , D1.TSK_NM
			         , D1.WGT_RTE
			         , D2.CTB_RTE
			      FROM TBCSPAOE026M D1
			         , TBCSPAOE027M D2
			     WHERE 1 = 1 
			       AND D1.EVL_YR       = D2.EVL_YR
			       AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			       AND D1.CHR_DPT_CD   = D2.CHR_DPT_CD
			       AND D1.TSK_NO       = D2.TSK_NO
			       AND D1.EVL_YR       = #strEvlYr#
			       AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
				]]>
		<isNotEmpty property="strDeptCd">
			AND D1.CHR_DPT_CD = #strDeptCd#
		</isNotEmpty>
				<![CDATA[				       
			   ) D3
			 ,(
			    SELECT D1.CHR_DPT_CD
			         , SUM(D2.CTB_RTE) AS CTB_RTE_SUM
			      FROM TBCSPAOE026M D1
			         , TBCSPAOE027M D2
			     WHERE 1 = 1 
			       AND D1.EVL_YR       = D2.EVL_YR
			       AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			       AND D1.CHR_DPT_CD   = D2.CHR_DPT_CD
			       AND D1.TSK_NO       = D2.TSK_NO
			       AND D1.EVL_YR       = #strEvlYr#
			       AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
				]]>
		<isNotEmpty property="strDeptCd">
			AND D1.CHR_DPT_CD = #strDeptCd#
		</isNotEmpty>
				<![CDATA[			       
			     GROUP BY D1.CHR_DPT_CD
			 ) D4
			WHERE D3.CHR_DPT_CD = D4.CHR_DPT_CD
		  ]]>
	</select>
	<!-- ################################ 지원업무 개인별 기여율 끝 (CSPAOE058Q) ################################# -->

	<!-- ################################ 운영직업무 직급별 평점 시작 (CSPAOE059Q) ################################ -->
	<!-- 부서명 조회 -->
	<select id="CSPAOE059QDeptCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT DPT_CD                  AS CD
			     , F_DPT_INFO(DPT_CD, '1') AS CD_NM /*부서명*/
			  FROM TBCSPAOE035M
			 WHERE TSK_DVSN_CD = '10003'
			   AND DPT_CD IS NOT NULL
			 GROUP BY DPT_CD
		  ]]>
	</select>

	<!-- 운영직업무 직급별 평점을 조회한다. -->
	<select id="CSPAOE059Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_DPT_INFO(SUBSTR(DPT_CD,0,3)||'000','1') AS HIRK_DPT_NM
				 , DECODE(DPT_CD,SUBSTR(DPT_CD,0,3)||'000',NULL,F_DPT_INFO(DPT_CD, '1'))        AS BLT_DPT_NM /*부서명*/
			     , F_CODE_NM('1000173', RANK_CD)   AS RANK_NM    /*직급명*/
			     , RANK_NM_2  /*직급구분*/
			     , F_USR_INFO(NEVLT_CNB, '2')      AS PTCPT_NAM  /*성명*/
			     , NEVLT_CNB                       AS PTCPT_CNB  /*전산번호*/
			     , SUM_ASC                         AS SUM_ASC    /*평점*/
			     , RANK_NUM                        AS RANK_NUM   /*직급별 순위*/
			 FROM (
			    SELECT D1.DPT_CD /*부서*/
			         , D2.RANK_CD
			         , D2.RANK_NM_2
			         , D1.NEVLT_CNB /*전산번호*/
			         , D1.SUM_ASC 
			         , RANK() OVER(PARTITION BY D2.RANK_CD ORDER BY D1.SUM_ASC DESC) AS RANK_NUM /*직급별 순위*/
			      FROM (
			        SELECT DPT_CD /*부서*/
			             , NEVLT_CNB /*전산번호*/
			             , SUM(PSN_TSK_ASC) AS SUM_ASC
			          FROM TBCSPAOE035M
			         WHERE 1 = 1 
			           AND EVL_YR       = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND TSK_DVSN_CD  = '10003'
			        GROUP BY DPT_CD, NEVLT_CNB
			    	) D1
			    	, TBDCMACM001M D2
		    	WHERE D1.NEVLT_CNB = D2.CNB 
				) Z
			WHERE 1 = 1
			]]>
		<isNotEmpty property="strDeptCd">
			AND DPT_CD = #strDeptCd#
		</isNotEmpty>
			<![CDATA[					
			ORDER BY RANK_CD, RANK_NUM
		  ]]>
	</select>
	<!-- ################################## 운영직업무 직급별 평점 끝 (CSPAOE059Q) ################################# -->

	<!-- ################################## 부서별 입무실적 총괄 시작 (CSPAOE060Q) ################################# -->
	<!-- 부서별 업무실적 총괄을 조회한다.(국/단별) -->
	<select id="CSPAOE060QUpmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT A.EVL_YR
				, A.HLYR_DVSN_CD
				, A.HIRK_DPT_CD
				, A.DPT_NM
				, A.PSN_TSK_ASC_1
				, A.PSN_TSK_ASC_2
				, A.PSN_TSK_ASC_3
				, A.PSN_TSK_ASC_4
				, A.PSN_TSK_ASC_5
				, A.PSN_TSK_ASC_6
				, A.PSN_TSK_ASC_7
				, A.PSN_TSK_ASC_8
				, A.PSN_TSK_ASC_9
				, A.PSN_TSK_ASC_SUM
				, RANK() OVER(ORDER BY A.PSN_TSK_ASC_SUM DESC) AS PSN_TSK_ASC_SUM_NUM
			FROM (
		        SELECT EVL_YR
		             , HLYR_DVSN_CD
		             , HIRK_DPT_CD
		             , F_DPT_INFO(HIRK_DPT_CD, '1') AS DPT_NM /*평가할때 상위 부서코드*/
		             , NVL(SUM(PSN_TSK_ASC_1), 0)   AS PSN_TSK_ASC_1  /*감사활동*/
		             , NVL(SUM(PSN_TSK_ASC_2), 0)   AS PSN_TSK_ASC_2 /*모니터링*/
		             , NVL(SUM(PSN_TSK_ASC_3), 0)   AS PSN_TSK_ASC_3 /*결산업무*/
		             , NVL(SUM(PSN_TSK_ASC_4), 0)   AS PSN_TSK_ASC_4 /*연보업무*/
		             , NVL(SUM(PSN_TSK_ASC_5), 0)   AS PSN_TSK_ASC_5 /*총괄업무*/
		             , NVL(SUM(PSN_TSK_ASC_6), 0)   AS PSN_TSK_ASC_6 /*집행전말*/
		             , NVL(SUM(PSN_TSK_ASC_7), 0)   AS PSN_TSK_ASC_7 /*기타업무*/
		             , NVL(SUM(PSN_TSK_ASC_8), 0)   AS PSN_TSK_ASC_8 /*성과보고서*/
		             , NVL(SUM(PSN_TSK_ASC_9), 0)   AS PSN_TSK_ASC_9 /*법령모니터링*/
		             , NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) + NVL(SUM(PSN_TSK_ASC_5), 0) + NVL(SUM(PSN_TSK_ASC_6), 0) + NVL(SUM(PSN_TSK_ASC_7), 0) + NVL(SUM(PSN_TSK_ASC_8), 0) + NVL(SUM(PSN_TSK_ASC_9), 0) AS PSN_TSK_ASC_SUM
		         FROM (
	 	            SELECT D22.EVL_YR
		                 , D22.HLYR_DVSN_CD
		                 , NVL(D24.HIRK_DPT_CD, D22.DPT_CD) AS HIRK_DPT_CD /*평가할때 상위 부서코드*/
		                 , D22.PSN_TSK_ASC_1
		                 , D22.PSN_TSK_ASC_2 /*모니터링*/
		                 , D22.PSN_TSK_ASC_3 /*결산업무*/
		                 , D22.PSN_TSK_ASC_4 /*연보업무*/
		                 , D22.PSN_TSK_ASC_5 /*총괄업무*/
		                 , D22.PSN_TSK_ASC_6 /*집행전말*/
		                 , D22.PSN_TSK_ASC_7 /*기타업무*/
		                 , D22.PSN_TSK_ASC_8 /*성과보고서*/
		                 , D22.PSN_TSK_ASC_9 /*법령모니터링*/ 
	                  FROM (	         
			            SELECT EVL_YR
			                 , HLYR_DVSN_CD
			                 , DPT_CD AS DPT_CD /*평가할때 부서코드*/
			                 , 0 AS PSN_TSK_ASC_1
			                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
			                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 2 AND 3 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*결산업무*/
			                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 4 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*연보업무*/
			                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_5 /*총괄업무*/
			                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_6 /*집행전말*/
			                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 94 AND 96) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_7 /*기타업무*/
			                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 13 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_8 /*성과보고서*/
			                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 7 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_9 /*법령모니터링*/
			              FROM TBCSPAOE035M 
			             WHERE EVL_YR       = #strEvlYr#
			               AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			               AND TSK_DVSN_CD  = '10001'		               
			              
			             UNION ALL    
			
			            SELECT #strEvlYr# AS EVL_YR
			                 , #strHlyrDvsnCd#  AS HLYR_DVSN_CD  
			                 , DPT_CD AS DPT_CD /*평가할때 부서코드*/
			                 , ROUND((STND_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 /*개인평점*/
			                 , 0 AS PSN_TSK_ASC_2 /*모니터링*/
			                 , 0 AS PSN_TSK_ASC_3 /*결산업무*/
			                 , 0 AS PSN_TSK_ASC_4 /*연보업무*/
			                 , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
			                 , 0 AS PSN_TSK_ASC_6 /*집행전말*/
			                 , 0 AS PSN_TSK_ASC_7 /*기타업무*/
			                 , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
			                 , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/
			              FROM (
		                    SELECT D20.PTCPT_CNB  
		                         , D20.DRIVE_RTE_ASC /*추진율 조정평점*/ 
		                         , D20.CTB_RTE
		                         , D20.DPT_CD
		                         , D20.SPE_ADD_SC
				                 , D20.MDT_ASC
		                         , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/  
		                         , D20.STND_ASC
		                      FROM (	              
				                SELECT D19.PTCPT_CNB  
				                     , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
				                     , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
				                            ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
				                     , D19.CTB_RTE
				                     , D19.DPT_CD
				                     , D19.AUD_KND_CD
		                             , D19.AUD_STEP_CD_MAX
		                             , D19.DLY_DT_SUM
		                             , D19.SYT_EVL_ADVL_VAL
		                             , D19.SPE_ADD_SC
				                     , D19.MDT_ASC
				                     , D19.AUD_YR
				                     , D19.TSK_NO
				                     , D19.STND_ASC
				                 FROM (
				                    SELECT D11.PTCPT_CNB
				                         , D10.STND_ASC /*표준평점*/
				                         , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
				                         , D10.DRIVE_RTE_SUM  /*추진율*/      
				                         , ( SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
				                         , D10.DLY_DT_SUM /*지연일*/
				                         , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
				                         , D11.CTB_RTE
				                         , D11.BLT_DPT_CD AS DPT_CD
				                         , D10.AUD_KND_CD
		                                 , D10.AUD_STEP_CD_MAX
		                                 , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
				                         , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
				                         , D10.AUD_YR
				                         , D10.TSK_NO
				                     FROM (
				                        SELECT AUD_KND_CD
				                             , AUD_YR
				                             , TSK_NO
				                             , AUD_STEP_CD_MIN
				                             , AUD_STEP_CD_MAX
				                             , MNDY_CNT
				                             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
				                             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
				                             , DRIVE_RTE_SUM  /*추진율*/      
				                             , DLY_DT_SUM /*지연일*/
				                             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
				                             , EVL_YR
				                             , HLYR_DVSN_CD
				                             , SYT_TRTM_YN
				                             , NVL(SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS SPE_ADD_SC
				                             , NVL(MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS MDT_ASC
				                          FROM (
				                            SELECT D5.AUD_KND_CD
				                                 , D5.AUD_YR
				                                 , D5.TSK_NO
				                                 , D5.AUD_STEP_CD_MIN
				                                 , D5.AUD_STEP_CD_MAX
				                                 , D5.MNDY_CNT
				                                 , (SELECT F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
				                                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
		                                                                          , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
		                                                                                     AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
		                                                                          , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                              
				                                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
				                                      FROM TBCSPAOE008D 
				                                     WHERE EVL_YR        = #strEvlYr#
				                                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
				                                       AND TSK_DVSN_CD   = '10000' 
				                                       AND AUD_KND_CD    = D5.AUD_KND_CD   
				                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
				                                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
				                                      FROM TBCSPAOE022M
				                                     WHERE AUD_YR = D5.AUD_YR
				                                       AND TSK_NO = D5.TSK_NO
				                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
				                                 , D6.EVL_YR
				                                 , D6.HLYR_DVSN_CD
				                                 , D5.SYT_TRTM_YN
				                                 , D6.SPE_ADD_SC
				                                 , D6.MDT_ASC
				                             FROM (
				                                    SELECT D2.HNDL_DIV_DPT_CD
				                                         , D2.SPVR_CNB
				                                         , D2.AUD_KND_CD
				                                         , D2.AUD_YR
				                                         , D2.TSK_NO
				                                         , D2.AUD_SBJ_NM
				                                         , D1.AUD_STEP_CD_MIN
				                                         , D1.AUD_STEP_CD_MAX
				                                         , D2.MNDY_CNT
				                                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
				                                      FROM (
				                                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
				                                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
				                                             , AUD_YR
				                                             , TSK_NO
				                                          FROM TBCSPAOE022M
				                                         WHERE CMPT_DT IS NOT NULL
				                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
				                                         GROUP BY AUD_YR, TSK_NO
				                                     ) D1
				                                     , TBCSPAOE021M D2
				                                 WHERE D1.AUD_YR = D2.AUD_YR
				                                   AND D1.TSK_NO = D2.TSK_NO
				                                  ) D5 /*평가대상 감사활동 - 기준*/
				                                  , (
				                                    SELECT D8.AUD_TSK_KND_CD
				                                         , D8.AUD_YR
				                                         , D8.TSK_NO
				                                         , D8.SYT_EVL_ADVL_VAL
				                                         , D8.EVL_YR
				                                         , D8.HLYR_DVSN_CD
				                                         , D8.TSK_DVSN_CD
				                                         , D8.EVL_RK_CD
				                                         , D8.SYT_EVL_RK_CD
				                                         , D8.EVL_STEP_CD
				                                         , D8.SPE_ADD_SC
				                                         , D8.MDT_ASC
				                                       FROM (
				                                           SELECT EVL_YR
				                                                , HLYR_DVSN_CD 
				                                                , AUD_YR
				                                                , TSK_NO
				                                                , MAX(EVL_STEP_CD) AS EVL_STEP_CD
				                                                , AUD_TSK_KND_CD
				                                                , TSK_DVSN_CD
				                                             FROM TBCSPAOE029M
				                                            WHERE 1=1
				                                              AND TSK_DVSN_CD  = '10000'
				                                              AND EVL_STA_CD   = '300' /*평가완료*/
				                                              AND (AUD_YR, TSK_NO, EVL_STEP_CD) 
				                                                   IN (SELECT AUD_YR, TSK_NO, MAX(EVL_STEP_CD)
				                                                       FROM TBCSPAOE029M 
				                                                       WHERE  (AUD_YR,TSK_NO) IN (SELECT
				                                                       AUD_YR ,
				                                                       TSK_NO
				                                                  FROM TBCSPAOE022M
				                                                 WHERE CMPT_DT IS NOT NULL
				                                                   AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
				                                                 GROUP BY AUD_YR,
				                                                       TSK_NO )
				                                                       GROUP BY AUD_YR, TSK_NO  )
				                                            GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
				                                     ) D7
				                                     , TBCSPAOE029M D8
				                                    WHERE D7.EVL_YR = D8.EVL_YR
				                                      AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
				                                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
				                                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
				                                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
				                                      AND D7.AUD_YR = D8.AUD_YR
				                                      AND D7.TSK_NO = D8.TSK_NO	                                          
				                                ) D6 /*감사사항 평가관리*/
				                                , TBCSPAOE010D D7
				                            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
				                              AND D5.AUD_YR          = D6.AUD_YR         (+)
				                              AND D5.TSK_NO          = D6.TSK_NO         (+)
				                              AND D6.EVL_YR = D7.EVL_YR (+) 
				                              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
				                              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
				                              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
				                              AND D6.EVL_RK_CD = D7.RK_CD (+)		  
				                          ) D9
				                      ) D10
				                      , TBCSPAOE023M D11
				                 WHERE D10.AUD_YR = D11.AUD_YR
				                   AND D10.TSK_NO = D11.TSK_NO
				                   AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
				                   AND D11.CTB_RTE != 0                   
				               ) D19
			               ) D20
			            ) D21
		            ) D22
	                , ( /* 감사부서만 나온다 감사청구조사국엔 감사부서, 지원부서가 모두 포함되잇기에 지원부서는뺀다*/
	                     SELECT DPT_CD
															 FROM TBDCMACM002M
															WHERE DPT_TP_CD = 'A'
	                ) D23 
	                , TBDCMACM002M D24	
	            WHERE D22.DPT_CD = D23.DPT_CD
	              AND D22.DPT_CD = D24.DPT_CD    
				]]>
					<isNotEmpty property="strDeptUpCd">
						AND NVL(D24.HIRK_DPT_CD, D22.DPT_CD) = #strDeptUpCd#
					</isNotEmpty>				
				<![CDATA[	                      
		        )
		    GROUP BY EVL_YR, HLYR_DVSN_CD, HIRK_DPT_CD) A
		ORDER BY A.PSN_TSK_ASC_SUM DESC
		  ]]>
	</select>

	<!-- 부서별 업무실적 총괄을 조회한다.(과/팀별) -->
	<select id="CSPAOE060Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
	        SELECT EVL_YR
	             , HLYR_DVSN_CD
	             , F_DPT_INFO(DPT_CD, '1') AS DPT_NM /*평가할때 상위 부서코드*/
	             , NVL(SUM(PSN_TSK_ASC_1), 0)   AS PSN_TSK_ASC_1  /*감사활동*/
	             , NVL(SUM(PSN_TSK_ASC_2), 0)   AS PSN_TSK_ASC_2 /*모니터링*/
	             , NVL(SUM(PSN_TSK_ASC_3), 0)   AS PSN_TSK_ASC_3 /*결산업무*/
	             , NVL(SUM(PSN_TSK_ASC_4), 0)   AS PSN_TSK_ASC_4 /*연보업무*/
	             , NVL(SUM(PSN_TSK_ASC_5), 0)   AS PSN_TSK_ASC_5 /*총괄업무*/
	             , NVL(SUM(PSN_TSK_ASC_6), 0)   AS PSN_TSK_ASC_6 /*집행전말*/
	             , NVL(SUM(PSN_TSK_ASC_7), 0)   AS PSN_TSK_ASC_7 /*기타업무*/
	             , NVL(SUM(PSN_TSK_ASC_8), 0)   AS PSN_TSK_ASC_8 /*성과보고서*/
	             , NVL(SUM(PSN_TSK_ASC_9), 0)   AS PSN_TSK_ASC_9 /*법령모니터링*/
	             , NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) + NVL(SUM(PSN_TSK_ASC_5), 0) + NVL(SUM(PSN_TSK_ASC_6), 0) + NVL(SUM(PSN_TSK_ASC_7), 0) + NVL(SUM(PSN_TSK_ASC_8), 0) + NVL(SUM(PSN_TSK_ASC_9), 0) AS PSN_TSK_ASC_SUM
	         FROM (
 	            SELECT D22.EVL_YR
	                 , D22.HLYR_DVSN_CD
	                 , D22.DPT_CD
	                 , D22.PSN_TSK_ASC_1
	                 , D22.PSN_TSK_ASC_2 /*모니터링*/
	                 , D22.PSN_TSK_ASC_3 /*결산업무*/
	                 , D22.PSN_TSK_ASC_4 /*연보업무*/
	                 , D22.PSN_TSK_ASC_5 /*총괄업무*/
	                 , D22.PSN_TSK_ASC_6 /*집행전말*/
	                 , D22.PSN_TSK_ASC_7 /*기타업무*/
	                 , D22.PSN_TSK_ASC_8 /*성과보고서*/
	                 , D22.PSN_TSK_ASC_9 /*법령모니터링*/ 
                  FROM (
		            SELECT EVL_YR
		                 , HLYR_DVSN_CD
		                 , DPT_CD /*평가할때 부서코드*/
		                 , 0 AS PSN_TSK_ASC_1
		                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
		                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 2 AND 3 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*결산업무*/
		                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 4 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*연보업무*/
		                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_5 /*총괄업무*/
		                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_6 /*집행전말*/
		                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 94 AND 96) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_7 /*기타업무*/
		                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 13 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_8 /*성과보고서*/
		                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 7 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_9 /*법령모니터링*/
		              FROM TBCSPAOE035M 
		             WHERE EVL_YR       = #strEvlYr#
		               AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		               AND TSK_DVSN_CD  = '10001'
						]]>	
							<isNotEmpty property="strDeptCd">
								AND DPT_CD = #strDeptCd#
							</isNotEmpty>									
						<![CDATA[		               
		              
		             UNION ALL    
		
		            SELECT #strEvlYr# AS EVL_YR
		                 , #strHlyrDvsnCd#  AS HLYR_DVSN_CD  
		                 , BLT_DPT_CD AS DPT_CD /*평가할때 부서코드*/
		                 , ROUND((STND_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 /*개인평점*/
		                 , 0 AS PSN_TSK_ASC_2 /*모니터링*/
		                 , 0 AS PSN_TSK_ASC_3 /*결산업무*/
		                 , 0 AS PSN_TSK_ASC_4 /*연보업무*/
		                 , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
		                 , 0 AS PSN_TSK_ASC_6 /*집행전말*/
		                 , 0 AS PSN_TSK_ASC_7 /*기타업무*/
		                 , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
		                 , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/
		              FROM (
	                    SELECT D20.PTCPT_CNB  
	                         , D20.DRIVE_RTE_ASC /*추진율 조정평점*/ 
	                         , D20.CTB_RTE
	                         , D20.BLT_DPT_CD
	                         , D20.SPE_ADD_SC
			                 , D20.MDT_ASC
	                         , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/  
	                         , D20.STND_ASC
	                      FROM (
			                SELECT D19.PTCPT_CNB  
			                     , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
			                     , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
			                            ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
			                     , D19.CTB_RTE
			                     , D19.BLT_DPT_CD
			                     , D19.AUD_KND_CD
	                             , D19.AUD_STEP_CD_MAX
	                             , D19.DLY_DT_SUM
	                             , D19.SYT_EVL_ADVL_VAL
	                             , D19.SPE_ADD_SC
			                     , D19.MDT_ASC
			                     , D19.AUD_YR
			                     , D19.TSK_NO
			                     , D19.STND_ASC
			                 FROM (
			                    SELECT D11.PTCPT_CNB
			                         , D10.STND_ASC /*표준평점*/
			                         , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
			                         , D10.DRIVE_RTE_SUM  /*추진율*/      
			                         , ( SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
			                         , D10.DLY_DT_SUM /*지연일*/
			                         , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
			                         , D11.CTB_RTE
			                         , D11.BLT_DPT_CD
			                         , D10.AUD_KND_CD
	                                 , D10.AUD_STEP_CD_MAX
	                                 , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
			                         , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
			                         , D10.AUD_YR
			                         , D10.TSK_NO
			                     FROM (
			                        SELECT AUD_KND_CD
			                             , AUD_YR
			                             , TSK_NO
			                             , AUD_STEP_CD_MIN
			                             , AUD_STEP_CD_MAX
			                             , MNDY_CNT
			                             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
			                             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
			                             , DRIVE_RTE_SUM  /*추진율*/      
			                             , DLY_DT_SUM /*지연일*/
			                             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
			                             , EVL_YR
			                             , HLYR_DVSN_CD
			                             , SYT_TRTM_YN
			                             , SPE_ADD_SC
			                             , MDT_ASC
			                          FROM (
			                            SELECT D5.AUD_KND_CD
			                                 , D5.AUD_YR
			                                 , D5.TSK_NO
			                                 , D5.AUD_STEP_CD_MIN
			                                 , D5.AUD_STEP_CD_MAX
			                                 , D5.MNDY_CNT
			                                 , (SELECT F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
			                                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
	                                                                          , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
	                                                                                     AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
	                                                                          , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
			                                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
			                                      FROM TBCSPAOE008D 
			                                     WHERE EVL_YR        = #strEvlYr#
			                                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
			                                       AND TSK_DVSN_CD   = '10000' 
			                                       AND AUD_KND_CD    = D5.AUD_KND_CD   
			                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
			                                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
			                                      FROM TBCSPAOE022M
			                                     WHERE AUD_YR = D5.AUD_YR
			                                       AND TSK_NO = D5.TSK_NO
			                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
			                                 , D6.EVL_YR
			                                 , D6.HLYR_DVSN_CD
			                                 , D5.SYT_TRTM_YN
			                                 , D6.SPE_ADD_SC
			                                 , D6.MDT_ASC
			                             FROM (
			                                    SELECT D2.HNDL_DIV_DPT_CD
			                                         , D2.SPVR_CNB
			                                         , D2.AUD_KND_CD
			                                         , D2.AUD_YR
			                                         , D2.TSK_NO
			                                         , D2.AUD_SBJ_NM
			                                         , D1.AUD_STEP_CD_MIN
			                                         , D1.AUD_STEP_CD_MAX
			                                         , D2.MNDY_CNT
			                                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
			                                      FROM (
			                                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
			                                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
			                                             , AUD_YR
			                                             , TSK_NO
			                                          FROM TBCSPAOE022M
			                                         WHERE CMPT_DT IS NOT NULL
			                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
			                                         GROUP BY AUD_YR, TSK_NO
			                                     ) D1
			                                     , TBCSPAOE021M D2
			                                 WHERE D1.AUD_YR = D2.AUD_YR
			                                   AND D1.TSK_NO = D2.TSK_NO
			                                  ) D5 /*평가대상 감사활동 - 기준*/
			                                  , (
			                                    SELECT D8.AUD_TSK_KND_CD
			                                         , D8.AUD_YR
			                                         , D8.TSK_NO
			                                         , D8.SYT_EVL_ADVL_VAL
			                                         , D8.EVL_YR
			                                         , D8.HLYR_DVSN_CD
			                                         , D8.TSK_DVSN_CD
			                                         , D8.EVL_RK_CD
			                                         , D8.SYT_EVL_RK_CD
			                                         , D8.EVL_STEP_CD
			                                         , D8.SPE_ADD_SC
			                                         , D8.MDT_ASC
			                                       FROM (
			                                           SELECT EVL_YR
			                                                , HLYR_DVSN_CD 
			                                                , AUD_YR
			                                                , TSK_NO
			                                                , MAX(EVL_STEP_CD) AS EVL_STEP_CD
			                                                , AUD_TSK_KND_CD
			                                                , TSK_DVSN_CD
			                                             FROM TBCSPAOE029M
			                                           WHERE  1=1 
			                                           AND (AUD_YR, TSK_NO, EVL_STEP_CD) 
			                                                   IN (SELECT AUD_YR, TSK_NO, MAX(EVL_STEP_CD)
			                                                       FROM TBCSPAOE029M 
			                                                       WHERE  (AUD_YR,TSK_NO) IN (SELECT
			                                                       AUD_YR ,
			                                                       TSK_NO
			                                                  FROM TBCSPAOE022M
			                                                 WHERE CMPT_DT IS NOT NULL
			                                                   AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
			                                                 GROUP BY AUD_YR,
			                                                       TSK_NO )
			                                                       GROUP BY AUD_YR, TSK_NO  )
			                                              AND TSK_DVSN_CD  = '10000'
			                                              AND EVL_STA_CD   = '300' /*평가완료*/
			                                            GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
			                                     ) D7
			                                     , TBCSPAOE029M D8
			                                    WHERE D7.EVL_YR = D8.EVL_YR
			                                      AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
			                                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
			                                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
			                                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
			                                      AND D7.AUD_YR = D8.AUD_YR
			                                      AND D7.TSK_NO = D8.TSK_NO	                                          
			                                ) D6 /*감사사항 평가관리*/
			                                , TBCSPAOE010D D7
			                            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
			                              AND D5.AUD_YR          = D6.AUD_YR         (+)
			                              AND D5.TSK_NO          = D6.TSK_NO         (+)
			                              AND D6.EVL_YR = D7.EVL_YR (+) 
			                              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
			                              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
			                              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
			                              AND D6.EVL_RK_CD = D7.RK_CD (+)		  
			                          ) D9
			                      ) D10
			                      , TBCSPAOE023M D11
			                 WHERE D10.AUD_YR = D11.AUD_YR
			                   AND D10.TSK_NO = D11.TSK_NO
			                   AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
			                   AND D11.CTB_RTE != 0
							]]>
								<isNotEmpty property="strDeptCd">
									AND D11.BLT_DPT_CD = #strDeptCd#
								</isNotEmpty>				
							<![CDATA[	                   
			               ) D19
		               ) D20
		            ) D21
	            ) D22
                , ( 
                SELECT DPT_CD
														 FROM TBDCMACM002M
														WHERE  DPT_TP_CD = 'A'     
                ) D23
                , TBDCMACM002M D24
            WHERE D22.DPT_CD = D23.DPT_CD
              AND D22.DPT_CD = D24.DPT_CD
			]]>
				<isNotEmpty property="strDeptUpCd">
					AND NVL(D24.HIRK_DPT_CD, D22.DPT_CD) = #strDeptUpCd#
				</isNotEmpty>				
			<![CDATA[	              	            
	        )
	    GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD
	    ORDER BY DPT_CD
		  ]]>
	</select>
	<!-- ################################ 부서별 입무실적 총괄 끝 (CSPAOE060Q) ##################################### -->

	<!-- ################################ 개인별 업무실적 총괄 시작 (CSPAOE061Q) ################################### -->
	<!-- 직급 -->
	<select id="CSPAOE061QRankCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_CODE_NM('1000173', RANK_CD) AS CD_NM
			     , RANK_CD                       AS CD
			  FROM TBCSPAOE035M 
			 WHERE RANK_CD IS NOT NULL
			 GROUP BY RANK_CD		
		  ]]>
	</select>

	<!-- 조회한다. -->
	<select id="CSPAOE061Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
            SELECT EVL_DPT_UP_NM  
			     , EVL_DPT_NM      /*평가소속부서명*/
			     , RANK_NM       /*직급*/
			     , NAM           /*성명*/
			     , NEVLT_CNB
			     , PSN_TSK_ASC_1    AS PSN_TSK_ASC_1   /*감사활동*/
			     , PSN_TSK_ASC_2    AS PSN_TSK_ASC_2   /*모니터링*/
			     , PSN_TSK_ASC_3    AS PSN_TSK_ASC_3   /*결산업무*/
			     , PSN_TSK_ASC_4    AS PSN_TSK_ASC_4   /*연보업무*/
			     , PSN_TSK_ASC_5    AS PSN_TSK_ASC_5   /*총괄업무*/
			     , PSN_TSK_ASC_6    AS PSN_TSK_ASC_6   /*집행전말*/
			     , PSN_TSK_ASC_7    AS PSN_TSK_ASC_7   /*기타업무*/
			     , PSN_TSK_ASC_8    AS PSN_TSK_ASC_8   /*성과보고서*/
			     , PSN_TSK_ASC_9    AS PSN_TSK_ASC_9   /*법령모니터링*/
			     , PSN_TSK_ASC_99    AS PSN_TSK_ASC_99   /*법령모니터링*/
			     , SPRT_CVS_ASC     AS SPRT_CVS_ASC    /*지원환상*/
			     , PSN_TSK_ASC_ALL  AS PSN_TSK_ASC_ALL /*종합평점*/
			     , DECODE(EVL_TG_YN, 'Y', TO_CHAR(RANK_NUM), '평가제외') AS RANK_NUM   /*직급별 순위*/
                 , EVL_TG_YN /*평가대상여부*/
                 , RMK /*비고*/
                 , BLT_DPT_UP_NM /*현부서(국/단)*/
			     , BLT_DPT_NM    /*현부서(과)*/
			 FROM (	
				SELECT F_DPT_INFO(MAIN.HIRK_DPT_CD, '1') AS BLT_DPT_UP_NM /*현부서(국/단)*/
                     , F_DPT_INFO(BLT_DPT_CD, '1') || 
                          CASE WHEN DPT.DPT_TP_CD IS NOT NULL THEN '(' || DECODE(DPT.DPT_TP_CD, 'S', 'Y', 'A', 'A', 'E', 'E', '') || ')' 
                                ELSE '' END AS BLT_DPT_NM      /*현부서(과)*/
				     , F_CODE_NM('1000173', RANK_CD) AS RANK_NM       /*직급*/
				     , F_USR_INFO(NEVLT_CNB, '2') AS NAM           /*성명*/
				     , NEVLT_CNB
				     , PSN_TSK_ASC_1    AS PSN_TSK_ASC_1   /*감사활동*/
				     , PSN_TSK_ASC_2    AS PSN_TSK_ASC_2   /*모니터링*/
				     , PSN_TSK_ASC_3    AS PSN_TSK_ASC_3   /*결산업무*/
				     , PSN_TSK_ASC_4    AS PSN_TSK_ASC_4   /*연보업무*/
				     , PSN_TSK_ASC_5    AS PSN_TSK_ASC_5   /*총괄업무*/
				     , PSN_TSK_ASC_6    AS PSN_TSK_ASC_6   /*집행전말*/
				     , PSN_TSK_ASC_7    AS PSN_TSK_ASC_7   /*기타업무*/
				     , PSN_TSK_ASC_8    AS PSN_TSK_ASC_8   /*성과보고서*/
				     , PSN_TSK_ASC_9    AS PSN_TSK_ASC_9   /*법령모니터링*/
				     , PSN_TSK_ASC_99    AS PSN_TSK_ASC_99   /*법령모니터링*/
				     , SPRT_CVS_ASC     AS SPRT_CVS_ASC    /*지원환상*/
				     , PSN_TSK_ASC_ALL  AS PSN_TSK_ASC_ALL /*종합평점*/
                     , (CASE WHEN EVL_DPT_UP_CD IS NOT NULL THEN F_DPT_INFO(EVL_DPT_UP_CD, '1') ELSE '' END) AS EVL_DPT_UP_NM      /*평가소속부서명*/
				     , (CASE WHEN EVL_DPT_CD IS NOT NULL THEN CASE WHEN DPT_DVSN_CD IS NOT NULL THEN DECODE(DPT_DVSN_CD, '20', 'Y', '10', 'A', '')
		                    ELSE '' END || '(' || F_DPT_INFO(EVL_DPT_CD, '1') || ')' ELSE '' END ) AS EVL_DPT_NM      /*평가소속부서명*/
				     , RANK_NUM   /*직급별 순위*/
				     , RANK_CD
                     , NVL(EVL_TG_YN, 'N') AS EVL_TG_YN
                     , RMK
                     , EVL_DPT_UP_CD
                     , EVL_DPT_CD
				  FROM (
					SELECT HIRK_DPT_CD      /*현부서(국/단)*/
					     , BLT_DPT_CD       /*현부서(과)*/
					     , RANK_CD          /*직급*/
					     , NEVLT_CNB
					     , PSN_TSK_ASC_1    /*감사활동*/
					     , PSN_TSK_ASC_2    /*모니터링*/
					     , PSN_TSK_ASC_3    /*결산업무*/
					     , PSN_TSK_ASC_4    /*연보업무*/
					     , PSN_TSK_ASC_5    /*총괄업무*/
					     , PSN_TSK_ASC_6    /*집행전말*/
					     , PSN_TSK_ASC_7    /*기타업무*/
					     , PSN_TSK_ASC_8    /*성과보고서*/
					     , PSN_TSK_ASC_9    /*법령모니터링*/
					     , PSN_TSK_ASC_99    /*법령모니터링*/
					     , SPRT_CVS_ASC     /*지원환상 - 추후 테이블 바꾸고 나서 값 가져올수 있음*/
					     , PSN_TSK_ASC_ALL  /*종합평점*/
					     , EVL_DPT_CD       /*평가종료일 소속부서관리에서 관리되는 평가부서코드*/
					     , EVL_DPT_UP_CD
                         , DPT_DVSN_CD
                         , EVL_TG_YN
                         , RMK
					     , RANK() OVER(PARTITION BY RANK_CD, EVL_TG_YN ORDER BY PSN_TSK_ASC_ALL DESC) AS RANK_NUM   /*직급별 순위*/ 
					  FROM (
	                        SELECT D21.EVL_YR
	                             , D21.HLYR_DVSN_CD
	                             , ( SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE D20.DPT_CD = DPT_CD ) AS HIRK_DPT_CD
	                             , D20.DPT_CD AS BLT_DPT_CD /*현소속부서*/
	                             , D21.RANK_CD
	                             , D21.CNB AS NEVLT_CNB
	                             , NVL(BASE.PSN_TSK_ASC_1, 0) AS PSN_TSK_ASC_1
	                             , NVL(BASE.PSN_TSK_ASC_2, 0) AS PSN_TSK_ASC_2
	                             , NVL(BASE.PSN_TSK_ASC_3, 0) AS PSN_TSK_ASC_3
	                             , NVL(BASE.PSN_TSK_ASC_4, 0) AS PSN_TSK_ASC_4
	                             , NVL(BASE.PSN_TSK_ASC_5, 0) AS PSN_TSK_ASC_5
	                             , NVL(BASE.PSN_TSK_ASC_6, 0) AS PSN_TSK_ASC_6
	                             , NVL(BASE.PSN_TSK_ASC_7, 0) AS PSN_TSK_ASC_7
	                             , NVL(BASE.PSN_TSK_ASC_8, 0) AS PSN_TSK_ASC_8
	                             , NVL(BASE.PSN_TSK_ASC_9, 0) AS PSN_TSK_ASC_9
	                             , NVL(BASE.PSN_TSK_ASC_99, 0) AS PSN_TSK_ASC_99
	                             , NVL(BASE.SPRT_CVS_ASC, 0)  AS SPRT_CVS_ASC
	                             , NVL(BASE.PSN_TSK_ASC_1 + BASE.PSN_TSK_ASC_2 + BASE.PSN_TSK_ASC_3 + BASE.PSN_TSK_ASC_4 + BASE.PSN_TSK_ASC_5 + BASE.PSN_TSK_ASC_6 + BASE.PSN_TSK_ASC_7 + BASE.PSN_TSK_ASC_8 + BASE.PSN_TSK_ASC_9 + BASE.SPRT_CVS_ASC, 0) AS PSN_TSK_ASC_ALL 
	                             , D21.EVL_DPT_CD AS EVL_DPT_CD /*평가종료일 소속부서관리에서 관리되는 평가부서코드*/
                                 , D21.DPT_DVSN_CD /*부서구분코드*/ 
                                 , D21.EVL_DPT_UP_CD /*평가부서 상위코드*/
                                 , D21.EVL_TG_YN
                                 , D21.RMK
	                          FROM (
	                                SELECT EVL_YR
	                                     , HLYR_DVSN_CD
	                                     , NEVLT_CNB /*피평가자 전산번호*/
	                                     , NVL(SUM(PSN_TSK_ASC_1), 0) AS PSN_TSK_ASC_1  /*감사활동*/
	                                     , NVL(SUM(PSN_TSK_ASC_2), 0) AS PSN_TSK_ASC_2 /*모니터링*/
	                                     , NVL(SUM(PSN_TSK_ASC_3), 0) AS PSN_TSK_ASC_3 /*결산업무*/
	                                     , NVL(SUM(PSN_TSK_ASC_4), 0) AS PSN_TSK_ASC_4 /*연보업무*/
	                                     , NVL(SUM(PSN_TSK_ASC_5), 0) AS PSN_TSK_ASC_5 /*총괄업무*/
	                                     , NVL(SUM(PSN_TSK_ASC_6), 0) AS PSN_TSK_ASC_6 /*집행전말*/
	                                     , NVL(SUM(PSN_TSK_ASC_7), 0) AS PSN_TSK_ASC_7 /*기타업무*/
	                                     , NVL(SUM(PSN_TSK_ASC_8), 0) AS PSN_TSK_ASC_8 /*성과보고서*/
	                                     , NVL(SUM(PSN_TSK_ASC_9), 0) AS PSN_TSK_ASC_9 /*법령모니터링*/
	                                     , NVL(SUM(PSN_TSK_ASC_99), 0) AS PSN_TSK_ASC_99 /*법령모니터링*/
	                                     , NVL(SUM(SPRT_CVS_ASC), 0) AS SPRT_CVS_ASC
	                                 FROM (
                                       /*지원환산점수*/
                                       SELECT EVL_YR	                                   AS EVL_YR           /*평가년도*/
                                            , HLYR_DVSN_CD                                 AS HLYR_DVSN_CD	   /*반기구분*/
                                            , PTCPT_CNB                                    AS NEVLT_CNB	           /*전산번호*/
                                            , CHR_DPT_CD                                   AS DPT_CD /*평가할때 부서코드*/
                                            , 0 AS PSN_TSK_ASC_1 /*개인평점*/
                                            , 0 AS PSN_TSK_ASC_2 /*모니터링*/
                                            , 0 AS PSN_TSK_ASC_3 /*결산업무*/
                                            , 0 AS PSN_TSK_ASC_4 /*연보업무*/
                                            , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
                                            , 0 AS PSN_TSK_ASC_6 /*집행전말*/
                                            , 0 AS PSN_TSK_ASC_7 /*기타업무*/
                                            , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
                                            , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/
                                            , 0 AS PSN_TSK_ASC_99 /*법령모니터링*/  
                                            , ROUND(F_AOE_DPT_TSC(#strEvlYr#, #strHlyrDvsnCd#, CHR_DPT_CD) * CTB_RTE / 100, 2) AS SPRT_CVS_ASC      /*지원환산 개인평점*/
                                        FROM (
                                           SELECT D1.EVL_YR	                                   AS EVL_YR           /*평가년도*/
                                                , D1.HLYR_DVSN_CD                              AS HLYR_DVSN_CD	   /*반기구분*/
                                                , D1.PTCPT_CNB                                 
                                                , NVL(SUM(D2.WGT_RTE * D1.CTB_RTE / 100), 0)   AS CTB_RTE	       /*기여율*/
                                                , D1.CHR_DPT_CD
                                             FROM TBCSPAOE027M D1
                                                , TBCSPAOE026M D2
                                            WHERE 1=1
                                              AND D1.EVL_YR       = D2.EVL_YR
                                              AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                                              AND D1.CHR_DPT_CD   = D2.CHR_DPT_CD
                                              AND D1.TSK_NO       = D2.TSK_NO
                                              AND D1.EVL_YR       = #strEvlYr#
                                              AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                              AND D1.CTB_RTE     != 0
                                              AND D1.PTCPT_CNB IN (SELECT CNB FROM TBCSPAOE041M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND DPT_DVSN_CD ='10' ) /* 2015.03.30 권효정 감사관 요청사항 */
                                            GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.PTCPT_CNB, D1.CHR_DPT_CD
                                        ) 
                                        
                                        UNION ALL  

	                                    SELECT EVL_YR
	                                         , HLYR_DVSN_CD
	                                         , NEVLT_CNB /*피평가자 전산번호*/
	                                         , DPT_CD /*평가할때 부서코드*/
	                                         , PSN_TSK_ASC_1
	                                         , PSN_TSK_ASC_2 /*모니터링*/
	                                         , PSN_TSK_ASC_3 /*결산업무*/
	                                         , PSN_TSK_ASC_4 /*연보업무*/
	                                         , PSN_TSK_ASC_5 /*총괄업무*/
	                                         , PSN_TSK_ASC_6 /*집행전말*/
	                                         , PSN_TSK_ASC_7 /*기타업무*/
	                                         , PSN_TSK_ASC_8 /*성과보고서*/
	                                         , PSN_TSK_ASC_9 /*법령모니터링*/
	                                         , PSN_TSK_ASC_99 /*법령모니터링*/
	                                         , SPRT_CVS_ASC
                                          FROM (
                                            SELECT EVL_YR
                                                 , HLYR_DVSN_CD
                                                 , NEVLT_CNB /*피평가자 전산번호*/
                                                 , DPT_CD /*평가할때 부서코드*/
                                                 , 0 AS PSN_TSK_ASC_1
                                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
                                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 2 AND 3 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*결산업무*/
                                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 4 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*연보업무*/
                                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_5 /*총괄업무*/
                                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_6 /*집행전말*/
                                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 94 AND 96) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_7 /*기타업무*/
                                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 13 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_8 /*성과보고서*/
                                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 7 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_9 /*법령모니터링*/
                                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 65 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 9 AND 10 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 69 AND 70 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 76 AND 80 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 94 AND 96 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_99 /*기타업무*/
                                                 , 0 AS SPRT_CVS_ASC
                                              FROM TBCSPAOE035M                                             
                                             WHERE EVL_YR       = #strEvlYr#
                                               AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                                               AND TSK_DVSN_CD = '10001'
                                               AND NEVLT_CNB IN (SELECT CNB FROM TBCSPAOE041M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND DPT_DVSN_CD ='10' ) /* 2015.03.30 권효정 감사관 요청사항 */
                                           ) 
	                                      
	                                     UNION ALL    
	                                     
	                                    SELECT #strEvlYr# AS EVL_YR
	                                         , #strHlyrDvsnCd#  AS HLYR_DVSN_CD
	                                         , PTCPT_CNB AS NEVLT_CNB   
	                                         , BLT_DPT_CD AS DPT_CD /*평가할때 부서코드*/
	                                         , ROUND(STND_ASC * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 /*개인평점*/
	                                         , 0 AS PSN_TSK_ASC_2 /*모니터링*/
	                                         , 0 AS PSN_TSK_ASC_3 /*결산업무*/
	                                         , 0 AS PSN_TSK_ASC_4 /*연보업무*/
	                                         , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
	                                         , 0 AS PSN_TSK_ASC_6 /*집행전말*/
	                                         , 0 AS PSN_TSK_ASC_7 /*기타업무*/
	                                         , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
	                                         , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/
	                                         , 0 AS PSN_TSK_ASC_99 /*법령모니터링*/
	                                         , 0 AS SPRT_CVS_ASC
	                                      FROM (
						                    SELECT D20.PTCPT_CNB  
						                         , D20.DRIVE_RTE_ASC /*추진율 조정평점*/ 
						                         , D20.CTB_RTE
						                         , D20.BLT_DPT_CD
						                         , D20.SPE_ADD_SC
		                                         , D20.MDT_ASC
						                         , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/  
						                         , D20.STND_ASC
						                      FROM (	                                      
		                                        SELECT D19.PTCPT_CNB  
		                                             , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
		                                             , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
		                                                    ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100), 2) END)) AS ASP_STND_ASC /*가감평점*/    
		                                             , D19.CTB_RTE
		                                             , D19.BLT_DPT_CD
		                                             , D19.AUD_KND_CD
						                             , D19.AUD_STEP_CD_MAX
						                             , D19.DLY_DT_SUM
						                             , D19.SYT_EVL_ADVL_VAL
						                             , D19.SPE_ADD_SC
		                                             , D19.MDT_ASC
		                                             , D19.AUD_YR
		                                             , D19.TSK_NO
		                                             , D19.STND_ASC
		                                         FROM (
		                                            SELECT D11.PTCPT_CNB
		                                                 , D10.STND_ASC /*표준평점*/
		                                                 , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
		                                                 , D10.DRIVE_RTE_SUM  /*추진율*/      
		                                                 , D10.DRIVE_RTE_ASC /*추진율 조정평점*/
		                                                 , D10.DLY_DT_SUM /*지연일*/
		                                                 , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
		                                                 , D11.CTB_RTE
		                                                 , D11.BLT_DPT_CD
		                                                 , D10.AUD_KND_CD
                                						 , D10.AUD_STEP_CD_MAX
                                						 , D10.SPE_ADD_SC
		                                                 , D10.MDT_ASC
		                                                 , D10.AUD_YR
		                                                 , D10.TSK_NO
		                                             FROM (
		                                                SELECT AUD_KND_CD
		                                                     , AUD_YR
		                                                     , TSK_NO
		                                                     , AUD_STEP_CD_MIN
		                                                     , AUD_STEP_CD_MAX
		                                                     , MNDY_CNT
		                                                     , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
		                                                     , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
		                                                     , DRIVE_RTE_SUM  /*추진율*/      
		                                                     , DLY_DT_SUM /*지연일*/
		                                                     , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
		                                                     , EVL_YR
		                                                     , HLYR_DVSN_CD
		                                                     , SYT_TRTM_YN
		                                                     , ROWNUM
		                                                     , F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_KND_CD, AUD_STEP_CD_MIN, AUD_STEP_CD_MAX, MNDY_CNT, SYT_TRTM_YN, NVL(SYT_EVL_ADVL_VAL, 0)) AS DRIVE_RTE_ASC
		                                                     , NVL(SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS SPE_ADD_SC
		                                                     , NVL(MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS MDT_ASC
		                                                  FROM (
		                                                    SELECT D5.AUD_KND_CD
		                                                         , D5.AUD_YR
		                                                         , D5.TSK_NO
		                                                         , D5.AUD_STEP_CD_MIN
		                                                         , D5.AUD_STEP_CD_MAX
		                                                         , D5.MNDY_CNT
		                                                         , F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) AS STND_ASC /*표준평점*/
		                                                         , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
                                                                          , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
                                                                                     AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
                                                                          , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
		                                                         , (SELECT NVL(SUM(DRIVE_RTE), 0) 
		                                                              FROM TBCSPAOE008D 
		                                                             WHERE EVL_YR        = #strEvlYr#
		                                                               AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
		                                                               AND TSK_DVSN_CD   = '10000' 
		                                                               AND AUD_KND_CD    = D5.AUD_KND_CD   
		                                                               AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
		                                                         , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
		                                                              FROM TBCSPAOE022M
		                                                             WHERE AUD_YR = D5.AUD_YR
		                                                               AND TSK_NO = D5.TSK_NO
		                                                               AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
		                                                         , D6.EVL_YR
		                                                         , D6.HLYR_DVSN_CD
		                                                         , D5.SYT_TRTM_YN
		                                                         , D6.SPE_ADD_SC
		                                                         , D6.MDT_ASC
		                                                     FROM (
		                                                            SELECT D2.HNDL_DIV_DPT_CD
		                                                                 , D2.SPVR_CNB
		                                                                 , D2.AUD_KND_CD
		                                                                 , D2.AUD_YR
		                                                                 , D2.TSK_NO
		                                                                 , D2.AUD_SBJ_NM
		                                                                 , D1.AUD_STEP_CD_MIN
		                                                                 , D1.AUD_STEP_CD_MAX
		                                                                 , D2.MNDY_CNT
		                                                                 , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
		                                                              FROM (
		                                                                SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
		                                                                     , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
		                                                                     , AUD_YR
		                                                                     , TSK_NO
		                                                                  FROM TBCSPAOE022M
		                                                                 WHERE CMPT_DT IS NOT NULL
		                                                                   AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
		                                                                 GROUP BY AUD_YR, TSK_NO
		                                                             ) D1
		                                                             , TBCSPAOE021M D2
		                                                         WHERE D1.AUD_YR = D2.AUD_YR
		                                                           AND D1.TSK_NO = D2.TSK_NO
		                                                          ) D5 /*평가대상 감사활동 - 기준*/
		                                                          , (
		                                                            SELECT D8.AUD_TSK_KND_CD
		                                                                 , D8.AUD_YR
		                                                                 , D8.TSK_NO
		                                                                 , D8.SYT_EVL_ADVL_VAL
		                                                                 , D8.EVL_YR
		                                                                 , D8.HLYR_DVSN_CD
		                                                                 , D8.TSK_DVSN_CD
		                                                                 , D8.EVL_RK_CD
		                                                                 , D8.SYT_EVL_RK_CD
		                                                                 , D8.EVL_STEP_CD
		                                                                 , D8.SPE_ADD_SC
		                                                                 , D8.MDT_ASC
		                                                               FROM (
		                                                                   SELECT EVL_YR
		                                                                        , HLYR_DVSN_CD 
		                                                                        , AUD_YR
		                                                                        , TSK_NO
		                                                                        , MAX(EVL_STEP_CD) AS EVL_STEP_CD
		                                                                        , AUD_TSK_KND_CD
		                                                                        , TSK_DVSN_CD
		                                                                     FROM TBCSPAOE029M
		                                                                   WHERE 1=1
		                                                                      AND TSK_DVSN_CD  = '10000'
		                                                                      AND EVL_STA_CD   = '300' /*평가완료*/
		                                                                      AND (AUD_YR, TSK_NO, EVL_STEP_CD) 
		                                                                           IN (SELECT AUD_YR, TSK_NO, MAX(EVL_STEP_CD)
		                                                                               FROM TBCSPAOE029M 
		                                                                               WHERE  (AUD_YR,TSK_NO) IN (SELECT
		                                                                               AUD_YR ,
		                                                                               TSK_NO
		                                                                          FROM TBCSPAOE022M
		                                                                         WHERE CMPT_DT IS NOT NULL
		                                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
		                                                                         GROUP BY AUD_YR,
		                                                                               TSK_NO )
		                                                                               GROUP BY AUD_YR, TSK_NO  )
		                                                                    GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
		                                                             ) D7
		                                                             , TBCSPAOE029M D8
		                                                            WHERE D7.EVL_YR = D8.EVL_YR
		                                                              AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
		                                                              AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
		                                                              AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
		                                                              AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
		                                                              AND D7.AUD_YR = D8.AUD_YR
		                                                              AND D7.TSK_NO = D8.TSK_NO	                                          
		                                                        ) D6 /*감사사항 평가관리*/
		                                                        , TBCSPAOE010D D7
		                                                    WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD  (+)
		                                                      AND D5.AUD_YR          = D6.AUD_YR          (+)
		                                                      AND D5.TSK_NO          = D6.TSK_NO          (+)
		                                                      AND D6.EVL_YR = D7.EVL_YR (+) 
		                                                      AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
		                                                      AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
		                                                      AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
		                                                      AND D6.EVL_RK_CD = D7.RK_CD (+)		  
		                                                  ) D9
		                                              ) D10
		                                              , (SELECT /*+ USE_NL(A02) INDEX(A02 IDX_TBCSPAOE023M_01) */
							                          		A02.AUD_YR, A02.TSK_NO, A02.AUD_STEP_CD, A02.PTCPT_CNB, A02.CTB_RTE, A02.BLT_DPT_CD, rownum
							                          	   FROM (SELECT MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX 
																		, AUD_YR
																		, TSK_NO
																   FROM TBCSPAOE022M
																  WHERE CMPT_DT IS NOT NULL
																	AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
																  GROUP BY AUD_YR, TSK_NO) A01
																, TBCSPAOE023M A02
														  WHERE A02.AUD_YR = A01.AUD_YR
							                                AND A02.TSK_NO = A01.TSK_NO
							                                AND A02.AUD_STEP_CD = A01.AUD_STEP_CD_MAX
							                                AND A02.CTB_RTE != 0
							                                AND EXISTS (SELECT /*+ NO_UNNEST */ 'Y' 
							                                			  FROM TBCSPAOE041M Z 
							                                			 WHERE EVL_YR = #strEvlYr#
							                                			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
							                                			   AND DPT_DVSN_CD ='10' 
							                                               AND A02.PTCPT_CNB = Z.CNB)
							                        ) D11
		                                         WHERE D10.AUD_YR = D11.AUD_YR
		                                           AND D10.TSK_NO = D11.TSK_NO
		                                           AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD                                                  
		                                       ) D19
	                                       ) D20
	                                    )
	                                )
	                            GROUP BY EVL_YR, HLYR_DVSN_CD, NEVLT_CNB
	                          ) BASE
                              , (
                                SELECT EVL_DPT_CD
                                     , CNB
                                     , EVL_TG_YN /*평가대상여부*/
                                     , RMK /*비고*/
                                     , DPT_DVSN_CD /*부서구분코드*/
                                     , HIRK_DPT_CD AS EVL_DPT_UP_CD
                                     , RANK_CD
                                     , EVL_YR
                                     , HLYR_DVSN_CD
                                  FROM TBCSPAOE041M D18
                                     , TBDCMACM002M D19
                                 WHERE D18.EVL_DPT_CD = D19.DPT_CD
                                   AND D18.EVL_YR = #strEvlYr#
                                   AND D18.HLYR_DVSN_CD = #strHlyrDvsnCd# 
                                   AND D18.DPT_DVSN_CD = '10'
                              ) D21
                              , TBDCMACM001M D20
	                     WHERE BASE.NEVLT_CNB (+) = D21.CNB
	                       AND D21.CNB = D20.CNB     
				      	)
				      ) MAIN
	                  , TBDCMACM002M DPT
				 WHERE MAIN.BLT_DPT_CD = DPT.DPT_CD (+)
                 ORDER BY DECODE(EVL_TG_YN, 'Y', 1, 2), RANK_CD, RANK_NUM 
			  	)
			WHERE 1 = 1			
			]]>
			<isNotEmpty property="strRankCd">
				AND RANK_CD = #strRankCd#
			</isNotEmpty>		
			<isNotEmpty property="strDeptUpCd">
				AND EVL_DPT_UP_CD = #strDeptUpCd#
			</isNotEmpty>
			<isNotEmpty property="strDeptCd">
				AND EVL_DPT_CD = #strDeptCd#
			</isNotEmpty>							
	</select>
	<!-- ################################ 개인별 업무실적 총괄 끝 (CSPAOE061Q) ################################## -->

	<!-- ################################ 부서별 평점환산 시작 (CSPAOE095E) ##################################### -->
	<select id="CSPAOE095EDataCntselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE034M
			 WHERE EVL_YR          = #strEvlYr#
			   AND HLYR_DVSN_CD    = #strHlyrDvsnCd#
			   AND DPT_TYP_DVSN_CD = #strDptTypDvsnCd# /*감사부서:10, 지원부서:20*/
		]]>
	</select>
	
	<!-- 감사부서 탭 - 맨 처음에 기초 데이터 세팅해준다. -->
	<update id="CSPAOE095EBaseDataFinsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPAOE034M
		    (
			       EVL_YR
				 , HLYR_DVSN_CD
				 , DPT_TYP_DVSN_CD
				 , DPT_CD
				 , DPT_ASC
				 , DPT_NOP_CNT
				 , PSN_ASC
			 	 , FRT_USR_ID
			 	 , FNL_USR_ID
				 , FNL_DEAL_DPT_CD
				 , FNL_MNU_ID
				 , FRT_REGI_DH
				 , FNL_MDF_DH
			) 
            SELECT #strEvlYr#       /*평가년도*/
                 , #strHlyrDvsnCd#  /*반기구분코드*/
                 , '10'             /*부서유형구분코드*/
                 , JUMSU.DPT_CD     /*부서코드*/
                 , JUMSU.DPT_ASC    /*부서평점*/
                 , NVL(CNT.DPT_NOP_CNT, 1)  /*부서인원수*/
                 , ROUND(JUMSU.DPT_ASC / NVL(CNT.DPT_NOP_CNT, 1), 2) AS PSN_ASC /*개인평점*/
			     , #FRT_USR_ID#
			     , #FRT_USR_ID#
			     , #FNL_DEAL_DPT_CD#
			     , #FNL_MNU_ID#
			     , SYSDATE
			     , SYSDATE     
              FROM (
                SELECT DPT_CD
                     /*, NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) AS DPT_ASC 종합평점=모니터링+총괄업무+집행전말+감사활동*/
                     , NVL(SUM(PSN_TSK_ASC_1), 0)  AS DPT_ASC
                 FROM (
                    SELECT D22.DPT_CD
                         , D22.PSN_TSK_ASC_1
                         , D22.PSN_TSK_ASC_2 /*모니터링*/
                         , D22.PSN_TSK_ASC_3 /*총괄업무*/
                         , D22.PSN_TSK_ASC_4 /*집행전말*/
                      FROM (
                        SELECT DPT_CD /*평가할때 부서코드*/
                             , 0 AS PSN_TSK_ASC_1
                             , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24  OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*총괄업무*/
                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*집행전말*/
                          FROM TBCSPAOE035M 
                         WHERE EVL_YR       = #strEvlYr#
                           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                           AND TSK_DVSN_CD  = '10001'		               
                          
                         UNION ALL    

                        SELECT BLT_DPT_CD AS DPT_CD /*평가할때 부서코드*/
                             /*, ROUND((DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 */ /*개인평점*/
                             ,ROUND(STND_ASC * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 
                             , 0 AS PSN_TSK_ASC_2 /*모니터링*/
                             , 0 AS PSN_TSK_ASC_3 /*총괄업무*/
                             , 0 AS PSN_TSK_ASC_4 /*집행전말*/
                          FROM (
                            SELECT D20.PTCPT_CNB  
                                 , D20.DRIVE_RTE_ASC /*추진율 조정평점*/ 
                                 , D20.CTB_RTE
                                 , D20.BLT_DPT_CD
                                 , D20.SPE_ADD_SC
                                 , D20.MDT_ASC
                                 , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/
                                 ,STND_ASC  
                              FROM (
                                SELECT D19.PTCPT_CNB  
                                     , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
                                     , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
                                            ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
                                     , D19.CTB_RTE
                                     , D19.BLT_DPT_CD
                                     , D19.AUD_KND_CD
                                     , D19.AUD_STEP_CD_MAX
                                     , D19.DLY_DT_SUM
                                     , D19.SYT_EVL_ADVL_VAL
                                     , D19.SPE_ADD_SC
                                     , D19.MDT_ASC
                                     , D19.AUD_YR
                                     , D19.TSK_NO
                                     ,STND_ASC
                                 FROM (
                                    SELECT D11.PTCPT_CNB
                                         , D10.STND_ASC /*표준평점*/
                                         , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
                                         , D10.DRIVE_RTE_SUM  /*추진율*/      
                                         , ( SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
                                         , D10.DLY_DT_SUM /*지연일*/
                                         , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
                                         , D11.CTB_RTE
                                         , D11.BLT_DPT_CD
                                         , D10.AUD_KND_CD
                                         , D10.AUD_STEP_CD_MAX
                                         , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
                                         , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
                                         , D10.AUD_YR
                                         , D10.TSK_NO
                                         
                                     FROM (
                                        SELECT AUD_KND_CD
                                             , AUD_YR
                                             , TSK_NO
                                             , AUD_STEP_CD_MIN
                                             , AUD_STEP_CD_MAX
                                             , MNDY_CNT
                                             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
                                             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
                                             , DRIVE_RTE_SUM  /*추진율*/      
                                             , DLY_DT_SUM /*지연일*/
                                             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
                                             , EVL_YR
                                             , HLYR_DVSN_CD
                                             , SYT_TRTM_YN
                                             , SPE_ADD_SC
                                             , MDT_ASC
                                             
                                          FROM (
                                            SELECT D5.AUD_KND_CD
                                                 , D5.AUD_YR
                                                 , D5.TSK_NO
                                                 , D5.AUD_STEP_CD_MIN
                                                 , D5.AUD_STEP_CD_MAX
                                                 , D5.MNDY_CNT
                                                 , (SELECT F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
                                                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
                                                                                  , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
                                                                                             AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
                                                                                  , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
                                                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
                                                      FROM TBCSPAOE008D 
                                                     WHERE EVL_YR        = #strEvlYr#
                                                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
                                                       AND TSK_DVSN_CD   = '10000' 
                                                       AND AUD_KND_CD    = D5.AUD_KND_CD   
                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
                                                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
                                                      FROM TBCSPAOE022M
                                                     WHERE AUD_YR = D5.AUD_YR
                                                       AND TSK_NO = D5.TSK_NO
                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
                                                 , NVL(D6.EVL_YR,#strEvlYr#) AS EVL_YR
                                                 , NVL(D6.HLYR_DVSN_CD,#strHlyrDvsnCd#) AS HLYR_DVSN_CD
                                                 , D5.SYT_TRTM_YN
                                                 , D6.SPE_ADD_SC
                                                 , D6.MDT_ASC
                                             FROM (
                                                    SELECT D2.HNDL_DIV_DPT_CD
                                                         , D2.SPVR_CNB
                                                         , D2.AUD_KND_CD
                                                         , D2.AUD_YR
                                                         , D2.TSK_NO
                                                         , D2.AUD_SBJ_NM
                                                         , D1.AUD_STEP_CD_MIN
                                                         , D1.AUD_STEP_CD_MAX
                                                         , D2.MNDY_CNT
                                                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
                                                      FROM (
                                                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                                                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                                             , AUD_YR
                                                             , TSK_NO
                                                          FROM TBCSPAOE022M
                                                         WHERE CMPT_DT IS NOT NULL
                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                         GROUP BY AUD_YR, TSK_NO
                                                     ) D1
                                                     , TBCSPAOE021M D2
                                                 WHERE D1.AUD_YR = D2.AUD_YR
                                                   AND D1.TSK_NO = D2.TSK_NO
                                                  ) D5 /*평가대상 감사활동 - 기준*/
                                                  , (
                                                    SELECT D8.AUD_TSK_KND_CD
                                                         , D8.AUD_YR
                                                         , D8.TSK_NO
                                                         , D8.SYT_EVL_ADVL_VAL
                                                         , D8.EVL_YR
                                                         , D8.HLYR_DVSN_CD
                                                         , D8.TSK_DVSN_CD
                                                         , D8.EVL_RK_CD
                                                         , D8.SYT_EVL_RK_CD
                                                         , D8.EVL_STEP_CD
                                                         , D8.SPE_ADD_SC
                                                         , D8.MDT_ASC
                                                       FROM (
                                                           SELECT EVL_YR
                                                                , HLYR_DVSN_CD 
                                                                , AUD_YR
                                                                , TSK_NO
                                                                , MAX(EVL_STEP_CD) AS EVL_STEP_CD
                                                                , AUD_TSK_KND_CD
                                                                , TSK_DVSN_CD
                                                             FROM TBCSPAOE029M
                                                           WHERE 1=1
                                                             AND (AUD_YR,
                                                     TSK_NO,
                                                     EVL_STEP_CD) IN (SELECT AUD_YR,
                                                     			TSK_NO,
			                                                     MAX(EVL_STEP_CD)
			                                                FROM TBCSPAOE029M
			                                               WHERE (AUD_YR,
			                                                             TSK_NO) IN (SELECT AUD_YR ,
			                                                             TSK_NO
			                                                        FROM TBCSPAOE022M
			                                                       WHERE CMPT_DT IS NOT NULL
			                                                         AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
			                                                       GROUP BY AUD_YR,
			                                                             TSK_NO )
			                                               GROUP BY AUD_YR,
			                                                     TSK_NO )
                                                              AND TSK_DVSN_CD  = '10000'
                                                              AND EVL_STA_CD   = '300' /*평가완료*/
                                                            GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
                                                     ) D7
                                                     , TBCSPAOE029M D8
                                                    WHERE D7.EVL_YR = D8.EVL_YR
                                                      AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
                                                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
                                                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
                                                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
                                                      AND D7.AUD_YR = D8.AUD_YR
                                                      AND D7.TSK_NO = D8.TSK_NO	                                          
                                                ) D6 /*감사사항 평가관리*/
                                                , TBCSPAOE010D D7
                                            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
                                              AND D5.AUD_YR          = D6.AUD_YR         (+)
                                              AND D5.TSK_NO          = D6.TSK_NO         (+)
                                              AND D6.EVL_YR = D7.EVL_YR (+) 
                                              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
                                              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
                                              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
                                              AND D6.EVL_RK_CD = D7.RK_CD (+)		  
                                          ) D9
                                      ) D10
                                      , TBCSPAOE023M D11
                                 WHERE D10.AUD_YR = D11.AUD_YR
                                   AND D10.TSK_NO = D11.TSK_NO
                                   AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
                                   AND D11.CTB_RTE != 0	                   
                               ) D19
                           ) D20
                        ) D21
                    ) D22,
                    (SELECT DPT_CD
                          FROM TBDCMACM002M
                          WHERE USE_YN = 'Y'
                     /*감사부서만 나온다*/) D23
                 WHERE D22.DPT_CD = D23.DPT_CD            
                  )
                GROUP BY DPT_CD
                ) JUMSU
               , (
               SELECT DPT_CD 
                    , COUNT(CNB) AS DPT_NOP_CNT
                 FROM TBDCMACM001M
                GROUP BY DPT_CD
               ) CNT /*처음에는 인사정보테이블에서 건수를 가져온다.*/
            WHERE JUMSU.DPT_CD = CNT.DPT_CD	(+)	
		]]>
	</update>
	
	<!-- 감사부서 탭 - 맨 처음에 기초 데이터 세팅해준다. -->
	<update id="CSPAOE095EReBaseDataFinsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPAOE034M
			(
			       EVL_YR
				 , HLYR_DVSN_CD
				 , DPT_TYP_DVSN_CD
				 , DPT_CD
				 , DPT_ASC
				 , DPT_NOP_CNT
				 , PSN_ASC
			 	 , FRT_USR_ID
			 	 , FNL_USR_ID
				 , FNL_DEAL_DPT_CD
				 , FNL_MNU_ID
				 , FRT_REGI_DH
				 , FNL_MDF_DH
			) 
            SELECT #strEvlYr#       /*평가년도*/
                 , #strHlyrDvsnCd#  /*반기구분코드*/
                 , '10'             /*부서유형구분코드*/
                 , JUMSU.DPT_CD     /*부서코드*/
                 , JUMSU.DPT_ASC    /*부서평점*/
                 , NVL(CNT.DPT_NOP_CNT, 1)  /*부서인원수*/
                 , ROUND(JUMSU.DPT_ASC / NVL(CNT.DPT_NOP_CNT, 1), 2) AS PSN_ASC /*개인평점*/
			     , #FRT_USR_ID#
			     , #FRT_USR_ID#
			     , #FNL_DEAL_DPT_CD#
			     , #FNL_MNU_ID#
			     , SYSDATE
			     , SYSDATE     
              FROM (
                SELECT DPT_CD
                     /*, NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) AS DPT_ASC */ /*종합평점=모니터링+총괄업무+집행전말+감사활동*/
                      , NVL(SUM(PSN_TSK_ASC_1), 0)  AS DPT_ASC
                 FROM (
                    SELECT D22.DPT_CD
                         , D22.PSN_TSK_ASC_1
                         , D22.PSN_TSK_ASC_2 /*모니터링*/
                         , D22.PSN_TSK_ASC_3 /*총괄업무*/
                         , D22.PSN_TSK_ASC_4 /*집행전말*/
                      FROM (
                        SELECT DPT_CD /*평가할때 부서코드*/
                             , 0 AS PSN_TSK_ASC_1
                             , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24  OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*총괄업무*/
                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*집행전말*/
                          FROM TBCSPAOE035M 
                         WHERE EVL_YR       = #strEvlYr#
                           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                           AND TSK_DVSN_CD  = '10001'		               
                          
                         UNION ALL    

                        SELECT BLT_DPT_CD AS DPT_CD /*평가할때 부서코드*/
                             /*, ROUND((DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 */ /*개인평점*/
                             ,ROUND(STND_ASC * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1
                             
                             , 0 AS PSN_TSK_ASC_2 /*모니터링*/
                             , 0 AS PSN_TSK_ASC_3 /*총괄업무*/
                             , 0 AS PSN_TSK_ASC_4 /*집행전말*/
                          FROM (
                            SELECT D20.PTCPT_CNB  
                                 , D20.DRIVE_RTE_ASC /*추진율 조정평점*/ 
                                 , D20.CTB_RTE
                                 , D20.BLT_DPT_CD
                                 , D20.SPE_ADD_SC
                                 , D20.MDT_ASC
                                 , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/
                                 ,STND_ASC  
                              FROM (
                                SELECT D19.PTCPT_CNB  
                                     , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
                                     , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
                                            ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
                                     , D19.CTB_RTE
                                     , D19.BLT_DPT_CD
                                     , D19.AUD_KND_CD
                                     , D19.AUD_STEP_CD_MAX
                                     , D19.DLY_DT_SUM
                                     , D19.SYT_EVL_ADVL_VAL
                                     , D19.SPE_ADD_SC
                                     , D19.MDT_ASC
                                     , D19.AUD_YR
                                     , D19.TSK_NO
                                     ,STND_ASC
                                 FROM (
                                    SELECT D11.PTCPT_CNB
                                         , D10.STND_ASC /*표준평점*/
                                         , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
                                         , D10.DRIVE_RTE_SUM  /*추진율*/      
                                         , ( SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
                                         , D10.DLY_DT_SUM /*지연일*/
                                         , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
                                         , D11.CTB_RTE
                                         , D11.BLT_DPT_CD
                                         , D10.AUD_KND_CD
                                         , D10.AUD_STEP_CD_MAX
                                         , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
                                         , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
                                         , D10.AUD_YR
                                         , D10.TSK_NO
                                     FROM (
                                        SELECT AUD_KND_CD
                                             , AUD_YR
                                             , TSK_NO
                                             , AUD_STEP_CD_MIN
                                             , AUD_STEP_CD_MAX
                                             , MNDY_CNT
                                             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
                                             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
                                             , DRIVE_RTE_SUM  /*추진율*/      
                                             , DLY_DT_SUM /*지연일*/
                                             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
                                             , NVL(EVL_YR,#strEvlYr#) AS EVL_YR
                                             , NVL(HLYR_DVSN_CD,#strHlyrDvsnCd#) AS HLYR_DVSN_CD
                                             , SYT_TRTM_YN
                                             , SPE_ADD_SC
                                             , MDT_ASC
                                          FROM (
                                            SELECT D5.AUD_KND_CD
                                                 , D5.AUD_YR
                                                 , D5.TSK_NO
                                                 , D5.AUD_STEP_CD_MIN
                                                 , D5.AUD_STEP_CD_MAX
                                                 , D5.MNDY_CNT
                                                 , (SELECT F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
                                                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
                                                                                  , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
                                                                                             AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
                                                                                  , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
                                                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
                                                      FROM TBCSPAOE008D 
                                                     WHERE EVL_YR        = #strEvlYr#
                                                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
                                                       AND TSK_DVSN_CD   = '10000' 
                                                       AND AUD_KND_CD    = D5.AUD_KND_CD   
                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
                                                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
                                                      FROM TBCSPAOE022M
                                                     WHERE AUD_YR = D5.AUD_YR
                                                       AND TSK_NO = D5.TSK_NO
                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
                                                 , D6.EVL_YR
                                                 , D6.HLYR_DVSN_CD
                                                 , D5.SYT_TRTM_YN
                                                 , D6.SPE_ADD_SC
                                                 , D6.MDT_ASC
                                             FROM (
                                                    SELECT D2.HNDL_DIV_DPT_CD
                                                         , D2.SPVR_CNB
                                                         , D2.AUD_KND_CD
                                                         , D2.AUD_YR
                                                         , D2.TSK_NO
                                                         , D2.AUD_SBJ_NM
                                                         , D1.AUD_STEP_CD_MIN
                                                         , D1.AUD_STEP_CD_MAX
                                                         , D2.MNDY_CNT
                                                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
                                                      FROM (
                                                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                                                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                                             , AUD_YR
                                                             , TSK_NO
                                                          FROM TBCSPAOE022M
                                                         WHERE CMPT_DT IS NOT NULL
                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                         GROUP BY AUD_YR, TSK_NO
                                                     ) D1
                                                     , TBCSPAOE021M D2
                                                 WHERE D1.AUD_YR = D2.AUD_YR
                                                   AND D1.TSK_NO = D2.TSK_NO
                                                  ) D5 /*평가대상 감사활동 - 기준*/
                                                  , (
                                                    SELECT D8.AUD_TSK_KND_CD
                                                         , D8.AUD_YR
                                                         , D8.TSK_NO
                                                         , D8.SYT_EVL_ADVL_VAL
                                                         , D8.EVL_YR
                                                         , D8.HLYR_DVSN_CD
                                                         , D8.TSK_DVSN_CD
                                                         , D8.EVL_RK_CD
                                                         , D8.SYT_EVL_RK_CD
                                                         , D8.EVL_STEP_CD
                                                         , D8.SPE_ADD_SC
                                                         , D8.MDT_ASC
                                                       FROM (
                                                           SELECT EVL_YR
                                                                , HLYR_DVSN_CD 
                                                                , AUD_YR
                                                                , TSK_NO
                                                                , MAX(EVL_STEP_CD) AS EVL_STEP_CD
                                                                , AUD_TSK_KND_CD
                                                                , TSK_DVSN_CD
                                                             FROM TBCSPAOE029M
                                                           WHERE 1=1
                                                            AND (AUD_YR,
                                                     TSK_NO,
                                                     EVL_STEP_CD) IN (SELECT AUD_YR,
                                                     TSK_NO,
                                                     MAX(EVL_STEP_CD)
                                                FROM TBCSPAOE029M
                                               WHERE (AUD_YR,
                                                             TSK_NO) IN (SELECT AUD_YR ,
                                                             TSK_NO
                                                        FROM TBCSPAOE022M
                                                       WHERE CMPT_DT IS NOT NULL
                                                         AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                       GROUP BY AUD_YR,
                                                             TSK_NO )
                                               GROUP BY AUD_YR,
                                                     TSK_NO )
                                                              AND TSK_DVSN_CD  = '10000'
                                                              AND EVL_STA_CD   = '300' /*평가완료*/
                                                            GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
                                                     ) D7
                                                     , TBCSPAOE029M D8
                                                    WHERE D7.EVL_YR = D8.EVL_YR
                                                      AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
                                                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
                                                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
                                                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
                                                      AND D7.AUD_YR = D8.AUD_YR
                                                      AND D7.TSK_NO = D8.TSK_NO	                                          
                                                ) D6 /*감사사항 평가관리*/
                                                , TBCSPAOE010D D7
                                            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
                                              AND D5.AUD_YR          = D6.AUD_YR         (+)
                                              AND D5.TSK_NO          = D6.TSK_NO         (+)
                                              AND D6.EVL_YR = D7.EVL_YR (+) 
                                              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
                                              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
                                              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
                                              AND D6.EVL_RK_CD = D7.RK_CD (+)		  
                                          ) D9
                                      ) D10
                                      , TBCSPAOE023M D11
                                 WHERE D10.AUD_YR = D11.AUD_YR
                                   AND D10.TSK_NO = D11.TSK_NO
                                   AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
                                   AND D11.CTB_RTE != 0	                   
                               ) D19
                           ) D20
                        ) D21
                    ) D22
                    , (
                    	SELECT A.DPT_CD
						  FROM (SELECT DPT_CD
                                 FROM TBDCMACM002M
                                WHERE DPT_TP_CD = 'A' 
                                /*감사부서만 나온다*/ ) A
						 WHERE NOT EXISTS (SELECT DPT_CD
										     FROM TBCSPAOE034M B
										    WHERE B.EVL_YR = #strEvlYr#
										      AND B.HLYR_DVSN_CD = #strHlyrDvsnCd#
										      AND B.DPT_TYP_DVSN_CD = #strDptTypDvsnCd#
										      AND A.DPT_CD = B.DPT_CD)
								
                     ) D23
                  WHERE D22.DPT_CD = D23.DPT_CD             	            
                  )
                GROUP BY DPT_CD
                ) JUMSU
               , (
               SELECT DPT_CD 
                    , COUNT(CNB) AS DPT_NOP_CNT
                 FROM TBDCMACM001M
                GROUP BY DPT_CD
               ) CNT /*처음에는 인사정보테이블에서 건수를 가져온다.*/
            WHERE JUMSU.DPT_CD = CNT.DPT_CD	(+)	
		]]>
	</update>
	
	<!-- 감사부서 평점환산 조회 -->
	<select id="CSPAOE095EmainFselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT BASE.EVL_YR
			     , BASE.HLYR_DVSN_CD
			     , F_DPT_INFO(BASE.DPT_CD, '1')  AS DPT_NM /*부서명*/
				 , BASE.DPT_CD
			     , BASE.DPT_ASC            /*부서평점-종합평점*/
			     , BASE.DPT_NOP_CNT        /*부서인원*/
			     , BASE.PSN_ASC AS PSN_ASC /*개인평점*/
			     , NEW.DPT_ASC_NEW                              AS DPT_ASC_NEW /*최신 종합평점*/
			     , DECODE(BASE.DPT_NOP_CNT, 0, '', ROUND(NEW.DPT_ASC_NEW / BASE.DPT_NOP_CNT, 2)) AS PSN_ASC_NEW /*최신 개인평점*/
			 FROM TBCSPAOE034M BASE
			    , (
	                SELECT DPT_CD /*평가할때 부서코드*/
	                     /*, NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) AS DPT_ASC_NEW *//*종합평점=모니터링+총괄업무+집행전말+감사활동*/
	                     ,NVL(SUM(PSN_TSK_ASC_1), 0) AS DPT_ASC_NEW
	                 FROM (
	                    SELECT D22.DPT_CD
	                         , D22.PSN_TSK_ASC_1
	                         , D22.PSN_TSK_ASC_2 /*모니터링*/
	                         , D22.PSN_TSK_ASC_3 /*총괄업무*/
	                         , D22.PSN_TSK_ASC_4 /*집행전말*/
	                      FROM (
	                        SELECT DPT_CD /*평가할때 부서코드*/
	                             , 0 AS PSN_TSK_ASC_1
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*총괄업무*/
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*집행전말*/
	                          FROM TBCSPAOE035M 
	                         WHERE EVL_YR       = #strEvlYr#
	                           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
	                           AND TSK_DVSN_CD  = '10001'		               
	                          
	                         UNION ALL    
	
	                        SELECT BLT_DPT_CD AS DPT_CD /*평가할때 부서코드*/
	                             /*, ROUND((DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 */ /*개인평점*/
	                             , ROUND(STND_ASC * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1
	                             , 0 AS PSN_TSK_ASC_2 /*모니터링*/
	                             , 0 AS PSN_TSK_ASC_3 /*총괄업무*/
	                             , 0 AS PSN_TSK_ASC_4 /*집행전말*/
	                          FROM (
	                            SELECT D20.PTCPT_CNB  
	                                 , D20.DRIVE_RTE_ASC /*추진율 조정평점*/ 
	                                 , D20.CTB_RTE
	                                 , D20.BLT_DPT_CD
	                                 , D20.SPE_ADD_SC
	                                 , D20.MDT_ASC
	                                 , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/
	                                 ,STND_ASC  
	                              FROM (
	                                SELECT D19.PTCPT_CNB  
	                                     , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
	                                     , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
	                                            ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
	                                     , D19.CTB_RTE
	                                     , D19.BLT_DPT_CD
	                                     , D19.AUD_KND_CD
	                                     , D19.AUD_STEP_CD_MAX
	                                     , D19.DLY_DT_SUM
	                                     , D19.SYT_EVL_ADVL_VAL
	                                     , D19.SPE_ADD_SC
	                                     , D19.MDT_ASC
	                                     , D19.AUD_YR
	                                     , D19.TSK_NO
	                                     ,STND_ASC
	                                 FROM (
	                                    SELECT D11.PTCPT_CNB
	                                         , D10.STND_ASC /*표준평점*/
	                                         , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
	                                         , D10.DRIVE_RTE_SUM  /*추진율*/      
	                                         , F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
	                                         , D10.DLY_DT_SUM /*지연일*/
	                                         , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
	                                         , D11.CTB_RTE
	                                         , D11.BLT_DPT_CD
	                                         , D10.AUD_KND_CD
	                                         , D10.AUD_STEP_CD_MAX
	                                         , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
	                                         , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
	                                         , D10.AUD_YR
	                                         , D10.TSK_NO
	                                     FROM (
	                                        SELECT AUD_KND_CD
	                                             , AUD_YR
	                                             , TSK_NO
	                                             , AUD_STEP_CD_MIN
	                                             , AUD_STEP_CD_MAX
	                                             , MNDY_CNT
	                                             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
	                                             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
	                                             , DRIVE_RTE_SUM  /*추진율*/      
	                                             , DLY_DT_SUM /*지연일*/
	                                             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
	                                             , EVL_YR
	                                             , HLYR_DVSN_CD
	                                             , SYT_TRTM_YN
	                                             , SPE_ADD_SC
	                                             , MDT_ASC
	                                          FROM (
	                                            SELECT D5.AUD_KND_CD
	                                                 , D5.AUD_YR
	                                                 , D5.TSK_NO
	                                                 , D5.AUD_STEP_CD_MIN
	                                                 , D5.AUD_STEP_CD_MAX
	                                                 , D5.MNDY_CNT
	                                                 , F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) AS STND_ASC /*표준평점*/
	                                                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
	                                                                                  , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
	                                                                                             AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
	                                                                                  , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
	                                                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
	                                                      FROM TBCSPAOE008D 
	                                                     WHERE EVL_YR        = #strEvlYr#
	                                                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
	                                                       AND TSK_DVSN_CD   = '10000' 
	                                                       AND AUD_KND_CD    = D5.AUD_KND_CD   
	                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
	                                                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
	                                                      FROM TBCSPAOE022M
	                                                     WHERE AUD_YR = D5.AUD_YR
	                                                       AND TSK_NO = D5.TSK_NO
	                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
	                                                 , NVL(D6.EVL_YR, #strEvlYr#) AS EVL_YR
	                                                 , NVL(D6.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD
	                                                 , D5.SYT_TRTM_YN
	                                                 , D6.SPE_ADD_SC
	                                                 , D6.MDT_ASC
	                                             FROM (
	                                                    SELECT D2.HNDL_DIV_DPT_CD
	                                                         , D2.SPVR_CNB
	                                                         , D2.AUD_KND_CD
	                                                         , D2.AUD_YR
	                                                         , D2.TSK_NO
	                                                         , D2.AUD_SBJ_NM
	                                                         , D1.AUD_STEP_CD_MIN
	                                                         , D1.AUD_STEP_CD_MAX
	                                                         , D2.MNDY_CNT
	                                                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
	                                                      FROM (
	                                                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
	                                                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
	                                                             , AUD_YR
	                                                             , TSK_NO
	                                                          FROM TBCSPAOE022M
	                                                         WHERE CMPT_DT IS NOT NULL
	                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
	                                                         GROUP BY AUD_YR, TSK_NO
	                                                     ) D1
	                                                     , TBCSPAOE021M D2
	                                                 WHERE D1.AUD_YR = D2.AUD_YR
	                                                   AND D1.TSK_NO = D2.TSK_NO
	                                                  ) D5 /*평가대상 감사활동 - 기준*/
	                                                  , (
	                                                    SELECT D8.AUD_TSK_KND_CD
	                                                         , D8.AUD_YR
	                                                         , D8.TSK_NO
	                                                         , D8.SYT_EVL_ADVL_VAL
	                                                         , D8.EVL_YR
	                                                         , D8.HLYR_DVSN_CD
	                                                         , D8.TSK_DVSN_CD
	                                                         , D8.EVL_RK_CD
	                                                         , D8.SYT_EVL_RK_CD
	                                                         , D8.EVL_STEP_CD
	                                                         , D8.SPE_ADD_SC
	                                                         , D8.MDT_ASC
	                                                       FROM (
	                                                           SELECT EVL_YR
	                                                                , HLYR_DVSN_CD 
	                                                                , AUD_YR
	                                                                , TSK_NO
	                                                                , MAX(EVL_STEP_CD) AS EVL_STEP_CD
	                                                                , AUD_TSK_KND_CD
	                                                                , TSK_DVSN_CD
	                                                             FROM TBCSPAOE029M
	                                                           WHERE 1=1
	                                                           AND (AUD_YR,
			                                                     TSK_NO,
			                                                     EVL_STEP_CD) IN (SELECT AUD_YR,
			                                                     TSK_NO,
			                                                     MAX(EVL_STEP_CD)
			                                                FROM TBCSPAOE029M
			                                               WHERE (AUD_YR,
			                                                             TSK_NO) IN (SELECT AUD_YR ,
			                                                             TSK_NO
			                                                        FROM TBCSPAOE022M
			                                                       WHERE CMPT_DT IS NOT NULL
			                                                         AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
			                                                       GROUP BY AUD_YR,
			                                                             TSK_NO )
			                                               GROUP BY AUD_YR,
			                                                     TSK_NO )
	                                                              AND TSK_DVSN_CD  = '10000'
	                                                              AND EVL_STA_CD   = '300' /*평가완료*/
	                                                            GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
	                                                     ) D7
	                                                     , TBCSPAOE029M D8
	                                                    WHERE D7.EVL_YR = D8.EVL_YR
	                                                      AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
	                                                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
	                                                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
	                                                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
	                                                      AND D7.AUD_YR = D8.AUD_YR
	                                                      AND D7.TSK_NO = D8.TSK_NO	                                          
	                                                ) D6 /*감사사항 평가관리*/
	                                                , TBCSPAOE010D D7
	                                            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
	                                              AND D5.AUD_YR          = D6.AUD_YR         (+)
	                                              AND D5.TSK_NO          = D6.TSK_NO         (+)
	                                              AND D6.EVL_YR = D7.EVL_YR (+) 
	                                              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
	                                              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
	                                              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
	                                              AND D6.EVL_RK_CD = D7.RK_CD (+)		  
	                                          ) D9
	                                      ) D10
	                                      , TBCSPAOE023M D11
	                                 WHERE D10.AUD_YR = D11.AUD_YR
	                                   AND D10.TSK_NO = D11.TSK_NO
	                                   AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
	                                   AND D11.CTB_RTE != 0	                   
	                               ) D19
	                           ) D20
	                        ) D21
	                    ) D22
	                    , (
	                         SELECT DPT_CD
                              FROM TBDCMACM002M
                             WHERE DPT_TP_CD = 'A'
                            /*감사부서만 나온다*/               
	                     ) D23
	                  WHERE D22.DPT_CD = D23.DPT_CD             	            
	                  )
	                GROUP BY DPT_CD 
			    ) NEW
			 WHERE BASE.DPT_CD          = NEW.DPT_CD (+)
			   AND BASE.EVL_YR          = #strEvlYr#
			   AND BASE.HLYR_DVSN_CD    = #strHlyrDvsnCd#
			   AND BASE.DPT_TYP_DVSN_CD = '10'
			 ORDER BY BASE.DPT_CD		  		 
		  ]]>
	</select>
	
	<!-- 감사부서 평점환산 1인당 평점 평균, 평점 표준편차 조회 -->
	<select id="CSPAOE095EmainFSumselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT /* CSPAOE095EmainFSumselect */
				  ROUND(AVG(PSN_ASC), 3) AS PSN_AVG /* 평점 평균 */ 
				, ROUND(STDDEV(PSN_ASC), 3) AS STD_DEV /* 평점 표준편차 */
			FROM 
				(SELECT 
					  A.DPT_CD /*부서코드*/
					, A.DPT_ASC  /*부서평점*/
					, A.DPT_NOP_CNT /*부서인원수*/
					, ROUND(A.DPT_ASC / A.DPT_NOP_CNT, 2) AS PSN_ASC /*개인평점*/
					, ROW_NUMBER() OVER(ORDER BY A.DPT_ASC / A.DPT_NOP_CNT ASC)  AS RANK_NUM_ASC   /*최저 점수 부터 순위*/
					, ROW_NUMBER() OVER(ORDER BY A.DPT_ASC / A.DPT_NOP_CNT DESC) AS RANK_NUM_DESC  /*최대 점수 부터 순위*/ 
				FROM 
					(SELECT BASE.EVL_YR
					     , BASE.HLYR_DVSN_CD
					     , F_DPT_INFO(BASE.DPT_CD, '1')  AS DPT_NM /*부서명*/
						 , BASE.DPT_CD
					     , BASE.DPT_ASC            /*부서평점-종합평점*/
					     , BASE.DPT_NOP_CNT        /*부서인원*/
					     , BASE.PSN_ASC AS PSN_ASC /*개인평점*/
					     , NEW.DPT_ASC_NEW                              AS DPT_ASC_NEW /*최신 종합평점*/
					     , DECODE(BASE.DPT_NOP_CNT, 0, '', ROUND(NEW.DPT_ASC_NEW / BASE.DPT_NOP_CNT, 2)) AS PSN_ASC_NEW /*최신 개인평점*/
					 FROM TBCSPAOE034M BASE
					    , (
			                SELECT DPT_CD /*평가할때 부서코드*/
			                    /* , NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) AS DPT_ASC_NEW */ /*종합평점=모니터링+총괄업무+집행전말+감사활동*/
			                    , NVL(SUM(PSN_TSK_ASC_1), 0) AS DPT_ASC_NEW
			                 FROM (
			                    SELECT D22.DPT_CD
			                         , D22.PSN_TSK_ASC_1
			                         , D22.PSN_TSK_ASC_2 /*모니터링*/
			                         , D22.PSN_TSK_ASC_3 /*총괄업무*/
			                         , D22.PSN_TSK_ASC_4 /*집행전말*/
			                      FROM (
			                        SELECT DPT_CD /*평가할때 부서코드*/
			                             , 0 AS PSN_TSK_ASC_1
			                             , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
			                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*총괄업무*/
			                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*집행전말*/
			                          FROM TBCSPAOE035M 
			                         WHERE EVL_YR       = #strEvlYr#
			                           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			                           AND TSK_DVSN_CD  = '10001'		               
			                          
			                         UNION ALL    
			
			                        SELECT BLT_DPT_CD AS DPT_CD /*평가할때 부서코드*/
			                             /* , ROUND((DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 개인평점 */
			                             , ROUND(STND_ASC * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1
			                             , 0 AS PSN_TSK_ASC_2 /*모니터링*/
			                             , 0 AS PSN_TSK_ASC_3 /*총괄업무*/
			                             , 0 AS PSN_TSK_ASC_4 /*집행전말*/
			                          FROM (
			                            SELECT D20.PTCPT_CNB  
			                                 , D20.DRIVE_RTE_ASC /*추진율 조정평점*/ 
			                                 , D20.CTB_RTE
			                                 , D20.BLT_DPT_CD
			                                 , D20.SPE_ADD_SC
			                                 , D20.MDT_ASC
			                                 , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/
			                                 , D20.STND_ASC  
			                              FROM (
			                                SELECT D19.PTCPT_CNB  
			                                     , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
			                                     , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
			                                            ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
			                                     , D19.CTB_RTE
			                                     , D19.BLT_DPT_CD
			                                     , D19.AUD_KND_CD
			                                     , D19.AUD_STEP_CD_MAX
			                                     , D19.DLY_DT_SUM
			                                     , D19.SYT_EVL_ADVL_VAL
			                                     , D19.SPE_ADD_SC
			                                     , D19.MDT_ASC
			                                     , D19.AUD_YR
			                                     , D19.TSK_NO
			                                     , D19.STND_ASC
			                                 FROM (
			                                    SELECT D11.PTCPT_CNB
			                                         , D10.STND_ASC /*표준평점*/
			                                         , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
			                                         , D10.DRIVE_RTE_SUM  /*추진율*/      
			                                         , F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
			                                         , D10.DLY_DT_SUM /*지연일*/
			                                         , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
			                                         , D11.CTB_RTE
			                                         , D11.BLT_DPT_CD
			                                         , D10.AUD_KND_CD
			                                         , D10.AUD_STEP_CD_MAX
			                                         , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
			                                         , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
			                                         , D10.AUD_YR
			                                         , D10.TSK_NO
			                                     FROM (
			                                        SELECT AUD_KND_CD
			                                             , AUD_YR
			                                             , TSK_NO
			                                             , AUD_STEP_CD_MIN
			                                             , AUD_STEP_CD_MAX
			                                             , MNDY_CNT
			                                             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
			                                             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
			                                             , DRIVE_RTE_SUM  /*추진율*/      
			                                             , DLY_DT_SUM /*지연일*/
			                                             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
			                                             , EVL_YR
			                                             , HLYR_DVSN_CD
			                                             , SYT_TRTM_YN
			                                             , SPE_ADD_SC
			                                             , MDT_ASC
			                                          FROM (
			                                            SELECT D5.AUD_KND_CD
			                                                 , D5.AUD_YR
			                                                 , D5.TSK_NO
			                                                 , D5.AUD_STEP_CD_MIN
			                                                 , D5.AUD_STEP_CD_MAX
			                                                 , D5.MNDY_CNT
			                                                 , F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) AS STND_ASC /*표준평점*/
			                                                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
			                                                                                  , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
			                                                                                             AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
			                                                                                  , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
			                                                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
			                                                      FROM TBCSPAOE008D 
			                                                     WHERE EVL_YR        = #strEvlYr#
			                                                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
			                                                       AND TSK_DVSN_CD   = '10000' 
			                                                       AND AUD_KND_CD    = D5.AUD_KND_CD   
			                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
			                                                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
			                                                      FROM TBCSPAOE022M
			                                                     WHERE AUD_YR = D5.AUD_YR
			                                                       AND TSK_NO = D5.TSK_NO
			                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
			                                                 , NVL(D6.EVL_YR, #strEvlYr#) AS EVL_YR
	                                                 			, NVL(D6.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD
			                                                 , D5.SYT_TRTM_YN
			                                                 , D6.SPE_ADD_SC
			                                                 , D6.MDT_ASC
			                                             FROM (
			                                                    SELECT D2.HNDL_DIV_DPT_CD
			                                                         , D2.SPVR_CNB
			                                                         , D2.AUD_KND_CD
			                                                         , D2.AUD_YR
			                                                         , D2.TSK_NO
			                                                         , D2.AUD_SBJ_NM
			                                                         , D1.AUD_STEP_CD_MIN
			                                                         , D1.AUD_STEP_CD_MAX
			                                                         , D2.MNDY_CNT
			                                                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
			                                                      FROM (
			                                                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
			                                                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
			                                                             , AUD_YR
			                                                             , TSK_NO
			                                                          FROM TBCSPAOE022M
			                                                         WHERE CMPT_DT IS NOT NULL
			                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
			                                                         GROUP BY AUD_YR, TSK_NO
			                                                     ) D1
			                                                     , TBCSPAOE021M D2
			                                                 WHERE D1.AUD_YR = D2.AUD_YR
			                                                   AND D1.TSK_NO = D2.TSK_NO
			                                                  ) D5 /*평가대상 감사활동 - 기준*/
			                                                  , (
			                                                    SELECT D8.AUD_TSK_KND_CD
			                                                         , D8.AUD_YR
			                                                         , D8.TSK_NO
			                                                         , D8.SYT_EVL_ADVL_VAL
			                                                         , D8.EVL_YR
			                                                         , D8.HLYR_DVSN_CD
			                                                         , D8.TSK_DVSN_CD
			                                                         , D8.EVL_RK_CD
			                                                         , D8.SYT_EVL_RK_CD
			                                                         , D8.EVL_STEP_CD
			                                                         , D8.SPE_ADD_SC
			                                                         , D8.MDT_ASC
			                                                       FROM (
			                                                           SELECT EVL_YR
			                                                                , HLYR_DVSN_CD 
			                                                                , AUD_YR
			                                                                , TSK_NO
			                                                                , MAX(EVL_STEP_CD) AS EVL_STEP_CD
			                                                                , AUD_TSK_KND_CD
			                                                                , TSK_DVSN_CD
			                                                             FROM TBCSPAOE029M
			                                                           WHERE EVL_YR        = #strEvlYr#
			                                                              AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			                                                              AND TSK_DVSN_CD  = '10000'
			                                                              AND EVL_STA_CD   = '300' /*평가완료*/
			                                                            GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
			                                                     ) D7
			                                                     , TBCSPAOE029M D8
			                                                    WHERE D7.EVL_YR = D8.EVL_YR
			                                                      AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
			                                                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
			                                                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
			                                                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
			                                                      AND D7.AUD_YR = D8.AUD_YR
			                                                      AND D7.TSK_NO = D8.TSK_NO	                                          
			                                                ) D6 /*감사사항 평가관리*/
			                                                , TBCSPAOE010D D7
			                                            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
			                                              AND D5.AUD_YR          = D6.AUD_YR         (+)
			                                              AND D5.TSK_NO          = D6.TSK_NO         (+)
			                                              AND D6.EVL_YR = D7.EVL_YR (+) 
			                                              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
			                                              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
			                                              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
			                                              AND D6.EVL_RK_CD = D7.RK_CD (+)		  
			                                          ) D9
			                                      ) D10
			                                      , TBCSPAOE023M D11
			                                 WHERE D10.AUD_YR = D11.AUD_YR
			                                   AND D10.TSK_NO = D11.TSK_NO
			                                   AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
			                                   AND D11.CTB_RTE != 0	                   
			                               ) D19
			                           ) D20
			                        ) D21
			                    ) D22
			                    , (SELECT DPT_CD
			                                                             FROM TBDCMACM002M
			                                                            WHERE DPT_TP_CD = 'A'
			                                                             /*감사부서만 나온다*/               
			                     ) D23
			                  WHERE D22.DPT_CD = D23.DPT_CD             	            
			                  )
			                GROUP BY DPT_CD 
					    ) NEW
					 WHERE BASE.DPT_CD          = NEW.DPT_CD (+)
					   AND BASE.EVL_YR          = #strEvlYr#
					   AND BASE.HLYR_DVSN_CD    = #strHlyrDvsnCd#
					   AND BASE.DPT_TYP_DVSN_CD = '10'
					 ORDER BY BASE.DPT_CD		
					 ) A
				)
			WHERE RANK_NUM_ASC  NOT IN (1, 2, 3) /*최저 점수인 세 부서의 값을 제외 한다.*/
			AND RANK_NUM_DESC NOT IN (1, 2, 3) /*최대 점수인 세 부서의 값을 제외 한다.*/
		]]>
	</select>

	<!-- 감사부서 탭 수정된 정보를 저장한다. -->
	<update id="CSPAOE095EmainFupdate" parameterClass="paramMap">
		<![CDATA[	
			UPDATE TBCSPAOE034M
			   SET DPT_NOP_CNT              = #DPT_NOP_CNT#
	             , PSN_ASC                  = #PSN_ASC_NEW#
	             , PSO_PER_ASC_AV_VAL       = #PSO_PER_ASC_AV_VAL#
	             , PSO_PER_ASC_STND_DEV_VAL = #PSO_PER_ASC_STND_DEV_VAL#
	             , DPT_ASC                  = #DPT_ASC_NEW#
	             , FNL_USR_ID               = #FNL_USR_ID#
	             , FNL_DEAL_DPT_CD          = #FNL_DEAL_DPT_CD#
	             , FNL_MNU_ID               = #FNL_MNU_ID#
	             , FNL_MDF_DH               = SYSDATE
	         WHERE 1=1
	           AND EVL_YR                   = #EVL_YR#
			   AND HLYR_DVSN_CD              = #HLYR_DVSN_CD#
			   AND DPT_TYP_DVSN_CD           = '10'
			   AND DPT_CD                    = #DPT_CD#
		]]>
	</update>
	
	<!-- 지원부서 탭 - 맨 처음에 기초 데이터 세팅해준다. -->
	<update id="CSPAOE095EBaseDataSinsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPAOE034M
		    (
			       EVL_YR
				 , HLYR_DVSN_CD
				 , DPT_TYP_DVSN_CD
				 , DPT_CD
				 , DPT_NOP_CNT
			 	 , FRT_USR_ID
			 	 , FNL_USR_ID
				 , FNL_DEAL_DPT_CD
				 , FNL_MNU_ID
				 , FRT_REGI_DH
				 , FNL_MDF_DH
			) 
			SELECT #strEvlYr#                           /*평가년도*/
			     , #strHlyrDvsnCd#                      /*반기구분코드*/
			     , '20'                                 /*부서유형구분코드*/
			     , DPT.DPT_CD                           /*부서코드*/
			     , NVL(CNT.CNT, 1) AS DPT_NOP_CNT       /*부서인원수*/
			     , #FRT_USR_ID#
			     , #FRT_USR_ID#
			     , #FNL_DEAL_DPT_CD#
			     , #FNL_MNU_ID#
			     , SYSDATE
			     , SYSDATE
			  FROM (
					SELECT CHR_DPT_CD AS DPT_CD
					 FROM TBCSPAOE026M
					WHERE EVL_YR = #strEvlYr#
					  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
					GROUP BY CHR_DPT_CD
				 ) DPT /*지원부서*/
				 , (
				    SELECT DPT_CD 
				         , COUNT(CNB) AS CNT
				      FROM TBDCMACM001M
				     GROUP BY DPT_CD
				 ) CNT /*처음에는 인사정보테이블에서 건수를 가져온다.*/
			 WHERE DPT.DPT_CD  = CNT.DPT_CD (+)		
		]]>
	</update>
	
	<!-- 지원부서 탭 - 맨 처음에 기초 데이터 세팅해준다. -->
	<update id="CSPAOE095EReBaseDataSinsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPAOE034M
		    (
			       EVL_YR
				 , HLYR_DVSN_CD
				 , DPT_TYP_DVSN_CD
				 , DPT_CD
				 , DPT_NOP_CNT
			 	 , FRT_USR_ID
			 	 , FNL_USR_ID
				 , FNL_DEAL_DPT_CD
				 , FNL_MNU_ID
				 , FRT_REGI_DH
				 , FNL_MDF_DH
			) 
			SELECT #strEvlYr#                           /*평가년도*/
			     , #strHlyrDvsnCd#                      /*반기구분코드*/
			     , '20'                                 /*부서유형구분코드*/
			     , DPT.DPT_CD                           /*부서코드*/
			     , NVL(CNT.CNT, 1) AS DPT_NOP_CNT       /*부서인원수*/
			     , #FRT_USR_ID#
			     , #FRT_USR_ID#
			     , #FNL_DEAL_DPT_CD#
			     , #FNL_MNU_ID#
			     , SYSDATE
			     , SYSDATE
			  FROM (SELECT A.DPT_CD
			  		  FROM (SELECT CHR_DPT_CD AS DPT_CD
							  FROM TBCSPAOE026M
						 	 WHERE EVL_YR = #strEvlYr#
						 	   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
							 GROUP BY CHR_DPT_CD) A
					 WHERE NOT EXISTS (SELECT DPT_CD
										     FROM TBCSPAOE034M B
										    WHERE B.EVL_YR = #strEvlYr#
										      AND B.HLYR_DVSN_CD = #strHlyrDvsnCd#
										      AND B.DPT_TYP_DVSN_CD = '20'
										      AND A.DPT_CD = B.DPT_CD)  
				 ) DPT /*지원부서*/
				 , (
				    SELECT DPT_CD 
				         , COUNT(CNB) AS CNT
				      FROM TBDCMACM001M
				     GROUP BY DPT_CD
				 ) CNT /*처음에는 인사정보테이블에서 건수를 가져온다.*/
			 WHERE DPT.DPT_CD  = CNT.DPT_CD (+)		
		]]>
	</update>
	
	<!-- 감사부서 탭 기준이 되는 데이터 업뎃해주기 위해 funcion 값 select해온다. -->
	<select id="CSPAOE095Efunctionselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
             SELECT F_AOE_GET_AVG(#strEvlYr#, #strHlyrDvsnCd#) AS AVG_VAL /*감사부서평균*/
                  , F_AOE_GET_STD_DEV(#strEvlYr#, #strHlyrDvsnCd#) AS STD_DEV_VAL /*감사부서 표준평점*/
                  , F_AOE_GET_AVG_SUPP(#strEvlYr#, #strHlyrDvsnCd#) AS AVG_SUPP /*지원부서평균*/
                  , F_AOE_GET_STD_DEV_SUPP(#strEvlYr#, #strHlyrDvsnCd#) AS STD_DEV_SUPP /*지원부서 표준평점*/
               FROM DUAL 	  		 
		  ]]>
	</select>
	
	<!-- 감사부서 탭 기준이 되는 데이터 업뎃해준다. -->
	<update id="CSPAOE095EBaseDataSupdate" parameterClass="paramMap">
		<![CDATA[	
			 UPDATE /*+ bypass_ujvc */
			     (
				SELECT D7.EVL_YR
				     , D7.HLYR_DVSN_CD
				     , D7.DPT_TYP_DVSN_CD
				     , D7.DPT_CD
				     , D7.DPT_NOP_CNT * ROUND(D7.PSO_PER_AV_ASC, 2) AS DPT_TSC_NEW /*부서총점*/
				     , ROUND(D7.PSO_PER_AV_ASC, 2) AS PSO_PER_AV_ASC_NEW /*인당평균평점*/
				     , ROUND(D7.DPT_ASC, 2)        AS DPT_ASC_NEW /*평점*/
				     , D8.DPT_TSC
				     , D8.PSO_PER_AV_ASC
				     , D8.DPT_ASC
				     , #FRT_USR_ID#      AS FNL_USR_ID_NEW
			         , #FNL_DEAL_DPT_CD# AS FNL_DEAL_DPT_CD_NEW
			         , #FNL_MNU_ID#      AS FNL_MNU_ID_NEW
			         , SYSDATE           AS FNL_MDF_DH_NEW
			         , D8.FNL_USR_ID
			         , D8.FNL_DEAL_DPT_CD
			         , D8.FNL_MNU_ID
			         , D8.FNL_MDF_DH
				  FROM (
				    SELECT D4.EVL_YR
				         , D4.HLYR_DVSN_CD
				         , D4.DPT_TYP_DVSN_CD
				         , D4.DPT_CD
				         , D4.DPT_NOP_CNT /*부서인원*/
				         , NVL(D5.AVG_TSK_ASC, 0) AS DPT_ASC /*평점*/
				         , CASE WHEN D5.AVG_TSK_ASC IS NOT NULL THEN #AVG_VAL# + #STD_DEV_VAL# * ( ( D5.AVG_TSK_ASC - #AVG_SUPP#) / #STD_DEV_SUPP# ) 
				                 ELSE 0 END AS PSO_PER_AV_ASC /*인당평균평점 - 감사부서1인당평점평균 + 감사부서 1인당 평점 표준편차 * {(해당부서평점-지원부서평균)/지원부서표준편차}*/
				      FROM TBCSPAOE034M D4
				         , (
				        SELECT EVL_YR 
				             , HLYR_DVSN_CD
				             , DPT_CD /*평가 부서코드*/ 
				             , CASE WHEN CNT > 2 THEN ROUND((SUM_TSK_ASC - SUM_TSK_ASC_MIN - SUM_TSK_ASC_MAX) / (CNT-2), 2)
				                    ELSE NULL END AS AVG_TSK_ASC /*평점 - 총점/ (평가인원-2) 두명의 점수를 제외하므로*/
				         FROM (
				                SELECT EVL_YR 
				                     , HLYR_DVSN_CD
				                     , DPT_CD /*평가 부서코드*/
				                     , MIN(SUM_TSK_ASC) AS SUM_TSK_ASC_MIN
				                     , MAX(SUM_TSK_ASC) AS SUM_TSK_ASC_MAX
				                     , SUM(SUM_TSK_ASC) AS SUM_TSK_ASC
				                     , MAX(CNT)         AS CNT /*평균을 구하기 위해서 총 평가자 수*/
				                  FROM (
				                SELECT EVL_YR 
				                     , HLYR_DVSN_CD
				                     , DPT_CD       /*평가 부서코드*/
				                     , EVL_CMTR_CNB /*평가위원전산번호*/
				                     , SUM(TSK_ASC) AS SUM_TSK_ASC /*업무평점 합*/
				                     , COUNT(*) OVER(PARTITION BY EVL_YR, HLYR_DVSN_CD, DPT_CD) AS CNT
				                  FROM TBCSPAOE031M D1
				                 WHERE 1 = 1
				                   AND EVL_STEP_CD  = '500' /*위원평가*/
				                   AND EVL_DTM_YN   = 'Y'   /*평가확정*/
				                   AND EVL_YR       = #strEvlYr#
				                   AND HLYR_DVSN_CD = #strHlyrDvsnCd#	       
				                 GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD, EVL_CMTR_CNB  
				                 ) D2
				                GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD
				             ) D3 
				         ) D5
				     WHERE D4.EVL_YR          = D5.EVL_YR (+)
				       AND D4.HLYR_DVSN_CD    = D5.HLYR_DVSN_CD (+)
				       AND D4.DPT_TYP_DVSN_CD = '20'
				       AND D4.DPT_CD          = D5.DPT_CD (+)
				   ) D7
				   , TBCSPAOE034M D8
				WHERE D7.EVL_YR          = D8.EVL_YR
				  AND D7.HLYR_DVSN_CD    = D8.HLYR_DVSN_CD
				  AND D7.DPT_TYP_DVSN_CD = D8.DPT_TYP_DVSN_CD
				  AND D7.DPT_CD          = D8.DPT_CD
			     )
			  SET DPT_TSC         = DPT_TSC_NEW
				, PSO_PER_AV_ASC  = PSO_PER_AV_ASC_NEW
				, DPT_ASC         = DPT_ASC_NEW
				, FNL_USR_ID      = FNL_USR_ID_NEW
			    , FNL_DEAL_DPT_CD = FNL_DEAL_DPT_CD_NEW
			    , FNL_MNU_ID      = FNL_MNU_ID_NEW
			    , FNL_MDF_DH      = FNL_MDF_DH_NEW
		]]>
	</update>
	
	<!-- 감사부서 탭 기준이 되는 데이터 업뎃해주기 위해 funcion 값 select해온다. -->
	<select id="CSPAOE095EfunctionSselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
             SELECT TO_CHAR(F_AOE_GET_AVG(#EVL_YR#, #HLYR_DVSN_CD#)) AS AVG_VAL /*감사부서평균*/
                  , TO_CHAR(F_AOE_GET_STD_DEV(#EVL_YR#, #HLYR_DVSN_CD#)) AS STD_DEV_VAL /*감사부서 표준평점*/
                  , TO_CHAR(F_AOE_GET_AVG_SUPP(#EVL_YR#, #HLYR_DVSN_CD#)) AS AVG_SUPP /*지원부서평균*/
                  , TO_CHAR(F_AOE_GET_STD_DEV_SUPP(#EVL_YR#, #HLYR_DVSN_CD#)) AS STD_DEV_SUPP /*지원부서 표준평점*/
               FROM DUAL 	  		 
		  ]]>
	</select>

	<!-- 지원부서 평점환산 조회 -->
	<select id="CSPAOE095EmainSselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT D4.EVL_YR
			     , D4.HLYR_DVSN_CD
			     , F_DPT_INFO(D4.DPT_CD, '1') AS DPT_NM /*부서명*/
			     , D4.DPT_CD
			     , NVL(D4.DPT_TSC, 0)         AS DPT_TSC
			     , NVL(D4.PSO_PER_AV_ASC, 0)  AS PSO_PER_AV_ASC  /*인당평균평점*/
			     , NVL(D4.DPT_NOP_CNT, 0)     AS DPT_NOP_CNT     /*부서인원*/
			     , NVL(D4.DPT_ASC, 0)         AS DPT_ASC         /*평점*/
			     , NVL(D5.AVG_TSK_ASC, 0)     AS DPT_ASC_NEW     /*신평점*/
			 FROM ( SELECT EVL_YR
                         , HLYR_DVSN_CD
                         , DPT_CD
                         , DPT_TSC
                         , PSO_PER_AV_ASC
                         , DPT_NOP_CNT
                         , DPT_ASC
                      FROM TBCSPAOE034M 
                     WHERE EVL_YR       = #strEvlYr#
                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#	
                       AND DPT_TYP_DVSN_CD = '20'
                  ) D4
			    , (
				    SELECT EVL_YR 
				         , HLYR_DVSN_CD
				         , DPT_CD /*평가 부서코드*/ 
				         , CASE WHEN CNT > 2 THEN ROUND((SUM_TSK_ASC - SUM_TSK_ASC_MIN - SUM_TSK_ASC_MAX) / (CNT-2), 2)
				                ELSE NULL END AS AVG_TSK_ASC /*평점 - 총점/ (평가인원-2) 두명의 점수를 제외하므로*/
				     FROM (
				            SELECT EVL_YR 
				                 , HLYR_DVSN_CD
				                 , DPT_CD /*평가 부서코드*/
				                 , MIN(SUM_TSK_ASC) AS SUM_TSK_ASC_MIN
				                 , MAX(SUM_TSK_ASC) AS SUM_TSK_ASC_MAX
				                 , SUM(SUM_TSK_ASC) AS SUM_TSK_ASC
				                 , MAX(CNT)         AS CNT /*평균을 구하기 위해서 총 평가자 수*/
				              FROM (
				            SELECT EVL_YR 
				                 , HLYR_DVSN_CD
				                 , DPT_CD       /*평가 부서코드*/
				                 , EVL_CMTR_CNB /*평가위원전산번호*/
				                 , SUM(TSK_ASC) AS SUM_TSK_ASC /*업무평점 합*/
				                 , COUNT(*) OVER(PARTITION BY EVL_YR, HLYR_DVSN_CD, DPT_CD) AS CNT
				              FROM TBCSPAOE031M D1
				             WHERE 1 = 1
				               AND EVL_STEP_CD  = '500' /*위원평가*/
				               AND EVL_DTM_YN   = 'Y'   /*평가확정*/
				               AND EVL_YR       = #strEvlYr#
				               AND HLYR_DVSN_CD = #strHlyrDvsnCd#	       
				             GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD, EVL_CMTR_CNB  
				             ) D2
				            GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD
				         ) D3    
				    ) D5
			WHERE 1=1
			  AND D4.EVL_YR  = D5.EVL_YR (+)
			  AND D4.HLYR_DVSN_CD  = D5.HLYR_DVSN_CD (+)
              AND D4.DPT_CD  = D5.DPT_CD (+)
			ORDER BY D4.DPT_CD		 
		  ]]>
	</select>

	<!-- 지원부서 탭 수정된 정보를 저장한다. -->
	<update id="CSPAOE095EmainSupdate" parameterClass="paramMap">
		<![CDATA[
			 UPDATE /*+ bypass_ujvc */
			     (
				SELECT D7.EVL_YR
				     , D7.HLYR_DVSN_CD
				     , D7.DPT_TYP_DVSN_CD
				     , D7.DPT_CD
				     , D8.DPT_TSC
				     , D8.PSO_PER_AV_ASC
				     , D8.DPT_ASC
				     , D8.DPT_NOP_CNT
				     , D8.PSO_PER_ASC_AV_VAL
				     , D8.PSO_PER_ASC_STND_DEV_VAL
				     , D8.FNL_USR_ID
			         , D8.FNL_DEAL_DPT_CD
			         , D8.FNL_MNU_ID
			         , D8.FNL_MDF_DH
				     , D7.DPT_NOP_CNT_NEW * ROUND(D7.PSO_PER_AV_ASC, 2) AS DPT_TSC_NEW /*부서총점*/
				     , ROUND(D7.PSO_PER_AV_ASC, 2) AS PSO_PER_AV_ASC_NEW /*인당평균평점*/
				     , ROUND(D7.DPT_ASC, 2)        AS DPT_ASC_NEW /*평점*/
				     , D7.DPT_NOP_CNT_NEW
				     , #AVG_SUPP#        AS PSO_PER_ASC_AV_VAL_NEW
				     , #STD_DEV_SUPP#    AS PSO_PER_ASC_STND_DEV_VAL_NEW
				     , #FNL_USR_ID#      AS FNL_USR_ID_NEW
			         , #FNL_DEAL_DPT_CD# AS FNL_DEAL_DPT_CD_NEW
			         , #FNL_MNU_ID#      AS FNL_MNU_ID_NEW
			         , SYSDATE           AS FNL_MDF_DH_NEW
				  FROM (
				    SELECT D5.EVL_YR
				         , D5.HLYR_DVSN_CD
				         , '20' AS DPT_TYP_DVSN_CD
				         , D5.DPT_CD
				         , #DPT_NOP_CNT# AS DPT_NOP_CNT_NEW /*부서인원*/
				         , NVL(D5.AVG_TSK_ASC, 0) AS DPT_ASC /*평점*/
				         , CASE WHEN D5.AVG_TSK_ASC IS NOT NULL THEN #AVG_VAL# + #STD_DEV_VAL# * ( ( D5.AVG_TSK_ASC - #AVG_SUPP#) / #STD_DEV_SUPP# ) 
				                 ELSE 0 END AS PSO_PER_AV_ASC /*인당평균평점 - 감사부서1인당평점평균 + 감사부서 1인당 평점 표준편차 * {(해당부서평점-지원부서평균)/지원부서표준편차}*/
				      FROM (
				        SELECT EVL_YR 
				             , HLYR_DVSN_CD
				             , DPT_CD /*평가 부서코드*/ 
				             , CASE WHEN CNT > 2 THEN ROUND((SUM_TSK_ASC - SUM_TSK_ASC_MIN - SUM_TSK_ASC_MAX) / (CNT-2), 2)
				                    ELSE NULL END AS AVG_TSK_ASC /*평점 - 총점/ (평가인원-2) 두명의 점수를 제외하므로*/
				         FROM (
				                SELECT EVL_YR 
				                     , HLYR_DVSN_CD
				                     , DPT_CD /*평가 부서코드*/
				                     , MIN(SUM_TSK_ASC) AS SUM_TSK_ASC_MIN
				                     , MAX(SUM_TSK_ASC) AS SUM_TSK_ASC_MAX
				                     , SUM(SUM_TSK_ASC) AS SUM_TSK_ASC
				                     , MAX(CNT)         AS CNT /*평균을 구하기 위해서 총 평가자 수*/
				                  FROM (
				                SELECT EVL_YR 
				                     , HLYR_DVSN_CD
				                     , DPT_CD       /*평가 부서코드*/
				                     , EVL_CMTR_CNB /*평가위원전산번호*/
				                     , SUM(TSK_ASC) AS SUM_TSK_ASC /*업무평점 합*/
				                     , COUNT(*) OVER(PARTITION BY EVL_YR, HLYR_DVSN_CD, DPT_CD) AS CNT
				                  FROM TBCSPAOE031M D1
				                 WHERE 1 = 1
				                   AND EVL_STEP_CD  = '500' /*위원평가*/
				                   AND EVL_DTM_YN   = 'Y'   /*평가확정*/
				                   AND EVL_YR       = #EVL_YR#
				                   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#	  
				                   AND DPT_CD       = #DPT_CD#    
				                 GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD, EVL_CMTR_CNB  
				                 ) D2
				                GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD
				             ) D3 
				         ) D5
				   ) D7
				   , TBCSPAOE034M D8
				WHERE D7.EVL_YR          = D8.EVL_YR 
				  AND D7.HLYR_DVSN_CD    = D8.HLYR_DVSN_CD 
				  AND D7.DPT_TYP_DVSN_CD = D8.DPT_TYP_DVSN_CD 
				  AND D7.DPT_CD          = D8.DPT_CD 
			     )
			  SET DPT_TSC         = DPT_TSC_NEW
				, PSO_PER_AV_ASC  = PSO_PER_AV_ASC_NEW
				, DPT_ASC         = DPT_ASC_NEW
				, DPT_NOP_CNT     = DPT_NOP_CNT_NEW
				, PSO_PER_ASC_AV_VAL = PSO_PER_ASC_AV_VAL_NEW
				, PSO_PER_ASC_STND_DEV_VAL = PSO_PER_ASC_STND_DEV_VAL_NEW
				, FNL_USR_ID      = FNL_USR_ID_NEW
			    , FNL_DEAL_DPT_CD = FNL_DEAL_DPT_CD_NEW
			    , FNL_MNU_ID      = FNL_MNU_ID_NEW
			    , FNL_MDF_DH      = FNL_MDF_DH_NEW
		]]>
	</update>
	<!-- ############################# 부서별 평점환상 끝 (CSPAOE095E) ##################################### -->

	<!-- ############################# 개인별평과결과 조회 시작 (CSPAOE094Q) ################################ -->
	<!-- 개인별 기여율 확인 온로드시 감사종류,업무종류 조회 -->
	<select id="CSPAOE094QTskKndCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CD
     			 , CD_NM
  			  FROM TBDCMACM013C
 		     WHERE 1=1
   			   AND CD <> '000000000'
   			   AND CMM_CD_DVSN_CD IN ('1000270', '1000272')
   			   AND CD NOT IN ('10000')
			   AND USE_YN = 'Y'
 		     ORDER BY OTPT_SEQ, CD ASC 
		]]>
	</select>

	<!-- 개인별 기여율 조회 -->
	<select id="CSPAOE094QMainFSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
		   /*지원업무 기여율 - 지원업무는 지원환산으로 해서 기여율= 기여율*비중/100 의 합인 기여율의 합을 보여준다. */
		   SELECT D1.EVL_YR	        AS EVL_YR           /*평가년도*/
	     		, D1.HLYR_DVSN_CD   AS HLYR_DVSN_CD	    /*반기구분*/
	     		, '지원환산'           AS TSK_KND_CD	    /*업무종류*/
	     		, ''	            AS TSK_NO           /*업무번호*/
	     		, ''                AS TSK_NM	        /*업무명*/
	     		, ''                AS TSK_ST_STEP_CD	/*단계기초*/
	     		, ''                AS TSK_END_STEP_CD	/*단계기말*/
	     		, D1.PTCPT_CNB      AS CNB	            /*전산번호*/
	     		, TO_CHAR(ROUND(SUM(D2.WGT_RTE * D1.CTB_RTE / 100), 2), 'FM99999.00') AS CTB_RTE	        /*기여율*/
	     		, ''                AS DRIVE_RTE		/*추진율*/
			 FROM TBCSPAOE027M D1
	   			, TBCSPAOE026M D2
			WHERE 1=1
	  		  AND D1.EVL_YR       = D2.EVL_YR
	  		  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
	  		  AND D2.CHR_DPT_CD = CASE WHEN SUBSTR(D1.CHR_DPT_CD,1,3) = '141' THEN '141000' 
                                    WHEN SUBSTR(D1.CHR_DPT_CD,1,3) = '121' THEN '121000' 
                                    WHEN SUBSTR(D1.CHR_DPT_CD,1,3) = '122' AND D1.CHR_DPT_CD = '122500' THEN D1.CHR_DPT_CD
                                    WHEN SUBSTR(D1.CHR_DPT_CD,1,3) = '122' AND D1.CHR_DPT_CD <> '122500' THEN '122000'
                                    ELSE D1.CHR_DPT_CD END
	  		  AND D1.TSK_NO       = D2.TSK_NO
	  		  AND D1.EVL_YR       = #strEvlYr#
	  		  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
	  		  AND D1.PTCPT_CNB    = #strNevltCnb#
	  		  AND D1.CTB_RTE     != 0  
	  		GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.PTCPT_CNB   
	  		  
	  		UNION ALL
	  		     
        	/*감사업무 기여율*/
            SELECT #strEvlYr#         AS EVL_YR	         /*평가년도*/
                 , #strHlyrDvsnCd#    AS HLYR_DVSN_CD	 /*반기구분*/
                 , F_CODE_NM('1000270',D5.AUD_KND_CD)      AS TSK_KND_CD	     /*업무종류*/
                 , D3.TSK_NO          AS TSK_NO	         /*업무번호*/
                 , D5.AUD_SBJ_NM      AS TSK_NM	         /*업무명*/
                 , D3.AUD_STEP_CD_MIN AS TSK_ST_STEP_CD	 /*단계기초*/
                 , D3.AUD_STEP_CD_MAX AS TSK_END_STEP_CD /*딘계기말*/
                 , D4.PTCPT_CNB       AS CNB	         /*전산번호*/
                 , TO_CHAR(D4.CTB_RTE, 'FM99999.00')     AS CTB_RTE         /*기여율*/
                 , (SELECT TO_CHAR(NVL(SUM(DRIVE_RTE), 0), 'FM99999.00') AS DRIVE_RTE
                      FROM TBCSPAOE008D 
                     WHERE EVL_YR       = #strEvlYr#
                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                       AND TSK_DVSN_CD  = '10000' 
                       AND AUD_KND_CD   = D5.AUD_KND_CD 
                       AND AUD_STEP_CD BETWEEN D3.AUD_STEP_CD_MIN AND D3.AUD_STEP_CD_MAX ) AS DRIVE_RTE /*추진율*/
              FROM (
                SELECT D1.AUD_YR 
                     , D1.TSK_NO 
                     , CASE WHEN D2.TSK_NO IS NOT NULL THEN ( SELECT MIN(AUD_STEP_CD) FROM TBCSPAOE022M WHERE AUD_STEP_CD BETWEEN D2.AUD_STEP_CD AND D1.AUD_STEP_CD_MAX AND AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND CMPT_DT IS NOT NULL)
                            ELSE D1.AUD_STEP_CD_MIN END AS AUD_STEP_CD_MIN /*단계기초*/
                     , D1.AUD_STEP_CD_MAX /*단계기말*/
                  FROM (
                    SELECT AUD_YR 
                         , TSK_NO 
                         , MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                         , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                      FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */
                     WHERE 1 = 1
                       AND CMPT_DT IS NOT NULL
                       AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                     GROUP BY AUD_YR, TSK_NO
                 ) D1
                 , (
                    SELECT AUD_YR
                         , TSK_NO
                         , MAX(AUD_STEP_CD) + 1 AS AUD_STEP_CD
                     FROM TBCSPAOE029M
                    WHERE EVL_YR       != #strEvlYr#
                      AND HLYR_DVSN_CD != #strHlyrDvsnCd# /*이번에 평가 받은건 빼야하니깐.*/
                      AND TSK_DVSN_CD   = '10000'
                    GROUP BY AUD_YR, TSK_NO 
                 ) D2
                WHERE D1.AUD_YR = D2.AUD_YR (+)
                  AND D1.TSK_NO = D2.TSK_NO (+) 
              ) D3
              , TBCSPAOE023M D4
              , TBCSPAOE021M D5
            WHERE D3.AUD_YR      = D4.AUD_YR
              AND D3.TSK_NO      = D4.TSK_NO
              AND D4.AUD_STEP_CD = D3.AUD_STEP_CD_MAX
              AND D4.PTCPT_CNB   = #strNevltCnb#
              AND D3.AUD_YR      = D5.AUD_YR
              AND D3.TSK_NO      = D5.TSK_NO
              AND D4.CTB_RTE    != 0

		  UNION ALL
		  
		  /*감사외업무 기여율*/
		  SELECT D3.EVL_YR       AS EVL_YR	        /*평가년도*/
     		   , D3.HLYR_DVSN_CD AS HLYR_DVSN_CD	/*반기구분*/
     		   , F_CODE_NM('1000272', D3.TSK_KND_CD)   AS TSK_KND_CD	    /*업무종류*/
     		   , D3.TSK_NO       AS TSK_NO	        /*업무번호*/
     		   , D3.TSK_NM       AS TSK_NM	        /*업무명*/
     		   , ''              AS TSK_ST_STEP_CD	/*단계기초*/
     		   , ''              AS TSK_END_STEP_CD	/*단계기말*/
     		   , D1.PTCPT_CNB    AS CNB	            /*전산번호*/
     		   , TO_CHAR(D1.CTB_RTE, 'FM99999.00')    AS CTB_RTE	        /*기여율*/
     		   , ''         AS DRIVE_RTE		/*추진율*/
		    FROM TBCSPAOE025M D1
   			   , TBCSPAOE024M D3
		   WHERE 1=1
 		     AND D1.EVL_YR       = D3.EVL_YR
  		 	 AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
  		 	 AND D1.TSK_KND_CD   = D3.TSK_KND_CD
  			 AND D1.TSK_NO       = D3.TSK_NO
  			 AND D1.EVL_YR       = #strEvlYr#
  			 AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
  			 AND D1.PTCPT_CNB    = #strNevltCnb#
  			 AND D1.CTB_RTE     != 0
		]]>
	</select>

	<!-- 개인별 업무실적명세 조회 -->
	<select id="CSPAOE094QMainSSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
		   /*지원업무 업무실적명세*/
		   SELECT EVL_YR	                                   AS EVL_YR           /*평가년도*/
	     		, HLYR_DVSN_CD                                 AS HLYR_DVSN_CD	   /*반기구분*/
	     		, '지원환산'                                      AS TSK_KND_CD	   /*업무종류*/
	     		, ''                                           AS TSK_NO	       /*업무번호*/
	     		, ''                                           AS TSK_NM	       /*업무명*/
	     		, ''                                           AS TSK_ST_STEP_CD   /*단계기초*/
	     		, ''                                           AS TSK_END_STEP_CD  /*단계기말*/
	     		, PTCPT_CNB                                    AS CNB	           /*전산번호*/
	     		, TO_CHAR(CTB_RTE, 'FM99999.00')               AS CTB_RTE	       /*기여율*/
	     		, ''                                           AS DRIVE_RTE		   /*추진율*/
                , TO_CHAR(ROUND(F_AOE_DPT_TSC(#strEvlYr#, #strHlyrDvsnCd#, CHR_DPT_CD) * CTB_RTE / 100, 2), 'FM99999.00') AS PSN_TSK_ASC      /*개인평점*/
            FROM (
               SELECT D1.EVL_YR	                                   AS EVL_YR           /*평가년도*/
                    , D1.HLYR_DVSN_CD                              AS HLYR_DVSN_CD	   /*반기구분*/
                    , D1.PTCPT_CNB                                 
                    , NVL(SUM(D2.WGT_RTE * D1.CTB_RTE / 100), 0)   AS CTB_RTE	       /*기여율*/
                    , D2.CHR_DPT_CD
                 FROM TBCSPAOE027M D1
                    , TBCSPAOE026M D2
                WHERE 1=1
                  AND D1.EVL_YR       = D2.EVL_YR
                  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                  AND D2.CHR_DPT_CD = CASE WHEN SUBSTR(D1.CHR_DPT_CD,1,3) = '141' THEN '141000' 
                                    WHEN SUBSTR(D1.CHR_DPT_CD,1,3) = '121' THEN '121000' 
                                    WHEN SUBSTR(D1.CHR_DPT_CD,1,3) = '122' AND D1.CHR_DPT_CD = '122500' THEN D1.CHR_DPT_CD
                                    WHEN SUBSTR(D1.CHR_DPT_CD,1,3) = '122' AND D1.CHR_DPT_CD <> '122500' THEN '122000'
                                    ELSE D1.CHR_DPT_CD END
                  AND D1.TSK_NO       = D2.TSK_NO
                  AND D1.EVL_YR       = #strEvlYr#
                  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                  AND D1.PTCPT_CNB    = #strNevltCnb#
                  AND D1.CTB_RTE     != 0
                GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.PTCPT_CNB, D2.CHR_DPT_CD
            ) 
                
             UNION ALL
               
            /*감사업무 업무실적명세*/
            SELECT #strEvlYr# AS EVL_YR	         /*평가년도*/
                 , #strHlyrDvsnCd#    AS HLYR_DVSN_CD	 /*반기구분*/
                 , AUD_KND_NM   AS TSK_KND_CD /*감사종류코드*/
                 , TSK_NO          AS TSK_NO	         /*업무번호*/
                 , AUD_SBJ_NM  AS TSK_NM	         /*업무명*/
                 , AUD_STEP_CD_MIN AS TSK_ST_STEP_CD	 /*단계기초*/
                 , AUD_STEP_CD_MAX AS TSK_END_STEP_CD /*딘계기말*/
                 , PTCPT_CNB       AS CNB	           /*전산번호*/
                 , TO_CHAR(CTB_RTE, 'FM99999.00') AS CTB_RTE         /*기여 율*/
                 , TO_CHAR(DRIVE_RTE_SUM, 'FM99999.00')  AS DRIVE_RTE /*추진율*/    
                 /*, TO_CHAR(ROUND((DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC) * (CTB_RTE/100), 2), 'FM99999.00') AS PSN_TSK_ASC *//*개인평점*/
                 , TO_CHAR(ROUND(STND_ASC * (CTB_RTE/100), 2), 'FM99999.00') AS PSN_TSK_ASC
              FROM (
                SELECT (SELECT F_CODE_NM('1000270', D20.AUD_KND_CD) FROM DUAL) AS AUD_KND_NM 
                     , D20.AUD_SBJ_NM
                     , D20.AUD_STEP_CD_MIN
                     , D20.AUD_STEP_CD_MAX
                     , D20.DRIVE_RTE_SUM  /*추진율*/      
                     , D20.DRIVE_RTE_ASC /*추진율 조정평점*/
                     , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/
                     , D20.SPE_ADD_SC /*특별가산점*/     
                     , D20.MDT_ASC /*조정평점*/ 
                     , D20.CTB_RTE
                     , D20.TSK_NO
                     , D20.PTCPT_CNB
                     , STND_ASC
                 FROM (                        
                 SELECT D19.AUD_KND_CD    /*감사종류코드*/
                      , D19.AUD_SBJ_NM
                      , D19.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
                      , D19.AUD_STEP_CD_MIN
                      , D19.AUD_STEP_CD_MAX
                      , D19.DRIVE_RTE_SUM  /*추진율*/      
                      , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
                      , D19.DLY_DT_SUM /*지연일*/
                      , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2) 
                             ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100), 2) END)) AS ASP_STND_ASC /*가감평점*/
                      , D19.SPE_ADD_SC /*특별가산점*/     
                      , D19.MDT_ASC /*조정평점*/ 
                      , D19.CTB_RTE
                      , D19.PTCPT_CNB
                      , D19.AUD_YR
                      , D19.TSK_NO
                      ,STND_ASC
                  FROM (
                     SELECT D10.AUD_KND_CD    /*감사종류코드*/
                          , D10.AUD_SBJ_NM
                          , D10.STND_ASC /*표준평점*/
                          , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
                          , D10.STND_ASC * D10.SYT_EVL_ADVL_VAL AS ADVL_ASC /*가중평점=표준평점*가중치*/
                          , D10.AUD_STEP_CD_MIN
                          , D10.AUD_STEP_CD_MAX
                          , D10.DRIVE_RTE_SUM  /*추진율*/      
                          , F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
                          , D10.DLY_DT_SUM /*지연일*/
                          , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/
                          , D10.SPE_ADD_SC /*특별가산점*/      
                          , D10.MDT_ASC /*조정평점*/
                          , D11.CTB_RTE
                          , D11.PTCPT_CNB
                          , D10.AUD_YR
                          , D10.TSK_NO
                      FROM (
                         SELECT AUD_KND_CD
                              , AUD_YR
                              , TSK_NO
                              , AUD_SBJ_NM
                              , AUD_STEP_CD_MIN
                              , AUD_STEP_CD_MAX
                              , MNDY_CNT
                              , NMPTCPT_CNT /*참여인원*/
                              , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
                              , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
                              , DRIVE_RTE_SUM  /*추진율*/      
                              , DLY_DT_SUM /*지연일*/
                              , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
                              , NVL(SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS SPE_ADD_SC
                              , NVL(MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS MDT_ASC
                              , EVL_YR
                              , HLYR_DVSN_CD
                              , SYT_TRTM_YN
                           FROM (
                             SELECT D5.HNDL_DIV_DPT_CD
                                  , D5.SPVR_CNB
                                  , D5.AUD_KND_CD
                                  , D5.AUD_YR
                                  , D5.TSK_NO
                                  , D5.AUD_SBJ_NM
                                  , D5.AUD_STEP_CD_MIN
                                  , D5.AUD_STEP_CD_MAX
                                  , D5.MNDY_CNT
                                  , ( SELECT COUNT(*) FROM TBCSPAOE023M WHERE AUD_YR = D5.AUD_YR AND TSK_NO = D5.TSK_NO AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ) AS NMPTCPT_CNT /*참여인원*/
                                  , ( SELECT F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
                                  , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
                                                                       , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
                                                                                         AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
                                                                       , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                                                                
                                  , (SELECT NVL(SUM(DRIVE_RTE), 0) 
                                       FROM TBCSPAOE008D 
                                      WHERE EVL_YR        = #strEvlYr#
                                        AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
                                        AND TSK_DVSN_CD   = '10000' 
                                        AND AUD_KND_CD    = D5.AUD_KND_CD   
                                        AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
                                  , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
                                       FROM TBCSPAOE022M
                                      WHERE AUD_YR = D5.AUD_YR
                                        AND TSK_NO = D5.TSK_NO
                                        AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
                                  , D6.SPE_ADD_SC
                                  , D6.MDT_ASC
                                  ,  NVL(D6.EVL_YR, #strEvlYr#) AS EVL_YR
                                  , NVL(D6.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD
                                  , D5.SYT_TRTM_YN
                              FROM (
                                     SELECT D2.HNDL_DIV_DPT_CD
                                          , D2.SPVR_CNB
                                          , D2.AUD_KND_CD
                                          , D2.AUD_YR
                                          , D2.TSK_NO
                                          , D2.AUD_SBJ_NM
                                          , D1.AUD_STEP_CD_MIN
                                          , D1.AUD_STEP_CD_MAX
                                          , D2.MNDY_CNT
                                          , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
                                       FROM (
                                         SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                                              , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                              , AUD_YR
                                              , TSK_NO
                                           FROM TBCSPAOE022M
                                          WHERE CMPT_DT IS NOT NULL
                                            AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                          GROUP BY AUD_YR, TSK_NO
                                      ) D1
                                      , TBCSPAOE021M D2
                                  WHERE D1.AUD_YR = D2.AUD_YR
                                    AND D1.TSK_NO = D2.TSK_NO
                                   ) D5 /*평가대상 감사활동 - 기준*/
                                   , (
                                     SELECT D8.AUD_TSK_KND_CD
                                          , D8.AUD_YR
                                          , D8.TSK_NO
                                          , D8.SYT_EVL_ADVL_VAL
                                          , D8.EVL_YR
                                          , D8.HLYR_DVSN_CD
                                          , D8.TSK_DVSN_CD
                                          , D8.EVL_RK_CD
                                          , D8.SYT_EVL_RK_CD
                                          , D8.EVL_STEP_CD
                                          , D8.SPE_ADD_SC
                                          , D8.MDT_ASC
                                        FROM (
                                            SELECT EVL_YR
                                                 , HLYR_DVSN_CD 
                                                 , AUD_YR
                                                 , TSK_NO
                                                 , MAX(EVL_STEP_CD) AS EVL_STEP_CD
                                                 , AUD_TSK_KND_CD
                                                 , TSK_DVSN_CD
                                              FROM TBCSPAOE029M
                                            WHERE 1=1
                                            AND (AUD_YR,
                                                     TSK_NO,
                                                     EVL_STEP_CD) IN (SELECT AUD_YR,
                                                     TSK_NO,
                                                     MAX(EVL_STEP_CD)
                                                FROM TBCSPAOE029M
                                               WHERE (AUD_YR,
                                                             TSK_NO) IN (SELECT AUD_YR ,
                                                             TSK_NO
                                                        FROM TBCSPAOE022M
                                                       WHERE CMPT_DT IS NOT NULL
                                                         AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                       GROUP BY AUD_YR,
                                                             TSK_NO )
                                               GROUP BY AUD_YR,
                                                     TSK_NO )
                                               AND TSK_DVSN_CD  = '10000'
                                               AND EVL_STA_CD   = '300' /*평가완료*/
                                             GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
                                      ) D7
                                      , TBCSPAOE029M D8
                                     WHERE D7.EVL_YR = D8.EVL_YR
                                       AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
                                       AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
                                       AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
                                       AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
                                       AND D7.AUD_YR = D8.AUD_YR
                                       AND D7.TSK_NO = D8.TSK_NO	                                          
                                 ) D6 /*감사사항 평가관리*/
                                 , TBCSPAOE010D D7
                             WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
                               AND D5.AUD_YR          = D6.AUD_YR         (+)
                               AND D5.TSK_NO          = D6.TSK_NO         (+)
                               AND D6.EVL_YR = D7.EVL_YR (+) 
                               AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
                               AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
                               AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
                               AND D6.EVL_RK_CD = D7.RK_CD (+)		  
                           ) D9
                       ) D10
                       , TBCSPAOE023M D11
                  WHERE D10.AUD_YR = D11.AUD_YR
                    AND D10.TSK_NO = D11.TSK_NO
                    AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD 
                    AND D11.PTCPT_CNB = #strNevltCnb#                                        
                    AND D11.CTB_RTE != 0
                	) D19
               ) D20
           )
            
		 UNION ALL
		 
		 /*감사외업무 업무실적명세*/
		 SELECT D3.EVL_YR                                     AS EVL_YR	           /*평가년도*/
     		  , D3.HLYR_DVSN_CD                               AS HLYR_DVSN_CD	   /*반기구분*/
     		  , F_CODE_NM('1000272', D3.TSK_KND_CD)                                 AS TSK_KND_CD	       /*업무종류*/
     		  , D3.TSK_NO                                     AS TSK_NO	           /*업무번호*/
     		  , D3.TSK_NM                                     AS TSK_NM	           /*업무명*/
     		  , ''                                            AS TSK_ST_STEP_CD	   /*단계기초*/
     		  , ''                                            AS TSK_END_STEP_CD   /*단계기말*/
     		  , D1.PTCPT_CNB                                  AS CNB	           /*전산번호*/
     		  , TO_CHAR(D1.CTB_RTE, 'FM99999.00')             AS CTB_RTE	       /*기여율*/
     		  , ''                                            AS DRIVE_RTE         /*추진율*/
     		  , TO_CHAR(NVL(D4.PSN_TSK_ASC, 0), 'FM99999.00') AS PSN_TSK_ASC       /*개인평점*/
		   FROM TBCSPAOE025M D1
		      , TBCSPAOE024M D3
   			  , TBCSPAOE035M D4
		  WHERE 1=1
 		    AND D1.EVL_YR       = D3.EVL_YR
  			AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
  			AND D1.TSK_KND_CD   = D3.TSK_KND_CD
  			AND D1.TSK_NO       = D3.TSK_NO
  			AND D1.EVL_YR       = #strEvlYr#
  			AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
  			AND D1.PTCPT_CNB    = #strNevltCnb#
  			AND D1.EVL_YR       = D4.EVL_YR (+)
            AND D1.HLYR_DVSN_CD = D4.HLYR_DVSN_CD (+)
            AND D4.TSK_DVSN_CD (+) = '10001'
            AND D1.EVL_YR       = D4.AUD_YR (+)
            AND D1.TSK_NO       = D4.TSK_NO (+)
            AND D1.PTCPT_CNB    = D4.NEVLT_CNB (+)
            AND D1.CTB_RTE != 0
		]]>
	</select>
	<select id="CSPAOE094QResultYn" parameterClass="paramMap" resultClass="resultMap">
		SELECT COUNT(1) AS RESULT_YN
		FROM	TBCSPAOE045M
		WHERE	EVL_YR = #strEvlYr#
		AND		HLYR_DVSN_CD = #strHlyrDvsnCd#
		AND		CNB = #strNevltCnb#
	</select>
	<!-- 공개 시작일자와 공개종료일자 정보를 가져온다. -->
	<select id="CSPAOE094QOpenSearchDateSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
			SELECT CASE WHEN SRCH_STR_DT IS NOT NULL AND SRCH_END_DT IS NOT NULL 
			            THEN ' ※ 공개일자 : ' || SUBSTR(SRCH_STR_DT, 1,4) || '.' || SUBSTR(SRCH_STR_DT, 5, 2) || '.' || SUBSTR(SRCH_STR_DT, 7) || ' ~ ' || SUBSTR(SRCH_END_DT, 1,4) || '.' || SUBSTR(SRCH_END_DT, 5, 2) || '.' || SUBSTR(SRCH_END_DT, 7)
			            ELSE '' END AS SRCH_DT
			  FROM TBCSPAOE001M
			 WHERE EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		]]>
	</select>
	<!-- ################################ 개인별평과결과 조회 끝 (CSPAOE094Q) ##################################### -->

	<!-- ################################ 감사업무 평가결과조회 시작 (CSPAOE091Q) ################################## -->
	<!-- 감사업무 과별 기여율 -->
	<select id="CSPAOE091QMainFSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D2.AUD_KND_CD, '-'),D1.AUD_YR || '-' || D1.TSK_NO)  AS EVL_YR_TSK_NO /*감사연번호*/
			     , D1.AUD_SBJ_NM                                /*감사사항명*/
			     , F_DPT_INFO(BLT_DPT_CD, '1') AS BLT_DPT_NM /*부서명*/
			     , PTCPT_CNT_MAX AS PTCPT_CNT                /*참여인원*/
			     , DPT_DIV                                   /*구분*/
			     , BLT_DPT_PTCPT_CNT                         /*과별 참여인원*/ 
			     , TO_CHAR(ROUND(BLT_DPT_PTCPT_CNT * 100 / PTCPT_CNT_MAX, 2), 'FM99999.00') AS BLT_DPT_PTCPT_RTE               /*과별 참여율*/
			     , TO_CHAR(CTB_RTE_SUM, 'FM99999.00')  AS CTB_RTE_SUM   /*과별 기여율*/
			     , TO_CHAR(ROUND(CTB_RTE_SUM / (BLT_DPT_PTCPT_CNT * 100 / PTCPT_CNT_MAX), 2), 'FM99999.00') AS BLT_DPT_CTB_RTE /*기여율 배분수치*/
			     , BLT_DPT_CD
			     , (SELECT A.DPT_SNO
			     	  FROM (SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , NVL((SELECT B.DPT_SNO FROM TBDCMACM002M B WHERE B.DPT_CD = A.HIRK_DPT_CD), '36') AS DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) <> '000'
							   AND A.DPT_CD NOT IN ('150150', '150160', '150170', '150180')
							UNION
							SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , A.DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) = '000') A
					 WHERE DPT_CD = BLT_DPT_CD) AS DPT_SNO
				 , (SELECT (CASE WHEN A.DPT_SNO != '32' THEN '0'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '150' THEN '1'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '141' THEN '2'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '100' THEN '3'
							END) DPT_SNO2
			     	  FROM (SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , NVL((SELECT B.DPT_SNO FROM TBDCMACM002M B WHERE B.DPT_CD = A.HIRK_DPT_CD), '36') AS DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) <> '000'
							   AND A.DPT_CD NOT IN ('150150', '150160', '150170', '150180')
							UNION
							SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , A.DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) = '000') A
					 WHERE DPT_CD = BLT_DPT_CD) AS DPT_SNO2
			  FROM (
			    SELECT D3.AUD_YR
			         , D3.TSK_NO
			         , D3.AUD_SBJ_NM
			         , D3.DPT_DIV
			         , D3.BLT_DPT_CD
			         , D3.BLT_DPT_PTCPT_CNT  /*과별 참여인원*/ 
			         , D3.CTB_RTE_SUM        /*과별 기여율*/
			         , D4.PTCPT_CNT_MAX      /*마지막단계 참여 인원수*/
			         , D3.ORD      
			         , D3.HNDL_DIV_DPT_CD
			      FROM (
			        /*주관부서*/
			        SELECT D1.AUD_YR
			             , D1.TSK_NO
			             , D1.AUD_SBJ_NM /*감사사항명*/
			             , '주관부서' AS DPT_DIV
			             , D2.BLT_DPT_CD
			             , D2.BLT_DPT_PTCPT_CNT /*과별 참여인원*/ 
			             , D2.CTB_RTE_SUM /*과별 기여율*/
			             , D1.HNDL_DIV_DPT_CD
			             , 1 AS ORD
			          FROM TBCSPAOE021M D1
			             , ( 
			                 SELECT D1.AUD_YR
			                      , D1.TSK_NO 
			                      , D1.BLT_DPT_CD
			                      , SUM(D1.CTB_RTE) AS CTB_RTE_SUM
                                  , COUNT(D1.PTCPT_CNB) AS BLT_DPT_PTCPT_CNT /*과별 참여인원*/ 
			                   FROM TBCSPAOE023M D1
			                      , (
                                 SELECT AUD_YR 
                                     , TSK_NO 
                                     , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                  FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */
                                 WHERE 1 = 1
                                   AND CMPT_DT IS NOT NULL
                                   AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                 GROUP BY AUD_YR, TSK_NO
                                     )D2
			                  WHERE D1.AUD_YR = D2.AUD_YR
			                    AND D1.TSK_NO = D2.TSK_NO
			                    AND D1.AUD_STEP_CD = D2.AUD_STEP_CD_MAX
                              GROUP BY D1.AUD_YR, D1.TSK_NO , D1.BLT_DPT_CD
		                )D2
			        WHERE D1.AUD_YR          = D2.AUD_YR
			          AND D1.TSK_NO          = D2.TSK_NO
			          AND D1.HNDL_DIV_DPT_CD = D2.BLT_DPT_CD

			        UNION ALL
			
			        /*지원부서*/
 			        SELECT D1.AUD_YR
			             , D1.TSK_NO
			             , D1.AUD_SBJ_NM /*감사사항명*/
			             , '지원부서' AS DPT_DIV
			             , D2.BLT_DPT_CD
			             , D2.BLT_DPT_PTCPT_CNT /*과별 참여인원*/ 
			             , D2.CTB_RTE_SUM /*과별 기여율*/
			             , D1.HNDL_DIV_DPT_CD
			             , 2 AS ORD
			          FROM TBCSPAOE021M D1
			             , ( 
			                 SELECT D1.AUD_YR
			                      , D1.TSK_NO 
			                      , D1.BLT_DPT_CD
			                      , SUM(D1.CTB_RTE) AS CTB_RTE_SUM
                                  , COUNT(D1.PTCPT_CNB) AS BLT_DPT_PTCPT_CNT /*과별 참여인원*/ 
			                   FROM TBCSPAOE023M D1
			                      , (
                                 SELECT AUD_YR 
                                     , TSK_NO 
                                     , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                  FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */
                                 WHERE 1 = 1
                                   AND CMPT_DT IS NOT NULL
                                   AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                 GROUP BY AUD_YR, TSK_NO
                                     )D2
			                  WHERE D1.AUD_YR = D2.AUD_YR
			                    AND D1.TSK_NO = D2.TSK_NO
			                    AND D1.AUD_STEP_CD = D2.AUD_STEP_CD_MAX
                              GROUP BY D1.AUD_YR, D1.TSK_NO , D1.BLT_DPT_CD
		                )D2
			        WHERE D1.AUD_YR          = D2.AUD_YR
			          AND D1.TSK_NO          = D2.TSK_NO
			          AND D1.HNDL_DIV_DPT_CD != D2.BLT_DPT_CD
			    ) D3
			    , (
			        SELECT D1.AUD_YR
			             , D1.TSK_NO
			             , COUNT(D1.PTCPT_CNB) AS PTCPT_CNT_MAX /*마지막단계*/
			          FROM TBCSPAOE023M D1
                         , (
                            SELECT AUD_YR 
                                 , TSK_NO 
                                 , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                              FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */
                             WHERE 1 = 1
                               AND CMPT_DT IS NOT NULL
                               AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                             GROUP BY AUD_YR, TSK_NO
                         )D2
			         WHERE D1.AUD_YR = D2.AUD_YR
                       AND D1.TSK_NO = D2.TSK_NO
                       AND D1.AUD_STEP_CD = D2.AUD_STEP_CD_MAX
                     GROUP BY D1.AUD_YR, D1.TSK_NO, D2.AUD_STEP_CD_MAX
			    ) D4 		    
			    WHERE D3.AUD_YR       = D4.AUD_YR
			      AND D3.TSK_NO       = D4.TSK_NO 
			)D1 , TBBADDED001M D2
		  WHERE 1 = 1
		  AND D1.AUD_YR = D2.AUD_YR(+)
		  AND D1.TSK_NO = D2.AUD_NO(+)
		  ORDER BY DPT_SNO, DPT_SNO2, BLT_DPT_CD, HNDL_DIV_DPT_CD, D1.AUD_YR, D1.TSK_NO, ORD
		  ]]>
	</select>

	<!-- 주관 지원부서간 기여율 -->
	<select id="CSPAOE091QMainSSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT NVL(F_MNG_KND_AUDYRNO(D3.AUD_YR, D3.TSK_NO, D4.AUD_KND_CD, '-'),D3.AUD_YR || '-' || D3.TSK_NO)               AS EVL_YR_TSK_NO     /*감사연번호*/
			     , MAX(D3.AUD_SBJ_NM)                          AS AUD_SBJ_NM        /*감사사항명*/
			     , F_DPT_INFO(D3.HNDL_DIV_DPT_CD, '1')         AS HNDL_DIV_DPT_NM   /*처리과*/
			     , F_CODE_NM('1000273', D3.AUD_STEP_CD_MIN)    AS AUD_STEP_CD_MIN   /*단계기초*/
			     , F_CODE_NM('1000273', D3.AUD_STEP_CD_MAX)    AS AUD_STEP_CD_MAX   /*단계기말*/
                 , (SELECT TO_CHAR(NVL(SUM(DRIVE_RTE), 0), 'FM99999.00') FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr#  AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' 
                        AND AUD_KND_CD = D3.AUD_KND_CD
                        AND AUD_STEP_CD BETWEEN D3.AUD_STEP_CD_MIN AND D3.AUD_STEP_CD_MAX 
                     ) AS DRIVE_RTE_SUM  /*추진율*/
                       
			     , D3.PTCPT_CNT_MAIN + D3.PTCPT_CNT_OTHER      AS PTCPT_CNT_ALL     /*전체참여인원*/
			     , D3.PTCPT_CNT_MAIN                           AS PTCPT_CNT_MAIN    /*주관부서 인원*/
			     , TO_CHAR(D3.CTB_RTE_MAIN, 'FM99999.00')      AS CTB_RTE_MAIN      /*주관부서 기여율*/
			     , TO_CHAR(CASE WHEN D3.CTB_RTE_MAIN != 0 AND D3.PTCPT_CNT_MAIN != 0 THEN ROUND(D3.CTB_RTE_MAIN / D3.PTCPT_CNT_MAIN, 2)
			             ELSE 0 END, 'FM99999.00')            AS AVG_CTB_RTE_MAIN  /*주관부서_인당 평균기여율*/
			     , D3.PTCPT_CNT_OTHER                          AS PTCPT_CNT_OTHER   /*지원부서 인원*/
			     , TO_CHAR(D3.CTB_RTE_OTHER, 'FM99999.00')     AS CTB_RTE_OTHER     /*지원부서 기여율*/
			     , TO_CHAR(CASE WHEN D3.CTB_RTE_OTHER != 0 AND D3.PTCPT_CNT_OTHER != 0 THEN ROUND(D3.CTB_RTE_OTHER /D3.PTCPT_CNT_OTHER, 2)
			             ELSE 0 END, 'FM99999.00')             AS AVG_CTB_RTE_OTHER /*지원부서_인당 평균기여율*/
			     , TO_CHAR(CASE WHEN D3.CTB_RTE_MAIN != 0 AND D3.PTCPT_CNT_MAIN != 0 AND D3.CTB_RTE_OTHER != 0 AND D3.PTCPT_CNT_OTHER != 0 
			            THEN ROUND( D3.CTB_RTE_MAIN / D3.PTCPT_CNT_MAIN /  (D3.CTB_RTE_OTHER / D3.PTCPT_CNT_OTHER)  , 2)
			            ELSE 0 END, 'FM99999.00')              AS AVG_CTB_RTE      /*기여율배분율(1인당 평균기여율 기준)*/
			     , (SELECT A.DPT_SNO
			     	  FROM (SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , NVL((SELECT B.DPT_SNO FROM TBDCMACM002M B WHERE B.DPT_CD = A.HIRK_DPT_CD), '36') AS DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) <> '000'
							   AND A.DPT_CD NOT IN ('150150', '150160', '150170', '150180')
							UNION
							SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , A.DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) = '000') A
					 WHERE DPT_CD = D3.HNDL_DIV_DPT_CD) AS DPT_SNO
				 , (SELECT (CASE WHEN A.DPT_SNO != '32' THEN '0'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '150' THEN '1'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '141' THEN '2'
								 WHEN A.DPT_SNO = '32' AND SUBSTR(A.DPT_CD, 1, 3) = '100' THEN '3'
							END) DPT_SNO2
			     	  FROM (SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , NVL((SELECT B.DPT_SNO FROM TBDCMACM002M B WHERE B.DPT_CD = A.HIRK_DPT_CD), '36') AS DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) <> '000'
							   AND A.DPT_CD NOT IN ('150150', '150160', '150170', '150180')
							UNION
							SELECT A.DPT_CD
			     	  			   , A.DPT_NM
								   , A.DPT_SNO
							  FROM TBDCMACM002M A
							 WHERE A.USE_YN = 'Y'
							   AND SUBSTR(A.DPT_CD, 4) = '000') A
					 WHERE DPT_CD = D3.HNDL_DIV_DPT_CD) AS DPT_SNO2
			  FROM (
			    SELECT D1.AUD_YR
			         , D1.TSK_NO
			         , D1.AUD_KND_CD
			         , MAX(D1.AUD_SBJ_NM)      AS AUD_SBJ_NM       /*감사사항명*/
			         , MAX(D1.HNDL_DIV_DPT_CD) AS HNDL_DIV_DPT_CD  /*처리과*/
			         , MAX(D2.AUD_STEP_CD_MIN) AS AUD_STEP_CD_MIN  /*단계기초*/
			         , MAX(D2.AUD_STEP_CD_MAX) AS AUD_STEP_CD_MAX  /*단계기말*/
			         , NVL(SUM(CASE WHEN D2.BLT_DPT_CD = D1.HNDL_DIV_DPT_CD THEN 1 END), 0)           AS PTCPT_CNT_MAIN   /*주관부서 인원*/
			         , NVL(SUM(CASE WHEN D2.BLT_DPT_CD = D1.HNDL_DIV_DPT_CD THEN D2.CTB_RTE END), 0)  AS CTB_RTE_MAIN     /*주관부서 기여율*/
			         , NVL(SUM(CASE WHEN D2.BLT_DPT_CD != D1.HNDL_DIV_DPT_CD THEN 1 END), 0)          AS PTCPT_CNT_OTHER  /*지원부서 인원*/
			         , NVL(SUM(CASE WHEN D2.BLT_DPT_CD != D1.HNDL_DIV_DPT_CD THEN D2.CTB_RTE END), 0) AS CTB_RTE_OTHER    /*지원부서 기여율*/
			      FROM TBCSPAOE021M D1
			         , (
                        SELECT D3.AUD_YR
                             , D3.TSK_NO
                             , D3.BLT_DPT_CD
                             , D3.CTB_RTE
                             , D4.AUD_STEP_CD_MAX
                             , D4.AUD_STEP_CD_MIN
                          FROM TBCSPAOE023M D3
                             , (
                            SELECT AUD_YR 
                                 , TSK_NO 
                                 , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                 , MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                              FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */
                             WHERE 1 = 1
                               AND CMPT_DT IS NOT NULL
                               AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                             GROUP BY AUD_YR, TSK_NO
                             ) D4
                          WHERE D3.AUD_YR = D4.AUD_YR
                            AND D3.TSK_NO = D4.TSK_NO
                            AND D3.AUD_STEP_CD = D4.AUD_STEP_CD_MAX
                       ) D2
			    WHERE D1.AUD_YR       = D2.AUD_YR
			      AND D1.TSK_NO       = D2.TSK_NO
			    GROUP BY D1.AUD_YR, D1.TSK_NO, D1.AUD_KND_CD
				) D3,TBBADDED001M D4
			WHERE 1 = 1
			AND D3.AUD_YR = D4.AUD_YR(+)
			AND D3.TSK_NO = D4.AUD_NO(+)
			GROUP BY D3.AUD_YR, D3.TSK_NO, D3.AUD_KND_CD, D3.HNDL_DIV_DPT_CD, D3.AUD_STEP_CD_MIN, D3.AUD_STEP_CD_MAX, D3.PTCPT_CNT_MAIN, D3.PTCPT_CNT_OTHER, D3.PTCPT_CNT_MAIN, D3.CTB_RTE_MAIN, D3.CTB_RTE_OTHER , D4.AUD_KND_CD
			ORDER BY DPT_SNO, DPT_SNO2, D3.HNDL_DIV_DPT_CD, D3.HNDL_DIV_DPT_CD, D3.AUD_YR, D3.TSK_NO
		  ]]>
	</select>
	<!-- ############################ 감사업무 평가결과조회 끝 (CSPAOE091Q) ################################### -->

	<!-- ############################ 감사외업무 평가결과조회 시작 (CSPAOE092Q) ################################ -->
	<!-- 업무종류별 실적명세 조회 -->
	<select id="CSPAOE092QMainFSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT MAN.TSK_NM                                      AS TSK_NM         /*업무명*/
			     , F_DPT_INFO(MAN.CHR_DPT_CD, '1')                 AS CHR_DPT_NM     /*담당부서코드*/
			     , F_CODE_NM('1000272', MAN.TSK_KND_CD)            AS TSK_KND_NM     /*업무종류*/
			     , D9.STND_ASC                                     AS STND_ASC       /*표준평점*/
			     , F_CODE_NM('1000280', NVL(D7.EVL_STA_CD, '100')) AS EVL_STA_NM     /*평가상태*/
			     , D8.IDVT_INDEX_VAL                               AS IDVT_INDEX_VAL /*가중치*/
			     , ROUND(D7.NAUD_TSK_EVL_SC, 2) AS STAD_ASC /*감사외업무평점*/
			     , DENSE_RANK() OVER(ORDER BY MAN.CHR_DPT_CD)      AS RANK_NUM
			  FROM ( 
			    SELECT D5.EVL_YR 
			         , D5.HLYR_DVSN_CD
			         , D5.TSK_KND_CD
			         , D5.TSK_NM
			         , D5.CHR_DPT_CD
			         , D5.EVL_CMTR_DVSN_CD
			         , D5.CHGR_CNB
			         , D5.TSK_NO
			      FROM (
			        /*평가자가 평가 완료한 리스트를 걸러낸다.*/
			        SELECT D3.EVL_YR
			             , D3.HLYR_DVSN_CD
			             , D3.TSK_KND_CD
			             , D3.TSK_NM
			             , D3.CHR_DPT_CD
			             , D3.TSK_NO
			             , D4.EVL_CMTR_CNB AS CHGR_CNB
			             , D4.EVL_CMTR_DVSN_CD /*확인자 구분코드 (평가자 다음 코드가 확인자)*/
			          FROM TBCSPAOE024M D3
			             , TBCSPAOE029M D4
			        WHERE D3.EVL_YR       = D4.EVL_YR
			          AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
			          AND D4.TSK_DVSN_CD  = '10001' /*감사외업무*/
			          AND D3.TSK_KND_CD   = D4.AUD_TSK_KND_CD
			          AND D4.EVL_STEP_CD  = '700' /*확인자*/
			          AND D3.TSK_NO       = D4.TSK_NO
			          AND D4.EVL_STA_CD   = '300' /*평가완료*/
			          AND D3.EVL_YR       = #strEvlYr#
			          AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd#
		  ]]>
		
		<isNotEmpty property="strTskKndCd">
			<isNotEqual property="strTskKndCd" compareValue="1">
				<isNotEqual property="strTskKndCd" compareValue="2">
					AND D3.TSK_KND_CD = #strTskKndCd#
				</isNotEqual>
			</isNotEqual>
			<isEqual property="strTskKndCd" compareValue="1">
				AND (TO_NUMBER(SUBSTR(D3.TSK_KND_CD, 4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(D3.TSK_KND_CD, 4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(D3.TSK_KND_CD, 4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(D3.TSK_KND_CD, 4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(D3.TSK_KND_CD, 4)) BETWEEN 94 AND 96) /* 기타업무 */
			</isEqual>
			<isEqual property="strTskKndCd" compareValue="2">
				AND (TO_NUMBER(SUBSTR(D3.TSK_KND_CD, 4)) = 1 OR TO_NUMBER(SUBSTR(D3.TSK_KND_CD, 4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(D3.TSK_KND_CD, 4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93) /* 모니터링 */
			</isEqual>
		</isNotEmpty>
		
		<isNotEmpty property="strTskKndCd2">
				AND D3.TSK_KND_CD = #strTskKndCd2#
		</isNotEmpty>
		
		<![CDATA[			          			          
			    ) D5
			 ) MAN
			 , TBCSPAOE029M D7
			 , TBCSPAOE010D D8
			 , TBCSPAOE006M D9
			WHERE 1=1
			  AND MAN.EVL_YR           = D7.EVL_YR           (+)
			  AND MAN.HLYR_DVSN_CD     = D7.HLYR_DVSN_CD     (+)
			  AND D7.TSK_DVSN_CD (+)   = '10001'
			  AND MAN.TSK_KND_CD       = D7.AUD_TSK_KND_CD   (+)
			  AND D7.EVL_STEP_CD (+)   = '700' /*확인자 단계*/
			  AND MAN.CHGR_CNB         = D7.EVL_CMTR_CNB     (+)
			  AND MAN.TSK_NO           = D7.TSK_NO           (+)
			  AND MAN.EVL_CMTR_DVSN_CD = D7.EVL_CMTR_DVSN_CD (+)
			  AND D7.EVL_YR            = D8.EVL_YR           (+)
			  AND D7.HLYR_DVSN_CD      = D8.HLYR_DVSN_CD     (+)
			  AND D7.TSK_DVSN_CD       = D8.TSK_DVSN_CD      (+)
			  AND D7.AUD_TSK_KND_CD    = D8.AUD_TSK_KND_CD   (+) 
			  AND D7.EVL_RK_CD         = D8.RK_CD            (+)
			  AND MAN.EVL_YR           = D9.EVL_YR
			  AND MAN.HLYR_DVSN_CD     = D9.HLYR_DVSN_CD
			  AND D9.TSK_DVSN_CD       = '10001'
			  AND MAN.TSK_KND_CD       = D9.TSK_KND_CD
			ORDER BY MAN.CHR_DPT_CD, MAN.TSK_NO 
		  ]]>
	</select>

	<!-- 개인별 기여율 조회 -->
	<select id="CSPAOE092QMainSSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_DPT_INFO(D1.CHR_DPT_CD, '1')      AS CHR_DPT_NM      /*담당부서명*/
			     , F_CODE_NM('1000272', D1.TSK_KND_CD) AS TSK_KND_NM      /*업무종류*/
			     , D1.TSK_NM                           AS TSK_NM          /*업무명*/
			     , F_DPT_INFO(D2.CHR_DPT_CD, '1')      AS PTCPT_DPT_NM    /*소속부서명*/
			     , F_CODE_NM('1000173', D2.RANK_CD)    AS RANK_NM         /*직급명*/
			     , F_USR_INFO(D2.PTCPT_CNB, '2')       AS PTCPT_NM        /*성명*/
			     , D2.CTB_RTE                          AS CTB_RTE         /*기여율*/
			     , D2.EVL_RFR_SBJ_TXT                  AS EVL_RFR_SBJ_TXT /*평가참고사항내용*/
			     , DENSE_RANK() OVER(ORDER BY D1.CHR_DPT_CD) AS RANK_NUM
			 FROM TBCSPAOE024M D1
			    , TBCSPAOE025M D2
			WHERE 1=1
			  AND D1.EVL_YR       = D2.EVL_YR
			  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			  AND D1.TSK_KND_CD   = D2.TSK_KND_CD
			  AND D1.TSK_NO       = D2.TSK_NO
			  AND D1.EVL_YR       = #strEvlYr#
			  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
	]]>
	
		<isNotEmpty property="strTskKndCd">
			<isNotEqual property="strTskKndCd" compareValue="1">
				<isNotEqual property="strTskKndCd" compareValue="2">
					AND D1.TSK_KND_CD = #strTskKndCd#
				</isNotEqual>
			</isNotEqual>
			<isEqual property="strTskKndCd" compareValue="1">
				AND (TO_NUMBER(SUBSTR(D1.TSK_KND_CD, 4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(D1.TSK_KND_CD, 4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(D1.TSK_KND_CD, 4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(D1.TSK_KND_CD, 4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(D1.TSK_KND_CD, 4)) BETWEEN 94 AND 96) /* 기타업무 */
			</isEqual>
			<isEqual property="strTskKndCd" compareValue="2">
				AND (TO_NUMBER(SUBSTR(D1.TSK_KND_CD, 4)) = 1 OR TO_NUMBER(SUBSTR(D1.TSK_KND_CD, 4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(D1.TSK_KND_CD, 4)) = 64 OR TO_NUMBER(SUBSTR(D1.TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(D1.TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(D1.TSK_KND_CD,4)) BETWEEN 89 AND 93) /* 모니터링 */
			</isEqual>
		</isNotEmpty>
		
		<isNotEmpty property="strTskKndCd2">
				AND D1.TSK_KND_CD = #strTskKndCd2#
		</isNotEmpty>
		
	<![CDATA[			  
			ORDER BY D1.CHR_DPT_CD, D1.TSK_KND_CD
		  ]]>
	</select>
	
	<!-- 평가완료된 업무종류 코드만 가져온다 -->
	<select id="CSPAOE092QAudTskKndCdselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT DISTINCT 
			CASE 
				WHEN SUBSTR(A.USR_DFN_TXT_1, 0, 4) = '1'
				THEN A.USR_DFN_TXT_1
				WHEN SUBSTR(A.USR_DFN_TXT_1, 0, 4) = '2'
				THEN A.USR_DFN_TXT_1
				ELSE A.CD
			END AS CD
			, CASE 
				WHEN SUBSTR(A.USR_DFN_TXT_1, 0, 4) = '1'
				THEN '기타업무'
				WHEN SUBSTR(A.USR_DFN_TXT_1, 0, 4) = '2'
				THEN '모니터링'
				ELSE A.CD_NM
			END AS CD_NM
		FROM
			(SELECT D1.CD
			     , D1.CD_NM
			     , D1.OTPT_SEQ
			     , D1.USR_DFN_TXT_1
			  FROM (
			     SELECT CD
			          , CD_NM
			          , OTPT_SEQ
			          , USR_DFN_TXT_1
			      FROM TBDCMACM013C 
			     WHERE CMM_CD_DVSN_CD = '1000272'
			       AND CD NOT IN ('000000000', '10000')
			       AND USE_YN = 'Y'
			    ) D1
			    , (
			    SELECT AUD_TSK_KND_CD
			     FROM TBCSPAOE029M
			    WHERE EVL_YR       = #strEvlYr#
			      AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			      AND TSK_DVSN_CD  = '10001' /*감사외업무관리*/
			      AND EVL_STEP_CD  = '700'   /*확인자*/
			      AND EVL_DTM_YN   = 'Y'     /*평가완료*/
			    GROUP BY AUD_TSK_KND_CD
			    ) D2
			WHERE D1.CD = D2.AUD_TSK_KND_CD
			ORDER BY SUBSTR(CD_NM, 0, 4), OTPT_SEQ, CD) A
	</select>
	
	<!-- 평가완료된 업무종류 코드만 가져온다 -->
	<select id="CSPAOE092QAudTskKndCdselect2" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT D1.CD
				 , D1.CD_NM
			FROM (SELECT CD
					   , CD_NM
					   , OTPT_SEQ
					FROM TBDCMACM013C 
				   WHERE CMM_CD_DVSN_CD = '1000272'
					 AND CD NOT IN ('000000000', '10000')
					 AND USE_YN = 'Y'
		]]>
				<isNotEqual property="strTskKndCd" compareValue="">
					<isNotEqual property="strTskKndCd" compareValue="1">
						<isNotEqual property="strTskKndCd" compareValue="2">
							AND CD = #strTskKndCd#
						</isNotEqual>
					</isNotEqual>
				</isNotEqual>
				<isEqual property="strTskKndCd" compareValue="1">
					AND CD_NM like #strCdNm# || '%'
				</isEqual>
				<isEqual property="strTskKndCd" compareValue="2">
					AND CD_NM like #strCdNm# || '%'
				</isEqual>
		<![CDATA[ 
					) D1
					, (SELECT AUD_TSK_KND_CD
						 FROM TBCSPAOE029M
						WHERE 1=1
						  AND EVL_YR       = #strEvlYr#
						  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
						  AND TSK_DVSN_CD  = '10001' /*감사외업무관리*/
						  AND EVL_STEP_CD  = '700'   /*확인자*/
						  AND EVL_DTM_YN   = 'Y'     /*평가완료*/
						GROUP BY AUD_TSK_KND_CD
					   ) D2
			WHERE D1.CD = D2.AUD_TSK_KND_CD
			ORDER BY SUBSTR(CD_NM, 0, 4), OTPT_SEQ, CD 
		]]>
	</select>
	<!-- ############################### 감사외업무 평가결과조회 끝 (CSPAOE092Q) ################################# -->

	<!-- ############################### 지원업무 평가결과조회 끝 (CSPAOE093Q) #################################### -->
	<!-- 지원업무 부서별 실적평가를 조회한다. -->
	<select id="CSPAOE093QMainFSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_DPT_INFO(DEPT.HIRK_DPT_CD, '1') AS UP_DPT_NM  /*부서명(국)*/
			     , F_DPT_INFO(BASE.DPT_CD, '1')      AS DPT_NM     /*부서명(과)*/
			     , F_CODE_NM('1000274', '600')       AS EVL_RK_NM  /*상급자 평가등급 - 보통*/
			     , BASE.SUM_TSK_ASC_1                              /*평가위원 평점 1 ~ 25명*/
			     , BASE.SUM_TSK_ASC_2
			     , BASE.SUM_TSK_ASC_3  
			     , BASE.SUM_TSK_ASC_4
			     , BASE.SUM_TSK_ASC_5
			     , BASE.SUM_TSK_ASC_6
			     , BASE.SUM_TSK_ASC_7
			     , BASE.SUM_TSK_ASC_8
			     , BASE.SUM_TSK_ASC_9
			     , BASE.SUM_TSK_ASC_10
			     , BASE.SUM_TSK_ASC_11
			     , BASE.SUM_TSK_ASC_12
			     , BASE.SUM_TSK_ASC_13
			     , BASE.SUM_TSK_ASC_14
			     , BASE.SUM_TSK_ASC_15
			     , BASE.SUM_TSK_ASC_16
			     , BASE.SUM_TSK_ASC_17
			     , BASE.SUM_TSK_ASC_18
			     , BASE.SUM_TSK_ASC_19
			     , BASE.SUM_TSK_ASC_20
			     , BASE.SUM_TSK_ASC_21
			     , BASE.SUM_TSK_ASC_22
			     , BASE.SUM_TSK_ASC_23
			     , BASE.SUM_TSK_ASC_24
			     , BASE.SUM_TSK_ASC_25
			     , CASE WHEN CNT > 2 THEN ROUND(SUM_TSK_ASC - SUM_TSK_ASC_MIN - SUM_TSK_ASC_MAX, 2)
			            ELSE NULL END AS SUM_TSK_ASC /*총점 - 3명 이상이 평가 했어야지 최고점과 최저점을 뺄수 있으니깐.*/
			     , CASE WHEN CNT > 2 THEN ROUND((SUM_TSK_ASC - SUM_TSK_ASC_MIN - SUM_TSK_ASC_MAX) / (CNT-2), 2)
			            ELSE NULL END AS AVG_TSK_ASC /*평균 - 총점/ (평가인원-2) 두명의 점수를 제외하므로*/
			  FROM (
			    SELECT D1.EVL_YR
			         , D1.HLYR_DVSN_CD
			         , D1.DPT_CD
			         , SUM(DECODE(D2.EVL_CMTR_NO, 1, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_1
			         , SUM(DECODE(D2.EVL_CMTR_NO, 2, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_2
			         , SUM(DECODE(D2.EVL_CMTR_NO, 3, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_3
			         , SUM(DECODE(D2.EVL_CMTR_NO, 4, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_4
			         , SUM(DECODE(D2.EVL_CMTR_NO, 5, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_5
			         , SUM(DECODE(D2.EVL_CMTR_NO, 6, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_6
			         , SUM(DECODE(D2.EVL_CMTR_NO, 7, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_7
			         , SUM(DECODE(D2.EVL_CMTR_NO, 8, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_8
			         , SUM(DECODE(D2.EVL_CMTR_NO, 9, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_9
			         , SUM(DECODE(D2.EVL_CMTR_NO, 10, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_10
			         , SUM(DECODE(D2.EVL_CMTR_NO, 11, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_11
			         , SUM(DECODE(D2.EVL_CMTR_NO, 12, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_12
			         , SUM(DECODE(D2.EVL_CMTR_NO, 13, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_13
			         , SUM(DECODE(D2.EVL_CMTR_NO, 14, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_14
			         , SUM(DECODE(D2.EVL_CMTR_NO, 15, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_15
			         , SUM(DECODE(D2.EVL_CMTR_NO, 16, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_16
			         , SUM(DECODE(D2.EVL_CMTR_NO, 17, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_17
			         , SUM(DECODE(D2.EVL_CMTR_NO, 18, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_18
			         , SUM(DECODE(D2.EVL_CMTR_NO, 19, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_19
			         , SUM(DECODE(D2.EVL_CMTR_NO, 20, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_20
			         , SUM(DECODE(D2.EVL_CMTR_NO, 21, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_21
			         , SUM(DECODE(D2.EVL_CMTR_NO, 22, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_22
			         , SUM(DECODE(D2.EVL_CMTR_NO, 23, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_23
			         , SUM(DECODE(D2.EVL_CMTR_NO, 24, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_24
			         , SUM(DECODE(D2.EVL_CMTR_NO, 25, D1.SUM_TSK_ASC, NULL)) AS SUM_TSK_ASC_25
			      FROM (
			        SELECT EVL_YR 
			             , HLYR_DVSN_CD
			             , DPT_CD                      /*평가 부서코드*/
			             , EVL_CMTR_CNB                /*평가위원전산번호*/
			             , SUM(TSK_ASC) AS SUM_TSK_ASC /*업무평점 합*/
			          FROM TBCSPAOE031M D1
			         WHERE 1 = 1
			           AND EVL_STEP_CD  = '500' /*위원평가*/
			           AND EVL_DTM_YN   = 'Y'   /*평가확정*/
			           AND EVL_YR       = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				]]>
		<isNotEmpty property="strDeptCd">
			AND DPT_CD = #strDeptCd#
		</isNotEmpty>
				<![CDATA[			           
			         GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD, EVL_CMTR_CNB     
			       ) D1
			       , (     
			        /*평가자 리스트*/
			        SELECT EVL_YR
			             , HLYR_DVSN_CD
			             , CHGR_CNB
			             , ROW_NUMBER() OVER (ORDER BY EVL_CMTR_NO) AS EVL_CMTR_NO
			          FROM TBCSPAOE017D
			         WHERE 1 = 1
			           AND EVL_YR         = #strEvlYr#
			           AND HLYR_DVSN_CD   = #strHlyrDvsnCd#
			           AND TSK_DVSN_CD    = '10002'
			           AND AUD_TSK_KND_CD = '10000'
			           AND CHGR_DVSN_CD   = 'CD03' 
			       ) D2
			    WHERE D1.EVL_YR       = D2.EVL_YR 
			      AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD 
			      AND D1.EVL_CMTR_CNB = D2.CHGR_CNB 
			    GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.DPT_CD  
			) BASE
			, (
			    SELECT EVL_YR 
			         , HLYR_DVSN_CD
			         , DPT_CD /*평가 부서코드*/
			         , MIN(SUM_TSK_ASC) AS SUM_TSK_ASC_MIN
			         , MAX(SUM_TSK_ASC) AS SUM_TSK_ASC_MAX
			         , SUM(SUM_TSK_ASC) AS SUM_TSK_ASC
			         , MAX(CNT)         AS CNT /*평균을 구하기 위해서 총 평가자 수*/
			      FROM (
			    SELECT EVL_YR 
			         , HLYR_DVSN_CD
			         , DPT_CD       /*평가 부서코드*/
			         , EVL_CMTR_CNB /*평가위원전산번호*/
			         , SUM(TSK_ASC) AS SUM_TSK_ASC /*업무평점 합*/
			         , COUNT(*) OVER(PARTITION BY EVL_YR, HLYR_DVSN_CD, DPT_CD) AS CNT
			      FROM TBCSPAOE031M D1
			     WHERE 1 = 1
			       AND EVL_STEP_CD  = '500' /*위원평가*/
			       AND EVL_DTM_YN   = 'Y'   /*평가확정*/
			       AND EVL_YR       = #strEvlYr#
			       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				]]>
		<isNotEmpty property="strDeptCd">
			AND DPT_CD = #strDeptCd#
		</isNotEmpty>
				<![CDATA[			       
			     GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD, EVL_CMTR_CNB  
			     )
			    GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD
			) JUMSU /*총점과 최고점과 최저점*/
			, TBDCMACM002M DEPT
		WHERE BASE.EVL_YR       = JUMSU.EVL_YR
		  AND BASE.HLYR_DVSN_CD = JUMSU.HLYR_DVSN_CD
		  AND BASE.DPT_CD       = JUMSU.DPT_CD
		  AND BASE.DPT_CD       = DEPT.DPT_CD
		ORDER BY BASE.DPT_CD
	 	 ]]>
	</select>

	<!-- 평가자 리스트를 가져온다. -->
	<select id="CSPAOE093QChgrInfoselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_USR_INFO(CHGR_CNB, '2') AS CHGR_NM
			     , EVL_CMTR_NO               AS EVL_CMTR_NO
			  FROM TBCSPAOE017D
			 WHERE 1 = 1
			   AND EVL_YR         = #strEvlYr#
			   AND HLYR_DVSN_CD   = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD    = '10002'
			   AND AUD_TSK_KND_CD = '10000'
			   AND CHGR_DVSN_CD   = 'CD03' 
			 ORDER BY EVL_CMTR_NO
		  ]]>
	</select>

	<!-- 지원업무 부서별 실적평가를 조회한다. -->
	<select id="CSPAOE093QMainSSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_DPT_INFO(D3.CHR_DPT_CD, '1')   AS CHR_DPT_NM   /*부서명*/
			     , F_CODE_NM('1000173', D3.RANK_CD) AS RANK_NM      /*직급명*/
			     , F_USR_INFO(D3.PTCPT_CNB, '2')    AS NAM          /*이름*/
			     , D3.TSK_NM                        AS TSK_NM       /*업무명*/
			     , D3.WGT_RTE                       AS WGT_RTE      /*비중*/
			     , D3.CTB_RTE                       AS CTB_RTE      /*기여율*/
			     , ROUND(D4.CTB_RTE_SUM, 2)         AS CTB_RTE_SUM  /*합계*/
			  FROM (
				    SELECT D1.CHR_DPT_CD
				         , D2.RANK_CD
				         , D2.PTCPT_CNB
				         , D1.TSK_NM
				         , D1.WGT_RTE
				         , D2.CTB_RTE
				      FROM TBCSPAOE026M D1
				         , TBCSPAOE027M D2
				     WHERE 1 = 1 
				       AND D1.EVL_YR       = D2.EVL_YR
				       AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
				       AND D1.CHR_DPT_CD = CASE WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '141' THEN '141000' 
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '121' THEN '121000' 
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '122' AND D2.CHR_DPT_CD = '122500' THEN D2.CHR_DPT_CD
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '122' AND D2.CHR_DPT_CD <> '122500' THEN '122000'
                                    ELSE D2.CHR_DPT_CD END
				       AND D1.TSK_NO       = D2.TSK_NO
				       AND D1.EVL_YR       = #strEvlYr#
				       AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
					]]>
					<isNotEmpty property="strDeptCd">
						AND D1.CHR_DPT_CD = #strDeptCd#
					</isNotEmpty>
					<![CDATA[				       
				   ) D3
				 ,(
				    SELECT D1.CHR_DPT_CD
				         , D2.PTCPT_CNB
				         , SUM(D1.WGT_RTE * D2.CTB_RTE / 100) AS CTB_RTE_SUM
				      FROM TBCSPAOE026M D1
				         , TBCSPAOE027M D2
				     WHERE 1 = 1 
				       AND D1.EVL_YR       = D2.EVL_YR
				       AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
				       AND D1.CHR_DPT_CD = CASE WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '141' THEN '141000' 
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '121' THEN '121000' 
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '122' AND D2.CHR_DPT_CD = '122500' THEN D2.CHR_DPT_CD
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '122' AND D2.CHR_DPT_CD <> '122500' THEN '122000'
                                    ELSE D2.CHR_DPT_CD END
				       AND D1.TSK_NO       = D2.TSK_NO
				       AND D1.EVL_YR       = #strEvlYr#
				       AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
					]]>
					<isNotEmpty property="strDeptCd">
						AND D1.CHR_DPT_CD = #strDeptCd#
					</isNotEmpty>
					<![CDATA[			       
				     GROUP BY D1.CHR_DPT_CD, D2.PTCPT_CNB
				 ) D4
			WHERE 1=1
			  AND D3.CHR_DPT_CD = D4.CHR_DPT_CD
			  AND D3.PTCPT_CNB = D4.PTCPT_CNB
		  			]]>
	</select>
	<!-- ################################ 지원외업무 평가결과조회 끝 (CSPAOE093Q) ################################# -->

	<!-- ################################ 부서별 입무실적 명세 시작 (CSPAOE063Q) ################################## -->
	<!-- 국/단명 -->
	<select id="CSPAOE063QDeptUpCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT D2.HIRK_DPT_CD                  AS DEPT_CD
			     , F_DPT_INFO(D2.HIRK_DPT_CD, '1') AS DEPT_NM
			  FROM TBCSPAOE021M D1
			     , TBDCMACM002M D2
			 WHERE 1=1
			   AND D1.HNDL_DIV_DPT_CD = D2.DPT_CD
			   AND D2.HIRK_DPT_CD IS NOT NULL
			 GROUP BY D2.HIRK_DPT_CD
		  ]]>
	</select>

	<!-- 과/팀명 -->
	<select id="CSPAOE063QDeptCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT D1.HNDL_DIV_DPT_CD AS DEPT_CD
			     , F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS DEPT_NM
			     , D2.HIRK_DPT_CD AS DEPT_UP_CD
			  FROM TBCSPAOE021M D1
			     , TBDCMACM002M D2
			 WHERE 1=1
			   AND D1.HNDL_DIV_DPT_CD = D2.DPT_CD
			   AND D1.HNDL_DIV_DPT_CD IS NOT NULL
			 GROUP BY D1.HNDL_DIV_DPT_CD, D2.HIRK_DPT_CD	
		  ]]>
	</select>

	<!-- 부서별 업무실적 명세를 조회한다. -->
	<select id="CSPAOE063Qmainselect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
			SELECT AUD_KND_NM /*감사종류*/
			     , AUD_SBJ_NM /*감사사항명*/
			     , PTCPT_CNB_CNT  /*참여인원*/
			     , STND_ASC /*표준평점*/
			     , SYT_EVL_RK_CD /*평가등급*/
			     , SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/  
			     , ADVL_ASC /*가중평점=표준평점*가중치*/
			     , DECODE(TSK_DVSN_CD, '10000', TSK_ST_STEP_NM, '') AS TSK_ST_STEP_NM  /*단계기초*/
			     , DECODE(TSK_DVSN_CD, '10000', TSK_END_STEP_NM, '') AS TSK_END_STEP_NM  /*단계기말*/
			     , DECODE(TSK_DVSN_CD, '10000', DRIVE_RTE, '')                         AS DRIVE_RTE  /*추진율*/
			     , DECODE(TSK_DVSN_CD, '10000', DRIVE_RTE_ASC, '')                         AS DRIVE_RTE_ASC /*추진율 조정평점*/
			     , DECODE(TSK_DVSN_CD, '10000', DLAY_DT_NM_SUM, '')                            AS DLAY_DT_NM_SUM /*지연일*/
			     , DECODE(TSK_DVSN_CD, '10000', ASP_RTE, '') AS ASP_RTE  /*가감점율*/
			     , DECODE(TSK_DVSN_CD, '10000', ASP_ASC, '')                          AS ASP_ASC  /*가감평점*/                           
			     , DECODE(TSK_DVSN_CD, '10000', SPE_ADD_SC, '')                            AS SPE_ADD_SC /*특별가산점*/
			     , TSK_ASC   /*업무평점-= 표준평점*평가등급별가중치*감사단계별추진율 + (가감평점) + 특별가산점 + 조정평점*/
			     , CTB_RTE_SUM /*기여율 SUM*/
			     , DPT_ASC_ALL /*부서평점 = 업무평점 * 기여율 (기여율이 0 이면 업무평점도 0이다.)*/
			     , F_DPT_INFO(EVAL_DPT_CD, '1') AS EVAL_DPT_NM /*2015.02.04 최원형감사관 요청*/
			  FROM(
				SELECT F_CODE_NM('1000270', D12.AUD_KND_CD)      AS AUD_KND_NM /*감사종류*/
				     , D12.AUD_SBJ_NM                            AS AUD_SBJ_NM /*감사사항명*/
				     , D12.NMPTCPT_CNT                           AS PTCPT_CNB_CNT  /*참여인원*/
				     , D12.STND_ASC                              AS STND_ASC /*표준평점*/
				     , F_CODE_NM('1000274', D12.SYT_EVL_RK_CD)   AS SYT_EVL_RK_CD /*평가등급*/
				     , D12.SYT_EVL_ADVL_VAL                      AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/  
				     , D12.ADVL_ASC                              AS ADVL_ASC /*가중평점=표준평점*가중치*/
				     , F_CODE_NM('1000273', D12.AUD_STEP_CD_MIN) AS TSK_ST_STEP_NM  /*단계기초*/
				     , F_CODE_NM('1000273', D12.AUD_STEP_CD_MAX) AS TSK_END_STEP_NM  /*단계기말*/
				     , D12.DRIVE_RTE_SUM                         AS DRIVE_RTE  /*추진율*/
				     , D12.DRIVE_RTE_ASC                         AS DRIVE_RTE_ASC /*추진율 조정평점*/
				     , D12.DLY_DT_SUM                            AS DLAY_DT_NM_SUM /*지연일*/
				     , ( CASE WHEN INSTR(D12.DLY_DT_SUM, '-') = 0 AND D12.ASP_RTE = 0 THEN '0.00'
	                          WHEN INSTR(D12.DLY_DT_SUM, '-') = 0 THEN  TO_CHAR(D12.ASP_RTE,'FM99990.00')
				              ELSE '-' || TO_CHAR(D12.ASP_RTE,'FM99990.00') END) AS ASP_RTE  /*가감점율*/
				     , D12.ASP_STND_ASC                          AS ASP_ASC  /*가감평점*/                           
				     , D12.SPE_ADD_SC                            AS SPE_ADD_SC /*특별가산점*/
				     , ROUND(D12.DRIVE_RTE_ASC + D12.ASP_STND_ASC + D12.SPE_ADD_SC + D12.MDT_ASC, 2) AS TSK_ASC   /*업무평점-= 표준평점*평가등급별가중치*감사단계별추진율 + (가감평점) + 특별가산점 + 조정평점*/
				     , D12.CTB_RTE_SUM                           AS CTB_RTE_SUM /*기여율 SUM*/
				     , CASE WHEN D12.CTB_RTE_SUM = 0 THEN 0
	                         ELSE ROUND((D12.DRIVE_RTE_ASC + D12.ASP_STND_ASC + D12.SPE_ADD_SC + D12.MDT_ASC) * (D12.CTB_RTE_SUM/ 100), 2) END AS DPT_ASC_ALL /*부서평점 = 업무평점 * 기여율 (기여율이 0 이면 업무평점도 0이다.)*/
				     , '10000' AS TSK_DVSN_CD
				     , D12.EVAL_DPT_CD
				  FROM (
				    SELECT D13.AUD_KND_CD /*감사종류*/
				         , D13.AUD_YR
				         , D13.TSK_NO 
				         , D13.AUD_SBJ_NM /*감사사항명*/
				         , D13.NMPTCPT_CNT /*참여인원*/
				         , D13.STND_ASC /*표준평점*/
				         , D13.SYT_EVL_RK_CD /*평가등급*/
				         , D13.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/  
				         , D13.ADVL_ASC /*가중평점=표준평점*가중치*/
				         , D13.AUD_STEP_CD_MIN /*단계기초*/
				         , D13.AUD_STEP_CD_MAX  /*단계기말*/
				         , D13.DRIVE_RTE_SUM /*추진율*/
				         , D13.DRIVE_RTE_ASC /*추진율 조정평점*/
				         , D13.DLY_DT_SUM /*지연일*/
				         , D13.ASP_RTE /*가감점율*/
				         , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D13.AUD_KND_CD, D13.AUD_STEP_CD_MAX, D13.DLY_DT_SUM, D13.SYT_EVL_ADVL_VAL, D13.ASP_STND_ASC, D13.AUD_YR, D13.TSK_NO) AS ASP_STND_ASC /*가감평점*/                                    
				         , D13.SPE_ADD_SC /*특별가산점*/
				         , D13.MDT_ASC /*조정평점*/
				         , D13.MNDY_CNT /*연인원*/
				         , D13.SYT_TRTM_YN /*종합처리안 여부*/
				         , D13.CTB_RTE_SUM /*기여율 SUM*/
				         , D13.EVAL_DPT_CD
				      FROM (
					    SELECT D11.AUD_KND_CD /*감사종류*/
					         , D11.AUD_YR
					         , D11.TSK_NO 
					         , D11.AUD_SBJ_NM /*감사사항명*/
					         , D11.NMPTCPT_CNT /*참여인원*/
					         , D11.STND_ASC /*표준평점*/
					         , D11.SYT_EVL_RK_CD /*평가등급*/
					         , D11.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/  
					         , D11.ADVL_ASC /*가중평점=표준평점*가중치*/
					         , D11.AUD_STEP_CD_MIN /*단계기초*/
					         , D11.AUD_STEP_CD_MAX  /*단계기말*/
					         , D11.DRIVE_RTE_SUM /*추진율*/
					         , D11.DRIVE_RTE_ASC /*추진율 조정평점*/
					         , D11.DLY_DT_SUM /*지연일*/
					         , D11.ASP_RTE /*가감점율*/
					         , DECODE(D11.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D11.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D11.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D11.DRIVE_RTE_ASC * NVL(D11.ASP_RTE, 0) / 100, 2)
					                                        ELSE ROUND(D11.STND_ASC * D11.SYT_EVL_ADVL_VAL * ( D11.DRIVE_RTE_SUM / 100)  * (NVL(D11.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/                           
					         , NVL(D11.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D11.AUD_YR, D11.TSK_NO, D11.AUD_KND_CD)) AS SPE_ADD_SC /*특별가산점*/
					         , NVL(D11.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D11.AUD_YR, D11.TSK_NO, D11.AUD_KND_CD)) AS MDT_ASC /*조정평점*/
					         , D11.MNDY_CNT /*연인원*/
					         , D11.SYT_TRTM_YN /*종합처리안 여부*/
					         , D11.CTB_RTE_SUM /*기여율 SUM*/
					         , D11.EVAL_DPT_CD
					     FROM (
					        SELECT D10.AUD_KND_CD /*감사종류*/
					             , D10.AUD_YR
					             , D10.TSK_NO 
					             , D10.AUD_SBJ_NM /*감사사항명*/
					             , D10.NMPTCPT_CNT /*참여인원*/
					             , D10.STND_ASC /*표준평점*/
					             , D10.SYT_EVL_RK_CD /*평가등급*/
					             , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/  
					             , D10.STND_ASC * D10.SYT_EVL_ADVL_VAL AS ADVL_ASC /*가중평점=표준평점*가중치*/
					             , D10.AUD_STEP_CD_MIN /*단계기초*/
					             , D10.AUD_STEP_CD_MAX  /*단계기말*/
					             , D10.DRIVE_RTE_SUM /*추진율*/
					             , F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
					             , D10.DLY_DT_SUM /*지연일*/
					             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D10.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
					             , D10.MNDY_CNT /*연인원*/
					             , D10.SYT_TRTM_YN /*종합처리안 여부*/
					             , D10.CTB_RTE_SUM /*기여율 SUM*/
					             , D10.SPE_ADD_SC /*특별가산점*/
					             , D10.MDT_ASC /*조정평점*/
					             , D10.EVAL_DPT_CD
					          FROM (
					            SELECT BASE.AUD_KND_CD /*감사종류*/
					                 , BASE.AUD_YR
					                 , BASE.TSK_NO 
					                 , BASE.AUD_SBJ_NM /*감사사항명*/
					                 , ( SELECT COUNT(*) 
					                       FROM TBCSPAOE023M 
					                      WHERE AUD_YR = BASE.AUD_YR 
					                        AND TSK_NO = BASE.TSK_NO 
					                        AND AUD_STEP_CD = BASE.AUD_STEP_CD_MAX 
											]]>
												<isNotEmpty property="strDeptUpCd">
													AND SUBSTR(BLT_DPT_CD, 1, 3) || '000' = #strDeptUpCd#
												</isNotEmpty>
												<isNotEmpty property="strDeptCd">
													AND BLT_DPT_CD = #strDeptCd#
												</isNotEmpty>				
											<![CDATA[					                        
					                    ) AS NMPTCPT_CNT /*참여인원*/
					                 , F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, BASE.AUD_KND_CD, BASE.AUD_STEP_CD_MIN, BASE.AUD_STEP_CD_MAX, BASE.MNDY_CNT, BASE.SYT_TRTM_YN) AS STND_ASC /*표준평점*/
					                 , DECODE(NVL(EVL.EVL_STEP_CD, 'X') , '100', EVL.EVL_RK_CD, '200', EVL.SYT_EVL_RK_CD, 'X', (SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = BASE.AUD_KND_CD AND AUD_STEP_CD = BASE.AUD_STEP_CD_MAX ), 0) AS SYT_EVL_RK_CD /*평가등급*/
					                 , DECODE(NVL(EVL.EVL_STEP_CD, 'X') , '100', D9.IDVT_INDEX_VAL, '200', EVL.SYT_EVL_ADVL_VAL
					                                                                  , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = BASE.AUD_KND_CD 
					                                                                             AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = BASE.AUD_KND_CD AND AUD_STEP_CD = BASE.AUD_STEP_CD_MAX ))
					                                                                  , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/  
					                 , BASE.AUD_STEP_CD_MIN /*단계기초*/
					                 , BASE.AUD_STEP_CD_MAX  /*단계기말*/
					                 , BASE.MNDY_CNT /*연인원*/
					                 , BASE.SYT_TRTM_YN /*종합처리안 여부*/
					                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
					                      FROM TBCSPAOE008D 
					                     WHERE EVL_YR        = #strEvlYr#
					                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
					                       AND TSK_DVSN_CD   = '10000' 
					                       AND AUD_KND_CD    = BASE.AUD_KND_CD   
					                       AND AUD_STEP_CD BETWEEN BASE.AUD_STEP_CD_MIN AND BASE.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/ 
					                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
					                      FROM TBCSPAOE022M
					                     WHERE AUD_YR = BASE.AUD_YR
					                       AND TSK_NO = BASE.TSK_NO
					                       AND AUD_STEP_CD BETWEEN BASE.AUD_STEP_CD_MIN AND BASE.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
					                 , BASE.CTB_RTE_SUM /*기여율 SUM*/
					                 , EVL.SPE_ADD_SC /*특별가산점*/
					                 , EVL.MDT_ASC /*조정평점*/
					                 , BASE.EVAL_DPT_CD
					              FROM (
					                SELECT D3.AUD_KND_CD
					                     , D3.AUD_YR
					                     , D3.TSK_NO
					                     , D3.AUD_SBJ_NM /*감사사항명*/
					                     , D3.AUD_STEP_CD_MIN /*단계기초*/
					                     , D3.AUD_STEP_CD_MAX  /*단계기말*/
					                     , D3.MNDY_CNT /*연인원*/
					                     , D3.SYT_TRTM_YN /*종합처리안 여부*/
					                     , D3.EVAL_DPT_CD
					                     , SUM(D4.CTB_RTE) AS CTB_RTE_SUM /*기여율 SUM*/
					                  FROM (
					                    SELECT D2.AUD_KND_CD
					                         , D2.AUD_YR
					                         , D2.TSK_NO
					                         , D2.AUD_SBJ_NM
					                         , D1.AUD_STEP_CD_MIN
					                         , D1.AUD_STEP_CD_MAX
					                         , D2.MNDY_CNT
					                         , D2.HNDL_DIV_DPT_CD AS EVAL_DPT_CD
					                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
					                      FROM (
					                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
					                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
					                             , AUD_YR
					                             , TSK_NO
					                          FROM TBCSPAOE022M
					                         WHERE CMPT_DT IS NOT NULL
					                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
					                         GROUP BY AUD_YR, TSK_NO
					                        ) D1
					                        , TBCSPAOE021M D2
					                    WHERE D1.AUD_YR = D2.AUD_YR
					                      AND D1.TSK_NO = D2.TSK_NO
					                    ) D3 /*감사사항 조회기준 데이터*/
					                    , TBCSPAOE023M D4 /*참여인원*/
					                WHERE D3.AUD_YR = D4.AUD_YR
					                  AND D3.TSK_NO = D4.TSK_NO
					                  AND D3.AUD_STEP_CD_MAX = D4.AUD_STEP_CD
									]]>
										<isNotEmpty property="strDeptUpCd">
											AND SUBSTR(D4.BLT_DPT_CD, 1, 3) || '000' = #strDeptUpCd#
										</isNotEmpty>
										<isNotEmpty property="strDeptCd">
											AND D4.BLT_DPT_CD = #strDeptCd#
										</isNotEmpty>				
									<![CDATA[			                  
					                GROUP BY D3.AUD_KND_CD, D3.AUD_YR, D3.TSK_NO, D3.AUD_SBJ_NM, D3.AUD_STEP_CD_MIN, D3.AUD_STEP_CD_MAX, D3.MNDY_CNT, D3.SYT_TRTM_YN, D3.EVAL_DPT_CD
					                ) BASE /*조회조건으로 걸러낸 기본 정보들*/
					                , (
					                SELECT D8.AUD_TSK_KND_CD
					                     , D8.AUD_YR
					                     , D8.TSK_NO
					                     , D8.SYT_EVL_ADVL_VAL
					                     , D8.EVL_YR
					                     , D8.HLYR_DVSN_CD
					                     , D8.TSK_DVSN_CD
					                     , D8.EVL_RK_CD
					                     , D8.SYT_EVL_RK_CD
					                     , D8.EVL_STEP_CD
					                     , D8.SPE_ADD_SC
					                     , D8.MDT_ASC
					                   FROM (
					                       SELECT EVL_YR
					                            , HLYR_DVSN_CD 
					                            , AUD_YR
					                            , TSK_NO
					                            , MAX(EVL_STEP_CD) AS EVL_STEP_CD
					                            , AUD_TSK_KND_CD
					                            , TSK_DVSN_CD
					                         FROM TBCSPAOE029M
					                       WHERE 1=1
					                       	  AND (AUD_YR,
                                                            TSK_NO,
                                                            EVL_STEP_CD) IN (SELECT AUD_YR,
                                                            TSK_NO,
                                                            MAX(EVL_STEP_CD)
                                                       FROM TBCSPAOE029M
                                                      WHERE (AUD_YR,
                                                                    TSK_NO) IN (SELECT AUD_YR ,
                                                                    TSK_NO
                                                               FROM TBCSPAOE022M
                                                              WHERE CMPT_DT IS NOT NULL
                                                                AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                              GROUP BY AUD_YR,
                                                                    TSK_NO )
                                                      GROUP BY AUD_YR,
                                                            TSK_NO )
					                          AND TSK_DVSN_CD  = '10000'
					                          AND EVL_STA_CD   = '300' /*평가완료*/
					                        GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
					                 ) D7
					                 , TBCSPAOE029M D8
					                WHERE D7.EVL_YR = D8.EVL_YR
					                  AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
					                  AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
					                  AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
					                  AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
					                  AND D7.AUD_YR = D8.AUD_YR
					                  AND D7.TSK_NO = D8.TSK_NO	                                          
					                ) EVL /*평가받은 아이들의 점수들*/
					                , TBCSPAOE010D D9
					            WHERE BASE.AUD_KND_CD    = EVL.AUD_TSK_KND_CD (+) /*평가받지 않은 감사사항들도 조회되야 한다.*/
					              AND BASE.AUD_YR        = EVL.AUD_YR         (+)
					              AND BASE.TSK_NO        = EVL.TSK_NO         (+)
					              AND EVL.EVL_YR         = D9.EVL_YR          (+)
					              AND EVL.HLYR_DVSN_CD   = D9.HLYR_DVSN_CD    (+)
					              AND EVL.TSK_DVSN_CD    = D9.TSK_DVSN_CD     (+)
					              AND EVL.AUD_TSK_KND_CD = D9.AUD_TSK_KND_CD  (+)
					              AND EVL.EVL_RK_CD      = D9.RK_CD           (+)
					          ) D10
					      ) D11
				      ) D13
				  ) D12
				  
				UNION ALL
				
				SELECT F_CODE_NM('1000272', BASE.TSK_KND_CD) AS AUD_KND_NM /*감사종류*/
				     , BASE.TSK_NM                           AS AUD_SBJ_NM /*업무명*/
				     , ( SELECT COUNT(PTCPT_CNB) 
				           FROM TBCSPAOE025M 
				          WHERE EVL_YR = BASE.EVL_YR 
				            AND HLYR_DVSN_CD = BASE.HLYR_DVSN_CD
				            AND TSK_KND_CD = BASE.TSK_KND_CD
				            AND TSK_NO = BASE.TSK_NO
						]]>
							<isNotEmpty property="strDeptUpCd">
								AND SUBSTR(CHR_DPT_CD, 1, 3) || '000' = #strDeptUpCd#
							</isNotEmpty>
							<isNotEmpty property="strDeptCd">
								AND CHR_DPT_CD = #strDeptCd#
							</isNotEmpty>				
						<![CDATA[			            
				        )                                    AS PTCPT_CNB_CNT  /*참여인원*/
				     , D3.STND_ASC /*표준평점*/
				     , F_CODE_NM('1000274', EVL.EVL_RK_CD)   AS SYT_EVL_RK_CD /*평가등급*/
				     , EVL.IDVT_INDEX_VAL                    AS SYT_EVL_ADVL_VAL /*가중치*/ 
				     , D3.STND_ASC * EVL.IDVT_INDEX_VAL      AS ADVL_ASC /*가중평점*/
				     , '' AS TSK_ST_STEP_NM
				     , '' AS TSK_END_STEP_NM
				     , 0 AS DRIVE_RTE
				     , 0 AS DRIVE_RTE_ASC
				     , 0 AS DLAY_DT_NM_SUM
				     , '' AS ASP_RTE
				     , 0 AS ASP_ASC
				     , 0 AS SPE_ADD_SC
				     , D3.STND_ASC * EVL.IDVT_INDEX_VAL    AS TSK_ASC /*업무평점*/
				     , BASE.CTB_RTE_SUM /*기여율 합*/
				     , ROUND(D3.STND_ASC * EVL.IDVT_INDEX_VAL * (BASE.CTB_RTE_SUM/100), 2) AS DPT_ASC_ALL /*부서평점*/
				     , '10001' AS TSK_DVSN_CD
				     , BASE.EVAL_DPT_CD
				  FROM (
				    SELECT D2.EVL_YR
				         , D2.HLYR_DVSN_CD
				         , D2.TSK_KND_CD
				         , D2.TSK_NO
				         , D2.TSK_NM
				         , D1.CTB_RTE_SUM
				         , D2.CHR_DPT_CD AS EVAL_DPT_CD
				      FROM (
				        SELECT EVL_YR
				             , HLYR_DVSN_CD
				             , TSK_KND_CD
				             , TSK_NO
				             , SUM(CTB_RTE) AS CTB_RTE_SUM /*기여율*/
				          FROM TBCSPAOE025M
				         WHERE EVL_YR = #strEvlYr#
				           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
							]]>
								<isNotEmpty property="strDeptUpCd">
									AND SUBSTR(CHR_DPT_CD, 1, 3) || '000' = #strDeptUpCd#
								</isNotEmpty>
								<isNotEmpty property="strDeptCd">
									AND CHR_DPT_CD = #strDeptCd#
								</isNotEmpty>				
							<![CDATA[			           
				         GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_KND_CD, TSK_NO
				        ) D1
				        , TBCSPAOE024M D2
				    WHERE D1.EVL_YR = D2.EVL_YR
				      AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
				      AND D1.TSK_KND_CD = D2.TSK_KND_CD
				      AND D1.TSK_NO = D2.TSK_NO
				    ) BASE /*조회될 기준일 될 데이터*/
				    , TBCSPAOE006M D3 /*표준평점*/
				    , (
					    SELECT D4.EVL_YR
					         , D4.HLYR_DVSN_CD
					         , D4.AUD_TSK_KND_CD
					         , D4.TSK_NO
					         , D4.EVL_RK_CD /*평가등급*/
					         , D4.NAUD_TSK_EVL_SC /*업무평점*/
					         , D5.IDVT_INDEX_VAL /*가중치*/
					      FROM TBCSPAOE029M D4
					         , TBCSPAOE010D D5
					     WHERE D4.EVL_YR = D5.EVL_YR
					       AND D4.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
					       AND D4.TSK_DVSN_CD = D5.TSK_DVSN_CD
					       AND D4.AUD_TSK_KND_CD = D5.AUD_TSK_KND_CD
					       AND D4.EVL_RK_CD = D5.RK_CD
					       AND D4.EVL_YR = #strEvlYr#
					       AND D4.HLYR_DVSN_CD = #strHlyrDvsnCd#
					       AND D4.TSK_DVSN_CD = '10001'
					       AND D4.EVL_STEP_CD = '600'
					    ) EVL
				WHERE BASE.EVL_YR = D3.EVL_YR
				  AND BASE.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
				  AND D3.TSK_DVSN_CD = '10001'
				  AND BASE.TSK_KND_CD = D3.TSK_KND_CD
				  AND BASE.EVL_YR = EVL.EVL_YR
				  AND BASE.HLYR_DVSN_CD = EVL.HLYR_DVSN_CD
				  AND BASE.TSK_KND_CD = EVL.AUD_TSK_KND_CD
				  AND BASE.TSK_NO = EVL.TSK_NO
				) 
			ORDER BY TSK_DVSN_CD, DPT_ASC_ALL DESC
		    ]]>
	</select>

	<!-- ################################ 부서별 입무실적 명세 끝 (CSPAOE063Q) ##################################### -->


	<!-- ################################ 부서별 업무실적 총괄조정 시작 (CSPAOE062Q) ################################ -->
	<!-- 전체국실적총점(전체과 실적총점) 구하기 -->
	<select id="CSPAOE062QAllDptSumselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
           SELECT TO_CHAR(SUM(SUMSU.TSK_ASC_SUM)) AS TSK_ASC_SUM
             FROM (
                SELECT EVL_YR
                     , HLYR_DVSN_CD
                     , HIRK_DPT_CD /*평가할때 상위 부서코드*/
                     , NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) + NVL(SUM(PSN_TSK_ASC_5), 0) + NVL(SUM(PSN_TSK_ASC_6), 0) + NVL(SUM(PSN_TSK_ASC_7), 0) + NVL(SUM(PSN_TSK_ASC_8), 0) + NVL(SUM(PSN_TSK_ASC_9), 0) AS TSK_ASC_SUM
                 FROM (
            SELECT D22.EVL_YR
                , D22.HLYR_DVSN_CD
                , NVL(D24.HIRK_DPT_CD, D22.DPT_CD) AS HIRK_DPT_CD /*평가할때 상위 부서코드*/
                , D22.PSN_TSK_ASC_1
                , D22.PSN_TSK_ASC_2 /*모니터링*/
                , D22.PSN_TSK_ASC_3 /*결산업무*/
                , D22.PSN_TSK_ASC_4 /*연보업무*/
                , D22.PSN_TSK_ASC_5 /*총괄업무*/
                , D22.PSN_TSK_ASC_6 /*집행전말*/
                , D22.PSN_TSK_ASC_7 /*기타업무*/
                , D22.PSN_TSK_ASC_8 /*성과보고서*/
                , D22.PSN_TSK_ASC_9 /*법령모니터링*/ 
               FROM (                     
                     SELECT EVL_YR
                          , HLYR_DVSN_CD
                          , DPT_CD AS DPT_CD /*평가할때 부서코드*/
                          , 0 AS PSN_TSK_ASC_1
                          , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
                          , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 2 AND 3 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*결산업무*/
                          , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 4 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*연보업무*/
                          , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_5 /*총괄업무*/
                          , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_6 /*집행전말*/
                          , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 94 AND 96) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_7 /*기타업무*/
                          , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 13 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_8 /*성과보고서*/
                          , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 7 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_9 /*법령모니터링*/
                       FROM TBCSPAOE035M 
                      WHERE EVL_YR       = #strEvlYr#
                        AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                        AND TSK_DVSN_CD  = '10001'	               
                       
                      UNION ALL    
         
                     SELECT #strEvlYr# AS EVL_YR
                          , #strHlyrDvsnCd#  AS HLYR_DVSN_CD  
                          , DPT_CD AS DPT_CD /*평가할때 부서코드*/
                          , ROUND((STND_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 /*개인평점*/
                          , 0 AS PSN_TSK_ASC_2 /*모니터링*/
                          , 0 AS PSN_TSK_ASC_3 /*결산업무*/
                          , 0 AS PSN_TSK_ASC_4 /*연보업무*/
                          , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
                          , 0 AS PSN_TSK_ASC_6 /*집행전말*/
                          , 0 AS PSN_TSK_ASC_7 /*기타업무*/
                          , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
                          , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/
                       FROM (
                SELECT D20.PTCPT_CNB  
                     , D20.DRIVE_RTE_ASC /*추진율 조정평점*/
                     , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/  
                     , D20.CTB_RTE
                     , D20.DPT_CD
                     , D20.SPE_ADD_SC
                     , D20.MDT_ASC
                     , D20.STND_ASC
                 FROM (                          
                          SELECT D19.PTCPT_CNB  
                               , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
                               , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
                                      ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
                               , D19.CTB_RTE
                               , D19.DPT_CD
                               , D19.AUD_KND_CD
                            , D19.AUD_STEP_CD_MAX
                            , D19.DLY_DT_SUM
                            , D19.SYT_EVL_ADVL_VAL
                            , D19.SPE_ADD_SC
                            , D19.MDT_ASC
                            , D19.AUD_YR
                            , D19.TSK_NO
                            , D19.STND_ASC
                           FROM (
                              SELECT D11.PTCPT_CNB
                                   , D10.STND_ASC /*표준평점*/
                                   , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
                                   , D10.DRIVE_RTE_SUM  /*추진율*/      
                                   , ( SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
                                   , D10.DLY_DT_SUM /*지연일*/
                                   , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
                                   , D11.CTB_RTE
                                   , D11.BLT_DPT_CD AS DPT_CD
                                   , D10.AUD_KND_CD
                             	   , D10.AUD_STEP_CD_MAX
                             	   , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
                                   , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
                                   , D10.AUD_YR
                                   , D10.TSK_NO
                               FROM (
                                  SELECT AUD_KND_CD
                                       , AUD_YR
                                       , TSK_NO
                                       , AUD_STEP_CD_MIN
                                       , AUD_STEP_CD_MAX
                                       , MNDY_CNT
                                       , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
                                       , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
                                       , DRIVE_RTE_SUM  /*추진율*/      
                                       , DLY_DT_SUM /*지연일*/
                                       , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
                                       , EVL_YR
                                       , HLYR_DVSN_CD
                                       , SYT_TRTM_YN
                                       , SPE_ADD_SC
                                       , MDT_ASC
                                    FROM (
                                      SELECT D5.AUD_KND_CD
                                           , D5.AUD_YR
                                           , D5.TSK_NO
                                           , D5.AUD_STEP_CD_MIN
                                           , D5.AUD_STEP_CD_MAX
                                           , D5.MNDY_CNT
                                           , (SELECT F_AOE_STND_ASC(D6.EVL_YR, D6.HLYR_DVSN_CD, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
                                           , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
                                                                         , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
                                                                                  AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
                                                                         , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
                                           , (SELECT NVL(SUM(DRIVE_RTE), 0) 
                                                FROM TBCSPAOE008D 
                                               WHERE EVL_YR        = #strEvlYr#
                                                 AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
                                                 AND TSK_DVSN_CD   = '10000' 
                                                 AND AUD_KND_CD    = D5.AUD_KND_CD   
                                                 AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
                                           , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
                                                FROM TBCSPAOE022M
                                               WHERE AUD_YR = D5.AUD_YR
                                                 AND TSK_NO = D5.TSK_NO
                                                 AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
                                           , D6.EVL_YR
                                           , D6.HLYR_DVSN_CD
                                           , D5.SYT_TRTM_YN
                                           , D6.SPE_ADD_SC
                                        , D6.MDT_ASC
                                       FROM (
                                              SELECT D2.HNDL_DIV_DPT_CD
                                                   , D2.SPVR_CNB
                                                   , D2.AUD_KND_CD
                                                   , D2.AUD_YR
                                                   , D2.TSK_NO
                                                   , D2.AUD_SBJ_NM
                                                   , D1.AUD_STEP_CD_MIN
                                                   , D1.AUD_STEP_CD_MAX
                                                   , D2.MNDY_CNT
                                                   , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
                                                FROM (
                                                  SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                                                       , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                                       , AUD_YR
                                                       , TSK_NO
                                                    FROM TBCSPAOE022M
                                                   WHERE CMPT_DT IS NOT NULL
                                                     AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                   GROUP BY AUD_YR, TSK_NO
                                               ) D1
                                               , TBCSPAOE021M D2
                                           WHERE D1.AUD_YR = D2.AUD_YR
                                             AND D1.TSK_NO = D2.TSK_NO
                                            ) D5 /*평가대상 감사활동 - 기준*/
                                            , (
                                              SELECT D8.AUD_TSK_KND_CD
                                                   , D8.AUD_YR
                                                   , D8.TSK_NO
                                                   , D8.SYT_EVL_ADVL_VAL
                                                   , D8.EVL_YR
                                                   , D8.HLYR_DVSN_CD
                                                   , D8.TSK_DVSN_CD
                                                   , D8.EVL_RK_CD
                                                   , D8.SYT_EVL_RK_CD
                                                   , D8.EVL_STEP_CD
                                                   , D8.SPE_ADD_SC
                                                   , D8.MDT_ASC
                                                 FROM (
                                                     SELECT EVL_YR
                                                          , HLYR_DVSN_CD 
                                                          , AUD_YR
                                                          , TSK_NO
                                                          , MAX(EVL_STEP_CD) AS EVL_STEP_CD
                                                          , AUD_TSK_KND_CD
                                                          , TSK_DVSN_CD
                                                       FROM TBCSPAOE029M
                                                     WHERE 1=1
                                                     AND (AUD_YR,
                                                                                       TSK_NO,
                                                                                       EVL_STEP_CD) IN (SELECT AUD_YR,
                                                                                       TSK_NO,
                                                                                       MAX(EVL_STEP_CD)
                                                                                  FROM TBCSPAOE029M
                                                                                 WHERE (AUD_YR,
                                                                                               TSK_NO) IN (SELECT AUD_YR ,
                                                                                               TSK_NO
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE CMPT_DT IS NOT NULL
                                                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                                                         GROUP BY AUD_YR,
                                                                                               TSK_NO )
                                                                                 GROUP BY AUD_YR,
                                                                                       TSK_NO )
                                                        AND TSK_DVSN_CD  = '10000'
                                                        AND EVL_STA_CD   = '300' /*평가완료*/
                                                      GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
                                               ) D7
                                               , TBCSPAOE029M D8
                                              WHERE D7.EVL_YR = D8.EVL_YR
                                                AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
                                                AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
                                                AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
                                                AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
                                                AND D7.AUD_YR = D8.AUD_YR
                                                AND D7.TSK_NO = D8.TSK_NO	                                          
                                          ) D6 /*감사사항 평가관리*/
                                          , TBCSPAOE010D D7
                                      WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
                                        AND D5.AUD_YR          = D6.AUD_YR         (+)
                                        AND D5.TSK_NO          = D6.TSK_NO         (+)
                                        AND D6.EVL_YR = D7.EVL_YR (+) 
                                        AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
                                        AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
                                        AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
                                        AND D6.EVL_RK_CD = D7.RK_CD (+)		  
                                    ) D9
                                ) D10
                                , TBCSPAOE023M D11
                           WHERE D10.AUD_YR = D11.AUD_YR
                             AND D10.TSK_NO = D11.TSK_NO
                             AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
                             AND D11.CTB_RTE != 0	                   
                         ) D19
                        ) D20
                     ) D21
                    ) D22
              , (
                
                   SELECT DPT_CD
														 FROM TBDCMACM002M
														WHERE DPT_TP_CD = 'A'
														 /*감사부서만 나온다*/                  
              ) D23
              , TBDCMACM002M D24	
          WHERE D22.DPT_CD = D23.DPT_CD
            AND D22.DPT_CD = D24.DPT_CD                          
                ) 
               GROUP BY EVL_YR, HLYR_DVSN_CD, HIRK_DPT_CD
             ) SUMSU
             , (
                 SELECT HIRK_DPT_CD
                      , SUM(DPT_CNT) AS DEPT_CNT
                   FROM (
                     SELECT NVL(DPT.HIRK_DPT_CD, BASE.DPT_CD) AS HIRK_DPT_CD
                          , BASE.DPT_CNT AS DPT_CNT
                       FROM (
                         SELECT DTP_CD.DPT_CD
                              , NVL(AOD_DPT_CNT.DEPT_CNT, 0) AS DPT_CNT
                           FROM (
                         SELECT DPT_CD
                           FROM TBCSPAOE034M
                        WHERE EVL_YR = #strEvlYr#
                          AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                          AND DPT_TYP_DVSN_CD = '10'	                              
                           UNION  
                          SELECT DPT_CD 
                           FROM TBDCMACM002M
                        WHERE USE_YN = 'Y' 
                          AND DPT_TP_CD = 'A'	/*감사부서*/
                          AND SUBSTR(DPT_CD,1,1) < '2'
                          AND SUBSTR(DPT_CD,4,3) <>'000'	                              
                           ) DTP_CD
                           , (
                             SELECT COUNT(CNB) AS DEPT_CNT
                                  , DPT_CD
                               FROM TBDCMACM001M
                               WHERE NVL(BAI_USR_YN, 'N') = 'Y'   
                               GROUP BY DPT_CD
                           ) DPT_CNT
                           , (
                             SELECT DPT_NOP_CNT AS DEPT_CNT
                                  , DPT_CD
                               FROM TBCSPAOE034M
                              WHERE EVL_YR       = #strEvlYr#
                                AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                           ) AOD_DPT_CNT
                         WHERE DTP_CD.DPT_CD = DPT_CNT.DPT_CD  (+)
                           AND DTP_CD.DPT_CD = AOD_DPT_CNT.DPT_CD (+)
                       ) BASE
                       , TBDCMACM002M DPT
                     WHERE BASE.DPT_CD = DPT.DPT_CD
                 )
                 GROUP BY HIRK_DPT_CD /*34TL에 부서인원수가 들어가있지 않을경우 인사테이블에서 건수를 가져와야 하고, 폐지된 부서도 가져와야 하기 때문에 지저분하지만 이런식으로 쿼리를 작성*/	
            ) DPTCNT
       WHERE SUMSU.HIRK_DPT_CD = DPTCNT.HIRK_DPT_CD    
		]]>
	</select>
	
	<!-- 전체국 1인당 평점 총점을 구한다. -->
	<select id="CSPAOE062QUpDptPsnTskAscSumselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
                SELECT TO_CHAR(SUM(ROUND(SUMSU.TSK_ASC_SUM / DPTCNT.DEPT_CNT, 2))) AS PSN_TSK_ASC_AVG_SUM /*1인당평점의 합*/
                 FROM (
                    SELECT EVL_YR
                         , HLYR_DVSN_CD
                         , HIRK_DPT_CD /*평가할때 상위 부서코드*/
                         , NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) + NVL(SUM(PSN_TSK_ASC_5), 0) + NVL(SUM(PSN_TSK_ASC_6), 0) + NVL(SUM(PSN_TSK_ASC_7), 0) + NVL(SUM(PSN_TSK_ASC_8), 0) + NVL(SUM(PSN_TSK_ASC_9), 0) AS TSK_ASC_SUM
                     FROM (
		 	            SELECT D22.EVL_YR
			                 , D22.HLYR_DVSN_CD
			                 , NVL(D24.HIRK_DPT_CD, D22.DPT_CD) AS HIRK_DPT_CD /*평가할때 상위 부서코드*/
			                 , D22.PSN_TSK_ASC_1
			                 , D22.PSN_TSK_ASC_2 /*모니터링*/
			                 , D22.PSN_TSK_ASC_3 /*결산업무*/
			                 , D22.PSN_TSK_ASC_4 /*연보업무*/
			                 , D22.PSN_TSK_ASC_5 /*총괄업무*/
			                 , D22.PSN_TSK_ASC_6 /*집행전말*/
			                 , D22.PSN_TSK_ASC_7 /*기타업무*/
			                 , D22.PSN_TSK_ASC_8 /*성과보고서*/
			                 , D22.PSN_TSK_ASC_9 /*법령모니터링*/ 
		                 FROM (                     
	                        SELECT EVL_YR
	                             , HLYR_DVSN_CD
	                             , DPT_CD AS DPT_CD /*평가할때 부서코드*/
	                             , 0 AS PSN_TSK_ASC_1
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 2 AND 3 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*결산업무*/
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 4 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*연보업무*/
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_5 /*총괄업무*/
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_6 /*집행전말*/
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 94 AND 96) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_7 /*기타업무*/
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 13 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_8 /*성과보고서*/
	                             , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 7 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_9 /*법령모니터링*/
	                          FROM TBCSPAOE035M 
	                         WHERE EVL_YR       = #strEvlYr#
	                           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
	                           AND TSK_DVSN_CD  = '10001'	               
	                          
	                         UNION ALL    
	            
	                        SELECT #strEvlYr# AS EVL_YR
	                             , #strHlyrDvsnCd#  AS HLYR_DVSN_CD  
	                             , DPT_CD AS DPT_CD /*평가할때 부서코드*/
	                             , ROUND((STND_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 /*개인평점*/
	                             , 0 AS PSN_TSK_ASC_2 /*모니터링*/
	                             , 0 AS PSN_TSK_ASC_3 /*결산업무*/
	                             , 0 AS PSN_TSK_ASC_4 /*연보업무*/
	                             , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
	                             , 0 AS PSN_TSK_ASC_6 /*집행전말*/
	                             , 0 AS PSN_TSK_ASC_7 /*기타업무*/
	                             , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
	                             , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/
	                          FROM (
				                SELECT D20.PTCPT_CNB  
				                     , D20.DRIVE_RTE_ASC /*추진율 조정평점*/
				                     , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/  
				                     , D20.CTB_RTE
				                     , D20.DPT_CD
				                     , D20.SPE_ADD_SC
			                         , D20.MDT_ASC
			                         , D20.STND_ASC
				                 FROM (                          
		                            SELECT D19.PTCPT_CNB  
		                                 , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
		                                 , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
		                                        ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
		                                 , D19.CTB_RTE
		                                 , D19.DPT_CD
		                                 , D19.AUD_KND_CD
			                             , D19.AUD_STEP_CD_MAX
			                             , D19.DLY_DT_SUM
			                             , D19.SYT_EVL_ADVL_VAL
			                             , D19.SPE_ADD_SC
			                             , D19.MDT_ASC
			                             , D19.AUD_YR
			                             , D19.TSK_NO
			                             , D19.STND_ASC
		                             FROM (
		                                SELECT D11.PTCPT_CNB
		                                     , D10.STND_ASC /*표준평점*/
		                                     , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
		                                     , D10.DRIVE_RTE_SUM  /*추진율*/      
		                                     , ( SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
		                                     , D10.DLY_DT_SUM /*지연일*/
		                                     , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
		                                     , D11.CTB_RTE
		                                     , D11.BLT_DPT_CD AS DPT_CD
		                                     , D10.AUD_KND_CD
	                                		 , D10.AUD_STEP_CD_MAX
	                                		 , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
			                                 , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
			                                 , D10.AUD_YR
			                                 , D10.TSK_NO
		                                 FROM (
		                                    SELECT AUD_KND_CD
		                                         , AUD_YR
		                                         , TSK_NO
		                                         , AUD_STEP_CD_MIN
		                                         , AUD_STEP_CD_MAX
		                                         , MNDY_CNT
		                                         , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
		                                         , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
		                                         , DRIVE_RTE_SUM  /*추진율*/      
		                                         , DLY_DT_SUM /*지연일*/
		                                         , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
		                                         , EVL_YR
		                                         , HLYR_DVSN_CD
		                                         , SYT_TRTM_YN
		                                         , SPE_ADD_SC
			                                     , MDT_ASC
		                                      FROM (
		                                        SELECT D5.AUD_KND_CD
		                                             , D5.AUD_YR
		                                             , D5.TSK_NO
		                                             , D5.AUD_STEP_CD_MIN
		                                             , D5.AUD_STEP_CD_MAX
		                                             , D5.MNDY_CNT
		                                             , (SELECT F_AOE_STND_ASC(D6.EVL_YR, D6.HLYR_DVSN_CD, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
		                                             , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
	                                                                            , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
	                                                                                     AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
	                                                                            , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
		                                             , (SELECT NVL(SUM(DRIVE_RTE), 0) 
		                                                  FROM TBCSPAOE008D 
		                                                 WHERE EVL_YR        = #strEvlYr#
		                                                   AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
		                                                   AND TSK_DVSN_CD   = '10000' 
		                                                   AND AUD_KND_CD    = D5.AUD_KND_CD   
		                                                   AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
		                                             , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
		                                                  FROM TBCSPAOE022M
		                                                 WHERE AUD_YR = D5.AUD_YR
		                                                   AND TSK_NO = D5.TSK_NO
		                                                   AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
		                                             , D6.EVL_YR
		                                             , D6.HLYR_DVSN_CD
		                                             , D5.SYT_TRTM_YN
		                                             , D6.SPE_ADD_SC
			                                         , D6.MDT_ASC
		                                         FROM (
		                                                SELECT D2.HNDL_DIV_DPT_CD
		                                                     , D2.SPVR_CNB
		                                                     , D2.AUD_KND_CD
		                                                     , D2.AUD_YR
		                                                     , D2.TSK_NO
		                                                     , D2.AUD_SBJ_NM
		                                                     , D1.AUD_STEP_CD_MIN
		                                                     , D1.AUD_STEP_CD_MAX
		                                                     , D2.MNDY_CNT
		                                                     , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
		                                                  FROM (
		                                                    SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
		                                                         , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
		                                                         , AUD_YR
		                                                         , TSK_NO
		                                                      FROM TBCSPAOE022M
		                                                     WHERE CMPT_DT IS NOT NULL
		                                                       AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
		                                                     GROUP BY AUD_YR, TSK_NO
		                                                 ) D1
		                                                 , TBCSPAOE021M D2
		                                             WHERE D1.AUD_YR = D2.AUD_YR
		                                               AND D1.TSK_NO = D2.TSK_NO
		                                              ) D5 /*평가대상 감사활동 - 기준*/
		                                              , (
		                                                SELECT D8.AUD_TSK_KND_CD
		                                                     , D8.AUD_YR
		                                                     , D8.TSK_NO
		                                                     , D8.SYT_EVL_ADVL_VAL
		                                                     , D8.EVL_YR
		                                                     , D8.HLYR_DVSN_CD
		                                                     , D8.TSK_DVSN_CD
		                                                     , D8.EVL_RK_CD
		                                                     , D8.SYT_EVL_RK_CD
		                                                     , D8.EVL_STEP_CD
		                                                     , D8.SPE_ADD_SC
		                                                     , D8.MDT_ASC
		                                                   FROM (
		                                                       SELECT EVL_YR
		                                                            , HLYR_DVSN_CD 
		                                                            , AUD_YR
		                                                            , TSK_NO
		                                                            , MAX(EVL_STEP_CD) AS EVL_STEP_CD
		                                                            , AUD_TSK_KND_CD
		                                                            , TSK_DVSN_CD
		                                                         FROM TBCSPAOE029M
		                                                       WHERE 1=1
		                                                       AND (AUD_YR,
                                                                                       TSK_NO,
                                                                                       EVL_STEP_CD) IN (SELECT AUD_YR,
                                                                                       TSK_NO,
                                                                                       MAX(EVL_STEP_CD)
                                                                                  FROM TBCSPAOE029M
                                                                                 WHERE (AUD_YR,
                                                                                               TSK_NO) IN (SELECT AUD_YR ,
                                                                                               TSK_NO
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE CMPT_DT IS NOT NULL
                                                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                                                         GROUP BY AUD_YR,
                                                                                               TSK_NO )
                                                                                 GROUP BY AUD_YR,
                                                                                       TSK_NO )
		                                                          AND TSK_DVSN_CD  = '10000'
		                                                          AND EVL_STA_CD   = '300' /*평가완료*/
		                                                        GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
		                                                 ) D7
		                                                 , TBCSPAOE029M D8
		                                                WHERE D7.EVL_YR = D8.EVL_YR
		                                                  AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
		                                                  AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
		                                                  AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
		                                                  AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
		                                                  AND D7.AUD_YR = D8.AUD_YR
		                                                  AND D7.TSK_NO = D8.TSK_NO	                                          
		                                            ) D6 /*감사사항 평가관리*/
		                                            , TBCSPAOE010D D7
		                                        WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
		                                          AND D5.AUD_YR          = D6.AUD_YR         (+)
		                                          AND D5.TSK_NO          = D6.TSK_NO         (+)
		                                          AND D6.EVL_YR = D7.EVL_YR (+) 
		                                          AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
		                                          AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
		                                          AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
		                                          AND D6.EVL_RK_CD = D7.RK_CD (+)		  
		                                      ) D9
		                                  ) D10
		                                  , TBCSPAOE023M D11
		                             WHERE D10.AUD_YR = D11.AUD_YR
		                               AND D10.TSK_NO = D11.TSK_NO
		                               AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
		                               AND D11.CTB_RTE != 0	                   
		                           ) D19
	                           ) D20
	                        ) D21
                        ) D22
		                , (
		                SELECT DPT_CD
														 FROM TBDCMACM002M
														WHERE  DPT_TP_CD = 'A'  /*감사부서만 나온다*/
														
		                ) D23
		                , TBDCMACM002M D24	
		            WHERE D22.DPT_CD = D23.DPT_CD
		              AND D22.DPT_CD = D24.DPT_CD                          
                    ) 
                   GROUP BY EVL_YR, HLYR_DVSN_CD, HIRK_DPT_CD
                 ) SUMSU
                 , (
	                    SELECT HIRK_DPT_CD
	                         , SUM(DPT_CNT) AS DEPT_CNT
	                      FROM (
	                        SELECT NVL(DPT.HIRK_DPT_CD, BASE.DPT_CD) AS HIRK_DPT_CD
	                             , BASE.DPT_CNT AS DPT_CNT
	                          FROM (
	                            SELECT DTP_CD.DPT_CD
	                                 , NVL(AOD_DPT_CNT.DEPT_CNT, 0) AS DPT_CNT
	                              FROM (
	                            SELECT DPT_CD
	                              FROM TBCSPAOE034M
		                          WHERE EVL_YR = #strEvlYr#
		                            AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		                            AND DPT_TYP_DVSN_CD = '10'	                              
	                              UNION  
	                             SELECT DPT_CD 
	                              FROM TBDCMACM002M
		                          WHERE USE_YN = 'Y' 
		                            AND DPT_TP_CD = 'A'	/*감사부서*/
		                            AND SUBSTR(DPT_CD,1,1) < '2'
		                            AND SUBSTR(DPT_CD,4,3) <>'000'	                              
	                              ) DTP_CD
	                              , (
	                                SELECT COUNT(CNB) AS DEPT_CNT
	                                     , DPT_CD
	                                  FROM TBDCMACM001M
	                                  WHERE NVL(BAI_USR_YN, 'N') = 'Y'   
	                                  GROUP BY DPT_CD
	                              ) DPT_CNT
	                              , (
	                                SELECT DPT_NOP_CNT AS DEPT_CNT
	                                     , DPT_CD
	                                  FROM TBCSPAOE034M
	                                 WHERE EVL_YR       = #strEvlYr#
	                                   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
	                              ) AOD_DPT_CNT
	                            WHERE DTP_CD.DPT_CD = DPT_CNT.DPT_CD  (+)
	                              AND DTP_CD.DPT_CD = AOD_DPT_CNT.DPT_CD (+)
	                          ) BASE
	                          , TBDCMACM002M DPT
	                        WHERE BASE.DPT_CD = DPT.DPT_CD
	                    )
	                    GROUP BY HIRK_DPT_CD /*34TL에 부서인원수가 들어가있지 않을경우 인사테이블에서 건수를 가져와야 하고, 폐지된 부서도 가져와야 하기 때문에 지저분하지만 이런식으로 쿼리를 작성*/	
                ) DPTCNT
           WHERE SUMSU.HIRK_DPT_CD = DPTCNT.HIRK_DPT_CD      
		]]>
	</select>
		
	<!-- 국/단별 -->
	<select id="CSPAOE062QUpmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
                SELECT F_DPT_INFO(HIRK_DPT_CD, '1') AS DPT_NM /*부서명*/
                     , ROUND(#strAllDptSum# * ((TSK_ASC_SUM/ TO_NUMBER(#strAllDptSum#)) * (#strSumRate# / 100) + (PSN_TSK_ASC_SUM/TO_NUMBER(#strPsnTskAscAvgSum#)) * (#strPsnAvgRate# / 100)), 2)  AS RTE_ASC /*조정평점*/
                     , PSN_TSK_ASC_SUM AS PSN_TSK_ASC_SUM /*1인당평점*/
                     , TSK_ASC_SUM AS TSK_ASC_SUM /*실적합계*/
                     , DEPT_CNT /*부서인원*/
                     , PSN_TSK_ASC_1 AS TSK_ASC_1 /*감사활동*/
                     , PSN_TSK_ASC_2 AS TSK_ASC_2 /*모니터링*/
                     , PSN_TSK_ASC_3 AS TSK_ASC_3 /*결산업무*/
                     , PSN_TSK_ASC_4 AS TSK_ASC_4 /*연보업무*/
                     , PSN_TSK_ASC_5 AS TSK_ASC_5 /*총괄업무*/
                     , PSN_TSK_ASC_6 AS TSK_ASC_6 /*집행전말*/
                     , PSN_TSK_ASC_7 AS TSK_ASC_7 /*기타업무*/
                     , PSN_TSK_ASC_8 AS TSK_ASC_8 /*성과보고서*/
                     , PSN_TSK_ASC_9 AS TSK_ASC_9 /*법령모니터링*/
                     , TO_NUMBER(#strAllDptSum#) AS TSK_ASC_SUM_ALL /*전체국 실적 총점*/
                     , TO_NUMBER(#strPsnTskAscAvgSum#) AS ALL_TSK_ASC_SUM /*전체국 1일당 총점 합계*/
                 FROM (
                    SELECT SUMSU.EVL_YR
                         , SUMSU.HLYR_DVSN_CD
                         , SUMSU.HIRK_DPT_CD /*평가할때 상위 부서코드*/
                         , ROUND(SUMSU.TSK_ASC_SUM / DPTCNT.DEPT_CNT, 2) AS PSN_TSK_ASC_SUM /*1인당평점*/
                         , SUMSU.TSK_ASC_SUM /*실적합계*/
                         , DPTCNT.DEPT_CNT /*부서인원*/
                         , SUMSU.PSN_TSK_ASC_1  /*감사활동*/
                         , SUMSU.PSN_TSK_ASC_2 /*모니터링*/
                         , SUMSU.PSN_TSK_ASC_3 /*결산업무*/
                         , SUMSU.PSN_TSK_ASC_4 /*연보업무*/
                         , SUMSU.PSN_TSK_ASC_5 /*총괄업무*/
                         , SUMSU.PSN_TSK_ASC_6 /*집행전말*/
                         , SUMSU.PSN_TSK_ASC_7 /*기타업무*/
                         , SUMSU.PSN_TSK_ASC_8 /*성과보고서*/
                         , SUMSU.PSN_TSK_ASC_9 /*법령모니터링*/
                     FROM (
                        SELECT EVL_YR
                             , HLYR_DVSN_CD
                             , HIRK_DPT_CD /*평가할때 상위 부서코드*/
                             , NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) + NVL(SUM(PSN_TSK_ASC_5), 0) + NVL(SUM(PSN_TSK_ASC_6), 0) + NVL(SUM(PSN_TSK_ASC_7), 0) + NVL(SUM(PSN_TSK_ASC_8), 0) + NVL(SUM(PSN_TSK_ASC_9), 0) AS TSK_ASC_SUM
                             , NVL(SUM(PSN_TSK_ASC_1), 0)   AS PSN_TSK_ASC_1  /*감사활동*/
                             , NVL(SUM(PSN_TSK_ASC_2), 0)   AS PSN_TSK_ASC_2 /*모니터링*/
                             , NVL(SUM(PSN_TSK_ASC_3), 0)   AS PSN_TSK_ASC_3 /*결산업무*/
                             , NVL(SUM(PSN_TSK_ASC_4), 0)   AS PSN_TSK_ASC_4 /*연보업무*/
                             , NVL(SUM(PSN_TSK_ASC_5), 0)   AS PSN_TSK_ASC_5 /*총괄업무*/
                             , NVL(SUM(PSN_TSK_ASC_6), 0)   AS PSN_TSK_ASC_6 /*집행전말*/
                             , NVL(SUM(PSN_TSK_ASC_7), 0)   AS PSN_TSK_ASC_7 /*기타업무*/
                             , NVL(SUM(PSN_TSK_ASC_8), 0)   AS PSN_TSK_ASC_8 /*성과보고서*/
                             , NVL(SUM(PSN_TSK_ASC_9), 0)   AS PSN_TSK_ASC_9 /*법령모니터링*/
                         FROM (
			 	            SELECT D22.EVL_YR
				                 , D22.HLYR_DVSN_CD
				                 , NVL(D24.HIRK_DPT_CD, D22.DPT_CD) AS HIRK_DPT_CD /*평가할때 상위 부서코드*/
				                 , D22.PSN_TSK_ASC_1
				                 , D22.PSN_TSK_ASC_2 /*모니터링*/
				                 , D22.PSN_TSK_ASC_3 /*결산업무*/
				                 , D22.PSN_TSK_ASC_4 /*연보업무*/
				                 , D22.PSN_TSK_ASC_5 /*총괄업무*/
				                 , D22.PSN_TSK_ASC_6 /*집행전말*/
				                 , D22.PSN_TSK_ASC_7 /*기타업무*/
				                 , D22.PSN_TSK_ASC_8 /*성과보고서*/
				                 , D22.PSN_TSK_ASC_9 /*법령모니터링*/ 
			                  FROM (                         
	                            SELECT EVL_YR
	                                 , HLYR_DVSN_CD
	                                 , DPT_CD AS DPT_CD /*평가할때 부서코드*/
	                                 , 0 AS PSN_TSK_ASC_1
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 2 AND 3 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*결산업무*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 4 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*연보업무*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_5 /*총괄업무*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_6 /*집행전말*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 94 AND 96) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_7 /*기타업무*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 13 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_8 /*성과보고서*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 7 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_9 /*법령모니터링*/
	                              FROM TBCSPAOE035M 
	                             WHERE EVL_YR       = #strEvlYr#
	                               AND HLYR_DVSN_CD = #strHlyrDvsnCd#
	                               AND TSK_DVSN_CD  = '10001'	               
	                              
	                             UNION ALL    
	                
	                            SELECT #strEvlYr# AS EVL_YR
	                                 , #strHlyrDvsnCd#  AS HLYR_DVSN_CD  
	                                 , DPT_CD AS DPT_CD /*평가할때 부서코드*/
	                                 , ROUND((STND_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 /*개인평점*/
	                                 , 0 AS PSN_TSK_ASC_2 /*모니터링*/
	                                 , 0 AS PSN_TSK_ASC_3 /*결산업무*/
	                                 , 0 AS PSN_TSK_ASC_4 /*연보업무*/
	                                 , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
	                                 , 0 AS PSN_TSK_ASC_6 /*집행전말*/
	                                 , 0 AS PSN_TSK_ASC_7 /*기타업무*/
	                                 , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
	                                 , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/
	                              FROM (
					                SELECT D20.PTCPT_CNB  
					                     , D20.DRIVE_RTE_ASC /*추진율 조정평점*/
					                     , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/  
					                     , D20.CTB_RTE
					                     , D20.DPT_CD
					                     , D20.SPE_ADD_SC
			                             , D20.MDT_ASC
			                             , D20.STND_ASC
					                 FROM (                              
		                                SELECT D19.PTCPT_CNB  
		                                     , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
		                                     , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
		                                            ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
		                                     , D19.CTB_RTE
		                                     , D19.DPT_CD
		                                     , D19.AUD_KND_CD
				                             , D19.AUD_STEP_CD_MAX
				                             , D19.DLY_DT_SUM
				                             , D19.SYT_EVL_ADVL_VAL
				                             , D19.SPE_ADD_SC
			                                 , D19.MDT_ASC
			                                 , D19.AUD_YR
			                                 , D19.TSK_NO
			                                 , D19.STND_ASC
		                                 FROM (
		                                    SELECT D11.PTCPT_CNB
		                                         , D10.STND_ASC /*표준평점*/
		                                         , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
		                                         , D10.DRIVE_RTE_SUM  /*추진율*/      
		                                         , ( SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
		                                         , D10.DLY_DT_SUM /*지연일*/
		                                         , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
		                                         , D11.CTB_RTE
		                                         , D11.BLT_DPT_CD AS DPT_CD
		                                         , D10.AUD_KND_CD
	                                			 , D10.AUD_STEP_CD_MAX
	                                			 , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
			                                     , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
			                                     , D10.AUD_YR
			                                     , D10.TSK_NO
		                                     FROM (
		                                        SELECT AUD_KND_CD
		                                             , AUD_YR
		                                             , TSK_NO
		                                             , AUD_STEP_CD_MIN
		                                             , AUD_STEP_CD_MAX
		                                             , MNDY_CNT
		                                             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
		                                             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
		                                             , DRIVE_RTE_SUM  /*추진율*/      
		                                             , DLY_DT_SUM /*지연일*/
		                                             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
		                                             , EVL_YR
		                                             , HLYR_DVSN_CD
		                                             , SYT_TRTM_YN
		                                             , SPE_ADD_SC
			                                         , MDT_ASC
		                                          FROM (
		                                            SELECT D5.AUD_KND_CD
		                                                 , D5.AUD_YR
		                                                 , D5.TSK_NO
		                                                 , D5.AUD_STEP_CD_MIN
		                                                 , D5.AUD_STEP_CD_MAX
		                                                 , D5.MNDY_CNT
		                                                 , (SELECT F_AOE_STND_ASC(D6.EVL_YR, D6.HLYR_DVSN_CD, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
		                                                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
	                                                                                , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
	                                                                                     AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
	                                                                                , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
		                                                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
		                                                      FROM TBCSPAOE008D 
		                                                     WHERE EVL_YR        = #strEvlYr#
		                                                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
		                                                       AND TSK_DVSN_CD   = '10000' 
		                                                       AND AUD_KND_CD    = D5.AUD_KND_CD   
		                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
		                                                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
		                                                      FROM TBCSPAOE022M
		                                                     WHERE AUD_YR = D5.AUD_YR
		                                                       AND TSK_NO = D5.TSK_NO
		                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
		                                                 , D6.EVL_YR
		                                                 , D6.HLYR_DVSN_CD
		                                                 , D5.SYT_TRTM_YN
		                                                 , D6.SPE_ADD_SC
			                                             , D6.MDT_ASC
		                                             FROM (
		                                                    SELECT D2.HNDL_DIV_DPT_CD
		                                                         , D2.SPVR_CNB
		                                                         , D2.AUD_KND_CD
		                                                         , D2.AUD_YR
		                                                         , D2.TSK_NO
		                                                         , D2.AUD_SBJ_NM
		                                                         , D1.AUD_STEP_CD_MIN
		                                                         , D1.AUD_STEP_CD_MAX
		                                                         , D2.MNDY_CNT
		                                                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
		                                                      FROM (
		                                                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
		                                                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
		                                                             , AUD_YR
		                                                             , TSK_NO
		                                                          FROM TBCSPAOE022M
		                                                         WHERE CMPT_DT IS NOT NULL
		                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
		                                                         GROUP BY AUD_YR, TSK_NO
		                                                     ) D1
		                                                     , TBCSPAOE021M D2
		                                                 WHERE D1.AUD_YR = D2.AUD_YR
		                                                   AND D1.TSK_NO = D2.TSK_NO
		                                                  ) D5 /*평가대상 감사활동 - 기준*/
		                                                  , (
		                                                    SELECT D8.AUD_TSK_KND_CD
		                                                         , D8.AUD_YR
		                                                         , D8.TSK_NO
		                                                         , D8.SYT_EVL_ADVL_VAL
		                                                         , D8.EVL_YR
		                                                         , D8.HLYR_DVSN_CD
		                                                         , D8.TSK_DVSN_CD
		                                                         , D8.EVL_RK_CD
		                                                         , D8.SYT_EVL_RK_CD
		                                                         , D8.EVL_STEP_CD
		                                                         , D8.SPE_ADD_SC
		                                                         , D8.MDT_ASC
		                                                       FROM (
		                                                           SELECT EVL_YR
		                                                                , HLYR_DVSN_CD 
		                                                                , AUD_YR
		                                                                , TSK_NO
		                                                                , MAX(EVL_STEP_CD) AS EVL_STEP_CD
		                                                                , AUD_TSK_KND_CD
		                                                                , TSK_DVSN_CD
		                                                             FROM TBCSPAOE029M
		                                                           WHERE 1=1
			                                                           AND (AUD_YR,
						                                                     TSK_NO,
						                                                     EVL_STEP_CD) IN (SELECT AUD_YR,
						                                                     TSK_NO,
						                                                     MAX(EVL_STEP_CD)
						                                                FROM TBCSPAOE029M
						                                               WHERE (AUD_YR,
						                                                             TSK_NO) IN (SELECT AUD_YR ,
						                                                             TSK_NO
						                                                        FROM TBCSPAOE022M
						                                                       WHERE CMPT_DT IS NOT NULL
						                                                         AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
						                                                       GROUP BY AUD_YR,
						                                                             TSK_NO )
						                                               GROUP BY AUD_YR,
						                                                     TSK_NO )
		                                                              AND TSK_DVSN_CD  = '10000'
		                                                              AND EVL_STA_CD   = '300' /*평가완료*/
		                                                            GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
		                                                     ) D7
		                                                     , TBCSPAOE029M D8
		                                                    WHERE D7.EVL_YR = D8.EVL_YR
		                                                      AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
		                                                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
		                                                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
		                                                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
		                                                      AND D7.AUD_YR = D8.AUD_YR
		                                                      AND D7.TSK_NO = D8.TSK_NO	                                          
		                                                ) D6 /*감사사항 평가관리*/
		                                                , TBCSPAOE010D D7
		                                            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
		                                              AND D5.AUD_YR          = D6.AUD_YR         (+)
		                                              AND D5.TSK_NO          = D6.TSK_NO         (+)
		                                              AND D6.EVL_YR = D7.EVL_YR (+) 
		                                              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
		                                              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
		                                              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
		                                              AND D6.EVL_RK_CD = D7.RK_CD (+)		  
		                                          ) D9
		                                      ) D10
		                                      , TBCSPAOE023M D11
		                                 WHERE D10.AUD_YR = D11.AUD_YR
		                                   AND D10.TSK_NO = D11.TSK_NO
		                                   AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
		                                   AND D11.CTB_RTE != 0	                   
		                               ) D19
	                               ) D20
	                            ) D21
                            ) D22
			                , (
		                    SELECT DPT_CD
														 FROM TBDCMACM002M
														WHERE DPT_TP_CD = 'A'  /*감사부서만 나온다*/
			                ) D23 
			                , TBDCMACM002M D24	
			            WHERE D22.DPT_CD = D23.DPT_CD
			              AND D22.DPT_CD = D24.DPT_CD                                
                        ) 
                       GROUP BY EVL_YR, HLYR_DVSN_CD, HIRK_DPT_CD
                     ) SUMSU
                     , (
	                    SELECT HIRK_DPT_CD
	                         , SUM(DPT_CNT) AS DEPT_CNT
	                      FROM (
	                        SELECT NVL(DPT.HIRK_DPT_CD, BASE.DPT_CD) AS HIRK_DPT_CD
	                             , BASE.DPT_CNT AS DPT_CNT
	                          FROM (
	                            SELECT DTP_CD.DPT_CD
	                                 , NVL(AOD_DPT_CNT.DEPT_CNT, 0) AS DPT_CNT
	                              FROM (
	                            SELECT DPT_CD
	                              FROM TBCSPAOE034M
		                          WHERE EVL_YR = #strEvlYr#
		                            AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		                            AND DPT_TYP_DVSN_CD = '10'	                              
	                              UNION  
	                             SELECT DPT_CD 
	                              FROM TBDCMACM002M
		                          WHERE USE_YN = 'Y' 
		                            AND DPT_TP_CD = 'A'	/*감사부서*/
		                            AND SUBSTR(DPT_CD,1,1) < '2'
		                            AND SUBSTR(DPT_CD,4,3) <>'000'	
	                              ) DTP_CD
	                              , (
	                                SELECT COUNT(CNB) AS DEPT_CNT
	                                     , DPT_CD
	                                  FROM TBDCMACM001M
	                                  WHERE NVL(BAI_USR_YN, 'N') = 'Y'   
	                                  GROUP BY DPT_CD
	                              ) DPT_CNT
	                              , (
	                                SELECT DPT_NOP_CNT AS DEPT_CNT
	                                     , DPT_CD
	                                  FROM TBCSPAOE034M
	                                 WHERE EVL_YR       = #strEvlYr#
	                                   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
	                              ) AOD_DPT_CNT
	                            WHERE DTP_CD.DPT_CD = DPT_CNT.DPT_CD  (+)
	                              AND DTP_CD.DPT_CD = AOD_DPT_CNT.DPT_CD (+)
	                          ) BASE
	                          , TBDCMACM002M DPT
	                        WHERE BASE.DPT_CD = DPT.DPT_CD
	                    )
	                    GROUP BY HIRK_DPT_CD /*34TL에 부서인원수가 들어가있지 않을경우 인사테이블에서 건수를 가져와야 하고, 폐지된 부서도 가져와야 하기 때문에 지저분하지만 이런식으로 쿼리를 작성*/	                     	
                    ) DPTCNT
               WHERE SUMSU.HIRK_DPT_CD = DPTCNT.HIRK_DPT_CD   
           )
         ORDER BY TSK_ASC_SUM DESC
		]]>
	</select>
	
	<!-- 전체과 1인당 평점 총점을 구한다. -->
	<select id="CSPAOE062QPsnTskAscSumselect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
            SELECT TO_CHAR(SUM(ROUND(SUMSU.TSK_ASC_SUM / DPTCNT.DEPT_CNT, 2))) AS PSN_TSK_ASC_AVG_SUM /*전체과 1인당 평점 총점*/
             FROM (
                SELECT DPT_CD /*평가할때 상위 부서코드*/
                     , NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) + NVL(SUM(PSN_TSK_ASC_5), 0) + NVL(SUM(PSN_TSK_ASC_6), 0) + NVL(SUM(PSN_TSK_ASC_7), 0) + NVL(SUM(PSN_TSK_ASC_8), 0) + NVL(SUM(PSN_TSK_ASC_9), 0) AS TSK_ASC_SUM
                 FROM (
	 	            SELECT D22.EVL_YR
		                 , D22.HLYR_DVSN_CD
		                 , D22.DPT_CD /*평가할때 부서코드*/
		                 , D22.PSN_TSK_ASC_1
		                 , D22.PSN_TSK_ASC_2 /*모니터링*/
		                 , D22.PSN_TSK_ASC_3 /*결산업무*/
		                 , D22.PSN_TSK_ASC_4 /*연보업무*/
		                 , D22.PSN_TSK_ASC_5 /*총괄업무*/
		                 , D22.PSN_TSK_ASC_6 /*집행전말*/
		                 , D22.PSN_TSK_ASC_7 /*기타업무*/
		                 , D22.PSN_TSK_ASC_8 /*성과보고서*/
		                 , D22.PSN_TSK_ASC_9 /*법령모니터링*/ 
	                  FROM (                 
	                    SELECT EVL_YR
	                         , HLYR_DVSN_CD
	                         , DPT_CD AS DPT_CD /*평가할때 부서코드*/
	                         , 0 AS PSN_TSK_ASC_1
	                         , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
	                         , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 2 AND 3 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*결산업무*/
	                         , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 4 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*연보업무*/
	                         , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_5 /*총괄업무*/
	                         , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_6 /*집행전말*/
	                         , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 94 AND 96) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_7 /*기타업무*/
	                         , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 13 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_8 /*성과보고서*/
	                         , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 7 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_9 /*법령모니터링*/
	                      FROM TBCSPAOE035M 
	                     WHERE EVL_YR       = #strEvlYr#
	                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
	                       AND TSK_DVSN_CD  = '10001'	               
	                      
	                     UNION ALL    
	        
	                    SELECT #strEvlYr# AS EVL_YR
	                         , #strHlyrDvsnCd#  AS HLYR_DVSN_CD  
	                         , DPT_CD AS DPT_CD /*평가할때 부서코드*/
	                         , ROUND((STND_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 /*개인평점*/
	                         , 0 AS PSN_TSK_ASC_2 /*모니터링*/
	                         , 0 AS PSN_TSK_ASC_3 /*결산업무*/
	                         , 0 AS PSN_TSK_ASC_4 /*연보업무*/
	                         , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
	                         , 0 AS PSN_TSK_ASC_6 /*집행전말*/
	                         , 0 AS PSN_TSK_ASC_7 /*기타업무*/
	                         , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
	                         , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/
	                      FROM (
			                SELECT D20.PTCPT_CNB  
			                     , D20.DRIVE_RTE_ASC /*추진율 조정평점*/
			                     , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/  
			                     , D20.CTB_RTE
			                     , D20.DPT_CD
			                     , D20.SPE_ADD_SC
			                     , D20.MDT_ASC
			                     , D20.STND_ASC
			                  FROM (                      
		                        SELECT D19.PTCPT_CNB  
		                             , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
		                             , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
		                                    ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
		                             , D19.CTB_RTE
		                             , D19.DPT_CD
		                             , D19.AUD_KND_CD
		                             , D19.AUD_STEP_CD_MAX
		                             , D19.DLY_DT_SUM
		                             , D19.SYT_EVL_ADVL_VAL
		                             , D19.SPE_ADD_SC
			                         , D19.MDT_ASC
			                         , D19.AUD_YR
			                         , D19.TSK_NO
			                         , D19.STND_ASC
		                         FROM (
		                            SELECT D11.PTCPT_CNB
		                                 , D10.STND_ASC /*표준평점*/
		                                 , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
		                                 , D10.DRIVE_RTE_SUM  /*추진율*/      
		                                 , ( SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
		                                 , D10.DLY_DT_SUM /*지연일*/
		                                 , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
		                                 , D11.CTB_RTE
		                                 , D11.BLT_DPT_CD AS DPT_CD
		                                 , D10.AUD_KND_CD
	                                     , D10.AUD_STEP_CD_MAX
	                                     , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
			                             , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
			                             , D10.AUD_YR
			                             , D10.TSK_NO
		                             FROM (
		                                SELECT AUD_KND_CD
		                                     , AUD_YR
		                                     , TSK_NO
		                                     , AUD_STEP_CD_MIN
		                                     , AUD_STEP_CD_MAX
		                                     , MNDY_CNT
		                                     , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
		                                     , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
		                                     , DRIVE_RTE_SUM  /*추진율*/      
		                                     , DLY_DT_SUM /*지연일*/
		                                     , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
		                                     , EVL_YR
		                                     , HLYR_DVSN_CD
		                                     , SYT_TRTM_YN
		                                     , SPE_ADD_SC
			                                 , MDT_ASC
		                                  FROM (
		                                    SELECT D5.AUD_KND_CD
		                                         , D5.AUD_YR
		                                         , D5.TSK_NO
		                                         , D5.AUD_STEP_CD_MIN
		                                         , D5.AUD_STEP_CD_MAX
		                                         , D5.MNDY_CNT
		                                         , (SELECT F_AOE_STND_ASC(D6.EVL_YR, D6.HLYR_DVSN_CD, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
		                                         , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
	                                                                               , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
	                                                                                     AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
	                                                                               , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
		                                         , (SELECT NVL(SUM(DRIVE_RTE), 0) 
		                                              FROM TBCSPAOE008D 
		                                             WHERE EVL_YR        = #strEvlYr#
		                                               AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
		                                               AND TSK_DVSN_CD   = '10000' 
		                                               AND AUD_KND_CD    = D5.AUD_KND_CD   
		                                               AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
		                                         , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
		                                              FROM TBCSPAOE022M
		                                             WHERE AUD_YR = D5.AUD_YR
		                                               AND TSK_NO = D5.TSK_NO
		                                               AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
		                                         , D6.EVL_YR
		                                         , D6.HLYR_DVSN_CD
		                                         , D5.SYT_TRTM_YN
		                                         , D6.SPE_ADD_SC
			                                     , D6.MDT_ASC
		                                     FROM (
		                                            SELECT D2.HNDL_DIV_DPT_CD
		                                                 , D2.SPVR_CNB
		                                                 , D2.AUD_KND_CD
		                                                 , D2.AUD_YR
		                                                 , D2.TSK_NO
		                                                 , D2.AUD_SBJ_NM
		                                                 , D1.AUD_STEP_CD_MIN
		                                                 , D1.AUD_STEP_CD_MAX
		                                                 , D2.MNDY_CNT
		                                                 , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
		                                              FROM (
		                                                SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
		                                                     , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
		                                                     , AUD_YR
		                                                     , TSK_NO
		                                                  FROM TBCSPAOE022M
		                                                 WHERE CMPT_DT IS NOT NULL
		                                                   AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
		                                                 GROUP BY AUD_YR, TSK_NO
		                                             ) D1
		                                             , TBCSPAOE021M D2
		                                         WHERE D1.AUD_YR = D2.AUD_YR
		                                           AND D1.TSK_NO = D2.TSK_NO
		                                          ) D5 /*평가대상 감사활동 - 기준*/
		                                          , (
		                                            SELECT D8.AUD_TSK_KND_CD
		                                                 , D8.AUD_YR
		                                                 , D8.TSK_NO
		                                                 , D8.SYT_EVL_ADVL_VAL
		                                                 , D8.EVL_YR
		                                                 , D8.HLYR_DVSN_CD
		                                                 , D8.TSK_DVSN_CD
		                                                 , D8.EVL_RK_CD
		                                                 , D8.SYT_EVL_RK_CD
		                                                 , D8.EVL_STEP_CD
		                                                 , D8.SPE_ADD_SC
		                                                 , D8.MDT_ASC
		                                               FROM (
		                                                   SELECT EVL_YR
		                                                        , HLYR_DVSN_CD 
		                                                        , AUD_YR
		                                                        , TSK_NO
		                                                        , MAX(EVL_STEP_CD) AS EVL_STEP_CD
		                                                        , AUD_TSK_KND_CD
		                                                        , TSK_DVSN_CD
		                                                     FROM TBCSPAOE029M
		                                                   WHERE 1=1
		                                                   AND (AUD_YR,
                                                                                       TSK_NO,
                                                                                       EVL_STEP_CD) IN (SELECT AUD_YR,
                                                                                       TSK_NO,
                                                                                       MAX(EVL_STEP_CD)
                                                                                  FROM TBCSPAOE029M
                                                                                 WHERE (AUD_YR,
                                                                                               TSK_NO) IN (SELECT AUD_YR ,
                                                                                               TSK_NO
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE CMPT_DT IS NOT NULL
                                                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                                                         GROUP BY AUD_YR,
                                                                                               TSK_NO )
                                                                                 GROUP BY AUD_YR,
                                                                                       TSK_NO )
		                                                      AND TSK_DVSN_CD  = '10000'
		                                                      AND EVL_STA_CD   = '300' /*평가완료*/
		                                                    GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
		                                             ) D7
		                                             , TBCSPAOE029M D8
		                                            WHERE D7.EVL_YR = D8.EVL_YR
		                                              AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
		                                              AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
		                                              AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
		                                              AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
		                                              AND D7.AUD_YR = D8.AUD_YR
		                                              AND D7.TSK_NO = D8.TSK_NO	                                          
		                                        ) D6 /*감사사항 평가관리*/
		                                        , TBCSPAOE010D D7
		                                    WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
		                                      AND D5.AUD_YR          = D6.AUD_YR         (+)
		                                      AND D5.TSK_NO          = D6.TSK_NO         (+)
		                                      AND D6.EVL_YR = D7.EVL_YR (+) 
		                                      AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
		                                      AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
		                                      AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
		                                      AND D6.EVL_RK_CD = D7.RK_CD (+)		  
		                                  ) D9
		                              ) D10
		                              , TBCSPAOE023M D11
		                         WHERE D10.AUD_YR = D11.AUD_YR
		                           AND D10.TSK_NO = D11.TSK_NO
		                           AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
		                           AND D11.CTB_RTE != 0	                   
		                       ) D19
	                       ) D20
	                    ) D21
                    ) D22
	                , (
                    SELECT DPT_CD
														 FROM TBDCMACM002M
														WHERE DPT_TP_CD = 'A' /*감사부서만 나온다*/ 
	                ) D23
	            WHERE D22.DPT_CD = D23.DPT_CD                    
                ) 
               GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD
             ) SUMSU
             , (
               SELECT BASE.DPT_CD       AS DPT_CD
                    , SUM(BASE.DPT_CNT) AS DEPT_CNT
                 FROM (
                   SELECT DTP_CD.DPT_CD
                        , NVL(AOD_DPT_CNT.DEPT_CNT, 0) AS DPT_CNT
                     FROM (
                        SELECT DPT_CD
                          FROM TBCSPAOE034M
                         WHERE EVL_YR = #strEvlYr#
                           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                           AND DPT_TYP_DVSN_CD = '10'	                              
                          UNION  
                         SELECT DPT_CD 
                          FROM TBDCMACM002M
                         WHERE USE_YN = 'Y' 
                           AND DPT_TP_CD = 'A'	/*감사부서*/
                           AND SUBSTR(DPT_CD,1,1) < '2'
                           AND SUBSTR(DPT_CD,4,3) <>'000'
                     ) DTP_CD
                     , (
                       SELECT COUNT(CNB) AS DEPT_CNT
                            , DPT_CD
                         FROM TBDCMACM001M
                         WHERE NVL(BAI_USR_YN, 'N') = 'Y'   
                         GROUP BY DPT_CD
                     ) DPT_CNT
                     , (
                       SELECT DPT_NOP_CNT AS DEPT_CNT
                            , DPT_CD
                         FROM TBCSPAOE034M
                        WHERE EVL_YR       = #strEvlYr#
                          AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                     ) AOD_DPT_CNT
                   WHERE DTP_CD.DPT_CD = DPT_CNT.DPT_CD  (+)
                     AND DTP_CD.DPT_CD = AOD_DPT_CNT.DPT_CD (+)
                 ) BASE
             GROUP BY BASE.DPT_CD /*34TL에 부서인원수가 들어가있지 않을경우 인사테이블에서 건수를 가져와야 하고, 폐지된 부서도 가져와야 하기 때문에 지저분하지만 이런식으로 쿼리를 작성*/     
            ) DPTCNT
       WHERE SUMSU.DPT_CD = DPTCNT.DPT_CD   
		]]>
	</select>

	<!-- 과/팀별 -->
	<select id="CSPAOE062Qmainselect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
                SELECT F_DPT_INFO(DPT_CD, '1') AS DPT_NM /*부서명*/
                     , ROUND(#strAllDptSum# * ((TSK_ASC_SUM/ TO_NUMBER(#strAllDptSum#)) * (#strSumRate# / 100) + (PSN_TSK_ASC_SUM/TO_NUMBER(#strPsnTskAscAvgSum#)) * (#strPsnAvgRate# / 100)), 2)  AS RTE_ASC /*조정평점*/
                     , PSN_TSK_ASC_SUM AS PSN_TSK_ASC_SUM /*1인당평점*/
                     , TSK_ASC_SUM AS TSK_ASC_SUM /*실적합계*/
                     , DEPT_CNT /*부서인원*/
                     , PSN_TSK_ASC_1 AS TSK_ASC_1 /*감사활동*/
                     , PSN_TSK_ASC_2 AS TSK_ASC_2 /*모니터링*/
                     , PSN_TSK_ASC_3 AS TSK_ASC_3 /*결산업무*/
                     , PSN_TSK_ASC_4 AS TSK_ASC_4 /*연보업무*/
                     , PSN_TSK_ASC_5 AS TSK_ASC_5 /*총괄업무*/
                     , PSN_TSK_ASC_6 AS TSK_ASC_6 /*집행전말*/
                     , PSN_TSK_ASC_7 AS TSK_ASC_7 /*기타업무*/
                     , PSN_TSK_ASC_8 AS TSK_ASC_8 /*성과보고서*/
                     , PSN_TSK_ASC_9 AS TSK_ASC_9 /*법령모니터링*/
                     , TO_NUMBER(#strAllDptSum#) AS TSK_ASC_SUM_ALL /*전체과 실적 총점*/
                     , TO_NUMBER(#strPsnTskAscAvgSum#) AS ALL_TSK_ASC_SUM /*전체과 1일당 총점 합계*/
                 FROM (
                    SELECT SUMSU.EVL_YR
                         , SUMSU.HLYR_DVSN_CD
                         , SUMSU.DPT_CD /*평가할때 상위 부서코드*/
                         , ROUND(SUMSU.TSK_ASC_SUM / DPTCNT.DEPT_CNT, 2) AS PSN_TSK_ASC_SUM /*1인당평점*/
                         , SUMSU.TSK_ASC_SUM /*실적합계*/
                         , DPTCNT.DEPT_CNT /*부서인원*/
                         , SUMSU.PSN_TSK_ASC_1  /*감사활동*/
                         , SUMSU.PSN_TSK_ASC_2 /*모니터링*/
                         , SUMSU.PSN_TSK_ASC_3 /*결산업무*/
                         , SUMSU.PSN_TSK_ASC_4 /*연보업무*/
                         , SUMSU.PSN_TSK_ASC_5 /*총괄업무*/
                         , SUMSU.PSN_TSK_ASC_6 /*집행전말*/
                         , SUMSU.PSN_TSK_ASC_7 /*기타업무*/
                         , SUMSU.PSN_TSK_ASC_8 /*성과보고서*/
                         , SUMSU.PSN_TSK_ASC_9 /*법령모니터링*/
                     FROM (
                        SELECT EVL_YR
                             , HLYR_DVSN_CD
                             , DPT_CD /*평가할때 상위 부서코드*/
                             , NVL(SUM(PSN_TSK_ASC_1), 0) + NVL(SUM(PSN_TSK_ASC_2), 0) + NVL(SUM(PSN_TSK_ASC_3), 0) + NVL(SUM(PSN_TSK_ASC_4), 0) + NVL(SUM(PSN_TSK_ASC_5), 0) + NVL(SUM(PSN_TSK_ASC_6), 0) + NVL(SUM(PSN_TSK_ASC_7), 0) + NVL(SUM(PSN_TSK_ASC_8), 0) + NVL(SUM(PSN_TSK_ASC_9), 0) AS TSK_ASC_SUM
                             , NVL(SUM(PSN_TSK_ASC_1), 0)   AS PSN_TSK_ASC_1  /*감사활동*/
                             , NVL(SUM(PSN_TSK_ASC_2), 0)   AS PSN_TSK_ASC_2 /*모니터링*/
                             , NVL(SUM(PSN_TSK_ASC_3), 0)   AS PSN_TSK_ASC_3 /*결산업무*/
                             , NVL(SUM(PSN_TSK_ASC_4), 0)   AS PSN_TSK_ASC_4 /*연보업무*/
                             , NVL(SUM(PSN_TSK_ASC_5), 0)   AS PSN_TSK_ASC_5 /*총괄업무*/
                             , NVL(SUM(PSN_TSK_ASC_6), 0)   AS PSN_TSK_ASC_6 /*집행전말*/
                             , NVL(SUM(PSN_TSK_ASC_7), 0)   AS PSN_TSK_ASC_7 /*기타업무*/
                             , NVL(SUM(PSN_TSK_ASC_8), 0)   AS PSN_TSK_ASC_8 /*성과보고서*/
                             , NVL(SUM(PSN_TSK_ASC_9), 0)   AS PSN_TSK_ASC_9 /*법령모니터링*/
                         FROM (
			 	            SELECT D22.EVL_YR
				                 , D22.HLYR_DVSN_CD
				                 , D22.DPT_CD /*평가할때 부서코드*/
				                 , D22.PSN_TSK_ASC_1
				                 , D22.PSN_TSK_ASC_2 /*모니터링*/
				                 , D22.PSN_TSK_ASC_3 /*결산업무*/
				                 , D22.PSN_TSK_ASC_4 /*연보업무*/
				                 , D22.PSN_TSK_ASC_5 /*총괄업무*/
				                 , D22.PSN_TSK_ASC_6 /*집행전말*/
				                 , D22.PSN_TSK_ASC_7 /*기타업무*/
				                 , D22.PSN_TSK_ASC_8 /*성과보고서*/
				                 , D22.PSN_TSK_ASC_9 /*법령모니터링*/ 
			                  FROM (                     
	                            SELECT EVL_YR
	                                 , HLYR_DVSN_CD
	                                 , DPT_CD AS DPT_CD /*평가할때 부서코드*/
	                                 , 0 AS PSN_TSK_ASC_1
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 2 AND 3 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*결산업무*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 4 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*연보업무*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_5 /*총괄업무*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_6 /*집행전말*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 94 AND 96) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_7 /*기타업무*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 13 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_8 /*성과보고서*/
	                                 , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 7 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_9 /*법령모니터링*/
	                              FROM TBCSPAOE035M 
	                             WHERE EVL_YR       = #strEvlYr#
	                               AND HLYR_DVSN_CD = #strHlyrDvsnCd#
	                               AND TSK_DVSN_CD  = '10001'	               
	                              
	                             UNION ALL    
	                
	                            SELECT #strEvlYr# AS EVL_YR
	                                 , #strHlyrDvsnCd#  AS HLYR_DVSN_CD  
	                                 , DPT_CD AS DPT_CD /*평가할때 부서코드*/
	                                 , ROUND((STND_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 /*개인평점*/
	                                 , 0 AS PSN_TSK_ASC_2 /*모니터링*/
	                                 , 0 AS PSN_TSK_ASC_3 /*결산업무*/
	                                 , 0 AS PSN_TSK_ASC_4 /*연보업무*/
	                                 , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
	                                 , 0 AS PSN_TSK_ASC_6 /*집행전말*/
	                                 , 0 AS PSN_TSK_ASC_7 /*기타업무*/
	                                 , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
	                                 , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/
	                              FROM (
					                SELECT D20.PTCPT_CNB  
					                     , D20.DRIVE_RTE_ASC /*추진율 조정평점*/
					                     , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/  
					                     , D20.CTB_RTE
					                     , D20.DPT_CD
					                     , D20.SPE_ADD_SC
			                             , D20.MDT_ASC
			                             , D20.STND_ASC
					                 FROM (                              
		                                SELECT D19.PTCPT_CNB  
		                                     , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
		                                     , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2) 
		                                            ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/    
		                                     , D19.CTB_RTE
		                                     , D19.DPT_CD
		                                     , D19.AUD_KND_CD
				                             , D19.AUD_STEP_CD_MAX
				                             , D19.DLY_DT_SUM
				                             , D19.SYT_EVL_ADVL_VAL
				                             , D19.SPE_ADD_SC
			                                 , D19.MDT_ASC
			                                 , D19.AUD_YR
			                                 , D19.TSK_NO
			                                 , D19.STND_ASC
		                                 FROM (
		                                    SELECT D11.PTCPT_CNB
		                                         , D10.STND_ASC /*표준평점*/
		                                         , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
		                                         , D10.DRIVE_RTE_SUM  /*추진율*/      
		                                         , ( SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
		                                         , D10.DLY_DT_SUM /*지연일*/
		                                         , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
		                                         , D11.CTB_RTE
		                                         , D11.BLT_DPT_CD AS DPT_CD
		                                         , D10.AUD_KND_CD
	                                			 , D10.AUD_STEP_CD_MAX
	                                			 , NVL(D10.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD)) AS SPE_ADD_SC
			                                     , NVL(D10.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_YR, D10.TSK_NO, D10.AUD_KND_CD))    AS MDT_ASC
			                                     , D10.AUD_YR
			                                     , D10.TSK_NO
		                                     FROM (
		                                        SELECT AUD_KND_CD
		                                             , AUD_YR
		                                             , TSK_NO
		                                             , AUD_STEP_CD_MIN
		                                             , AUD_STEP_CD_MAX
		                                             , MNDY_CNT
		                                             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
		                                             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
		                                             , DRIVE_RTE_SUM  /*추진율*/      
		                                             , DLY_DT_SUM /*지연일*/
		                                             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
		                                             , EVL_YR
		                                             , HLYR_DVSN_CD
		                                             , SYT_TRTM_YN
		                                             , SPE_ADD_SC
			                                         , MDT_ASC
		                                          FROM (
		                                            SELECT D5.AUD_KND_CD
		                                                 , D5.AUD_YR
		                                                 , D5.TSK_NO
		                                                 , D5.AUD_STEP_CD_MIN
		                                                 , D5.AUD_STEP_CD_MAX
		                                                 , D5.MNDY_CNT
		                                                 , (SELECT F_AOE_STND_ASC(D6.EVL_YR, D6.HLYR_DVSN_CD, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
		                                                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
	                                                                                       , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
	                                                                                                 AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
	                                                                                       , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
		                                                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
		                                                      FROM TBCSPAOE008D 
		                                                     WHERE EVL_YR        = #strEvlYr#
		                                                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
		                                                       AND TSK_DVSN_CD   = '10000' 
		                                                       AND AUD_KND_CD    = D5.AUD_KND_CD   
		                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
		                                                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
		                                                      FROM TBCSPAOE022M
		                                                     WHERE AUD_YR = D5.AUD_YR
		                                                       AND TSK_NO = D5.TSK_NO
		                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
		                                                 , D6.EVL_YR
		                                                 , D6.HLYR_DVSN_CD
		                                                 , D5.SYT_TRTM_YN
		                                                 , D6.SPE_ADD_SC
			                                             , D6.MDT_ASC
		                                             FROM (
		                                                    SELECT D2.HNDL_DIV_DPT_CD
		                                                         , D2.SPVR_CNB
		                                                         , D2.AUD_KND_CD
		                                                         , D2.AUD_YR
		                                                         , D2.TSK_NO
		                                                         , D2.AUD_SBJ_NM
		                                                         , D1.AUD_STEP_CD_MIN
		                                                         , D1.AUD_STEP_CD_MAX
		                                                         , D2.MNDY_CNT
		                                                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
		                                                      FROM (
		                                                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
		                                                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
		                                                             , AUD_YR
		                                                             , TSK_NO
		                                                          FROM TBCSPAOE022M
		                                                         WHERE CMPT_DT IS NOT NULL
		                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
		                                                         GROUP BY AUD_YR, TSK_NO
		                                                     ) D1
		                                                     , TBCSPAOE021M D2
		                                                 WHERE D1.AUD_YR = D2.AUD_YR
		                                                   AND D1.TSK_NO = D2.TSK_NO
		                                                  ) D5 /*평가대상 감사활동 - 기준*/
		                                                  , (
		                                                    SELECT D8.AUD_TSK_KND_CD
		                                                         , D8.AUD_YR
		                                                         , D8.TSK_NO
		                                                         , D8.SYT_EVL_ADVL_VAL
		                                                         , D8.EVL_YR
		                                                         , D8.HLYR_DVSN_CD
		                                                         , D8.TSK_DVSN_CD
		                                                         , D8.EVL_RK_CD
		                                                         , D8.SYT_EVL_RK_CD
		                                                         , D8.EVL_STEP_CD
		                                                         , D8.SPE_ADD_SC
		                                                         , D8.MDT_ASC
		                                                       FROM (
		                                                           SELECT EVL_YR
		                                                                , HLYR_DVSN_CD 
		                                                                , AUD_YR
		                                                                , TSK_NO
		                                                                , MAX(EVL_STEP_CD) AS EVL_STEP_CD
		                                                                , AUD_TSK_KND_CD
		                                                                , TSK_DVSN_CD
		                                                             FROM TBCSPAOE029M
		                                                           WHERE 1=1
		                                                           AND (AUD_YR,
                                                                                       TSK_NO,
                                                                                       EVL_STEP_CD) IN (SELECT AUD_YR,
                                                                                       TSK_NO,
                                                                                       MAX(EVL_STEP_CD)
                                                                                  FROM TBCSPAOE029M
                                                                                 WHERE (AUD_YR,
                                                                                               TSK_NO) IN (SELECT AUD_YR ,
                                                                                               TSK_NO
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE CMPT_DT IS NOT NULL
                                                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                                                         GROUP BY AUD_YR,
                                                                                               TSK_NO )
                                                                                 GROUP BY AUD_YR,
                                                                                       TSK_NO )
		                                                              AND TSK_DVSN_CD  = '10000'
		                                                              AND EVL_STA_CD   = '300' /*평가완료*/
		                                                            GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
		                                                     ) D7
		                                                     , TBCSPAOE029M D8
		                                                    WHERE D7.EVL_YR = D8.EVL_YR
		                                                      AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
		                                                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
		                                                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
		                                                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
		                                                      AND D7.AUD_YR = D8.AUD_YR
		                                                      AND D7.TSK_NO = D8.TSK_NO	                                          
		                                                ) D6 /*감사사항 평가관리*/
		                                                , TBCSPAOE010D D7
		                                            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
		                                              AND D5.AUD_YR          = D6.AUD_YR         (+)
		                                              AND D5.TSK_NO          = D6.TSK_NO         (+)
		                                              AND D6.EVL_YR = D7.EVL_YR (+) 
		                                              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
		                                              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
		                                              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
		                                              AND D6.EVL_RK_CD = D7.RK_CD (+)		  
		                                          ) D9
		                                      ) D10
		                                      , TBCSPAOE023M D11
		                                 WHERE D10.AUD_YR = D11.AUD_YR
		                                   AND D10.TSK_NO = D11.TSK_NO
		                                   AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD    
		                                   AND D11.CTB_RTE != 0	                   
		                               ) D19
	                               ) D20
	                            ) D21
                            ) D22
			                , (
		                    SELECT DPT_CD
														 FROM TBDCMACM002M
														WHERE DPT_TP_CD = 'A'    /*감사부서만 나온다*/              
			                ) D23
			            WHERE D22.DPT_CD = D23.DPT_CD                           
                        ) 
                       GROUP BY EVL_YR, HLYR_DVSN_CD, DPT_CD
                     ) SUMSU
                     , (
		               SELECT BASE.DPT_CD       AS DPT_CD
		                    , SUM(BASE.DPT_CNT) AS DEPT_CNT
		                 FROM (
		                   SELECT DTP_CD.DPT_CD
		                        , NVL(AOD_DPT_CNT.DEPT_CNT, 0) AS DPT_CNT
		                     FROM (
		                   SELECT DPT_CD
		                     FROM TBCSPAOE034M
		                     UNION  
		                    SELECT DPT_CD 
		                     FROM TBDCMACM002M
		                     ) DTP_CD
		                     , (
		                       SELECT COUNT(CNB) AS DEPT_CNT
		                            , DPT_CD
		                         FROM TBDCMACM001M
		                         WHERE NVL(BAI_USR_YN, 'N') = 'Y'   
		                         GROUP BY DPT_CD
		                     ) DPT_CNT
		                     , (
		                       SELECT DPT_NOP_CNT AS DEPT_CNT
		                            , DPT_CD
		                         FROM TBCSPAOE034M
		                        WHERE EVL_YR       = #strEvlYr#
		                          AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		                     ) AOD_DPT_CNT
		                   WHERE DTP_CD.DPT_CD = DPT_CNT.DPT_CD  (+)
		                     AND DTP_CD.DPT_CD = AOD_DPT_CNT.DPT_CD (+)
		                 ) BASE
		             GROUP BY BASE.DPT_CD /*34TL에 부서인원수가 들어가있지 않을경우 인사테이블에서 건수를 가져와야 하고, 폐지된 부서도 가져와야 하기 때문에 지저분하지만 이런식으로 쿼리를 작성*/    		
                    ) DPTCNT
               WHERE SUMSU.DPT_CD = DPTCNT.DPT_CD   
           )
         ORDER BY TSK_ASC_SUM DESC	
		]]>
	</select>
	<!-- ############################## 부서별 업무실적 총괄조정 끝 (CSPAOE062Q) ################################### -->

	<!-- ############################## 개인별 업무실적 명세 시작 (CSPAOE066Q) ##################################### -->
	<select id="CSPAOE066Qmainselect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[	
                SELECT (SELECT F_DPT_INFO(D16.DPT_CD, '1')       FROM DUAL)  AS DPT_NM /*부서코드*/
                     , (SELECT F_CODE_NM('1000173', D16.RANK_CD) FROM DUAL)  AS RANK_NM /*직급명*/
                     , (SELECT F_USR_INFO(D15.PTCPT_CNB, '2')    FROM DUAL)  AS NEVLT_NM /*이름*/
                     , D15.PTCPT_CNB                     AS NEVLT_CNB /*피평가자전산번호*/
                     , AUD_KND_NM    /*감사종류코드*/
			         , AUD_SBJ_NM    AS TSK_NM  /*업무명*/
                     , NMPTCPT_CNT   AS PTCPT_CNB_CNT /*참여인원*/
                     , STND_ASC /*표준평점*/
                     , (SELECT F_CODE_NM('1000274', SYT_EVL_RK_CD) FROM DUAL) AS EVL_RK_CD /*평가등급*/
                     , SYT_EVL_ADVL_VAL                    AS IDVT_INDEX_VAL   /*가중치*/    
                     , ADVL_ASC /*가중평점=표준평점*가중치*/
                     , (SELECT F_CODE_NM('1000273', AUD_STEP_CD_MIN) FROM DUAL)           AS TSK_ST_STEP_NM	/*단계기초*/
			         , (SELECT F_CODE_NM('1000273', AUD_STEP_CD_MAX) FROM DUAL)           AS TSK_END_STEP_NM	/*단계기말 */ 
                     , DECODE(TSK_DVSN_CD, '10001', '', DRIVE_RTE_SUM) AS DRIVE_RTE /*추진율*/      
                     , DECODE(TSK_DVSN_CD, '10001', '', DRIVE_RTE_ASC) AS DRIVE_RTE_ASC /*추진율 조정평점*/
                     , DECODE(TSK_DVSN_CD, '10001', '', DLY_DT_SUM)    AS DLAY_DT_NM_SUM /*지연일*/
                     , DECODE(TSK_DVSN_CD, '10001', '', ASP_RTE)       AS ASP_RTE /*가감점율*/
			         , DECODE(TSK_DVSN_CD, '10001', '', ASP_STND_ASC)  AS ASP_ASC /*가감평점*/
                     , DECODE(TSK_DVSN_CD, '10001', '', SPE_ADD_SC)    AS SPE_ADD_SC /*특별가산점*/      
                     , TSK_ASC    /*업무평점 = 표준평점*평가등급별가중치*감사단계별추진율 + (가감평점) + 특별가산점 + 조정평점(조정평점은 사용하지 않는다고 했다. 하지만 혹시 모르니 일단 더하는 방식으로 간다.)*/
                     , CTB_RTE
                     , PSN_TSK_ASC /*개인평점*/
                     , D17.PSN_TSK_ASC_SUM AS PSN_TSK_ASC_SUM /*개인평점 합계*/
                  FROM (
                    SELECT PTCPT_CNB
                         , AUD_KND_NM    /*감사종류코드*/
                         , AUD_SBJ_NM
                         , NMPTCPT_CNT   /*참여인원*/
                         , STND_ASC /*표준평점*/
                         , SYT_EVL_RK_CD
                         , SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
                         , ADVL_ASC /*가중평점=표준평점*가중치*/
                         , AUD_STEP_CD_MIN
                         , AUD_STEP_CD_MAX
                         , DRIVE_RTE_SUM  /*추진율*/      
                         , DRIVE_RTE_ASC /*추진율 조정평점*/
                         , DLY_DT_SUM /*지연일*/
                         , ( CASE WHEN INSTR(DLY_DT_SUM, '-') = 0 AND ASP_RTE = 0 THEN '0.00'
                             WHEN INSTR(DLY_DT_SUM, '-') = 0 THEN  TO_CHAR(ASP_RTE,'FM99990.00')
			                 ELSE '-' || TO_CHAR(ASP_RTE,'FM99990.00') END) AS ASP_RTE  /*가감점율*/
                         , ASP_STND_ASC /*가감평점*/
                         , SPE_ADD_SC /*특별가산점*/      
                         /*, ROUND(DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC, 2) AS TSK_ASC  */ /*업무평점 = 표준평점*평가등급별가중치*감사단계별추진율 + (가감평점) + 특별가산점 + 조정평점(조정평점은 사용하지 않는다고 했다. 하지만 혹시 모르니 일단 더하는 방식으로 간다.)*/
                         , ROUND(STND_ASC, 2) AS TSK_ASC 
                         , CTB_RTE
                         /*, ROUND((DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC  */ /*개인평점*/
                         , ROUND(STND_ASC * (CTB_RTE/100), 2) AS PSN_TSK_ASC
                         , TSK_DVSN_CD
                      FROM (
                        SELECT D20.PTCPT_CNB
                             , (SELECT F_CODE_NM('1000270', D20.AUD_KND_CD) FROM DUAL) AS AUD_KND_NM 
                             , D20.AUD_SBJ_NM
                             , D20.NMPTCPT_CNT /*참여인원*/
                             , D20.STND_ASC /*표준평점*/
                             , D20.SYT_EVL_RK_CD
                             , D20.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
                             , D20.ADVL_ASC /*가중평점=표준평점*가중치*/
                             , D20.AUD_STEP_CD_MIN
                             , D20.AUD_STEP_CD_MAX
                             , D20.DRIVE_RTE_SUM  /*추진율*/      
                             , D20.DRIVE_RTE_ASC /*추진율 조정평점*/
                             , D20.DLY_DT_SUM /*지연일*/
                             , D20.ASP_RTE  /*가감점율*/
                             , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/
                             , D20.SPE_ADD_SC /*특별가산점*/     
                             , D20.MDT_ASC /*조정평점*/ 
                             , D20.CTB_RTE
                             , D20.MNDY_CNT
                             , '10000' AS TSK_DVSN_CD
                         FROM (                        
	                        SELECT D19.PTCPT_CNB
	                             , D19.AUD_KND_CD    /*감사종류코드*/
	                             , D19.AUD_SBJ_NM
	                             , D19.NMPTCPT_CNT /*참여인원*/
	                             , D19.STND_ASC /*표준평점*/
	                             , D19.SYT_EVL_RK_CD
	                             , D19.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
	                             , D19.ADVL_ASC /*가중평점=표준평점*가중치*/
	                             , D19.AUD_STEP_CD_MIN
	                             , D19.AUD_STEP_CD_MAX
	                             , D19.DRIVE_RTE_SUM  /*추진율*/      
	                             , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
	                             , D19.DLY_DT_SUM /*지연일*/
	                             , D19.ASP_RTE  /*가감점율*/
	                             , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2) 
	                                    ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100), 2) END)) AS ASP_STND_ASC /*가감평점*/
	                             , D19.SPE_ADD_SC /*특별가산점*/     
	                             , D19.MDT_ASC /*조정평점*/ 
	                             , D19.CTB_RTE
	                             , D19.MNDY_CNT
	                             , D19.AUD_YR
	                             , D19.TSK_NO
	                         FROM (
	                            SELECT D11.PTCPT_CNB
	                                 , D10.AUD_KND_CD    /*감사종류코드*/
	                                 , D10.AUD_SBJ_NM
	                                 , D10.NMPTCPT_CNT /*참여인원*/
	                                 , D10.STND_ASC /*표준평점*/
	                                 , D10.SYT_EVL_RK_CD
	                                 , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
	                                 , D10.STND_ASC * D10.SYT_EVL_ADVL_VAL AS ADVL_ASC /*가중평점=표준평점*가중치*/
	                                 , D10.AUD_STEP_CD_MIN
	                                 , D10.AUD_STEP_CD_MAX
	                                 , D10.DRIVE_RTE_SUM  /*추진율*/      
	                                 , (SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
	                                 , D10.DLY_DT_SUM /*지연일*/
	                                 , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/
	                                 , D10.SPE_ADD_SC /*특별가산점*/      
	                                 , D10.MDT_ASC /*조정평점*/
	                                 , D11.CTB_RTE
	                                 , D10.MNDY_CNT
	                                 , D10.AUD_YR
	                                 , D10.TSK_NO
	                             FROM (
	                                SELECT HNDL_DIV_DPT_CD
	                                     , SPVR_CNB
	                                     , AUD_KND_CD
	                                     , AUD_YR
	                                     , TSK_NO
	                                     , AUD_SBJ_NM
	                                     , AUD_STEP_CD_MIN
	                                     , AUD_STEP_CD_MAX
	                                     , MNDY_CNT
	                                     , NMPTCPT_CNT /*참여인원*/
	                                     , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
	                                     , SYT_EVL_RK_CD
	                                     , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
	                                     , DRIVE_RTE_SUM  /*추진율*/      
	                                     , DLY_DT_SUM /*지연일*/
	                                     , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
	                                     , NVL(SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS SPE_ADD_SC
	                                     , NVL(MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS MDT_ASC
	                                     , EVL_YR
	                                     , HLYR_DVSN_CD
	                                     , SYT_TRTM_YN
	                                  FROM (
	                                    SELECT D5.HNDL_DIV_DPT_CD
	                                         , D5.SPVR_CNB
	                                         , D5.AUD_KND_CD
	                                         , D5.AUD_YR
	                                         , D5.TSK_NO
	                                         , D5.AUD_SBJ_NM
	                                         , D5.AUD_STEP_CD_MIN
	                                         , D5.AUD_STEP_CD_MAX
	                                         , D5.MNDY_CNT
	                                         , ( SELECT COUNT(*) FROM TBCSPAOE023M WHERE AUD_YR = D5.AUD_YR AND TSK_NO = D5.TSK_NO AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ) AS NMPTCPT_CNT /*참여인원*/
	                                         , ( SELECT F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) FROM DUAL) AS STND_ASC /*표준평점*/
	                                         , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
                                                                               , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
                                                                                                 AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
                                                                               , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                                                                
                                             , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D6.EVL_RK_CD, '200', D6.SYT_EVL_RK_CD, 'X', (SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ), 0) AS SYT_EVL_RK_CD
	                                         , (SELECT NVL(SUM(DRIVE_RTE), 0) 
	                                              FROM TBCSPAOE008D 
	                                             WHERE EVL_YR        = #strEvlYr#
	                                               AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
	                                               AND TSK_DVSN_CD   = '10000' 
	                                               AND AUD_KND_CD    = D5.AUD_KND_CD   
	                                               AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
	                                         , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
	                                              FROM TBCSPAOE022M
	                                             WHERE AUD_YR = D5.AUD_YR
	                                               AND TSK_NO = D5.TSK_NO
	                                               AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
	                                         , D6.SPE_ADD_SC
	                                         , D6.MDT_ASC
	                                         , nvl(D6.EVL_YR,#strEvlYr#) as EVL_YR
	                                         , nvl(D6.HLYR_DVSN_CD ,#strHlyrDvsnCd#) as HLYR_DVSN_CD
	                                         , D5.SYT_TRTM_YN
	                                     FROM (
	                                            SELECT D2.HNDL_DIV_DPT_CD
	                                                 , D2.SPVR_CNB
	                                                 , D2.AUD_KND_CD
	                                                 , D2.AUD_YR
	                                                 , D2.TSK_NO
	                                                 , D2.AUD_SBJ_NM
	                                                 , D1.AUD_STEP_CD_MIN
	                                                 , D1.AUD_STEP_CD_MAX
	                                                 , D2.MNDY_CNT
	                                                 , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
	                                              FROM (
	                                                SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
	                                                     , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
	                                                     , AUD_YR
	                                                     , TSK_NO
	                                                  FROM TBCSPAOE022M
	                                                 WHERE CMPT_DT IS NOT NULL
	                                                   AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
	                                                 GROUP BY AUD_YR, TSK_NO
	                                             ) D1
	                                             , TBCSPAOE021M D2
	                                         WHERE D1.AUD_YR = D2.AUD_YR
	                                           AND D1.TSK_NO = D2.TSK_NO
	                                          ) D5 /*평가대상 감사활동 - 기준*/
	                                          , (
	                                            SELECT D8.AUD_TSK_KND_CD
	                                                 , D8.AUD_YR
	                                                 , D8.TSK_NO
	                                                 , D8.SYT_EVL_ADVL_VAL
	                                                 , D8.EVL_YR
	                                                 , D8.HLYR_DVSN_CD
	                                                 , D8.TSK_DVSN_CD
	                                                 , D8.EVL_RK_CD
	                                                 , D8.SYT_EVL_RK_CD
	                                                 , D8.EVL_STEP_CD
	                                                 , D8.SPE_ADD_SC
	                                                 , D8.MDT_ASC
	                                               FROM (
	                                                   SELECT EVL_YR
	                                                        , HLYR_DVSN_CD 
	                                                        , AUD_YR
	                                                        , TSK_NO
	                                                        , MAX(EVL_STEP_CD) AS EVL_STEP_CD
	                                                        , AUD_TSK_KND_CD
	                                                        , TSK_DVSN_CD
	                                                     FROM TBCSPAOE029M
	                                                   WHERE 1=1
	                                                   AND (AUD_YR,
                                                                   TSK_NO,
                                                                   EVL_STEP_CD) IN (SELECT AUD_YR,
                                                                   TSK_NO,
                                                                   MAX(EVL_STEP_CD)
                                                              FROM TBCSPAOE029M
                                                             WHERE (AUD_YR,
                                                                           TSK_NO) IN (SELECT AUD_YR ,
                                                                           TSK_NO
                                                                      FROM TBCSPAOE022M
                                                                     WHERE CMPT_DT IS NOT NULL
                                                                       AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                                     GROUP BY AUD_YR,
                                                                           TSK_NO )
                                                             GROUP BY AUD_YR,
                                                                   TSK_NO )
	                                                      AND TSK_DVSN_CD  = '10000'
	                                                      AND EVL_STA_CD   = '300' /*평가완료*/
	                                                    GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
	                                             ) D7
	                                             , TBCSPAOE029M D8
	                                            WHERE D7.EVL_YR = D8.EVL_YR
	                                              AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
	                                              AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
	                                              AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
	                                              AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
	                                              AND D7.AUD_YR = D8.AUD_YR
	                                              AND D7.TSK_NO = D8.TSK_NO	                                          
	                                        ) D6 /*감사사항 평가관리*/
	                                        , TBCSPAOE010D D7
	                                    WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
	                                      AND D5.AUD_YR          = D6.AUD_YR         (+)
	                                      AND D5.TSK_NO          = D6.TSK_NO         (+)
	                                      AND D6.EVL_YR = D7.EVL_YR (+) 
	                                      AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
	                                      AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
	                                      AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
	                                      AND D6.EVL_RK_CD = D7.RK_CD (+)		  
	                                  ) D9
	                              ) D10
	                              , TBCSPAOE023M D11
	                         WHERE D10.AUD_YR = D11.AUD_YR
	                           AND D10.TSK_NO = D11.TSK_NO
	                           AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD 
					         ]]>
								<isNotEmpty property="strNevltCnb">
									AND D11.PTCPT_CNB = #strNevltCnb#
								</isNotEmpty> 											
							<![CDATA[                                                  
	                           AND D11.CTB_RTE != 0
	                       ) D19
                       ) D20
                   )

                   UNION ALL 

                    SELECT MAN.NEVLT_CNB  AS PTCPT_CNB /*피평가자전산번호*/
                         , MAN.AUD_KND_NM /*종류*/
                         , JUMSU.TSK_NM     /*업무명*/
                         , JUMSU.PTCPT_CNB_CNT /*참여인원*/
                         , JUMSU.STND_ASC          /*표준평점*/
                         , JUMSU.EVL_RK_CD   /*평가등급*/
                         , JUMSU.IDVT_INDEX_VAL   /*가중치*/
                         , JUMSU.ADVL_ASC /*가중평점=표준평점*가중치*/
                         , '' AS TSK_ST_STEP_CD	/*단계기초*/
                         , '' AS TSK_END_STEP_CD	/*단계기말 */ 
                         , 0 AS DRIVE_RTE /*추진율 합*/
                         , 0 AS DRIVE_RTE_ASC /*추진율 조정평점=가중평점*추진율/100*/
                         , 0 AS DLAY_DT_NM_SUM /*지연일*/
                         , '' AS ASP_RTE /*가감점율*/
                         , 0 AS ASP_ASC /*가감평점=추진율조정평점*가감점율*/
                         , 0 AS SPE_ADD_SC    /*특별가산점*/
                         , JUMSU.NAUD_TSK_EVL_SC AS TSK_ASC   /*업무평점*/
                         , RTE.CTB_RTE  /*기여율*/
                         , MAN.PSN_TSK_ASC /*개인평점*/
                         , MAN.TSK_DVSN_CD    
                      FROM (
                        SELECT EVL_YR
                             , HLYR_DVSN_CD
                             , TSK_NO
                             , NEVLT_CNB /*피평가자전산번호*/
                             , TSK_DVSN_CD /*업무구분코드*/
                             , F_CODE_NM('1000272', AUD_TSK_KND_CD) AS AUD_KND_NM    /*감사종류코드*/
                             , AUD_TSK_KND_CD /*감사업무종류코드*/
                             , PSN_TSK_ASC /*개인평점*/
                             , DPT_CD
                             , RANK_CD
                          FROM TBCSPAOE035M
                        WHERE 1 = 1			        
                          AND TSK_DVSN_CD = '10001'
                          AND EVL_YR = #strEvlYr#
                          AND HLYR_DVSN_CD = #strHlyrDvsnCd#
       			         ]]>
							<isNotEmpty property="strNevltCnb">
								AND NEVLT_CNB = #strNevltCnb#
							</isNotEmpty> 											
						<![CDATA[              
                      ) MAN
                      , TBCSPAOE025M RTE
                      ,(
                        SELECT D3.EVL_YR
                             , D3.HLYR_DVSN_CD
                             , D3.TSK_KND_CD
                             , D3.TSK_NO
                             , D3.TSK_NM /*업무명*/
                             , D3.PTCPT_CNB_CNT /*참여인원*/
                             , D4.STND_ASC/*표준평점*/
                             , D5.EVL_RK_CD /*평가등급*/
                             , D6.IDVT_INDEX_VAL /*가중치*/
                             , ROUND(D4.STND_ASC * D6.IDVT_INDEX_VAL, 2) AS ADVL_ASC /*가중평점=표준평점*가중치*/
                             , (CASE 
                             	WHEN D3.TSK_KND_CD = '10006'
                             	THEN D5.NAUD_TSK_EVL_SC - D6.IDVT_INDEX_VAL 
                             	ELSE D5.NAUD_TSK_EVL_SC
                             END) AS NAUD_TSK_EVL_SC /*업무평점*/
                             , D5.TSK_DVSN_CD
                           FROM (
                            SELECT D1.EVL_YR
                                 , D1.HLYR_DVSN_CD
                                 , D1.TSK_KND_CD
                                 , D1.TSK_NO
                                 , MAX(D1.TSK_NM) AS TSK_NM /*업무명*/
                                 , COUNT(PTCPT_CNB) AS PTCPT_CNB_CNT /*참여인원*/
                              FROM TBCSPAOE024M D1
                                 , TBCSPAOE025M D2
                             WHERE D1.EVL_YR = D2.EVL_YR
                               AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                               AND D1.TSK_KND_CD = D2.TSK_KND_CD
                               AND D1.TSK_NO = D2.TSK_NO
                               AND D1.EVL_YR  = #strEvlYr#
                               AND D1.HLYR_DVSN_CD  = #strHlyrDvsnCd#                                    
                             GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.TSK_KND_CD, D1.TSK_NO
                            ) D3
                            , TBCSPAOE006M D4
                            , TBCSPAOE029M D5
                            , TBCSPAOE010D D6
                        WHERE D3.EVL_YR = D4.EVL_YR
                          AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
                          AND D4.TSK_DVSN_CD = '10001'
                          AND D3.TSK_KND_CD = D4.TSK_KND_CD
                          AND D3.EVL_YR = D5.EVL_YR
                          AND D3.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
                          AND D5.TSK_DVSN_CD = '10001'
                          AND D3.TSK_KND_CD = D5.AUD_TSK_KND_CD
                          AND D5.EVL_STEP_CD = '700'
                          AND D3.TSK_NO = D5.TSK_NO
                          AND D5.EVL_YR            = D6.EVL_YR         
                          AND D5.HLYR_DVSN_CD      = D6.HLYR_DVSN_CD    
                          AND D5.TSK_DVSN_CD       = D6.TSK_DVSN_CD      
                          AND D5.AUD_TSK_KND_CD    = D6.AUD_TSK_KND_CD  
                          AND D5.EVL_RK_CD         = D6.RK_CD     
                      ) JUMSU
                    WHERE MAN.EVL_YR = RTE.EVL_YR
                      AND MAN.HLYR_DVSN_CD = RTE.HLYR_DVSN_CD
                      AND MAN.AUD_TSK_KND_CD = RTE.TSK_KND_CD
                      AND MAN.TSK_NO = RTE.TSK_NO
                      AND MAN.NEVLT_CNB = RTE.PTCPT_CNB
                      AND MAN.EVL_YR = JUMSU.EVL_YR
                      AND MAN.HLYR_DVSN_CD = JUMSU.HLYR_DVSN_CD
                      AND MAN.TSK_NO = JUMSU.TSK_NO
                      AND MAN.TSK_DVSN_CD = JUMSU.TSK_DVSN_CD                         
                      AND RTE.CTB_RTE != 0
                  ) D15
                  ,(
                    SELECT PTCPT_CNB
                         , SUM(PSN_TSK_ASC) AS PSN_TSK_ASC_SUM
                      FROM (
                         SELECT PTCPT_CNB
                              /*, ROUND((DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC*/ /*개인평점*/
                               ,ROUND(STND_ASC * (CTB_RTE/100), 2) AS PSN_TSK_ASC
                          FROM (
	                        SELECT D20.PTCPT_CNB
	                             , D20.STND_ASC /*표준평점*/
	                             , D20.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
	                             , D20.DRIVE_RTE_SUM  /*추진율*/      
	                             , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/
	                             , D20.CTB_RTE
	                             , D20.DRIVE_RTE_ASC
	                             , D20.SPE_ADD_SC 
	                             , D20.MDT_ASC
	                         FROM (                         
	                            SELECT D19.PTCPT_CNB
	                                 , D19.STND_ASC
	                                 , D19.SYT_EVL_ADVL_VAL
	                                 , D19.DRIVE_RTE_SUM
	                                 , D19.CTB_RTE
	                                 , D19.AUD_KND_CD
	                                 , D19.AUD_STEP_CD_MAX
	                                 , D19.DLY_DT_SUM
	                                 , D19.DRIVE_RTE_ASC
	                                 , D19.SPE_ADD_SC 
	                                 , D19.MDT_ASC
	                                 , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2) 
	                                        ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/
	                                 , D19.AUD_YR
	                                 , D19.TSK_NO
	                             FROM (
	                                    SELECT D11.PTCPT_CNB
	                                         , D10.STND_ASC /*표준평점*/
	                                         , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
	                                         , D10.STND_ASC * D10.SYT_EVL_ADVL_VAL AS ADVL_ASC /*가중평점=표준평점*가중치*/
	                                         , D10.DRIVE_RTE_SUM  /*추진율*/      
	                                         , ( SELECT F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) FROM DUAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
	                                         , D10.DLY_DT_SUM /*지연일*/
	                                         , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/
	                                         , D11.CTB_RTE
	                                         , D10.AUD_KND_CD
	                                         , D10.AUD_STEP_CD_MAX
	                                         , D10.SPE_ADD_SC 
	                                         , D10.MDT_ASC
	                                         , D10.AUD_YR
	                                         , D10.TSK_NO
	                                     FROM (
	                                        SELECT AUD_KND_CD
	                                             , AUD_YR
	                                             , TSK_NO
	                                             , AUD_SBJ_NM
	                                             , AUD_STEP_CD_MIN
	                                             , AUD_STEP_CD_MAX
	                                             , MNDY_CNT
	                                             , NMPTCPT_CNT /*참여인원*/
	                                             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
	                                             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
	                                             , DRIVE_RTE_SUM  /*추진율*/      
	                                             , DLY_DT_SUM /*지연일*/
	                                             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
	                                             , EVL_YR
	                                             , HLYR_DVSN_CD
	                                             , SYT_TRTM_YN
	                                             , SPE_ADD_SC 
	                                             , MDT_ASC
	                                          FROM (
	                                            SELECT D5.AUD_KND_CD
	                                                 , D5.AUD_YR
	                                                 , D5.TSK_NO
	                                                 , D5.AUD_SBJ_NM
	                                                 , D5.AUD_STEP_CD_MIN
	                                                 , D5.AUD_STEP_CD_MAX
	                                                 , D5.MNDY_CNT
	                                                 , ( SELECT COUNT(*) FROM TBCSPAOE023M WHERE AUD_YR = D5.AUD_YR AND TSK_NO = D5.TSK_NO AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ) AS NMPTCPT_CNT /*참여인원*/
	                                                 , F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) AS STND_ASC /*표준평점*/
	                                                 , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
                                                                               , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
                                                                                                 AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
                                                                               , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                          
	                                                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
	                                                      FROM TBCSPAOE008D 
	                                                     WHERE EVL_YR        = #strEvlYr#
	                                                       AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
	                                                       AND TSK_DVSN_CD   = '10000' 
	                                                       AND AUD_KND_CD    = D5.AUD_KND_CD   
	                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
	                                                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM))
	                                                      FROM TBCSPAOE022M
	                                                     WHERE AUD_YR = D5.AUD_YR
	                                                       AND TSK_NO = D5.TSK_NO
	                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
	                                                 , NVL(D6.EVL_YR, #strEvlYr#) as EVL_YR
	                                                 , NVL(D6.HLYR_DVSN_CD ,#strHlyrDvsnCd#) as HLYR_DVSN_CD
	                                                 , D5.SYT_TRTM_YN
	                                                 , NVL(D6.SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_YR, D5.TSK_NO, D5.AUD_KND_CD)) AS SPE_ADD_SC
	                                                 , NVL(D6.MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_YR, D5.TSK_NO, D5.AUD_KND_CD)) AS MDT_ASC
	                                             FROM (
	                                                    SELECT D2.HNDL_DIV_DPT_CD
	                                                         , D2.SPVR_CNB
	                                                         , D2.AUD_KND_CD
	                                                         , D2.AUD_YR
	                                                         , D2.TSK_NO
	                                                         , D2.AUD_SBJ_NM
	                                                         , D1.AUD_STEP_CD_MIN
	                                                         , D1.AUD_STEP_CD_MAX
	                                                         , D2.MNDY_CNT
	                                                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
	                                                      FROM (
	                                                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
	                                                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
	                                                             , AUD_YR
	                                                             , TSK_NO
	                                                          FROM TBCSPAOE022M
	                                                         WHERE CMPT_DT IS NOT NULL
	                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
	                                                         GROUP BY AUD_YR, TSK_NO
	                                                     ) D1
	                                                     , TBCSPAOE021M D2
	                                                 WHERE D1.AUD_YR = D2.AUD_YR
	                                                   AND D1.TSK_NO = D2.TSK_NO
	                                                  ) D5 /*평가대상 감사활동 - 기준*/
	                                                  , (
	                                                    SELECT D8.AUD_TSK_KND_CD
	                                                         , D8.AUD_YR
	                                                         , D8.TSK_NO
	                                                         , D8.SYT_EVL_ADVL_VAL
	                                                         , D8.EVL_YR
	                                                         , D8.HLYR_DVSN_CD
	                                                         , D8.TSK_DVSN_CD
	                                                         , D8.EVL_RK_CD
	                                                         , D8.SYT_EVL_RK_CD
	                                                         , D8.EVL_STEP_CD
	                                                         , D8.SPE_ADD_SC
	                                                         , D8.MDT_ASC
	                                                       FROM (
	                                                           SELECT EVL_YR
	                                                                , HLYR_DVSN_CD
	                                                                , AUD_YR
	                                                                , TSK_NO
	                                                                , MAX(EVL_STEP_CD) AS EVL_STEP_CD
	                                                                , AUD_TSK_KND_CD
	                                                                , TSK_DVSN_CD
	                                                             FROM TBCSPAOE029M
	                                                            WHERE 1=1
	                                                            AND (AUD_YR,
                                                                                       TSK_NO,
                                                                                       EVL_STEP_CD) IN (SELECT AUD_YR,
                                                                                       TSK_NO,
                                                                                       MAX(EVL_STEP_CD)
                                                                                  FROM TBCSPAOE029M
                                                                                 WHERE (AUD_YR,
                                                                                               TSK_NO) IN (SELECT AUD_YR ,
                                                                                               TSK_NO
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE CMPT_DT IS NOT NULL
                                                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                                                         GROUP BY AUD_YR,
                                                                                               TSK_NO )
                                                                                 GROUP BY AUD_YR,
                                                                                       TSK_NO )
	                                                              AND TSK_DVSN_CD = '10000'
	                                                              AND EVL_STA_CD   = '300' /*평가완료*/
	                                                            GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
	                                                     ) D7
	                                                     , TBCSPAOE029M D8
	                                                    WHERE D7.EVL_YR = D8.EVL_YR
	                                                      AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
	                                                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
	                                                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
	                                                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
	                                                      AND D7.AUD_YR = D8.AUD_YR
	                                                      AND D7.TSK_NO = D8.TSK_NO	                                          
	                                                ) D6 /*감사사항 평가관리*/
	                                                , TBCSPAOE010D D7
	                                            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD (+)
	                                              AND D5.AUD_YR          = D6.AUD_YR         (+)
	                                              AND D5.TSK_NO          = D6.TSK_NO         (+)
	                                              AND D6.EVL_YR = D7.EVL_YR (+) 
	                                              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
	                                              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
	                                              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
	                                              AND D6.EVL_RK_CD = D7.RK_CD (+)		  
	                                          ) D9
	                                      ) D10
	                                      , TBCSPAOE023M D11
	                                 WHERE D10.AUD_YR = D11.AUD_YR
	                                   AND D10.TSK_NO = D11.TSK_NO
	                                   AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD   
							         ]]>
										<isNotEmpty property="strNevltCnb">
											AND D11.PTCPT_CNB = #strNevltCnb#
										</isNotEmpty> 											
									<![CDATA[                                                     
	                                   AND D11.CTB_RTE != 0
	                               ) D19
                               ) D20
                           )                     
                         UNION ALL 
                            
                         /*감사외업무 개인별 총 점*/
                         SELECT NEVLT_CNB
                              , PSN_TSK_ASC
                          FROM TBCSPAOE035M
                          WHERE 1 = 1
                            AND EVL_YR = #strEvlYr#
                            AND HLYR_DVSN_CD = #strHlyrDvsnCd#
       			         ]]>
							<isNotEmpty property="strNevltCnb">
								AND NEVLT_CNB = #strNevltCnb#
							</isNotEmpty> 					         										
						<![CDATA[                     		      
                           AND TSK_DVSN_CD = '10001'
                     )
                    GROUP BY PTCPT_CNB                  
                  ) D17
                  , TBDCMACM001M D16
              WHERE D15.PTCPT_CNB = D17.PTCPT_CNB
                AND D15.PTCPT_CNB = D16.CNB
              ORDER BY NEVLT_NM
		]]>
	</select>
	<!-- ############################# 개인별 업무실적 명세 끝 (CSPAOE066Q) ##################################### -->

	<!-- ############################# 지원부서 개인별 평점관리 시작 (CSPAOE069Q) ############################### -->
	<select id="CSPAOE069Qmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			WITH DATA
			AS
			(
				SELECT 
					  #strEvlYr# AS EVL_YR
					, #strHlyrDvsnCd# AS HLYR_DVSN_CD
					, D15.PTCPT_CNB AS NEVLT_CNB /*피평가자전산번호*/
					, D15.TSK_DVSN_CD
					, D15.PSN_TSK_ASC /*개인평점*/
				FROM
					(SELECT 
						  PTCPT_CNB
						, AUD_KND_NM    /*감사종류코드*/
						, AUD_SBJ_NM
						, NMPTCPT_CNT   /*참여인원*/
						, STND_ASC /*표준평점*/
						, SYT_EVL_RK_CD
						, SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
						, ADVL_ASC /*가중평점=표준평점*가중치*/
						, AUD_STEP_CD_MIN
						, AUD_STEP_CD_MAX
						, DRIVE_RTE_SUM  /*추진율*/      
						, DRIVE_RTE_ASC /*추진율 조정평점*/
						, DLY_DT_SUM /*지연일*/
						, (CASE 
							WHEN INSTR(DLY_DT_SUM, '-') = 0 AND ASP_RTE = 0 
							THEN '0.00'
							WHEN INSTR(DLY_DT_SUM, '-') = 0 
							THEN TO_CHAR(ASP_RTE,'FM99990.00')
							ELSE '-' || TO_CHAR(ASP_RTE,'FM99990.00') 
						END) AS ASP_RTE  /*가감점율*/
						, ASP_STND_ASC /*가감평점*/
						, SPE_ADD_SC /*특별가산점*/      
						, ROUND(STND_ASC, 2) AS TSK_ASC /*업무평점 = 표준평점 * 평가등급별가중치 * 감사단계별추진율 + (가감평점) + 특별가산점 + 조정평점(조정평점은 사용하지 않는다고 했다. 하지만 혹시 모르니 일단 더하는 방식으로 간다.)*/
						, CTB_RTE
						, ROUND((STND_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC /*개인평점*/
						, TSK_DVSN_CD
					FROM
						(SELECT 
							  D20.PTCPT_CNB
							, F_CODE_NM('1000270', D20.AUD_KND_CD) AS AUD_KND_NM 
							, D20.AUD_SBJ_NM
							, D20.NMPTCPT_CNT /*참여인원*/
							, D20.STND_ASC /*표준평점*/
							, D20.SYT_EVL_RK_CD
							, D20.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
							, D20.ADVL_ASC /*가중평점=표준평점*가중치*/
							, D20.AUD_STEP_CD_MIN
							, D20.AUD_STEP_CD_MAX
							, D20.DRIVE_RTE_SUM  /*추진율*/      
							, D20.DRIVE_RTE_ASC /*추진율 조정평점*/
							, D20.DLY_DT_SUM /*지연일*/
							, D20.ASP_RTE  /*가감점율*/
							, F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/
							, D20.SPE_ADD_SC /*특별가산점*/     
							, D20.MDT_ASC /*조정평점*/ 
							, D20.CTB_RTE
							, D20.MNDY_CNT
							, '10000' AS TSK_DVSN_CD
						FROM                        
							(SELECT 
								  D19.PTCPT_CNB
								, D19.AUD_KND_CD /*감사종류코드*/
								, D19.AUD_SBJ_NM
								, D19.NMPTCPT_CNT /*참여인원*/
								, D19.STND_ASC /*표준평점*/
								, D19.SYT_EVL_RK_CD
								, D19.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
								, D19.ADVL_ASC /*가중평점=표준평점*가중치*/
								, D19.AUD_STEP_CD_MIN
								, D19.AUD_STEP_CD_MAX
								, D19.DRIVE_RTE_SUM  /*추진율*/      
								, D19.DRIVE_RTE_ASC /*추진율 조정평점*/
								, D19.DLY_DT_SUM /*지연일*/
								, D19.ASP_RTE  /*가감점율*/
								, DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0, '-', '') || 
									CASE 
										WHEN D19.DRIVE_RTE_ASC IS NOT NULL 
										THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2) 
										ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0) / 100), 2) 
									END)
								) AS ASP_STND_ASC /*가감평점*/
								, D19.SPE_ADD_SC /*특별가산점*/     
								, D19.MDT_ASC /*조정평점*/ 
								, D19.CTB_RTE
								, D19.MNDY_CNT
								, D19.AUD_YR
								, D19.TSK_NO
							FROM
								(SELECT 
									  D10.PTCPT_CNB
									, D10.AUD_KND_CD    /*감사종류코드*/
									, D10.AUD_SBJ_NM
									, D10.NMPTCPT_CNT /*참여인원*/
									, D10.STND_ASC /*표준평점*/
									, D10.SYT_EVL_RK_CD
									, D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
									, D10.STND_ASC * D10.SYT_EVL_ADVL_VAL AS ADVL_ASC /*가중평점=표준평점*가중치*/
									, D10.AUD_STEP_CD_MIN
									, D10.AUD_STEP_CD_MAX
									, D10.DRIVE_RTE_SUM  /*추진율*/      
									, F_AOE_DRIVE_RTE_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL, F_AOE_STND_ASC) AS DRIVE_RTE_ASC /*추진율 조정평점*/
									, D10.DLY_DT_SUM /*지연일*/
									, NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/
									, D10.SPE_ADD_SC /*특별가산점*/      
									, D10.MDT_ASC /*조정평점*/
									, D10.CTB_RTE
									, D10.MNDY_CNT
									, D10.AUD_YR
									, D10.TSK_NO
								FROM
									(SELECT 
										  HNDL_DIV_DPT_CD
										, SPVR_CNB
										, AUD_KND_CD
										, AUD_YR
										, TSK_NO
										, AUD_SBJ_NM
										, AUD_STEP_CD_MIN
										, AUD_STEP_CD_MAX
										, MNDY_CNT
										, NMPTCPT_CNT /*참여인원*/
										, NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
										, SYT_EVL_RK_CD
										, NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
										, DRIVE_RTE_SUM  /*추진율*/      
										, DLY_DT_SUM /*지연일*/
										, (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
										, NVL(SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS SPE_ADD_SC
										, NVL(MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS MDT_ASC
										, EVL_YR
										, HLYR_DVSN_CD
										, SYT_TRTM_YN
										, PTCPT_CNB
										, CTB_RTE
										, F_AOE_STND_ASC
									FROM
										(SELECT 
											  D5.HNDL_DIV_DPT_CD
											, D5.SPVR_CNB
											, D5.AUD_KND_CD
											, D5.AUD_YR
											, D5.TSK_NO
											, D5.AUD_SBJ_NM
											, D5.AUD_STEP_CD_MIN
											, D5.AUD_STEP_CD_MAX
											, D5.MNDY_CNT
											, (SELECT COUNT(*) FROM TBCSPAOE023M WHERE AUD_YR = D5.AUD_YR AND TSK_NO = D5.TSK_NO AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ) AS NMPTCPT_CNT /*참여인원*/
											, F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) AS STND_ASC /*표준평점*/
											, DECODE(NVL(D6.EVL_STEP_CD, 'X'), '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL, 'X', (SELECT IDVT_INDEX_VAL 
																																			 FROM TBCSPAOE010D 
																																			WHERE EVL_YR = #strEvlYr# 
																																			  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
																																			  AND TSK_DVSN_CD = '10000' 
																																			  AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
																																			  AND RK_CD = (SELECT ELY_ADPT_STAD_RK_CD 
																																							 FROM TBCSPAOE008D 
																																							WHERE EVL_YR = #strEvlYr# 
																																							  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
																																							  AND TSK_DVSN_CD = '10000' 
																																							  AND AUD_KND_CD = D5.AUD_KND_CD 
																																							  AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX)
																																			), 0
											) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                                                                
											, DECODE(NVL(D6.EVL_STEP_CD, 'X'), '100', D6.EVL_RK_CD, '200', D6.SYT_EVL_RK_CD, 'X', (SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ), 0) AS SYT_EVL_RK_CD
											, (SELECT NVL(SUM(DRIVE_RTE), 0) 
												 FROM TBCSPAOE008D 
												WHERE 1 = 1
												  AND AUD_KND_CD   = D5.AUD_KND_CD
												  AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX 
												  AND EVL_YR       = #strEvlYr#
												  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
												  AND TSK_DVSN_CD  = '10000'
											) AS DRIVE_RTE_SUM  /*추진율*/      
											, (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
												 FROM TBCSPAOE022M Z
												WHERE AUD_YR = D5.AUD_YR
												  AND TSK_NO = D5.TSK_NO
												  AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX
											) AS DLY_DT_SUM /*지연일*/
											, D6.SPE_ADD_SC
											, D6.MDT_ASC
											, D6.EVL_YR
											, D6.HLYR_DVSN_CD
											, D5.SYT_TRTM_YN
											, D8.PTCPT_CNB
											, D8.CTB_RTE
											, D5.F_AOE_STND_ASC
										FROM
											(SELECT 
												  D2.HNDL_DIV_DPT_CD
												, D2.SPVR_CNB
												, D2.AUD_KND_CD
												, D2.AUD_YR
												, D2.TSK_NO
												, D2.AUD_SBJ_NM
												, D1.AUD_STEP_CD_MIN
												, D1.AUD_STEP_CD_MAX
												, D2.MNDY_CNT
												, NVL(D3.SYT_TRTM_YN, 'N') AS SYT_TRTM_YN /*종합처리안 여부*/
												, F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D2.AUD_KND_CD, D1.AUD_STEP_CD_MIN, D1.AUD_STEP_CD_MAX, D2.MNDY_CNT,NVL(D3.SYT_TRTM_YN, 'N')) AS F_AOE_STND_ASC
												, ROWNUM AS RN
											FROM 
												(SELECT 
													  MIN(A.AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
													, MAX(A.AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
													, A.AUD_YR
													, A.TSK_NO
												FROM TBCSPAOE022M A, TBCSPAOE001M B
												WHERE 1 = 1
												AND A.CMPT_DT IS NOT NULL
												AND A.CMPT_DT BETWEEN B.EVL_STR_DT AND B.EVL_END_DT
												AND B.EVL_YR = #strEvlYr#
												AND B.HLYR_DVSN_CD = #strHlyrDvsnCd#
												GROUP BY AUD_YR, TSK_NO) D1
												, TBCSPAOE021M D2
												, TBCSPAOE022M D3
											WHERE D1.AUD_YR = D2.AUD_YR
											AND D1.TSK_NO = D2.TSK_NO
											AND D3.AUD_YR(+) = D1.AUD_YR
											AND D3.TSK_NO(+) = D1.TSK_NO
											AND D3.AUD_STEP_CD(+) = '10004' 
											) D5 /*평가대상 감사활동 - 기준*/
											, (SELECT 
												  D8.AUD_TSK_KND_CD
												, D8.AUD_YR
												, D8.TSK_NO
												, D8.SYT_EVL_ADVL_VAL
												, D8.EVL_YR
												, D8.HLYR_DVSN_CD
												, D8.TSK_DVSN_CD
												, D8.EVL_RK_CD
												, D8.SYT_EVL_RK_CD
												, D8.EVL_STEP_CD
												, D8.SPE_ADD_SC
												, D8.MDT_ASC
											FROM 
												(SELECT 
													  EVL_YR
													, HLYR_DVSN_CD 
													, AUD_YR
													, TSK_NO
													, MAX(EVL_STEP_CD) AS EVL_STEP_CD
													, AUD_TSK_KND_CD
													, TSK_DVSN_CD
												FROM TBCSPAOE029M
												WHERE 1 = 1
												AND (AUD_YR,
                                                                TSK_NO,
                                                                EVL_STEP_CD) IN (SELECT AUD_YR,
                                                                TSK_NO,
                                                                MAX(EVL_STEP_CD)
                                                           FROM TBCSPAOE029M
                                                          WHERE (AUD_YR,
                                                                        TSK_NO) IN (SELECT AUD_YR ,
                                                                        TSK_NO
                                                                   FROM TBCSPAOE022M
                                                                    , ( SELECT EVL_STR_DT, EVL_END_DT 
                                                FROM TBCSPAOE001M 
                                                WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# ) SS
                                                                  WHERE CMPT_DT IS NOT NULL
                                                                    AND CMPT_DT BETWEEN SS.EVL_STR_DT AND SS.EVL_END_DT
                                                                  GROUP BY AUD_YR,
                                                                        TSK_NO )
                                                          GROUP BY AUD_YR,
                                                                TSK_NO )
												AND TSK_DVSN_CD  = '10000'
												AND EVL_STA_CD   = '300' /*평가완료*/
												GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
												) D7
												, TBCSPAOE029M D8
											WHERE D7.EVL_YR = D8.EVL_YR
											AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
											AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
											AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
											AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
											AND D7.AUD_YR = D8.AUD_YR
											AND D7.TSK_NO = D8.TSK_NO	                                          
											) D6 /*감사사항 평가관리*/
											, TBCSPAOE010D D7
											, TBCSPAOE023M D8
										WHERE D5.AUD_KND_CD   = D6.AUD_TSK_KND_CD (+)
										AND D5.AUD_YR         = D6.AUD_YR         (+)
										AND D5.TSK_NO         = D6.TSK_NO         (+)
										AND D6.EVL_YR         = D7.EVL_YR         (+) 
										AND D6.HLYR_DVSN_CD   = D7.HLYR_DVSN_CD   (+)
										AND D6.TSK_DVSN_CD    = D7.TSK_DVSN_CD    (+) 
										AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
										AND D6.EVL_RK_CD      = D7.RK_CD          (+)	
										AND D8.AUD_YR      = D5.AUD_YR
										AND D8.TSK_NO      = D5.TSK_NO
										AND D8.AUD_STEP_CD = D5.AUD_STEP_CD_MAX           
										AND D8.CTB_RTE     != 0	  
										) D9
									) D10
								) D19
							) D20
						)
	
					UNION ALL 
	
					SELECT 
						  MAN.NEVLT_CNB  AS PTCPT_CNB /*피평가자전산번호*/
						, MAN.AUD_KND_NM /*종류*/
						, JUMSU.TSK_NM     /*업무명*/
						, JUMSU.PTCPT_CNB_CNT /*참여인원*/
						, JUMSU.STND_ASC          /*표준평점*/
						, JUMSU.EVL_RK_CD   /*평가등급*/
						, JUMSU.IDVT_INDEX_VAL   /*가중치*/
						, JUMSU.ADVL_ASC /*가중평점=표준평점*가중치*/
						, '' AS TSK_ST_STEP_CD	/*단계기초*/
						, '' AS TSK_END_STEP_CD	/*단계기말 */ 
						, 0 AS DRIVE_RTE /*추진율 합*/
						, 0 AS DRIVE_RTE_ASC /*추진율 조정평점=가중평점*추진율/100*/
						, 0 AS DLAY_DT_NM_SUM /*지연일*/
						, '' AS ASP_RTE /*가감점율*/
						, 0 AS ASP_ASC /*가감평점=추진율조정평점*가감점율*/
						, 0 AS SPE_ADD_SC    /*특별가산점*/
						, JUMSU.NAUD_TSK_EVL_SC AS TSK_ASC   /*업무평점*/
						, RTE.CTB_RTE  /*기여율*/
						, MAN.PSN_TSK_ASC /*개인평점*/
						, MAN.TSK_DVSN_CD    
					FROM 
						(SELECT 
							  EVL_YR
							, HLYR_DVSN_CD
							, TSK_NO
							, NEVLT_CNB /*피평가자전산번호*/
							, TSK_DVSN_CD /*업무구분코드*/
							, F_CODE_NM('1000272', AUD_TSK_KND_CD) AS AUD_KND_NM    /*감사종류코드*/
							, AUD_TSK_KND_CD /*감사업무종류코드*/
							, PSN_TSK_ASC /*개인평점*/
							, DPT_CD
							, RANK_CD
						FROM TBCSPAOE035M
						WHERE 1 = 1			        
						AND TSK_DVSN_CD = '10001'
						AND EVL_YR = #strEvlYr#
						AND HLYR_DVSN_CD = #strHlyrDvsnCd#
					]]>
						<isNotEmpty property="strEvlCnb">
						AND NEVLT_CNB = #strEvlCnb#     
						</isNotEmpty> 					         										
					<![CDATA[					
						) MAN
						, TBCSPAOE025M RTE
						, (SELECT 
							  D3.EVL_YR
							, D3.HLYR_DVSN_CD
							, D3.TSK_KND_CD
							, D3.TSK_NO
							, D3.TSK_NM /*업무명*/
							, D3.PTCPT_CNB_CNT /*참여인원*/
							, D4.STND_ASC/*표준평점*/
							, D5.EVL_RK_CD /*평가등급*/
							, D6.IDVT_INDEX_VAL /*가중치*/
							, ROUND(D4.STND_ASC * D6.IDVT_INDEX_VAL, 2) AS ADVL_ASC /*가중평점=표준평점*가중치*/
							, D5.NAUD_TSK_EVL_SC /*업무평점*/
							, D5.TSK_DVSN_CD
						FROM 
							(SELECT 
								  D1.EVL_YR
								, D1.HLYR_DVSN_CD
								, D1.TSK_KND_CD
								, D1.TSK_NO
								, MAX(D1.TSK_NM) AS TSK_NM /*업무명*/
								, COUNT(PTCPT_CNB) AS PTCPT_CNB_CNT /*참여인원*/
								, max(rownum) as rn
							FROM 
								  TBCSPAOE024M D1
								, TBCSPAOE025M D2
							WHERE D1.EVL_YR = D2.EVL_YR
							AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
							AND D1.TSK_KND_CD = D2.TSK_KND_CD
							AND D1.TSK_NO = D2.TSK_NO
							AND D1.EVL_YR  = #strEvlYr#
							AND D1.HLYR_DVSN_CD  = #strHlyrDvsnCd#                                   
							GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.TSK_KND_CD, D1.TSK_NO) D3
							, TBCSPAOE006M D4
							, TBCSPAOE029M D5
							, TBCSPAOE010D D6
						WHERE D3.EVL_YR = D4.EVL_YR
						AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
						AND D4.TSK_DVSN_CD = '10001'
						AND D3.TSK_KND_CD = D4.TSK_KND_CD
						AND D3.EVL_YR = D5.EVL_YR
						AND D3.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
						AND D3.TSK_KND_CD = D5.AUD_TSK_KND_CD
						AND D3.TSK_NO = D5.TSK_NO
						AND D5.TSK_DVSN_CD = '10001'
						AND D5.EVL_STEP_CD = '700'
						AND D5.EVL_YR        = D6.EVL_YR         
						AND D5.HLYR_DVSN_CD   = D6.HLYR_DVSN_CD    
						AND D5.TSK_DVSN_CD    = D6.TSK_DVSN_CD      
						AND D5.AUD_TSK_KND_CD = D6.AUD_TSK_KND_CD  
						AND D5.EVL_RK_CD      = D6.RK_CD     
						) JUMSU
					WHERE MAN.EVL_YR = RTE.EVL_YR
					AND MAN.HLYR_DVSN_CD = RTE.HLYR_DVSN_CD
					AND MAN.AUD_TSK_KND_CD = RTE.TSK_KND_CD
					AND MAN.TSK_NO = RTE.TSK_NO
					AND MAN.NEVLT_CNB = RTE.PTCPT_CNB
					AND MAN.EVL_YR = JUMSU.EVL_YR||''
					AND MAN.HLYR_DVSN_CD = JUMSU.HLYR_DVSN_CD||''
					AND MAN.TSK_NO = JUMSU.TSK_NO||''
					AND MAN.TSK_DVSN_CD = JUMSU.TSK_DVSN_CD||''                         
					AND RTE.CTB_RTE != 0
					) D15
					, TBDCMACM001M D16
				WHERE 1 = 1
				AND D15.PTCPT_CNB = D16.CNB
			]]>
				<isNotEmpty property="strEvlCnb">
				AND D15.PTCPT_CNB =  #strEvlCnb#  
				</isNotEmpty> 					         										
			<![CDATA[
				ORDER BY D15.PTCPT_CNB, D15.TSK_DVSN_CD
			)
	
			SELECT 
				  F_DPT_INFO(DPT_CD, '1') || CASE WHEN DPT_TP_CD IS NOT NULL THEN '(' || DECODE(DPT_TP_CD, 'S', 'Y', 'A', 'A', 'E', 'E', '') || ')' ELSE NULL END AS BLT_DPT_NM /*현부서명*/
				, F_DPT_INFO(UP_DPT_CD, '1') AS UP_DPT_NM
				, F_CODE_NM('1000173', RANK_CD) AS RANK_NM /*현 직급명*/
				, USR_NAM AS NAM /*성명*/
				, PTCPT_CNB AS NEVLT_CNB
				, PSN_TSK_ASC AS PSN_TSK_ASC /*개인평점환산 = 부서총점환산 * 기여율 / 100*/
				, AUD_SPRT_ASC /*감사지원*/
				, PSN_TSK_ASC_OTHER /*감사외*/
				, PSN_TSK_ASC_ALL AS PSN_TSK_ASC_ALL /*개인종합평점*/
				, TO_CHAR(ROUND(NVL(CTB_RTE_AVG, 0), 2), 'FM999.00') AS CTB_RTE_AVG /* 기여도 합계 */
				, DECODE(DPT_DVSN_CD, '10', 'A', '20', 'S', '') || '(' || F_DPT_INFO(EVL_DPT_CD, '1') || ')' AS EVL_DPT_NM /*평가부서명*/
				, F_DPT_INFO(EVL_UP_DPT_CD, '1') AS EVL_UP_DPT_NM
				, DECODE(EVL_TG_YN, 'Y', TO_CHAR(RANK_NUM), '평가제외') AS RANK_NUM /*직급별순위*/
				, EVL_TG_YN /*평가제외여부*/
				, RMK
				, EVL_YR 
				, HLYR_DVSN_CD
			FROM 
				(SELECT 
					  D14.DPT_DVSN_CD /*평가종료일 부서구분*/
					, D14.EVL_DPT_CD /*평가종료일 부서코드*/
					, (SELECT HIRK_DPT_CD FROM TBDCMACM002M WHERE DPT_CD = D14.EVL_DPT_CD) AS EVL_UP_DPT_CD
					, D14.PTCPT_CNB
					, D14.RANK_CD
					, D14.USR_NAM
					, D14.PSN_TSK_ASC /*개인평점환산 = 부서총점환산 * 기여율 / 100*/
					, D14.AUD_SPRT_ASC /*감사지원*/
					, D14.PSN_TSK_ASC_OTHER /*감사외*/
					, D14.PSN_TSK_ASC_ALL
					, D14.CTB_RTE_AVG
					, D14.DPT_TP_CD /*현 부서구분*/
					, D14.UP_DPT_CD /*현 부서 국과*/
					, D14.DPT_CD /*현부서 과팀*/
					, D14.EVL_YR 
					, D14.HLYR_DVSN_CD 
					, D14.EVL_TG_YN
					, D14.RMK
					, RANK() OVER(PARTITION BY D14.RANK_CD, D14.EVL_TG_YN ORDER BY D14.PSN_TSK_ASC_ALL DESC) AS RANK_NUM 
				FROM
					(SELECT 
						  D2.DPT_DVSN_CD
						, D2.EVL_DPT_CD
						, D2.CNB AS PTCPT_CNB
						, D2.RANK_CD
						, D3.USR_NAM
						, D4.HIRK_DPT_CD AS UP_DPT_CD
						, D3.DPT_CD
						, D4.DPT_TP_CD AS DPT_TP_CD
						, D2.EVL_YR 
						, D2.HLYR_DVSN_CD 
						, D2.EVL_TG_YN
						, D2.RMK
						, DECODE(D2.EVL_TG_YN, 'N', 0, NVL(D1.PSN_TSK_ASC, 0)) AS PSN_TSK_ASC /*개인평점환산 = 부서총점환산 * 기여율 / 100*/
						, DECODE(D2.EVL_TG_YN, 'N', 0, NVL(D1.AUD_SPRT_ASC, 0)) AS AUD_SPRT_ASC /*감사지원*/
						, DECODE(D2.EVL_TG_YN, 'N', 0, NVL(D1.PSN_TSK_ASC_OTHER, 0)) AS PSN_TSK_ASC_OTHER /*감사외*/
						, DECODE(D2.EVL_TG_YN, 'N', 0, NVL(D1.PSN_TSK_ASC, 0)) + DECODE(D2.EVL_TG_YN, 'N', 0, NVL(D1.AUD_SPRT_ASC, 0)) + DECODE(D2.EVL_TG_YN, 'N', 0, NVL(D1.PSN_TSK_ASC_OTHER, 0)) AS PSN_TSK_ASC_ALL /*개인종합평점*/
						, D1.CTB_RTE_AVG
					FROM 
						(SELECT 
							  A.EVL_YR
							, A.HLYR_DVSN_CD
							, A.PTCPT_CNB
							, SUM(A.AUD_SPRT_ASC) AS AUD_SPRT_ASC
							, SUM(A.PSN_TSK_ASC_OTHER) AS PSN_TSK_ASC_OTHER
							, SUM(A.PSN_TSK_ASC) AS PSN_TSK_ASC
							, SUM(A.CTB_RTE_AVG) AS CTB_RTE_AVG
						FROM		
							(SELECT 
								  A.EVL_YR AS EVL_YR
								, A.HLYR_DVSN_CD AS HLYR_DVSN_CD
								, A.PTCPT_CNB AS PTCPT_CNB
								, NVL(SUM(ROUND(A.PSN_TSK_ASC_DEPT * A.CTB_RTE_AVG / 100, 2)), 0) AS PSN_TSK_ASC
								, 0 AS AUD_SPRT_ASC
								, 0 AS PSN_TSK_ASC_OTHER
								, A.CTB_RTE_AVG
							FROM 
								(SELECT 
									  A.EVL_YR
									, A.HLYR_DVSN_CD
									, A.CHR_DPT_CD
									, A.PTCPT_CNB
									, A.CTB_RTE_AVG
									, F_AOE_DPT_TSC(A.EVL_YR, A.HLYR_DVSN_CD, A.CHR_DPT_CD) AS PSN_TSK_ASC_DEPT
								FROM
									(SELECT 
										  SUM(D1.WGT_RTE * D2.CTB_RTE / 100) AS CTB_RTE_AVG  /*기여율 = 비중 * 기여율 / 100*/
										, D2.PTCPT_CNB
										, D1.EVL_YR
										, D1.HLYR_DVSN_CD
										, D1.CHR_DPT_CD
									FROM 
										  TBCSPAOE026M D1
										, TBCSPAOE027M D2
									WHERE D1.EVL_YR = D2.EVL_YR
									AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
									AND D1.CHR_DPT_CD = CASE WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '141' THEN '141000' 
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '121' THEN '121000' 
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '122' AND D2.CHR_DPT_CD = '122500' THEN D2.CHR_DPT_CD
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '122' AND D2.CHR_DPT_CD <> '122500' THEN '122000'
                                    ELSE D2.CHR_DPT_CD END
									AND D1.TSK_NO = D2.TSK_NO
									AND D1.EVL_YR = #strEvlYr#
									AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
									AND D2.PTCPT_CNB IN (SELECT CNB FROM TBCSPAOE041M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND DPT_DVSN_CD = '20') /*2015.03.30 권효정 감사관 요청사항*/
									GROUP BY D2.PTCPT_CNB, D1.EVL_YR, D1.HLYR_DVSN_CD, D1.CHR_DPT_CD, D2.CTB_RTE
									) A
								) A
							GROUP BY A.EVL_YR, A.HLYR_DVSN_CD, A.PTCPT_CNB, A.CTB_RTE_AVG
										
							UNION ALL
				
							SELECT 
								  D10.EVL_YR AS EVL_YR
								, D10.HLYR_DVSN_CD AS HLYR_DVSN_CD
								, D10.PTCPT_CNB AS PTCPT_CNB
								, 0 AS PSN_TSK_ASC    
								, SUM(D10.AUD_SPRT_ASC) AS AUD_SPRT_ASC /*감사지원*/
								, SUM(D10.PSN_TSK_ASC_OTHER) AS PSN_TSK_ASC_OTHER /*감사외*/
								, 0 AS CTB_RTE_AVG
							FROM
								(SELECT 
									  D6.NEVLT_CNB AS PTCPT_CNB
									, D6.AUD_SPRT_ASC /*감사지원*/
									, D6.PSN_TSK_ASC_OTHER /*감사외*/
									, D6.EVL_YR 
									, D6.HLYR_DVSN_CD
								FROM 
									(
										SELECT
											  A.EVL_YR
											, A.HLYR_DVSN_CD
											, A.NEVLT_CNB /*피평가자전산번호*/
											, ROUND(NVL(SUM(DECODE(A.TSK_DVSN_CD, '10000', A.PSN_TSK_ASC, 0)), 0), 2) AS AUD_SPRT_ASC
											, ROUND(NVL(SUM(DECODE(A.TSK_DVSN_CD, '10001', A.PSN_TSK_ASC, 0)), 0), 2) AS PSN_TSK_ASC_OTHER
										FROM
											DATA A
										WHERE 1 = 1
									]]>
										<isNotEmpty property="strEvlCnb">
										AND A.NEVLT_CNB = #strEvlCnb#
										</isNotEmpty> 					         										
									<![CDATA[
										GROUP BY A.EVL_YR, A.HLYR_DVSN_CD, A.NEVLT_CNB
									) D6
								) D10
								GROUP BY D10.PTCPT_CNB, D10.EVL_YR, D10.HLYR_DVSN_CD 
							) A
							GROUP BY A.EVL_YR , A.HLYR_DVSN_CD, A.PTCPT_CNB) D1
							, (SELECT 
								  EVL_YR
								, HLYR_DVSN_CD
								, DPT_DVSN_CD
								, EVL_DPT_CD
								, EVL_TG_YN
								, CNB
								, RMK
								, RANK_CD
							FROM TBCSPAOE041M
							WHERE EVL_YR = #strEvlYr#
							AND HLYR_DVSN_CD = #strHlyrDvsnCd#       
							AND DPT_DVSN_CD = '20'      
							) D2
							, TBDCMACM001M D3
							, TBDCMACM002M D4
						WHERE D1.PTCPT_CNB (+) = D2.CNB
						AND D2.CNB = D3.CNB
						AND D3.DPT_CD = D4.DPT_CD
					) D14
					ORDER BY DECODE(D14.EVL_TG_YN, 'Y', 0, 1), D14.RANK_CD, RANK_NUM
				) D15
			WHERE 1 = 1
         ]]>
		<isNotEmpty property="strEvlCnb">
			AND PTCPT_CNB = #strEvlCnb#
		</isNotEmpty>
		<isNotEmpty property="strDeptUpCd">
			AND EVL_UP_DPT_CD = #strDeptUpCd#
		</isNotEmpty>
		<isNotEmpty property="strDeptCd">
			AND EVL_DPT_CD = #strDeptCd#
		</isNotEmpty>
		<isNotEmpty property="strRankCd">
			AND RANK_CD = #strRankCd#
		</isNotEmpty>											
	</select>

	<!-- 담당업무 목록 -->
	<select id="CSPAOE069Qsubselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
		    SELECT D2.TSK_NM  AS TSK_NM_SUB
		         , D2.WGT_RTE AS WGT_RTE_SUB
		         , D3.CTB_RTE AS CTB_RTE_SUB
		      FROM TBCSPAOE026M D2
		         , TBCSPAOE027M D3
		    WHERE 1=1
		      AND D2.EVL_YR       = D3.EVL_YR
		      AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
		      AND D2.CHR_DPT_CD = CASE WHEN SUBSTR(D3.CHR_DPT_CD,1,3) = '141' THEN '141000' 
                                    WHEN SUBSTR(D3.CHR_DPT_CD,1,3) = '121' THEN '121000' 
                                    WHEN SUBSTR(D3.CHR_DPT_CD,1,3) = '122' AND D3.CHR_DPT_CD = '122500' THEN D3.CHR_DPT_CD
                                    WHEN SUBSTR(D3.CHR_DPT_CD,1,3) = '122' AND D3.CHR_DPT_CD <> '122500' THEN '122000'
                                    ELSE D3.CHR_DPT_CD END
		      AND D2.TSK_NO       = D3.TSK_NO
		      AND D2.EVL_YR       = #strEvlYr#
		      AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
		      AND D3.PTCPT_CNB    = #strEvlCnb#
		     ORDER BY D2.TSK_NO
		]]>
	</select>

	<!-- 직급 -->
	<select id="CSPAOE069QRankCdListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT RANK_CD AS CD
			     , F_CODE_NM('1000173', RANK_CD) AS CD_NM /*직급명*/
			  FROM TBCSPAOE035M
			 GROUP BY RANK_CD		
		]]>
	</select>
	<!-- ################################## 지원부서 개인별 평점관리 끝 (CSPAOE069Q) ################################# -->

	<!-- ################################## 감사사항 진행단계별 현황 시작 (CSPAOE084Q) ############################### -->
	<select id="CSPAOE084Qmainselect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
			SELECT NVL(F_MNG_KND_AUDYRNO(D3.AUD_YR, D3.TSK_NO, D5.AUD_KND_CD, '-'),D3.AUD_YR || '-' || D3.TSK_NO) AS EVL_YR_TSK_NO /*감사연번호*/
			     , D3.AUD_SBJ_NM /*감사사항명*/
			     , D3.MNDY_CNT /*연인원*/
			     , NVL(D4.PTCPT_CNB_CNT, 0) AS PTCPT_CNB_CNT /*참여인원*/
			     , F_DPT_INFO(D3.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_CD /*처리과*/
			     , F_CODE_NM('1000270', D3.AUD_KND_CD) AS AUD_KND_CD  /*감사종류*/
			     , F_CODE_NM('1000273',D3.AUD_STEP_CD) AS  AUD_STEP_CD/*감사단계*/
			     , '' AS EVLT_ASG_YN /*평가자 지정여부*/
			     , D3.LUNH_DT /*착수일*/
			     , D3.CMPT_DT /*완료일*/
			     , F_USR_INFO(D3.CTB_RTE_CFM_BRUCHF_CNB, '2') AS CTB_RTE_CFM_BRUCHF_CNB /*기여율확인국장전산번호*/
			     , D3.CTB_RTE_CFM_YN /*기여도확인여부*/
			     , D3.AUD_END_YN AS AUD_END_YN /*종료여부*/
			     , D3.DLAY_DT_NM /*지연일*/
			     , D3.EXET_DCN /*면책일*/
			     , D3.EXET_RQS_DCN /*면책요청일*/
			     , D3.DLAY_RSN_TXT /*지연사유*/
			     , D3.DLAY_RPT_TXT /*지연보고*/
			  FROM (
			    SELECT D1.AUD_YR 
                     , D1.TSK_NO /*감사연번호*/
			         , D1.AUD_SBJ_NM /*감사사항명*/
			         , D1.MNDY_CNT /*연인원*/
			         , D1.HNDL_DIV_DPT_CD /*처리과*/
			         , D1.AUD_KND_CD /*감사종류*/
			         , D2.AUD_STEP_CD /*감사단계*/
			         , D2.LUNH_DT /*착수일*/
			         , D2.CMPT_DT /*완료일*/  
			         , D2.CTB_RTE_CFM_BRUCHF_CNB /*기여율확인국장전산번호*/
			         , DECODE((SELECT CTB_RTE_CFM_BRUCHF_CNB FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = D2.AUD_STEP_CD_MAX)
                                , '', '', 'Y') AS CTB_RTE_CFM_YN /*기여도확인여부*/
                     , (SELECT AUD_END_YN FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = D2.AUD_STEP_CD_MAX) AS AUD_END_YN /*종료여부*/
			         , D2.DLAY_DT_NM /*지연일*/
			         , D2.EXET_DCN /*면책일*/
			         , D2.EXET_RQS_DCN /*면책요청일*/
			         , D2.DLAY_RSN_TXT /*지연사유*/
			         , D2.DLAY_RPT_TXT /*지연보고*/
			      FROM TBCSPAOE021M D1
			         , (
                     SELECT D1.AUD_YR
                          , D1.TSK_NO
                          , D1.AUD_STEP_CD
                          , D1.LUNH_DT
                          , D1.CMPT_DT
                          , D1.DLAY_DT_NM
                          , D1.EXET_DCN
                          , D1.EXET_RQS_DCN
                          , D1.DLAY_RSN_TXT
                          , D1.DLAY_RPT_TXT
                          , D1.CTB_RTE_CFM_BRUCHF_CNB
                          , D2.AUD_STEP_CD_MAX
                      FROM TBCSPAOE022M D1
                         , (
                        SELECT AUD_YR
                             , TSK_NO
                             , AUD_STEP_CD AS AUD_STEP_CD_MIN
                             , AUD_STEP_CD AS AUD_STEP_CD_MAX
                          FROM TBCSPAOE022M
                         WHERE 1 = 1
						  ]]>
							<isNotEmpty property="strSearchEvlYr">
								AND AUD_YR = #strSearchEvlYr#
							</isNotEmpty>
						<![CDATA[                         
                           AND CMPT_DT IS NOT NULL
                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                     ) D2
                     WHERE D1.AUD_YR = D2.AUD_YR
                       AND D1.TSK_NO = D2.TSK_NO
                       AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_CD_MIN AND D2.AUD_STEP_CD_MAX                    
                     ) D2
			    WHERE D1.AUD_YR = D2.AUD_YR
			      AND D1.TSK_NO = D2.TSK_NO			  
			    ) D3
			    , (
			        SELECT AUD_YR
			             , TSK_NO
			             , AUD_STEP_CD
			             , COUNT(PTCPT_CNB) AS PTCPT_CNB_CNT
			          FROM TBCSPAOE023M
			         WHERE 1=1
					  ]]>
						<isNotEmpty property="strSearchEvlYr">
							AND AUD_YR = #strSearchEvlYr#
						</isNotEmpty>
					<![CDATA[ 
			         GROUP BY AUD_YR, TSK_NO, AUD_STEP_CD   
			    ) D4 ,TBBADDED001M D5
			 WHERE D3.AUD_YR = D4.AUD_YR (+)
			   AND D3.TSK_NO = D4.TSK_NO (+)
			   AND D3.AUD_STEP_CD = D4.AUD_STEP_CD (+) 
			   AND D3.AUD_YR = D5.AUD_YR (+)
 			   AND D3.TSK_NO = D5.AUD_NO (+)
		]]>
		<isNotEmpty prepend="AND" property="strTskNo">
			      CASE WHEN LENGTH(#strTskNo#) = 3 AND D5.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D3.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			      D3.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			D5.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1) 
		</isNotEmpty>
		<![CDATA[		
			 ORDER BY D3.HNDL_DIV_DPT_CD, D3.TSK_NO, D3.AUD_STEP_CD
		]]>
	</select>
	<!-- ##################################### 감사사항 진행단계별 현황 끝 (CSPAOE084Q) ############################### -->

	<!-- ##################################### 감사참여이력조회 시작 (CSPAOE087Q) ##################################### -->
	<select id="CSPAOE087Qmainselect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
                SELECT (SELECT F_DPT_INFO(D16.DPT_CD, '1') FROM DUAL)       AS DPT_NM /*부서코드*/
                     , (SELECT F_CODE_NM('1000173', D16.RANK_CD) FROM DUAL) AS RANK_NM /*직급명*/
                     , (SELECT F_USR_INFO(D15.PTCPT_CNB, '2') FROM DUAL)    AS NEVLT_NM /*이름*/
                     , D15.PTCPT_CNB AS NEVLT_CNB /*피평가자전산번호*/
                     , AUD_KND_NM    /*감사종류코드*/
			         , AUD_SBJ_NM    AS TSK_NM  /*업무명*/
                     , NMPTCPT_CNT   AS PTCPT_CNB_CNT /*참여인원*/
                     , STND_ASC /*표준평점*/
                     , (SELECT F_CODE_NM('1000274', SYT_EVL_RK_CD) FROM DUAL) AS EVL_RK_CD /*평가등급*/
                     , SYT_EVL_ADVL_VAL                    AS IDVT_INDEX_VAL   /*가중치*/    
                     , ADVL_ASC /*가중평점=표준평점*가중치*/
                     , (SELECT F_CODE_NM('1000273', AUD_STEP_CD_MIN) FROM DUAL)           AS TSK_ST_STEP_NM	/*단계기초*/
			         , (SELECT F_CODE_NM('1000273', AUD_STEP_CD_MAX) FROM DUAL)           AS TSK_END_STEP_NM	/*단계기말 */ 
                     , DECODE(TSK_DVSN_CD, '10001', '', DRIVE_RTE_SUM) AS DRIVE_RTE /*추진율*/      
                     , DECODE(TSK_DVSN_CD, '10001', '', DRIVE_RTE_ASC) AS DRIVE_RTE_ASC /*추진율 조정평점*/
                     , DECODE(TSK_DVSN_CD, '10001', '', DLY_DT_SUM)    AS DLAY_DT_NM_SUM /*지연일*/
                     , DECODE(TSK_DVSN_CD, '10001', '', ASP_RTE)       AS ASP_RTE /*가감점율*/
			         , DECODE(TSK_DVSN_CD, '10001', '', ASP_STND_ASC)  AS ASP_ASC /*가감평점*/
                     , DECODE(TSK_DVSN_CD, '10001', '', SPE_ADD_SC)    AS SPE_ADD_SC /*특별가산점*/      
                     , TSK_ASC   /*업무평점-= 표준평점*평가등급별가중치*감사단계별추진율 + (가감평점) + 특별가산점 + 조정평점 */
                     , CTB_RTE
                     , PSN_TSK_ASC /*개인평점*/
                     , D17.PSN_TSK_ASC_SUM AS PSN_TSK_ASC_SUM /*개인평점 합계*/
                  FROM (
                    SELECT PTCPT_CNB
                         , F_CODE_NM('1000270', AUD_KND_CD) AS AUD_KND_NM    /*감사종류코드*/
                         , AUD_SBJ_NM
                         , NMPTCPT_CNT   /*참여인원*/
                         , STND_ASC /*표준평점*/
                         , SYT_EVL_RK_CD
                         , SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
                         , ADVL_ASC /*가중평점=표준평점*가중치*/
                         , AUD_STEP_CD_MIN
                         , AUD_STEP_CD_MAX
                         , DRIVE_RTE_SUM  /*추진율*/      
                         , DRIVE_RTE_ASC /*추진율 조정평점*/
                         , DLY_DT_SUM /*지연일*/
                         , ( CASE WHEN INSTR(DLY_DT_SUM, '-') = 0 AND ASP_RTE = 0 THEN '0.00'
                                  WHEN INSTR(DLY_DT_SUM, '-') = 0 THEN TO_CHAR(ASP_RTE,'FM99990.00')
			                       ELSE '-' ||  TO_CHAR(ASP_RTE, 'FM99990.00') END) AS ASP_RTE  /*가감점율*/
                         , ASP_STND_ASC /*가감평점*/
                         , SPE_ADD_SC /*특별가산점*/      
                         , ROUND(DRIVE_RTE_ASC+ ASP_STND_ASC + SPE_ADD_SC + MDT_ASC , 2) AS TSK_ASC   /*업무평점-= 표준평점*평가등급별가중치*감사단계별추진율 + (가감평점) + 특별가산점 + 조정평점 */
                         , CTB_RTE
                         , ROUND((DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC /*개인평점*/
                         , TSK_DVSN_CD
                      FROM (
                        SELECT D20.PTCPT_CNB
                             , D20.AUD_KND_CD    /*감사종류코드*/
                             , D20.AUD_SBJ_NM
                             , D20.NMPTCPT_CNT /*참여인원*/
                             , D20.STND_ASC /*표준평점*/
                             , D20.SYT_EVL_RK_CD
                             , D20.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
                             , D20.ADVL_ASC /*가중평점=표준평점*가중치*/
                             , D20.AUD_STEP_CD_MIN
                             , D20.AUD_STEP_CD_MAX
                             , D20.DRIVE_RTE_SUM  /*추진율*/      
                             , D20.DRIVE_RTE_ASC /*추진율 조정평점*/
                             , D20.DLY_DT_SUM /*지연일*/
                             , D20.ASP_RTE  /*가감점율*/
                             , F_AOE_ASP_STND_ASC_2(D20.EVL_YR, D20.HLYR_DVSN_CD, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/
                             , D20.SPE_ADD_SC /*특별가산점*/   
                             , D20.MDT_ASC /*조정평점*/   
                             , D20.CTB_RTE
                             , D20.MNDY_CNT
                             , '10000' AS TSK_DVSN_CD
                         FROM (                       
	                        SELECT D19.PTCPT_CNB
	                             , D19.AUD_KND_CD    /*감사종류코드*/
	                             , D19.AUD_SBJ_NM
	                             , D19.NMPTCPT_CNT /*참여인원*/
	                             , D19.STND_ASC /*표준평점*/
	                             , D19.SYT_EVL_RK_CD
	                             , D19.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
	                             , D19.ADVL_ASC /*가중평점=표준평점*가중치*/
	                             , D19.AUD_STEP_CD_MIN
	                             , D19.AUD_STEP_CD_MAX
	                             , D19.DRIVE_RTE_SUM  /*추진율*/      
	                             , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
	                             , D19.DLY_DT_SUM /*지연일*/
	                             , D19.ASP_RTE  /*가감점율*/
	                             , DECODE(D19.DLY_DT_SUM, 0, 0 ,(DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2) 
	                                    ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100) , 2) END)) AS ASP_STND_ASC /*가감평점*/
	                             , D19.SPE_ADD_SC /*특별가산점*/   
	                             , D19.MDT_ASC /*조정평점*/   
	                             , D19.CTB_RTE
	                             , D19.MNDY_CNT
                                 , D19.EVL_YR
                                 , D19.HLYR_DVSN_CD
                                 , D19.AUD_YR
	                             , D19.TSK_NO
	                         FROM (
	                            SELECT D11.PTCPT_CNB
	                                 , D10.AUD_KND_CD    /*감사종류코드*/
	                                 , D10.AUD_SBJ_NM
	                                 , D10.NMPTCPT_CNT /*참여인원*/
	                                 , D10.STND_ASC /*표준평점*/
	                                 , D10.SYT_EVL_RK_CD
	                                 , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
	                                 , D10.STND_ASC * D10.SYT_EVL_ADVL_VAL AS ADVL_ASC /*가중평점=표준평점*가중치*/
	                                 , D10.AUD_STEP_CD_MIN
	                                 , D10.AUD_STEP_CD_MAX
	                                 , D10.DRIVE_RTE_SUM  /*추진율*/      
	                                 , F_AOE_DRIVE_RTE_ASC(D10.EVL_YR, D10.HLYR_DVSN_CD, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
	                                 , D10.DLY_DT_SUM /*지연일*/
	                                 , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/
	                                 , D10.SPE_ADD_SC /*특별가산점*/  
	                                 , D10.MDT_ASC /*조정평점*/    
	                                 , D11.CTB_RTE
	                                 , D10.MNDY_CNT
	                                 , D10.EVL_YR
                                     , D10.HLYR_DVSN_CD
                                     , D10.AUD_YR
	                                 , D10.TSK_NO
	                             FROM (
	                                SELECT HNDL_DIV_DPT_CD
	                                     , SPVR_CNB
	                                     , AUD_KND_CD
	                                     , AUD_YR
	                                     , TSK_NO
	                                     , AUD_SBJ_NM
	                                     , AUD_STEP_CD_MIN
	                                     , AUD_STEP_CD_MAX
	                                     , MNDY_CNT
	                                     , NMPTCPT_CNT /*참여인원*/
	                                     , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
	                                     , SYT_EVL_RK_CD
	                                     , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
	                                     , DRIVE_RTE_SUM  /*추진율*/      
	                                     , DLY_DT_SUM /*지연일*/
	                                     , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = D9.EVL_YR AND HLYR_DVSN_CD = D9.HLYR_DVSN_CD) AS ASP_RTE /*가감점율*/
	                                     , NVL(SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS SPE_ADD_SC
	                                     , NVL(MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS MDT_ASC
	                                     , EVL_YR
	                                     , HLYR_DVSN_CD
	                                     , SYT_TRTM_YN
	                                  FROM (
	                                    SELECT D5.HNDL_DIV_DPT_CD
	                                         , D5.SPVR_CNB
	                                         , D5.AUD_KND_CD
	                                         , D5.AUD_YR
	                                         , D5.TSK_NO
	                                         , D5.AUD_SBJ_NM
	                                         , D5.AUD_STEP_CD_MIN
	                                         , D5.AUD_STEP_CD_MAX
	                                         , D5.MNDY_CNT
	                                         , ( SELECT COUNT(*) FROM TBCSPAOE023M WHERE AUD_YR = D5.AUD_YR AND TSK_NO = D5.TSK_NO AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ) AS NMPTCPT_CNT /*참여인원*/
	                                         , F_AOE_STND_ASC(D6.EVL_YR, D6.HLYR_DVSN_CD, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) AS STND_ASC /*표준평점*/
	                                         , DECODE(D6.EVL_STEP_CD, '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다.*/           
	                                         , DECODE(D6.EVL_STEP_CD, '100', D6.EVL_RK_CD, '200', D6.SYT_EVL_RK_CD, 0) AS SYT_EVL_RK_CD
	                                         , (SELECT NVL(SUM(DRIVE_RTE), 0) 
	                                              FROM TBCSPAOE008D 
	                                             WHERE EVL_YR        = D6.EVL_YR
	                                               AND HLYR_DVSN_CD  = D6.HLYR_DVSN_CD
	                                               AND TSK_DVSN_CD   = '10000' 
	                                               AND AUD_KND_CD    = D5.AUD_KND_CD   
	                                               AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
	                                         , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
	                                              FROM TBCSPAOE022M
	                                             WHERE AUD_YR = D5.AUD_YR
	                                               AND TSK_NO = D5.TSK_NO
	                                               AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
	                                         , D6.SPE_ADD_SC
	                                         , D6.MDT_ASC
	                                         , D6.EVL_YR
	                                         , D6.HLYR_DVSN_CD
	                                         , D5.SYT_TRTM_YN
	                                     FROM (
	                                            SELECT D2.HNDL_DIV_DPT_CD
	                                                 , D2.SPVR_CNB
	                                                 , D2.AUD_KND_CD
	                                                 , D2.AUD_YR
	                                                 , D2.TSK_NO
	                                                 , D2.AUD_SBJ_NM
	                                                 , D1.AUD_STEP_CD_MIN
	                                                 , D1.AUD_STEP_CD_MAX
	                                                 , D2.MNDY_CNT
	                                                 , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
	                                              FROM (
	                                                SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
	                                                     , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
	                                                     , AUD_YR
	                                                     , TSK_NO
	                                                  FROM TBCSPAOE022M
	                                                 WHERE CMPT_DT IS NOT NULL
	                                                   AND CMPT_DT BETWEEN #strFromDate# AND #strToDate#
	                                                 GROUP BY AUD_YR, TSK_NO
	                                             ) D1
	                                             , TBCSPAOE021M D2
	                                         WHERE D1.AUD_YR = D2.AUD_YR
	                                           AND D1.TSK_NO = D2.TSK_NO
	                                          ) D5 /*평가대상 감사활동 - 기준*/
	                                          , (
	                                            SELECT D8.AUD_TSK_KND_CD
	                                                 , D8.AUD_YR
	                                                 , D8.TSK_NO
	                                                 , D8.SYT_EVL_ADVL_VAL
	                                                 , D8.EVL_YR
	                                                 , D8.HLYR_DVSN_CD
	                                                 , D8.TSK_DVSN_CD
	                                                 , D8.EVL_RK_CD
	                                                 , D8.SYT_EVL_RK_CD
	                                                 , D8.EVL_STEP_CD
	                                                 , D8.SPE_ADD_SC
	                                                 , D8.MDT_ASC
	                                               FROM (
	                                                   SELECT AUD_YR
	                                                        , TSK_NO
	                                                        , MAX(EVL_STEP_CD) AS EVL_STEP_CD
	                                                        , AUD_TSK_KND_CD
	                                                        , TSK_DVSN_CD
	                                                        , MAX(EVL_YR || HLYR_DVSN_CD) AS EVL_YR_HLYR_DVSN_CD
	                                                     FROM TBCSPAOE029M
	                                                    WHERE TSK_DVSN_CD = '10000'
	                                                      AND EVL_STA_CD   = '300' /*평가완료*/
	                                                    GROUP BY AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
	                                             ) D7
	                                             , TBCSPAOE029M D8
	                                            WHERE D7.EVL_YR_HLYR_DVSN_CD = D8.EVL_YR || D8.HLYR_DVSN_CD
	                                              AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
	                                              AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
	                                              AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
	                                              AND D7.AUD_YR = D8.AUD_YR
	                                              AND D7.TSK_NO = D8.TSK_NO	                                          
	                                        ) D6 /*감사사항 평가관리*/
	                                        , TBCSPAOE010D D7
	                                    WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD 
	                                      AND D5.AUD_YR          = D6.AUD_YR        
	                                      AND D5.TSK_NO          = D6.TSK_NO      
	                                      AND D6.EVL_YR = D7.EVL_YR (+) 
	                                      AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
	                                      AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
	                                      AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
	                                      AND D6.EVL_RK_CD = D7.RK_CD (+)		  
	                                  ) D9
	                              ) D10
	                              , TBCSPAOE023M D11
	                         WHERE D10.AUD_YR = D11.AUD_YR
	                           AND D10.TSK_NO = D11.TSK_NO
	                           AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD 
					         ]]>
								<isNotEmpty property="strNevltCnb">
									AND D11.PTCPT_CNB = #strNevltCnb#
								</isNotEmpty> 											
							<![CDATA[                                                  
	                           AND D11.CTB_RTE != 0
	                       ) D19
                       ) D20
                   )

                   UNION ALL 

                    SELECT MAN.NEVLT_CNB  AS PTCPT_CNB /*피평가자전산번호*/
                         , MAN.AUD_KND_NM /*종류*/
                         , JUMSU.TSK_NM     /*업무명*/
                         , JUMSU.PTCPT_CNB_CNT /*참여인원*/
                         , JUMSU.STND_ASC          /*표준평점*/
                         , JUMSU.EVL_RK_CD   /*평가등급*/
                         , JUMSU.IDVT_INDEX_VAL   /*가중치*/
                         , JUMSU.ADVL_ASC /*가중평점=표준평점*가중치*/
                         , '' AS TSK_ST_STEP_CD	/*단계기초*/
                         , '' AS TSK_END_STEP_CD	/*단계기말 */ 
                         , 0 AS DRIVE_RTE /*추진율 합*/
                         , 0 AS DRIVE_RTE_ASC /*추진율 조정평점=가중평점*추진율/100*/
                         , 0 AS DLAY_DT_NM_SUM /*지연일*/
                         , '' AS ASP_RTE /*가감점율*/
                         , 0 AS ASP_ASC /*가감평점=추진율조정평점*가감점율*/
                         , 0 AS SPE_ADD_SC    /*특별가산점*/
                         , JUMSU.NAUD_TSK_EVL_SC AS TSK_ASC   /*업무평점*/
                         , RTE.CTB_RTE  /*기여율*/
                         , MAN.PSN_TSK_ASC /*개인평점*/
                         , MAN.TSK_DVSN_CD    
                      FROM (
                        SELECT EVL_YR
                             , HLYR_DVSN_CD
                             , TSK_NO
                             , NEVLT_CNB /*피평가자전산번호*/
                             , TSK_DVSN_CD /*업무구분코드*/
                             , F_CODE_NM('1000272', AUD_TSK_KND_CD) AS AUD_KND_NM    /*감사종류코드*/
                             , AUD_TSK_KND_CD /*감사업무종류코드*/
                             , PSN_TSK_ASC /*개인평점*/
                             , DPT_CD
                             , RANK_CD
                          FROM TBCSPAOE035M
                        WHERE 1 = 1			        
                          AND TSK_DVSN_CD = '10001'
       			         ]]>
				         <dynamic prepend="AND">
					         <isNotEmpty property = "strYrHlytDvsn">
					         	EVL_YR || HLYR_DVSN_CD IN
					         		<iterate property = "strYrHlytDvsn" open="(" close=")" conjunction=",">
					         			#strYrHlytDvsn[]#
					         		</iterate>
					         </isNotEmpty>
				         </dynamic>
							<isNotEmpty property="strNevltCnb">
								AND NEVLT_CNB = #strNevltCnb#
							</isNotEmpty> 											
						<![CDATA[              
                      ) MAN
                      , TBCSPAOE025M RTE
                      ,(
                        SELECT D3.EVL_YR
                             , D3.HLYR_DVSN_CD
                             , D3.TSK_KND_CD
                             , D3.TSK_NO
                             , D3.TSK_NM /*업무명*/
                             , D3.PTCPT_CNB_CNT /*참여인원*/
                             , D4.STND_ASC/*표준평점*/
                             , D5.EVL_RK_CD /*평가등급*/
                             , D6.IDVT_INDEX_VAL /*가중치*/
                             , ROUND(D4.STND_ASC * D6.IDVT_INDEX_VAL, 2) AS ADVL_ASC /*가중평점=표준평점*가중치*/
                             , D5.NAUD_TSK_EVL_SC /*업무평점*/
                             , D5.TSK_DVSN_CD
                           FROM (
                            SELECT D1.EVL_YR
                                 , D1.HLYR_DVSN_CD
                                 , D1.TSK_KND_CD
                                 , D1.TSK_NO
                                 , MAX(D1.TSK_NM) AS TSK_NM /*업무명*/
                                 , COUNT(PTCPT_CNB) AS PTCPT_CNB_CNT /*참여인원*/
                              FROM TBCSPAOE024M D1
                                 , TBCSPAOE025M D2
                             WHERE D1.EVL_YR = D2.EVL_YR
                               AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                               AND D1.TSK_KND_CD = D2.TSK_KND_CD
                               AND D1.TSK_NO = D2.TSK_NO
		       			         ]]>
						         <dynamic prepend="AND">
							         <isNotEmpty property = "strYrHlytDvsn">
							         	D1.EVL_YR || D1.HLYR_DVSN_CD IN
							         		<iterate property = "strYrHlytDvsn" open="(" close=")" conjunction=",">
							         			#strYrHlytDvsn[]#
							         		</iterate>
							         </isNotEmpty>
						         </dynamic>											
								<![CDATA[                                       
                             GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.TSK_KND_CD, D1.TSK_NO
                            ) D3
                            , TBCSPAOE006M D4
                            , TBCSPAOE029M D5
                            , TBCSPAOE010D D6
                        WHERE D3.EVL_YR = D4.EVL_YR
                          AND D3.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
                          AND D4.TSK_DVSN_CD = '10001'
                          AND D3.TSK_KND_CD = D4.TSK_KND_CD
                          AND D3.EVL_YR = D5.EVL_YR
                          AND D3.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
                          AND D5.TSK_DVSN_CD = '10001'
                          AND D3.TSK_KND_CD = D5.AUD_TSK_KND_CD
                          AND D5.EVL_STEP_CD = '700'
                          AND D3.TSK_NO = D5.TSK_NO
                          AND D5.EVL_YR            = D6.EVL_YR         
                          AND D5.HLYR_DVSN_CD      = D6.HLYR_DVSN_CD    
                          AND D5.TSK_DVSN_CD       = D6.TSK_DVSN_CD      
                          AND D5.AUD_TSK_KND_CD    = D6.AUD_TSK_KND_CD  
                          AND D5.EVL_RK_CD         = D6.RK_CD     
                      ) JUMSU
                    WHERE MAN.EVL_YR = RTE.EVL_YR
                      AND MAN.HLYR_DVSN_CD = RTE.HLYR_DVSN_CD
                      AND MAN.AUD_TSK_KND_CD = RTE.TSK_KND_CD
                      AND MAN.TSK_NO = RTE.TSK_NO
                      AND MAN.NEVLT_CNB = RTE.PTCPT_CNB
                      AND MAN.EVL_YR = JUMSU.EVL_YR
                      AND MAN.HLYR_DVSN_CD = JUMSU.HLYR_DVSN_CD
                      AND MAN.TSK_NO = JUMSU.TSK_NO
                      AND MAN.TSK_DVSN_CD = JUMSU.TSK_DVSN_CD                         
                      AND RTE.CTB_RTE != 0
                  ) D15
                  ,(
                    SELECT PTCPT_CNB
                         , SUM(PSN_TSK_ASC) AS PSN_TSK_ASC_SUM
                      FROM (
                         SELECT PTCPT_CNB
                             , ROUND((STND_ASC * SYT_EVL_ADVL_VAL * (DRIVE_RTE_SUM/100) + (TO_NUMBER(ASP_STND_ASC))) * (CTB_RTE/100), 2) AS PSN_TSK_ASC /*개인평점*/
                          FROM (
                            SELECT D25.PTCPT_CNB
                                 , D25.STND_ASC 
                                 , D25.SYT_EVL_ADVL_VAL 
                                 , D25.DRIVE_RTE_SUM
                                 , D25.CTB_RTE
                                 , F_AOE_ASP_STND_ASC_2(D25.EVL_YR, D25.HLYR_DVSN_CD, D25.AUD_KND_CD, D25.AUD_STEP_CD_MAX, D25.DLY_DT_SUM, D25.SYT_EVL_ADVL_VAL, D25.ASP_STND_ASC, D25.AUD_YR, D25.TSK_NO) AS ASP_STND_ASC /*가감평점*/
                             FROM (                          
	                            SELECT D19.PTCPT_CNB
	                                 , D19.STND_ASC
	                                 , D19.SYT_EVL_ADVL_VAL
	                                 , D19.DRIVE_RTE_SUM
	                                 , D19.CTB_RTE
	                                 , D19.EVL_YR
                                     , D19.HLYR_DVSN_CD
                                     , D19.AUD_KND_CD
                                     , D19.AUD_STEP_CD_MAX
                                     , D19.DLY_DT_SUM
	                                 , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2) 
	                                        ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100)  , 2) END)) AS ASP_STND_ASC /*가감평점*/
	                                 , D19.AUD_YR
	                                 , D19.TSK_NO
	                             FROM (
	                                    SELECT D11.PTCPT_CNB
	                                         , D10.STND_ASC /*표준평점*/
	                                         , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
	                                         , D10.STND_ASC * D10.SYT_EVL_ADVL_VAL AS ADVL_ASC /*가중평점=표준평점*가중치*/
	                                         , D10.DRIVE_RTE_SUM  /*추진율*/      
	                                         , F_AOE_DRIVE_RTE_ASC(D10.EVL_YR, D10.HLYR_DVSN_CD, D10.AUD_KND_CD, D10.AUD_STEP_CD_MIN, D10.AUD_STEP_CD_MAX, D10.MNDY_CNT, D10.SYT_TRTM_YN, D10.SYT_EVL_ADVL_VAL) AS DRIVE_RTE_ASC /*추진율 조정평점*/
	                                         , D10.DLY_DT_SUM /*지연일*/
	                                         , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/
	                                         , D11.CTB_RTE
	                                         , D10.EVL_YR
                                             , D10.HLYR_DVSN_CD
                                             , D10.AUD_KND_CD
                                             , D10.AUD_STEP_CD_MAX
                                             , D10.AUD_YR
                                             , D10.TSK_NO
	                                     FROM (
	                                        SELECT AUD_KND_CD
	                                             , AUD_YR
	                                             , TSK_NO
	                                             , AUD_SBJ_NM
	                                             , AUD_STEP_CD_MIN
	                                             , AUD_STEP_CD_MAX
	                                             , MNDY_CNT
	                                             , NMPTCPT_CNT /*참여인원*/
	                                             , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
	                                             , SYT_EVL_RK_CD
	                                             , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
	                                             , DRIVE_RTE_SUM  /*추진율*/      
	                                             , DLY_DT_SUM /*지연일*/
	                                             , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = D9.EVL_YR AND HLYR_DVSN_CD = D9.HLYR_DVSN_CD) AS ASP_RTE /*가감점율*/
	                                             , EVL_YR
	                                             , HLYR_DVSN_CD
	                                             , SYT_TRTM_YN
	                                          FROM (
	                                            SELECT D5.AUD_KND_CD
	                                                 , D5.AUD_YR
	                                                 , D5.TSK_NO
	                                                 , D5.AUD_SBJ_NM
	                                                 , D5.AUD_STEP_CD_MIN
	                                                 , D5.AUD_STEP_CD_MAX
	                                                 , D5.MNDY_CNT
	                                                 , ( SELECT COUNT(*) FROM TBCSPAOE023M WHERE AUD_YR = D5.AUD_YR AND TSK_NO = D5.TSK_NO AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ) AS NMPTCPT_CNT /*참여인원*/
	                                                 , F_AOE_STND_ASC(D6.EVL_YR, D6.HLYR_DVSN_CD, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) AS STND_ASC /*표준평점*/
	                                                 , DECODE(D6.EVL_STEP_CD, '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다.*/           
	                                                 , DECODE(D6.EVL_STEP_CD, '100', D6.EVL_RK_CD, '200', D6.SYT_EVL_RK_CD, 0) AS SYT_EVL_RK_CD
	                                                 , (SELECT NVL(SUM(DRIVE_RTE), 0) 
	                                                      FROM TBCSPAOE008D 
	                                                     WHERE EVL_YR        = D6.EVL_YR
	                                                       AND HLYR_DVSN_CD  = D6.HLYR_DVSN_CD
	                                                       AND TSK_DVSN_CD   = '10000' 
	                                                       AND AUD_KND_CD    = D5.AUD_KND_CD   
	                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
	                                                 , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
	                                                      FROM TBCSPAOE022M
	                                                     WHERE AUD_YR = D5.AUD_YR
	                                                       AND TSK_NO = D5.TSK_NO
	                                                       AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
	                                                 , D6.EVL_YR
	                                                 , D6.HLYR_DVSN_CD
	                                                 , D5.SYT_TRTM_YN
	                                             FROM (
	                                                    SELECT D2.HNDL_DIV_DPT_CD
	                                                         , D2.SPVR_CNB
	                                                         , D2.AUD_KND_CD
	                                                         , D2.AUD_YR
	                                                         , D2.TSK_NO
	                                                         , D2.AUD_SBJ_NM
	                                                         , D1.AUD_STEP_CD_MIN
	                                                         , D1.AUD_STEP_CD_MAX
	                                                         , D2.MNDY_CNT
	                                                         , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
	                                                      FROM (
	                                                        SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
	                                                             , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
	                                                             , AUD_YR
	                                                             , TSK_NO
	                                                          FROM TBCSPAOE022M
	                                                         WHERE CMPT_DT IS NOT NULL
	                                                           AND CMPT_DT BETWEEN #strFromDate# AND #strToDate#
	                                                         GROUP BY AUD_YR, TSK_NO
	                                                     ) D1
	                                                     , TBCSPAOE021M D2
	                                                 WHERE D1.AUD_YR = D2.AUD_YR
	                                                   AND D1.TSK_NO = D2.TSK_NO
	                                                  ) D5 /*평가대상 감사활동 - 기준*/
	                                                  , (
	                                                    SELECT D8.AUD_TSK_KND_CD
	                                                         , D8.AUD_YR
	                                                         , D8.TSK_NO
	                                                         , D8.SYT_EVL_ADVL_VAL
	                                                         , D8.EVL_YR
	                                                         , D8.HLYR_DVSN_CD
	                                                         , D8.TSK_DVSN_CD
	                                                         , D8.EVL_RK_CD
	                                                         , D8.SYT_EVL_RK_CD
	                                                         , D8.EVL_STEP_CD
	                                                         , D8.SPE_ADD_SC
	                                                         , D8.MDT_ASC
	                                                       FROM (
	                                                           SELECT AUD_YR
	                                                                , TSK_NO
	                                                                , MAX(EVL_STEP_CD) AS EVL_STEP_CD
	                                                                , AUD_TSK_KND_CD
	                                                                , TSK_DVSN_CD
	                                                                , MAX(EVL_YR || HLYR_DVSN_CD) AS EVL_YR_HLYR_DVSN_CD
	                                                             FROM TBCSPAOE029M
	                                                            WHERE TSK_DVSN_CD = '10000'
	                                                              AND EVL_STA_CD   = '300' /*평가완료*/
	                                                            GROUP BY AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
	                                                     ) D7
	                                                     , TBCSPAOE029M D8
	                                                    WHERE D7.EVL_YR_HLYR_DVSN_CD = D8.EVL_YR || D8.HLYR_DVSN_CD
	                                                      AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
	                                                      AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
	                                                      AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
	                                                      AND D7.AUD_YR = D8.AUD_YR
	                                                      AND D7.TSK_NO = D8.TSK_NO	                                          
	                                                ) D6 /*감사사항 평가관리*/
	                                                , TBCSPAOE010D D7
	                                            WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD 
	                                              AND D5.AUD_YR          = D6.AUD_YR        
	                                              AND D5.TSK_NO          = D6.TSK_NO      
	                                              AND D6.EVL_YR = D7.EVL_YR (+) 
	                                              AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
	                                              AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
	                                              AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
	                                              AND D6.EVL_RK_CD = D7.RK_CD (+)		  
	                                          ) D9
	                                      ) D10
	                                      , TBCSPAOE023M D11
	                                 WHERE D10.AUD_YR = D11.AUD_YR
	                                   AND D10.TSK_NO = D11.TSK_NO
	                                   AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD   
							         ]]>
										<isNotEmpty property="strNevltCnb">
											AND D11.PTCPT_CNB = #strNevltCnb#
										</isNotEmpty> 											
									<![CDATA[                                                     
	                                   AND D11.CTB_RTE != 0
	                               ) D19
                               ) D25
                           )                     
                         UNION ALL 
                            
                         /*감사외업무 개인별 총 점*/
                         SELECT NEVLT_CNB
                              , PSN_TSK_ASC
                          FROM TBCSPAOE035M
                          WHERE 1 = 1
       			         ]]>
				         <dynamic prepend="AND">
					         <isNotEmpty property = "strYrHlytDvsn">
					         	EVL_YR || HLYR_DVSN_CD IN
					         		<iterate property = "strYrHlytDvsn" open="(" close=")" conjunction=",">
					         			#strYrHlytDvsn[]#
					         		</iterate>
					         </isNotEmpty>
				         </dynamic>	
							<isNotEmpty property="strNevltCnb">
								AND NEVLT_CNB = #strNevltCnb#
							</isNotEmpty> 					         										
						<![CDATA[                     		      
                           AND TSK_DVSN_CD = '10001'
                     )
                    GROUP BY PTCPT_CNB                  
                  ) D17
                  , TBDCMACM001M D16
              WHERE D15.PTCPT_CNB = D17.PTCPT_CNB
                AND D15.PTCPT_CNB = D16.CNB
              ORDER BY D15.PTCPT_CNB, D15.TSK_DVSN_CD
		]]>
	</select>

	<select id="CSPAOE087QEvlDtListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT EVL_YR
			     , HLYR_DVSN_CD
			 FROM TBCSPAOE001M
			WHERE #strFromDate# BETWEEN EVL_STR_DT AND EVL_END_DT
			   OR #strToDate# BETWEEN EVL_STR_DT AND EVL_END_DT
		]]>
	</select>
	<!-- ##################################### 감사참여이력조회 끝 (CSPAOE087Q) ##################################### -->
	
	<!-- ##################################### 감사사항별 기여율 확인 시작 (CSPAOE106P) ############################# -->
	<!-- 확인 감사목록 조회 -->
	<select id="CSPAOE106Pmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D3.AUD_KND_CD, '-'),D1.AUD_YR || '-' || D1.TSK_NO) AS AUD_YR_NO /*감사연번호*/
			     , F_CODE_NM('1000270', D1.AUD_KND_CD) AS AUD_KND_NM /*감사종류*/
			     , D1.MNDY_CNT AS MNDY_CNT /*연인원수*/
			     , F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM /*처리과부서*/
			     , F_CODE_NM('1000273', D2.AUD_STEP_CD) AS AUD_STEP_NM /*감사기말단계*/
			     , D1.AUD_SBJ_NM AS AUD_SBJ_NM /*감사사항명*/
			     , NVL(D2.CTB_RTE_CFM_YN, 'N') AS CTB_RTE_CFM_BRUCHF_YN /*국장확인*/
			     , F_USR_INFO(D2.CTB_RTE_CFM_BRUCHF_CNB, '2') AS CTB_RTE_CFM_BRUCHF_NM    /*지정 결재자명*/
			     , D1.AUD_YR
			     , D1.TSK_NO
			     , D1.AUD_KND_CD
			     , D2.AUD_STEP_CD
			  FROM TBCSPAOE021M D1
			     , (
			        SELECT DISTINCT D3.AUD_YR
			             , D3.TSK_NO
			             , D3.AUD_STEP_CD
			             , D3.CTB_RTE_CFM_BRUCHF_CNB /*기여율확인 지정 결재자 전산번호*/
			             , D3.CTB_RTE_CFM_YN /*기여율확인여부*/
			          FROM TBCSPAOE022M D3
			             , (
			                SELECT AUD_YR
			                     , TSK_NO
			                     , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX
			                  FROM TBCSPAOE022M
			                 WHERE CMPT_DT IS NOT NULL 
			                 GROUP BY AUD_YR, TSK_NO
			            ) D4
			            , (SELECT MAX(EVL_STR_DT) AS EVL_STR_DT, MAX(EVL_END_DT) AS EVL_END_DT FROM TBCSPAOE001M) D5
			        WHERE D3.AUD_YR = D4.AUD_YR
			          AND D3.TSK_NO = D4.TSK_NO
			          AND D3.AUD_STEP_CD = D4.AUD_STEP_CD_MAX
			          AND NVL(D3.CTB_RTE_CFM_RQS_YN, 'N') = 'Y' /* 기여율확인요청여부가 Y 인건만*/
			          AND D3.CMPT_DT BETWEEN D5.EVL_STR_DT AND D5.EVL_END_DT
			     ) D2, TBBADDED001M D3
			 WHERE D1.AUD_YR = D2.AUD_YR
			   AND D1.TSK_NO = D2.TSK_NO
			   AND D1.AUD_YR = D3.AUD_YR(+)
			   AND D1.TSK_NO = D3.AUD_NO(+)
		]]>
		<isNotEmpty property="strDeptCd" >
			   AND D2.CTB_RTE_CFM_BRUCHF_CNB = #strCtbRteCnb#
		</isNotEmpty>
		<!--isEqual property="strPstCd" compareValue="0015800">
               AND D1.HNDL_DIV_DPT_CD IN ( SELECT DPT_CD FROM TBDCMACM002M WHERE USE_YN = 'Y' AND ( HIRK_DPT_CD = #strDeptCd# OR DPT_CD = #strDeptCd# ))
		</isEqual-->
		<![CDATA[
			 ORDER BY D1.AUD_YR, D1.TSK_NO 
		]]>
	</select>
	
	<!-- 참여인원 및 기여율 조회 -->
	<select id="CSPAOE106Psubselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT F_DPT_INFO(BLT_DPT_CD, '1')       AS BLT_DPT_NM /*소속부서*/
			     , F_CODE_NM('1000173', RANK_CD)     AS RANK_NM /*직급*/
			     , F_USR_INFO(PTCPT_CNB, '2')        AS PTCPT_NM /*성명*/
			     , F_CODE_NM('1000278', JON_DVSN_CD) AS JON_DVSN_NM /*참여구분*/
			     , CTB_RTE                           AS CTB_RTE /*기여율*/
			     , EVL_RFR_SBJ_TXT                   AS EVL_RFR_SBJ_TXT /*평가참고사항*/
			  FROM TBCSPAOE023M
			 WHERE 1=1
			   AND AUD_YR      = #strAudYr#
			   AND TSK_NO      = #strTskNo#
			   AND AUD_STEP_CD = #strAudStepCd#
		]]>
	</select>	
	
	<!-- 해당 전산번호로 직위코드 가져오기  -->
	<select id="CSPAOE106PPstCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT PST_CD 
			  FROM TBDCMACM001M 
			  WHERE CNB = #strCtbRteCnb#
		]]>
	</select>	
	
	<!-- 과장이 결재하고 결재취소한다 -->
	<update id="CSPAOE106PDvcnsave" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		   SET 
		   		FNL_MDF_DH = SYSDATE
		     	, CTB_RTE_CFM_DVCHF_CNB = #CTB_RTE_CFM_DVCHF_CNB#
			<isNotEmpty prepend="," property="FNL_USR_ID">
				FNL_USR_ID = #FNL_USR_ID#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
				FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_MNU_ID">
				FNL_MNU_ID = #FNL_MNU_ID#
			</isNotEmpty>
		  WHERE 1=1
		    AND AUD_YR      = #AUD_YR#
		    AND TSK_NO      = #TSK_NO#
		    AND AUD_STEP_CD = #AUD_STEP_CD#
	</update>
	
	<!-- 감사업무관리-참여인원 및 기여율 : 국장 기여율 확인 메세지 연계 -->
	<insert id="CSPAOE023EMsgSInsert" parameterClass="paramMap">
	INSERT INTO TBDCMACM026L
		(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
			, MSG_TP_YN
			, MSG_TXT_2
			, RCNT_CNT
	        , RCNT_HIS
	        , ATT_FL_CN
	        , MSG_REGI_DH
	        , MSG_HNDL_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT  DISTINCT (SELECT MAX(B.MSG_SNO) + 1 FROM TBDCMACM026L B) 
		      , 'SP'
		      , 'OE'
		      , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = #strCtbRteCnb#)
		      , '0'
		      , C.EVL_YR || '년 ' || F_CODE_NM('1000268', C.HLYR_DVSN_CD) || ' 감사업무 기여율 확인내역이 등록되었습니다.'
		      , 1
		      , (SELECT CNB
		          FROM TBDCMACM001M
		         WHERE DPT_CD = ( SELECT A.DPT_CD
		                            FROM TBDCMACM001M A
		                               , TBDCMACM002M B
		                           WHERE 1=1
		                             AND A.DPT_CD = B.DPT_CD
		                             AND USE_YN = 'Y'
		                             AND A.CNB = #strCtbRteCnb# )
		           AND PST_CD = '0015800' ) 
		      , '0'
		      ,	SYSDATE
		      ,	'N'
		      , SYSDATE 
		      , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = #strCtbRteCnb#)
		      , (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = #strCtbRteCnb#)
		      , (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = #strCtbRteCnb#)
		      , 'ptlOrderPortlet'
		      , SYSDATE
		      , SYSDATE
		  FROM TBDCMACM026L A 
		      , (SELECT D.EVL_YR 
		              , D.HLYR_DVSN_CD
		          FROM TBCSPAOE001M D
		         WHERE SYSDATE BETWEEN D.EVL_STR_DT AND D.EVL_END_DT) C 
	</insert>
	
	<!-- 국장이 결재하고 결재취소한다 -->
	<update id="CSPAOE106PBruchfsave" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		   SET 
		   		FNL_MDF_DH = SYSDATE
		     	, CTB_RTE_CFM_YN = #CTB_RTE_CFM_YN#
			<isNotEmpty prepend="," property="CTB_RTE_CFM_RQS_YN">
				CTB_RTE_CFM_RQS_YN = #CTB_RTE_CFM_RQS_YN#
			</isNotEmpty>
			<isNotEmpty prepend="," property="CTB_RTE_CFM_BRUCHF_CNB">
				CTB_RTE_CFM_BRUCHF_CNB = #CTB_RTE_CFM_BRUCHF_CNB#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_USR_ID">
				FNL_USR_ID = #FNL_USR_ID#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
				FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_MNU_ID">
				FNL_MNU_ID = #FNL_MNU_ID#
			</isNotEmpty>
		  WHERE 1=1
		    AND AUD_YR      = #AUD_YR#
		    AND TSK_NO      = #TSK_NO#
		    AND AUD_STEP_CD = #AUD_STEP_CD#
	</update>

	<!-- ############################# 감사사항별 기여율 확인 끝 (CSPAOE106P) ############################ -->
	
	<!-- ############################# 위원평가자 평가 평가취소 시작 (CSPAOE119P) ######################## -->
	<!-- 해당부서의 평가완료한 위원평가자 리스트를 가져온다. -->
	<select id="CSPAOE119Pmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT D2.USR_NAM
			     , D1.EVL_CMTR_CNB 
			     , F_DPT_INFO(D2.DPT_CD, '1')       AS DPT_NM
			     , F_CODE_NM('1000173', D2.RANK_CD) AS RANK_NM
			     , D1.EVL_YR
			     , D1.HLYR_DVSN_CD
			     , D1.DPT_CD
			  FROM (
					    SELECT EVL_YR
					         , HLYR_DVSN_CD
					         , EVL_STEP_CD
					         , DPT_CD
					         , EVL_CMTR_CNB
					      FROM TBCSPAOE031M 
					     WHERE 1=1
					       AND EVL_YR               = #strEvlYr#
					       AND HLYR_DVSN_CD         = #strHlyrDvsnCd#
					       AND EVL_STEP_CD          = '500'
					       AND EVL_CMTR_DVSN_CD     = 'CD03'
					       AND DPT_CD               = #strEvlDptCd#
					       AND NVL(EVL_DTM_YN, 'N') = 'Y' /*평가확정된 것만 가져온다.*/
					     GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_STEP_CD, DPT_CD, EVL_CMTR_CNB			  
					) D1
					, TBDCMACM001M D2
			 WHERE D1.EVL_CMTR_CNB = D2.CNB
			 ORDER BY D2.USR_NAM
		]]>
	</select>
	
	<!-- 삭제할 데이터를 셀렉트 한다. -->
	<select id="CSPAOE119PdeleteDataselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT EVL_YR
			     , HLYR_DVSN_CD
			     , CHR_DPT_CD
			     , TSK_NO
			     , PTCPT_CNB
			     , #EVL_CMTR_CNB# AS EVL_CMTR_CNB
			  FROM TBCSPAOE027M
			 WHERE 1=1
			   AND EVL_YR       = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND CHR_DPT_CD   = #DPT_CD#
		]]>
	</select>	

	<!-- 평가확정되서 계산된 개인점수 삭제한다. -->
	<delete id="CSPAOE119Pmaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE035M
		 WHERE 1=1
		   AND EVL_YR               = #EVL_YR#
		   AND HLYR_DVSN_CD         = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD          = '10002'
		   AND AUD_YR               = #EVL_YR#
		   AND TSK_NO               = #TSK_NO#
		   AND NEVLT_CNB            = #PTCPT_CNB#
		   AND EVLT_CNB             = #EVL_CMTR_CNB#
	</delete>
	
	<!-- 평가확정여부를 'N'으로 갱신한다. -->
	<update id="CSPAOE119Pmainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE031M
		   SET FNL_MDF_DH = SYSDATE
		     , EVL_DTM_YN = 'N'
		     , EVL_STA_CD = '200'
		     , FNL_USR_ID = #FNL_USR_ID#
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		     , FNL_MNU_ID = #FNL_MNU_ID#
		 WHERE 1=1
		   AND EVL_YR               = #EVL_YR#
		   AND HLYR_DVSN_CD         = #HLYR_DVSN_CD#
		   AND EVL_STEP_CD          = '500'
		   AND DPT_CD               = #DPT_CD#
		   AND EVL_CMTR_DVSN_CD     = 'CD03'
		   AND EVL_CMTR_CNB         = #EVL_CMTR_CNB#
	</update>
	<!-- ########################### 위원평가자 평가 평가취소 끝 (CSPAOE119P) ############################# -->
	
	<!-- ############################ 운영직등 업무 평가 평가취소 시작 (CSPAOE200P) ####################### -->
	<!-- 평가군 조회한다. -->
	<select id="CSPAOE200PEvlGpCdListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT EVL_GP_CD      AS CD       /*평가군코드*/
			     , EVL_GP_NM      AS CD_NM    /*평가군명*/
			  FROM TBCSPAOE018M 
		 	 WHERE 1=1
		 	   AND EVL_YR       = #strEvlYr#
               AND HLYR_DVSN_CD = #strHlyrDvsnCd#
             ORDER BY EVL_GP_CD
		]]>
	</select>	
	
	<!-- 평가취소할 피펑가자 목록을 조회한다. -->
	<select id="CSPAOE200Pmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT D1.EVL_YR
			     , D1.HLYR_DVSN_CD
			     , D2.USR_NAM
			     , D1.NEVLT_CNB /*피평가자 전산번호*/
			     , F_DPT_INFO(D2.DPT_CD, '1') AS DPT_NM
			     , F_CODE_NM('1000173', D2.RANK_CD) AS RANK_NM
			     , D1.EVL_CMTR_CNB
			     , (SELECT USR_NAM FROM TBDCMACM001M WHERE CNB = D1.EVL_CMTR_CNB) AS EVL_CMTR_NM
			  FROM (
					    SELECT EVL_YR
					         , HLYR_DVSN_CD
					         , NEVLT_CNB /*피평가자 전산번호*/
					         , EVL_CMTR_CNB
					     FROM TBCSPAOE032M
					    WHERE EVL_YR               = #strEvlYr#
					      AND HLYR_DVSN_CD         = #strHlyrDvsnCd#
					      AND EVL_CMTR_DVSN_CD     = #strEvlGrpCd#
					      AND NVL(EVL_DTM_YN, 'N') = 'Y' /*평가확정된 사람만 나오면 된다*/
					    GROUP BY EVL_YR, HLYR_DVSN_CD, NEVLT_CNB, EVL_CMTR_CNB
					)  D1
					, TBDCMACM001M D2
			WHERE D1.NEVLT_CNB = D2.CNB
			ORDER BY D2.USR_NAM
		]]>
	</select>	
	
	<!-- 평가확정되서 계산된 개인점수 삭제한다. -->
	<delete id="CSPAOE200Pmaindelete" parameterClass="paramMap">
		DELETE TBCSPAOE035M
		 WHERE 1=1
		   AND EVL_YR               = #EVL_YR#
		   AND HLYR_DVSN_CD         = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD          = '10003'
		   AND NEVLT_CNB            = #NEVLT_CNB#
	</delete>
	
	<!-- 평가확정여부를 'N'으로 갱신한다. -->
	<update id="CSPAOE200Pmainupdate" parameterClass="paramMap">
		UPDATE TBCSPAOE032M
		   SET FNL_MDF_DH      = SYSDATE
		     , EVL_DTM_YN      = 'N'
		     , EVL_STA_CD      = '200'
		     , FNL_USR_ID      = #FNL_USR_ID#
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		     , FNL_MNU_ID      = #FNL_MNU_ID#
		 WHERE 1=1
		   AND EVL_YR          = #EVL_YR#
		   AND HLYR_DVSN_CD    = #HLYR_DVSN_CD#
		   AND NEVLT_CNB       = #NEVLT_CNB# /*피평가자 한명한 평가군 하나이기 때문에*/
		   AND EVL_CMTR_CNB    = #EVL_CMTR_CNB# 		   
	</update>
		
	<!-- ############################ 운영직등 업무 평가 평가취소 끝 (CSPAOE200P) ############################### -->
	
	<!-- ############################ 개인별 업무실적 총괄 상세 팝업 시작 (CSPAOE201P) ########################## -->
	<select id="CSPAOE201Pmainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
            SELECT NEVLT_CNB /*피평가자 전산번호*/
                 , F_DPT_INFO(DPT_CD, '1') AS DPT_NM /*평가할때 부서코드*/
                 , NVL(SUM(PSN_TSK_ASC_1), 0) AS PSN_TSK_ASC_1  /*감사활동*/
                 , NVL(SUM(PSN_TSK_ASC_2), 0) AS PSN_TSK_ASC_2 /*모니터링*/
                 , NVL(SUM(PSN_TSK_ASC_3), 0) AS PSN_TSK_ASC_3 /*결산업무*/
                 , NVL(SUM(PSN_TSK_ASC_4), 0) AS PSN_TSK_ASC_4 /*연보업무*/
                 , NVL(SUM(PSN_TSK_ASC_5), 0) AS PSN_TSK_ASC_5 /*총괄업무*/
                 , NVL(SUM(PSN_TSK_ASC_6), 0) AS PSN_TSK_ASC_6 /*집행전말*/
                 , NVL(SUM(PSN_TSK_ASC_7), 0) AS PSN_TSK_ASC_7 /*기타업무*/
                 , NVL(SUM(PSN_TSK_ASC_8), 0) AS PSN_TSK_ASC_8 /*성과보고서*/
                 , NVL(SUM(PSN_TSK_ASC_9), 0) AS PSN_TSK_ASC_9 /*법령모니터링*/
                 , NVL(SUM(SPRT_CVS_ASC), 0) AS SPRT_CVS_ASC   /*지원환산*/
             FROM (
                  /*지원환산점수*/
                  SELECT PTCPT_CNB                                    AS NEVLT_CNB	 /*전산번호*/
                       , CHR_DPT_CD                                   AS DPT_CD /*평가할때 부서코드*/
                       , 0 AS PSN_TSK_ASC_1 /*개인평점*/
                       , 0 AS PSN_TSK_ASC_2 /*모니터링*/
                       , 0 AS PSN_TSK_ASC_3 /*결산업무*/
                       , 0 AS PSN_TSK_ASC_4 /*연보업무*/
                       , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
                       , 0 AS PSN_TSK_ASC_6 /*집행전말*/
                       , 0 AS PSN_TSK_ASC_7 /*기타업무*/
                       , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
                       , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/ 
                       , (SELECT ROUND(F_AOE_DPT_TSC(#strEvlYr#, #strHlyrDvsnCd#, CHR_DPT_CD) * CTB_RTE / 100, 2) FROM DUAL) AS SPRT_CVS_ASC /*지원환산 개인평점*/                 
                   FROM (
                      SELECT D1.EVL_YR	                                   AS EVL_YR           /*평가년도*/
                           , D1.HLYR_DVSN_CD                              AS HLYR_DVSN_CD	   /*반기구분*/
                           , D1.PTCPT_CNB                                 
                           , NVL(SUM(D2.WGT_RTE * D1.CTB_RTE / 100), 0)   AS CTB_RTE	       /*기여율*/
                           , D1.CHR_DPT_CD
                        FROM TBCSPAOE027M D1
                           , TBCSPAOE026M D2                           
                       WHERE 1=1
                         AND D1.EVL_YR       = D2.EVL_YR
                         AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                         AND D1.CHR_DPT_CD   = D2.CHR_DPT_CD
                         AND D1.TSK_NO       = D2.TSK_NO
                         AND D1.EVL_YR       = #strEvlYr#
                         AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                         AND D1.PTCPT_CNB    = #strEvltCnb#       
                         AND D1.CTB_RTE     != 0
                       GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.PTCPT_CNB, D1.CHR_DPT_CD
                   ) 
                   
                   UNION ALL  

                SELECT NEVLT_CNB /*피평가자 전산번호*/
                     , DPT_CD /*평가할때 부서코드*/
                     , PSN_TSK_ASC_1
                     , PSN_TSK_ASC_2 /*모니터링*/
                     , PSN_TSK_ASC_3 /*결산업무*/
                     , PSN_TSK_ASC_4 /*연보업무*/
                     , PSN_TSK_ASC_5 /*총괄업무*/
                     , PSN_TSK_ASC_6 /*집행전말*/
                     , PSN_TSK_ASC_7 /*기타업무*/
                     , PSN_TSK_ASC_8 /*성과보고서*/
                     , PSN_TSK_ASC_9 /*법령모니터링*/
                     , SPRT_CVS_ASC
                     FROM (
                       SELECT NEVLT_CNB /*피평가자 전산번호*/
                            , DPT_CD /*평가할때 부서코드*/
                            , 0 AS PSN_TSK_ASC_1
                            , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 1 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 14 AND 24 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 64 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 74 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 75 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 89 AND 93) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_2 /*모니터링*/
                            , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 2 AND 3 ) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_3 /*결산업무*/
                            , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 4 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_4 /*연보업무*/
                            , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 5 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_5 /*총괄업무*/
                            , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 6 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_6 /*집행전말*/
                            , (CASE WHEN TSK_DVSN_CD = '10001' AND (TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 8 AND 12 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 25 AND 63 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 65 AND 73 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 76 AND 88 OR TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) BETWEEN 94 AND 96) THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_7 /*기타업무*/
                            , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 13 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_8 /*성과보고서*/
                            , (CASE WHEN TSK_DVSN_CD = '10001' AND TO_NUMBER(SUBSTR(AUD_TSK_KND_CD,4)) = 7 THEN PSN_TSK_ASC END) AS PSN_TSK_ASC_9 /*법령모니터링*/
                            , 0 AS SPRT_CVS_ASC
                         FROM TBCSPAOE035M                                             
                        WHERE EVL_YR       = #strEvlYr#
                          AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                          AND TSK_DVSN_CD = '10001'
                          AND NEVLT_CNB = #strEvltCnb#
                      ) D4
                      , (
                            SELECT DPT_CD AS HNDL_DIV_DPT_CD
                                                                FROM TBDCMACM002M
                                                               WHERE  DPT_TP_CD = 'A'                                     
                       ) D5 /*감사부서만 나와야 한다*/ 
                   WHERE D4.DPT_CD = D5.HNDL_DIV_DPT_CD
                  
                 UNION ALL    
                 
                SELECT PTCPT_CNB AS NEVLT_CNB   
                     , BLT_DPT_CD AS DPT_CD /*평가할때 부서코드*/
                     , ROUND((DRIVE_RTE_ASC + ASP_STND_ASC + SPE_ADD_SC + MDT_ASC) * (CTB_RTE/100), 2) AS PSN_TSK_ASC_1 /*개인평점*/
                     , 0 AS PSN_TSK_ASC_2 /*모니터링*/
                     , 0 AS PSN_TSK_ASC_3 /*결산업무*/
                     , 0 AS PSN_TSK_ASC_4 /*연보업무*/
                     , 0 AS PSN_TSK_ASC_5 /*총괄업무*/
                     , 0 AS PSN_TSK_ASC_6 /*집행전말*/
                     , 0 AS PSN_TSK_ASC_7 /*기타업무*/
                     , 0 AS PSN_TSK_ASC_8 /*성과보고서*/
                     , 0 AS PSN_TSK_ASC_9 /*법령모니터링*/
                     , 0 AS SPRT_CVS_ASC
                  FROM (
				     SELECT D20.PTCPT_CNB  
				          , D20.DRIVE_RTE_ASC /*추진율 조정평점*/ 
				          , D20.CTB_RTE
				          , D20.BLT_DPT_CD
				          , D20.SPE_ADD_SC
				          , D20.MDT_ASC
				          , F_AOE_ASP_STND_ASC_2(#strEvlYr#, #strHlyrDvsnCd#, D20.AUD_KND_CD, D20.AUD_STEP_CD_MAX, D20.DLY_DT_SUM, D20.SYT_EVL_ADVL_VAL, D20.ASP_STND_ASC, D20.AUD_YR, D20.TSK_NO) AS ASP_STND_ASC /*가감평점*/  
				       FROM (	                                      
	                     SELECT D19.PTCPT_CNB  
	                          , D19.DRIVE_RTE_ASC /*추진율 조정평점*/
	                          , DECODE(D19.DLY_DT_SUM, 0, 0, (DECODE(INSTR(D19.DLY_DT_SUM, '-') , 0,'-', '') || CASE WHEN D19.DRIVE_RTE_ASC IS NOT NULL THEN ROUND(D19.DRIVE_RTE_ASC * NVL(D19.ASP_RTE, 0) / 100, 2)
	                                 ELSE ROUND(D19.STND_ASC * D19.SYT_EVL_ADVL_VAL * ( D19.DRIVE_RTE_SUM / 100)  * (NVL(D19.ASP_RTE, 0)/ 100), 2) END)) AS ASP_STND_ASC /*가감평점*/    
	                          , D19.CTB_RTE
	                          , D19.BLT_DPT_CD
	                          , D19.AUD_KND_CD
				              , D19.AUD_STEP_CD_MAX
				              , D19.DLY_DT_SUM
				              , D19.SYT_EVL_ADVL_VAL
				              , D19.SPE_ADD_SC
	                          , D19.MDT_ASC
	                          , D19.AUD_YR
	                          , D19.TSK_NO
                      	   FROM (
	                         SELECT D11.PTCPT_CNB
	                              , D10.STND_ASC /*표준평점*/
	                              , D10.SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/      
	                              , D10.DRIVE_RTE_SUM  /*추진율*/      
	                              , D10.DRIVE_RTE_ASC /*추진율 조정평점*/
	                              , D10.DLY_DT_SUM /*지연일*/
	                              , NVL(D10.ASP_RTE, 0) AS ASP_RTE  /*가감점율*/   
	                              , D11.CTB_RTE
	                              , D11.BLT_DPT_CD
	                              , D10.AUD_KND_CD
	           					  , D10.AUD_STEP_CD_MAX
	           					  , NVL(D10.SPE_ADD_SC, 0) AS SPE_ADD_SC
	                              , NVL(D10.MDT_ASC, 0)    AS MDT_ASC
	                              , D10.AUD_YR
	                              , D10.TSK_NO
	                           FROM (
	                             SELECT AUD_KND_CD
	                                  , AUD_YR
	                                  , TSK_NO
	                                  , AUD_STEP_CD_MIN
	                                  , AUD_STEP_CD_MAX
	                                  , MNDY_CNT
	                                  , NVL(STND_ASC, 0) AS STND_ASC  /*표준평점*/
	                                  , NVL(SYT_EVL_ADVL_VAL, 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/           
	                                  , DRIVE_RTE_SUM  /*추진율*/      
	                                  , DLY_DT_SUM /*지연일*/
	                                  , (SELECT ASP_RTE FROM TBCSPAOE012M WHERE DLAY_DT_NM = TO_CHAR(D9.DLY_DT_SUM) AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AS ASP_RTE /*가감점율*/
	                                  , EVL_YR
	                                  , HLYR_DVSN_CD
	                                  , SYT_TRTM_YN
	                                  , F_AOE_DRIVE_RTE_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_KND_CD, AUD_STEP_CD_MIN, AUD_STEP_CD_MAX, MNDY_CNT, SYT_TRTM_YN, NVL(SYT_EVL_ADVL_VAL, 0)) AS DRIVE_RTE_ASC
                                      , NVL(SPE_ADD_SC, F_AOE_SPE_ADD_SC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS SPE_ADD_SC
                                      , NVL(MDT_ASC, F_AOE_MDT_ASC(#strEvlYr#, #strHlyrDvsnCd#, AUD_YR, TSK_NO, AUD_KND_CD)) AS MDT_ASC
	                               FROM (
	                                 SELECT D5.AUD_KND_CD
	                                      , D5.AUD_YR
	                                      , D5.TSK_NO
	                                      , D5.AUD_STEP_CD_MIN
	                                      , D5.AUD_STEP_CD_MAX
	                                      , D5.MNDY_CNT	                                      
	                                      , F_AOE_STND_ASC(#strEvlYr#, #strHlyrDvsnCd#, D5.AUD_KND_CD, D5.AUD_STEP_CD_MIN, D5.AUD_STEP_CD_MAX, D5.MNDY_CNT, NVL(D5.SYT_TRTM_YN,'N')) AS STND_ASC /*표준평점*/
	                                      , DECODE(NVL(D6.EVL_STEP_CD, 'X') , '100', D7.IDVT_INDEX_VAL, '200', D6.SYT_EVL_ADVL_VAL
	                                                     , 'X', (SELECT IDVT_INDEX_VAL FROM TBCSPAOE010D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_TSK_KND_CD = D5.AUD_KND_CD 
	                                                                AND RK_CD =  ( SELECT ELY_ADPT_STAD_RK_CD FROM TBCSPAOE008D WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = D5.AUD_KND_CD AND AUD_STEP_CD = D5.AUD_STEP_CD_MAX ))
	                                                     , 0) AS SYT_EVL_ADVL_VAL /*종합평가 가중치-평가자 스텝별로 가중치 가져오는 방법 다르다. 평가대상이 아닌 업무는 조기가점기준등급 코드의 가중치를 가져온다.*/                     
	                                      , (SELECT NVL(SUM(DRIVE_RTE), 0) 
	                                           FROM TBCSPAOE008D 
	                                          WHERE EVL_YR        = #strEvlYr#
	                                            AND HLYR_DVSN_CD  = #strHlyrDvsnCd#
	                                            AND TSK_DVSN_CD   = '10000' 
	                                            AND AUD_KND_CD    = D5.AUD_KND_CD   
	                                            AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DRIVE_RTE_SUM  /*추진율*/      
	                                      , (SELECT SUM(TO_NUMBER(DLAY_DT_NM-(NVL(EXET_DCN,0))))
	                                           FROM TBCSPAOE022M
	                                          WHERE AUD_YR = D5.AUD_YR
	                                            AND TSK_NO = D5.TSK_NO
	                                            AND AUD_STEP_CD BETWEEN D5.AUD_STEP_CD_MIN AND D5.AUD_STEP_CD_MAX ) AS DLY_DT_SUM /*지연일*/
	                                      , D6.EVL_YR
	                                      , D6.HLYR_DVSN_CD
	                                      , D5.SYT_TRTM_YN
	                                      , D6.SPE_ADD_SC
	                                      , D6.MDT_ASC
	                                  FROM (
                                         SELECT D2.HNDL_DIV_DPT_CD
                                              , D2.SPVR_CNB
                                              , D2.AUD_KND_CD
                                              , D2.AUD_YR
                                              , D2.TSK_NO
                                              , D2.AUD_SBJ_NM
                                              , D1.AUD_STEP_CD_MIN
                                              , D1.AUD_STEP_CD_MAX
                                              , D2.MNDY_CNT
                                              , ( SELECT NVL(SYT_TRTM_YN, 'N') FROM TBCSPAOE022M WHERE AUD_YR = D1.AUD_YR AND TSK_NO = D1.TSK_NO AND AUD_STEP_CD = '10004' ) AS SYT_TRTM_YN /*종합처리안 여부*/
                                           FROM (
                                             SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN /*단계기초*/
                                                  , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                                  , AUD_YR
                                                  , TSK_NO
                                               FROM TBCSPAOE022M
                                              WHERE CMPT_DT IS NOT NULL
                                                AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                              GROUP BY AUD_YR, TSK_NO
	                                          ) D1
	                                          , TBCSPAOE021M D2
	                                      WHERE D1.AUD_YR = D2.AUD_YR
	                                        AND D1.TSK_NO = D2.TSK_NO
	                                       ) D5 /*평가대상 감사활동 - 기준*/
	                                       , (
	                                         SELECT D8.AUD_TSK_KND_CD
	                                              , D8.AUD_YR
	                                              , D8.TSK_NO
	                                              , D8.SYT_EVL_ADVL_VAL
	                                              , D8.EVL_YR
	                                              , D8.HLYR_DVSN_CD
	                                              , D8.TSK_DVSN_CD
	                                              , D8.EVL_RK_CD
	                                              , D8.SYT_EVL_RK_CD
	                                              , D8.EVL_STEP_CD
	                                              , D8.SPE_ADD_SC
	                                              , D8.MDT_ASC
	                                            FROM (
	                                                SELECT EVL_YR
	                                                     , HLYR_DVSN_CD 
	                                                     , AUD_YR
	                                                     , TSK_NO
	                                                     , MAX(EVL_STEP_CD) AS EVL_STEP_CD
	                                                     , AUD_TSK_KND_CD
	                                                     , TSK_DVSN_CD
	                                                  FROM TBCSPAOE029M
	                                                WHERE 1=1
	                                                   AND TSK_DVSN_CD  = '10000'
	                                                   AND EVL_STA_CD   = '300' /*평가완료*/
	                                                   AND (AUD_YR, TSK_NO, EVL_STEP_CD) 
                                                                           IN (SELECT AUD_YR, TSK_NO, MAX(EVL_STEP_CD)
                                                                               FROM TBCSPAOE029M 
                                                                               WHERE  (AUD_YR,TSK_NO) IN (SELECT
                                                                               AUD_YR ,
                                                                               TSK_NO
                                                                          FROM TBCSPAOE022M
                                                                         WHERE CMPT_DT IS NOT NULL
                                                                           AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
                                                                         GROUP BY AUD_YR,
                                                                               TSK_NO )
                                                                               GROUP BY AUD_YR, TSK_NO  )
	                                                 GROUP BY EVL_YR, HLYR_DVSN_CD, AUD_YR, TSK_NO, AUD_TSK_KND_CD, TSK_DVSN_CD /*한 감사사항이 귀청보고평가, 위원평가를 받을 수 있기때문에 이렇게 한번 걸러내는 작업을 함*/
	                                          ) D7
	                                          , TBCSPAOE029M D8
	                                         WHERE D7.EVL_YR = D8.EVL_YR
	                                           AND D7.HLYR_DVSN_CD = D8.HLYR_DVSN_CD
	                                           AND D7.TSK_DVSN_CD = D8.TSK_DVSN_CD
	                                           AND D7.AUD_TSK_KND_CD = D8.AUD_TSK_KND_CD
	                                           AND D7.EVL_STEP_CD = D8.EVL_STEP_CD
	                                           AND D7.AUD_YR = D8.AUD_YR
	                                           AND D7.TSK_NO = D8.TSK_NO	                                          
	                                     ) D6 /*감사사항 평가관리*/
	                                     , TBCSPAOE010D D7
	                                 WHERE D5.AUD_KND_CD      = D6.AUD_TSK_KND_CD  (+)
	                                   AND D5.AUD_YR          = D6.AUD_YR          (+)
	                                   AND D5.TSK_NO          = D6.TSK_NO          (+)
	                                   AND D6.EVL_YR = D7.EVL_YR (+) 
	                                   AND D6.HLYR_DVSN_CD = D7.HLYR_DVSN_CD (+)
	                                   AND D6.TSK_DVSN_CD = D7.TSK_DVSN_CD (+) 
	                                   AND D6.AUD_TSK_KND_CD = D7.AUD_TSK_KND_CD (+)
	                                   AND D6.EVL_RK_CD = D7.RK_CD (+)		  
		                               ) D9
		                           ) D10
		                           , TBCSPAOE023M D11
		                      WHERE D10.AUD_YR = D11.AUD_YR
		                        AND D10.TSK_NO = D11.TSK_NO
		                        AND D10.AUD_STEP_CD_MAX = D11.AUD_STEP_CD 
		                        AND D11.PTCPT_CNB = #strEvltCnb#
		                        AND D11.CTB_RTE != 0
		                        AND D11.BLT_DPT_CD IN (  
                                         SELECT DPT_CD
                                                                           FROM TBDCMACM002M
                                                                           WHERE DPT_TP_CD = 'A'                                                
                              ) /*감사부서만 나와야 한다.*/
		                    ) D19
	                   	  ) D20
		                )
		            )
		        GROUP BY NEVLT_CNB, DPT_CD
		        ORDER BY DPT_NM
		]]>
	</select>
	<!-- ############################ 개인별 업무실적 총괄 상세 팝업 끝 (CSPAOE201P) ########################### -->
	
	<!-- ############################ 지원부서 개인별 평점 상세 팝업 시작 (CSPAOE202P) ######################### -->
	<select id="CSPAOE202Pmainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
            SELECT D10.PTCPT_CNB
                 , F_DPT_INFO(D10.CHR_DPT_CD, '1') AS CHR_DPT_NM
                 , D10.CTB_RTE_AVG /*기여율*/
                 , NVL(ROUND(D10.PSN_TSK_ASC_DEPT * D10.CTB_RTE_AVG / 100, 2), 0) AS PSN_TSK_ASC /*개인평점환산 = 부서총점환산 * 기여율 / 100 */  
                 , NVL(D10.AUD_SPRT_ASC, 0) AS AUD_SPRT_ASC /*감사지원*/
                 , NVL(D10.PSN_TSK_ASC_OTHER, 0) AS PSN_TSK_ASC_OTHER /*감사외*/
                 , NVL(D10.PSN_TSK_ASC_DEPT, 0) AS PSN_TSK_ASC_DEPT /*부서총점환산*/              
              FROM (
                SELECT D3.PTCPT_CNB
                     , D3.CTB_RTE_AVG /*기여율*/
                     , D6.AUD_SPRT_ASC /*감사지원*/
                     , D6.PSN_TSK_ASC_OTHER /*감사외*/
                     , (SELECT F_AOE_DPT_TSC(D3.EVL_YR, D3.HLYR_DVSN_CD, D3.CHR_DPT_CD) FROM DUAL) AS PSN_TSK_ASC_DEPT /*부서총점환산*/
                     , D3.CHR_DPT_CD AS CHR_DPT_CD /*평가부서*/
                     , D3.EVL_YR 
                     , D3.HLYR_DVSN_CD
                  FROM (
                    SELECT SUM(D1.WGT_RTE * D2.CTB_RTE / 100) AS CTB_RTE_AVG  /*기여율=비중*기여율/100*/
                         , D2.PTCPT_CNB
                         , D1.EVL_YR
                         , D1.HLYR_DVSN_CD
                         , D1.CHR_DPT_CD
                      FROM TBCSPAOE026M D1
                         , TBCSPAOE027M D2
                    WHERE D1.EVL_YR       = D2.EVL_YR
                      AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                      AND D1.CHR_DPT_CD = CASE WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '141' THEN '141000' 
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '121' THEN '121000' 
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '122' AND D2.CHR_DPT_CD = '122500' THEN D2.CHR_DPT_CD
                                    WHEN SUBSTR(D2.CHR_DPT_CD,1,3) = '122' AND D2.CHR_DPT_CD <> '122500' THEN '122000'
                                    ELSE D2.CHR_DPT_CD END
                      AND D1.TSK_NO       = D2.TSK_NO
                      AND D1.EVL_YR       = #strEvlYr#
                      AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                      AND D2.PTCPT_CNB    = #strEvltCnb#
                    GROUP BY D2.PTCPT_CNB, D1.EVL_YR, D1.HLYR_DVSN_CD, D1.CHR_DPT_CD  
                    ) D3 /*지원부서*/
                    , (
                    SELECT D4.EVL_YR
                         , D4.HLYR_DVSN_CD
                         , D4.NEVLT_CNB /*피평가자전산번호*/
                         , ROUND(NVL(SUM(DECODE( D4.TSK_DVSN_CD, '10000', D4.AUD_SPRT_ASC,  '') + DECODE( D4.TSK_DVSN_CD, '10000', D4.PSN_TSK_ASC,  '')) , 0), 2) AS AUD_SPRT_ASC
                         , ROUND(NVL(SUM(DECODE( D4.TSK_DVSN_CD, '10001', D4.PSN_TSK_ASC, '')), 0), 2) AS PSN_TSK_ASC_OTHER
                      FROM TBCSPAOE035M D4
                     WHERE D4.EVL_YR       = #strEvlYr#
                       AND D4.HLYR_DVSN_CD = #strHlyrDvsnCd#
                       AND D4.TSK_DVSN_CD  IN ('10001', '10000')		
                       AND D4.NEVLT_CNB    = #strEvltCnb#
                     GROUP BY D4.EVL_YR, D4.HLYR_DVSN_CD, D4.NEVLT_CNB 
                    ) D6
                WHERE D3.EVL_YR = D6.EVL_YR(+)
                  AND D3.HLYR_DVSN_CD = D6.HLYR_DVSN_CD(+)
                  AND D3.PTCPT_CNB = D6.NEVLT_CNB(+)
              ) D10
          ORDER BY CHR_DPT_NM
		]]>
	</select>
	
	<!-- ########################## 지원부서 개인별 평점 상세 팝업 끝 (CSPAOE202P) ########################## -->
	
	<!-- ########################### 지원업무 등록현황 팝업 시작 (CSPAOE203P) ############################### -->
	<select id="CSPAOE203Pmainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT F_DPT_INFO(D2.DPT_CD, '1') AS DPT_NM
			     , NVL2(D1.CHR_DPT_CD, '등록', '미등록') AS DPT_YN
			 FROM (
				SELECT CHR_DPT_CD
				  FROM TBCSPAOE026M
				 WHERE EVL_YR       = #strEvlYr#
				   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				 GROUP BY CHR_DPT_CD
			 ) D1
			 , (
				   SELECT DPT_CD
				     FROM TBDCMACM002M
				    WHERE DPT_TP_CD = 'S' /*지원부서만*/
				      AND USE_YN = 'Y'
				      AND DPT_CD NOT IN ('141010', '141020', '141030', 
                  					'120000', '080000', '0D0000', '140000', '100000','300210','300220','300230',
                  					'160000', '1A0000', '170000', '190000',	'150000','140150','080190','190160',
                  					'200000', '300000', '400000', '500000', '510000','100100','080180','080220','200010',
                  					'520000', '530000', '540000', '550000', '150170','150160','770770','300010','150150',
                  					'121100', '121200', '122100','122200','122300','122400','150180','140130'
                                    , '071110', '071120','071130','071140','122500','071000'
                                    ,'081000', '081100', '081200', '081300', '081400' ,'071100', '071300'
                                    , '180000', '180100', '180110', '180120', '170300', '170320')
					UNION
				
										
					SELECT '121000' AS DPT_CD
					  FROM DUAL
					UNION
					
					SELECT '122000' AS DPT_CD
					  FROM DUAL
					  /* 2015.05.20 혁신전략팀, 감사혁신팀, 조직혁신팀 제외하고 감사혁신추진단으로 표시 시작 */
					  /*2015.05.25 인사혁신과, 운영지원과*/
			 ) D2
			WHERE D1.CHR_DPT_CD (+) = D2.DPT_CD
		]]>
			<isNotEmpty property="strYn">
				AND NVL2(D1.CHR_DPT_CD, 'Y', 'N') = #strYn#
			</isNotEmpty>
        <![CDATA[  			
			ORDER BY NVL2(D1.CHR_DPT_CD, 2, 1), D2.DPT_CD      
		]]>
	</select>
	<!-- ############################### 지원업무 등록현황 팝업 끝 (CSPAOE203P) ############################ -->
	
	<!-- ######################## 감사사항 가산점 관리(평가완료 전) 시작 (CSPAOE204P) ####################### -->
	<select id="CSPAOE204Emainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D4.AUD_KND_CD, '-'),D1.AUD_YR || '-' || D1.TSK_NO) AS AUD_YR_TSK_NO        /*감사연번호*/
			     , D1.AUD_YR                                             /*감사년도*/
			     , D1.TSK_NO                                             /*업무번호*/
			     , D2.AUD_KND_CD                                         /*감사종류 코드*/
			     , F_CODE_NM('1000270', D2.AUD_KND_CD)  AS AUD_KND_NM    /*감사종류명*/ 
			     , D2.AUD_SBJ_NM                                         /*감사사항명*/
			     , D3.SPE_ADD_SC                                         /*특별가산점*/
			     , D3.MDT_ASC                                            /*조정평점*/
			     , #strEvlYr#      AS EVL_YR                             /*평가년도*/
			     , #strHlyrDvsnCd# AS HLYR_DVSN_CD                       /*반기구분*/
			  FROM (
			    SELECT AUD_YR
			         , TSK_NO
			         , MAX(AUD_STEP_CD) AS AUD_STEP_CD
			      FROM TBCSPAOE022M
			     WHERE CMPT_DT IS NOT NULL
			       AND CMPT_DT BETWEEN #strEvlStrDt# AND #strEvlEndDt#
			    GROUP BY AUD_YR, TSK_NO
			    ) D1
			    , TBCSPAOE021M D2
			    , TBCSPAOE043M D3 
			    , TBBADDED001M D4
			WHERE D1.AUD_YR = D2.AUD_YR
			  AND D1.TSK_NO = D2.TSK_NO
			  AND D2.AUD_YR                 = D3.AUD_YR     (+)
			  AND D2.TSK_NO                 = D3.TSK_NO     (+)
			  AND D2.AUD_YR = D4.AUD_YR (+)
   			  AND D2.TSK_NO = D4.AUD_NO (+)
			  AND D2.AUD_KND_CD             = D3.AUD_KND_CD (+)  
			  AND TO_CHAR(D1.AUD_STEP_CD)  != '10010' 
			  AND NVL(D2.EVL_RQS_YN, 'N')  != 'Y' /*위원평가 대상이 아닌 것*/
			]]>
				<isNotEmpty property="strAudYr">
					AND D2.AUD_YR = #strAudYr#
				</isNotEmpty>
				<isNotEmpty property="strTskNo">
					AND CASE WHEN LENGTH(#strTskNo#) = 3 AND D4.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D2.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
				</isNotEmpty>
				<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
				D4.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1)
		</isNotEmpty>
				<isNotEmpty property="strAudSbjNm">
					AND D2.AUD_SBJ_NM LIKE '%' || #strAudSbjNm# || '%'
				</isNotEmpty>
	        <![CDATA[  			  
			ORDER BY D2.HNDL_DIV_DPT_CD          
		]]>
	</select>
	<!-- ###################### 감사사항 가산점 관리(평가완료 전) 끝 (CSPAOE204P) ########################### -->
	
	<!-- 신규 or 수정된 정보를 저장한다. -->
	<update id="CSPAOE204Emainupdate" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO TBCSPAOE043M
		    USING DUAL
			   ON ( 
					    EVL_YR         = #EVL_YR#
					AND HLYR_DVSN_CD   = #HLYR_DVSN_CD#
					AND AUD_YR         = #AUD_YR#
					AND TSK_NO         = #TSK_NO#
					AND AUD_KND_CD     = #AUD_KND_CD#
			  	   )
			WHEN MATCHED  THEN 		
				UPDATE 
				   SET FNL_MDF_DH      = SYSDATE
				     , SPE_ADD_SC      = #SPE_ADD_SC#
		             , MDT_ASC         = #MDT_ASC#
		             , FNL_USR_ID      = #FNL_USR_ID#
		             , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		             , FNL_MNU_ID      = #FNL_MNU_ID#
		]]>
		<![CDATA[
            WHEN NOT MATCHED THEN 
				INSERT 
				    (
					       EVL_YR
						 , HLYR_DVSN_CD
						 , AUD_YR
						 , TSK_NO
						 , AUD_KND_CD
						 , SPE_ADD_SC
						 , MDT_ASC
					 	 , FRT_USR_ID
					 	 , FNL_USR_ID
						 , FNL_DEAL_DPT_CD
						 , FNL_MNU_ID
						 , FRT_REGI_DH
						 , FNL_MDF_DH
					)  VALUES 
					(
					       #EVL_YR#
						 , #HLYR_DVSN_CD#
						 , #AUD_YR#
						 , #TSK_NO#
						 , #AUD_KND_CD#
						 , #SPE_ADD_SC#
						 , #MDT_ASC#
						 , #FNL_USR_ID#
						 , #FNL_USR_ID#
						 , #FNL_DEAL_DPT_CD#
						 , #FNL_MNU_ID#
						 , SYSDATE
						 , SYSDATE	
					 )
		]]>
	</update>
	<!-- ############ 유화경 마지막 ############# -->

	
	<!-- emcha 시작 -->
	<!-- 사용자에 따라 메뉴 권한을 조회한다. -->
	<select id="CSPAOECommonPstCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT PST_CD
			  FROM TBDCMACM001M
			 WHERE CNB = #strChgrCnb#
		  ]]>
	</select>

	<!-- 감사업무별 평점항목관리 조회 -->
	<select id="CSPAOE009ETskDvsnCdSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CD
     			 , CD_NM
  			  FROM TBDCMACM013C
 			  WHERE 1=1
   			    AND CD <> '000000000'
   				AND CMM_CD_DVSN_CD ='1000269'
   				AND CD IN ('10000', '10001')
   				AND USE_YN = 'Y'
   		      ORDER BY CD ASC
		]]>
	</select>

	<!-- 감사업무별 평점항목관리 조회 -->
	<select id="CSPAOE009EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR			/*평가년도*/
			     , HLYR_DVSN_CD		/*반기구분코드*/
			     , TSK_DVSN_CD		/*업무구분코드*/
			     , FML_TXT			/*수식내용*/
			  FROM TBCSPAOE013M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			 ORDER BY TSK_DVSN_CD
		]]>
	</select>

	<!-- 감사업무별 평점항목관리 신규 -->
	<insert id="CSPAOE009EMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE013M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			,
			FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			,
			#FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 마스터 삭제전 디테일 카운트 -->
	<select id="CSPAOE009ECntSubSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE014D
			 WHERE EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD = #TSK_DVSN_CD#
		]]>
	</select>

	<!-- 감사업무별 평점항목관리 삭제 -->
	<delete id="CSPAOE009EMainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE013M
		 WHERE EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD = #TSK_DVSN_CD#
	</delete>

	<!-- 수식항목 상세 조회 -->
	<select id="CSPAOE009ESubSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D2.EVL_YR			/*평가년도*/
			     , D2.HLYR_DVSN_CD		/*반기구분코드*/
			     , D2.TSK_DVSN_CD		/*업무구분코드*/
			     , D2.FML_CLU_CD		/*수식항목코드*/
			     , D2.FML_CLU_NM		/*수식항목명*/
			     , D2.USE_YN			/*사용여부*/
			  FROM TBCSPAOE013M D1
			     , TBCSPAOE014D D2
			 WHERE 1=1
			   AND D1.EVL_YR = D2.EVL_YR
			   AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			   AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
			   AND D2.EVL_YR = #strEvlYr#
			   AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND D2.TSK_DVSN_CD = #strTskDvsnCd#
			 ORDER BY D2.FML_CLU_CD
		]]>
	</select>

	<!-- 수식항목 상세 신규 -->
	<insert id="CSPAOE009ESubInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE014D
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, FML_CLU_CD
			, FML_CLU_NM
			, USE_YN
			,
			FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #FML_CLU_CD#
			, #FML_CLU_NM#
			, #USE_YN#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 수식항목 상세 저장 -->
	<update id="CSPAOE009ESubUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE014D
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE009E'
		<isNotEmpty prepend="," property="FML_CLU_NM">
			FML_CLU_NM = #FML_CLU_NM#
		</isNotEmpty>
		<isEmpty prepend="," property="USE_YN">
			USE_YN = #USE_YN#
		</isEmpty>
		<isNotEmpty prepend="," property="USE_YN">
			USE_YN = #USE_YN#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD = #TSK_DVSN_CD#
		  AND FML_CLU_CD = #FML_CLU_CD#
	</update>

	<!-- 수식항목 상세 삭제 -->
	<delete id="CSPAOE009ESubDelete" parameterClass="paramMap">
		DELETE TBCSPAOE014D
		 WHERE 1 = 1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND TSK_DVSN_CD = #TSK_DVSN_CD#
		   AND FML_CLU_CD = #FML_CLU_CD#
	</delete>

	<!-- 감사업무별 평점수식관리(팝업) 수식항목 갯수 조회 -->
	<select id="CSPAOE010PCntFmlCluCdSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT COUNT(FML_CLU_CD) AS CNT 
			  FROM TBCSPAOE014D
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = #strTskDvsnCd#
			   AND USE_YN = 'Y'
			 ORDER BY FML_CLU_CD ASC
		]]>
	</select>

	<!-- 감사업무별 평점수식관리(팝업) 수식항목명 조회 -->
	<select id="CSPAOE010PFmlCluCdSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR		/*평가년도*/
			     , HLYR_DVSN_CD	/*반기구분코드*/
			     , TSK_DVSN_CD	/*업무구분코드*/
			     , FML_CLU_CD	/*수식항목코드*/
			     , FML_CLU_NM || '(' || FML_CLU_CD || ')' AS FML_CLU_NM	/*수식항목명*/
			  FROM TBCSPAOE014D
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = #strTskDvsnCd#
			   AND USE_YN = 'Y'
			 ORDER BY FML_CLU_CD ASC
		]]>
	</select>

	<!-- 감사업무별 평점수식관리(팝업) 조회 -->
	<select id="CSPAOE010PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR			/*평가년도*/
			     , HLYR_DVSN_CD		/*반기구분코드*/
			     , TSK_DVSN_CD		/*업무구분코드*/
			     , FML_TXT			/*수식내용*/
			  FROM TBCSPAOE013M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = #strTskDvsnCd#
		]]>
	</select>

	<!-- 감사업무별 평점수식관리(팝업) 저장 -->
	<update id="CSPAOE010PMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE013M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE010P'
		<isNotEmpty prepend="," property="FML_TXT">
			FML_TXT = #FML_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD = #TSK_DVSN_CD#
	</update>

	<!-- 감사업무별 평점수식관리 조회 -->
	<select id="CSPAOE011EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR			/*평가년도*/
			     , HLYR_DVSN_CD		/*반기구분코드*/
			     , TSK_DVSN_CD		/*업무구분코드*/
			     , FML_TXT			/*수식내용*/
			  FROM TBCSPAOE013M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = #strTskDvsnCd#
		]]>
	</select>

	<!-- 감사업무별 평점수식관리 저장 -->
	<update id="CSPAOE011EMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE013M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE011E'
		<isNotEmpty prepend="," property="FML_TXT">
			FML_TXT = #FML_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD = #TSK_DVSN_CD#
	</update>

	<!-- 참여인원별 개인기여율 상한관리 조회 -->
	<select id="CSPAOE012EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR				/*평가년도*/
			     , HLYR_DVSN_CD			/*반기구분코드*/
			     , SEQ_NO				/*순서번호*/
			     , JON_NOP_MORE_CNT		/*참여인원이상수*/
			     , JON_NOP_LES_CNT		/*참여인원이하수*/
			     , MAXM_RT				/*상한비율*/
			  FROM TBCSPAOE015M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		     ORDER BY SEQ_NO ASC
		]]>
	</select>

	<!-- 참여인원별 개인기여율 상한관리 건수 조회 -->
	<select id="CSPAOE012ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT	/*참여인원별 개인기여율 상한 건수*/
			  FROM TBCSPAOE015M
			 WHERE 1=1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND SEQ_NO = #SEQ_NO#
		]]>
	</select>

	<!-- 참여인원별 개인기여율 상한관리 신규 -->
	<insert id="CSPAOE012EMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE015M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, SEQ_NO
			, JON_NOP_MORE_CNT
			, JON_NOP_LES_CNT
			, MAXM_RT
			,
			FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, (SELECT
					CASE WHEN MAX(SEQ_NO) IS NULL THEN 1
					ELSE MAX(SEQ_NO)+1
					END AS SEQ_NO
				FROM TBCSPAOE015M
				WHERE 1=1
				AND EVL_YR = #EVL_YR#
				AND HLYR_DVSN_CD = #HLYR_DVSN_CD#)
			, #JON_NOP_MORE_CNT#
			, #JON_NOP_LES_CNT#
			, #MAXM_RT#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			,
			#FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 참여인원별 개인기여율 상한관리 저장 -->
	<update id="CSPAOE012EMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE015M
		SET 
		 	FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE012E'
		<isNotEmpty prepend="," property="JON_NOP_MORE_CNT">
			JON_NOP_MORE_CNT = #JON_NOP_MORE_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="JON_NOP_LES_CNT">
			JON_NOP_LES_CNT = #JON_NOP_LES_CNT#
		</isNotEmpty>
		<isEmpty prepend="," property="JON_NOP_LES_CNT">
			JON_NOP_LES_CNT = #JON_NOP_LES_CNT#
		</isEmpty>
		<isNotEmpty prepend="," property="MAXM_RT">
			MAXM_RT = #MAXM_RT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND SEQ_NO = #SEQ_NO#
	</update>

	<!-- 참여인원별 개인기여율 상한관리 삭제 -->
	<delete id="CSPAOE012EMainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE015M
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND SEQ_NO = #SEQ_NO#
	</delete>

	<!-- 감사업무 불문율관리 중복데이터 조회 -->
	<select id="CSPAOE086ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE042M
			 WHERE 1=1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD = #TSK_DVSN_CD#
			   AND AUD_KND_CD = #AUD_KND_CD#
		]]>
	</select>

	<!-- 감사업무 불문율관리 조회 -->
	<select id="CSPAOE086EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR			/*평가년도*/
			     , HLYR_DVSN_CD		/*반기구분코드*/
			     , TSK_DVSN_CD		/*업무구분코드*/
			     , AUD_KND_CD		/*감사종류코드*/
			     , UNW_RTE			/*불문율*/
			     , AV_EVL_RK_VAL	/*평균평가등급값*/
			  FROM TBCSPAOE042M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = #strTskDvsnCd#
		  ORDER BY AUD_KND_CD ASC
		]]>
	</select>

	<!-- 감사업무 불문율관리 신규 -->
	<insert id="CSPAOE086EMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE042M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_KND_CD
			, UNW_RTE
			, AV_EVL_RK_VAL
			,
			FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #AUD_KND_CD#
			, #UNW_RTE#
			,
			#AV_EVL_RK_VAL#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			,
			#FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사업무 불문율관리 저장 -->
	<update id="CSPAOE086EMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE042M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE086E'
		<isEmpty prepend="," property="UNW_RTE">
			UNW_RTE = ''
		</isEmpty>
		<isEmpty prepend="," property="AV_EVL_RK_VAL">
			AV_EVL_RK_VAL = ''
		</isEmpty>
		<isNotEmpty prepend="," property="UNW_RTE">
			UNW_RTE = #UNW_RTE#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AV_EVL_RK_VAL">
			AV_EVL_RK_VAL = #AV_EVL_RK_VAL#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CL_RT">
			CL_RT = #CL_RT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND AUD_KND_CD = #AUD_KND_CD#
	</update>

	<!-- 감사업무 불문율관리 삭제 -->
	<delete id="CSPAOE086EMainDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE TBCSPAOE042M
			 WHERE 1 = 1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD = #TSK_DVSN_CD#
			   AND AUD_KND_CD = #AUD_KND_CD#
		]]>
	</delete>

	<!-- 다면평가 평가기간 중복데이터 조회 -->
	<select id="CSPAOE073ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE037M
			 WHERE 1=1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		]]>
	</select>

	<!-- 다면평가 평가기간 정보 조회 -->
	<select id="CSPAOE073EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR 			/*평가년도*/
			     , HLYR_DVSN_CD		/*반기구분코드*/
			     , EVL_STR_DT		/*평가시작일*/
			     , EVL_END_DT		/*평가종료일*/
			     , ACMP_EVL_ASC_RT	/*실적평가 평점비율*/
			     , MNSD_EVL_ASC_RT	/*다면평가 평점비율*/
			  FROM TBCSPAOE037M
			 WHERE EVL_YR = #strEvlYr#
		     ORDER BY EVL_YR, HLYR_DVSN_CD ASC
		]]>
	</select>

	<!-- 다면평가 평가기간 신규등록 -->
	<insert id="CSPAOE073EMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE037M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, EVL_STR_DT
			, EVL_END_DT
			, ACMP_EVL_ASC_RT
			,
			MNSD_EVL_ASC_RT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			,
			FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#EVL_YR#
			, #HLYR_DVSN_CD#
			, #EVL_STR_DT#
			, #EVL_END_DT#
			, #ACMP_EVL_ASC_RT#
			,
			#MNSD_EVL_ASC_RT#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			,
			#FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 다면평가 평가기간 정보 수정 -->
	<update id="CSPAOE073EMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE037M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE073E'
		<isNotEmpty prepend="," property="EVL_STR_DT">
			EVL_STR_DT = #EVL_STR_DT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EVL_END_DT">
			EVL_END_DT = #EVL_END_DT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ACMP_EVL_ASC_RT">
			ACMP_EVL_ASC_RT = #ACMP_EVL_ASC_RT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="MNSD_EVL_ASC_RT">
			MNSD_EVL_ASC_RT = #MNSD_EVL_ASC_RT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
	</update>

	<!-- 다면평가 평가기간 정보 삭제 -->
	<delete id="CSPAOE073EMainDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE TBCSPAOE037M
			 WHERE 1 = 1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		]]>
	</delete>

	<!-- 다면평가 평가기간 정보 복사 전 데이터 존재여부 확인 -->
	<select id="CSPAOE073ECopyCntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE037M
			 WHERE EVL_YR = #strEvlYr#
		]]>
	</select>

	<!-- 다면평가 평가기간 정보 복사 점 데이터 삭제 -->
	<delete id="CSPAOE073ECopyDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE TBCSPAOE037M
			 WHERE EVL_YR = #strEvlYr#
		]]>
	</delete>

	<!-- 다면평가 평가기간 정보 복사 -->
	<insert id="CSPAOE073ECopyInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE037M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, EVL_STR_DT
			, EVL_END_DT
			, ACMP_EVL_ASC_RT
			,
			MNSD_EVL_ASC_RT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			,
			FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #strEvlYr#
			, HLYR_DVSN_CD
			, EVL_STR_DT
			, EVL_END_DT
			, ACMP_EVL_ASC_RT
			, MNSD_EVL_ASC_RT
			, FNL_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, SYSDATE AS FRT_REGI_DH
			, SYSDATE AS FNL_MDF_DH
		FROM TBCSPAOE037M
		WHERE EVL_YR = #strBfEvlYr#
	</insert>

	<!-- 감사업무 평가요청 조회 -->
	<select id="CSPAOE085EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR 	   /*평가년도*/
       			 , D1.EVL_RQS_YN   /*평가요청여부*/
       			 , CASE WHEN D1.EVL_RQS_YN IS NULL THEN '10' WHEN D1.EVL_RQS_YN = 'N' THEN '10' ELSE '20' END AS EVL_STA_CD /*요청상태코드*/
       			 , NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D5.AUD_KND_CD, '-'),D1.AUD_YR||'-'||D1.TSK_NO) AS TSK_YR_NO /*감사연번호*/
       			 , D1.TSK_NO	  /*업무번호*/
       			 , D3.AUD_STEP_CD /*감사단계코드*/
       			 , CASE WHEN D4.AUD_END_YN IS NULL THEN '' ELSE '종료' END AS AUD_END_YN  /*감사종료여부*/
       			 , D1.AUD_SBJ_NM  /*감사사항명*/
       			 , F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM /*2014.02.04 최원형 감사관 요청*/
			FROM TBCSPAOE021M D1
   			   , (
		            SELECT AUD_YR
		                 , TSK_NO
		                 , MAX(AUD_STEP_CD) AS AUD_STEP_CD
		              FROM TBCSPAOE022M
		             WHERE AUD_YR = #strEvlYr#
		               AND CMPT_DT IS NOT NULL
		          GROUP BY AUD_YR, TSK_NO
		         ) D3
		       , TBCSPAOE022M D4
		       ,TBBADDED001M D5
			WHERE 1=1
   			  AND D1.AUD_YR = D3.AUD_YR
			  AND D1.TSK_NO = D3.TSK_NO
			  AND D3.AUD_YR = D4.AUD_YR
		      AND D3.TSK_NO = D4.TSK_NO
		      AND D1.AUD_YR = D5.AUD_YR (+)
			  AND D1.TSK_NO = D5.AUD_NO (+)
		      AND D3.AUD_STEP_CD = D4.AUD_STEP_CD
		      AND D3.AUD_STEP_CD NOT IN ('10000','10001','10002','10003','10010')
  			  AND D1.AUD_YR = #strEvlYr#
  			  ]]>
		<isNotEmpty prepend="AND" property="strTskNo">
			CASE WHEN LENGTH(#strTskNo#) = 3 AND D5.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D1.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			D1.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			SUBSTR(D5.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
		</isNotEmpty>
	 	<![CDATA[
	     ORDER BY D1.HNDL_DIV_DPT_CD, D1.AUD_YR, D1.TSK_NO
		]]>
	</select>

	<!-- 감사업무 평가요청 저장 -->
	<update id="CSPAOE085ERequestUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPAOE021M
			   SET EVL_RQS_YN = 'Y'
			 WHERE 1 = 1
			   AND AUD_YR = #AUD_YR#
			   AND TSK_NO = #TSK_NO#
		]]>		   
	</update>

	<!-- 감사업무 평가요청 취소 저장 -->
	<update id="CSPAOE085ECancelUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPAOE021M
			   SET EVL_RQS_YN = 'N'
			 WHERE 1 = 1
			   AND AUD_YR = #AUD_YR#
			   AND TSK_NO = #TSK_NO#
		]]>
	</update>
	
	<!-- 감사사항 조회 -->
	<select id="CSPAOE015PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR 		/*감사년도*/
			     , D1.TSK_NO		/*감사번호*/
			     , NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D2.AUD_KND_CD, '-'),D1.AUD_YR || '-' || D1.TSK_NO) AS AUD_YR_NO	/*감사연번호*/
			     , D1.AUD_KND_CD	/*감사종류코드*/
			     , D1.AUD_SBJ_NM	/*감사사항명*/
			     , D1.HNDL_DIV_DPT_CD	/*처리과*/
			  FROM TBCSPAOE021M D1
			  		,TBBADDED001M D2
			 WHERE 1=1
			   AND D1.AUD_YR = #strAudYr#
			   AND LENGTH(D1.TSK_NO) = 3
			   AND D1.HNDL_DIV_DPT_CD = #strUsrDptCd#
			   AND D1.aud_yr = D2.aud_yr (+)
   				and D1.tsk_no = D2.AUD_NO (+)
		]]>
		<isNotEmpty prepend="AND" property="strAudNo">
			       D2.AUD_GRN_NO = #strAudNo#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			       D1.AUD_SBJ_NM like '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			SUBSTR(D2.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
		</isNotEmpty>
	 	<![CDATA[
	      ORDER BY D1.AUD_YR, D1.TSK_NO ASC
		]]>
	</select>

	<!-- 감사사항등록(팝업) 건수 조회 -->
	<select id="CSPAOE022PCntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE021M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
		]]>
	</select>
	
	<!-- 감사사항등록(팝업) 조회 -->
	<select id="CSPAOE022PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT AUD_YR 	   /*감사년도*/
       			 , AUD_KND_CD	/*감사종류*/
       			 , AUD_YR||'-'||TSK_NO AS TSK_YR_NO /*감사연번호*/
       			 , TSK_NO	  /*업무번호*/
       			 , AUD_SBJ_NM  /*감사사항명*/
       			 , HNDL_DIV_DPT_CD	/*처리과 부서코드*/
       			 , MNDY_CNT	/*연인원*/
			  FROM TBCSPAOE021M
			 WHERE 1=1
  			   AND AUD_YR = #strAudYr#
  			   AND AUD_ACTV_CON_YN IS NULL
  			   AND LENGTH(TSK_NO) > 3
  			   AND HNDL_DIV_DPT_CD = #strUsrDptCd#
  		]]>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strTskNo">
			TSK_NO = #strTskNo#
		</isNotEmpty>
	 	<![CDATA[
		  ORDER BY AUD_YR, TSK_NO
		]]>
	</select>

	<!-- 감사사항등록(팝업) 신규 -->
	<insert id="CSPAOE022PMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE021M
		(
			AUD_YR
			, TSK_NO
			, AUD_KND_CD
			, AUD_SBJ_NM
			, HNDL_DIV_DPT_CD
			, MNDY_CNT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#AUD_YR#
			, (SELECT CASE WHEN COUNT(TSK_NO) = 0 THEN 90001
					       ELSE MAX(TSK_NO)+1
					  END AS TSK_NO
			     FROM TBCSPAOE021M
		     	WHERE 1=1
		    	  AND AUD_YR = #AUD_YR#
				  AND LENGTH(TSK_NO) >= 5)
			, #AUD_KND_CD#
			, #AUD_SBJ_NM#
			, #HNDL_DIV_DPT_CD#
			, #MNDY_CNT#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사사항등록(팝업) 저장 -->
	<update id="CSPAOE022PMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE021M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE022P'
		<isNotEmpty prepend="," property="AUD_SBJ_NM">
			AUD_SBJ_NM = #AUD_SBJ_NM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
	</update>

	<!-- 감사사항등록(팝업) 삭제 -->
	<delete id="CSPAOE022PMainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE021M
		 WHERE 1 = 1
		   AND AUD_YR = #AUD_YR#
		   AND TSK_NO = #TSK_NO#
	</delete>

	<!-- 감사업무관리-업무현황 조회 -->
	<select id="CSPAOE023EFrfMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR	/*평가년도*/
     			 , D1.TSK_NO	/*감사번호*/
     			 , D1.AUD_YR||'-'||D1.TSK_NO AS TSK_YR_NO	/*감사연번호*/
    	 		 , D1.AUD_SBJ_NM	/*감사사항명*/
     			 , D1.HNDL_DIV_DPT_CD	/*처리과부서코드*/
     			 , F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM  /*처리과명*/
     			 , D1.TG_ORG_NM	/*대상기관명*/
     			 , D1.AUD_KND_CD	/*감사종류코드*/
     			 , D6.AUD_STEP_CD	/*감사단계코드기말*/
     		 	 , D1.AUD_LDR_CNB	/*감사단장 전산번호*/
     			 , D1.AUD_LDR_BLT_DPT_CD	/*감사단장소속부서코드*/
     			 , D1.AUD_LDR_RANK_CD	/*감사단장직급코드*/
     			 , D3.USR_NAM AS AUD_LDR_NM	/*감사단장성명*/
     			 , D1.SPVR_CNB	/*주관자전산번호*/
     			 , D1.SPVR_BLT_DPT_CD	/*주관자소속부서코드*/
     			 , D1.SPVR_RANK_CD	/*주관자직급코드*/
     			 , D4.USR_NAM AS SPVR_NM	/*주관자성명*/
     			 , D1.AST_CNB	/*보조자전산번호*/
     			 , D1.AST_BLT_DPT_CD	/*보조자소속부서코드*/
     			 , D1.AST_RANK_CD	/*보조자직급코드*/
     			 , D5.USR_NAM AS AST_NM /*보조자성명*/
     			 , NVL(D1.BZT_AM,0) AS BZT_AM	/*출장금액*/
     			 , CASE WHEN (SELECT LUNH_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10000') IS NULL THEN ''
			            ELSE SUBSTR((SELECT LUNH_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10000'),1,4)||'-'||SUBSTR((SELECT LUNH_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10000'),5,2)||'-'||SUBSTR((SELECT LUNH_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10000'),7,2)
			          END AS RSV_INSPC_LUNH_DT	/*예비조사착수일*/
     			 , CASE WHEN (SELECT CMPT_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10010') IS NULL THEN ''
			            ELSE SUBSTR((SELECT CMPT_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10010'),1,4)||'-'||SUBSTR((SELECT CMPT_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10010'),5,2)||'-'||SUBSTR((SELECT CMPT_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10010'),7,2)
			          END AS ENF_DT	/*시행일*/
     			 , '' AS TOT_AUD_OP_PRD_DCN	/*총감사운영기간일수*/
     			 , NVL(D1.MNDY_CNT, 9) AS MNDY_CNT	/*연인원수*/
    	 		 , CASE WHEN D2.DLAY_DT_NM IS NULL THEN '0' ELSE D2.DLAY_DT_NM END AS DLAY_DT_NM	/*지연일명*/
     			 , CASE WHEN D2.EXET_DCN IS NULL THEN 0 ELSE D2.EXET_DCN END AS EXET_DCN	/*면책일수*/
     			 , '' AS STUT_NOP_CNT	/*단계별인원수*/
     			 , '' AS STUT_PRD_DCN	/*단계별기간일수*/
     			 , D1.MAIN_INDC_SBJ_PRB_TXT	/*주요지적사항문제점내용*/
     			 , D1.MAIN_AUD_RSLT_EPT_EFCT_TXT	/*주요감사결과기대효과내용*/
     			 , D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT	/*특기사항계획대비기여율변경사유내용*/
			  FROM TBCSPAOE021M D1
     		 	   LEFT JOIN TBCSPAOE022M D2
            	 	      ON D1.AUD_YR = D2.AUD_YR
           		   	     AND D1.TSK_NO = D2.TSK_NO
           	     , TBDCMACM001M D3
                 , TBDCMACM001M D4
                 , TBDCMACM001M D5
                 , (
			            SELECT NVL(MAX(AUD_STEP_CD),'') AS AUD_STEP_CD
			            FROM TBCSPAOE022M
			            WHERE AUD_YR = #strAudYr#
			              AND TSK_NO = #strTskNo# 
			              AND CMPT_DT IS NOT NULL
			       ) D6
		     WHERE ROWNUM = 1
		       AND D1.AUD_LDR_CNB = D3.CNB (+)
		       AND D1.SPVR_CNB = D4.CNB (+)
		       AND D1.AST_CNB = D5.CNB (+)
			   AND D1.AUD_YR = #strAudYr#
			   AND D1.TSK_NO = #strTskNo#
		]]>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
				   D1.AUD_SBJ_NM = #strAudSbjNm#
		</isNotEmpty>
	</select>

	<!-- 감사업무관리-업무현황 저장 -->
	<update id="CSPAOE023EFrfMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE021M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="HNDL_DIV_DPT_CD">
			HNDL_DIV_DPT_CD = #HNDL_DIV_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="TG_ORG_NM">
			TG_ORG_NM = #TG_ORG_NM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AUD_KND_CD">
			AUD_KND_CD = #AUD_KND_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AUD_LDR_CNB">
			AUD_LDR_CNB = #AUD_LDR_CNB#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AUD_LDR_BLT_DPT_CD">
			AUD_LDR_BLT_DPT_CD = #AUD_LDR_BLT_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AUD_LDR_RANK_CD">
			AUD_LDR_RANK_CD = #AUD_LDR_RANK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SPVR_CNB">
			SPVR_CNB = #SPVR_CNB#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SPVR_BLT_DPT_CD">
			SPVR_BLT_DPT_CD = #SPVR_BLT_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SPVR_RANK_CD">
			SPVR_RANK_CD = #SPVR_RANK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AST_CNB">
			AST_CNB = #AST_CNB#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AST_BLT_DPT_CD">
			AST_BLT_DPT_CD = #AST_BLT_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AST_RANK_CD">
			AST_RANK_CD = #AST_RANK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="BZT_AM">
			BZT_AM = #BZT_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="MNDY_CNT">
			MNDY_CNT = #MNDY_CNT#
		</isNotEmpty>
		<isEmpty prepend="," property="MAIN_INDC_SBJ_PRB_TXT">
			MAIN_INDC_SBJ_PRB_TXT = #MAIN_INDC_SBJ_PRB_TXT#
		</isEmpty>
		<isEmpty prepend="," property="MAIN_AUD_RSLT_EPT_EFCT_TXT">
			MAIN_AUD_RSLT_EPT_EFCT_TXT = #MAIN_AUD_RSLT_EPT_EFCT_TXT#
		</isEmpty>
		<isEmpty prepend="," property="SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT">
			SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT =
			#SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT#
		</isEmpty>
		<isNotEmpty prepend="," property="MAIN_INDC_SBJ_PRB_TXT">
			MAIN_INDC_SBJ_PRB_TXT = #MAIN_INDC_SBJ_PRB_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="MAIN_AUD_RSLT_EPT_EFCT_TXT">
			MAIN_AUD_RSLT_EPT_EFCT_TXT = #MAIN_AUD_RSLT_EPT_EFCT_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT">
			SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT =
			#SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		AND AUD_YR = #AUD_YR#
		AND TSK_NO = #TSK_NO#
	</update>

	<!-- 감사업무관리-처리단계 중복데이터 조회 -->
	<select id="CSPAOE023ECntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE022M
			 WHERE 1=1
			   AND AUD_YR = #AUD_YR#
			   AND TSK_NO = #TSK_NO#
			   AND AUD_STEP_CD = #AUD_STEP_CD#
		]]>
	</select>

	<!-- 감사업무관리-처리단계 조회 -->
	<select id="CSPAOE023EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR			/*평가년도*/
     			 , D1.TSK_NO			/*감사번호*/
    	 		 , D1.AUD_STEP_CD		/*감사단계코드*/
     			 , NVL(D1.STAD_PRD_DCN, D3.STAD_PRD_DCN) AS STAD_PRD_DCN		/*기준기간수*/
     			 , D1.LUNH_DT			/*착수일*/
     			 , D1.CMPT_DT			/*완료일*/
       			 , CASE WHEN D1.AUD_STEP_CD = '10000' THEN '첨부 요망'
            			WHEN D1.AUD_STEP_CD = '10001' THEN '첨부 요망'
            			WHEN D1.AUD_STEP_CD = '10004' THEN '첨부 요망'
            			WHEN D1.AUD_STEP_CD = '10010' THEN '첨부 요망'
       			   ELSE ''
       			   END AS ECM_NAME		/*첨부파일정보유형코드*/
     			 , D1.DLAY_DT_NM /*지연일명*/
     			 , NVL(D1.DLAY_ADD_DCN,0) AS DLAY_ADD_DCN 		/*지연가산일수*/
     			 , NVL(D1.EXET_DCN,0) AS EXET_DCN			/*면책일*/
     			 , (SELECT TO_CHAR(MAX(TO_NUMBER(EVL_STR_DT))) FROM TBCSPAOE001M WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT) AS EVL_STR_DT
       			 , (SELECT TO_CHAR(MAX(TO_NUMBER(EVL_END_DT))) FROM TBCSPAOE001M WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT) AS EVL_END_DT
			 FROM TBCSPAOE022M D1
			    , TBCSPAOE021M D2
			    , (SELECT AUD_KND_CD, AUD_STEP_CD, STAD_PRD_DCN 
			    	 FROM TBCSPAOE008D A
			    	WHERE 1 = 1
			    	  AND A.EVL_YR = (SELECT MAX(EVL_YR)
               					        FROM TBCSPAOE001M)
               		  AND A.HLYR_DVSN_CD = (SELECT MAX(HLYR_DVSN_CD)
               							      FROM TBCSPAOE001M
               						         WHERE EVL_YR = (SELECT MAX(EVL_YR)
               					                               FROM TBCSPAOE001M))) D3
			 WHERE 1=1
			   AND D1.AUD_YR = D2.AUD_YR
               AND D1.TSK_NO = D2.TSK_NO
               AND D2.AUD_KND_CD = D3.AUD_KND_CD
               AND D1.AUD_STEP_CD = D3.AUD_STEP_CD
			   AND D1.AUD_YR = #strAudYr#
			   AND D1.TSK_NO = #strTskNo#
			 /*  AND (D1.AUD_STEP_CD NOT IN ('10007') OR D1.AUD_STEP_CD IS NULL ) 신규 추가 2016-05-20 삭제 2019.05.10 */
			   
	    ]]>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
				   D2.AUD_SBJ_NM = #strAudSbjNm#
		</isNotEmpty>
		<![CDATA[
	      ORDER BY D1.AUD_YR, D1.TSK_NO, D1.AUD_STEP_CD ASC
		]]>
	</select>

	<!-- 감사업무관리-처리단계 데이터 건수 조회 -->
	<select id="CSPAOE023EAudStepCntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE022M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
		]]>
	</select>

	<!-- 감사업무관리-처리단계 감사단계 자동 인서트 -->
	<insert id="CSPAOE023EAudStepInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE022M
		(
			AUD_YR
			, TSK_NO
			, AUD_STEP_CD
			, STAD_PRD_DCN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #strAudYr#
			, #strTskNo#
			, D1.CD AS AUD_STEP_CD
			, D3.STAD_PRD_DCN
			, ' '
			, ' '
			, ' '
			, 'CSPAOE023E'
			, SYSDATE
			, SYSDATE
		FROM TBDCMACM013C D1
			, TBCSPAOE008D D3
		WHERE D1.CD = D3.AUD_STEP_CD
		AND D3.EVL_YR = (SELECT EVL_YR 
						   FROM TBCSPAOE001M 
						  WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT)
		AND D3.HLYR_DVSN_CD = (SELECT HLYR_DVSN_CD 
		                         FROM TBCSPAOE001M 
		                        WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT)
		AND D3.TSK_DVSN_CD = '10000'
		AND D3.AUD_KND_CD = (SELECT AUD_KND_CD 
		                       FROM TBCSPAOE021M 
		                      WHERE AUD_YR = #strAudYr# 
		                        AND TSK_NO = #strTskNo#)
		AND D1.CMM_CD_DVSN_CD = '1000273'
		AND NVL(D1.USE_YN, 'N') = 'Y'
		AND D1.CD NOT IN ('000000000')
	</insert>

	<!-- 감사업무관리-처리단계 신규등록 -->
	<insert id="CSPAOE023EMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE022M
		(
			AUD_YR
			, TSK_NO
			, AUD_STEP_CD
			, STAD_PRD_DCN
			, LUNH_DT
			, CMPT_DT
			, DLAY_DT_NM
			, DLAY_ADD_DCN
			, EXET_DCN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #AUD_YR#
			, #TSK_NO#
			, #AUD_STEP_CD#
			, #STAD_PRD_DCN#
			, #LUNH_DT#
			, #CMPT_DT#
			, #DLAY_DT_NM#
			, #DLAY_ADD_DCN#
			, #EXET_DCN#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사업무관리-처리단계 저장 -->
	<update id="CSPAOE023EMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE023E'
			,STAD_PRD_DCN = #STAD_PRD_DCN#
		<isEmpty prepend="," property="LUNH_DT">
			LUNH_DT = #CMPT_DT#
		</isEmpty>
		<isEmpty prepend="," property="CMPT_DT">
			CMPT_DT = #CMPT_DT#
		</isEmpty>
		<isEmpty prepend="," property="DLAY_DT_NM">
			DLAY_DT_NM = #DLAY_DT_NM#
		</isEmpty>
		<isNotEmpty prepend="," property="LUNH_DT">
			LUNH_DT = #LUNH_DT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CMPT_DT">
			CMPT_DT = #CMPT_DT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="DLAY_DT_NM">
			DLAY_DT_NM = #DLAY_DT_NM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="DLAY_ADD_DCN">
			DLAY_ADD_DCN = #DLAY_ADD_DCN#
		</isNotEmpty>
		<isEmpty prepend="," property="DLAY_ADD_DCN">
			DLAY_ADD_DCN = #DLAY_ADD_DCN#
		</isEmpty>
		<isNotEmpty prepend="," property="EXET_DCN">
			EXET_DCN = #EXET_DCN#
		</isNotEmpty>
		<isEmpty prepend="," property="EXET_DCN">
			EXET_DCN = #EXET_DCN#
		</isEmpty>
		<isNotEmpty prepend="," property="AUD_END_YN">
			AUD_END_YN = #AUD_END_YN#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYT_TRTM_YN">
			SYT_TRTM_YN = #SYT_TRTM_YN#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
		  AND AUD_STEP_CD = #AUD_STEP_CD#
	</update>

	<!-- 감사업무관리-처리단계 첨부파일 개수 조회 -->
	<select id="CSPAOE023EAttCntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT COUNT(DOC_ID) AS CNT
			  FROM TBCSPAOE040M
			 WHERE 1=1
			   AND AUD_YR = #AUD_YR#
			   AND TSK_NO = #TSK_NO#
			   AND DOC_TYP_CD = #DOC_TYP_CD#
		]]>
	</select>

	<!-- 감사업무관리-처리단계 첨부파일 예비조사계획서 신규등록 -->
	<insert id="CSPAOE023EMainTyp1AttInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE040M
		(
			  AUD_YR
			, TSK_NO
			, DOC_TYP_CD
			, DOC_ID
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #AUD_YR#
			, #TSK_NO#
			, #TYPE1_DOC_TYP_CD#
			, TRIM(#TYPE1_DOC_ID#)
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>
	
	<!-- 감사업무관리-처리단계 첨부파일 실지감사계획서 신규등록 -->
	<insert id="CSPAOE023EMainTyp2AttInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE040M
		(
			  AUD_YR
			, TSK_NO
			, DOC_TYP_CD
			, DOC_ID
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #AUD_YR#
			, #TSK_NO#
			, #TYPE2_DOC_TYP_CD#
			, TRIM(#TYPE2_DOC_ID#)
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>
	
	<!-- 감사업무관리-처리단계 첨부파일 귀청보고서 신규등록 -->
	<insert id="CSPAOE023EMainTyp3AttInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE040M
		(
			  AUD_YR
			, TSK_NO
			, DOC_TYP_CD
			, DOC_ID
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #AUD_YR#
			, #TSK_NO#
			, #TYPE3_DOC_TYP_CD#
			, TRIM(#TYPE3_DOC_ID#)
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>
	
	<!-- 감사업무관리-처리단계 첨부파일 기여율배분계획서 신규등록 -->
	<insert id="CSPAOE023EMainTyp4AttInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE040M
		(
			  AUD_YR
			, TSK_NO
			, DOC_TYP_CD
			, DOC_ID
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #AUD_YR#
			, #TSK_NO#
			, #TYPE4_DOC_TYP_CD#
			, TRIM(#TYPE4_DOC_ID#)
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>
	
	<!-- 감사업무관리-처리단계 첨부파일 감사결과보고서 신규등록 -->
	<insert id="CSPAOE023EMainTyp5AttInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE040M
		(
			  AUD_YR
			, TSK_NO
			, DOC_TYP_CD
			, DOC_ID
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #AUD_YR#
			, #TSK_NO#
			, #TYPE5_DOC_TYP_CD#
			, TRIM(#TYPE5_DOC_ID#)
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>
	
	<!-- 감사업무관리-처리단계 첨부파일 변경사항대조표 신규등록 -->
	<insert id="CSPAOE023EMainTyp6AttInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE040M
		(
			  AUD_YR
			, TSK_NO
			, DOC_TYP_CD
			, DOC_ID
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #AUD_YR#
			, #TSK_NO#
			, #TYPE6_DOC_TYP_CD#
			, TRIM(#TYPE6_DOC_ID#)
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>
	
	<!-- 감사업무관리-처리단계 첨부파일 변경의결사항대조표 신규등록 -->
	<insert id="CSPAOE023EMainTyp7AttInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE040M
		(
			  AUD_YR
			, TSK_NO
			, DOC_TYP_CD
			, DOC_ID
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #AUD_YR#
			, #TSK_NO#
			, #TYPE7_DOC_TYP_CD#
			, TRIM(#TYPE7_DOC_ID#)
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>
	
	<!-- 감사업무관리-처리단계 첨부파일 삭제 -->
	<delete id="CSPAOE023EAttDelete" parameterClass="paramMap">
		DELETE TBCSPAOE040M
		WHERE 1 = 1
		AND AUD_YR = #AUD_YR#
		AND TSK_NO = #TSK_NO#
		AND DOC_TYP_CD = #DOC_TYP_CD#
		AND DOC_ID = TRIM(#DOC_ID#)
	</delete>

	<!-- 감사업무관리-처리단계 삭제 -->
	<delete id="CSPAOE023EMainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE022M
		 WHERE 1 = 1
		   AND AUD_YR = #AUD_YR#
		   AND TSK_NO = #TSK_NO#
		   AND AUD_STEP_CD = #AUD_STEP_CD#
	</delete>

	<!-- 감사업무관리-처리단계 감사종료 저장 -->
	<update id="CSPAOE023EAudEndUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		SET 
			FNL_MDF_DH = SYSDATE
			, AUD_END_YN = #strAudEndYn#
			, FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #strAudYr#
		  AND TSK_NO = #strTskNo#
		  AND AUD_STEP_CD = (SELECT MAX(AUD_STEP_CD) AS AUD_STEP_CD
							   FROM TBCSPAOE022M
							  WHERE 1=1
							    AND AUD_YR = #strAudYr#
							    AND TSK_NO = #strTskNo#
							    AND CMPT_DT IS NOT NULL)
	</update>

	<!-- 감사업무관리-처리단계 종합처리안 체크 여부 조회 -->
	<select id="CSPAOE023ESytTrtmYnSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT NVL(SYT_TRTM_YN,'N') AS SYT_TRTM_YN	/*종합처리안여부*/
			  FROM TBCSPAOE022M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
			   AND AUD_STEP_CD = '10004'
		]]>
	</select>

	<!-- 감사업무관리-처리단계 국장/단장 단계 데이터 존재 여부 조회 -->
	<select id="CSPAOE023ESytTrtmCntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE022M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
			   AND AUD_STEP_CD = '10005'
		]]>
	</select>
	
	<!-- 감사업무관리-처리단계 종합처리안 저장 -->
	<update id="CSPAOE023ESytTrtmYUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		SET 
			FNL_MDF_DH = SYSDATE
			, SYT_TRTM_YN = 'Y'
			, FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #strAudYr#
		  AND TSK_NO = #strTskNo#
		  AND AUD_STEP_CD = '10004'
	</update>

	<!-- 감사업무관리-처리단계 종합처리안 취소 -->
	<update id="CSPAOE023ESytTrtmNUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		SET 
			FNL_MDF_DH = SYSDATE
			, SYT_TRTM_YN = 'N'
			, FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #strAudYr#
		  AND TSK_NO = #strTskNo#
		  AND AUD_STEP_CD = '10004'
	</update>
	
	<!-- 감사업무관리-처리단계 종합처리안 국장/단장 5일 추가 저장 -->
	<update id="CSPAOE023ESytTrtmYnUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		SET 
			FNL_MDF_DH = SYSDATE
			, STAD_PRD_DCN =STAD_PRD_DCN+5
			, DLAY_DT_NM = TO_NUMBER(TO_DATE(CMPT_DT) - TO_DATE(LUNH_DT)) - (STAD_PRD_DCN+5)
			, FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #strAudYr#
		  AND TSK_NO = #strTskNo#
		  AND AUD_STEP_CD = '10005'
	</update>

	<!-- 감사업무관리-처리단계 종합처리안 국장/단장 5일 추가 취소 -->
	<update id="CSPAOE023ESytTrtmYnCancelUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		SET 
			FNL_MDF_DH = SYSDATE
			, STAD_PRD_DCN = STAD_PRD_DCN-5
			, DLAY_DT_NM = TO_NUMBER(TO_DATE(CMPT_DT) - TO_DATE(LUNH_DT)) - (STAD_PRD_DCN-5)
			, FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #strAudYr#
		  AND TSK_NO = #strTskNo#
		  AND AUD_STEP_CD = '10005'
	</update>

	<!-- 감사업무관리-처리단계 이전단계 완료일 조회 -->
	<select id="CSPAOE023ECmptDtSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT AUD_STEP_CD
			     , CASE WHEN AUD_STEP_CD = '10000' THEN ' '
			       ELSE NVL(CMPT_DT, 'null') END AS CMPT_DT	/*완료일*/
			  FROM TBCSPAOE022M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
			   AND AUD_STEP_CD = #strAudStepCd#
		]]>
	</select>

	<!-- 감사업무관리-처리지연 조회 -->
	<select id="CSPAOE023EParamSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR	/*감사년도*/
     			 , D1.TSK_NO	/*감사번호*/
    	 		 , D1.AUD_STEP_CD	/*감사단계코드*/
     			 , NVL(D1.STAD_PRD_DCN, D3.STAD_PRD_DCN) AS STAD_PRD_DCN	/*기준기간수*/
     			 , D1.DLAY_DT_NM	/*지연일명*/
     			 , D1.LUNH_DT		/*착수일*/
     			 , D1.CMPT_DT		/*완료일*/
     			 , D1.DLAY_ADD_DCN	/*지연가산일수*/
                 , D1.EXET_RQS_DCN	/*면책요청일수*/
     			 , D1.EXET_DCN	/*면책일수*/
                 , D1.DLAY_RSN_TXT	/*지연사유내용*/
                 , D1.DLAY_RPT_TXT	/*지연보고내용*/
			 FROM TBCSPAOE022M D1
			    , TBCSPAOE021M D2
			    , (SELECT AUD_KND_CD, AUD_STEP_CD, STAD_PRD_DCN 
			    	 FROM TBCSPAOE008D A
			    	WHERE 1 = 1
			    	  AND A.EVL_YR = (SELECT MAX(EVL_YR)
               					        FROM TBCSPAOE001M)
               		  AND A.HLYR_DVSN_CD = (SELECT MAX(HLYR_DVSN_CD)
               							      FROM TBCSPAOE001M
               						         WHERE EVL_YR = (SELECT MAX(EVL_YR)
               					                               FROM TBCSPAOE001M))) D3
			WHERE 1=1
			  AND D1.AUD_YR = D2.AUD_YR
              AND D1.TSK_NO = D2.TSK_NO
              AND D1.AUD_STEP_CD = D3.AUD_STEP_CD
			  AND D2.AUD_KND_CD = D3.AUD_KND_CD
			  AND D1.AUD_YR = #strAudYr#
			  AND D1.TSK_NO = #strTskNo#
			  /* AND (D1.AUD_STEP_CD NOT IN ('10007') OR D1.AUD_STEP_CD IS NULL ) 신규 추가 2016-05-20 삭제 2019.05.15*/
		 ]]>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			  D2.AUD_SBJ_NM = #strAudSbjNm#
		</isNotEmpty>	
		<![CDATA[  
			  AND D1.CMPT_DT IS NOT NULL
		]]>
	</select>

	<!-- 감사업무관리-처리지연 저장 -->
	<update id="CSPAOE023EParamUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE023E'
		<isEmpty prepend="," property="DLAY_DT_NM">
			DLAY_DT_NM = #DLAY_DT_NM#
		</isEmpty>
		<isEmpty prepend="," property="DLAY_ADD_DCN">
			DLAY_ADD_DCN = #DLAY_ADD_DCN#
		</isEmpty>
		<isEmpty prepend="," property="EXET_RQS_DCN">
			EXET_RQS_DCN = #EXET_RQS_DCN#
		</isEmpty>
		<isEmpty prepend="," property="EXET_DCN">
			EXET_DCN = #EXET_DCN#
		</isEmpty>
		<isEmpty prepend="," property="DLAY_RSN_TXT">
			DLAY_RSN_TXT = #DLAY_RSN_TXT#
		</isEmpty>
		<isEmpty prepend="," property="DLAY_RPT_TXT">
			DLAY_RPT_TXT = #DLAY_RPT_TXT#
		</isEmpty>
		<isNotEmpty prepend="," property="DLAY_DT_NM">
			DLAY_DT_NM = #DLAY_DT_NM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="DLAY_ADD_DCN">
			DLAY_ADD_DCN = #DLAY_ADD_DCN#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EXET_RQS_DCN">
			EXET_RQS_DCN = #EXET_RQS_DCN#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EXET_DCN">
			EXET_DCN = #EXET_DCN#
		</isNotEmpty>
		<isNotEmpty prepend="," property="DLAY_RSN_TXT">
			DLAY_RSN_TXT = #DLAY_RSN_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="DLAY_RPT_TXT">
			DLAY_RPT_TXT = #DLAY_RPT_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
		  AND AUD_STEP_CD = #AUD_STEP_CD#
	</update>

	<!-- 감사업무관리-참여인원 및 기여율 온로드시 부서코드 조회 -->
	<select id="CSPAOE023EEvlDptCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT DPT_CD AS CD	/*평가부서코드*/
     			 , DPT_NM AS CD_NM	/*평가부서명*/
  			  FROM TBDCMACM002M
  		  	 GROUP BY DPT_CD, DPT_NM
		]]>
	</select>

	<!-- 감사업무관리-참여인원 및 기여율 온로드시 감사종류코드 조회 -->
	<select id="CSPAOE023EAudKndCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CD		/*코드*/
       			 , CD_NM	/*코드명*/
  			  FROM TBDCMACM013C
 			 WHERE 1=1
   			   AND CD <> '000000000'
   			   AND USE_YN = 'Y'
   			   AND CMM_CD_DVSN_CD ='1000270'	/*감사종류코드*/
   			   AND CD NOT IN '10000'	/*감사종류: 공통종류코드 제외*/
		]]>
	</select>
	
	<!-- 감사업무관리(비연계) 온로드시 평가기간 조회 -->
	<select id="CSPAOE023EEvlDtListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_STR_DT	/*평가시작일*/
			     , EVL_END_DT	/*평가종료일*/
			  FROM TBCSPAOE001M
			 WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT
		]]>
	</select>

	<!-- 감사업무관리-참여인원 및 기여율 감사단계 목록 조회 -->
	<select id="CSPAOE023EInfoSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR	/*감사년도*/
     			 , D1.TSK_NO	/*감사번호*/
    	 		 , D1.AUD_STEP_CD	/*감사단계코드*/
    	 		 , (
    	 		 		SELECT B.CTB_RTE_CFM_RQS_YN
				          FROM ( 
				                    SELECT AUD_YR
				                         , TSK_NO
				                         , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX
				                      FROM TBCSPAOE022M
				                     WHERE CMPT_DT IS NOT NULL 
				                     GROUP BY AUD_YR, TSK_NO
				               ) A
				             , TBCSPAOE022M B
				         WHERE A.AUD_YR = B.AUD_YR
				           AND A.TSK_NO = B.TSK_NO
				           AND A.AUD_STEP_CD_MAX = B.AUD_STEP_CD
				           AND A.AUD_YR = #strAudYr#
				           AND A.TSK_NO = #strTskNo#
				           AND B.CMPT_DT IS NOT NULL
				           AND B.CTB_RTE_CFM_RQS_YN IS NOT NULL
				   ) AS CTB_RTE_CFM_RQS_YN	/*기여율확인요청여부*/
			 FROM TBCSPAOE022M D1
			    , TBCSPAOE021M D2
			 WHERE 1=1
			   AND D1.AUD_YR = D2.AUD_YR
               AND D1.TSK_NO = D2.TSK_NO
			   AND D1.AUD_YR = #strAudYr#
			   AND D1.TSK_NO = #strTskNo#
			   /*AND (D1.AUD_STEP_CD NOT IN ('10007') OR D1.AUD_STEP_CD IS NULL ) 신규 추가 2016-05-20 삭제 2019.05.15*/
	     ]]>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			   D2.AUD_SBJ_NM = #strAudSbjNm#
		</isNotEmpty>	
		<![CDATA[ 
			   AND D1.CMPT_DT IS NOT NULL
		]]>
	</select>

	<!-- 감사업무관리-참여인원 및 기여율 목록 조회 -->
	<select id="CSPAOE023EInfoSubSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR					/*감사년도*/
     			 , D1.TSK_NO					/*감사번호*/
    	 		 , D1.AUD_STEP_CD				/*감사단계코드*/
    	 		 , D1.PTCPT_CNB					/*참여자 전산번호*/
    	 		 , F_USR_INFO(D1.PTCPT_CNB, '2') AS NAM			/*참여자 성명*/
    	 		 , D1.BLT_DPT_CD				/*소속부서코드*/
    	 		 , D1.RANK_CD					/*직급코드*/
    	 		 , D1.JON_DVSN_CD				/*참여구분코드*/
    	 		 , D1.CTB_RTE					/*기여율*/
    	 		 , D1.EVL_RFR_SBJ_TXT			/*평가참고사항내용*/
			 FROM TBCSPAOE023M D1
			WHERE 1=1
			  AND D1.AUD_YR = #strAudYr#
			  AND D1.TSK_NO = #strTskNo#
			  AND D1.AUD_STEP_CD = #strAudStepCd#
		]]>
	</select>

	<!-- 감사업무관리-참여인원 및 기여율 예외승인 저장 -->
	<update id="CSPAOE023EExCofmUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE023M
		SET 
			FNL_MDF_DH = SYSDATE
			, EX_COFM_YN = 'Y'
			, FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="BLT_DPT_CD">
			BLT_DPT_CD = #BLT_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RANK_CD">
			RANK_CD = #RANK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="JON_DVSN_CD">
			JON_DVSN_CD = #JON_DVSN_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CTB_RTE">
			CTB_RTE = #CTB_RTE#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EVL_RFR_SBJ_TXT">
			EVL_RFR_SBJ_TXT = #EVL_RFR_SBJ_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
		  AND AUD_STEP_CD = #AUD_STEP_CD#
		  AND PTCPT_CNB = #PTCPT_CNB#
	</update>
	
	<!-- 감사업무관리-참여인원 및 기여율 예외승인 저장 -->
	<insert id="CSPAOE023EExCofmInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE023M
		(
			AUD_YR
			, TSK_NO
			, AUD_STEP_CD
			, PTCPT_CNB
			, BLT_DPT_CD
			, RANK_CD
			, JON_DVSN_CD
			,
			CTB_RTE
			, EVL_RFR_SBJ_TXT
			, EX_COFM_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			,
			FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#AUD_YR#
			, #TSK_NO#
			, #AUD_STEP_CD#
			, #PTCPT_CNB#
			, #BLT_DPT_CD#
			, #RANK_CD#
			,
			#JON_DVSN_CD#
			, #CTB_RTE#
			, #EVL_RFR_SBJ_TXT#
			, 'Y'
			, #FNL_USR_ID#
			,
			#FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사업무관리-참여인원 및 기여율 신규등록 -->
	<insert id="CSPAOE023EInfoSubInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE023M
		(
			AUD_YR
			, TSK_NO
			, AUD_STEP_CD
			, PTCPT_CNB
			, BLT_DPT_CD
			, RANK_CD
			, JON_DVSN_CD
			,
			CTB_RTE
			, EVL_RFR_SBJ_TXT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			,
			FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			#AUD_YR#
			, #TSK_NO#
			, #AUD_STEP_CD#
			, #PTCPT_CNB#
			, #BLT_DPT_CD#
			, #RANK_CD#
			,
			#JON_DVSN_CD#
			, #CTB_RTE#
			, #EVL_RFR_SBJ_TXT#
			, #FNL_USR_ID#
			,
			#FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사업무관리-참여인원 및 기여율 저장 -->
	<update id="CSPAOE023EInfoSubUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE023M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE023E'
			,EVL_RFR_SBJ_TXT = #EVL_RFR_SBJ_TXT#
		<isNotEmpty prepend="," property="BLT_DPT_CD">
			BLT_DPT_CD = #BLT_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RANK_CD">
			RANK_CD = #RANK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="JON_DVSN_CD">
			JON_DVSN_CD = #JON_DVSN_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CTB_RTE">
			CTB_RTE = #CTB_RTE#
		</isNotEmpty>
			
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
		  AND AUD_STEP_CD = #AUD_STEP_CD#
		  AND PTCPT_CNB = #PTCPT_CNB#
	</update>
	
	<!-- 감사업무관리-참여인원 및 기여율 확인요청취소 저장 -->
	<update id="CSPAOE023ECtbRteCfmNUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		   SET 
		   		FNL_MDF_DH = SYSDATE
		     	, CTB_RTE_CFM_RQS_YN = 'N'
		     	, CTB_RTE_CFM_BRUCHF_CNB = NULL
		     	, CTB_RTE_CFM_YN = 'N'
		     	, FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			   	FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			   	FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
		  AND AUD_STEP_CD = #AUD_STEP_CD#
	</update>

	<!-- 감사업무관리-참여인원 및 기여율 삭제 -->
	<delete id="CSPAOE023EInfoSubDelete" parameterClass="paramMap">
		<![CDATA[ 
			DELETE TBCSPAOE023M
			 WHERE 1 = 1
			   AND AUD_YR = #AUD_YR#
			   AND TSK_NO = #TSK_NO#
			   AND AUD_STEP_CD = #AUD_STEP_CD#
			   AND PTCPT_CNB = #PTCPT_CNB#
		]]>   
	</delete>

	<!-- 감사업무관리-참여인원 및 기여율 중복데이터 조회 -->
	<select id="CSPAOE023ECopyCntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE023M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
			   AND AUD_STEP_CD = #strAudStepCd#
		]]>
	</select>

	<!-- 감사업무관리-참여인원 및 기여율 전단계 입력정보 복사 -->
	<insert id="CSPAOE023ECopyInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE023M
		(
			  AUD_YR
			, TSK_NO
			, AUD_STEP_CD
			, PTCPT_CNB
			, BLT_DPT_CD
			, RANK_CD
			, JON_DVSN_CD
			, CTB_RTE
			, EVL_RFR_SBJ_TXT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT AUD_YR
			, TSK_NO
			, #strAudStepCd#
			, PTCPT_CNB
			, BLT_DPT_CD
			, RANK_CD
			, JON_DVSN_CD
			, CTB_RTE
			, EVL_RFR_SBJ_TXT
			, FNL_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, SYSDATE AS FRT_REGI_DH
			, SYSDATE AS FNL_MDF_DH
		  FROM TBCSPAOE023M
		 WHERE AUD_YR = #strAudYr#
		   AND TSK_NO = #strTskNo#
		   AND AUD_STEP_CD = DECODE(#strAudStepCd#,'10008','10006',TO_CHAR(TO_NUMBER(#strAudStepCd#) - 1))
	</insert>

	<!-- 감사업무관리-참여인원 및 기여율 전단계 입력정보 복사 점 데이터 삭제 -->
	<delete id="CSPAOE023ECopyDelete" parameterClass="paramMap">
		<![CDATA[ 
			DELETE TBCSPAOE023M
			 WHERE 1 = 1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
			   AND AUD_STEP_CD = #strAudStepCd#
		]]>
	</delete>

	<!-- 감사업무관리-참여인원 및 기여율 국장/과장 기여율 확인 여부 조회 -->
	<select id="CSPAOE023EFrfInfoDtlSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR						/*평가년도*/
     			 , D1.TSK_NO						/*감사번호*/
    	 		 , D1.AUD_STEP_CD					/*감사단계코드*/
    	 		 , D1.CTB_RTE_CFM_BRUCHF_CNB /*국장 전산번호*/
       			 , F_USR_INFO(D1.CTB_RTE_CFM_BRUCHF_CNB, '2') AS CTB_RTE_CFM_BRUCHF_NM   /*국장 성명*/
       			 , NVL(D1.CTB_RTE_CFM_YN, 'N') AS CTB_RTE_CFM_YN	/*기여율확인여부*/
       			 , CASE WHEN D1.CTB_RTE_CFM_BRUCHF_CNB IS NOT NULL AND NVL(D1.CTB_RTE_CFM_YN, 'N') = 'Y' THEN '확인완료'
                        WHEN D1.CTB_RTE_CFM_BRUCHF_CNB IS NOT NULL AND NVL(D1.CTB_RTE_CFM_YN, 'N') = 'N' THEN '미확인'
                        ELSE '결재자 지정하세요'
                 END AS CTB_RTE_CFM_YN_NM   /*기여율확인여부표시*/
                 , CASE WHEN D1.CTB_RTE_CFM_BRUCHF_CNB IS NOT NULL AND NVL(D1.CTB_RTE_CFM_RQS_YN, 'N') = 'Y' THEN 'Y'
                        ELSE 'N' END AS CTB_RTE_CFM_RQS_YN	/*기여율확인요청여부*/
			  FROM TBCSPAOE022M D1
			 WHERE 1=1
			   AND D1.AUD_YR = #strAudYr#
			   AND D1.TSK_NO = #strTskNo#
			   AND D1.AUD_STEP_CD = #strAudStepCd#
		]]>
	</select>

	<!-- 감사업무관리-참여인원 및 기여율 과장 확인 여부 조회 -->
	<select id="CSPAOE023ECtbRteCfmYnSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CASE WHEN CTB_RTE_CFM_DVCHF_CNB IS NOT NULL THEN 'Y' ELSE 'N' END AS CTB_RTE_CFM_DVCHF_YN	/*기여율 과장 확인 여부*/
			     , CASE WHEN CTB_RTE_CFM_BRUCHF_CNB IS NOT NULL THEN 'Y' ELSE 'N' END AS CTB_RTE_CFM_BRUCHF_YN	/*기여율 국장 확인 여부*/
			     , NVL((SELECT COUNT(AUD_STEP_CD) FROM TBCSPAOE023M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = #strAudStepCd# GROUP BY AUD_YR, TSK_NO, AUD_STEP_CD),0) AS PTCPT_CNB_CNT	/*참여 인원 수*/
			  FROM TBCSPAOE022M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
			   AND AUD_STEP_CD = (SELECT MAX(AUD_STEP_CD) AS AUD_STEP_CD
									FROM TBCSPAOE022M
							   	   WHERE 1=1
						        	 AND AUD_YR = #strAudYr#
								 	 AND TSK_NO = #strTskNo#
								 	 AND CMPT_DT IS NOT NULL)
		]]>
	</select>

	<!-- 감사업무관리-참여인원 및 기여율 과장 확인 -->
	<update id="CSPAOE023ECfmDvchfUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		SET 
			FNL_MDF_DH = SYSDATE
			, CTB_RTE_CFM_DVCHF_CNB = #strDvchfCnb#
			, FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #strAudYr#
		  AND TSK_NO = #strTskNo#
		  AND AUD_STEP_CD = (SELECT MAX(AUD_STEP_CD) AS AUD_STEP_CD
							   FROM TBCSPAOE022M
							  WHERE 1=1
							    AND AUD_YR = #strAudYr#
							    AND TSK_NO = #strTskNo#
							    AND CMPT_DT IS NOT NULL)
	</update>

	<!-- 감사업무관리-참여인원 및 기여율 국장 확인 -->
	<update id="CSPAOE023ECfmBruchfUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		SET 
			FNL_MDF_DH = SYSDATE
			, CTB_RTE_CFM_BRUCHF_CNB = #strBruchfCnb#
			, FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #strAudYr#
		  AND TSK_NO = #strTskNo#
		  AND AUD_STEP_CD = (SELECT MAX(AUD_STEP_CD) AS AUD_STEP_CD
							   FROM TBCSPAOE022M
							  WHERE 1=1
							    AND AUD_YR = #strAudYr#
							    AND TSK_NO = #strTskNo#
							    AND CMPT_DT IS NOT NULL)
	</update>
	
	<!-- 감사업무관리-참여인원 및 기여율 : 참여인원별 상한 기여율 조회 -->
	<select id="CSPAOE023EClRtSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT MAXM_RT
		      FROM TBCSPAOE015M
			 WHERE EVL_YR = (SELECT MAX(EVL_YR) 
			 				   FROM TBCSPAOE001M)
			   AND HLYR_DVSN_CD = (SELECT MAX(HLYR_DVSN_CD) 
								     FROM TBCSPAOE001M 
								    WHERE EVL_YR = (SELECT MAX(EVL_YR) 
								   					  FROM TBCSPAOE001M))
			   AND #strJonCnt# BETWEEN JON_NOP_MORE_CNT AND JON_NOP_LES_CNT
		]]>
	</select>

	<!-- 감사업무관리-참여인원 및 기여율 확인요청 저장 -->
	<update id="CSPAOE023ECtbRteCfmYnUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		   SET FNL_MDF_DH = SYSDATE
		     , CTB_RTE_CFM_RQS_YN = 'Y'
		     , FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			   FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			   FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #strAudYr#
		  AND TSK_NO = #strTskNo#
		  AND AUD_STEP_CD = (SELECT MAX(AUD_STEP_CD) AS AUD_STEP_CD
							   FROM TBCSPAOE022M
						      WHERE 1=1
							    AND AUD_YR = #strAudYr#
							    AND TSK_NO = #strTskNo#
							    AND CMPT_DT IS NOT NULL)
	</update>
	
	<!-- 감사업무관리-참여인원 및 기여율 : 과장 기여율 확인 메세지 연계 -->
	<insert id="CSPAOE023EMsgFInsert" parameterClass="paramMap">
	INSERT INTO TBDCMACM026L
		(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
			, MSG_TP_YN
			, MSG_TXT_2
			, RCNT_CNT
	        , RCNT_HIS
	        , ATT_FL_CN
	        , MSG_REGI_DH
	        , MSG_HNDL_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT (SELECT MAX(B.MSG_SNO) + 1 FROM TBDCMACM026L B)
		     , 'SP'
		     , 'OE'
		     , #strUsrId#
		     , '0'
		     , C.EVL_YR || '년 ' || F_CODE_NM('1000268', C.HLYR_DVSN_CD) || ' 감사업무 기여율 확인내역이 등록되었습니다.'
		     , 1
		     , #strBruchfCnb#
		     , '0'
		     , SYSDATE
		     , 'N'
		     , #strUsrId#
		     , #strUsrId#
		     , #strUsrDptCd#
		     , 'ptlOrderPortlet'
		     , SYSDATE
		     , SYSDATE
		FROM DUAL A
		   , (
		        SELECT D.EVL_YR
		             , D.HLYR_DVSN_CD
		          FROM TBCSPAOE001M D
		         WHERE SYSDATE BETWEEN D.EVL_STR_DT AND D.EVL_END_DT
		     ) C
	</insert>
	
	<!-- 감사업무관리-처리단계 : 기준기간 조회 -->
	<select id="CSPAOE023EStadPrdDcnSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT STAD_PRD_DCN	/*기준기간*/
			  FROM TBCSPAOE008D
			 WHERE 1=1
  			   AND EVL_YR = (SELECT EVL_YR 
  			   				   FROM TBCSPAOE001M 
  			   				  WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT)
  			   AND HLYR_DVSN_CD = (SELECT HLYR_DVSN_CD 
					  			     FROM TBCSPAOE001M 
					  			    WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT)
  			   AND TSK_DVSN_CD = '10000'
  			   AND AUD_KND_CD = (SELECT AUD_KND_CD 
					  			   FROM TBCSPAOE021M 
					  			  WHERE AUD_YR = #strAudYr# 
					  			    AND TSK_NO = #strTskNo#)
   			   AND AUD_STEP_CD = #strAudStepCd#
		]]>
	</select>
	
	<!-- 감사업무관리-참여인원 및 기여율 결재자 지정 -->
	<update id="CSPAOE023ECfmBruchfYnUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		SET 
			FNL_MDF_DH = SYSDATE
		  , CTB_RTE_CFM_BRUCHF_CNB = #strBruchfCnb#
		  , FNL_MNU_ID = 'CSPAOE023E'
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #strAudYr#
		  AND TSK_NO = #strTskNo#
		  AND AUD_STEP_CD = (SELECT MAX(AUD_STEP_CD) AS AUD_STEP_CD
							   FROM TBCSPAOE022M
							  WHERE 1=1
								AND AUD_YR = #strAudYr#
								AND TSK_NO = #strTskNo#
								AND CMPT_DT IS NOT NULL)
	</update>

	<!-- 지적사항총괄(팝업) 데이터 존재 여부 조회 -->
	<select id="CSPAOE072PCntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE036M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
		]]>
	</select>

	<!-- 지적사항총괄(팝업) 조회 -->
	<select id="CSPAOE072PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR	/*평가년도*/
			     , D1.TSK_NO	/*감사번호*/
                 , NVL(D3.UNW_RTE,0) AS UNW_RT	/*동일감사 평균 불문율*/
			     , D1.CPS_JUD_RTN_RPT_NOC	/*변상판정 귀청보고*/
			     , D1.CPS_JUD_ANEW_ADT_NOC	/*변상판정 새로추가*/
			     , D1.CPS_JUD_INCR_KND_CHG_NOC	/*변상펀정 증가 종류변경*/
			     , D1.CPS_JUD_DIMR_NOC	/*변상펀정  분건*/
			     , D1.CPS_JUD_UNW_NOC	/*변상펀정  불문*/
			     , D1.CPS_JUD_DECR_KND_CHG_NOC	/*변상펀정  감소 종류변경*/
			     , D1.CPS_JUD_SUC_NOC	/*변상펀정  합건*/
			     , D1.CPS_JUD_ETC_NOC	/*변상펀정  기타*/
			     , (D1.CPS_JUD_RTN_RPT_NOC+D1.CPS_JUD_ANEW_ADT_NOC+D1.CPS_JUD_INCR_KND_CHG_NOC+D1.CPS_JUD_DIMR_NOC-(D1.CPS_JUD_UNW_NOC+D1.CPS_JUD_DECR_KND_CHG_NOC+D1.CPS_JUD_SUC_NOC+D1.CPS_JUD_ETC_NOC)) AS CPS_JUD_NOC_NOW_SUM	/*변상펀정 현재*/
			     , D1.CPS_JUD_RTN_RPT_AM	/*변상판정금액 귀청보고*/
			     , D1.CPS_JUD_INCR_AM	/*변상판정금액 증가*/
			     , D1.CPS_JUD_DECR_AM	/*변상판정금액 감소*/
			     , (D1.CPS_JUD_RTN_RPT_AM+D1.CPS_JUD_INCR_AM-D1.CPS_JUD_DECR_AM) AS CPS_JUD_AM_NOW_SUM	/*변상판정금액 현재*/
			     , D1.CRCT_RTN_RPT_NOC	/*시정건수 귀청보고*/
			     , D1.CRCT_ANEW_ADT_NOC	/*시정건수  새로추가*/
			     , D1.CRCT_INCR_KND_CHG_NOC	/*시정건수 증가 종류변경*/
			     , D1.CRCT_DIMR_NOC	/*시정건수 분건*/
			     , D1.CRCT_UNW_NOC	/*시정건수 불문*/
			     , D1.CRCT_DECR_KND_CHG_NOC	/*시정건수 감소 종류변경*/
			     , D1.CRCT_SUC_NOC	/*시정건수 합건*/
			     , D1.CRCT_ETC_NOC	/*시정건수 기타*/
			     , (D1.CRCT_RTN_RPT_NOC+D1.CRCT_ANEW_ADT_NOC+D1.CRCT_INCR_KND_CHG_NOC+D1.CRCT_DIMR_NOC-(D1.CRCT_UNW_NOC+D1.CRCT_DECR_KND_CHG_NOC+D1.CRCT_SUC_NOC+D1.CRCT_ETC_NOC)) AS CRCT_NOC_NOW_SUM	/*시정건수 현재*/
			     , D1.CRCT_RTN_RPT_AM	/*시정금액 귀청보고*/
			     , D1.CRCT_INCR_AM	/*시정금액 증가*/
			     , D1.CRCT_DECR_AM	/*시정금액 감소*/
			     , (D1.CRCT_RTN_RPT_AM+D1.CRCT_INCR_AM-D1.CRCT_DECR_AM) AS CRCT_AM_NOW_SUM	/*시정금액 현재*/
			     , D1.PNSH_RTN_RPT_NOC	/*징계건수 귀청보고*/
			     , D1.PNSH_ANEW_ADT_NOC	/*징계건수 새로추가*/
			     , D1.PNSH_INCR_KND_CHG_NOC	/*징계건수 증가 종류변경*/
			     , D1.PNSH_DIMR_NOC	/*징계건수 분건*/
			     , D1.PNSH_UNW_NOC	/*징계건수 불문*/
			     , D1.PNSH_DECR_KND_CHG_NOC	/*징계건수 감소 종류변경*/
			     , D1.PNSH_SUC_NOC	/*징계건수 합건*/
			     , D1.PNSH_ETC_NOC	/*징계건수 기타*/
			     , (D1.PNSH_RTN_RPT_NOC+D1.PNSH_ANEW_ADT_NOC+D1.PNSH_INCR_KND_CHG_NOC+D1.PNSH_DIMR_NOC-(D1.PNSH_UNW_NOC+D1.PNSH_DECR_KND_CHG_NOC+D1.PNSH_SUC_NOC+D1.PNSH_ETC_NOC)) AS PNSH_NOC_NOW_SUM	/*징계건수 현재*/
			     , D1.PNSH_RTN_RPT_NOP_CNT	/*징계인원 귀청보고*/
			     , D1.PNSH_INCR_NOP_CNT	/*징계인원 증가*/
			     , D1.PNSH_DECR_NOP_CNT	/*징계인원 감소*/
			     , (D1.PNSH_RTN_RPT_NOP_CNT+D1.PNSH_INCR_NOP_CNT-D1.PNSH_DECR_NOP_CNT) AS PNSH_NOP_NOW_SUM	/*징계인원 현재*/
			     , D1.ATNT_RTN_RPT_NOC	/*주의건수 귀청보고*/
			     , D1.ATNT_ANEW_ADT_NOC	/*주의건수 새로추가*/
			     , D1.ATNT_INCR_KND_CHG_NOC	/*주의건수 증가 종류변경*/
			     , D1.ATNT_DIMR_NOC	/*주의건수  분건*/
			     , D1.ATNT_UNW_NOC	/*주의건수 불문*/
			     , D1.ATNT_DECR_KND_CHG_NOC	/*주의건수 감소 종류변경*/
			     , D1.ATNT_SUC_NOC	/*주의건수 합건*/
			     , D1.ATNT_ETC_NOC	/*주의건수 기타*/
			     , (D1.ATNT_RTN_RPT_NOC+D1.ATNT_ANEW_ADT_NOC+D1.ATNT_INCR_KND_CHG_NOC+D1.ATNT_DIMR_NOC-(D1.ATNT_UNW_NOC+D1.ATNT_DECR_KND_CHG_NOC+D1.ATNT_SUC_NOC+D1.ATNT_ETC_NOC)) AS ATNT_NOC_NOW_SUM	/*주의건수 현재*/
			     , D1.LAW_IMP_RTN_RPT_NOC	/*법령개선건수 귀청보고*/
			     , D1.LAW_IMP_ANEW_ADT_NOC	/*법령개선건수 새로추가*/
			     , D1.LAW_IMP_INCR_KND_CHG_NOC	/*법령개선건수 증가 종류변경*/
			     , D1.LAW_IMP_DIMR_NOC	/*법령개선건수 분건*/
			     , D1.LAW_IMP_UNW_NOC	/*법령개선건수 불문*/
			     , D1.LAW_IMP_DECR_KND_CHG_NOC	/*법령개선건수 감소 종류변경*/
			     , D1.LAW_IMP_SUC_NOC	/*법령개선건수 합건*/
			     , D1.LAW_IMP_ETC_NOC	/*법령개선건수 기타*/
			     , (D1.LAW_IMP_RTN_RPT_NOC+D1.LAW_IMP_ANEW_ADT_NOC+D1.LAW_IMP_INCR_KND_CHG_NOC+D1.LAW_IMP_DIMR_NOC-(D1.LAW_IMP_UNW_NOC+D1.LAW_IMP_DECR_KND_CHG_NOC+D1.LAW_IMP_SUC_NOC+D1.LAW_IMP_ETC_NOC)) AS LAW_IMP_NOC_NOW_SUM	/*법령개선건수 현재*/
			     , D1.SYE_IMP_RTN_RPT_NOC	/*제도개선건수 귀청보고*/
			     , D1.SYE_IMP_ANEW_ADT_NOC	/*제도개선건수 새로추가*/
			     , D1.SYE_IMP_INCR_KND_CHG_NOC	/*제도개선건수 증가 종류변경*/
			     , D1.SYE_IMP_DIMR_NOC	/*제도개선건수 분건*/
			     , D1.SYE_IMP_UNW_NOC	/*제도개선건수 불문*/
			     , D1.SYE_IMP_DECR_KND_CHG_NOC	/*제도개선건수 감소 종류변경*/
			     , D1.SYE_IMP_SUC_NOC	/*제도개선건수 합건*/
			     , D1.SYE_IMP_ETC_NOC	/*제도개선건수 기타*/
			     , (D1.SYE_IMP_RTN_RPT_NOC+D1.SYE_IMP_ANEW_ADT_NOC+D1.SYE_IMP_INCR_KND_CHG_NOC+D1.SYE_IMP_DIMR_NOC-(D1.SYE_IMP_UNW_NOC+D1.SYE_IMP_DECR_KND_CHG_NOC+D1.SYE_IMP_SUC_NOC+D1.SYE_IMP_ETC_NOC)) AS SYS_IMP_NOC_NOW_SUM	/*제도개선건수 현재*/
			     , D1.ADMN_IMP_RTN_RPT_NOC	/*행정개선건수 귀청보고*/
			     , D1.ADMN_IMP_ANEW_ADT_NOC	/*행정개선건수 새로추가*/
			     , D1.ADMN_IMP_INCR_KND_CHG_NOC	/*행정개선건수  증가 종류변경*/
			     , D1.ADMN_IMP_DIMR_NOC	/*행정개선건수  분건*/
			     , D1.ADMN_IMP_UNW_NOC	/*행정개선건수 불문*/
			     , D1.ADMN_IMP_DECR_KND_CHG_NOC	/*행정개선건수 감소 종류변경*/
			     , D1.ADMN_IMP_SUC_NOC	/*행정개선건수 합건*/
			     , D1.ADMN_IMP_ETC_NOC	/*행정개선건수 기타*/
			     , (D1.ADMN_IMP_RTN_RPT_NOC+D1.ADMN_IMP_ANEW_ADT_NOC+D1.ADMN_IMP_INCR_KND_CHG_NOC+D1.ADMN_IMP_DIMR_NOC-(D1.ADMN_IMP_UNW_NOC+D1.ADMN_IMP_DECR_KND_CHG_NOC+D1.ADMN_IMP_SUC_NOC+D1.ADMN_IMP_ETC_NOC)) AS ADMN_IMP_NOC_NOW_SUM	/*행정개선건수 현재*/
			     , D1.RDA_RTN_RPT_NOC	/*권고건수 귀청보고*/
			     , D1.RDA_ANEW_ADT_NOC	/*권고건수 새로추가*/
			     , D1.RDA_INCR_KND_CHG_NOC	/*권고건수 증가 종류변경*/
			     , D1.RDA_DIMR_NOC	/*권고건수 분건*/
			     , D1.RDA_UNW_NOC	/*권고건수 불문*/
			     , D1.RDA_DECR_KND_CHG_NOC	/*권고건수 감소 종류변경*/
			     , D1.RDA_SUC_NOC	/*권고건수 합건*/
			     , D1.RDA_ETC_NOC	/*권고건수 기타*/
			     , (D1.RDA_RTN_RPT_NOC+D1.RDA_ANEW_ADT_NOC+D1.RDA_INCR_KND_CHG_NOC+D1.RDA_DIMR_NOC-(D1.RDA_UNW_NOC+D1.RDA_DECR_KND_CHG_NOC+D1.RDA_SUC_NOC+D1.RDA_ETC_NOC)) AS RCD_NOC_NOW_SUM	/*권고건수 현재*/
			     , D1.GEN_NTF_RTN_RPT_NOC	/*일반통보건수 귀청보고*/
			     , D1.GEN_NTF_ANEW_ADT_NOC	/*일반통보건수 새로추가*/
			     , D1.GEN_NTF_INCR_KND_CHG_NOC	/*일반통보건수 증가 종류변경*/
			     , D1.GEN_NTF_DIMR_NOC	/*일반통보건수 분건*/
			     , D1.GEN_NTF_UNW_NOC	/*일반통보건수 불문*/
			     , D1.GEN_NTF_DECR_KND_CHG_NOC	/*일반통보건수 감소 종류변경*/
			     , D1.GEN_NTF_SUC_NOC	/*일반통보건수 합건*/
			     , D1.GEN_NTF_ETC_NOC	/*일반통보건수 기타*/
			     , (D1.GEN_NTF_RTN_RPT_NOC+D1.GEN_NTF_ANEW_ADT_NOC+D1.GEN_NTF_INCR_KND_CHG_NOC+D1.GEN_NTF_DIMR_NOC-(D1.GEN_NTF_UNW_NOC+D1.GEN_NTF_DECR_KND_CHG_NOC+D1.GEN_NTF_SUC_NOC+D1.GEN_NTF_ETC_NOC)) AS GEN_NTF_NOC_NOW_SUM	/*일반통보건수 현재*/
			     , D1.WRDO_NTF_RTN_RPT_NOC	/*비위통보건수 귀청보고*/
			     , D1.WRDO_NTF_ANEW_ADT_NOC	/*비위통보건수 새로추가*/
			     , D1.WRDO_NTF_INCR_KND_CHG_NOC	/*비위통보건수 증가 종류변경*/
			     , D1.WRDO_NTF_DIMR_NOC	/*비위통보건수 분건*/
			     , D1.WRDO_NTF_UNW_NOC	/*비위통보건수 불문*/
			     , D1.WRDO_NTF_DECR_KND_CHG_NOC	/*비위통보건수 감소 종류변경*/
			     , D1.WRDO_NTF_SUC_NOC	/*비위통보건수 합건*/
			     , D1.WRDO_NTF_ETC_NOC	/*비위통보건수 기타*/
			     , (D1.WRDO_NTF_RTN_RPT_NOC+D1.WRDO_NTF_ANEW_ADT_NOC+D1.WRDO_NTF_INCR_KND_CHG_NOC+D1.WRDO_NTF_DIMR_NOC-(D1.WRDO_NTF_UNW_NOC+D1.WRDO_NTF_DECR_KND_CHG_NOC+D1.WRDO_NTF_SUC_NOC+D1.WRDO_NTF_ETC_NOC)) AS WRDO_NTF_NOC_NOW_SUM	/*비위통보건수 현재*/
			     , D1.WRDO_NTF_RTN_RPT_NOP_CNT	/*비위통보인원 귀청보고*/
			     , D1.WRDO_NTF_ANEW_ADT_NOP_CNT	/*비위통보인원 새로추가*/
			     , D1.WRDO_NTF_INCR_KND_CHG_NOP_CNT	/*비위통보인원 증가 종류변경*/
			     , D1.WRDO_NTF_DIMR_NOP_CNT	/*비위통보인원 분건*/
			     , D1.WRDO_NTF_UNW_NOP_CNT	/*비위통보인원 불문*/
			     , D1.WRDO_NTF_DECR_KND_CHG_NOP_CNT	/*비위통보인원 감소 종류변경*/
			     , D1.WRDO_NTF_SUC_NOP_CNT	/*비위통보인원 합건*/
			     , D1.WRDO_NTF_ETC_NOP_CNT	/*비위통보인원 기타*/
			     , (D1.WRDO_NTF_RTN_RPT_NOP_CNT+D1.WRDO_NTF_ANEW_ADT_NOP_CNT+D1.WRDO_NTF_INCR_KND_CHG_NOP_CNT+D1.WRDO_NTF_DIMR_NOP_CNT-(D1.WRDO_NTF_UNW_NOP_CNT+D1.WRDO_NTF_DECR_KND_CHG_NOP_CNT+D1.WRDO_NTF_SUC_NOP_CNT+D1.WRDO_NTF_ETC_NOP_CNT)) AS WRDO_NTF_NOP_NOW_SUM	/*비위통보인원 현재*/
			     , D1.HRA_NTF_RTN_RPT_NOC	/*인사통보건수 귀청보고*/
			     , D1.HRA_NTF_ANEW_ADT_NOC	/*인사통보건수 새로추가*/
			     , D1.HRA_NTF_INCR_KND_CHG_NOC	/*인사통보건수 증가 종류변경*/
			     , D1.HRA_NTF_DIMR_NOC	/*인사통보건수 분건*/
			     , D1.HRA_NTF_UNW_NOC	/*인사통보건수 불문*/
			     , D1.HRA_NTF_NOC_KND_CHG_NOC	/*인사통보건수 감소 종류변경*/
			     , D1.HRA_NTF_SUC_NOC	/*인사통보건수 합건*/
			     , D1.HRA_NTF_ETC_NOC	/*인사통보건수 기타*/
			     , (D1.HRA_NTF_RTN_RPT_NOC+D1.HRA_NTF_ANEW_ADT_NOC+D1.HRA_NTF_INCR_KND_CHG_NOC+D1.HRA_NTF_DIMR_NOC-(D1.HRA_NTF_UNW_NOC+D1.HRA_NTF_NOC_KND_CHG_NOC+D1.HRA_NTF_SUC_NOC+D1.HRA_NTF_ETC_NOC)) AS HRA_NTF_NOC_NOW_SUM	/*인사통보건수 현재*/
			     , D1.HRA_NTF_RTN_RPT_NOP_CNT	/*인사통보인원 귀청보고*/
			     , D1.HRA_NTF_INCR_NOP_CNT	/*인사통보인원 증가*/
			     , D1.HRA_NTF_DECR_NOP_CNT	/*인사통보인원 감소*/
			     , (D1.HRA_NTF_RTN_RPT_NOP_CNT+D1.HRA_NTF_INCR_NOP_CNT-D1.HRA_NTF_DECR_NOP_CNT) AS HRA_NTF_NOP_NOW_SUM	/*인사통보인원 현재*/
			     , D1.EXPL_NTF_RTN_RPT_NOC	/*모범통보건수 귀청보고*/
			     , D1.EXPL_NTF_ANEW_ADT_NOC	/*모범통보건수 새로추가*/
			     , D1.EXPL_NTF_INCR_KND_CHG_NOC	/*모범통보건수 증가 종류변경*/
			     , D1.EXPL_NTF_DIMR_NOC	/*모범통보건수 분건*/
			     , D1.EXPL_NTF_UNW_NOC	/*모범통보건수 불문*/
			     , D1.EXPL_NTF_DECR_KND_CHG_NOC	/*모범통보건수 감소 종류변경*/
			     , D1.EXPL_NTF_SUC_NOC	/*모범통보건수 합건*/
			     , D1.EXPL_NTF_ETC_NOC	/*모범통보건수 기타*/
			     , (D1.EXPL_NTF_RTN_RPT_NOC+D1.EXPL_NTF_ANEW_ADT_NOC+D1.EXPL_NTF_INCR_KND_CHG_NOC+D1.EXPL_NTF_DIMR_NOC-(D1.EXPL_NTF_UNW_NOC+D1.EXPL_NTF_DECR_KND_CHG_NOC+D1.EXPL_NTF_SUC_NOC+D1.EXPL_NTF_ETC_NOC)) AS EXPL_NTF_NOC_NOW_SUM	/*모범통보건수 현재*/
			     , D1.PSC_RTN_RPT_NOC	/*고발건수 귀청보고*/
			     , D1.PSC_ANEW_ADT_NOC	/*고발건수 새로추가*/
			     , D1.PSC_INCR_KND_CHG_NOC	/*고발건수 증가 종류변경*/
			     , D1.PSC_DIMR_NOC	/*고발건수 분건*/
			     , D1.PSC_UNW_NOC	/*고발건수 불문*/
			     , D1.PSC_DECR_KND_CHG_NOC	/*고발건수 감소 종류변경*/
			     , D1.PSC_SUC_NOC	/*고발건수 합건*/
			     , D1.PSC_ETC_NOC	/*고발건수 기타*/
			     , (D1.PSC_RTN_RPT_NOC+D1.PSC_ANEW_ADT_NOC+D1.PSC_INCR_KND_CHG_NOC+D1.PSC_DIMR_NOC-(D1.PSC_UNW_NOC+D1.PSC_DECR_KND_CHG_NOC+D1.PSC_SUC_NOC+D1.PSC_ETC_NOC)) AS PSC_NOC_NOW_SUM	/*고발건수 현재*/
			     , D1.PSC_RTN_RPT_NOP_CNT	/*고발인원 귀청보고*/
			     , D1.PSC_INCR_NOP_CNT	/*고발인원 증가*/
			     , D1.PSC_DECR_NOP_CNT	/*고발인원 감소*/
			     , (D1.PSC_RTN_RPT_NOP_CNT+D1.PSC_INCR_NOP_CNT-D1.PSC_DECR_NOP_CNT) AS PSC_NOP_NOW_SUM	/*고발인원 현재*/
			     , D1.EPT_EFCT_RTN_RPT_AM	/*기대효과금액 귀청보고*/
			     , D1.EPT_EFCT_INCR_AM	/*기대효과금액 증가*/
			     , D1.EPT_EFCT_DECR_AM	/*기대효과금액 감소*/
			     , (D1.EPT_EFCT_RTN_RPT_AM+D1.EPT_EFCT_INCR_AM-D1.EPT_EFCT_DECR_AM) AS EPT_EFCT_AM_NOW_SUM	/*기대효과금액 현재*/
			     , D1.LOC_ACT_RTN_RPT_NOC		/* 현지조치 귀청보고건수 */
				 , D1.LOC_ACT_ANEW_ADT_NOC		/* 현지조치 새로추가건수 */
				 , D1.LOC_ACT_INCR_KND_CHG_NOC	/* 현지조치 증가종류변경건수 */
				 , D1.LOC_ACT_DIMR_NOC		/* 현지조치 분건건수 */
				 , D1.LOC_ACT_UNW_NOC			/* 현지조치 불문건수 */
				 , D1.LOC_ACT_DECR_KND_CHG_NOC	/* 현지조치 감소종류변경건수 */
				 , D1.LOC_ACT_SUC_NOC			/* 현지조치 합건건수 */
				 , D1.LOC_ACT_ETC_NOC			/* 현지조치 기타건수 */
				 , (D1.LOC_ACT_RTN_RPT_NOC + D1.LOC_ACT_ANEW_ADT_NOC + D1.LOC_ACT_INCR_KND_CHG_NOC + D1.LOC_ACT_DIMR_NOC
				  - (D1.LOC_ACT_UNW_NOC + D1.LOC_ACT_DECR_KND_CHG_NOC + D1.LOC_ACT_SUC_NOC + D1.LOC_ACT_ETC_NOC)) AS LOC_ACT_NOC_NOW_SUM	/*현재조치건수 현재*/
				 , D1.INV_REQ_RTN_RPT_NOC		/* 수사요청 귀청보고건수 */
				 , D1.INV_REQ_ANEW_ADT_NOC		/* 수사요청 새로추가건수 */
				 , D1.INV_REQ_INCR_KND_CHG_NOC	/* 수사요청 증가종류변경건수 */
				 , D1.INV_REQ_DIMR_NOC		/* 수사요청 분건건수 */
				 , D1.INV_REQ_UNW_NOC			/* 수사요청 불문건수 */
				 , D1.INV_REQ_DECR_KND_CHG_NOC	/* 수사요청 감소종류변경건수 */
				 , D1.INV_REQ_SUC_NOC			/* 수사요청 합건건수 */
				 , D1.INV_REQ_ETC_NOC			/* 수사요청 기타건수 */
				 , (D1.INV_REQ_RTN_RPT_NOC + D1.INV_REQ_ANEW_ADT_NOC + D1.INV_REQ_INCR_KND_CHG_NOC + D1.INV_REQ_DIMR_NOC
				  - (D1.INV_REQ_UNW_NOC + D1.INV_REQ_DECR_KND_CHG_NOC + D1.INV_REQ_SUC_NOC + D1.INV_REQ_ETC_NOC)) AS INV_REQ_NOC_NOW_SUM	/*수사요청건수 현재*/
				 , D1.INV_REQ_RTN_RPT_NOP_CNT		/* 수사요청 귀청보고인원수 */
				 , D1.INV_REQ_INCR_NOP_CNT		/* 수사요청 증가인원수 */
				 , D1.INV_REQ_DECR_NOP_CNT		/* 수사요청 감소인원수 */
			     , (D1.INV_REQ_RTN_RPT_NOP_CNT + D1.INV_REQ_INCR_NOP_CNT - D1.INV_REQ_DECR_NOP_CNT) AS INV_REQ_NOP_NOW_SUM	/*수사요청인원 현재*/
			     , (D1.PNSH_RTN_RPT_NOP_CNT+D1.WRDO_NTF_RTN_RPT_NOP_CNT+D1.HRA_NTF_RTN_RPT_NOP_CNT+D1.PSC_RTN_RPT_NOP_CNT
			      + D1.INV_REQ_RTN_RPT_NOP_CNT) AS NOP_SUM	/*귀청보고 인원 합계*/
			     , (D1.CPS_JUD_RTN_RPT_NOC+D1.CRCT_RTN_RPT_NOC+D1.PNSH_RTN_RPT_NOC+D1.ATNT_RTN_RPT_NOC+D1.LAW_IMP_RTN_RPT_NOC+D1.SYE_IMP_RTN_RPT_NOC+D1.ADMN_IMP_RTN_RPT_NOC+D1.RDA_RTN_RPT_NOC+D1.GEN_NTF_RTN_RPT_NOC+D1.WRDO_NTF_RTN_RPT_NOC+D1.HRA_NTF_RTN_RPT_NOC+D1.EXPL_NTF_RTN_RPT_NOC+D1.PSC_RTN_RPT_NOC
			      + D1.LOC_ACT_RTN_RPT_NOC + D1.INV_REQ_RTN_RPT_NOC) AS CNT_SUM	/*귀청보고 건수 합계*/
			     , (D1.CPS_JUD_RTN_RPT_AM+D1.CRCT_RTN_RPT_AM+EPT_EFCT_RTN_RPT_AM) AS AM_SUM	/*귀청보고 금액 합계*/
			     ,D1.CPS_JUD_ANEW_ADT_NOC+D1.CPS_JUD_INCR_KND_CHG_NOC+D1.CPS_JUD_DIMR_NOC
+D1.CRCT_ANEW_ADT_NOC+D1.CRCT_INCR_KND_CHG_NOC+D1.CRCT_DIMR_NOC
+D1.PNSH_ANEW_ADT_NOC+D1.PNSH_INCR_KND_CHG_NOC+D1.PNSH_DIMR_NOC
+D1.ATNT_ANEW_ADT_NOC+D1.ATNT_INCR_KND_CHG_NOC+D1.ATNT_DIMR_NOC
+D1.LAW_IMP_ANEW_ADT_NOC+D1.LAW_IMP_INCR_KND_CHG_NOC+D1.LAW_IMP_DIMR_NOC
+D1.SYE_IMP_ANEW_ADT_NOC+D1.SYE_IMP_INCR_KND_CHG_NOC+D1.SYE_IMP_DIMR_NOC
+D1.ADMN_IMP_ANEW_ADT_NOC+D1.ADMN_IMP_INCR_KND_CHG_NOC+D1.ADMN_IMP_DIMR_NOC
+D1.RDA_ANEW_ADT_NOC+D1.RDA_INCR_KND_CHG_NOC+D1.RDA_DIMR_NOC
+D1.GEN_NTF_ANEW_ADT_NOC+D1.GEN_NTF_INCR_KND_CHG_NOC+D1.GEN_NTF_DIMR_NOC
+D1.WRDO_NTF_ANEW_ADT_NOC+D1.WRDO_NTF_INCR_KND_CHG_NOC+D1.WRDO_NTF_DIMR_NOC
+D1.HRA_NTF_ANEW_ADT_NOC+D1.HRA_NTF_INCR_KND_CHG_NOC+D1.HRA_NTF_DIMR_NOC
+D1.EXPL_NTF_ANEW_ADT_NOC+D1.EXPL_NTF_INCR_KND_CHG_NOC+D1.EXPL_NTF_DIMR_NOC
+D1.PSC_ANEW_ADT_NOC+D1.PSC_INCR_KND_CHG_NOC+D1.PSC_DIMR_NOC
+ D1.LOC_ACT_ANEW_ADT_NOC + D1.LOC_ACT_INCR_KND_CHG_NOC + D1.LOC_ACT_DIMR_NOC
+ D1.INV_REQ_ANEW_ADT_NOC + D1.INV_REQ_INCR_KND_CHG_NOC + D1.INV_REQ_DIMR_NOC AS INCR_CNT_SUM /*증감건수 합계*/
,D1.CPS_JUD_INCR_AM+D1.CRCT_INCR_AM+D1.EPT_EFCT_INCR_AM AS INCR_AM_SUM /*증감금액합계*/
,D1.CPS_JUD_DECR_AM+CRCT_DECR_AM+EPT_EFCT_DECR_AM AS DECR_AM_SUM /*감소금액합계*/
,D1.PNSH_INCR_NOP_CNT+D1.WRDO_NTF_ANEW_ADT_NOP_CNT+D1.WRDO_NTF_INCR_KND_CHG_NOP_CNT+D1.WRDO_NTF_DIMR_NOP_CNT
+D1.HRA_NTF_INCR_NOP_CNT+D1.PSC_INCR_NOP_CNT+ D1.INV_REQ_INCR_NOP_CNT AS INCR_NOP_SUM /*증감인원합계*/
,D1.PNSH_DECR_NOP_CNT+D1.WRDO_NTF_UNW_NOP_CNT+D1.WRDO_NTF_DECR_KND_CHG_NOP_CNT+D1.WRDO_NTF_SUC_NOP_CNT+D1.WRDO_NTF_ETC_NOP_CNT
+D1.HRA_NTF_DECR_NOP_CNT+PSC_DECR_NOP_CNT+D1.INV_REQ_DECR_NOP_CNT AS DECR_NOP_SUM /*감소인원합계*/
			     , (D1.CPS_JUD_UNW_NOC+D1.CRCT_UNW_NOC+D1.PNSH_UNW_NOC+D1.ATNT_UNW_NOC+D1.LAW_IMP_UNW_NOC+D1.SYE_IMP_UNW_NOC+D1.ADMN_IMP_UNW_NOC+D1.RDA_UNW_NOC+D1.GEN_NTF_UNW_NOC+D1.WRDO_NTF_UNW_NOC+D1.HRA_NTF_UNW_NOC+D1.EXPL_NTF_UNW_NOC+D1.PSC_UNW_NOC
			      + D1.LOC_ACT_UNW_NOC + D1.INV_REQ_UNW_NOC) AS UNW_SUM	/*불문 건수 합계*/
			    ,(D1.CPS_JUD_DECR_KND_CHG_NOC+D1.CPS_JUD_SUC_NOC+D1.CPS_JUD_ETC_NOC)
+(D1.CRCT_DECR_KND_CHG_NOC+D1.CRCT_SUC_NOC+D1.CRCT_ETC_NOC)
+(D1.PNSH_DECR_KND_CHG_NOC+D1.PNSH_SUC_NOC+D1.PNSH_ETC_NOC)
+(D1.ATNT_DECR_KND_CHG_NOC+D1.ATNT_SUC_NOC+D1.ATNT_ETC_NOC)
+(D1.LAW_IMP_DECR_KND_CHG_NOC+D1.LAW_IMP_SUC_NOC+D1.LAW_IMP_ETC_NOC)
+(D1.SYE_IMP_DECR_KND_CHG_NOC+D1.SYE_IMP_SUC_NOC+D1.SYE_IMP_ETC_NOC)
+(D1.ADMN_IMP_DECR_KND_CHG_NOC+D1.ADMN_IMP_SUC_NOC+D1.ADMN_IMP_ETC_NOC)
+(D1.RDA_DECR_KND_CHG_NOC+D1.RDA_SUC_NOC+D1.RDA_ETC_NOC)
+(D1.GEN_NTF_DECR_KND_CHG_NOC+D1.GEN_NTF_SUC_NOC+D1.GEN_NTF_ETC_NOC)
+(D1.WRDO_NTF_DECR_KND_CHG_NOC+D1.WRDO_NTF_SUC_NOC+D1.WRDO_NTF_ETC_NOC)
+(D1.HRA_NTF_NOC_KND_CHG_NOC+D1.HRA_NTF_SUC_NOC+D1.HRA_NTF_ETC_NOC)
+(D1.EXPL_NTF_DECR_KND_CHG_NOC+D1.EXPL_NTF_SUC_NOC+D1.EXPL_NTF_ETC_NOC)
+(D1.PSC_DECR_KND_CHG_NOC+D1.PSC_SUC_NOC+D1.PSC_ETC_NOC)
+(D1.LOC_ACT_DECR_KND_CHG_NOC + D1.LOC_ACT_SUC_NOC + D1.LOC_ACT_ETC_NOC)
+(D1.INV_REQ_DECR_KND_CHG_NOC + D1.INV_REQ_SUC_NOC + D1.INV_REQ_ETC_NOC) AS DECR_CNT_SUM
			     , (D1.PNSH_RTN_RPT_NOP_CNT+D1.WRDO_NTF_RTN_RPT_NOP_CNT+D1.HRA_NTF_RTN_RPT_NOP_CNT+D1.PSC_RTN_RPT_NOP_CNT
			      + D1.INV_REQ_RTN_RPT_NOP_CNT) 
			      +(PNSH_INCR_NOP_CNT+WRDO_NTF_ANEW_ADT_NOP_CNT+WRDO_NTF_INCR_KND_CHG_NOP_CNT+WRDO_NTF_DIMR_NOP_CNT+HRA_NTF_INCR_NOP_CNT+PSC_INCR_NOP_CNT+INV_REQ_INCR_NOP_CNT)
			      -(PNSH_DECR_NOP_CNT+WRDO_NTF_UNW_NOP_CNT+WRDO_NTF_DECR_KND_CHG_NOP_CNT+WRDO_NTF_SUC_NOP_CNT+WRDO_NTF_ETC_NOP_CNT+HRA_NTF_DECR_NOP_CNT+PSC_DECR_NOP_CNT+INV_REQ_DECR_NOP_CNT)
			      AS NOP_NOW_SUM	/*현재 인원 합계*/
			     , (D1.CPS_JUD_RTN_RPT_NOC+D1.CPS_JUD_ANEW_ADT_NOC+D1.CPS_JUD_INCR_KND_CHG_NOC+D1.CPS_JUD_DIMR_NOC-(D1.CPS_JUD_UNW_NOC+D1.CPS_JUD_DECR_KND_CHG_NOC+D1.CPS_JUD_SUC_NOC+D1.CPS_JUD_ETC_NOC))
+(D1.CRCT_RTN_RPT_NOC+D1.CRCT_ANEW_ADT_NOC+D1.CRCT_INCR_KND_CHG_NOC+D1.CRCT_DIMR_NOC-(D1.CRCT_UNW_NOC+D1.CRCT_DECR_KND_CHG_NOC+D1.CRCT_SUC_NOC+D1.CRCT_ETC_NOC))
+(D1.PNSH_RTN_RPT_NOC+D1.PNSH_ANEW_ADT_NOC+D1.PNSH_INCR_KND_CHG_NOC+D1.PNSH_DIMR_NOC-(D1.PNSH_UNW_NOC+D1.PNSH_DECR_KND_CHG_NOC+D1.PNSH_SUC_NOC+D1.PNSH_ETC_NOC)) 
+(D1.ATNT_RTN_RPT_NOC+D1.ATNT_ANEW_ADT_NOC+D1.ATNT_INCR_KND_CHG_NOC+D1.ATNT_DIMR_NOC-(D1.ATNT_UNW_NOC+D1.ATNT_DECR_KND_CHG_NOC+D1.ATNT_SUC_NOC+D1.ATNT_ETC_NOC))
+(D1.LAW_IMP_RTN_RPT_NOC+D1.LAW_IMP_ANEW_ADT_NOC+D1.LAW_IMP_INCR_KND_CHG_NOC+D1.LAW_IMP_DIMR_NOC-(D1.LAW_IMP_UNW_NOC+D1.LAW_IMP_DECR_KND_CHG_NOC+D1.LAW_IMP_SUC_NOC+D1.LAW_IMP_ETC_NOC))
+(D1.SYE_IMP_RTN_RPT_NOC+D1.SYE_IMP_ANEW_ADT_NOC+D1.SYE_IMP_INCR_KND_CHG_NOC+D1.SYE_IMP_DIMR_NOC-(D1.SYE_IMP_UNW_NOC+D1.SYE_IMP_DECR_KND_CHG_NOC+D1.SYE_IMP_SUC_NOC+D1.SYE_IMP_ETC_NOC))
+(D1.ADMN_IMP_RTN_RPT_NOC+D1.ADMN_IMP_ANEW_ADT_NOC+D1.ADMN_IMP_INCR_KND_CHG_NOC+D1.ADMN_IMP_DIMR_NOC-(D1.ADMN_IMP_UNW_NOC+D1.ADMN_IMP_DECR_KND_CHG_NOC+D1.ADMN_IMP_SUC_NOC+D1.ADMN_IMP_ETC_NOC)) 
+(D1.RDA_RTN_RPT_NOC+D1.RDA_ANEW_ADT_NOC+D1.RDA_INCR_KND_CHG_NOC+D1.RDA_DIMR_NOC-(D1.RDA_UNW_NOC+D1.RDA_DECR_KND_CHG_NOC+D1.RDA_SUC_NOC+D1.RDA_ETC_NOC))
+(D1.GEN_NTF_RTN_RPT_NOC+D1.GEN_NTF_ANEW_ADT_NOC+D1.GEN_NTF_INCR_KND_CHG_NOC+D1.GEN_NTF_DIMR_NOC-(D1.GEN_NTF_UNW_NOC+D1.GEN_NTF_DECR_KND_CHG_NOC+D1.GEN_NTF_SUC_NOC+D1.GEN_NTF_ETC_NOC))
+(D1.WRDO_NTF_RTN_RPT_NOC+D1.WRDO_NTF_ANEW_ADT_NOC+D1.WRDO_NTF_INCR_KND_CHG_NOC+D1.WRDO_NTF_DIMR_NOC-(D1.WRDO_NTF_UNW_NOC+D1.WRDO_NTF_DECR_KND_CHG_NOC+D1.WRDO_NTF_SUC_NOC+D1.WRDO_NTF_ETC_NOC))
+(D1.HRA_NTF_RTN_RPT_NOC+D1.HRA_NTF_ANEW_ADT_NOC+D1.HRA_NTF_INCR_KND_CHG_NOC+D1.HRA_NTF_DIMR_NOC-(D1.HRA_NTF_UNW_NOC+D1.HRA_NTF_NOC_KND_CHG_NOC+D1.HRA_NTF_SUC_NOC+D1.HRA_NTF_ETC_NOC))
+(D1.EXPL_NTF_RTN_RPT_NOC+D1.EXPL_NTF_ANEW_ADT_NOC+D1.EXPL_NTF_INCR_KND_CHG_NOC+D1.EXPL_NTF_DIMR_NOC-(D1.EXPL_NTF_UNW_NOC+D1.EXPL_NTF_DECR_KND_CHG_NOC+D1.EXPL_NTF_SUC_NOC+D1.EXPL_NTF_ETC_NOC))
+(D1.PSC_RTN_RPT_NOC+D1.PSC_ANEW_ADT_NOC+D1.PSC_INCR_KND_CHG_NOC+D1.PSC_DIMR_NOC-(D1.PSC_UNW_NOC+D1.PSC_DECR_KND_CHG_NOC+D1.PSC_SUC_NOC+D1.PSC_ETC_NOC))
+(D1.LOC_ACT_RTN_RPT_NOC + D1.LOC_ACT_ANEW_ADT_NOC + D1.LOC_ACT_INCR_KND_CHG_NOC + D1.LOC_ACT_DIMR_NOC - (D1.LOC_ACT_UNW_NOC + D1.LOC_ACT_DECR_KND_CHG_NOC + D1.LOC_ACT_SUC_NOC + D1.LOC_ACT_ETC_NOC))
+(D1.INV_REQ_RTN_RPT_NOC + D1.INV_REQ_ANEW_ADT_NOC + D1.INV_REQ_INCR_KND_CHG_NOC + D1.INV_REQ_DIMR_NOC - (D1.INV_REQ_UNW_NOC + D1.INV_REQ_DECR_KND_CHG_NOC + D1.INV_REQ_SUC_NOC + D1.INV_REQ_ETC_NOC)) AS CNT_NOW_SUM	/*현재 건수 합계*/
			     ,(D1.CPS_JUD_RTN_RPT_AM+D1.CPS_JUD_INCR_AM-D1.CPS_JUD_DECR_AM)
+(D1.CRCT_RTN_RPT_AM+D1.CRCT_INCR_AM-D1.CRCT_DECR_AM) 
+(D1.EPT_EFCT_RTN_RPT_AM+D1.EPT_EFCT_INCR_AM-D1.EPT_EFCT_DECR_AM) AS AM_NOW_SUM	/*현재 금액 합계*/
			     , CASE WHEN (D1.CPS_JUD_RTN_RPT_NOC+D1.CRCT_RTN_RPT_NOC+D1.PNSH_RTN_RPT_NOC+D1.ATNT_RTN_RPT_NOC+D1.LAW_IMP_RTN_RPT_NOC+D1.SYE_IMP_RTN_RPT_NOC+D1.ADMN_IMP_RTN_RPT_NOC+D1.RDA_RTN_RPT_NOC+D1.GEN_NTF_RTN_RPT_NOC+D1.WRDO_NTF_RTN_RPT_NOC+D1.HRA_NTF_RTN_RPT_NOC+D1.EXPL_NTF_RTN_RPT_NOC+D1.PSC_RTN_RPT_NOC + D1.LOC_ACT_RTN_RPT_NOC + D1.INV_REQ_RTN_RPT_NOC) = 0 
			     	OR (D1.CPS_JUD_UNW_NOC+D1.CRCT_UNW_NOC+D1.PNSH_UNW_NOC+D1.ATNT_UNW_NOC+D1.LAW_IMP_UNW_NOC+D1.SYE_IMP_UNW_NOC+D1.ADMN_IMP_UNW_NOC+D1.RDA_UNW_NOC+D1.GEN_NTF_UNW_NOC+D1.WRDO_NTF_UNW_NOC+D1.WRDO_NTF_DIMR_NOP_CNT+D1.HRA_NTF_UNW_NOC+D1.EXPL_NTF_UNW_NOC+D1.PSC_UNW_NOC + D1.LOC_ACT_UNW_NOC + D1.INV_REQ_UNW_NOC) = 0
			             THEN 0
					     ELSE (ROUND((D1.CPS_JUD_UNW_NOC+D1.CRCT_UNW_NOC+D1.PNSH_UNW_NOC+D1.ATNT_UNW_NOC+D1.LAW_IMP_UNW_NOC+D1.SYE_IMP_UNW_NOC+D1.ADMN_IMP_UNW_NOC+D1.RDA_UNW_NOC+D1.GEN_NTF_UNW_NOC+D1.WRDO_NTF_UNW_NOC+D1.WRDO_NTF_DIMR_NOP_CNT+D1.HRA_NTF_UNW_NOC+D1.EXPL_NTF_UNW_NOC+D1.PSC_UNW_NOC + D1.LOC_ACT_UNW_NOC + D1.INV_REQ_UNW_NOC)/(D1.CPS_JUD_RTN_RPT_NOC+D1.CRCT_RTN_RPT_NOC+D1.PNSH_RTN_RPT_NOC+D1.ATNT_RTN_RPT_NOC+D1.LAW_IMP_RTN_RPT_NOC+D1.SYE_IMP_RTN_RPT_NOC+D1.ADMN_IMP_RTN_RPT_NOC+D1.RDA_RTN_RPT_NOC+D1.GEN_NTF_RTN_RPT_NOC+D1.WRDO_NTF_RTN_RPT_NOC+D1.HRA_NTF_RTN_RPT_NOC+D1.EXPL_NTF_RTN_RPT_NOC+D1.PSC_RTN_RPT_NOC + D1.LOC_ACT_RTN_RPT_NOC + D1.INV_REQ_RTN_RPT_NOC),2))
				   END AS BA /*해당감사불문율*/
			     , (SELECT NVL(UNW_RTE, 0) AS UNW_RTE FROM TBCSPAOE042M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = (SELECT HLYR_DVSN_CD FROM TBCSPAOE001M WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT) AND TSK_DVSN_CD = '10000' AND AUD_KND_CD = (SELECT AUD_KND_CD FROM TBCSPAOE021M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#)) AS UNW_RTE /*동일감사평균불문율*/
			  FROM TBCSPAOE036M D1
                 , TBCSPAOE021M D2
                   LEFT JOIN TBCSPAOE042M D3
                          ON D3.EVL_YR = D2.AUD_YR
                         AND D3.HLYR_DVSN_CD = (SELECT HLYR_DVSN_CD FROM TBCSPAOE001M WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT)
                         AND D3.AUD_KND_CD = D2.AUD_KND_CD
                         AND D3.AUD_KND_CD = (SELECT AUD_KND_CD FROM TBCSPAOE021M WHERE 1=1 AND AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#)
			 WHERE 1=1
			   AND D1.AUD_YR = D2.AUD_YR
			   AND D1.TSK_NO = D2.TSK_NO
			   AND D1.AUD_YR = #strAudYr#
			   AND D1.TSK_NO = #strTskNo#
		]]>
	</select>

	<!-- 지적사항총괄(팝업) 신규등록 -->
	<insert id="CSPAOE072PMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE036M
		(
			AUD_YR
			, TSK_NO
			, CPS_JUD_RTN_RPT_NOC
			, CPS_JUD_ANEW_ADT_NOC
			,
			CPS_JUD_INCR_KND_CHG_NOC
			, CPS_JUD_DIMR_NOC
			, CPS_JUD_UNW_NOC
			,
			CPS_JUD_DECR_KND_CHG_NOC
			, CPS_JUD_SUC_NOC
			, CPS_JUD_ETC_NOC
			,
			CPS_JUD_RTN_RPT_AM
			, CPS_JUD_INCR_AM
			, CPS_JUD_DECR_AM
			, CRCT_RTN_RPT_NOC
			, CRCT_ANEW_ADT_NOC
			, CRCT_INCR_KND_CHG_NOC
			, CRCT_DIMR_NOC
			,
			CRCT_UNW_NOC
			, CRCT_DECR_KND_CHG_NOC
			, CRCT_SUC_NOC
			, CRCT_ETC_NOC
			,
			CRCT_RTN_RPT_AM
			, CRCT_INCR_AM
			, CRCT_DECR_AM
			, PNSH_RTN_RPT_NOC
			,
			PNSH_ANEW_ADT_NOC
			, PNSH_INCR_KND_CHG_NOC
			, PNSH_DIMR_NOC
			, PNSH_UNW_NOC
			, PNSH_DECR_KND_CHG_NOC
			, PNSH_SUC_NOC
			, PNSH_ETC_NOC
			,
			PNSH_RTN_RPT_NOP_CNT
			, PNSH_INCR_NOP_CNT
			, PNSH_DECR_NOP_CNT
			,
			ATNT_RTN_RPT_NOC
			, ATNT_ANEW_ADT_NOC
			, ATNT_INCR_KND_CHG_NOC
			,
			ATNT_DIMR_NOC
			, ATNT_UNW_NOC
			, ATNT_DECR_KND_CHG_NOC
			, ATNT_SUC_NOC
			,
			ATNT_ETC_NOC
			, LAW_IMP_RTN_RPT_NOC
			, LAW_IMP_ANEW_ADT_NOC
			,
			LAW_IMP_INCR_KND_CHG_NOC
			, LAW_IMP_DIMR_NOC
			, LAW_IMP_UNW_NOC
			,
			LAW_IMP_DECR_KND_CHG_NOC
			, LAW_IMP_SUC_NOC
			, LAW_IMP_ETC_NOC
			,
			SYE_IMP_RTN_RPT_NOC
			, SYE_IMP_ANEW_ADT_NOC
			, SYE_IMP_INCR_KND_CHG_NOC
			,
			SYE_IMP_DIMR_NOC
			, SYE_IMP_UNW_NOC
			, SYE_IMP_DECR_KND_CHG_NOC
			,
			SYE_IMP_SUC_NOC
			, SYE_IMP_ETC_NOC
			, ADMN_IMP_RTN_RPT_NOC
			,
			ADMN_IMP_ANEW_ADT_NOC
			, ADMN_IMP_INCR_KND_CHG_NOC
			, ADMN_IMP_DIMR_NOC
			,
			ADMN_IMP_UNW_NOC
			, ADMN_IMP_DECR_KND_CHG_NOC
			, ADMN_IMP_SUC_NOC
			,
			ADMN_IMP_ETC_NOC
			, RDA_RTN_RPT_NOC
			, RDA_ANEW_ADT_NOC
			,
			RDA_INCR_KND_CHG_NOC
			, RDA_DIMR_NOC
			, RDA_UNW_NOC
			, RDA_DECR_KND_CHG_NOC
			, RDA_SUC_NOC
			, RDA_ETC_NOC
			, GEN_NTF_RTN_RPT_NOC
			, GEN_NTF_ANEW_ADT_NOC
			, GEN_NTF_INCR_KND_CHG_NOC
			, GEN_NTF_DIMR_NOC
			, GEN_NTF_UNW_NOC
			,
			GEN_NTF_DECR_KND_CHG_NOC
			, GEN_NTF_SUC_NOC
			, GEN_NTF_ETC_NOC
			,
			WRDO_NTF_RTN_RPT_NOC
			, WRDO_NTF_ANEW_ADT_NOC
			, WRDO_NTF_INCR_KND_CHG_NOC
			, WRDO_NTF_DIMR_NOC
			, WRDO_NTF_UNW_NOC
			, WRDO_NTF_DECR_KND_CHG_NOC
			,
			WRDO_NTF_SUC_NOC
			, WRDO_NTF_ETC_NOC
			, WRDO_NTF_RTN_RPT_NOP_CNT
			,
			WRDO_NTF_ANEW_ADT_NOP_CNT
			, WRDO_NTF_INCR_KND_CHG_NOP_CNT
			,
			WRDO_NTF_DIMR_NOP_CNT
			, WRDO_NTF_UNW_NOP_CNT
			,
			WRDO_NTF_DECR_KND_CHG_NOP_CNT
			, WRDO_NTF_SUC_NOP_CNT
			,
			WRDO_NTF_ETC_NOP_CNT
			, HRA_NTF_RTN_RPT_NOC
			, HRA_NTF_ANEW_ADT_NOC
			,
			HRA_NTF_INCR_KND_CHG_NOC
			, HRA_NTF_DIMR_NOC
			, HRA_NTF_UNW_NOC
			,
			HRA_NTF_NOC_KND_CHG_NOC
			, HRA_NTF_SUC_NOC
			, HRA_NTF_ETC_NOC
			,
			HRA_NTF_RTN_RPT_NOP_CNT
			, HRA_NTF_INCR_NOP_CNT
			, HRA_NTF_DECR_NOP_CNT
			,
			EXPL_NTF_RTN_RPT_NOC
			, EXPL_NTF_ANEW_ADT_NOC
			, EXPL_NTF_INCR_KND_CHG_NOC
			, EXPL_NTF_DIMR_NOC
			, EXPL_NTF_UNW_NOC
			, EXPL_NTF_DECR_KND_CHG_NOC
			,
			EXPL_NTF_SUC_NOC
			, EXPL_NTF_ETC_NOC
			, PSC_RTN_RPT_NOC
			, PSC_ANEW_ADT_NOC
			, PSC_INCR_KND_CHG_NOC
			, PSC_DIMR_NOC
			, PSC_UNW_NOC
			,
			PSC_DECR_KND_CHG_NOC
			, PSC_SUC_NOC
			, PSC_ETC_NOC
			, PSC_RTN_RPT_NOP_CNT
			,
			PSC_INCR_NOP_CNT
			, PSC_DECR_NOP_CNT
			, EPT_EFCT_RTN_RPT_AM
			,
			EPT_EFCT_INCR_AM
			, EPT_EFCT_DECR_AM
			, FRT_USR_ID
			, FNL_USR_ID
			,
			FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
			, LOC_ACT_RTN_RPT_NOC
			, LOC_ACT_ANEW_ADT_NOC
			, LOC_ACT_INCR_KND_CHG_NOC
			, LOC_ACT_DIMR_NOC
			, LOC_ACT_UNW_NOC
			, LOC_ACT_DECR_KND_CHG_NOC
			, LOC_ACT_SUC_NOC
			, LOC_ACT_ETC_NOC
			, INV_REQ_RTN_RPT_NOC
			, INV_REQ_ANEW_ADT_NOC
			, INV_REQ_INCR_KND_CHG_NOC
			, INV_REQ_DIMR_NOC
			, INV_REQ_UNW_NOC
			, INV_REQ_DECR_KND_CHG_NOC
			, INV_REQ_SUC_NOC
			, INV_REQ_ETC_NOC
			, INV_REQ_RTN_RPT_NOP_CNT
			, INV_REQ_INCR_NOP_CNT
			, INV_REQ_DECR_NOP_CNT
		) VALUES
		(
			#strAudYr#	, #strTskNo#, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			
			, 0			, 0			, '	'		, ' '		, ' '		, 'CSPAOE0023E'			, SYSDATE	, SYSDATE	, 0
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0			
			, 0			, 0			, 0			, 0			, 0			, 0			, 0			, 0
		)
	</insert>

	<!-- 지적사항총괄(팝업) 저장 -->
	<update id="CSPAOE072PMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE036M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE072P'
		<isNotEmpty prepend="," property="CPS_JUD_RTN_RPT_NOC">
			CPS_JUD_RTN_RPT_NOC = #CPS_JUD_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CPS_JUD_ANEW_ADT_NOC">
			CPS_JUD_ANEW_ADT_NOC = #CPS_JUD_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CPS_JUD_INCR_KND_CHG_NOC">
			CPS_JUD_INCR_KND_CHG_NOC = #CPS_JUD_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CPS_JUD_DIMR_NOC">
			CPS_JUD_DIMR_NOC = #CPS_JUD_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CPS_JUD_UNW_NOC">
			CPS_JUD_UNW_NOC = #CPS_JUD_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CPS_JUD_DECR_KND_CHG_NOC">
			CPS_JUD_DECR_KND_CHG_NOC = #CPS_JUD_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CPS_JUD_SUC_NOC">
			CPS_JUD_SUC_NOC = #CPS_JUD_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CPS_JUD_ETC_NOC">
			CPS_JUD_ETC_NOC = #CPS_JUD_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CPS_JUD_RTN_RPT_AM">
			CPS_JUD_RTN_RPT_AM = #CPS_JUD_RTN_RPT_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CPS_JUD_INCR_AM">
			CPS_JUD_INCR_AM = #CPS_JUD_INCR_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CPS_JUD_DECR_AM">
			CPS_JUD_DECR_AM = #CPS_JUD_DECR_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_RTN_RPT_NOC">
			CRCT_RTN_RPT_NOC = #CRCT_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_ANEW_ADT_NOC">
			CRCT_ANEW_ADT_NOC = #CRCT_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_INCR_KND_CHG_NOC">
			CRCT_INCR_KND_CHG_NOC = #CRCT_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_DIMR_NOC">
			CRCT_DIMR_NOC = #CRCT_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_UNW_NOC">
			CRCT_UNW_NOC = #CRCT_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_DECR_KND_CHG_NOC">
			CRCT_DECR_KND_CHG_NOC = #CRCT_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_SUC_NOC">
			CRCT_SUC_NOC = #CRCT_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_ETC_NOC">
			CRCT_ETC_NOC = #CRCT_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_RTN_RPT_AM">
			CRCT_RTN_RPT_AM = #CRCT_RTN_RPT_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_INCR_AM">
			CRCT_INCR_AM = #CRCT_INCR_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CRCT_DECR_AM">
			CRCT_DECR_AM = #CRCT_DECR_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_RTN_RPT_NOC">
			PNSH_RTN_RPT_NOC = #PNSH_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_ANEW_ADT_NOC">
			PNSH_ANEW_ADT_NOC = #PNSH_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_INCR_KND_CHG_NOC">
			PNSH_INCR_KND_CHG_NOC = #PNSH_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_DIMR_NOC">
			PNSH_DIMR_NOC = #PNSH_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_UNW_NOC">
			PNSH_UNW_NOC = #PNSH_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_DECR_KND_CHG_NOC">
			PNSH_DECR_KND_CHG_NOC = #PNSH_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_SUC_NOC">
			PNSH_SUC_NOC = #PNSH_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_ETC_NOC">
			PNSH_ETC_NOC = #PNSH_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_RTN_RPT_NOP_CNT">
			PNSH_RTN_RPT_NOP_CNT = #PNSH_RTN_RPT_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_INCR_NOP_CNT">
			PNSH_INCR_NOP_CNT = #PNSH_INCR_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PNSH_DECR_NOP_CNT">
			PNSH_DECR_NOP_CNT = #PNSH_DECR_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ATNT_RTN_RPT_NOC">
			ATNT_RTN_RPT_NOC = #ATNT_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ATNT_ANEW_ADT_NOC">
			ATNT_ANEW_ADT_NOC = #ATNT_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ATNT_INCR_KND_CHG_NOC">
			ATNT_INCR_KND_CHG_NOC = #ATNT_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ATNT_DIMR_NOC">
			ATNT_DIMR_NOC = #ATNT_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ATNT_UNW_NOC">
			ATNT_UNW_NOC = #ATNT_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ATNT_DECR_KND_CHG_NOC">
			ATNT_DECR_KND_CHG_NOC = #ATNT_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ATNT_SUC_NOC">
			ATNT_SUC_NOC = #ATNT_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ATNT_ETC_NOC">
			ATNT_ETC_NOC = #ATNT_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LAW_IMP_RTN_RPT_NOC">
			LAW_IMP_RTN_RPT_NOC = #LAW_IMP_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LAW_IMP_ANEW_ADT_NOC">
			LAW_IMP_ANEW_ADT_NOC = #LAW_IMP_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LAW_IMP_INCR_KND_CHG_NOC">
			LAW_IMP_INCR_KND_CHG_NOC = #LAW_IMP_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LAW_IMP_DIMR_NOC">
			LAW_IMP_DIMR_NOC = #LAW_IMP_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LAW_IMP_UNW_NOC">
			LAW_IMP_UNW_NOC = #LAW_IMP_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LAW_IMP_DECR_KND_CHG_NOC">
			LAW_IMP_DECR_KND_CHG_NOC = #LAW_IMP_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LAW_IMP_SUC_NOC">
			LAW_IMP_SUC_NOC = #LAW_IMP_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LAW_IMP_ETC_NOC">
			LAW_IMP_ETC_NOC = #LAW_IMP_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYE_IMP_RTN_RPT_NOC">
			SYE_IMP_RTN_RPT_NOC = #SYE_IMP_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYE_IMP_ANEW_ADT_NOC">
			SYE_IMP_ANEW_ADT_NOC = #SYE_IMP_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYE_IMP_INCR_KND_CHG_NOC">
			SYE_IMP_INCR_KND_CHG_NOC = #SYE_IMP_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYE_IMP_DIMR_NOC">
			SYE_IMP_DIMR_NOC = #SYE_IMP_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYE_IMP_UNW_NOC">
			SYE_IMP_UNW_NOC = #SYE_IMP_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYE_IMP_DECR_KND_CHG_NOC">
			SYE_IMP_DECR_KND_CHG_NOC = #SYE_IMP_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYE_IMP_SUC_NOC">
			SYE_IMP_SUC_NOC = #SYE_IMP_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYE_IMP_ETC_NOC">
			SYE_IMP_ETC_NOC = #SYE_IMP_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ADMN_IMP_RTN_RPT_NOC">
			ADMN_IMP_RTN_RPT_NOC = #ADMN_IMP_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ADMN_IMP_ANEW_ADT_NOC">
			ADMN_IMP_ANEW_ADT_NOC = #ADMN_IMP_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ADMN_IMP_INCR_KND_CHG_NOC">
			ADMN_IMP_INCR_KND_CHG_NOC = #ADMN_IMP_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ADMN_IMP_DIMR_NOC">
			ADMN_IMP_DIMR_NOC = #ADMN_IMP_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ADMN_IMP_UNW_NOC">
			ADMN_IMP_UNW_NOC = #ADMN_IMP_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ADMN_IMP_DECR_KND_CHG_NOC">
			ADMN_IMP_DECR_KND_CHG_NOC = #ADMN_IMP_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ADMN_IMP_SUC_NOC">
			ADMN_IMP_SUC_NOC = #ADMN_IMP_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ADMN_IMP_ETC_NOC">
			ADMN_IMP_ETC_NOC = #ADMN_IMP_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RDA_RTN_RPT_NOC">
			RDA_RTN_RPT_NOC = #RDA_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RDA_ANEW_ADT_NOC">
			RDA_ANEW_ADT_NOC = #RDA_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RDA_INCR_KND_CHG_NOC">
			RDA_INCR_KND_CHG_NOC = #RDA_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RDA_DIMR_NOC">
			RDA_DIMR_NOC = #RDA_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RDA_UNW_NOC">
			RDA_UNW_NOC = #RDA_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RDA_DECR_KND_CHG_NOC">
			RDA_DECR_KND_CHG_NOC = #RDA_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RDA_SUC_NOC">
			RDA_SUC_NOC = #RDA_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="RDA_ETC_NOC">
			RDA_ETC_NOC = #RDA_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="GEN_NTF_RTN_RPT_NOC">
			GEN_NTF_RTN_RPT_NOC = #GEN_NTF_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="GEN_NTF_ANEW_ADT_NOC">
			GEN_NTF_ANEW_ADT_NOC = #GEN_NTF_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="GEN_NTF_INCR_KND_CHG_NOC">
			GEN_NTF_INCR_KND_CHG_NOC = #GEN_NTF_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="GEN_NTF_DIMR_NOC">
			GEN_NTF_DIMR_NOC = #GEN_NTF_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="GEN_NTF_UNW_NOC">
			GEN_NTF_UNW_NOC = #GEN_NTF_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="GEN_NTF_DECR_KND_CHG_NOC">
			GEN_NTF_DECR_KND_CHG_NOC = #GEN_NTF_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="GEN_NTF_SUC_NOC">
			GEN_NTF_SUC_NOC = #GEN_NTF_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="GEN_NTF_ETC_NOC">
			GEN_NTF_ETC_NOC = #GEN_NTF_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_RTN_RPT_NOC">
			WRDO_NTF_RTN_RPT_NOC = #WRDO_NTF_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_ANEW_ADT_NOC">
			WRDO_NTF_ANEW_ADT_NOC = #WRDO_NTF_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_INCR_KND_CHG_NOC">
			WRDO_NTF_INCR_KND_CHG_NOC = #WRDO_NTF_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_DIMR_NOC">
			WRDO_NTF_DIMR_NOC = #WRDO_NTF_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_UNW_NOC">
			WRDO_NTF_UNW_NOC = #WRDO_NTF_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_DECR_KND_CHG_NOC">
			WRDO_NTF_DECR_KND_CHG_NOC = #WRDO_NTF_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_SUC_NOC">
			WRDO_NTF_SUC_NOC = #WRDO_NTF_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_ETC_NOC">
			WRDO_NTF_ETC_NOC = #WRDO_NTF_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_RTN_RPT_NOP_CNT">
			WRDO_NTF_RTN_RPT_NOP_CNT = #WRDO_NTF_RTN_RPT_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_ANEW_ADT_NOP_CNT">
			WRDO_NTF_ANEW_ADT_NOP_CNT = #WRDO_NTF_ANEW_ADT_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_INCR_KND_CHG_NOP_CNT">
			WRDO_NTF_INCR_KND_CHG_NOP_CNT = #WRDO_NTF_INCR_KND_CHG_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_DIMR_NOP_CNT">
			WRDO_NTF_DIMR_NOP_CNT = #WRDO_NTF_DIMR_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_UNW_NOP_CNT">
			WRDO_NTF_UNW_NOP_CNT = #WRDO_NTF_UNW_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_DECR_KND_CHG_NOP_CNT">
			WRDO_NTF_DECR_KND_CHG_NOP_CNT = #WRDO_NTF_DECR_KND_CHG_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_SUC_NOP_CNT">
			WRDO_NTF_SUC_NOP_CNT = #WRDO_NTF_SUC_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="WRDO_NTF_ETC_NOP_CNT">
			WRDO_NTF_ETC_NOP_CNT = #WRDO_NTF_ETC_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_RTN_RPT_NOC">
			HRA_NTF_RTN_RPT_NOC = #HRA_NTF_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_ANEW_ADT_NOC">
			HRA_NTF_ANEW_ADT_NOC = #HRA_NTF_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_INCR_KND_CHG_NOC">
			HRA_NTF_INCR_KND_CHG_NOC = #HRA_NTF_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_DIMR_NOC">
			HRA_NTF_DIMR_NOC = #HRA_NTF_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_UNW_NOC">
			HRA_NTF_UNW_NOC = #HRA_NTF_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_NOC_KND_CHG_NOC">
			HRA_NTF_NOC_KND_CHG_NOC = #HRA_NTF_NOC_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_SUC_NOC">
			HRA_NTF_SUC_NOC = #HRA_NTF_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_ETC_NOC">
			HRA_NTF_ETC_NOC = #HRA_NTF_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_RTN_RPT_NOP_CNT">
			HRA_NTF_RTN_RPT_NOP_CNT = #HRA_NTF_RTN_RPT_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_INCR_NOP_CNT">
			HRA_NTF_INCR_NOP_CNT = #HRA_NTF_INCR_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HRA_NTF_DECR_NOP_CNT">
			HRA_NTF_DECR_NOP_CNT = #HRA_NTF_DECR_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EXPL_NTF_RTN_RPT_NOC">
			EXPL_NTF_RTN_RPT_NOC = #EXPL_NTF_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EXPL_NTF_ANEW_ADT_NOC">
			EXPL_NTF_ANEW_ADT_NOC =	#EXPL_NTF_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EXPL_NTF_INCR_KND_CHG_NOC">
			EXPL_NTF_INCR_KND_CHG_NOC = #EXPL_NTF_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EXPL_NTF_DIMR_NOC">
			EXPL_NTF_DIMR_NOC = #EXPL_NTF_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EXPL_NTF_UNW_NOC">
			EXPL_NTF_UNW_NOC = #EXPL_NTF_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EXPL_NTF_DECR_KND_CHG_NOC">
			EXPL_NTF_DECR_KND_CHG_NOC = #EXPL_NTF_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EXPL_NTF_SUC_NOC">
			EXPL_NTF_SUC_NOC = #EXPL_NTF_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EXPL_NTF_ETC_NOC">
			EXPL_NTF_ETC_NOC = #EXPL_NTF_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_RTN_RPT_NOC">
			PSC_RTN_RPT_NOC = #PSC_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_ANEW_ADT_NOC">
			PSC_ANEW_ADT_NOC = #PSC_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_INCR_KND_CHG_NOC">
			PSC_INCR_KND_CHG_NOC = #PSC_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_DIMR_NOC">
			PSC_DIMR_NOC = #PSC_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_UNW_NOC">
			PSC_UNW_NOC = #PSC_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_DECR_KND_CHG_NOC">
			PSC_DECR_KND_CHG_NOC = #PSC_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_SUC_NOC">
			PSC_SUC_NOC = #PSC_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_ETC_NOC">
			PSC_ETC_NOC = #PSC_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_RTN_RPT_NOP_CNT">
			PSC_RTN_RPT_NOP_CNT = #PSC_RTN_RPT_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_INCR_NOP_CNT">
			PSC_INCR_NOP_CNT = #PSC_INCR_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSC_DECR_NOP_CNT">
			PSC_DECR_NOP_CNT = #PSC_DECR_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EPT_EFCT_RTN_RPT_AM">
			EPT_EFCT_RTN_RPT_AM = #EPT_EFCT_RTN_RPT_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EPT_EFCT_INCR_AM">
			EPT_EFCT_INCR_AM = #EPT_EFCT_INCR_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EPT_EFCT_DECR_AM">
			EPT_EFCT_DECR_AM = #EPT_EFCT_DECR_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LOC_ACT_RTN_RPT_NOC">
			LOC_ACT_RTN_RPT_NOC = #LOC_ACT_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LOC_ACT_ANEW_ADT_NOC">
			LOC_ACT_ANEW_ADT_NOC = #LOC_ACT_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LOC_ACT_INCR_KND_CHG_NOC">
			LOC_ACT_INCR_KND_CHG_NOC = #LOC_ACT_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LOC_ACT_DIMR_NOC">
			LOC_ACT_DIMR_NOC = #LOC_ACT_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LOC_ACT_UNW_NOC">
			LOC_ACT_UNW_NOC = #LOC_ACT_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LOC_ACT_DECR_KND_CHG_NOC">
			LOC_ACT_DECR_KND_CHG_NOC = #LOC_ACT_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LOC_ACT_SUC_NOC">
			LOC_ACT_SUC_NOC = #LOC_ACT_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="LOC_ACT_ETC_NOC">
			LOC_ACT_ETC_NOC = #LOC_ACT_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_RTN_RPT_NOC">
			INV_REQ_RTN_RPT_NOC = #INV_REQ_RTN_RPT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_ANEW_ADT_NOC">
			INV_REQ_ANEW_ADT_NOC = #INV_REQ_ANEW_ADT_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_INCR_KND_CHG_NOC">
			INV_REQ_INCR_KND_CHG_NOC = #INV_REQ_INCR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_DIMR_NOC">
			INV_REQ_DIMR_NOC = #INV_REQ_DIMR_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_UNW_NOC">
			INV_REQ_UNW_NOC = #INV_REQ_UNW_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_DECR_KND_CHG_NOC">
			INV_REQ_DECR_KND_CHG_NOC = #INV_REQ_DECR_KND_CHG_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_SUC_NOC">
			INV_REQ_SUC_NOC = #INV_REQ_SUC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_ETC_NOC">
			INV_REQ_ETC_NOC = #INV_REQ_ETC_NOC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_RTN_RPT_NOP_CNT">
			INV_REQ_RTN_RPT_NOP_CNT = #INV_REQ_RTN_RPT_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_INCR_NOP_CNT">
			INV_REQ_INCR_NOP_CNT = #INV_REQ_INCR_NOP_CNT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="INV_REQ_DECR_NOP_CNT">
			INV_REQ_DECR_NOP_CNT = #INV_REQ_DECR_NOP_CNT#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
	</update>

	<!-- 다면평가 평가기간관리에 등록된 평가년도를 가져온다. -->
	<select id="CSPAOE074EEvlYrListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT EVL_YR AS CD
			     , EVL_YR AS CD_NM
			  FROM TBCSPAOE037M
			 GROUP BY EVL_YR
		  ]]>
	</select>

	<!-- 다면평가 평가기간관리에 등록된 평가년도에 따른 반기구분코드를 가져온다. -->
	<select id="CSPAOE074EHlyrDvsnCdListselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT EVL_YR AS KEY 
			     , HLYR_DVSN_CD AS CD
			     , F_CODE_NM('1000268', HLYR_DVSN_CD) AS CD_NM
			  FROM TBCSPAOE037M
			 GROUP BY EVL_YR, HLYR_DVSN_CD 
			 ORDER BY HLYR_DVSN_CD ASC
		  ]]>
	</select>

	<!-- 다면평가 점수입력관리 온로드시 평가군명을 가져온다 -->
	<select id="CSPAOE074EEvlGpCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_GP_CD AS CD       /*평가군코드*/
			     , MAX(EVL_GP_NM) AS CD_NM    /*평가군명*/
			  FROM TBCSPAOE018M 
		     GROUP BY EVL_GP_CD
		     ORDER BY EVL_GP_CD
		]]>
	</select>

	<!--다면평가 점수입력관리 온로드시 부서코드 조회 -->
	<select id="CSPAOE074EEvlDptCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT DPT_CD AS CD	/*부서코드*/
			     , F_DPT_INFO(DPT_CD, '1') AS CD_NM	/*부서명*/
			  FROM TBDCMACM002M
			 GROUP BY DPT_CD
			 ORDER BY DPT_CD               
		]]>
	</select>

	<!-- 다면평가 점수입력관리 조회 -->
	<select id="CSPAOE074EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D2.EVL_YR /*년도*/ 
			     , D2.HLYR_DVSN_CD /*반기구분*/
			     , D2.EVL_GP_CD /*평가군코드*/
			     , NVL(COUNT(D2.NEVLT_CNB),0) AS NEVLT_CNB_CNT	/*피평가자인원수*/
			 FROM TBCSPAOE018M D1
                , TBCSPAOE020D D2
		   	WHERE 1 = 1
		   	  AND D1.EVL_YR = D2.EVL_YR
              AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
   			  AND D1.EVL_GP_CD = D2.EVL_GP_CD
		   	  AND D2.EVL_YR = #strEvlYr#
		   	  AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
		]]>
		<isNotEmpty prepend="AND" property="strEvlGpCd">
			D2.EVL_GP_CD LIKE '%'||#strEvlGpCd#||'%'
		</isNotEmpty>
		<![CDATA[
		   GROUP BY D2.EVL_YR, D2.HLYR_DVSN_CD, D2.EVL_GP_CD
 		   ORDER BY D2.EVL_YR, D2.HLYR_DVSN_CD, D2.EVL_GP_CD
		]]>
	</select>

	<!-- 다면평가 점수입력관리 피평가자 조회 -->
	<select id="CSPAOE074EDtlSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
			SELECT D2.EVL_YR    /*평가년도*/
			     , D2.HLYR_DVSN_CD  /*반기구분코드*/
			     , D2.EVL_GP_CD /*평가군코드*/
			     , D2.EVL_STA_CD    /*평가상태코드*/
			     , D2.BLT_DPT_CD AS EVL_DPT_CD    /*소속부서코드*/
			     , D2.RANK_CD   /*직급코드*/
			     , D2.NEVLT_CNB /*전산번호*/
			     , F_USR_INFO(D2.NEVLT_CNB, '2') AS NAM /*성명*/
			     , TO_CHAR(NVL(ROUND(D2.TSK_ASC, 2), 0), 'FM999.00') AS ACMP_EVL_SC /*실적평가*/
			     , TO_CHAR(ROUND(NVL(D1.MNSD_EVL_SC, 0), 2), 'FM999.00') AS MNSD_EVL_SC /*다면평가*/
			     , TO_CHAR(NVL(ROUND(((NVL(D2.TSK_ASC, 0)*(D3.ACMP_EVL_ASC_RT/D3.ACMP_EVL_ASC_RT+D3.MNSD_EVL_ASC_RT)) + (NVL(D1.MNSD_EVL_SC, 0)*(D3.MNSD_EVL_ASC_RT/D3.ACMP_EVL_ASC_RT+D3.MNSD_EVL_ASC_RT))), 2), 0), 'FM999.00') AS PSN_ASC /*개인평점 = 실적평가*(실적평점비율/실적평점비율+다면평점비율) + 다면평가*(다면평점비율/실적평점비율+다면평점비율)*/
			FROM (
			        SELECT D1.EVL_YR
			             , D1.HLYR_DVSN_CD
			             , D1.NEVLT_CNB
			             , D1.BLT_DPT_CD
			             , D1.RANK_CD
			             , D1.EVL_CMTR_DVSN_CD AS EVL_GP_CD
			             , D1.EVL_STA_CD
			             , SUM(D1.TSK_ASC)/D1.EVLT_CNT AS TSK_ASC
			        FROM (
			                SELECT D1.EVL_YR
			                     , D1.HLYR_DVSN_CD
			                     , D1.NEVLT_CNB
			                     , D3.BLT_DPT_CD
			                     , D3.RANK_CD
			                     , D1.EVL_CMTR_CNB
			                     , D1.EVL_CMTR_DVSN_CD
			                     , SUM(D1.TSK_ASC) AS TSK_ASC
			                     , D2.CNT AS EVLT_CNT
			                     , D1.EVL_STA_CD
			                FROM TBCSPAOE032M D1
			                   , (SELECT EVL_YR
			                           , HLYR_DVSN_CD
			                           , EVL_GP_CD
			                           , COUNT(EVLT_CNB) AS CNT
			                       FROM TBCSPAOE019D
			                       GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_GP_CD
			                     ) D2
			                   , TBCSPAOE020D D3
			                WHERE D1.EVL_YR = D2.EVL_YR
			                  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			                  AND D1.EVL_CMTR_DVSN_CD = D2.EVL_GP_CD
			                  AND D1.EVL_YR = D3.EVL_YR
			                  AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
			                  AND D1.EVL_CMTR_DVSN_CD = D3.EVL_GP_CD
			                  AND D1.NEVLT_CNB = D3.NEVLT_CNB
			                  AND D2.EVL_YR = D3.EVL_YR
			                  AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
			                  AND D2.EVL_GP_CD = D3.EVL_GP_CD
			                GROUP BY D1.EVL_YR
			                       , D1.HLYR_DVSN_CD
			                       , D1.NEVLT_CNB
			                       , D3.BLT_DPT_CD
			                       , D3.RANK_CD
			                       , D1.EVL_CMTR_CNB
			                       , D1.EVL_CMTR_DVSN_CD
			                       , D2.CNT
			                       , D1.EVL_STA_CD
			             ) D1
			        GROUP BY D1.EVL_YR
			             , D1.HLYR_DVSN_CD
			             , D1.NEVLT_CNB
			             , D1.BLT_DPT_CD
			             , D1.RANK_CD
			             , D1.EVL_CMTR_DVSN_CD
			             , D1.EVL_STA_CD
			             , D1.EVLT_CNT
			     ) D2
			   , TBCSPAOE037M D3
			     LEFT JOIN TBCSPAOE038M D1 ON D1.EVL_YR = D3.EVL_YR AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
			WHERE 1=1
			  AND D2.EVL_YR = D1.EVL_YR (+)
			  AND D2.HLYR_DVSN_CD = D1.HLYR_DVSN_CD (+)
			  AND D2.EVL_GP_CD = D1.EVL_GP_CD (+)
			  AND D2.NEVLT_CNB = D1.NEVLT_CNB (+)
			  AND D2.EVL_YR = #strEvlYr#
			  AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			  AND D2.EVL_GP_CD = #strEvlGpCd#
		]]>
	</select>

	<!-- 다면평가 점수입력관리 신규 등록 시 데이터 존재여부 체크 -->
	<select id="CSPAOE074ECntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE038M 
		     WHERE 1=1
		       AND EVL_YR = #strEvlYr#
		       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		       AND EVL_GP_CD = #strEvlGpCd#
		]]>
	</select>

	<!-- 다면평가 점수입력관리 신규 등록 -->
	<insert id="CSPAOE074EDtlInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE038M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, EVL_GP_CD
			, NEVLT_CNB
			, ACMP_EVL_SC
			, MNSD_EVL_SC
			,
			PSN_ASC
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			,
			FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT D1.EVL_YR /*평가년도*/
			, D1.HLYR_DVSN_CD /*반기구분*/
			, D1.EVL_GP_CD /*평가군*/
			, D1.NEVLT_CNB /*피평가자 전산번호*/
			, NVL(SUM(D2.PSN_TSK_ASC), 0) AS ACMP_EVL_SC /*실적평가*/
			, NVL(D3.MNSD_EVL_SC, 0) AS MNSD_EVL_SC /*다면평가*/
			, NVL((SUM(D2.PSN_TSK_ASC) * (SELECT D4.ACMP_EVL_ASC_RT FROM
			TBCSPAOE037M D4 WHERE D4.EVL_YR = #strEvlYr# AND D4.HLYR_DVSN_CD =
			#strHlyrDvsnCd#) + D3.MNSD_EVL_SC * (SELECT D4.MNSD_EVL_ASC_RT FROM
			TBCSPAOE037M D4 WHERE D4.EVL_YR = #strEvlYr# AND D4.HLYR_DVSN_CD =
			#strHlyrDvsnCd#)),0) AS PSN_ASC /*개인평점*/
			, D1.FNL_USR_ID
			, D1.FNL_USR_ID
			, D1.FNL_DEAL_DPT_CD
			, 'CSPAOE0074E' AS FNL_MNU_ID
			, SYSDATE AS FRT_REGI_DH
			, SYSDATE AS FNL_MDF_DH
		FROM TBCSPAOE020D D1
		LEFT JOIN TBCSPAOE035M D2
		  ON D1.EVL_YR = D2.EVL_YR
		AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
		AND D1.NEVLT_CNB = D2.NEVLT_CNB
		LEFT JOIN TBCSPAOE038M D3
		  ON D2.EVL_YR = D3.EVL_YR
		AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
		AND D2.NEVLT_CNB = D3.NEVLT_CNB
		WHERE 1=1 
		  AND D1.EVL_YR = #strEvlYr#
		  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
		  AND D1.EVL_GP_CD = #strEvlGpCd#
		GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.EVL_GP_CD, D1.NEVLT_CNB,
				D3.MNSD_EVL_SC, D3.PSN_ASC, D1.FNL_USR_ID, D1.FNL_USR_ID,
				D1.FNL_DEAL_DPT_CD
	</insert>

	<!-- 다면평가 점수입력관리 정보 수정 -->
	<update id="CSPAOE074EDtlUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE038M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE074E'
		<isNotEmpty prepend="," property="MNSD_EVL_SC">
			MNSD_EVL_SC = #MNSD_EVL_SC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="PSN_ASC">
			PSN_ASC = #PSN_ASC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND EVL_GP_CD = #EVL_GP_CD#
		  AND NEVLT_CNB = #NEVLT_CNB#
	</update>

	<!-- 개인별 기여율 확인 온로드시 감사종류,업무종류 조회 -->
	<select id="CSPAOE070QTskKndCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CD
     			 , CD_NM
  			  FROM TBDCMACM013C
 		     WHERE 1=1
   			   AND CD <> '000000000'
   			   AND CMM_CD_DVSN_CD IN ('1000270', '1000272')
   			   AND CD NOT IN ('10000')
			   AND USE_YN = 'Y'
 		     ORDER BY OTPT_SEQ, CD ASC 
		]]>
	</select>

	<!-- 개인별 기여율 조회 -->
	<select id="CSPAOE070QMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
        	/*감사업무 기여율*/
			SELECT D3.EVL_YR	/*평가년도*/
        		 , D3.HLYR_DVSN_CD	/*반기구분*/
     			 , D3.AUD_KND_CD AS TSK_KND_CD	/*업무종류*/
     			 , D3.TSK_NO AS TSK_NO	/*업무번호*/
     			 , D3.AUD_SBJ_NM AS TSK_NM	/*업무명*/
     			 , MIN(D4.AUD_STEP_CD) AS TSK_ST_STEP_CD	/*단계기초*/
     			 , MAX(D4.AUD_STEP_CD) AS TSK_END_STEP_CD	/*딘계기말*/
     			 , D1.PTCPT_CNB AS CNB	/*전산번호*/
     			 , (SELECT SUM(CTB_RTE) AS CTB_RTE FROM TBCSPAOE023M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND PTCPT_CNB = #strCnb# GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_NO, PTCPT_CNB) AS CTB_RTE	/*기여율*/
     			 , (
            		SELECT SUM(D1.DRIVE_RTE) AS DRIVE_RTE
					  FROM TBCSPAOE008D D1
						 , (SELECT DISTINCT D1.EVL_YR
                 				 , D1.HLYR_DVSN_CD
                 				 , D1.TSK_NO
                 				 , D1.AUD_SBJ_NM
                 				 , D3.PTCPT_CNB
              				  FROM TBCSPAOE021M D1
                 				 , TBCSPAOE022M D2
                   				   LEFT JOIN TBCSPAOE023M D3
                          				  ON D2.EVL_YR = D3.EVL_YR
                         				 AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
                         				 AND D2.TSK_NO = D3.TSK_NO
                         				 AND D2.AUD_STEP_CD = D3.AUD_STEP_CD
             		 		WHERE 1=1
                			  AND D1.EVL_YR = D2.EVL_YR
                			  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                			  AND D1.TSK_NO = D2.TSK_NO
                			  AND D3.EVL_YR = #strEvlYr#
                			  AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd#
                			  AND D3.PTCPT_CNB = #strCnb#
   				   ) D2
			   WHERE 1=1
  			     AND D1.EVL_YR = D2.EVL_YR
  				 AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
  				 AND D1.TSK_DVSN_CD = '10000'
  				 AND D1.AUD_KND_CD = (
                        				SELECT DISTINCT  D1.AUD_KND_CD 
                                    				FROM TBCSPAOE021M D1
                                         			   , TBCSPAOE023M D2
                                   				   WHERE 1=1
                                     			   	 AND D1.EVL_YR = D2.EVL_YR
                                     				 AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                                     				 AND D1.TSK_NO = D2.TSK_NO
                                     				 AND D2.EVL_YR = #strEvlYr#
                                     				 AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                     				 AND D2.PTCPT_CNB = #strCnb#
                      				)
  				 AND D1.AUD_STEP_CD BETWEEN (SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD FROM TBCSPAOE022M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_NO = (SELECT TSK_NO FROM TBCSPAOE023M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND PTCPT_CNB = #strCnb#))
                                        AND (SELECT MAX(AUD_STEP_CD) AS AUD_STEP_CD FROM TBCSPAOE022M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_NO = (SELECT TSK_NO FROM TBCSPAOE023M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND PTCPT_CNB = #strCnb#))

       			 ) AS DRIVE_RTE
			  FROM TBCSPAOE023M D1
   				 , TBCSPAOE021M D3
   				 , TBCSPAOE022M D4
			 WHERE 1=1
  			   AND D1.EVL_YR = D3.EVL_YR
  			   AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
  			   AND D1.TSK_NO = D3.TSK_NO
  			   AND D1.EVL_YR = D4.EVL_YR
  			   AND D1.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
  			   AND D1.TSK_NO = D4.TSK_NO
  			   AND D1.EVL_YR = #strEvlYr#
  			   AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
  			   AND D1.PTCPT_CNB = #strCnb#
		  GROUP BY D3.EVL_YR, D3.HLYR_DVSN_CD, D3.AUD_KND_CD, D3.TSK_NO, D3.AUD_SBJ_NM, D1.PTCPT_CNB

		  UNION ALL
		  
		  /*감사외업무 기여율*/
		  SELECT D3.EVL_YR	/*평가년도*/
     		   , D3.HLYR_DVSN_CD	/*반기구분*/
     		   , D3.TSK_KND_CD AS TSK_KND_CD	/*업무종류*/
     		   , D3.TSK_NO AS TSK_NO	/*업무번호*/
     		   , D3.TSK_NM AS TSK_NM	/*업무명*/
     		   , '' AS TSK_ST_STEP_CD	/*단계기초*/
     		   , '' AS TSK_END_STEP_CD	/*단계기말*/
     		   , D1.PTCPT_CNB AS CNB	/*전산번호*/
     		   , SUM(D1.CTB_RTE) AS CTB_RTE	/*기여율*/
     		   , 0 AS DRIVE_RTE		/*추진율*/
		    FROM TBCSPAOE025M D1
   			   , TBCSPAOE024M D3
		   WHERE 1=1
 		     AND D1.EVL_YR = D3.EVL_YR
  		 	 AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
  			 AND D1.TSK_NO = D3.TSK_NO
  			 AND D1.EVL_YR = #strEvlYr#
  			 AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
  			 AND D1.PTCPT_CNB = #strCnb#
	    GROUP BY D3.EVL_YR, D3.HLYR_DVSN_CD, D3.TSK_KND_CD, D3.TSK_NO, D3.TSK_NO, D3.TSK_NM, D1.PTCPT_CNB
	      
 	   UNION ALL
	   
	   /*지원업무 기여율*/
	   SELECT D1.EVL_YR	/*평가년도*/
     		, D1.HLYR_DVSN_CD	/*반기구분*/
     		, '' AS TSK_KND_CD	/*업무종류*/
     		, D1.TSK_NO	/*업무번호*/
     		, D2.TSK_NM	/*업무명*/
     		, '' AS TSK_ST_STEP_CD	/*단계기초*/
     		, '' AS TSK_END_STEP_CD	/*단계기말*/
     		, D1.PTCPT_CNB AS CNB	/*전산번호*/
     		, NVL(D1.CTB_RTE,0) AS CTB_RTE	/*기여율*/
     		, 0 AS DRIVE_RTE		/*추진율*/
		 FROM TBCSPAOE027M D1
   			, TBCSPAOE026M D2
		WHERE 1=1
  		  AND D1.EVL_YR = D2.EVL_YR
  		  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
  		  AND D1.TSK_NO = D2.TSK_NO
  		  AND D1.EVL_YR = #strEvlYr#
  		  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
  		  AND D1.PTCPT_CNB = #strCnb#
		]]>
	</select>

	<!-- 개인별 업무실적명세 조회 -->
	<select id="CSPAOE071QMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
            /*감사업무 업무실적명세*/
			SELECT D3.EVL_YR	/*평가년도*/
        		 , D3.HLYR_DVSN_CD	/*반기구분*/
     			 , D3.AUD_KND_CD AS TSK_KND_CD	/*업무종류*/
     			 , D3.TSK_NO AS TSK_NO	/*업무번호*/
     			 , D3.AUD_SBJ_NM AS TSK_NM	/*업무명*/
     			 , MIN(D4.AUD_STEP_CD) AS TSK_ST_STEP_CD	/*단계기초*/
     			 , MAX(D4.AUD_STEP_CD) AS TSK_END_STEP_CD	/*단계기말*/
     			 , D1.PTCPT_CNB AS CNB	/*전산번호*/
     			 , (SELECT SUM(CTB_RTE) AS CTB_RTE FROM TBCSPAOE023M WHERE 1=1 AND EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND PTCPT_CNB = #strCnb# GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_NO, PTCPT_CNB) AS CTB_RTE	/*기여율*/
     			 , (
            		SELECT SUM(D1.DRIVE_RTE) AS DRIVE_RTE
					  FROM TBCSPAOE008D D1
						 , (SELECT DISTINCT D1.EVL_YR
                 				 , D1.HLYR_DVSN_CD
                 				 , D1.TSK_NO
                 				 , D1.AUD_SBJ_NM
                 				 , D3.PTCPT_CNB
              				  FROM TBCSPAOE021M D1
                 				 , TBCSPAOE022M D2
                   				   LEFT JOIN TBCSPAOE023M D3
                          				  ON D2.EVL_YR = D3.EVL_YR
                         				 AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
                         				 AND D2.TSK_NO = D3.TSK_NO
                         				 AND D2.AUD_STEP_CD = D3.AUD_STEP_CD
             		 		WHERE 1=1
                			  AND D1.EVL_YR = D2.EVL_YR
                			  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                			  AND D1.TSK_NO = D2.TSK_NO
                			  AND D3.EVL_YR = #strEvlYr#
                			  AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd#
                			  AND D3.PTCPT_CNB = #strCnb#
   				  ) D2
			  WHERE 1=1
  			    AND D1.EVL_YR = D2.EVL_YR
  				AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
  				AND D1.TSK_DVSN_CD = '10000'
  				AND D1.AUD_KND_CD = (
                        				SELECT DISTINCT  D1.AUD_KND_CD 
                                    				FROM TBCSPAOE021M D1
                                         			   , TBCSPAOE023M D2
                                   				   WHERE 1=1
                                     			   	 AND D1.EVL_YR = D2.EVL_YR
                                     				 AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                                     				 AND D1.TSK_NO = D2.TSK_NO
                                     				 AND D2.EVL_YR = #strEvlYr#
                                     				 AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                     				 AND D2.PTCPT_CNB = #strCnb#
                      				)
  				AND D1.AUD_STEP_CD BETWEEN (SELECT MIN(AUD_STEP_CD) AS AUD_STEP_CD FROM TBCSPAOE022M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_NO = (SELECT TSK_NO FROM TBCSPAOE023M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND PTCPT_CNB = #strCnb#))
                                       AND (SELECT MAX(AUD_STEP_CD) AS AUD_STEP_CD FROM TBCSPAOE022M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_NO = (SELECT TSK_NO FROM TBCSPAOE023M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND PTCPT_CNB = #strCnb#))

       			) AS DRIVE_RTE
     			, NVL(D5.PSN_TSK_ASC,0) AS PSN_TSK_ASC /*개인평점*/
			 FROM TBCSPAOE023M D1
			      LEFT JOIN TBCSPAOE035M D5
              			 ON D1.EVL_YR = D5.EVL_YR
             			AND D1.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
             			AND D1.TSK_NO = D5.TSK_NO
             			AND D1.PTCPT_CNB = D5.NEVLT_CNB
   				, TBCSPAOE021M D3
   				, TBCSPAOE022M D4
			WHERE 1=1
  			  AND D1.EVL_YR = D3.EVL_YR
  			  AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
  			  AND D1.TSK_NO = D3.TSK_NO
  			  AND D1.EVL_YR = D4.EVL_YR
  			  AND D1.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
  			  AND D1.TSK_NO = D4.TSK_NO
  			  AND D1.EVL_YR = #strEvlYr#
  			  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
  			  AND D1.PTCPT_CNB = #strCnb#
		 GROUP BY D3.EVL_YR, D3.HLYR_DVSN_CD, D3.AUD_KND_CD, D3.TSK_NO, D3.AUD_SBJ_NM, D1.PTCPT_CNB, D5.PSN_TSK_ASC

		 UNION ALL
		 
		 /*감사외업무 업무실적명세*/
		 SELECT D3.EVL_YR	/*평가년도*/
     		  , D3.HLYR_DVSN_CD	/*반기구분*/
     		  , D3.TSK_KND_CD AS TSK_KND_CD	/*업무종류*/
     		  , D3.TSK_NO AS TSK_NO	/*업무번호*/
     		  , D3.TSK_NM AS TSK_NM	/*업무명*/
     		  , '' AS TSK_ST_STEP_CD	/*단계기초*/
     		  , '' AS TSK_END_STEP_CD	/*단계기말*/
     		  , D1.PTCPT_CNB AS CNB	/*전산번호*/
     		  , SUM(D1.CTB_RTE) AS CTB_RTE	/*기여율*/
     		  , 0 AS DRIVE_RTE		/*추진율*/
     		  , NVL(D4.PSN_TSK_ASC, 0) AS PSN_TSK_ASC /*개인평점*/
		   FROM TBCSPAOE025M D1
		   		LEFT JOIN TBCSPAOE035M D4
              		   ON D1.EVL_YR = D4.EVL_YR
             		  AND D1.HLYR_DVSN_CD = D4.HLYR_DVSN_CD
             		  AND D1.TSK_NO = D4.TSK_NO
             		  AND D1.PTCPT_CNB = D4.NEVLT_CNB
   			  , TBCSPAOE024M D3
		  WHERE 1=1
 		    AND D1.EVL_YR = D3.EVL_YR
  			AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
  			AND D1.TSK_NO = D3.TSK_NO
  			AND D1.EVL_YR = #strEvlYr#
  			AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
  			AND D1.PTCPT_CNB = #strCnb#
	   GROUP BY D3.EVL_YR, D3.HLYR_DVSN_CD, D3.TSK_KND_CD, D3.TSK_NO, D3.TSK_NO, D3.TSK_NM, D1.PTCPT_CNB, D4.PSN_TSK_ASC
	   
	   UNION ALL
	   
	   /*지원업무 업무실적명세*/
	   SELECT D1.EVL_YR	/*평가년도*/
     		, D1.HLYR_DVSN_CD	/*반기구분*/
     		, '' AS TSK_KND_CD	/*업무종류*/
     		, D1.TSK_NO	/*업무번호*/
     		, D2.TSK_NM	/*업무명*/
     		, '' AS TSK_ST_STEP_CD	/*단계기초*/
     		, '' AS TSK_END_STEP_CD	/*단계기말*/
     		, D1.PTCPT_CNB AS CNB	/*전산번호*/
     		, NVL(D1.CTB_RTE, 0) AS CTB_RTE	/*기여율*/
     		, 0 AS DRIVE_RTE		/*추진율*/
     		, NVL(D3.PSN_TSK_ASC,0) AS PSN_TSK_ASC /*개인평점*/
		 FROM TBCSPAOE027M D1
		 	  LEFT JOIN TBCSPAOE035M D3
              		 ON D1.EVL_YR = D3.EVL_YR
             		AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
             		AND D1.TSK_NO = D3.TSK_NO
             		AND D1.PTCPT_CNB = D3.NEVLT_CNB
   			, TBCSPAOE026M D2
		WHERE 1=1
  		  AND D1.EVL_YR = D2.EVL_YR
  		  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
  		  AND D1.TSK_NO = D2.TSK_NO
  		  AND D1.EVL_YR = #strEvlYr#
  		  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
  		  AND D1.PTCPT_CNB = #strCnb#
		]]>
	</select>

	<!-- 파일첨부(팝업) 온로드시 파일종류 조회 -->
	<select id="CSPAOE088PDocTypCdListSelect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT CD	/*코드*/
     			 , CD_NM 	/*코드명*/
  			  FROM TBDCMACM013C
 			 WHERE 1=1
   			   AND CD <> '000000000'
   			   AND CMM_CD_DVSN_CD ='1000500'
   			   AND TSK_CAT_CD = 'SP'
   			   AND FUNC_CAT_CD = 'OE'
   			   AND CD NOT IN ('SP-OE-008')
 		     ORDER BY OTPT_SEQ, CD ASC
		]]>
	</select>

	<!-- 감사업무 평가관리 온로드시 평가등급코드 조회 -->
	<select id="CSPAOE038EEvlRkCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
            SELECT D1.RK_CD AS CD 
                 , F_CODE_NM('1000274', D1.RK_CD) AS CD_NM /* 등급코드명 */
             FROM (
	                SELECT RK_CD 
	                  FROM TBCSPAOE010D
	                 WHERE EVL_YR       = #strEvlYr#
	                   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
	                   AND TSK_DVSN_CD  = '10000'
	                   AND IDCT_YN      = 'Y'
	                GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_DVSN_CD, RK_CD
	                ) D1
	                , TBDCMACM013C D2
           WHERE 1=1
             AND D1.RK_CD = D2.CD
             AND D2.CD             <> '000000000'
			 AND D2.CMM_CD_DVSN_CD = '1000274'
			 AND D2.USE_YN         = 'Y'
           ORDER BY D2.OTPT_SEQ, D2.CD
		]]>
	</select>
	
	<!-- 평가지표별 명 가져오기   -->
	<select id="CSPAOE038EEvlIndexNmListselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
              SELECT CASE WHEN LENGTH(EVL_INDEX_NM_PJCD01) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD01, 1, INSTR(EVL_INDEX_NM_PJCD01, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD01, (INSTR(EVL_INDEX_NM_PJCD01, ' ')+1))
                          ELSE EVL_INDEX_NM_PJCD01 END EVL_INDEX_NM_PJCD01
                   , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD02) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD02, 1, INSTR(EVL_INDEX_NM_PJCD02, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD02, (INSTR(EVL_INDEX_NM_PJCD02, ' ')+1))
                          ELSE EVL_INDEX_NM_PJCD02 END EVL_INDEX_NM_PJCD02
                   , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD03) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD03, 1, INSTR(EVL_INDEX_NM_PJCD03, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD03, (INSTR(EVL_INDEX_NM_PJCD03, ' ')+1))
                          ELSE EVL_INDEX_NM_PJCD03 END EVL_INDEX_NM_PJCD03
                   , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD04) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD04, 1, INSTR(EVL_INDEX_NM_PJCD04, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD04, (INSTR(EVL_INDEX_NM_PJCD04, ' ')+1))
                          ELSE EVL_INDEX_NM_PJCD04 END EVL_INDEX_NM_PJCD04
                   , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD05) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD05, 1, INSTR(EVL_INDEX_NM_PJCD05, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD05, (INSTR(EVL_INDEX_NM_PJCD05, ' ')+1))
                          ELSE EVL_INDEX_NM_PJCD05 END EVL_INDEX_NM_PJCD05
                   , CASE WHEN LENGTH(EVL_INDEX_NM_PJCD06) > 5 THEN SUBSTR(EVL_INDEX_NM_PJCD06, 1, INSTR(EVL_INDEX_NM_PJCD06, ' ')) || CHR(10) || SUBSTR(EVL_INDEX_NM_PJCD06, (INSTR(EVL_INDEX_NM_PJCD06, ' ')+1))
                          ELSE EVL_INDEX_NM_PJCD06 END EVL_INDEX_NM_PJCD06      
              FROM (        
		             SELECT MAX(DECODE(EVL_INDEX_CD, 'PJCD01', EVL_INDEX_NM, '')) AS EVL_INDEX_NM_PJCD01
		                  , MAX(DECODE(EVL_INDEX_CD, 'PJCD02', EVL_INDEX_NM, '')) AS EVL_INDEX_NM_PJCD02
		                  , MAX(DECODE(EVL_INDEX_CD, 'PJCD03', EVL_INDEX_NM, '')) AS EVL_INDEX_NM_PJCD03
		                  , MAX(DECODE(EVL_INDEX_CD, 'PJCD04', EVL_INDEX_NM, '')) AS EVL_INDEX_NM_PJCD04
		                  , MAX(DECODE(EVL_INDEX_CD, 'PJCD05', EVL_INDEX_NM, '')) AS EVL_INDEX_NM_PJCD05
		                  , MAX(DECODE(EVL_INDEX_CD, 'PJCD06', EVL_INDEX_NM, '')) AS EVL_INDEX_NM_PJCD06
		               FROM TBCSPAOE002M
		              WHERE EVL_YR       = #strEvlYr#
		                AND HLYR_DVSN_CD = #strHlyrDvsnCd#
               		)
		]]>
	</select>

	<!-- 감사업무 평가관리 온로드시 특별가산점항목코드 조회 -->
	<select id="CSPAOE038ESpeAdpCluCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CLU_CD AS CD	/*특별가산점 항목코드*/
     			 , CLU_NM AS CD_NM	/*특별가산점 항목명*/
			  FROM TBCSPAOE011M
			 WHERE USE_YN = 'Y'
		     GROUP BY EVL_YR, HLYR_DVSN_CD, CLU_CD, CLU_NM
		]]>
	</select>

	<!-- 감사업무 평가관리 온로드시 평가지표항목코드 조회 -->
	<select id="CSPAOE038EEvlIndexCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT  EVL_INDEX_CD AS CD	/*평가지표항목코드*/
      			  , EVL_INDEX_NM AS CD_NM	/*평가지표항목명*/
			  FROM TBCSPAOE002M
		     GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_INDEX_CD, EVL_INDEX_NM
		]]>
	</select>

	<!-- 감사업무 평가관리-귀청보고평가 조회 -->
	<select id="CSPAOE038EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT D1.EVL_STEP_CD    /*평가단계코드*/
			     , D1.EVL_CMTR_DVSN_CD    /*평가위원구분코드*/
			     , D1.EVL_CMTR_CNB    /*평가자 전산번호*/
			  	 , D1.EVL_YR    /*평가년도*/
			     , D1.HLYR_DVSN_CD    /*반기구분코드*/
			     , D1.TSK_DVSN_CD    /*업무구분코드*/
			     , D1.AUD_TSK_KND_CD    /*감사업무종류코드*/
			     , D1.AUD_YR	/*감사년도*/
			     , D1.TSK_NO    /*업무번호*/
			     , NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D2.AUD_KND_CD, '-'),D1.TSK_YR_NO) AS TSK_YR_NO    /*감사연번호*/
			     , D1.AUD_SBJ_NM    /*감사사항명*/
			     , D1.AUD_STEP_CD   /*감사기말단계*/
			     , D1.EVL_STA_CD    /*평가상태코드*/
			     , D1.EVL_RK_CD    /*평가등급코드*/
			     , D1.IDVT_INDEX_VAL    /*개별지표값*/
			     , D1.TSK_ASC   /*업무평점*/
			     , D1.DRIVE_RTE_ASC /*추진율조정평점*/
			     , D1.MAIN_INDC_SBJ_PRB_TXT    /*주요지적사항문제점내용*/
			     , D1.MAIN_AUD_RSLT_EPT_EFCT_TXT    /*주요감사결과기대효과내용*/
			     , D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT    /*특기사항계획대비기여율변경사유내용*/
			     , D1.EVL_OPIN    /*평가의견*/
			     , F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM /*처리과 : 2015.02.04 최원형감사관 요청*/
			FROM (
                   SELECT NVL(D5.EVL_STEP_CD, '100') AS EVL_STEP_CD	/*평가단계코드*/
                         , NVL(D5.EVL_CMTR_DVSN_CD, 'CD33') AS EVL_CMTR_DVSN_CD	/*귀청보고평가자구분코드*/
                         , NVL(D5.EVL_CMTR_CNB, #strEvlCmtrCnb#) AS EVL_CMTR_CNB	/*평가자 전산번호*/
                         , NVL(D5.EVL_YR, #strEvlYr#) AS EVL_YR    /*평가년도*/
                         , NVL(D5.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD   /*반기구분코드*/
                         , NVL(D5.TSK_DVSN_CD, '10000') AS TSK_DVSN_CD  /*업무구분코드*/
                         , D4.AUD_KND_CD AS AUD_TSK_KND_CD    /*감사업무종류코드*/
                         , D4.AUD_YR	/*감사년도*/
                         , D4.TSK_NO    /*업무번호*/
                         , D4.AUD_YR||'-'||D4.TSK_NO AS TSK_YR_NO    /*감사연번호*/
                         , D4.AUD_SBJ_NM    /*감사사항명*/
                         , D3.AUD_STEP_CD   /*감사기말단계*/
                         , NVL(D5.EVL_STA_CD,'100') AS EVL_STA_CD    /*평가상태코드*/
                         , D5.EVL_RK_CD /*평가등급코드*/
                         , NULL AS IDVT_INDEX_VAL    /*개별지표값*/
                         , D5.TSK_ASC   /*업무평점*/
                         , D5.DRIVE_RTE_ASC /*추진율조정평점*/
                         , D4.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/
                         , D4.MAIN_AUD_RSLT_EPT_EFCT_TXT    /*주요감사결과기대효과내용*/
                         , D4.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT  /*특기사항계획대비기여율변경사유내용*/
                         , D5.EVL_OPIN /*평가의견*/
                         , D4.HNDL_DIV_DPT_CD /*처리과부서코드*/
                      FROM (
                        SELECT D2.AUD_YR
                             , D2.TSK_NO
                             , D2.AUD_STEP_CD /*마지막단계*/
                         FROM (
                            SELECT AUD_YR
                                 , TSK_NO
                                 , AUD_STEP_CD_MAX
                                 , AUD_STEP_CD_MIN
                              FROM (
                                SELECT AUD_YR 
                                     , TSK_NO 
                                     , MAX(AUD_STEP_CD) AS AUD_STEP_CD_MAX /*단계기말*/
                                     , MIN(AUD_STEP_CD) AS AUD_STEP_CD_MIN
                                  FROM TBCSPAOE022M /* 감사업무처리단계관리기본 */
                                 WHERE 1 = 1
                                   AND CMPT_DT IS NOT NULL
                                   AND CMPT_DT BETWEEN (SELECT EVL_STR_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (SELECT EVL_END_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                 GROUP BY AUD_YR, TSK_NO
                                 )
                             WHERE (TO_NUMBER(AUD_STEP_CD_MAX) BETWEEN 10004 AND 10009 OR TO_NUMBER(AUD_STEP_CD_MAX) = '10011') /* 흐속조치 추가 */
                               AND TO_NUMBER(AUD_STEP_CD_MIN) <= 10004 /*귀청보고 ~ ( 귀청보고 - 국장/단장) */
                             ) D1
                             , TBCSPAOE022M D2
                            WHERE D1.AUD_YR = D2.AUD_YR
                              AND D1.TSK_NO = D2.TSK_NO
                              AND D1.AUD_STEP_CD_MAX = D2.AUD_STEP_CD
                              AND NVL(D2.CTB_RTE_CFM_YN, 'N') = 'Y'
                      ) D3
                      , TBCSPAOE021M D4
                      , (
                        SELECT AUD_YR
                             , TSK_NO
                             , EVL_STEP_CD
                             , EVL_CMTR_DVSN_CD
                             , EVL_CMTR_CNB
                             , TSK_DVSN_CD
                             , EVL_STA_CD
                             , EVL_RK_CD
                             , TSK_ASC
                             , DRIVE_RTE_ASC
                             , EVL_OPIN
                             , EVL_YR
                             , HLYR_DVSN_CD
                          FROM TBCSPAOE029M
                         WHERE EVL_YR       = #strEvlYr#
                           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
                           AND TSK_DVSN_CD  = '10000'
                           AND EVL_STEP_CD  = '100'
                           AND EVL_CMTR_CNB = #strEvlCmtrCnb# 
                       ) D5
                    WHERE D3.AUD_YR = D4.AUD_YR
                      AND D3.TSK_NO = D4.TSK_NO
                      AND D3.AUD_YR = D5.AUD_YR (+)
                      AND D3.TSK_NO = D5.TSK_NO (+)
                      AND D5.EVL_STA_CD IS NULL /*미평가 감사사항 목록*/			
			
			        UNION
			          
			        SELECT D1.EVL_STEP_CD  /*평가단계코드*/
			             , D1.EVL_CMTR_DVSN_CD   /*귀청보고평가자구분코드*/
			             , D1.EVL_CMTR_CNB	    /*평가자 전산번호*/
			             , D1.EVL_YR   /*평가년도*/
			             , D1.HLYR_DVSN_CD /*반기구분코드*/
			             , D1.TSK_DVSN_CD  /*업무구분코드*/
			             , D1.AUD_TSK_KND_CD AS AUD_TSK_KND_CD   /*감사업무종류코드*/
			             , D1.AUD_YR	/*감사년도*/
			             , TO_CHAR(D1.TSK_NO) AS TSK_NO   /*업무번호*/
			             , D1.AUD_YR||'-'||D1.TSK_NO AS TSK_YR_NO    /*감사연번호*/
			             , D2.AUD_SBJ_NM    /*감사사항명*/
			             , D1.AUD_STEP_CD   /*감사기말단계*/
			             , D1.EVL_STA_CD    /*평가상태코드*/
			             , D1.EVL_RK_CD /*평가등급코드*/
			             , D3.IDVT_INDEX_VAL  /*개별지표값*/
			             , D1.TSK_ASC   /*업무평점*/
			             , D1.DRIVE_RTE_ASC /*추진율조정평점*/
			             , D2.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/
			             , D2.MAIN_AUD_RSLT_EPT_EFCT_TXT    /*주요감사결과기대효과내용*/
			             , D2.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT  /*특기사항계획대비기여율변경사유내용*/
			             , D1.EVL_OPIN /*평가의견*/
			             , D2.HNDL_DIV_DPT_CD /*처리과부서코드*/
			          FROM TBCSPAOE029M D1
			             , TBCSPAOE021M D2
			             , TBCSPAOE010D D3
			          WHERE D1.AUD_YR = D2.AUD_YR
           				AND D1.TSK_NO = D2.TSK_NO
			            AND D1.EVL_YR = D3.EVL_YR
			            AND D1.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
			            AND D1.TSK_DVSN_CD = D3.TSK_DVSN_CD
			            AND D1.AUD_TSK_KND_CD = D3.AUD_TSK_KND_CD
			            AND D1.EVL_RK_CD = D3.RK_CD
			            AND D1.TSK_DVSN_CD = '10000'
			            AND D1.EVL_STEP_CD = '100'
			            AND D1.EVL_CMTR_DVSN_CD = 'CD33'
			            AND D1.EVL_STA_CD IS NOT NULL	/*평가중, 평가완료 감사사항 목록*/
			
			        UNION
			        
			          SELECT NVL(D3.EVL_STEP_CD, '100') AS EVL_STEP_CD /*평가단계코드*/
			               , NVL(D3.EVL_CMTR_DVSN_CD, 'CD33') AS EVL_CMTR_DVSN_CD /*귀청보고평가자구분코드*/
			               , NVL(D3.EVL_CMTR_CNB, #strEvlCmtrCnb#) AS EVL_CMTR_CNB /*평가자 전산번호*/
			               , NVL(D3.EVL_YR, #strEvlYr#) AS EVL_YR /*평가년도*/
			               , NVL(D3.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD /*반기구분코드*/          
			               , NVL(D3.TSK_DVSN_CD, '10000') AS TSK_DVSN_CD /*업무구분코드*/
			               , D1.AUD_KND_CD AS AUD_TSK_KND_CD /*감사업무종류코드*/
			               , D1.AUD_YR	/*감사년도*/
			               , D1.TSK_NO /*업무번호*/
			               , D1.AUD_YR||'-'||D1.TSK_NO AS TSK_YR_NO /*감사연번호*/
			               , D1.AUD_SBJ_NM /*감사사항명*/
			               , D6.AUD_STEP_CD /*감사기말단계*/
			               , NVL(D3.EVL_STA_CD, '100') AS EVL_STA_CD /*평가상태코드*/
			               , D3.EVL_RK_CD /*평가등급코드*/
			               , D5.IDVT_INDEX_VAL /*개별지표값*/
			               , D3.TSK_ASC /*업무평점*/
			               , D3.DRIVE_RTE_ASC /*추진율조정평점*/
			               , D1.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/
			               , D1.MAIN_AUD_RSLT_EPT_EFCT_TXT /*주요감사결과기대효과내용*/          
			               , D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /*특기사항계획대비기여율변경사유내용*/
			               , D3.EVL_OPIN /*평가의견*/
			               , D1.HNDL_DIV_DPT_CD /*처리과부서코드*/
					    FROM TBCSPAOE021M D1
					       , TBCSPAOE029M D3 
					       , TBCSPAOE010D D5
					       , (
                               SELECT A.AUD_YR
				                    , A.TSK_NO
				                    , A.AUD_STEP_CD
				                    , nvl(B.CTB_RTE_CFM_YN, 'N') AS CTB_RTE_CFM_YN
				                FROM
				                (
					                SELECT AUD_YR ,
					                       TSK_NO ,
					                       MAX(AUD_STEP_CD) AS AUD_STEP_CD
					                  FROM TBCSPAOE022M
					                 WHERE CMPT_DT IS NOT NULL
					                   AND (CMPT_DT BETWEEN (SELECT EVL_STR_DT
							                                   FROM TBCSPAOE001M
							                                  WHERE EVL_YR = #strEvlYr#
							                                    AND HLYR_DVSN_CD = #strHlyrDvsnCd#)
							                            AND (SELECT EVL_END_DT
							                                   FROM TBCSPAOE001M
							                                  WHERE EVL_YR = #strEvlYr#
							                                    AND HLYR_DVSN_CD = #strHlyrDvsnCd#))
					       GROUP BY AUD_YR, TSK_NO
				                ) A
				                , TBCSPAOE022M B
				            WHERE A.AUD_YR = B.AUD_YR
				              and A.TSK_NO = B.TSK_NO
				              and A.AUD_STEP_CD = B.AUD_STEP_CD
                           ) D6
					 WHERE D1.AUD_YR = D3.AUD_YR (+)
			           AND D1.TSK_NO = D3.TSK_NO (+)
			           AND D1.AUD_KND_CD = D3.AUD_TSK_KND_CD (+)
			           AND D3.EVL_STEP_CD (+) = '100'
			           AND D3.EVL_STA_CD IS NULL
			           AND D3.EVL_YR = D5.EVL_YR
			           AND D3.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
			           AND D3.TSK_DVSN_CD = D5.TSK_DVSN_CD
			           AND D3.AUD_TSK_KND_CD = D5.AUD_TSK_KND_CD
			           AND D3.EVL_RK_CD = D5.RK_CD
			           AND D1.AUD_YR = D6.AUD_YR
                       AND D1.TSK_NO = D6.TSK_NO
			           AND D6.CTB_RTE_CFM_YN = 'Y'	
			   	 
			   	 UNION
     
			     SELECT NVL(D3.EVL_STEP_CD, '100') AS EVL_STEP_CD /*평가단계코드*/,
			            NVL(D3.EVL_CMTR_DVSN_CD, 'CD33') AS EVL_CMTR_DVSN_CD /*귀청보고평가자구분코드*/,
			            NVL(D3.EVL_CMTR_CNB, #strEvlCmtrCnb#) AS EVL_CMTR_CNB /*평가자 전산번호*/,
			            NVL(D3.EVL_YR, #strEvlYr#) AS EVL_YR /*평가년도*/,
			            NVL(D3.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD /*반기구분코드*/,
			            NVL(D3.TSK_DVSN_CD, '10000') AS TSK_DVSN_CD /*업무구분코드*/,
			            D1.AUD_KND_CD AS AUD_TSK_KND_CD /*감사업무종류코드*/,
			            D1.AUD_YR /*감사년도*/,
			            D1.TSK_NO /*업무번호*/,
			            D1.AUD_YR||'-'||D1.TSK_NO AS TSK_YR_NO /*감사연번호*/,
			            D1.AUD_SBJ_NM /*감사사항명*/,
			            D2.AUD_STEP_CD /*감사기말단계*/,
			            NVL(D3.EVL_STA_CD, '100') AS EVL_STA_CD /*평가상태코드*/,
			            D3.EVL_RK_CD /*평가등급코드*/,
			            D5.IDVT_INDEX_VAL /*개별지표값*/,
			            D3.TSK_ASC /*업무평점*/,
			            D3.DRIVE_RTE_ASC /*추진율조정평점*/,
			            D1.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/,
			            D1.MAIN_AUD_RSLT_EPT_EFCT_TXT /*주요감사결과기대효과내용*/,
			            D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /*특기사항계획대비기여율변경사유내용*/,
			            D3.EVL_OPIN /*평가의견*/,
			            D1.HNDL_DIV_DPT_CD /*처리과부서코드*/
			      FROM TBCSPAOE021M D1 ,
			           (SELECT A.AUD_YR /*감사년도*/,
			                   A.TSK_NO /*업무번호*/,
			                   A.AUD_STEP_CD /*감사기말단계*/
			              FROM TBCSPAOE022M A
			             WHERE 1=1
			               AND A.AUD_STEP_CD = '10010'	/*회의시행단계에 완료일이 있어도  귀청보고평가 대상이 됨*/
			               AND A.CMPT_DT IS NOT NULL
                           AND 0 = (
                                 SELECT COUNT(*)
                                 FROM TBCSPAOE029M
                                WHERE EVL_YR || HLYR_DVSN_CD != #strEvlYr# || #strHlyrDvsnCd#
                                  AND EVL_STEP_CD = '100'
                                  AND EVL_CMTR_DVSN_CD = 'CD33'  
                                  AND AUD_YR = A.AUD_YR
                                  AND TSK_NO = A.TSK_NO
                           )			               
			               AND (A.CMPT_DT BETWEEN (select EVL_STR_DT
			                              from TBCSPAOE001M
			                             where EVL_YR = #strEvlYr#
			                               and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
			                              from TBCSPAOE001M
			                             where EVL_YR = #strEvlYr#
			                               and HLYR_DVSN_CD = #strHlyrDvsnCd#))
			               AND A.CTB_RTE_CFM_YN = 'Y') D2 ,
			           TBCSPAOE029M D3 LEFT JOIN TBCSPAOE010D D5 ON D3.EVL_YR = D5.EVL_YR
			       AND D3.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
			       AND D3.TSK_DVSN_CD = D5.TSK_DVSN_CD
			       AND D3.AUD_TSK_KND_CD = D5.AUD_TSK_KND_CD
			       AND D3.EVL_RK_CD = D5.RK_CD
			     WHERE D1.AUD_YR = D2.AUD_YR
			       AND D1.TSK_NO = D2.TSK_NO
			       AND D2.AUD_YR = D3.AUD_YR (+)
			       AND D2.TSK_NO = D3.TSK_NO (+)
			       AND D3.EVL_STEP_CD (+) = '100'
           		   AND D3.EVL_CMTR_DVSN_CD (+) = 'CD33'
			) D1,TBBADDED001M D2	
			WHERE 1=1
			  AND D1.EVL_YR = #strEvlYr#
			  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			  AND D1.TSK_DVSN_CD = '10000'
			  AND D1.AUD_YR = D2.AUD_YR(+)
   				AND D1.TSK_NO = D2.AUD_NO(+)
	    ]]>
		<isNotEmpty prepend="AND" property="strAudYr">
			D1.AUD_YR = #strAudYr#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			D1.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudKndCd">
			D1.AUD_TSK_KND_CD LIKE '%'||#strAudKndCd#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strTskNo">
			CASE WHEN LENGTH(#strTskNo#) = 3 AND D2.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D1.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			      D2.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1)
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strEvlStaCd">
			NVL(D1.EVL_STA_CD, '100') = #strEvlStaCd#
		</isNotEmpty>
        <![CDATA[ 		
			ORDER BY D1.AUD_TSK_KND_CD, D1.HNDL_DIV_DPT_CD
		]]>
	</select>

	<!-- 감사업무 평가관리-귀청보고평가 데이터 조회 -->
	<select id="CSPAOE038ECntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE029M
			 WHERE EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
  			   AND TSK_DVSN_CD = '10000'
  			   AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
  			   AND EVL_STEP_CD = '100'
  			   AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
  			   AND TSK_NO = #TSK_NO#
  			   AND EVL_CMTR_DVSN_CD = 'CD33'
		]]>
	</select>

	<!-- 감사업무 평가관리-귀청보고평가 신규등록 -->
	<insert id="CSPAOE038EMainInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE029M
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, EVL_STEP_CD
			, EVL_CMTR_CNB
			, AUD_YR
			, TSK_NO
			, AUD_STEP_CD
			, EVL_CMTR_DVSN_CD
			, EVL_STA_CD
			, EVL_RK_CD
			, EVL_OPIN
			, DRIVE_RTE_ASC
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #AUD_TSK_KND_CD#
			, '100'
			, #EVL_CMTR_CNB#
			, #AUD_YR#
			, #TSK_NO#
			, #AUD_STEP_CD#
			, 'CD33'
			, #EVL_STA_CD#
			, #EVL_RK_CD#
			, #EVL_OPIN#
			, #DRIVE_RTE_ASC#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사업무 평가관리-귀청보고평가 저장 -->
	<update id="CSPAOE038EMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE029M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE038E'
		<isNotEmpty prepend="," property="EVL_STA_CD">
			EVL_STA_CD = #EVL_STA_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EVL_RK_CD">
			EVL_RK_CD = #EVL_RK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EVL_OPIN">
			EVL_OPIN = #EVL_OPIN#
		</isNotEmpty>
		<isNotEmpty prepend="," property="TSK_ASC">
			TSK_ASC = #TSK_ASC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="DRIVE_RTE_ASC">
			DRIVE_RTE_ASC = #DRIVE_RTE_ASC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AUD_STEP_CD">
			AUD_STEP_CD = #AUD_STEP_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD = #TSK_DVSN_CD#
		  AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		  AND EVL_STEP_CD = #EVL_STEP_CD#
		  AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
		  AND EVL_CMTR_DVSN_CD = #EVL_CMTR_DVSN_CD#
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
	</update>

	<!-- 감사업무 평가관리 확정 전 평가기간여부 조회 -->
	<select id="CSPAOE038EEvlDtYnSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
  			SELECT COUNT(*) AS CNT
			  FROM TBCSPAOE001M
			 WHERE 1=1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT
		]]>
	</select>

	<!-- 감사업무 평가관리-귀청보고평가 확정 -->
	<update id="CSPAOE038EEvlDtmYUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE029M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE038E'
			, EVL_STA_CD = '300'
			, EVL_DTM_YN = 'Y'
		<isNotEmpty prepend="," property="EVL_RK_CD">
			EVL_RK_CD = #EVL_RK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="TSK_ASC">
			TSK_ASC = #TSK_ASC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AUD_STEP_CD">
			AUD_STEP_CD = #AUD_STEP_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD = #TSK_DVSN_CD#
		  AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		  AND EVL_STEP_CD = #EVL_STEP_CD#
		  AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
		  AND EVL_CMTR_DVSN_CD = #EVL_CMTR_DVSN_CD#
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
	</update>
	
	<!-- 감사업무 평가관리-귀청보고평가 확정시 감사종료 처리 -->
	<update id="CSPAOE038EAudEndYUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		   SET AUD_END_YN = 'Y'
		<isNotEmpty prepend="," property="FRT_USR_ID">
			   FRT_USR_ID = #FRT_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			   FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			   FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			   FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FRT_REGI_DH">
			   FRT_REGI_DH = #FRT_REGI_DH#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MDF_DH">
			   FNL_MDF_DH = #FNL_MDF_DH#
		</isNotEmpty>
		 WHERE 1 = 1
		   AND AUD_YR = #AUD_YR#
		   AND TSK_NO = #TSK_NO#
		   AND AUD_STEP_CD = #AUD_STEP_CD#
	</update>

	<!-- 감사업무 평가관리-귀청보고평가 확정취소 -->
	<update id="CSPAOE038EEvlDtmNUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE029M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE038E'
			, EVL_STA_CD = '200'
			, EVL_DTM_YN = 'N'
		<isNotEmpty prepend="," property="EVL_RK_CD">
			EVL_RK_CD = #EVL_RK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD = #TSK_DVSN_CD#
		  AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		  AND EVL_STEP_CD = #EVL_STEP_CD#
		  AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
		  AND EVL_CMTR_DVSN_CD = #EVL_CMTR_DVSN_CD#
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
	</update>
	
	<!-- 감사업무 평가관리-귀청보고평가 확정취소시 감사종료 취소처리 -->
	<update id="CSPAOE038EAudEndNUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE022M
		   SET AUD_END_YN = 'N'
		<isNotEmpty prepend="," property="FRT_USR_ID">
			   FRT_USR_ID = #FRT_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			   FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			   FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			   FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FRT_REGI_DH">
			   FRT_REGI_DH = #FRT_REGI_DH#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MDF_DH">
			   FNL_MDF_DH = #FNL_MDF_DH#
		</isNotEmpty>
		 WHERE 1 = 1
		   AND AUD_YR = #AUD_YR#
		   AND TSK_NO = #TSK_NO#
		   AND AUD_STEP_CD = #AUD_STEP_CD#
	</update>

	<!-- 감사업무 평가관리-위원평가 조회 -->
	<select id="CSPAOE038EParamSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT DISTINCT D1.EVL_STEP_CD   /*평가단계코드*/
			     , D1.EVL_CMTR_DVSN_CD  /*평가자구분코드*/
			     , D1.EVL_CMTR_CNB  /*평가자 전산번호*/
			     , D1.EVL_YR    /*평가년도*/
			     , D1.HLYR_DVSN_CD  /*반기구분코드*/
			     , D1.TSK_DVSN_CD   /*업무구분코드*/
			     , D1.AUD_TSK_KND_CD    /*감사업무종류코드*/
			     , D1.AUD_YR    /*감사년도*/
			     , D1.TSK_NO    /*업무번호*/
			     , NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D3.AUD_KND_CD, '-'),D1.TSK_YR_NO) AS TSK_YR_NO /*감사연번호*/
			     , D1.AUD_SBJ_NM    /*감사사항명*/
			     , D1.AUD_STEP_CD   /*감사기말단계*/
			     , D1.EVL_STA_CD    /*평가상태코드*/
			     , D1.EVL_INDEX_CD1 /*감사준비 평가등급*/
		         , D1.EVL_INDEX_RTE1 /*감사준비 비중*/
		         , D1.EVL_INDEX_CD2 /*감사투입인력비용적정성 평가등급*/
		         , D1.EVL_INDEX_RTE2 /*감사투입인력비용적정성 비중*/
		         , D1.EVL_INDEX_CD3  /*감사난이도 평가등급*/
		         , D1.EVL_INDEX_RTE3  /*감사난이도 비중*/
		         , D1.EVL_INDEX_CD4 /*지적사항변경불문정도 평가등급*/
		         , D1.EVL_INDEX_RTE4 /*지적사항변경불문정도 비중*/
		         , D1.EVL_INDEX_CD5 /*처리안작성적정성 평가등급*/
		         , D1.EVL_INDEX_RTE5 /*처리안작성적정성 비중*/
		         , D1.EVL_INDEX_CD6 /*감사성과정도 평가등급*/    
		         , D1.EVL_INDEX_RTE6 /*감사성과정도 비중*/ 
				 , D1.RK_CD_100 /*탁월 개별지표값*/
		         , D1.RK_CD_200 /*매우우수 개별지표값*/
		         , D1.RK_CD_300 /*우수+ 개별지표값*/
		         , D1.RK_CD_400 /*우수- 개별지표값*/
		         , D1.RK_CD_500 /*양호 개별지표값*/
		         , D1.RK_CD_600 /*보통 개별지표값*/
		         , D1.RK_CD_700 /*미흡 개별지표값*/
		         , D1.RK_CD_800 /*우수 개별지표값*/
		         , D1.CAL_IDVT_INDEX_VAL1   /*감사준비 비중*개별지표*/
                 , D1.CAL_IDVT_INDEX_VAL2   /*감사투입인력비용적정성 비중*개별지표*/
                 , D1.CAL_IDVT_INDEX_VAL3   /*감사난이도 비중*개별지표*/
                 , D1.CAL_IDVT_INDEX_VAL4   /*지적사항변경불문정도 비중*개별지표*/
                 , D1.CAL_IDVT_INDEX_VAL5   /*처리안작성적정성 비중*개별지표*/
                 , D1.CAL_IDVT_INDEX_VAL6   /*감사성과정도 비중*개별지표*/
		         , D1.DRIVE_RTE_ASC /*추진율조정평점*/
		         , D1.TSK_ASC   /*업무평점*/
			     , D1.SYT_EVL_RK_CD /*종합평가등급코드*/
			     , D1.SYT_EVL_ADVL_VAL  /*종합가중치 합계지표*/
			     , D1.SPE_ADP_CLU_CD    /*특별가산점항목코드*/
			     , D1.SPE_ADD_SC    /*특별가산점*/
			     , D1.MDT_ASC   /*평점조정*/
			     , D1.EVL_OPIN  /*위원평가의견*/
			     , D1.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/
      			 , D1.MAIN_AUD_RSLT_EPT_EFCT_TXT /*주요감사결과기대효과내용*/          
     			 , D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /*특기사항계획대비기여율변경사유내용*/
			     , D2.EVL_RK_CD AS BF_EVL_RK_CD /*귀청보고평가등급*/
			     , D2.EVL_STEP_NM	/*평가단계명*/
		         , D2.EVL_CMTR_NM	/*귀청보고 평가자명*/
		         , D2.EVL_RK_NM	/*귀청보고 평가등급*/
		         , D2.EVL_STA_NM	/*귀청보고 평가상태*/
			     , D2.EVL_OPIN AS BF_EVL_OPIN/*귀청보고평가의견*/
			     , F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM /*처리과 추가요구 2015.02.04 최원형감사관 요청*/
                 , D1.HNDL_DIV_DPT_CD
			FROM (
					select a.EVL_STEP_CD /*평가단계코드*/,
			               a.EVL_CMTR_DVSN_CD /*평가자구분코드*/,
			               a.EVL_CMTR_CNB /*평가자 전산번호*/,
			               a.EVL_YR /*평가년도*/,
			               a.HLYR_DVSN_CD /*반기구분코드*/,
			               a.TSK_DVSN_CD /*업무구분코드*/,
			               a.AUD_TSK_KND_CD /*감사업무종류코드*/,
			               a.AUD_YR /*감사년도*/,
			               a.TSK_NO /*업무번호*/,
			               a.AUD_YR||'-'||a.TSK_NO AS TSK_YR_NO /*감사연번호*/,
			               a.AUD_SBJ_NM /*감사사항명*/,
			               a.AUD_STEP_CD /*감사기말단계*/,
			               a.EVL_STA_CD /*평가상태코드*/,
			               A.EVL_INDEX_CD1 /*감사준비 평가등급*/,
			               D4.EVL_INDEX_RTE1 /*감사준비 비중*/,
			               A.EVL_INDEX_CD2 /*감사투입인력비용적정성 평가등급*/,
			               D4.EVL_INDEX_RTE2 /*감사투입인력비용적정성 비중*/,
			               A.EVL_INDEX_CD3 /*감사난이도 평가등급*/,
			               D4.EVL_INDEX_RTE3 /*감사난이도 비중*/,
			               A.EVL_INDEX_CD4 /*지적사항변경불문정도 평가등급*/,
			               D4.EVL_INDEX_RTE4 /*지적사항변경불문정도 비중*/,
			               A.EVL_INDEX_CD5 /*처리안작성적정성 평가등급*/,
			               D4.EVL_INDEX_RTE5 /*처리안작성적정성 비중*/,
			               A.EVL_INDEX_CD6 /*감사성과정도 평가등급*/,
			               D4.EVL_INDEX_RTE6 /*감사성과정도 비중*/,
			               D5.RK_CD_100 /*탁월 개별지표값*/,
			               D5.RK_CD_200 /*매우우수 개별지표값*/,
			               D5.RK_CD_300 /*우수+ 개별지표값*/,
			               D5.RK_CD_400 /*우수- 개별지표값*/,
			               D5.RK_CD_500 /*양호 개별지표값*/,
			               D5.RK_CD_600 /*보통 개별지표값*/,
			               D5.RK_CD_700 /*미흡 개별지표값*/,
			               D5.RK_CD_800 /*우수 개별지표값*/,
	                       CASE WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '100' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_100)/100
                                WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '200' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_200)/100
                            	WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '300' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_300)/100
                            	WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '400' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_400)/100
                            	WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '500' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_500)/100
                         		WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '600' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_600)/100
                         		WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '700' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_700)/100
                         		WHEN A.EVL_INDEX_CD1 IS NOT NULL AND A.EVL_INDEX_CD1 = '800' THEN (D4.EVL_INDEX_RTE1 * D5.RK_CD_800)/100
	                       ELSE 0
	                       END AS CAL_IDVT_INDEX_VAL1 /*감사준비 비중*개별지표*/ ,
	                       CASE WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '100' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_100)/100
	                            WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '200' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_200)/100
	                            WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '300' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_300)/100
	                            WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '400' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_400)/100
	                            WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '500' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_500)/100
	                            WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '600' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_600)/100
	                            WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '700' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_700)/100
	                            WHEN A.EVL_INDEX_CD2 IS NOT NULL AND A.EVL_INDEX_CD2 = '800' THEN (D4.EVL_INDEX_RTE2 * D5.RK_CD_800)/100
	                       ELSE 0
	                       END CAL_IDVT_INDEX_VAL2 /*감사투입인력비용적정성 비중*개별지표*/ ,
		                   CASE WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '100' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_100)/100
		                        WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '200' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_200)/100
		                        WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '300' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_300)/100
		                        WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '400' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_400)/100
		                        WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '500' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_500)/100
		                        WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '600' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_600)/100
		                        WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '700' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_700)/100
		                        WHEN A.EVL_INDEX_CD3 IS NOT NULL AND A.EVL_INDEX_CD3 = '800' THEN (D4.EVL_INDEX_RTE3 * D5.RK_CD_800)/100
		                   ELSE 0
		                   END CAL_IDVT_INDEX_VAL3 /*감사난이도 비중*개별지표*/ ,
	                       CASE WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '100' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_100)/100
	                            WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '200' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_200)/100
	                            WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '300' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_300)/100
	                            WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '400' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_400)/100
	                            WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '500' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_500)/100
	                            WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '600' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_600)/100
	                            WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '700' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_700)/100
	                            WHEN A.EVL_INDEX_CD4 IS NOT NULL AND A.EVL_INDEX_CD4 = '800' THEN (D4.EVL_INDEX_RTE4 * D5.RK_CD_800)/100
	                       ELSE 0
	                       END CAL_IDVT_INDEX_VAL4 /*지적사항변경불문정도 비중*개별지표*/ ,
	                       CASE WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '100' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_100)/100
	                            WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '200' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_200)/100
	                            WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '300' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_300)/100
	                            WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '400' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_400)/100
	                            WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '500' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_500)/100
	                            WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '600' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_600)/100
	                            WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '700' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_700)/100
	                            WHEN A.EVL_INDEX_CD5 IS NOT NULL AND A.EVL_INDEX_CD5 = '800' THEN (D4.EVL_INDEX_RTE5 * D5.RK_CD_800)/100
	                       ELSE 0
	                       END CAL_IDVT_INDEX_VAL5 /*처리안작성적정성 비중*개별지표*/ ,
	                       CASE WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '100' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_100)/100
	                         WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '200' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_200)/100
	                         WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '300' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_300)/100
	                         WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '400' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_400)/100
	                         WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '500' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_500)/100
	                         WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '600' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_600)/100
	                         WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '700' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_700)/100
	                         WHEN A.EVL_INDEX_CD6 IS NOT NULL AND A.EVL_INDEX_CD6 = '800' THEN (D4.EVL_INDEX_RTE6 * D5.RK_CD_800)/100
	                         ELSE 0
	                       END CAL_IDVT_INDEX_VAL6 /*감사성과정도 비중*개별지표*/ ,
			               a.DRIVE_RTE_ASC /*추진율조정평점*/,
			               a.TSK_ASC /*업무평점*/,
			               a.SYT_EVL_RK_CD /*종합평가등급코드*/,
			               a.SYT_EVL_ADVL_VAL /*종합가중치 합계지표*/,
			               a.SPE_ADP_CLU_CD /*특별가산점항목코드*/,
			               a.SPE_ADD_SC /*특별가산점*/,
			               a.MDT_ASC /*평점조정*/,
			               a.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/,
			               a.MAIN_AUD_RSLT_EPT_EFCT_TXT /*주요감사결과기대효과내용*/,
			               a.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /*특기사항계획대비기여율변경사유내용*/,
			               a.EVL_OPIN /*위원평가의견*/
			               , A.HNDL_DIV_DPT_CD
			from (
					SELECT  A.EVL_STEP_CD
					      , A.EVL_CMTR_DVSN_CD
					      , A.EVL_CMTR_CNB
					      , A.EVL_YR
					      , A.HLYR_DVSN_CD
					      , A.TSK_DVSN_CD
					      , A.AUD_TSK_KND_CD
					      , A.AUD_YR
					      , A.TSK_NO
					      , A.TSK_YR_NO
					      , A.AUD_SBJ_NM
					      , A.AUD_STEP_CD
					      , A.EVL_STA_CD
					      , NVL(B.EVL_INDEX_CD1,0) AS EVL_INDEX_CD1 /*감사준비 평가등급*/
					      , NVL(B.EVL_INDEX_CD2,0) AS EVL_INDEX_CD2 /*감사투입인력비용적정성 평가등급*/
					      , NVL(B.EVL_INDEX_CD3,0) AS EVL_INDEX_CD3 /*감사난이도 평가등급*/
					      , NVL(B.EVL_INDEX_CD4,0) AS EVL_INDEX_CD4 /*지적사항변경불문정도 평가등급*/
					      , NVL(B.EVL_INDEX_CD5,0) AS EVL_INDEX_CD5 /*처리안작성적정성 평가등급*/
					      , NVL(B.EVL_INDEX_CD6,0) AS EVL_INDEX_CD6 /*감사성과정도 평가등급*/
					      , A.DRIVE_RTE_ASC
					      , A.TSK_ASC
					      , A.SYT_EVL_RK_CD
					      , A.SYT_EVL_ADVL_VAL
					      , A.SPE_ADP_CLU_CD
					      , A.SPE_ADD_SC
					      , A.MDT_ASC
					      , A.MAIN_INDC_SBJ_PRB_TXT
					      , A.MAIN_AUD_RSLT_EPT_EFCT_TXT
					      , A.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT
					      , A.EVL_OPIN
					      , A.HNDL_DIV_DPT_CD
					FROM(
					        SELECT NVL(D3.EVL_STEP_CD, '200') AS EVL_STEP_CD /*평가단계코드*/,
					                       NVL(D3.EVL_CMTR_DVSN_CD, 'CD34') AS EVL_CMTR_DVSN_CD /*평가자구분코드*/,
					                       NVL(D3.EVL_CMTR_CNB, #strEvlCmtrCnb#) AS EVL_CMTR_CNB /*평가자 전산번호*/,
					                       NVL(D3.EVL_YR, #strEvlYr#) AS EVL_YR /*평가년도*/,
					                       NVL(D3.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD /*반기구분코드*/                  ,
					                       NVL(D3.TSK_DVSN_CD, '10000') AS TSK_DVSN_CD /*업무구분코드*/,
					                       D2.AUD_KND_CD AS AUD_TSK_KND_CD /*감사업무종류코드*/,
					                       D1.AUD_YR /*감사년도*/,
					                       D1.TSK_NO /*업무번호*/,
					                       D1.AUD_YR||'-'||D1.TSK_NO AS TSK_YR_NO /*감사연번호*/,
					                       D2.AUD_SBJ_NM /*감사사항명*/,
					                       D1.AUD_STEP_CD /*감사기말단계*/,
					                       NVL(D3.EVL_STA_CD, '100') AS EVL_STA_CD /*평가상태코드*/,
					                       D3.DRIVE_RTE_ASC /*추진율조정평점*/,
					                       D3.TSK_ASC /*업무평점*/,
					                       D3.SYT_EVL_RK_CD /*종합평가등급코드*/,
					                       D3.SYT_EVL_ADVL_VAL /*종합가중치 합계지표*/,
					                       D3.SPE_ADP_CLU_CD /*특별가산점항목코드*/,
					                       D3.SPE_ADD_SC /*특별가산점*/,
					                       D3.MDT_ASC /*평점조정*/,
					                       D2.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/,
					                       D2.MAIN_AUD_RSLT_EPT_EFCT_TXT /*주요감사결과기대효과내용*/,
					                       D2.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /*특기사항계획대비기여율변경사유내용*/,
					                       D3.EVL_OPIN /*위원평가의견*/
					                       , D2.HNDL_DIV_DPT_CD
					                  FROM TBCSPAOE022M D1 ,
					                       TBCSPAOE021M D2 ,
					                       TBCSPAOE029M D3
					                 WHERE D1.AUD_YR = D2.AUD_YR
					                   AND D1.TSK_NO = D2.TSK_NO
					                   AND D2.AUD_YR = D3.AUD_YR (+)
					                   AND D2.TSK_NO = D3.TSK_NO (+)
					                   AND D2.AUD_KND_CD = D3.AUD_TSK_KND_CD (+)
					                   and d3.evl_yr (+) = #strEvlYr#
					                   and d3.HLYR_DVSN_CD (+) = #strHlyrDvsnCd#
					                   AND D1.AUD_STEP_CD = '10010'
					                   AND D3.EVL_STEP_CD (+) = '200'
					                   AND D1.LUNH_DT IS NOT NULL
					                   AND D1.CMPT_DT IS NOT NULL
					                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT
					                                  from TBCSPAOE001M
					                                 where EVL_YR = #strEvlYr#
					                                   and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
					                                  from TBCSPAOE001M
					                                 where EVL_YR = #strEvlYr#
					                                   and HLYR_DVSN_CD = #strHlyrDvsnCd#))
					                   AND D1.CTB_RTE_CFM_YN = 'Y'	/*기여율 확인을 했고 감사단계가 회의시행단계인 감사사항 목록*/
					                   
					                   
					           UNION
					           
					           
					           SELECT NVL(D3.EVL_STEP_CD, '200') AS EVL_STEP_CD /*평가단계코드*/,
					                       NVL(D3.EVL_CMTR_DVSN_CD, 'CD34') AS EVL_CMTR_DVSN_CD /*평가자구분코드*/,
					                       NVL(D3.EVL_CMTR_CNB, #strEvlCmtrCnb#) AS EVL_CMTR_CNB /*평가자 전산번호*/,
					                       NVL(D3.EVL_YR, #strEvlYr#) AS EVL_YR /*평가년도*/,
					                       NVL(D3.HLYR_DVSN_CD, #strHlyrDvsnCd#) AS HLYR_DVSN_CD /*반기구분코드*/,
					                       NVL(D3.TSK_DVSN_CD, '10000') AS TSK_DVSN_CD /*업무구분코드*/,
					                       D1.AUD_KND_CD AS AUD_TSK_KND_CD /*감사업무종류코드*/,
					                       D1.AUD_YR /*감사년도*/,
					                       D1.TSK_NO /*업무번호*/,
					                       D1.AUD_YR||'-'||D1.TSK_NO AS TSK_YR_NO /*감사연번호*/,
					                       D1.AUD_SBJ_NM /*감사사항명*/,
					                       D2.AUD_STEP_CD /*감사기말단계*/,
					                       NVL(D3.EVL_STA_CD, '100') AS EVL_STA_CD /*평가상태코드*/,
					                       D3.DRIVE_RTE_ASC /*추진율조정평점*/,
					                       D3.TSK_ASC /*업무평점*/,
					                       D3.SYT_EVL_RK_CD /*종합평가등급코드*/,
					                       D3.SYT_EVL_ADVL_VAL /*종합가중치 합계지표*/,
					                       D3.SPE_ADP_CLU_CD /*특별가산점항목코드*/,
					                       D3.SPE_ADD_SC /*특별가산점*/,
					                       D3.MDT_ASC /*평점조정*/,
					                       D1.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/,
					                       D1.MAIN_AUD_RSLT_EPT_EFCT_TXT /*주요감사결과기대효과내용*/,
					                       D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /*특기사항계획대비기여율변경사유내용*/,
					                       D3.EVL_OPIN /*위원평가의견*/
					                       , D1.HNDL_DIV_DPT_CD
					                  FROM TBCSPAOE021M D1 ,
					                       TBCSPAOE029M D3 ,
					                       (SELECT AUD_YR ,
					                               TSK_NO ,
					                               MAX(AUD_STEP_CD) AS AUD_STEP_CD
					                          FROM TBCSPAOE022M
					                         WHERE LUNH_DT IS NOT NULL
					                           and CMPT_DT IS NOT NULL
					                           AND (CMPT_DT BETWEEN (select EVL_STR_DT
					                                          from TBCSPAOE001M
					                                         where EVL_YR = #strEvlYr#
					                                           and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
					                                          from TBCSPAOE001M
					                                         where EVL_YR = #strEvlYr#
					                                           and HLYR_DVSN_CD = #strHlyrDvsnCd#))
					                           AND CTB_RTE_CFM_YN = 'Y'
					                         GROUP BY AUD_YR, TSK_NO ) D2
					                 WHERE D1.AUD_YR = D3.AUD_YR (+)
					                   AND D1.TSK_NO = D3.TSK_NO (+)
					                   AND D1.AUD_KND_CD = D3.AUD_TSK_KND_CD (+)
					                   AND D1.TSK_NO = D3.TSK_NO (+)
					                   AND D3.EVL_STEP_CD (+) = '200'
					                   AND D3.EVL_STA_CD IS NULL
					                   AND D1.EVL_RQS_YN = 'Y'
					                   AND D1.AUD_YR = D2.AUD_YR
					                   AND D1.TSK_NO = D2.TSK_NO	/*평가요청(평가기준>업무별기준관리>감사업무평가요청화면)을 했고 미평가상태인 감사사항 목록*/
					          
					          UNION					          
					          
					          SELECT D1.EVL_STEP_CD /*평가단계코드*/,
					               D1.EVL_CMTR_DVSN_CD /*평가위원구분코드*/,
					               D1.EVL_CMTR_CNB /*평가자 전산번호*/,
					               D1.EVL_YR /*평가년도*/,
					               D1.HLYR_DVSN_CD /*반기구분코드*/,
					               D1.TSK_DVSN_CD /*업무구분코드*/,
					               D1.AUD_TSK_KND_CD AS AUD_TSK_KND_CD /*감사업무종류코드*/,
					               D2.AUD_YR /*감사년도*/,
					               TO_CHAR(D2.TSK_NO) AS TSK_NO /*업무번호*/,
					               D2.AUD_YR||'-'||D2.TSK_NO AS TSK_YR_NO /*감사연번호*/,
					               D2.AUD_SBJ_NM /*감사사항명*/,
					               D3.AUD_STEP_CD /*감사기말단계*/,
					               D1.EVL_STA_CD /*평가상태코드*/          ,
					               D1.DRIVE_RTE_ASC /*추진율조정평점*/,
					               D1.TSK_ASC /*업무평점*/          ,
					               D1.SYT_EVL_RK_CD /*종합평가등급코드*/,
					               D1.SYT_EVL_ADVL_VAL /*종합가중치 합계지표*/,
					               D1.SPE_ADP_CLU_CD /*특별가산점항목코드*/          ,
					               D1.SPE_ADD_SC /*특별가산점*/,
					               D1.MDT_ASC /*평점조정*/,
					               D2.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/          ,
					               D2.MAIN_AUD_RSLT_EPT_EFCT_TXT /*주요감사결과기대효과내용*/,
					               D2.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /*특기사항계획대비기여율변경사유내용*/,
					               D1.EVL_OPIN /*위원평가의견*/
					               , D2.HNDL_DIV_DPT_CD
					          FROM TBCSPAOE029M D1 ,
					               TBCSPAOE021M D2 ,
					               (SELECT AUD_YR ,
					                       TSK_NO ,
					                       MAX(AUD_STEP_CD) AS AUD_STEP_CD
					                  FROM TBCSPAOE022M
					                 WHERE LUNH_DT IS NOT NULL
					                   AND CMPT_DT IS NOT NULL
					                   AND (CMPT_DT BETWEEN (select EVL_STR_DT
					                                  from TBCSPAOE001M
					                                 where EVL_YR = #strEvlYr#
					                                   and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
					                                  from TBCSPAOE001M
					                                 where EVL_YR = #strEvlYr#
					                                   and HLYR_DVSN_CD = #strHlyrDvsnCd#))
					                   AND CTB_RTE_CFM_YN = 'Y'
					                 GROUP BY AUD_YR,
					                       TSK_NO ) D3 
					         WHERE D1.AUD_YR = D2.AUD_YR
					           AND D1.TSK_NO = D2.TSK_NO
					           AND D2.AUD_YR = D3.AUD_YR
					           AND D2.TSK_NO = D3.TSK_NO
					           AND D1.TSK_DVSN_CD = '10000'
					           AND D1.EVL_STEP_CD = '200'
					           AND D1.EVL_CMTR_DVSN_CD = 'CD34'
					           AND D1.EVL_STA_CD IS NOT NULL	/*평가중, 평가완료상태인 감사사항 목록*/
			     ) A  
			     , (
			            SELECT DISTINCT C.EVL_YR,
				                        C.HLYR_DVSN_CD,
				                        C.AUD_YR,
				                        C.TSK_NO,
				                        MAX(C.EVL_INDEX_CD1) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.AUD_YR, C.TSK_NO) AS EVL_INDEX_CD1 /*감사준비*/,
				                        MAX(C.EVL_INDEX_CD2) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.AUD_YR, C.TSK_NO) AS EVL_INDEX_CD2 /*감사투입인력비용적정성*/,
				                        MAX(C.EVL_INDEX_CD3) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.AUD_YR, C.TSK_NO) AS EVL_INDEX_CD3 /*감사난이도*/,
				                        MAX(C.EVL_INDEX_CD4) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.AUD_YR, C.TSK_NO) AS EVL_INDEX_CD4 /*지적사항변경불문정도*/,
				                        MAX(C.EVL_INDEX_CD5) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.AUD_YR, C.TSK_NO) AS EVL_INDEX_CD5 /*처리안작성적정성*/,
				                        MAX(C.EVL_INDEX_CD6) OVER(PARTITION BY C.EVL_YR, C.HLYR_DVSN_CD, C.AUD_YR, C.TSK_NO) AS EVL_INDEX_CD6 /*감사성과정도*/
			            FROM (
			                    SELECT B.EVL_YR
			                         , B.HLYR_DVSN_CD
			                         , B.AUD_YR
			                         , B.TSK_NO
			                         , CASE WHEN B.EVL_INDEX_CD = 'PJCD02' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD1 /*감사준비 등급*/
                                     , CASE WHEN B.EVL_INDEX_CD = 'PJCD01' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD2 /*감사투입인력비용적정성 등급*/
                                     , CASE WHEN B.EVL_INDEX_CD = 'PJCD05' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD3 /*감사난이도 등급*/
                                     , CASE WHEN B.EVL_INDEX_CD = 'PJCD03' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD4 /*지적사항변경불문정도 등급*/
                                     , CASE WHEN B.EVL_INDEX_CD = 'PJCD04' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD5 /*처리안작성적정성 등급*/
                                     , CASE WHEN B.EVL_INDEX_CD = 'PJCD06' THEN NVL(B.EVL_RK_CD, 0) END AS EVL_INDEX_CD6 /*감사성과정도 등급*/
			                   FROM TBCSPAOE030M B
			                   WHERE B.EVL_YR = #strEvlYr#
			                     AND B.HLYR_DVSN_CD = #strHlyrDvsnCd#
			                 ) C
			     ) B		     
			WHERE A.EVL_YR = B.EVL_YR (+)
			  AND A.HLYR_DVSN_CD = B.HLYR_DVSN_CD (+)
			  AND A.AUD_YR = B.AUD_YR (+)
			  AND A.TSK_NO = B.TSK_NO (+)
			     ) A       
			   , (SELECT DISTINCT A.EVL_YR,
			                      A.HLYR_DVSN_CD,
			                      MAX(A.EVL_INDEX_RTE1) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE1 /*감사준비 비중*/,
			                      MAX(A.EVL_INDEX_RTE2) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE2 /*감사투입인력비용적정성 비중*/,
			                      MAX(A.EVL_INDEX_RTE3) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE3 /*감사난이도 비중*/,
			                      MAX(A.EVL_INDEX_RTE4) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE4 /*지적사항변경불문정도 비중*/,
			                      MAX(A.EVL_INDEX_RTE5) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE5 /*처리안작성적정성 비중*/,
			                      MAX(A.EVL_INDEX_RTE6) OVER(PARTITION BY A.EVL_YR, A.HLYR_DVSN_CD) AS EVL_INDEX_RTE6 /*감사성과정도 비중*/
			                  FROM (SELECT E.EVL_YR,
			                               E.HLYR_DVSN_CD,
                                           CASE WHEN E.EVL_INDEX_CD = 'PJCD02' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_RTE1 /*감사준비*/,
                                           CASE WHEN E.EVL_INDEX_CD = 'PJCD01' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_RTE2 /*감사투입인력비용적정성*/,
                                           CASE WHEN E.EVL_INDEX_CD = 'PJCD05' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_RTE3 /*감사난이도*/,
                                           CASE WHEN E.EVL_INDEX_CD = 'PJCD03' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_RTE4 /*지적사항변경불문정도*/,
                                           CASE WHEN E.EVL_INDEX_CD = 'PJCD04' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_RTE5 /*처리안작성적정성*/,
                                           CASE WHEN E.EVL_INDEX_CD = 'PJCD06' THEN NVL(E.WGT_RTE, 0) END AS EVL_INDEX_RTE6 /*감사성과정도*/
			                          FROM TBCSPAOE002M E ,
			                               TBCSPAOE030M D
			                         WHERE 1=1
			                           AND E.EVL_YR = D.EVL_YR (+)
			                           AND E.HLYR_DVSN_CD = D.HLYR_DVSN_CD (+)
			                           AND E.EVL_INDEX_CD = D.EVL_INDEX_CD (+)
			                           AND E.EVL_YR = #strEvlYr#
			                           AND E.HLYR_DVSN_CD = #strHlyrDvsnCd#
			                           AND D.TSK_DVSN_CD (+) = '10000'
			                           AND D.EVL_STEP_CD (+) = '200' ) A ) D4 ,
			               (
                               SELECT NVL(SUM(CASE WHEN A.RK_CD = '100' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD_100	/*탁월*/,
                                      NVL(SUM(CASE WHEN A.RK_CD = '200' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD_200 /*매우우수*/,
                                      NVL(SUM(CASE WHEN A.RK_CD = '300' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD_300 /*우수+*/,
                                      NVL(SUM(CASE WHEN A.RK_CD = '400' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD_400 /*우수-*/,
                                      NVL(SUM(CASE WHEN A.RK_CD = '500' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD_500 /*양호*/,
                                      NVL(SUM(CASE WHEN A.RK_CD = '600' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD_600 /*보통*/,
                                      NVL(SUM(CASE WHEN A.RK_CD = '700' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD_700 /*미흡*/,
                                      NVL(SUM(CASE WHEN A.RK_CD = '800' THEN NVL(A.IDVT_INDEX_VAL, 0) END ), 0) AS RK_CD_800 /*우수*/,
	                                  A.EVL_YR ,
	                                  A.HLYR_DVSN_CD ,
	                                  A.TSK_DVSN_CD ,
	                                  A.AUD_TSK_KND_CD
	                               FROM TBCSPAOE010D A
	                              WHERE 1=1
	                                AND A.IDCT_YN = 'Y'
	                                AND A.EVL_YR = #strEvlYr#
					 		        AND A.HLYR_DVSN_CD = #strHlyrDvsnCd#
	                                AND A.TSK_DVSN_CD = '10000'
	                              GROUP BY A.EVL_YR, A.HLYR_DVSN_CD, A.TSK_DVSN_CD, A.AUD_TSK_KND_CD 			               
			               ) D5 /*2015.02.26 수정 쿼리가...이상했다. 종류별 등급별 점수가 다다른데 그냥 등급별 점수를 맥스로 해서 계산오류가 있었음*/
			where a.evl_yr = d4.EVL_YR
			  and a.HLYR_DVSN_CD = d4.HLYR_DVSN_CD
			  AND A.evl_yr = D5.EVL_YR
			  AND A.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
              AND A.AUD_TSK_KND_CD = D5.AUD_TSK_KND_CD
				 ) D1 LEFT JOIN (SELECT D1.EVL_YR    /*평가년도*/
				                      , D1.HLYR_DVSN_CD /*반기구분*/
				                      , D1.TSK_DVSN_CD /*업무구분*/
				                      , D1.AUD_TSK_KND_CD /*감사종류코드*/
				                      , D1.EVL_CMTR_CNB /*평가자 전산번호*/
				                      , D1.AUD_YR  /*감사년도*/
				                      , D1.TSK_NO /*업무번호*/
				                      , D1.AUD_STEP_CD  /*감사기말단계*/
				                      , D1.EVL_RK_CD /*귀청보고평가등급*/
				                      , F_CODE_NM('1000279', D1.EVL_STEP_CD) AS EVL_STEP_NM
				                 	  , F_USR_INFO(D1.EVL_CMTR_CNB, '2') AS EVL_CMTR_NM
				                 	  , F_CODE_NM('1000274', D1.EVL_RK_CD) AS EVL_RK_NM
				                 	  , F_CODE_NM('1000280', D1.EVL_STA_CD) AS EVL_STA_NM
				                      , D1.EVL_OPIN /*귀청보고평가의견*/
				                  FROM TBCSPAOE029M D1
				                 WHERE D1.EVL_YR = #strEvlYr#
						           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
						           AND D1.TSK_DVSN_CD = '10000'
				                   AND D1.EVL_STEP_CD = '100'
				                   AND D1.EVL_CMTR_DVSN_CD = 'CD33' ) D2    /*귀청보고단계 평가등급 및 평가의견*/
	            ON D1.EVL_YR = D2.EVL_YR
               AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
               AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
               AND D1.AUD_TSK_KND_CD = D2.AUD_TSK_KND_CD
               AND D1.AUD_YR = D2.AUD_YR
               AND D1.TSK_NO = D2.TSK_NO
               ,TBBADDED001M D3
			WHERE 1 = 1
			  AND D1.EVL_YR = #strEvlYr#
			  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			  AND D1.AUD_YR = D3.AUD_YR(+)
   			AND D1.TSK_NO = D3.AUD_NO(+)
	    ]]>
		<isNotEmpty prepend="AND" property="strAudYr">
			D1.AUD_YR = #strAudYr#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			D1.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudKndCd">
			D1.AUD_TSK_KND_CD LIKE '%'||#strAudKndCd#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strTskNo">
			CASE WHEN LENGTH(#strTskNo#) = 3 AND D3.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D1.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			SUBSTR(D3.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strEvlStaCd">
			NVL(D1.EVL_STA_CD, '100') = #strEvlStaCd#
		</isNotEmpty>
		<![CDATA[    
			ORDER BY D1.AUD_TSK_KND_CD, D1.HNDL_DIV_DPT_CD
		]]>
	</select>

	<!-- 감사업무 평가관리-위원평가 데이터 조회 -->
	<select id="CSPAOE038EParamCntYSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE029M
			 WHERE 1=1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
  			   AND TSK_DVSN_CD = #TSK_DVSN_CD#
  			   AND EVL_STEP_CD = #EVL_STEP_CD#
  			   AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
  			   AND EVL_CMTR_DVSN_CD = #EVL_CMTR_DVSN_CD#
  			   AND AUD_TSK_KND_CD LIKE #AUD_TSK_KND_CD#
  			   AND AUD_YR = #AUD_YR#
			   AND TSK_NO = #TSK_NO#
		]]>
	</select>
	
	<!-- 감사업무 평가관리-위원평가 펴악지표 데이터 조회 -->
	<select id="CSPAOE038EParamSubCntYSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE030M
			 WHERE 1=1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
  			   AND TSK_DVSN_CD = #TSK_DVSN_CD#
  			   AND EVL_STEP_CD = #EVL_STEP_CD#
  			   AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
  			   AND AUD_TSK_KND_CD LIKE #AUD_TSK_KND_CD#
  			   AND AUD_YR = #AUD_YR#
			   AND TSK_NO = #TSK_NO#
		]]>
	</select>

	<!-- 감사업무 평가관리-위원평가 신규등록 -->
	<insert id="CSPAOE038EParamInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE029M
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, EVL_STEP_CD
			, EVL_CMTR_CNB
			, AUD_YR
			, TSK_NO
			, AUD_STEP_CD
			, EVL_CMTR_DVSN_CD
			, EVL_STA_CD
			, EVL_RK_CD
			, EVL_OPIN
			, SPE_ADP_CLU_CD
			, SPE_ADD_SC
			, SYT_EVL_RK_CD
			, SYT_EVL_ADVL_VAL
			, MDT_ASC
			, TSK_ASC
			, DRIVE_RTE_ASC
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #AUD_TSK_KND_CD#
			, #EVL_STEP_CD#
			, #EVL_CMTR_CNB#
			, #AUD_YR#
			, #TSK_NO#
			, '10010'
			, #EVL_CMTR_DVSN_CD#
			, #EVL_STA_CD#
			, #EVL_RK_CD#
			, #EVL_OPIN#
			, #SPE_ADP_CLU_CD#
			, #SPE_ADD_SC#
			, #SYT_EVL_RK_CD#
			, #SYT_EVL_ADVL_VAL#
			, #MDT_ASC#
			, #TSK_ASC#
			, #DRIVE_RTE_ASC#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사업무 평가관리-위원평가 저장 -->
	<update id="CSPAOE038EParamUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE029M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE038E'
			, AUD_STEP_CD = '10010'
			,SPE_ADP_CLU_CD = #SPE_ADP_CLU_CD#
			,SPE_ADD_SC = #SPE_ADD_SC#
		<isNotEmpty prepend="," property="EVL_STA_CD">
			EVL_STA_CD = #EVL_STA_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="EVL_OPIN">
			EVL_OPIN = #EVL_OPIN#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYT_EVL_RK_CD">
			SYT_EVL_RK_CD = #SYT_EVL_RK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYT_EVL_ADVL_VAL">
			SYT_EVL_ADVL_VAL = #SYT_EVL_ADVL_VAL#
		</isNotEmpty>
		<isNotEmpty prepend="," property="TSK_ASC">
			TSK_ASC = #TSK_ASC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="DRIVE_RTE_ASC">
			DRIVE_RTE_ASC = #DRIVE_RTE_ASC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="MDT_ASC">
			MDT_ASC = #MDT_ASC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD = #TSK_DVSN_CD#
		  AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		  AND EVL_STEP_CD = #EVL_STEP_CD#
		  AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
		  AND EVL_CMTR_DVSN_CD = #EVL_CMTR_DVSN_CD#
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
	</update>

	<!-- 감사업무 평가관리-위원평가 확정 -->
	<update id="CSPAOE038EEvlDtmYSubUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE029M
		   SET 
		   	   FNL_MDF_DH = SYSDATE
		   	 , FNL_MNU_ID = #FNL_MNU_ID#
			 , EVL_STA_CD = '300'
			 , EVL_DTM_YN = 'Y'
			<isNotEmpty prepend="," property="FNL_USR_ID">
				FNL_USR_ID = #FNL_USR_ID#
			</isNotEmpty>
			<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
				FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			</isNotEmpty>
		WHERE 1 = 1
		  AND EVL_YR = #EVL_YR#
		  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		  AND TSK_DVSN_CD = #TSK_DVSN_CD#
		  AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		  AND EVL_STEP_CD = #EVL_STEP_CD#
		  AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
		  AND AUD_STEP_CD = #AUD_STEP_CD#
		  AND EVL_CMTR_DVSN_CD = #EVL_CMTR_DVSN_CD#
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
	</update>

	<!-- 감사업무 평가관리-위원평가 확정시 개인별평점관리 데이터 조회 -->
	<select id="CSPAOE038EEvlDtmYPsnCntYSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE035M
			 WHERE 1=1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND AUD_YR = #AUD_YR#
  			   AND TSK_NO = #TSK_NO#
               AND NEVLT_CNB IN (  SELECT PTCPT_CNB
                                     FROM TBCSPAOE023M
                                    WHERE AUD_YR = #EVL_YR#
                                      AND TSK_NO = #TSK_NO#
                                      AND AUD_STEP_CD = #AUD_STEP_CD#  )
		]]>
	</select>

	<!-- 감사업무 평가관리-위원평가 확정시 개인별평점관리 데이터 신규등록 -->
	<insert id="CSPAOE038EEvlDtmYPsnInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE035M
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, AUD_YR
			, TSK_NO
			, NEVLT_CNB
			, EVLT_CNB
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, DPT_CD_1
			, DPT_CD
			, RANK_CD
			, PSN_TSK_ASC
			, SPRT_CVS_ASC
			, AUD_SPRT_ASC
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT D1.EVL_YR /*평가년도*/
			, D1.HLYR_DVSN_CD /*반기구분코드*/
			, D1.AUD_YR /*감사년도*/
			, D1.TSK_NO /*업무번호*/
			, D2.PTCPT_CNB AS NEVLT_CNB /*피평가자전산번호*/
			, D1.EVL_CMTR_CNB AS EVLT_CNB /*평가자전산번호*/
			, D1.TSK_DVSN_CD /*업무구분코드*/
			, D1.AUD_TSK_KND_CD /*감사업무종류코드*/
			, NVL(D3.HIRK_DPT_CD,D2.BLT_DPT_CD) AS DPT_CD_1 /*부서코드1*/
			, D2.BLT_DPT_CD AS DPT_CD /*부서코드*/
			, D2.RANK_CD /*직급코드*/
			, CASE WHEN d3.DPT_TP_CD = 'A'/*부서타입코드 : 감사부서(A), 지원부서(S), 퇴직자(E)*/ THEN ROUND((D1.TSK_ASC*D2.CTB_RTE)/100,2) ELSE 0 END PSN_TSK_ASC   /*개인업무평점*/
			, 0 AS SPRT_CVS_ASC /*지원환산평점*/
			, CASE WHEN d3.DPT_TP_CD = 'S'/*부서타입코드 : 감사부서(A), 지원부서(S), 퇴직자(E)*/ THEN ROUND((D1.TSK_ASC*D2.CTB_RTE)/100,2) ELSE 0 END AUD_SPRT_ASC  /*감사지원평점*/
			, D1.FNL_USR_ID
			, D1.FNL_USR_ID
			, D1.FNL_DEAL_DPT_CD
			, D1.FNL_MNU_ID
			, SYSDATE
			, SYSDATE
		FROM TBCSPAOE029M D1
			, TBCSPAOE023M D2
			, TBDCMACM002M D3
		WHERE D1.AUD_YR = D2.AUD_YR
		AND D1.TSK_NO = D2.TSK_NO
		AND D2.BLT_DPT_CD = D3.DPT_CD
		AND D1.EVL_YR = #EVL_YR#
		AND D1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND D1.TSK_DVSN_CD = #TSK_DVSN_CD#
		AND D1.AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		AND D1.EVL_STEP_CD = #EVL_STEP_CD#
		AND D2.AUD_YR = #AUD_YR#
		AND D2.TSK_NO = #TSK_NO#
		AND D2.AUD_STEP_CD = #AUD_STEP_CD#
	</insert>

	<!-- 감사업무 평가관리-위원평가 확정취소 -->
	<update id="CSPAOE038EEvlDtmNSubUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE029M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE038E'
			, EVL_STA_CD = '200'
			, EVL_DTM_YN = 'N'
		<isNotEmpty prepend="," property="SYT_EVL_RK_CD">
			SYT_EVL_RK_CD = #SYT_EVL_RK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SYT_EVL_ADVL_VAL">
			SYT_EVL_ADVL_VAL = #SYT_EVL_ADVL_VAL#
		</isNotEmpty>
		<isNotEmpty prepend="," property="TSK_ASC">
			TSK_ASC = #TSK_ASC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="DRIVE_RTE_ASC">
			DRIVE_RTE_ASC = #DRIVE_RTE_ASC#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_DVSN_CD = #TSK_DVSN_CD#
		AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		AND EVL_STEP_CD = #EVL_STEP_CD#
		AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
		AND EVL_CMTR_DVSN_CD = #EVL_CMTR_DVSN_CD#
		AND AUD_YR = #AUD_YR#
		AND TSK_NO = #TSK_NO#
	</update>

	<!-- 감사업무 평가관리-위원평가 확정 취소시 개인별평점관리 데이터 삭제 -->
	<delete id="CSPAOE038EEvlDtmNPsnDelete" parameterClass="paramMap">
		DELETE TBCSPAOE035M
		 WHERE 1=1
		   AND EVL_YR = #EVL_YR#
		   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		   AND AUD_YR = #AUD_YR#
		   AND TSK_NO = #TSK_NO#
		   AND NEVLT_CNB IN (
								SELECT PTCPT_CNB AS NEVLT_CNB
								  FROM TBCSPAOE023M
								 WHERE AUD_YR = #AUD_YR#
								   AND TSK_NO = #TSK_NO#
								   AND AUD_STEP_CD = ( SELECT MAX(AUD_STEP_CD)
														 FROM TBCSPAOE022M
														WHERE AUD_YR = #AUD_YR#
														  AND TSK_NO = #TSK_NO#
														  AND CMPT_DT IS NOT NULL )
						     )
	</delete>
	
	<!-- 감사업무 평가관리-위원평가 : 평가지표 데이터 삭제 -->
	<delete id="CSPAOE038EEvlDtmNDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE TBCSPAOE030M
			WHERE 1=1
			  AND EVL_YR = #EVL_YR#
			  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			  AND TSK_DVSN_CD = #TSK_DVSN_CD#
			  AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
			  AND EVL_STEP_CD = #EVL_STEP_CD#
			  AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
			  AND AUD_YR = #AUD_YR#
			  AND TSK_NO = #TSK_NO#
		  ]]>
	</delete>
	
	<!-- 감사업무 평가관리-위원평가 평가지표항목 조회 -->
	<select id="CSPAOE038EParamSubSelect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT D2.EVL_YR    /*평가년도*/
     			 , D2.HLYR_DVSN_CD  /*반기구분*/
     			 , NVL(D2.TSK_DVSN_CD,'10000') AS TSK_DVSN_CD  /*업무구분코드*/
     			 , D2.AUD_TSK_KND_CD    /*감사업무종류코드*/
     			 , NVL(D2.EVL_STEP_CD,'200') AS EVL_STEP_CD	/*평가단계코드(위원평가)*/
     			 , NVL(D1.EVL_CMTR_DVSN_CD,'CD34') AS EVL_CMTR_DVSN_CD	/*평가위원구분코드(위원평가)*/
     			 , D1.EVL_CMTR_CNB	/*평가자전산번호*/
     			 , D2.AUD_YR    /*감사년도*/
     			 , D2.TSK_NO    /*업무번호*/
     			 , D2.EVL_INDEX_CD	/*평가지표코드*/
     			 , D2.EVL_RK_CD	/*평가등급코드*/
     			 , D3.IDVT_INDEX_VAL  /*개별지표값*/
     			 , D6.WGT_RTE   /*비중*/
     			 , (D6.WGT_RTE/100) * D3.IDVT_INDEX_VAL AS CAL_IDVT_INDEX_VAL   /*비중*개별지표값*/
     			 , NVL(D1.SYT_EVL_ADVL_VAL,0) AS SYT_EVL_ADVL_VAL  /*종합평가가중치값*/
     			 , NVL((
								            SELECT D1.RK_CD
								            FROM(
								                    SELECT RK_CD
								                         , RANK() OVER(ORDER BY RK_CD DESC) AS RK_CD_RANK
								                      FROM TBCSPAOE010D
								                     WHERE 1=1
								                       AND EVL_YR = #strEvlYr#
								                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
								                       AND TSK_DVSN_CD = #strTskDvsnCd#
								                       AND ((
								                                    SELECT ROUND(AVG(D3.IDVT_INDEX_VAL),1) AS SYT_EVL_ADVL_VAL    /*종합평가가중치값*/
								                                      FROM TBCSPAOE030M D2
								                                           LEFT JOIN TBCSPAOE010D D3
								                                                  ON D2.EVL_YR = D3.EVL_YR 
								                                                 AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
								                                                 AND D2.TSK_DVSN_CD = D3.TSK_DVSN_CD
								                                                 AND D2.AUD_TSK_KND_CD = D3.AUD_TSK_KND_CD
								                                                 AND D2.EVL_RK_CD = D3.RK_CD
								                                     WHERE 1=1
								                                       AND D2.EVL_STEP_CD = #strEvlStepCd#
								                                       AND D2.TSK_DVSN_CD = #strTskDvsnCd#
								                                       AND D2.EVL_CMTR_CNB = #strEvlCmtrCnb#
								                                       AND D2.EVL_YR = #strEvlYr#
								                                       AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
								                                )) <= TO_NUMBER(ROUND(SUM_INDEX_VAL,1))
								                       AND AUD_TSK_KND_CD = #strAudKndCd#
								                ) D1
								            WHERE D1.RK_CD_RANK = 1
								      ),0) AS SYT_EVL_RK_CD   /*종합평가등급코드*/
			    , (F_CODE_NM('1000274', D1.SYT_EVL_RK_CD)) || '(' || TO_CHAR((NVL(D1.SYT_EVL_ADVL_VAL, 0))) || ')' AS SYT_EVL_RT	/*종합평가등급(성과가중치합계지표)*/
			    , NVL(D5.TSK_ASC, 0) AS TSK_ASC    /*업무평점*/
			    , NVL(D5.DRIVE_RTE_ASC, 0) AS DRIVE_RTE_ASC /*추진율평점*/
			  FROM TBCSPAOE002M d6
			     , TBCSPAOE029M D1
     			   LEFT JOIN TBCSPAOE030M D2
            			  ON D1.EVL_YR = D2.EVL_YR
           				 AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
           				 AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
           			 	 AND D1.AUD_TSK_KND_CD = D2.AUD_TSK_KND_CD
           			 	 AND D1.EVL_STEP_CD = D2.EVL_STEP_CD
           			 	 AND D1.EVL_CMTR_CNB = D2.EVL_CMTR_CNB
           			 	 AND D1.AUD_YR = D2.AUD_YR
           				 AND D1.TSK_NO = D2.TSK_NO
           		   LEFT JOIN TBCSPAOE010D D3
              			  ON D2.EVL_YR = D3.EVL_YR 
             			 AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
             			 AND D2.TSK_DVSN_CD = D3.TSK_DVSN_CD
             			 AND D2.AUD_TSK_KND_CD = D3.AUD_TSK_KND_CD
             			 AND D2.EVL_RK_CD = D3.RK_CD
                 , (
			            SELECT ROUND(sum(((d6.WGT_RTE/100) * d3.IDVT_INDEX_VAL)), 1) AS SYT_EVL_ADVL_VAL
			              FROM TBCSPAOE002M D6
			                 , TBCSPAOE030M D2
			                   LEFT JOIN TBCSPAOE010D D3
			                          ON D2.EVL_YR = D3.EVL_YR 
			                         AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
			                         AND D2.TSK_DVSN_CD = D3.TSK_DVSN_CD
			                         AND D2.AUD_TSK_KND_CD = D3.AUD_TSK_KND_CD
			                         AND D2.EVL_RK_CD = D3.RK_CD
			             WHERE 1=1
			               AND D6.EVL_YR = D2.EVL_YR
                   		   AND D6.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                           AND D6.EVL_INDEX_CD = D2.EVL_INDEX_CD
                   		   AND D2.EVL_STEP_CD = #strEvlStepCd#
			               AND D2.TSK_DVSN_CD = #strTskDvsnCd#
			               AND D2.EVL_CMTR_CNB = #strEvlCmtrCnb#
			               AND D2.EVL_YR = #strEvlYr#
			               AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			       ) D4   /*종합평가가중치값*/
			     , (
				        SELECT CASE WHEN D1.AUD_STEP_YN = 'N' AND (D1.CNT_YN = '1' OR D1.CNT_YN = '2') THEN  NVL(ROUND(D1.CD01111*D2.CD012*D9.CD013, 2), 0) ELSE NVL(ROUND(D1.RTE_ASC, 2), 0) END AS DRIVE_RTE_ASC ,
				               CASE WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN NVL(ROUND(D1.RTE_ASC1 - (D1.RTE_ASC2*D4.CD014) + D5.CD015 + D6.CD016, 2), 0)
				               ELSE NVL(ROUND(F_TSK_ASC_SUM(#strTskDvsnCd#, D7.FML_TXT, D1.CD011, D2.CD012, D3.CD013, D1.CD0111*D2.CD012*D3.CD013*D4.CD014, D5.CD015, D6.CD016), 2), 0) END AS TSK_ASC
						  FROM (
				                        SELECT D1.AUD_STEP_YN
                     						 , D1.CNT_YN     
                     						 , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
                                				CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
                                     					  NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
	                                				 ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
                                				END
                           							when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then
                                						 NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                            end, 2) cd011
                    , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                                
                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then
                                NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                            end, 2) cd0111
                    , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                                
                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then
                                NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                            end, 2) cd01111
                    , CASE when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then
                             nvl(D1.AUD_STEP_ST_DRIVE_RTE,0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT),0) * A.SYT_EVL_ADVL_VAL +
                             CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE,0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT),0) * A.SYT_EVL_ADVL_VAL
                                  ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE,0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT),0) * A.SYT_EVL_ADVL_VAL
                             end
                      END AS RTE_ASC
                    , CASE when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then
                             nvl(D1.AUD_STEP_ST_DRIVE_RTE,0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT),0) * A.SYT_EVL_ADVL_VAL +
                             CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE,0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT),0) * A.SYT_EVL_ADVL_VAL
                                  ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE,0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT),0) * A.SYT_EVL_ADVL_VAL
                             end
                      END AS RTE_ASC1
                    , CASE when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then
                             nvl(D1.AUD_STEP_ST_DRIVE_RTE,0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT),0) * A.SYT_EVL_ADVL_VAL +
                             CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE,0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT),0) * A.SYT_EVL_ADVL_VAL
                                  ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE,0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT),0) * A.SYT_EVL_ADVL_VAL
                             end
                      END AS RTE_ASC2
                FROM(
                        SELECT D2.EVL_YR ,
                                               D2.HLYR_DVSN_CD ,
                                               D2.AUD_KND_CD ,
                                               D2.STND_ASC_FML_TXT ,    /*국단장 이전 표준평점수식*/
                                               D2.SYT_TRTM_STND_ASC_FML_TXT,    /*심의실 이후 종합처리안 표준평점수식*/
                                               D2.IDVT_TRTM_STND_ASC_FML_TXT    /*심의실 이후 개별처리안 표준평점수식*/
                                          FROM TBCSPAOE004M D1 ,
                                               TBCSPAOE044M D2
                                         WHERE D1.EVL_YR = D2.EVL_YR
                                           AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                                           AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
                                           AND D1.AUD_KND_CD = D2.AUD_KND_CD
                                           AND D1.EVL_YR = #strEvlYr#
                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                           AND D1.AUD_KND_CD = #strAudKndCd#
                                           AND (SELECT MNDY_CNT
                                                  FROM TBCSPAOE021M
                                                 WHERE AUD_YR = #strAudYr#
                                                   AND TSK_NO = #strTskNo#) BETWEEN D2.MNDY_CNT_1 AND D2.MNDY_CNT_2 
                      ) D2  /*표준평점 수식*/
                     ,(   
                            SELECT D1.AUD_STEP_YN   /*감사기초단계 ~ 감사기말단계에서 심의실 포함 여부*/
                                 , CASE WHEN D2.AUD_STEP_END_DRIVE_RTE = 0 THEN '2' /*감사단장 이전*/
                                        WHEN D2.AUD_STEP_ST_DRIVE_RTE = 0 THEN '1' /*심의실 이후*/                                    
                                   ELSE '3' END AS CNT_YN   /*심의실 포함*/
                                 , CASE WHEN D1.AUD_STEP_YN = 'Y' THEN D2.AUD_STEP_ST_DRIVE_RTE ELSE D3.AUD_STEP_ST_DRIVE_RTE END AS AUD_STEP_ST_DRIVE_RTE  /*감사단장 이전 추진율*/
                                 , CASE WHEN D1.AUD_STEP_YN = 'N' THEN D3.AUD_STEP_END_DRIVE_RTE ELSE D2.AUD_STEP_END_DRIVE_RTE END AS AUD_STEP_END_DRIVE_RTE   /*심의실 이후 추진율*/
                            FROM (
                                                SELECT CASE WHEN COUNT(*) = 1 THEN 'Y' ELSE 'N' END AS AUD_STEP_YN
                                                        FROM (
                                                                                SELECT MIN(AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       AUD_YR ,
                                                                                       TSK_NO 
                                                                                  FROM TBCSPAOE022M
                                                                                 WHERE LUNH_DT IS NOT NULL
                                                                                   AND CMPT_DT IS NOT NULL
                                                                                   AND AUD_YR = #strAudYr#
                                                                                   AND TSK_NO = #strTskNo#
                                                                                   AND (LUNH_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                        AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                         OR CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                        AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                                 GROUP BY AUD_YR, TSK_NO
                                                            ) D1
                                                        WHERE '10006' BETWEEN D1.AUD_STEP_ST_CD AND D1.AUD_STEP_END_CD
                            ) D1
                            , (
                                    /*심의실 포함한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                                    SELECT D1.AUD_STEP_ST_DRIVE_RTE
                                         , D2.AUD_STEP_END_DRIVE_RTE
                                    FROM
                                    (
                                                                /*감사기초단계 ~ 감사기말단계에서 심의실 포함하고 감사단장 이전에 대한 추진율 구하는 쿼리*/
                                                                SELECT NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_ST_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.LUNH_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                       AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                        OR D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                             GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND '10006' BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND '10005'
                                           ) D1
                                         , (
                                                                /*감사기초단계 ~ 감사기말단계에서 심의실 포함하고 심의실 이후에 대한 추진율 구하는 쿼리*/
                                                                SELECT NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.LUNH_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                       AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                        OR D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND '10006' BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                                                           AND D1.AUD_STEP_CD BETWEEN '10006' AND D2.AUD_STEP_END_CD
                                           ) D2
                              ) D2  /*심의실 포함한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                            , (
                                    /*심의실 포함 안 한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                                    SELECT CASE WHEN (D3.AUD_STEP_ST_CD <= '10005' AND D3.AUD_STEP_END_CD <= '10005') THEN D2.AUD_STEP_ST_DRIVE_RTE ELSE D1.AUD_STEP_ST_DRIVE_RTE END AS AUD_STEP_ST_DRIVE_RTE
                                         , CASE WHEN (D3.AUD_STEP_ST_CD >= '10006' AND D3.AUD_STEP_END_CD >= '10006') THEN D1.AUD_STEP_END_DRIVE_RTE ELSE D2.AUD_STEP_END_DRIVE_RTE END AS AUD_STEP_END_DRIVE_RTE
                                    FROM (
                                    /*감사기초단계 ~ 감사기말단계에서 심의실 포함 안하고 심의실 이후에 대한 추진율 구하는 쿼리*/
                                    SELECT 0 AS AUD_STEP_ST_DRIVE_RTE
                                         , NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.LUNH_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                       AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                        OR D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND (D2.AUD_STEP_ST_CD >= '10006' AND D2.AUD_STEP_END_CD >= '10006')
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                            ) D1
                            , (
                                    /*감사기초단계 ~ 감사기말단계에서 심의실 포함 안하고 감사단장 이전에 대한 추진율 구하는 쿼리*/
                                    SELECT NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_ST_DRIVE_RTE
                                         , 0 AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.LUNH_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                       AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                        OR D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND (D2.AUD_STEP_ST_CD <= '10005' AND D2.AUD_STEP_END_CD <= '10005')
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                    ) D2
                                    , (
                                             SELECT MIN(AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                               MAX(AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                               AUD_YR ,
                                                                                               TSK_NO 
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE LUNH_DT IS NOT NULL
                                                                                           AND CMPT_DT IS NOT NULL
                                                                                           AND AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND (LUNH_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                                AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                 OR CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                                AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                                         GROUP BY AUD_YR, TSK_NO
                                    ) D3
                              ) D3  /*심의실 포함 안 한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                      ) D1  /*감사단장 이전 추진율 및 심의실 이후 추진율*/
                  , (SELECT DISTINCT SYT_TRTM_YN FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#) D3
                  , (SELECT MNDY_CNT FROM TBCSPAOE021M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#) D4
                  , (SELECT SYT_EVL_ADVL_VAL FROM TBCSPAOE029M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd# AND TSK_DVSN_CD = #strTskDvsnCd# AND AUD_TSK_KND_CD = #strAudKndCd# AND EVL_STEP_CD = #strEvlStepCd# AND EVL_CMTR_DVSN_CD = 'CD34' AND AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#) A
               
				                 ) D1    /*감사종류별 표준평점*/
				               , (
				                    SELECT SYT_EVL_ADVL_VAL AS CD012
				                      FROM TBCSPAOE029M
				                     WHERE EVL_YR = #strEvlYr#
				                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				                       AND TSK_DVSN_CD = #strTskDvsnCd#
				                       AND AUD_TSK_KND_CD = #strAudKndCd#
				                       AND EVL_STEP_CD = #strEvlStepCd#
				                       AND AUD_YR = #strAudYr#
				                       AND TSK_NO = #strTskNo#
				                 ) D2    /*평가등급별 가중치*/
				               , (
				                    SELECT SUM(D1.DRIVE_RTE)/100 AS CD013
				                      FROM TBCSPAOE008D D1,
				                           (
				                                SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD
				                                     , MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD
				                                     , D1.AUD_YR
                                                     , D2.AUD_KND_CD
				                                  FROM TBCSPAOE022M D1
				                                       LEFT JOIN TBCSPAOE021M D2
				                                              ON D1.AUD_YR = D2.AUD_YR
				                                             AND D1.TSK_NO = D2.TSK_NO
				                                 WHERE D1.LUNH_DT IS NOT NULL
						                           AND D1.CMPT_DT IS NOT NULL
						                           AND D1.AUD_YR = #strAudYr#
				                                   AND D1.TSK_NO = #strTskNo#
				                                   AND ( D1.LUNH_DT BETWEEN (select EVL_STR_DT
															                   from TBCSPAOE001M
															                  where EVL_YR = #strEvlYr#
															                    and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
																							                    from TBCSPAOE001M
																							                   where EVL_YR = #strEvlYr#
																							                    and HLYR_DVSN_CD = #strHlyrDvsnCd#)
												      OR D1.CMPT_DT BETWEEN (select EVL_STR_DT
															                   from TBCSPAOE001M
															                  where EVL_YR = #strEvlYr#
															                    and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
																								                from TBCSPAOE001M
																								               where EVL_YR = #strEvlYr#
																								                 and HLYR_DVSN_CD = #strHlyrDvsnCd#))
											  GROUP BY D1.AUD_YR, D2.AUD_KND_CD
				                           ) D2
				                     WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                       AND D1.EVL_YR = #strEvlYr#
				                       AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
				                       AND D1.TSK_DVSN_CD = #strTskDvsnCd#
				                       AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
				                 ) D3    /*감사단계별 추진율*/
				               , (
				                    SELECT SUM(D1.DRIVE_RTE)/100 AS CD013
				                      FROM TBCSPAOE008D D1,
				                           (
				                                SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD
				                                     , MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD
				                                     , D1.AUD_YR
                                                     , D2.AUD_KND_CD
				                                  FROM TBCSPAOE022M D1
				                                       LEFT JOIN TBCSPAOE021M D2
				                                              ON D1.AUD_YR = D2.AUD_YR
				                                             AND D1.TSK_NO = D2.TSK_NO
				                                 WHERE D1.LUNH_DT IS NOT NULL
						                           AND D1.CMPT_DT IS NOT NULL
						                           AND D1.AUD_YR = #strAudYr#
				                                   AND D1.TSK_NO = #strTskNo#
				                                   AND ( D1.LUNH_DT BETWEEN (select EVL_STR_DT
															                   from TBCSPAOE001M
															                  where EVL_YR = #strEvlYr#
															                    and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
																							                    from TBCSPAOE001M
																							                   where EVL_YR = #strEvlYr#
																							                    and HLYR_DVSN_CD = #strHlyrDvsnCd#)
												      OR D1.CMPT_DT BETWEEN (select EVL_STR_DT
															                   from TBCSPAOE001M
															                  where EVL_YR = #strEvlYr#
															                    and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
																								                from TBCSPAOE001M
																								               where EVL_YR = #strEvlYr#
																								                 and HLYR_DVSN_CD = #strHlyrDvsnCd#))
											  GROUP BY D1.AUD_YR, D2.AUD_KND_CD
				                           ) D2
				                     WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                       AND D1.EVL_YR = #strEvlYr#
				                       AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
				                       AND D1.TSK_DVSN_CD = #strTskDvsnCd#
				                       AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
				                 ) D9    /*감사단계별 추진율*/
				               , (
				                    SELECT CASE WHEN (SELECT COUNT(*)
									                    FROM TBCSPAOE012M
									                   WHERE EVL_YR = #strEvlYr#
									                     AND HLYR_DVSN_CD = #strHlyrDvsnCd#
									                     AND DLAY_DT_NM = (SELECT SUM(DLAY_DT_NM)
									                                         FROM TBCSPAOE022M
									                                        WHERE AUD_YR = #strAudYr#
									                                          AND TSK_NO = #strTskNo#
									                                          AND (LUNH_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                                AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                 OR CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                                AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))  ) ) > 0 THEN (SELECT CASE WHEN HNDL_PRD_DVSN_CD = '100' THEN NVL(ASP_RTE/100, '0') ELSE -NVL(ASP_RTE/100, '0') END AS CD014
									                                                                                         FROM TBCSPAOE012M
									                                                                                        WHERE EVL_YR = #strEvlYr#
									                                                                                          AND HLYR_DVSN_CD = #strHlyrDvsnCd#
									                                                                                          AND DLAY_DT_NM = (SELECT SUM(DLAY_DT_NM)
									                                                                                                              FROM TBCSPAOE022M
									                                                                                                             WHERE AUD_YR = #strAudYr#
									                                                                                                               AND TSK_NO = #strTskNo#
									                                                                                                               AND (LUNH_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
													                                                                                                                AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
													                                                                                                 OR CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
													                                                                                                                AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))  ) )
									         ELSE 0
									       END AS CD014
									  FROM DUAL
				                 ) D4  /*조기지연처리 가감점*/
				               , (
				                    SELECT NVL(SPE_ADD_SC,0) AS CD015
				                      FROM TBCSPAOE029M
				                     WHERE EVL_YR = #strEvlYr#
				                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				                       AND TSK_DVSN_CD = #strTskDvsnCd#
				                       AND AUD_TSK_KND_CD = #strAudKndCd#
				                       AND EVL_STEP_CD = #strEvlStepCd#
				                       AND AUD_YR = #strAudYr#
				                       AND TSK_NO = #strTskNo#
				                 ) D5    /*특별가산점*/
				               , (
				                    SELECT ROUND(NVL(MDT_ASC,0),2) AS CD016
				                      FROM TBCSPAOE029M
				                     WHERE EVL_YR = #strEvlYr#
				                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				                       AND TSK_DVSN_CD = #strTskDvsnCd#
				                       AND AUD_TSK_KND_CD = #strAudKndCd#
				                       AND EVL_STEP_CD = #strEvlStepCd#
				                       AND AUD_YR = #strAudYr#
				                       AND TSK_NO = #strTskNo#
				                 ) D6    /*평점조정*/
				               , (
				                    SELECT FML_TXT
				                      FROM TBCSPAOE013M
				                     WHERE EVL_YR = #strEvlYr#
				                       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				                       AND TSK_DVSN_CD = #strTskDvsnCd#
				                 ) D7   /*감사업무 업무평점 수식*/
				   ) D5
			WHERE 1=1
			  AND D6.EVL_YR = D2.EVL_YR
			  AND D6.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			  AND D6.EVL_INDEX_CD = D2.EVL_INDEX_CD
			  AND D2.EVL_STEP_CD = #strEvlStepCd#
			  AND D2.TSK_DVSN_CD = #strTskDvsnCd#
			  AND D2.EVL_CMTR_CNB = #strEvlCmtrCnb#
			  AND D1.EVL_YR = #strEvlYr#
			  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
	          AND D1.AUD_TSK_KND_CD = #strAudKndCd#
	          AND D1.AUD_YR = #strAudYr#
		      AND D1.TSK_NO = #strTskNo#
		]]>
	</select>

	<!-- 감사업무 평가관리-위원평가 평가지표항목 데이터 조회 -->
	<select id="CSPAOE038EParamSubCntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE030M
			 WHERE 1=1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
  			   AND TSK_DVSN_CD = #TSK_DVSN_CD#
  			   AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
  			   AND EVL_STEP_CD = #EVL_STEP_CD#
  			   AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
  			   AND TSK_NO = #TSK_NO#
  			   AND EVL_INDEX_CD = #EVL_INDEX_CD#
		]]>
	</select>

	<!-- 감사업무 퍙가관리-위원평가 평가지표항목 신규등록 -->
	<insert id="CSPAOE038EParamSubInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE030M
		(
			EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, EVL_STEP_CD
			, EVL_CMTR_CNB
			, AUD_YR
			, TSK_NO
			, EVL_INDEX_CD
			, EVL_RK_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #AUD_TSK_KND_CD#
			, #EVL_STEP_CD#
			, #EVL_CMTR_CNB#
			, #AUD_YR#
			, #TSK_NO#
			, #EVL_INDEX_CD#
			, #EVL_RK_CD#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사업무 평가관리-위원평가 평가지표항목 저장 -->
	<update id="CSPAOE038EParamSubUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE030M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE038E'
		<isNotEmpty prepend="," property="EVL_RK_CD">
			EVL_RK_CD = #EVL_RK_CD#
		</isNotEmpty>
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_DVSN_CD = #TSK_DVSN_CD#
		AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		AND EVL_STEP_CD = #EVL_STEP_CD#
		AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
		AND TSK_NO = #TSK_NO#
		AND EVL_INDEX_CD = #EVL_INDEX_CD#
	</update>

	<!-- 감사업무 평가관리-위원평가 종합평가등급, 성과가중치 합계지표, 업무평점, 표준평점 저장 -->
	<update id="CSPAOE038EParamSytEvlRtUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE029M
		SET 
			FNL_MDF_DH = SYSDATE
			, FNL_MNU_ID = 'CSPAOE038E'
			, SYT_EVL_ADVL_VAL = #SYT_EVL_ADVL_VAL#
			, SYT_EVL_RK_CD = #SYT_EVL_RK_CD#
			, TSK_ASC = #TSK_ASC#
			, DRIVE_RTE_ASC = #DRIVE_RTE_ASC#
		WHERE 1 = 1
		AND EVL_YR = #EVL_YR#
		AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
		AND TSK_DVSN_CD = #TSK_DVSN_CD#
		AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
		AND EVL_STEP_CD = #EVL_STEP_CD#
		AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
		AND EVL_CMTR_DVSN_CD = #EVL_CMTR_DVSN_CD#
		AND TSK_NO = #TSK_NO#
	</update>

	<!-- 감사업무 평가관리-위원평가 평가지표항목 삭제 -->
	<delete id="CSPAOE038EParamSubDelete" parameterClass="paramMap">
		<![CDATA[ 
			DELETE TBCSPAOE030M
			 WHERE 1 = 1
			   AND EVL_YR = #EVL_YR#
			   AND HLYR_DVSN_CD = #HLYR_DVSN_CD#
			   AND TSK_DVSN_CD = #TSK_DVSN_CD#
			   AND AUD_TSK_KND_CD = #AUD_TSK_KND_CD#
			   AND EVL_STEP_CD = #EVL_STEP_CD#
			   AND EVL_CMTR_CNB = #EVL_CMTR_CNB#
			   AND TSK_NO = #TSK_NO#
			   AND EVL_INDEX_CD = #EVL_INDEX_CD#
		]]>
	</delete>

	<!-- 감사업무 평가관리-위원평가 : 특별가산점 조회 -->
	<select id="CSPAOE038ECluScSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CLU_SC
		      FROM TBCSPAOE011M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND CLU_CD = #strCluCd#
		]]>
	</select>

	<!-- 감사업무 평가관리-위원평가 : 평가등급 개별지표값 조회 -->
	<select id="CSPAOE038EIdvtIndexValSelect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
			SELECT IDVT_INDEX_VAL
			  FROM TBCSPAOE010D
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = #strTskDvsnCd#
			   AND AUD_TSK_KND_CD = #strAudKndCd#
			   AND RK_CD = #strRkCd#
		]]>
	</select>

	<!-- 감사업무 평가관리-위원평가 : 종합평가등급 조회 -->
	<select id="CSPAOE038ESytEvlRkCdSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.RK_CD AS SYT_EVL_RK_CD
			     , F_CODE_NM('1000274', D1.RK_CD) AS SYT_EVL_RK_NM 
			  FROM (
					  SELECT RK_CD
		         		   , RANK() OVER(ORDER BY IDVT_INDEX_VAL ASC) AS RK_CD_RANK
					    FROM TBCSPAOE010D
					   WHERE EVL_YR = #strEvlYr#
					     AND HLYR_DVSN_CD = #strHlyrDvsnCd#
					     AND TSK_DVSN_CD = #strTskDvsnCd#
					     AND AUD_TSK_KND_CD = #strAudKndCd#
					     AND #strIdvtIndexVal# <= TO_NUMBER(ROUND(SUM_INDEX_VAL, 1))
				   ) D1
			 WHERE D1.RK_CD_RANK = 1
		]]>
	</select>

	<!-- 감사업무 평가관리-귀청보고평가 : 업무평점 조회 -->
	<select id="CSPAOE038ETskAsc1Select" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CASE WHEN D1.AUD_STEP_YN = 'N' AND (D1.CNT_YN = '1' OR D1.CNT_YN = '2') THEN  NVL(ROUND(D1.CD01111 * #strIdvtIndexVal# * D9.CD013, 2), 0) ELSE NVL(ROUND(D1.RTE_ASC, 2), 0) END AS DRIVE_RTE_ASC	/*추진율조정평점*/
                 , case when instr(d4.CD014, '-') = 0 then	/*조기가점 처리일 경우*/
				         CASE WHEN D12.AUD_STEP_END_CD < '10004' THEN /*단계기말이 귀청보고 미만이면, 기준등급의 가중치 이상일 때 가점처리한다. */
				                       CASE
				                         WHEN ROUND(#strIdvtIndexVal#, 2) >= D10.IDVT_INDEX_VAL THEN nvl(round(d1.RTE_ASC1 + (D1.CD0111*ROUND(#strIdvtIndexVal#, 2)*D3.CD013*D4.CD014) + 0 + 0 , 2), 0)
				                         else nvl(round(d1.RTE_ASC2 + 0 + 0 + 0 , 2), 0)
				                       END
				              WHEN D12.AUD_STEP_END_CD >= '10004' THEN /*단계기말이 귀청보고 이상이면, 기준등급의 가중치 초과일 때 가점처리한다.*/
				                       CASE
				                         WHEN ROUND(#strIdvtIndexVal#, 2) <= D10.IDVT_INDEX_VAL THEN nvl(round(d1.RTE_ASC3 + 0 + 0 + 0 , 2), 0)
				                         else nvl(round(d1.RTE_ASC4 + (d1.RTE_ASC4*D4.CD014) + 0 + 0 , 2), 0)
				                       END
				              end
				             when instr(d4.CD014, '-') = 1 then	/*지연감점 처리일 경우*/
				             									nvl(round(d1.RTE_ASC5 + (d1.RTE_ASC5*D4.CD014) + 0 + 0 , 2), 0)
				  end AS TSK_ASC /*업무평점 = 추진율조정평점 + 가감평점 + 특별가산점 + 평점조정*/
			  FROM (
                    SELECT D1.AUD_STEP_YN
                     , D1.CNT_YN     
                     , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
														                                END
                                  when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                                  WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                                  WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                            end, 2) cd011	/*표준평점*/
                    , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
														                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                            end, 2) cd0111	/*표준평점*/
                    , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
														                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                            end, 2) cd01111	/*표준평점*/
                   , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
														                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                            end, 2) cd011111	/*표준평점*/
                   , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
														                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                            end, 2) cd0111111	/*표준평점*/
                   , CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                       END AS RTE_ASC /*추진율조정평점*/,
                       CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                       END AS RTE_ASC1 /*추진율조정평점*/,
                       CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                       END AS RTE_ASC2 /*추진율조정평점*/,
                       CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                       END AS RTE_ASC3 /*추진율조정평점*/,
                       CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                       END AS RTE_ASC4 /*추진율조정평점*/,
                       CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                             CASE
                               WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                               ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                             end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                       END AS RTE_ASC5 /*추진율조정평점*/
                FROM(
                        SELECT D2.EVL_YR ,
                                               D2.HLYR_DVSN_CD ,
                                               D2.AUD_KND_CD ,
                                               D2.STND_ASC_FML_TXT ,    /*국단장 이전 표준평점수식*/
                                               D2.SYT_TRTM_STND_ASC_FML_TXT,    /*심의실 이후 종합처리안 표준평점수식*/
                                               D2.IDVT_TRTM_STND_ASC_FML_TXT    /*심의실 이후 개별처리안 표준평점수식*/
                                          FROM TBCSPAOE004M D1 ,
                                               TBCSPAOE044M D2
                                         WHERE D1.EVL_YR = D2.EVL_YR
                                           AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                                           AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
                                           AND D1.AUD_KND_CD = D2.AUD_KND_CD
                                           AND D1.EVL_YR = #strEvlYr#
                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                           AND D1.AUD_KND_CD = #strAudKndCd#
                                           AND (	SELECT MNDY_CNT
                                               		FROM TBCSPAOE021M
                                              		WHERE AUD_YR = #strAudYr#
                                                	AND TSK_NO = #strTskNo# ) BETWEEN D2.MNDY_CNT_1 AND D2.MNDY_CNT_2 
                      ) D2  /*표준평점 수식*/
                     ,(   
                            SELECT D1.AUD_STEP_YN   /*감사기초단계 ~ 감사기말단계에서 심의실 포함 여부*/
                                 , CASE WHEN D2.AUD_STEP_END_DRIVE_RTE = 0 THEN '2' /*감사단장 이전*/
                                        WHEN D2.AUD_STEP_ST_DRIVE_RTE = 0 THEN '1' /*심의실 이후*/
                                   ELSE '3' END AS CNT_YN   /*심의실 포함*/
                                 , CASE WHEN D1.AUD_STEP_YN = 'Y' THEN D2.AUD_STEP_ST_DRIVE_RTE ELSE D3.AUD_STEP_ST_DRIVE_RTE END AS AUD_STEP_ST_DRIVE_RTE  /*감사단장 이전 추진율*/
                                 , CASE WHEN D1.AUD_STEP_YN = 'N' THEN D3.AUD_STEP_END_DRIVE_RTE ELSE D2.AUD_STEP_END_DRIVE_RTE END AS AUD_STEP_END_DRIVE_RTE   /*심의실 이후 추진율*/
                            FROM (
                                                SELECT CASE WHEN COUNT(*) = 1 THEN 'Y' ELSE 'N' END AS AUD_STEP_YN
                                                        FROM (
                                                                                SELECT MIN(AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       AUD_YR ,
                                                                                       TSK_NO 
                                                                                  FROM TBCSPAOE022M
                                                                                 WHERE LUNH_DT IS NOT NULL
                                                                                   AND CMPT_DT IS NOT NULL
                                                                                   AND AUD_YR = #strAudYr#
                                                                                   AND TSK_NO = #strTskNo#
                                                                                   AND (CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                        AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                                 GROUP BY AUD_YR, TSK_NO
                                                            ) D1
                                                        WHERE '10006' BETWEEN D1.AUD_STEP_ST_CD AND D1.AUD_STEP_END_CD
                            ) D1
                            , (
                                    /*심의실 포함한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                                    SELECT D1.AUD_STEP_ST_DRIVE_RTE
                                         , D2.AUD_STEP_END_DRIVE_RTE
                                    FROM
                                    (
                                                                /*감사기초단계 ~ 감사기말단계에서 심의실 포함하고 감사단장 이전에 대한 추진율 구하는 쿼리*/
                                                                SELECT NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_ST_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                             GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND '10006' BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND '10005'
                                           ) D1
                                         , (
                                                                /*감사기초단계 ~ 감사기말단계에서 심의실 포함하고 심의실 이후에 대한 추진율 구하는 쿼리*/
                                                                SELECT NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND '10006' BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                                                           AND D1.AUD_STEP_CD BETWEEN '10006' AND D2.AUD_STEP_END_CD
                                           ) D2
                              ) D2  /*심의실 포함한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                            , (
                                    /*심의실 포함 안 한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                                    SELECT CASE WHEN (D3.AUD_STEP_ST_CD <= '10005' AND D3.AUD_STEP_END_CD <= '10005') THEN D2.AUD_STEP_ST_DRIVE_RTE ELSE D1.AUD_STEP_ST_DRIVE_RTE END AS AUD_STEP_ST_DRIVE_RTE
                                         , CASE WHEN (D3.AUD_STEP_ST_CD >= '10006' AND D3.AUD_STEP_END_CD >= '10006') THEN D1.AUD_STEP_END_DRIVE_RTE ELSE D2.AUD_STEP_END_DRIVE_RTE END AS AUD_STEP_END_DRIVE_RTE
                                    FROM (
                                    /*감사기초단계 ~ 감사기말단계에서 심의실 포함 안하고 심의실 이후에 대한 추진율 구하는 쿼리*/
                                    SELECT 0 AS AUD_STEP_ST_DRIVE_RTE
                                         , NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND (D2.AUD_STEP_ST_CD >= '10006' AND D2.AUD_STEP_END_CD >= '10006')
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                            ) D1
                            , (
                                    /*감사기초단계 ~ 감사기말단계에서 심의실 포함 안하고 감사단장 이전에 대한 추진율 구하는 쿼리*/
                                    SELECT NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_ST_DRIVE_RTE
                                         , 0 AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND (D2.AUD_STEP_ST_CD <= '10005' AND D2.AUD_STEP_END_CD <= '10005')
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                    ) D2
                                    , (
                                             SELECT MIN(AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                               MAX(AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                               AUD_YR ,
                                                                                               TSK_NO 
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE LUNH_DT IS NOT NULL
                                                                                           AND CMPT_DT IS NOT NULL
                                                                                           AND AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND (CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                                AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                                         GROUP BY AUD_YR, TSK_NO
                                    ) D3
                              ) D3  /*심의실 포함 안 한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                      ) D1  /*감사단장 이전 추진율 및 심의실 이후 추진율*/
                  , (SELECT DISTINCT NVL(SYT_TRTM_YN, 'N') AS SYT_TRTM_YN FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#) D3
                  , (SELECT MNDY_CNT FROM TBCSPAOE021M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#) D4
                   ) D1 /*감사종류별 표준평점*/,
			       (SELECT SUM(D1.DRIVE_RTE)/100 AS CD013
			          FROM TBCSPAOE008D D1,
			               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
			                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
			                       D1.AUD_YR ,
			                       D2.AUD_KND_CD
			                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
			                   AND D1.TSK_NO = D2.TSK_NO
			                 WHERE D1.AUD_YR = #strAudYr#
			                   AND D1.TSK_NO = #strTskNo#
			                   AND D1.CMPT_DT IS NOT NULL
			                   AND ( D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
			                 GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
			         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
			           AND D1.EVL_YR = #strEvlYr#
			           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
			           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD ) D3 /*감사단계별 추진율*/,
			       (SELECT SUM(D1.DRIVE_RTE)/100 AS CD013
			          FROM TBCSPAOE008D D1,
			               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
			                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
			                       D1.AUD_YR ,
			                       D2.AUD_KND_CD
			                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
			                   AND D1.TSK_NO = D2.TSK_NO
			                 WHERE D1.AUD_YR = #strAudYr#
			                   AND D1.TSK_NO = #strTskNo#
			                   AND D1.CMPT_DT IS NOT NULL
			                   AND ( D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
			                 GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
			         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
			           AND D1.EVL_YR = #strEvlYr#
			           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
			           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD ) D9 /*감사단계별 추진율*/,
			       (SELECT
			                       CASE
			                         WHEN HNDL_PRD_DVSN_CD = '100' THEN NVL(ASP_RTE/100, '0')
			                         ELSE -NVL(ASP_RTE/100, '0')
			                       END AS CD014
			          FROM TBCSPAOE012M
			         WHERE EVL_YR = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND DLAY_DT_NM = (
			           						SELECT SUM(D2.DLAY_DT_NM)
			                                FROM (
			                                            SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
			                                                                           MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
			                                                                           D1.AUD_YR ,
			                                                                           D1.TSK_NO 
			                                                                      FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
			                                                                       AND D1.TSK_NO = D2.TSK_NO
			                                                                     WHERE D1.AUD_YR = #strAudYr#
			                                                                       AND D1.TSK_NO = #strTskNo#
			                                                                       AND D1.CMPT_DT IS NOT NULL
			                                                                       AND ( D1.CMPT_DT BETWEEN (select EVL_STR_DT
							                                                                                      from TBCSPAOE001M
							                                                                                     where EVL_YR = #strEvlYr#
							                                                                                       and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
																		                                                                                      from TBCSPAOE001M
																		                                                                                     where EVL_YR = #strEvlYr#
																		                                                                                       and HLYR_DVSN_CD = #strHlyrDvsnCd#))
			                                                                     GROUP BY D1.AUD_YR, D1.TSK_NO 
			                                     ) D1
			                                     , TBCSPAOE022M D2
			                                WHERE D1.AUD_YR = D2.AUD_YR
			                                  AND D1.TSK_NO = D2.TSK_NO
			                                  AND D2.AUD_STEP_CD BETWEEN D1.AUD_STEP_ST_CD AND D1.AUD_STEP_END_CD
			                            )
                   ) D4 /*조기지연처리 가감점율*/,
			       (SELECT FML_TXT
			          FROM TBCSPAOE013M
			         WHERE EVL_YR = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND TSK_DVSN_CD = #strTskDvsnCd# ) D7 /*감사업무 업무평점 수식*/,
			       (SELECT B.IDVT_INDEX_VAL
			          FROM TBCSPAOE010D B
			         WHERE B.RK_CD = (
			                                SELECT A.ELY_ADPT_STAD_RK_CD
			                                    FROM TBCSPAOE008D A
			                                    WHERE A.EVL_YR = #strEvlYr# 
			                                      AND A.HLYR_DVSN_CD = #strHlyrDvsnCd#
			                                      AND A.TSK_DVSN_CD = #strTskDvsnCd#
			                                      AND A.AUD_KND_CD = (SELECT C.AUD_KND_CD FROM TBCSPAOE021M C WHERE C.AUD_YR = #strAudYr# AND C.TSK_NO = #strTskNo#)
			                                      AND A.AUD_STEP_CD = (SELECT MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD
			                                                                              FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
			                                                                               AND D1.TSK_NO = D2.TSK_NO
			                                                                             WHERE D1.AUD_YR = #strAudYr#
			                                                                               AND D1.TSK_NO = #strTskNo#
			                                                                               AND D1.CMPT_DT IS NOT NULL
			                                                                               AND ( D1.CMPT_DT BETWEEN (select EVL_STR_DT
			                                                                                              from TBCSPAOE001M
			                                                                                             where EVL_YR = #strEvlYr#
			                                                                                               and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
			                                                                                              from TBCSPAOE001M
			                                                                                             where EVL_YR = #strEvlYr#
			                                                                                               and HLYR_DVSN_CD = #strHlyrDvsnCd#))
			                                                                             GROUP BY D1.AUD_YR, D1.TSK_NO )
			                            )
			              AND B.EVL_YR = #strEvlYr# 
			              AND B.HLYR_DVSN_CD = #strHlyrDvsnCd#
			              AND B.TSK_DVSN_CD = #strTskDvsnCd#
			              AND B.AUD_TSK_KND_CD = (SELECT AUD_KND_CD FROM TBCSPAOE021M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#)) D10   /*조기가점기준등급*/
			 , (SELECT MIN(AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                           MAX(AUD_STEP_CD) AS AUD_STEP_END_CD ,
                           AUD_YR ,
                           TSK_NO
                      FROM TBCSPAOE022M
                     WHERE LUNH_DT IS NOT NULL
                       AND CMPT_DT IS NOT NULL
                       AND AUD_YR = #strAudYr#
                       AND TSK_NO = #strTskNo#
                       AND (CMPT_DT BETWEEN (select EVL_STR_DT
                                               from TBCSPAOE001M
                                              where EVL_YR = #strEvlYr#
                                                and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                        AND (select EVL_END_DT
                                               from TBCSPAOE001M
                                              where EVL_YR = #strEvlYr#
                                                and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                  GROUP BY AUD_YR, TSK_NO) D12
		]]>
	</select>
	
	<!-- 감사업무 평가관리-위원평가 : 업무평점 조회 -->
	<select id="CSPAOE038ETskAscSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT NVL(ROUND(D1.RTE_ASC, 2), 0) AS DRIVE_RTE_ASC	/*추진율조정평점 = 표준평점 * 종합가중치 * 감사단계 추진율*/
       			 , case when instr(d4.CD014, '-') = 0 then	/*조기가점 처리일 경우*/
				         CASE WHEN D12.AUD_STEP_END_CD < '10004' THEN /*단계기말이 귀청보고 미만이면, 기준등급의 가중치 이상일 때 가점처리한다. */
				                       CASE
				                         WHEN ROUND(#strIdvtIndexVal#, 2) >= D10.IDVT_INDEX_VAL THEN nvl(round(d1.RTE_ASC1 + (D1.CD0111*ROUND(#strIdvtIndexVal#, 2)*D3.CD013*D4.CD014) + D5.CD015 + (D6.CD016) , 2), 0)
				                         else nvl(round(d1.RTE_ASC2 + 0 + D5.CD015 + (D6.CD016) , 2), 0)
				                       END
				              WHEN D12.AUD_STEP_END_CD >= '10004' THEN /*단계기말이 귀청보고 이상이면, 기준등급의 가중치 초과일 때 가점처리한다.*/
				                       CASE
				                         WHEN ROUND(#strIdvtIndexVal#, 2) <= D10.IDVT_INDEX_VAL THEN nvl(round(d1.RTE_ASC3 + 0 + D5.CD015 + (D6.CD016) , 2), 0)
				                         else nvl(round(d1.RTE_ASC4 + (d1.RTE_ASC4*D4.CD014) + D5.CD015 + (D6.CD016) , 2), 0)
				                       END
				              end
				             when instr(d4.CD014, '-') = 1 then /*지연감점 처리일 경우*/
				             									nvl(round(d1.RTE_ASC5 + (d1.RTE_ASC5*D4.CD014) + D5.CD015 + (D6.CD016) , 2), 0)
				  end AS TSK_ASC /*업무평점 = 추진율조정평점 + 가감평점 + 특별가산점 + 평점조정*/
			  FROM (
                    SELECT D1.AUD_STEP_YN
                     , D1.CNT_YN     
                     , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                                
                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then
                                NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                            end, 2) cd011	/*표준평점*/
                    , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                                
                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then
                                NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
						   WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                            end, 2) cd0111	/*표준평점*/
                    , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                                
                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then
                                NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                            end, 2) cd01111	/*표준평점*/
                   , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                                
                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then
                                NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                            end, 2) cd011111	/*표준평점*/
                   , ROUND(case when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1'  then
                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN 
                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                                
                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) 
                                END
                           when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2'  then
                                NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                           WHEN D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' THEN
														                                CASE WHEN D3.SYT_TRTM_YN = 'Y' THEN
														                                     NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0)
														                                END
                            end, 2) cd0111111	/*표준평점*/
                   , CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                       END AS RTE_ASC /*추진율조정평점*/,
                       CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                       END AS RTE_ASC1 /*추진율조정평점*/,
                       CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                       END AS RTE_ASC2 /*추진율조정평점*/,
                       CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                       END AS RTE_ASC3 /*추진율조정평점*/,
                       CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                       END AS RTE_ASC4 /*추진율조정평점*/,
                       CASE
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '3' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'Y' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '1' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal# +
                         CASE
                           WHEN D3.SYT_TRTM_YN = 'Y' THEN nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                           ELSE nvl(D1.AUD_STEP_END_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                         end
                         when D1.AUD_STEP_YN = 'N' AND D1.CNT_YN = '2' then nvl(D1.AUD_STEP_ST_DRIVE_RTE, 0) * nvl(F_GET_CAL(D2.STND_ASC_FML_TXT, D4.MNDY_CNT), 0) * #strIdvtIndexVal#
                       END AS RTE_ASC5 /*추진율조정평점*/
                FROM(
                        SELECT D2.EVL_YR ,
                                               D2.HLYR_DVSN_CD ,
                                               D2.AUD_KND_CD ,
                                               D2.STND_ASC_FML_TXT ,    /*국단장 이전 표준평점수식*/
                                               D2.SYT_TRTM_STND_ASC_FML_TXT,    /*심의실 이후 종합처리안 표준평점수식*/
                                               D2.IDVT_TRTM_STND_ASC_FML_TXT    /*심의실 이후 개별처리안 표준평점수식*/
                                          FROM TBCSPAOE004M D1 ,
                                               TBCSPAOE044M D2
                                         WHERE D1.EVL_YR = D2.EVL_YR
                                           AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
                                           AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
                                           AND D1.AUD_KND_CD = D2.AUD_KND_CD
                                           AND D1.EVL_YR = #strEvlYr#
                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                           AND D1.AUD_KND_CD = #strAudKndCd#
                                           AND (	SELECT MNDY_CNT
                                               		FROM TBCSPAOE021M
                                              		WHERE AUD_YR = #strAudYr#
                                                	AND TSK_NO = #strTskNo# ) BETWEEN D2.MNDY_CNT_1 AND D2.MNDY_CNT_2
                      ) D2  /*표준평점 수식*/
                     ,(   
                            SELECT D1.AUD_STEP_YN   /*감사기초단계 ~ 감사기말단계에서 심의실 포함 여부*/
                                 , CASE WHEN D2.AUD_STEP_ST_DRIVE_RTE = 0 THEN '1' /*심의실 이후*/
                                        WHEN D2.AUD_STEP_END_DRIVE_RTE = 0 THEN '2' /*감사단장 이전*/
                                   ELSE '3' END AS CNT_YN   /*심의실 포함*/
                                 , CASE WHEN D1.AUD_STEP_YN = 'Y' THEN D2.AUD_STEP_ST_DRIVE_RTE ELSE D3.AUD_STEP_ST_DRIVE_RTE END AS AUD_STEP_ST_DRIVE_RTE  /*감사단장 이전 추진율*/
                                 , CASE WHEN D1.AUD_STEP_YN = 'N' THEN D3.AUD_STEP_END_DRIVE_RTE ELSE D2.AUD_STEP_END_DRIVE_RTE END AS AUD_STEP_END_DRIVE_RTE   /*심의실 이후 추진율*/
                            FROM (
                                                SELECT CASE WHEN COUNT(*) = 1 THEN 'Y' ELSE 'N' END AS AUD_STEP_YN
                                                        FROM (
                                                                                SELECT MIN(AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       AUD_YR ,
                                                                                       TSK_NO 
                                                                                  FROM TBCSPAOE022M
                                                                                 WHERE LUNH_DT IS NOT NULL
                                                                                   AND CMPT_DT IS NOT NULL
                                                                                   AND AUD_YR = #strAudYr#
                                                                                   AND TSK_NO = #strTskNo#
                                                                                   AND (CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                        AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                                 GROUP BY AUD_YR, TSK_NO
                                                            ) D1
                                                        WHERE '10006' BETWEEN D1.AUD_STEP_ST_CD AND D1.AUD_STEP_END_CD
                            ) D1
                            , (
                                    /*심의실 포함한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                                    SELECT D1.AUD_STEP_ST_DRIVE_RTE
                                         , D2.AUD_STEP_END_DRIVE_RTE
                                    FROM
                                    (
                                                                /*감사기초단계 ~ 감사기말단계에서 심의실 포함하고 감사단장 이전에 대한 추진율 구하는 쿼리*/
                                                                SELECT NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_ST_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                             GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND '10006' BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND '10005'
                                           ) D1
                                         , (
                                                                /*감사기초단계 ~ 감사기말단계에서 심의실 포함하고 심의실 이후에 대한 추진율 구하는 쿼리*/
                                                                SELECT NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND '10006' BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                                                           AND D1.AUD_STEP_CD BETWEEN '10006' AND D2.AUD_STEP_END_CD
                                           ) D2
                              ) D2  /*심의실 포함한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                            , (
                                    /*심의실 포함 안 한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                                    SELECT CASE WHEN (D3.AUD_STEP_ST_CD <= '10005' AND D3.AUD_STEP_END_CD <= '10005') THEN D2.AUD_STEP_ST_DRIVE_RTE ELSE D1.AUD_STEP_ST_DRIVE_RTE END AS AUD_STEP_ST_DRIVE_RTE
                                         , CASE WHEN (D3.AUD_STEP_ST_CD >= '10006' AND D3.AUD_STEP_END_CD >= '10006') THEN D1.AUD_STEP_END_DRIVE_RTE ELSE D2.AUD_STEP_END_DRIVE_RTE END AS AUD_STEP_END_DRIVE_RTE
                                    FROM (
                                    /*감사기초단계 ~ 감사기말단계에서 심의실 포함 안하고 심의실 이후에 대한 추진율 구하는 쿼리*/
                                    SELECT 0 AS AUD_STEP_ST_DRIVE_RTE
                                         , NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND (D2.AUD_STEP_ST_CD >= '10006' AND D2.AUD_STEP_END_CD >= '10006')
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                            ) D1
                            , (
                                    /*감사기초단계 ~ 감사기말단계에서 심의실 포함 안하고 감사단장 이전에 대한 추진율 구하는 쿼리*/
                                    SELECT NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_ST_DRIVE_RTE
                                         , 0 AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND (D2.AUD_STEP_ST_CD <= '10005' AND D2.AUD_STEP_END_CD <= '10005')
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                    ) D2
                                    , (
                                             SELECT MIN(AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                                                                                               MAX(AUD_STEP_CD) AS AUD_STEP_END_CD ,
                                                                                               AUD_YR ,
                                                                                               TSK_NO 
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE LUNH_DT IS NOT NULL
                                                                                           AND CMPT_DT IS NOT NULL
                                                                                           AND AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND (CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                                AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                                         GROUP BY AUD_YR, TSK_NO
                                    ) D3
                              ) D3  /*심의실 포함 안 한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                      ) D1  /*감사단장 이전 추진율 및 심의실 이후 추진율*/
                  , (SELECT DISTINCT NVL(SYT_TRTM_YN, 'N') AS SYT_TRTM_YN FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#) D3
                  , (SELECT MNDY_CNT FROM TBCSPAOE021M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#) D4
                   ) D1 /*감사종류별 표준평점*/,
			       (SELECT SUM(D1.DRIVE_RTE)/100 AS CD013
			          FROM TBCSPAOE008D D1,
			               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
			                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
			                       D1.AUD_YR ,
			                       D2.AUD_KND_CD
			                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
			                   AND D1.TSK_NO = D2.TSK_NO
			                 WHERE D1.AUD_YR = #strAudYr#
			                   AND D1.TSK_NO = #strTskNo#
			                   AND D1.CMPT_DT IS NOT NULL
			                   AND ( D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
			                 GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
			         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
			           AND D1.EVL_YR = #strEvlYr#
			           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
			           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD ) D3 /*감사단계별 추진율*/,
			       (SELECT SUM(D1.DRIVE_RTE)/100 AS CD013
			          FROM TBCSPAOE008D D1,
			               (SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
			                       MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
			                       D1.AUD_YR ,
			                       D2.AUD_KND_CD
			                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
			                   AND D1.TSK_NO = D2.TSK_NO
			                 WHERE D1.AUD_YR = #strAudYr#
			                   AND D1.TSK_NO = #strTskNo#
			                   AND D1.CMPT_DT IS NOT NULL
			                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
			                 GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
			         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
			           AND D1.EVL_YR = #strEvlYr#
			           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
			           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD ) D9 /*감사단계별 추진율*/,
			       (SELECT
			                       CASE
			                         WHEN HNDL_PRD_DVSN_CD = '100' THEN NVL(ASP_RTE/100, '0')
			                         ELSE -NVL(ASP_RTE/100, '0')
			                       END AS CD014
			          FROM TBCSPAOE012M
			         WHERE EVL_YR = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND DLAY_DT_NM = (
			           						SELECT SUM(D2.DLAY_DT_NM)
			                                FROM (
			                                            SELECT MIN(D1.AUD_STEP_CD) AS AUD_STEP_ST_CD ,
			                                                                           MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD ,
			                                                                           D1.AUD_YR ,
			                                                                           D1.TSK_NO 
			                                                                      FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
			                                                                       AND D1.TSK_NO = D2.TSK_NO
			                                                                     WHERE D1.AUD_YR = #strAudYr#
			                                                                       AND D1.TSK_NO = #strTskNo#
			                                                                       AND D1.CMPT_DT IS NOT NULL
			                                                                       AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT
							                                                                                      from TBCSPAOE001M
							                                                                                     where EVL_YR = #strEvlYr#
							                                                                                       and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
																		                                                                                      from TBCSPAOE001M
																		                                                                                     where EVL_YR = #strEvlYr#
																		                                                                                       and HLYR_DVSN_CD = #strHlyrDvsnCd#))
			                                                                     GROUP BY D1.AUD_YR, D1.TSK_NO 
			                                     ) D1
			                                     , TBCSPAOE022M D2
			                                WHERE D1.AUD_YR = D2.AUD_YR
			                                  AND D1.TSK_NO = D2.TSK_NO
			                                  AND D2.AUD_STEP_CD BETWEEN D1.AUD_STEP_ST_CD AND D1.AUD_STEP_END_CD
			                            )
                   ) D4 /*조기지연처리 가감점율*/,
			       (SELECT NVL(SPE_ADD_SC, 0) AS CD015
			          FROM TBCSPAOE029M
			         WHERE EVL_YR = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND TSK_DVSN_CD = #strTskDvsnCd#
			           AND AUD_TSK_KND_CD = #strAudKndCd#
			           AND EVL_STEP_CD = #strEvlStepCd#
			           AND AUD_YR = #strAudYr#
			           AND TSK_NO = #strTskNo# ) D5 /*특별가산점*/  ,
			       (SELECT ROUND(NVL(MDT_ASC, 0), 2) AS CD016
			          FROM TBCSPAOE029M
			         WHERE EVL_YR = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND TSK_DVSN_CD = #strTskDvsnCd#
			           AND AUD_TSK_KND_CD = #strAudKndCd#
			           AND EVL_STEP_CD = #strEvlStepCd#
			           AND AUD_YR = #strAudYr#
			           AND TSK_NO = #strTskNo# ) D6 /*평점조정*/,
			       (SELECT FML_TXT
			          FROM TBCSPAOE013M
			         WHERE EVL_YR = #strEvlYr#
			           AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND TSK_DVSN_CD = #strTskDvsnCd# ) D7 /*감사업무 업무평점 수식*/,
			       (SELECT B.IDVT_INDEX_VAL
			          FROM TBCSPAOE010D B
			         WHERE B.RK_CD = (
			                                SELECT A.ELY_ADPT_STAD_RK_CD
			                                    FROM TBCSPAOE008D A
			                                    WHERE A.EVL_YR = #strEvlYr# 
			                                      AND A.HLYR_DVSN_CD = #strHlyrDvsnCd#
			                                      AND A.TSK_DVSN_CD = #strTskDvsnCd#
			                                      AND A.AUD_KND_CD = (SELECT C.AUD_KND_CD FROM TBCSPAOE021M C WHERE C.AUD_YR = #strAudYr# AND C.TSK_NO = #strTskNo#)
			                                      AND A.AUD_STEP_CD = (SELECT MAX(D1.AUD_STEP_CD) AS AUD_STEP_END_CD
			                                                                              FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
			                                                                               AND D1.TSK_NO = D2.TSK_NO
			                                                                             WHERE D1.AUD_YR = #strAudYr#
			                                                                               AND D1.TSK_NO = #strTskNo#
			                                                                               AND D1.CMPT_DT IS NOT NULL
			                                                                               AND ( D1.CMPT_DT BETWEEN (select EVL_STR_DT
			                                                                                              from TBCSPAOE001M
			                                                                                             where EVL_YR = #strEvlYr#
			                                                                                               and HLYR_DVSN_CD = #strHlyrDvsnCd#) AND (select EVL_END_DT
			                                                                                              from TBCSPAOE001M
			                                                                                             where EVL_YR = #strEvlYr#
			                                                                                               and HLYR_DVSN_CD = #strHlyrDvsnCd#))
			                                                                             GROUP BY D1.AUD_YR, D1.TSK_NO )
			                            )
			              AND B.EVL_YR = #strEvlYr# 
			              AND B.HLYR_DVSN_CD = #strHlyrDvsnCd#
			              AND B.TSK_DVSN_CD = #strTskDvsnCd#
			              AND B.AUD_TSK_KND_CD = (SELECT AUD_KND_CD FROM TBCSPAOE021M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo#)) D10
			     , (SELECT MIN(AUD_STEP_CD) AS AUD_STEP_ST_CD ,
                           MAX(AUD_STEP_CD) AS AUD_STEP_END_CD ,
                           AUD_YR ,
                           TSK_NO
                      FROM TBCSPAOE022M
                     WHERE LUNH_DT IS NOT NULL
                       AND CMPT_DT IS NOT NULL
                       AND AUD_YR = #strAudYr#
                       AND TSK_NO = #strTskNo#
                       AND (CMPT_DT BETWEEN (select EVL_STR_DT
                                               from TBCSPAOE001M
                                              where EVL_YR = #strEvlYr#
                                                and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                        AND (select EVL_END_DT
                                               from TBCSPAOE001M
                                              where EVL_YR = #strEvlYr#
                                                and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                  GROUP BY AUD_YR, TSK_NO) D12
		]]>
	</select>
	
	<!-- 감사업무 평가관리-위원평가 데이터 조회 -->
	<select id="CSPAOE038ECopyCntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE030M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
  			   AND TSK_DVSN_CD = '10000'
  			   AND EVL_STEP_CD = '200'
  			   AND EVL_CMTR_CNB = #strEvlCmtrCnb#
  			   AND AUD_TSK_KND_CD = #strAudKndCd#
  			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
		]]>
	</select>
	
	<!-- 감사업무 평가관리-위원평가 평가지표 정보 복사 -->
	<insert id="CSPAOE038ECopyInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE030M
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_TSK_KND_CD
			, EVL_STEP_CD
			, EVL_CMTR_CNB
			, AUD_YR
			, TSK_NO
			, EVL_INDEX_CD
			, EVL_RK_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT #strEvlYr#
			 , #strHlyrDvsnCd#
		 	 , '10000'
			 , #strAudKndCd#
			 , '200'
			 , #strEvlCmtrCnb#
			 , #strAudYr#
			 , #strTskNo#
			 , EVL_INDEX_CD
			 , ' '
			 , ' '
			 , ' '
			 , ' '
			 , 'CSPAOE038E'
			 , SYSDATE
			 , SYSDATE
		FROM TBCSPAOE002M
		 WHERE EVL_YR = #strEvlYr#
	      AND  HLYR_DVSN_CD = #strHlyrDvsnCd#
	  GROUP BY EVL_YR, HLYR_DVSN_CD, EVL_INDEX_CD
	</insert>
	
	<!-- 감사업무 평가관리-위원평가 : 평가지표 기준 정보 복사 점 데이터 삭제 -->
	<delete id="CSPAOE038ECopyDelete" parameterClass="paramMap">
		DELETE TBCSPAOE030M
		WHERE 1=1 
		  AND EVL_YR = #strEvlYr#
		  AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		  AND TSK_DVSN_CD = '10000'
		  AND AUD_TSK_KND_CD = #strAudKndCd#
		  AND EVL_STEP_CD = '200'
		  AND EVL_CMTR_CNB = #strEvlCmtrCnb#
		  AND AUD_YR = #strAudYr#
		  AND TSK_NO = #strTskNo#
	</delete>
	
	<!-- 감사사항별 평가관리-감사업무평점 온로드시 평가항목코드 조회 -->
	<select id="CSPAOE047EAudFmlCluCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT FML_CLU_CD AS CD /*코드*/
			     , FML_CLU_NM AS CD_NM /*코드명*/
			  FROM TBCSPAOE014D
			 WHERE TSK_DVSN_CD = '10000'
	         GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_DVSN_CD, FML_CLU_CD, FML_CLU_NM
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사외업무평점 온로드시 업무종류코드 조회 -->
	<select id="CSPAOE047ENAudKndCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CD	/*코드*/
       			 , CD_NM	/*코드명*/
  			  FROM TBDCMACM013C
 			 WHERE 1=1
   			   AND CD <> '000000000'
   			   AND CMM_CD_DVSN_CD ='1000272'	/*업무종류코드*/
   			   AND CD NOT IN '10000'	/*업무종류: 공통종류코드 제외*/
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사외업무평점 온로드시 평가항목코드 조회 -->
	<select id="CSPAOE047ENAudFmlCluCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT FML_CLU_CD AS CD /*코드*/
			     , FML_CLU_NM AS CD_NM /*코드명*/
			  FROM TBCSPAOE014D
			 WHERE TSK_DVSN_CD = '10001'
	         GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_DVSN_CD, FML_CLU_CD, FML_CLU_NM
		]]>
	</select>
	
	<!-- 감사사항별 평가관리-감사업무평점 온로드시 평가등급코드 조회 -->
	<select id="CSPAOE047EAudEvlRkCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT DISTINCT RK_CD AS CD /*코드*/
			     , F_CODE_NM('1000274', RK_CD)AS CD_NM /*코드명*/
			  FROM TBCSPAOE010D
			 WHERE 1=1
			   AND TSK_DVSN_CD = '10000'
			   AND IDCT_YN = 'Y'
			 GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_DVSN_CD, AUD_TSK_KND_CD, RK_CD
			 ORDER BY RK_CD ASC
		]]>
	</select>
	
	<!-- 감사사항별 평가관리-감사외업무평점 온로드시 평가등급코드 조회 -->
	<select id="CSPAOE047ENAudEvlRkCdListSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT DISTINCT RK_CD AS CD /*코드*/
			     , F_CODE_NM('1000274', RK_CD)AS CD_NM /*코드명*/
			  FROM TBCSPAOE010D
			 WHERE 1=1
			   AND TSK_DVSN_CD = '10001'
			   AND IDCT_YN = 'Y'
			 GROUP BY EVL_YR, HLYR_DVSN_CD, TSK_DVSN_CD, AUD_TSK_KND_CD, RK_CD
			 ORDER BY RK_CD ASC
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사업무평점 조회 -->
	<select id="CSPAOE047EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D2.EVL_YR
			     , D2.HLYR_DVSN_CD
			     , D2.TSK_DVSN_CD
			     , D2.AUD_TSK_KND_CD
			     , D2.AUD_YR
			     , D2.TSK_NO
			     , NVL(F_MNG_KND_AUDYRNO(D2.AUD_YR, D2.TSK_NO, D6.AUD_KND_CD, '-'),D2.AUD_YR||'-'||D2.TSK_NO) AS TSK_YR_NO
			     , D3.AUD_SBJ_NM
			     , D2.TSK_ASC
			     , D2.EVL_STEP_CD
			     , D2.EVL_CMTR_DVSN_CD
			     , F_DPT_INFO(D3.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM
                 , D3.HNDL_DIV_DPT_CD
			  FROM TBCSPAOE029M D2
				   LEFT JOIN TBCSPAOE033M D1
				          ON D1.EVL_YR = D2.EVL_YR
				         AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
				         AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
				         AND D1.AUD_YR = D2.AUD_YR
				         AND D1.TSK_NO = D2.TSK_NO
				 , TBCSPAOE021M D3
				   LEFT JOIN TBCSPAOE022M D4
				          ON D3.AUD_YR = D4.AUD_YR
				         AND D3.TSK_NO = D4.TSK_NO
				 , TBCSPAOE008D D5,TBBADDED001M D6
			WHERE 1=1
			  AND D2.AUD_YR = D3.AUD_YR
			  AND D2.TSK_NO = D3.TSK_NO
			  AND D2.AUD_YR = D6.AUD_YR(+)
   			  AND D2.TSK_NO = D6.AUD_NO(+)
			  AND D2.EVL_YR =D5.EVL_YR
			  AND D2.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
			  AND D3.AUD_KND_CD = D5.AUD_KND_CD
			  AND D4.AUD_STEP_CD = D5.AUD_STEP_CD
			  AND D2.EVL_YR = #strEvlYr#
			  AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			  AND D2.TSK_DVSN_CD = '10000'	/*감사업무평점*/
			  AND D2.AUD_STEP_CD <> '10010'
			  AND D2.EVL_STEP_CD = '100'   /*귀청보고단계평가*/
	    ]]>
		<isNotEmpty prepend="AND" property="strAudYr">
			D2.AUD_YR = #strAudYr#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strTskNo">
			CASE WHEN LENGTH(#strTskNo#) = 3 AND D6.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D2.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			D6.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1)
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			D3.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<![CDATA[
	     GROUP BY D2.EVL_YR, D2.HLYR_DVSN_CD, D2.TSK_DVSN_CD, D2.AUD_TSK_KND_CD, D2.AUD_YR, D2.TSK_NO, D3.AUD_SBJ_NM, D2.TSK_ASC, D2.EVL_STEP_CD, D2.EVL_CMTR_DVSN_CD, D2.SYT_EVL_RK_CD, D2.SYT_EVL_ADVL_VAL, D3.HNDL_DIV_DPT_CD, D6.AUD_KND_CD
	     
	     UNION
	     
	     SELECT D2.EVL_YR
			     , D2.HLYR_DVSN_CD
			     , D2.TSK_DVSN_CD
			     , D2.AUD_TSK_KND_CD
			     , D2.AUD_YR
			     , D2.TSK_NO
			     , NVL(F_MNG_KND_AUDYRNO(D2.AUD_YR, D2.TSK_NO, D6.AUD_KND_CD, '-'),D2.AUD_YR||'-'||D2.TSK_NO) AS TSK_YR_NO
			     , D3.AUD_SBJ_NM
			     , D2.TSK_ASC
			     , D2.EVL_STEP_CD
			     , D2.EVL_CMTR_DVSN_CD
			     , F_DPT_INFO(D3.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM
                 , D3.HNDL_DIV_DPT_CD
			  FROM TBCSPAOE029M D2
				   LEFT JOIN TBCSPAOE033M D1
				          ON D1.EVL_YR = D2.EVL_YR
				         AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
				         AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
				         AND D1.AUD_YR = D2.AUD_YR
				         AND D1.TSK_NO = D2.TSK_NO
				 , TBCSPAOE021M D3
				   LEFT JOIN TBCSPAOE022M D4
				          ON D3.AUD_YR = D4.AUD_YR
				         AND D3.TSK_NO = D4.TSK_NO
				 , TBCSPAOE008D D5,TBBADDED001M D6
			WHERE 1=1
			  AND D2.AUD_YR = D3.AUD_YR
			  AND D2.TSK_NO = D3.TSK_NO
			  AND D2.AUD_YR = D6.AUD_YR(+)
 			  AND D2.TSK_NO = D6.AUD_NO(+)
			  AND D2.EVL_YR =D5.EVL_YR
			  AND D2.HLYR_DVSN_CD = D5.HLYR_DVSN_CD
			  AND D3.AUD_KND_CD = D5.AUD_KND_CD
			  AND D4.AUD_STEP_CD = D5.AUD_STEP_CD
			  AND D2.EVL_YR = #strEvlYr#
			  AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			  AND D2.TSK_DVSN_CD = '10000'	/*감사업무평점*/
			  AND D2.EVL_STEP_CD = '200'   /*위원평가단계*/
		]]>
		<isNotEmpty prepend="AND" property="strAudYr">
			D2.AUD_YR = #strAudYr#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strTskNo">
			CASE WHEN LENGTH(#strTskNo#) = 3 AND D6.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D2.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			D6.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1)
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			D3.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<![CDATA[
	     GROUP BY D2.EVL_YR, D2.HLYR_DVSN_CD, D2.TSK_DVSN_CD, D2.AUD_TSK_KND_CD, D2.AUD_YR, D2.TSK_NO, D3.AUD_SBJ_NM, D2.TSK_ASC, D2.EVL_STEP_CD, D2.EVL_CMTR_DVSN_CD, D2.SYT_EVL_RK_CD, D2.SYT_EVL_ADVL_VAL, D3.HNDL_DIV_DPT_CD, D6.AUD_KND_CD
         ORDER BY D3.HNDL_DIV_DPT_CD	     
	    ]]> 
	</select>

	<!-- 감사사항별 평가관리-감사업무평점 상세 데이터 조회 -->
	<select id="CSPAOE047EDtlCntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT NVL(COUNT(DGE),0) AS CNT
			  FROM TBCSPAOE033M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = #strTskDvsnCd#
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사업무평점 상세 조회 -->
	<select id="CSPAOE047EDtlNSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT #strEvlYr# AS EVL_YR
			     , #strHlyrDvsnCd# AS HLYR_DVSN_CD
			     , #strTskDvsnCd# AS TSK_DVSN_CD
			     , #strAudYr# AS AUD_YR
			     , #strTskNo# AS TSK_NO
			     , D1.EVL_CLU_CD1
			     , D1.MNDY_CNT
			     , D1.SYT_TRTM_YN
			     , D1.AUD_KND_CD
			     , D1.STND_ASC
			     , D2.EVL_CLU_CD2
			     , D2.SYT_EVL_RK_CD
			     , D2.SYT_EVL_ADVL_VAL
			     , D3.EVL_CLU_CD3
			     , D3.AUD_ST_STEP_CD
			     , D3.AUD_END_STEP_CD
			     , D3.DRIVE_RTE
			     , D7.AUD_STEP_YN
			     , D7.AUD_STEP_ST_DRIVE_RTE AS ST_DRIVE_RTE
			     , D7.AUD_STEP_END_DRIVE_RTE AS END_DRIVE_RTE
			     , D4.EVL_CLU_CD4
			     , D4.HNDL_PRD_DVSN_CD
			     , D4.HNDL_PRD_DCN
			     , D4.DLAY_DT_NM
			     , D4.ASP_RTE
			     , D5.EVL_CLU_CD5
			     , D5.SPE_ADP_CLU_CD
			     , D5.SPE_ADD_SC
			     , D6.EVL_CLU_CD6
			     , D6.MDT_ASC
			FROM (
			        SELECT 'CD011' AS EVL_CLU_CD1
			             , CASE WHEN D1.SYT_TRTM_YN IS NULL THEN 'N'
       							ELSE D1.SYT_TRTM_YN END AS SYT_TRTM_YN
			             , D1.MNDY_CNT
			             , D1.AUD_KND_CD
			             , ROUND(F_GET_CAL(CONCAT(CONCAT(SUBSTR(D1.FML_TXT, 1, INSTR(D1.FML_TXT, 'A01')-1), 'A01,'), SUBSTR(D1.FML_TXT, INSTR(D1.FML_TXT, 'A01')+4)), D1.MNDY_CNT), 2) AS STND_ASC
			        FROM(
			                    SELECT D2.MNDY_CNT
			                         , D2.AUD_KND_CD
			                         , D3.SYT_TRTM_YN
			                         , CASE WHEN TO_NUMBER(D3.AUD_STEP_CD) <= 10005 THEN D4.STND_ASC_FML_TXT
                                            WHEN NVL(D3.SYT_TRTM_YN, 'N') = 'N' THEN D4.IDVT_TRTM_STND_ASC_FML_TXT
			                                ELSE D4.SYT_TRTM_STND_ASC_FML_TXT END FML_TXT
			                          FROM TBCSPAOE021M D2
			                             , TBCSPAOE022M D3
			                             , TBCSPAOE044M D4
			                        WHERE D2.AUD_YR = D3.AUD_YR
					                  AND D2.TSK_NO = D3.TSK_NO
					                  AND D2.AUD_KND_CD = D4.AUD_KND_CD
			                          AND D4.EVL_YR = #strEvlYr#
			                          AND D4.HLYR_DVSN_CD = #strHlyrDvsnCd#
			                          AND D2.AUD_YR = #strAudYr#
			                          AND D2.TSK_NO = #strTskNo#
			                          AND D3.AUD_STEP_CD = ( SELECT MAX(AUD_STEP_CD) FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND CMPT_DT IS NOT NULL)
			                          AND (	SELECT MNDY_CNT
                                               		FROM TBCSPAOE021M
                                              		WHERE AUD_YR = #strAudYr#
                                                	AND TSK_NO = #strTskNo# ) BETWEEN D4.MNDY_CNT_1 AND D4.MNDY_CNT_2 
			            ) D1
			     ) D1 /*수식가져오는 쿼리 이상해서 수정함 2015.03.16*/
			   , (
			        SELECT 'CD012' AS EVL_CLU_CD2
			              , CASE WHEN D1.SYT_EVL_RK_CD IS NOT NULL THEN D1.SYT_EVL_RK_CD
               			         ELSE D1.EVL_RK_CD END AS SYT_EVL_RK_CD
              		      , CASE WHEN D1.SYT_EVL_ADVL_VAL IS NOT NULL THEN D1.SYT_EVL_ADVL_VAL
               				     ELSE D2.IDVT_INDEX_VAL END AS SYT_EVL_ADVL_VAL
			        FROM TBCSPAOE029M D1
			           , TBCSPAOE010D D2
			        WHERE D1.EVL_YR = D2.EVL_YR
			          AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			          AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
			          AND D1.AUD_TSK_KND_CD = D2.AUD_TSK_KND_CD
			          AND (D1.SYT_EVL_RK_CD = D2.RK_CD OR D1.EVL_RK_CD = D2.RK_CD)
			          AND D1.EVL_YR = #strEvlYr#
			          AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			          AND D1.TSK_DVSN_CD = #strTskDvsnCd#
			          AND D1.AUD_TSK_KND_CD = #strAudKndCd#
			          AND D1.AUD_YR = #strAudYr#
			          AND D1.TSK_NO = #strTskNo#
			     ) D2
			   , (
			        SELECT DISTINCT 'CD013' AS EVL_CLU_CD3
			             , (SELECT MIN(AUD_STEP_CD) FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND CMPT_DT IS NOT NULL
			                                                            AND (CMPT_DT BETWEEN (SELECT EVL_STR_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                        AND (SELECT EVL_END_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#))) AS AUD_ST_STEP_CD
			             , (SELECT MAX(AUD_STEP_CD) FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND CMPT_DT IS NOT NULL
			                                                            AND (CMPT_DT BETWEEN (SELECT EVL_STR_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                        AND (SELECT EVL_END_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#))) AS AUD_END_STEP_CD
			             , D2.DRIVE_RTE
			        FROM TBCSPAOE022M D1
			             LEFT JOIN TBCSPAOE021M D3
			                   ON D1.AUD_YR = D3.AUD_YR
			                  AND D1.TSK_NO = D3.TSK_NO
			           , ( SELECT SUM(D2.DRIVE_RTE) AS DRIVE_RTE
			                 FROM TBCSPAOE008D D2
			                WHERE 1=1
			                  AND D2.EVL_YR = #strEvlYr#
			                  AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			                  AND D2.TSK_DVSN_CD = #strTskDvsnCd#
			                  AND D2.AUD_KND_CD = #strAudKndCd#
			                  AND D2.AUD_STEP_CD BETWEEN (
					                                       SELECT MIN(AUD_STEP_CD)
					                                         FROM TBCSPAOE022M
					                                         WHERE AUD_YR = #strAudYr#
					                                           AND TSK_NO = #strTskNo#
					                                           AND CMPT_DT IS NOT NULL
					                                           AND (CMPT_DT BETWEEN (SELECT EVL_STR_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                    AND (SELECT EVL_END_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#))
					                                     )
						                             AND (
						                                    SELECT MAX(AUD_STEP_CD)
						                                      FROM TBCSPAOE022M
						                                     WHERE AUD_YR = #strAudYr#
						                                       AND TSK_NO = #strTskNo#
						                                       AND CMPT_DT IS NOT NULL
						                                       AND (CMPT_DT BETWEEN (SELECT EVL_STR_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                    AND (SELECT EVL_END_DT FROM TBCSPAOE001M WHERE EVL_YR = #strEvlYr# AND HLYR_DVSN_CD = #strHlyrDvsnCd#))
						                                 )
			              ) D2 /*값이 잘못나와 평가기간에 소속된 감사단계를 리턴하도록 조건 추가 2015.03.16*/
			        WHERE 1=1
			          AND D1.AUD_YR = #strAudYr#
			          AND D1.TSK_NO = #strTskNo#
			     ) D3
			   , (
			        SELECT 'CD014' AS EVL_CLU_CD4
			             , D2.HNDL_PRD_DVSN_CD
			             , D2.HNDL_PRD_DCN
			             , D1.DLAY_DT_NM
			             , D2.ASP_RTE
			        FROM TBCSPAOE012M D2
			           , (
			                SELECT AUD_YR
			                     , SUM(DLAY_DT_NM) AS DLAY_DT_NM
			                  FROM TBCSPAOE022M
			                 WHERE AUD_YR = #strAudYr#
			                   AND TSK_NO = #strTskNo#
			              GROUP BY AUD_YR, TSK_NO
			             ) D1
			        WHERE D1.DLAY_DT_NM = D2.DLAY_DT_NM
			          AND D2.EVL_YR = #strEvlYr#
			          AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			     ) D4
			   , (
			   		SELECT 'CD015' AS EVL_CLU_CD5
			              , NVL(D1.SPE_ADP_CLU_CD, '') AS SPE_ADP_CLU_CD
			              , NVL(D1.SPE_ADD_SC, '') AS SPE_ADD_SC
			           FROM TBCSPAOE029M D1
			                LEFT JOIN TBCSPAOE011M D2
		                      ON D1.EVL_YR = D2.EVL_YR
		                     AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
		                     AND D1.SPE_ADP_CLU_CD = D2.CLU_CD
			          WHERE 1=1
			            AND D1.EVL_YR = #strEvlYr#
			            AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			            AND D1.TSK_DVSN_CD = #strTskDvsnCd#
			            AND D1.AUD_TSK_KND_CD = #strAudKndCd#
			            AND D1.EVL_STEP_CD = #strEvlStepCd#
			            AND D1.AUD_YR = #strAudYr#
			            AND D1.TSK_NO = #strTskNo#
			            AND D1.EVL_CMTR_DVSN_CD = #strEvlCmtrDvsnCd#
			         GROUP BY D1.EVL_YR, D1.HLYR_DVSN_CD, D1.SPE_ADP_CLU_CD, D1.SPE_ADD_SC
			      ) D5
			   , (
			     	SELECT 'CD016' AS EVL_CLU_CD6
			              , NVL(MDT_ASC, '') AS MDT_ASC
			           FROM TBCSPAOE029M
			          WHERE EVL_YR = #strEvlYr#
			            AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			            AND TSK_DVSN_CD = #strTskDvsnCd#
			            AND AUD_TSK_KND_CD = #strAudKndCd#
			            AND EVL_STEP_CD = #strEvlStepCd#
			            AND AUD_YR = #strAudYr#
			            AND TSK_NO = #strTskNo#
			            AND EVL_CMTR_DVSN_CD = #strEvlCmtrDvsnCd#
			     ) D6
			   , (
			   		   
                            SELECT D1.AUD_STEP_YN   /*감사기초단계 ~ 감사기말단계에서 심의실 포함 여부*/
                                 , CASE WHEN D1.AUD_STEP_YN = 'Y' THEN D2.AUD_STEP_ST_DRIVE_RTE ELSE D3.AUD_STEP_ST_DRIVE_RTE END AS AUD_STEP_ST_DRIVE_RTE  /*감사단장 이전 추진율*/
                                 , CASE WHEN D1.AUD_STEP_YN = 'N' THEN D3.AUD_STEP_END_DRIVE_RTE ELSE D2.AUD_STEP_END_DRIVE_RTE END AS AUD_STEP_END_DRIVE_RTE   /*심의실 이후 추진율*/
                            FROM (
                                                SELECT CASE WHEN COUNT(*) = 1 THEN 'Y' ELSE 'N' END AS AUD_STEP_YN
                                                        FROM (
                                                                                SELECT (SELECT MIN(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND LUNH_DT IS NOT NULL) AS AUD_STEP_ST_CD ,
                                                                                       (SELECT MAX(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND CMPT_DT IS NOT NULL) AS AUD_STEP_END_CD ,
                                                                                       AUD_YR ,
                                                                                       TSK_NO 
                                                                                  FROM TBCSPAOE022M
                                                                                 WHERE LUNH_DT IS NOT NULL
                                                                                   AND CMPT_DT IS NOT NULL
                                                                                   AND AUD_YR = #strAudYr#
                                                                                   AND TSK_NO = #strTskNo#
                                                                                   AND (CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                        AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                                 GROUP BY AUD_YR, TSK_NO
                                                            ) D1
                                                        WHERE '10006' BETWEEN D1.AUD_STEP_ST_CD AND D1.AUD_STEP_END_CD
                            ) D1
                            , (
                                    /*심의실 포함한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                                    SELECT D1.AUD_STEP_ST_DRIVE_RTE
                                         , D2.AUD_STEP_END_DRIVE_RTE
                                    FROM
                                    (
                                                                /*감사기초단계 ~ 감사기말단계에서 심의실 포함하고 감사단장 이전에 대한 추진율 구하는 쿼리*/
                                                                SELECT NVL(SUM(D1.DRIVE_RTE), 0) AS AUD_STEP_ST_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT (SELECT MIN(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND LUNH_DT IS NOT NULL) AS AUD_STEP_ST_CD ,
                                                                                       (SELECT MAX(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND CMPT_DT IS NOT NULL) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                             GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND '10006' BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND '10005'
                                           ) D1
                                         , (
                                                                /*감사기초단계 ~ 감사기말단계에서 심의실 포함하고 심의실 이후에 대한 추진율 구하는 쿼리*/
                                                                SELECT NVL(SUM(D1.DRIVE_RTE)/100, 0) AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT (SELECT MIN(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND LUNH_DT IS NOT NULL) AS AUD_STEP_ST_CD ,
                                                                                       (SELECT MAX(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND CMPT_DT IS NOT NULL) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND '10006' BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                                                           AND D1.AUD_STEP_CD BETWEEN '10006' AND D2.AUD_STEP_END_CD
                                           ) D2
                              ) D2  /*심의실 포함한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                            , (
                                    /*심의실 포함 안 한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                                    SELECT CASE WHEN (D3.AUD_STEP_ST_CD <= '10005' AND D3.AUD_STEP_END_CD <= '10005') THEN D2.AUD_STEP_ST_DRIVE_RTE ELSE D1.AUD_STEP_ST_DRIVE_RTE END AS AUD_STEP_ST_DRIVE_RTE
                                         , CASE WHEN (D3.AUD_STEP_ST_CD >= '10006' AND D3.AUD_STEP_END_CD >= '10006') THEN D1.AUD_STEP_END_DRIVE_RTE ELSE D2.AUD_STEP_END_DRIVE_RTE END AS AUD_STEP_END_DRIVE_RTE
                                    FROM (
                                    /*감사기초단계 ~ 감사기말단계에서 심의실 포함 안하고 심의실 이후에 대한 추진율 구하는 쿼리*/
                                    SELECT 0 AS AUD_STEP_ST_DRIVE_RTE
                                         , NVL(SUM(D1.DRIVE_RTE), 0) AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT (SELECT MIN(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND LUNH_DT IS NOT NULL) AS AUD_STEP_ST_CD ,
                                                                                       (SELECT MAX(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND CMPT_DT IS NOT NULL) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND (D2.AUD_STEP_ST_CD >= '10006' AND D2.AUD_STEP_END_CD >= '10006')
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                            ) D1
                            , (
                                    /*감사기초단계 ~ 감사기말단계에서 심의실 포함 안하고 감사단장 이전에 대한 추진율 구하는 쿼리*/
                                    SELECT NVL(SUM(D1.DRIVE_RTE), 0) AS AUD_STEP_ST_DRIVE_RTE
                                         , 0 AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT (SELECT MIN(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND LUNH_DT IS NOT NULL) AS AUD_STEP_ST_CD ,
                                                                                       (SELECT MAX(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND CMPT_DT IS NOT NULL) AS AUD_STEP_END_CD ,
                                                                                       D1.AUD_YR ,
                                                                                       D2.AUD_KND_CD
                                                                                  FROM TBCSPAOE022M D1 LEFT JOIN TBCSPAOE021M D2 ON D1.AUD_YR = D2.AUD_YR
                                                                                   AND D1.TSK_NO = D2.TSK_NO
                                                                                 WHERE D1.LUNH_DT IS NOT NULL
                                                                                   AND D1.CMPT_DT IS NOT NULL
                                                                                   AND D1.AUD_YR = #strAudYr#
                                                                                   AND D1.TSK_NO = #strTskNo#
                                                                                   AND (D1.CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                          AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                              GROUP BY D1.AUD_YR, D2.AUD_KND_CD ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND (D2.AUD_STEP_ST_CD <= '10005' AND D2.AUD_STEP_END_CD <= '10005')
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                    ) D2
                                    , (
                                             SELECT (SELECT MIN(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND LUNH_DT IS NOT NULL) AS AUD_STEP_ST_CD ,
                                                                                       (SELECT MAX(AUD_STEP_CD)
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND CMPT_DT IS NOT NULL) AS AUD_STEP_END_CD ,
                                                                                               AUD_YR ,
                                                                                               TSK_NO 
                                                                                          FROM TBCSPAOE022M
                                                                                         WHERE LUNH_DT IS NOT NULL
                                                                                           AND CMPT_DT IS NOT NULL
                                                                                           AND AUD_YR = #strAudYr#
                                                                                           AND TSK_NO = #strTskNo#
                                                                                           AND (CMPT_DT BETWEEN (select EVL_STR_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#)
                                                                                                                AND (select EVL_END_DT from TBCSPAOE001M where EVL_YR = #strEvlYr# and HLYR_DVSN_CD = #strHlyrDvsnCd#))
                                                                                         GROUP BY AUD_YR, TSK_NO
                                    ) D3
                              ) D3  /*심의실 포함 안 한 감사단장 이전 추진율 및 심의실 이후 추진율*/
			     ) D7
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사업무평점 상세 조회 -->
	<select id="CSPAOE047EDtlYSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[   
        	SELECT A.EVL_YR
        	     , A.HLYR_DVSN_CD
        	     , A.TSK_DVSN_CD
        	     , A.AUD_YR
        	     , A.TSK_NO
        	     , A.DGE
        	     , A.EVL_CLU_CD1
        	     , A.MNDY_CNT
        	     , A.SYT_TRTM_YN
        	     , A.AUD_KND_CD
        	     , A.STND_ASC
        	     , A.EVL_CLU_CD2
        	     , A.SYT_EVL_RK_CD
        	     , A.SYT_EVL_ADVL_VAL
        	     , A.EVL_CLU_CD3
        	     , A.AUD_ST_STEP_CD
        	     , A.AUD_END_STEP_CD
        	     , A.DRIVE_RTE
        	     , B.AUD_STEP_YN
        	     , B.AUD_STEP_ST_DRIVE_RTE AS ST_DRIVE_RTE
			     , B.AUD_STEP_END_DRIVE_RTE AS END_DRIVE_RTE
        	     , A.EVL_CLU_CD4
        	     , A.HNDL_PRD_DVSN_CD
        	     , A.HNDL_PRD_DCN
        	     , A.ASP_RTE
        	     , A.EVL_CLU_CD5
        	     , A.SPE_ADP_CLU_CD
        	     , A.SPE_ADD_SC
        	     , A.EVL_CLU_CD6
        	     , A.MDT_ASC
        	     , A.FML_TXT
        	     , A.FNL_ASC
        	FROM (    
					SELECT D1.EVL_YR
					     , D1.HLYR_DVSN_CD
					     , D1.TSK_DVSN_CD
					     , D1.AUD_YR
					     , D1.TSK_NO
					     , D1.DGE
					     , D1.EVL_CLU_CD_1 AS EVL_CLU_CD1
					     , D1.MNDY_CNT
					     , D1.SYT_TRTM_YN
					     , D1.AUD_KND_CD
					     , D1.STND_ASC
					     , D1.EVL_CLU_CD_2 AS EVL_CLU_CD2
					     , D1.AUD_TSK_EVL_RK_CD AS SYT_EVL_RK_CD
					     , D1.ADVL_VAL AS SYT_EVL_ADVL_VAL
					     , D1.EVL_CLU_CD_3 AS EVL_CLU_CD3
					     , D1.AUD_STEP_FNDT_CD AS AUD_ST_STEP_CD
					     , D1.AUD_STEP_TEND_CD AS AUD_END_STEP_CD
					     , D1.DRIVE_RTE
					     , D1.EVL_CLU_CD_4 AS EVL_CLU_CD4
					     , D1.HNDL_PRD_DVSN_CD
					     , D1.HNDL_PRD_DCN
					     , D1.ASP_RTE
					     , D1.EVL_CLU_CD_5 AS EVL_CLU_CD5
					     , D1.SPE_ADP_CLU_CD
					     , NVL(D1.SPE_ADD_SC, 0) AS SPE_ADD_SC
					     , D1.EVL_CLU_CD_6 AS EVL_CLU_CD6
					     , NVL(D1.MDT_ASC, 0) AS MDT_ASC
					     , D2.FML_TXT
					     , NVL(ROUND(F_TSK_ASC_SUM(D1.TSK_DVSN_CD, D2.FML_TXT, D1.STND_ASC, D1.ADVL_VAL, D1.DRIVE_RTE/100, D1.STND_ASC*D1.ADVL_VAL*(D1.DRIVE_RTE/100)*D3.ASP_RTE, NVL(D1.SPE_ADD_SC,0), NVL(D1.MDT_ASC,0)),2),0) AS FNL_ASC
					FROM TBCSPAOE033M D1
					   , (
				            SELECT EVL_YR
				                 , HLYR_DVSN_CD
				                 , TSK_DVSN_CD
				                 , FML_TXT
				            FROM TBCSPAOE013M
				            WHERE EVL_YR = #strEvlYr#
				              AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				              AND TSK_DVSN_CD = #strTskDvsnCd#
			             ) D2
			           , (
			           		SELECT EVL_YR
			             		 , HLYR_DVSN_CD
						         , TSK_DVSN_CD
						         , AUD_YR
						         , TSK_NO
						         , HNDL_PRD_DVSN_CD
						         , HNDL_PRD_DCN
						         , CASE WHEN HNDL_PRD_DVSN_CD = '100' THEN ASP_RTE/100
						                ELSE -(ASP_RTE/100) END AS ASP_RTE
						      FROM TBCSPAOE033M
						     WHERE EVL_YR = #strEvlYr#
						       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
						       AND TSK_DVSN_CD = #strTskDvsnCd#
						       AND AUD_YR = #strAudYr#
						       AND TSK_NO = #strTskNo#
						       AND DGE = (
								             SELECT MAX(DGE) AS CNT
								               FROM TBCSPAOE033M
								              WHERE EVL_YR = #strEvlYr#
								                AND HLYR_DVSN_CD = #strHlyrDvsnCd#
								                AND TSK_DVSN_CD = #strTskDvsnCd#
								                AND AUD_YR = #strAudYr#
								                AND TSK_NO = #strTskNo#
							             )
					     ) D3
					WHERE D1.EVL_YR = D2.EVL_YR
					  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
					  AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
					  AND D1.EVL_YR = d3.EVL_YR
					  AND D1.HLYR_DVSN_CD = d3.HLYR_DVSN_CD
					  AND D1.TSK_DVSN_CD = d3.TSK_DVSN_CD
					  AND D1.AUD_YR = d3.AUD_YR
					  AND D1.TSK_NO = d3.TSK_NO
					  AND D1.EVL_YR = #strEvlYr#
					  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
					  AND D1.TSK_DVSN_CD = #strTskDvsnCd#
					  AND D1.AUD_YR = #strAudYr#
					  AND D1.TSK_NO = #strTskNo#
			 ORDER BY D1.DGE DESC
			) A
		  , (
                            SELECT D1.AUD_STEP_YN   /*감사기초단계 ~ 감사기말단계에서 심의실 포함 여부*/
                                 , CASE WHEN D1.AUD_STEP_YN = 'Y' THEN D2.AUD_STEP_ST_DRIVE_RTE ELSE D3.AUD_STEP_ST_DRIVE_RTE END AS AUD_STEP_ST_DRIVE_RTE  /*감사단장 이전 추진율*/
                                 , CASE WHEN D1.AUD_STEP_YN = 'N' THEN D3.AUD_STEP_END_DRIVE_RTE ELSE D2.AUD_STEP_END_DRIVE_RTE END AS AUD_STEP_END_DRIVE_RTE   /*심의실 이후 추진율*/
                            FROM (
                                                SELECT CASE WHEN COUNT(*) = 1 THEN 'Y' ELSE 'N' END AS AUD_STEP_YN
                                                        FROM (
                                                                                SELECT A.*
                                                                                 FROM (SELECT D1.AUD_STEP_FNDT_CD AS AUD_STEP_ST_CD ,
                                                                                              D1.AUD_STEP_TEND_CD AS AUD_STEP_END_CD ,
                                                                                              D1.AUD_YR ,
                                                                                              D1.AUD_KND_CD
                                                                                         FROM TBCSPAOE033M D1 
                                                                                        WHERE D1.AUD_YR = #strAudYr#
                                                                                          AND D1.TSK_NO = #strTskNo#
                                                                                     ORDER BY D1.DGE DESC
                                                                                ) A
                                                                                WHERE ROWNUM =1
                                                            ) D1
                                                        WHERE '10006' BETWEEN D1.AUD_STEP_ST_CD AND D1.AUD_STEP_END_CD
                            ) D1
                            , (
                                    /*심의실 포함한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                                    SELECT D1.AUD_STEP_ST_DRIVE_RTE
                                         , D2.AUD_STEP_END_DRIVE_RTE
                                    FROM
                                    (
                                                                /*감사기초단계 ~ 감사기말단계에서 심의실 포함하고 감사단장 이전에 대한 추진율 구하는 쿼리*/
                                                                SELECT NVL(SUM(D1.DRIVE_RTE), 0) AS AUD_STEP_ST_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT A.*
                                                                                 FROM (SELECT D1.AUD_STEP_FNDT_CD AS AUD_STEP_ST_CD ,
                                                                                              D1.AUD_STEP_TEND_CD AS AUD_STEP_END_CD ,
                                                                                              D1.AUD_YR ,
                                                                                              D1.AUD_KND_CD
                                                                                         FROM TBCSPAOE033M D1 
                                                                                        WHERE D1.AUD_YR = #strAudYr#
                                                                                          AND D1.TSK_NO = #strTskNo#
                                                                                     ORDER BY D1.DGE DESC
                                                                                ) A
                                                                                WHERE ROWNUM =1
                                                                               ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND '10006' BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND '10005'
                                           ) D1
                                         , (
                                                                /*감사기초단계 ~ 감사기말단계에서 심의실 포함하고 심의실 이후에 대한 추진율 구하는 쿼리*/
                                                                SELECT NVL(SUM(D1.DRIVE_RTE), 0) AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT A.*
                                                                                 FROM (SELECT D1.AUD_STEP_FNDT_CD AS AUD_STEP_ST_CD ,
                                                                                              D1.AUD_STEP_TEND_CD AS AUD_STEP_END_CD ,
                                                                                              D1.AUD_YR ,
                                                                                              D1.AUD_KND_CD
                                                                                         FROM TBCSPAOE033M D1 
                                                                                        WHERE D1.AUD_YR = #strAudYr#
                                                                                          AND D1.TSK_NO = #strTskNo#
                                                                                     ORDER BY D1.DGE DESC
                                                                                ) A
                                                                                WHERE ROWNUM =1
                                                                              ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND '10006' BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                                                           AND D1.AUD_STEP_CD BETWEEN '10006' AND D2.AUD_STEP_END_CD
                                           ) D2
                              ) D2  /*심의실 포함한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                            , (
                                    /*심의실 포함 안 한 감사단장 이전 추진율 및 심의실 이후 추진율*/
                                    SELECT CASE WHEN (D3.AUD_STEP_ST_CD <= '10005' AND D3.AUD_STEP_END_CD <= '10005') THEN D2.AUD_STEP_ST_DRIVE_RTE ELSE D1.AUD_STEP_ST_DRIVE_RTE END AS AUD_STEP_ST_DRIVE_RTE
                                         , CASE WHEN (D3.AUD_STEP_ST_CD >= '10006' AND D3.AUD_STEP_END_CD >= '10006') THEN D1.AUD_STEP_END_DRIVE_RTE ELSE D2.AUD_STEP_END_DRIVE_RTE END AS AUD_STEP_END_DRIVE_RTE
                                    FROM (
                                    /*감사기초단계 ~ 감사기말단계에서 심의실 포함 안하고 심의실 이후에 대한 추진율 구하는 쿼리*/
                                    SELECT 0 AS AUD_STEP_ST_DRIVE_RTE
                                         , NVL(SUM(D1.DRIVE_RTE), 0) AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT A.*
                                                                                 FROM (SELECT D1.AUD_STEP_FNDT_CD AS AUD_STEP_ST_CD ,
                                                                                              D1.AUD_STEP_TEND_CD AS AUD_STEP_END_CD ,
                                                                                              D1.AUD_YR ,
                                                                                              D1.AUD_KND_CD
                                                                                         FROM TBCSPAOE033M D1 
                                                                                        WHERE D1.AUD_YR = #strAudYr#
                                                                                          AND D1.TSK_NO = #strTskNo#
                                                                                     ORDER BY D1.DGE DESC
                                                                                ) A
                                                                                WHERE ROWNUM =1
                                                                              ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND (D2.AUD_STEP_ST_CD >= '10006' AND D2.AUD_STEP_END_CD >= '10006')
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                            ) D1
                            , (
                                    /*감사기초단계 ~ 감사기말단계에서 심의실 포함 안하고 감사단장 이전에 대한 추진율 구하는 쿼리*/
                                    SELECT NVL(SUM(D1.DRIVE_RTE), 0) AS AUD_STEP_ST_DRIVE_RTE
                                         , 0 AS AUD_STEP_END_DRIVE_RTE
                                                                          FROM TBCSPAOE008D D1,
                                                                               (SELECT A.*
                                                                                 FROM (SELECT D1.AUD_STEP_FNDT_CD AS AUD_STEP_ST_CD ,
                                                                                              D1.AUD_STEP_TEND_CD AS AUD_STEP_END_CD ,
                                                                                              D1.AUD_YR ,
                                                                                              D1.AUD_KND_CD
                                                                                         FROM TBCSPAOE033M D1 
                                                                                        WHERE D1.AUD_YR = #strAudYr#
                                                                                          AND D1.TSK_NO = #strTskNo#
                                                                                     ORDER BY D1.DGE DESC
                                                                                ) A
                                                                                WHERE ROWNUM =1
                                                                              ) D2
                                                                         WHERE D1.AUD_KND_CD = D2.AUD_KND_CD
                                                                           AND D1.EVL_YR = #strEvlYr#
                                                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
                                                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
                                                                           AND (D2.AUD_STEP_ST_CD <= '10005' AND D2.AUD_STEP_END_CD <= '10005')
                                                                           AND D1.AUD_STEP_CD BETWEEN D2.AUD_STEP_ST_CD AND D2.AUD_STEP_END_CD
                                    ) D2
                                    , (
                                             SELECT A.*
                                                                                 FROM (SELECT D1.AUD_STEP_FNDT_CD AS AUD_STEP_ST_CD ,
                                                                                              D1.AUD_STEP_TEND_CD AS AUD_STEP_END_CD ,
                                                                                              D1.AUD_YR ,
                                                                                              D1.AUD_KND_CD
                                                                                         FROM TBCSPAOE033M D1 
                                                                                        WHERE D1.AUD_YR = #strAudYr#
                                                                                          AND D1.TSK_NO = #strTskNo#
                                                                                     ORDER BY D1.DGE DESC
                                                                                ) A
                                                                                WHERE ROWNUM =1
                                    ) D3
                              ) D3  /*심의실 포함 안 한 감사단장 이전 추진율 및 심의실 이후 추진율*/
         ) B
			WHERE ROWNUM = 1
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사업무평점 : 표준평점 조회 -->
	<select id="CSPAOE047EStndAscSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
                    SELECT ROUND(
			                       case when #strAudStepYn# = 'Y' then
			                                                           CASE WHEN #strSytTrtmYn# = 'Y' THEN NVL(F_GET_CAL(D2.SYT_TRTM_STND_ASC_FML_TXT, '200'), 0)
			                                                                ELSE NVL(F_GET_CAL(D2.IDVT_TRTM_STND_ASC_FML_TXT, '200'), 0)
			                                                           END
			                            when #strAudStepYn# = 'N' then NVL(F_GET_CAL(D2.STND_ASC_FML_TXT, '200'), 0)
			                       end, 2) AS STND_ASC	/*표준평점*/
		                FROM(
		                        SELECT D2.EVL_YR ,
		                                               D2.HLYR_DVSN_CD ,
		                                               D2.AUD_KND_CD ,
		                                               D2.STND_ASC_FML_TXT ,    /*국단장 이전 표준평점수식*/
		                                               D2.SYT_TRTM_STND_ASC_FML_TXT,    /*심의실 이후 종합처리안 표준평점수식*/
		                                               D2.IDVT_TRTM_STND_ASC_FML_TXT    /*심의실 이후 개별처리안 표준평점수식*/
		                                          FROM TBCSPAOE004M D1 ,
		                                               TBCSPAOE044M D2
		                                         WHERE D1.EVL_YR = D2.EVL_YR
		                                           AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
		                                           AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
		                                           AND D1.AUD_KND_CD = D2.AUD_KND_CD
		                                           AND D1.EVL_YR = #strEvlYr#
		                                           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
		                                           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
		                                           AND D1.AUD_KND_CD = #strAudKndCd#
		                                           AND #strMndyCnt# BETWEEN D2.MNDY_CNT_1 AND D2.MNDY_CNT_2  
		                      ) D2  /*표준평점 수식*/
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사업무평점 : 합계지표 가중치 조회 -->
	<select id="CSPAOE047ESumIndexValSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT SUM_INDEX_VAL
			  FROM TBCSPAOE010D
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = #strTskDvsnCd#
			   AND AUD_TSK_KND_CD = #strAudTskKndCd#
			   AND RK_CD = #strRkCd#
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사업무평점 : 추진율 조회 -->
	<select id="CSPAOE047EDriveRteSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT NVL(A.ST_DRIVE_RTE, 0)  AS ST_DRIVE_RTE      /*국단장 감사단계 이전 추진율*/
			     , NVL(B.END_DRIVE_RTE, 0) AS END_DRIVE_RTE 	/*심의실 감사단계 이후 추진율 2015.03.16 NVL처리 안해줘서 오류있었음.*/
			FROM
			(
			    SELECT SUM(DRIVE_RTE) AS ST_DRIVE_RTE
			      FROM TBCSPAOE008D
			     WHERE EVL_YR = #strEvlYr#
			       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			       AND TSK_DVSN_CD = #strTskDvsnCd#
			       AND AUD_KND_CD = #strAudKndCd#
			       AND AUD_STEP_CD BETWEEN #strAudStStepCd# AND CASE WHEN TO_NUMBER(#strAudEndStepCd#) <= 10005 THEN #strAudEndStepCd# ELSE '10005' END
			) A,
			(
			    SELECT SUM(DRIVE_RTE) AS END_DRIVE_RTE
			      FROM TBCSPAOE008D
			     WHERE EVL_YR = #strEvlYr#
			       AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			       AND TSK_DVSN_CD = #strTskDvsnCd#
			       AND AUD_KND_CD = #strAudKndCd#
			       AND AUD_STEP_CD BETWEEN CASE WHEN TO_NUMBER(#strAudStStepCd#) >= 10006 THEN #strAudStStepCd# ELSE '10006' END AND #strAudEndStepCd#
			) B
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사업무평점 : 가감점율 조회 -->
	<select id="CSPAOE047EAspRteSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT ASP_RTE
			  FROM TBCSPAOE012M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND HNDL_PRD_DVSN_CD = #strHndlPrdDvsnCd#
			   AND HNDL_PRD_DCN = #strHndlPrdDcn#
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사업무평점 : 특별가산점 조회 -->
	<select id="CSPAOE047ESpeAddScSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT CLU_SC AS SPE_ADD_SC
			  FROM TBCSPAOE011M
			  WHERE 1=1
			    AND EVL_YR = #strEvlYr#
			    AND HLYR_DVSN_CD = #strHlyrDvsnCd#
				AND CLU_CD = #strCluCd#
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사업무평점 시뮬레이션 신규등록 -->
	<insert id="CSPAOE047EMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE033M
		(
			  EVL_YR
			, HLYR_DVSN_CD
			, TSK_DVSN_CD
			, AUD_YR
			, TSK_NO
			, DGE
			, EVL_CLU_CD_1
			, AUD_KND_CD
			, MNDY_CNT
			, SYT_TRTM_YN
			, STND_ASC
			, EVL_CLU_CD_2
			, AUD_TSK_EVL_RK_CD
			, ADVL_VAL
			, EVL_CLU_CD_3
			, AUD_STEP_FNDT_CD
			, AUD_STEP_TEND_CD
			, DRIVE_RTE
			, EVL_CLU_CD_4
			, HNDL_PRD_DVSN_CD
			, HNDL_PRD_DCN
			, ASP_RTE
			, EVL_CLU_CD_5
			, SPE_ADP_CLU_CD
			, SPE_ADD_SC
			, EVL_CLU_CD_6
			, MDT_ASC
			, EVL_CLU_CD_7
			, TSK_KND_CD
			, BSC_ASC
			, EVL_CLU_CD_8
			, NAUD_TSK_EVL_RK_CD
			, NAUD_TSK_ADVL_VAL
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES 
		(
			  #EVL_YR#
			, #HLYR_DVSN_CD#
			, #TSK_DVSN_CD#
			, #AUD_YR#
			, #TSK_NO#
			, (SELECT CASE WHEN MAX(DGE) IS NULL THEN 1
				      ELSE MAX(DGE)+1 END AS DGE
				 FROM TBCSPAOE033M
				WHERE EVL_YR = #EVL_YR#
				  AND HLYR_DVSN_CD = #HLYR_DVSN_CD#)
			, #EVL_CLU_CD1#
			, #AUD_KND_CD#
			, #MNDY_CNT#
			, #SYT_TRTM_YN#
			, #STND_ASC#
			, #EVL_CLU_CD2#
			, #SYT_EVL_RK_CD#
			, #SYT_EVL_ADVL_VAL#
			, #EVL_CLU_CD3#
			, #AUD_ST_STEP_CD#
			, #AUD_END_STEP_CD#
			, #DRIVE_RTE#
			, #EVL_CLU_CD4#
			, #HNDL_PRD_DVSN_CD#
			, #HNDL_PRD_DCN#
			, #ASP_RTE#
			, #EVL_CLU_CD5#
			, #SPE_ADP_CLU_CD#
			, #SPE_ADD_SC#
			, #EVL_CLU_CD6#
			, #MDT_ASC#
			, #EVL_CLU_CD7#
			, #TSK_KND_CD#
			, #BSC_ASC#
			, #EVL_CLU_CD8#
			, #NAUD_TSK_EVL_RK_CD#
			, #NAUD_TSK_ADVL_VAL#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사사항별 평가관리-감사외업무평점 조회 -->
	<select id="CSPAOE047EParamSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D2.EVL_YR
			     , D2.HLYR_DVSN_CD
			     , D2.TSK_DVSN_CD
			     , D2.AUD_TSK_KND_CD
			     , D2.AUD_YR
			     , D2.TSK_NO
			     , D3.TSK_NM
			     , D2.TSK_ASC
			     , D2.EVL_STEP_CD
			     , D2.EVL_CMTR_DVSN_CD
			     , D2.TSK_ASC
			     , F_DPT_INFO(D3.CHR_DPT_CD, '1') AS CHR_DPT_NM
			  FROM TBCSPAOE029M D2
			       LEFT JOIN TBCSPAOE033M D1
			         	  ON D1.EVL_YR = D2.EVL_YR
			        	  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			        	  AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
			        	  AND D1.AUD_YR = D2.AUD_YR
			        	  AND D1.TSK_NO = D2.TSK_NO
			     , TBCSPAOE024M D3 
			 WHERE D2.EVL_YR = D3.EVL_YR
			   AND D2.HLYR_DVSN_CD = D3.HLYR_DVSN_CD
			   AND D2.AUD_TSK_KND_CD = D3.TSK_KND_CD
			   AND D2.AUD_YR = D3.EVL_YR
			   AND D2.TSK_NO = D3.TSK_NO  
			   AND D2.EVL_YR = #strEvlYr#
			   AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND D2.TSK_DVSN_CD = '10001'	/*감사외업무평점*/
			   AND D2.EVL_CMTR_DVSN_CD IN ('CD08','CD10','CD12','CD14','CD16','CD18','CD20','CD22','CD24','CD26','CD28','CD30','CD32') 
	    ]]>
		<isNotEmpty prepend="AND" property="strAudYr">
			D2.AUD_YR = #strAudYr#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strTskNo">
			D2.TSK_NO = #strTskNo#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			D3.TSK_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<![CDATA[
	     GROUP BY D2.EVL_YR, D2.HLYR_DVSN_CD, D2.TSK_DVSN_CD, D2.AUD_TSK_KND_CD, D2.AUD_YR, D2.TSK_NO, D3.TSK_NM, D2.TSK_ASC, D2.EVL_STEP_CD, D2.EVL_CMTR_DVSN_CD, D2.SYT_EVL_RK_CD, D2.SYT_EVL_ADVL_VAL, D3.CHR_DPT_CD
         ORDER BY D3.CHR_DPT_CD
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사외업무평점 : 표준평점 조회 -->
	<select id="CSPAOE047ENAudStndAscSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT STND_ASC
			  FROM TBCSPAOE006M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = #strTskDvsnCd#
			   AND TSK_KND_CD = #strAudKndCd#
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사외업무평점 : 가중치 조회 -->
	<select id="CSPAOE047EIdvtIndexValSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT IDVT_INDEX_VAL
			  FROM TBCSPAOE010D
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = #strTskDvsnCd#
			   AND AUD_TSK_KND_CD = #strAudTskKndCd#
			   AND RK_CD = #strRkCd#
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사외업무평점 상세 조회 -->
	<select id="CSPAOE047EDtlParamNSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT #strEvlYr# AS EVL_YR
			     , #strHlyrDvsnCd# AS HLYR_DVSN_CD
			     , #strTskDvsnCd# AS TSK_DVSN_CD
			     , #strAudYr# as AUD_YR
			     , #strTskNo# AS TSK_NO
			     , D1.EVL_CLU_CD7
			     , D1.AUD_TSK_KND_CD AS TSK_KND_CD
			     , D1.STND_ASC AS BSC_ASC
			     , D2.EVL_CLU_CD8
			     , D2.SYT_EVL_RK_CD AS NAUD_TSK_EVL_RK_CD
			     , D2.SYT_EVL_ADVL_VAL AS NAUD_TSK_ADVL_VAL
			FROM (
					SELECT 'CD011' AS EVL_CLU_CD7
			             , D1.AUD_TSK_KND_CD
			             , D2.STND_ASC
			          FROM TBCSPAOE029M D1
			             , TBCSPAOE006M D2
			         WHERE D1.EVL_YR = D2.EVL_YR
					   AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
					   AND D1.AUD_TSK_KND_CD = D2.TSK_KND_CD
			           AND D2.EVL_YR = #strEvlYr#
			           AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND D2.TSK_DVSN_CD = #strTskDvsnCd#
			           AND D2.TSK_KND_CD = #strAudKndCd#
			     ) D1
			   , (
			        SELECT 'CD012' AS EVL_CLU_CD8
			              , D1.EVL_RK_CD AS SYT_EVL_RK_CD
			              , D2.IDVT_INDEX_VAL AS SYT_EVL_ADVL_VAL
			          FROM TBCSPAOE029M D1
			             , TBCSPAOE010D D2
			         WHERE D1.EVL_YR = D2.EVL_YR
			           AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			           AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
			           AND D1.AUD_TSK_KND_CD = D2.AUD_TSK_KND_CD
			           AND D1.EVL_RK_CD = D2.RK_CD
			           AND D1.EVL_YR = #strEvlYr#
			           AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			           AND D1.TSK_DVSN_CD = #strTskDvsnCd#
			           AND D1.AUD_TSK_KND_CD = #strAudKndCd#
			           AND D1.EVL_STEP_CD = #strEvlStepCd#
			           AND D1.AUD_YR = #strAudYr#
			           AND D1.TSK_NO = #strTskNo#
			           AND D1.EVL_CMTR_DVSN_CD = #strEvlCmtrDvsnCd#
			     ) D2
		   WHERE ROWNUM = 1
		]]>
	</select>

	<!-- 감사사항별 평가관리-감사외업무평점 상세 조회 -->
	<select id="CSPAOE047EDtlParamYSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.EVL_YR
			     , D1.HLYR_DVSN_CD
			     , D1.TSK_DVSN_CD
			     , D1.AUD_YR
			     , D1.TSK_NO
			     , D1.DGE
			     , D1.EVL_CLU_CD_7 AS EVL_CLU_CD7
			     , D1.TSK_KND_CD
			     , D1.BSC_ASC
			     , D1.EVL_CLU_CD_8 AS EVL_CLU_CD8
			     , D1.NAUD_TSK_EVL_RK_CD
			     , D1.NAUD_TSK_ADVL_VAL
			     , D2.FML_TXT
			     , NVL(ROUND(F_TSK_ASC_SUM(D1.TSK_DVSN_CD, D2.FML_TXT, D1.BSC_ASC, D1.NAUD_TSK_ADVL_VAL, NULL, NULL, NULL, NULL),2),0) AS FNL_ASC
			FROM TBCSPAOE033M D1
			   , (
		            SELECT EVL_YR
		                 , HLYR_DVSN_CD
		                 , TSK_DVSN_CD
		                 , FML_TXT
		            FROM TBCSPAOE013M
		            WHERE EVL_YR = #strEvlYr#
		              AND HLYR_DVSN_CD = #strHlyrDvsnCd#
		              AND TSK_DVSN_CD = #strTskDvsnCd#
	             ) D2
			WHERE D1.EVL_YR = D2.EVL_YR
			  AND D1.HLYR_DVSN_CD = D2.HLYR_DVSN_CD
			  AND D1.TSK_DVSN_CD = D2.TSK_DVSN_CD
			  AND D1.EVL_YR = #strEvlYr#
			  AND D1.HLYR_DVSN_CD = #strHlyrDvsnCd#
			  AND D1.TSK_DVSN_CD = #strTskDvsnCd#
			  AND D1.AUD_YR = #strAudYr#
			  AND D1.TSK_NO = #strTskNo#
			  AND D1.DGE = (
			                SELECT MAX(DGE) AS CNT
			                  FROM TBCSPAOE033M
			                 WHERE EVL_YR = #strEvlYr#
			                   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			                   AND TSK_DVSN_CD = #strTskDvsnCd#
			                   AND AUD_YR = #strAudYr#
			                   AND TSK_NO = #strTskNo#
			                   AND ROWNUM = 1
			               )
		]]>
	</select>

	<!-- 감사업무관리(연계)-감사사항 데이터 조회 -->
	<select id="CSPAOE016EFrfMainCntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TO_CHAR(COUNT(MNDY_CNT)) AS CNT
			  FROM TBCSPAOE021M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
		]]>
	</select>

	<!-- 감사업무관리(연계)-업무현황 조회 -->
	<select id="CSPAOE016EFrfMainNSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			  SELECT A.AUD_YR
			       , A.AUD_NO AS TSK_NO
			       , A.AUD_YR||'-'||A.AUD_NO AS TSK_YR_NO    /*감사연번호*/
			       , AUD_SBJ_NM                              /*감사사항명*/
			       , DPT_CD AS HNDL_DIV_DPT_CD   /*주관국과(처리과)코드*/
			       , DPT_NM AS HNDL_DIV_DPT_NM                                  /*주관국과(처리과)*/
			       , F_ORG_INFO(B.ORG_CD,'1') ||CASE WHEN NVL(B.ORG_CNT,0)-1  > 0 then ' 외' || (B.ORG_CNT -1)  end as TG_ORG_NM  /*대상기관*/
			       , CASE WHEN SUBSTR(A.AUD_KND_CD,-1) = '1' THEN '10001'
			              WHEN SUBSTR(A.AUD_KND_CD,-1) = '6' THEN '10002'
			              WHEN SUBSTR(A.AUD_KND_CD,-1) = '4' THEN '10003'
			              WHEN SUBSTR(A.AUD_KND_CD,-1) = '0' THEN '10004'
			              WHEN SUBSTR(A.AUD_KND_CD,-1) = '2' THEN '10004'
			              WHEN SUBSTR(A.AUD_KND_CD,-1) = '3' THEN '10006'
			              ELSE ''
			         END AS AUD_KND_CD   /*감사종류코드*/
			       , F_CODE_NM('1000007',A.AUD_KND_CD)      AUD_KND_CD_NM   /*감사종류명*/
			       , '' AS AUD_STEP_CD
			       , A.TOT_DRTR_BRDV_CD AS AUD_LDR_BLT_DPT_CD  /* 감사반장 소속부서코드*/
			       , A.TOT_DRTR_RANK_CD AS AUD_LDR_RANK_CD             /* 감사반장 직급코드*/
			       , A.LEADER_POS_CLASS_NM           /* 감사반장 직급명*/
			       , A.AUD_TOT_DRTR_CNB AS AUD_LDR_CNB              /* 감사반장 전산번호*/
			       , A.LEADER_NM AS AUD_LDR_NM                    /* 감사반장 이름*/
			       , A.SPVR_BRDV_CD AS SPVR_BLT_DPT_CD /* 주관자 소속부서코드*/
			       , A.SPVR_RANK_CD                  /* 주관자 직급코드*/
			       , A.SPVR_CLASS_NM                 /* 주관자 직급명*/
			       , A.SPVR_CNB                      /* 주관자 전산번호*/
			       , A.SPVR_NM                       /* 주관자 이름*/
			       , A.AST_BRDV_CD AS AST_BLT_DPT_CD /* 보조자 소속부서코드*/
			       , A.AST_RANK_CD                   /* 보조자 직급코드*/       
			       , A.AST_CLASS_NM                  /* 보조자 직급명*/
			       , A.AST_CNB                       /* 보조자 전산번호*/
			       , A.AST_NM                        /* 보조자 이름*/
			       , A.AUD_DCN AS TOT_AUD_OP_PRD_DCN        /* 총감사운영기간일*/
			       , C.IN_PSON_MAN_DAY AS MNDY_CNT               /* 연인원*/
			       , C.IN_PSON_CNT AS STUT_NOP_CNT                  /* 단계별인원*/
			       , C.AUD_DCN AS STUT_PRD_DCN                      /* 단계별 기간일*/
			       , SUBSTR(D.SUM_ALL,1,LENGTH(D.SUM_ALL)-3) AS BZT_AM	/* 출장여비*/
			       , '' AS RSV_INSPC_LUNH_DT
			       , '' AS ENF_DT
			       , '' AS DLAY_DT_NM
			       , '' AS EXET_DCN
			 FROM
			     (
			        SELECT   A.AUD_YR
			               , A.AUD_NO
			               , MAX(A.SPV_BRDV_CD) DPT_CD  /*주관국과코드*/
			               , F_DPT_INFO(MAX(A.SPV_BRDV_CD),'1') DPT_NM  /*주관국과*/       
			               , A.TOT_DRTR_BRDV_CD  /*감사반장 소속부서코드*/
			               , MAX(TOT_DRTR_RANK_CD) AS TOT_DRTR_RANK_CD /* 감사반장 직급코드*/  
			               , MAX(A.TOT_DRTR_RANK_CD)
			               , F_CODE_NM('1000173',MAX(A.TOT_DRTR_RANK_CD)) AS LEADER_POS_CLASS_NM  /*감사반장 직급명*/
			               , MAX(A.AUD_TOT_DRTR_CNB) AS AUD_TOT_DRTR_CNB/*감사반장 전산번호*/
			               , F_USR_INFO(MAX(A.AUD_TOT_DRTR_CNB),'2') AS LEADER_NM  /*감사반장 이름*/
			               , A.SPVR_BRDV_CD  /*주관자 소속부서코드*/
			               , MAX(A.SPVR_RANK_CD) AS SPVR_RANK_CD /*주관자 직급코드*/       
			               , F_CODE_NM('1000173',MAX(A.SPVR_RANK_CD)) AS SPVR_CLASS_NM  /*주관자 직급명*/
			               , MAX(A.SPVR_CNB) SPVR_CNB /*주관자 전산번호*/
			               , F_USR_INFO(MAX(A.SPVR_CNB),'2') AS SPVR_NM  /*주관자 이름*/   
			               , A.AST_BRDV_CD   /*보조자 소속부서코드*/
			               , MAX(A.AST_RANK_CD) AS AST_RANK_CD  /*보조자 직급코드*/       
			               , F_CODE_NM('1000173',MAX(A.AST_RANK_CD)) AS AST_CLASS_NM /*보조자 직급명*/
			               , MAX(A.AST_CNB) AS  AST_CNB/*보조자 전산번호*/
			               , F_USR_INFO(MAX(A.AST_CNB),'2') AS AST_NM  /*보조자 이름*/
			               , MAX(AUD_BZT_KND_CD) AUD_BZT_KND_CD 
			               , MAX(AUD_KND_CD) AUD_KND_CD
			               , min(B.AUD_STR_DT) as AUD_STR_DT
			               , max(B.AUD_END_DT) as AUD_END_DT
			               , sum(B.AUD_DCN) AS AUD_DCN
			               , MAX(AUD_SBJ_NM) AS AUD_SBJ_NM
			        FROM TBBADDED001M A
			           , TBBADDED002M B 
			        WHERE A.AUD_YR = B.REL_AUD_YR
			          AND A.AUD_NO = B.REL_AUD_NO
			          AND BZT_DVSN_CD ='1'
			          AND A.AUD_YR = #strAudYr#
			          AND A.AUD_NO = #strTskNo# 
			          GROUP BY A.AUD_YR, A.AUD_NO, A.TOT_DRTR_BRDV_CD, A.SPVR_BRDV_CD, A.AST_BRDV_CD
			        )  A		        
			      , (
			        SELECT B.REL_AUD_YR
			             , B.REL_AUD_NO
			             ,  MIN(ORG_CD) ORG_CD
			             ,  COUNT(DISTINCT ORG_CD) AS ORG_CNT
			         FROM TBBADDED008L A
			            , TBBADDED002M B
			         WHERE A.BZT_YR = B.BZT_YR
			           and A.BZT_SNO = B.BZT_SNO
			           AND B.AUD_BZT_KND_CD = (SELECT MAX(AUD_BZT_KND_CD) AS AUD_BZT_KND_CD
												 		 FROM TBBADDED002M
												 		WHERE REL_AUD_YR = #strAudYr#
												   		  AND REL_AUD_NO = #strTskNo#
												   		  AND AUD_BZT_KND_CD IN ('01','02'))
			           AND REL_AUD_YR = #strAudYr#
			           AND REL_AUD_NO = #strTskNo#
			         GROUP BY REL_AUD_YR, REL_AUD_NO
			        ) B
			      , (  SELECT   REL_AUD_YR
                              , REL_AUD_NO
                              ,SUBSTR(EXTRACT(xmlagg(XMLELEMENT(A,'  '||AUD_BZT_KND_NM||' '||FLD_AUD_STEP_NO||'단계('||AUD_DCN||'일)') ORDER BY  A.FLD_AUD_STEP_NO),'//text()'),2) AS AUD_DCN
                              , max(IN_PSON_MAN_DAY) IN_PSON_MAN_DAY
                              ,SUBSTR(EXTRACT(xmlagg(XMLELEMENT(A,'  '||AUD_BZT_KND_NM||' '||FLD_AUD_STEP_NO||'단계('||IN_PSON_CNT||'명)') ORDER BY  A.FLD_AUD_STEP_NO),'//text()'),2) AS IN_PSON_CNT
                        FROM (SELECT ROWNUM RN
                                     , A.REL_AUD_YR
                                     , A.REL_AUD_NO
                                     , A.BZT_YR
                                     , A.BZT_SNO
                                     , A.AUD_DCN
                                     , B.IN_PSON_CNT
                                     , SUM(C.IN_PSON_MAN_DAY) OVER (PARTITION BY REL_AUD_YR,REL_AUD_NO) IN_PSON_MAN_DAY
                                     , FLD_AUD_STEP_NO 
                                     , F_CODE_NM('1000030', AUD_BZT_KND_CD )  AUD_BZT_KND_NM
                                FROM TBBADDED002M A
                                   , (
                                        select /*+ INDEX(A KBBADBADDED005001) */
                                               BZT_YR
                                             , BZT_SNO
                                             , sum(
                                                   case
                                                     when A.STF_DVSN_CD = '0' then 1
                                                     else 0
                                                   end) as IN_PSON_CNT
                                          from (select distinct BZT_YR
                                                     , BZT_SNO
                                                     , PCT_CNB
                                                     , STF_DVSN_CD
                                                  from TBBADDED005L
                                               ) A
                                         group by BZT_YR, BZT_SNO
                                    ) B
                                  , (
                                        select /*+INDEX(B, KBBADBADDED006001)*/ 
                                               pt1.BZT_YR
                                              , pt1.BZT_SNO
                                              , SUM(case
                                                     when tma.STF_DVSN_CD = '0' then pt1.AUD_DCN
                                                     else 0
                                                   end) AS IN_PSON_MAN_DAY
                                          from TBBADDED005L tma
                                             , TBBADDED006L pt1
                                         where pt1.BZT_YR = tma.BZT_YR
                                           and pt1.BZT_SNO = tma.BZT_SNO
                                           and pt1.TEAM_SNO = tma.TEAM_SNO
                                           and pt1.PCT_ALC_SNO = tma.PCT_ALC_SNO
                                         group by pt1.BZT_YR, pt1.BZT_SNO
                                    ) C     
                                     WHERE B.BZT_YR(+)  = A.BZT_YR
                                       and B.BZT_SNO(+) = A.BZT_SNO
                                       and C.BZT_YR(+)  = A.BZT_YR
                                       and C.BZT_SNO(+) = A.BZT_SNO
                                       AND AUD_BZT_KND_CD = (SELECT MAX(AUD_BZT_KND_CD) AS AUD_BZT_KND_CD
															 		 FROM TBBADDED002M
															 		WHERE REL_AUD_YR = #strAudYr#
															   		  AND REL_AUD_NO = #strTskNo#
															   		  AND AUD_BZT_KND_CD IN ('01','02'))
                                       AND A.REL_AUD_YR = #strAudYr#
                                       AND A.REL_AUD_NO = #strTskNo#
                                 ) A
                             group by REL_AUD_YR, REL_AUD_NO
                           ) C
					     , (
					         SELECT  SITU.REL_AUD_YR 
					               , SITU.REL_AUD_NO
					               , SUM(TE.FDEX + TE.LDC + TE.DT_EXS + NVL(TFD.RL_FR_EXS, 0) + NVL(SPM_XPN,0) +NVL(LEAD_EXS,0)+NVL(AUD_ACTV_RCV_EXS,0))AS SUM_ALL
					          FROM TBBADDED002M SITU
					              , TBBADDED011L TE
					              , (SELECT BZT_YR
					                      , BZT_SNO
					                      , PCT_CNB
					                      , BZT_EXS_SNO
					                      , SUM(RL_FR_EXS) AS RL_FR_EXS
					                   FROM TBBADDED017L
					                  WHERE CALC_YN= 'N'
					               GROUP BY BZT_YR, BZT_SNO, PCT_CNB, BZT_EXS_SNO
					                ) TFD
					         WHERE SITU.REL_AUD_YR = #strAudYr#
					           AND SITU.REL_AUD_NO = #strTskNo#
					           AND TE.CALC_YN = 'N'
					           AND SITU.BZT_YR = TE.BZT_YR
					           AND SITU.BZT_SNO =TE.BZT_SNO
					           AND TE.BZT_YR = TFD.BZT_YR(+)
					           AND TE.BZT_SNO = TFD.BZT_SNO(+)
					           AND TE.PCT_CNB = TFD.PCT_CNB(+) 
					           AND TE.BZT_EXS_SNO = TFD.BZT_EXS_SNO(+)
					        GROUP BY SITU.REL_AUD_YR, SITU.REL_AUD_NO
					       ) D					       
					 WHERE A.AUD_YR = B.REL_AUD_YR
					   AND A.AUD_NO = B.REL_AUD_NO
					   AND A.AUD_YR = C.REL_AUD_YR
					   AND A.AUD_NO = C.REL_AUD_NO
					   AND A.AUD_YR = D.REL_AUD_YR
					   AND A.AUD_NO = D.REL_AUD_NO
					   AND A.AUD_YR = #strAudYr#
					   AND A.AUD_NO = #strTskNo#
		]]>
	</select>

	<!-- 감사업무관리(연계)-업무현황 조회 -->
	<select id="CSPAOE016EFrfMainYSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR	/*평가년도*/
     			 , D1.TSK_NO	/*감사번호*/
     			 , D1.AUD_YR||'-'||D1.TSK_NO AS TSK_YR_NO	/*감사연번호*/
    	 		 , D1.AUD_SBJ_NM	/*감사사항명*/
     			 , D1.HNDL_DIV_DPT_CD	/*처리과부서코드*/
     			 , F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM  /*처리과명*/
     			 , D1.TG_ORG_NM	/*대상기관명*/
     			 , D1.AUD_KND_CD	/*감사종류코드*/
     			 , D6.AUD_STEP_CD	/*감사기말단계코드*/
     		 	 , D1.AUD_LDR_CNB	/*감사단장 전산번호*/
     			 , D1.AUD_LDR_BLT_DPT_CD	/*감사단장소속부서코드*/
     			 , D1.AUD_LDR_RANK_CD	/*감사단장직급코드*/
     			 , D3.USR_NAM AS AUD_LDR_NM	/*감사단장성명*/
     			 , D1.SPVR_CNB	/*주관자전산번호*/
     			 , D1.SPVR_BLT_DPT_CD	/*주관자소속부서코드*/
     			 , D1.SPVR_RANK_CD	/*주관자직급코드*/
     			 , D4.USR_NAM AS SPVR_NM	/*주관자성명*/
     			 , D1.AST_CNB	/*보조자전산번호*/
     			 , D1.AST_BLT_DPT_CD	/*보조자소속부서코드*/
     			 , D1.AST_RANK_CD	/*보조자직급코드*/
     			 , D5.USR_NAM AS AST_NM /*보조자성명*/
     			 , NVL(D1.BZT_AM,0) AS BZT_AM	/*출장금액*/
     			 , CASE WHEN (SELECT LUNH_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10000') IS NULL THEN ''
			            ELSE SUBSTR((SELECT LUNH_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10000'),1,4)||'-'||SUBSTR((SELECT LUNH_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10000'),5,2)||'-'||SUBSTR((SELECT LUNH_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10000'),7,2)
			          END AS RSV_INSPC_LUNH_DT	/*예비조사착수일*/
     			 , CASE WHEN (SELECT CMPT_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10010') IS NULL THEN ''
			            ELSE SUBSTR((SELECT CMPT_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10010'),1,4)||'-'||SUBSTR((SELECT CMPT_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10010'),5,2)||'-'||SUBSTR((SELECT CMPT_DT FROM TBCSPAOE022M WHERE AUD_YR = #strAudYr# AND TSK_NO = #strTskNo# AND AUD_STEP_CD = '10010'),7,2)
			          END AS ENF_DT	/*시행일*/
     			 , D7.TOT_AUD_OP_PRD_DCN	/*총감사운영기간일수*/
     			 , D1.MNDY_CNT AS MNDY_CNT	/*연인원수*/
    	 		 , NVL(D2.DLAY_DT_NM,'0') AS DLAY_DT_NM	/*지연일명*/
     			 , NVL(D2.EXET_DCN,0) AS EXET_DCN	/*면책일수*/
     			 , D7.STUT_NOP_CNT	/*단계별인원수*/
     			 , D7.STUT_PRD_DCN	/*단계별기간일수*/
     			 , D1.MAIN_INDC_SBJ_PRB_TXT	/*주요지적사항문제점내용*/
     			 , D1.MAIN_AUD_RSLT_EPT_EFCT_TXT	/*주요감사결과기대효과내용*/
     			 , D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT	/*특기사항계획대비기여율변경사유내용*/
			  FROM TBCSPAOE021M D1
     		 	 , (SELECT AUD_YR, TSK_NO, SUM(DLAY_DT_NM) AS DLAY_DT_NM, SUM(EXET_DCN) AS EXET_DCN FROM TBCSPAOE022M GROUP BY AUD_YR, TSK_NO) D2
           	     , TBDCMACM001M D3
                 , TBDCMACM001M D4
                 , TBDCMACM001M D5
                 , (
			            SELECT NVL(MAX(AUD_STEP_CD),'') AS AUD_STEP_CD
			            FROM TBCSPAOE022M
			            WHERE AUD_YR = #strAudYr#
			              AND TSK_NO = #strTskNo# 
			              AND CMPT_DT IS NOT NULL
			       ) D6
			     , (
				        SELECT A.AUD_YR	/*감사년도*/
				             , A.AUD_NO AS TSK_NO	/*감사번호*/
				             , A.AUD_DCN AS TOT_AUD_OP_PRD_DCN /* 총감사운영기간일*/
				             , C.IN_PSON_CNT AS STUT_NOP_CNT /* 단계별인원*/
				             , C.AUD_DCN AS STUT_PRD_DCN /* 단계별 기간일*/
				          FROM (SELECT A.AUD_YR	/*감사년도*/
				                     , A.AUD_NO /*감사번호*/
				                     , MAX(AUD_KND_CD) AUD_KND_CD /*감사종류코드*/
				                     , sum(B.AUD_DCN) AS AUD_DCN	/*총감사운영기간일*/
				                  FROM TBBADDED001M A
				                     , TBBADDED002M B
				                 WHERE A.AUD_YR = B.REL_AUD_YR
				                   AND A.AUD_NO = B.REL_AUD_NO
				                   AND BZT_DVSN_CD ='1'
				                   AND A.AUD_YR = #strAudYr#
				                   AND A.AUD_NO = #strTskNo#
				                 GROUP BY A.AUD_YR , A.AUD_NO , A.TOT_DRTR_BRDV_CD , A.SPVR_BRDV_CD , A.AST_BRDV_CD
				               ) A,
				               (  SELECT    REL_AUD_YR
								          , REL_AUD_NO
								          , SUBSTR(EXTRACT(xmlagg(XMLELEMENT(A,'  '||AUD_BZT_KND_NM||' '||FLD_AUD_STEP_NO||'단계('||AUD_DCN||'일)') ORDER BY  A.FLD_AUD_STEP_NO),'//text()'),2) AS AUD_DCN
								          , max(IN_PSON_MAN_DAY) IN_PSON_MAN_DAY
								          , SUBSTR(EXTRACT(xmlagg(XMLELEMENT(A,'  '||AUD_BZT_KND_NM||' '||FLD_AUD_STEP_NO||'단계('||IN_PSON_CNT||'명)') ORDER BY  A.FLD_AUD_STEP_NO),'//text()'),2) AS IN_PSON_CNT
								    FROM (SELECT ROWNUM RN
								                 , A.REL_AUD_YR
								                 , A.REL_AUD_NO
								                 , A.BZT_YR
								                 , A.BZT_SNO
								                 , A.AUD_DCN
								                 , B.IN_PSON_CNT
								                 , SUM(C.IN_PSON_MAN_DAY) OVER (PARTITION BY REL_AUD_YR,REL_AUD_NO) IN_PSON_MAN_DAY
								                 , FLD_AUD_STEP_NO 
								                 , F_CODE_NM('1000030', AUD_BZT_KND_CD )  AUD_BZT_KND_NM
								            FROM TBBADDED002M A
								               , (
								                    select /*+ INDEX(A KBBADBADDED005001) */
								                           BZT_YR
								                         , BZT_SNO
								                         , sum(
								                               case
								                                 when A.STF_DVSN_CD = '0' then 1
								                                 else 0
								                               end) as IN_PSON_CNT
								                      from (select distinct BZT_YR
								                                 , BZT_SNO
								                                 , PCT_CNB
								                                 , STF_DVSN_CD
								                              from TBBADDED005L
								                           ) A
								                     group by BZT_YR, BZT_SNO
								                ) B
								              , (
								                    select /*+INDEX(B, KBBADBADDED006001)*/ 
								                           pt1.BZT_YR
								                          , pt1.BZT_SNO
								                          , SUM(case
								                                 when tma.STF_DVSN_CD = '0' then pt1.AUD_DCN
								                                 else 0
								                               end) AS IN_PSON_MAN_DAY
								                      from TBBADDED005L tma
								                         , TBBADDED006L pt1
								                     where pt1.BZT_YR = tma.BZT_YR
								                       and pt1.BZT_SNO = tma.BZT_SNO
								                       and pt1.TEAM_SNO = tma.TEAM_SNO
								                       and pt1.PCT_ALC_SNO = tma.PCT_ALC_SNO
								                     group by pt1.BZT_YR, pt1.BZT_SNO
								                ) C     
								                 WHERE B.BZT_YR(+)  = A.BZT_YR
								                   and B.BZT_SNO(+) = A.BZT_SNO
								                   and C.BZT_YR(+)  = A.BZT_YR
								                   and C.BZT_SNO(+) = A.BZT_SNO
								                   AND AUD_BZT_KND_CD = (SELECT MAX(AUD_BZT_KND_CD) AS AUD_BZT_KND_CD
																		 		 FROM TBBADDED002M
																		 		WHERE REL_AUD_YR = #strAudYr#
																		   		  AND REL_AUD_NO = #strTskNo#
																		   		  AND AUD_BZT_KND_CD IN ('01','02'))
								                   AND A.REL_AUD_YR = #strAudYr#
								                   AND A.REL_AUD_NO = #strTskNo#
								             ) A
								         group by REL_AUD_YR, REL_AUD_NO
				                 ) C
				         WHERE A.AUD_YR = C.REL_AUD_YR
				           AND A.AUD_NO = C.REL_AUD_NO
				           AND A.AUD_YR = #strAudYr#
				           AND A.AUD_NO = #strTskNo# 
				       ) D7
		     WHERE ROWNUM = 1
		       AND D1.AUD_YR = D2.AUD_YR (+)
           	   AND D1.TSK_NO = D2.TSK_NO (+)
           	   AND D1.AUD_LDR_CNB = D3.CNB (+)
   			   AND D1.SPVR_CNB = D4.CNB (+)
               AND D1.AST_CNB = D5.CNB (+)
               AND D1.AUD_YR = D7.AUD_YR (+)
   			   AND D1.TSK_NO = D7.TSK_NO (+)
			   AND D1.AUD_YR = #strAudYr#
			   AND D1.TSK_NO = #strTskNo#
		]]>
	</select>

	<!-- 감사업무관리(연계)-업무현황 갯수 조회 -->
	<select id="CSPAOE016EFrfCntselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT COUNT(*) AS CNT
			  FROM TBCSPAOE021M
			 WHERE 1=1
			   AND AUD_YR = #AUD_YR#
			   AND TSK_NO = #TSK_NO#
		]]>
	</select>

	<!-- 감사업무관리(연계)-업무현황 신규등록 -->
	<insert id="CSPAOE016EFrfMainInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE021M
		(
			  AUD_YR
			, TSK_NO
			, AUD_KND_CD
			, AUD_SBJ_NM
			, HNDL_DIV_DPT_CD
			, TG_ORG_NM
			, AUD_LDR_CNB
			, AUD_LDR_BLT_DPT_CD
			, AUD_LDR_RANK_CD
			, SPVR_CNB
			, SPVR_BLT_DPT_CD
			, SPVR_RANK_CD
			, AST_CNB
			, AST_BLT_DPT_CD
			, AST_RANK_CD
			, BZT_AM
			, MNDY_CNT
			, MAIN_INDC_SBJ_PRB_TXT
			, MAIN_AUD_RSLT_EPT_EFCT_TXT
			, SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT
			, AUD_ACTV_CON_YN
			, EVL_RQS_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #AUD_YR#
			, #TSK_NO#
			, #AUD_KND_CD#
			, #AUD_SBJ_NM#
			, #HNDL_DIV_DPT_CD#
			, #TG_ORG_NM#
			, #AUD_LDR_CNB#
			, #AUD_LDR_BLT_DPT_CD#
			, #AUD_LDR_RANK_CD#
			, #SPVR_CNB#
			, #SPVR_BLT_DPT_CD#
			, #SPVR_RANK_CD#
			, #AST_CNB#
			, #AST_BLT_DPT_CD#
			, #AST_RANK_CD#
			, #BZT_AM#
			, #MNDY_CNT#
			, #MAIN_INDC_SBJ_PRB_TXT#
			, #MAIN_AUD_RSLT_EPT_EFCT_TXT#
			, #SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT#
			, 'Y'
			, #EVL_RQS_YN#
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>

	<!-- 감사업무관리(연계)-업무현황 저장 -->
	<update id="CSPAOE016EFrfMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPAOE021M
		   SET 
			   FNL_MDF_DH = SYSDATE
			   , FNL_MNU_ID = 'CSPAOE016E'
			   , AUD_ACTV_CON_YN = 'Y'
		<isNotEmpty prepend="," property="AUD_KND_CD">
			  AUD_KND_CD = #AUD_KND_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="HNDL_DIV_DPT_CD">
			  HNDL_DIV_DPT_CD = #HNDL_DIV_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AUD_LDR_CNB">
			  AUD_LDR_CNB = #AUD_LDR_CNB#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AUD_LDR_BLT_DPT_CD">
			  AUD_LDR_BLT_DPT_CD = #AUD_LDR_BLT_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AUD_LDR_RANK_CD">
			  AUD_LDR_RANK_CD = #AUD_LDR_RANK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SPVR_CNB">
			  SPVR_CNB = #SPVR_CNB#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SPVR_BLT_DPT_CD">
			  SPVR_BLT_DPT_CD = #SPVR_BLT_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SPVR_RANK_CD">
			  SPVR_RANK_CD = #SPVR_RANK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AST_CNB">
			  AST_CNB = #AST_CNB#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AST_BLT_DPT_CD">
			  AST_BLT_DPT_CD = #AST_BLT_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="AST_RANK_CD">
			  AST_RANK_CD = #AST_RANK_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="BZT_AM">
			  BZT_AM = #BZT_AM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="MNDY_CNT">
			  MNDY_CNT = #MNDY_CNT#
		</isNotEmpty>
		<isEmpty prepend="," property="MAIN_INDC_SBJ_PRB_TXT">
			  MAIN_INDC_SBJ_PRB_TXT = #MAIN_INDC_SBJ_PRB_TXT#
		</isEmpty>
		<isEmpty prepend="," property="MAIN_AUD_RSLT_EPT_EFCT_TXT">
			  MAIN_AUD_RSLT_EPT_EFCT_TXT = #MAIN_AUD_RSLT_EPT_EFCT_TXT#
		</isEmpty>
		<isEmpty prepend="," property="SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT">
			  SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT = #SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT#
		</isEmpty>
		<isNotEmpty prepend="," property="MAIN_INDC_SBJ_PRB_TXT">
			  MAIN_INDC_SBJ_PRB_TXT = #MAIN_INDC_SBJ_PRB_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="MAIN_AUD_RSLT_EPT_EFCT_TXT">
			  MAIN_AUD_RSLT_EPT_EFCT_TXT = #MAIN_AUD_RSLT_EPT_EFCT_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT">
			  SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT = #SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			  FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			  FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		WHERE 1 = 1
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
	</update>

	<!-- 감사업무관리(연계)-처리단계 국과별처리현황 자동 인서트 -->
	<insert id="CSPAOE016EAudStepInsert" parameterClass="paramMap">
		INSERT INTO	TBCSPAOE022M
		(
			  AUD_YR
			, TSK_NO
			, AUD_STEP_CD
			/*, STAD_PRD_DCN 2016.05.25*/
			, LUNH_DT
			, CMPT_DT
			/*,  DLAY_DT_NM 2016.05.25*/
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT AUD_YR
				, AUD_NO AS TSK_NO
				, AUD_STEP_CD
				/*, DDLN_DCN AS STAD_PRD_DCN 2016.05.25*/
				, AUD_STEP_FROM_DT AS LUNH_DT
				, AUD_STEP_TO_DT AS CMPT_DT
				/*, DELAY_DCN AS DLAY_DT_NM 2016.05.25*/
				, ' '
				, ' '
				, ' '
				, 'CSPAOE023E'
				, SYSDATE
				, SYSDATE
		FROM VBBAD002
		WHERE 1=1
		AND AUD_YR = #strAudYr#
		AND AUD_NO = #strTskNo#
	</insert>

	<!-- 감사업무관리(연계)-처리단계 : 국과별처리현황(연계) 정보 조회 -->
	<select id="CSPAOE016EStadPrdDcnSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT AUD_YR
			     , AUD_NO AS TSK_NO
			     , AUD_STEP_CD
			     , DDLN_DCN AS STAD_PRD_DCN
			     , AUD_STEP_FROM_DT AS LUNH_DT
			     , AUD_STEP_TO_DT AS CMPT_DT
			     , DELAY_DCN AS DLAY_DT_NM
			FROM VBBAD002
			WHERE 1=1
			  AND AUD_YR = #strAudYr#
			  AND AUD_NO = #strTskNo#
		]]>
	</select>

	<!-- 감사업무관리-처리단계 데이터 존재여부 조회 -->
	<select id="CSPAOE016EAudStepCntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT COUNT(*) AS CNT
			  FROM TBCSPAOE022M
			 WHERE 1=1
			   AND AUD_YR = #AUD_YR#
			   AND TSK_NO = #TSK_NO#
			   AND AUD_STEP_CD = #AUD_STEP_CD#
		]]>
	</select>

	<!-- 감사업무관리-처리단계 참여인원 데이터 존재여부 조회 -->
	<select id="CSPAOE016EAudInfoCntSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT COUNT(*) AS CNT
			  FROM TBCSPAOE023M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
			   AND AUD_STEP_CD = #strAudStepCd#
		]]>
	</select>

	<!-- 감사업무관리-처리단계 참여인원 데이터 삭제 -->
	<delete id="CSPAOE016ECopyDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE TBCSPAOE023M
			 WHERE 1=1
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
			   AND AUD_STEP_CD = #strAudStepCd#
		]]>
	</delete>

	<!-- 감사업무관리-참여인원 및 기여율 : 출장정보 복사 -->
	<insert id="CSPAOE016ECopyInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE023M
		(
			  AUD_YR
			, TSK_NO
			, AUD_STEP_CD
			, PTCPT_CNB
			, BLT_DPT_CD
			, DPT_DVSN_CD
			, RANK_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT DISTINCT E.AUD_YR /*감사년도*/
				, E.AUD_NO AS TSK_NO /*업무번호*/
				, #strAudStepCd# AS AUD_STEP_CD /*감사단계코드*/
				, B.PCT_CNB AS PTCPT_CNB /*참여자전산번호*/
				, MAX(B.BLT_BRDV_CD) AS BLT_DPT_CD /*소속부서코드*/
				, ' ' /*부서구분코드*/
				, MIN(F.RANK_CD) /*직급코드*/
				, ' '
				, ' '
				, ' '
				, 'CSPAOE023E'
				, SYSDATE
				, SYSDATE
				FROM TBBADDED005L B
				, TBBADDED002M D
				, TBBADDED001M E
				, TBDCMACM001M F
		WHERE 1 = 1
		AND B.STF_DVSN_CD = '0'
		AND D.BZT_YR = B.BZT_YR
		AND D.BZT_SNO = B.BZT_SNO
		AND D.BZT_DVSN_CD = '1'
		AND E.AUD_YR = D.REL_AUD_YR
		AND E.AUD_NO = D.REL_AUD_NO
		AND B.PCT_CNB = F.CNB
		AND (TRIM(F.PST_CD) NOT IN ('0013600','0065600','0069300') OR F.PST_CD IS NULL OR F.PST_CD = ' ') /*과장, 연구원, 연구관 제외*/
		AND D.AUD_BZT_KND_CD = (SELECT MAX(AUD_BZT_KND_CD) AS AUD_BZT_KND_CD
								 		 FROM TBBADDED002M
								 		WHERE REL_AUD_YR = #strAudYr#
								   		  AND REL_AUD_NO = #strTskNo#
								   		  AND AUD_BZT_KND_CD IN ('01','02'))
		AND E.AUD_YR = #strAudYr#
		AND E.AUD_NO = #strTskNo#
		GROUP BY E.AUD_YR, E.AUD_NO, B.PCT_CNB
	</insert>

	<!-- 감사사항조회(팝업) 조회 -->
	<select id="CSPAOE089PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR 	   /*감사년도*/
       			 , D1.AUD_KND_CD	/*감사종류*/
       			 , NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D2.AUD_KND_CD, '-'),D1.AUD_YR || '-' || D1.TSK_NO) AS TSK_YR_NO /*감사연번호*/
       			 , NVL(D2.AUD_GRN_NO, D1.TSK_NO) AS TSK_NO	  /*업무번호*/
       			 , D1.AUD_SBJ_NM  /*감사사항명*/
       			 , D1.MNDY_CNT
       			 , SUBSTR(D2.AUD_KND_CD,3,1) AS AUD_YR_NO_KND_CD
			  FROM TBCSPAOE021M D1
			  		,TBBADDED001M D2
			 WHERE 1=1
  			   AND D1.AUD_YR = #strAudYr#
  			   AND D1.AUD_YR= D2.AUD_YR(+)
    		   AND D1.TSK_NO = D2.AUD_NO(+)
  		]]>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			D1.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strTskNo">
			CASE WHEN LENGTH(#strTskNo#) = 3 AND D2.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND D1.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			SUBSTR(D2.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
		</isNotEmpty>
	 	<![CDATA[
		  ORDER BY D1.AUD_YR, D1.TSK_NO
		]]>
	</select>
	
	<!-- 감사업무관리-감사사항 목록 조회 -->
	<select id="CSPAOE107EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT A.AUD_YR /*감사년도*/
			     , A.TSK_NO /*업무번호*/
			     , NVL(F_MNG_KND_AUDYRNO(a.AUD_YR, a.TSK_NO, a.AUD_KND_CD, '-'),a.AUD_YR || '-' || a.TSK_NO)  AS AUD_YR_NO /*감사연번호*/
			     , A.AUD_KND_CD /*감사종류코드*/
			     , F_CODE_NM('1000270', A.AUD_KND_CD) AS AUD_KND_NM /*감사종류명*/
			     , A.HNDL_DIV_DPT_CD    /*처리과코드*/
			     , F_DPT_INFO(A.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM    /*처리과명*/
			     , A.MNDY_CNT   /*연인원*/
			     , C.AUD_END_STEP_CD    /*감사진행단계코드*/
			     , F_CODE_NM('1000273', C.AUD_END_STEP_CD) AS AUD_END_STEP_NM    /*감사진행단계코드명*/
			     , CASE WHEN B.CTB_RTE_CFM_BRUCHF_CNB IS NOT NULL THEN 'Y'  
			            ELSE 'N'
			       END AS CTB_RTE_YN   /*국장기여도확인여부*/
			     , E.EVL_YR /*평가년도*/
			     , E.HLYR_DVSN_CD   /*반기구분코드*/
			     , F_CODE_NM('1000279', E.EVL_STEP_CD) AS EVL_END_STEP_NM /*평가단계명*/
			     , A.AUD_SBJ_NM /*감사사항명*/
			     , 'N' AS AUD_END_YN /*감사종료여부*/
			     , B.CMPT_DT    /*감사기말단계 완료일*/
			     , NVL(E.EVL_STA_CD, '100') AS EVL_STA_CD    /*평가상태코드*/
			     , F_CODE_NM('1000280', NVL(E.EVL_STA_CD, '100')) AS EVL_STA_NM	/*평가상태명*/
			FROM TBCSPAOE021M A
			   , (SELECT C1.AUD_YR 
               		   , C1.TSK_NO
               		   , MAX(C1.AUD_STEP_CD) AS AUD_END_STEP_CD
                    FROM TBCSPAOE022M C1
         		   WHERE C1.CMPT_DT IS NOT NULL
                GROUP BY C1.AUD_YR, C1.TSK_NO ) C 
       		, (SELECT B1.AUD_YR 
	                , B1.TSK_NO 
	                , B1.CTB_RTE_CFM_BRUCHF_CNB
	                , B1.CMPT_DT
                    , B1.AUD_STEP_CD
          		 FROM TBCSPAOE022M B1
         		WHERE B1.LUNH_DT IS NOT NULL
           		  AND B1.CMPT_DT IS NOT NULL
              ) B LEFT JOIN TBCSPAOE029M E ON B.AUD_YR = E.AUD_YR
                                          AND B.TSK_NO = E.TSK_NO 
              ,TBBADDED001M D
			WHERE A.AUD_YR = C.AUD_YR (+)
              AND A.TSK_NO = C.TSK_NO (+)
              AND C.AUD_YR = B.AUD_YR (+) 
			  AND C.TSK_NO = B.TSK_NO (+)
			  AND a.aud_yr = D.aud_yr (+)
   and a.tsk_no = D.AUD_NO (+)
              AND C.AUD_END_STEP_CD = B.AUD_STEP_CD(+)
			  AND A.HNDL_DIV_DPT_CD = #strHndlDivDptCd# /*이건 왜 이렇게 해놓고 밑에 저렇게 해놨을까..*/
        ]]>
        <isEqual property="strRankCd" compareValue="0013600">
				AND A.HNDL_DIV_DPT_CD = #strHndlDivDptCd#
		</isEqual>
		<isEqual property="strRankCd" compareValue="0015800">
                AND A.HNDL_DIV_DPT_CD IN ( SELECT DPT_CD FROM TBDCMACM002M WHERE USE_YN = 'Y' AND ( HIRK_DPT_CD = #strHndlDivDptCd# OR DPT_CD = #strHndlDivDptCd# ))
		</isEqual>
		<isNotEmpty prepend="AND" property="strAudYr">
			      A.AUD_YR = #strAudYr#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strTskNo">
				CASE WHEN LENGTH(#strTskNo#) = 3 AND D.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND a.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			D.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1)
		</isNotEmpty>
        <isNotEmpty prepend="AND" property="strAudSbjNm">
			      A.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudKndCd">
			      A.AUD_KND_CD LIKE '%'||#strAudKndCd#||'%'
		</isNotEmpty>
		<!-- 감사종료 조회조건에 따라 건 수가 맞지않은 오류 수정 2015.02.02 -->
		<isNotEmpty property="strAudEndYn">
			<isEqual property="strAudEndYn" compareValue="Y">
              AND 0 <![CDATA[ < ]]> (
                        SELECT COUNT(*)  
                          FROM TBCSPAOE022M 
                          WHERE  AUD_YR = A.AUD_YR  
                          AND TSK_NO = A.TSK_NO    
                          AND AUD_END_YN = 'Y' 
                        )			
			</isEqual>
			<isEqual property="strAudEndYn" compareValue="N">
              AND 0  =  (
                        SELECT COUNT(*)  
                          FROM TBCSPAOE022M 
                          WHERE  AUD_YR = A.AUD_YR    
                          AND TSK_NO = A.TSK_NO    
                          AND AUD_END_YN = 'Y' 
                        )			
			</isEqual>			
		</isNotEmpty>		
		 <![CDATA[ 
			 ORDER BY D.AUD_KND_CD,
       A.AUD_YR,
       A.TSK_NO ASC 
		]]>
	</select>
	
	<!-- 감사업무관리-감사사항 목록 조회(미래전략담당관용) -->
	<select id="CSPAOE107EMainAllSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			select a.AUD_YR
			     , a.TSK_NO
			     , NVL(F_MNG_KND_AUDYRNO(a.AUD_YR, a.TSK_NO, D.AUD_KND_CD, '-'),a.AUD_YR || '-' || a.TSK_NO)  AS AUD_YR_NO
			     , a.AUD_SBJ_NM
			     , a.AUD_KND_CD
			     , F_CODE_NM('1000270', a.AUD_KND_CD) AS AUD_KND_NM
			     , F_DPT_INFO(a.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM
			     , a.MNDY_CNT
			     , F_CODE_NM('1000273', b.AUD_END_STEP_CD) AS AUD_END_STEP_NM
			     , b.LUNH_DT
		         , b.CMPT_DT
		         , c.EVL_STR_DT
		         , c.EVL_END_DT
		         , b.CTB_RTE_CFM_BRUCHF_CNB
		         , b.CTB_RTE_CFM_YN
			     , CASE
			         WHEN b.CTB_RTE_CFM_BRUCHF_CNB IS NOT NULL 
			         THEN  (CASE WHEN b.CTB_RTE_CFM_YN = 'Y' AND b.CMPT_DT BETWEEN c.EVL_STR_DT AND c.EVL_END_DT THEN 'Y' ELSE 'N' END)
			         ELSE 'N'
			       END AS CTB_RTE_YN
			from TBCSPAOE021M a
			    , (select d.AUD_YR
			             , d.TSK_NO
			             , d.AUD_END_STEP_CD
			             , e.LUNH_DT
                  		 , e.CMPT_DT
			             , e.CTB_RTE_CFM_BRUCHF_CNB
			             , e.CTB_RTE_CFM_YN
			        from (
			                SELECT C1.AUD_YR ,
			                       C1.TSK_NO ,
			                       MAX(C1.AUD_STEP_CD) AS AUD_END_STEP_CD
			                  FROM TBCSPAOE022M C1
			                 WHERE C1.CMPT_DT IS NOT NULL
			                 GROUP BY C1.AUD_YR, C1.TSK_NO
			             ) d
			           , TBCSPAOE022M e
			        where d.aud_yr          = e.aud_yr 
			          and d.tsk_no          = e.tsk_no 
			          and d.AUD_END_STEP_CD = e.AUD_STEP_CD
			    ) b
			    , (SELECT EVL_STR_DT, EVL_END_DT
              		 FROM TBCSPAOE001M 
              		WHERE EVL_YR = (SELECT MAX(EVL_YR) AS EVL_YR
              						  FROM TBCSPAOE001M)
              		  AND HLYR_DVSN_CD = (SELECT MAX(HLYR_DVSN_CD) AS HLYR_DVSN_CD
              								FROM TBCSPAOE001M
              							   WHERE EVL_YR = (SELECT MAX(EVL_YR) AS  EVL_YR
				              								 FROM TBCSPAOE001M)) 
				) C,TBBADDED001M D
			where a.aud_yr = b.aud_yr (+)
			  and a.tsk_no = b.tsk_no (+)
			  AND a.aud_yr = D.aud_yr (+)
   				and a.tsk_no = D.AUD_NO (+)
        ]]>
		<isNotEmpty prepend="AND" property="strAudYr">
			      A.AUD_YR = #strAudYr#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strTskNo">
				CASE WHEN LENGTH(#strTskNo#) = 3 AND D.AUD_GRN_NO = #strTskNo# THEN '1'
					WHEN LENGTH(#strTskNo#) <![CDATA[<>]]> 3 AND a.tsk_no = #strTskNo# THEN '1'
					ELSE '' END = '1'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			      D.AUD_KND_CD like '%'||SUBSTR(#strAudYrNoKndCd#,3,1)
		</isNotEmpty>
		
        <isNotEmpty prepend="AND" property="strAudSbjNm">
			      A.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudKndCd">
			      A.AUD_KND_CD LIKE '%'||#strAudKndCd#||'%'
		</isNotEmpty>
		<!-- 2015.01.30 조회조건 : 처리과부서 추가 -->
		<isNotEmpty prepend="AND" property="strHndlDivDptCd">
			      A.HNDL_DIV_DPT_CD = #strHndlDivDptCd#
		</isNotEmpty>
		<!-- 감사종료 조회조건에 따라 건 수가 맞지않은 오류 수정 2015.02.02 -->
		<isNotEmpty property="strAudEndYn">
			<isEqual property="strAudEndYn" compareValue="Y">
              AND 0 <![CDATA[ < ]]> (
                        SELECT COUNT(*)  
                          FROM TBCSPAOE022M 
                          WHERE  AUD_YR = A.AUD_YR  
                          AND TSK_NO = A.TSK_NO      
                          AND AUD_END_YN = 'Y' 
                        )			
			</isEqual>
			<isEqual property="strAudEndYn" compareValue="N">
              AND 0 =  (
                        SELECT COUNT(*)  
                          FROM TBCSPAOE022M 
                          WHERE  AUD_YR = A.AUD_YR  
                          AND TSK_NO = A.TSK_NO    
                          AND AUD_END_YN = 'Y' 
                        )			
			</isEqual>			
		</isNotEmpty>
		 <![CDATA[ 
			 ORDER BY d.AUD_KND_CD,
       A.AUD_YR,
       A.TSK_NO ASC 
		]]>
	</select>
	
	<!-- 감사업무관리-감사사항 TBCSPAOE030M 정보 삭제 -->
	<delete id="CSPAOE107E30MainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE030M
		WHERE 1 = 1
		AND AUD_YR = #AUD_YR#
		AND TSK_NO = #TSK_NO#
	</delete>
	
	<!-- 감사업무관리-감사사항 TBCSPAOE029M 정보 삭제 -->
	<delete id="CSPAOE107E29MainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE029M
		WHERE 1 = 1
		AND AUD_YR = #AUD_YR#
		AND TSK_NO = #TSK_NO#
	</delete>
	
	<!-- 감사업무관리-감사사항 TBCSPAOE040M 정보 삭제 -->
	<delete id="CSPAOE107E40MainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE040M
		WHERE 1 = 1
		AND AUD_YR = #AUD_YR#
		AND TSK_NO = #TSK_NO#
	</delete>
	
	<!-- 감사업무관리-감사사항 TBCSPAOE023M 정보 삭제 -->
	<delete id="CSPAOE107E23MainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE023M
		WHERE 1 = 1
		AND AUD_YR = #AUD_YR#
		AND TSK_NO = #TSK_NO#
	</delete>
	
	<!-- 감사업무관리-감사사항 TBCSPAOE022M 정보 삭제 -->
	<delete id="CSPAOE107E22MainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE022M
		WHERE 1 = 1
		AND AUD_YR = #AUD_YR#
		AND TSK_NO = #TSK_NO#
	</delete>
	
	<!-- 감사업무관리-감사사항 TBCSPAOE021M 정보 삭제 -->
	<delete id="CSPAOE107E21MainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE021M
		WHERE 1 = 1
		AND AUD_YR = #AUD_YR#
		AND TSK_NO = #TSK_NO#
	</delete>
	
	<!-- 처리과부서코드 -->
	<select id="CSPAOE107E21HndlDivDptCdselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT HNDL_DIV_DPT_CD AS CD
			     , F_DPT_INFO(HNDL_DIV_DPT_CD, '1') AS CD_NM
			 FROM TBCSPAOE021M
			GROUP BY HNDL_DIV_DPT_CD
			ORDER BY HNDL_DIV_DPT_CD
		]]>
	</select>
	
	<!--감사업무관리-처리단계 파일업로드 insert-->
	<insert id="CSPAOE023EFileUploadInsert" parameterClass="paramMap">
		<![CDATA[  
			INSERT INTO TBCSPAOE040M
			( 
			       AUD_YR
			     , TSK_NO
			     , DOC_ID
			     , DOC_TYP_CD
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH  
			)
			VALUES
			(
				#AUD_YR#
			     , #TSK_NO#
			     , #DOC_ID#
			     , #DOC_TYP_CD#
			     , #FRT_USR_ID#
			     , #FNL_USR_ID#
			     , #FNL_DEAL_DPT_CD#
			     , #FNL_MNU_ID#
			     , SYSDATE
			     , SYSDATE 
			) 	
		]]>
	</insert>
	
	<!--감사업무관리-처리단계 파일업로드 update-->
	<update id="CSPAOE023EFileUploadUpdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBCSPAOE040M
			   SET AUD_YR        = #AUD_YR# 
			     , TSK_NO        = #TSK_NO# 		
			     , DOC_ID        = #DOC_ID#
		]]>	 
		<isNotEmpty property="DOC_TYP_CD">	 	
			     , DOC_TYP_CD      = #DOC_TYP_CD#
		</isNotEmpty>		
		<isNotNull  property="FNL_USR_ID">	       
			     , FNL_USR_ID      = #FNL_USR_ID#
		</isNotNull>	
		<isNotNull  property="FNL_DEAL_DPT_CD">	       
			     , FNL_DEAL_DPT_CD  = #FNL_DEAL_DPT_CD#
		</isNotNull>		
		<isNotNull  property="FNL_MNU_ID">	       
			     , FNL_MNU_ID        = #FNL_MNU_ID#
		</isNotNull>
		<![CDATA[ 	
				 , FNL_MDF_DH        = SYSDATE			
			  WHERE 1=1
			    AND AUD_YR = #AUD_YR# 
			    AND TSK_NO = #TSK_NO# 	
			    AND DOC_ID = #DOC_ID#
			    AND DOC_TYP_CD = #DOC_TYP_CD#
		]]>			    					        
	</update>	

	<!--감사업무관리-처리단계 파일업로드 delete-->
	<update id="CSPAOE023EFileUploadDelete" parameterClass="paramMap">
		   DELETE FROM TBCSPAOE040M
			WHERE 1=1
			  AND AUD_YR = #AUD_YR# 
			  AND TSK_NO = #TSK_NO# 		
			  AND DOC_ID = #DOC_ID#
			  AND DOC_TYP_CD = #DOC_TYP_CD#
	</update>
	
	<!-- 감사업무관리-처리단계 첨부파일 조회 CSPAOE016E 화면 -->
	<select id="CSPAOE023EMainSubSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D3.AUD_YR /*감사년도*/,
			       D3.TSK_NO /*업무번호*/,
			       D3.TYPE1_DOC_TYP_CD /*예비조사계획서 문서유형코드*/,
			       CASE
			         WHEN D3.TYPE1_DOC_TYP_CD = 'SP-OE-001' THEN (SELECT D1.DOC_ID
														            FROM TBCSPAOE040M D1
														           WHERE D1.AUD_YR = #strAudYr#
														             AND D1.TSK_NO = #strTskNo#
														             AND D1.DOC_TYP_CD = 'SP-OE-001'
														             AND ROWNUM = 1)
			       END AS TYPE1_DOC_ID /*예비조사계획서 문서ID*/,
			       CASE
			         WHEN D3.TYPE1_DOC_TYP_CD = 'SP-OE-001' THEN (SELECT D2.FILE_NAME
															        FROM TBCSPAOE040M D1 ,
															             UBKERAPP.ECM_FILE_LIST_VIEW D2
															       WHERE D1.DOC_ID = D2.DOC_ID
															         AND D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-001'
															         AND ROWNUM = 1)
			       END AS TYPE1_FILE_NM /*예비조사계획서 첨부파일명*/  ,
			       D3.TYPE2_DOC_TYP_CD /*실지감사계획서 문서유형코드*/,
			       CASE
			         WHEN D3.TYPE2_DOC_TYP_CD = 'SP-OE-002' THEN (SELECT NVL(D2.DOC_ID,D1.DOC_ID)  AS DOC_ID
			                                                        FROM TBCSPAOE040M D1
			                                                            ,TBBADDED021M D2
			                                                       WHERE D1.AUD_YR(+) = D2.AUD_YR
			                                                         AND D1.TSK_NO(+) = D2.AUD_NO
			                                                         AND D2.AUD_YR = #strAudYr#
			                                                         AND D2.AUD_NO = #strTskNo#
			                                                         AND D1.DOC_TYP_CD(+) = 'SP-OE-002'
			                                                         AND D2.DOC_TYP_CD ='AD-AR-002' 
			                                                         AND ROWNUM = 1)
			       END AS TYPE2_DOC_ID /*실지감사계획서 문서ID*/,
			       CASE
			         WHEN D3.TYPE2_DOC_TYP_CD = 'SP-OE-002' THEN (SELECT D2.FILE_NAME
			                                                        FROM 
			                                                            (SELECT NVL(D2.DOC_ID,D1.DOC_ID)  AS DOC_ID
			                                                               FROM TBCSPAOE040M D1
			                                                                  , TBBADDED021M D2
			                                                             WHERE D1.AUD_YR(+) = D2.AUD_YR
			                                                               AND D1.TSK_NO(+) = D2.AUD_NO
			                                                               AND D2.AUD_YR = #strAudYr#
			                                                               AND D2.AUD_NO = #strTskNo#
			                                                               AND D1.DOC_TYP_CD(+) = 'SP-OE-002'
			                                                               AND D2.DOC_TYP_CD ='AD-AR-002'
			                                                             ) D1,
			                                                             UBKERAPP.ECM_FILE_LIST_VIEW D2
			                                                        WHERE D1.DOC_ID = D2.DOC_ID 
			                                                          AND ROWNUM = 1)
			       END AS TYPE2_FILE_NM /*실지감사계획서 첨부파일명*/,
			       D3.TYPE3_DOC_TYP_CD /*귀청보고서 문서유형코드*/,
			       CASE
			         WHEN D3.TYPE3_DOC_TYP_CD = 'SP-OE-003' THEN (SELECT NVL(D2.DOC_ID,D1.DOC_ID)  AS DOC_ID
															        FROM TBCSPAOE040M D1
															           , TBBADDED021M D2
															       WHERE D1.AUD_YR(+) = D2.AUD_YR
															         AND D1.TSK_NO(+) = D2.AUD_NO
															         AND D2.AUD_YR = #strAudYr#
															         AND D2.AUD_NO = #strTskNo#
															         AND D1.DOC_TYP_CD(+) = 'SP-OE-003'
															         AND D2.DOC_TYP_CD ='AD-AR-003'
															         AND ROWNUM = 1)
				   END AS TYPE3_DOC_ID /*귀청보고서 문서ID*/, 			
			       CASE
			         WHEN D3.TYPE3_DOC_TYP_CD = 'SP-OE-003' THEN (SELECT D2.FILE_NAME
			                                                        FROM 
			                                                            (SELECT NVL(D2.DOC_ID,D1.DOC_ID)  AS DOC_ID
			                                                              FROM TBCSPAOE040M D1
			                                                                 , TBBADDED021M D2
			                                                             WHERE D1.AUD_YR(+) = D2.AUD_YR
			                                                               AND D1.TSK_NO(+) = D2.AUD_NO
			                                                               AND D2.AUD_YR = #strAudYr#
			                                                               AND D2.AUD_NO = #strTskNo#
			                                                               AND D1.DOC_TYP_CD(+) = 'SP-OE-003'
			                                                               AND D2.DOC_TYP_CD ='AD-AR-003'
			                                                             ) D1,
			                                                             UBKERAPP.ECM_FILE_LIST_VIEW D2
			                                                        WHERE D1.DOC_ID = D2.DOC_ID 
			                                                          AND ROWNUM = 1)
			       END AS TYPE3_FILE_NM /*귀청보고서 첨부파일명*/,
			       D3.TYPE4_DOC_TYP_CD /*기여율배분계획서 문서유형코드*/  ,
			       CASE
			         WHEN D3.TYPE4_DOC_TYP_CD = 'SP-OE-004' THEN (SELECT D1.DOC_ID
														            FROM TBCSPAOE040M D1
														           WHERE D1.AUD_YR = #strAudYr#
														             AND D1.TSK_NO = #strTskNo#
														             AND D1.DOC_TYP_CD = 'SP-OE-004'
														             AND ROWNUM = 1)
			       END AS TYPE4_DOC_ID /*기여율배분계획서 문서ID*/,
			       CASE
			         WHEN D3.TYPE4_DOC_TYP_CD = 'SP-OE-004' THEN (SELECT D2.FILE_NAME
															        FROM TBCSPAOE040M D1 ,
															             UBKERAPP.ECM_FILE_LIST_VIEW D2
															       WHERE D1.DOC_ID = D2.DOC_ID 
															         AND D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-004'
															         AND ROWNUM = 1)
			       END AS TYPE4_FILE_NM /*기여율배분계획서 첨부파일명*/,
			       D3.TYPE5_DOC_TYP_CD /*감사결과보고서 문서유형코드*/,
			       CASE
			         WHEN D3.TYPE5_DOC_TYP_CD = 'SP-OE-005' THEN (SELECT NVL(D2.DOC_ID,D1.DOC_ID)  AS DOC_ID
			                                                        FROM TBCSPAOE040M D1
			                                                           , TBBADDED021M D2
			                                                       WHERE D1.AUD_YR(+) = D2.AUD_YR
			                                                         AND D1.TSK_NO(+) = D2.AUD_NO
			                                                         AND D2.AUD_YR = #strAudYr#
			                                                         AND D2.AUD_NO = #strTskNo#
			                                                         AND D1.DOC_TYP_CD(+) = 'SP-OE-005'
			                                                         AND D2.DOC_TYP_CD ='AD-AR-001'
			                                                         AND ROWNUM = 1)
			       END AS TYPE5_DOC_ID /*감사결과보고서 문서ID*/,
			       CASE
			         WHEN D3.TYPE5_DOC_TYP_CD = 'SP-OE-005' THEN (SELECT D2.FILE_NAME
			                                                        FROM 
			                                                            (SELECT NVL(D2.DOC_ID,D1.DOC_ID)  AS DOC_ID
			                                                              FROM TBCSPAOE040M D1
			                                                                  ,TBBADDED021M D2
			                                                             WHERE D1.AUD_YR(+) = D2.AUD_YR
			                                                               AND D1.TSK_NO(+) = D2.AUD_NO
			                                                               AND D2.AUD_YR = #strAudYr#
			                                                               AND D2.AUD_NO = #strTskNo#
			                                                               AND D1.DOC_TYP_CD(+) = 'SP-OE-005'
			                                                               AND D2.DOC_TYP_CD ='AD-AR-001'
			                                                             ) D1,
			                                                             UBKERAPP.ECM_FILE_LIST_VIEW D2
			                                                        WHERE D1.DOC_ID = D2.DOC_ID 
			                                                          AND ROWNUM = 1)
			       END AS TYPE5_FILE_NM /*감사결과보고서 첨부파일명*/,
			       D3.TYPE6_DOC_TYP_CD /*변경사항대조표 문서유형코드*/  ,
			       CASE
			         WHEN D3.TYPE6_DOC_TYP_CD = 'SP-OE-006' THEN (SELECT D1.DOC_ID
															        FROM TBCSPAOE040M D1
															       WHERE D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-006'
															         AND ROWNUM = 1)
			       END AS TYPE6_DOC_ID /*변경사항대조표 문서ID*/,
			       CASE
			         WHEN D3.TYPE6_DOC_TYP_CD = 'SP-OE-006' THEN (SELECT D2.FILE_NAME
															        FROM TBCSPAOE040M D1 ,
															             UBKERAPP.ECM_FILE_LIST_VIEW D2
															       WHERE D1.DOC_ID = D2.DOC_ID 
															         AND D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-006'
															         AND ROWNUM = 1)
			       END AS TYPE6_FILE_NM /*변경사항대조표 첨부파일명*/,
			       D3.TYPE7_DOC_TYP_CD /*변경의결사항대조표 문서유형코드*/,
			       CASE
			         WHEN D3.TYPE7_DOC_TYP_CD = 'SP-OE-007' THEN (SELECT D1.DOC_ID
															        FROM TBCSPAOE040M D1
															       WHERE D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-007'
															         AND ROWNUM = 1)
			       END AS TYPE7_DOC_ID /*변경의결사항대조표 문서ID*/,
			       CASE
			         WHEN D3.TYPE7_DOC_TYP_CD = 'SP-OE-007' THEN (SELECT D2.FILE_NAME
														            FROM TBCSPAOE040M D1 ,
														                 UBKERAPP.ECM_FILE_LIST_VIEW D2
														           WHERE D1.DOC_ID = D2.DOC_ID 
														             AND D1.AUD_YR = #strAudYr#
														             AND D1.TSK_NO = #strTskNo#
														             AND D1.DOC_TYP_CD = 'SP-OE-007'
														             AND ROWNUM = 1)
			       END AS TYPE7_FILE_NM /*변경의결사항대조표 첨부파일명*/,
			       '' AS ECM_FILE_INFO1 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO2 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO3 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO4 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO5 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO6 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO7 /*ECM 첨부파일정보(XML)*/
			  FROM (SELECT #strAudYr# AS AUD_YR ,
			               #strTskNo# AS TSK_NO ,
			               'SP-OE-001' AS TYPE1_DOC_TYP_CD ,
			               'SP-OE-002' AS TYPE2_DOC_TYP_CD ,
			               'SP-OE-003' AS TYPE3_DOC_TYP_CD ,
			               'SP-OE-004' AS TYPE4_DOC_TYP_CD ,
			               'SP-OE-005' AS TYPE5_DOC_TYP_CD ,
			               'SP-OE-006' AS TYPE6_DOC_TYP_CD ,
			               'SP-OE-007' AS TYPE7_DOC_TYP_CD
			          FROM DUAL ) D3 
		]]>
	</select>
	
	<!-- 감사업무관리- 미연계 감사업무 처리단계 첨부파일 조회  CSPAOE023E 화면-->
	<select id="CSPAOE023EMainSubSelect023" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D3.AUD_YR /*감사년도*/,
			       D3.TSK_NO /*업무번호*/,
			       D3.TYPE1_DOC_TYP_CD /*예비조사계획서 문서유형코드*/,
			       CASE
			         WHEN D3.TYPE1_DOC_TYP_CD = 'SP-OE-001' THEN (SELECT D1.DOC_ID
														            FROM TBCSPAOE040M D1
														           WHERE D1.AUD_YR = #strAudYr#
														             AND D1.TSK_NO = #strTskNo#
														             AND D1.DOC_TYP_CD = 'SP-OE-001'
														             AND ROWNUM = 1)
			       END AS TYPE1_DOC_ID /*예비조사계획서 문서ID*/,
			       CASE
			         WHEN D3.TYPE1_DOC_TYP_CD = 'SP-OE-001' THEN (SELECT D2.FILE_NAME
															        FROM TBCSPAOE040M D1 ,
															             UBKERAPP.ECM_FILE_LIST_VIEW D2
															       WHERE D1.DOC_ID = D2.DOC_ID
															         AND D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-001'
															         AND ROWNUM = 1)
			       END AS TYPE1_FILE_NM /*예비조사계획서 첨부파일명*/  ,
			       D3.TYPE2_DOC_TYP_CD /*실지감사계획서 문서유형코드*/,
			       CASE
			         WHEN D3.TYPE2_DOC_TYP_CD = 'SP-OE-002' THEN (SELECT D1.DOC_ID AS DOC_ID
			                                                        FROM TBCSPAOE040M D1
			                                                       WHERE D1.AUD_YR = #strAudYr#
			                                                         AND D1.TSK_NO = #strTskNo#
			                                                         AND D1.DOC_TYP_CD = 'SP-OE-002'
			                                                         AND ROWNUM = 1)
			       END AS TYPE2_DOC_ID /*실지감사계획서 문서ID*/,
			       CASE
			         WHEN D3.TYPE2_DOC_TYP_CD = 'SP-OE-002' THEN (SELECT D2.FILE_NAME
			                                                        FROM 
			                                                            (SELECT D1.DOC_ID
			                                                               FROM TBCSPAOE040M D1
			                                                             WHERE D1.AUD_YR = #strAudYr#
			                                                               AND D1.TSK_NO = #strTskNo#
			                                                               AND D1.DOC_TYP_CD = 'SP-OE-002'
			                                                             ) D1,
			                                                             UBKERAPP.ECM_FILE_LIST_VIEW D2
			                                                        WHERE D1.DOC_ID = D2.DOC_ID 
			                                                          AND ROWNUM = 1)
			       END AS TYPE2_FILE_NM /*실지감사계획서 첨부파일명*/,
			       D3.TYPE3_DOC_TYP_CD /*귀청보고서 문서유형코드*/,
			       CASE
			         WHEN D3.TYPE3_DOC_TYP_CD = 'SP-OE-003' THEN (SELECT D1.DOC_ID
															        FROM TBCSPAOE040M D1
															       WHERE D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-003'
															         AND ROWNUM = 1)
				   END AS TYPE3_DOC_ID /*귀청보고서 문서ID*/, 			
			       CASE
			         WHEN D3.TYPE3_DOC_TYP_CD = 'SP-OE-003' THEN (SELECT D2.FILE_NAME
			                                                        FROM 
			                                                            (SELECT D1.DOC_ID
			                                                              FROM TBCSPAOE040M D1
			                                                             WHERE D1.AUD_YR = #strAudYr#
			                                                               AND D1.TSK_NO = #strTskNo#
			                                                               AND D1.DOC_TYP_CD = 'SP-OE-003'
			                                                             ) D1,
			                                                             UBKERAPP.ECM_FILE_LIST_VIEW D2
			                                                        WHERE D1.DOC_ID = D2.DOC_ID 
			                                                          AND ROWNUM = 1)
			       END AS TYPE3_FILE_NM /*귀청보고서 첨부파일명*/,
			       D3.TYPE4_DOC_TYP_CD /*기여율배분계획서 문서유형코드*/  ,
			       CASE
			         WHEN D3.TYPE4_DOC_TYP_CD = 'SP-OE-004' THEN (SELECT D1.DOC_ID
														            FROM TBCSPAOE040M D1
														           WHERE D1.AUD_YR = #strAudYr#
														             AND D1.TSK_NO = #strTskNo#
														             AND D1.DOC_TYP_CD = 'SP-OE-004'
														             AND ROWNUM = 1)
			       END AS TYPE4_DOC_ID /*기여율배분계획서 문서ID*/,
			       CASE
			         WHEN D3.TYPE4_DOC_TYP_CD = 'SP-OE-004' THEN (SELECT D2.FILE_NAME
															        FROM TBCSPAOE040M D1 ,
															             UBKERAPP.ECM_FILE_LIST_VIEW D2
															       WHERE D1.DOC_ID = D2.DOC_ID 
															         AND D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-004'
															         AND ROWNUM = 1)
			       END AS TYPE4_FILE_NM /*기여율배분계획서 첨부파일명*/,
			       D3.TYPE5_DOC_TYP_CD /*감사결과보고서 문서유형코드*/,
			       CASE
			         WHEN D3.TYPE5_DOC_TYP_CD = 'SP-OE-005' THEN (SELECT D1.DOC_ID
			                                                        FROM TBCSPAOE040M D1
			                                                       WHERE D1.AUD_YR = #strAudYr#
			                                                         AND D1.TSK_NO = #strTskNo#
			                                                         AND D1.DOC_TYP_CD = 'SP-OE-005'
			                                                         AND ROWNUM = 1)
			       END AS TYPE5_DOC_ID /*감사결과보고서 문서ID*/,
			       CASE
			         WHEN D3.TYPE5_DOC_TYP_CD = 'SP-OE-005' THEN (SELECT D2.FILE_NAME
			                                                        FROM 
			                                                            (SELECT D1.DOC_ID
			                                                              FROM TBCSPAOE040M D1
			                                                             WHERE D1.AUD_YR = #strAudYr#
			                                                               AND D1.TSK_NO = #strTskNo#
			                                                               AND D1.DOC_TYP_CD = 'SP-OE-005'
			                                                             ) D1,
			                                                             UBKERAPP.ECM_FILE_LIST_VIEW D2
			                                                        WHERE D1.DOC_ID = D2.DOC_ID 
			                                                          AND ROWNUM = 1)
			       END AS TYPE5_FILE_NM /*감사결과보고서 첨부파일명*/,
			       D3.TYPE6_DOC_TYP_CD /*변경사항대조표 문서유형코드*/  ,
			       CASE
			         WHEN D3.TYPE6_DOC_TYP_CD = 'SP-OE-006' THEN (SELECT D1.DOC_ID
															        FROM TBCSPAOE040M D1
															       WHERE D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-006'
															         AND ROWNUM = 1)
			       END AS TYPE6_DOC_ID /*변경사항대조표 문서ID*/,
			       CASE
			         WHEN D3.TYPE6_DOC_TYP_CD = 'SP-OE-006' THEN (SELECT D2.FILE_NAME
															        FROM TBCSPAOE040M D1 ,
															             UBKERAPP.ECM_FILE_LIST_VIEW D2
															       WHERE D1.DOC_ID = D2.DOC_ID 
															         AND D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-006'
															         AND ROWNUM = 1)
			       END AS TYPE6_FILE_NM /*변경사항대조표 첨부파일명*/,
			       D3.TYPE7_DOC_TYP_CD /*변경의결사항대조표 문서유형코드*/,
			       CASE
			         WHEN D3.TYPE7_DOC_TYP_CD = 'SP-OE-007' THEN (SELECT D1.DOC_ID
															        FROM TBCSPAOE040M D1
															       WHERE D1.AUD_YR = #strAudYr#
															         AND D1.TSK_NO = #strTskNo#
															         AND D1.DOC_TYP_CD = 'SP-OE-007'
															         AND ROWNUM = 1)
			       END AS TYPE7_DOC_ID /*변경의결사항대조표 문서ID*/,
			       CASE
			         WHEN D3.TYPE7_DOC_TYP_CD = 'SP-OE-007' THEN (SELECT D2.FILE_NAME
														            FROM TBCSPAOE040M D1 ,
														                 UBKERAPP.ECM_FILE_LIST_VIEW D2
														           WHERE D1.DOC_ID = D2.DOC_ID 
														             AND D1.AUD_YR = #strAudYr#
														             AND D1.TSK_NO = #strTskNo#
														             AND D1.DOC_TYP_CD = 'SP-OE-007'
														             AND ROWNUM = 1)
			       END AS TYPE7_FILE_NM /*변경의결사항대조표 첨부파일명*/,
			       '' AS ECM_FILE_INFO1 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO2 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO3 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO4 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO5 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO6 /*ECM 첨부파일정보(XML)*/,
			       '' AS ECM_FILE_INFO7 /*ECM 첨부파일정보(XML)*/
			  FROM (SELECT #strAudYr# AS AUD_YR ,
			               #strTskNo# AS TSK_NO ,
			               'SP-OE-001' AS TYPE1_DOC_TYP_CD ,
			               'SP-OE-002' AS TYPE2_DOC_TYP_CD ,
			               'SP-OE-003' AS TYPE3_DOC_TYP_CD ,
			               'SP-OE-004' AS TYPE4_DOC_TYP_CD ,
			               'SP-OE-005' AS TYPE5_DOC_TYP_CD ,
			               'SP-OE-006' AS TYPE6_DOC_TYP_CD ,
			               'SP-OE-007' AS TYPE7_DOC_TYP_CD
			          FROM DUAL ) D3 
		]]>
	</select>
	
	<!-- 감사사항(연계)조회 (팝업) 조회 -->
	<select id="CSPAOE111PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT A.AUD_YR 	/*감사년도*/
				 , A.AUD_NO AS TSK_NO		/*감사번호*/
				 , F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, A.AUD_KND_CD, '-') AS TSK_YR_NO	/*감사연번호*/
				 , A.AUD_SBJ_NM	/*감사사항명*/
				 , A.SPV_BRDV_CD AS HNDL_DIV_DPT_CD
			  FROM TBBADDED001M A
			 WHERE NOT EXISTS (
			                    SELECT B.AUD_YR
			                         , B.TSK_NO
			                    FROM TBCSPAOE021M B
			                    WHERE A.AUD_YR = B.AUD_YR
			                      AND A.AUD_NO = B.TSK_NO
			                      AND LENGTH(B.TSK_NO) = 3)
  			  AND A.AUD_YR = #strAudYr#
  			  AND SUBSTR(A.AUD_KND_CD, -1) NOT IN ('5','8','9')
  			  
  		]]>
		<isNotEmpty prepend="AND" property="strAudSbjNm">
			      A.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strTskNo">
			      A.AUD_GRN_NO = #strTskNo#
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="strAudYrNoKndCd">
			      SUBSTR(A.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
		</isNotEmpty>
		
	 	<![CDATA[
		 ORDER BY A.AUD_YR, A.AUD_NO
		]]>
	</select>
	
	<!-- 감사사항(연계) 정보 삭제 -->
	<delete id="CSPAOE015PMainDelete" parameterClass="paramMap">
		DELETE TBCSPAOE021M
		WHERE 1 = 1
		  AND AUD_YR = #AUD_YR#
		  AND TSK_NO = #TSK_NO#
	</delete>
	
	<!-- 신규등록 전 중복된 정보가 있는지 체크한다. -->
	<select id="CSPAOE015PCntSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBCSPAOE021M D1
			 WHERE 1=1
			   AND AUD_YR = #AUD_YR#
			   AND TSK_NO = #TSK_NO#
		]]>
	</select>
	
	<!-- 감사사항(연계) 신규등록 -->
	<insert id="CSPAOE015PMainInsert" parameterClass="paramMap">
		INSERT INTO TBCSPAOE021M
		(
			  AUD_YR
			, TSK_NO
			, AUD_KND_CD
			, AUD_SBJ_NM
			, HNDL_DIV_DPT_CD
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		) VALUES
		(
			  #AUD_YR#
			, #TSK_NO#
			, #AUD_KND_CD#
			, #AUD_SBJ_NM#
			, #HNDL_DIV_DPT_CD#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	</insert>
	
	<!-- 감사업무 평가관리 업무현황 출력 -->
	<select id="CSPAOE075RSelect1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR /*평가년도*/,
			       D1.TSK_NO /*감사번호*/,
			       NVL(F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.TSK_NO, D8.AUD_KND_CD, '-'),D1.AUD_YR||'-'||D1.TSK_NO) AS TSK_YR_NO /*감사연번호*/  ,
			       D1.AUD_SBJ_NM /*감사사항명*/,
			       D1.HNDL_DIV_DPT_CD /*처리과부서코드*/,
			       F_DPT_INFO(D1.HNDL_DIV_DPT_CD, '1') AS HNDL_DIV_DPT_NM /*처리과명*/,
			       NVL(D1.TG_ORG_NM, '') AS TG_ORG_NM /*대상기관명*/,
			       D1.AUD_KND_CD    /*감사종류코드*/,
			       F_CODE_NM('1000270', D1.AUD_KND_CD) AS AUD_KND_NM /*감사종류명*/,
			       F_CODE_NM('1000273', D6.AUD_STEP_CD) AS AUD_STEP_CD  /*감사기말단계명*/,
			       D1.AUD_LDR_CNB /*감사단장 전산번호*/,
			       D1.AUD_LDR_BLT_DPT_CD /*감사단장소속부서코드*/,
			       F_DPT_INFO(D1.AUD_LDR_BLT_DPT_CD, '1') AS AUD_LDR_BLT_DPT_NM /*감사단장소속부서명*/,
			       D1.AUD_LDR_RANK_CD /*감사단장직급코드*/,
			       F_CODE_NM('1000173', D1.AUD_LDR_RANK_CD) AS PST_NM  /*감사단장직급명*/,
			       D3.USR_NAM AS AUD_LDR_NM /*감사단장성명*/,
			       D1.SPVR_CNB /*주관자전산번호*/,
			       D1.SPVR_BLT_DPT_CD /*주관자소속부서코드*/,
			       F_DPT_INFO(D1.SPVR_BLT_DPT_CD, '1') AS SPVR_BLT_DPT_NM   /*주관자소속부서명*/,
			       D1.SPVR_RANK_CD /*주관자직급코드*/,
			       F_CODE_NM('1000173', D1.SPVR_RANK_CD) AS SPVR_RANK_NM    /*주관자직급명*/,
			       D4.USR_NAM AS SPVR_NM /*주관자성명*/,
			       D1.AST_CNB /*보조자전산번호*/,
			       D1.AST_BLT_DPT_CD /*보조자소속부서코드*/,
			       F_DPT_INFO(D1.AST_BLT_DPT_CD, '1') AS AST_BLT_DPT_NM /*보조자소속부서명*/,
			       D1.AST_RANK_CD /*보조자직급코드*/,
			       F_CODE_NM('1000173', D1.AST_RANK_CD) AS AST_RANK_NM  /*보조자직급명*/,
			       D5.USR_NAM AS AST_NM /*보조자성명*/,
			       NVL(D1.BZT_AM, 0) AS BZT_AM /*출장금액*/,
			       CASE
			         WHEN (SELECT LUNH_DT
			          FROM TBCSPAOE022M
			         WHERE AUD_YR = #strAudYr#
			           AND TSK_NO = #strTskNo#
			           AND AUD_STEP_CD = '10000') IS NULL THEN ''
			         ELSE SUBSTR((SELECT LUNH_DT
			                  FROM TBCSPAOE022M
			                 WHERE AUD_YR = #strAudYr#
			                   AND TSK_NO = #strTskNo#
			                   AND AUD_STEP_CD = '10000'), 1, 4)||'-'||SUBSTR((SELECT LUNH_DT
			                  FROM TBCSPAOE022M
			                 WHERE AUD_YR = #strAudYr#
			                   AND TSK_NO = #strTskNo#
			                   AND AUD_STEP_CD = '10000'), 5, 2)||'-'||SUBSTR((SELECT LUNH_DT
			                  FROM TBCSPAOE022M
			                 WHERE AUD_YR = #strAudYr#
			                   AND TSK_NO = #strTskNo#
			                   AND AUD_STEP_CD = '10000'), 7, 2)
			       END AS RSV_INSPC_LUNH_DT /*예비조사착수일*/,
			       CASE
			         WHEN (SELECT CMPT_DT
			          FROM TBCSPAOE022M
			         WHERE AUD_YR = #strAudYr#
			           AND TSK_NO = #strTskNo#
			           AND AUD_STEP_CD = '10010') IS NULL THEN ''
			         ELSE SUBSTR((SELECT CMPT_DT
			                  FROM TBCSPAOE022M
			                 WHERE AUD_YR = #strAudYr#
			                   AND TSK_NO = #strTskNo#
			                   AND AUD_STEP_CD = '10010'), 1, 4)||'-'||SUBSTR((SELECT CMPT_DT
			                  FROM TBCSPAOE022M
			                 WHERE AUD_YR = #strAudYr#
			                   AND TSK_NO = #strTskNo#
			                   AND AUD_STEP_CD = '10010'), 5, 2)||'-'||SUBSTR((SELECT CMPT_DT
			                  FROM TBCSPAOE022M
			                 WHERE AUD_YR = #strAudYr#
			                   AND TSK_NO = #strTskNo#
			                   AND AUD_STEP_CD = '10010'), 7, 2)
			       END AS ENF_DT /*시행일*/,
			       D7.TOT_AUD_OP_PRD_DCN /*총감사운영기간일수*/,
			       NVL(D1.MNDY_CNT, 9) AS MNDY_CNT /*연인원수*/,
			       NVL(D2.DLAY_DT_NM, '0') AS DLAY_DT_NM /*지연일명*/,
			       NVL(D2.EXET_DCN, 0) AS EXET_DCN /*면책일수*/  ,
			       D7.STUT_NOP_CNT /*단계별인원수*/,
			       D7.STUT_PRD_DCN /*단계별기간일수*/,
			       D1.MAIN_INDC_SBJ_PRB_TXT /*주요지적사항문제점내용*/  ,
			       D1.MAIN_AUD_RSLT_EPT_EFCT_TXT /*주요감사결과기대효과내용*/,
			       D1.SPCT_SBJ_PLN_CTT_CTB_RTE_CHG_RSN_TXT /*특기사항계획대비기여율변경사유내용*/
			  FROM TBCSPAOE021M D1 ,
			       (SELECT AUD_YR,
			               TSK_NO,
			               SUM(DLAY_DT_NM) AS DLAY_DT_NM,
			               SUM(EXET_DCN) AS EXET_DCN
			          FROM TBCSPAOE022M
			         GROUP BY AUD_YR,
			               TSK_NO) D2 ,
			       TBDCMACM001M D3 ,
			       TBDCMACM001M D4 ,
			       TBDCMACM001M D5 ,
			       (SELECT NVL(MAX(AUD_STEP_CD), '') AS AUD_STEP_CD
			          FROM TBCSPAOE022M
			         WHERE AUD_YR = #strAudYr#
			           AND TSK_NO = #strTskNo#
			           AND CMPT_DT IS NOT NULL ) D6 ,
			       (SELECT A.AUD_YR /*감사년도*/          ,
			               A.AUD_NO AS TSK_NO /*감사번호*/,
			               A.AUD_DCN AS TOT_AUD_OP_PRD_DCN /* 총감사운영기간일*/,
			               C.IN_PSON_CNT AS STUT_NOP_CNT /* 단계별인원*/,
			               C.AUD_DCN AS STUT_PRD_DCN /* 단계별 기간일*/
			          FROM (SELECT A.AUD_YR /*감사년도*/                  ,
			                       A.AUD_NO /*감사번호*/,
			                       MAX(AUD_KND_CD) AUD_KND_CD /*감사종류코드*/,
			                       sum(B.AUD_DCN) AS AUD_DCN /*총감사운영기간일*/
			                  FROM TBBADDED001M A ,
			                       TBBADDED002M B
			                 WHERE A.AUD_YR = B.REL_AUD_YR
			                   AND A.AUD_NO = B.REL_AUD_NO
			                   AND BZT_DVSN_CD ='1'
			                   AND A.AUD_YR = #strAudYr#
			                   AND A.AUD_NO = #strTskNo#
			                 GROUP BY A.AUD_YR ,
			                       A.AUD_NO ,
			                       A.TOT_DRTR_BRDV_CD ,
			                       A.SPVR_BRDV_CD ,
			                       A.AST_BRDV_CD ) A,
			               (SELECT REL_AUD_YR ,
			                       REL_AUD_NO ,
			                       SUBSTRB(max(SYS_CONNECT_BY_PATH(FLD_AUD_STEP_NO||'단계('||AUD_DCN||'일)', ' ')), 2) AUD_DCN ,
			                       max(IN_PSON_MAN_DAY) IN_PSON_MAN_DAY ,
			                       SUBSTRB(max(SYS_CONNECT_BY_PATH(FLD_AUD_STEP_NO||'단계('||IN_PSON_CNT||'명)', ' ')), 2) IN_PSON_CNT
			                  FROM (SELECT ROWNUM RN ,
			                               A.REL_AUD_YR ,
			                               A.REL_AUD_NO ,
			                               A.BZT_YR ,
			                               A.BZT_SNO ,
			                               A.AUD_DCN ,
			                               B.IN_PSON_CNT ,
			                               SUM(C.IN_PSON_MAN_DAY) OVER (PARTITION BY REL_AUD_YR, REL_AUD_NO) IN_PSON_MAN_DAY ,
			                               FLD_AUD_STEP_NO
			                          FROM TBBADDED002M A ,
			                               (select /*+ INDEX(A KBBADBADDED005001) */
			                               		   BZT_YR ,
			                                       BZT_SNO ,
			                                       sum( case when A.STF_DVSN_CD = '0' then 1
                                                             else 0
                                                         end) as IN_PSON_CNT
			                                  from (SELECT distinct BZT_YR ,
			                                               BZT_SNO ,
			                                               PCT_CNB ,
			                                               STF_DVSN_CD
			                                          FROM TBBADDED005L ) A
			                                 group by BZT_YR, BZT_SNO ) B,
			                               (select /*+INDEX(B, KBBADBADDED006001)*/
			                               		   pt1.BZT_YR,
			                                       pt1.BZT_SNO,
			                                       SUM(  case
                                                            when tma.STF_DVSN_CD = '0' then pt1.AUD_DCN
                                                            else 0
                                                          end) AS IN_PSON_MAN_DAY
			                                  from TBBADDED005L tma ,
			                                       TBBADDED006L pt1
			                                 where pt1.BZT_YR = tma.BZT_YR
			                                   and pt1.BZT_SNO = tma.BZT_SNO
			                                   and pt1.TEAM_SNO = tma.TEAM_SNO
			                                   and pt1.PCT_ALC_SNO = tma.PCT_ALC_SNO
			                                 group by pt1.BZT_YR, pt1.BZT_SNO ) C
			                         WHERE B.BZT_YR(+) = A.BZT_YR
			                           AND B.BZT_SNO(+) = A.BZT_SNO
			                           AND C.BZT_YR(+) = A.BZT_YR
			                           AND C.BZT_SNO(+) = A.BZT_SNO /*AND AUD_BZT_KND_CD ='02'*/
			                           AND A.REL_AUD_YR = #strAudYr#
			                           AND A.REL_AUD_NO = #strTskNo# )
			                 WHERE LEVEL >= 1 START WITH RN = 1 CONNECT BY PRIOR RN = RN-1
			                 group by REL_AUD_YR, REL_AUD_NO ) C
			         WHERE A.AUD_YR = C.REL_AUD_YR
			           AND A.AUD_NO = C.REL_AUD_NO
			           AND A.AUD_YR = #strAudYr#
			           AND A.AUD_NO = #strTskNo# ) D7 ,TBBADDED001M D8
			 WHERE 1=1
			   AND ROWNUM = 1
			   AND D1.AUD_YR = D2.AUD_YR (+)
			   AND D1.TSK_NO = D2.TSK_NO (+)
			   AND D1.AUD_LDR_CNB = D3.CNB (+)
			   AND D1.SPVR_CNB = D4.CNB (+)
			   AND D1.AST_CNB = D5.CNB (+)
			   AND D1.AUD_YR = D7.AUD_YR (+)
			   AND D1.TSK_NO = D7.TSK_NO (+)
			   AND D1.AUD_YR = D8.AUD_YR(+)
  			   AND D1.TSK_NO = D8.AUD_NO(+)
			   AND D1.AUD_YR = #strAudYr#
			   AND D1.TSK_NO = #strTskNo#
        ]]>
	</select>
	
	<!-- 감사업무 평가관리 첨부파일 출력 -->
	<select id="CSPAOE075RSelect1-1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D2.FILE_NAME AS DOC_NM	/*파일명*/
		         , F_CODE_NM('1000500', D8.DOC_TYP_CD) AS DOC_TYP_CD /*문서유형코드명*/
		      FROM TBCSPAOE040M D8
		         , UBKERAPP.ECM_FILE_LIST_VIEW D2
		     WHERE 1=1
		       AND D8.DOC_ID = D2.DOC_ID (+)
		       AND D8.AUD_YR = #strAudYr#
		       AND D8.TSK_NO = #strTskNo#
        ]]>
	</select>	
	
	<!-- 감사업무 평가관리 - 위원평가 이전단계 평가결과 출력 -->
	<select id="CSPAOE076RSelect1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT NVL(F_CODE_NM('1000279', EVL_STEP_CD),'') AS EVL_STEP_NM /*평가단계명*/
			     , NVL(F_USR_INFO(EVL_CMTR_CNB, '2'),'') AS USR_NM /*평가자명*/
			     , NVL(F_CODE_NM('1000274', EVL_RK_CD),'') AS EVL_RK_NM /*평가등급*/
			     , NVL(EVL_OPIN,'') AS EVL_OPIN /*평가의견*/
			  FROM TBCSPAOE029M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
			   AND TSK_DVSN_CD = '10000'
			   AND AUD_TSK_KND_CD = #strAudKndCd#
			   AND EVL_STEP_CD = '100' /*귀청보고평가*/
			   AND AUD_YR = #strAudYr#
			   AND TSK_NO = #strTskNo#
        ]]>
	</select>
	
	<!-- 감사업무 평가관리 - 위원평가 평가지표 평가결과 출력 -->
	<select id="CSPAOE076RSelect1-1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT NVL(F.USR_DPT_NM,'') AS USR_DPT_NM	/*소속부서명*/
			     , NVL(F.USR_RANK_NM,'') AS USR_RANK_NM	/*직급명*/
			     , NVL(F.USR_NM,'') AS USR_NM	/*평가자명*/
			     , NVL(F.SYT_EVL_ADVL_VAL,'') AS SYT_EVL_ADVL_VAL	/*종합평가가중치*/
			     , NVL(C.PJCD02,'') AS PJCD02	/*감사준비 평가등급*/
			     , NVL(C.PJCD01,'') AS PJCD01	/*감사투입인력비용의적정성 평가등급*/
			     , NVL(C.PJCD03,'') AS PJCD03	/*감사난이도 평가등급*/
			     , NVL(C.PJCD04,'') AS PJCD04	/*지적사항 변경 불문정도 평가등급*/
			     , NVL(C.PJCD05,'') AS PJCD05	/*처리안 작성의 적정성 평가등급*/
			     , NVL(C.PJCD06,'') AS PJCD06	/*감사성과정도 평가등급*/
			FROM
			(
			    SELECT MAX(B.PJCD02) AS PJCD02  /*감사준비*/
			         , MAX(B.PJCD01) AS PJCD01  /*감사투입인력비용의적정성*/
			         , MAX(B.PJCD03) AS PJCD03  /*감사난이도*/
			         , MAX(B.PJCD04) AS PJCD04  /*지적사항 변경 불문정도*/
			         , MAX(B.PJCD05) AS PJCD05  /*처리안 작성의 적정성*/
			         , MAX(B.PJCD06) AS PJCD06  /*감사성과정도*/
			    FROM
			    (
			        SELECT A.EVL_INDEX_CD  /*평가지표코드*/
			             , A.EVL_INDEX_NM  /*평가지표명*/
			             , CASE WHEN A.EVL_INDEX_CD = 'PJCD02' THEN A.EVL_RK_NM END AS PJCD02
			             , CASE WHEN A.EVL_INDEX_CD = 'PJCD01' THEN A.EVL_RK_NM END AS PJCD01
			             , CASE WHEN A.EVL_INDEX_CD = 'PJCD03' THEN A.EVL_RK_NM END AS PJCD03
			             , CASE WHEN A.EVL_INDEX_CD = 'PJCD04' THEN A.EVL_RK_NM END AS PJCD04
			             , CASE WHEN A.EVL_INDEX_CD = 'PJCD05' THEN A.EVL_RK_NM END AS PJCD05
			             , CASE WHEN A.EVL_INDEX_CD = 'PJCD06' THEN A.EVL_RK_NM END AS PJCD06
			        FROM
			        (
				        SELECT D1.EVL_INDEX_CD  /*평가지표코드*/
				             , D1.EVL_INDEX_NM  /*평가지표명*/
				             , F_CODE_NM('1000274', D2.EVL_RK_CD) AS EVL_RK_NM /*평가등급*/
				        FROM TBCSPAOE029M D3
				           , TBCSPAOE030M D2
				           , TBCSPAOE002M D1
				        WHERE D2.EVL_YR = D1.EVL_YR (+)
				          AND D2.HLYR_DVSN_CD = D1.HLYR_DVSN_CD (+)
				          AND D2.EVL_INDEX_CD = D1.EVL_INDEX_CD (+)
				          AND D3.EVL_YR = D2.EVL_YR (+)
				          AND D3.HLYR_DVSN_CD = D2.HLYR_DVSN_CD (+)
				          AND D3.TSK_DVSN_CD = D2.TSK_DVSN_CD (+)
				          AND D3.AUD_TSK_KND_CD = D2.AUD_TSK_KND_CD (+)
				          AND D3.EVL_STEP_CD = D2.EVL_STEP_CD (+)
				          AND D3.EVL_CMTR_CNB = D2.EVL_CMTR_CNB (+)
				          AND D3.AUD_YR = D2.AUD_YR (+)
				          AND D3.TSK_NO = D2.TSK_NO (+)
				          AND D2.EVL_YR = #strEvlYr#
				          AND D2.HLYR_DVSN_CD = #strHlyrDvsnCd#
				          AND D2.TSK_DVSN_CD = '10000'  /*감사업무구분*/
				          AND D2.EVL_STEP_CD = '200' /*위원평가*/
				          AND D2.AUD_YR = #strAudYr#
				          AND D2.TSK_NO = #strTskNo#
			        ) A
			    ) B
			) C	/*평가지표별 평가등급*/
			, (
			    SELECT DISTINCT F_DPT_INFO(F_USR_INFO(D3.EVL_CMTR_CNB, '5'), '1') AS USR_DPT_NM /*평가자 소속부서*/
			         , F_CODE_NM('1000173', F_USR_INFO(D3.EVL_CMTR_CNB, '3')) AS USR_RANK_NM /*평가자 직급*/
			         , F_USR_INFO(D3.EVL_CMTR_CNB, '2') AS USR_NM /*평가자*/
			         , D3.SYT_EVL_ADVL_VAL /*종합가중치*/
			  FROM TBCSPAOE030M D2
			     , TBCSPAOE029M D3
			  WHERE D3.EVL_YR = D2.EVL_YR (+)
			      AND D3.HLYR_DVSN_CD = D2.HLYR_DVSN_CD (+)
			      AND D3.TSK_DVSN_CD = D2.TSK_DVSN_CD (+)
			      AND D3.AUD_TSK_KND_CD = D2.AUD_TSK_KND_CD (+)
			      AND D3.EVL_STEP_CD = D2.EVL_STEP_CD (+)
			      AND D3.EVL_CMTR_CNB = D2.EVL_CMTR_CNB (+)
			      AND D3.AUD_YR = D2.AUD_YR (+)
			      AND D3.TSK_NO = D2.TSK_NO (+)
			      AND D3.EVL_YR = #strEvlYr#
			      AND D3.HLYR_DVSN_CD = #strHlyrDvsnCd#
			      AND D3.TSK_DVSN_CD = '10000'  /*감사업무구분*/
			      AND D3.EVL_STEP_CD = '200' /*위원평가*/
			      AND D3.AUD_YR = #strAudYr#
			      AND D3.TSK_NO = #strTskNo#
			) F /*평가자정보*/
        ]]>
	</select>	
	
	<!-- 감사업무 평가관리 - 위원평가 평가지표 출력 -->
	<select id="CSPAOE076RSelect1-2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_INDEX_NM	/*평가지표명*/
			     , WGT_RTE	/*비중*/
			  FROM TBCSPAOE002M
			 WHERE 1=1
			   AND EVL_YR = #strEvlYr#
			   AND HLYR_DVSN_CD = #strHlyrDvsnCd#
        ]]>
	</select>
	
	<!-- 감사업무관리 - 평가기간 조회 -->
	<select id="CSPAOE023EEvlDtSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT EVL_YR
			     , HLYR_DVSN_CD
			  FROM TBCSPAOE001M
			 WHERE 1 = 1
			   AND EVL_YR = (SELECT MAX(EVL_YR) AS EVL_YR
							   FROM TBCSPAOE001M)
			   AND HLYR_DVSN_CD = (SELECT MAX(HLYR_DVSN_CD) AS HLYR_DVSN_CD
								     FROM TBCSPAOE001M
								    WHERE 1 = 1
								      AND EVL_YR = (SELECT MAX(EVL_YR) AS EVL_YR
												      FROM TBCSPAOE001M))
        ]]>
	</select>
	
	<!-- 평가대상 시작일자와 평가대상 종료일자 정보를 가져온다 -->
	<select id="CSPAOE023EEvlSearchDateSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
			SELECT CASE WHEN EVL_STR_DT IS NOT NULL AND EVL_END_DT IS NOT NULL THEN ' ※ 평가대상기간 : ' || SUBSTR(EVL_STR_DT, 1, 4) || '.' || SUBSTR(EVL_STR_DT, 5, 2) || '.' || SUBSTR(EVL_STR_DT, 7) || ' ~ ' || SUBSTR(EVL_END_DT, 1, 4) || '.' || SUBSTR(EVL_END_DT, 5, 2) || '.' || SUBSTR(EVL_END_DT, 7)
              		ELSE '' END AS EVL_DT
			  FROM TBCSPAOE001M
			 WHERE 1=1
			   AND EVL_YR = (SELECT EVL_YR 
			 				   FROM TBCSPAOE001M 
			 				  WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT)
			   AND HLYR_DVSN_CD = (SELECT HLYR_DVSN_CD 
			   						 FROM TBCSPAOE001M 
			   					    WHERE SYSDATE BETWEEN EVL_STR_DT AND EVL_END_DT)
		]]>
	</select>				
	<!-- emcha 끝 -->
	
	<!-- 감사종료여부 조회 -->
	<select id="CSPAOE023EAudEndYnSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
			SELECT AUD_END_YN
			FROM TBCSPAOE022M
			WHERE 1 = 1
			AND AUD_YR = #strAudYr#
			AND TSK_NO = #strTskNo#
			AND AUD_STEP_CD = (SELECT MAX(AUD_STEP_CD)
								 FROM TBCSPAOE022M 
								WHERE 1 = 1
								  AND AUD_YR = #strAudYr# 
								  AND TSK_NO = #strTskNo#
								  AND LUNH_DT = (SELECT MAX(LUNH_DT)
												   FROM TBCSPAOE022M
												  WHERE 1 = 1
													AND AUD_YR = #strAudYr#
													AND TSK_NO = #strTskNo#))
		]]>
	</select>	
	
	<!--  -->
	<select id="CSPAOE023EEndAuthYnSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[ 
			SELECT END_AUTH_YN
			  FROM TBCSPAOE017D
			 WHERE 1 = 1
			   AND EVL_YR = (SELECT MAX(EVL_YR)
							   FROM TBCSPAOE001M)
			   AND HLYR_DVSN_CD = (SELECT MAX(HLYR_DVSN_CD)
					 			     FROM TBCSPAOE001M
								    WHERE 1 = 1
					 			      AND EVL_YR = (SELECT MAX(EVL_YR)
												      FROM TBCSPAOE001M))
			   AND TSK_DVSN_CD = '10004'
			   AND CHGR_DVSN_CD = 'CD04'
			   AND CHGR_CNB = #CNB#
		]]>
	</select>
	
</sqlMap> 	