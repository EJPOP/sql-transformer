<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="hrm/cex/001">

	<!--처분요구목록 조회-->
	<select id="HRMCEX001PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT T1.EXPRT_SRNO
			      ,T2.ACTPLN_SRNO
			      ,T1.EXPRT_DVSN_CD
			      ,F_EBSC_CODE_NM('10000024', T1.EXPRT_DVSN_CD) AS EXPRT_DVSN_NM
			      ,T1.EXPRT_SPH_CD
			      ,F_EBSC_CODE_NM('10000025', T1.EXPRT_SPH_CD) AS EXPRT_SPH_NM
			      ,T1.CNB
			      ,F_USR_INFO(T1.CNB,'2') AS USR_NAM
			      ,TO_CHAR(TO_DATE(T1.SELECTN_DT),'YYYY-MM-DD') AS SELECTN_DT
			      ,T2.DPT_CD
			      ,T2.RANK_CD
			      ,F_CODE_NM('1000173',T2.RANK_CD) AS RANK_NM
			      ,F_DPT_INFO(T2.DPT_CD,'1') AS DPT_NM
			  FROM TBHRMCEX001M T1
			      ,TBHRMCEX002M T2
			 WHERE T1.EXPRT_SRNO = T2.EXPRT_SRNO
		]]>			             
           		
		<isNotEmpty property="EXPRT_SRNO">	
			   AND T1.EXPRT_SRNO = #EXPRT_SRNO#
		</isNotEmpty>

		<isNotEmpty property="ACTPLN_SRNO">	
			   AND T2.ACTPLN_SRNO = #ACTPLN_SRNO#
		</isNotEmpty>
	     
		<isNotEmpty property="APV_DOC_NO">	
			   AND T2.APV_DOC_NO = #APV_DOC_NO#
		</isNotEmpty>	     
	</select>
	
	<update id="HRMCEX001PApvSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBHRMCEX002M T1
			   SET APV_DOC_NO = #APV_DOC_NO#
			      ,APV_STA_CD = #APV_STA_CD#
			      ,PRSS_STA_CD = CASE WHEN #APV_STA_CD# = '3' THEN '102' 
			                          WHEN #APV_STA_CD# = '2' THEN '107' ELSE PRSS_STA_CD END
			      ,SMT_DT = CASE WHEN #APV_STA_CD# = '3' THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE SMT_DT END
			 WHERE 1=1
		]]>
		
		<isNotEmpty property="EXPRT_SRNO">
			AND T1.EXPRT_SRNO = #EXPRT_SRNO#
			AND T1.ACTPLN_SRNO = #ACTPLN_SRNO#
		</isNotEmpty>
		
		<isEmpty property="EXPRT_SRNO">
			AND APV_DOC_NO = #APV_DOC_NO#
		</isEmpty>
	</update>
	
	
	<select id="HRMCEX002PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT T1.EXPRT_SRNO
			      ,T2.RPRT_SRNO
			      ,T1.EXPRT_DVSN_CD
			      ,F_EBSC_CODE_NM('10000024', T1.EXPRT_DVSN_CD) AS EXPRT_DVSN_NM
			      ,T1.EXPRT_SPH_CD
			      ,F_EBSC_CODE_NM('10000025', T1.EXPRT_SPH_CD) AS EXPRT_SPH_NM
			      ,T1.CNB
			      ,F_USR_INFO(T1.CNB,'2') AS USR_NAM
			      ,TO_CHAR(TO_DATE(T1.SELECTN_DT),'YYYY-MM-DD') AS SELECTN_DT
			      ,T2.DPT_CD
			      ,T2.RANK_CD
			      ,F_CODE_NM('1000173',T2.RANK_CD) AS RANK_NM
			      ,F_DPT_INFO(T2.DPT_CD,'1') AS DPT_NM
			  FROM TBHRMCEX001M T1
			      ,TBHRMCEX004M T2
			 WHERE T1.EXPRT_SRNO = T2.EXPRT_SRNO
		]]>			             
           		
		<isNotEmpty property="EXPRT_SRNO">	
			   AND T1.EXPRT_SRNO = #EXPRT_SRNO#
		</isNotEmpty>

		<isNotEmpty property="RPRT_SRNO">	
			   AND T2.RPRT_SRNO = #RPRT_SRNO#
		</isNotEmpty>
	     
		<isNotEmpty property="APV_DOC_NO">	
			   AND T2.APV_DOC_NO = #APV_DOC_NO#
		</isNotEmpty>	     
	</select>
	
	<update id="HRMCEX002PApvSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBHRMCEX004M T1
			   SET APV_DOC_NO = #APV_DOC_NO#
			      ,APV_STA_CD = #APV_STA_CD#
			      ,PRSS_STA_CD = CASE WHEN #APV_STA_CD# = '3' THEN '102' 
			                          WHEN #APV_STA_CD# = '2' THEN '107' ELSE PRSS_STA_CD END
			      ,SMT_DT = CASE WHEN #APV_STA_CD# = '3' THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE SMT_DT END
			 WHERE 1=1
		]]>
		
		<isNotEmpty property="EXPRT_SRNO">
			AND T1.EXPRT_SRNO = #EXPRT_SRNO#
			AND T1.RPRT_SRNO = #RPRT_SRNO#
		</isNotEmpty>
		
		<isEmpty property="EXPRT_SRNO">
			AND APV_DOC_NO = #APV_DOC_NO#
		</isEmpty>
	</update>
</sqlMap> 
