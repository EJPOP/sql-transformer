<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/bii/521">
	<!-- 직무역량평가 대상자 목록 조회 -->   
	<select id="CSPBII521QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[       
			SELECT MAX(B.NAM)                                AS NAM
			     , SUBSTR(A.EIN, 1, 6) || '-******'          AS RRN			     
			     , MAX((SELECT C.ORG_NM
			              FROM TBDCMACM015M C
			             WHERE C.ORG_CD = B.BLT_ORG_CD))     AS BLT_ORG_NM
			     , MAX(B.PST_NM)                             AS PST_NM                          			     
			     , MAX((SELECT D.DPT_NM
			             FROM TBDCMACM015M C
			                , TBDCMACM002M D			          
			            WHERE C.ENFM_DPT_CD = D.DPT_CD
			              AND C.ORG_CD      = B.BLT_ORG_CD)) AS CHR_DPT_NM
			     , '평가(' || COUNT(*) || ')'                 AS MTRL_CNT			          
			     , A.EIN
			  FROM TBCSPBII500L A  /* 직무역량평가내역 */
			     , TBCSPBII300M B  /* 대인정보기본 */  
			 WHERE A.EIN = B.EIN			
		]]>
			<isNotEmpty property="strNam">
				AND B.NAM LIKE #strNam# || '%'
			</isNotEmpty>
			<isNotEmpty property="strRrn">
				AND A.EIN LIKE #strRrn# || '%'
			</isNotEmpty>
			<isNotEmpty property="strBltOrgCd">
				AND B.BLT_ORG_CD = #strBltOrgCd#
			</isNotEmpty>
			<isNotEmpty property="strChgDptCd">
				AND B.BLT_ORG_CD IN (SELECT C.ORG_CD
				                       FROM TBDCMACM015M C
				                      WHERE C.ENFM_DPT_CD = #strChgDptCd#)
			</isNotEmpty>
			GROUP BY A.EIN
			ORDER BY MAX(B.NAM)
	</select>
</sqlMap> 
