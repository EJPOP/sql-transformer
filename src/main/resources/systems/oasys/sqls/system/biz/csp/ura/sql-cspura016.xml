<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/ura/016">

	<select id="CSPURA016EDown" parameterClass="paramMap"	resultClass="resultMap">
	<![CDATA[
	SELECT '[' || A.ACP_YR || '-심사-' || A.ACP_SRNO || ']' || REPLACE(B.TIT_NM,CHR(10),'')||'_'  as title ,a.DOC_ID
  FROM TBBADFRE103M A INNER JOIN TBBADFRE012M B ON (B.ACP_YR = A.ACP_YR
           AND B.ACP_DVSN_CD = A.ACP_DVSN_CD
           AND B.ACP_SRNO = A.ACP_SRNO)
 WHERE A.RPRT_CD = 'D10100200'  
   AND A.ACP_DVSN_CD = '1'
   AND A.ACP_YR || A.ACP_SRNO IN ('2018926','2018925','2018923','2018911','2018910','2018728','2018686'
   ,'2018685','2018684','2018683','2018682','2018681','2018591','2018480','2018479','2018435','2018434'
   ,'2018170','201889','201850','201814','20184','2017670','2017668','2017649','2017646','2017645','2017644',
'2017642','2017620','2017617','2017605','2017600','2017599','2017598','2017588','2017586','2017585','2017553',
'2017552','2017551','2017539','2017524','2017518','2017488','2017487','2017465','2017464','2017459','2017458',
'2017457','2017456','2017443','2017421','2017420','2017419','2017417','2017398','2017396','2017395','2017383',
'2017382','2017369','2017365','2017334','2017318','2017317','2017316','2017311','2017310','2017298','2017297',
'2017296','2017295','2017283','2017282','2017265','2017262','2017261','2017258','2017247','2017241','2017239',
'2017231','2017229','2017224','2017213','2017210','2017209','2017205','2017204','2017191','2017160','2017159',
'2017156','2017153','2017144','2017142','2017141','2017133','2017131','2017130','2017128','2017112','2017108',
'201793','201787','201782','201780','201776','201753','201729','201725','201724','201721','201720','201719',
'2016952','2016945','2016944','2016932','2016931','2016929','2016927','2016926','2016919','2016909','2016894',
'2016889','2016877','2016876','2016875','2016874','2016873','2016869','2016868','2016861','2016860','2016858',
'2016857','2016856','2016855','2016854','2016853','2016852','2016851','2016850','2016849','2016848','2016830',
'2016829','2016814','2016813','2016804','2016803','2016802','2016801','2016793','2016788','2016785','2016777',
'2016776','2016774','2016769','2016760','2016758','2016749','2016747','2016742','2016741','2016740','2016736',
'2016733','2016707','2016701','2016700','2016698','2016690','2016689','2016682','2016681','2016678','2016674',
'2016666','2016663','2016662','2016658','2016634','2016624','2016619','2016618','2016617','2016600','2016598',
'2016597','2016593','2016591','2016588','2016587','2016586','2016585','2016581','2016580','2016578','2016577',
'2016572','2016570','2016561','2016553','2016552','2016551','2016545','2016544','2016539','2016536','2016525',
'2016522','2016516','2016512','2016449','2016448','2016442','2016332','2016326','2016289','2016288','2016283',
'2016282','2016270','2016227','2016178','2016161','2016160','2016158','2016156','2016142','2016138','2016137',
'2016136','2016135','2016133','2016132','2015949','2016131','2016128','2016126','2016124','2016123','2016120',
'2016119','2016115','2016111','2016106','2016100','201697','201696','201693','201691','201689','201683','201679',
'201678','201670','201669','201668','201665','201656','201649','201648','201645','201644','201642','201641',
'201624','201622','201621','201620','201615')

                               ]]>
	</select>
	
	<select id="CSPURA016EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT /*CSPURA016EMainSelect*/ A.STD_YE,
				       A.STD_SLN,
				       A.STD_TASK_NM,
				       CASE WHEN LENGTHB(STD_TASK_NM) > 50 THEN SUBSTRB(A.STD_TASK_NM,1,50)||'...' ELSE A.STD_TASK_NM END AS STD_TASK_NM2,
				       A.CHGR_CNB_1 as CHGR_CNB1,
				       (SELECT USR_NAM FROM TBDCMACM001M WHERE CNB = A.CHGR_CNB_1) AS CHGR_NAM1,
				      	F_USR_INFO(A.CHGR_CNB_1,'2') AS TOT_NM,
				       A.RPT_DT,
				       A.DOC_ID,
				       A.DOC_TYP_CD,
				       A.FRT_USR_ID,
				       A.AUD_STD_SPH_CD,
				       F_CODE_NM('1000605',A.AUD_STD_SPH_CD) AS AUD_STD_SPH_NM,
				       CASE WHEN (TO_DATE(TO_CHAR(SYSDATE,'YYYYMMDD'))- TO_DATE(TO_CHAR(FRT_REGI_DH,'YYYYMMDD'))) < 30 THEN '1' ELSE '2' END AS NEW_YN
				       ,OPEN_DVSN_CD
				       ,F_CODE_NM('1000835',OPEN_DVSN_CD) AS OPEN_DVSN_NM
				       ,ACMP_DVSN_YE
				       ,A.HNDL_DPT_CD
				       ,nvl2((SELECT DPT_CD FROM TBDCMACM002M WHERE DPT_CD = #strDptCd# AND MANPOWER_POOL_SYE_YN = 'Y'),substr(A.HNDL_DPT_CD,0,3)||'000',A.HNDL_DPT_CD) AS CHK_HNDL_DPT_CD
				       ,F_DPT_INFO(A.HNDL_DPT_CD, '1') AS HNDL_DPT_NM
				 FROM TBCSPURA004M A
				WHERE 1=1
				AND A.HNDL_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, 'ALL', '', #strDptCd#))) 
		]]>	
			<dynamic>
				<isNotEmpty property="fromYmd">
				  AND A.RPT_DT &gt;= #fromYmd#
				</isNotEmpty>
				<isNotEmpty property="toYmd">
				  AND A.RPT_DT &lt;= #toYmd#
				</isNotEmpty>
				<isNotEmpty property="CHGR_CNB"> 
				  AND A.CHGR_CNB_1 = #CHGR_CNB# 
				</isNotEmpty>
				<isNotEmpty property="STD_TASK_NM">
				  AND STD_TASK_NM LIKE '%'||#STD_TASK_NM#||'%'
				</isNotEmpty>
				<isNotEmpty property="strAUD_STD_SPH_CD">
				  AND AUD_STD_SPH_CD = #strAUD_STD_SPH_CD#
				</isNotEmpty>
				<isNotEmpty property="strDptCd2">
				  AND A.HNDL_DPT_CD = #strDptCd2#
				</isNotEmpty>
				
			</dynamic>
			 ORDER BY A.RPT_DT DESC
	</select>
	
	<update id="CSPURA016EUpdate" parameterClass="paramMap">
			UPDATE /*CSPURA016EUpdate*/ TBCSPURA004M
			SET FNL_MDF_DH = SYSDATE
			,OPEN_DVSN_CD = #OPEN_DVSN_CD#
			,ACMP_DVSN_YE = #ACMP_DVSN_YE#
			<isNotNull prepend="," property="AUD_STD_SPH_CD">
				AUD_STD_SPH_CD = #AUD_STD_SPH_CD# 
			</isNotNull>
			<isNotNull prepend="," property="STD_TASK_NM">
				STD_TASK_NM = #STD_TASK_NM# 
			</isNotNull>
			<isNotNull prepend="," property="CHGR_CNB1">
				CHGR_CNB_1 = #CHGR_CNB1#
			</isNotNull>
			<isNotNull prepend="," property="RPT_DT">
				RPT_DT = #RPT_DT# 
			</isNotNull>
			<isNotNull prepend="," property="DOC_ID">
				DOC_ID = #DOC_ID# 
			</isNotNull>
			<isNotNull prepend="," property="DOC_TYP_CD">
				DOC_TYP_CD = #DOC_TYP_CD#
			</isNotNull>
			<isNotNull prepend="," property="FNL_USR_ID">
				FNL_USR_ID = #FNL_USR_ID#
			</isNotNull>
			<isNotNull prepend="," property="FNL_DEAL_DPT_CD">
				FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			</isNotNull>
			<isNotNull prepend="," property="FNL_MNU_ID">
				FNL_MNU_ID =#FNL_MNU_ID#
			</isNotNull>
			<isNotNull prepend="," property="HNDL_DPT_CD">
				HNDL_DPT_CD =#HNDL_DPT_CD#
			</isNotNull>
			WHERE STD_YE = #STD_YE#
			  AND STD_SLN = #STD_SLN#
	</update>
	


	<delete id="CSPURA016EDelete" parameterClass="paramMap">
			DELETE FROM TBCSPURA004M
			 WHERE STD_YE = #STD_YE#
			   AND STD_SLN = #STD_SLN#
	</delete>
	
	<select id="CSPURA016EKeySelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	TO_CHAR(SYSDATE, 'YYYY') AS STD_YE
					,NVL(MAX(TO_NUMBER(STD_SLN))+1, 1) AS STD_SLN
			FROM	TBCSPURA004M
			WHERE	STD_YE = (SELECT TO_CHAR(SYSDATE, 'YYYY') FROM DUAL)
		]]>
	</select>
	
	<insert id="CSPURA016EInsert" parameterClass="paramMap">
        <![CDATA[       
				INSERT INTO TBCSPURA004M
				( 
				STD_YE, 
				STD_SLN, 
				STD_TASK_NM, 
				CHGR_CNB_1, 
				RPT_DT, 
				DOC_ID, 
				DOC_TYP_CD, 
				AUD_STD_SPH_CD,
				FRT_USR_ID, 
				FNL_USR_ID, 
				FNL_DEAL_DPT_CD, 
				FNL_MNU_ID, 
				FRT_REGI_DH, 
				FNL_MDF_DH
				,OPEN_DVSN_CD
				,ACMP_DVSN_YE
				,HNDL_DPT_CD )
				VALUES
				(
				#STD_YE#,
				#STD_SLN#,
				#STD_TASK_NM#,
				#CHGR_CNB1#, 
				#RPT_DT#, 
				#DOC_ID#, 
				#DOC_TYP_CD#, 
				#AUD_STD_SPH_CD#,
				#FRT_USR_ID#, 
				#FNL_USR_ID#, 
				#FNL_DEAL_DPT_CD#, 
				#FNL_MNU_ID#, 
				SYSDATE,
				SYSDATE
				,#OPEN_DVSN_CD#
				,#ACMP_DVSN_YE#
				,#HNDL_DPT_CD#
				)
        ]]>
	</insert>
	
	
		<select id="CSPURA016EMainListExcel" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT /*CSPURA001EMainListExcel*/ 
     				   A.STD_TASK_NM AS STD_TASK_NM2,
				       F_USR_INFO(A.CHGR_CNB_1,'2') AS TOT_NM,
				       SUBSTR(A.RPT_DT, 0, 4) || '-' || SUBSTR(A.RPT_DT, 5, 2) || '-' || SUBSTR(A.RPT_DT, 7, 2) AS RPT_DT,
				       F_CODE_NM('1000605',A.AUD_STD_SPH_CD) AS AUD_STD_SPH_NM,
				       A.ACMP_DVSN_YE,
				       F_DPT_INFO(A.HNDL_DPT_CD, '1') AS HNDL_DPT_NM,
				       F_CODE_NM('1000835',OPEN_DVSN_CD) AS OPEN_DVSN_NM
				 FROM TBCSPURA004M A
				WHERE 1=1
				AND A.HNDL_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, 'ALL', '', #strDptCd#)))
		]]>	
			<dynamic>
				<isNotEmpty property="fromYmd">
				  AND A.RPT_DT &gt;= #fromYmd#
				</isNotEmpty>
				<isNotEmpty property="toYmd">
				  AND A.RPT_DT &lt;= #toYmd#
				</isNotEmpty>
				<isNotEmpty property="CHGR_CNB"> 
				  AND A.CHGR_CNB_1 = #CHGR_CNB# 
				</isNotEmpty>
				<isNotEmpty property="STD_TASK_NM">
				  AND STD_TASK_NM LIKE '%'||#STD_TASK_NM#||'%'
				</isNotEmpty>
				<isNotEmpty property="strAUD_STD_SPH_CD">
				  AND AUD_STD_SPH_CD = #strAUD_STD_SPH_CD#
				</isNotEmpty>
				<isNotEmpty property="strDptCd2">
				  AND A.HNDL_DPT_CD = #strDptCd2#
				</isNotEmpty>
				
			</dynamic>
			 ORDER BY A.RPT_DT DESC
	</select>
	
</sqlMap> 
