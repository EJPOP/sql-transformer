<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/acp/001">
	
	<!-- 물품수리요청 목록 조회 -->
	<select id="CSPACP001QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* csp/acp/001/CSPACP001QMainSelect */ ]]>
		<include refid = "include.pageSelct"/>
        <![CDATA[
			SELECT  A.GDS_RQS_SNO,      /*물품요청순번*/
			        A.GDS_DVSN_CD,      /*물품구분번호*/
			        A.RQS_DT,           /*요청일*/
			        D.ABR_DPT_NM_1 AS RQS_DPT_NM,   /*요청자부서명*/
			        B.USR_NAM AS RQR_NAM,   /*요청자명*/
			        A.RQS_TIT_NM,       /*요청제목*/
			        C.USR_NAM AS HNDL_PEN_NAM,  /*처리자명*/
			        A.HNDL_DT,          /*처리일자*/
			        A.RQR_CNB,          /*요청자전산번호*/
			        A.HNDL_PEN_CNB,     /*처리자전산번호*/
			        A.RQS_DPT_CD,        /*처리자부서코드*/
			        A.HNDL_TXT	/*처리결과*/
			FROM    TBCSPACP001M A,
			        TBDCMACM001M B,
			        TBDCMACM001M C,
			        TBDCMACM002M D
			WHERE   A.RQR_CNB = B.CNB(+)
			AND     A.HNDL_PEN_CNB = C.CNB(+)
			AND     A.RQS_DPT_CD = D.DPT_CD(+)
			AND		A.GDS_KBN='1'
			]]>
			<dynamic>
			    <isNotEmpty property="strRQS_DTS">
			        AND	A.RQS_DT &gt;= #strRQS_DTS#
			    </isNotEmpty>
			    <isNotEmpty property="strRQS_DTE">
			        AND	A.RQS_DT &lt;= #strRQS_DTE#
			    </isNotEmpty>
			    <isNotEmpty property="strGDS_DVSN_CD">
			        AND	A.GDS_DVSN_CD = #strGDS_DVSN_CD#
			    </isNotEmpty>
			    <isNotEmpty property="strSEARCH_NM">
			        AND	(D.DPT_NM LIKE '%'||#strSEARCH_NM#||'%'
			                OR A.RQS_TIT_NM LIKE '%'||#strSEARCH_NM#||'%'
			                OR A.RQS_TXT LIKE '%'||#strSEARCH_NM#||'%'
			                OR A.HNDL_TXT LIKE '%'||#strSEARCH_NM#||'%')
			    </isNotEmpty>
			    <isNotEmpty property="strRQR_NAM">
			        AND B.USR_NAM LIKE '%'||#strRQR_NAM#||'%'
			    </isNotEmpty>
			    <isNotEmpty property="strHNDL_PEN_NAM">
			        AND	C.USR_NAM LIKE '%'||#strHNDL_PEN_NAM#||'%'
			    </isNotEmpty>
			    <isEqual property="strRESULT_CD" compareValue="1">
			        AND	A.HNDL_DT IS NULL
			    </isEqual>
			    <isEqual property="strRESULT_CD" compareValue="2">
			        AND	A.HNDL_DT IS NOT NULL
			    </isEqual>
			</dynamic>
        <![CDATA[
        	ORDER BY TO_NUMBER(A.GDS_RQS_SNO) DESC
        ]]>
        <include refid = "include.pageOrder"/> 
	</select>
	
	
	<!-- 물품수리요청 목록 엑셀다운 -->
	<select id="CSPACP001QExcelExportSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* csp/acp/001/CSPACP001QExcelExportSelect */ ]]>
        <![CDATA[
			SELECT ROWNUM, AA.* FROM 
				(SELECT 	/*CSPACP001QExcelExportSelect*/
			        GDS_RQS_SNO,        /*물품요청순번*/
			        F_CODE_NM('1000829',A.GDS_DVSN_CD) AS GDS_DVSN_NM,	/*물품구분명*/
			        TO_CHAR(TO_DATE(A.RQS_DT),'YYYY-MM-DD') AS RQS_DT,		/*요청일자*/
			        D.DPT_NM AS RQS_DPT_NM,	/*요청자부서명*/
			        B.USR_NAM AS RQR_NAM,	/*요청자명*/
			        A.RQS_TIT_NM,			/*요청제목*/
			        C.USR_NAM AS HNDL_PEN_NAM,	/*처리담당자명*/
			        TO_CHAR(TO_DATE(A.HNDL_DT),'YYYY-MM-DD') AS HNDL_DT,	/*처리일자*/
			        A.HNDL_TXT,	/*처리결과*/
			        A.RQS_TXT	/*요청내용*/
			FROM   	TBCSPACP001M A,			/*물품수리요청기본*/
			        TBDCMACM001M B, 		/*사용자테이블(요청자)*/
			        TBDCMACM001M C,			/*사용자테이블(처리자)*/
			        TBDCMACM002M D
			WHERE	A.RQR_CNB = B.CNB(+)
			AND		A.HNDL_PEN_CNB = C.CNB(+)
			AND		A.RQS_DPT_CD = D.DPT_CD(+)
			AND		A.GDS_KBN='1'
        ]]>
        <dynamic>
        	<isNotEmpty property="strRQS_DTS">
        		AND	A.RQS_DT &gt;= #strRQS_DTS#
        	</isNotEmpty>
        	<isNotEmpty property="strRQS_DTE">
        		AND	A.RQS_DT &lt;= #strRQS_DTE#
        	</isNotEmpty>
        	<isNotEmpty property="strGDS_DVSN_CD">
		        AND	A.GDS_DVSN_CD = #strGDS_DVSN_CD#
		    </isNotEmpty>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	(D.DPT_NM LIKE '%'||#strSEARCH_NM#||'%'
        				OR A.RQS_TIT_NM LIKE '%'||#strSEARCH_NM#||'%'
        				OR A.RQS_TXT LIKE '%'||#strSEARCH_NM#||'%'
        				OR A.HNDL_TXT LIKE '%'||#strSEARCH_NM#||'%')
        	</isNotEmpty>
        	<isNotEmpty property="strRQR_NAM">
        		AND B.USR_NAM LIKE '%'||#strRQR_NAM#||'%'
        	</isNotEmpty>
        	<isNotEmpty property="strHNDL_PEN_NAM">
        		AND	C.USR_NAM LIKE '%'||#strHNDL_PEN_NAM#||'%'
        	</isNotEmpty>
        	<isEqual property="strRESULT_CD" compareValue="1">
        		AND	A.HNDL_DT IS NULL
        	</isEqual>
        	<isEqual property="strRESULT_CD" compareValue="2">
        		AND	A.HNDL_DT IS NOT NULL
        	</isEqual>
        </dynamic>
        <![CDATA[
        	ORDER BY TO_NUMBER(A.GDS_RQS_SNO) DESC )AA
        ]]>
	</select>
	
	
</sqlMap>