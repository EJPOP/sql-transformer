<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/gsu/011">

	<select id="CSPGSU011PMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	DECODE(A.PRPS_ACP_NO,NULL,'',A.PRPS_YE||'-'||A.PRPS_ACP_NO) AS PRPS_ACP_NO	/*접수번호*/
					,A.ACP_DT			/*접수일자*/
					,A.SMT_DT			/*제출일자*/
					,A.PRPS_TIT_NM		/*제안제목*/
					,F_USR_INFO(A.PRPS_PEN_CNB,'2')	AS PRPS_PEN_NAM/*제안자명*/
					,A.PRPS_PEN_CNB		/*제안자전산번호*/
					,(SELECT	CASE WHEN Z.SNO = 1 THEN '' 
						        WHEN Z.SNO = 2 THEN F_USR_INFO(Z.PRPS_PEN_CNB,'2') 
						        WHEN Z.SNO >= 3 THEN F_USR_INFO(Z.PRPS_PEN_CNB,'2')||' 외 '||(Z.SNO-2)||'명' 
						        ELSE '' END 
						FROM 	TBCSPGSU002L Z 
						WHERE 	B.PRPS_YE = Z.PRPS_YE
						AND 	B.PRPS_SLN = Z.PRPS_SLN 
						AND 	B.CNT = Z.SNO) AS JNT_PRPS_PEN_NAM	/*공동제안자*/
					,F_CODE_NM('1000075',A.PRPS_STA_CD) AS PRPS_STA_NM
					,A.PRPS_STA_CD		/*제안상태코드*/
					,A.CUR_SYE_TXT		/*현행제도내용*/
					,A.PRB_TXT			/*문제점내용*/
					,A.IMP_ATV_TXT		/*개선대안내용*/
					,A.IMP_EFCT_TXT		/*개선효과내용*/
					,A.PRPS_YE			/*제안연도*/
					,A.PRPS_SLN			/*제안연번*/
					,(SELECT 	Z.DOC_ID	
						FROM	TBCSPGSU004M Z
						WHERE	Z.PRPS_YE = A.PRPS_YE
						AND		Z.PRPS_SLN = A.PRPS_SLN
						AND		Z.PRPS_ATT_FL_DVSN_CD = '1') AS DOC_ID	/*첨부파일 문서*/
			FROM	TBCSPGSU001M A		/*도서자료기본*/
					, (	SELECT 	PRPS_YE, PRPS_SLN, COUNT(*) CNT 
						FROM 	TBCSPGSU002L A WHERE 1=1
					    AND 	A.PRPS_YE = #strPRPS_YE#
					    AND 	A.PRPS_SLN = #strPRPS_SLN#
					    GROUP BY PRPS_YE, PRPS_SLN) B
			WHERE	1=1
			AND		A.PRPS_YE = #strPRPS_YE#
			AND		A.PRPS_SLN = #strPRPS_SLN#
			AND	 	A.PRPS_YE = B.PRPS_YE
		    AND 	A.PRPS_SLN = B.PRPS_SLN
		]]>
	</select>
	
</sqlMap> 
