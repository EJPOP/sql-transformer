<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/aea/010">

	<select id="FAAAEA010EDptTpCd2Select" parameterClass="paramMap" resultClass="String">
        <![CDATA[       
               SELECT DPT_TP_CD_2
                 FROM TBDCMACM002M
                WHERE DPT_CD = #strDptCd#
		]]>
	</select>
	
	<select id="FAAAEA010EMenuHeadTitleSelect" parameterClass="paramMap" resultClass="resultMap">
              SELECT MAX(CASE WHEN CD = '1000' THEN CD            ELSE '' END) AS CD_1
                    ,MAX(CASE WHEN CD = '1000' THEN $strTxtColNm$ ELSE '' END) AS CD_NM_1
                    ,MAX(CASE WHEN CD = '2000' THEN CD            ELSE '' END) AS CD_2
                    ,MAX(CASE WHEN CD = '2000' THEN $strTxtColNm$ ELSE '' END) AS CD_NM_2
                    ,MAX(CASE WHEN CD = '3000' THEN CD            ELSE '' END) AS CD_3
                    ,MAX(CASE WHEN CD = '3000' THEN $strTxtColNm$ ELSE '' END) AS CD_NM_3
                    ,MAX(CASE WHEN CD = '9000' THEN CD            ELSE '' END) AS CD_9
                    ,MAX(CASE WHEN CD = '9000' THEN $strTxtColNm$ ELSE '' END) AS CD_NM_9
                FROM TBDCMACM013C
               WHERE CMM_CD_DVSN_CD = '1000864'
                 AND CD             IN ('1000','2000','3000','9000')
                 AND USE_YN         = 'Y'	
	</select>	
	
	<select id="FAAAEA010EMenuSelect" parameterClass="paramMap" resultClass="resultMap">
        WITH DATA 
          AS (
              SELECT ROW_NUMBER() OVER(PARTITION BY SUBSTR(CD,1,2) ORDER BY CD ASC) AS DVSN
                    ,SUBSTR(CD,1,1) AS CUT_CD 
                    ,CD             AS CD
                FROM TBDCMACM013C
               WHERE CMM_CD_DVSN_CD  = '1000864'
                 AND CD              NOT IN ('000000000','1000','2000','3000','9000')
                 AND USE_YN          = 'Y' 
             )
    
             SELECT CD_1                       
                   ,(SELECT $strTxtColNm$ FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_1)        AS CD_NM_1
                   ,(SELECT USR_DFN_TXT_2 FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_1)        AS LINK_1
                   ,(SELECT USR_DFN_TXT_3 FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_1)        AS LINK_REG_1
                   ,(SELECT COUNT(1)      
                       FROM TBFAAAEA045M A 
                      WHERE A.MTRL_DVSN_CD = CD_1   
                        AND A.DPT_CD       IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
					<isNotEmpty property="strDptCd2">
               		    AND A.DPT_CD       = #strDptCd2#
            		</isNotEmpty>                       
                     )                                                                                                 AS CD_CNT_1
                   
                   ,CD_2                       
                   ,(SELECT $strTxtColNm$ FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_2)        AS CD_NM_2
                   ,(SELECT USR_DFN_TXT_2 FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_2)        AS LINK_2
                   ,(SELECT USR_DFN_TXT_3 FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_2)        AS LINK_REG_2
                   ,(SELECT COUNT(1)      
                       FROM TBFAAAEA045M A 
                      WHERE A.MTRL_DVSN_CD = CD_2   
                        AND A.DPT_CD       IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
					<isNotEmpty property="strDptCd2">
               		    AND A.DPT_CD       = #strDptCd2#
            		</isNotEmpty>                       
                     )                                                                                                 AS CD_CNT_2
                   
                   ,CD_3                      
                   ,(SELECT $strTxtColNm$ FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_3)        AS CD_NM_3
                   ,(SELECT USR_DFN_TXT_2 FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_3)        AS LINK_3
                   ,(SELECT USR_DFN_TXT_3 FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_3)        AS LINK_REG_3
                   ,(SELECT COUNT(1)      
                       FROM TBFAAAEA045M A 
                      WHERE A.MTRL_DVSN_CD = CD_3   
                        AND A.DPT_CD       IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
					<isNotEmpty property="strDptCd2">
               		    AND A.DPT_CD       = #strDptCd2#
            		</isNotEmpty>                       
                     )                                                                                                 AS CD_CNT_3
                   
                   ,CD_9                      
                   ,(SELECT $strTxtColNm$ FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_9)        AS CD_NM_9
                   ,(SELECT USR_DFN_TXT_2 FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_9)        AS LINK_9
                   ,(SELECT USR_DFN_TXT_3 FROM TBDCMACM013C A WHERE CMM_CD_DVSN_CD = '1000864' AND A.CD = CD_9)        AS LINK_REG_9
                   ,(SELECT COUNT(1)      
                       FROM TBFAAAEA045M A 
                      WHERE A.MTRL_DVSN_CD = CD_9   
                        AND A.DPT_CD       IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
					<isNotEmpty property="strDptCd2">
               		    AND A.DPT_CD       = #strDptCd2#
            		</isNotEmpty>                       
                     )                                                                                                 AS CD_CNT_9
                   
               FROM DATA
               PIVOT 
                    (
                     MAX(CD) 
                     FOR CUT_CD IN (
                                        '1' AS CD_1
                                       ,'2' AS CD_2
                                       ,'3' AS CD_3
                                       ,'9' AS CD_9
                                   )
                    )
                    
           ORDER BY DVSN
	</select>	
	
	
	<select id="FAAAEA010EMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<include refid="include.pageSelct" />
		
            SELECT SRNO             
                  ,MTRL_DVSN_CD
                  ,F_CODE_NM('1000864',MTRL_DVSN_CD)  AS MTRL_DVSN_NM
                  ,DPT_CD                             AS DPT_CD
                  ,F_DPT_INFO(DPT_CD,'1')             AS DPT_NM
                  ,TIT_NM
                  ,DTL_TXT
                  ,DOC_ID
                  ,REGN_CNB
                  ,F_USR_INFO(REGN_CNB,'2')           AS REGN_NM   
                  ,TO_CHAR(FRT_REGI_DH, 'YYYY-MM-DD') AS FRT_REGI_DT   
              FROM TBFAAAEA045M
             WHERE MTRL_DVSN_CD = #strMtrlDvsnCd#
               AND DPT_CD       IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
               
			<isNotEmpty property="strDptCd2">
               AND DPT_CD      = #strDptCd2#
            </isNotEmpty> 
	           
			<isNotEmpty property="strTitNm">
			   AND TIT_NM LIKE '%'||#strTitNm#||'%'
			</isNotEmpty>
			
    	<include refid="include.pageOrder" />
	</select>		
	
				
	
	<select id="FAAAEA010E2001CntSelect" parameterClass="paramMap" resultClass="java.lang.Integer">
        <![CDATA[       
			SELECT COUNT(1) AS CNT 
			  FROM TBCSPFPL002M 
			 WHERE 1=1
			   AND CHR_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
		]]>
		<isNotEmpty property="strDptCd2">
               AND CHR_DPT_CD = #strDptCd2#
        </isNotEmpty> 		
	</select>	
	
	<select id="FAAAEA010E2001Select" parameterClass="paramMap" resultClass="resultMap">
		<include refid="include.pageSelct" />
		
        <![CDATA[       
			SELECT D2.QSTNAI_YR||'-'||D2.QSTNAI_NO||'-'||D2.DTIL_ANS_NO||'-'||D2.DTIL_DVSN_NO         AS TOTAL_ANS_NO			/*세부질의번호*/
			     , D2.QSTNAI_YR            AS QSTNAI_YR  	/*질의서년도*/
			     , D2.QSTNAI_NO            AS QSTNAI_NO  	/*질의서번호*/
			     , D2.DTIL_ANS_NO          AS DTIL_ANS_NO  	/*세부답변번호*/
			     , D2.DTIL_DVSN_NO         AS DTIL_DVSN_NO  /*세부구분번호*/
			     , D2.CHGR_NM              AS CHGR_NM  	    /*담당자명*/
			     , D2.CHGR_ID              AS CHGR_ID  	    /*담당자ID*/
			     , D2.CHR_DPT_CD           AS CHR_DPT_CD    /*담당부서코드*/
			     , D2.CHR_DPT_NM           AS CHR_DPT_NM    /*담당부서명*/
			     , D2.QUE_TXT              AS QUE_TXT		/*질의내용*/
			     , D2.SMT_DT               AS SMT_DT		/*제출일*/
				 , (SELECT Z1.NTAS_SMT_DDLN_DT FROM TBCSPFPL001M Z1 WHERE	Z1.QSTNAI_YR=D2.QSTNAI_YR and Z1.QSTNAI_NO=D2.QSTNAI_NO) AS NTAS_SMT_DDLN_DT         /*국회제출기한*/
			     , DECODE(D2.NTAS_RQ_MTRL_HNDL_STA_CD, '20', '30', D2.NTAS_RQ_MTRL_HNDL_STA_CD)                                      AS NTAS_RQ_MTRL_HNDL_STA_CD /*처리상태코드*/
			     , F_CODE_NM('1000374', DECODE(D2.NTAS_RQ_MTRL_HNDL_STA_CD, '20', '30', D2.NTAS_RQ_MTRL_HNDL_STA_CD))                AS NTAS_RQ_MTRL_HNDL_STA_NM /*처리상태명*/
			     , (SELECT Z1.CMTR_NM FROM TBCSPFPL001M Z1 WHERE	Z1.QSTNAI_YR=D2.QSTNAI_YR and Z1.QSTNAI_NO=D2.QSTNAI_NO)         AS CMTR_NM                  /*위원명*/
			     , (SELECT Z1.RQ_DT FROM TBCSPFPL001M Z1 WHERE	Z1.QSTNAI_YR=D2.QSTNAI_YR and Z1.QSTNAI_NO=D2.QSTNAI_NO)             AS RQ_DT                    /*요청일자*/
			     , (SELECT Z1.SMT_RQ_DT FROM TBCSPFPL001M Z1 WHERE	Z1.QSTNAI_YR=D2.QSTNAI_YR and Z1.QSTNAI_NO=D2.QSTNAI_NO)         AS SMT_RQ_DT                /*제출일자*/
   			     , (SELECT D7.DOC_ID AS DOC_ID FROM TBCSPFPL007M D7 WHERE D2.QSTNAI_YR=D7.QSTNAI_YR and D2.QSTNAI_NO=D7.QSTNAI_NO and D2.DTIL_ANS_NO=D7.DTIL_ANS_NO and D2.DTIL_DVSN_NO=D7.DTIL_DVSN_NO AND D7.NTAS_RQ_MTRL_DOC_KND_CD = 'B2') 
   			                                                                                                                         AS ETC_DOC_ID
			     , (SELECT D7.DOC_ID AS DOC_ID FROM TBCSPFPL007M D7 WHERE D2.QSTNAI_YR=D7.QSTNAI_YR and D2.QSTNAI_NO=D7.QSTNAI_NO and D2.DTIL_ANS_NO=D7.DTIL_ANS_NO and D2.DTIL_DVSN_NO=D7.DTIL_DVSN_NO AND D7.NTAS_RQ_MTRL_DOC_KND_CD = 'B1') 
			                                                                                                                         AS HWP_DOC_ID
			  FROM TBCSPFPL002M D2
			 WHERE 1=1
			   AND D2.CHR_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
		]]>
		
		<isNotEmpty property="strDptCd2">
               AND D2.CHR_DPT_CD = #strDptCd2#
        </isNotEmpty> 		
		
		<isNotEmpty property="strTxt">
			   AND D2.QUE_TXT LIKE '%'||#strTxt#||'%'
		</isNotEmpty>
		
		<include refid="include.pageOrder" />
	</select>				
</sqlMap> 
