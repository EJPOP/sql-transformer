<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/fpl/005">

	<!-- 질의서목록 조회 -->
	<select id="CSPFPL005WrtQueListSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
		 select d2.QSTNAI_YR||'-'||d2.QSTNAI_NO as QSTNAI_YRNO,
		        d2.QSTNAI_YR||'-'||d2.QSTNAI_NO||'-'||d2.DTIL_ANS_NO||'-'||d2.DTIL_DVSN_NO as DTIL_DVSN_NO,
		        d1.QSTNAI_TIT_NM as QSTNAI_TIT_NM,
		        d2.QUE_TXT     AS QUE_TXT,		/*질의내용*/
		        d1.CMTR_NM as CMTR_NM,
		        F_CODE_NM ('1000092',d1.CMT_CD)as CMT_CD,
		        d1.RQ_DT as RQ_DT,
  		        d1.SITT_NO as SITT_NO,
		        d1.NTAS_SMT_DDLN_DT as NTAS_SMT_DDLN_DT,
		        d1.RQR_NM as RQR_NM,
		        d1.SMT_RQ_DT as SMT_RQ_DT,
		        d2.CHR_DPT_NM as CHR_DPT_NM,
		        d2.CHGR_NM as CHGR_NM,
		        d2.SMT_DT as SMT_DT,
		        d2.HNDL_SITU_HIS as HNDL_SITU_HIS,
		        F_CODE_NM ('1000374',d2.NTAS_RQ_MTRL_HNDL_STA_CD) as NTAS_RQ_MTRL_HNDL_STA_CD
		   from tbcspfpl002m d2,tbcspfpl001m d1
		  where 1=1
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strYear">
				D2.QSTNAI_YR =
				#strYear#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnai">
				D2.QSTNAI_NO LIKE '%'||#strQstnai#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnaiTitleNm">
				D1.QSTNAI_TIT_NM LIKE '%'||#strQstnaiTitleNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtrNm">
				D1.CMTR_NM LIKE '%'||#strCmtrNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtFrom">
				D1.RQ_DT >=
				#strRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtTo">
				D1.RQ_DT &lt;=
				#strRqDtTo#
			</isNotEmpty>			
			<isNotEmpty prepend="AND" property="strSmtRqDtFrom">
				D1.SMT_RQ_DT >=
				#strSmtRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strSmtRqDtTo">
				D1.SMT_RQ_DT &lt;=
				#strSmtRqDtTo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtCd">
				d1.CMT_CD = #strCmtCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strNtasRqMtrlHndlStaCd">
				d2.NTAS_RQ_MTRL_HNDL_STA_CD =
				#strNtasRqMtrlHndlStaCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strDptNm">
				D2.CHR_DPT_NM = #strDptNm#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strChgrNm">
				D2.CHGR_NM = #strChgrNm#
			</isNotEmpty>							
		</dynamic>
		<![CDATA[       
		    AND D1.QSTNAI_YR = D2.QSTNAI_YR
		    AND D1.QSTNAI_NO = D2.QSTNAI_NO
		  ORDER BY D2.QSTNAI_YR, D2.QSTNAI_NO,D2.DTIL_ANS_NO, D2.DTIL_DVSN_NO ASC
		]]>
	</select>
	
	
	<select id="CSPFPL020selectReport" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT	A.QSTNAI_YR || '-' || A.QSTNAI_NO AS NO
					,B.QSTNAI_YR||'-'||B.QSTNAI_NO||'-'||B.DTIL_ANS_NO as DTIL_DVSN_NO
					,A.SITT_NO
					,F_CODE_NM('1000092', A.NTAS_RQ_MTRL_DVSN_CD) AS NTAS_RQ_MTRL_DVSN_CD
					,F_CODE_NM('1000091', A.CMT_CD) AS CMT_CD
					,A.CMTR_NM
					,A.RQR_NM
					,F_CODE_NM('1000093', A.RQ_SHP_CD) AS RQ_SHP_CD
					,TO_CHAR(TO_DATE(A.RQ_DT), 'YYYY-MM-DD') AS RQ_DT 		/* 요구일자 */
					,TO_CHAR(TO_DATE(A.NTAS_SMT_DDLN_DT), 'YYYY-MM-DD') AS NTAS_SMT_DDLN_DT		/* 제출기한 */
					,DECODE(NTAS_SMT_HNDL_STA_CD,'40',TO_CHAR(TO_DATE(B.NTAS_SMT_DT), 'YYYY-MM-DD'),F_CODE_NM ('1000661',B.NTAS_SMT_HNDL_STA_CD)) AS NTAS_SMT_DT 		/* 제출일자 */
					,B.QUE_TXT
					,(  SELECT  AGGR_CONCAT( S1.CHR_DPT_NM, ', ')
                        FROM    TBCSPFPL002M S1
                        WHERE   B.QSTNAI_YR = S1.QSTNAI_YR
                        AND     B.QSTNAI_NO = S1.QSTNAI_NO 
                        AND     B.DTIL_ANS_NO = S1.DTIL_ANS_NO
                     ) AS CHR_DPT_NM
					,(  SELECT  AGGR_CONCAT( S1.CHGR_NM, ', ')
                        FROM    TBCSPFPL002M S1
                        WHERE   B.QSTNAI_YR = S1.QSTNAI_YR
                        AND     B.QSTNAI_NO = S1.QSTNAI_NO 
                        AND     B.DTIL_ANS_NO = S1.DTIL_ANS_NO
                     ) AS CHGR_NM
					,TO_CHAR(TO_DATE(B.SMT_DT), 'YYYY-MM-DD') AS SMT_DT		/* 각국제출일자 */
					, F_CODE_NM ('1000661',B.NTAS_SMT_HNDL_STA_CD) AS NTAS_SMT_HNDL_STA_CD
			FROM	TBCSPFPL001M A
					,TBCSPFPL002M B
			WHERE	1=1
			AND		A.QSTNAI_YR = B.QSTNAI_YR
			AND		A.QSTNAI_NO = B.QSTNAI_NO
			AND		B.DTIL_DVSN_NO ='01'
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strYear">
				A.QSTNAI_YR = #strYear#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnai">
				A.QSTNAI_NO LIKE '%'||#strQstnai#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnaiTitleNm">
				A.QSTNAI_TIT_NM LIKE '%'||#strQstnaiTitleNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtrNm">
				A.CMTR_NM LIKE '%'||#strCmtrNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtFrom">
				A.RQ_DT >= #strRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtTo">
				A.RQ_DT &lt;= #strRqDtTo#
			</isNotEmpty>			
			<isNotEmpty prepend="AND" property="strSmtRqDtFrom">
				A.SMT_RQ_DT >= #strSmtRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strSmtRqDtTo">
				A.SMT_RQ_DT &lt;= #strSmtRqDtTo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtCd">
				A.CMT_CD = #strCmtCd# 
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strNtasRqMtrlHndlStaCd">
				B.NTAS_RQ_MTRL_HNDL_STA_CD = #strNtasRqMtrlHndlStaCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strDptNm">
				B.CHR_DPT_NM = #strDptNm#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strChgrNm">
				B.CHGR_NM = #strChgrNm#
			</isNotEmpty>							
		</dynamic>
		<![CDATA[
			ORDER BY NO ASC,DTIL_DVSN_NO ASC
		]]>
	</select>

	<!-- 질의서목록 조회 -->
	<select id="CSPFPL020WrtQueNewListSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
		 select d2.QSTNAI_YR||'-'||d2.QSTNAI_NO as QSTNAI_YRNO,
		        d2.QSTNAI_YR||'-'||d2.QSTNAI_NO||'-'||d2.DTIL_ANS_NO||'-'||d2.DTIL_DVSN_NO as DTIL_DVSN_NO,
		        d1.QSTNAI_TIT_NM as QSTNAI_TIT_NM,
		        d2.QUE_TXT     AS QUE_TXT,		/*질의내용*/
		        d1.CMTR_NM as CMTR_NM,
		        F_CODE_NM ('1000091',d1.CMT_CD)as CMT_CD,
		        d1.RQ_DT as RQ_DT,
		        d1.SMT_RQ_DT as SMT_RQ_DT,
		        d1.SITT_NO as SITT_NO,
		        d1.NTAS_SMT_DDLN_DT as NTAS_SMT_DDLN_DT,
		        d1.RQR_NM as RQR_NM,
		        d2.CHR_DPT_NM as CHR_DPT_NM,
		        d2.HNDL_SITU_HIS as HNDL_SITU_HIS,
		        d2.CHGR_NM as CHGR_NM,
		        d2.SMT_DT as SMT_DT,
		        d2.NTAS_SMT_HNDL_STA_CD as NTAS_SMT_HNDL_STA_CD,
		        d2.NTAS_SMT_DT as NTAS_SMT_DT,
		        decode(d2.NTAS_RQ_MTRL_HNDL_STA_CD, '10', '30', '20', '30', '40', '30', '80', '90',d2.NTAS_RQ_MTRL_HNDL_STA_CD) AS NTAS_RQ_MTRL_HNDL_STA_CD,
		        /*decode(d2.NTAS_RQ_MTRL_HNDL_STA_CD, '40', '30', d2.NTAS_RQ_MTRL_HNDL_STA_CD) AS NTAS_RQ_MTRL_HNDL_STA_CD,*/ /*답변자료처리상태코드*/
		        d1.NTAS_RQ_MTRL_HNDL_STA_CD AS NTAS_RQ_MTRL_HNDL_STA_CD_ORG /*질의서처리상태코드*/
		   from tbcspfpl002m d2,tbcspfpl001m d1
		  where 1=1
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strYear">
				D2.QSTNAI_YR =
				#strYear#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnai">
				D2.QSTNAI_NO LIKE '%'||#strQstnai#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnaiTitleNm">
				D1.QSTNAI_TIT_NM LIKE '%'||#strQstnaiTitleNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtrNm">
				D1.CMTR_NM LIKE '%'||#strCmtrNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtFrom">
				D1.RQ_DT >=
				#strRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtTo">
				D1.RQ_DT &lt;=
				#strRqDtTo#
			</isNotEmpty>			
			<isNotEmpty prepend="AND" property="strSmtRqDtFrom">
				D1.SMT_RQ_DT >=
				#strSmtRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strSmtRqDtTo">
				D1.SMT_RQ_DT &lt;=
				#strSmtRqDtTo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strNtasSmtRqDtFrom">
				D1.NTAS_SMT_DDLN_DT >=
				#strNtasSmtRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strNtasSmtRqDtTo">
				D1.NTAS_SMT_DDLN_DT &lt;=
				#strNtasSmtRqDtTo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtCd">
				d1.CMT_CD = #strCmtCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strNtasRqMtrlHndlStaCd">
				d2.NTAS_RQ_MTRL_HNDL_STA_CD =
				#strNtasRqMtrlHndlStaCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strNtasSmtHndlStaCd">
				d2.NTAS_SMT_HNDL_STA_CD =
				#strNtasSmtHndlStaCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strDptNm">
				D2.CHR_DPT_NM = #strDptNm#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strChgrNm">
				D2.CHGR_NM = #strChgrNm#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strSittNo">
				D1.SITT_NO = #strSittNo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqrNm">
				D1.RQR_NM = #strRqrNm#
			</isNotEmpty>
		</dynamic>
		<![CDATA[       
		    AND D1.QSTNAI_YR = D2.QSTNAI_YR
		    AND D1.QSTNAI_NO = D2.QSTNAI_NO
		  ORDER BY D2.QSTNAI_YR, D2.QSTNAI_NO,D2.DTIL_ANS_NO, D2.DTIL_DVSN_NO ASC
		]]>
	</select>
	
	<!-- 답변자료 처리상태 답변제출로 변경 -->
	<update id="CSPFPL020WrtQueNewListUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL002M
		SET FNL_MDF_DH = SYSDATE
			 ,HNDL_SITU_HIS = #HNDL_SITU_HIS#
			 ,NTAS_SMT_HNDL_STA_CD = #NTAS_SMT_HNDL_STA_CD#
			 ,NTAS_RQ_MTRL_HNDL_STA_CD = #NTAS_RQ_MTRL_HNDL_STA_CD#
			 ,NTAS_SMT_DT = #NTAS_SMT_DT#
			 ,SMT_DT = #SMT_DT#
 	 		, FNL_USR_ID = #FNL_USR_ID#
			, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			, FNL_MNU_ID = #FNL_MNU_ID#
		WHERE 1 = 1
		AND QSTNAI_YR||'-'||QSTNAI_NO||'-'||DTIL_ANS_NO||'-'||DTIL_DVSN_NO=#DTIL_DVSN_NO#

		]]>
	</update>	

	<!-- 답변자료 처리상태 답변제출로 변경 -->
	<update id="CSPFPL020WrtQueQstnaiUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL001M
		SET FNL_MDF_DH = SYSDATE
			 ,NTAS_RQ_MTRL_HNDL_STA_CD = #NTAS_RQ_MTRL_HNDL_STA_CD_ORG#
 	 		, FNL_USR_ID = #FNL_USR_ID#
			, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			, FNL_MNU_ID = #FNL_MNU_ID#
		WHERE 1 = 1
		AND QSTNAI_YR||'-'||QSTNAI_NO=#QSTNAI_YRNO#

		]]>
	</update>	
	
	<!-- 답변자료 처리상태 답변제출로 변경 -->
	<update id="CSPFPL020WrtWrtansUpdate" parameterClass="paramMap">
	<![CDATA[    
		UPDATE TBCSPFPL003M
		SET FNL_MDF_DH = SYSDATE
			 ,NTAS_RQ_MTRL_HNDL_STA_CD = #NTAS_RQ_MTRL_HNDL_STA_CD_ORG#
 	 		, FNL_USR_ID = #FNL_USR_ID#
			, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			, FNL_MNU_ID = #FNL_MNU_ID#
		WHERE 1 = 1
		AND QSTNAI_YR||'-'||QSTNAI_NO=#QSTNAI_YRNO#

		]]>
	</update>	
	
	<!-- 질의서목록 조회 -->
	<select id="CSPFPL005WrtQuePopListSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
		 SELECT D1.QSTNAI_YR AS QSTNAI_YR /*연도*/,
		        D1.QSTNAI_NO AS QSTNAI_NO /*질의서번호*/,
		        D1.QSTNAI_YR || '-' || D1.QSTNAI_NO AS QSTNAI_YR_NO /*질의서연번호*/,
		        D1.QSTNAI_TIT_NM AS QSTNAI_TIT_NM /*질의서제목*/,
		        D1.CMT_CD AS CMT_CD /*위원회명*/,
		        D1.RQ_DT AS RQ_DT /*요구일자*/,
		        D1.SMT_RQ_DT AS SMT_RQ_DT /*제출일자*/,
		        D1.CMTR_NM AS CMTR_NM /*위원명*/,
		        F_CODE_NM ('1000374',D1.NTAS_RQ_MTRL_HNDL_STA_CD) AS NTAS_RQ_MTRL_HNDL_STA_CD /*처리상태코드*/
		   FROM TBCSPFPL001M D1
		  where 1=1
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strYear">
				D1.QSTNAI_YR =
				#strYear#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnai">
				D1.QSTNAI_NO =
				#strQstnai#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnaiTitleNm">
				D1.QSTNAI_TIT_NM LIKE '%'||#strQstnaiTitleNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtrNm">
				D1.CMTR_NM =
				#strCmtrNm#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtFrom">
				D1.RQ_DT >=
				#strRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtTo">
				D1.RQ_DT &lt;=
				#strRqDtTo#
			</isNotEmpty>			
			<isNotEmpty prepend="AND" property="strSmtRqDtFrom">
				D1.SMT_RQ_DT >=
				#strSmtRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strSmtRqDtTo">
				D1.SMT_RQ_DT &lt;=
				#strSmtRqDtTo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtrNm">
				D1.CMTR_NM =
				#strCmtrNm#
			</isNotEmpty>
		</dynamic>
		<![CDATA[       
			 ORDER BY D1.QSTNAI_NO ASC
		]]>
	</select>	
</sqlMap> 