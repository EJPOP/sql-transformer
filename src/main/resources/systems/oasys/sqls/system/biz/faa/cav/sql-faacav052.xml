<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/cav/052"> 
	 
	<!--접수마스터 목록-->
	<select id="FAACAV052EMainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/052/FAACAV052EMainselect */ ]]>
		<include refid="include.pageSelct" />		
        <![CDATA[       
        	 select 
        	 ROWNUM AS KEY,  
        	 B.COPT_CD||'-'||B.ACNT_CD||'-'||B.BLL_CD||'-'||B.PROF_DRTR_SRNO||'-'|| B.DL_XPN_RCDB_PBSVT_SRNO  PROF_DRTR_SG,
             B.COPT_CD, B.ACNT_CD, B.BLL_CD, B.PROF_DRTR_SRNO, B.DL_XPN_RCDB_PBSVT_SRNO,C.ORG_NM,B.CRE_DT,B.ABLT_DT, 
        	 C.period,C.period_nm,C.ACP_DVSN_CD,C.ACNT_CD_NM, 
        	 C.M1 M1_STA_CD,C.M2 M2_STA_CD,C.M3 M3_STA_CD,C.M4 M4_STA_CD,C.M5 M5_STA_CD,C.M6 M6_STA_CD,C.M7 M7_STA_CD, 
        	 C.M8 M8_STA_CD,C.M9 M9_STA_CD,C.M10 M10_STA_CD,C.M11 M11_STA_CD,C.M12 M12_STA_CD,C.M13 M13_STA_CD  
        	
        	 from (SELECT	mn.COPT_CD, mn.ACNT_CD, mn.BLL_CD, mn.PROF_DRTR_SRNO, mn.DL_XPN_RCDB_PBSVT_SRNO,mn.CRE_DT,mn.ABLT_DT, 
              	 case when A.period='01' then 
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'01' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'01' 	
                        then 'O'  	else '*' 	end  else       		  
              	 case when A.period='03' 
                 then  case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'03' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'01' 
                       then 'O'  	else '*'  end else	
                       case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'12' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'01'	
                      then 'O' 		else '*' 	end end end  M1 , 
               	 case when A.period='01' then  
              			 case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'02' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'02' 
                         then 'O'    else '*' 	end else
                 case when A.period='03' then          			
             		     case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'06' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'04' 
                         then 'O'    else '*'  end end end  M2 , 
              	 case when A.period='01' then  
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'03' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'03'  
                        then 'O'    else '*'  end  else
              	 case when A.period='03' 
                      then  case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'09' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'07'  
                      then 'O'    else '*' 	end end end  M3 , 
              	 case when A.period='01' then 
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'04' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'04' 	
                        then 'O'    else '*'  end else
              	 case when A.period='03'	then  
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'12' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'10' 	then 'O'   	else '*'  end end end   M4 , 
              	 case when A.period='01'	then 
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'05' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'05' 	then 'O'  	else '*'	end  end   M5 , 
              	 case when A.period='01' then 
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'06' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'06' 	then 'O'   	else '*'  end  end M6 , 
             		case when A.period='01' then 
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'07' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'07'  then 'O'   	else '*'  end  end M7 , 
              	case when A.period='01' then 
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'08' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'08'  then 'O' 		else '*'  end  end M8 , 
             		case when A.period='01' then 
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'09' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'09'  then 'O'  	else '*'  end  end  M9 , 
             		case when A.period='01' then  
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'10' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'10'  then 'O'   else '*' 	end  end M10 , 
              	case when A.period='01' then 
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'11' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'11'  then 'O'   else '*' 	end  end M11 , 
             		case when A.period='01' then 
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'12' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'12'  then 'O'   else '*'   end  end M12 , 
             		case when A.period='01' then 
              			case when SUBSTR(mn.CRE_DT,1,6)<= #strYr# ||'12' and SUBSTR(mn.ABLT_DT,1,6)>= #strYr# ||'12'  then  case when mn.BLL_CD='19' then '*' else 'O' end else '*' end end M13 
              			FROM	TWFAACAV003M mn,
              
             (SELECT mn.COPT_CD, mn.ACNT_CD, mn.BLL_CD, mn.PROF_DRTR_SRNO, mn.DL_XPN_RCDB_PBSVT_SRNO, mn.CRE_DT, mn.ABLT_DT, 
          	 	mn.ACP_DVSN_CD,cd.ACNT_CD_NM,case when mn.BLL_CD in('22', '23', '24')  
          	 	and mn.DL_XPN_RCDB_PBSVT_SRNO <> '000' then '01' else SUBSTR(cd.RMK_2,1,2) end      as  period ,
          			case when mstr.MN_1_STA_CD not in ('*') then 'O' else mstr.MN_1_STA_CD end M1 
          		,case when mstr.MN_2_STA_CD not in('*') then 'O' else mstr.MN_2_STA_CD end M2 
          		,case when mstr.MN_3_STA_CD not in('*') then 'O' else mstr.MN_3_STA_CD end M3 
          		,case when mstr.MN_4_STA_CD not in('*') then 'O' else mstr.MN_4_STA_CD end M4 
          		,case when mstr.MN_5_STA_CD not in('*') then 'O' else mstr.MN_5_STA_CD end M5 
         			,case when mstr.MN_6_STA_CD not in('*') then 'O' else mstr.MN_6_STA_CD end M6  
          		,case when mstr.MN_7_STA_CD not in('*') then 'O' else mstr.MN_7_STA_CD end M7 
         			,case when mstr.MN_8_STA_CD not in('*') then 'O' else mstr.MN_8_STA_CD end M8 
         			,case when mstr.MN_9_STA_CD not in('*') then 'O' else mstr.MN_9_STA_CD end M9 
     				  ,case when mstr.MN_1_0_STA_CD not in('*') then 'O' else mstr.MN_1_0_STA_CD end M10 
     				  ,case when mstr.MN_1_1_STA_CD not in('*') then 'O' else mstr.MN_1_1_STA_CD end M11 
          		,case when mstr.MN_1_2_STA_CD not in('*') then 'O' else mstr.MN_1_2_STA_CD end M12 
          		,case when mstr.MN_1_3_STA_CD not in('*') then 'O' else mstr.MN_1_3_STA_CD end M13 
          		FROM	TWFAACAV003M mn,TWFAACAV007M mstr,TWFAACAV024C cd 
          		WHERE	SUBSTR(mn.ABLT_DT,1,4) >= #strYr#  
          			AND SUBSTR(mn.CRE_DT,1,4)<=#strYr#
          	    AND mn.COPT_CD = mstr.COPT_CD 
          	    AND mn.ACNT_CD = mstr.ACNT_CD 
          	   	AND mn.BLL_CD = mstr.BLL_CD 
          	  	AND mn.PROF_DRTR_SRNO = mstr.PROF_DRTR_SRNO 
          	 	  AND mn.DL_XPN_RCDB_PBSVT_SRNO = mstr.DL_XPN_RCDB_PBSVT_SRNO 
          	 		AND mstr.PROF_YR = #strYr#
          			AND cd.ACNT_DVSN_CD = '03' 
          			AND cd.ACNT_CD = mn.BLL_CD ) A
    			WHERE	SUBSTR(mn.ABLT_DT,1,4) >= #strYr# 
    	 		 AND SUBSTR(mn.CRE_DT,1,4)<=#strYr# 
    	 		 AND mn.COPT_CD = A.COPT_CD 
    	 		 AND mn.ACNT_CD = A.ACNT_CD 
    	 		 AND mn.BLL_CD = A.BLL_CD 
    	 		 AND mn.PROF_DRTR_SRNO = A.PROF_DRTR_SRNO 
    	     AND mn.DL_XPN_RCDB_PBSVT_SRNO =A.DL_XPN_RCDB_PBSVT_SRNO )B,
        	/* '*'가 아닌것은 무조건 '0'으로 표기 */
    	 (SELECT mn.COPT_CD, mn.ACNT_CD, mn.BLL_CD, mn.PROF_DRTR_SRNO, mn.DL_XPN_RCDB_PBSVT_SRNO,mn.ORG_NM, mn.CRE_DT, 
    		 mn.ABLT_DT, mn.ACP_DVSN_CD,cd.ACNT_CD_NM 
    	 	,case when mn.BLL_CD in('22', '23', '24')  and mn.DL_XPN_RCDB_PBSVT_SRNO <> '000' then '01' else SUBSTR 	(cd.RMK_2,1,2) end period 
    	 	,case when mn.BLL_CD in('22', '23', '24') and mn.DL_XPN_RCDB_PBSVT_SRNO <> '000' then'월' else SUBSTR(cd.RMK_2,3,4)  end period_nm 
    	    ,case when mstr.MN_1_STA_CD not in ('*') then 'O' else mstr.MN_1_STA_CD end M1 
    		,case when mstr.MN_2_STA_CD not in('*') then 'O' else mstr.MN_2_STA_CD end M2 
    		,case when mstr.MN_3_STA_CD not in('*') then 'O' else mstr.MN_3_STA_CD end M3 
    		,case when mstr.MN_4_STA_CD not in('*') then 'O' else mstr.MN_4_STA_CD end M4 
    		,case when mstr.MN_5_STA_CD not in('*') then 'O' else mstr.MN_5_STA_CD end M5 
    		,case when mstr.MN_6_STA_CD not in('*') then 'O' else mstr.MN_6_STA_CD end M6 
    		,case when mstr.MN_7_STA_CD not in('*') then 'O' else mstr.MN_7_STA_CD end M7 
    		,case when mstr.MN_8_STA_CD not in('*') then 'O' else mstr.MN_8_STA_CD end M8 
    		,case when mstr.MN_9_STA_CD not in('*') then 'O' else mstr.MN_9_STA_CD end M9 
    		,case when mstr.MN_1_0_STA_CD not in('*') then 'O' else mstr.MN_1_0_STA_CD end M10 
    		,case when mstr.MN_1_1_STA_CD not in('*') then 'O' else mstr.MN_1_1_STA_CD end M11 
    		,case when mstr.MN_1_2_STA_CD not in('*') then 'O' else mstr.MN_1_2_STA_CD end M12 
    		,case when mstr.MN_1_3_STA_CD not in('*') then 'O' else mstr.MN_1_3_STA_CD end M13 
    			FROM	TWFAACAV003M mn,TWFAACAV007M mstr,TWFAACAV024C cd 
    			WHERE	SUBSTR(mn.ABLT_DT,1,4) >= #strYr# 
    			AND SUBSTR(mn.CRE_DT,1,4)<=#strYr# 
    		  AND mn.COPT_CD = mstr.COPT_CD 
    		  AND mn.ACNT_CD = mstr.ACNT_CD 
    			AND mn.BLL_CD = mstr.BLL_CD 
    			AND mn.PROF_DRTR_SRNO = mstr.PROF_DRTR_SRNO 
    	    AND mn.DL_XPN_RCDB_PBSVT_SRNO = mstr.DL_XPN_RCDB_PBSVT_SRNO  
    			AND mstr.PROF_YR = #strYr# 
    			AND cd.ACNT_DVSN_CD = '03' 
    			AND cd.ACNT_CD = mn.BLL_CD)C          
    		WHERE B.COPT_CD = C.COPT_CD 
    		 AND B.ACNT_CD = C.ACNT_CD 
    		 AND B.BLL_CD = C.BLL_CD 
    	 	 AND B.PROF_DRTR_SRNO = C.PROF_DRTR_SRNO 
    	 	 AND B.DL_XPN_RCDB_PBSVT_SRNO = C.DL_XPN_RCDB_PBSVT_SRNO  
    	   AND(B.M1<> C.M1 
    	 	  or B.M1<> C.M1 
    	  	or B.M2<> C.M2 
    	  	or B.M3<> C.M3 
    	   	or B.M4<> C.M4 
    	   	or B.M5<> C.M5 
    	    or B.M6<> C.M6 
    	    or B.M7<> C.M7 
    	   	or B.M8<> C.M8 
    	  	or B.M9<> C.M9 
    	  	or B.M10<> C.M10 
    	  	or B.M11<> C.M11 
    	  	or B.M12<> C.M12 
    	]]>  	
		<isNotEmpty property="strFildSsecYn">	
			<isEqual property="strFildSsecYn" compareValue="Y"> 	   
			   or B.M13 &lt;&gt; C.M13)
			</isEqual>	
			<isEqual property="strFildSsecYn" compareValue="N"> 	   
			     )
			</isEqual>			   
		</isNotEmpty>	    	
    	  	         
        	 UNION 
		<![CDATA[         	
        	/* 증명자 부호는 없는데 마스터 테이블에는 값이 있는경우 처리 */
      	 select ROWNUM AS KEY, COPT_CD||'-'||ACNT_CD||'-'||BLL_CD||'-'||PROF_DRTR_SRNO||'-'|| DL_XPN_RCDB_PBSVT_SRNO  PROF_DRTR_SG,
                COPT_CD, ACNT_CD, BLL_CD, PROF_DRTR_SRNO, DL_XPN_RCDB_PBSVT_SRNO,ORG_NM,CRE_DT,ABLT_DT 
      	 	,period ,  period_nm,ACP_DVSN_CD,ACNT_CD_NM 
      	 ,MN_1_STA_CD AS M1_STA_CD,MN_2_STA_CD AS M2_STA_CD, MN_3_STA_CD AS M3_STA_CD, MN_4_STA_CD AS M4_STA_CD, MN_5_STA_CD AS M5_STA_CD, MN_2_STA_CD AS M6_STA_CD, MN_7_STA_CD AS M7_STA_CD 
      	 ,MN_8_STA_CD AS M8_STA_CD, MN_9_STA_CD AS M9_STA_CD, MN_1_0_STA_CD AS M10_STA_CD, MN_1_1_STA_CD AS M11_STA_CD,MN_1_2_STA_CD AS M12_STA_CD, MN_1_3_STA_CD AS M13_STA_CD 
      	 from (
      	 select B.COPT_CD, B.ACNT_CD, B.BLL_CD, B.PROF_DRTR_SRNO, B.DL_XPN_RCDB_PBSVT_SRNO,A.ORG_NM,A.CRE_DT,A.ABLT_DT 
      	 	,case when B.BLL_CD in('22', '23', '24')  and B.DL_XPN_RCDB_PBSVT_SRNO <> '000' then '01' else SUBSTR (C.RMK_2,1,2) end period  
      	 	,case when B.BLL_CD in('22', '23', '24') and B.DL_XPN_RCDB_PBSVT_SRNO <> '000' then '월' else SUBSTR(C.RMK_2,3,4)  end period_nm 
      	 ,A.ACP_DVSN_CD,C.ACNT_CD_NM 
      	 ,MN_1_STA_CD,MN_2_STA_CD, MN_3_STA_CD, MN_4_STA_CD, MN_5_STA_CD, MN_6_STA_CD, MN_7_STA_CD 
      	 ,MN_8_STA_CD, MN_9_STA_CD, MN_1_0_STA_CD, MN_1_1_STA_CD,MN_1_2_STA_CD, MN_1_3_STA_CD 
      	 from TWFAACAV003M A,TWFAACAV007M B, TWFAACAV024C C 
         WHERE A.COPT_CD(+) = B.COPT_CD
	            AND A.ACNT_CD(+) = B.ACNT_CD
	            AND A.BLL_CD(+) = B.BLL_CD
	            AND A.PROF_DRTR_SRNO(+) = B.PROF_DRTR_SRNO
	            AND A.DL_XPN_RCDB_PBSVT_SRNO(+) = B.DL_XPN_RCDB_PBSVT_SRNO
      			AND B.PROF_YR = #strYr# 
      			AND C.ACNT_DVSN_CD = '03' 
      			AND C.ACNT_CD = B.BLL_CD       
            ) A
         where A.CRE_DT is null   

		]]>
		<include refid="include.pageOrder" />
		ORDER BY KEY, PROF_DRTR_SG
	</select>

	
		    

	
</sqlMap> 
