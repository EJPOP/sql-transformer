<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/bii/999">

	<!-- 주민등록번호 밸리데이션 체크 -->
	<select id="CSPBI999QRrnValidation" parameterClass="paramMap" resultClass="integer">
		SELECT COUNT(*) AS RRN_CNT
		  FROM $TABLE_NAME$                   		   
		 WHERE EIN = #EIN#
	</select>
	
	<!-- 주민등록번호 밸리데이션 체크 (리스트형태로 반환)-->
	<select id="CSPBI999QRrnListValidation" parameterClass="paramMap" resultClass="resultMap">
		SELECT COUNT(*) AS RRN_CNT
		  FROM $TABLE_NAME$                   		   
		 WHERE EIN = #EIN#
	</select>
	
	<!-- 대인자료 목록 조회 -->
	<select id="CSPBII999PsnInfoSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[       
			SELECT A.NAM                                                                                                        /* 성명 */
			     , A.EIN                                                                                                        /* 암호화주민등록번호 */
			     , A.BLT_ORG_CD                                                                                                 /* 소속기관코드 */			     
			     , (SELECT B.ORG_NM
			          FROM TBDCMACM015M B
			         WHERE B.ORG_CD = A.BLT_ORG_CD)                                                              AS BLT_ORG_NM  /* 소속기관명 */
			     , A.PST_NM                                                                                                     /* 직위명 */
			     , F_CODE_NM('1000058', A.CRSP_OD_RANK_CD)
			    || CASE WHEN A.RANK_NM IS NOT NULL THEN ', ' || RANK_NM
			            ELSE ''
			       END
			    || CASE WHEN A.DTY_RK_CD IS NOT NULL THEN '(' || F_CODE_NM('1000174', A.DTY_RK_CD) || ')'
			            ELSE ''
			       END                                                                                           AS RANK_NM     /* 직급명 */
			     , A.PST_NM
			    || CASE WHEN A.CRSP_OD_RANK_CD IS NOT NULL THEN ' / ' || F_CODE_NM('1000058', A.CRSP_OD_RANK_CD)
			            ELSE ''
			       END
			    || CASE WHEN A.RANK_NM IS NOT NULL THEN ', ' || RANK_NM
			            ELSE ''
			       END
			    || CASE WHEN A.DTY_RK_CD IS NOT NULL THEN '(' || F_CODE_NM('1000174', A.DTY_RK_CD) || ')'
			            ELSE ''
			       END                                                                                           AS PST_RANK_NM /* 직위/직급명 */
			     , CASE WHEN RSG_YN <> 'Y' AND A.EPS_MNG_DVSN_CD = '1' THEN '중점'
			            ELSE ''
			       END                                                                                           AS DVSN_NM     /* 구분명 */
			     , A.DOC_ID                                                                                                     /* 사진문서ID */ 			     
			  FROM TBCSPBII300M A  /* 대인정보기본 */
			 WHERE 1 = 1
		]]>
		<isNotEmpty property="rrn">
			AND A.EIN = #rrn#
		</isNotEmpty>
		<!-- 대인감찰검색 팝업화면에서 입력한 값(성명, 주민등록번호)-->
		<isNotEmpty property="strNam">
			AND CASE WHEN A.EIN = #strEin#           THEN '1'
			         WHEN A.NAM LIKE #strNam# || '%' THEN '1'
			    END = '1'
		</isNotEmpty>
	</select>
</sqlMap> 
