<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/ear/004">
	
	<select id="CSPEAR005ECodeSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	CD, CD_NM, USR_DFN_TXT_1, USR_DFN_TXT_2, USR_DFN_TXT_3
			FROM	TBDCMACM013C A
			WHERE	A.CMM_CD_DVSN_CD = '1000379'
			AND		A.CMM_CD_DVSN_CD <> '000000000'
		]]>
	</select>
	
	
 	<select id="CSPEAR004EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<include refid = "include.pageSelct"/>
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||A.CVPT_ACP_NO AS ACP_NO
   					,A.CVPTR_NM
   					,A.TIT_NM
   					,A.ACP_DH
   					,B.REQR_DVSN_CD
   					,A.CVPT_HNDL_STA_CD
   					,F_USR_INFO_BY_ID(B.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
   					,F_DPT_INFO(B.HNDL_DPT_CD,'1') AS HNDL_DPT_NM
   					,B.HNDL_CHGR_ID
   					,B.HNDL_DPT_CD
   					,CASE
				         WHEN A.REQ_DVSN_CD IN ('2','3') AND EXAM_RPT_APV_DT IS NULL  THEN CASE WHEN A.REQ_DVSN_CD = '2' THEN TO_CHAR(A.ACP_DH+30+F_GET_DAY_CNT(A.REQ_DVSN_CD,A.ACP_YR,A.CVPT_ACP_NO),'YYYYMMDD')
                            ELSE TO_CHAR(ADD_MONTHS(A.ACP_DH ,1)+F_GET_DAY_CNT(A.REQ_DVSN_CD,A.ACP_YR,A.CVPT_ACP_NO),'YYYYMMDD') END
				         WHEN A.REQ_DVSN_CD = '2' THEN TO_CHAR(TO_DATE(EXAM_RPT_APV_DT)+60, 'YYYYMMDD')
				         ELSE TO_CHAR(ADD_MONTHS(TO_DATE(EXAM_RPT_APV_DT) , 6), 'YYYYMMDD') 
				       END AS HNDL_DDLN_DT
   					,CASE WHEN A.CVPT_HNDL_STA_CD = '170' THEN NULL 
                        WHEN SYSDATE - ADD_MONTHS(A.ACP_DH,3) > 0 THEN ROUND(SYSDATE - ADD_MONTHS(A.ACP_DH,3)) 
                        ELSE NULL END AS DLAY_CNT
   			FROM	TBCSPDCP101M A
   					,TBCSPEAR001M B
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = B.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)
   			AND		A.CVPT_HNDL_STA_CD NOT IN ('10','20','21')
   			AND		(#strAuth# = 'ALL' OR B.HNDL_DPT_CD = #strDPT_CD#)
		]]>
		<dynamic>
			
			<isNotEmpty property="strREQ_DVSN_CD">
				AND	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
			</isNotEmpty>
			<isEmpty property="strREQ_DVSN_CD">
				AND	A.REQ_DVSN_CD IN ('2','3')
			</isEmpty>
			<isNotEmpty property="strACP_DHS">
				AND	TO_CHAR(A.ACP_DH,'YYYYMMDD') &gt;= #strACP_DHS#
			</isNotEmpty>
			<isNotEmpty property="strACP_DHE">
				AND	TO_CHAR(A.ACP_DH,'YYYYMMDD') &lt;= #strACP_DHE#
			</isNotEmpty>
			<isNotEmpty property="strTIT_NM">
				AND	A.TIT_NM LIKE '%'||#strTIT_NM#||'%'
			</isNotEmpty>
			<isNotEmpty property="strACP_YR">
				AND	A.ACP_YR = #strACP_YR#
			</isNotEmpty>
			<isNotEmpty property="strCVPT_ACP_NO">
				AND	A.CVPT_ACP_NO = #strCVPT_ACP_NO#
			</isNotEmpty>
			<isNotEmpty property="strCVPT_HNDL_STA_CD">
				AND	A.CVPT_HNDL_STA_CD = #strCVPT_HNDL_STA_CD#
			</isNotEmpty>
			<isNotEmpty property="strCVPTR_NM">
				AND	(A.CVPTR_NM LIKE '%'||#strCVPTR_NM#||'%' OR A.RPST_PEN_NM LIKE '%'||#strCVPTR_NM#||'%')
			</isNotEmpty>
		</dynamic>
		<![CDATA[
			ORDER BY A.ACP_YR DESC, A.CVPT_ACP_NO DESC
		]]>
		<include refid = "include.pageOrder"/> 
	</select>
	
	<resultMap class="java.util.HashMap" id="CSPEAR005">
 		<result property="REQ_DVSN_CD" column="REQ_DVSN_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ACP_YR" column="ACP_YR"                             jdbcType="VARCHAR2"  javaType="java.lang.String" /> 
		<result property="CVPT_ACP_NO" column="CVPT_ACP_NO"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_NO" column="ACP_NO"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="REQR_KND_CD" column="REQR_KND_CD"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CVPTR_NM" column="CVPTR_NM"                         jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="BTDT" column="BTDT"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="JB_NM" column="JB_NM"                               jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RPST_PEN_NM" column="RPST_PEN_NM"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="BZN" column="BZN"                                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CPNM_NM" column="CPNM_NM"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ZCD" column="ZCD"                                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AD" column="AD"                                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="DTL_AD" column="DTL_AD"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TNB1" column="TNB1"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TNB2" column="TNB2"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TNB3" column="TNB3"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HPN1" column="HPN1"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HPN2" column="HPN2"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HPN3" column="HPN3"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="EML_ID" column="EML_ID"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="EML_DMI_NM" column="EML_DMI_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TIT_NM" column="TIT_NM"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_DPT_CD" column="ACP_DPT_CD"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_DPT_NM" column="ACP_DPT_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RCEP_ID" column="RCEP_ID"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RCEP_NM" column="RCEP_NM"                           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_DH" column="ACP_DH"                             jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="CVPT_HNDL_STA_CD" column="CVPT_HNDL_STA_CD"         jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CVPT_TXT" column="CVPT_TXT"                         jdbcType="CLOB"      javaType="java.lang.String" />
		<result property="CVPT_SBT" column="CVPT_SBT"                         jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="DOC_ID" column="DOC_ID"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="REQR_CNT" column="REQR_CNT"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="REQR_DVSN_CD" column="REQR_DVSN_CD"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="OGNZ_PSO_CNT" column="OGNZ_PSO_CNT"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_DT" column="ACP_DT"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		
		<result property="AUD_EXEC_DCS_DPT_NM" column="AUD_EXEC_DCS_DPT_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AUD_EXEC_DCS_DPT_CD" column="AUD_EXEC_DCS_DPT_CD"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AUD_EXEC_DCS_CHGR_NM" column="AUD_EXEC_DCS_CHGR_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AUD_EXEC_DCS_CHGR_ID" column="AUD_EXEC_DCS_CHGR_ID"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AUD_DPT_CD" column="AUD_DPT_CD"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AUD_DPT_NM" column="AUD_DPT_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AUD_CHGR_NM" column="AUD_CHGR_NM"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AUD_CHGR_ID" column="AUD_CHGR_ID"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AUD_EXEC_DCS_DDLN" column="AUD_EXEC_DCS_DDLN"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AUD_RSLT_HNDL_DDLN" column="AUD_RSLT_HNDL_DDLN"                     jdbcType="VARCHAR2"  javaType="java.lang.String" />
		
 	</resultMap>
	<select id="CSPEAR005EDtlSelect" parameterClass="paramMap"
		resultMap="CSPEAR005">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||A.CVPT_ACP_NO AS ACP_NO
   					,A.REQR_KND_CD
   					,A.CVPTR_NM
   					,A.BTDT
   					,A.JB_NM
   					,A.RPST_PEN_NM
   					,A.BZN
   					,A.CPNM_NM
   					,A.ZCD
   					,A.AD
   					,A.DTL_AD
   					,DECODE(A.TNB,NULL,'',SUBSTR(A.TNB,1,INSTR(A.TNB,'-',1,1)-1)) TNB1
   					,DECODE(A.TNB,NULL,'',SUBSTR(A.TNB,INSTR(A.TNB,'-',1,1)+1,INSTR(A.TNB,'-',1,2)-INSTR(A.TNB,'-',1,1)-1)) AS TNB2
   					,DECODE(A.TNB,NULL,'',SUBSTR(A.TNB,INSTR(A.TNB,'-',1,2)+1)) TNB3
   					,DECODE(A.HPN,NULL,'',SUBSTR(HPN,1,INSTR(HPN,'-',1,1)-1)) HPN1
   					,DECODE(A.HPN,NULL,'',SUBSTR(A.HPN,INSTR(A.HPN,'-',1,1)+1,INSTR(A.HPN,'-',1,2)-INSTR(A.HPN,'-',1,1)-1)) AS HPN2
   					,DECODE(A.HPN,NULL,'',SUBSTR(A.HPN,INSTR(A.HPN,'-',1,2)+1)) HPN3
   					,A.EML_ID
   					,A.EML_DMI_NM
   					,A.TIT_NM
   					,A.ACP_DPT_CD
   					,F_DPT_INFO(A.ACP_DPT_CD,'1') AS ACP_DPT_NM
   					,A.RCEP_ID
   					,F_USR_INFO_BY_ID(A.RCEP_ID,'2') AS RCEP_NM
   					,A.ACP_DH
   					,A.CVPT_HNDL_STA_CD
   					,B.CVPT_TXT
   					,B.CVPT_SBT
   					,A.DOC_ID
   					,C.REQR_CNT
   					,C.REQR_DVSN_CD
   					,C.OGNZ_PSO_CNT
   					,TO_CHAR(A.ACP_DH,'YYYYMMDD') AS ACP_DT 
   					,DECODE(C.AUD_EXEC_DCS_DPT_CD,NULL,F_DPT_INFO(C.HNDL_DPT_CD,'1'),F_DPT_INFO(C.AUD_EXEC_DCS_DPT_CD,'1')) AS AUD_EXEC_DCS_DPT_NM
   					,NVL(C.AUD_EXEC_DCS_DPT_CD,C.HNDL_DPT_CD) AS AUD_EXEC_DCS_DPT_CD
   					,DECODE(C.AUD_EXEC_DCS_CHGR_ID,NULL,F_USR_INFO_BY_ID(C.HNDL_CHGR_ID,'2'),F_USR_INFO_BY_ID(C.AUD_EXEC_DCS_CHGR_ID,'2')) AS AUD_EXEC_DCS_CHGR_NM
   					,NVL(C.AUD_EXEC_DCS_CHGR_ID,C.HNDL_CHGR_ID) AS AUD_EXEC_DCS_CHGR_ID
   					,C.AUD_DPT_CD
   					,F_DPT_INFO(C.AUD_DPT_CD,'1') AS AUD_DPT_NM
   					,F_USR_INFO_BY_ID(C.AUD_CHGR_ID,'2') AS AUD_CHGR_NM
   					,C.AUD_CHGR_ID
   					,CASE WHEN C.REQ_DVSN_CD = '2' THEN TO_CHAR(A.ACP_DH+30+F_GET_DAY_CNT(C.REQ_DVSN_CD,C.ACP_YR,C.CVPT_ACP_NO),'YYYY-MM-DD')
   						ELSE TO_CHAR(ADD_MONTHS(A.ACP_DH ,1)+F_GET_DAY_CNT(C.REQ_DVSN_CD,C.ACP_YR,C.CVPT_ACP_NO),'YYYY-MM-DD') END AUD_EXEC_DCS_DDLN
   					,CASE
				         WHEN C.REQ_DVSN_CD IN ('2','3') AND EXAM_RPT_APV_DT IS NULL  THEN '해당사항 없음'
				         WHEN C.REQ_DVSN_CD = '2' THEN TO_CHAR(TO_DATE(EXAM_RPT_APV_DT)+60, 'YYYY-MM-DD')
				         ELSE TO_CHAR(ADD_MONTHS(TO_DATE(EXAM_RPT_APV_DT) , 6), 'YYYY-MM-DD') 
				       END AS AUD_RSLT_HNDL_DDLN
   			FROM	TBCSPDCP101M A
   					,TBCSPDCP102M B
   					,TBCSPEAR001M C
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
		]]>
			
	</select>
	
	<select id="CSPEAR005EPreiSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	NVL(A.PREI_DMS_YN,'N') AS PREI_DMS_YN
					,A.PREI_APV_DT
					,A.PREI_DMS_RSN_CD
					,NVL(A.TRNF_YN,'N') AS TRNF_YN
					,A.TRNF_DPT_CD
					,F_DPT_INFO(A.TRNF_DPT_CD,'1') AS TRNF_DPT_NM
					,A.TRNF_DT
					,TO_CHAR(B.CVPT_WDW_DH,'YYYYMMDD') AS CVPT_WDW_DH
					,DECODE(B.CVPT_WDW_DH,NULL,'','취하') AS CVPT_WDW_NM
					,A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.CVPT_HNDL_STA_CD 
   					,A.PREI_RPL_DT
   					,(	SELECT 	DOC_ID 
   						FROM	TBCSPEAR004M Z
   						WHERE	A.REQ_DVSN_CD = Z.REQ_DVSN_CD
			   			AND		A.ACP_YR = Z.ACP_YR
			   			AND		A.CVPT_ACP_NO = Z.CVPT_ACP_NO 
			   			AND		Z.REQ_DOC_KND_CD = '1') AS PREI_DOC_ID
			   		,C.ONR_DOC_MNG_CRD_ID
			   		,NVL(C.REQ_DOC_KND_CD,'1') AS REQ_DOC_KND_CD
			   		,C.CVPT_OPM_APV_HNDL_STA_CD
			   		,B.TIT_NM
			FROM	TBCSPEAR001M A 
					,TBCSPDCP101M B
					,TBCSPEAR002M C  
			WHERE	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		C.REQ_DOC_KND_CD(+) = '1'
		]]>
	</select>
	
	<select id="CSPEAR005ESpmtSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	B.SPMT_RQ_SLN
					,B.SPMT_RQ_DT
					,B.SPMT_RQ_TXT
					,B.SPMT_CMPT_DT
					,A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.SPMT_DVSN_CD
   					,B.TG_ORG_NM
   					,B.SPMT_RQ_STA_CD
			FROM	TBCSPEAR001M A 
					,TBCSPEAR003L B
			WHERE	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			ORDER BY B.SPMT_RQ_SLN DESC
		]]>
	</select>
	
	<select id="CSPEAR005EPreiApvSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	D1.REQ_DVSN_CD
					,D1.ACP_YR
					,D1.CVPT_ACP_NO
					,NVL(D2.APV_DOC_DVSN_CD,'1') AS APV_DOC_DVSN_CD
					,D2.APV_VLE_PEN_DVSN_CD
					,D2.DVCHF_APV_DT
					,D2.LDR_APV_DT
					,D2.HQ_CHIF_APV_DT
					,D2.OW_PSD_APV_DT
					,D2.LEDG_APV_DT
			FROM	TBCSPEAR001M D1
					,TBCSPEAR009M D2
			WHERE	D1.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		D1.ACP_YR = #strACP_YR#
   			AND		D1.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
			AND		D1.ACP_YR = D2.ACP_YR(+)
			AND		D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
			AND		D2.APV_DOC_DVSN_CD(+) = '1'
		]]>
	</select>
	
	
	<update id="CSPEAR005EEAR001PreiUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		PREI_APV_DT = #PREI_APV_DT#
					,PREI_DMS_YN = #PREI_DMS_YN#
					,PREI_DMS_RSN_CD = #PREI_DMS_RSN_CD#
					,PREI_RPL_DT = #PREI_RPL_DT#
					,TRNF_YN = #TRNF_YN#
					,TRNF_DT = #TRNF_DT#
					,TRNF_DPT_CD = #TRNF_DPT_CD#
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	<insert id="CSPEAR005EEAR006PreiInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPEAR006H
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, SRNO
        					, DTB_DPT_CD
        					, DTB_PEN_ID
        					, CVPT_HNDL_STA_CD
        					, HNDL_DPT_CD
        					, HNDL_CHGR_ID
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
        					, #ACP_YR#
        					, #CVPT_ACP_NO#
        					, (	SELECT 	NVL(MAX(SRNO),0)+1
        						FROM	TBCSPEAR006H
        						WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
					   			AND		ACP_YR = #ACP_YR#
					   			AND		CVPT_ACP_NO = #CVPT_ACP_NO# )
					   		, F_USR_INFO(#S_CNB#, '5')
					   		, F_USR_INFO(#S_CNB#, '1')
        					, DECODE(#PREI_DMS_YN#,'Y','170','120')
        					, #HNDL_DPT_CD#
        					, #HNDL_CHGR_ID#
        					, F_USR_INFO(#S_CNB#, '1')
        					, #FNL_USR_ID#
        					, #FNL_DEAL_DPT_CD#
        					, #FNL_MNU_ID#
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>
	
	<insert id="CSPEAR005EEAR004PreiFileInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPEAR004M
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, REQ_DOC_KND_CD
        					, DOC_ID
        					, DOC_TYP_CD
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
        					, #ACP_YR#
        					, #CVPT_ACP_NO#
        					, '1'
					   		, #PREI_DOC_ID#
					   		, #DOC_TYP_CD#
        					, F_USR_INFO(#S_CNB#, '1')
        					, #FNL_USR_ID#
        					, #FNL_DEAL_DPT_CD#
        					, #FNL_MNU_ID#
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>
	
	<insert id="CSPEAR005EDCP101PreiUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPDCP101M
			SET		CVPT_HNDL_STA_CD = DECODE(#PREI_DMS_YN#,'Y','170',DECODE(#CVPT_HNDL_STA_CD#,'110','120',#CVPT_HNDL_STA_CD#))
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</insert>
	
	<insert id="CSPEAR005EEAR003PreiInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPEAR003L
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, SPMT_RQ_SLN
        					, SPMT_RQ_DT
        					, SPMT_RQ_TXT
        					, SPMT_CMPT_DT
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        					, SPMT_DVSN_CD
        					, TG_ORG_NM
        					, SPMT_RQ_STA_CD
        				)
        		VALUES	(	#REQ_DVSN_CD#
        					, #ACP_YR#
        					, #CVPT_ACP_NO#
        					, (	SELECT 	NVL(MAX(TO_NUMBER(SPMT_RQ_SLN)),0)+1
        						FROM	TBCSPEAR003L
        						WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
					   			AND		ACP_YR = #ACP_YR#
					   			AND		CVPT_ACP_NO = #CVPT_ACP_NO# )
					   		, #SPMT_RQ_DT#
					   		, #SPMT_RQ_TXT#
        					, #SPMT_CMPT_DT#
        					, F_USR_INFO(#S_CNB#, '1')
        					, #FNL_USR_ID#
        					, #FNL_DEAL_DPT_CD#
        					, #FNL_MNU_ID#
        					, SYSDATE
        					, SYSDATE
        					, #SPMT_DVSN_CD#
        					, #TG_ORG_NM#
        					, #SPMT_RQ_STA_CD#
        				)
       	]]>
	</insert>
	
	<update id="CSPEAR005EEAR003PreiUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR003L
			SET		SPMT_RQ_DT = #SPMT_RQ_DT#
					,SPMT_RQ_TXT = #SPMT_RQ_TXT#
					,SPMT_CMPT_DT = #SPMT_CMPT_DT#
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
   					,SPMT_DVSN_CD = #SPMT_DVSN_CD#
   					,TG_ORG_NM = #TG_ORG_NM#
   					,SPMT_RQ_STA_CD = #SPMT_RQ_STA_CD#
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
			AND		SPMT_RQ_SLN = #SPMT_RQ_SLN#
		]]>
	</update>
	
	<delete id="CSPEAR005EEAR003PreiDelete" parameterClass = "paramMap">
		<![CDATA[
			DELETE	
			FROM	TBCSPEAR003L
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
			AND		SPMT_RQ_SLN = #SPMT_RQ_SLN#
		]]>
	</delete>
	
	
	<update id="CSPEAR005EPreiApvMerge" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO	TBCSPEAR009M D1
			USING	(	SELECT	#REQ_DVSN_CD# AS REQ_DVSN_CD
								,#ACP_YR# AS ACP_YR
								,#CVPT_ACP_NO# AS CVPT_ACP_NO
								,#APV_DOC_DVSN_CD# AS APV_DOC_DVSN_CD
						FROM	DUAL
					) D2
			ON		(		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
						AND	D1.ACP_YR = D2.ACP_YR
						AND	D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
						AND	D1.APV_DOC_DVSN_CD = D2.APV_DOC_DVSN_CD
					)
			WHEN MATCHED THEN
				UPDATE
				SET		APV_VLE_PEN_DVSN_CD = #APV_VLE_PEN_DVSN_CD#
						,DVCHF_APV_DT = #DVCHF_APV_DT#
						,LDR_APV_DT = #LDR_APV_DT#
						,HQ_CHIF_APV_DT = #HQ_CHIF_APV_DT#
						,OW_PSD_APV_DT = #OW_PSD_APV_DT#
						,LEDG_APV_DT = #LEDG_APV_DT#
						,FNL_USR_ID = #FNL_USR_ID#
	  					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
	  					,FNL_MNU_ID = #FNL_MNU_ID#
	  					,FNL_MDF_DH = SYSDATE
	  		WHEN NOT MATCHED THEN
	  			INSERT	(	REQ_DVSN_CD
	  					,	ACP_YR
	  					,	CVPT_ACP_NO
	  					,	APV_DOC_DVSN_CD
	  					,	APV_VLE_PEN_DVSN_CD
	  					,	DVCHF_APV_DT
	  					,	LDR_APV_DT
	  					,	HQ_CHIF_APV_DT
	  					,	OW_PSD_APV_DT
	  					,	LEDG_APV_DT
	  					,	FRT_USR_ID
	  					,	FNL_USR_ID
	  					,	FNL_DEAL_DPT_CD
	  					,	FNL_MNU_ID
	  					,	FRT_REGI_DH
	  					,	FNL_MDF_DH
	  					)
	  			VALUES	(	#REQ_DVSN_CD#
	  					,	#ACP_YR#
	  					,	#CVPT_ACP_NO#
	  					,	#APV_DOC_DVSN_CD#
	  					,	#APV_VLE_PEN_DVSN_CD#
	  					,	#DVCHF_APV_DT#
	  					,	#LDR_APV_DT#
	  					,	#HQ_CHIF_APV_DT#
	  					,	#OW_PSD_APV_DT#
	  					,	#LEDG_APV_DT#
	  					,	#FNL_USR_ID#
	  					,	#FNL_USR_ID#
	  					,	#FNL_DEAL_DPT_CD#
	  					,	#FNL_MNU_ID#
	  					,	SYSDATE
	  					,	SYSDATE
	  					)
	  	]]>
	</update>	
	
	
	<select id="CSPEAR005EMtrlSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	A.MTRL_CLC_BZT_DVSN_CD
					,A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.AUD_YR
   					,B.AUD_NO
   					,DECODE(B.AUD_YR,NULL,'',B.AUD_YR||'-'||B.AUD_NO) AS AUD_YR_NO
   					,C.CVPT_HNDL_STA_CD
   					,A.PREI_DMS_YN
   					,TO_CHAR(C.CVPT_WDW_DH,'YYYYMMDD') AS CVPT_WDW_DH
					,DECODE(C.CVPT_WDW_DH,NULL,'','취하') AS CVPT_WDW_NM
			FROM	TBCSPEAR001M A, TBBADDED001M B, TBCSPDCP101M C
			WHERE	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = B.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
		]]>
	</select>
	
	<!-- <select id="CSPEAR005EBztSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			select  D3.AUD_YR
			        ,D3.AUD_NO
			        , F_MNG_KND_AUDYRNO(D3.AUD_YR, D3.AUD_NO, D3.AUD_KND_CD, '-') AS AUD_YR_N0 
			        ,D3.AUD_SBJ_NM
			        , F_CODE_NM_YEAR('1000007', D3.AUD_KND_CD, D3.AUD_YR) AS AUD_KND_NM 
			        , F_DPT_INFO(D3.SPV_BRDV_CD,'1')	AS SPV_BRDV_NM  /*주관국과명*/
			from    TBCSPEAR001M D1
			        ,TBBADDED030L D2
			        ,TBBADDED001M D3
			WHERE   D1.ACP_YR = D2.TSK_KEY1
			AND     D1.REQ_DVSN_CD = D2.TSK_KEY2
			AND     D1.CVPT_ACP_NO = D2.TSK_KEY3
			AND     D2.AUD_YR = D3.AUD_YR 
			AND     D2.AUD_NO = D3.AUD_NO
			AND		D1.ACP_YR = #strACP_YR#
			AND		D1.REQ_DVSN_CD = #strREQ_DVSN_CD#
			AND		D1.CVPT_ACP_NO = #strCVPT_ACP_NO#
		]]>
	</select> -->
	<select id="CSPEAR005EBztSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.AUD_YR
   					,B.AUD_NO
   					,DECODE(B.AUD_YR,NULL,'',B.AUD_YR||'-'||B.AUD_NO) AS AUD_YR_NO
   					,C.BZT_YR
   					,C.BZT_SNO
   					,C.BZT_DVSN_CD
   					,TO_CHAR(TO_DATE(C.AUD_STR_DT),'YYYY-MM-DD')||'~'|| TO_CHAR(TO_DATE(C.AUD_END_DT),'YYYY-MM-DD')    AS AUD_STR_END_DT        /*실시기간*/
   					,C.AUD_BZT_KND_CD
   					,C.AUD_DCN
   					,F_ORG_CNT_NM(C.BZT_YR,C.BZT_SNO) AS ORG_CNT_NM 
			FROM	TBCSPEAR001M A, TBBADDED001M B, TBBADDED002M C
			WHERE	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND 	B.AUD_YR = C.REL_AUD_YR
   			AND		B.AUD_NO = C.REL_AUD_NO
   			AND		C.AUD_BZT_KND_CD = '00'
		]]>
	</select>
	<update id="CSPEAR005EEAR001MtrlUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		MTRL_CLC_BZT_DVSN_CD = #MTRL_CLC_BZT_DVSN_CD#
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	<insert id="CSPEAR005EEAR006MtrlInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPEAR006H
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, SRNO
        					, DTB_DPT_CD
        					, DTB_PEN_ID
        					, CVPT_HNDL_STA_CD
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
        					, #ACP_YR#
        					, #CVPT_ACP_NO#
        					, (	SELECT 	NVL(MAX(SRNO),0)+1
        						FROM	TBCSPEAR006H
        						WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
					   			AND		ACP_YR = #ACP_YR#
					   			AND		CVPT_ACP_NO = #CVPT_ACP_NO# )
					   		, F_USR_INFO(#S_CNB#, '5')
					   		, F_USR_INFO(#S_CNB#, '1')
        					, '130'
        					, F_USR_INFO(#S_CNB#, '1')
        					, #FNL_USR_ID#
        					, #FNL_DEAL_DPT_CD#
        					, #FNL_MNU_ID#
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>
	
	<insert id="CSPEAR005EDCP101MtrlUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPDCP101M
			SET		CVPT_HNDL_STA_CD = '130'
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</insert>
	
	<select id="CSPEAR005EExamSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	NVL(A.CMT_OEN_YN,'N') AS CMT_OEN_YN
					,DECODE(A.CMT_OEN_YN,'Y', A.REQ_DVSN_CD) AS CMT_CD
					,A.CMT_OEN_YE
					,A.CMT_DGE
					,A.CMT_OEN_DT
					,A.REQ_EXAM_RSLT_CD
					,A.CMT_PRVS_CD
					,A.OGN_TYP_CD
					,A.EXAM_RPT_APV_DT /*결정일자*/
					,A.EXAM_RSLT_RPL_DT
					,A.TON_DT
					,A.TON_ORG_CD
					,(	SELECT	Z.USR_DFN_TXT_1
   						FROM	TBDCMACM013C Z
   						WHERE	Z.CMM_CD_DVSN_CD ='1000128'
   						AND		Z.CD = D.PUB_DVSN_CD) AS TON_DVSN_CD
   					,F_ORG_HRK_NM(D.COPT_SG_CD) AS COPT_SG_NM
   					,D.ORG_NM AS TON_ORG_NM
   					,A.KYWD_NM_1
   					,A.KYWD_NM_2
   					,A.KYWD_NM_3
					,TO_CHAR(B.CVPT_WDW_DH,'YYYYMMDD') AS CVPT_WDW_DH
					,DECODE(B.CVPT_WDW_DH,NULL,'','취하') AS CVPT_WDW_NM
					,A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.CVPT_HNDL_STA_CD
   					,(	SELECT 	DOC_ID 
   						FROM	TBCSPEAR004M Z
   						WHERE	A.REQ_DVSN_CD = Z.REQ_DVSN_CD
			   			AND		A.ACP_YR = Z.ACP_YR
			   			AND		A.CVPT_ACP_NO = Z.CVPT_ACP_NO 
			   			AND		Z.REQ_DOC_KND_CD = '2') AS EXAM_DOC_ID
			   		,C.ONR_DOC_MNG_CRD_ID
			   		,NVL(REQ_DOC_KND_CD,'2') AS REQ_DOC_KND_CD
			   		,A.EXAM_RPT_NTF_YN
			   		,B.TIT_NM
			   		,C.CVPT_OPM_APV_HNDL_STA_CD
			   		,A.AUD_EXEC_DCS_DDLN_EXMP_CD
			   		,A.CMT_RSLT_CD
			   		,A.CMT_DCS_CSL_DT
			   		,NVL(A.AUD_RFR_MTRL_YN,'N') AS AUD_RFR_MTRL_YN
			   		,A.CMT_COPT_DPT_CD
			   		,F_DPT_INFO(A.CMT_COPT_DPT_CD,'1') AS CMT_COPT_DPT_NM
			   		,A.CMT_SEN_DT
			   		,A.CMT_DOC_NO_1
			   		,A.CMT_DOC_NO_2
			FROM	TBCSPEAR001M A 
					,TBCSPDCP101M B
					,TBDCMACM015M D
					,TBCSPEAR002M C
			WHERE	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.TON_ORG_CD = D.ORG_CD(+)
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		C.REQ_DOC_KND_CD(+) = '2'
		]]>
	</select>
	
	
	<select id="CSPEAR005EExamApvSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	MAX(REQ_DVSN_CD) AS REQ_DVSN_CD
			        ,MAX(ACP_YR) AS ACP_YR
			        ,MAX(CVPT_ACP_NO) AS CVPT_ACP_NO
			        ,MAX(APV_VLE_PEN_DVSN_CD) AS APV_VLE_PEN_DVSN_CD
			        ,MAX(DVCHF_APV_DT) AS DVCHF_APV_DT
			        ,MAX(LDR_APV_DT) AS LDR_APV_DT
			        ,MAX(HQ_CHIF_APV_DT) AS HQ_CHIF_APV_DT
			        ,MAX(OW_PSD_APV_DT) AS OW_PSD_APV_DT
			        ,MAX(LEDG_APV_DT) AS LEDG_APV_DT
			        ,MAX(EXAM_DVCHF_APV_DT) AS EXAM_DVCHF_APV_DT
			        ,MAX(EXAM_LDR_APV_DT) AS EXAM_LDR_APV_DT
			        ,MAX(EXAM_HQ_CHIF_APV_DT) AS EXAM_HQ_CHIF_APV_DT
			        ,MAX(EXAM_OW_PSD_APV_DT) AS EXAM_OW_PSD_APV_DT
			        ,MAX(EXAM_LEDG_APV_DT) AS EXAM_LEDG_APV_DT
			FROM	(
						SELECT	D1.REQ_DVSN_CD
								,D1.ACP_YR
								,D1.CVPT_ACP_NO
								,D2.APV_VLE_PEN_DVSN_CD
								,D2.DVCHF_APV_DT
								,D2.LDR_APV_DT
								,D2.HQ_CHIF_APV_DT
								,D2.OW_PSD_APV_DT
								,D2.LEDG_APV_DT
								,'' EXAM_DVCHF_APV_DT
			                    ,'' EXAM_LDR_APV_DT
			                    ,'' EXAM_HQ_CHIF_APV_DT
			                    ,'' EXAM_OW_PSD_APV_DT
			                    ,'' EXAM_LEDG_APV_DT
						FROM	TBCSPEAR001M D1
								,TBCSPEAR009M D2
						WHERE	D1.REQ_DVSN_CD = #strREQ_DVSN_CD#
			   			AND		D1.ACP_YR = #strACP_YR#
			   			AND		D1.CVPT_ACP_NO = #strCVPT_ACP_NO#
			   			AND		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
						AND		D1.ACP_YR = D2.ACP_YR(+)
						AND		D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
						AND		D2.APV_DOC_DVSN_CD(+) = '2'
						UNION ALL
						SELECT	D1.REQ_DVSN_CD
								,D1.ACP_YR
								,D1.CVPT_ACP_NO
								,D2.APV_VLE_PEN_DVSN_CD
								,'' DVCHF_APV_DT
			                    ,'' LDR_APV_DT
			                    ,'' HQ_CHIF_APV_DT
			                    ,'' OW_PSD_APV_DT
			                    ,'' LEDG_APV_DT
								,D2.DVCHF_APV_DT  AS EXAM_DVCHF_APV_DT
								,D2.LDR_APV_DT AS EXAM_LDR_APV_DT
								,D2.HQ_CHIF_APV_DT AS EXAM_HQ_CHIF_APV_DT
								,D2.OW_PSD_APV_DT AS EXAM_OW_PSD_APV_DT
								,D2.LEDG_APV_DT AS EXAM_LEDG_APV_DT
						FROM	TBCSPEAR001M D1
								,TBCSPEAR009M D2
						WHERE	D1.REQ_DVSN_CD = #strREQ_DVSN_CD#
			   			AND		D1.ACP_YR = #strACP_YR#
			   			AND		D1.CVPT_ACP_NO = #strCVPT_ACP_NO#
			   			AND		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
						AND		D1.ACP_YR = D2.ACP_YR(+)
						AND		D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
						AND		D2.APV_DOC_DVSN_CD(+) = '3'
					)
		]]>
	</select>
	
	<update id="CSPEAR005EEAR001ExamUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		CMT_OEN_YN = #CMT_OEN_YN#
					,CMT_OEN_YE = #CMT_OEN_YE#
					,CMT_DGE = #CMT_DGE#
					,CMT_OEN_DT = #CMT_OEN_DT#
					,OGN_TYP_CD = #OGN_TYP_CD#
					,EXAM_RPT_APV_DT = #EXAM_RPT_APV_DT#
					,REQ_EXAM_RSLT_CD = #REQ_EXAM_RSLT_CD#
					,CMT_PRVS_CD = #CMT_PRVS_CD#
					,EXAM_RSLT_RPL_DT = #EXAM_RSLT_RPL_DT# 
					,TON_DT = #TON_DT#
					,KYWD_NM_1 = #KYWD_NM_1#
					,KYWD_NM_2 = #KYWD_NM_2#
					,KYWD_NM_3 = #KYWD_NM_3#
					,TON_ORG_CD = #TON_ORG_CD#
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
   					,AUD_EXEC_DCS_DDLN_EXMP_CD = #AUD_EXEC_DCS_DDLN_EXMP_CD# /*감사실시결정기한제외코드*/
   					,CMT_RSLT_CD = #CMT_RSLT_CD# /*위원회 결과*/
   					,CMT_DCS_CSL_DT = #CMT_DCS_CSL_DT# /*감사실시여부결정자문일*/
   					,AUD_RFR_MTRL_YN = #AUD_RFR_MTRL_YN# /*감사참고자료 여부*/
   					,CMT_COPT_DPT_CD = #CMT_COPT_DPT_CD# /*위원회 소관부서*/
   					,CMT_SEN_DT = #CMT_SEN_DT# /*위원회 발송일*/
   					,CMT_DOC_NO_1 = #CMT_DOC_NO_1#
   					,CMT_DOC_NO_2 = #CMT_DOC_NO_2#
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	<insert id="CSPEAR005EEAR004ExamFileInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPEAR004M
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, REQ_DOC_KND_CD
        					, DOC_ID
        					, DOC_TYP_CD
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
        					, #ACP_YR#
        					, #CVPT_ACP_NO#
        					, '2'
					   		, #EXAM_DOC_ID#
					   		, #DOC_TYP_CD#
        					, F_USR_INFO(#S_CNB#, '1')
        					, #FNL_USR_ID#
        					, #FNL_DEAL_DPT_CD#
        					, #FNL_MNU_ID#
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>
	
	<insert id="CSPEAR005EEAR002OnrInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO	TBCSPEAR002M
        				(	REQ_DVSN_CD
        					, ACP_YR
        					, CVPT_ACP_NO
        					, REQ_DOC_KND_CD
        					, ONR_DOC_MNG_CRD_ID
        					, CVPT_OPM_APV_HNDL_STA_CD
        					, ADMN_INF_HNDL_NO
        					, ONR_APV_RQS_DH
        					, FRT_USR_ID
        					, FNL_USR_ID
        					, FNL_DEAL_DPT_CD
        					, FNL_MNU_ID
        					, FRT_REGI_DH
        					, FNL_MDF_DH
        				)
        		VALUES	(	#REQ_DVSN_CD#
        					, #ACP_YR#
        					, #CVPT_ACP_NO#
        					, #REQ_DOC_KND_CD#
					   		, #ONR_DOC_MNG_CRD_ID#
					   		, '20'
					   		, #ADMN_INF_HNDL_NO#
					   		, SYSDATE
        					, F_USR_INFO(#S_CNB#, '1')
        					, #FNL_USR_ID#
        					, #FNL_DEAL_DPT_CD#
        					, #FNL_MNU_ID#
        					, SYSDATE
        					, SYSDATE
        				)
       	]]>
	</insert>
	
	<select id="CSPEAR005ERtnSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.RTN_DT
   					,A.DVCHF_APV_DT
   					,A.BRUCHF_APV_DT
   					,A.HQ_CHIF_APV_DT
   					,A.OW_PSD_APV_DT
   					,A.LEDG_APV_DT
   					,D.ONR_DOC_MNG_CRD_ID
   					/*,B.AUD_YR
   					,B.AUD_NO
   					,DECODE(B.AUD_YR,NULL,'',B.AUD_YR||'-'||B.AUD_NO) AS AUD_YR_NO*/
   					,C.CVPT_HNDL_STA_CD
   					/*,B.PRSS_STEP_CD*/
   					,A.EXAM_RPT_NTF_YN
			FROM	TBCSPEAR001M A
					/*, TBBADDED001M B*/
					, TBCSPDCP101M C, TBCSPEAR002M D
			WHERE	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			/*AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = B.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)*/
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
   			AND		A.ACP_YR = C.ACP_YR
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = D.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = D.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = D.CVPT_ACP_NO(+)
   			AND		D.REQ_DOC_KND_CD(+) = '2'
		]]>
	</select>
	
	<!-- <select id="CSPEAR005EAudBztSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,B.AUD_YR
   					,B.AUD_NO
   					,DECODE(B.AUD_YR,NULL,'',B.AUD_YR||'-'||B.AUD_NO) AS AUD_YR_NO
   					,C.BZT_YR
   					,C.BZT_SNO
   					,C.BZT_DVSN_CD
   					,TO_CHAR(TO_DATE(C.AUD_STR_DT),'YYYY-MM-DD')||'~'|| TO_CHAR(TO_DATE(C.AUD_END_DT),'YYYY-MM-DD')    AS AUD_STR_END_DT        /*실시기간*/
   					,C.AUD_BZT_KND_CD
   					,C.AUD_DCN
   					,F_ORG_CNT_NM(C.BZT_YR,C.BZT_SNO) AS ORG_CNT_NM 
			FROM	TBCSPEAR001M A, TBBADDED001M B, TBBADDED002M C
			WHERE	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND 	B.AUD_YR = C.REL_AUD_YR
   			AND		B.AUD_NO = C.REL_AUD_NO
		]]>
	</select> -->
	
	<select id="CSPEAR005EAudBztSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			 SELECT  D1.AUD_YR
			        ,D1.AUD_NO
			        ,D1.AUD_SBJ_NM
			        , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-') AS AUD_YR_N0
			        , F_CODE_NM_YEAR('1000007', D1.AUD_KND_CD, D1.AUD_YR) AS AUD_KND_NM
			        , F_DPT_INFO(D1.SPV_BRDV_CD,'1')	AS SPV_BRDV_NM  /*주관국과명*/
                    , F_DPT_INFO(D1.MNG_DPT_CD,'1')	AS SPV_BRDV_NM  /*주관국과명*/
			FROM    TBBADDED001M D1
			        ,TBBADDED030L D2
			WHERE   D1.AUD_YR = D2.AUD_YR
			AND     D1.AUD_NO = D2.AUD_NO
			AND		D2.TSK_KEY2 = #strREQ_DVSN_CD#
			AND		D2.TSK_KEY1 = #strACP_YR#
			AND		D2.TSK_KEY3 = #strCVPT_ACP_NO#
		]]>
	</select>
	
	<select id="CSPEAR005EHndlSituSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	C.RPT_DDLN_DT
					,C.BRDV_HNDL_DDLN_DT
					,C.MDT_CHGR_APV_DDLN_DT
					,C.MDT_OFER_APV_DDLN_DT
					,C.RVW_RM_APV_DDLN_DT
					,C.TOT_DHD_APV_DDLN_DT
					,C.CHF_CMTR_APV_DDLN_DT
					,C.ENF_APV_DDLN_DT
					,C.RTN_RPT_DT
					,C.AUD_BRDV_APV_DT
					,C.MDT_OFER_APV_DT
					,C.MDT_DDG_APV_DT
					,C.JA_JDG_SSEC_APV_DT
					,C.OW_DHD_APV_DT
					,C.CHF_CMTR_APV_DT
					,C.ENF_APV_DT
					,(CASE WHEN TRIM(C.RTN_RPT_DT) IS NOT NULL THEN /*귀청보고일이 있는 경우*/
				       			CASE WHEN TRIM(C.RPT_DDLN_DT) IS NULL THEN '0'
				           			ELSE TO_CHAR(TO_DATE(C.RTN_RPT_DT) - TO_DATE(C.RPT_DDLN_DT))
				         			END
				         	ELSE CASE
				           		WHEN TRIM(C.RPT_DDLN_DT) IS NULL THEN '0'
				           		ELSE TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(C.RPT_DDLN_DT))
							END
					 END) AS DIFF_REPORT /*귀청보고지연일수*/
					, CASE
			         WHEN TRIM(RTN_RPT_DT) IS NOT NULL AND TRIM(BRDV_HNDL_DDLN_DT) IS NOT NULL
			         THEN /*귀청보고일이 있는 */
			              CASE WHEN TRIM(AUD_BRDV_APV_DT) IS NULL 
			                   THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(BRDV_HNDL_DDLN_DT))
			                   ELSE TO_CHAR(TO_DATE(AUD_BRDV_APV_DT) - TO_DATE(BRDV_HNDL_DDLN_DT))
			               END
			         ELSE '-'
			        END DIFF_BRDV /*감사국과지연일수*/
			         
			         
					,(CASE WHEN TRIM(C.AUD_BRDV_APV_DT) IS NOT NULL 
						THEN /*감사국과결재일이 있는 경우*/
		                	CASE WHEN TRIM(C.MDT_OFER_APV_DT) IS NULL 
								THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(C.MDT_CHGR_APV_DDLN_DT))
							ELSE TO_CHAR(TO_DATE(C.MDT_OFER_APV_DT) - TO_DATE(C.MDT_CHGR_APV_DDLN_DT))
							END
						ELSE '-'
			       	END) AS DIFF_MDT_CHGR /*조정담당자지연일수*/
			       	,(CASE WHEN TRIM(C.MDT_OFER_APV_DT) IS NOT NULL /*조정담당자결재일이 있는 경우*/
						THEN  
							CASE WHEN TRIM(C.MDT_DDG_APV_DT) IS NULL 
		                   		THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(C.MDT_OFER_APV_DDLN_DT))
		                  	ELSE TO_CHAR(TO_DATE(C.MDT_DDG_APV_DT) - TO_DATE(C.MDT_OFER_APV_DDLN_DT))
		                   	END
			     		ELSE '-'
			        END) AS DIFF_MDT_OFER /*조정담당관지연일수 */   
			        , CASE                                                                                                                  			                                                                           
			         WHEN TRIM(AUD_BRDV_APV_DT) IS NOT NULL AND TRIM(RVW_RM_APV_DDLN_DT) IS NOT NULL THEN /*조정담당관결재일이 있는 경우*/
			       CASE                                                                                                                  
			           WHEN TRIM(JA_JDG_SSEC_APV_DT) IS NULL THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(RVW_RM_APV_DDLN_DT))                 
			           ELSE TO_CHAR(TO_DATE(JA_JDG_SSEC_APV_DT) - TO_DATE(RVW_RM_APV_DDLN_DT))                                           
			         END                                                                                                                 
			         ELSE '-'                                                                                                            
			       END DIFF_RVW_RM /*심의실장지연일수*/  
			       ,CASE
			         WHEN TRIM(JA_JDG_SSEC_APV_DT) IS NOT NULL AND TRIM(TOT_DHD_APV_DDLN_DT) IS NOT NULL THEN /*법무심사관(심의실장)결재일이 있는 경우*/
			       CASE
			           WHEN TRIM(OW_DHD_APV_DT) IS NULL THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(TOT_DHD_APV_DDLN_DT))
			           ELSE TO_CHAR(TO_DATE(OW_DHD_APV_DT) - TO_DATE(TOT_DHD_APV_DDLN_DT))
			         END
			         ELSE '-'
			       END DIFF_TOT_DHD /*총차장지연일수*/
			       	,CASE
			         WHEN TRIM(OW_DHD_APV_DT) IS NOT NULL AND TRIM(CHF_CMTR_APV_DDLN_DT) IS NOT NULL THEN /*사무차장결재일이 있는경우*/
			       CASE
			           WHEN TRIM(CHF_CMTR_APV_DT) IS NULL THEN TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(CHF_CMTR_APV_DDLN_DT))
			           ELSE TO_CHAR(TO_DATE(CHF_CMTR_APV_DT) - TO_DATE(CHF_CMTR_APV_DDLN_DT))
			         END
			         ELSE '-'
			       END DIFF_CHF_CMTR /*주심위원지연일수*/
			       	,CASE
			         WHEN TRIM(CHF_CMTR_APV_DT) IS NOT NULL THEN /*주심위원결재일이 있는 경우*/
			       CASE
			           WHEN TRIM(ENF_APV_DT) IS NULL THEN CASE
			             WHEN TRIM(ENF_APV_DDLN_DT) IS NULL THEN '0'
			             ELSE TO_CHAR(TO_DATE(SYSDATE) - TO_DATE(ENF_APV_DDLN_DT))
			           END
			           ELSE CASE
			             WHEN TRIM(ENF_APV_DDLN_DT) IS NULL THEN '0'
			             ELSE TO_CHAR(TO_DATE(ENF_APV_DT) - TO_DATE(ENF_APV_DDLN_DT))
			           END
			         END
			         ELSE '-'
			       END DIFF_ENF /*시행지연일수*/
			FROM	TBBADDED030L D2, TBBADDED001M B, TBBADDED003M C
			WHERE	D2.TSK_KEY2 = #strREQ_DVSN_CD#
			AND		D2.TSK_KEY1 = #strACP_YR#
			AND		D2.TSK_KEY3 = #strCVPT_ACP_NO#
   			AND		B.AUD_YR = D2.AUD_YR
			AND     B.AUD_NO = D2.AUD_NO
   			AND		B.AUD_YR = C.AUD_YR
   			AND		B.AUD_NO = C.AUD_NO
   			AND		SUBSTR(B.AUD_KND_CD,'3','1') <> '5'
   			
		]]>
	</select>
	
	<update id="CSPEAR005EEAR001RtnUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		RTN_DT = #RTN_DT#
					,DVCHF_APV_DT = #DVCHF_APV_DT#
					,BRUCHF_APV_DT = #BRUCHF_APV_DT#
					,HQ_CHIF_APV_DT = #HQ_CHIF_APV_DT#
					,OW_PSD_APV_DT = #OW_PSD_APV_DT#
					,LEDG_APV_DT = #LEDG_APV_DT#
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	<select id="CSPEAR005EAudResultSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.AUD_CMT_OEN_DT
   					,A.DSP_RQ_ENF_DT
   					,A.AUD_RSLT_RPL_DT
   					,A.AUD_RSLT_CD
   					,D.ONR_DOC_MNG_CRD_ID
   					,B.AUD_YR
   					,B.AUD_NO
   					,DECODE(B.AUD_YR,NULL,'',B.AUD_YR||'-'||B.AUD_NO) AS AUD_YR_NO
   					,C.CVPT_HNDL_STA_CD
   					,B.PRSS_STEP_CD
   					,NVL(D.REQ_DOC_KND_CD,'3') AS REQ_DOC_KND_CD
   					,C.TIT_NM
   					,D.CVPT_OPM_APV_HNDL_STA_CD
			FROM	TBCSPEAR001M A, TBBADDED001M B, TBCSPDCP101M C, TBCSPEAR002M D
			WHERE	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = B.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD
   			AND		A.ACP_YR = C.ACP_YR
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = D.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = D.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = D.CVPT_ACP_NO(+)
   			AND		D.REQ_DOC_KND_CD(+) = '3'
		]]>
	</select>
	
	<!-- <select id="CSPEAR005EAudResultBztSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT D1.AUD_YR                         AS AUD_YR                          /*감사년도*/
			     , D1.AUD_NO                         AS AUD_NO                          /*감사번호*/
			     , D1.AUD_YR||D1.AUD_NO              AS AUD_YR_NO   
			     , D3.SPV_BRDV_NM                    AS SPV_BRDV_NM                     /*주관국과명*/
			     , D3.AUD_SBJ_NM                     AS AUD_SBJ_NM                      /*감사사항*/
			     , D3.AUD_ORG_CNT                    AS AUD_ORG_CNT                     /*기관명*/
			     , D1.DSP_RQ_SNO                     AS DSP_RQ_SNO                      /*처분요구순번*/
			     , D1.AUD_YR||'-'||D1.AUD_NO||'-'||D1.DSP_RQ_SNO AS DSP_RQ_SNO_NM       /*처분요구순번DISP*/
			     , D1.FRM_NO                         AS FRM_NO                          /*서식번호*/
			     , D1.RPRT_NO                     AS RPRT_NO                      /*보고서식번호*/
			     /*, D1.JUDG_NO                        AS JUDG_NO                         /*판결번호*/
			     , D1.TIT_TXT                        AS TIT_TXT                         /*제목내용*/    
			     /*, D1.HND_SBJ_TXT                    AS HND_SBJ_TXT                     /*조치사항내용*/
			     /*, D1.HNDL_PLAN_DVSN_CD                 AS HNDL_PLAN_DVSN_CD                  /*처리방안구분*/
			     , D1.DSP_RQ_KND_CD                  AS DSP_RQ_KND_CD                   /*처분요구종류코드*/
			     , D1.ORG_DVSN_CD                    AS ORG_DVSN_CD                     /*기관구분코드*/
			     , D1.AUD_EPS_CD                     AS AUD_EPS_CD                      /*감사중점코드*/
			     , D2.DSP_RQ_SRNO                    AS DSP_RQ_SRNO                     /*처분요구일련번호*/
			     , D2.ENF_DT                         AS ENF_DT                          /*시행일*/
			     , D2.HNDL_DDLN_DT                   AS HNDL_DDLN_DT                    /*처리기한일*/
			     , D2.ENF_BRDV_CD                    AS ENF_BRDV_CD                     /*시행국과코드*/
			     , F_DPT_INFO(D2.ENF_BRDV_CD,'1')	 AS ENF_BRDV_NM                     /*시행국과명*/
			     /*, D2.CHGR_NM                        AS CHGR_NM                         /*담당자명*/    
			     , D2.DOC_SEN_NO                     AS DOC_SEN_NO                      /*문서발송코드*/
			     /*, D2.DSP_RQ_IPT_DT                  AS DSP_RQ_IPT_DT                   /*처분요구입력일*/
			     /*, D2.PSC_RQT_NOP_CNT                AS PSC_RQT_NOP_CNT                 /*고발의뢰인원수*/    
			     /*, D2.PNL_DRIN_PSVT_AM               AS PNL_DRIN_PSVT_AM                /*추징회수보전금액*/
			     /*, D2.RSR_AM                         AS RSR_AM                          /*환급금액*/
			     /*, D2.SPLP_AM                        AS SPLP_AM                         /*추급금액*/
			     /*, D2.BGT_RDC_AM                     AS BGT_RDC_AM                      /*예산절감금액*/    
			     /*, D2.INC_ICR_AM                     AS INC_ICR_AM                      /*수입증대금액*/    
			     /*, D2.PPL_BDN_RDT_AM                 AS PPL_BDN_RDT_AM                  /*국민부담경감금액*/
			     /*, D2.FRTN_INCR_AM                   AS FRTN_INCR_AM                    /*재산증가금액*/
			     /*, D2.EXPN_RTNL_AM                   AS EXPN_RTNL_AM                    /*지출합리화금액*/
			     /*, D2.IJS_AM                         AS IJS_AM                          /*부당금액*/
			     /*, D2.SLF_HNDL_RQ_AM                 AS SLF_HNDL_RQ_AM                  /*자체처리요구금액*/
			     , D2.WRDO_CAU_CD                    AS WRDO_CAU_CD                     /*비위원인코드*/
			     , D2.ENFM_MNG_BRDV_CD               AS ENFM_MNG_BRDV_CD                /*집행관리국과코드*/    
			     , D2.DTM_YN                         AS DTM_YN                          /*확정여부*/
			     , D2.DTM_STA_CD                     AS DTM_STA_CD                      /*확정상태코드*/
			     /*, D2.ENFM_HST_IPT_DT                AS ENFM_HST_IPT_DT                 /*집행이력입력일*/
			     /*, D2.ACNT_INSP_CD                   AS ACNT_INSP_CD                    /*회계감찰코드*/
			     /*, D2.CPLT_DT                        AS CPLT_DT                         /*완견일*/
			     , D2.HMP_OPEN_YN                    AS HMP_OPEN_YN                     /*홈페이지공개여부*/
			     , D2.DTY_OBV_UTL_YN                 AS DTY_OBV_UTL_YN                  /*직무관철활용여부*/
			     /*, D2.AM                             AS AM                              /*금액*/
			     /*, D2.NOP_CNT                        AS NOP_CNT                         /*인원수*/
			     /*, D2.HNDL_PLAN_RPT_NO               AS HNDL_PLAN_RPT_NO                /*처리방안보고번호*/    
			     /*, D2.EVI_CNT                        AS EVI_CNT                         /*증거수*/
			     /*, D2.TOT_EVI_CNT                    AS TOT_EVI_CNT                     /*총증거수*/
			     , D2.WRDO_TYP_CD                    AS WRDO_TYP_CD                     /*비위유형코드*/
			     /*, D2.DTY_INSP_MTRL_TXT              AS DTY_INSP_MTRL_TXT               /*직무감찰자료내용*/
			     /*, D2.AUD_POLI_CD                    AS AUD_POLI_CD                     /*감사방침코드*/
			     /*, D2.AUD_SPH_CD                     AS AUD_SPH_CD                      /*감사분야코드*/
			     /*, D2.AUD_RPT_YR                     AS AUD_RPT_YR                      /*감사보고년도*/
			     /*, D2.ENFM_CPLT_IPT_DT               AS ENFM_CPLT_IPT_DT                /*집행완결입력일*/
			     /*, D2.EPT_EFCT_AM_STA_CD             AS EPT_EFCT_AM_STA_CD              /*기대효과금액상태코드*/
			     /*, D2.EPT_EFCT_DT                    AS EPT_EFCT_DT                     /*기대효과일*/
			     /*, D2.ENFM_WHLS_DTM_DT               AS ENFM_WHLS_DTM_DT                /*집행전말확정일*/    
			     /*, D2.SLF_HNDL_TXT                   AS SLF_HNDL_TXT                    /*자체처리내용*/
			     /*, D2.STF_SMT_INF_TXT                AS STF_SMT_INF_TXT                 /*직원제출정보내용*/
			     /*, D2.COPT_OFI_CD                    AS COPT_OFI_CD                     /*소관청코드*/
			     /*, D2.RLTN_ORG_CD                    AS RLTN_ORG_CD                     /*관계기관코드*/
			     /*, D2.COPT_CNT                       AS COPT_CNT                        /*소관수*/
			     /*, D2.ORG_CNT                        AS ORG_CNT                         /*기관수*/
			     /*, D2.DSP_RQ_DTM_DT                  AS DSP_RQ_DTM_DT                   /*처분요구확정일*/
			     /*, D2.DSP_RQ_DTM_PEN_ID              AS DSP_RQ_DTM_PEN_ID               /*처분요구확정자ID*/
			     /*, D2.ENFM_CPLT_IPT_PEN_ID           AS ENFM_CPLT_IPT_PEN_ID            /*집행완결입력자ID*/
			     /*, D2.ENFM_WHLS_DTM_PEN_ID           AS ENFM_WHLS_DTM_PEN_ID            /*집행전말확정자ID*/
			     , D2.DSP_RQ_APV_STA_CD              AS DSP_RQ_APV_STA_CD               /*처분요구결재상태코드*/
			     /*, D2.APV_REF_ID                     AS APV_REF_ID                      /*결재참조ID*/
			     /*, D2.DSP_RQ_APV_STA_DT              AS DSP_RQ_APV_STA_DT               /*처분요구결재상태일*/
			     /*, D2.CPLT_PEN_ID                    AS CPLT_PEN_ID                     /*완결자ID*/    
			     , D2.TSK_CAT_CD                     AS TSK_CAT_CD                      /*업무분류코드*/
			     /*, D2.APV_REF_GRP_ID                 AS APV_REF_GRP_ID                  /*결재참조그룹ID*/
			     /*, D2.EXPOT_Y_EFCT_AM                AS EXPOT_Y_EFCT_AM                 /*사후적효과금액*/
			     /*, D2.EXPOT_Y_EFCT_AM_CALC_BAS_TXT   AS EXPOT_Y_EFCT_AM_CALC_BAS_TXT    /*사후적효과금액계산근거내용*/
			     /*, D2.ENFM_WHLS_APV_KND_CD           AS ENFM_WHLS_APV_KND_CD            /*집행전말결재종류코드*/ 
			     /*, D2.EXAM_RPRT_DSP_RQ_SBT           AS EXAM_RPRT_DSP_RQ_SBT            /*검토보고서처분요구요지*/
			     /*, D2.EXAM_RPRT_UNENFM_RTWR_TXT      AS EXAM_RPRT_UNENFM_RTWR_TXT       /*검토보고서미집행경위내용*/
			     /*, D2.EXAM_RPRT_UNENFM_RSN_EXAM_TXT  AS EXAM_RPRT_UNENFM_RSN_EXAM_TXT   /*검토보고서미집행사유검토내용*/
			     /*, D2.EXAM_RPRT_APV_STA_DT           AS EXAM_RPRT_APV_STA_DT            /*검토보고서결재상태일*/
			     /*, D2.EXAM_RPRT_APV_REF_ID           AS EXAM_RPRT_APV_REF_ID            /*검토보고서결재참조ID*/
			     /*, D2.EXAM_RPRT_APV_STA_CD           AS EXAM_RPRT_APV_STA_CD            /*검토보고서결재상태코드*/
			     /*, D2.CLSG_PRSS_STA_CD               AS CLSG_PRSS_STA_CD                /*결산진행상태코드*/
			     , F_CODE_NM('1000121',D2.WRDO_TYP_CD) AS WRDO_TYP_NM                   /*비위유형코드명*/      
			     , F_CODE_NM('1000120',D2.TSK_CAT_CD)  AS TSK_CAT_NM                    /*업무분류명*/
			     , F_CODE_NM('1000002',D1.DSP_RQ_KND_CD )  AS DSP_RQ_KND_NM                    /*처분요구종류명*/
			     , F_CODE_NM('1000017',D2.DTM_STA_CD )  AS DTM_STA_NM                    /*결재상태명*/
			  FROM TBBADEAR001M D1
			     , TBBADEAR002D D2
			     , (
			           SELECT D1.AUD_YR
			                , D1.AUD_NO
			                , F_DPT_INFO(D1.SPV_BRDV_CD,'1')||'(반장 : '||F_USR_INFO(D1.AUD_TOT_DRTR_CNB,'2')||', 주관 : '||F_USR_INFO(D1.SPVR_CNB,'2')||')' AS SPV_BRDV_NM               
			                , '<'||F_CODE_NM('1000007',D1.AUD_KND_CD) ||'>'||D1.AUD_SBJ_NM AS AUD_SBJ_NM
			                , F_ORG_CNT_NM_AUD(D1.AUD_YR,D1.AUD_NO,'1') AS AUD_ORG_CNT
			            FROM TBBADDED001M D1
			            	, TBCSPEAR001M A
			             WHERE 1=1
		            	AND		A.REQ_DVSN_CD = #strREQ_DVSN_CD#
					 	AND		A.ACP_YR = #strACP_YR#
		   				AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
		   				AND		A.REQ_DVSN_CD = D1.REQ_DVSN_CD
		   				AND		A.ACP_YR = D1.ACP_YR
		   				AND		A.CVPT_ACP_NO = D1.CVPT_ACP_NO
			       ) D3
			 WHERE 1=1
			   	AND 	D1.AUD_YR     = D2.AUD_YR
			   	AND 	D1.AUD_NO     = D2.AUD_NO
			   	AND 	D1.DSP_RQ_SNO = D2.DSP_RQ_SNO
			   	AND 	D1.AUD_YR     = D3.AUD_YR
			   	AND 	D1.AUD_NO     = D3.AUD_NO
		]]>
	</select> -->
	
	<select id="CSPEAR005EAudResultBztSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT  D1.AUD_YR
				        ,D1.AUD_NO
				        ,D1.DSP_RQ_SNO
				        ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-') ||'-'|| D1.DSP_RQ_SNO AS DSP_RQ_SNO_NM
				        , D1.TIT_TXT
				        , F_CODE_NM('1000002',D1.DSP_RQ_KND_CD )  AS DSP_RQ_KND_NM 
				FROM    TBBADEAR001M D1
				        ,TBBADEAR035L D2
				        ,TBBADDED001M D3
				WHERE   D1.AUD_YR = D2.AUD_YR
				AND     D1.AUD_NO = D2.AUD_NO
				AND     D1.DSP_RQ_SNO = D2.DSP_RQ_SNO
				AND     D1.AUD_YR = D3.AUD_YR
				AND     D1.AUD_NO = D3.AUD_NO
				AND		D2.TSK_KEY2 = #strREQ_DVSN_CD#
				AND		D2.TSK_KEY1 = #strACP_YR#
				AND		D2.TSK_KEY3 = #strCVPT_ACP_NO#
		]]>
	</select>
	
	<update id="CSPEAR005EEAR001AudResultUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		AUD_CMT_OEN_DT = #AUD_CMT_OEN_DT#
					,DSP_RQ_ENF_DT = #DSP_RQ_ENF_DT#
					,AUD_RSLT_RPL_DT = #AUD_RSLT_RPL_DT#
					,AUD_RSLT_CD = #AUD_RSLT_CD#
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	<update id="CSPEAR005EEAR001WdwUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		AUD_RSLT_CD = '08'
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	<update id="CSPEAR005EDCP101WdwUpdate" parameterClass="paramMap">
        <![CDATA[
        	UPDATE	TBCSPDCP101M
        	SET		CVPT_HNDL_STA_CD = #CVPT_HNDL_STA_CD#
        			,CVPT_WDW_DH  = SYSDATE
   					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
   			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
   			AND		ACP_YR = #ACP_YR#
   			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
       	]]>
	</update>
	
	<update id="CSPEAR005EEAR001TrnfUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		HNDL_DPT_CD = ''
					,HNDL_CHGR_ID = ''
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	<update id="CSPEAR005EEAR001PreiNtfUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		AUD_RSLT_RPL_DT = #PREI_RPL_DT#
					,AUD_RSLT_CD = '03'
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	<update id="CSPEAR005EEAR001ExamNtfUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		EXAM_RPT_NTF_YN = 'Y'
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
		]]>
					<isEqual property="REQ_EXAM_RSLT_CD" compareValue="02" >
						,AUD_RSLT_RPL_DT = #EXAM_RSLT_RPL_DT#
						,AUD_RSLT_CD = #REQ_EXAM_RSLT_CD#
					</isEqual>
					<isEqual property="REQ_EXAM_RSLT_CD" compareValue="03" >
						,AUD_RSLT_RPL_DT = #EXAM_RSLT_RPL_DT#
						,AUD_RSLT_CD = #REQ_EXAM_RSLT_CD#
					</isEqual>
					<isEqual property="REQ_EXAM_RSLT_CD" compareValue="04" >
						,AUD_RSLT_RPL_DT = #EXAM_RSLT_RPL_DT#
						,AUD_RSLT_CD = #REQ_EXAM_RSLT_CD#
					</isEqual>
					<isEqual property="REQ_EXAM_RSLT_CD" compareValue="05" >
						,AUD_RSLT_RPL_DT = #EXAM_RSLT_RPL_DT#
						,AUD_RSLT_CD = #REQ_EXAM_RSLT_CD#
					</isEqual>
		<![CDATA[
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	<resultMap class="java.util.HashMap" id="CSPEAR013">
 		<result property="REQ_DVSN_CD" column="REQ_DVSN_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ACP_YR" column="ACP_YR"                             jdbcType="VARCHAR2"  javaType="java.lang.String" /> 
		<result property="CVPT_ACP_NO" column="CVPT_ACP_NO"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="REQ_DOC_KND_CD" column="REQ_DOC_KND_CD"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ONR_DOC_MNG_CRD_ID" column="ONR_DOC_MNG_CRD_ID"                             jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="CVPT_OPM_APV_HNDL_STA_CD" column="CVPT_OPM_APV_HNDL_STA_CD"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="OPM_TXT" column="OPM_TXT"                                 jdbcType="CLOB"  javaType="java.lang.String" />
		<result property="AD" column="AD"                                 jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RECEIVER" column="RECEIVER"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
		<result property="ZCD" column="ZCD"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
		<result property="CVPTR_NM" column="CVPTR_NM"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
		<result property="TEL" column="TEL"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
		<result property="FL_RUT_NM" column="FL_RUT_NM"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
		<result property="SYS_FL_NM" column="SYS_FL_NM"                         jdbcType="VARCHAR2"      javaType="java.lang.String" />
 	</resultMap>
 	
 	<select id="CSPEAR013PMainSelect2" parameterClass="paramMap"
		resultMap="CSPEAR013">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,#strREQ_DOC_KND_CD# AS REQ_DOC_KND_CD
   					,C.ONR_DOC_MNG_CRD_ID
   					,C.CVPT_OPM_APV_HNDL_STA_CD
				   	,C.OPM_TXT
				   	,A.AD||' '||A.DTL_AD AS AD
				   	,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM)
				   	||' 귀하 (우'||A.ZCD||' '||A.AD||' '||A.DTL_AD||') AS RECEIVER
   					,A.ZCD
   					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS CVPTR_NM
   					,DECODE(A.TNB,NULL,A.HPN,A.TNB) AS TEL
   					, D.FL_RUT_NM
					, D.SYS_FL_NM
   			FROM	TBCSPDCP101M A
   					,TBCSPEAR001M B
   					,TBCSPEAR002M C
   					, TBDCMACM103L D
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = #strREQ_DVSN_CD#
			AND		A.ACP_YR = #strACP_YR#
			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		C.REQ_DOC_KND_CD(+) = #strREQ_DOC_KND_CD#
   			AND		C.ONR_DOC_MNG_CRD_ID = D.ONR_DOC_MNG_CRD_ID(+)
		]]>
	</select>
	
	<insert id="CSPEAR005EMmsMsgInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MMS_CONTENTS_INFO 
				 	(	CONT_SEQ
				 		, FILE_CNT
				 		, MMS_BODY
				 		, MMS_SUBJECT
				 	) 
			VALUES (	#CONT_SEQ#
						, 1
						, #SMS_TXT#||#ACP_YR#||'-'||DECODE(#REQ_DVSN_CD#,'2','국민','공익')||'-'||#CVPT_ACP_NO#
						, '감사원 감사청구 문자 통보'
					)
		]]>
	</insert>
	
	<insert id="CSPEAR005EMsgInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MSG_DATA
				 	(	MSG_SEQ
				 		, CUR_STATE
				 		, REQ_DATE
				 		, CALL_TO
				 		, CALL_FROM
				 		, SMS_TXT
				 		, MSG_TYPE
				 		, CONT_SEQ
				 	) 
			VALUES (	MSG_DATA_SEQ.NEXTVAL
						, 0
						, SYSDATE
						, REPLACE(#HPN#,'-','')
						, '0220112751'
						, ''
						, 6
						, #CONT_SEQ#
					)
		]]>
	</insert>
	
	<update id="CSPEAR005EDCP101MainUpdate" parameterClass="paramMap">
        <![CDATA[
        	UPDATE	TBCSPDCP101M
        	SET		CVPTR_NM = #CVPTR_NM#
   					,BTDT = #BTDT#
   					,JB_NM = #JB_NM#
   					,RPST_PEN_NM = #RPST_PEN_NM#
   					,BZN = #BZN#
   					,ZCD = #ZCD#
   					,AD = #AD#
   					,DTL_AD = #DTL_AD#
   					,TNB = DECODE(#TNB1#,NULL,'',#TNB1#||'-'||#TNB2#||'-'||#TNB3#)
   					,HPN = DECODE(#HPN1#,NULL,'',#HPN1#||'-'||#HPN2#||'-'||#HPN3#)
   					,TIT_NM = #TIT_NM#
   					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
   			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
   			AND		ACP_YR = #ACP_YR#
   			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
       	]]>
	</update>
	
	<update id="CSPEAR005EDCP102Update" parameterClass="paramMap">
        <![CDATA[
        	UPDATE	TBCSPDCP102M
        	SET		CVPT_TXT = #CVPT_TXT#
   					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
   			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
   			AND		ACP_YR = #ACP_YR#
   			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
       	]]>
	</update>
	
	<update id="CSPEAR005EEAR001Update" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		REQR_DVSN_CD = #REQR_DVSN_CD#
   					,REQR_CNT = #REQR_CNT#
   					,AUD_EXEC_DCS_DPT_CD = #AUD_EXEC_DCS_DPT_CD#
   					,AUD_EXEC_DCS_CHGR_ID = #AUD_EXEC_DCS_CHGR_ID#
   					,AUD_DPT_CD = #AUD_DPT_CD#
   					,AUD_CHGR_ID = #AUD_CHGR_ID#
   					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
   			AND		ACP_YR = #ACP_YR#
   			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
	
	
	<select id="CSPEAR005EExamFileSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	A.ACP_YR
					,A.CVPT_ACP_NO
					,A.REQ_DVSN_CD
					,C.DOC_ID AS EXAM_DOC_ID
					/*,(SELECT 	X.FILE_NAME
						FROM	ECM_FILE_LIST_VIEW2 X
						WHERE	C.DOC_ID = X.DOC_ID
						AND		ROWNUM = 1
					) AS FILE_NAME*/
					,'' AS FILE_NAME
			FROM	TBCSPEAR001M A 
					,TBCSPDCP101M B
					,TBCSPEAR004M C
			WHERE	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
   			AND		C.REQ_DOC_KND_CD(+) = '2'
		]]>
	</select>
	
	<select id="CSPEAR005ECmtFileSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			WITH BASE AS  (
				SELECT 	REQ_DVSN_CD
	                      , ACP_YR
	                      , CVPT_ACP_NO
	                      ,(SELECT    DOC_ID
	                      FROM      TBCSPEAR004M
	                      WHERE     REQ_DOC_KND_CD = '3' 
	                      AND       ROWNUM = 1) AS CMT_DOC_ID_1
	                    ,(SELECT    DOC_ID
	                      FROM      TBCSPEAR004M
	                      WHERE     REQ_DOC_KND_CD = '4' 
	                      AND       ROWNUM = 1) AS CMT_DOC_ID_2
	                    ,(SELECT    DOC_ID
	                      FROM      TBCSPEAR004M
	                      WHERE     REQ_DOC_KND_CD = '5' 
	                      AND       ROWNUM = 1) AS CMT_DOC_ID_3
				FROM    (SELECT #strREQ_DVSN_CD# AS REQ_DVSN_CD
				                      ,#strACP_YR# AS ACP_YR
				                      ,#strCVPT_ACP_NO# AS CVPT_ACP_NO 
				         FROM DUAL ) )
				SELECT	A.ACP_YR
						,A.CVPT_ACP_NO
						,A.REQ_DVSN_CD
						,C.CMT_DOC_ID_1
	                    ,C.CMT_DOC_ID_2
	                    ,C.CMT_DOC_ID_3
						/*,(SELECT 	X.FILE_NAME
							FROM	ECM_FILE_LIST_VIEW2 X
							WHERE	C.CMT_DOC_ID_1 = X.DOC_ID
							AND		ROWNUM = 1
						) AS FILE_NAME_1
	                    ,(SELECT 	X.FILE_NAME
							FROM	ECM_FILE_LIST_VIEW2 X
							WHERE	C.CMT_DOC_ID_2 = X.DOC_ID
							AND		ROWNUM = 1
						) AS FILE_NAME_2
	                    ,(SELECT 	X.FILE_NAME
							FROM	ECM_FILE_LIST_VIEW2 X
							WHERE	C.CMT_DOC_ID_3 = X.DOC_ID
							AND		ROWNUM = 1
						) AS FILE_NAME_3*/
					,'' AS FILE_NAME_1
					,'' AS FILE_NAME_2
					,'' AS FILE_NAME_3
			FROM	TBCSPEAR001M A 
					,TBCSPDCP101M B
					,BASE C
			WHERE	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
   			AND		A.ACP_YR = #strACP_YR#
   			AND		A.CVPT_ACP_NO = #strCVPT_ACP_NO#
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD
   			AND		A.ACP_YR = B.ACP_YR
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
   			AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = C.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
		]]>
	</select>
	
	
	<update id="CSPEAR005EExamApvMerge1" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO	TBCSPEAR009M D1
			USING	(	SELECT	#REQ_DVSN_CD# AS REQ_DVSN_CD
								,#ACP_YR# AS ACP_YR
								,#CVPT_ACP_NO# AS CVPT_ACP_NO
								,'2' AS APV_DOC_DVSN_CD
						FROM	DUAL
					) D2
			ON		(		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
						AND	D1.ACP_YR = D2.ACP_YR
						AND	D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
						AND	D1.APV_DOC_DVSN_CD = D2.APV_DOC_DVSN_CD
					)
			WHEN MATCHED THEN
				UPDATE
				SET		APV_VLE_PEN_DVSN_CD = #APV_VLE_PEN_DVSN_CD#
						,DVCHF_APV_DT = NULL
						,LDR_APV_DT = #LDR_APV_DT#
						,HQ_CHIF_APV_DT = #HQ_CHIF_APV_DT#
						,OW_PSD_APV_DT = #OW_PSD_APV_DT#
						,LEDG_APV_DT = #LEDG_APV_DT#
						,FNL_USR_ID = #FNL_USR_ID#
	  					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
	  					,FNL_MNU_ID = #FNL_MNU_ID#
	  					,FNL_MDF_DH = SYSDATE
	  		WHEN NOT MATCHED THEN
	  			INSERT	(	REQ_DVSN_CD
	  					,	ACP_YR
	  					,	CVPT_ACP_NO
	  					,	APV_DOC_DVSN_CD
	  					,	APV_VLE_PEN_DVSN_CD
	  					,	DVCHF_APV_DT
	  					,	LDR_APV_DT
	  					,	HQ_CHIF_APV_DT
	  					,	OW_PSD_APV_DT
	  					,	LEDG_APV_DT
	  					,	FRT_USR_ID
	  					,	FNL_USR_ID
	  					,	FNL_DEAL_DPT_CD
	  					,	FNL_MNU_ID
	  					,	FRT_REGI_DH
	  					,	FNL_MDF_DH
	  					)
	  			VALUES	(	#REQ_DVSN_CD#
	  					,	#ACP_YR#
	  					,	#CVPT_ACP_NO#
	  					,	'2'
	  					,	#APV_VLE_PEN_DVSN_CD#
	  					,	NULL
	  					,	#LDR_APV_DT#
	  					,	#HQ_CHIF_APV_DT#
	  					,	#OW_PSD_APV_DT#
	  					,	#LEDG_APV_DT#
	  					,	#FNL_USR_ID#
	  					,	#FNL_USR_ID#
	  					,	#FNL_DEAL_DPT_CD#
	  					,	#FNL_MNU_ID#
	  					,	SYSDATE
	  					,	SYSDATE
	  					)
	  	]]>
	</update>	
	
	<update id="CSPEAR005EExamApvMerge2" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO	TBCSPEAR009M D1
			USING	(	SELECT	#REQ_DVSN_CD# AS REQ_DVSN_CD
								,#ACP_YR# AS ACP_YR
								,#CVPT_ACP_NO# AS CVPT_ACP_NO
								,'3' AS APV_DOC_DVSN_CD
						FROM	DUAL
					) D2
			ON		(		D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
						AND	D1.ACP_YR = D2.ACP_YR
						AND	D1.CVPT_ACP_NO = D2.CVPT_ACP_NO
						AND	D1.APV_DOC_DVSN_CD = D2.APV_DOC_DVSN_CD
					)
			WHEN MATCHED THEN
				UPDATE
				SET		APV_VLE_PEN_DVSN_CD = #APV_VLE_PEN_DVSN_CD#
						,DVCHF_APV_DT = #EXAM_DVCHF_APV_DT#
						,LDR_APV_DT = #EXAM_LDR_APV_DT#
						,HQ_CHIF_APV_DT = #EXAM_HQ_CHIF_APV_DT#
						,OW_PSD_APV_DT = #EXAM_OW_PSD_APV_DT#
						,LEDG_APV_DT = #EXAM_LEDG_APV_DT#
						,FNL_USR_ID = #FNL_USR_ID#
	  					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
	  					,FNL_MNU_ID = #FNL_MNU_ID#
	  					,FNL_MDF_DH = SYSDATE
	  		WHEN NOT MATCHED THEN
	  			INSERT	(	REQ_DVSN_CD
	  					,	ACP_YR
	  					,	CVPT_ACP_NO
	  					,	APV_DOC_DVSN_CD
	  					,	APV_VLE_PEN_DVSN_CD
	  					,	DVCHF_APV_DT
	  					,	LDR_APV_DT
	  					,	HQ_CHIF_APV_DT
	  					,	OW_PSD_APV_DT
	  					,	LEDG_APV_DT
	  					,	FRT_USR_ID
	  					,	FNL_USR_ID
	  					,	FNL_DEAL_DPT_CD
	  					,	FNL_MNU_ID
	  					,	FRT_REGI_DH
	  					,	FNL_MDF_DH
	  					)
	  			VALUES	(	#REQ_DVSN_CD#
	  					,	#ACP_YR#
	  					,	#CVPT_ACP_NO#
	  					,	'3'
	  					,	#APV_VLE_PEN_DVSN_CD#
	  					,	#EXAM_DVCHF_APV_DT#
	  					,	#EXAM_LDR_APV_DT#
	  					,	#EXAM_HQ_CHIF_APV_DT#
	  					,	#EXAM_OW_PSD_APV_DT#
	  					,	#EXAM_LEDG_APV_DT#
	  					,	#FNL_USR_ID#
	  					,	#FNL_USR_ID#
	  					,	#FNL_DEAL_DPT_CD#
	  					,	#FNL_MNU_ID#
	  					,	SYSDATE
	  					,	SYSDATE
	  					)
	  	]]>
	</update>	
</sqlMap> 
