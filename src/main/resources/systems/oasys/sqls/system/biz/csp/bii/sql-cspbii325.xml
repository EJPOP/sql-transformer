<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/bii/325">

	<!-- 기본정보 조회 -->   
	<select id="CSPBII325QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.NAM
			      ,T1.EIN
			      ,F_ORG_INFO(T1.BLT_ORG_CD,'1') AS BLT_ORG_NM
			      ,T1.PST_NM || ' / ' || F_CODE_NM('1000173', T1.CLSS_CD) AS PST_RANK_NM
			      ,F_CODE_NM('1000908',T2.DBT_PSN_DVSN_CD) AS DBT_PSN_DVSN_NM
			      ,F_CODE_NM('1000909',T2.TYP_DVSN_CD) AS TYP_DVSN_NM
			      ,T2.BLT_ORG_NM AS BLT_ORG_NM2
			      ,T2.BLT_PST_NM
			      ,T2.SMM_TXT
			      ,T2.ASG_DT
			      ,'요약내용보기' AS SMM_TXT2
			      ,SUBSTR(T1.EIN,1,6)||'-*******' AS RRN
			      ,T2.CHGR_CNB
			      ,F_USR_INFO(T2.CHGR_CNB,'2') AS CHGR_NM
			  FROM TBCSPBII300M T1
			      ,TBCSPBII380M T2
			 WHERE T1.EIN = T2.EIN
		]]>
		
		<dynamic>
			<isNotEmpty property="strNam">
			   AND T1.NAM LIKE #strNam#||'%'
			</isNotEmpty>
			
			<isNotEmpty property="strEin">
			   AND T1.EIN LIKE #strEin# || '%'
			</isNotEmpty>
			
			<isNotEmpty property="strDBT_PSN_DVSN_CD">
			   AND T2.DBT_PSN_DVSN_CD = #strDBT_PSN_DVSN_CD#
			</isNotEmpty>
		</dynamic>
		<![CDATA[
          ORDER BY (CASE WHEN T2.DBT_PSN_DVSN_CD != '30' THEN 1
                         ELSE 2
                          END) ASC, T2.ASG_DT DESC		
		]]>
	</select>
	
</sqlMap> 
