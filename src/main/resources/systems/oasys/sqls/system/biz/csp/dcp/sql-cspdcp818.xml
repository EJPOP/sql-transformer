<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/818">
 	
 	<resultMap class="java.util.HashMap" id="CSPDCP818EMainSelect">
			<result property="STTM_DVSN_CD" 			 column="STTM_DVSN_CD" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_YR" 						 column="ACP_YR" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_ACP_NO" 			 column="STTM_ACP_NO" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_NO" 			 column="ACP_NO" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HMP_APL_NO" 				 column="HMP_APL_NO" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_KND_CD" 			 column="STTM_KND_CD" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_KND_DTL_CD" 	 column="STTM_KND_DTL_CD" 	     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_KND_DTL_NM" 	 column="STTM_KND_DTL_NM" 	     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="NAM" 							 column="NAM" 							     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EIN" 							 column="EIN" 							     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="JB_NM" 						 column="JB_NM" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="AD" 								 column="AD" 								     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="TNB" 							 column="TNB" 							     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EML_AD" 						 column="EML_AD" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="TIT_NM" 						 column="TIT_NM" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="DOC_ID" 						 column="DOC_ID" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_EXCU_TXT" 		 column="STTM_EXCU_TXT" 		     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_TXT_DH" 			 column="STTM_TXT_DH" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_PLC_NM" 			 column="STTM_PLC_NM" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_TXT" 					 column="STTM_TXT" 					     jdbcType="CLOB" javaType="java.lang.String" />
			<result property="RTRN_WAY_TXT" 			 column="RTRN_WAY_TXT" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RMK_TXT" 					 column="RMK_TXT" 					     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="OTR_ORG_NM" 				 column="OTR_ORG_NM" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="INSPC_AGR_YN" 			 column="INSPC_AGR_YN" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="OTR_INSPC_AGR_YN" 	 column="OTR_INSPC_AGR_YN" 	     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_DH" 						 column="ACP_DH" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_RUT_CD" 				 column="ACP_RUT_CD" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_STA_CD" 			 column="HNDL_STA_CD" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_STA_NM" 			 column="HNDL_STA_NM" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_DH" 					 column="HNDL_DH" 					     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ANS_TXT" 					 column="ANS_TXT" 					     jdbcType="CLOB" javaType="java.lang.String" />
			<result property="FRT_REGI_DH" 			 column="FRT_REGI_DH" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RES_NAM" 					 column="RES_NAM" 					     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RES_TNB" 					 column="RES_TNB" 					     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RES_JB_NM" 				 column="RES_JB_NM" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RES_AD" 						 column="RES_AD" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="CRP_NM" 						 column="CRP_NM" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="FRT_USR_ID" 				 column="FRT_USR_ID" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RM_STTM_ACP_NO" 				 column="RM_STTM_ACP_NO" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_DPT_CD" 				 column="ACP_DPT_CD" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_DPT_NM" 				 column="ACP_DPT_NM" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_PEN_CNB" 				 column="ACP_PEN_CNB" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_PEN_NAM" 				 column="ACP_PEN_NAM" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_DPT_CD" 				 column="HNDL_DPT_CD" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_CHGR_ID" 				 column="HNDL_CHGR_ID" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="DOC_YN" 				 column="DOC_YN" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_YN" 				 column="HNDL_YN" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ONR_APV_RQS_DH" 				 column="ONR_APV_RQS_DH" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ONR_APV_CMPT_DH" 				 column="ONR_APV_CMPT_DH" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ONR_DOC_MNG_CRD_ID" 				 column="ONR_DOC_MNG_CRD_ID" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			
	</resultMap>
 	<select id="CSPDCP818EMainSelect" parameterClass="paramMap" resultMap="CSPDCP818EMainSelect">
		<![CDATA[
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
					,T1.STTM_ACP_NO
					,DECODE(T1.RM_STTM_ACP_NO,NULL,NULL,T1.ACP_YR||'-'||'청금-'||T1.RM_STTM_ACP_NO) AS ACP_NO	
					,T1.HMP_APL_NO
					,T1.STTM_KND_CD
					,T1.STTM_KND_DTL_CD
					,F_CODE_NM('1000759',T1.STTM_KND_DTL_CD) AS STTM_KND_DTL_NM
					,T1.NAM
					,T1.EIN
					,T1.JB_NM
					,T1.AD
					,T1.TNB
					,T1.EML_AD
					,T1.TIT_NM
					,T1.DOC_ID
					,T1.STTM_EXCU_TXT
					,T1.STTM_TXT_DH
					,T1.STTM_PLC_NM
					,T1.STTM_TXT
					,T1.RTRN_WAY_TXT
					,T1.RMK_TXT
					,T1.OTR_ORG_NM
					,T1.INSPC_AGR_YN
					,T1.OTR_INSPC_AGR_YN
					,TO_CHAR(T1.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
					,T1.ACP_RUT_CD
					,T1.HNDL_STA_CD
					,F_CODE_NM('1000760',T1.HNDL_STA_CD) AS HNDL_STA_NM
					,T1.HNDL_DH 
					,T1.ANS_TXT
					,T1.FRT_REGI_DH
					,T2.RES_NAM
					,T2.RES_TNB
					,T2.RES_JB_NM
					,T2.RES_AD
					,T2.CRP_NM
					,T1.FRT_USR_ID
					,T1.RM_STTM_ACP_NO
					,T1.ACP_DPT_CD
					,F_DPT_INFO(ACP_DPT_CD,'1') AS ACP_DPT_NM
					,T1.ACP_PEN_CNB
					,F_USR_INFO(T1.ACP_PEN_CNB,'2') AS ACP_PEN_NAM
					,T3.HNDL_DPT_CD
   					,T3.HNDL_CHGR_ID
   					,CASE WHEN T4.ONR_DOC_MNG_CRD_ID IS NOT NULL THEN 'Y' ELSE 'N' END AS DOC_YN
   					,CASE WHEN  T4.OPM_APV_HNDL_STA_CD <> '30' OR T4.OPM_APV_HNDL_STA_CD IS NULL THEN '1'
   							WHEN T4.OPM_APV_HNDL_STA_CD = '30' THEN '2'
   							ELSE '3' END AS HNDL_YN
   					,TO_CHAR(T4.ONR_APV_RQS_DH,'YYYY-MM-DD HH24:MI') AS ONR_APV_RQS_DH
   					,TO_CHAR(T4.ONR_APV_CMPT_DH,'YYYY-MM-DD HH24:MI') AS ONR_APV_CMPT_DH
   					,T4.ONR_DOC_MNG_CRD_ID
			FROM	TBCSPDCP811M T1
					,TBCSPDCP812M T2
					,TBCSPDCP813M T3
					,TBCSPDCP818M T4
			WHERE	T1.STTM_DVSN_CD = T2.STTM_DVSN_CD
			AND		T1.ACP_YR = T2.ACP_YR
			AND		T1.STTM_ACP_NO = T2.STTM_ACP_NO
			AND		T1.STTM_DVSN_CD = #strSTTM_DVSN_CD# 
			AND		T1.ACP_YR = #strACP_YR#
			AND		T1.STTM_ACP_NO = #strSTTM_ACP_NO#
			AND		T1.STTM_DVSN_CD = T3.STTM_DVSN_CD
			AND		T1.ACP_YR = T3.ACP_YR
			AND		T1.STTM_ACP_NO = T3.STTM_ACP_NO
			AND		T1.STTM_DVSN_CD = T4.STTM_DVSN_CD(+)
			AND		T1.ACP_YR = T4.ACP_YR(+)
			AND		T1.STTM_ACP_NO = T4.STTM_ACP_NO(+)
			AND		T4.IFM_DVSN_CD(+) = '10'
		]]>
	</select>
	
	
	<select id="CSPDCP818EHndlSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[	
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
					,T1.STTM_ACP_NO
   					,T3.SRNO
   					,T3.HNDL_DVSN_CD
   					,T3.TRNF_DPT_CD
   					,T3.HNDL_DVSN_CD AS HNDL_DVSN_CD
   					,T3.DOC_ID AS HNDL_DOC_ID
   					,'첨부파일보기' AS DOC_NM
   			FROM	TBCSPDCP811M T1
   					, TBCSPDCP813M T2
   					,TBCSPDCP815L T3
   			WHERE	T1.STTM_DVSN_CD = T2.STTM_DVSN_CD
			AND		T1.ACP_YR = T2.ACP_YR
			AND		T1.STTM_ACP_NO = T2.STTM_ACP_NO
			AND		T1.STTM_DVSN_CD = #strSTTM_DVSN_CD# 
			AND		T1.ACP_YR = #strACP_YR# 
			AND		T1.STTM_ACP_NO = #strSTTM_ACP_NO#
			AND		T1.STTM_DVSN_CD = T3.STTM_DVSN_CD
			AND		T1.ACP_YR = T3.ACP_YR
			AND		T1.STTM_ACP_NO = T3.STTM_ACP_NO
   			ORDER BY T3.SRNO ASC
   		]]>
   	</select>
   	
   	<select id="CSPDCP818EHndlOrgSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
   					,T1.STTM_ACP_NO
   					,T1.HNDL_ORG_SRNO
   					,T1.SRNO
   					,T1.ORG_CD
   					,T1.PUB_DVSN_CD
   					,T1.COPT_SG_CD
   					,F_ORG_HRK_NM(T1.COPT_SG_CD) AS COPT_SG_NM
   					, F_ORG_INFO(T1.ORG_CD,'1') AS ORG_NM 
   			FROM	TBCSPDCP816L T1
   			WHERE	T1.STTM_DVSN_CD = #strSTTM_DVSN_CD#
   			AND		T1.ACP_YR = #strACP_YR#
   			AND		T1.STTM_ACP_NO = #strSTTM_ACP_NO#
   			AND		T1.SRNO = #strSRNO#
   		]]>
   	</select>
   	
	<select id="CSPDCP818ECheckSelect" parameterClass="paramMap"
		resultClass="integer">
		<![CDATA[
			SELECT	COUNT(*) AS CNT	/*진행상태*/
			FROM	TBCSPDCP811M
			WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		STTM_ACP_NO = #STTM_ACP_NO#
			AND		HNDL_STA_CD = #HNDL_STA_CD#
		]]>
	</select> 
	
	<update id="CSPDCP818EHNDL_STA_CDUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPDCP811M
			SET		HNDL_STA_CD = #HNDL_STA_CD#
			WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		STTM_ACP_NO = #STTM_ACP_NO#
		]]>
	</update>
	
	<update id="CSPDCP818E811Update" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPDCP811M
			SET		STTM_KND_CD = #STTM_KND_CD#
					,STTM_KND_DTL_CD = #STTM_KND_DTL_CD#
			WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		STTM_ACP_NO = #STTM_ACP_NO#
		]]>
	</update>
	
	<select id="CSPDCP818ETBCSPDCP815LKeySelect" parameterClass="paramMap" resultClass="Integer">
        <![CDATA[     	
			SELECT	NVL(MAX(SRNO),0)+1 AS SRNO
			FROM	TBCSPDCP815L A
			WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		STTM_ACP_NO = #STTM_ACP_NO#
		]]>
	</select>
	
	<insert id="CSPDCP818ETBCSPDCP815LInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	/*CSPDCP818ETBCSPDCP815LInsert*/ 
						TBCSPDCP815L
						(	STTM_DVSN_CD
        					,ACP_YR
        					,STTM_ACP_NO
        					,SRNO
        					,HNDL_DVSN_CD
        					,TRNF_DPT_CD
        					,DOC_ID
        					,DOC_TYP_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#STTM_DVSN_CD#
        					,#ACP_YR#
        					,#STTM_ACP_NO#
        					,#SRNO#
        					,#HNDL_DVSN_CD#
        					,#TRNF_DPT_CD#
        					,#HNDL_DOC_ID#
        					,null
        					,#FNL_USR_ID#
        					,#FNL_USR_ID#
        					,#FNL_DEAL_DPT_CD#
        					,#FNL_MNU_ID#
        					,SYSDATE
        					,SYSDATE
        				)
		]]>
	</insert>
	
	<insert id="CSPDCP818ETBCSPDCP816L6Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	TBCSPDCP816L
						(	STTM_DVSN_CD
        					,ACP_YR
        					,STTM_ACP_NO
        					,HNDL_ORG_SRNO
        					,SRNO
        					,ORG_CD
        					,PUB_DVSN_CD
        					,COPT_SG_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		VALUES	(	#STTM_DVSN_CD#
        					,#ACP_YR#
        					,#STTM_ACP_NO#
        					,(	SELECT	NVL(MAX(HNDL_ORG_SRNO),0)+1
        						FROM	TBCSPDCP816L
        						WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
        						AND		ACP_YR = #ACP_YR#
        						AND		STTM_ACP_NO = #STTM_ACP_NO#
        					)
        					,#SRNO#
        					,#ORG_CD#
        					,#PUB_DVSN_CD#
        					,#COPT_SG_CD#
        					,#FNL_USR_ID#
        					,#FNL_USR_ID#
        					,#FNL_DEAL_DPT_CD#
        					,#FNL_MNU_ID#
        					,SYSDATE
        					,SYSDATE
        				)
        						
		]]>
	</insert>
	
	<!-- 처리결과내역 수정 -->
	<update id="CSPDCP818ETBCSPDCP815LUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	/*CSPDCP818ETBCSPDCP815LUpdate*/ TBCSPDCP815L
			SET		HNDL_DVSN_CD = #HNDL_DVSN_CD#
					,TRNF_DPT_CD = #TRNF_DPT_CD#
					,DOC_ID = #HNDL_DOC_ID#
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		STTM_ACP_NO = #STTM_ACP_NO#
			AND		SRNO = #SRNO#
		]]>
	</update>
	
	<delete id="CSPDCP818ETBCSPDCP816LDelete" parameterClass="paramMap"> 
		<![CDATA[
			DELETE
			FROM	TBCSPDCP816L
			WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
		  	AND 	ACP_YR = #ACP_YR#
		    AND 	STTM_ACP_NO = #STTM_ACP_NO#
		    AND		HNDL_ORG_SRNO = #HNDL_ORG_SRNO#
		]]>
	</delete>
	
	<delete id="CSPDCP818ETBCSPDCP816LDeleteAll" parameterClass="paramMap"> 
		<![CDATA[
			DELETE
			FROM	TBCSPDCP816L
			WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
		  	AND 	ACP_YR = #ACP_YR#
		    AND 	STTM_ACP_NO = #STTM_ACP_NO#
		    AND		SRNO = #SRNO#
		]]>
	</delete>
	
	<delete id="CSPDCP818ETBCSPDCP815LDelete" parameterClass="paramMap"> 
		<![CDATA[
			DELETE	/*CSPDCP818ETBCSPDCP815LDelete*/
			FROM	TBCSPDCP815L
			WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
		  	AND 	ACP_YR = #ACP_YR#
		    AND 	STTM_ACP_NO = #STTM_ACP_NO#
		    AND		SRNO = #SRNO#
		]]>
	</delete>
	
	<resultMap class="java.util.HashMap" id="CSPDCP818EAnsSelect">
 		<result property="STTM_DVSN_CD" column="STTM_DVSN_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ACP_YR" column="ACP_YR"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="STTM_ACP_NO" column="STTM_ACP_NO"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="OPM_NTF_DVSN_CD" column="OPM_NTF_DVSN_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NTF_YN" column="NTF_YN"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="HNDL_STA_CD" column="HNDL_STA_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ANS_TXT" column="ANS_TXT"                   jdbcType="CLOB" javaType="java.lang.String" />
		<result property="OPM_APV_HNDL_STA_CD" column="OPM_APV_HNDL_STA_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="OPM_SRNO" column="OPM_SRNO"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ONR_DOC_MNG_CRD_ID" column="ONR_DOC_MNG_CRD_ID"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ONR_APV_CMPT_DH" column="ONR_APV_CMPT_DH"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TNB" column="TNB"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
 	</resultMap>
 	
	<select id="CSPDCP818EAnsSelect" parameterClass="paramMap" resultMap="CSPDCP818EAnsSelect">
		<![CDATA[
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
					,T1.STTM_ACP_NO
					,NVL(T1.OPM_NTF_DVSN_CD,'N') AS OPM_NTF_DVSN_CD
					,T1.OPM_NTF_DVSN_CD AS NTF_YN
					,T1.HNDL_STA_CD
					,T1.ANS_TXT
					,T3.OPM_APV_HNDL_STA_CD
					,T3.OPM_SRNO
					,T3.ONR_DOC_MNG_CRD_ID
					,TO_CHAR(T3.ONR_APV_CMPT_DH,'YYYY-MM-DD HH24:MI') AS ONR_APV_CMPT_DH
					,T1.TNB
			FROM	TBCSPDCP811M T1
					,TBCSPDCP813M T2
					,TBCSPDCP818M T3
			WHERE	T1.STTM_DVSN_CD = #strSTTM_DVSN_CD# 
			AND		T1.ACP_YR = #strACP_YR#
			AND		T1.STTM_ACP_NO = #strSTTM_ACP_NO#
			AND		T1.STTM_DVSN_CD = T2.STTM_DVSN_CD
			AND		T1.ACP_YR = T2.ACP_YR
			AND		T1.STTM_ACP_NO = T2.STTM_ACP_NO
			AND		T1.STTM_DVSN_CD = T3.STTM_DVSN_CD(+)
			AND		T1.ACP_YR = T3.ACP_YR(+)
			AND		T1.STTM_ACP_NO = T3.STTM_ACP_NO(+)
			AND		T3.IFM_DVSN_CD(+) = '20'
		]]>
	</select>
	
	<!-- 처리결과 답변 탭 저장시 처리구분, 통보확인코드,처리결과답변 내용 저장  -->
	<update id="CSPDCP818EAnsUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	/*CSPDCP818EAnsUpdate*/ TBCSPDCP811M
			SET		OPM_NTF_DVSN_CD = #OPM_NTF_DVSN_CD#
					,ANS_TXT = #ANS_TXT#
			WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		STTM_ACP_NO = #STTM_ACP_NO#
		]]>
	</update>
	
	<resultMap class="java.util.HashMap" id="CSPDCP818ETBCSPDCP818MOnnaraSelect">
 		<result property="STTM_DVSN_CD" column="STTM_DVSN_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ACP_YR" column="ACP_YR"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="STTM_ACP_NO" column="STTM_ACP_NO"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ACP_NO" column="ACP_NO"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NAM" column="NAM"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AD" column="AD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="OPM_SRNO" column="OPM_SRNO"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ANS_TXT" column="ANS_TXT"                   jdbcType="CLOB" javaType="java.lang.String" />
		<result property="ONR_DOC_MNG_CRD_ID" column="ONR_DOC_MNG_CRD_ID"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="IFM_DVSN_CD" column="IFM_DVSN_CD"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TITLE" column="TITLE"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TNB" column="TNB"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="RECEIVER" column="RECEIVER"                   jdbcType="VARCHAR2" javaType="java.lang.String" />
 	</resultMap>
 	
	<select id="CSPDCP818ETBCSPDCP818MOnnaraSelect" parameterClass="paramMap" resultMap="CSPDCP818ETBCSPDCP818MOnnaraSelect">
        <![CDATA[     	
			SELECT	T1.STTM_DVSN_CD
					, T1.ACP_YR
					, T1.STTM_ACP_NO
					, T1.ACP_YR||'-청금-'||T1.RM_STTM_ACP_NO AS ACP_NO
					, T1.NAM
					, T1.AD
					, T2.OPM_SRNO
					, T1.ANS_TXT
					, T2.ONR_DOC_MNG_CRD_ID
					, NVL(T2.IFM_DVSN_CD,#strIFM_DVSN_CD#) AS IFM_DVSN_CD
					, F_CODE_NM('1000765',NVL(T2.IFM_DVSN_CD,#strIFM_DVSN_CD#))||' (제'||T1.ACP_YR||'-청금-'||T1.RM_STTM_ACP_NO||'호)' AS TITLE
					, T1.TIT_NM
					, T1.TNB
					, T1.NAM || ' 귀하 '||T1.AD AS RECEIVER
			FROM	TBCSPDCP811M T1
					, TBCSPDCP818M T2
			WHERE	1=1
			AND		T1.STTM_DVSN_CD = #strSTTM_DVSN_CD#
			AND		T1.ACP_YR = #strACP_YR#
			AND		T1.STTM_ACP_NO = #strSTTM_ACP_NO#
			AND		T1.STTM_DVSN_CD = T2.STTM_DVSN_CD(+)
			AND		T1.ACP_YR = T2.ACP_YR(+)
			AND		T1.STTM_ACP_NO = T2.STTM_ACP_NO(+)
			AND		T2.IFM_DVSN_CD(+) = #strIFM_DVSN_CD#
		]]>
	</select>
	
	<!-- 시행문 작성 온나라결재 -->
	<insert id="CSPDCP818ETBCSPDCP818MOnnaraMerge" parameterClass="paramMap">
        <![CDATA[
        	MERGE INTO 	TBCSPDCP818M A
        	USING 	(	SELECT 	#STTM_DVSN_CD# AS STTM_DVSN_CD 
        						,#ACP_YR# AS ACP_YR
        						,#STTM_ACP_NO# AS STTM_ACP_NO
        						,#OPM_SRNO# AS OPM_SRNO
        				FROM DUAL
        			) B
        	ON		(	A.STTM_DVSN_CD = B.STTM_DVSN_CD
        				AND	A.ACP_YR = B.ACP_YR
        				AND A.STTM_ACP_NO = B.STTM_ACP_NO
        				AND A.OPM_SRNO = B.OPM_SRNO
        			)
        	WHEN MATCHED THEN
        			UPDATE	
        			SET		ONR_DOC_MNG_CRD_ID = #ONR_DOC_MNG_CRD_ID#
        					,ADMN_INF_HNDL_NO = #ADMN_INF_HNDL_NO#
        					,FNL_USR_ID = #FNL_USR_ID#
        					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
        					,FNL_MNU_ID = #FNL_MNU_ID#
        					,FNL_MDF_DH = SYSDATE
        	WHEN NOT MATCHED THEN
		        	INSERT 		(	STTM_DVSN_CD
		        					,ACP_YR
		        					,STTM_ACP_NO
		        					,OPM_SRNO
		        					,IFM_DVSN_CD
		        					,OPM_APV_HNDL_STA_CD
		        					,ADMN_INF_HNDL_NO
		        					,ONR_DOC_MNG_CRD_ID
		        					,FRT_USR_ID
		        					,FNL_USR_ID
		        					,FNL_DEAL_DPT_CD
		        					,FNL_MNU_ID
		        					,FRT_REGI_DH
		        					,FNL_MDF_DH
		        				)
		        		VALUES	(	#STTM_DVSN_CD#
									,#ACP_YR#
									,#STTM_ACP_NO#
		        					,(SELECT 	NVL(MAX(TO_NUMBER(OPM_SRNO)),0)+1
										FROM 	TBCSPDCP818M
										WHERE 	STTM_DVSN_CD = #STTM_DVSN_CD#
										AND		ACP_YR = #ACP_YR#
										AND		STTM_ACP_NO = #STTM_ACP_NO#)
		        					,#IFM_DVSN_CD#
		        					,'10'
		        					,#ADMN_INF_HNDL_NO#
		        					,#ONR_DOC_MNG_CRD_ID#
									,#FRT_USR_ID#
									,#FNL_USR_ID#
									,#FNL_DEAL_DPT_CD#
									,#FNL_MNU_ID#
									,SYSDATE
									,SYSDATE
								)
        ]]>
	</insert>
	
	<update id="CSPDCP818ETBCSPDCP813MNtfUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	/*CSPDCP818ETBCSPDCP813MNtfUpdate*/ TBCSPDCP813M D1
			SET		FNL_HNDL_DH = SYSDATE
			WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		STTM_ACP_NO = #STTM_ACP_NO#
		]]>
	</update>
	
	<select id="CSPDCP818ESucSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	B.STTM_DVSN_CD
					,B.ACP_YR
   					,B.STTM_ACP_NO
   					,A.RM_STTM_ACP_NO
   					,A.ACP_YR||'-청금-'||A.RM_STTM_ACP_NO AS ACP_NO
   					,TO_CHAR(A.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
   					,A.TIT_NM
   					,A.NAM
   					,B.SUC_STTM_DVSN_CD
   					,B.SUC_ACP_YR
   					,B.SUC_STTM_ACP_NO
   					,A.HNDL_STA_CD
   					,F_CODE_NM('1000758',A.STTM_KND_CD) AS STTM_KND_NM
   					,F_CODE_NM('1000759',A.STTM_KND_DTL_CD) AS STTM_KND_DTL_NM
   			FROM	TBCSPDCP811M A, TBCSPDCP819L B
   			WHERE	B.STTM_DVSN_CD = #strSTTM_DVSN_CD#
   			AND		B.ACP_YR = #strACP_YR#
   			AND		B.STTM_ACP_NO = #strSTTM_ACP_NO#
   			AND		B.SUC_STTM_DVSN_CD = A.STTM_DVSN_CD
   			AND		B.SUC_ACP_YR = A.ACP_YR
   			AND		B.SUC_STTM_ACP_NO = A.STTM_ACP_NO
   		]]>
   	</select>
   	
   	<insert id="CSPDCP818E815SucInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	/*CSPDCP818E815SucInsert*/
						TBCSPDCP815L
						(	STTM_DVSN_CD
        					,ACP_YR
        					,STTM_ACP_NO
        					,SRNO
        					,HNDL_DVSN_CD
        					,TRNF_DPT_CD
        					,DOC_ID
        					,DOC_TYP_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        		SELECT	SUC_STTM_DVSN_CD
	        			,SUC_ACP_YR
	        			,SUC_STTM_ACP_NO
       					,#SRNO#
       					,#HNDL_DVSN_CD#
       					,#TRNF_DPT_CD#
       					,#HNDL_DOC_ID#
       					,NULL
       					,#FNL_USR_ID#
       					,#FNL_USR_ID#
       					,#FNL_DEAL_DPT_CD#
       					,#FNL_MNU_ID#
       					,SYSDATE
       					,SYSDATE
        		FROM	TBCSPDCP819L
        		WHERE	(STTM_DVSN_CD,ACP_YR,STTM_ACP_NO) IN ( 	SELECT	#STTM_DVSN_CD#,#ACP_YR#,#STTM_ACP_NO# 
        														FROM 	DUAL )
		]]>
	</insert>
	
	<insert id="CSPDCP818ETBCSPDCP816LSucInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	/*CSPDCP818ETBCSPDCP816LSucInsert*/
						TBCSPDCP816L
						(	STTM_DVSN_CD
        					,ACP_YR
        					,STTM_ACP_NO
        					,HNDL_ORG_SRNO
        					,SRNO
        					,ORG_CD
        					,PUB_DVSN_CD
        					,COPT_SG_CD
        					,FRT_USR_ID
        					,FNL_USR_ID
        					,FNL_DEAL_DPT_CD
        					,FNL_MNU_ID
        					,FRT_REGI_DH
        					,FNL_MDF_DH
        				)
        	SELECT	SUC_STTM_DVSN_CD
        			,SUC_ACP_YR
        			,SUC_STTM_ACP_NO
        			,(	SELECT	NVL(MAX(HNDL_ORG_SRNO),0)+1
        						FROM	TBCSPDCP816L
        						WHERE	STTM_DVSN_CD = SUC_STTM_DVSN_CD
        						AND		ACP_YR = SUC_ACP_YR
        						AND		STTM_ACP_NO = SUC_STTM_ACP_NO
        			)
        			,#SRNO#
  					,#ORG_CD#
  					,#PUB_DVSN_CD#
  					,#COPT_SG_CD#
  					,#FNL_USR_ID#
  					,#FNL_USR_ID#
  					,#FNL_DEAL_DPT_CD#
  					,#FNL_MNU_ID#
  					,SYSDATE
  					,SYSDATE
        	FROM	TBCSPDCP819L
        	WHERE	(STTM_DVSN_CD,ACP_YR,STTM_ACP_NO) IN ( 	SELECT	#STTM_DVSN_CD#,#ACP_YR#,#STTM_ACP_NO# 
        													FROM 	DUAL )
		]]>
	</insert>
	
	<update id="CSPDCP818ETBCSPDCP815LSucUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	/*CSPDCP818ETBCSPDCP815LSucUpdate*/ TBCSPDCP815L
			SET		HNDL_DVSN_CD = #HNDL_DVSN_CD#
					,TRNF_DPT_CD = #TRNF_DPT_CD#
					,DOC_ID = #HNDL_DOC_ID#
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	(STTM_DVSN_CD, ACP_YR, STTM_ACP_NO ) IN (SELECT	SUC_STTM_DVSN_CD
																	,SUC_ACP_YR
																	,SUC_STTM_ACP_NO
															FROM	TBCSPDCP819L
															WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
															AND		ACP_YR = #ACP_YR#
															AND		STTM_ACP_NO = #STTM_ACP_NO#
															)
			AND		SRNO = #SRNO#
		]]>
	</update>
	
	<delete id="CSPDCP818ETBCSPDCP816LSucDelete" parameterClass="paramMap"> 
		<![CDATA[
			DELETE
			FROM	TBCSPDCP816L
			WHERE	(STTM_DVSN_CD, ACP_YR, STTM_ACP_NO ) IN (SELECT	SUC_STTM_DVSN_CD
																	,SUC_ACP_YR
																	,SUC_STTM_ACP_NO
															FROM	TBCSPDCP819L
															WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
															AND		ACP_YR = #ACP_YR#
															AND		STTM_ACP_NO = #STTM_ACP_NO#
															)
		    AND		HNDL_ORG_SRNO = #HNDL_ORG_SRNO#
		]]>
	</delete>
	
	<delete id="CSPDCP818ETBCSPDCP816LDeleteAllSuc" parameterClass="paramMap"> 
		<![CDATA[
			DELETE
			FROM	TBCSPDCP816L
			WHERE	(STTM_DVSN_CD, ACP_YR, STTM_ACP_NO ) IN (SELECT	SUC_STTM_DVSN_CD
																	,SUC_ACP_YR
																	,SUC_STTM_ACP_NO
															FROM	TBCSPDCP819L
															WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
															AND		ACP_YR = #ACP_YR#
															AND		STTM_ACP_NO = #STTM_ACP_NO#
															)
		    AND		SRNO = #SRNO#
		]]>
	</delete>
	
	<delete id="CSPDCP818ETBCSPDCP815LDeleteSuc" parameterClass="paramMap"> 
		<![CDATA[
			DELETE	/*CSPDCP818ETBCSPDCP815LDeleteSuc*/
			FROM	TBCSPDCP815L
			WHERE	(STTM_DVSN_CD, ACP_YR, STTM_ACP_NO ) IN (SELECT	SUC_STTM_DVSN_CD
																	,SUC_ACP_YR
																	,SUC_STTM_ACP_NO
															FROM	TBCSPDCP819L
															WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
															AND		ACP_YR = #ACP_YR#
															AND		STTM_ACP_NO = #STTM_ACP_NO#
															)
		    AND		SRNO = #SRNO#
		]]>
	</delete>
	
	<update id="CSPDCP818EAnsSucUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	/*CSPDCP818EAnsSucUpdate*/ TBCSPDCP811M
			SET		OPM_NTF_DVSN_CD = #OPM_NTF_DVSN_CD#
					,ANS_TXT = #ANS_TXT#
			WHERE	(STTM_DVSN_CD,ACP_YR,STTM_ACP_NO) IN (	SELECT	SUC_STTM_DVSN_CD, SUC_ACP_YR, SUC_STTM_ACP_NO
															FROM	TBCSPDCP819L
															WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
															AND		ACP_YR = #ACP_YR#
															AND		STTM_ACP_NO = #STTM_ACP_NO#
														)
		]]>
	</update>
	
	<update id="CSPDCP818EHNDL_STA_CDSucUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPDCP811M
			SET		HNDL_STA_CD = #HNDL_STA_CD#
			WHERE	(STTM_DVSN_CD,ACP_YR,STTM_ACP_NO) IN (	SELECT	SUC_STTM_DVSN_CD, SUC_ACP_YR, SUC_STTM_ACP_NO
															FROM	TBCSPDCP819L
															WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
															AND		ACP_YR = #ACP_YR#
															AND		STTM_ACP_NO = #STTM_ACP_NO#
														)
		]]>
	</update>
	
	<update id="CSPDCP818ETBCSPDCP813MNtfSucUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	/*CSPDCP818ETBCSPDCP813MNtfSucUpdate*/ TBCSPDCP813M D1
			SET		FNL_HNDL_DH = SYSDATE
			WHERE	(STTM_DVSN_CD,ACP_YR,STTM_ACP_NO) IN (	SELECT	SUC_STTM_DVSN_CD, SUC_ACP_YR, SUC_STTM_ACP_NO
															FROM	TBCSPDCP819L
															WHERE	STTM_DVSN_CD = #STTM_DVSN_CD#
															AND		ACP_YR = #ACP_YR#
															AND		STTM_ACP_NO = #STTM_ACP_NO#
														)
		]]>
	</update>
	
	
	<select id="CSPDCP818SelectSucSmsList" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.STTM_DVSN_CD, T1.ACP_YR, T1.STTM_ACP_NO, T1.TNB
			  FROM TBCSPDCP811M T1, TBCSPDCP819L T2
			 WHERE T1.STTM_DVSN_CD = T2.SUC_STTM_DVSN_CD
			   AND T1.ACP_YR = T2.SUC_ACP_YR
			   AND T1.STTM_ACP_NO = T2.SUC_STTM_ACP_NO
			   AND T2.STTM_DVSN_CD = #STTM_DVSN_CD#
			   AND T2.ACP_YR = #ACP_YR#
			   AND T2.STTM_ACP_NO = #STTM_ACP_NO#
			   AND T1.TNB IS NOT NULL 
		]]>
	</select>
	
</sqlMap> 

