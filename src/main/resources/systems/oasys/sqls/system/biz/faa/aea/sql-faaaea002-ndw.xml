<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/aea/002-ndw">
	
	<select id="FAAAEA002EDetailAmRequestListselect" parameterClass="paramMap"	resultClass="resultMap">
			 SELECT CASE WHEN D1.requestDate IS NOT NULL THEN SUBSTRING(D1.requestDate,0,4)||'.'||SUBSTRING(D1.requestDate,5,2)||'.'||SUBSTRING(D1.requestDate,7,2) ELSE '' END AS requestDate
					,D1.requestuserName
					,D2.responsedeptName
					,D1.requestTitle
					,CASE WHEN D2.responseDate IS NOT NULL THEN SUBSTRING(D2.responseDate,0,4)||'.'||SUBSTRING(D2.responseDate,5,2)||'.'||SUBSTRING(D2.responseDate,7,2) ELSE '' END AS responseDate1
					,D2.responseuserName
					,CASE WHEN D2.responseDate IS NOT NULL THEN SUBSTRING(D2.responseDate,0,4)||'.'||SUBSTRING(D2.responseDate,5,2)||'.'||SUBSTRING(D2.responseDate,7,2) ELSE '' END AS responseDate2
					,CASE WHEN D1.shareYN = 'A' THEN '전체'
					      WHEN D1.shareYN = 'D' THEN '부서'
					      WHEN D1.shareYN = 'P' THEN '개인'
					      ELSE '' END AS shareNm
					,CASE WHEN D2.acceptStatCd = '1' THEN '미접수' 
					      WHEN D2.acceptStatCd = '0' THEN '접수' 
					      ELSE '' END AS acceptStatNm
			   FROM ebaiusr.AM_ONNARA_REQUEST D1
         INNER JOIN ebaiusr.AM_ONNARA_RESPONSE D2
				 ON D1.requestId = D2.requestId
				AND D2.cancelYn = 'N'
			  WHERE 1=1
		<isEqual property="strDetailChkYn" compareValue="Y">
			<isEqual property="strOrgDep" compareValue="N">
			    AND SUBSTRING(D1.responseBaiOrgId,0,3) = #strDetailOrgCd#
			</isEqual>
			<isEqual property="strOrgDep" compareValue="Y">
			    AND SUBSTRING(D1.responseBaiOrgId,0,6) = #strDetailOrgCd#
			</isEqual>
		</isEqual>
		<isEqual property="strDetailChkYn" compareValue="">
			<isEqual property="strOrgDep" compareValue="N">
			    AND D1.responseBaiOrgId = #strDetailOrgCd#||'000000000'
			</isEqual>
			<isEqual property="strOrgDep" compareValue="Y">
			    AND D1.responseBaiOrgId = #strDetailOrgCd#||'000000'
			</isEqual>
		</isEqual>
		<isNotEmpty property="strRequestSDate">	  
			  <![CDATA[AND LEFT(D1.requestDate,8) >= #strRequestSDate#]]>
		</isNotEmpty>
		<isNotEmpty property="strRequestEDate">
			  <![CDATA[AND LEFT(D1.requestDate,8) <= #strRequestEDate#]]>
		</isNotEmpty>
		   ORDER BY D1.requestDate DESC
	</select>

	<select id="FAAAEA002EDetailCount16select" parameterClass="paramMap"	resultClass="resultMap">
			 SELECT '제출받은자료('||COUNT(1)||')' AS COUNT16
			   FROM ebaiusr.AM_ONNARA_REQUEST D1
         INNER JOIN ebaiusr.AM_ONNARA_RESPONSE D2
				 ON D1.requestId = D2.requestId
				AND D2.cancelYn = 'N'
			  WHERE 1=1
		<isEqual property="strExistOrg" compareValue="Y">
			<isEqual property="strOrgDep" compareValue="N">
			    AND SUBSTRING(D1.responseBaiOrgId,0,3) = #strCoptSgCd#
			</isEqual>
			<isEqual property="strOrgDep" compareValue="Y">
			    AND SUBSTRING(D1.responseBaiOrgId,0,6) = #strCoptSgCd#
			</isEqual>
		</isEqual>
		<isEqual property="strExistOrg" compareValue="N">
			<isEqual property="strOrgDep" compareValue="N">
			    AND D1.responseBaiOrgId = #strCoptSgCd#||'000000000'
			</isEqual>
			<isEqual property="strOrgDep" compareValue="Y">
			    AND D1.responseBaiOrgId = #strCoptSgCd#||'000000'
			</isEqual>
		</isEqual>
	</select>
	
</sqlMap> 
