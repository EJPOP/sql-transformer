<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="aep/gkm/021">
	<resultMap class="java.util.HashMap" id="hwpDocMap">
		<result property="KNB" column="KNB" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_NM" column="KLD_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_SMM_TXT" column="KLD_SMM_TXT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KYWD_NM" column="KYWD_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KYWD_NM_1" column="KYWD_NM_1" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KYWD_NM_2" column="KYWD_NM_2" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KYWD_NM_3" column="KYWD_NM_3" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGI_RQS_DT" column="REGI_RQS_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGI_RQS_DT_Q" column="REGI_RQS_DT_Q" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="PRSV_WAY_CD" column="PRSV_WAY_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="PRSV_WAY_NM" column="PRSV_WAY_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="PRSV_DDLN_DH" column="PRSV_DDLN_DH" jdbcType="TIMESTAMP" javaType="java.lang.String" />
		<result property="PRSV_WAY_DH" column="PRSV_WAY_DH" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_CAT_CD" column="KLD_CAT_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_CAT_NM" column="KLD_CAT_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_TXT" column="KLD_TXT" jdbcType="CLOB" javaType="java.lang.String" />
		<result property="KLD_TXT_REVOKE" column="KLD_TXT_REVOKE" jdbcType="CLOB" javaType="java.lang.String" />
		<result property="TG_ORG_CD" column="TG_ORG_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TG_ORG_NM" column="TG_ORG_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_YR" column="AUD_YR" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_NO" column="AUD_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DSP_RQ_SNO" column="DSP_RQ_SNO" jdbcType="NUMBER" javaType="java.lang.String" />
		<result property="FUNC_SPH_CD" column="FUNC_SPH_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="FUNC_SPH_NM" column="FUNC_SPH_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="CAT_SPH_CD" column="CAT_SPH_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="CAT_SPH_NM" column="CAT_SPH_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="SPH_NM" column="SPH_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DOC_ID" column="DOC_ID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGN_OPEN_YN" column="REGN_OPEN_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGN_OPEN_NM" column="REGN_OPEN_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_STA_CD" column="KLD_STA_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_STA_NM" column="KLD_STA_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="SRCH_CNT" column="SRCH_CNT" jdbcType="NUMBER" javaType="java.lang.String" />
		<result property="AUD_SBJ_NM" column="AUD_SBJ_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DSP_RQ_NM" column="DSP_RQ_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_SRC_NM" column="KLD_SRC_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_REGI_YR" column="KLD_REGI_YR" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="KLD_REGI_YR_Q" column="KLD_REGI_YR_Q" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="COUNT" column="COUNT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="COFM_YN" column="COFM_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="FILE_YN" column="FILE_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NOT_HWP_DOC_YN" column="NOT_HWP_DOC_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGN_CNB" column="REGN_CNB" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGN_NM" column="REGN_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TNB" column="TNB" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="EML_AD" column="EML_AD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REGN_DPT_NM" column="REGN_DPT_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NEW_KLD_CAT_NM" column="NEW_KLD_CAT_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NEW_CAT_SPH_NM" column="NEW_CAT_SPH_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>

	<select id="AEPGKM021Emainselect" parameterClass="paramMap" resultMap="hwpDocMap">
	<![CDATA[	
		SELECT  KNB	                                        							/* 지식번호 */
		        ,KLD_NM                                        							/* 지식명 */
		        ,KLD_SMM_TXT	                                    					/* 지식요약내용 */
		        ,KYWD_NM_1 ||
                (CASE
                    WHEN TRIM(KYWD_NM_1) IS NOT NULL AND TRIM(KYWD_NM_2) IS NOT NULL
                    THEN ' / ' || KYWD_NM_2
                END) ||
                (CASE
                    WHEN (TRIM(KYWD_NM_1) IS NOT NULL OR TRIM(KYWD_NM_2) IS NOT NULL) 
                    AND TRIM(KYWD_NM_3) IS NOT NULL
                    THEN ' / ' || KYWD_NM_3
                END) AS KYWD_NM															/* 키워드명조합 */
		        ,KYWD_NM_1							                					/* 키워드명1 */
		        ,KYWD_NM_2						                                        /* 키워드명2 */
		        ,KYWD_NM_3	                					                        /* 키워드명3 */
		        ,REGI_RQS_DT	                                					    /* 등록요청일 */
		        ,TO_CHAR(TO_DATE(REGI_RQS_DT), 'YYYY-MM-DD') AS REGI_RQS_DT_Q			/* 등록요청일 상세 */
		        ,PRSV_WAY_CD	                                    					/* 보존방법코드 */
		        ,F_CODE_NM('1000352', PRSV_WAY_CD) AS PRSV_WAY_NM   					/* 보존방법명 */
		        ,(CASE
		            WHEN PRSV_WAY_CD = '0'
		            THEN NULL
		            ELSE PRSV_DDLN_DH
		         END) AS PRSV_DDLN_DH	                            					/* 보존기한일시 */
		        ,F_CODE_NM('1000352', PRSV_WAY_CD) || '  ' ||
		        (CASE
		            WHEN PRSV_WAY_CD = '0'
		            THEN NULL
		            ELSE TO_CHAR(PRSV_DDLN_DH, 'YYYY-MM-DD')
		         END) AS PRSV_WAY_DH													/* 보존방법명/일시 */
		        ,KLD_CAT_CD	                                        					/* 지식분류코드 */
		        ,(SELECT    TG_CAT_NM                               
		          FROM      TBAEPGKM017M                            					/* 대상분류기본T */
		          WHERE     TG_CAT_ID = KLD_CAT_CD) AS KLD_CAT_NM   					/* 지식분류명 */
		        ,KLD_TXT	                                        					/* 지식내용 */
		        ,KLD_TXT AS KLD_TXT_REVOKE	                                        	/* 지식내용 - 초기화때 쓸 꺼 */
		        ,TG_ORG_CD	                                        					/* 대상기관코드 */
		        ,F_ORG_INFO(TG_ORG_CD, '1') AS TG_ORG_NM            					/* 대상기관명 */
		        ,AUD_YR	                                            					/* 감사년도 */
		        ,AUD_NO	                                            					/* 감사번호 */
		        ,DSP_RQ_SNO                                         					/* 처분요구순번 */
		        ,FUNC_SPH_CD                                        					/* 기능분야코드 */
		        ,CAT_SPH_CD                                         					/* 분류분야코드 */
		        ,F_CODE_NM('1000466', CAT_SPH_CD)
                 ||
                 (CASE
                    WHEN F_CODE_NM('1000466', CAT_SPH_CD) IS NOT NULL 
                    AND  F_CODE_NM('1000467', FUNC_SPH_CD) IS NOT NULL
                    THEN ' / '
                 END
                 )
                 ||
                 F_CODE_NM('1000467', FUNC_SPH_CD) AS SPH_NM							/* 분야명조합 */
		        ,F_CODE_NM('1000466', CAT_SPH_CD) AS CAT_SPH_NM							/* 기능분야명 */
		        ,F_CODE_NM('1000467', FUNC_SPH_CD) AS FUNC_SPH_NM   					/* 분류분야명 */
		        ,A.DOC_ID	                                            					/* 문서ID */
		        ,REGN_OPEN_YN	                                    					/* 등록자공개여부 */
		        ,(CASE
		            WHEN REGN_OPEN_YN = 'Y'
		            THEN '공개'
		            ELSE '비공개'
		        END) AS REGN_OPEN_NM                                					/* 등록자공개여부명 */
		        ,KLD_STA_CD	                                       						/* 지식상태코드 */
		        ,(CASE
		        	WHEN KLD_STA_CD = '7'
		        	THEN F_CODE_NM('1000351', KLD_STA_CD) || ' (' || TO_CHAR(EXPR_DH, 'YYYY-MM-DD') || ')'
		        	WHEN KLD_STA_CD = '8'
		        	THEN F_CODE_NM('1000351', KLD_STA_CD) || ' (' || TO_CHAR(ABRG_DH, 'YYYY-MM-DD') || ')'
		        	ELSE F_CODE_NM('1000351', KLD_STA_CD)
		       	END) AS KLD_STA_NM     													/* 지식상태명 */
		        ,SRCH_CNT	                                        					/* 조회수 */
		        ,AUD_SBJ_NM	                                        					/* 감사사항명 */
		        ,DSP_RQ_NM	                                        					/* 처분요구명 */
		        ,KLD_SRC_NM	                                        					/* 지식출처명 */
		        ,KLD_REGI_YR	                                    					/* 지식등록년도 */
		        ,KLD_REGI_YR || ' 년도' AS KLD_REGI_YR_Q								/* 지식등록년도[텍스트] */
		        ,(
				SELECT COUNT(*)
				  FROM (
				        SELECT KNB
				          FROM TBAEPGKM002L
				         WHERE KNB = #KNB#
				         UNION ALL
				        SELECT KNB
				          FROM TBAEPGKM004L
				         WHERE KNB = #KNB#
						)
				
		        ) AS COUNT
		        ,NVL((
				SELECT	MAX(COFM_YN)
				FROM	TBAEPGKM016L
				WHERE	KNB = A.KNB
				), 'N') AS COFM_YN
				, CASE WHEN A.DOC_ID IS NOT NULL THEN (SELECT DECODE(COUNT(*), 0, 'N', 'Y') FROM UBKERAPP.XR_PAGE WHERE DOC_ID = A.DOC_ID ) ELSE 'N' END AS FILE_YN
				, CASE WHEN A.DOC_ID IS NOT NULL THEN (SELECT DECODE(COUNT(*), 0, 'N', 'Y') FROM UBKERAPP.XR_PAGE WHERE DOC_ID = A.DOC_ID AND PAGE_TITLE IS NOT NULL AND SUBSTR(PAGE_TITLE, CASE WHEN INSTR(PAGE_TITLE, '.',-1) > 0 THEN INSTR(PAGE_TITLE, '.',-1)+1 ELSE 1 END) != 'hwp')
		             ELSE 'N' END AS NOT_HWP_DOC_YN
		   , REGN_CNB /*등록자 전산번호*/
	       , F_USR_INFO(REGN_CNB, '2') AS REGN_NM /*등록자명*/
	       , B.TNB /*내선번호*/
	       , B.EML_AD /*이메일*/
	       , A.REGN_DPT_NM /*등록자 소속명*/
	       , F_CODE_NM('1000836', NEW_KLD_CAT_CD ) AS NEW_KLD_CAT_NM
       	   , F_CODE_NM('1000837', NEW_CAT_SPH_CD ) AS NEW_CAT_SPH_NM
		FROM  TBAEPGKM001M A
		    , TBDCMACM001M B
        WHERE A.REGN_CNB = B.CNB (+)
		]]>
		<isNotEmpty property="KNB">
			  AND A.KNB = #KNB#
		</isNotEmpty>
		<isNotEmpty property="AUD_YR">
			  AND A.AUD_YR = #AUD_YR#
		</isNotEmpty>
		<isNotEmpty property="AUD_NO">
			  AND A.AUD_NO = #AUD_NO#
		</isNotEmpty>
		<isNotEmpty property="DSP_RQ_SNO">
			  AND A.DSP_RQ_SNO = #DSP_RQ_SNO#
		</isNotEmpty>		
	</select>
	
	<select id="AEPGKM021Emainselect1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
	      SELECT CASE WHEN (
	              SELECT COUNT(DPT_CD) 
	                FROM TABLE(F_AUTH_DEPT(#strCnb#, 'DEPTLW', '', '')) AS IS_YN
	               WHERE 1=1
	                 AND DPT_CD = #SPV_BRDV_CD# 
	              ) >0 THEN 'Y' ELSE 'N' END AS IS_YN 
	        FROM DUAL
    	]]> 
    </select>  
	
	<update id="AEPGKM021Edrinupdate" parameterClass="java.util.Map">
		UPDATE	TBAEPGKM001M
		SET		SRCH_CNT = (SELECT NVL(SRCH_CNT, 0) + 1 FROM TBAEPGKM001M WHERE KNB = #KNB#)
		WHERE	KNB = #KNB#
	</update>
	
	<insert id="AEPGKM021Emaininsert" parameterClass="java.util.Map">
		DECLARE
			BEGIN
			INSERT INTO TBAEPGKM001M (
				KNB	/* 지식번호 */
				,KLD_NM	/* 지식명 */
				,KLD_SMM_TXT	/* 지식요약내용 */
				,KYWD_NM_1	/* 키워드명1 */
				,KYWD_NM_2	/* 키워드명2 */
				,KYWD_NM_3	/* 키워드명3 */
				,REGI_RQS_DT	/* 등록요청일 */
				,PRSV_WAY_CD	/* 보존방법코드 */
				,PRSV_DDLN_DH	/* 보존기한일시 */
				,KLD_CAT_CD	/* 지식분류코드 */
				,KLD_TXT	/* 지식내용 */
				,TG_ORG_CD	/* 대상기관코드 */
				,AUD_YR	/* 감사년도 */
				,AUD_NO	/* 감사번호 */
				,DSP_RQ_SNO	/* 처분요구순번 */
				,FUNC_SPH_CD	/* 기능분야코드 */
				,CAT_SPH_CD	/* 분류분야코드 */
				,DOC_ID	/* 문서ID */
				,DOC_TYP_CD	/* 문서유형코드 */
				,REGN_OPEN_YN	/* 등록자공개여부 */
				,KLD_STA_CD	/* 지식상태코드 */
				,SRCH_CNT	/* 조회수 */
				,EXPR_DH	/* 만기일시 */
				,ABRG_DH	/* 폐기일시 */
				,RSTR_DH	/* 복구일시 */
				,ABRG_RSN	/* 폐기사유 */
				,REGN_CNB	/* 등록자전산번호 */
				,REGN_DPT_CD	/* 등록자부서코드 */
				,REGN_DPT_NM	/* 등록자부서명 */
				,MTRL_CD	/* 자료코드 */
				,ORI_SEAT_NM	/* 원서위치명 */
				,AUD_KND_CD	/* 감사종류코드 */
				,AUD_SBJ_NM	/* 감사사항명 */
				,DSP_RQ_NM	/* 처분요구명 */
				,KLD_SRC_NM	/* 지식출처명 */
				,KLD_REGI_YR	/* 지식등록년도 */
				,FRT_USR_ID	/* 최초사용자ID */
				,FNL_USR_ID	/* 최종사용자ID */
				,FNL_DEAL_DPT_CD	/* 최종거래부서코드 */
				,FNL_MNU_ID	/* 최종메뉴ID */
				,FRT_REGI_DH	/* 최초등록일시 */
				,FNL_MDF_DH	/* 최종수정일시 */
				,NEW_KLD_CAT_CD
				,NEW_CAT_SPH_CD
			)
			VALUES (
				#KNB#
				,'['|| #KLD_CAT_NM# || ']' || #KLD_NM#
				,#KLD_SMM_TXT#
				,#KYWD_NM_1#
				,#KYWD_NM_2#
				,#KYWD_NM_3#
				,TO_CHAR(SYSDATE, 'YYYYMMDD')
				,#PRSV_WAY_CD#
				,#PRSV_DDLN_DH#
				,#KLD_CAT_CD#
				,#KLD_TXT#
				,#TG_ORG_CD#
				,#AUD_YR#
				,#AUD_NO#
				,#DSP_RQ_SNO#
				,#FUNC_SPH_CD#
				,#CAT_SPH_CD#
				,#DOC_ID#
				,'지식'
				,#REGN_OPEN_YN#
				,#KLD_STA_CD#
				,'0'
				,''
				,''
				,''
				,''
				,#REGN_CNB#
				,#REGN_DPT_CD#
				,#REGN_DPT_NM#
				,'6'
				,''
				,#AUD_KND_CD#
				,#AUD_SBJ_NM#
				,#DSP_RQ_NM#
				,#KLD_SRC_NM#
				,#KLD_REGI_YR#
				,#FRT_USR_ID#
				,#FNL_USR_ID#
				,#FNL_DEAL_DPT_CD#
				,#FNL_MNU_ID#
				,SYSDATE
				,SYSDATE
				,NEW_KLD_CAT_CD
				,NEW_CAT_SPH_CD
			);
			INSERT INTO TBAEPGKM018H
					(
					HST_DVSN_CD	/* 이력구분코드 */
					,HST_SNO	/* 이력순번 */
					,HST_DH	/* 이력일시 */
					,KNB	/* 지식번호 */
					,KLD_NM	/* 지식명 */
					,KLD_SMM_TXT	/* 지식요약내용 */
					,KYWD_NM_1	/* 키워드명1 */
					,KYWD_NM_2	/* 키워드명2 */
					,KYWD_NM_3	/* 키워드명3 */
					,REGI_RQS_DT	/* 등록요청일 */
					,PRSV_WAY_CD	/* 보존방법코드 */
					,PRSV_DDLN_DH	/* 보존기한일시 */
					,KLD_CAT_CD	/* 지식분류코드 */
					,KLD_TXT	/* 지식내용 */
					,TG_ORG_CD	/* 대상기관코드 */
					,AUD_YR	/* 감사년도 */
					,AUD_NO	/* 감사번호 */
					,DSP_RQ_SNO	/* 처분요구순번 */
					,FUNC_SPH_CD	/* 기능분야코드 */
					,CAT_SPH_CD	/* 분류분야코드 */
					,DOC_ID	/* 문서ID */
					,DOC_TYP_CD	/* 문서유형코드 */
					,REGN_OPEN_YN	/* 등록자공개여부 */
					,KLD_STA_CD	/* 지식상태코드 */
					,SRCH_CNT	/* 조회수 */
					,EXPR_DH	/* 만기일시 */
					,ABRG_DH	/* 폐기일시 */
					,RSTR_DH	/* 복구일시 */
					,ABRG_RSN	/* 폐기사유 */
					,REGN_CNB	/* 등록자전산번호 */
					,REGN_DPT_CD	/* 등록자부서코드 */
					,REGN_DPT_NM	/* 등록자부서명 */
					,MTRL_CD	/* 자료코드 */
					,ORI_SEAT_NM	/* 원서위치명 */
					,AUD_KND_CD	/* 감사종류코드 */
					,AUD_SBJ_NM	/* 감사사항명 */
					,KLD_SRC_NM	/* 지식출처명 */
					,KLD_REGI_YR	/* 지식등록년도 */
					,DSP_RQ_NM	/* 처분요구명 */
					,FRT_USR_ID	/* 최초사용자ID */
					,FNL_USR_ID	/* 최종사용자ID */
					,FNL_DEAL_DPT_CD	/* 최종거래부서코드 */
					,FNL_MNU_ID /* 최종메뉴ID */
					,FRT_REGI_DH /* 최초등록일시 */
					,FNL_MDF_DH /* 최종수정일시 */
					,CM_PROCESS_STATUS
					,NEW_KLD_CAT_CD
					,NEW_CAT_SPH_CD
					)
			SELECT	'C' AS HST_DVSN_CD
					,(SELECT NVL(MAX(HST_SNO), 0) + 1 FROM TBAEPGKM018H WHERE HST_DH = SYSDATE) AS HST_SNO
					,SYSDATE AS HST_DH
					,KNB
					,KLD_NM
					,KLD_SMM_TXT
					,KYWD_NM_1
					,KYWD_NM_2
					,KYWD_NM_3
					,REGI_RQS_DT
					,PRSV_WAY_CD
					,PRSV_DDLN_DH
					,KLD_CAT_CD
					,KLD_TXT
					,TG_ORG_CD
					,AUD_YR
					,AUD_NO
					,DSP_RQ_SNO
					,FUNC_SPH_CD
					,CAT_SPH_CD
					,DOC_ID
					,DOC_TYP_CD
					,REGN_OPEN_YN
					,KLD_STA_CD
					,SRCH_CNT
					,EXPR_DH
					,ABRG_DH
					,RSTR_DH
					,ABRG_RSN
					,REGN_CNB
					,REGN_DPT_CD
					,REGN_DPT_NM
					,MTRL_CD
					,ORI_SEAT_NM
					,AUD_KND_CD
					,AUD_SBJ_NM
					,KLD_SRC_NM
					,KLD_REGI_YR
					,DSP_RQ_NM
					,FRT_USR_ID
					,FNL_USR_ID
					,FNL_DEAL_DPT_CD
					,FNL_MNU_ID
					,FRT_REGI_DH
					,FNL_MDF_DH
					,CM_PROCESS_STATUS
					,NEW_KLD_CAT_CD
					,NEW_CAT_SPH_CD
			FROM	TBAEPGKM001M AS A
			WHERE	KNB = #KNB#;
		END;
	</insert>
	
	<delete id="AEPGKM021Emaindelete" parameterClass="java.util.Map">
		DECLARE
			BEGIN
				INSERT INTO TBAEPGKM018H
					(
					HST_DVSN_CD	/* 이력구분코드 */
					,HST_SNO	/* 이력순번 */
					,HST_DH	/* 이력일시 */
					,KNB	/* 지식번호 */
					,KLD_NM	/* 지식명 */
					,KLD_SMM_TXT	/* 지식요약내용 */
					,KYWD_NM_1	/* 키워드명1 */
					,KYWD_NM_2	/* 키워드명2 */
					,KYWD_NM_3	/* 키워드명3 */
					,REGI_RQS_DT	/* 등록요청일 */
					,PRSV_WAY_CD	/* 보존방법코드 */
					,PRSV_DDLN_DH	/* 보존기한일시 */
					,KLD_CAT_CD	/* 지식분류코드 */
					,KLD_TXT	/* 지식내용 */
					,TG_ORG_CD	/* 대상기관코드 */
					,AUD_YR	/* 감사년도 */
					,AUD_NO	/* 감사번호 */
					,DSP_RQ_SNO	/* 처분요구순번 */
					,FUNC_SPH_CD	/* 기능분야코드 */
					,CAT_SPH_CD	/* 분류분야코드 */
					,DOC_ID	/* 문서ID */
					,DOC_TYP_CD	/* 문서유형코드 */
					,REGN_OPEN_YN	/* 등록자공개여부 */
					,KLD_STA_CD	/* 지식상태코드 */
					,SRCH_CNT	/* 조회수 */
					,EXPR_DH	/* 만기일시 */
					,ABRG_DH	/* 폐기일시 */
					,RSTR_DH	/* 복구일시 */
					,ABRG_RSN	/* 폐기사유 */
					,REGN_CNB	/* 등록자전산번호 */
					,REGN_DPT_CD	/* 등록자부서코드 */
					,REGN_DPT_NM	/* 등록자부서명 */
					,MTRL_CD	/* 자료코드 */
					,ORI_SEAT_NM	/* 원서위치명 */
					,AUD_KND_CD	/* 감사종류코드 */
					,AUD_SBJ_NM	/* 감사사항명 */
					,KLD_SRC_NM	/* 지식출처명 */
					,KLD_REGI_YR	/* 지식등록년도 */
					,DSP_RQ_NM	/* 처분요구명 */
					,FRT_USR_ID	/* 최초사용자ID */
					,FNL_USR_ID	/* 최종사용자ID */
					,FNL_DEAL_DPT_CD	/* 최종거래부서코드 */
					,FNL_MNU_ID /* 최종메뉴ID */
					,FRT_REGI_DH /* 최초등록일시 */
					,FNL_MDF_DH /* 최종수정일시 */
					,CM_PROCESS_STATUS /*공감상태코드*/
					,NEW_KLD_CAT_CD
					,NEW_CAT_SPH_CD
					)
				SELECT	'D' AS HST_DVSN_CD
						,(SELECT NVL(MAX(HST_SNO), 0) + 1 FROM TBAEPGKM018H WHERE HST_DH = SYSDATE) AS HST_SNO
						,SYSDATE AS HST_DH
						,KNB
						,KLD_NM
						,KLD_SMM_TXT
						,KYWD_NM_1
						,KYWD_NM_2
						,KYWD_NM_3
						,REGI_RQS_DT
						,PRSV_WAY_CD
						,PRSV_DDLN_DH
						,KLD_CAT_CD
						,KLD_TXT
						,TG_ORG_CD
						,AUD_YR
						,AUD_NO
						,DSP_RQ_SNO
						,FUNC_SPH_CD
						,CAT_SPH_CD
						,DOC_ID
						,DOC_TYP_CD
						,REGN_OPEN_YN
						,KLD_STA_CD
						,SRCH_CNT
						,EXPR_DH
						,ABRG_DH
						,RSTR_DH
						,ABRG_RSN
						,REGN_CNB
						,REGN_DPT_CD
						,REGN_DPT_NM
						,MTRL_CD
						,ORI_SEAT_NM
						,AUD_KND_CD
						,AUD_SBJ_NM
						,KLD_SRC_NM
						,KLD_REGI_YR
						,DSP_RQ_NM
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
						,CM_PROCESS_STATUS
						,NEW_KLD_CAT_CD
						,NEW_CAT_SPH_CD
				FROM	TBAEPGKM001M AS A
				WHERE	KNB = #KNB#;
				DELETE FROM TBAEPGKM001M
				WHERE KNB = #KNB#;
		END;
	</delete>
	
	<update id="AEPGKM021Emainupdate" parameterClass="java.util.Map">
		DECLARE
			BEGIN
				UPDATE	TBAEPGKM001M
				SET		KLD_NM			= #KLD_NM#,
						KLD_SMM_TXT		= #KLD_SMM_TXT#,
						KYWD_NM_1		= #KYWD_NM_1#,
						KYWD_NM_2		= #KYWD_NM_2#,
						KYWD_NM_3		= #KYWD_NM_3#,
						PRSV_WAY_CD		= #PRSV_WAY_CD#,
						PRSV_DDLN_DH	= #PRSV_DDLN_DH#,
						KLD_CAT_CD		= #KLD_CAT_CD#,
						KLD_TXT			= #KLD_TXT#,
						TG_ORG_CD		= #TG_ORG_CD#,
						AUD_YR			= #AUD_YR#,
						AUD_NO			= #AUD_NO#,
						DSP_RQ_SNO		= #DSP_RQ_SNO#,
						FUNC_SPH_CD		= #FUNC_SPH_CD#,
						CAT_SPH_CD		= #CAT_SPH_CD#,
						DOC_ID			= #DOC_ID#,
						DOC_TYP_CD		= #DOC_TYP_CD#,
						REGN_OPEN_YN	= #REGN_OPEN_YN#,
						KLD_STA_CD		= #KLD_STA_CD#,
						AUD_KND_CD		= #AUD_KND_CD#,
						AUD_SBJ_NM		= #AUD_SBJ_NM#,
						DSP_RQ_NM		= #DSP_RQ_NM#,
						KLD_SRC_NM		= #KLD_SRC_NM#, 
						KLD_REGI_YR		= #KLD_REGI_YR#,
						FNL_USR_ID		= #FNL_USR_ID#,
						FNL_DEAL_DPT_CD	= #FNL_DEAL_DPT_CD#,
						FNL_MNU_ID		= #FNL_MNU_ID#,
						FNL_MDF_DH		= SYSDATE,
						NEW_KLD_CAT_CD	= #NEW_KLD_CAT_CD#,
						NEW_CAT_SPH_CD	= #NEW_CAT_SPH_CD#
				WHERE	KNB				= #KNB#;
				INSERT INTO TBAEPGKM018H
					(
					HST_DVSN_CD	/* 이력구분코드 */
					,HST_SNO	/* 이력순번 */
					,HST_DH	/* 이력일시 */
					,KNB	/* 지식번호 */
					,KLD_NM	/* 지식명 */
					,KLD_SMM_TXT	/* 지식요약내용 */
					,KYWD_NM_1	/* 키워드명1 */
					,KYWD_NM_2	/* 키워드명2 */
					,KYWD_NM_3	/* 키워드명3 */
					,REGI_RQS_DT	/* 등록요청일 */
					,PRSV_WAY_CD	/* 보존방법코드 */
					,PRSV_DDLN_DH	/* 보존기한일시 */
					,KLD_CAT_CD	/* 지식분류코드 */
					,KLD_TXT	/* 지식내용 */
					,TG_ORG_CD	/* 대상기관코드 */
					,AUD_YR	/* 감사년도 */
					,AUD_NO	/* 감사번호 */
					,DSP_RQ_SNO	/* 처분요구순번 */
					,FUNC_SPH_CD	/* 기능분야코드 */
					,CAT_SPH_CD	/* 분류분야코드 */
					,DOC_ID	/* 문서ID */
					,DOC_TYP_CD	/* 문서유형코드 */
					,REGN_OPEN_YN	/* 등록자공개여부 */
					,KLD_STA_CD	/* 지식상태코드 */
					,SRCH_CNT	/* 조회수 */
					,EXPR_DH	/* 만기일시 */
					,ABRG_DH	/* 폐기일시 */
					,RSTR_DH	/* 복구일시 */
					,ABRG_RSN	/* 폐기사유 */
					,REGN_CNB	/* 등록자전산번호 */
					,REGN_DPT_CD	/* 등록자부서코드 */
					,REGN_DPT_NM	/* 등록자부서명 */
					,MTRL_CD	/* 자료코드 */
					,ORI_SEAT_NM	/* 원서위치명 */
					,AUD_KND_CD	/* 감사종류코드 */
					,AUD_SBJ_NM	/* 감사사항명 */
					,KLD_SRC_NM	/* 지식출처명 */
					,KLD_REGI_YR	/* 지식등록년도 */
					,DSP_RQ_NM	/* 처분요구명 */
					,FRT_USR_ID	/* 최초사용자ID */
					,FNL_USR_ID	/* 최종사용자ID */
					,FNL_DEAL_DPT_CD	/* 최종거래부서코드 */
					,FNL_MNU_ID /* 최종메뉴ID */
					,FRT_REGI_DH /* 최초등록일시 */
					,FNL_MDF_DH /* 최종수정일시 */
					,CM_PROCESS_STATUS /*공감상태코드*/
					,NEW_KLD_CAT_CD
					,NEW_CAT_SPH_CD
					)
				SELECT	'U' AS HST_DVSN_CD
						,(SELECT NVL(MAX(HST_SNO), 0) + 1 FROM TBAEPGKM018H WHERE HST_DH = SYSDATE) AS HST_SNO
						,SYSDATE AS HST_DH
						,KNB
						,KLD_NM
						,KLD_SMM_TXT
						,KYWD_NM_1
						,KYWD_NM_2
						,KYWD_NM_3
						,REGI_RQS_DT
						,PRSV_WAY_CD
						,PRSV_DDLN_DH
						,KLD_CAT_CD
						,KLD_TXT
						,TG_ORG_CD
						,AUD_YR
						,AUD_NO
						,DSP_RQ_SNO
						,FUNC_SPH_CD
						,CAT_SPH_CD
						,DOC_ID
						,DOC_TYP_CD
						,REGN_OPEN_YN
						,KLD_STA_CD
						,SRCH_CNT
						,EXPR_DH
						,ABRG_DH
						,RSTR_DH
						,ABRG_RSN
						,REGN_CNB
						,REGN_DPT_CD
						,REGN_DPT_NM
						,MTRL_CD
						,ORI_SEAT_NM
						,AUD_KND_CD
						,AUD_SBJ_NM
						,KLD_SRC_NM
						,KLD_REGI_YR
						,DSP_RQ_NM
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
						,CM_PROCESS_STATUS
						,NEW_KLD_CAT_CD
						,NEW_CAT_SPH_CD
				FROM	TBAEPGKM001M AS A
				WHERE	KNB = #KNB#;
		END;
	</update>
	
	<select id="AEPGKM021Eknbselect" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT	NVL(MAX(TO_NUMBER(KNB)), '0') + 1 AS KNB
		FROM	TBAEPGKM001M;
	</select>
	
	
	<update id="AEPGKM021Estatusupdate" parameterClass="java.util.Map">
		UPDATE	TBAEPGKM001M
		SET		KLD_STA_CD		= #KLD_STA_CD#,
				<isEqual property="KLD_STA_CD" compareValue="7">
				EXPR_DH			= SYSDATE,
				</isEqual>
				<isEqual property="KLD_STA_CD" compareValue="8">
				ABRG_DH			= SYSDATE,
				</isEqual>
				<isEqual property="KLD_STA_CD" compareValue="6">
				RSTR_DH			= SYSDATE,
				</isEqual>
				FNL_USR_ID		= #FNL_USR_ID#,
				FNL_DEAL_DPT_CD	= #FNL_DEAL_DPT_CD#,
				FNL_MNU_ID		= #FNL_MNU_ID#,
				FNL_MDF_DH		= SYSDATE
		WHERE	KNB = #KNB#
	</update>
	
	
	<select id="AepGkmCmnCodeSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
            SELECT  CMM_CD_DVSN_CD
			      , CD
			      , CD_NM
			      , CD_NM||'('||CD||')' AS CDNM_CD	      
			      , '['||CD||']'||CD_NM AS CD_CD_NM
			  FROM TBDCMACM013C
			 WHERE 1=1 
			   AND CD <> '000000000'
		       AND CMM_CD_DVSN_CD =#strCdDvsn#
		       AND CD LIKE '%000' 
		      ]]>
		      </select>
		      
	<!-- 해당지식의 댓글을 조회한다. -->
	<select id="AEPGKM021Esubselect" parameterClass="java.util.Map" resultClass="java.util.HashMap">
            SELECT D2.BOARD_ID
                 , D2.POST_SEQ
                 , D2.CMMT_SEQ
                 , D2.CONTENT                                 /*내용*/
                 , SUBSTR(D2.CRE_DT, 1, 4) || '.' || SUBSTR(D2.CRE_DT, 5, 2) || '.' || SUBSTR(D2.CRE_DT, 7, 2) AS CRE_DT /*등록일*/  
                 , D2.CRE_USER_NAME                           /*등록자*/
                 , D2.CRE_USER_ID /*등록자ID*/      
                 , '삭제' AS BTNDEL
              FROM CTT_POST D1       /*게시판*/
                 , CTT_POST_CMMT D2  /*댓글*/
             WHERE D1.BOARD_ID = D2.BOARD_ID
               AND D1.POST_SEQ = D2.POST_SEQ
               AND D1.BOARD_ID = '1550' /*고정값*/
               AND D1.POST_SEQ = #strKnb#
             ORDER BY TO_NUMBER(D2.CRE_DT) DESC
	</select>
	
	<!-- 신규건일 경우 가라 게시글이있는지 체크한다. -->
	<select id="AEPGKM021ECmmtCntselect" parameterClass="java.util.Map" resultClass="java.util.HashMap">
            SELECT TO_CHAR(COUNT(*)) AS CNT
              FROM CTT_POST          /*게시판*/
             WHERE BOARD_ID = '1550' /*고정값*/
               AND POST_SEQ = #strKnb#
	</select>
	
	<!--  신규건일 경우 가라 게시글이 없을 경우 가라게시글 만들어 줘야한다. -->
	<insert id="AEPGKM021EPostinsert" parameterClass="java.util.Map">
		INSERT 
		  INTO CTT_POST
	    	 ( 
	            BOARD_ID
	          , POST_SEQ
	          , POST_GROUP
	          , REPLY_LEVEL
	          , REPLY_SORT
	          , NOTICE_YN
	          , PERIOD_NOTICE_YN
	          , TITLE
	          , DEL_YN
	          , CRE_DT
	          , CRE_USER_ID
	          , CRE_USER_NAME
	          , CRE_USER_DEPT_CD
	          , CRE_USER_DEPT_NAME
	          , VISIT_CNT
	          , GOOD_CNT
	          , NO_GOOD_CNT
	          , SECRET_YN
              , ALLOW_CMMT_YN
	          , LAST_UPDATE
	          , FILE_CNT
	          , CMMT_CNT
	          , SPAM_YN
		 	 )
		VALUES	
		     (
		        '1550'
		      , #strKnb#
		      , #strKnb#
		      , 0
		      , '00'
		      , 'N'
		      , 'N'
		      , #strKnbNm#
		      , 'N'
		      , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
		      , #CRE_USER_ID#
		      , #CRE_USER_NAME#
		      , #CRE_USER_DEPT_CD#
		      , #CRE_USER_DEPT_NAME#
		      , 0
		      , 0
		      , 0
		      , 'N'
		      , 'N'
		      , SYSDATE
		      , 0
		      , 0
		      , 'N'
		     )
	</insert>
	
	<!-- 댓글을 등록한다. -->
	<insert id="AEPGKM021ECmmtinsert" parameterClass="java.util.Map">
		INSERT 
		  INTO CTT_POST_CMMT
	    	 ( 
				  BOARD_ID
				, POST_SEQ
				, CMMT_SEQ
				, CONTENT
				, DEL_YN
				, CRE_DT
				, CRE_USER_ID
				, CRE_USER_NAME
				, CRE_USER_DEPT_CD
				, CRE_USER_DEPT_NAME
				, SPAM_YN
		 	 )
		VALUES	
		     (
		          '1550'
		        , #strKnb#
		        , (SELECT NVL(MAX(CMMT_SEQ), 0) + 1 FROM CTT_POST_CMMT WHERE BOARD_ID = '1550' AND POST_SEQ = #strKnb#)
		        , #strContent#
		        , 'N'
		        , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
		        , #CRE_USER_ID#
		      	, #CRE_USER_NAME#
		      	, #CRE_USER_DEPT_CD#
		      	, #CRE_USER_DEPT_NAME#
		        , 'N'
		     )
	</insert>
	
	<!-- 댓글 삭제 -->
	<delete id="AEPGKM021ECmmtdelete" parameterClass="java.util.Map">
		DELETE 
		  FROM CTT_POST_CMMT
		 WHERE BOARD_ID = '1550'
		   AND POST_SEQ = #strKnb#
		   AND CMMT_SEQ = #strCmmtSeq#
	</delete>
</sqlMap>