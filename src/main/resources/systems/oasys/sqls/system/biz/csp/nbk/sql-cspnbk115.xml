<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="csp/nbk/115">
	
	<select id="CSPNBK115PMouiListSelect" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT	/* CSPNBK115PMouiListSelect */
				D1.MOUI_DVSN_CD
				, DECODE( D1.MOUI_DVSN_CD, '0', '개인', '1', '단체' ) AS MOUI_DVSN_CD_NM
				, D1.MOUI_NO
				, DECODE( D1.MOUI_DVSN_CD, '0', D2.USR_NAM, '1', D1.OGNZ_NM  ) AS MOUI_NM
				, D2.USR_NAM
				, D1.CNB
				, SUBSTR(D2.EIN, 1, 6) || '-*******' AS EIN
				, D3.DPT_NM
				, TO_CHAR(SYSDATE, 'YYYYMMDD') AS CUR_DT
				, F_CODE_NM( '1000176', D2.PST_CD ) AS PST_CD_NM
				, F_CODE_NM( '1000173', D2.RANK_CD ) AS RANK_CD_NM
				, D4.INV_BL
		FROM	TBCSPNBK001M D1
				, TBDCMACM001M D2
				, TBDCMACM002M D3
				, TBCSPNBK101M D4
		WHERE	D1.CNB = D2.CNB
		AND		D2.DPT_CD = D3.DPT_CD
		AND		D1.MOUI_NO = D4.MOUI_NO(+)
	]]>
		<isNotEmpty property="mouiDvsnCd" prepend="AND">
				D1.MOUI_DVSN_CD = #mouiDvsnCd#
		</isNotEmpty>
		<isNotEmpty property="schKeyword" prepend="AND">
				(
					(D1.MOUI_NO = #schKeyword#)
					OR ( (D2.USR_NAM LIKE #schKeyword# || '%') OR (D1.OGNZ_NM LIKE #schKeyword# || '%' ) )
					OR ( D1.CNB = #schKeyword# )
				)
		</isNotEmpty>
		<isNotEmpty property="cnb" prepend="AND">
				D1.CNB = #cnb#
		</isNotEmpty>
		<isNotEmpty property="scsYn" prepend="AND">
				D1.SCS_YN = #scsYn#
		</isNotEmpty>
		<isEqual property="retiredYn" compareValue="Y" prepend="AND" >
				D3.DPT_CD = '880880'
		</isEqual>
		<isEqual property="retiredYn" compareValue="N" prepend="AND" >
				D3.DPT_CD != '880880'
		</isEqual>
	<![CDATA[
		ORDER BY MOUI_NO
	]]>
	</select>
</sqlMap>