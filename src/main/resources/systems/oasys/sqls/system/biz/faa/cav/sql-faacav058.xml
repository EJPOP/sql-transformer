<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/cav/058"> 
	 
	<!--QA 게시판 상세 리스트 조회-->
	<select id="FAACAV058EMainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/058/FAACAV058EMainselect */ ]]>
		<include refid="include.pageSelct" />		
        <![CDATA[       
			SELECT ROWNUM AS KEY,
				   GRP_NO,
			       RPL_SNO,
			       LVL_CNT,
			       TO_CHAR(TXT) AS TXT,
			       TIT_NM,
			       SRCH_CNT,
			       REGN_NM,
			       BRD_DVSN_CD,
			       RMK,
			       REGN_ID,
			       DECODE(DOC_ID, NULL, '', 'Y') AS DOC_YN,
			       DOC_ID,
			       REGI_DH,
			       SRNO,
			       TNB,
			       REGI_ORG_NM
			  FROM TWFAACAV065L 
              WHERE 1 = 1
              AND TO_CHAR(REGI_DH,'YYYYMMDD') BETWEEN #strSrchFrom# AND #strSrchTo#
              AND  BRD_DVSN_CD = #strBrdDvsnCd#
		]]>
        <isNotEmpty property="strSrno">	 	   
			   AND SRNO     = #strSrno#
		</isNotEmpty>	
		
		<isNotEmpty property="strSrchNm">
			<isEqual property="strSrchDvsnCd" compareValue="0">
			   AND  (TIT_NM like '%'||UPPER(#strSrchNm#)||'%' OR TXT like '%'||UPPER(#strSrchNm#)||'%')
			</isEqual>		
			<isEqual property="strSrchDvsnCd" compareValue="1">
			   AND  TIT_NM like '%'||UPPER(#strSrchNm#)||'%'
			</isEqual>
			<isEqual property="strSrchDvsnCd" compareValue="2">
			   AND  TXT like '%'||UPPER(#strSrchNm#)||'%'
			</isEqual>			
		</isNotEmpty>
			<include refid="include.pageOrder" />		
 			ORDER BY GRP_NO DESC, SRNO ASC
	</select>

	<!--QA 게시판 상세 데이터 조회-->
	<select id="FAACAV058EDetailselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/058/FAACAV058EDetailselect */ ]]>
        <![CDATA[       
			SELECT  ROWNUM AS KEY,
			        BRD_DVSN_CD,
			        SRNO,
			        GRP_NO,
			        RPL_SNO,
			        LVL_CNT,
			        TIT_NM,
			        REGI_DH,
			        REGI_ORG_NM,
			        REGN_ID,
			        REGN_NM,
			        SRCH_CNT,
			        TO_CHAR(TXT) AS TXT,
			        DOC_ID,
			        DECODE(DOC_ID, NULL, '', 'Y') AS DOC_YN,
			        TNB
			FROM    TWFAACAV065L
			WHERE   BRD_DVSN_CD =  #strBrdDvsnCd#
		]]>
        <isNotEmpty property="strSrno">	 	   
			AND		SRNO	= #strSrno#
		</isNotEmpty>		
			ORDER BY GRP_NO DESC, SRNO ASC
	</select>
	
	<!-- QA조회수 구하기 -->
	<select id="FAACAV058ESrchCntSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/058/FAACAV058ESrchCntSelect */ ]]>
        <![CDATA[     	
			SELECT	TO_CHAR(NVL(TO_NUMBER(SRCH_CNT),0)+1) AS CNT
			FROM	TWFAACAV065L
			WHERE	BRD_DVSN_CD = #strBrdDvsnCd#
			AND		SRNO        = #strSrno# 
		]]>
	</select>
	
	<!--QA게시판 insert-->
	<insert id="FAACAV058EMaininsert" parameterClass="paramMap">
		<![CDATA[  /* faa/cav/058/FAACAV058EMaininsert */ ]]>
		INSERT INTO TWFAACAV065L
		(
			 BRD_DVSN_CD
			,SRNO
			,GRP_NO
			,RPL_SNO
			,LVL_CNT
			,TIT_NM
			,REGI_DH
			,REGI_ORG_NM
			,REGN_ID
			,REGN_NM
			,SRCH_CNT
			,TXT
			,DOC_ID
			,TNB
			,RMK
			,FRT_REGI_DH
			,FRT_USR_ID
			,FNL_MDF_DH
			,FNL_USR_ID
			,FNL_DEAL_DPT_CD
			,FNL_MNU_ID						
		) VALUES (
			 #BRD_DVSN_CD#
			,#SRNO#
			,#GRP_NO#
			,#RPL_SNO#
			,#LVL_CNT#
			,#TIT_NM#
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,#REGI_ORG_NM#
			,#REGN_ID#
			,#REGN_NM#
			,0
			,#TXT#
			,#DOC_ID#
			,#TNB#
			,''
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,'ADMIN'
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,#FNL_USR_ID#
			,#FNL_DEAL_DPT_CD#
			,'ADMIN'
		)
	</insert>	

	<!--QA게시판 update-->
	<update id="FAACAV058EMainUpdate" parameterClass="paramMap">
		<![CDATA[  /* faa/cav/058/FAACAV058EMainUpdate */ ]]>
		<![CDATA[ 	
			UPDATE  TWFAACAV065L
			SET     REGN_NM     = #REGN_NM#,
			        REGI_ORG_NM = #REGI_ORG_NM#,
			        TNB         = #TNB#,
			        TIT_NM      = #TIT_NM#,
			        TXT         = #TXT#,
			        DOC_ID		= #DOC_ID#
			WHERE   SRNO        = #SRNO#
			AND		BRD_DVSN_CD = #BRD_DVSN_CD#
		]]>	
	</update>
	
	<!--QA게시판 insert-->
	<insert id="FAACAV058EMainReply" parameterClass="paramMap">
		<![CDATA[  /* faa/cav/058/FAACAV058EMainReply */ ]]>
		INSERT INTO TWFAACAV065L
		(
			 BRD_DVSN_CD
			,SRNO
			,GRP_NO
			,RPL_SNO
			,LVL_CNT
			,TIT_NM
			,REGI_DH
			,REGI_ORG_NM
			,REGN_ID
			,REGN_NM
			,SRCH_CNT
			,TXT
			,DOC_ID
			,TNB
			,RMK
			,FRT_REGI_DH
			,FRT_USR_ID
			,FNL_MDF_DH
			,FNL_USR_ID
			,FNL_DEAL_DPT_CD
			,FNL_MNU_ID						
		) VALUES (
			 #BRD_DVSN_CD#
			,#SRNO#
			,#GRP_NO#
			,#RPL_SNO#
			,#LVL_CNT#
			,#TIT_NM#
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,#REGI_ORG_NM#
			,#REGN_ID#
			,#REGN_NM#
			,0
			,#TXT#
			,#DOC_ID#
			,#TNB#
			,''
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,'ADMIN'
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,#FNL_USR_ID#
			,#FNL_DEAL_DPT_CD#
			,'ADMIN'					
		)
	</insert>
	
	<!--홈페이지 QA 게시판 delete-->
	<update id="FAACAV058EMainDelete" parameterClass="paramMap">
		<![CDATA[  /* faa/cav/058/FAACAV058EMainDelete */ ]]>
			DELETE	FROM TWFAACAV065L
			WHERE	1=1
			AND		BRD_DVSN_CD	= #BRD_DVSN_CD#
		    AND		SRNO		= #SRNO# 
	</update>
	
	<update id="FAACAV058EMainDeleteAll" parameterClass="paramMap">
		<![CDATA[  /* faa/cav/058/FAACAV058EMainDeleteAll */ ]]>
			DELETE	FROM TWFAACAV065L
			WHERE	1=1
			AND		BRD_DVSN_CD	= #BRD_DVSN_CD#
		    AND		GRP_NO		= #GRP_NO# 
	</update>
	
	
	<!--QA조회수 update-->
	<update id="FAACAV058EMainSrchCntUpdate" parameterClass="paramMap">
		<![CDATA[  /* faa/cav/058/FAACAV058EMainSrchCntUpdate */ ]]>
		<![CDATA[ 	
			UPDATE TWFAACAV065L
			   SET SRCH_CNT = #SRCH_CNT# 
			 WHERE 1=1
			   AND BRD_DVSN_CD = #strBrdDvsnCd#
		       AND SRNO = #strSrno#
		]]>
	</update>
	
	<!--QA 게시판 상세 데이터 조회-->
	<select id="FAACAV058ESrnoCntselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/058/FAACAV058ESrnoCntselect */ ]]>
        <![CDATA[       
			SELECT MAX(SRNO) AS SRNO
			  FROM TWFAACAV065L 
              WHERE 1 = 1
              AND  BRD_DVSN_CD = #strBrdDvsnCd#
		]]>
	</select>
	
	<insert id="FAACAV058E_ENAIS_BOARD_Insert" parameterClass="paramMap">
		<![CDATA[  /* faa/cav/056/FAACAV056E_ENAIS_BOARD_Insert */ ]]>
		<![CDATA[
			INSERT INTO EN_ENAIS_BOARD
			(
				IF_SEQ
	            ,BRD_DVSN_CD
				,SRNO
				,GRP_NO
				,RPL_SNO
				,LVL_CNT
				,TIT_NM
				,REGI_DH
				,REGI_ORG_NM
				,REGN_ID
				,REGN_NM
				,SRCH_CNT
				,TXT
				,DOC_ID
				,TNB
				,RMK
				,FRT_REGI_DH
				,FRT_USR_ID
				,FNL_MDF_DH
				,FNL_USR_ID
				,FNL_DEAL_DPT_CD
				,FNL_MNU_ID
	            ,ATCH_FILE_ID
	            ,FILE_PATH
	            ,FILE_NAME
	            ,S_FILE_NAME
	            ,FILE_SIZE
	            ,FLAG
	            ,IF_STATUS
	            ,IF_TRY
	            ,IF_RAISE_DT
	            ,IF_DEAL_DT
	            ,IF_MESSG
	            ,IF_SIID
			) VALUES (
	            #IF_SEQ#
				,#BRD_DVSN_CD#
				,#SRNO#
				,#GRP_NO#
				,#RPL_SNO#
				,#LVL_CNT#
				,#TIT_NM#
				,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
				,#REGI_ORG_NM#
				,#REGN_ID#
				,#REGN_NM#
				,0
				,#TXT#
				,#DOC_ID#
				,#TNB#
				,''
				,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
				,#REGN_ID#
				,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
				,#FNL_USR_ID#
				,#FNL_DEAL_DPT_CD#
				,#REGN_ID#
				,#ATCH_FILE_ID#
	            ,#FILE_PATH#
	            ,#FILE_NAME#
	            ,#S_FILE_NAME#
	            ,#FILE_SIZE#
	            ,#FLAG#
	            ,'SS'
	            ,0
	            ,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
	            ,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
	            ,''
	            ,''
			)
		]]>
	</insert>
	
	<!-- 답변그룹 구하기 -->
	<select id="FAACAV058ERplSnoSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/058/FAACAV058ERplSnoSelect */ ]]>
        <![CDATA[     	
			SELECT	MAX(NVL(RPL_SNO,0)) AS RPL_SNO
			FROM	TWFAACAV065L
			WHERE	BRD_DVSN_CD = #strBrdDvsnCd#
			AND		GRP_NO		= #strGrpNo#
		]]>
	</select>
	
	<!-- QA조회수 구하기 -->
	<select id="FAACAV058ELvlCntSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/058/FAACAV058ERplSnoSelect */ ]]>
        <![CDATA[     	
			SELECT	MAX(NVL(LVL_CNT,0)) AS LVL_CNT
			FROM	TWFAACAV065L
			WHERE	BRD_DVSN_CD = #strBrdDvsnCd#
			AND		GRP_NO		= #strGrpNo#
		]]>
	</select>
	
	<select id="FAACAV058EDetailselectRpl" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/058/FAACAV058EDetailselect */ ]]>
        <![CDATA[       
			SELECT  ROWNUM AS KEY,
			        BRD_DVSN_CD,
			        SRNO,
			        GRP_NO,
			        RPL_SNO,
			        LVL_CNT,
			        TIT_NM,
			        REGI_DH,
			        REGI_ORG_NM,
			        REGN_ID,
			        REGN_NM,
			        SRCH_CNT,
			        TO_CHAR(TXT) AS TXT,
			        DOC_ID,
			        DECODE(DOC_ID, NULL, '', 'Y') AS DOC_YN,
			        TNB
			FROM    TWFAACAV065L
			WHERE   BRD_DVSN_CD =  'QA'
			AND		SRNO	= #SRNO#
		]]>
	</select>
	
	<insert id="FAACAV058EMaininsertRpl" parameterClass="paramMap">
		<![CDATA[  /* faa/cav/058/FAACAV058EMaininsert */ ]]>
		INSERT INTO TWFAACAV065L
		(
			 BRD_DVSN_CD
			,SRNO
			,GRP_NO
			,RPL_SNO
			,LVL_CNT
			,TIT_NM
			,REGI_DH
			,REGI_ORG_NM
			,REGN_ID
			,REGN_NM
			,SRCH_CNT
			,TXT
			,TNB
			,RMK
			,DOC_ID
			,FRT_REGI_DH
			,FRT_USR_ID
			,FNL_MDF_DH
			,FNL_USR_ID
			,FNL_DEAL_DPT_CD
			,FNL_MNU_ID						
		) VALUES (
			 #BRD_DVSN_CD#
			,#NEW_SRNO#
			,(SELECT S1.GRP_NO FROM TWFAACAV065L S1 WHERE S1.BRD_DVSN_CD = 'QA' AND SRNO = #SRNO#)
			,(SELECT NVL(MAX(RPL_SNO),0) + 1 FROM TWFAACAV065L S1 WHERE S1.BRD_DVSN_CD = 'QA' AND SRNO = #SRNO#)
			,(SELECT NVL(MAX(LVL_CNT),0) + 1 FROM TWFAACAV065L S1 WHERE S1.BRD_DVSN_CD = 'QA' AND SRNO = #SRNO#)
			,#TIT_NM#
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,#REGI_ORG_NM#
			,#REGN_ID#
			,#REGN_NM#
			,0
			,#TXT#
			,#TNB#
			,''
			,#DOC_ID#
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,'ADMIN'
			,TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS')
			,#FNL_USR_ID#
			,#FNL_DEAL_DPT_CD#
			,'ADMIN'
		)
	</insert>
	
	<select id="FAACAV058EMainMaxSnoSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/056/FAACAV058EMainMaxSnoSelect */ ]]>
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(SRNO)),0)+1) AS MAX_SEQ
				  FROM TWFAACAV065L
				 WHERE BRD_DVSN_CD = 'QA'
		]]>
	</select>	
	
	<select id="FAACAV058ECheckSameSrno" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/056/FAACAV058ECheckSameSrno */ ]]>
        <![CDATA[     	
			    SELECT SRNO AS CHECKSRNO, 
			           GRP_NO AS CHECKGRPNO
				  FROM NE_ENAIS_BOARD
				 WHERE BRD_DVSN_CD = 'QA'
				   AND SRNO =#SRNO#
		]]>
	</select>	
	
	<select id="FAACAV058ECheckSameSrno2" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/056/FAACAV058ECheckSameSrno2 */ ]]>
        <![CDATA[     	
			    SELECT SRNO AS CHECKSRNO, 
			           GRP_NO AS CHECKGRPNO
				  FROM NE_ENAIS_BOARD
				 WHERE BRD_DVSN_CD = 'QA'
				   AND SRNO =#NEW_SRNO#
		]]>
	</select>	
</sqlMap> 
