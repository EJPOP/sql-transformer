<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="rem/fft/001">

	<!--처분요구목록 조회-->
	<select id="REMFFT001PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT T2.TRN_YR, T2.DGE, T2.CNB
			       ,T2.DPT_CD
			       ,F_USR_INFO(T2.CNB, '2') AS USR_NAM
			       ,F_DPT_INFO(T2.DPT_CD, '1') AS DPT_NM
			       ,T2.TRN_DVSN_CD, T2.TRN_ORG_CD
			       ,F_EBSC_CODE_NM('10000013',T2.TRN_DVSN_CD) AS TRN_DVSN_NM
			       ,F_EBSC_CODE_NM('10000014',T2.TRN_ORG_CD) AS TRN_ORG_NM
			       ,T2.TRN_NAT_NM
			       ,T2.LNG_VLE_NM
			       ,T2.TRN_TASK_NM
			  FROM TBREMFFT001M T1,
			       TBREMFFT004M T2
			 WHERE T1.TRN_YR = T2.TRN_YR
			   AND T1.DGE = T2.DGE
		]]>			             
           		
		<isNotEmpty property="TRN_YR">	
			   AND T1.TRN_YR = #TRN_YR#
			   AND T1.DGE = #DGE#
			   AND T2.CNB = #CNB#
		</isNotEmpty>
	     
		<isNotEmpty property="APV_DOC_NO">	
			   AND T2.APV_DOC_NO = #APV_DOC_NO#
		</isNotEmpty>	     
	</select>
	
	<update id="REMFFT001PApvSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBREMFFT004M T1
			   SET APV_DOC_NO = #APV_DOC_NO#
			      ,APV_STA_CD = #APV_STA_CD#
			      ,PRSS_STA_CD = CASE WHEN #APV_STA_CD# = '3' THEN '30' ELSE PRSS_STA_CD END
			 WHERE 1=1
		]]>
		
		<isNotEmpty property="TRN_YR">
			AND T1.TRN_YR = #TRN_YR#
		   AND T1.DGE = #DGE#
		   AND T1.CNB = #CNB#
		</isNotEmpty>
		
		<isEmpty property="TRN_YR">
			AND APV_DOC_NO = #APV_DOC_NO#
		</isEmpty>
	</update>
</sqlMap> 
