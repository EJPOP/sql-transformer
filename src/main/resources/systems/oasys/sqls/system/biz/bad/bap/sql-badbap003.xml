<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/bap/003">
	
	<!--위탁 및 대행감사관리 조회-->
	<select id="BADBAP003EMainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
               SELECT D1.ORG_CD                                               /* 기관코드           */
                     ,D2.ORG_NM                                               /* 기관명             */
                     ,D1.YR                                                   /* 연도               */
                     ,D1.DLG_CSM_NO                                           /* 위임위탁번호       */
                     ,D1.NTF_DT                                               /* 통보일             */
                     ,D1.NTF_ORG_CD                                           /* 통보기관코드       */
                     ,D1.NTF_PEN_ID                                           /* 통보자ID     */
                     ,D1.NTF_DPT_NM                                           /* 통보부서명         */
                     ,D1.ACP_STA_CD                                           /* 접수상태코드       */
                     ,D1.ACP_DT                                               /* 접수일             */
                     ,D1.RCEP_ID                                              /* 접수자ID    */
                     ,D1.DLG_CSM_DVSN_CD                                      /* 위임위탁구분코드   */
                     ,(SELECT CD_NM 
                         FROM TBDCMACM013C
                        WHERE CMM_CD_DVSN_CD   = '1000207'
                          AND CD               = D1.DLG_CSM_DVSN_CD
                          AND NVL(USE_YN, 'N') = 'Y') AS DLG_CSM_DVSN_NM      /* 위임위탁구분명   */
                     ,D1.AUD_EXEC_DVSN_CD                                     /* 감사실시구분코드   */
                     ,D1.AUD_SBJ_NM                                           /* 감사사항명         */
                     ,D1.AUD_EPS_SBJ                                          /* 감사중점사항       */
                     ,D1.AUD_EXEC_RN_TXT                                      /* 감사실시범위내용   */
                     ,D1.ETC_SBJ                                              /* 기타사항           */
                     ,D1.HNDL_DDLN_DT                                         /* 처리기한일         */
                     ,D1.AUD_TG_TSK_CD                                        /* 감사대상업무코드   */
                     ,D1.DOC_ID                                               /* 문서ID     */
                     ,D1.DOC_TYP_CD                                           /* 문서유형코드       */
                     ,D1.ORGCHF_PST_NM                                        /* 기관장직위명       */
                     ,D1.PCR_RQ_CSM_TXT                                       /* 대행요구위탁내용       */
                     ,D1.AUD_RSLT_ACP_TXT                                     /* 감사결과접수내용       */
                     ,D1.AUD_DCN_TXT                                          /* 감사일수기간내용       */
                     ,D1.DRTR_SBJ                                             /* 책임자사항       */
                     ,D1.INDC_NOC_TXT                                         /* 지적건수내용       */          
                     ,D1.FRT_USR_ID                                           /* 최초사용자ID */
                     ,D1.FNL_USR_ID                                           /* 최종사용자ID */
                     ,D1.FNL_DEAL_DPT_CD                                      /* 최종거래부서코드   */
                     ,D1.FNL_MNU_ID                                           /* 최종메뉴ID  */
                     ,D1.FRT_REGI_DH                                          /* 최초등록일시       */
                     ,D1.FNL_MDF_DH                                           /* 최종수정일시       */
                FROM TBBADBAP001M D1                                          /* 위탁및대행감사기본 */
                    ,TBDCMACM015M D2                                          /* 기관정보기본       */
               WHERE 1=1
                 AND D1.ORG_CD     = D2.ORG_CD(+)
                 AND D1.ORG_CD     = #strOrgCd#                               /* 기관코드 */
                 AND D1.YR         = #strYr#                                  /* 연도*/
                 AND D1.DLG_CSM_NO = #strDlgCsmNo#                            /* 위임위탁번호 */
		]]>
	</select>
		
	<!--감사대상기관내역 조회 -->
	<select id="BADBAP003Tgselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
                   SELECT  D1.ORG_CD                          /* 기관코드 */
                          ,D2.ORG_NM                          /* 기관명 */    
                          ,D1.YR                              /* 연도 */    
                          ,D1.DLG_CSM_NO                      /* 위임위탁번호 */
                          ,D1.TG_ORG_CD                       /* 대상기관코드 */
                          ,D3.ORG_NM       AS TG_ORG_NM       /* 대상기관명 */
                          ,D1.TG_ORG_CD    AS CMPR_TG_ORG_CD  /* 대상기관코드 */
                          ,D1.FRT_USR_ID                      /* 최초사용자ID */     
                          ,D1.FNL_USR_ID                      /* 최종사용자ID */
                          ,D1.FNL_DEAL_DPT_CD                 /* 최종거래부서코드 */
                          ,D1.FNL_MNU_ID                      /* 최종메뉴ID */
                          ,D1.FRT_REGI_DH                     /* 최초등록일시 */
                          ,D1.FNL_MDF_DH                      /* 최종수정일시 */
                     FROM TBBADBAP001L D1      /* 감사대상기관내역 */
                         ,TBDCMACM015M D2      /* 기관정보기본  */
                         ,TBDCMACM015M D3      /* 기관정보기본  */
                    WHERE 1=1
                      AND D1.ORG_CD      = D2.ORG_CD(+)
                      AND D1.TG_ORG_CD   = D3.ORG_CD(+)
                      AND D1.ORG_CD      = #strOrgCd#     /* 기관코드 */ 
                      AND D1.YR          = #strYr#        /* 연도 */
                      AND D1.DLG_CSM_NO  = #strDlgCsmNo#  /* 위임위탁번호 */
                 ORDER BY D3.ORG_NM                
		]]>
	</select>

	
	<!-- 위탁및대행감사기본 insert-->
	<insert id="BADBAP003EMaininsert" parameterClass="paramMap">
        INSERT INTO TBBADBAP001M
        (  
              ORG_CD                /* 기관코드(PK) */
            , YR                    /* 연도(PK) */
            , DLG_CSM_NO            /* 위임위탁번호(PK) */
            , NTF_DT                /* 통보일  */
            , NTF_ORG_CD            /* 통보기관코드  */
            , NTF_PEN_ID            /* 통보자ID */
            , NTF_DPT_NM            /* 통보부서명  */
            , ACP_STA_CD            /* 접수상태코드  */
            , ACP_DT                /* 접수일  */
            , RCEP_ID               /* 접수자ID */
            , DLG_CSM_DVSN_CD       /* 위임위탁구분코드 */
            , AUD_EXEC_DVSN_CD      /* 감사실시구분코드 */
            , AUD_SBJ_NM            /* 감사사항명 */
            , AUD_EPS_SBJ           /* 감사중점사항 */
            , AUD_EXEC_RN_TXT       /* 감사실시범위내용 */
            , ETC_SBJ               /* 기타사항  */
            , HNDL_DDLN_DT          /* 처리기한일   */
            , AUD_TG_TSK_CD         /* 감사대상업무코드 */
            , DOC_ID                /* 문서ID */
            , DOC_TYP_CD            /* 문서유형코드   */
            , ORGCHF_PST_NM         /* 기관장직위명   */
            , PCR_RQ_CSM_TXT        /* 대행요구위탁내용       */
            , AUD_RSLT_ACP_TXT      /* 감사결과접수내용       */
            , AUD_DCN_TXT           /* 감사일수기간내용       */
            , DRTR_SBJ              /* 책임자사항       */
            , INDC_NOC_TXT          /* 지적건수내용       */            
            , FRT_USR_ID            /* 최초사용자ID */
            , FNL_USR_ID            /* 최종사용자ID */
            , FNL_DEAL_DPT_CD       /* 최종거래부서코드  */
            , FNL_MNU_ID            /* 최종메뉴ID */
            , FRT_REGI_DH           /* 최초등록일시  */
            , FNL_MDF_DH            /* 최종수정일시  */
        ) VALUES (
              #ORG_CD#              /* 기관코드(PK) */
            , #YR#                  /* 연도(PK) */
            , #DLG_CSM_NO#          /* 위임위탁번호(PK) */
            , #NTF_DT#              /* 통보일 */
            , #NTF_ORG_CD#          /* 통보기관코드  */
            , #NTF_PEN_ID#          /* 통보자ID */
            , #NTF_DPT_NM#          /* 통보부서명 */
            , #ACP_STA_CD#          /* 접수상태코드  */
            , #ACP_DT#              /* 접수일 */
            , #RCEP_ID#             /* 접수자ID */
            , #DLG_CSM_DVSN_CD#     /* 위임위탁구분코드 */
            , #AUD_EXEC_DVSN_CD#    /* 감사실시구분코드 */
            , #AUD_SBJ_NM#          /* 감사사항명 */
            , #AUD_EPS_SBJ#         /* 감사중점사항 */
            , #AUD_EXEC_RN_TXT#     /* 감사실시범위내용 */
            , #ETC_SBJ#             /* 기타사항 */
            , #HNDL_DDLN_DT#        /* 처리기한일 */
            , #AUD_TG_TSK_CD#       /* 감사대상업무코드 */
            , #DOC_ID#              /* 문서ID */
            , #DOC_TYP_CD#          /* 문서유형코드 */
            , #ORGCHF_PST_NM#       /* 기관장직위명  */
            , #PCR_RQ_CSM_TXT#      /* 대행요구위탁내용       */
            , #AUD_RSLT_ACP_TXT#    /* 감사결과접수내용       */
            , #AUD_DCN_TXT#         /* 감사일수기간내용       */
            , #DRTR_SBJ#            /* 책임자사항       */
            , #INDC_NOC_TXT#        /* 지적건수내용       */            
            , #FRT_USR_ID#          /* 최초사용자ID */
            , #FNL_USR_ID#          /* 최종사용자ID */
            , #FNL_DEAL_DPT_CD#     /* 최종거래부서코드  */
            , #FNL_MNU_ID#          /* 최종메뉴ID */
            , SYSDATE               /* 최초등록일시 */
            , SYSDATE               /* 최종수정일시 */
        )
	</insert>
	
    <!-- 감사대상기관내역 insert-->
	<insert id="BADBAP003ETginsert" parameterClass="paramMap">
        INSERT INTO TBBADBAP001L
        (
            ORG_CD              /* 기관코드 */    
           ,YR                  /* 연도 */        
           ,DLG_CSM_NO          /* 위임위탁번호 */
           ,TG_ORG_CD           /* 대상기관코드 */    
           ,FRT_USR_ID          /* 최초사용자ID */        
           ,FNL_USR_ID          /* 최종사용자ID */        
           ,FNL_DEAL_DPT_CD     /* 최종거래부서코드 */  
           ,FNL_MNU_ID          /* 최종메뉴ID */          
           ,FRT_REGI_DH         /* 최초등록일시 */        
           ,FNL_MDF_DH          /* 최종수정일시 */       
        ) VALUES (
            #ORG_CD#            /* 기관코드  */    
           ,#YR#                /* 연도  */        
           ,#DLG_CSM_NO#        /* 위임위탁번호  */
           ,#TG_ORG_CD#         /* 대상기관코드  */    
           ,#FRT_USR_ID#        /* 최초사용자ID */        
           ,#FNL_USR_ID#        /* 최종사용자ID */        
           ,#FNL_DEAL_DPT_CD#   /* 최종거래부서코드 */   
           ,#FNL_MNU_ID#        /* 최종메뉴ID */
           ,SYSDATE             /* 최초등록일시 */
           ,SYSDATE             /* 최종수정일시 */
        )
	</insert>	
	
	<!--위탁 및 대행감사기본 update-->
	<update id="BADBAP003EMainupdate" parameterClass="paramMap">
           UPDATE TBBADBAP001M 
              SET FNL_MDF_DH       = SYSDATE                 /* 최종수정일시  */
                 ,FNL_USR_ID       = #FNL_USR_ID#            /* 최종사용자ID */
                                  
        <isNotNull property="NTF_DT">
                 ,NTF_DT           = #NTF_DT#                /* 통보일  */
        </isNotNull>
        <isNotNull property="NTF_ORG_CD">
              , NTF_ORG_CD       = #NTF_ORG_CD#            /* 통보기관코드  */
        </isNotNull>
        <isNotNull property="NTF_PEN_ID">
              , NTF_PEN_ID       = #NTF_PEN_ID#            /* 통보자ID */
       	</isNotNull>
        <isNotNull property="NTF_DPT_NM">
              , NTF_DPT_NM       = #NTF_DPT_NM#            /* 통보부서명  */        
        </isNotNull>
        <isNotNull property="ACP_STA_CD">
              , ACP_STA_CD       = #ACP_STA_CD#            /* 접수상태코드  */        
        </isNotNull>
        <isNotNull property="ACP_DT">
              , ACP_DT           = #ACP_DT#                /* 접수일  */        
        </isNotNull>
        <isNotNull property="RCEP_ID">
              , RCEP_ID          = #RCEP_ID#               /* 접수자ID */        
        </isNotNull>
        <isNotNull property="DLG_CSM_DVSN_CD">
              , DLG_CSM_DVSN_CD  = #DLG_CSM_DVSN_CD#       /* 위임위탁구분코드 */
        </isNotNull>
        <isNotNull property="AUD_EXEC_DVSN_CD">
              , AUD_EXEC_DVSN_CD = #AUD_EXEC_DVSN_CD#      /* 감사실시구분코드 */        
        </isNotNull>
        <isNotNull property="AUD_SBJ_NM">
              , AUD_SBJ_NM       = #AUD_SBJ_NM#            /* 감사사항명 */        
        </isNotNull>
        <isNotNull property="AUD_EPS_SBJ">
              , AUD_EPS_SBJ      = #AUD_EPS_SBJ#           /* 감사중점사항 */
        </isNotNull>
        <isNotNull property="AUD_EXEC_RN_TXT">
              , AUD_EXEC_RN_TXT  = #AUD_EXEC_RN_TXT#       /* 감사실시범위내용 */        
        </isNotNull>
        <isNotNull property="ETC_SBJ">
              , ETC_SBJ          = #ETC_SBJ#               /* 기타사항  */        
        </isNotNull>
        <isNotNull property="HNDL_DDLN_DT">
              , HNDL_DDLN_DT     = #HNDL_DDLN_DT#          /* 처리기한일   */        
        </isNotNull>
        <isNotNull property="AUD_TG_TSK_CD">
              , AUD_TG_TSK_CD    = #AUD_TG_TSK_CD#         /* 감사대상업무코드 */        
        </isNotNull>
        <isNotNull property="DOC_ID">
              , DOC_ID           = #DOC_ID#                /* 문서ID */        
        </isNotNull>
        <isNotNull property="DOC_TYP_CD">
              , DOC_TYP_CD       = #DOC_TYP_CD#            /* 문서유형코드   */        
        </isNotNull>
        <isNotNull property="ORGCHF_PST_NM">
              , ORGCHF_PST_NM    = #ORGCHF_PST_NM#         /* 기관장직위명   */        
        </isNotNull>        
        <isNotNull property="PCR_RQ_CSM_TXT">
              , PCR_RQ_CSM_TXT  = #PCR_RQ_CSM_TXT#         /* 대행요구위탁내용   */        
        </isNotNull>
        <isNotNull property="AUD_RSLT_ACP_TXT">
              , AUD_RSLT_ACP_TXT = #AUD_RSLT_ACP_TXT#      /* 감사결과접수내용   */        
        </isNotNull>
        <isNotNull property="AUD_DCN_TXT">
              , AUD_DCN_TXT      = #AUD_DCN_TXT#           /* 감사일수기간내용   */        
        </isNotNull>
        <isNotNull property="DRTR_SBJ">
              , DRTR_SBJ         = #DRTR_SBJ#              /* 책임자사항   */        
        </isNotNull>
        <isNotNull property="INDC_NOC_TXT">
              , INDC_NOC_TXT     = #INDC_NOC_TXT#          /* 지적건수내용   */        
        </isNotNull>
        <isNotNull property="FNL_DEAL_DPT_CD">
              , FNL_DEAL_DPT_CD  = #FNL_DEAL_DPT_CD#       /* 최종거래부서코드  */
        </isNotNull>
        <isNotNull property="FNL_MNU_ID">
              , FNL_MNU_ID       = #FNL_MNU_ID#            /* 최종메뉴ID */              
        </isNotNull>
        
        WHERE ORG_CD       = #ORG_CD#      /* 기관코드 */
          AND YR           = #YR#          /* 연도 */
          AND DLG_CSM_NO   = #DLG_CSM_NO#  /* 위임위탁번호 */        
	</update>	
	
	<!--위탁 및 대행감사기본 update-->
	<update id="BADBAP003ETgupdate" parameterClass="paramMap">
           UPDATE TBBADBAP001L 
              SET FNL_MDF_DH      = SYSDATE            /* 최종수정일시 */ 
                 ,FNL_USR_ID      = #FNL_USR_ID#       /* 최종사용자ID */ 
                 
              <isNotEmpty property="TG_ORG_CD">              
                 ,TG_ORG_CD       = #TG_ORG_CD#        /* 대상기관코드 */
              </isNotEmpty>
              
              <isNotEmpty property="FNL_DEAL_DPT_CD">        
                 ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#  /* 최종거래부서코드 */
              </isNotEmpty>
              
              <isNotEmpty property="FNL_MNU_ID">   
                 ,FNL_MNU_ID      = #FNL_MNU_ID#       /* 최종메뉴ID */
              </isNotEmpty>
                      
            WHERE ORG_CD          = #ORG_CD#           /* 기관코드 */ 
              AND YR              = #YR#               /* 연도 */  
              AND DLG_CSM_NO      = #DLG_CSM_NO#       /* 위임위탁번호 */
              AND TG_ORG_CD       = #CMPR_TG_ORG_CD#   /* 대상기관코드 */     
	</update>		
	
	<!--위탁 및 대행감사기본 delete-->
	<update id="BADBAP003EMaindelete" parameterClass="paramMap">
          DELETE 
            FROM TBBADBAP001M
           WHERE ORG_CD     = #ORG_CD#
             AND YR         = #YR# 
             AND DLG_CSM_NO = #DLG_CSM_NO# 
	</update>

	<!--감사대상기관내역 delete-->
	<update id="BADBAP003ETgdelete" parameterClass="paramMap">
          DELETE 
            FROM TBBADBAP001L
           WHERE ORG_CD     = #ORG_CD#
             AND YR         = #YR# 
             AND DLG_CSM_NO = #DLG_CSM_NO#
             
		<isNotNull property="CMPR_TG_ORG_CD">	
             AND TG_ORG_CD  = #CMPR_TG_ORG_CD#
		</isNotNull>
		
	</update>


	<!-- 위탁위임번호 Max + 1값 찾기 -->
	<select id="BADBAP003EMainMaxDlgCsmNoselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT NVL(MAX(TO_NUMBER(DLG_CSM_NO)),0)+1 AS DLG_CSM_NO
				  FROM TBBADBAP001M /* 위탁및대행감사기본 */ 
				 WHERE 1=1
				   AND ORG_CD = #ORG_CD#
				   AND YR     = #YR#
		]]>
	</select>

	<!-- 위탁위임번호 Max 값 찾기 -->
	<select id="BADBAP003EMainMaxDlgCsmNoMaxselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT MAX(TO_NUMBER(DLG_CSM_NO)) AS DLG_CSM_NO
				  FROM TBBADBAP001M /* 위탁및대행감사기본 */ 
				 WHERE 1=1
				   AND ORG_CD = #ORG_CD#
				   AND YR     = #YR#
		]]>
	</select>
		
</sqlMap> 
