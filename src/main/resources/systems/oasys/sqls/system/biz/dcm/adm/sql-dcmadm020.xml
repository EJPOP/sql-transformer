<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="dcm/adm/020">

	<select id="DCMADM020PMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.ACP_YR
			      ,T1.ACP_DVSN_CD
			      ,T1.ACP_SRNO
			      ,T1.ACP_DT
			      ,T1.TIT_NM
			      ,T1.ACP_YR||'-'||DECODE(T1.ACP_DVSN_CD,'1','심사','2','재심')||'-'||T1.ACP_SRNO AS ACP_YR_SRNO
			      ,T1.REQR_NM
			      ,F_CODE_NM('1000807',T1.ACP_HNDL_STA_CD) AS ACP_HNDL_STA_NM
			  FROM TBBADFRE012M T1
			  WHERE T1.ACP_YR = #strACP_YR#
			    AND T1.ACP_DVSN_CD = #strACP_DVSN_CD#
		]]>
		<dynamic>
			<isNotEmpty property="strACP_SRNO">
			    AND T1.ACP_SRNO = #strACP_SRNO#
			</isNotEmpty>
			<isNotEmpty property="strTIT_NM">
			    AND T1.TIT_NM LIKE '%'||#strTIT_NM#||'%'
			</isNotEmpty>
		</dynamic>
	</select>
	
	<update id="DCMADM020AcpInformupdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBDCMIDM001L
			   SET  
					ACP_YR						= #ACP_YR#              
					,ACP_DVSN_CD						= #ACP_DVSN_CD#
					,ACP_SRNO						= #ACP_SRNO# 
			WHERE	AUD_SMT_MTRL_ID = #AUD_SMT_MTRL_ID#
		]]>
	</update>
	
	
	<insert id="DCMADM020Eevidenceinsert" parameterClass="paramMap">
        INSERT INTO TBBADFRE108D
        (
            ACP_YR /*감사년도 */
            ,ACP_DVSN_CD /*감사번호*/ 
            ,ACP_SRNO /*감사부여코드*/ 
            ,EVI_DCMB_SNO	/*감사서류함순번 */
            ,ACP_DCM_DOC_ID	/*감사서류문서ID */
            ,FILE_NM	/*파일명 */
            ,FILE_SIZE
            ,FRT_USR_ID	/*최초사용자ID */
            ,FNL_USR_ID
            ,FNL_DEAL_DPT_CD
            ,EVI_DCM_DVSN_CD/*증거서류구분코드*/
            ,ACP_DCM_CRE_ID /*감사서류생성자ID*/
            ,FNL_MNU_ID
            ,FRT_REGI_DH	/*최초등록일시 */
            ,FNL_MDF_DH	/*최종수정일시  */
        )
        values
        (	
            #acpYr#       
            ,#acpDvsnCd#       
            ,#acpSrno#       
            ,#eviDcmbSno#  
            ,#audDcmDocId#
            ,#fileNm#
            ,#fileSize#
            ,#frtUsrId#  
            ,#fnlUsrId# 
            ,#fnlDealDptCd# 
            ,#eviDcmDsnCd#
            ,#audDcmCreId#
            ,#fnlMnuId#
            ,SYSDATE    
            ,SYSDATE 
        )
    </insert>
    
    <update id="DCMADM020Eevidenceupdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBDCMIDM001D
			   SET  DOC_ID  				= #DOC_ID# 
					,FNL_USR_ID       			= #FNL_USR_ID#  
					,FNL_MDF_DH					= SYSDATE
					,FILE_DN2					= #FILE_DN2# 
					,ACP_YR = #acpYr#
					,ACP_DVSN_CD = #acpDvsnCd#
					,ACP_SRNO = #acpSrno#
					,REGI_DT2 = CASE WHEN REGI_DT2 IS NULL THEN TO_CHAR(SYSDATE,'YYYYMMDD') ELSE REGI_DT2 END
			WHERE	AUD_SMT_MTRL_ID = #AUD_SMT_MTRL_ID#
			        AND ATACH_FILE_ID = #ATACH_FILE_ID#
		]]>
	</update>
	
	<insert id="DCMADM020EevidenceDocIdinsert" parameterClass="paramMap" >
        <![CDATA[ 
        
         INSERT INTO TBDCMIDM001D
        (
            AUD_SMT_MTRL_ID    
			,FILE_SN
			,FILE_NAME  
			,ATACH_FILE_ID
			,DOC_ID
			,FRT_USR_ID
			,FNL_USR_ID
			,FRT_REGI_DH
			,FNL_MDF_DH
			,FILE_DN2
			,ACP_YR
			,ACP_DVSN_CD
			,ACP_SRNO
			,REGI_DT2
        )
        values
        (	
       		#AUD_SMT_MTRL_ID# 
			,#FILE_SN#           
			,#FILE_NAME# 
			,#ATACH_FILE_ID# 
			,#DOC_ID#   
			,#FRT_USR_ID#
			,#FNL_USR_ID#
            ,SYSDATE    
            ,SYSDATE  
			,#FILE_DN2#
			,#acpYr#
			,#acpDvsnCd#
			,#acpSrno#
			,TO_CHAR(SYSDATE,'YYYYMMDD')
        )      
			 	
        ]]>        
	</insert>
</sqlMap>