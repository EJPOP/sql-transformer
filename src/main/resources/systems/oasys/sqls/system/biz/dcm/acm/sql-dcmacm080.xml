<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="dcm/acm/080">

	<select id="dcmacm080QInitComboList" parameterClass="paramMap" resultClass="resultMap">
		SELECT DISTINCT DVSN_NM AS CD_NM
		  FROM TBDCMACM080H
	</select>

	<select id="dcmacm080QselectMainList" parameterClass="paramMap" resultClass="resultMap">
		<include refid = "include.pageSelct"/>
		<![CDATA[
		SELECT T1.*, 
			   ROWNUM AS NO
          FROM (
				SELECT SNO,
					   DOWNLOAD_DH AS DL_DH,
				       MNU_NM AS MENU_NM,
				       DVSN_NM,
				       F_USR_INFO(CNB, '2') AS USR_NM,
				       F_DPT_INFO(F_USR_INFO(CNB, '5'), '1') AS DPT_NM,
				       TXT
				  FROM TBDCMACM080H			
				 WHERE 1=1
		]]>
			<dynamic>
	        	<isNotEmpty property="strDTS">
	        		AND	TO_CHAR(DOWNLOAD_DH,'YYYYMMDD') &gt;= #strDTS#
	        	</isNotEmpty>
	        	<isNotEmpty property="strDTE">
	        		AND	TO_CHAR(DOWNLOAD_DH,'YYYYMMDD') &lt;= #strDTE#
	        	</isNotEmpty>
			
				<isNotEmpty property="strSCH">
	        		AND	TXT LIKE '%'||#strSCH#||'%'        	
	        	</isNotEmpty>
	
				<isNotEmpty property="strUsrCnb">
					AND CNB = #strUsrCnb#
				</isNotEmpty>
			
				<isNotEmpty property="strDvsnNm">
					AND DVSN_NM = #strDvsnNm#
				</isNotEmpty>
			</dynamic>
			   ORDER BY DL_DH ASC ) T1
		
		<include refid = "include.pageOrder"/> 
	</select>
	
	<select id="dcmacm080QselectExcelExport" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
		SELECT T1.*, 
			   ROWNUM AS NO
          FROM (
				SELECT SNO,
				       DOWNLOAD_DH AS DL_DH,
				       MNU_NM AS MENU_NM,
				       DVSN_NM,
				       F_USR_INFO(CNB, '2') AS USR_NM,
				       F_DPT_INFO(F_USR_INFO(CNB, '5'), '1') AS DPT_NM,
				       TXT
				  FROM TBDCMACM080H			
				 WHERE 1=1
		]]>
			<dynamic>
	        	<isNotEmpty property="strDTS">
	        		AND	DOWNLOAD_DH &gt;= #strDTS#
	        	</isNotEmpty>
	        	<isNotEmpty property="strDTE">
	        		AND	DOWNLOAD_DH &lt;= #strDTE#
	        	</isNotEmpty>
			
				<isNotEmpty property="strSCH">
	        		AND	TXT LIKE '%'||#strSCH#||'%'        	
	        	</isNotEmpty>
	
				<isNotEmpty property="strUsrCnb">
					AND CNB = #strUsrCnb#
				</isNotEmpty>
			
				<isNotEmpty property="strDvsnNm">
					AND DVSN_NM = #strDvsnNm#
				</isNotEmpty>
			</dynamic>
			ORDER BY DL_DH ASC ) T1
	</select>
	
	<select id="dcmacm080QNextKey" parameterClass="paramMap" resultClass="Integer">
		SELECT NVL(MAX(SNO),0)+1 AS NEXT_KEY FROM TBDCMACM080H
	</select>
	
	<insert id="dcmacm080QInsert" parameterClass="paramMap">
		INSERT INTO TBDCMACM080H (
				SNO,
	            DOWNLOAD_DH,
	            MNU_NM,
	            DVSN_NM, 
	            CNB,
	            TXT,
	            FRT_USR_ID,
	            FNL_DEAL_DPT_CD,
	            FNL_MNU_ID
			)
			VALUES (
				#SNO#,
				SYSDATE,
				#strMenuNm#,
				#strDvsnNm#,
				#CNB#,
				#strTxt#,
				#FRT_USR_ID#,
				#FNL_DEAL_DPT_CD#,
				#FNL_MNU_ID#
			)		
	</insert>
</sqlMap> 