<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/qbo/171">
 
 	<select id="CSPQBO171EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.RCMD_BOO_SLN		/*추천도서연번*/
					,A.BOO_TIT_NM		/*도서제목명*/
					,A.ATR_NM			/*저자명*/
					,F_USR_INFO(A.RCMR_CNB,'2') AS RCMR_NAM		/*추천자명*/
					,A.BOO_RCMD_TXT		/*도서추천내용*/
					,A.BOO_RCMD_RMK		/*도서추천비고*/
					,A.RCMR_CNB			/*추천자전산번호*/
					,A.DOC_ID
			FROM	TBCSPQBO005M A		/*추천도서기본*/
			WHERE	1=1
		]]> 
		
		<dynamic>
			<isNotEmpty property="strSEARCH_NM">
				AND (A.BOO_TIT_NM LIKE '%'||#strSEARCH_NM#||'%' 
						OR A.ATR_NM LIKE '%'||#strSEARCH_NM#||'%'
						OR A.RCMR_CNB IN (SELECT CNB 
											FROM TBDCMACM001M 
											WHERE USR_NAM LIKE '%'||#strSEARCH_NM#||'%'))
			</isNotEmpty>
		</dynamic>
		<![CDATA[
			ORDER BY TO_NUMBER(A.RCMD_BOO_SLN) DESC
		]]> 
	</select>
	
	<select id="CSPQBO171EKeySelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT 	TO_CHAR(NVL(MAX(TO_NUMBER(RCMD_BOO_SLN))+1,1)) AS RCMD_BOO_SLN
			FROM	TBCSPQBO005M
		]]> 
	</select>
	
	<insert id="CSPQBO171EMainInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPQBO005M
					(	
						RCMD_BOO_SLN		/*추천도서연번*/
						,BOO_TIT_NM			/*도서제목명*/
						,ATR_NM				/*저자명*/
						,RCMR_CNB			/*추천자전산번호*/
						,BOO_RCMD_TXT		/*도서추천내용*/
						,BOO_RCMD_RMK		/*도서추천비고*/
						,DOC_ID				/*첨부파일문서번호*/
						,FRT_USR_ID			/*최초사용자ID*/
						,FNL_USR_ID			/*최종사용자ID*/
						,FNL_DEAL_DPT_CD	/*최종거래부서코드*/
						,FNL_MNU_ID			/*최종메뉴ID*/
						,FRT_REGI_DH		/*최초등록일시*/
						,FNL_MDF_DH			/*최종수정일시*/
					)
				VALUES 	(
							#RCMD_BOO_SLN#
							,#BOO_TIT_NM#
							,#ATR_NM#
							,#RCMR_CNB#
							,#BOO_RCMD_TXT#
							,#BOO_RCMD_RMK#
							,#DOC_ID#
							,#FRT_USR_ID#
							,#FNL_USR_ID#
							,#FNL_DEAL_DPT_CD#
							,#FNL_MNU_ID#
							,SYSDATE
							,SYSDATE
						)
		]]> 
	</insert>
	
	<update id="CSPQBO171EMainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPQBO005M
			SET		BOO_TIT_NM = #BOO_TIT_NM#		/*도서제목명*/
					,ATR_NM = #ATR_NM#				/*저자명*/
					,RCMR_CNB = #RCMR_CNB#			/*추천자전산번호*/
					,BOO_RCMD_TXT = #BOO_RCMD_TXT#	/*도서추천내용*/
					,BOO_RCMD_RMK = #BOO_RCMD_RMK#	/*도서추천비고*/
					,DOC_ID	= #DOC_ID#				/*첨부파일문서ID*/
					,FNL_USR_ID = #FNL_USR_ID#
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID = #FNL_MNU_ID#
					,FNL_MDF_DH = SYSDATE
			WHERE	RCMD_BOO_SLN = #RCMD_BOO_SLN#
		]]> 
	</update>
	
	<delete id="CSPQBO171EMainDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE	
			FROM	TBCSPQBO005M
			WHERE	RCMD_BOO_SLN = #RCMD_BOO_SLN#
		]]> 
	</delete>
	
</sqlMap> 
