<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/123">
 	
 	<select id="CSPDCP123PMainSelectSusin" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
		SELECT D1.YM
				, '보고자' AS DIV
		      ,D1.INF_RPRT_NO
		      ,CASE WHEN SUBSTR(D1.INF_TYP_CD, 0, 2) = '01' THEN F_CODE_NM('1000607', '0100') ELSE F_CODE_NM('1000607', '0200') END AS INF_TYP_TOP_NM
		      ,F_CODE_NM('1000607', D1.INF_TYP_CD) AS INF_TYP_NM
		      ,D2.APV_RPT_PEN_DVSN_CD
		      ,F_DPT_INFO(D3.DPT_CD, '1') AS DPT_NM
		      ,D3.USR_NAM
		      ,F_CODE_NM('1000173', D3.RANK_CD) AS RANK_NM
		  FROM TBCSPDCP501M D1
		      ,TBCSPDCP503L D2
		      ,TBDCMACM001M D3
		 WHERE 1=1
		   AND D1.YM = D2.YM(+)
		   AND D1.INF_RPRT_NO = D2.INF_RPRT_NO(+)
		   AND D2.APVR_ID = D3.USR_ID
		   AND D2.APV_RPT_PEN_DVSN_CD = 1
		   AND D1.YM= #YM#
		   AND D1.INF_RPRT_NO = #INF_RPRT_NO#
		]]>
		
	</select>
	
	<select id="CSPDCP123PMainSelectBogo" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
		SELECT D1.YM
		      ,D1.INF_RPRT_NO
		      ,CASE WHEN SUBSTR(D1.INF_TYP_CD, 0, 2) = '01' THEN F_CODE_NM('1000607', '0100') ELSE F_CODE_NM('1000607', '0200') END AS INF_TYP_TOP_NM
		      ,F_CODE_NM('1000607', D1.INF_TYP_CD) AS INF_TYP_NM
		      ,F_CODE_NM('1000608', D2.APV_RPT_PEN_DVSN_CD) AS APV_RPT_PEN_DVSN_CD
		      ,F_DPT_INFO(D3.DPT_CD, '1') AS DPT_NM
		      ,D3.USR_NAM
		      ,F_CODE_NM('1000173', D3.RANK_CD) AS RANK_NM
		  FROM TBCSPDCP501M D1
		      ,TBCSPDCP503L D2
		      ,TBDCMACM001M D3
		 WHERE 1=1
		   AND D1.YM = D2.YM(+)
		   AND D1.INF_RPRT_NO = D2.INF_RPRT_NO(+)
		   AND D2.APVR_ID = D3.USR_ID
		   AND D2.APV_RPT_PEN_DVSN_CD IN (2, 3)
		   AND D1.YM= #YM#
		   AND D1.INF_RPRT_NO = #INF_RPRT_NO#
	   ORDER BY APV_RPT_PEN_DVSN_CD
		]]>
		
	</select>
	
	<select id="CSPDCP123PMainSelectchamjo" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
		SELECT D1.YM
		      ,D1.INF_RPRT_NO
		      ,CASE WHEN SUBSTR(D1.INF_TYP_CD, 0, 2) = '01' THEN F_CODE_NM('1000607', '0100') ELSE F_CODE_NM('1000607', '0200') END AS INF_TYP_TOP_NM
		      ,F_CODE_NM('1000607', D1.INF_TYP_CD) AS INF_TYP_NM
		      ,D2.APV_RPT_PEN_DVSN_CD
		      ,F_DPT_INFO(D3.DPT_CD, '1') AS DPT_NM
		      ,D3.USR_NAM
		      ,F_CODE_NM('1000173', D3.RANK_CD) AS RANK_NM
		  FROM TBCSPDCP501M D1
		      ,TBCSPDCP503L D2
		      ,TBDCMACM001M D3
		 WHERE 1=1
		   AND D1.YM = D2.YM(+)
		   AND D1.INF_RPRT_NO = D2.INF_RPRT_NO(+)
		   AND D2.APVR_ID = D3.USR_ID
		   AND D2.APV_RPT_PEN_DVSN_CD = 3
		   AND D1.YM= #YM#
		   AND D1.INF_RPRT_NO = #INF_RPRT_NO#
		]]>
		
	</select>
	
	<select id="CSPDCP123PSubSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			

            SELECT T2.YM
	         	  ,T2.INF_RPRT_NO
		          ,T2.ORG_CD
		          ,T3.ORG_NM
		          ,(SELECT ORG_NM 
		              FROM TBDCMACM015M 
		             WHERE ORG_CD LIKE SUBSTR(T3.ORG_CD, 0 , 3)||'000000000') AS SMALL_ORG_NM
		          ,(SELECT 
	                   (SELECT S1.CD_NM 
		                  FROM TBDCMACM013C S1 
		                 WHERE 1=1
		                   AND S1.CMM_CD_DVSN_CD = '1000447'
		                   AND S1.CD = C1.USR_DFN_TXT_1) AS CD_NM
	                  FROM TBDCMACM013C C1 
	                 WHERE 1=1 
	         	       AND C1.CMM_CD_DVSN_CD = '1000128'
	                   AND C1.CD = T3.PUB_DVSN_CD) AS ORG_DIV
                     ,T4.YM
                     ,T4.INF_RPRT_NO
                     ,T4.SRNO
                     ,T4.NAM
                     ,T4.BTDT
                     ,T4.BLT_ORG_NM
                     ,T4.RANK_NM
                     ,T4.PST_NM
	     	  FROM TBCSPDCP501M T1
	              ,TBCSPDCP502L T2
	              ,TBDCMACM015M T3
                  ,TBCSPDCP504L T4
	   		 WHERE 1=1 
		       AND T1.YM = T2.YM(+)
		       AND T1.INF_RPRT_NO = T2.INF_RPRT_NO(+)
               AND T1.YM = T4.YM(+)
               AND T1.INF_RPRT_NO = T4.INF_RPRT_NO(+)
		       AND T2.ORG_CD = T3.ORG_CD(+)
	           AND T1.YM = #YM#
	           AND T1.INF_RPRT_NO = #INF_RPRT_NO#
	
		]]>
		
	</select>
	
<resultMap class="java.util.HashMap" id="subMap">
	
     <result property="TIT_NM" column="TIT_NM" jdbcType="VARCHAR2"	javaType="java.lang.String" />
	
	<result property="DOC_TXT" column="DOC_TXT" jdbcType="CLOB"	javaType="java.lang.String" />
			
</resultMap>
	
	<select id="CSPDCP123PSubTxt" parameterClass="paramMap"
		resultMap="subMap">
		<![CDATA[
			  SELECT D1.TIT_NM
                    ,D2.DOC_TXT
               FROM TBCSPDCP501M D1
                   ,TBCSPDCP505M D2
              WHERE 1=1
                AND D1.YM = D2.YM
                AND D1.INF_RPRT_NO = D2.INF_RPRT_NO
                AND D2.INF_RPRT_DOC_DVSN_CD = 'A'
                AND D1.YM= #YM#
		        AND D1.INF_RPRT_NO = #INF_RPRT_NO#
		]]>
	</select>

	<resultMap class="java.util.HashMap" id="subMap2">
		
	     <result property="TIT_NM" column="TIT_NM" jdbcType="VARCHAR2"	javaType="java.lang.String" />
		
		<result property="DOC_TXT" column="DOC_TXT" jdbcType="CLOB"	javaType="java.lang.String" />
				
	</resultMap>	
	
		<select id="CSPDCP123PSubTxt2" parameterClass="paramMap"
		resultMap="subMap2">
		<![CDATA[
			  SELECT D1.TIT_NM
                    ,D2.DOC_TXT
               FROM TBCSPDCP501M D1
                   ,TBCSPDCP505M D2
              WHERE 1=1
                AND D1.YM = D2.YM
                AND D1.INF_RPRT_NO = D2.INF_RPRT_NO
                AND D2.INF_RPRT_DOC_DVSN_CD = 'B'
                AND D1.YM= #YM#
		        AND D1.INF_RPRT_NO = #INF_RPRT_NO#
		]]>
	</select>
	
	<select id="CSPDCP123PTxtACheck" parameterClass="paramMap"
		resultClass="java.lang.String">
				SELECT CASE WHEN COUNT(1) = 0 THEN 'I' ELSE 'U' END AS TXTAIUCHECK
				  FROM TBCSPDCP505M
				 WHERE 1=1
				   AND YM = #YM#
				   AND INF_RPRT_NO = #INF_RPRT_NO#
				   AND INF_RPRT_DOC_DVSN_CD = 'A'
	</select>
	
	<select id="CSPDCP123PTxtBCheck" parameterClass="paramMap"
		resultClass="java.lang.String">
				SELECT CASE WHEN COUNT(1) = 0 THEN 'I' ELSE 'U' END AS TXTAIUCHECK
				  FROM TBCSPDCP505M
				 WHERE 1=1
				   AND YM = #YM#
				   AND INF_RPRT_NO = #INF_RPRT_NO#
				   AND INF_RPRT_DOC_DVSN_CD = 'B'
	</select>
	
	
	<insert id="CSPDCP123PTxtInsert" parameterClass="paramMap">
		<![CDATA[
		 INSERT INTO TBCSPDCP505M(
				             YM
				            ,INF_RPRT_NO
				            ,INF_RPRT_DOC_DVSN_CD
				            ,DOC_TXT
				            ,FRT_USR_ID
				            ,FNL_USR_ID
				            ,FNL_DEAL_DPT_CD
				            ,FNL_MNU_ID
				            ,FRT_REGI_DH
				            ,FNL_MDF_DH 
				            )
				            VALUES(
				            #YM#
				            ,#INF_RPRT_NO#
				            ,#INF_RPRT_DOC_DVSN_CD#
				            ,(CASE WHEN #INF_RPRT_DOC_DVSN_CD# = 'A' THEN #TEXT_A# ELSE #TEXT_B# END) 
				            ,#FRT_USR_ID#
				            ,#FNL_USR_ID#
				            ,#FNL_DEAL_DPT_CD#
				            ,#FNL_MNU_ID#
				            ,SYSDATE
				            ,SYSDATE
				            )
	]]>
	</insert>
	
	<update id="CSPDCP123PTxtUpdate" parameterClass="paramMap">
	 UPDATE TBCSPDCP505M 
	    SET FNL_USR_ID         = #FNL_USR_ID#
	       ,FNL_DEAL_DPT_CD    = #FNL_DEAL_DPT_CD#
	       ,FNL_MNU_ID         = #FNL_MNU_ID#
	       ,FNL_MDF_DH         = SYSDATE
	       ,DOC_TXT            = (CASE WHEN #INF_RPRT_DOC_DVSN_CD# = 'A' THEN #TEXT_A# ELSE #TEXT_B# END)
	  WHERE  1=1
	    AND YM = #YM#
	    AND INF_RPRT_NO = #INF_RPRT_NO#
	    AND INF_RPRT_DOC_DVSN_CD = #INF_RPRT_DOC_DVSN_CD#
	</update>
	
</sqlMap> 
