<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="res/rcm/004">

	<select id="RESRCM004IMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
            SELECT rownum AS NUM,
                   T1.EVL_YR,
			       T1.HLYR_DVSN_CD,
			       T1.EVL_DGE,
				   T1.CNB,
			       F_DPT_INFO(T1.DPT_CD,'1') AS DPT_NM,
				   T1.DPT_CD,
				   F_USR_INFO(T1.CNB,'2') AS DSP_RQ_USR_NM,
				   T1.AUD_ACMP_ECL_RCMD_RSN,
			       COUNT(1) OVER () AS TOT_CNT
			  FROM TBRESRAD025D T1
			 WHERE 1=1
		]]>
		<isNotEmpty property="EVL_YR">	
			   AND T1.EVL_YR = #EVL_YR#
		</isNotEmpty>

		<isNotEmpty property="HLYR_DVSN_CD">	
			   AND T1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
		</isNotEmpty>
		
		<isNotEmpty property="EVL_DGE">	
			   AND T1.EVL_DGE = #EVL_DGE#
		</isNotEmpty>		
		<isNotEmpty property="CNB">
			   AND T1.CNB IN
					<iterate property="CNB" open="(" close=")" conjunction=",">
						#CNB[]#
					</iterate>
		</isNotEmpty>
	     
		<isNotEmpty property="APV_DOC_NO">	
			   AND T1.APV_DOC_NO = #APV_DOC_NO#
		</isNotEmpty>	     
	     
		ORDER BY F_USR_INFO(T1.CNB,'5') ASC, F_USR_INFO(T1.CNB,'9') ASC, T1.CNB ASC
	</select>
	
	<update id="RESRCM004IApvSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBRESRAD025D T1
			   SET APV_DOC_NO = #APV_DOC_NO#
			      ,APV_STA_CD = #APV_STA_CD#
			 WHERE 1=1
		]]>
		
		<isNotEmpty property="CNB">
			AND T1.EVL_YR = #EVL_YR#
			AND T1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
			AND T1.EVL_DGE = #EVL_DGE#
		   	AND T1.CNB IN
				<iterate property="CNB" open="(" close=")" conjunction=",">
					#CNB[]#
				</iterate>
		</isNotEmpty>
		
		<isEmpty property="CNB">
			AND APV_DOC_NO = #APV_DOC_NO#
		</isEmpty>
	</update>
</sqlMap> 
