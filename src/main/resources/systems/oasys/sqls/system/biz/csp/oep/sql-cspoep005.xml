<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/oep/005">

	
	<select id="CSPOEP005EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT  F_DPT_INFO(substr(A.DPT_CD,1,3)||'000','1') AS DPT_NM1      /*소속1*/
			        ,B.DPT_NM AS DPT_NM2                                        /*소속2*/
			        ,F_CODE_NM('1000173',A.RANK_CD) AS RANK_NM                  /*직급*/
			        ,A.USR_NAM                                                  /*성명*/
			        ,A.CNB                                                      /*전산번호*/
			        ,A.CAR_NO                                                   /*차량번호*/
			        ,REGEXP_REPLACE(A.HOM_TNB,'([[:digit:]]{3})([[:digit:]]{3,4})([[:digit:]]{4})','\1-\2-\3') AS HOM_TNB /*핸드폰번호*/
			        ,A.TNB                                                         /*내선번호*/
			        ,A.CAR_NO_CHG_DT
			FROM TBDCMACM001M A
			     ,TBDCMACM002M B
			WHERE A.DPT_CD = B.DPT_CD
			AND   A.DPT_CD != '880880'
			AND   A.RQS_STA_CD = '3'
			AND  substr(A.USR_ID,1,4) != 'test'
		]]>
		<dynamic>
			<isNotEmpty property="str_USR_NAM">
				AND	A.USR_NAM LIKE '%'||#str_USR_NAM#||'%'
			</isNotEmpty>
			<isNotEmpty property="str_CAR_NO">
				AND	A.CAR_NO LIKE '%'||#str_CAR_NO#||'%'
			</isNotEmpty>
			<isNotEmpty property="str_CAR_NO_CHG_DTS">
				<![CDATA[
					AND A.CAR_NO_CHG_DT >= #str_CAR_NO_CHG_DTS#
				]]>  
			</isNotEmpty>
			<isNotEmpty property="str_CAR_NO_CHG_DTE">
				<![CDATA[
					AND A.CAR_NO_CHG_DT <= #str_CAR_NO_CHG_DTE#
				]]>  
			</isNotEmpty>
			
		</dynamic>
		<![CDATA[
			ORDER BY A.DPT_CD ASC
		]]>
	</select>
	
	<update id="CSPOEP005EUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE 	TBDCMACM001M
			   SET	CAR_NO 		= REPLACE(#CAR_NO#,' ','') /*입력시 공백제거*/
					,FNL_USR_ID		= #FNL_USR_ID#
					,FNL_DEAL_DPT_CD	= #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID		= #FNL_MNU_ID#
					,CAR_NO_CHG_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
			 WHERE 	1=1
			   AND 	CNB = #CNB#
		]]>
	</update>
	
	
	<select id="CSPOEP005EOnLoad" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	TO_CHAR(SYSDATE-6,'YYYYMMDD') STRDT, TO_CHAR(SYSDATE,'YYYYMMDD') ENDDT
			FROM	DUAL
		]]>
	</select>
</sqlMap> 
