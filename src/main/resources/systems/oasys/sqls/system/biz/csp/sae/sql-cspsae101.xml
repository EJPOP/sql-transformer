<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/sae/101">

	<resultMap class="java.util.HashMap" id="hwpDocMap">
		<result property="APC_DT" column="APC_DT" jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="TXT" column="TXT" jdbcType="CLOB" javaType="java.lang.String"/>
	</resultMap>
	
	<select id="CSPSAE101ECbbYr" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
            SELECT YYYY AS YR_CD, 
                 YYYY AS YR_NM 
            FROM (
                  SELECT YR - LEVEL +2 YYYY 
                    FROM (
                 			SELECT MAX(YR) AS YR
							  FROM TBCSPSAE201M
                         ) 
                  CONNECT BY TO_CHAR(SYSDATE,'YYYY') - LEVEL + 3 >= 2000
                 )
        ]]>
	</select>

	<select id="CSPSAE101ECbbEduDvsn" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.EDU_DVSN_CD
			     , A.EDU_DVSN_NM
			 FROM TBCSPSAE101C A
			WHERE A.USE_YN = 'Y'
			ORDER BY EDU_DVSN_NM
        ]]>
	</select>
	
	<!-- 교육분류 콤보조회 -->
	<select id="CSPSAE101ECbbEduCat" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.EDU_CAT_CD
			      ,A.EDU_CAT_NM
			 FROM TBCSPSAE102C A
			WHERE A.USE_YN = 'Y' 
			  AND A.EDU_DVSN_CD = #strEDU_DVSN_CD# 
		    ORDER BY A.EDU_DVSN_CD ASC
        ]]>
	</select>

	<select id="CSPSAE101ECbbEduCrs" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
   			SELECT A.CRS_CD
   			     , A.CRS_NM
			 FROM TBCSPSAE103C A
			WHERE A.USE_YN = 'Y'
			  AND A.EDU_DVSN_CD = #strEDU_DVSN_CD# 
			  AND A.EDU_CAT_CD = #strEDU_CAT_CD# 
			  ORDER BY A.EDU_DVSN_CD ASC, A.EDU_CAT_CD ASC, A.CRS_CD ASC
        ]]>
	</select>
	
	<!-- 교육기수 조회 -->
	<select id="CSPSAE101ECbbCrsCdn" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
	   		SELECT CRS_CDN AS CD
	     	     , CRS_CDN AS NM
	      	 FROM TBCSPSAE201D
			WHERE YR = #strYr#
		      AND CRS_CD = #strEDU_CRS_CD# 		    
        ]]>
	</select>

	<select id="CSPSAE101EReportData" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
   			SELECT A.EDU_DVSN_NM	
			     , B.EDU_CAT_NM		
			     , C.CRS_NM
			     , C.CRS_CD	
			     , D.YR
			     , D.EDU_PRD_TXT
			     , D.EDU_NBC		
			     , D.ONTM_NOP_CNT	
			     , D.TOT_NOP_CNT	
			     , SUBSTR(E.EDU_STR_DT, 0, 4) || '.' || SUBSTR(E.EDU_STR_DT, 5, 2) || '.' || SUBSTR(E.EDU_STR_DT, 7, 2) || ' ~ ' ||
   			       SUBSTR(E.EDU_END_DT, 0, 4) || '.' || SUBSTR(E.EDU_END_DT, 5, 2) || '.' || SUBSTR(E.EDU_END_DT, 7, 2) AS EDU_DT
			 FROM TBCSPSAE101C A
			     , TBCSPSAE102C B
			     , TBCSPSAE103C C
			     , TBCSPSAE201M D
			     , TBCSPSAE201D E
			 WHERE B.EDU_DVSN_CD = A.EDU_DVSN_CD
			   AND C.EDU_DVSN_CD = B.EDU_DVSN_CD
			   AND C.EDU_CAT_CD	 = B.EDU_CAT_CD
			   AND D.CRS_CD 	 = C.CRS_CD
			   AND E.YR 		 = D.YR
			   AND E.CRS_CD		 = D.CRS_CD
        ]]>
        <dynamic>
	        <isNotEmpty property="strYR_CD">
	        	AND D.YR = #strYR_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_DVSN_CD">
	        	AND A.EDU_DVSN_CD = #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
	        	AND B.EDU_CAT_CD = #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
	        	AND C.CRS_CD = #strEDU_CRS_CD#
	       	</isNotEmpty>
	    </dynamic>
        <![CDATA[
          	ORDER BY A.EDU_DVSN_CD ASC, B.EDU_CAT_CD ASC, C.CRS_CD ASC, D.YR ASC, EDU_DT
        ]]>
	</select>
	
	<select id="CSPSAE101EMainList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
   			SELECT A.EDU_DVSN_NM	
			     , B.EDU_CAT_NM		
			     , C.CRS_NM
			     , C.CRS_CD	
			     , D.YR
			     , D.EDU_PRD_TXT
			     , D.EDU_NBC		
			     , D.ONTM_NOP_CNT	
			     , D.TOT_NOP_CNT	
			     , (SELECT NVL(MAX(CRS_CDN), 0) FROM TBCSPSAE201D E WHERE E.YR = D.YR AND E.CRS_CD = D.CRS_CD) AS FNL_CRS_CDN
			 FROM TBCSPSAE101C A
			     , TBCSPSAE102C B
			     , TBCSPSAE103C C
			     , TBCSPSAE201M D
			 WHERE B.EDU_DVSN_CD = A.EDU_DVSN_CD
			   AND C.EDU_DVSN_CD = B.EDU_DVSN_CD
			   AND C.EDU_CAT_CD	 = B.EDU_CAT_CD
			   AND D.CRS_CD 	 = C.CRS_CD
        ]]>
        <dynamic>
	        <isNotEmpty property="strYR_CD">
	        	AND D.YR = #strYR_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_DVSN_CD">
	        	AND A.EDU_DVSN_CD = #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
	        	AND B.EDU_CAT_CD = #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
	        	AND C.CRS_CD = #strEDU_CRS_CD#
	       	</isNotEmpty>
	    </dynamic>
        <![CDATA[
          	ORDER BY A.EDU_DVSN_CD ASC, B.EDU_CAT_CD ASC, C.CRS_CD ASC, D.YR ASC
        ]]>
	</select>
	
	<select id="CSPSAE101EMainListForSendToH" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT '' AS FLAG			/* 상태값 */
			     , D.YR					/* 년도 */
			     , A.EDU_DVSN_CD		/* 교육구분코드 */
				 , A.EDU_DVSN_NM		/* 교육구분명 */
			     , B.EDU_CAT_CD			/* 교육분류코드 */
			     , B.EDU_CAT_NM			/* 교육분류명 */
			     , C.CRS_CD				/* 과정코드 */
			     , C.CRS_NM				/* 과정명 */
			     , E.CRS_CDN			/* 기수 */
			     , D.EDU_GL_TXT			/* 교육목표내용 */
			     , D.EDU_TG_TXT			/* 교육대상내용 */
			     , E.NOP_CNT AS ONTM_NOP_CNT /* 기당인원수 */
			     , E.EDU_STR_DT			/* 교육시작일 */
			     , E.EDU_END_DT			/* 교육종료일 */
			     , D.EDU_PRD_TXT		/* 교육기간내용 */
			     , D.EDU_TXT			/* 교육내용 */
			     , D.INQ_DPT_NM			/* 문의부서명 */
			     , D.INQ_TNB			/* 문의전화번호 */
			 FROM TBCSPSAE101C A
			     , TBCSPSAE102C B
			     , TBCSPSAE103C C
			     , TBCSPSAE201M D
			     , TBCSPSAE201D E
			 WHERE B.EDU_DVSN_CD = A.EDU_DVSN_CD
			   AND C.EDU_DVSN_CD = B.EDU_DVSN_CD
			   AND C.EDU_CAT_CD	 = B.EDU_CAT_CD
			   AND D.CRS_CD 	 = C.CRS_CD
			   AND E.YR			 = D.YR
			   AND E.CRS_CD		 = D.CRS_CD
			   AND D.YR = #YRS#
			   AND REGEXP_LIKE (D.CRS_CD, #CRS_CDS#)
        ]]>
        <![CDATA[
          	ORDER BY A.EDU_DVSN_CD ASC, B.EDU_CAT_CD ASC, C.CRS_CD ASC, D.YR ASC
        ]]>
	</select>
	
	<delete id="CSPSAE101EDelMain" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE201M A
			 WHERE A.YR = #YR#
			   AND A.CRS_CD = #CRS_CD#
		]]>  
	</delete>
	
	<select id="CSPSAE101EExistCrsCdn" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(NVL(MAX(CRS_CDN), 0), 0, 'N', 'Y') EXISTYN
              FROM  TBCSPSAE201D
             WHERE CRS_CD = #CRS_CD#
               AND YR = #YR#
        ]]>
	</select>
	
	<select id="CSPSAE102EMainList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
          SELECT    A.EDU_DVSN_CD
                  , B.EDU_CAT_CD
                  , C.CRS_CD
                  , D.YR
				  , D.EDU_TG_TXT
				  , D.EDU_PRD_TXT
				  , D.ONTM_NOP_CNT
				  , D.EDU_NBC
				  , D.TOT_NOP_CNT
				  , D.CHR_DPT_NM
				  , D.CHR_TNB
				  , D.INQ_DPT_NM
				  , D.INQ_TNB
				  , D.EDU_GL_TXT
				  , D.EDU_TXT
				  , D.EAN
            FROM   TBCSPSAE101C A
			     , TBCSPSAE102C B
			     , TBCSPSAE103C C
			     , TBCSPSAE201M D
			 WHERE B.EDU_DVSN_CD = A.EDU_DVSN_CD
			   AND C.EDU_DVSN_CD = B.EDU_DVSN_CD
			   AND C.EDU_CAT_CD	 = B.EDU_CAT_CD
			   AND D.CRS_CD 	 = C.CRS_CD
               AND D.YR = #strYR_CD#
               AND D.CRS_CD = #strEDU_CRS_CD#
        ]]>
	</select>
	
	<select id="CSPSAE102ESubList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
          SELECT    YR
				  , CRS_CD
				  , CRS_CDN AS VCRS_CDN
				  , CRS_CDN
				  , NOP_CNT
				  , EDU_STR_DT
				  , EDU_END_DT
				  , SV_DT
				  , CRS_CHIF_NM
				  , SU_CRS_CHIF_NM
				  , REG_STR_DT
				  , REG_END_DT
				  , REG_OPEN_YN
				  , INCLUDE_SC
				  , LCT_NM
				  , LCT_PLACE
            FROM  TBCSPSAE201D
           WHERE  YR = #strYR_CD#
             AND  CRS_CD = #strEDU_CRS_CD#
        ]]>
	</select>	
	
	
	<insert id="CSPSAE102EInsertMain" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPSAE201M
			(
					YR
				  , CRS_CD
				  , EDU_TG_TXT
				  , EDU_PRD_TXT
				  , ONTM_NOP_CNT
				  , EDU_NBC
				  , TOT_NOP_CNT
				  , CHR_DPT_NM
				  , CHR_TNB
				  , INQ_DPT_NM
				  , INQ_TNB
				  , EDU_GL_TXT
				  , EDU_TXT
				  , EAN
				  , FRT_USR_ID
				  , FNL_USR_ID
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID
				  , FRT_REGI_DH
				  , FNL_MDF_DH
			) VALUES (
					#YR#
				  , #CRS_CD#
				  , #EDU_TG_TXT#
				  , #EDU_PRD_TXT#
   				  , #ONTM_NOP_CNT#
				  , #EDU_NBC#
				  , #TOT_NOP_CNT#
				  , #CHR_DPT_NM#
				  , #CHR_TNB#
				  , #INQ_DPT_NM#
				  , #INQ_TNB#
				  , #EDU_GL_TXT#
				  , #EDU_TXT#
				  , #EAN#
				  , #FRT_USR_ID#
				  , #FNL_USR_ID#
				  , #FNL_DEAL_DPT_CD#
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE
			)
        ]]>
	</insert>
	
	<insert id="CSPSAE102EInsertSub" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPSAE201D
			(
				    YR
				  , CRS_CD
				  , CRS_CDN
				  , NOP_CNT
				  , EDU_STR_DT
				  , EDU_END_DT
				  , SV_DT
				  , CRS_CHIF_NM
				  , SU_CRS_CHIF_NM
				  , FRT_USR_ID
				  , FNL_USR_ID
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID
				  , FRT_REGI_DH
				  , FNL_MDF_DH
				  , REG_STR_DT
				  , REG_END_DT
				  , REG_OPEN_YN
				  , INCLUDE_SC
				  , LCT_NM
				  , LCT_PLACE
			) VALUES (
				    #YR#
				  , #CRS_CD#
				  , #VCRS_CDN#
				  , #NOP_CNT#
				  , #EDU_STR_DT#
				  , #EDU_END_DT#
				  , #SV_DT#
				  , #CRS_CHIF_NM#
				  , #SU_CRS_CHIF_NM#
				  , #FRT_USR_ID#
				  , #FNL_USR_ID#
				  , #FNL_DEAL_DPT_CD#
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE
				  , #REG_STR_DT#
				  , #REG_END_DT#
				  , #REG_OPEN_YN#
				  , #INCLUDE_SC#
				  , #LCT_NM#
				  , #LCT_PLACE#
			)
        ]]>
	</insert>
	
	<update id="CSPSAE102EUpdateMain" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE201M
			SET		EDU_TG_TXT 	  	= #EDU_TG_TXT#,
					EDU_PRD_TXT   	= #EDU_PRD_TXT#,
					ONTM_NOP_CNT  	= #ONTM_NOP_CNT#,
					EDU_NBC       	= #EDU_NBC#,
					TOT_NOP_CNT   	= #TOT_NOP_CNT#,
					CHR_DPT_NM    	= #CHR_DPT_NM#,
					CHR_TNB       	= #CHR_TNB#,
					INQ_DPT_NM    	= #INQ_DPT_NM#,
					INQ_TNB       	= #INQ_TNB#,
					EDU_GL_TXT    	= #EDU_GL_TXT#,
					EDU_TXT       	= #EDU_TXT#,
					EAN				= #EAN#,
					FNL_USR_ID 	  	= #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID 		= #FNL_MNU_ID#,
					FNL_MDF_DH 		= SYSDATE
			WHERE	YR = #YR#
			  AND   CRS_CD = #CRS_CD# 
		]]>
	</update>
	
	<update id="CSPSAE102EUpdateSub" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE201D
			SET		NOP_CNT         = #NOP_CNT#,
				    EDU_STR_DT      = #EDU_STR_DT#,
				    EDU_END_DT      = #EDU_END_DT#,
				    SV_DT           = #SV_DT#,
				    CRS_CHIF_NM     = #CRS_CHIF_NM#,
				    SU_CRS_CHIF_NM  = #SU_CRS_CHIF_NM#,
					FNL_USR_ID      = #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID      = #FNL_MNU_ID#,
					FNL_MDF_DH      = SYSDATE,
					REG_STR_DT      = #REG_STR_DT#,
				    REG_END_DT      = #REG_END_DT#,
				    REG_OPEN_YN     = #REG_OPEN_YN#,
				    INCLUDE_SC      = #INCLUDE_SC#,
				  	LCT_NM          = #LCT_NM#,
				  	LCT_PLACE       = #LCT_PLACE#
			WHERE	YR              = #YR#
			  AND   CRS_CD          = #CRS_CD#
			  AND   CRS_CDN         = #CRS_CDN#
		]]>
	</update>
	
	<select id="CSPSAE102EExistCrsCdnInfo" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT SUM(CNT)
			  FROM (
					SELECT COUNT(YR) AS CNT FROM TBCSPSAE202D
					WHERE 1=1
					AND YR = #YR#
					AND CRS_CD = #CRS_CD#
					AND CRS_CDN = #CRS_CDN#
					UNION
					SELECT COUNT(YR) AS CNT FROM TBCSPSAE203D
					WHERE 1=1
					AND YR = #YR#
					AND CRS_CD = #CRS_CD#
					AND CRS_CDN = #CRS_CDN#
					UNION
					SELECT COUNT(YR) AS CNT FROM TBCSPSAE401D
					WHERE 1=1
					AND YR = #YR#
					AND CRS_CD = #CRS_CD#
					AND CRS_CDN = #CRS_CDN#
					UNION
					SELECT COUNT(YR) AS CNT FROM TBCSPSAE101D
					WHERE 1=1
					AND YR = #YR#
					AND CRS_CD = #CRS_CD#
					AND CRS_CDN = #CRS_CDN#
					UNION
					SELECT COUNT(YR) AS CNT FROM TBCSPSAE305D
					WHERE 1=1
					AND YR = #YR#
					AND CRS_CD = #CRS_CD#
					AND CRS_CDN = #CRS_CDN#
					UNION
					SELECT COUNT(YR) AS CNT FROM TBCSPSAE301D
					WHERE 1=1
					AND YR = #YR#
					AND CRS_CD = #CRS_CD#
					AND CRS_CDN = #CRS_CDN#
					UNION
					SELECT COUNT(YR) AS CNT FROM TBCSPSAE303D
					WHERE 1=1
					AND YR = #YR#
					AND CRS_CD = #CRS_CD#
					AND CRS_CDN = #CRS_CDN#
					UNION
					SELECT COUNT(YR) AS CNT FROM TBCSPSAE302D
					WHERE 1=1
					AND YR = #YR#
					AND CRS_CD = #CRS_CD#
					AND CRS_CDN = #CRS_CDN#
				)
        ]]>
	</select>

	<delete id="CSPSAE102EDelSub" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE201D A
			 WHERE A.YR              = #YR#
			   AND A.CRS_CD          = #CRS_CD#
			   AND A.CRS_CDN         = #CRS_CDN#
		]]>  
	</delete>
	
	<select id="CSPSAE106PMainList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT SUBSTR(D.EDU_STR_DT, 0, 6) AS YM
			     , A.EDU_DVSN_CD
			     , A.EDU_DVSN_NM
			     , B.EDU_CAT_CD
			     , B.EDU_CAT_NM
			     , C.CRS_CD
			     , C.CRS_NM
			     , D.CRS_CDN
			     , D.EDU_STR_DT
			     , D.EDU_END_DT
			     , SUBSTR(D.EDU_STR_DT, 0, 4)||'-'||SUBSTR(D.EDU_STR_DT, 5, 2)||'-'||SUBSTR(D.EDU_STR_DT, 7, 2)||' ~ '||SUBSTR(D.EDU_END_DT, 0,4)||'-'||SUBSTR(D.EDU_END_DT, 5,2)||'-'||SUBSTR(D.EDU_END_DT, 7,2) AS EDU_DT
			     , DECODE((SELECT COUNT(*) FROM TBCSPSAE101D E WHERE E.YR = D.YR AND E.CRS_CDN = D.CRS_CDN AND E.CRS_CD = D.CRS_CD), 0, 'N', 'Y') AS YN
			  FROM TBCSPSAE101C A
			     , TBCSPSAE102C B
			     , TBCSPSAE103C C
			     , TBCSPSAE201D D
			WHERE B.EDU_DVSN_CD = A.EDU_DVSN_CD
			  AND C.EDU_DVSN_CD = B.EDU_DVSN_CD
			  AND C.EDU_CAT_CD  = B.EDU_CAT_CD
			  AND D.CRS_CD 		= C.CRS_CD
        ]]>
        <dynamic>
	        <isNotEmpty property="strFromYm">
	        	<isNotEmpty property="strToYm">
					AND SUBSTR(D.EDU_STR_DT, 0, 6) BETWEEN SUBSTR(#strFromYm#, 0, 6) AND SUBSTR(#strToYm#, 0, 6)
				</isNotEmpty>
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_DVSN_CD">
				AND A.EDU_DVSN_CD = #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
				AND B.EDU_CAT_CD = #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
				AND C.CRS_CD = #strEDU_CRS_CD#
	       	</isNotEmpty>
			<isNotEmpty property="strCRS_CDN">
				AND D.CRS_CDN = #strCRS_CDN#
	       	</isNotEmpty>
	       	<isEqual property="strYN" compareValue="Y">
	       		AND C.CRS_CD IN (SELECT DISTINCT(E.CRS_CD) FROM TBCSPSAE101D E WHERE E.YR = D.YR AND E.CRS_CDN = D.CRS_CDN AND E.CRS_CD = D.CRS_CD)
	       	</isEqual>
	       	<isEqual property="strYN" compareValue="N">
	       		AND C.CRS_CD NOT IN (SELECT DISTINCT(E.CRS_CD) FROM TBCSPSAE101D E WHERE E.YR = D.YR AND E.CRS_CDN = D.CRS_CDN AND E.CRS_CD = D.CRS_CD)
	       	</isEqual>
	    </dynamic>
        <![CDATA[
			ORDER BY D.EDU_STR_DT, A.EDU_DVSN_CD, B.EDU_CAT_CD, C.CRS_CD, D.CRS_CDN
        ]]>
	</select>
	
	<select id="CSPSAE103PCbbBfYr" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT DISTINCT(YR) AS YR_CD
			     , YR AS YR_NM
			  FROM TBCSPSAE201M
			ORDER BY YR DESC
        ]]>
	</select>
	
	<select id="CSPSAE103PCbbAfYr" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
            SELECT YYYY AS YR_CD, 
                 YYYY AS YR_NM 
            FROM (
                  SELECT YR - LEVEL +2 YYYY 
                    FROM (
                 			SELECT MAX(YR) AS YR
							  FROM TBCSPSAE201M
                         ) 
                  CONNECT BY YR - LEVEL +2 >= YR
                 )
        ]]>
	</select>
	
	<select id="CSPSAE103PExistYn" parameterClass="paramMap" resultClass="String">
        <![CDATA[
 			SELECT DECODE(COUNT(*), 0, 'N', 'Y') EXIST_YN FROM TBCSPSAE201D where YR = #strAfYr#;
        ]]>
	</select>
	
	<insert id="CSPSAE103PCopy" parameterClass="paramMap">
        <![CDATA[
			 INSERT INTO TBCSPSAE201M(
			        YR
			      , CRS_CD
			      , EDU_TG_TXT
			      , EDU_PRD_TXT
			      , ONTM_NOP_CNT
			      , EDU_NBC
			      , TOT_NOP_CNT
			      , CHR_DPT_NM
			      , CHR_TNB
			      , INQ_DPT_NM
			      , INQ_TNB
			      , EDU_GL_TXT
			      , EDU_TXT
			      , EAN
			      , FRT_USR_ID
			      , FNL_USR_ID
			      , FNL_DEAL_DPT_CD
			      , FNL_MNU_ID
			      , FRT_REGI_DH
			      , FNL_MDF_DH)
	        SELECT #strAfYr#
	      	       , CRS_CD
		           , EDU_TG_TXT
		           , EDU_PRD_TXT
		           , ONTM_NOP_CNT
		           , EDU_NBC
		           , TOT_NOP_CNT
		           , CHR_DPT_NM
		           , CHR_TNB
		           , INQ_DPT_NM
		           , INQ_TNB
		           , EDU_GL_TXT
		           , EDU_TXT
		           , EAN
		           , #FRT_USR_ID#
		           , #FNL_USR_ID#
		           , #FNL_DEAL_DPT_CD#
		           , #FNL_MNU_ID#
		           ,SYSDATE
		           ,SYSDATE
	        FROM TBCSPSAE201M
	       WHERE YR = #strBfYr#
        ]]>
	</insert>
	
	<delete id="CSPSAE103PCopyCancel" parameterClass="paramMap">
		<![CDATA[
			 DELETE FROM TBCSPSAE201M
			 WHERE YR = #strAfYr#
		]]>  
	</delete>

	<select id="CSPSAE104QCbbCrsCdn" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[        
	   		SELECT CRS_CDN AS CD
	     	     , CRS_CDN AS NM
	      	 FROM TBCSPSAE201D
			WHERE EDU_STR_DT >= #strFromYm#
			  AND EDU_END_DT <= #strToYm#
		      AND CRS_CD = #strEDU_CRS_CD#
		    ORDER BY CD
        ]]>
	</select>

	<select id="CSPSAE104QMainList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT SUBSTR(D.EDU_STR_DT, 0, 4) AS YR
			     , A.EDU_DVSN_CD
			     , A.EDU_DVSN_NM
			     , B.EDU_CAT_CD
			     , B.EDU_CAT_NM
			     , C.CRS_CD
			     , C.CRS_NM
			     , D.CRS_CDN
			     , D.EDU_STR_DT
			     , D.EDU_END_DT
			     , SUBSTR(D.EDU_STR_DT, 0, 4)||'-'||SUBSTR(D.EDU_STR_DT, 5, 2)||'-'||SUBSTR(D.EDU_STR_DT, 7, 2)||' ~ '||SUBSTR(D.EDU_END_DT, 0,4)||'-'||SUBSTR(D.EDU_END_DT, 5,2)||'-'||SUBSTR(D.EDU_END_DT, 7,2) AS EDU_DT
			  FROM TBCSPSAE101C A
			     , TBCSPSAE102C B
			     , TBCSPSAE103C C
			     , TBCSPSAE201D D
			WHERE B.EDU_DVSN_CD = A.EDU_DVSN_CD
			  AND C.EDU_DVSN_CD = B.EDU_DVSN_CD
			  AND C.EDU_CAT_CD  = B.EDU_CAT_CD
			  AND D.CRS_CD 		= C.CRS_CD
        ]]>
        <dynamic>
	        <isNotEmpty property="strFromYm">
	        	<isNotEmpty property="strToYm">
					AND SUBSTR(D.EDU_STR_DT, 0, 6) BETWEEN SUBSTR(#strFromYm#, 0, 6) AND SUBSTR(#strToYm#, 0, 6)
				</isNotEmpty>
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_DVSN_CD">
				AND A.EDU_DVSN_CD = #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
				AND B.EDU_CAT_CD = #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
				AND C.CRS_CD = #strEDU_CRS_CD#
	       	</isNotEmpty>
			<isNotEmpty property="strCRS_CDN">
				AND D.CRS_CDN = #strCRS_CDN#
	       	</isNotEmpty>
	    </dynamic>
        <![CDATA[
			ORDER BY D.EDU_STR_DT, A.EDU_DVSN_CD, B.EDU_CAT_CD, C.CRS_CD, D.CRS_CDN
        ]]>
	</select>

	<!-- 화면로드시 운영중인 교과목 조회 -->
	<select id="CSPSAE105ENearInfo" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
				SELECT    YR
				        , EDU_DVSN_CD
				        , EDU_CAT_CD
				        , CRS_CD
   				        , CRS_CDN
   				        , SV_DT
				FROM    
				(
				SELECT    D1.YR
				        , D1.CRS_CD
				        , D1.CRS_CDN
				        , T1.EDU_DVSN_CD
				        , T2.EDU_CAT_CD
				        , TRUNC(TO_DATE(D1.EDU_STR_DT, 'YYYYMMDD') - SYSDATE) AS DAY_C
				        , D1.SV_DT
				FROM    TBCSPSAE201D D1
				      , TBCSPSAE101C T1
				      , TBCSPSAE102C T2
				      , TBCSPSAE103C T3
				WHERE    D1.EDU_STR_DT > TO_CHAR(SYSDATE, 'YYYYMMDD')
				  AND  T3.CRS_CD = D1.CRS_CD
				  AND  T2.EDU_CAT_CD = T3.EDU_CAT_CD
				  AND  T2.EDU_DVSN_CD = T3.EDU_DVSN_CD
				  AND  T1.EDU_DVSN_CD = T2.EDU_DVSN_CD
				ORDER BY DAY_C, CRS_CDN
				)
				WHERE    ROWNUM = 1;
        ]]>
	</select>

	<!-- 일정조회 -->
	<select id="CSPSAE105EEduDate" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT EDU_STR_DT
			     , EDU_END_DT
			 FROM TBCSPSAE201D C
			WHERE YR = #strYR_CD#
			  AND CRS_CD = #strEDU_CRS_CD#
			  AND CRS_CDN = #strCRS_CDN#
        ]]>
	</select>
	
	<select id="CSPSAE105EBscSubjList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT B.YR /* CSPSAE105EBscSubjList */
			     , B.CRS_CD
			     , B.CRS_CDN
			     , B.SUBJ_SNO
			     , B.SUBJ_CD
			     , A.SUBJ_NM
			     , B.LCT_TM_HM
			     , B.JON_TM_HM
			     , B.ETC_TM_HM
			     , SUM(B.LCT_TM_HM + B.JON_TM_HM + B.ETC_TM_HM) AS TOT_TM_HM
			     , 'U' AS FLAG
			     , B.SUBJ_YN
			     , B.PFSR_ID
			  FROM TBCSPSAE101M A
			     , TBCSPSAE101D B
			WHERE A.SUBJ_CD = B.SUBJ_CD
			  AND A.USE_YN = 'Y'
			  AND B.SUBJ_YN = 'N'
			  AND B.YR = #strYR_CD#
			  AND B.CRS_CD = #strEDU_CRS_CD#
			  AND B.CRS_CDN = #strCRS_CDN#
			GROUP BY B.YR
			     , B.CRS_CD
			     , B.CRS_CDN
			     , B.SUBJ_SNO
			     , B.SUBJ_CD
			     , A.SUBJ_NM
			     , B.LCT_TM_HM
			     , B.JON_TM_HM
			     , B.ETC_TM_HM
			     , B.SUBJ_YN
			     , B.PFSR_ID
		  ORDER BY TO_NUMBER(B.SUBJ_SNO)
        ]]>
	</select>
	
	<select id="CSPSAE105ENewBscSubj" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.YR /* CSPSAE105ENewBscSubj */
			     , A.CRS_CD
			     , A.CRS_CDN
			     , A.SUBJ_SNO
			     , A.SUBJ_CD
			     , A.SUBJ_NM
			     , A.LCT_TM_HM
			     , A.JON_TM_HM
			     , A.ETC_TM_HM
			     , A.TOT_TM_HM
			     , A.FLAG
			     , A.SUBJ_YN
			     , A.PFSR_ID
			  FROM ( 
					SELECT    #strYR_CD# AS YR
						    , #strEDU_CRS_CD# AS CRS_CD
						    , #strCRS_CDN# AS CRS_CDN
						    , rownum AS SUBJ_SNO
						    , SUBJ_CD
						    , SUBJ_NM
						    , '' AS LCT_TM_HM
						    , '' AS JON_TM_HM
						    , '' AS ETC_TM_HM
						    , '' AS TOT_TM_HM
						    , 'I' AS FLAG
						    , 'N' AS SUBJ_YN
						    , NULL AS PFSR_ID
					    FROM TBCSPSAE101M
					   WHERE BSC_OP_SUBJ_YN = 'Y'
					     AND USE_YN = 'Y'
					ORDER BY SUBJ_CD
					) A
			ORDER BY A.SUBJ_SNO
        ]]>
	</select>
	
	<select id="CSPSAE105ESubjList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			select AA.YR /* CSPSAE105ESubjList */,
			       AA.CRS_CD ,
			       AA.CRS_CDN ,
			       AA.SUBJ_SNO ,
			       AA.SUBJ_CD ,
			       AA.SUBJ_NM ,
			       AA.LCT_TM_HM ,
			       AA.JON_TM_HM ,
			       AA.ETC_TM_HM ,
			       AA.TOT_TM_HM ,
			       AA.PFSR_ID ,
			       AA.NAM ,
			       AA.PFSR_DVSN_CD ,
			       AA.PFSR_RK_CD ,
			       AA.SUBJ_YN, 
			       AA.DOC_ID_2,
			       AA.KEYW1_TXT,
			       AA.KEYW2_TXT,
			       AA.KEYW3_TXT,
			       BB.FILE_NAME
			from(
			SELECT B.YR ,
			       B.CRS_CD ,
			       B.CRS_CDN ,
			       B.SUBJ_SNO ,
			       B.SUBJ_CD ,
			       A.SUBJ_NM ,
			       B.LCT_TM_HM ,
			       B.JON_TM_HM ,
			       B.ETC_TM_HM ,
			       SUM(B.LCT_TM_HM + B.JON_TM_HM + B.ETC_TM_HM) AS TOT_TM_HM ,
			       B.PFSR_ID ,
			       D.NAM ,
			       D.PFSR_DVSN_CD ,
			       D.PFSR_RK_CD ,
			       B.SUBJ_YN, 
			       B.DOC_ID_2, 
			       B.KEYW1_TXT,
			       B.KEYW2_TXT,
			       B.KEYW3_TXT
			  FROM TBCSPSAE101M A ,
			       TBCSPSAE101D B ,
			       TBCSPSAE109M D 			             
			 WHERE A.SUBJ_CD = B.SUBJ_CD
			   AND D.PFSR_ID(+) = B.PFSR_ID			         
			   AND A.USE_YN = 'Y'
			   AND B.SUBJ_YN = 'Y'
			   AND B.YR = #strYR_CD#
			   AND B.CRS_CD = #strEDU_CRS_CD#
			   AND B.CRS_CDN = #strCRS_CDN#
			 GROUP BY B.YR ,
			       B.CRS_CD ,
			       B.CRS_CDN ,
			       B.SUBJ_SNO ,
			       B.SUBJ_CD ,
			       A.SUBJ_NM ,
			       B.LCT_TM_HM ,
			       B.JON_TM_HM ,
			       B.ETC_TM_HM ,
			       B.PFSR_ID ,
			       D.NAM ,
			       D.PFSR_DVSN_CD ,
			       D.PFSR_RK_CD ,
			       B.SUBJ_YN,
			       B.DOC_ID_2,
			       B.KEYW1_TXT,
                   B.KEYW2_TXT,
                   B.KEYW3_TXT    
			 ORDER BY TO_NUMBER(B.SUBJ_SNO) 
			 ) AA
			 , ECM_FILE_LIST_VIEW2 BB
			 where 1=1
			 and AA.DOC_ID_2 = BB.DOC_ID(+)
        ]]>
	</select>
	
	<select id="CSPSAE105ESubjListForSendToH" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT '' AS FLAG /* CSPSAE105ESubjListForSendToH */		/* 상태값 */ 
			     , B.YR				/* 년도 */
			     , B.CRS_CD			/* 과정코드 */
			     , B.CRS_CDN		/* 과정기수 */
			     , B.SUBJ_SNO		/* 과목순번 */
			     , B.SUBJ_CD		/* 과목코드 */
			     , A.SUBJ_NM		/* 과목명 */
			     , B.LCT_TM_HM		/* 강의시간 */
			     , B.JON_TM_HM		/* 참여시간 */
			     , B.ETC_TM_HM		/* 기타시간 */
			     , B.PFSR_ID		/* 강사ID */
			     , B.SUBJ_YN		/* 과목여부 */
			  FROM TBCSPSAE101M A
			     , TBCSPSAE101D B
			WHERE A.SUBJ_CD = B.SUBJ_CD
			  AND A.USE_YN = 'Y'
			  AND B.SUBJ_YN = 'Y'
			  AND B.YR = #strYR_CD#
			  AND B.CRS_CD = #strEDU_CRS_CD#
			  AND B.CRS_CDN = #strCRS_CDN#
		 ORDER BY TO_NUMBER(B.SUBJ_SNO)
        ]]>
	</select>

	<insert id="CSPSAE105EInsertSubj" parameterClass="paramMap">
        <![CDATA[
		INSERT INTO TBCSPSAE101D
		           (YR
		          , CRS_CD
		          , CRS_CDN
		          , SUBJ_CD
		          , LCT_TM_HM
		          , JON_TM_HM
		          , ETC_TM_HM
		          , SUBJ_SNO
		          , SUBJ_YN
		          , PFSR_ID
		          , FRT_USR_ID
		          , FNL_USR_ID
		          , FNL_DEAL_DPT_CD
		          , FNL_MNU_ID
		          , FRT_REGI_DH
		          , FNL_MDF_DH
		          , DOC_ID_2
		          , KEYW1_TXT
		          , KEYW2_TXT
		          , KEYW3_TXT
		) VALUES (  #YR#
                  , #CRS_CD#
		          , #CRS_CDN#
		          , #SUBJ_CD#
		          , NVL(#LCT_TM_HM#, 0)
		          , NVL(#JON_TM_HM#, 0)
		          , NVL(#ETC_TM_HM#, 0)
		          , #SUBJ_SNO#
		          , #SUBJ_YN#
		          , #PFSR_ID#
		          , #FRT_USR_ID#
		          , #FNL_USR_ID#
		          , #FNL_DEAL_DPT_CD#
		          , #FNL_MNU_ID#
		          , SYSDATE
		          , SYSDATE
		          , #DOC_ID_2#
		          , #KEYW1_TXT#
		          , #KEYW2_TXT#
		          , #KEYW3_TXT#
		          )
        ]]>
	</insert>
	
	<update id="CSPSAE105EUpdateSubj" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE101D
			SET		SUBJ_CD         = #SUBJ_CD#
		          , LCT_TM_HM       = NVL(#LCT_TM_HM#, 0)
		          , JON_TM_HM       = NVL(#JON_TM_HM#, 0)
		          , ETC_TM_HM       = NVL(#ETC_TM_HM#, 0)
		          , SUBJ_SNO        = #SUBJ_SNO#
		          , SUBJ_YN         = #SUBJ_YN#
		          , PFSR_ID         = #PFSR_ID#
		          , FNL_USR_ID      = #FNL_USR_ID#
		          , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		          , FNL_MNU_ID      = #FNL_MNU_ID#
		          , FNL_MDF_DH      = SYSDATE
		          , DOC_ID_2		= #DOC_ID_2#
		          , KEYW1_TXT		= #KEYW1_TXT#
		          , KEYW2_TXT		= #KEYW2_TXT#
		          , KEYW3_TXT		= #KEYW3_TXT#
			WHERE	YR       		= #YR#
		      AND   CRS_CD   		= #CRS_CD#
		      AND   CRS_CDN	 		= #CRS_CDN#
		      AND 	SUBJ_CD         = #SUBJ_CD#
		]]>
	</update>
	
	<select id="CSPSAE105EExistYnSubjInTT" parameterClass="paramMap" resultClass="String">
		<![CDATA[
		   SELECT DECODE(COUNT(*), 0, 'N', 'Y') AS EXIST_YN FROM TBCSPSAE202D
			WHERE YR = #YR#
			  AND CRS_CD = #CRS_CD#
			  AND CRS_CDN = #CRS_CDN#
			  AND SUBJ_CD = #SUBJ_CD#;
		]]>
	</select>
	
	
	<delete id="CSPSAE105EDeleteSubj" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE101D
			WHERE	YR       		= #YR#
		      AND   CRS_CD   		= #CRS_CD#
		      AND   CRS_CDN	 		= #CRS_CDN#
		      AND   SUBJ_CD			= #SUBJ_CD#
		]]>  
	</delete>
	
	<delete id="CSPSAE105EDeleteSubjSvInfo" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE304D
			WHERE	YR       		= #YR#
		      AND   CRS_CD   		= #CRS_CD#
		      AND   CRS_CDN	 		= #CRS_CDN#
		      AND   SUBJ_CD			= #SUBJ_CD#
		]]>  
	</delete>
	
	<select id="CSPSAE105ETimeTableCount" parameterClass="paramMap"	resultClass="String">
		<![CDATA[       
			SELECT COUNT(*) AS TOT_CNT
			  FROM (
			        SELECT DISTINCT(SUBSTRING(B.DT, 0, 4) || '-' || SUBSTRING(B.DT, 5, 2) || '-' || SUBSTRING(B.DT, 7, 2) || '(' || SUBSTRING(UPPER(TO_CHAR(TO_DATE(B.DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) || ')') AS DATE_NAME
					  FROM (
							SELECT TO_CHAR(TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') + (LEVEL-1), 'YYYYMMDD') AS DT
							FROM (
							      SELECT EDU_STR_DT
							           , EDU_END_DT
									FROM TBCSPSAE201D
							       WHERE YR = #strYR_CD#
									 AND CRS_CD = #strEDU_CRS_CD#
									 AND CRS_CDN = #strCRS_CDN#
							     ) A
							CONNECT BY LEVEL <= (TO_DATE(A.EDU_END_DT, 'YYYYMMDD')+1) - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD')
						) B
					WHERE SUBSTRING(UPPER(TO_CHAR(TO_DATE(B.DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) NOT IN ('일', '토')
					ORDER BY DATE_NAME
					)
		]]>
	</select>
	
	<select id="CSPSAE105ETimeHeaderExcel" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
  				SELECT DISTINCT(SUBSTRING(B.DT, 0, 4) || '-' || SUBSTRING(B.DT, 5, 2) || '-' || SUBSTRING(B.DT, 7, 2) || '(' || SUBSTRING(UPPER(TO_CHAR(TO_DATE(B.DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) || ')') AS DATE_NAME
				FROM (
						SELECT TO_CHAR(TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') + LEVEL-1, 'YYYYMMDD') AS DT
                      FROM ( SELECT EDU_STR_DT,
                                    EDU_END_DT
                               FROM TBCSPSAE201D
                              WHERE YR = #strYR_CD#
                                AND CRS_CD = #strEDU_CRS_CD#
                                AND CRS_CDN = #strCRS_CDN#) A
                    CONNECT BY LEVEL <= TO_DATE(A.EDU_END_DT, 'YYYYMMDD') - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') +1
					) B
				WHERE SUBSTRING(UPPER(TO_CHAR(TO_DATE(B.DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) NOT IN ('일', '토')
				ORDER BY DATE_NAME
        ]]>
	</select>
	
	<select id="CSPSAE105ETimeHeaderList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
  				SELECT DISTINCT(SUBSTRING(B.DT, 0, 4) || '-' || SUBSTRING(B.DT, 5, 2) || '-' || SUBSTRING(B.DT, 7, 2) || '(' || SUBSTRING(UPPER(TO_CHAR(TO_DATE(B.DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) || ')') AS DATE_NAME
				FROM (
						SELECT TO_CHAR((TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') + (#currPage# - 1) * 7) + LEVEL-1, 'YYYYMMDD') AS DT
                      FROM ( SELECT EDU_STR_DT,
                                    EDU_END_DT
                               FROM TBCSPSAE201D
                              WHERE YR = #strYR_CD#
                                AND CRS_CD = #strEDU_CRS_CD#
                                AND CRS_CDN = #strCRS_CDN#) A
                    CONNECT BY LEVEL <= TO_DATE(A.EDU_END_DT, 'YYYYMMDD') - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') - (#currPage# - 1) * 7 +1
                     AND ROWNUM <= 7
					) B
				WHERE SUBSTRING(UPPER(TO_CHAR(TO_DATE(B.DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) NOT IN ('일', '토')
				ORDER BY DATE_NAME
        ]]>
	</select>
	
	<select id="CSPSAE105ETimeListExcel" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
				SELECT    MAX(D4.TT) AS TT
				        , REPLACE(AGGR_CONCAT( NVL(D5.SUBJ_NM, '%%'), '@' ORDER BY D4.LCT_DT ), '%%', '-') AS SUBJ_NM
				FROM    (
				            SELECT    D6.SRT_SNO
				                    , D6.TT
	                                , D6.HUC_STR_HM
	                                , D6.HUC_END_HM
				                    , D7.LCT_DT
				            FROM    (
				                        SELECT    D1.SRT_SNO
				                                , SUBSTRING(D1.HUC_STR_HM, 0, 2) || ':' || SUBSTRING(D1.HUC_STR_HM, 3, 4) || ' ~ ' || SUBSTRING(D1.HUC_END_HM, 0, 2) || ':' || SUBSTRING(D1.HUC_END_HM, 3, 4) || DECODE(D1.HUC_TXT, '중식', '    (중식)', NULL) AS TT
				                                , D1.HUC_STR_HM
				                                , D1.HUC_END_HM
				                        FROM    TBCSPSAE111B D1
				                    ) D6
				                  , ( 
				                      SELECT TO_CHAR(TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') + LEVEL-1, 'YYYYMMDD') AS LCT_DT
				                      FROM ( SELECT EDU_STR_DT,
				                                    EDU_END_DT
				                               FROM TBCSPSAE201D
				                              WHERE YR = #strYR_CD#
				                                AND CRS_CD = #strEDU_CRS_CD#
				                                AND CRS_CDN = #strCRS_CDN#) A
				                    CONNECT BY LEVEL <= TO_DATE(A.EDU_END_DT, 'YYYYMMDD') - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD')  +1
				                    ) D7
				           WHERE SUBSTRING(UPPER(TO_CHAR(TO_DATE(D7.LCT_DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) NOT IN ('토', '일')
				        ) D4
				        , ( 
				            SELECT    D2.YR
				                    , D2.CRS_CD
				                    , D2.CRS_CDN
				                    , D2.HUC_TXT
				                    , D2.LCT_DT
				                    , D2.SUBJ_CD
				                    , D3.SUBJ_NM
				                    , D2.RMK
				            FROM    TBCSPSAE202D D2
				                    , TBCSPSAE101M D3
				            WHERE    D2.SUBJ_CD = D3.SUBJ_CD
				            AND        D2.YR = #strYR_CD#
				            AND        D2.CRS_CD = #strEDU_CRS_CD#
				            AND        D2.CRS_CDN = #strCRS_CDN#
				        ) D5
				WHERE    D4.SRT_SNO = D5.HUC_TXT(+)
				AND      D4.LCT_DT = D5.LCT_DT(+)
				GROUP BY SRT_SNO, HUC_STR_HM, HUC_END_HM
        ]]>
	</select>
	
	<select id="CSPSAE105ETimeList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
				SELECT    #strYR_CD# AS YR
				        , #strEDU_CRS_CD# AS CRS_CD
				        , #strCRS_CDN# AS CRS_CDN
				        , D4.SRT_SNO
				        , MAX(D4.TT) AS TT
				        , D4.HUC_STR_HM
				        , D4.HUC_END_HM
				        , AGGR_CONCAT( D4.LCT_DT, '@' ORDER BY D4.LCT_DT ) AS LCT_DT
				        , REPLACE(AGGR_CONCAT( NVL(D5.SUBJ_CD, '%%'), '@' ORDER BY D4.LCT_DT ), '%%', '') AS SUBJ_CD
				        , REPLACE(AGGR_CONCAT( NVL(D5.SUBJ_NM, '%%'), '@' ORDER BY D4.LCT_DT ), '%%', '') AS SUBJ_NM
						, REPLACE(AGGR_CONCAT( NVL(D5.RMK, '%%'), '@' ORDER BY D4.LCT_DT ), '%%', '') AS RMK
				FROM    (
				            SELECT    D6.SRT_SNO
				                    , D6.TT
	                                , D6.HUC_STR_HM
	                                , D6.HUC_END_HM
				                    , D7.LCT_DT
				            FROM    (
				                        SELECT    D1.SRT_SNO
				                                , SUBSTRING(D1.HUC_STR_HM, 0, 2) || ':' || SUBSTRING(D1.HUC_STR_HM, 3, 4) || ' ~ ' || SUBSTRING(D1.HUC_END_HM, 0, 2) || ':' || SUBSTRING(D1.HUC_END_HM, 3, 4) || DECODE(D1.HUC_TXT, '중식', '    (중식)', NULL) AS TT
				                                , D1.HUC_STR_HM
				                                , D1.HUC_END_HM
				                        FROM    TBCSPSAE111B D1
				                    ) D6
				                  , ( 
				                      SELECT TO_CHAR((TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') + (#currPage# - 1) * 7) + LEVEL-1, 'YYYYMMDD') AS LCT_DT
				                      FROM ( SELECT EDU_STR_DT,
				                                    EDU_END_DT
				                               FROM TBCSPSAE201D
				                              WHERE YR = #strYR_CD#
				                                AND CRS_CD = #strEDU_CRS_CD#
				                                AND CRS_CDN = #strCRS_CDN#) A
				                    CONNECT BY LEVEL <= TO_DATE(A.EDU_END_DT, 'YYYYMMDD') - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') - (#currPage# - 1) * 7 +1
				                     AND ROWNUM <= 7
				                    ) D7
				           WHERE SUBSTRING(UPPER(TO_CHAR(TO_DATE(D7.LCT_DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) NOT IN ('토', '일')
				        ) D4
				        , ( 
				            SELECT    D2.YR
				                    , D2.CRS_CD
				                    , D2.CRS_CDN
				                    , D2.HUC_TXT
				                    , D2.LCT_DT
				                    , D2.SUBJ_CD
				                    , D3.SUBJ_NM
				                    , D2.RMK
				            FROM    TBCSPSAE202D D2
				                    , TBCSPSAE101M D3
				            WHERE    D2.SUBJ_CD = D3.SUBJ_CD
				            AND        D2.YR = #strYR_CD#
				            AND        D2.CRS_CD = #strEDU_CRS_CD#
				            AND        D2.CRS_CDN = #strCRS_CDN#
				        ) D5
				WHERE    D4.SRT_SNO = D5.HUC_TXT(+)
				AND      D4.LCT_DT = D5.LCT_DT(+)
				GROUP BY SRT_SNO, HUC_STR_HM, HUC_END_HM
        ]]>
	</select>

	<select id="CSPSAE105ESubjCbbList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
		        SELECT A.SUBJ_CD AS CD
				     , B.SUBJ_NM AS CD_NM
				  FROM TBCSPSAE101D A
				     , TBCSPSAE101M B
				 WHERE B.SUBJ_CD = A.SUBJ_CD
				   AND A.YR = #strYR_CD#
				   AND A.CRS_CD = #strEDU_CRS_CD#
				   AND A.CRS_CDN = #strCRS_CDN#
		      ORDER BY TO_NUMBER(SUBJ_SNO)
        ]]>
	</select>

	<select id="CSPSAE105ESubjExistYn" parameterClass="paramMap" resultClass="String">
        <![CDATA[
				SELECT DECODE(COUNT(*), 0, 'N', 'Y') AS EXIST_YN FROM TBCSPSAE202D
				WHERE YR = #YR#
				AND CRS_CD = #CRS_CD#
				AND CRS_CDN = #CRS_CDN#
				AND HUC_TXT = #HUC#
				AND LCT_DT = #LCT_DT#
        ]]>
	</select>

	<insert id="CSPSAE105EInsertSubjTT" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPSAE202D (
						YR
					  , CRS_CD
					  , CRS_CDN
					  , SUBJ_CD
					  , ASG_SNO
					  , PFSR_ID
					  , LCT_DT
					  , LCT_TM_HM
					  , HUC_TXT
					  , LCT_STR_TM_HM
					  , LCT_END_TM_HM
					  , RMK
					  , FRT_USR_ID
					  , FNL_USR_ID
					  , FNL_DEAL_DPT_CD
					  , FNL_MNU_ID
					  , FRT_REGI_DH
					  , FNL_MDF_DH)
			   VALUES ( #YR#                      
					  , #CRS_CD#                  
					  , #CRS_CDN#                 
					  , #SUBJ_CD#                 
					  , (SELECT NVL(MAX(ASG_SNO), 0)+1 AS ASG_SNO
					       FROM TBCSPSAE202D
						  WHERE YR = #YR#
						    AND CRS_CD = #CRS_CD#
						    AND CRS_CDN = #CRS_CDN#
					        AND SUBJ_CD = #SUBJ_CD#)
					  , (SELECT PFSR_ID
					       FROM TBCSPSAE101D
					      WHERE YR = #YR#
						    AND CRS_CD = #CRS_CD#
						    AND CRS_CDN = #CRS_CDN#
					        AND SUBJ_CD = #SUBJ_CD#)
					  , #LCT_DT#                  
					  , #LCT_TM_HM#               
					  , #HUC#                     
					  , #LCT_STR_TM_HM#           
					  , #LCT_END_TM_HM#           
					  , #RMK#                     
					  , #FRT_USR_ID#              
					  , #FNL_USR_ID#              
					  , #FNL_DEAL_DPT_CD#         
					  , #FNL_MNU_ID#              
					  , SYSDATE
					  , SYSDATE)
        ]]>
	</insert>

	<delete id="CSPSAE105EDeleteSubjTT" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE202D
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND HUC_TXT = #HUC#
			   AND LCT_DT = #LCT_DT#
		]]>
	</delete>

	<update id="CSPSAE105EUpdateSubjTTSno" parameterClass="paramMap">
			UPDATE    TBCSPSAE202D D2
				SET        D2.ASG_SNO = (     SELECT    ORD 
				                        FROM     (
				                                    SELECT    D1.YR
				                                            , D1.CRS_CD
				                                            , D1.CRS_CDN
				                                            , D1.SUBJ_CD
				                                            , D1.ASG_SNO
				                                            , D1.HUC_TXT
				                                            , D1.LCT_DT
				                                            , RANK () OVER (PARTITION BY D1.YR, D1.CRS_CD, D1.CRS_CDN, D1.SUBJ_CD ORDER BY D1.HUC_TXT, D1.LCT_DT) AS ORD
				                                    FROM    TBCSPSAE202D D1
				                                    WHERE     D1.YR = #YR#
				                                    AND       D1.CRS_CD =  #CRS_CD#
				                                    AND       D1.CRS_CDN = #CRS_CDN#
				                                    AND       D1.SUBJ_CD = #SUBJ_CD#
				                                ) D3
				                        WHERE     D3.YR = D2.YR
				                        AND         D3.CRS_CD = D2.CRS_CD
				                        AND     D3.CRS_CDN = D2.CRS_CDN
				                        AND        D3.SUBJ_CD = D2.SUBJ_CD
				                        AND        D3.LCT_DT = D2.LCT_DT
				                        AND        D3.HUC_TXT = D2.HUC_TXT
				                    )
				WHERE     D2.YR = #YR#
				AND       D2.CRS_CD = #CRS_CD#
				AND       D2.CRS_CDN = #CRS_CDN#
				AND       D2.SUBJ_CD = #SUBJ_CD#
	
	</update>

	<select id="CSPSAE105ECbbLctRmNm" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.LCT_RM_NO
			     , A.LCT_RM_DVSN_CD
			     , A.LCT_RM_NM
			  FROM TBCSPSAE114C A
			 ORDER BY A.LCT_RM_NO
        ]]>
	</select>
	
	<select id="CSPSAE105ESelectLctList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.YR
			     , A.CRS_CD
			     , A.CRS_CDN
			     , A.ASG_YN
			     , B.LCT_RM_DVSN_CD
			     , B.LCT_RM_NO
			     , A.USE_STR_DT
			     , A.USE_END_DT
			     , A.USE_STR_HM
			     , A.USE_END_HM
			  FROM TBCSPSAE203D A
			     , TBCSPSAE114C B
			 WHERE A.LCT_RM_NO = B.LCT_RM_NO
			   AND A.YR = #strYR_CD#
			   AND A.CRS_CD = #strEDU_CRS_CD#
			   AND A.CRS_CDN = #strCRS_CDN#
			 ORDER BY A.ASG_YN DESC, A.USE_STR_DT, A.USE_END_DT, A.USE_STR_HM, A.USE_END_HM 
        ]]>
	</select>
	
	<delete id="CSPSAE105EDeleteLctRm" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE203D
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND LCT_RM_NO = #LCT_RM_NO# 
		]]>
	</delete>

	<update id="CSPSAE105EUpdateLctRm" parameterClass="paramMap">
			UPDATE TBCSPSAE203D D2
			   SET ASG_YN 			= #ASG_YN#
			     , USE_STR_DT		= #USE_STR_DT#
			     , USE_END_DT		= #USE_END_DT#
			     , USE_STR_HM		= #USE_STR_HM#
			     , USE_END_HM		= #USE_END_HM#
			     , FNL_USR_ID		= #FNL_USR_ID#
			     , FNL_DEAL_DPT_CD	= #FNL_DEAL_DPT_CD#
			     , FNL_MNU_ID		= #FNL_MNU_ID#
			     , FNL_MDF_DH		= SYSDATE
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND LCT_RM_NO = #LCT_RM_NO# 
	</update>
	
	<insert id="CSPSAE105EInsertLctRm" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPSAE203D (
						YR
					  , CRS_CD
					  , CRS_CDN
					  , LCT_RM_NO
					  , ASG_YN
					  , USE_STR_DT
					  , USE_END_DT
					  , USE_STR_HM
					  , USE_END_HM
					  , FRT_USR_ID
					  , FNL_USR_ID
					  , FNL_DEAL_DPT_CD
					  , FNL_MNU_ID
					  , FRT_REGI_DH
					  , FNL_MDF_DH)
			   VALUES ( #YR#                      
					  , #CRS_CD#                  
					  , #CRS_CDN#                 
					  , #LCT_RM_NO#
					  , #ASG_YN#
					  , #USE_STR_DT#
					  , #USE_END_DT#
					  , #USE_STR_HM#
					  , #USE_END_HM#
					  , #FRT_USR_ID#              
					  , #FNL_USR_ID#              
					  , #FNL_DEAL_DPT_CD#         
					  , #FNL_MNU_ID#              
					  , SYSDATE
					  , SYSDATE)
        ]]>
	</insert>

	<select id="CSPSAE105ESelectMaxTaneId" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT LPAD(NVL(MAX(TANE_ID), 0)+1, 13, '0') AS TANE_ID FROM TBCSPSAE301D
			WHERE YR = #YR#
			  AND CRS_CD = #CRS_CD#
			  AND CRS_CDN = #CRS_CDN#
			  AND TANE_ID LIKE '0%'
        ]]>
	</select>

	<select id="CSPSAE105ETaneExistYn" parameterClass="paramMap" resultClass="String">
        <![CDATA[
		   SELECT DECODE(NVL(MAX(YR), 0), 0, 'N', 'Y') FROM TBCSPSAE301D
			WHERE YR = #YR#
			  AND CRS_CD = #CRS_CD#
			  AND CRS_CDN = #CRS_CDN#
			  AND NAM = #NAM#
			  AND RAL_BLT_NM = #RAL_BLT_NM#
			  AND NPL_BLT_NM = #NPL_BLT_NM#
			  AND RANK_NM	= #RANK_NM#
        ]]>
	</select>

	<select id="CSPSAE105EGetDueDay" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT	DISTINCT /* CSPSAE105EGetDueDay */
					SUBSTR(A.ILJA, 5, 2) || '월 ' || SUBSTR(A.ILJA, 7, 2) || '일(' || A.DAY_NAME || ')' AS DUE_DAY
			FROM	(
					SELECT TO_CHAR(BF_DT, 'yyyymmdd') AS ILJA
							, SUBSTRING(UPPER(TO_CHAR(TO_DATE(BF_DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) AS DAY_NAME
							, CEIL((BF_DT - NEXT_DAY(TRUNC(BF_DT, 'yy'), '1') + 1)/7) AS BF_JUCHA
					FROM (
							SELECT TO_DATE(A.BF_EDU_STR_DT) + (LEVEL -1) AS BF_DT
							FROM (
								SELECT	TO_DATE(EDU_STR_DT, 'YYYYMMDD')-30 AS BF_EDU_STR_DT
										, EDU_END_DT
								FROM	TBCSPSAE201D
								WHERE	YR = #strYR_CD#
								AND 	CRS_CD = #strEDU_CRS_CD#
								AND		CRS_CDN = #strCRS_CDN#
								) A
							CONNECT BY LEVEL <= (TO_DATE(A.EDU_END_DT, 'YYYYMMDD')+1) - A.BF_EDU_STR_DT
						) 
					)A
					,
					(
					SELECT TO_CHAR(MIN(STR_DT), 'yyyymmdd') AS ILJA
							, SUBSTRING(UPPER(TO_CHAR(TO_DATE(MIN(STR_DT)), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) AS DAY_NAME
							, CEIL((MIN(STR_DT) - NEXT_DAY(TRUNC(MIN(STR_DT), 'yy') - 7, '1') + 1)/7) AS STR_JUCHA
					FROM (
							SELECT TO_DATE(A.EDU_STR_DT) + (LEVEL -1) AS STR_DT
							FROM (
								SELECT	EDU_STR_DT
										, EDU_END_DT
								FROM	TBCSPSAE201D
								WHERE	YR = #strYR_CD#
								AND 	CRS_CD = #strEDU_CRS_CD#
								AND		CRS_CDN = #strCRS_CDN#
								) A
							CONNECT BY LEVEL <= (TO_DATE(A.EDU_END_DT, 'YYYYMMDD')+1) - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD')
						)
					) B
			WHERE B.STR_JUCHA-2 = BF_JUCHA
			  AND A.DAY_NAME = '금'
			  AND ROWNUM = 1   /*날짜는 하나만 나와야 한다(교육기간이 몇년일 경우 여러건이 조회되어 수정함) */
        ]]>
	</select>

	<!-- 교육생목록 조회 -->
	<select id="CSPSAE105ESelectTaneList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.YR
			     , A.CRS_CD
			     , A.CRS_CDN
			     , A.TANE_ID
			     , A.SNO
			     , A.NAM
			     , NVL(A.RAL_BLT_NM, (SELECT ORG_NM FROM TBDCMACM015M WHERE ORG_CD = A.ORG_CD)) AS RAL_BLT_NM
			     , A.NPL_BLT_NM
			     , A.RANK_NM
			     , TRIM(REPLACE(A.HPN, '-')) AS HPN
			     , A.CNB
			  FROM TBCSPSAE301D A
			 WHERE A.YR = #strYR_CD#
		       AND A.CRS_CD = #strEDU_CRS_CD#
		       AND A.CRS_CDN = #strCRS_CDN#
		     ORDER BY A.SNO, A.TANE_ID
        ]]>
	</select>

	<select id="CSPSAE105EReportData" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
        SELECT A.EDU_TITLE
		     , A.NPL_BLT_NM
		     , A.NAM
		     , A.SNO AS NO
		  FROM (
				SELECT C.CRS_NM AS EDU_TITLE
				     , A.NPL_BLT_NM
				     , A.NAM
				     , A.SNO
				  FROM TBCSPSAE301D A
				     , TBCSPSAE201D B
				     , TBCSPSAE103C C
				 WHERE B.YR = A.YR
				   AND B.CRS_CD = A.CRS_CD
				   AND B.CRS_CDN = A.CRS_CDN
				   AND C.CRS_CD = B.CRS_CD
				   AND A.YR = #strYR_CD#
			       AND A.CRS_CD = #strEDU_CRS_CD#
			       AND A.CRS_CDN = #strCRS_CDN#
			  ORDER BY A.SNO, A.TANE_ID
		    ) A
        ]]>
	</select>
	
	<delete id="CSPSAE105EDeleteTane" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE301D
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND TANE_ID = #TANE_ID# 
		]]>
	</delete>

	<update id="CSPSAE105EUpdateTane" parameterClass="paramMap">
			UPDATE TBCSPSAE301D
			   SET NAM			=	#NAM#
			     , SNO			=	#SNO#
			     , RAL_BLT_NM	=	#RAL_BLT_NM#
			     , NPL_BLT_NM	=	#NPL_BLT_NM#
			     , RANK_NM		=	#RANK_NM#
			     , HPN			=	TRIM(REPLACE(#HPN#, '-'))
			     , CNB			=   #CNB#
			     , FNL_USR_ID 	  	= #FNL_USR_ID#
			     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			     , FNL_MNU_ID 		= #FNL_MNU_ID#
			     , FNL_MDF_DH 		= SYSDATE
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND TANE_ID = #TANE_ID# 
	</update>
	
	<insert id="CSPSAE105EInsertTane" parameterClass="paramMap">
        
 			INSERT INTO TBCSPSAE301D 
 				( 	YR
 				  , CRS_CD
 				  , CRS_CDN
 				  , TANE_ID
 				  , SNO
 				  , NAM
 				  , RAL_BLT_NM
 				  , NPL_BLT_NM
 				  , RANK_NM
 				  , DMT_UE_YN
 				  , SNDY_LODG_YN
 				  , BUS_UE_YN
 				  , FIN_YN
 				  , PD_YN
 				  , WRK_PRD_TXT
 				  , HPN
 				  , CNB
				  <isNotEmpty property="DVSN_CD">
				      <isEqual property="DVSN_CD" compareValue="001">
						  , ORG_CD
					      , DPT_NM
					  </isEqual>
				  </isNotEmpty>
 				  , FRT_USR_ID
 				  , FNL_USR_ID
 				  , FNL_DEAL_DPT_CD
 				  , FNL_MNU_ID
 				  , FRT_REGI_DH
 				  , FNL_MDF_DH)
        	VALUES( #YR#
 				  , #CRS_CD#
 				  , #CRS_CDN#
 				  , #TANE_ID#
 				  , #SNO#
 				  , #NAM#
 				  , #NPL_BLT_NM#
 				  , #NPL_BLT_NM#
 				  , #RANK_NM#
 				  , 'N'
 				  , 'N'
 				  , 'N'
 				  , 'N'
 				  , 'N'
 				  , '0000'
 				  , TRIM(REPLACE(#HPN#, '-'))
 				  , #CNB#
 				  <isNotEmpty property="DVSN_CD">
					  <isEqual property="DVSN_CD" compareValue="001">
						  , '011000000000'
						  , #NPL_BLT_NM#
					  </isEqual>
				  </isNotEmpty>
				  , #FRT_USR_ID#              
				  , #FNL_USR_ID#              
				  , #FNL_DEAL_DPT_CD#         
				  , #FNL_MNU_ID#              
				  , SYSDATE
				  , SYSDATE)
        
	</insert>

	<delete id="CSPSAE105EDeleteAllTane" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE301D
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
		]]>
	</delete>

	<select id="CSPSAE107PSelectBscSubjList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.SUBJ_CD
			     , A.SUBJ_NM
			     , '' AS PFSR_ID
			     , '' AS NAM
			     , '' AS VLD_DVSN_NM
			     , '' AS LCT_DT
			  FROM TBCSPSAE101M A
			 WHERE A.USE_YN = 'Y'
			   AND A.BSC_OP_SUBJ_YN = 'Y'
        ]]>
        <dynamic>
	        <isNotEmpty property="strSUBJ_NM">
	        	AND UPPER(A.SUBJ_NM) LIKE '%' || UPPER(#strSUBJ_NM#) || '%'
	       	</isNotEmpty>
	    </dynamic>
        <![CDATA[
			ORDER BY A.SUBJ_NM
        ]]>
	</select>

	<select id="CSPSAE107PCountBscSubjList" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT COUNT(A.SUBJ_CD) CNT
			  FROM TBCSPSAE101M A
			 WHERE A.USE_YN = 'Y'
			   AND A.BSC_OP_SUBJ_YN = 'Y'
			   AND UPPER(A.SUBJ_NM) LIKE '%' || UPPER(#strSUBJ_NM#) || '%'
        ]]>
	</select>

	<select id="CSPSAE107PSelectSubjList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.SUBJ_CD
                 , A.SUBJ_NM
                 , E.PFSR_ID
			     , E.NAM
				 , (SELECT B.CD_NM FROM TBDCMACM013C B WHERE B.CMM_CD_DVSN_CD = '1000313' AND B.CD = E.VLD_DVSN_CD) AS VLD_DVSN_NM
				 , MAX(C.LCT_DT) AS LCT_DT
			  FROM TBCSPSAE101M A
			     , TBCSPSAE101L B
			     , TBCSPSAE202D C
			     , TBCSPSAE201D D
			     , TBCSPSAE109M E
			  WHERE B.SUBJ_CD = A.SUBJ_CD
			    AND C.SUBJ_CD(+) = B.SUBJ_CD
			    AND D.YR(+) = C.YR
			    AND D.CRS_CD(+) = C.CRS_CD
			    AND D.CRS_CDN(+) = C.CRS_CDN
			    AND C.PFSR_ID(+) = B.PFSR_ID
			    AND E.PFSR_ID(+) = B.PFSR_ID
			    AND A.USE_YN = 'Y'
			    AND B.USE_YN = 'Y'
			   AND ( C.LCT_DT < TO_CHAR(SYSDATE, 'YYYYMMDD') OR C.LCT_DT IS NULL)
        ]]>
        <dynamic>
	        <isNotEmpty property="strSUBJ_NM">
	        	AND UPPER(A.SUBJ_NM) LIKE '%' || UPPER(#strSUBJ_NM#) || '%'
	       	</isNotEmpty>
	        <isNotEmpty property="strNAM">
	        	AND E.NAM LIKE '%' || #strNAM# || '%'
	       	</isNotEmpty>
	        <isNotEmpty property="strVLD_DVSN_CD">
	       	    AND E.VLD_DVSN_CD = #strVLD_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strRange">
				AND FLOOR(MOD(MONTHS_BETWEEN(TO_CHAR(SYSDATE, 'yyyyMMdd'), (SELECT MAX(C.LCT_DT) FROM TBCSPSAE202D B WHERE B.PFSR_ID = E.PFSR_ID)),0)*30.5) &lt;= #strRange#
	       	</isNotEmpty>
	    </dynamic>
        <![CDATA[
			GROUP BY A.SUBJ_CD, A.SUBJ_NM, E.PFSR_ID, E.NAM, E.VLD_DVSN_CD
			ORDER BY A.SUBJ_NM
        ]]>
	</select>
	
	<select id="CSPSAE107PCountSubjList" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT COUNT(A.SUBJ_CD) AS CNT
			   FROM TBCSPSAE101M A,
			        TBCSPSAE101L B
			  WHERE B.SUBJ_CD = A.SUBJ_CD
			    AND A.USE_YN = 'Y'
			    AND B.USE_YN = 'Y'
        ]]>
        <dynamic>
	        <isNotEmpty property="strSUBJ_NM">
	        	AND UPPER(A.SUBJ_NM) LIKE '%' || UPPER(#strSUBJ_NM#) || '%'
	       	</isNotEmpty>
	        <isNotEmpty property="strNAM">
	        	AND E.NAM LIKE '%' || #strNAM# || '%'
	       	</isNotEmpty>
	    </dynamic>
	</select>
	
	<select id="CSPSAE108PSelectMainList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT 
			      (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000139' AND CD = B.LCT_RM_DVSN_CD) AS LCT_RM_DVSN_NM
			     , B.LCT_RM_NM
			     , SUBSTR(A.USE_STR_DT, 0, 4) || '-' || SUBSTR(A.USE_STR_DT, 5, 2) || '-' || SUBSTR(A.USE_STR_DT, 7, 2) || ' ~ ' 
			     || SUBSTR(A.USE_END_DT, 0, 4) || '-' || SUBSTR(A.USE_END_DT, 5, 2) || '-' || SUBSTR(A.USE_END_DT, 7, 2) AS USE_DATE
			     , SUBSTR(A.USE_STR_HM, 0, 2) || ':' || SUBSTR(A.USE_STR_HM, 3, 2) || ' ~ ' || SUBSTR(A.USE_END_HM, 0, 2) || ':' || SUBSTR(A.USE_END_HM, 3, 2) AS USE_TIME
			     , C.EDU_DVSN_NM || '-' || D.EDU_CAT_NM || '-' || E.CRS_NM || '-' || A.CRS_CDN || '기' AS CONTENT
			  FROM TBCSPSAE203D A
			     , TBCSPSAE114C B
			     , TBCSPSAE101C C
			     , TBCSPSAE102C D
			     , TBCSPSAE103C E
			 WHERE D.EDU_DVSN_CD = C.EDU_DVSN_CD
			   AND E.EDU_DVSN_CD = D.EDU_DVSN_CD
			   AND E.EDU_CAT_CD = D.EDU_CAT_CD
			   AND A.CRS_CD = E.CRS_CD
			   AND B.LCT_RM_NO = A.LCT_RM_NO
        ]]>
        <dynamic>
	        <isNotEmpty property="strYR_CD">
				   AND A.YR = #strYR_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_DVSN_CD">
				   AND C.EDU_DVSN_CD = #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
				   AND D.EDU_CAT_CD = #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
				   AND A.CRS_CD = #strEDU_CRS_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strCRS_CDN">
				   AND A.CRS_CDN = #strCRS_CDN#
	       	</isNotEmpty>
	    </dynamic>
        <![CDATA[
			ORDER BY B.LCT_RM_DVSN_CD, B.LCT_RM_NO, A.USE_STR_DT, A.USE_END_DT, A.USE_STR_HM, A.USE_END_HM, C.EDU_DVSN_CD, D.EDU_CAT_CD, E.CRS_CD
        ]]>
	</select>

	<select id="CSPSAE109ECbbApcDtList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
				SELECT APC_DT
				     , SUBSTR(A.APC_DT, 0, 4) || '-' || SUBSTR(A.APC_DT, 5, 2) || '-' || SUBSTR(A.APC_DT, 7, 2)AS APC_DT_NM
				  FROM TBCSPSAE124M A
				 WHERE A.USE_YN = 'Y'
        ]]>
         <![CDATA[
         	ORDER BY A.APC_DT DESC
         ]]>
	</select>

	<select id="CSPSAE109EMainList" parameterClass="paramMap" resultMap="hwpDocMap">
        <![CDATA[
			SELECT APC_DT
			     , TXT
			  FROM TBCSPSAE124M
			 WHERE 1=1
			   AND USE_YN = 'Y'
			   AND APC_DT IS NOT NULL
        ]]>
	</select>

	<update id="CSPSAE109ESaveMain" parameterClass="paramMap">
        <![CDATA[
			UPDATE TBCSPSAE124M
		       SET TXT = #hwp#
		         , APC_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
		         , FNL_USR_ID 	  	= #FNL_USR_ID#
			     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			     , FNL_MNU_ID 		= #FNL_MNU_ID#
			     , FNL_MDF_DH 		= SYSDATE
        ]]>
	</update>
	
	<select id="CSPSAE110QMainList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT SUBSTR(D.EDU_STR_DT, 0, 4) AS YR
			     , A.EDU_DVSN_CD 
			     , A.EDU_DVSN_NM 
			     , B.EDU_CAT_CD 
			     , B.EDU_CAT_NM 
			     , C.CRS_CD 
			     , C.CRS_NM 
			     , D.CRS_CDN 
			     , D.EDU_STR_DT 
			     , D.EDU_END_DT 
			     , SUBSTR(D.EDU_STR_DT, 0, 4)||'-'||SUBSTR(D.EDU_STR_DT, 5, 2)||'-'||SUBSTR(D.EDU_STR_DT, 7, 2)||' ~ '||SUBSTR(D.EDU_END_DT, 0,4)||'-'||SUBSTR(D.EDU_END_DT, 5,2)||'-'||SUBSTR(D.EDU_END_DT, 7,2) AS EDU_DT
			     , E.EDU_PRD_TXT
			     , E.EDU_TG_TXT
			  FROM TBCSPSAE101C A 
			     , TBCSPSAE102C B 
			     , TBCSPSAE103C C 
			     , TBCSPSAE201D D
			     , TBCSPSAE201M E
			     , TBCSPSAE203D F
			WHERE B.EDU_DVSN_CD = A.EDU_DVSN_CD 
			  AND C.EDU_DVSN_CD = B.EDU_DVSN_CD 
			  AND C.EDU_CAT_CD 	= B.EDU_CAT_CD 
			  AND D.CRS_CD 		= C.CRS_CD 
			  AND E.YR			= D.YR
			  AND E.CRS_CD		= D.CRS_CD
			  AND F.YR = D.YR
		      AND F.CRS_CD = D.CRS_CD
		      AND F.CRS_CDN = D.CRS_CDN
		      AND F.ASG_YN = 'Y'
        ]]>
        <dynamic>
	 		<isNotEmpty property="strFromYm">
	        	<isNotEmpty property="strToYm">
					AND SUBSTR(D.EDU_STR_DT, 0, 6) BETWEEN SUBSTR(#strFromYm#, 0, 6) AND SUBSTR(#strToYm#, 0, 6)
				</isNotEmpty>
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_DVSN_CD">
				AND A.EDU_DVSN_CD = #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
				AND B.EDU_CAT_CD = #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
				AND C.CRS_CD = #strEDU_CRS_CD#
	       	</isNotEmpty>
			<isNotEmpty property="strCRS_CDN">
				AND D.CRS_CDN = #strCRS_CDN#
	       	</isNotEmpty>
	     </dynamic>
         <![CDATA[
  				ORDER BY D.EDU_STR_DT, A.EDU_DVSN_CD, B.EDU_CAT_CD, C.CRS_CD, D.CRS_CDN 
         ]]>
	</select>
	
	<select id="CSPSAE110QReportData" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			
         ]]>
	</select>
	
	<select id="CSPSAE110QNearInfo" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
				SELECT A.YR
			     , A.EDU_DVSN_CD
			     , A.EDU_CAT_CD
			     , A.CRS_CD
			     , B.CRS_CDN
			     , B.EDU_STR_DT
			     , B.EDU_END_DT
			  FROM (
					SELECT    YR
					        , EDU_DVSN_CD
					        , EDU_CAT_CD
					        , CRS_CD
						    , CRS_CDN
					FROM    (
								SELECT    D1.YR
								        , D1.CRS_CD
								        , D1.CRS_CDN
								        , T1.EDU_DVSN_CD
								        , T2.EDU_CAT_CD
								        , TRUNC(TO_DATE(D1.EDU_STR_DT, 'YYYYMMDD') - SYSDATE) AS DAY_C
								FROM    TBCSPSAE201D D1
								      , TBCSPSAE101C T1
								      , TBCSPSAE102C T2
								      , TBCSPSAE103C T3
								WHERE D1.EDU_STR_DT > TO_CHAR(SYSDATE, 'YYYYMMDD')
								  AND  T3.CRS_CD = D1.CRS_CD
								  AND  T2.EDU_CAT_CD = T3.EDU_CAT_CD
								  AND  T2.EDU_DVSN_CD = T3.EDU_DVSN_CD
								  AND  T1.EDU_DVSN_CD = T2.EDU_DVSN_CD
								ORDER BY DAY_C, CRS_CDN
							 )
					 ) A
				     , TBCSPSAE201D B
			    WHERE B.YR = A.YR
			      AND B.CRS_CD = A.CRS_CD
			      AND A.CRS_CDN < B.CRS_CDN
			      AND ROWNUM = 1
        ]]>
	</select>
	
	<select id="CSPSAE111PBasicInfo" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT C.CRS_CDN
			     , B.CRS_NM
			     , A.EDU_GL_TXT
			     , A.EDU_TG_TXT
			      || ' ' || C.NOP_CNT || '명' AS EDU_TG_TXT
			     , SUBSTR(C.EDU_STR_DT, 0, 4) || '. ' || SUBSTR(C.EDU_STR_DT, 5, 2) || '. ' || SUBSTR(C.EDU_STR_DT, 7, 2) || ' ~ ' ||
			       SUBSTR(C.EDU_END_DT, 0, 4) || '. ' || SUBSTR(C.EDU_END_DT, 5, 2) || '. ' || SUBSTR(C.EDU_END_DT, 7, 2) ||
			       '(' || TO_CHAR((TO_DATE(C.EDU_END_DT, 'YYYYMMDD') - TO_DATE(C.EDU_STR_DT, 'YYYYMMDD'))+1) || '일) ' ||
			       E.SEAT_NM || ' ' || E.LCT_RM_NM AS EDU_PRD_TXT
			     , C.CRS_CHIF_NM
			     , A.CHR_TNB
			  FROM TBCSPSAE201M A
			     , TBCSPSAE103C B
			     , TBCSPSAE201D C
			     , TBCSPSAE203D D
			     , TBCSPSAE114C E
			 WHERE B.CRS_CD 	= A.CRS_CD
			   AND C.YR			= A.YR
			   AND C.CRS_CD		= A.CRS_CD
			   AND D.YR			= C.YR
			   AND D.CRS_CD		= C.CRS_CD
			   AND D.CRS_CDN	= C.CRS_CDN
			   AND E.LCT_RM_NO 	= D.LCT_RM_NO
			   AND D.ASG_YN = 'Y'
			   AND A.YR = #strYR_CD#
			   AND A.CRS_CD = #strEDU_CRS_CD#
			   AND C.CRS_CDN = #strCRS_CDN#
        ]]>
	</select>
	
	<select id="CSPSAE111PPfsrBySubj" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT ROWNUM || '. ' || A.SUBJ_NM AS SUBJ_NM
			     , A.ASG_SNO
			     , A.PFSR_BLT_NM
			     , A.PFSR_RANK_NM
			     , A.NAM
			  FROM (
					SELECT B.SUBJ_NM
					     , COUNT(ASG_SNO) AS ASG_SNO
					     , NVL(C.PFSR_BLT_NM, E.CHR_DPT_NM) AS PFSR_BLT_NM
					     , NVL(C.PFSR_RANK_NM, '과정장') AS PFSR_RANK_NM
					     , NVL(C.NAM, D.CRS_CHIF_NM) AS NAM 
					  FROM TBCSPSAE202D A
					     , TBCSPSAE101M B
					     , TBCSPSAE109M C
					     , TBCSPSAE201D D
					     , TBCSPSAE201M E
					 WHERE B.SUBJ_CD(+)		= A.SUBJ_CD
					   AND C.PFSR_ID(+)		= A.PFSR_ID
					   AND D.YR = A.YR
					   AND D.CRS_CD = A.CRS_CD
					   AND D.CRS_CDN = A.CRS_CDN
					   AND E.YR = A.YR
					   AND E.CRS_CD = A.CRS_CD
					   AND A.YR = #strYR_CD#
					   AND A.CRS_CD = #strEDU_CRS_CD#
					   AND A.CRS_CDN = #strCRS_CDN#
					 GROUP BY B.SUBJ_NM
					        , C.NAM
					        , C.PFSR_BLT_NM
					        , C.PFSR_RANK_NM
					        , D.CRS_CHIF_NM
					        , E.CHR_DPT_NM
					 ORDER BY B.SUBJ_NM, C.PFSR_BLT_NM, C.PFSR_RANK_NM, C.NAM
			       ) A
        ]]>
	</select>
	
	<select id="CSPSAE111PTimeHeaderList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
        SELECT '' AS DATE_NAME
             , 0 AS NUM
          FROM DUAL
        UNION ALL
        SELECT A.DATE_NAME
             , ROWNUM AS NUM
          FROM (
				SELECT DISTINCT( SUBSTRING(B.DT, 5, 2) || '. ' || SUBSTRING(B.DT, 7, 2) || '(' || SUBSTRING(UPPER(TO_CHAR(TO_DATE(B.DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) || ')') AS DATE_NAME
					FROM (
							SELECT TO_CHAR(TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') + LEVEL-1, 'YYYYMMDD') AS DT
	                      FROM ( SELECT EDU_STR_DT,
	                                    EDU_END_DT
	                               FROM TBCSPSAE201D
	                              WHERE YR = #strYR_CD#
	                                AND CRS_CD =  #strEDU_CRS_CD#
	                                AND CRS_CDN = #strCRS_CDN#) A
	                    CONNECT BY LEVEL <= TO_DATE(A.EDU_END_DT, 'YYYYMMDD') - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') + 1
	                     AND ROWNUM <= 7
						) B
					WHERE SUBSTRING(UPPER(TO_CHAR(TO_DATE(B.DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) NOT IN ('일', '토')
					ORDER BY DATE_NAME
				) A
		 ORDER BY NUM
        ]]>
	</select>
	
	<select id="CSPSAE111PTimeList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
				SELECT    D4.SRT_SNO
				        , MAX(D4.TT) AS TT
				        , REPLACE(AGGR_CONCAT( NVL(D5.SUBJ_NM || DECODE(D5.SUBJ_NM, NULL, '', '(') || D5.NAM || DECODE(D5.SUBJ_NM, NULL, '', ')'), '%%'), '@' ORDER BY D4.LCT_DT ), '%%', '') AS SUBJ_NM
				FROM    (
				            SELECT    D6.SRT_SNO
				                    , D6.TT
				                    , D7.LCT_DT
				            FROM    (
				                        SELECT    D1.SRT_SNO
				                                , SUBSTRING(D1.HUC_STR_HM, 0, 2) || ':' || SUBSTRING(D1.HUC_STR_HM, 3, 4) || ' ~ ' || SUBSTRING(D1.HUC_END_HM, 0, 2) || ':' || SUBSTRING(D1.HUC_END_HM, 3, 4) || DECODE(D1.HUC_TXT, '중식', '    (중식)', NULL) AS TT
				                        FROM    TBCSPSAE111B D1
				                    ) D6
				                  , ( 
				                      SELECT TO_CHAR(TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') + LEVEL-1, 'YYYYMMDD') AS LCT_DT
				                      FROM ( SELECT EDU_STR_DT,
				                                    EDU_END_DT
				                               FROM TBCSPSAE201D
				                              WHERE YR = #strYR_CD#
				                                AND CRS_CD = #strEDU_CRS_CD#
				                                AND CRS_CDN = #strCRS_CDN#) A
				                    CONNECT BY LEVEL <= TO_DATE(A.EDU_END_DT, 'YYYYMMDD') - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') +1
				                     AND ROWNUM <= 7
				                    ) D7
				           WHERE SUBSTRING(UPPER(TO_CHAR(TO_DATE(D7.LCT_DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) NOT IN ('토', '일')
				        ) D4
				        , ( 
				            SELECT    D2.HUC_TXT
				                    , D2.LCT_DT
				                    , D3.SUBJ_NM 
				                    , NVL(D5.NAM, D6.CRS_CHIF_NM) AS NAM
				            FROM    TBCSPSAE202D D2
				                  , TBCSPSAE101M D3
				                  , TBCSPSAE101L D4
				                  , TBCSPSAE109M D5
				                  , TBCSPSAE201D D6
				            WHERE    D2.SUBJ_CD = D3.SUBJ_CD
				            AND		 D4.SUBJ_CD(+) = D2.SUBJ_CD
				            AND      D5.PFSR_ID(+) = D4.PFSR_ID
				            AND		 D6.YR = D2.YR
				            AND      D6.CRS_CD = D2.CRS_CD
				            AND      D6.CRS_CDN = D2.CRS_CDN
				            AND        D2.YR = #strYR_CD#
				            AND        D2.CRS_CD = #strEDU_CRS_CD#
				            AND        D2.CRS_CDN = #strCRS_CDN#
				        ) D5
				WHERE    D4.SRT_SNO = D5.HUC_TXT(+)
				AND      D4.LCT_DT = D5.LCT_DT(+)
				GROUP BY SRT_SNO
        ]]>
	</select>
	
	<select id="CSPSAE111PTaneList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			WITH DATA AS (
				SELECT A.SNO
				     , A.NPL_BLT_NM
				     , A.RANK_NM
				     , A.NAM
				  FROM (
						SELECT A.NPL_BLT_NM
						     , A.RANK_NM
						     , A.NAM
						     , A.SNO
						  FROM TBCSPSAE301D A
						 WHERE 1=1
						   AND A.YR = #strYR_CD#
						   AND A.CRS_CD = #strEDU_CRS_CD#
						   AND CRS_CDN = #strCRS_CDN#
						 ORDER BY A.SNO, A.TANE_ID
						) A
			)
			SELECT A.SNO1
			     , A.NPL_BLT_NM1
			     , A.RANK_NM1
			     , A.NAM1
			     , B.SNO2
			     , B.NPL_BLT_NM2
			     , B.RANK_NM2
			     , B.NAM2
			  FROM (
					SELECT ROWNUM AS SEQ1
					     , DECODE(MOD(DATA.SNO, 2), 1, DATA.SNO) AS SNO1
					     , DECODE(MOD(DATA.SNO, 2), 1, DATA.NPL_BLT_NM) AS NPL_BLT_NM1
					     , DECODE(MOD(DATA.SNO, 2), 1, DATA.RANK_NM) AS RANK_NM1
					     , DECODE(MOD(DATA.SNO, 2), 1, DATA.NAM) AS NAM1
					  FROM DATA
			   		 WHERE DECODE(MOD(DATA.SNO, 2), 1, DATA.SNO) IS NOT NULL
					) A
				  , (
				  	SELECT ROWNUM AS SEQ2
				  	     , DECODE(MOD(DATA.SNO, 2), 0, DATA.SNO) AS SNO2
					     , DECODE(MOD(DATA.SNO, 2), 0, DATA.NPL_BLT_NM) AS NPL_BLT_NM2
					     , DECODE(MOD(DATA.SNO, 2), 0, DATA.RANK_NM) AS RANK_NM2
					     , DECODE(MOD(DATA.SNO, 2), 0, DATA.NAM) AS NAM2
					  FROM DATA
					 WHERE DECODE(MOD(DATA.SNO, 2), 0, DATA.SNO) IS NOT NULL
				    ) B
				WHERE A.SEQ1 = B.SEQ2(+)
	
        ]]>
	</select>
	
	<select id="CSPSAE105ESubjListForSendToH2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			WITH DATA AS (
			  SELECT A.APC_DT
			       , A.EDU_EXS
			       , A.DMT_EXS
			       , A.BRKF_FDEX
			       , A.LUNCH_FDEX
			       , A.DINR_FDEX
			  FROM TBCSPSAE113B A
			  WHERE A.APC_DT = (SELECT NVL(MAX(B.APC_DT), (SELECT MAX(APC_DT) FROM TBCSPSAE113B WHERE CRS_CD = '000' AND APC_DT < (SELECT EDU_STR_DT FROM TBCSPSAE201D WHERE YR = #strYR_CD# AND CRS_CD = #strEDU_CRS_CD# AND CRS_CDN = #strCRS_CDN#))) AS APC_DT
								  FROM TBCSPSAE201D A
								     , TBCSPSAE113B B
								  WHERE B.APC_DT < A.EDU_STR_DT
								    AND A.CRS_CD = B.CRS_CD /* 150520  교육과정이 전체가 아니면 그 교육과정에 대한 금액을 들고가도록 변경 */
								   	AND A.YR			= #strYR_CD#
						  			AND A.CRS_CD		= #strEDU_CRS_CD#
								  	AND A.CRS_CDN		= #strCRS_CDN#
				  				)			
				AND A.CRS_CD =  NVL((SELECT A.CRS_CD
								  FROM TBCSPSAE201D A
								     , TBCSPSAE113B B
								  WHERE B.APC_DT < A.EDU_STR_DT
								    AND A.CRS_CD = B.CRS_CD /* 150520  교육과정이 전체가 아니면 그 교육과정에 대한 금액을 들고가도록 변경 */
								   	AND A.YR			= #strYR_CD#
						  			AND A.CRS_CD		= #strEDU_CRS_CD#
								  	AND A.CRS_CDN		= #strCRS_CDN#
								  	GROUP BY A.CRS_CD
				  				),'000')
			)
						SELECT '' AS FLAG		/* 상태값 */
						     , A.YR				/* 년도 */
						     , A.CRS_CD			/* 과정코드 */
						     , A.CRS_CDN		/* 과정기수 */
						     , A.SNO			/* 교번 */
						     , A.TANE_ID		/* 교육생ID */
						     , A.NAM			/* 성명 */
						     , A.BTDT			/* 생일 */
						     , SUBSTR(REPLACE(A.HPN, '-', ''), 0, 3) || '-' || SUBSTR(REPLACE(A.HPN, '-', ''), 4, 4) || '-' || SUBSTR(REPLACE(A.HPN, '-', ''), 8, 4) AS HPN  /* 핸드폰번호 */
						     , A.NPL_BLT_NM				/* 기관명 */
						     , (SELECT EDU_EXS FROM DATA ) AS STD_EDU_EXS			/* 교육비 */
						     , (SELECT DMT_EXS FROM DATA ) AS STD_DMT_EXS			/* 기숙사비 */ 
						     , (SELECT BRKF_FDEX FROM DATA ) AS STD_BRKF_FDEX		/* 아침식비 */
						     , (SELECT LUNCH_FDEX FROM DATA ) AS STD_LUNCH_FDEX 	/* 점심식비 */
						     , (SELECT DINR_FDEX FROM DATA ) AS STD_DINR_FDEX		/* 저녁식비 */
						  FROM TBCSPSAE301D A
						     , TBCSPSAE201D B
						WHERE 1=1
						  AND B.YR			= A.YR
						  AND B.CRS_CD		= A.CRS_CD
						  AND B.CRS_CDN		= A.CRS_CDN
						  AND A.YR			= #strYR_CD#
			  			  AND A.CRS_CD		= #strEDU_CRS_CD#
			  			  AND A.CRS_CDN		= #strCRS_CDN#
		 ORDER BY A.YR, A.CRS_CD, A.CRS_CDN, A.NAM
        ]]>		     
	</select>
	
	<!-- 교육교재 조회 -->
	<select id="CSPSAE701ESubjList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT  a.YR, 
                    a.CRS_CD,
                    a.CRS_CDN,
                    a.PFSR_ID,
                    b.NAM,       	/*강사명*/
                    a.DOC_ID_2,  	/*문서ID*/
				     (SELECT FILE_NAME 
				       FROM ECM_FILE_LIST_VIEW2 g 
				      WHERE a.DOC_ID_2 = g.DOC_ID
				      AND G.FILE_ID IS NOT NULL
				      AND ROWNUM = 1) AS FILE_NAME, /*교재제목*/
				    a.KEYW1_TXT,	/*키워드1*/
					a.KEYW2_TXT,	/*키워드2*/
					a.KEYW3_TXT,	/*키워드3*/
					a.SUBJ_CD, 		/*교과목코드*/
                    c.SUBJ_NM, 		/*교과목명*/
                    d.EDU_DVSN_CD, 	/*교육구분코드*/
                    d.EDU_CAT_CD, 	/*교육분류코드*/
                    d.CRS_NM, 		/*교육과정명*/
                    (SUBSTR(e.EDU_STR_DT, 0, 4)||'-'||SUBSTR(e.EDU_STR_DT, 5, 2)||'-'||SUBSTR(e.EDU_STR_DT, 7, 2)||' ~ '||
			        SUBSTR(e.EDU_END_DT, 0, 4)||'-'||SUBSTR(e.EDU_END_DT, 5, 2)||'-'||SUBSTR(e.EDU_END_DT, 7, 2)) AS EDU_DT /*교육기간*/
             FROM TBCSPSAE101D a,
                  TBCSPSAE109M b,
                  TBCSPSAE101M c,
                  TBCSPSAE103C d,
                  TBCSPSAE201D e,
                  ECM_FILE_LIST_VIEW2 f
            WHERE 1=1
           	  AND a.SUBJ_YN	= 'Y' 	/*과목여부*/
              AND d.USE_YN 	= 'Y' 	/*교육구분,분류코드 사용여부*/
              AND a.DOC_ID_2 IS NOT NULL
              AND a.PFSR_ID = b.PFSR_ID
              AND a.SUBJ_CD = c.SUBJ_CD
              AND a.CRS_CD 	= d.CRS_CD
              AND a.YR		= e.YR 
              AND a.CRS_CDN = e.CRS_CDN 
              AND a.CRS_CD 	= e.CRS_CD
              AND a.DOC_ID_2 = f.DOC_ID
   			  AND f.FILE_NAME IS NOT NULL  
		]]>	 
		<dynamic>
	        <isNotEmpty property="strYR_CD">
	        	AND a.YR = #strYR_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_DVSN_CD">
	        	AND d.EDU_DVSN_CD = #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
	        	AND d.EDU_CAT_CD = #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
	        	AND a.CRS_CD = #strEDU_CRS_CD#
	       	</isNotEmpty>
	       	<isNotEmpty property="strCRS_CDN">
				AND a.CRS_CDN = #strCRS_CDN#
	       	</isNotEmpty>
	       	<isNotEmpty property="strNAM">
				AND UPPER(b.NAM) LIKE '%' || UPPER(#strNAM#) || '%'
	       	</isNotEmpty>
	       	<isNotEmpty property="strKEYW_TXT">
				AND (UPPER(a.KEYW1_TXT) LIKE '%' || UPPER(#strKEYW_TXT#) || '%' 
					OR UPPER(a.KEYW2_TXT) LIKE '%' || UPPER(#strKEYW_TXT#) || '%' 
					OR UPPER(a.KEYW3_TXT) LIKE '%' || UPPER(#strKEYW_TXT#) || '%')
	       	</isNotEmpty>
	    </dynamic>	 
	    	ORDER BY a.YR , a.CRS_CD, a.CRS_CDN
	           
	</select>
	
	<insert id="CSPSAE101E_EH_INF_SP_AE_001_Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO EH_INF_SP_AE_001
			    (
			        IF_SEQ,
			        IF_TYPE,
					YR,
					EDU_DVSN_CD,
					EDU_DVSN_NM,
					EDU_CAT_CD,
					EDU_CAT_NM,
					CRS_CD,
					CRS_NM,
					CRS_CDN,
					EDU_GL_TXT,
					EDU_TG_TXT,
					ONTM_NOP_CNT,
					EDU_STR_DT,
					EDU_END_DT,
					EDU_PRD_TXT,
					EDU_TXT,
					INQ_DPT_NM,
					INQ_TNB,
					FLAG,
					FRT_USR_ID
			    )
			VALUES
			    (
			        #IF_SEQ#,
			        'SND',
					#YR#,
					#EDU_DVSN_CD#,
					#EDU_DVSN_NM#,
					#EDU_CAT_CD#,
					#EDU_CAT_NM#,
					#CRS_CD#,
					#CRS_NM#,
					#CRS_CDN#,
					#EDU_GL_TXT#,
					#EDU_TG_TXT#,
					#ONTM_NOP_CNT#,
					#EDU_STR_DT#,
					#EDU_END_DT#,
					#EDU_PRD_TXT#,
					#EDU_TXT#,
					#INQ_DPT_NM#,
					#INQ_TNB#,
					#FLAG#,
					#FRT_USR_ID#
			    )
		]]>
	</insert>
	
	<insert id="CSPSAE105E_EH_INF_SP_AE_002_Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO EH_INF_SP_AE_002
			(
				IF_SEQ,
				IF_TYPE,
				YR,
				CRS_CD,
				CRS_CDN,
				SUBJ_SNO,
				SUBJ_CD,
				SUBJ_NM,
				LCT_TM_HM,
				JON_TM_HM,
				ETC_TM_HM,
				FLAG,
				SUBJ_YN,
				PFSR_ID,
				FRT_USR_ID
			)
			VALUES
			(
				#IF_SEQ#,
				'SND',
				#YR#,
				#CRS_CD#,
				#CRS_CDN#,
				#SUBJ_SNO#,
				#SUBJ_CD#,
				#SUBJ_NM#,
				#LCT_TM_HM#,
				#JON_TM_HM#,
				#ETC_TM_HM#,
				#FLAG#,
				#SUBJ_YN#,
				#PFSR_ID#,
				#FRT_USR_ID#
			)
		]]>
	</insert>
	
	<insert id="CSPSAE105E_EH_INF_SP_AE_003_Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO EH_INF_SP_AE_003
			(
				IF_SEQ,
				IF_TYPE,
				YR,
				CRS_CD,
				CRS_CDN,
				TANE_ID,
				STD_EDU_EXS,
				STD_DMT_EXS,
				NAM,
				STD_DINR_FDEX,
				STD_BRKF_FDEX,
				STD_LUNCH_FDEX,
				BTDT,
				NPL_BLT_NM,
				HPN,
				SNO,
				FLAG,
				FRT_USR_ID
			)
			VALUES
			(
				#IF_SEQ#,
				'SND',
				#YR#,
				#CRS_CD#,
				#CRS_CDN#,
				#TANE_ID#,
				#STD_EDU_EXS#,
				#STD_DMT_EXS#,
				#NAM#,
				#STD_DINR_FDEX#,
				#STD_BRKF_FDEX#,
				#STD_LUNCH_FDEX#,
				#BTDT#,
				#NPL_BLT_NM#,
				#HPN#,
				#SNO#,
				#FLAG#,
				#FRT_USR_ID#
			)
		]]>
	</insert>
	
</sqlMap> 
