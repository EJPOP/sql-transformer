<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="aep/gkm/047" >
	<!-- PC장비코드관리 내역 조회 -->
	
	<resultMap class="java.util.HashMap" id="cspaepMap">
		<result property="SRNO" column="SRNO"	jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="LAG_CAT_CD" column="LAG_CAT_CD"	jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="MID_CAT_CD" column="MID_CAT_CD"	jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="SALL_CAT_CD" column="SALL_CAT_CD"	jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TIT_NM" column="TIT_NM"	jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ORG_TYP_CD" column="ORG_TYP_CD"	jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="MAIN_ORG_NM" column="MAIN_ORG_NM"	jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DTL_TXT" column="DTL_TXT"	jdbcType="CLOB" javaType="java.lang.String" />
	</resultMap>
	
	<select id="AEPGKM047PMainSelect" parameterClass="paramMap" resultMap="cspaepMap">
        <![CDATA[
			SELECT 	A.SRNO, 				/*일련번호*/
					A.LAG_CAT_CD,			/*대분류코드*/
					A.MID_CAT_CD,		/*중분류코드*/
					A.SALL_CAT_CD,			/*소분류코드*/
					A.TIT_NM,			/*제목명*/
					A.ORG_TYP_CD,	/*기관유형코드*/
					A.MAIN_ORG_NM,			/*주요기관명*/
					B.DTL_TXT
			FROM	TBAEPGKM019M A	/*PC장비코드*/
					,TBAEPGKM020D B
			WHERE	A.SRNO = B.SRNO
        	AND		A.SRNO = #strSRNO#
        ]]>
	</select> 
	
	
	<select id="AEPGKM047PKeySelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[     	
			SELECT 	TO_CHAR(NVL(MAX(TO_NUMBER(SRNO)),0)+1) AS SRNO
			FROM 	TBAEPGKM019M
			WHERE 	1=1
		]]>
	</select>
	
	<insert id="AEPGKM047P019Merge" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO 	TBAEPGKM019M A     	
			USING 	(	SELECT 	#SRNO# AS SRNO 
        				FROM DUAL
        			) B
        	ON		(	A.SRNO = B.SRNO
        			)
        	WHEN MATCHED THEN
        			UPDATE	
        			SET		LAG_CAT_CD = #LAG_CAT_CD#
        					,MID_CAT_CD = #MID_CAT_CD#
        					,SALL_CAT_CD = #SALL_CAT_CD#
        					,TIT_NM = #TIT_NM#
        					,ORG_TYP_CD = #ORG_TYP_CD#
        					,MAIN_ORG_NM = #MAIN_ORG_NM#
        					,FNL_USR_ID = #FNL_USR_ID#
        					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
        					,FNL_MNU_ID = #FNL_MNU_ID#
        					,FNL_MDF_DH = SYSDATE
        	WHEN NOT MATCHED THEN
		        	INSERT 		(	SRNO
		        					,LAG_CAT_CD
		        					,MID_CAT_CD
		        					,SALL_CAT_CD
		        					,TIT_NM
		        					,ORG_TYP_CD
		        					,MAIN_ORG_NM
		        					,FRT_USR_ID
		        					,FNL_USR_ID
		        					,FNL_DEAL_DPT_CD
		        					,FNL_MNU_ID
		        					,FRT_REGI_DH
		        					,FNL_MDF_DH
		        				)
		        		VALUES	(	#SRNO#
		        					,#LAG_CAT_CD#
		        					,#MID_CAT_CD#
		        					,#SALL_CAT_CD#
		        					,#TIT_NM#
		        					,#ORG_TYP_CD#
		        					,#MAIN_ORG_NM#
		        					,#FRT_USR_ID#
		        					,#FNL_USR_ID#
		        					,#FNL_DEAL_DPT_CD#
		        					,#FNL_MNU_ID#
		        					,SYSDATE
		        					,SYSDATE
		        				)
		]]>
		
	</insert>
	
	<insert id="AEPGKM047P020Merge" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO 	TBAEPGKM020D A     	
			USING 	(	SELECT 	#SRNO# AS SRNO 
        				FROM DUAL
        			) B
        	ON		(	A.SRNO = B.SRNO
        			)
        	WHEN MATCHED THEN
        			UPDATE	
        			SET		DTL_TXT = #DTL_TXT#
        					
        	WHEN NOT MATCHED THEN
		        	INSERT 		(	SRNO
		        					,DTL_TXT
		        					,FRT_USR_ID
		        					,FNL_USR_ID
		        					,FNL_DEAL_DPT_CD
		        					,FNL_MNU_ID
		        					,FRT_REGI_DH
		        					,FNL_MDF_DH
		        				)
		        		VALUES	(	#SRNO#
		        					,#DTL_TXT#
		        					,#FRT_USR_ID#
		        					,#FNL_USR_ID#
		        					,#FNL_DEAL_DPT_CD#
		        					,#FNL_MNU_ID#
		        					,SYSDATE
		        					,SYSDATE
		        				)
		]]>
		
	</insert>
</sqlMap>

