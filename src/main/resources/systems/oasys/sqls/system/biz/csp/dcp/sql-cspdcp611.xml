<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/611">
 	
 	<select id="CSPDCP611QDPTSELECT" resultClass="resultMap">
 	<![CDATA[
 	SELECT DPT_CD, DPT_NM,HIRK_DPT_CD
	  FROM TBDCMACM002M
	 WHERE 1=1
	   AND HIRK_DPT_CD = '071000'
	   AND USE_YN ='Y' 
	   AND DPT_CD NOT IN ('071000')
	]]>            
 	</select>
 	
 	<select id="CSPDCP611QUSRSELECT" resultClass="resultMap">
 	<![CDATA[
		SELECT	USR_ID, USR_NAM, DPT_CD
       	FROM	TBDCMACM001M
       	WHERE	DPT_CD LIKE '071%'
       	AND 	DPT_CD NOT IN ('071000')
       	AND		RSG_DT IS NULL
		AND		RQS_STA_CD = '3'
		AND		BAI_USR_YN = 'Y'
		ORDER BY USR_NAM ASC
    ]]>
 	</select>
 	<select id="CSPDCP611QMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<include refid = "include.pageSelct"/>
		<![CDATA[
			SELECT D2.CVPT_KND_DVSN_CD
			      /*,SUBSTR(F_CODE_NM('1000599', D2.CVPT_KND_DVSN_CD),0 ,2) AS CVPT_KND_DVSN_NM*/
			      /*,(SELECT SUBSTR(F_CODE_NM('1000599', S1.USR_DFN_TXT_1), 0, 2) FROM TBDCMACM013C S1 WHERE S1.CMM_CD_DVSN_CD = '1000047' AND S1.CD = D1.CVPT_KND_CD) AS CVPT_KND_DVSN_NM*/
			      ,D8.USR_DFN_TXT_2 AS CVPT_KND_DVSN_NM 
			      ,D1.CVPT_KND_CD
			      ,D8.CD_NM AS CVPT_KND_NM 
			      ,TO_CHAR(D1.ACP_DH, 'YYYY-MM-DD HH24:MI') AS ACP_DH
			      ,D1.ACP_YR
			      ,D1.CVPT_ACP_NO
			      ,D1.REQ_DVSN_CD
			      ,D1.RM_CVPT_ACP_NO
			      ,DECODE(D1.RM_CVPT_ACP_NO, NULL,'',D1.ACP_YR ||'-민원-'||D1.RM_CVPT_ACP_NO) AS ACP_YR_NO
			      ,D1.TIT_NM
			      ,DECODE(D1.REQR_KND_CD,'1',D1.CVPTR_NM,'2',D1.RPST_PEN_NM,'3',D1.RPST_PEN_NM,'4',D1.CVPTR_NM) AS CVPTR_NM
			      ,F_DPT_INFO(D2.HNDL_DPT_CD, '1') AS HNDL_DPT_CD
			      ,(SELECT S2.USR_NAM FROM TBDCMACM001M S2 WHERE USR_ID = D2.HNDL_CHGR_ID) AS USR_NAM
			      ,D1.CVPT_HNDL_STA_CD
			      ,F_CODE_NM('1000361',D1.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
			      ,D4.ORG_NMS AS ORG_CD
			      ,F_CODE_NM('1000754', D3.CVPT_HNDL_DVSN_CD) AS CVPT_HNLD_DVSN_NM
			      ,F_CODE_NM('1000051', D3.T_CVPT_HNDL_DVSN_CD) AS T_CVPT_HNLD_DVSN_NM
			      ,TO_CHAR(D2.FNL_HNDL_DH, 'YYYY-MM-DD') AS FNL_HNDL_DH
			      ,TO_CHAR(D2.FNL_DTB_DH, 'YYYY-MM-DD') AS FNL_DTB_DH
			      ,CASE WHEN D6.CNT > 0 THEN 'O' ELSE 'X' END AS HNDL_YN
			      ,CASE WHEN D7.CNT > 0 THEN 'O' ELSE 'X' END AS BOGO_YN
			      ,F_DPT_INFO(D1.ACP_DPT_CD,'1') AS ACP_DPT_NM
   				  ,F_CODE_NM('1000056',D1.ACP_RUT_CD) AS ACP_RUT_NM
   				  ,D1.REQR_KND_CD
   				  ,(SELECT 	F_CODE_NM('1000053',S1.RSLT_RPRT_HNDL_RSLT_CD) 
   				  	FROM	TBCSPDCP402L S1
   				  	WHERE	(S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO, S1.DGE) IN	(SELECT	S2.REQ_DVSN_CD, S2.ACP_YR, S2.CVPT_ACP_NO, MIN(S2.DGE) AS DGE
   				  																	FROM	TBCSPDCP402L S2
   				  																	WHERE	S2.REQ_DVSN_CD = D1.REQ_DVSN_CD
   				  																	AND		S2.ACP_YR = D2.ACP_YR
   				  																	AND		S2.CVPT_ACP_NO = D2.CVPT_ACP_NO
   				  																	GROUP BY S2.REQ_DVSN_CD, S2.ACP_YR, S2.CVPT_ACP_NO
   				  																	)
   				  ) AS RSLT_RPRT_HNDL_RSLT_NM
   				  ,D1.CPNM_NM
   				  ,F_USR_INFO_BY_ID(D2.BAI_CHGR_ID,'2') AS BAI_CHGR_NM			
			  FROM TBCSPDCP101M D1
			      ,TBCSPDCP201M D2
			      ,TBCSPDCP205L D3
                  ,(SELECT	S1.REQ_DVSN_CD
                            , S1.ACP_YR
                            , S1.CVPT_ACP_NO
                            , AGGR_CONCAT( DECODE(S1.OGN_ORG_DVSN_CD,'10',S2.ORG_NM,'20',S1.ORG_NM), '/') AS ORG_NMS
                    FROM	TBCSPDCP206L S1
                           ,TBDCMACM015M S2
                    WHERE	S1.ORG_CD = S2.ORG_CD(+)
                    AND		S1.REQ_DVSN_CD = '1'
                    AND		S1.ORG_HIS_DVSN_CD = '1'
                    GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO
                    ) D4
			      ,TBCSPDCP102M D5
			      ,(SELECT	S5.REQ_DVSN_CD
                            , S5.ACP_YR
                            , S5.CVPT_ACP_NO
                            , COUNT(*) AS CNT
			      	FROM	TBCSPDCP203M S5
			      	WHERE	S5.DGE IS NULL
			      	AND		S5.CVPT_DOC_DVSN_CD = 'A1'
			      	GROUP BY S5.REQ_DVSN_CD, S5.ACP_YR, S5.CVPT_ACP_NO ) D6
			      ,(SELECT	S6.REQ_DVSN_CD
                            , S6.ACP_YR
                            , S6.CVPT_ACP_NO
                            , COUNT(*) AS CNT
			      	FROM	TBCSPDCP203M S6
			      	WHERE	S6.DGE IS NOT NULL
			      	AND		S6.CVPT_DOC_DVSN_CD = 'B1'
			      	GROUP BY S6.REQ_DVSN_CD, S6.ACP_YR, S6.CVPT_ACP_NO) D7
			      ,TBDCMACM013C D8
			 WHERE 1=1
			   AND D1.REQ_DVSN_CD = '1'
			   AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D2.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D4.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D4.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D4.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D5.REQ_DVSN_CD
			   AND D1.CVPT_ACP_NO = D5.CVPT_ACP_NO
			   AND D1.ACP_YR      = D5.ACP_YR
			   AND D1.REQ_DVSN_CD = D6.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D6.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D6.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D7.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D7.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D7.ACP_YR(+)
			    AND D1.REQ_DVSN_CD = D3.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D3.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D3.ACP_YR(+)
			   AND D3.SRNO(+) = 1
			   AND D8.CMM_CD_DVSN_CD = '1000047'
			   AND D8.CD <> '000000000'
			   AND D1.CVPT_KND_CD = D8.CD
			   
			   ]]>
			<dynamic>
			<isEqual property="SEARCHDTKEY" compareValue="A">
			   AND TO_CHAR(D1.ACP_DH, 'YYYYMMDD') BETWEEN #STARTDT# AND #ENDDT#
			</isEqual>
			<isNotEmpty property="CVPT_KND_DVSN_CD">
				AND D2.CVPT_KND_DVSN_CD = #CVPT_KND_DVSN_CD#
			</isNotEmpty>
			<isEqual property="SEARCHDTKEY" compareValue="B">
			   AND TO_CHAR(D2.FNL_HNDL_DH, 'YYYYMMDD') BETWEEN #STARTDT# AND #ENDDT#
			</isEqual>
			
			<isEqual property="SEARCHDTKEY" compareValue="C">
			   AND TO_CHAR(D1.FRT_REGI_DH, 'YYYYMMDD') BETWEEN #STARTDT# AND #ENDDT#
			</isEqual>
			
			<isEqual property="SEARCHTITKEY" compareValue="1">
			 <isNotEmpty property="TIT_NM">
			   AND D1.TIT_NM LIKE '%'||#TIT_NM#||'%'
			 </isNotEmpty>
			</isEqual>
			
			<isEqual property="SEARCHTITKEY" compareValue="2">
			 <isNotEmpty property="TIT_NM">
			 
			   AND D5.CVPT_SBT LIKE '%'||#TIT_NM#||'%'
			 </isNotEmpty>
			</isEqual>      
			
			<isNotEmpty property="ACP_YR">
			
			   AND D1.ACP_YR = #ACP_YR#
			</isNotEmpty>   

			<isNotEmpty property="RM_CVPT_ACP_NO">
			
			   AND D1.RM_CVPT_ACP_NO = #RM_CVPT_ACP_NO#
			</isNotEmpty> 

			<isNotEmpty property="CVPTR_NM">
			  AND	(D1.CVPTR_NM LIKE '%'||#CVPTR_NM#||'%' OR D1.RPST_PEN_NM LIKE '%'||#CVPTR_NM#||'%')
			</isNotEmpty> 

			<isNotEmpty property="BANBOKCNT">
				AND (D1.CVPTR_NM, D1.HPN) IN ( SELECT S1.CVPTR_NM , S1.HPN
						                         FROM TBCSPDCP101M S1
						                        WHERE 1=1
						                          AND S1.REQ_DVSN_CD = '1'
						                          AND S1.HPN IS NOT NULL
						                        GROUP BY S1.CVPTR_NM , S1.HPN
						                       HAVING COUNT(*) > #BANBOKCNT#
						                       )
			</isNotEmpty> 
			   
			<isNotEmpty property="TNB">
			   AND REPLACE(D1.TNB, '-', '') LIKE '%'||#TNB#||'%'
			</isNotEmpty>
			
			<isNotEmpty property= "HPN">  
			   AND REPLACE(D1.HPN, '-', '') LIKE '%'||#HPN#||'%'
			</isNotEmpty>
			
			<isNotEmpty property="CVPT_HNDL_STA_CD">
			
			   AND D1.CVPT_HNDL_STA_CD = #CVPT_HNDL_STA_CD#
			</isNotEmpty>
			 
			<isNotEmpty property="strCVPT_KND_CD">
			   AND D1.CVPT_KND_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #strCVPT_KND_CD# ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
			</isNotEmpty>   
			
			<isNotEmpty property="strREQR_KND_CD">					                    
			   AND D1.REQR_KND_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #strREQR_KND_CD# ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
			</isNotEmpty>
			
			<isNotEmpty property="strACP_RUT_CD">								                    
			   AND D1.ACP_RUT_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #strACP_RUT_CD# ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
   			</isNotEmpty>	
   			
   			<isNotEmpty property="strMNG_TYP_CD">							                    
			   AND D1.MNG_TYP_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #strMNG_TYP_CD# ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
			</isNotEmpty>
			
			<isEmpty property="HNDL_CHGR_ID">
				<isNotEmpty property="HNDL_DPT_CD">
				   AND NVL(D2.HNDL_DPT_CD,D1.ACP_DPT_CD) = #HNDL_DPT_CD#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="HNDL_CHGR_ID">
				   AND D2.HNDL_CHGR_ID = #HNDL_CHGR_ID#
			</isNotEmpty>
			<isNotEmpty property="strPASV_ADMN_YN" prepend="AND">
					NVL(D2.PASV_ADMN_YN,'N') = #strPASV_ADMN_YN#
			</isNotEmpty>
			<isNotEmpty property="strAD" prepend="AND">
					(D1.AD LIKE '%'||#strAD#||'%' OR D1.DTL_AD LIKE '%'||#strAD#||'%')
			</isNotEmpty>
			<isNotEmpty property="strORG_CD" prepend="AND">
					(D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD = '1'
																	AND		ORG_CD = #strORG_CD#
																 )
			</isNotEmpty>
			
			<isNotEmpty property="strTRNF_ORG_CD" prepend="AND">
					(D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD IN ('2','3')
																	AND		ORG_CD = #strTRNF_ORG_CD#
																 )
			</isNotEmpty>
			<isNotEmpty property="strTRNF_DPT_CD" prepend="AND">
					(D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP205L
																	WHERE	TRNF_DPT_CD = #strTRNF_DPT_CD#
																	AND		SRNO=1
																 )
			</isNotEmpty>
			
			<isNotEmpty property="strHMP_APL_NO">
			   AND D1.HMP_APL_NO = #strHMP_APL_NO#
			</isNotEmpty> 
			
			<isNotEmpty property="strSMG_CVPT_APL_NO">
			   AND D1.SMG_CVPT_APL_NO = #strSMG_CVPT_APL_NO#
			</isNotEmpty> 
			<isNotEmpty property="strCVPT_HNDL_DVSN_CD">
			   AND D3.CVPT_HNDL_DVSN_CD = #strCVPT_HNDL_DVSN_CD#
			</isNotEmpty>
		</dynamic>
			    <include refid = "include.pageOrder"/> 
	</select>
	
	
	
	<select id="CSPDCP611QExcelDownLoadSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT D2.CVPT_KND_DVSN_CD
			      /*,F_CODE_NM('1000599', D2.CVPT_KND_DVSN_CD) AS CVPT_KND_DVSN_NM*/
			      ,(SELECT F_CODE_NM('1000599', S1.USR_DFN_TXT_1) FROM TBDCMACM013C S1 WHERE S1.CMM_CD_DVSN_CD = '1000047' AND S1.CD = D1.CVPT_KND_CD) AS CVPT_KND_DVSN_NM
			      ,D1.CVPT_KND_CD
			      ,F_CODE_NM('1000047', D1.CVPT_KND_CD) AS CVPT_KND_NM
			      ,TO_CHAR(D1.ACP_DH, 'YYYY-MM-DD HH:MM') AS ACP_DH
			      ,D1.ACP_YR
			      ,D1.CVPT_ACP_NO
			      ,D1.ACP_YR ||'-민원-'||D1.RM_CVPT_ACP_NO AS ACP_YR_NO
			      ,D1.TIT_NM
			      ,D1.CVPTR_NM
			      ,F_DPT_INFO(D2.HNDL_DPT_CD, '1') AS HNDL_DPT_CD
			      ,(SELECT S2.USR_NAM FROM TBDCMACM001M S2 WHERE USR_ID = D2.HNDL_CHGR_ID) AS USR_NAM
			      ,D1.CVPT_HNDL_STA_CD
			      ,F_CODE_NM('1000361',D1.CVPT_HNDL_STA_CD) AS CVPT_HNDL_STA_NM
			      ,D4.ORG_NMS AS ORG_CD
			      ,F_CODE_NM('1000754', D3.CVPT_HNDL_DVSN_CD) AS CVPT_HNLD_DVSN_NM
			      ,F_CODE_NM('1000051', D3.T_CVPT_HNDL_DVSN_CD) AS T_CVPT_HNLD_DVSN_NM
			      ,TO_CHAR(D2.FNL_HNDL_DH, 'YYYY-MM-DD') AS FNL_HNDL_DH
			      ,TO_CHAR(D2.FNL_DTB_DH, 'YYYY-MM-DD') AS FNL_DTB_DH
			      ,(	SELECT	DECODE(COUNT(*),0,1,COUNT(*))
   						FROM	TBCSPDCP101M S1
   						WHERE	S1.REQ_DVSN_CD = '1' 
   						AND		S1.CVPTR_NM = D1.CVPTR_NM
   						AND		S1.HPN = D1.HPN
   					) AS JEBOCNT
   				  ,F_CODE_NM('1000056',D1.ACP_RUT_CD) AS ACP_RUT_NM
   				  ,D4.COPT_ORG_NM
   				  ,(SELECT 	F_CODE_NM('1000053',S1.RSLT_RPRT_HNDL_RSLT_CD) 
   				  	FROM	TBCSPDCP402L S1
   				  	WHERE	(S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO, S1.DGE) IN	(SELECT	S2.REQ_DVSN_CD, S2.ACP_YR, S2.CVPT_ACP_NO, MIN(S2.DGE) AS DGE
   				  																	FROM	TBCSPDCP402L S2
   				  																	WHERE	S2.REQ_DVSN_CD = D1.REQ_DVSN_CD
   				  																	AND		S2.ACP_YR = D2.ACP_YR
   				  																	AND		S2.CVPT_ACP_NO = D2.CVPT_ACP_NO
   				  																	GROUP BY S2.REQ_DVSN_CD, S2.ACP_YR, S2.CVPT_ACP_NO
   				  																	)
   				  ) AS RSLT_RPRT_HNDL_RSLT_NM
   				  ,F_DPT_INFO(D3.AUD_RFR_MTRL_TRNF_DPT_CD,'1') AS AUD_RFR_MTRL_TRNF_DPT_NM
   				  ,F_DPT_INFO(D3.TRNF_DPT_CD,'1') AS TRNF_DPT_NM
   				  ,F_DPT_INFO(D1.ACP_DPT_CD,'1') AS ACP_DPT_NM
   				  ,D11.ORG_NMS AS TRNF_ORG_NM
   				  ,D1.CPNM_NM
   				  ,F_USR_INFO_BY_ID(D2.BAI_CHGR_ID,'2') AS BAI_CHGR_NM	
   				  ,NVL(PUB_DVSN_NM,'미분류') AS PUB_DVSN_NM
			  FROM TBCSPDCP101M D1
			      ,TBCSPDCP201M D2
			      ,TBCSPDCP205L D3
                  ,(SELECT	S1.REQ_DVSN_CD
                            , S1.ACP_YR
                            , S1.CVPT_ACP_NO
                            , AGGR_CONCAT( DECODE(S1.OGN_ORG_DVSN_CD,'10',S2.ORG_NM,'20',S1.ORG_NM), '/') AS ORG_NMS
                            , AGGR_CONCAT((SELECT ORG_NM FROM TBDCMACM015M WHERE  ORG_CD = S1.COPT_SG_CD||'000000000'),'/') AS COPT_ORG_NM
                            , AGGR_CONCAT(CASE WHEN S1.PUB_DVSN_CD = '10' THEN '국가기관' 
                            	WHEN S1.PUB_DVSN_CD IN ('20', '21','22', '23') THEN '지방자치단체' 
                            	WHEN S1.PUB_DVSN_CD IN ('30', '31', '32', '33') THEN '공공기관'
                            	WHEN S1.PUB_DVSN_CD = '40'  THEN '기타단체'
                            	ELSE '미분류' END ,'/')AS PUB_DVSN_NM
                    FROM	TBCSPDCP206L S1
                           ,TBDCMACM015M S2
                    WHERE	S1.ORG_CD = S2.ORG_CD(+)
                    AND		S1.REQ_DVSN_CD = '1'
                    AND		S1.ORG_HIS_DVSN_CD = '1'
                    GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO
                    ) D4
			      ,TBCSPDCP102M D5
			      ,(SELECT	S1.REQ_DVSN_CD
                            , S1.ACP_YR
                            , S1.CVPT_ACP_NO
                            , AGGR_CONCAT (S2.ORG_NM, '/') AS ORG_NMS
                    FROM	TBCSPDCP206L S1
                           ,TBDCMACM015M S2
                    WHERE	S1.ORG_CD = S2.ORG_CD(+)
                    AND		S1.REQ_DVSN_CD = '1'
                    AND		S1.ORG_HIS_DVSN_CD IN ('2','3')
                    GROUP BY S1.REQ_DVSN_CD, S1.ACP_YR, S1.CVPT_ACP_NO
                    ) D11
			 WHERE D1.REQ_DVSN_CD = '1'
			   AND D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D2.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D3.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D3.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D3.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D4.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D4.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D4.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D5.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D5.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D5.ACP_YR(+)
			   AND D1.REQ_DVSN_CD = D11.REQ_DVSN_CD(+)
			   AND D1.CVPT_ACP_NO = D11.CVPT_ACP_NO(+)
			   AND D1.ACP_YR      = D11.ACP_YR(+)
			   AND D3.SRNO(+) = '1'
			   ]]>
			<dynamic>
			
			<isNotEmpty property="CVPT_KND_DVSN_CD">
				AND D2.CVPT_KND_DVSN_CD = #CVPT_KND_DVSN_CD#
			</isNotEmpty>
			<isEqual property="SEARCHDTKEY" compareValue="A">
			   AND TO_CHAR(ACP_DH, 'YYYYMMDD') BETWEEN #STARTDT# AND #ENDDT#
			</isEqual>
			
			<isEqual property="SEARCHDTKEY" compareValue="B">
			   AND TO_CHAR(D2.FNL_HNDL_DH, 'YYYYMMDD') BETWEEN #STARTDT# AND #ENDDT#
			</isEqual>
			
			<isEqual property="SEARCHTITKEY" compareValue="1">
			 <isNotEmpty property="TIT_NM">
			   AND D1.TIT_NM LIKE '%'||#TIT_NM#||'%'
			 </isNotEmpty>
			</isEqual>
			
			<isEqual property="SEARCHTITKEY" compareValue="2">
			 <isNotEmpty property="TIT_NM">
			 
			   AND D5.CVPT_SBT LIKE '%'||#TIT_NM#||'%'
			 </isNotEmpty>
			</isEqual>      
			
			<isNotEmpty property="ACP_YR">
			
			   AND D1.ACP_YR = #ACP_YR#
			</isNotEmpty>   

			<isNotEmpty property="RM_CVPT_ACP_NO">
			
			   AND D1.RM_CVPT_ACP_NO = #RM_CVPT_ACP_NO# 
			</isNotEmpty> 

			<isNotEmpty property="CVPTR_NM">
				AND	(D1.CVPTR_NM LIKE '%'||#CVPTR_NM#||'%' OR D1.RPST_PEN_NM LIKE '%'||#CVPTR_NM#||'%')
			</isNotEmpty> 

			<isNotEmpty property="BANBOKCNT">
				AND D1.CVPTR_NM IN (SELECT S1.CVPTR_NM 
				                         FROM TBCSPDCP101M S1
				                        WHERE 1=1
				                          AND S1.REQ_DVSN_CD = D1.REQ_DVSN_CD
				                          AND S1.CVPT_ACP_NO = D1.CVPT_ACP_NO
				                          AND S1.ACP_YR      = D1.ACP_YR
				                        GROUP BY S1.CVPTR_NM 
				                       HAVING COUNT(*) > #BANBOKCNT#
				                       )
			</isNotEmpty> 
			   
			<isNotEmpty property="TNB">
			   AND D1.TNB = #TNB#
			</isNotEmpty>
			
			<isNotEmpty property= "HPN">  
			   AND D1.HPN = #HPN#
			</isNotEmpty>
			
			<isNotEmpty property="CVPT_HNDL_STA_CD">
			
			   AND D1.CVPT_HNDL_STA_CD = #CVPT_HNDL_STA_CD#
			</isNotEmpty>
			 
			<isNotEmpty property="strCVPT_KND_CD">
			   AND D1.CVPT_KND_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #strCVPT_KND_CD# ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
			</isNotEmpty>   
			
			<isNotEmpty property="strREQR_KND_CD">					                    
			   AND D1.REQR_KND_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #strREQR_KND_CD# ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
			</isNotEmpty>
			
			<isNotEmpty property="strACP_RUT_CD">								                    
			   AND D1.ACP_RUT_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #strACP_RUT_CD# ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
   			</isNotEmpty>	
   			
   			<isNotEmpty property="strMNG_TYP_CD">							                    
			   AND D1.MNG_TYP_CD IN (SELECT 	SUBSTR(CODE,INSTR(CODE,',',1,LEVEL)+1,INSTR(CODE,',',1,LEVEL+1)-INSTR(CODE,',',1,LEVEL) -1) merge_col
								                    FROM 	DUAL A
								                    CROSS JOIN(SELECT ','|| #strMNG_TYP_CD# ||',' AS CODE FROM DUAL) B
								                    CONNECT BY LEVEL&lt;=LENGTH(CODE)-LENGTH(REPLACE(CODE,','))-1 )
			</isNotEmpty>
			<isEmpty property="HNDL_CHGR_ID">
				<isNotEmpty property="HNDL_DPT_CD">
				   AND NVL(D2.HNDL_DPT_CD,D1.ACP_DPT_CD) = #HNDL_DPT_CD#
				</isNotEmpty>
			</isEmpty>
			<isNotEmpty property="HNDL_CHGR_ID">
				   AND D2.HNDL_CHGR_ID = #HNDL_CHGR_ID#
			</isNotEmpty>
			<isNotEmpty property="strPASV_ADMN_YN" prepend="AND">
					NVL(D2.PASV_ADMN_YN,'N') = #strPASV_ADMN_YN#
			</isNotEmpty>
			<isNotEmpty property="strAD" prepend="AND">
					(D1.AD LIKE '%'||#strAD#||'%' OR D1.DTL_AD LIKE '%'||#strAD#||'%')
			</isNotEmpty>
			<isNotEmpty property="strORG_CD" prepend="AND">
					(D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD = '1'
																	AND		ORG_CD = #strORG_CD#
																 )
			</isNotEmpty>
			<isNotEmpty property="strTRNF_ORG_CD" prepend="AND">
					(D1.REQ_DVSN_CD,D1.ACP_YR,D1.CVPT_ACP_NO) IN (	SELECT  REQ_DVSN_CD,ACP_YR,CVPT_ACP_NO
																	FROM	TBCSPDCP206L
																	WHERE	ORG_HIS_DVSN_CD IN ('2','3')
																	AND		ORG_CD = #strTRNF_ORG_CD#
																 )
			</isNotEmpty>
			<isNotEmpty property="strTRNF_DPT_CD" prepend="AND">
					D3.TRNF_DPT_CD = #strTRNF_DPT_CD#
			</isNotEmpty>
			
			<isNotEmpty property="strHMP_APL_NO">
			   AND D1.HMP_APL_NO = #strHMP_APL_NO#
			</isNotEmpty> 
			
			<isNotEmpty property="strSMG_CVPT_APL_NO">
			   AND D1.SMG_CVPT_APL_NO = #strSMG_CVPT_APL_NO#
			</isNotEmpty> 
			<isNotEmpty property="strCVPT_HNDL_DVSN_CD">
			   AND D3.CVPT_HNDL_DVSN_CD = #strCVPT_HNDL_DVSN_CD#
			</isNotEmpty> 
			
		</dynamic>
	</select>
	
</sqlMap> 
