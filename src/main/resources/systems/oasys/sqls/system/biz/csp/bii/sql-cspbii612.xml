<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/bii/612">

	<!-- 공무원/공공직원 정보 조회 -->
	<select id="CSPBII612QSubSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[       
			SELECT A.NAM					                           /* 성명 */				 
				 , A.MTRL_DVSN_CD                                      /* 자료구분 */
				 , A.EPS_MNG_DVSN_CD                                   /* 중점관리구분 */
				 , A.RSG_YN                                            /* 퇴직여부 */	
				 , A.WRK_RANK_CD                                       /* 근무직급코드 */		
				 , A.BLT_ORG_CD                                        /* 소속기관코드 */
				 , (SELECT B.ORG_NM
				      FROM TBDCMACM015M B
				     WHERE B.ORG_CD = A.BLT_ORG_CD) AS BLT_ORG_NM      /* 소속기관명 */				
				 , A.ORG_DVSN_CD                                       /* 기관구분코드 */
				 , A.DTIL_ORG_NM                                       /* 세부기관명 */
				 , A.DTIL_RANK_NM                                      /* 세부직급명 */
				 , A.JOCP_DT                                           /* 입사일 */
				 , A.RSG_DT                                            /* 퇴사일 */
				 , A.EIN                                               /* 암호화주민등록번호 */
				 , A.RRN_SRNO                                          /* 주민등록번호일련번호 */
				 , (SELECT TO_CHAR(B.FRT_REGI_DH, 'YYYY.MM.DD') || ' 등록'
				      FROM TBCSPBII300M B
				     WHERE B.EIN = A.EIN)           AS INSP_REGI_DT    /* 대인감찰등록일 */			      
				 , A.EIN                            AS CHG_BF_EIN      /* 변경이전암호화주민등록번호 */
				 , A.RRN_SRNO                       AS CHG_BF_RRN_SRNO /* 변경이전주민등록번호일련번호 */
			  FROM TBCSPBII600M A  /* 공무원_공공직원 기본 */
			 WHERE A.EIN      = #strEin# 	 
			   AND A.RRN_SRNO = #strRrnSrno#
		]]>
	</select>

	<!-- 가족사항 조회 -->
	<select id="CSPBII612QFmyselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[       
			SELECT A.FMY_NAM                       /* 가족성명 */
			     , A.FMY_EIN                       /* 가족암호화주민등록번호 */
			     , A.FMY_RLTN_CD                   /* 가족관계코드 */
			     , A.EIN                           /* 암호화주민등록번호 */
			     , A.RRN_SRNO                      /* 주민등록번호일련번호 */
			     , A.SRNO                          /* 일련번호 */			     
			  FROM TBCSPBII620L A
			 WHERE EIN      = #strEin#
			   AND RRN_SRNO = #strRrnSrno#
		]]>
	</select>

	<!-- 근무이력 조회-->
	<select id="CSPBII612QWrkselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[       
			SELECT A.BLT_ORG_CD                                   /* 소속기관코드 */
			     , (SELECT B.ORG_NM
				      FROM TBDCMACM015M B
				     WHERE B.ORG_CD = A.BLT_ORG_CD) AS BLT_ORG_NM /* 소속기관명 */	
			     , A.WRK_RANK_CD                                  /* 직급코드 */
			     , A.JOCP_DT                                      /* 입사일 */
			     , A.RSG_DT                                       /* 퇴사일 */
			     , A.EIN                           /* 암호화주민등록번호 */
			     , A.RRN_SRNO                      /* 주민등록번호일련번호 */
			     , A.SRNO                          /* 일련번호 */		
			  FROM TBCSPBII610L A
			 WHERE EIN      = #strEin#
			   AND RRN_SRNO = #strRrnSrno#
		]]>
	</select>
	
	<!-- 특이사항 내역 조회-->
	<select id="CSPBII612QUnqselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[       	
			SELECT A.UNQ_CD                                /* 특이사항내용 */
			     , A.REL_PEN_NAM                           /* 관련자성명 */
			     , A.REL_PEN_EIN                           /* 관련자주민등록번호 */
			     , A.REL_PEN_RLTN_NM                       /* 관련자관계명 */
			     , A.WRDO_SC                               /* 비위점수 */
			     , A.UNQ_RMK                               /* 비고 */
			     , A.UNQ_CD          AS CHG_BF_UNQ_CD      /* 변경이전 특이사항코드 */
			     , A.EIN                                   /* 암호화주민등록번호 */
			     , A.RRN_SRNO                              /* 주민등록번호일련번호 */
			     , A.SRNO                                  /* 일련번호 */		
			  FROM TBCSPBII630L A 	 
			 WHERE EIN      = #strEin#
			   AND RRN_SRNO = #strRrnSrno# 
		]]>	
	</select>
	
	
	<!-- 공무원/공공직원 등록  -->
	<insert id="CSPBII612Qinsert" parameterClass="paramMap">
		INSERT INTO TBCSPBII600M (
		                          EIN             /* 암호화주민등록번호 */
		                        , RRN_SRNO        /* 주민등록번호일련번호 */
		                        , NAM             /* 성명 */
		                        , WRK_RANK_CD     /* 근무직급코드 */
		                        , BLT_ORG_CD      /* 소속기관코드 */
		                        , RSG_YN          /* 퇴직여부 */
		                        , ORG_DVSN_CD     /* 기관구분코드 */
		                        , EPS_MNG_DVSN_CD /* 중점관리구분코드 */
		                        , JOCP_DT         /* 입사일 */
		                        , RSG_DT          /* 퇴사일 */
		                        , DTIL_ORG_NM     /* 세부기관명 */
		                        , DTIL_RANK_NM    /* 세부직급명 */
		                        , MTRL_DVSN_CD    /* 자료구분코드 */
		                        , FRT_USR_ID      /* 최초사용자ID */
		                        , FNL_USR_ID      /* 최종사용자ID */
		                        , FNL_DEAL_DPT_CD /* 최종거래부서코드 */
		                        , FNL_MNU_ID      /* 최종메뉴ID */
		                        , FRT_REGI_DH     /* 최초등록일시 */
		                        , FNL_MDF_DH      /* 최종수정일시 */
		                         ) 
		                  VALUES (
		                          #EIN#
		                        , #RRN_SRNO#
		                        , #NAM#
		                        , #WRK_RANK_CD#
		                        , #BLT_ORG_CD#
		                        , #RSG_YN#
		                        , #ORG_DVSN_CD#
		                        , #EPS_MNG_DVSN_CD#
		                        , #JOCP_DT#
		                        , #RSG_DT#
		                        , #DTIL_ORG_NM#
		                        , #DTIL_RANK_NM#
		                        , #MTRL_DVSN_CD#
		                        , #FRT_USR_ID#
		                        , #FNL_USR_ID#
		                        , #FNL_DEAL_DPT_CD#
		                        , #FNL_MNU_ID#
		                        , SYSDATE
		                        , SYSDATE
				                 )
	</insert>
	
	<!-- 공무원 공공직원 가족내역 등록  -->
	<insert id="CSPBII612QinsertFmy" parameterClass="paramMap">
		INSERT INTO TBCSPBII620L (
		                       EIN             /* 암호화주민등록번호 */
		                     , RRN_SRNO        /* 주민등록번호일련번호 */
		                     , SRNO            /* 일련번호 */
		                     , FMY_EIN         /* 가족암호화주민등록번호 */
		                     , FMY_NAM         /* 가족성명 */
		                     , FMY_RLTN_CD     /* 가족관계코드 */
		                     , FRT_USR_ID      /* 최초사용자ID */
		                     , FNL_USR_ID      /* 최종사용자ID */
		                     , FNL_DEAL_DPT_CD /* 최종거래부서코드 */
		                     , FNL_MNU_ID      /* 최종메뉴ID */
		                     , FRT_REGI_DH     /* 최초등록일시 */
		                     , FNL_MDF_DH      /* 최종수정일시 */
		                      ) 
		               VALUES (
		                       #EIN#
		                     , #RRN_SRNO#
		                     , (SELECT NVL(MAX(SRNO), 0) + 1 
		                          FROM TBCSPBII620L
		                         WHERE EIN      = #EIN#
		                           AND RRN_SRNO = #RRN_SRNO#)		                        
		                     , #FMY_EIN#
		                     , #FMY_NAM#
		                     , #FMY_RLTN_CD#
		                     , #FRT_USR_ID#
		                     , #FNL_USR_ID#
		                     , #FNL_DEAL_DPT_CD#
		                     , #FNL_MNU_ID#
		                     , SYSDATE
		                     , SYSDATE
		                )
	</insert>
	
	<!-- 공무원 공공직원 근무이력 등록  -->
	<insert id="CSPBII612QinsertWrk" parameterClass="paramMap">
		INSERT INTO TBCSPBII610L (
		                          EIN             /* 암호화주민등록번호 */
		                        , RRN_SRNO        /* 주민등록번호일련번호 */
		                        , SRNO            /* 일련번호 */  
		                        , BLT_ORG_CD      /* 소속기관코드 */
		                        , WRK_RANK_CD     /* 근무직급코드 */
		                        , JOCP_DT         /* 입사일 */
		                        , RSG_DT          /* 퇴직일 */
		                        , FRT_USR_ID      /* 최초사용자ID */
		                        , FNL_USR_ID      /* 최종사용자ID */
		                        , FNL_DEAL_DPT_CD /* 최종거래부서코드 */
		                        , FNL_MNU_ID      /* 최종메뉴ID */
		                        , FRT_REGI_DH     /* 최초등록일시 */
		                        , FNL_MDF_DH      /* 최종수정일시 */
		                         ) 
		                  VALUES (
		                          #EIN#
		                        , #RRN_SRNO#
		                        , (SELECT NVL(MAX(SRNO), 0) + 1 
		                             FROM TBCSPBII610L
		                            WHERE EIN      = #EIN#
		                              AND RRN_SRNO = #RRN_SRNO#)		        
		                        , #BLT_ORG_CD#
		                        , #WRK_RANK_CD#
		                        , #JOCP_DT#
		                        , #RSG_DT#
		                        , #FRT_USR_ID#
		                        , #FNL_USR_ID#
		                        , #FNL_DEAL_DPT_CD#
		                        , #FNL_MNU_ID#
		                        , SYSDATE
		                        , SYSDATE
				                 )
	</insert>
	
	<!-- 공무원 공공직원 특이사항 등록  -->
	<insert id="CSPBII612QinsertUnq" parameterClass="paramMap">
		INSERT INTO TBCSPBII630L (
		                          EIN             /* 암호화주민등록번호 */
		                        , RRN_SRNO        /* 주민등록번호일련번호 */
		                        , SRNO            /* 일련번호 */  
		                        , UNQ_CD          /* 특이사항코드 */
		                        , REL_PEN_EIN     /* 관련자암호화주민등록번호 */
		                        , REL_PEN_NAM     /* 관련자성명 */
		                        , REL_PEN_RLTN_NM /* 관련자관계명 */
		                        , WRDO_SC         /* 비위점수 */
		                        , UNQ_RMK         /* 특이사항비고 */
		                        , FRT_USR_ID      /* 최초사용자ID */
		                        , FNL_USR_ID      /* 최종사용자ID */
		                        , FNL_DEAL_DPT_CD /* 최종거래부서코드 */
		                        , FNL_MNU_ID      /* 최종메뉴ID */
		                        , FRT_REGI_DH     /* 최초등록일시 */
		                        , FNL_MDF_DH      /* 최종수정일시 */
		                         ) 
		                  VALUES (
		                          #EIN#
		                        , #RRN_SRNO#
		                        , (SELECT NVL(MAX(SRNO), 0) + 1 
		                             FROM TBCSPBII630L
		                            WHERE EIN      = #EIN#
		                           AND RRN_SRNO = #RRN_SRNO#)		        
		                        , #UNQ_CD#
		                        , #REL_PEN_EIN#
		                        , #REL_PEN_NAM#
		                        , #REL_PEN_RLTN_NM#
		                        , #WRDO_SC#
		                        , #UNQ_RMK#
		                        , #FRT_USR_ID#
		                        , #FNL_USR_ID#
		                        , #FNL_DEAL_DPT_CD#
		                        , #FNL_MNU_ID#
		                        , SYSDATE
		                        , SYSDATE
				                 )
	</insert>
	
	<!-- 공무원/공공직원 정보 수정 -->
	<update id="CSPBII612Qupdate" parameterClass="paramMap">
		UPDATE TBCSPBII600M                       
		   SET NAM             = #NAM#            /* 성명 */              
		     , MTRL_DVSN_CD    = #MTRL_DVSN_CD#   /* 자료구분코드 */          
		     , EPS_MNG_DVSN_CD = #EPS_MNG_DVSN_CD#/* 중점관리구분코드 */      
		     , RSG_YN          = #RSG_YN#         /* 퇴직여부 */          
		     , WRK_RANK_CD     = #WRK_RANK_CD#    /* 근무직급코드 */      
		     , BLT_ORG_CD      = #BLT_ORG_CD#     /* 소속기관코드 */  
		     , ORG_DVSN_CD     = #ORG_DVSN_CD#    /* 기관구분코드 */            
		     , DTIL_ORG_NM     = #DTIL_ORG_NM#    /* 세부기관명 */            
		     , DTIL_RANK_NM    = #DTIL_RANK_NM#   /* 세부직급명 */       
		     , JOCP_DT         = #JOCP_DT#        /* 입사일 */        
		     , RSG_DT          = #RSG_DT#         /* 퇴직일 */      
		     , FNL_USR_ID      = #FNL_USR_ID#     /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#/* 최종거래부서코드 */
		     , FNL_MNU_ID      = #FNL_MNU_ID#     /* 최종메뉴ID */
		     , FNL_MDF_DH      = SYSDATE          /* 최종수정일시 */
		 WHERE EIN      = #CHG_BF_EIN#
		   AND RRN_SRNO = #CHG_BF_RRN_SRNO#		   
	</update>
	
	<!-- 가족사항정보  수정 -->
	<update id="CSPBII612QupdateFmy" parameterClass="paramMap">
		UPDATE TBCSPBII620L                       
		   SET FMY_EIN         = #FMY_EIN#        /* 가족암호화주민등록번호 */              
		     , FMY_NAM         = #FMY_NAM#        /* 가족성명 */          
		     , FMY_RLTN_CD     = #FMY_RLTN_CD#    /* 가족관계코드 */       
		     , FNL_USR_ID      = #FNL_USR_ID#     /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#/* 최종거래부서코드 */
		     , FNL_MNU_ID      = #FNL_MNU_ID#     /* 최종메뉴ID */
		     , FNL_MDF_DH      = SYSDATE          /* 최종수정일시 */
		 WHERE EIN      = #EIN#   
		   AND RRN_SRNO = #RRN_SRNO#
		   AND SRNO     = #SRNO#
	</update>	
	
	<!-- 근무이력   수정 -->
	<update id="CSPBII612QupdateWrk" parameterClass="paramMap">
		UPDATE TBCSPBII610L                       
		   SET BLT_ORG_CD      = #BLT_ORG_CD#     /* 소속기관코드 */
		     , WRK_RANK_CD     = #WRK_RANK_CD#    /* 직급코드 */
		     , JOCP_DT         = #JOCP_DT#        /* 입사일 */
		     , RSG_DT          = #RSG_DT#         /* 퇴직일 */  
		     , FNL_USR_ID      = #FNL_USR_ID#     /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#/* 최종거래부서코드 */
		     , FNL_MNU_ID      = #FNL_MNU_ID#     /* 최종메뉴ID */
		     , FNL_MDF_DH      = SYSDATE          /* 최종수정일시 */
		 WHERE EIN      = #EIN#   
		   AND RRN_SRNO = #RRN_SRNO#
		   AND SRNO     = #SRNO#
	</update>
	
	<!--특이사항내역   수정 -->
	<update id="CSPBII612QupdateUnq" parameterClass="paramMap">
		UPDATE TBCSPBII630L                       
		   SET UNQ_CD          = #UNQ_CD#         /* 특이사항코드 */
		     , REL_PEN_EIN     = #REL_PEN_EIN#    /* 관련자암호화주민등록번호 */
		     , REL_PEN_NAM     = #REL_PEN_NAM#    /* 관련자성명 */
		     , REL_PEN_RLTN_NM = #REL_PEN_RLTN_NM#/* 관련자관계명 */
		     , WRDO_SC         = #WRDO_SC#        /* 비위점수 */
		     , UNQ_RMK         = #UNQ_RMK#        /* 특이사항비고 */
		     , FNL_USR_ID      = #FNL_USR_ID#     /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#/* 최종거래부서코드 */
		     , FNL_MNU_ID      = #FNL_MNU_ID#     /* 최종메뉴ID */
		     , FNL_MDF_DH      = SYSDATE          /* 최종수정일시 */
		 WHERE EIN      = #EIN#   
		   AND RRN_SRNO = #RRN_SRNO#
		   AND SRNO     = #SRNO#
	</update>	
	
	<!-- 공무원/공공직원 정보 삭제 -->
	<delete id="CSPBII612Qdelete" parameterClass="paramMap">
		DELETE TBCSPBII600M
		 WHERE EIN      = #CHG_BF_EIN#	
		   AND RRN_SRNO = #RRN_SRNO# 	   
	</delete>	
	
	<!-- 가족사항정보 삭제 -->
	<delete id="CSPBII612QdeleteFmy" parameterClass="paramMap">
		DELETE TBCSPBII620L
		 WHERE EIN      = #EIN#   
		   AND RRN_SRNO = #RRN_SRNO#
		   AND SRNO     = #SRNO#
	</delete>	
	
	<!-- 근무이력 정보 삭제 -->
	<delete id="CSPBII612QdeleteWrk" parameterClass="paramMap">
		DELETE TBCSPBII610L
		 WHERE EIN      = #EIN#   
		   AND RRN_SRNO = #RRN_SRNO#
		   AND SRNO     = #SRNO#
	</delete>
	
	<!-- 특이사항 내역 삭제 -->
	<delete id="CSPBII612QdeleteUnq" parameterClass="paramMap">
		DELETE TBCSPBII630L
		 WHERE EIN      = #EIN#   
		   AND RRN_SRNO = #RRN_SRNO#
		   AND SRNO     = #SRNO#
	</delete>
	
	<!-- 공무원/공공직원 키 수정 -->
	<update id="CSPBII612QupdateMainKey" parameterClass="paramMap">
		UPDATE TBCSPBII600M                       
		   SET EIN      = #EIN#      /* 암호화주민등록번호 */
		    ,  RRN_SRNO = #RRN_SRNO# /* 변경후주민등록번호일련번호 */
		 WHERE EIN      = #CHG_BF_EIN#
		   AND RRN_SRNO = #CHG_BF_RRN_SRNO#
	</update>
	
	<!-- 가족사항정보 키 수정 -->
	<update id="CSPBII612QupdateFmyKey" parameterClass="paramMap">
		UPDATE TBCSPBII620L                       
		   SET EIN      = #EIN#      /* 암호화주민등록번호 */
		    ,  RRN_SRNO = #RRN_SRNO# /* 변경후주민등록번호일련번호 */
		 WHERE EIN      = #CHG_BF_EIN#
		   AND RRN_SRNO = #CHG_BF_RRN_SRNO#
	</update>	
	
	<!-- 근무이력 키 수정 -->
	<update id="CSPBII612QupdateWrkKey" parameterClass="paramMap">
		UPDATE TBCSPBII610L                       
		   SET EIN      = #EIN#      /* 암호화주민등록번호 */
		    ,  RRN_SRNO = #RRN_SRNO# /* 변경후주민등록번호일련번호 */
		 WHERE EIN      = #CHG_BF_EIN#
		   AND RRN_SRNO = #CHG_BF_RRN_SRNO#
	</update>
	
	<!--특이사항내역 키 수정 -->
	<update id="CSPBII612QupdateUnqKey" parameterClass="paramMap">
		UPDATE TBCSPBII630L                       
		   SET EIN      = #EIN#      /* 암호화주민등록번호 */
		    ,  RRN_SRNO = #RRN_SRNO# /* 변경후주민등록번호일련번호 */
		 WHERE EIN      = #CHG_BF_EIN#
		   AND RRN_SRNO = #CHG_BF_RRN_SRNO#
	</update>	
	
	<!-- 공무원/공공직원 정보 밸리데이션 체크 -->
	<select id="CSPBII612QSubVldBscInf" parameterClass="paramMap" resultClass="integer">
		SELECT COUNT(*)    
		  FROM TBCSPBII600M                   		   
		 WHERE EIN = #EIN#
	</select>		
</sqlMap> 
