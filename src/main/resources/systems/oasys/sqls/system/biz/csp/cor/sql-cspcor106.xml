<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/cor/106">
 	
 	<select id="CSPCOR106EHndlSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	T1.CORR_DVSN_CD
					,T1.ACP_YR
					,T1.CORR_ACP_NO
					,T1.TNB
					,T1.HNDL_STA_CD
					,T2.HNDL_RSLT_CD
					,F_CODE_NM('1000890',T2.HNDL_RSLT_CD) AS HNDL_RSLT_NM
					,T2.HNDL_APV_DOC_NO
					,T2.INSPC_DPT_CD
					,F_DPT_INFO(T2.INSPC_DPT_CD,'1') AS INSPC_DPT_NM
					,T2.INSPC_CHGR_ID
					,F_USR_INFO_BY_ID(T2.INSPC_CHGR_ID,'2') AS INSPC_CHGR_NM
					,T2.HNDL_DOC_ID
					,T2.HNDL_APV_DOC_NO
					,DECODE(T1.RM_CORR_ACP_NO,NULL,NULL,T1.ACP_YR||'-부감-'||T1.RM_CORR_ACP_NO) AS ACP_NO
					,T2.HNDL_APV_STA_CD
					,T2.INSPC_RSLT_CD
					,F_CODE_NM('1000892',T2.INSPC_RSLT_CD) AS INSPC_RSLT_NM
					,T2.INSPC_DOC_ID
					,T2.INSPC_APV_DOC_NO
					,T2.INSPC_APV_STA_CD
					,F_CODE_NM('1000891',T2.INSPC_APV_STA_CD) AS INSPC_APV_STA_NM
			FROM	TBCSPCOR101M T1
			       ,TBCSPCOR104M T2
			WHERE	T1.CORR_DVSN_CD = '1'
			  AND   T1.CORR_DVSN_CD = T2.CORR_DVSN_CD(+)
			  AND   T1.ACP_YR = T2.ACP_YR(+)
			  AND   T1.CORR_ACp_NO = T2.CORR_ACP_NO(+)
		]]>
		<dynamic>
			<isEmpty property="strHNDL_APV_DOC_NO">
				<![CDATA[
					  AND   T1.CORR_DVSN_CD = #strCORR_DVSN_CD#
					  AND   T1.ACP_YR = #strACP_YR#
					  AND   T1.CORR_ACP_NO = #strCORR_ACP_NO#
				]]>
			</isEmpty>
			<isNotEmpty property="strHNDL_APV_DOC_NO">
				<![CDATA[
					  AND   T2.HNDL_APV_DOC_NO = #strHNDL_APV_DOC_NO#
				]]>
			</isNotEmpty>
		</dynamic>
	</select>
	
	<update id="CSPCOR106E104HndlUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR104M
			   SET HNDL_RSLT_CD = #HNDL_RSLT_CD#
			      ,HNDL_APV_DOC_NO = #HNDL_APV_DOC_NO#
			      ,INSPC_DPT_CD = #INSPC_DPT_CD#
			      ,HNDL_DOC_ID = #HNDL_DOC_ID#
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
		]]>
	</update>
	
	<update id="CSPCOR106E104HndlSucUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR104M
			   SET HNDL_RSLT_CD = #HNDL_RSLT_CD#
			      ,INSPC_DPT_CD = #INSPC_DPT_CD#
			 WHERE (CORR_DVSN_CD, ACP_YR, CORR_ACP_NO) IN ( SELECT S1.SUC_CORR_DVSN_CD, SUC_ACP_YR, SUC_CORR_ACP_NO
			                                                  FROM TBCSPCOR107L S1
			                                                 WHERE S1.CORR_DVSN_CD = #CORR_DVSN_CD#
			                                                   AND S1.ACP_YR = #ACP_YR#
			                                                   AND S1.CORR_ACP_NO = #CORR_ACP_NO#
			                                              )
		]]>
	</update>
	
	<select id="CSPCOR106EHndlApvSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT MAX(CASE WHEN ROW_ID = 1 THEN PST_NM ELSE NULL END) AS PST_NM1
				  ,MAX(CASE WHEN ROW_ID = 2 THEN PST_NM ELSE NULL END) AS PST_NM2
       			  ,MAX(CASE WHEN ROW_ID = 3 THEN PST_NM ELSE NULL END) AS PST_NM3
       			  ,MAX(CASE WHEN ROW_ID = 4 THEN PST_NM ELSE NULL END) AS PST_NM4
       			  ,MAX(CASE WHEN ROW_ID = 5 THEN PST_NM ELSE NULL END) AS PST_NM5
       			  ,MAX(CASE WHEN ROW_ID = 6 THEN PST_NM ELSE NULL END) AS PST_NM6
       			  ,MAX(CASE WHEN ROW_ID = 7 THEN PST_NM ELSE NULL END) AS PST_NM7
       			  ,MAX(CASE WHEN ROW_ID = 1 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM1
                  ,MAX(CASE WHEN ROW_ID = 2 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM2
                  ,MAX(CASE WHEN ROW_ID = 3 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM3
                  ,MAX(CASE WHEN ROW_ID = 4 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM4
                  ,MAX(CASE WHEN ROW_ID = 5 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM5
                  ,MAX(CASE WHEN ROW_ID = 6 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM6
                  ,MAX(CASE WHEN ROW_ID = 7 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM7
			  FROM ( SELECT APV_DOC_NO
			               ,APV_SNO
			               ,APVR_NM
			               ,APV_DH
			               ,PST_NM
			               ,ROW_NUMBER() OVER (ORDER BY APV_SNO) AS ROW_ID
			           FROM ( SELECT APV_DOC_NO
			                        ,APV_SNO
			                        ,CASE WHEN APVR_PST_CD IS NULL THEN ONR_PST_NM
			                           ELSE F_CODE_NM('1000176', APVR_PST_CD)
			                         END AS PST_NM
			                        ,F_USR_INFO(APVR_CNB, '2') AS APVR_NM
			                        ,CASE WHEN SUBSTR(APVR_STA_CD, 0, 1) = '2' THEN TO_CHAR(APV_DH, 'YYYY-MM-DD')
			                           ELSE NULL
			                         END AS APV_DH
			                    FROM TBDCMACM023L
			                   WHERE APV_SNO <> '1'
			                     AND APVR_KND_CD NOT IN ('4','6','7')
			                     AND APV_DOC_NO = ( SELECT HNDL_APV_DOC_NO
			                                          FROM TBCSPCOR104M S1 
			                                         WHERE S1.CORR_DVSN_CD = #strCORR_DVSN_CD#
			                                           AND S1.ACP_YR = #strACP_YR#
			                                           AND S1.CORR_ACP_NO = #strCORR_ACP_NO#
			                                      )
			                )
			  	   )
       			  
		]]>
	</select>
	
	
	<resultMap class="java.util.HashMap" id="opmMap">
 		<result property="CORR_DVSN_CD"            column="CORR_DVSN_CD"              jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_YR"                  column="ACP_YR"                    jdbcType="VARCHAR2"  javaType="java.lang.String" /> 
		<result property="CORR_ACP_NO"             column="CORR_ACP_NO"               jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ACP_NO"                  column="ACP_NO"                    jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="RM_CORR_ACP_NO"          column="RM_CORR_ACP_NO"            jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="TNB"                     column="TNB"                       jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HNDL_STA_CD"             column="HNDL_STA_CD"               jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ONR_DOC_MNG_CRD_ID"      column="ONR_DOC_MNG_CRD_ID"        jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ADMN_INF_HNDL_NO"        column="ADMN_INF_HNDL_NO"          jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ONR_APV_STA_CD"          column="ONR_APV_STA_CD"            jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ONR_TIT"                 column="ONR_TIT"                   jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="AD"                      column="AD"                        jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="NAM"                     column="NAM"                       jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HNDL_APV_STA_CD"         column="HNDL_APV_STA_CD"           jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="HNDL_RSLT_CD"            column="HNDL_RSLT_CD"              jdbcType="VARCHAR2"  javaType="java.lang.String" />
		<result property="ANS_TXT"                 column="ANS_TXT"                   jdbcType="CLOB"      javaType="java.lang.String" />
 	</resultMap>
 	
 	
	<select id="CSPCOR106EOpmSelect" parameterClass="paramMap" resultMap="opmMap">
		<![CDATA[
			SELECT	T1.CORR_DVSN_CD
					,T1.ACP_YR
					,T1.CORR_ACP_NO
					,DECODE(T1.RM_CORR_ACP_NO,NULL,NULL,T1.ACP_YR||'-부감-'||T1.RM_CORR_ACP_NO) AS ACP_NO
					,T1.RM_CORR_ACP_NO
					,T1.TNB
					,T1.HNDL_STA_CD
					,T2.ONR_DOC_MNG_CRD_ID
					,T2.ADMN_INF_HNDL_NO
					,T2.ONR_APV_STA_CD
					,'부패행위 신고 처리결과 통보 ( 제 '||T1.ACP_YR||'-부감-'||T1.RM_CORR_ACP_NO||' 호)' AS ONR_TIT
					,T1.AD||' '||T1.DTL_AD AD
					,T1.NAM
					,T2.HNDL_APV_STA_CD
					,T2.HNDL_RSLT_CD
					,T1.ANS_TXT
			FROM	TBCSPCOR101M T1
			       ,TBCSPCOR104M T2
			WHERE	T1.CORR_DVSN_CD = '1'
			  AND   T1.CORR_DVSN_CD = T2.CORR_DVSN_CD(+)
			  AND   T1.ACP_YR = T2.ACP_YR(+)
			  AND   T1.CORR_ACp_NO = T2.CORR_ACP_NO(+)
			  AND   T1.CORR_DVSN_CD = #strCORR_DVSN_CD#
			  AND   T1.ACP_YR = #strACP_YR#
			  AND   T1.CORR_ACP_NO = #strCORR_ACP_NO#
		]]>
					  
	</select>
	
	<update id="CSPCOR106E101OpmUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR101M
			   SET ANS_TXT = #ANS_TXT#
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
		]]>
	</update>
	
	<update id="CSPCOR106E101OpmSucUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR101M
			   SET ANS_TXT = #ANS_TXT#
			 WHERE (CORR_DVSN_CD, ACP_YR, CORR_ACP_NO) IN ( SELECT S1.SUC_CORR_DVSN_CD, S1.SUC_ACP_YR, S1.SUC_CORR_ACP_NO
			                                                  FROM TBCSPCOR107L S1
			                                                 WHERE S1.CORR_DVSN_CD = #CORR_DVSN_CD#
			                                                   AND S1.ACP_YR = #ACP_YR#
			                                                   AND S1.CORR_ACP_NO = #CORR_ACP_NO#
			                                              )
		]]>
	</update>
	
	<select id="CSPCOR106EOpmApvSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT MAX(CASE WHEN ROW_ID = 1 THEN PST_NM ELSE NULL END) AS PST_NM1
				  ,MAX(CASE WHEN ROW_ID = 2 THEN PST_NM ELSE NULL END) AS PST_NM2
       			  ,MAX(CASE WHEN ROW_ID = 3 THEN PST_NM ELSE NULL END) AS PST_NM3
       			  ,MAX(CASE WHEN ROW_ID = 4 THEN PST_NM ELSE NULL END) AS PST_NM4
       			  ,MAX(CASE WHEN ROW_ID = 5 THEN PST_NM ELSE NULL END) AS PST_NM5
       			  ,MAX(CASE WHEN ROW_ID = 6 THEN PST_NM ELSE NULL END) AS PST_NM6
       			  ,MAX(CASE WHEN ROW_ID = 7 THEN PST_NM ELSE NULL END) AS PST_NM7
       			  ,MAX(CASE WHEN ROW_ID = 1 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM1
                  ,MAX(CASE WHEN ROW_ID = 2 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM2
                  ,MAX(CASE WHEN ROW_ID = 3 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM3
                  ,MAX(CASE WHEN ROW_ID = 4 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM4
                  ,MAX(CASE WHEN ROW_ID = 5 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM5
                  ,MAX(CASE WHEN ROW_ID = 6 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM6
                  ,MAX(CASE WHEN ROW_ID = 7 THEN CASE WHEN APV_DH IS NULL THEN APVR_NM ELSE APVR_NM||CHR(10)||'('||APV_DH||')' END  
                    ELSE NULL END) AS APVR_NM7
			  FROM ( SELECT DH1.APV_RQS_ID
			               ,DH1.APV_SRNO
			               ,(SELECT H2.PST_NM AS PST_NM
			                   FROM TBDCMACM111H H1
			                       ,TBDCMACM112H H2
			                  WHERE H1.RCPT_DT = H2.RCPT_DT
			                    AND H1.RCPT_ID = H2.RCPT_ID
			                    AND H1.ONR_DOC_MNG_CRD_ID = DH1.APV_RQS_ID
			                    AND H2.APVR_ID = DH1.APVR_ID
			                  GROUP BY H2.PST_NM
			                ) AS PST_NM
			               ,DH1.APVR_NM
			               ,DH1.APV_DH
			               ,ROW_NUMBER() OVER (ORDER BY APV_SRNO) AS ROW_ID
			               
			          FROM ( SELECT ONR_DOC_MNG_CRD_ID AS APV_RQS_ID
			                       ,APV_HIS_SRNO AS APV_SRNO
			                       ,APVR_ID
			                       ,TO_CHAR(APV_DH, 'YYYY-MM-DD') AS APV_DH
			                       ,APVR_NM AS APVR_NM
			                  FROM TBDCMACM102L D2
			                 WHERE ONR_APV_DVSN_CD <> '10'
			                   AND ONR_DOC_MNG_CRD_ID = ( SELECT ONR_DOC_MNG_CRD_ID
			                                                FROM TBCSPCOR104M S1 
			                                               WHERE S1.CORR_DVSN_CD = #strCORR_DVSN_CD#
			                                                 AND S1.ACP_YR = #strACP_YR#
			                                                 AND S1.CORR_ACP_NO = #strCORR_ACP_NO#
			                                            )
			          	   ) DH1
			  	   )
       			  
		]]>
	</select>
	
	<select id="CSPCOR106EOnrInfoSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.USR_ID
			      ,NVL(F_DPT_INFO(T1.DPT_CD,'6'),T1.DPT_CD) AS DEPT_CD
			  FROM TBDCMACM001M T1
			 WHERE T1.USR_ID = #FNL_USR_ID#
		]]>
	</select>
	
	<select id="getOnrAdministrativeNumSeq" parameterClass="paramMap" resultClass="String">
        SELECT TO_CHAR(ONR_ADMINISTRATIVENUM_SEQ.NEXTVAL) AS ONR_ADMINISTRATIVENUM_SEQ
          FROM DUAL
    </select>
	
	<update id="CSPCOR106EOpmApvUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR104M
			   SET ONR_DOC_MNG_CRD_ID = #ONR_DOC_MNG_CRD_ID#
			      ,ADMN_INF_HNDL_NO = #ADMN_INF_HNDL_NO#
			      ,ONR_APV_STA_CD = '101'
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
		]]>
	</update>
	
	<update id="CSPCOR106E101ResultUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR101M
			   SET HNDL_STA_CD = '90'
			      ,HNDL_DH = SYSDATE
			      ,FNL_USR_ID = #FNL_USR_ID#
			      ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			      ,FNL_MNU_ID = #FNL_MNU_ID#
			      ,FNL_MDF_DH = SYSDATE
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
		]]>
	</update>
	
	<update id="CSPCOR106E101ResultSucUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR101M
			   SET HNDL_STA_CD = '90'
			      ,HNDL_DH = SYSDATE
			      ,FNL_USR_ID = #FNL_USR_ID#
			      ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			      ,FNL_MNU_ID = #FNL_MNU_ID#
			      ,FNL_MDF_DH = SYSDATE
			WHERE (CORR_DVSN_CD, ACP_YR, CORR_ACP_NO) IN ( SELECT S1.SUC_CORR_DVSN_CD, S1.SUC_ACP_YR, S1.SUC_CORR_ACP_NO
			                                                  FROM TBCSPCOR107L S1
			                                                 WHERE S1.CORR_DVSN_CD = #CORR_DVSN_CD#
			                                                   AND S1.ACP_YR = #ACP_YR#
			                                                   AND S1.CORR_ACP_NO = #CORR_ACP_NO#
			                                              )
		]]>
	</update>
	
	<update id="CSPCOR106E101InspcUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR101M
			   SET HNDL_STA_CD = '40'
			      ,FNL_USR_ID = #FNL_USR_ID#
			      ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			      ,FNL_MNU_ID = #FNL_MNU_ID#
			      ,FNL_MDF_DH = SYSDATE
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
		]]>
	</update>
	
	<update id="CSPCOR106E101InspcSucUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR101M
			   SET HNDL_STA_CD = '40'
			      ,FNL_USR_ID = #FNL_USR_ID#
			      ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			      ,FNL_MNU_ID = #FNL_MNU_ID#
			      ,FNL_MDF_DH = SYSDATE
			 WHERE (CORR_DVSN_CD, ACP_YR, CORR_ACP_NO) IN ( SELECT S1.SUC_CORR_DVSN_CD, S1.SUC_ACP_YR, S1.SUC_CORR_ACP_NO
			                                                  FROM TBCSPCOR107L S1
			                                                 WHERE S1.CORR_DVSN_CD = #CORR_DVSN_CD#
			                                                   AND S1.ACP_YR = #ACP_YR#
			                                                   AND S1.CORR_ACP_NO = #CORR_ACP_NO#
			                                              )
		]]>
	</update>
	
	<select id="CSPCOR106EExtnSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.CORR_DVSN_CD
			       ,T1.ACP_YR
			       ,T1.CORR_ACP_NO
			       ,T1.SRNO
			       ,T1.ONR_TIT_NM
			       ,T1.BK_HNDL_DDLN_DT
			       ,T1.EXTN_HNDL_DDLN_DT
			       ,T1.ONR_DOC_MNG_CRD_ID
			       ,T1.ADMN_INF_HNDL_NO
			       ,T1.ONR_APV_STA_CD
			       ,T2.AD||' '||T2.DTL_AD AD
				   ,T2.NAM
				   ,T2.TNB
			       ,CASE WHEN T1.ONR_APV_STA_CD IS NULL THEN '상신전'
			       		 WHEN T1.ONR_APV_STA_CD = '101' THEN '작성중'
			             WHEN T1.ONR_APV_STA_CD = '102' THEN '결재중'
			             WHEN T1.ONR_APV_STA_CD = '103' THEN '결재완료'
			             ELSE '기타' END AS ONR_APV_STA_NM
			       ,TO_CHAR(T1.FNL_APV_DH,'YYYY-MM-DD') AS FNL_APV_DH
			  FROM TBCSPCOR108M T1
			      ,TBCSPCOR101M T2
			 WHERE 1=1 
			   AND T1.CORR_DVSN_CD = #strCORR_DVSN_CD#
			   AND T1.ACP_YR = #strACP_YR#
			   AND T1.CORR_ACP_NO = #strCORR_ACP_NO#
			   AND T1.CORR_DVSN_CD = T2.CORR_DVSN_CD
			   AND T1.ACP_YR = T2.ACP_YR
			   AND T1.CORR_ACP_NO = T2.CORR_ACP_NO
			   ORDER BY T1.SRNO DESC
		]]>
	</select>
	
	<update id="CSPCOR106EExtnApvUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR108M
			   SET ONR_DOC_MNG_CRD_ID = #ONR_DOC_MNG_CRD_ID#
			      ,ADMN_INF_HNDL_NO = #ADMN_INF_HNDL_NO#
			      ,ONR_APV_STA_CD = '101'
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
			   AND SRNO = #SRNO#
		]]>
	</update>
	
	<insert id="CSPCOR106E108MInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPCOR108M
				( CORR_DVSN_CD
				 ,ACP_YR
				 ,CORR_ACP_NO
				 ,SRNO
				 ,ONR_TIT_NM
				 ,BK_HNDL_DDLN_DT
				 ,EXTN_HNDL_DDLN_DT
				 ,ONR_DOC_MNG_CRD_ID
				 ,ADMN_INF_HNDL_NO
				 ,ONR_APV_STA_CD
				 ,FRT_USR_ID
				 ,FNL_USR_ID
				 ,FNL_DEAL_DPT_CD
				 ,FNL_MNU_ID
				 ,FRT_REGI_DH
				 ,FNL_MDF_DH
				)
				VALUES ( #CORR_DVSN_CD#
				        ,#ACP_YR#
				        ,#CORR_ACP_NO#
				        ,(SELECT NVL(MAX(S1.SRNO),0)+1
				            FROM TBCSPCOR108M S1
				           WHERE S1.CORR_DVSN_CD = #CORR_DVSN_CD#
				             AND S1.ACP_YR = #ACP_YR#
				             AND S1.CORR_ACP_NO = #CORR_ACP_NO#
				         )
				        ,#ONR_TIT_NM#
				        ,#BK_HNDL_DDLN_DT#
				        ,#EXTN_HNDL_DDLN_DT#
				        ,#ONR_DOC_MNG_CRD_ID#
				        ,#ADMN_INF_HNDL_NO#
				        ,NULL
				        ,#FNL_USR_ID#
				        ,#FNL_USR_ID#
				        ,#FNL_DEAL_DPT_CD#
				        ,#FNL_MNU_ID#
				        ,SYSDATE
				        ,SYSDATE
				       )
				
		]]>
	</insert>
	
	<update id="CSPCOR106E108MUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR108M
			   SET ONR_TIT_NM = #ONR_TIT_NM#
			      ,EXTN_HNDL_DDLN_DT = #EXTN_HNDL_DDLN_DT#
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
			   AND SRNO = #SRNO#
		]]>
	</update>
	
	<select id="CSPCOR106ESucSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.CORR_DVSN_CD
			      ,T1.ACP_YR
			      ,T1.CORR_ACP_NO
			      ,T1.ACP_YR||'-부감-'||T1.RM_CORR_ACP_NO AS ACP_NO
			      ,T1.TNB
			  FROM TBCSPCOR101M T1
			      ,TBCSPCOR107L T2
			 WHERE T1.CORR_DVSN_CD = T2.SUC_CORR_DVSN_CD
			   AND T1.ACP_YR = T2.SUC_ACP_YR
			   AND T1.CORR_ACP_NO = T2.SUC_CORR_ACP_NO
			   AND T2.CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND T2.ACP_YR = #ACP_YR#
			   AND T2.CORR_ACP_NO = #CORR_ACP_NO#
		]]>
	</select>
	
	<delete id="CSPCOR101P108MDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE 
			  FROM TBCSPCOR108M
			 WHERE CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND ACP_YR = #ACP_YR#
			   AND CORR_ACP_NO = #CORR_ACP_NO#
			   AND SRNO = #SRNO#
		]]>
		
	</delete>
	
	<select id="CSPCOR106EOrgSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.CORR_DVSN_CD
			      ,T1.ACP_YR
			      ,T1.CORR_ACP_NO
			      ,T1.SRNO
			      ,T1.ORG_CD
			      ,T2.ORG_NM
			      ,F_CODE_NM('1000128',T2.PUB_DVSN_CD) AS PUB_DVSN_NM
			      ,F_ORG_INFO(RPAD(T2.COPT_SG_2_CD,12,'0'),'1') AS COPT_SG_NM 
			  FROM TBCSPCOR105L T1
			      ,TBDCMACM015M T2
			 WHERE T1.ORG_CD = T2.ORG_CD
			   AND T1.CORR_DVSN_CD = #strCORR_DVSN_CD#
			   AND T1.ACP_YR = #strACP_YR#
			   AND T1.CORR_ACP_NO = #strCORR_ACP_NO#
		]]>
	</select>
	
	<insert id="CSPCOR106P105LInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPCOR105L
				( CORR_DVSN_CD
				 ,ACP_YR
				 ,CORR_ACP_NO
				 ,SRNO
				 ,ORG_CD
				 ,FRT_USR_ID
				 ,FNL_USR_ID
				 ,FNL_DEAL_DPT_CD
				 ,FNL_MNU_ID
				 ,FRT_REGI_DH
				 ,FNL_MDF_DH
				)
				VALUES ( #CORR_DVSN_CD#
					    ,#ACP_YR#
					    ,#CORR_ACP_NO#
					    ,( SELECT NVL(MAX(SRNO),0)+1
					         FROM TBCSPCOR105L S1
					        WHERE S1.CORR_DVSN_CD = #CORR_DVSN_CD#
					          AND S1.ACP_YR = #ACP_YR#
					          AND S1.CORR_ACP_NO = #CORR_ACP_NO#
					     )
					    ,#ORG_CD#
					    ,#FNL_USR_ID#
					    ,#FNL_USR_ID#
					    ,#FNL_DEAL_DPT_CD#
					    ,#FNL_MNU_ID#
					    ,SYSDATE
					    ,SYSDATE
					   )
		]]>
	</insert>
	
	<delete id="CSPCOR106P105LSucDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE
			  FROM TBCSPCOR105L
			 WHERE (CORR_DVSN_CD, ACP_YR, CORR_ACP_NO) IN ( SELECT S1.SUC_CORR_DVSN_CD, S1.SUC_ACP_YR, S1.SUC_CORR_ACP_NO
			                                                  FROM TBCSPCOR107L S1
			                                                 WHERE S1.CORR_DVSN_CD = #CORR_DVSN_CD#
			                                                   AND S1.ACP_YR = #ACP_YR#
			                                                   AND S1.CORR_ACP_NO = #CORR_ACP_NO#
			                                              )
		]]>
	</delete>
	
	<insert id="CSPCOR106P105LSucInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPCOR105L
				( CORR_DVSN_CD
				 ,ACP_YR
				 ,CORR_ACP_NO
				 ,SRNO
				 ,ORG_CD
				 ,FRT_USR_ID
				 ,FNL_USR_ID
				 ,FNL_DEAL_DPT_CD
				 ,FNL_MNU_ID
				 ,FRT_REGI_DH
				 ,FNL_MDF_DH
				)
			SELECT S2.SUC_CORR_DVSN_CD
			      ,S2.SUC_ACP_YR
			      ,S2.SUC_CORR_ACP_NO
			      ,S1.SRNO
			      ,S1.ORG_CD
			      ,#FNL_USR_ID#
			      ,#FNL_USR_ID#
			      ,#FNL_DEAL_DPT_CD#
			      ,#FNL_MNU_ID#
			      ,SYSDATE
			      ,SYSDATE
			  FROM TBCSPCOR105L S1
			      ,TBCSPCOR107L S2
			 WHERE S1.CORR_DVSN_CD = S2.CORR_DVSN_CD
			   AND S1.ACP_YR = S2.ACP_YR
			   AND S1.CORR_ACP_NO = S2.CORR_ACP_NO
			   AND S1.CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND S1.ACP_YR = #ACP_YR#
			   AND S1.CORR_ACP_NO = #CORR_ACP_NO#
				
		]]>
	</insert>
	
	<update id="CSPCOR106P105LUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPCOR105L T1
			   SET ORG_CD = #ORG_CD#
			 WHERE T1.CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND T1.ACP_YR = #ACP_YR#
			   AND T1.CORR_ACP_NO = #CORR_ACP_NO#
			   AND T1.SRNO = #SRNO#
		]]>
	</update>
	
	<delete id="CSPCOR106P105LDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE
			  FROM TBCSPCOR105L T1
			 WHERE T1.CORR_DVSN_CD = #CORR_DVSN_CD#
			   AND T1.ACP_YR = #ACP_YR#
			   AND T1.CORR_ACP_NO = #CORR_ACP_NO#
			   AND T1.SRNO = #SRNO#
		]]>
	</delete>
</sqlMap> 
