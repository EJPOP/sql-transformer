<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/fpl/007">

	<!-- 질의서목록 조회 -->
	<select id="CSPFPL007ListSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT D1.CHGR_CNB         AS CHGR_CNB			/*담당자전산번호*/
			     , D1.CHGR_NM   AS CHGR_NM	/*담당자명*/
			     , D1.CHR_DPT_NM   AS CHR_DPT_NM	/*담당부서명*/
			     , D1.CHGR_ID    AS CHGR_ID        /*담당자ID*/
			     , D1.CHR_DPT_CD    AS CHR_DPT_CD        /*담당부서코드*/
			     , D1.CHGR_NO    AS CHGR_NO        /*담당자ID*/
			  FROM TBCSPFPL004M D1
			  where 1=1 
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strChgrNm">
				D1.CHGR_NM 
				LIKE '%'||#strChgrNm# ||'%' 
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strDeptNm">
				D1.CHR_DPT_NM
				LIKE '%'||#strDeptNm# ||'%' 
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="StrChgrCnb">
				D1.CHGR_CNB LIKE '%'||#StrChgrCnb# ||'%'
			</isNotEmpty>
		</dynamic>
		<![CDATA[       
			ORDER BY D1.CHGR_NM ASC
		]]>
	</select>

	<delete id="CSPFPL007ListDelete" parameterClass="paramMap">
		DELETE
		FROM TBCSPFPL004M
		WHERE 1=1
		AND CHGR_NM=#CHGR_NM#
		AND
		CHR_DPT_NM=#CHR_DPT_NM#
	</delete>

	<!-- 질의서 신규등록 -->
	<insert id="CSPFPL007maininsert" parameterClass="paramMap">
		INSERT INTO
		TBCSPFPL004M
		(
		CHGR_CNB
		, CHGR_NM
		, CHR_DPT_NM
		, CHGR_ID
		, CHR_DPT_CD
		, CHGR_NO
		, FNL_USR_ID
		, FNL_DEAL_DPT_CD
		, FNL_MNU_ID
		, FNL_MDF_DH
		, FRT_REGI_DH
		, FRT_USR_ID
		)
		VALUES
		(
		#CHGR_CNB#
		, #CHGR_NM#
		, #CHR_DPT_NM#
		, #CHGR_ID#
		, #CHR_DPT_CD#
		, #CHGR_NO#
		, #FNL_USR_ID#
		, #FNL_DEAL_DPT_CD#
		, #FNL_MNU_ID#
		, SYSDATE
		, SYSDATE
		, #FRT_USR_ID#
		)
	</insert>
 
	<!-- 질의서정보 수정 -->
 	<update id="CSPFPL007mainupdate" parameterClass="paramMap">
		UPDATE TBCSPFPL004M
		SET CHGR_CNB = #CHGR_CNB#
		<isNotEmpty prepend="," property="CHGR_NM">
			CHGR_NM = #CHGR_NM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CHR_DPT_NM">
			CHR_DPT_NM = #CHR_DPT_NM#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CHGR_ID">
			CHGR_ID = #CHGR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="CHR_DPT_CD">
			CHR_DPT_CD = #CHR_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MDF_DH">
			FNL_MDF_DH = SYSDATE
		</isNotEmpty>
		WHERE 1 = 1
		AND CHGR_NO=#CHGR_NO#
	</update> 
	
		<!-- 질의서번호 Max값 찾기 -->
	<select id="CSPFPL007MainMaxSnoSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT LPAD(NVL(MAX(TO_NUMBER(CHGR_NO)),0)+1,3,0) AS MAX_SEQ
				  FROM TBCSPFPL004M
				 WHERE 1=1
		]]>
	</select>
</sqlMap> 