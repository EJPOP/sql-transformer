<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/sae/301">
	<select id="CSPSAE301EgetTnb" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT TNB FROM TBDCMACM001M WHERE CNB = #strCnb#
       	]]>
	</select>
	
	<select id="CSPSAE301EgetTnbs" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT TNB
			     , HOM_TNB
			  FROM TBDCMACM001M WHERE CNB = #strCnb#
       	]]>
	</select>

	<select id="CSPSAE301EMainList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.YR /* CSPSAE301EMainList */
				 , A.CRS_CD
				 , A.CRS_NM
				 , A.CRS_CDN
				 , A.SNO
				 , A.TANE_ID
				 , A.NAM
				 , A.ORG_CD
				 , A.ORG_NM
				 , A.RANK_NM
				 , A.EDU_EXS
				 , A.DMT_EXS
				 , A.FDEX
				 , (A.EDU_EXS + A.DMT_EXS + A.FDEX) AS TOT_AMT
				 , A.PD_AMT
				 , (A.PD_AMT - (A.EDU_EXS + A.DMT_EXS + A.FDEX)) AS UNP_AMT
				 , A.PD_MEAN_CD
			     , A.PD_YN
			     , A.EDU_DVSN_NM
			     , A.EDU_CAT_NM
				 , A.DMT_UE_YN
				 , A.BUS_UE_YN
				 , A.SEX_CD
			     , A.PD_DT
			     , A.HPN
			     , A.PD_SMS_SEN_DT
			     , A.UNP_SMS_SEN_DT
			     , A.EDU_DT
			     , A.EAN
			FROM (
				SELECT A.YR
					 , B.EDU_DVSN_CD
	 		     	 , C.EDU_CAT_CD
				     , A.CRS_CD
				     , D.CRS_NM
				     , A.CRS_CDN
				     , A.SNO
				     , A.TANE_ID
				     , A.NAM
				     , A.ORG_CD
				     , E.ORG_NM
				     , A.RANK_NM
				      , DECODE(NVL(A.EDU_EXS, 0), 0, NVL( (SELECT Z.EDU_EXS 
				                                       FROM TBCSPSAE113B Z
				                                      WHERE Z.CRS_CD = A.CRS_CD
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = Z.CRS_CD
	 			                                                       AND X.APC_DT < F.EDU_STR_DT)
	 			                                     )* F.EDU_DAY,
	 			                                      (SELECT Y.EDU_EXS 
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
																		  FROM TBCSPSAE113B
																		  WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														  								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )* F.EDU_DAY
	 			       ), A.EDU_EXS) AS EDU_EXS
				     , DECODE(NVL(A.DMT_EXS, 0), 0, NVL( (SELECT Z.DMT_EXS 
				                                       FROM TBCSPSAE113B Z
				                                      WHERE Z.CRS_CD = A.CRS_CD
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = Z.CRS_CD
	 			                                                       AND X.APC_DT < F.EDU_STR_DT)
	 			                                     )* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0)),
	 			                                    (SELECT Y.DMT_EXS 
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
																		  FROM TBCSPSAE113B
																		  WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														  								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0))
	 			       ), A.DMT_EXS) AS DMT_EXS
					  , DECODE(NVL(A.FDEX, 0), 0, NVL( (SELECT DECODE(A.DMT_UE_YN, 'Y', Z.BRKF_FDEX*(F.EDU_DAY-1) + Z.LUNCH_FDEX*(F.EDU_DAY) +Z.DINR_FDEX*(F.EDU_DAY-1)
				                                                                    , Z.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정_천은정감사관 */
				                                       FROM TBCSPSAE113B Z
				                                      WHERE Z.CRS_CD = A.CRS_CD
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = Z.CRS_CD
	 			                                                       AND X.APC_DT < F.EDU_STR_DT)
	 			                                     ), (SELECT DECODE(A.DMT_UE_YN, 'Y', Y.BRKF_FDEX*(F.EDU_DAY-1) + Y.LUNCH_FDEX*(F.EDU_DAY) +Y.DINR_FDEX*(F.EDU_DAY-1)
	 			                                                                       , Y.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정_천은정감사관 */
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
																		  FROM TBCSPSAE113B
																		  WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																						  AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )), (SELECT DECODE(A.DMT_UE_YN, 'Y', Y.BRKF_FDEX*(F.EDU_DAY-1) + Y.LUNCH_FDEX*(F.EDU_DAY) +Y.DINR_FDEX*(F.EDU_DAY-1)
	 			                                                                       , Y.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정_천은정감사관 */
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   				  FROM TBCSPSAE113B
																		 WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														  								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )) AS FDEX
				     , NVL(A.PD_AMT, 0) AS PD_AMT
				     , A.PD_MEAN_CD
				     , A.PD_YN
				     , B.EDU_DVSN_NM
				     , C.EDU_CAT_NM
				     , DECODE(A.SNDY_LODG_YN, 'Y', '전일입교', DECODE(A.DMT_UE_YN, 'Y', '숙박', '비숙박')) AS DMT_UE_YN
				     , A.BUS_UE_YN
				     , DECODE(A.SEX_CD, 1, '남', DECODE(A.SEX_CD, 2, '여', '') )AS SEX_CD
				     , A.PD_DT
				     , A.HPN
				     , A.PD_SMS_SEN_DT
				     , A.UNP_SMS_SEN_DT
				     , SUBSTR(F.EDU_STR_DT, 0, 4) || '.' || SUBSTR(F.EDU_STR_DT, 5, 2) || '.' || SUBSTR(F.EDU_STR_DT, 7, 2) || ' ~ ' ||
				       SUBSTR(F.EDU_END_DT, 0, 4) || '.' || SUBSTR(F.EDU_END_DT, 5, 2) || '.' || SUBSTR(F.EDU_END_DT, 7, 2) AS EDU_DT
				     , F.EAN
				  FROM TBCSPSAE301D A
				  	 , TBCSPSAE101C B
				  	 , TBCSPSAE102C C
				     , TBCSPSAE103C D
				     , TBDCMACM015M E
				     , (SELECT TO_DATE(A.EDU_END_DT, 'YYYYMMDD')+1 - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') AS EDU_DAY
	                         , CEIL((TO_DATE(A.EDU_END_DT, 'YYYYMMDD') - NEXT_DAY(TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') -1, '6') +1)/7) AS FRIDY_DCN /* 20240613 교육과정 점심식비에 금요일 미포함 계산식 조정으로 추가 */
	                         , A.YR
	                         , A.CRS_CD
	                         , A.CRS_CDN
	                         , A.EDU_STR_DT
	                         , A.EDU_END_DT
	                         , B.EAN
			             FROM TBCSPSAE201D A
			                , TBCSPSAE201M B
			             WHERE A.YR = B.YR
			             AND A.CRS_CD = B.CRS_CD) F
				 WHERE B.EDU_DVSN_CD = D.EDU_DVSN_CD
				   AND B.EDU_DVSN_CD = C.EDU_DVSN_CD
				   AND C.EDU_CAT_CD = D.EDU_CAT_CD
				   AND D.CRS_CD = A.CRS_CD
				   AND E.ORG_CD(+) = A.ORG_CD
				   AND F.YR	= A.YR
				   AND F.CRS_CD = A.CRS_CD
				   AND F.CRS_CDN = A.CRS_CDN
				   AND A.ORG_CD IS NOT NULL
				   AND A.YR BETWEEN SUBSTR(#strFromYm#, 0, 4) AND SUBSTR(#strToYm#, 0, 4)
				   AND F.EDU_STR_DT BETWEEN #strFromYm# AND #strToYm#
        ]]>
        <dynamic>
	        <isNotEmpty property="strEDU_DVSN_CD">
	        	AND B.EDU_DVSN_CD	= #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
	        	AND C.EDU_CAT_CD 	= #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
	        	AND A.CRS_CD 		= #strEDU_CRS_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strCRS_CDN">
	        	AND A.CRS_CDN 		= #strCRS_CDN#
	       	</isNotEmpty>
	        <isNotEmpty property="strPD_YN">
				AND A.PD_YN = #strPD_YN#
	       	</isNotEmpty>
	        <isNotEmpty property="strNAM">
				AND A.NAM LIKE '%' || #strNAM# || '%'
	       	</isNotEmpty>
	    </dynamic>
       	<![CDATA[
       	) A
		ORDER BY A.YR, A.CRS_CD, A.CRS_CDN, A.SNO
       	]]>
	</select>

	<select id="CSPSAE301EReportData" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.CRS_CDN
			     , D.CRS_NM
			     , SUBSTR(E.EDU_STR_DT, 0, 4) || '.' || SUBSTR(E.EDU_STR_DT, 5, 2) || '.' || SUBSTR(E.EDU_STR_DT, 7, 2) || ' ~ ' ||
			       SUBSTR(E.EDU_END_DT, 0, 4) || '.' || SUBSTR(E.EDU_END_DT, 5, 2) || '.' || SUBSTR(E.EDU_END_DT, 7, 2) AS EDU_DT
			     , E.EDU_END_DT
			     , A.NAM
			     , A.EDU_EXS
			     , A.DMT_EXS
			     , A.FDEX
			     , A.PD_AMT
 			     , A.UNP_AMT
			     , SUBSTR(A.PD_DT, 0, 4) || '년 ' || SUBSTR(A.PD_DT, 5, 2) || '월 ' || SUBSTR(A.PD_DT, 7, 2) || '일' AS PD_DT
			  FROM TBCSPSAE301D A
			  	 , TBCSPSAE101C B
			  	 , TBCSPSAE102C C
			     , TBCSPSAE103C D
			     , TBCSPSAE201D E
			 WHERE B.EDU_DVSN_CD = D.EDU_DVSN_CD
			   AND B.EDU_DVSN_CD = C.EDU_DVSN_CD
			   AND C.EDU_CAT_CD = D.EDU_CAT_CD
			   AND D.CRS_CD 	= A.CRS_CD
			   AND E.YR			= A.YR
			   AND E.CRS_CD		= A.CRS_CD
			   AND E.CRS_CDN	= A.CRS_CDN
			   AND A.PD_YN = 'Y'
			   AND A.YR BETWEEN #strFromY# AND #strToY#
			   AND SUBSTR(E.EDU_STR_DT, 0, 6) BETWEEN #strFromY# || #strFromM# AND #strToY# || #strToM#
        ]]>
        <dynamic>
	        <isNotEmpty property="strEDU_DVSN_CD">
	        	AND B.EDU_DVSN_CD	= #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
	        	AND C.EDU_CAT_CD 	= #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
	        	AND A.CRS_CD 		= #strEDU_CRS_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strCRS_CDN">
	        	AND A.CRS_CDN 		= #strCRS_CDN#
	       	</isNotEmpty>
	        <isNotEmpty property="strNAM">
				AND A.NAM LIKE '%' || #strNAM# || '%'
	       	</isNotEmpty>
	    </dynamic>
       	<![CDATA[
			ORDER BY A.YR, B.EDU_DVSN_CD, C.EDU_CAT_CD, A.CRS_CD, A.CRS_CDN, A.NAM
       	]]>
	</select>
	
	<update id="CSPSAE301EUpdateMain" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE301D
			   SET PD_MEAN_CD = #PD_MEAN_CD#
			     , PD_YN = #PD_YN#
			     , EDU_EXS = #EDU_EXS#
			     , DMT_EXS = #DMT_EXS#
			     , FDEX = #FDEX#
			     , PD_AMT = #PD_AMT#
			     , UNP_AMT = #UNP_AMT#
			     , PD_DT = DECODE(#PD_YN#, 'Y', TO_CHAR(SYSDATE, 'YYYYMMDD'), '')
			     , FNL_USR_ID      = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID      = #FNL_MNU_ID#
			     , FNL_MDF_DH      = SYSDATE
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND TANE_ID = #TANE_ID#
		]]>
	</update>
	
	<select id="CSPSAE302PSelectTaneHpn" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT NVL(HPN, 0) AS HPN
			  FROM TBCSPSAE301D
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND TANE_ID = #TANE_ID#
       	]]>
	</select>

	<insert id="CSPSAE302PInsertMain" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO MSG_DATA 
	 			      ( MSG_SEQ
	 			      , REQ_DATE
	 			      , CUR_STATE
	 			      , CALL_TO
	 			      , CALL_FROM
	 			      , SMS_TXT
	 			      , MSG_TYPE
	 			      , CONT_SEQ)
 			      VALUES (
 			            MSG_DATA_SEQ.NEXTVAL
 			          , SYSDATE
 			          , 0
 			          , TRIM(REPLACE(#CALL_TO#, '-'))
 			          , REPLACE(#CALL_FROM#, '-')
 			          , ''
 			          , 6
 			          , #CONT_SEQ#)
        ]]>
	</insert>

	<select id="CSPSAE302PSelectMaxMMSSeq" parameterClass="paramMap" resultClass="String">
        <![CDATA[
   			SELECT MMS_CONTENTS_INFO_SEQ.NEXTVAL AS SEQ FROM DUAL
       	]]>
	</select>
	
	<insert id="CSPSAE302PInsertMMSMain" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO MMS_CONTENTS_INFO 
	 			      ( CONT_SEQ
	 			      , FILE_CNT
	 			      , MMS_BODY
	 			      , MMS_SUBJECT)
 			      VALUES (#CONT_SEQ#
 			          , 1
 			          , #SMS_TXT#
 			          , #SMS_TLT#)
        ]]>
	</insert>

	<update id="CSPSAE302PUpdatePdSmsSenDt" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE301D
			   SET PD_SMS_SEN_DT   = TO_CHAR(SYSDATE, 'YYYYMMDD')
			     , FNL_USR_ID      = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID      = #FNL_MNU_ID#
			     , FNL_MDF_DH      = SYSDATE
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND TANE_ID = #TANE_ID#
		]]>
	</update>

	<update id="CSPSAE302PUpdateUnpSmsSenDt" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE301D
			   SET UNP_SMS_SEN_DT   = TO_CHAR(SYSDATE, 'YYYYMMDD')
			     , FNL_USR_ID      = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID      = #FNL_MNU_ID#
			     , FNL_MDF_DH      = SYSDATE
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND TANE_ID = #TANE_ID#
		]]>
	</update>

	<select id="CSPSAE303QMainList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT NVL2(A.YR, A.YR, '합계') AS YR
			      , DECODE(NVL2(A.YR, A.YR, '합계'), '합계', '', NVL2(B.EDU_DVSN_NM, B.EDU_DVSN_NM, '소계')) AS EDU_DVSN_NM
			      , DECODE(NVL2(B.EDU_DVSN_NM, B.EDU_DVSN_NM, '소계'), '소계', '', NVL2(C.EDU_CAT_NM, C.EDU_CAT_NM, '소계')) AS EDU_CAT_NM
			      , DECODE(NVL2(C.EDU_CAT_NM, C.EDU_CAT_NM, '소계'), '소계', '', DECODE(A.CRS_CDN, NULL, '소계', NVL2('제 ' || A.CRS_CDN || '기 ' || D.CRS_NM, '제 ' || A.CRS_CDN || '기 ' || D.CRS_NM, '소계'))) AS CRS_NM
			      , DECODE(NVL2(D.CRS_NM, D.CRS_NM, '소계'), '소계', '', NVL((SUBSTR(E.EDU_STR_DT, 5, 2) || '.' || SUBSTR(E.EDU_STR_DT, 7, 2)) || ' ~ '
			      || (SUBSTR(E.EDU_END_DT, 5, 2) || '.' || SUBSTR(E.EDU_END_DT, 7, 2)), '') )AS EDU_DATE
			      , SUM(A.CNT_EDU_PSON) AS CNT_EDU_PSON
			      , SUM(A.CNT_DRMTY_USE) AS CNT_DRMTY_USE
			      , NVL(SUM(A.EDU_EXS), 0) AS EDU_EXS
			      , NVL(SUM(A.DMT_EXS), 0) AS DMT_EXS
			      , NVL(SUM(A.PAID_AMT), 0) AS PAID_AMT
			      , NVL(SUM(A.PAID_AMT) OVER(ORDER BY A.YR, B.EDU_DVSN_NM, C.EDU_CAT_NM, D.CRS_NM, A.CRS_CDN,NVL((SUBSTR(E.EDU_STR_DT, 5, 2) || '.' || SUBSTR(E.EDU_STR_DT, 7, 2)) || ' ~ '
			      || (SUBSTR(E.EDU_END_DT, 5, 2) || '.' || SUBSTR(E.EDU_END_DT, 7, 2)), '소계')), 0) AS TOT
				   FROM ( SELECT A.YR, 
				                 A.CRS_CD,
				                 A.CRS_CDN,
				                 C.CNT_EDU_PSON,
				                 NVL(B.CNT_DRMTY_USE, 0) CNT_DRMTY_USE,
				                 A.EDU_EXS,
				                 A.DMT_EXS,
				                 A.PAID_AMT,
				                 A.PD_DT
				            FROM ( SELECT YR,
				                          CRS_CD,
				                          CRS_CDN,
				                          SUM(EDU_EXS) EDU_EXS,
				                          SUM(DMT_EXS) DMT_EXS,
				                          SUM(EDU_EXS + DMT_EXS) PAID_AMT,
				                          MAX(PD_DT) AS PD_DT
				                     FROM TBCSPSAE301D
				                    WHERE PD_YN = 'Y'
				                    GROUP BY YR,
				                          CRS_CD,
				                          CRS_CDN) A,
				                 ( SELECT YR,
				                           CRS_CD,
				                           CRS_CDN,
				                           COUNT(DMT_UE_YN) CNT_DRMTY_USE
				                      FROM TBCSPSAE301D
				                     WHERE DMT_UE_YN = 'Y'
				                       AND PD_YN = 'Y'
				                     GROUP BY YR,
				                           CRS_CD,
				                           CRS_CDN) B,
				                 ( SELECT YR,
				                           CRS_CD,
				                           CRS_CDN,
				                           COUNT(TANE_ID) CNT_EDU_PSON
				                      FROM TBCSPSAE301D
				                     WHERE PD_YN = 'Y'
				                     GROUP BY YR,
				                           CRS_CD,
				                           CRS_CDN) C
				           WHERE B.YR(+) = A.YR
				             AND B.CRS_CD(+) = A.CRS_CD
				             AND B.CRS_CDN(+) = A.CRS_CDN
				             AND C.YR = A.YR
				             AND C.CRS_CD = A.CRS_CD
				             AND C.CRS_CDN = A.CRS_CDN
				        ) A
				      , TBCSPSAE101C B
				      , TBCSPSAE102C C
				      , TBCSPSAE103C D
				      , TBCSPSAE201D E
				  WHERE D.CRS_CD 		= A.CRS_CD
				    AND C.EDU_CAT_CD 	= D.EDU_CAT_CD
				    AND B.EDU_DVSN_CD	= D.EDU_DVSN_CD
				    AND B.EDU_DVSN_CD	= C.EDU_DVSN_CD
				    AND E.YR			= A.YR
				    AND E.CRS_CD		= A.CRS_CD
				    AND E.CRS_CDN		= A.CRS_CDN
				    AND A.YR			BETWEEN #strFromY# AND #strToY#
        ]]>
        <dynamic>
	        <isNotEmpty property="strEDU_DVSN_CD">
	        	AND B.EDU_DVSN_CD = #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
	        	AND C.EDU_CAT_CD = #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
	        	AND A.CRS_CD = #strEDU_CRS_CD#
	       	</isNotEmpty>
	       	<isEqual property="strDateDvsn" compareValue="1" >
	       		AND SUBSTR(E.EDU_STR_DT, 0, 6) &gt;= #strFromY# || #strFromM#
				AND SUBSTR(E.EDU_END_DT, 0, 6) &lt;= #strToY#	|| #strToM#
	       	</isEqual>
	       	<isEqual property="strDateDvsn" compareValue="2" >
	       		AND SUBSTR(A.PD_DT, 0, 6) BETWEEN  #strFromY# || #strFromM# AND #strToY# || #strToM#
	       	</isEqual>
	    </dynamic>
       	<![CDATA[
			GROUP BY ROLLUP(A.YR, B.EDU_DVSN_NM, C.EDU_CAT_NM, 
					(D.CRS_NM, A.CRS_CDN, B.EDU_DVSN_NM, C.EDU_CAT_NM, D.CRS_NM, NVL((SUBSTR(E.EDU_STR_DT, 5, 2) || '.' || SUBSTR(E.EDU_STR_DT, 7, 2)) || ' ~ '
		      || (SUBSTR(E.EDU_END_DT, 5, 2) || '.' || SUBSTR(E.EDU_END_DT, 7, 2)), ''), E.EDU_STR_DT, E.EDU_END_DT, A.PAID_AMT))
       	]]>
	</select>
	
	<select id="CSPSAE304ESelectMain" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			 SELECT A.APC_DT AS BF_APC_DT
			 	  , A.APC_DT
			      , A.EDU_EXS
			      , A.DMT_EXS
			      , A.BRKF_FDEX
			      , A.LUNCH_FDEX
			      , A.DINR_FDEX
			      , A.CRS_CD AS BF_CRS_CD
			      , A.CRS_CD
			      , A.RMK_SBJ AS RMK
			   FROM TBCSPSAE113B A
       	]]>
	</select>
	
	<select id="CSPSAE304ECrsCdList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT '000' AS CRS_CD
			     , '전체' AS CRS_NM
			  FROM DUAL
  			 UNION
			SELECT CRS_CD
		         , CRS_NM
		      FROM TBCSPSAE103C
		     ORDER BY CRS_CD
       	]]>
	</select>
	
	<insert id="CSPSAE304EInsertMain" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO TBCSPSAE113B 
	 			      ( APC_DT
	 			      , CRS_CD
	 			      , EDU_EXS
	 			      , DMT_EXS
	 			      , BRKF_FDEX
	 			      , LUNCH_FDEX
	 			      , DINR_FDEX
	 			      , RMK_SBJ
	 			      , FRT_USR_ID
	 			      , FNL_USR_ID
	 			      , FNL_DEAL_DPT_CD
	 			      , FNL_MNU_ID
	 			      , FRT_REGI_DH
	 			      , FNL_MDF_DH
	 			      )
 			      VALUES (
 			            #APC_DT#
 			          , #CRS_CD#
 			          , #EDU_EXS# 
 			          , #DMT_EXS#
	 			      , #BRKF_FDEX#
	 			      , #LUNCH_FDEX#
	 			      , #DINR_FDEX#
	 			      , #RMK#
	 			      , #FRT_USR_ID#
	 			      , #FNL_USR_ID#
	 			      , #FNL_DEAL_DPT_CD#
	 			      , #FNL_MNU_ID#
	 			      , SYSDATE
	 			      , SYSDATE
	 			      )
        ]]>
	</insert>
	
	<update id="CSPSAE304EUpdateMain" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE113B
			   SET APC_DT = #APC_DT#
 			     , CRS_CD = #CRS_CD#
 			     , EDU_EXS = #EDU_EXS#
 			     , DMT_EXS = #DMT_EXS#
 			     , BRKF_FDEX = #BRKF_FDEX#
 			     , LUNCH_FDEX = #LUNCH_FDEX#
 			     , DINR_FDEX = #DINR_FDEX#
 			     , RMK_SBJ = #RMK#
			     , FNL_USR_ID      = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID      = #FNL_MNU_ID#
			     , FNL_MDF_DH      = SYSDATE
			 WHERE APC_DT = #BF_APC_DT#
			   AND CRS_CD = #BF_CRS_CD#
		]]>
	</update>
	
	<update id="CSPSAE304EUpdateRmk" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE113B
			   SET RMK_SBJ = #RMK#
			     , FNL_USR_ID      = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID      = #FNL_MNU_ID#
			     , FNL_MDF_DH      = SYSDATE
		]]>
	</update>
	
	<delete id="CSPSAE304EDeleteMain" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE113B
			 WHERE APC_DT = #BF_APC_DT#
			   AND CRS_CD = #BF_CRS_CD#
		]]>  
	</delete>
	
	<select id="CSPSAE305QHeadList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT DISTINCT(SUBSTRING(B.DT, 7, 2) || '(' || SUBSTRING(UPPER(TO_CHAR(TO_DATE(B.DT), 'DAY', 'NLS_DATE_LANGUAGE=KOREAN')), 0, 1) || ')') AS DATE_NAME
			  FROM (
					SELECT TO_CHAR(TO_DATE(#strYR_CD# || #strM# || '01', 'YYYYMMDD') + LEVEL-1, 'YYYYMMDD') AS DT
					  FROM DUAL
					CONNECT BY LEVEL <= TO_DATE((SELECT TO_CHAR(LAST_DAY(#strYR_CD# || #strM# || '01'), 'YYYYMMDD') FROM DUAL), 'YYYYMMDD') - (TO_DATE(#strYR_CD# || #strM# || '01', 'YYYYMMDD')-1)
					) B
			ORDER BY DATE_NAME
       	]]>
	</select>
	
	<select id="CSPSAE305QMainList" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			WITH
			CRS_DATA AS
			(
				SELECT 	A.YR
						, A.YR || #strM# AS YM
						, A.LCT_RM_NO
						, A.CRS_CDN
						, A.CRS_CD
						, A.USE_STR_DT
						, A.USE_END_DT
						, A.USE_STR_HM
						, A.USE_END_HM
						, A.ASG_YN
						, ( '제 ' || A.CRS_CDN || '기' || CHR(13) || CHR(10) || 
							(SELECT CRS_NM FROM TBCSPSAE103C WHERE CRS_CD = A.CRS_CD) || CHR(13) || CHR(10) ||
							SUBSTR(A.USE_STR_DT, 0, 4) || '.' || SUBSTR(A.USE_STR_DT, 5, 2) || '.' || SUBSTR(A.USE_STR_DT, 7, 2) || ' ~ '
							|| SUBSTR(A.USE_END_DT, 0, 4) || '.' || SUBSTR(A.USE_END_DT, 5, 2) || '.' || SUBSTR(A.USE_END_DT, 7, 2) || CHR(13) || CHR(10) ||
							SUBSTR(A.USE_STR_HM, 0, 2) || ':' || SUBSTR(A.USE_STR_HM, 3, 2) || ' ~ ' || SUBSTR(A.USE_END_HM, 0, 2) || ':' || SUBSTR(A.USE_END_HM, 3, 2) || CHR(13) || CHR(10)
						) AS TOOLTIP
				FROM 	TBCSPSAE203D A
				WHERE 	A.YR = #strYR_CD#
				AND 	(SUBSTR(A.USE_STR_DT, 5, 2) = #strM# OR SUBSTR(A.USE_END_DT, 5, 2) = #strM#)
			
			)
			, MAX_TIME_DATA AS
			(
				SELECT 	MIN(HUC_STR_HM) AS HUC_STR_HM,
						MAX(HUC_END_HM) AS HUC_END_HM
				FROM 	TBCSPSAE111B
			)
			SELECT	D62.CD_NM
					, D60.LCT_RM_NO
					, D60.LCT_RM_NM
					, D61.CRS_CD_01 
					, D61.CRS_CD_02 
					, D61.CRS_CD_03 
					, D61.CRS_CD_04 
					, D61.CRS_CD_05 
					, D61.CRS_CD_06 
					, D61.CRS_CD_07 
					, D61.CRS_CD_08 
					, D61.CRS_CD_09 
					, D61.CRS_CD_10 
					, D61.CRS_CD_11 
					, D61.CRS_CD_12 
					, D61.CRS_CD_13 
					, D61.CRS_CD_14 
					, D61.CRS_CD_15 
					, D61.CRS_CD_16 
					, D61.CRS_CD_17 
					, D61.CRS_CD_18 
					, D61.CRS_CD_19 
					, D61.CRS_CD_20 
					, D61.CRS_CD_21 
					, D61.CRS_CD_22 
					, D61.CRS_CD_23 
					, D61.CRS_CD_24 
					, D61.CRS_CD_25 
					, D61.CRS_CD_26 
					, D61.CRS_CD_27 
					, D61.CRS_CD_28 
					, D61.CRS_CD_29 
					, D61.CRS_CD_30 
					, D61.CRS_CD_31 
					, D61.CRS_CDN_01
					, D61.CRS_CDN_02
					, D61.CRS_CDN_03
					, D61.CRS_CDN_04
					, D61.CRS_CDN_05
					, D61.CRS_CDN_06
					, D61.CRS_CDN_07
					, D61.CRS_CDN_08
					, D61.CRS_CDN_09
					, D61.CRS_CDN_10
					, D61.CRS_CDN_11
					, D61.CRS_CDN_12
					, D61.CRS_CDN_13
					, D61.CRS_CDN_14
					, D61.CRS_CDN_15
					, D61.CRS_CDN_16
					, D61.CRS_CDN_17
					, D61.CRS_CDN_18
					, D61.CRS_CDN_19
					, D61.CRS_CDN_20
					, D61.CRS_CDN_21
					, D61.CRS_CDN_22
					, D61.CRS_CDN_23
					, D61.CRS_CDN_24
					, D61.CRS_CDN_25
					, D61.CRS_CDN_26
					, D61.CRS_CDN_27
					, D61.CRS_CDN_28
					, D61.CRS_CDN_29
					, D61.CRS_CDN_30
					, D61.CRS_CDN_31
					, D61.TOOLTIP_01
					, D61.TOOLTIP_02
					, D61.TOOLTIP_03
					, D61.TOOLTIP_04
					, D61.TOOLTIP_05
					, D61.TOOLTIP_06
					, D61.TOOLTIP_07
					, D61.TOOLTIP_08
					, D61.TOOLTIP_09
					, D61.TOOLTIP_10
					, D61.TOOLTIP_11
					, D61.TOOLTIP_12
					, D61.TOOLTIP_13
					, D61.TOOLTIP_14
					, D61.TOOLTIP_15
					, D61.TOOLTIP_16
					, D61.TOOLTIP_17
					, D61.TOOLTIP_18
					, D61.TOOLTIP_19
					, D61.TOOLTIP_20
					, D61.TOOLTIP_21
					, D61.TOOLTIP_22
					, D61.TOOLTIP_23
					, D61.TOOLTIP_24
					, D61.TOOLTIP_25
					, D61.TOOLTIP_26
					, D61.TOOLTIP_27
					, D61.TOOLTIP_28
					, D61.TOOLTIP_29
					, D61.TOOLTIP_30
					, D61.TOOLTIP_31
					, NVL(D61.YN_01, 'Ｘ') AS YN_01
					, NVL(D61.YN_02, 'Ｘ') AS YN_02
					, NVL(D61.YN_03, 'Ｘ') AS YN_03
					, NVL(D61.YN_04, 'Ｘ') AS YN_04
					, NVL(D61.YN_05, 'Ｘ') AS YN_05
					, NVL(D61.YN_06, 'Ｘ') AS YN_06
					, NVL(D61.YN_07, 'Ｘ') AS YN_07
					, NVL(D61.YN_08, 'Ｘ') AS YN_08
					, NVL(D61.YN_09, 'Ｘ') AS YN_09
					, NVL(D61.YN_10, 'Ｘ') AS YN_10
					, NVL(D61.YN_11, 'Ｘ') AS YN_11
					, NVL(D61.YN_12, 'Ｘ') AS YN_12
					, NVL(D61.YN_13, 'Ｘ') AS YN_13
					, NVL(D61.YN_14, 'Ｘ') AS YN_14
					, NVL(D61.YN_15, 'Ｘ') AS YN_15
					, NVL(D61.YN_16, 'Ｘ') AS YN_16
					, NVL(D61.YN_17, 'Ｘ') AS YN_17
					, NVL(D61.YN_18, 'Ｘ') AS YN_18
					, NVL(D61.YN_19, 'Ｘ') AS YN_19
					, NVL(D61.YN_20, 'Ｘ') AS YN_20
					, NVL(D61.YN_21, 'Ｘ') AS YN_21
					, NVL(D61.YN_22, 'Ｘ') AS YN_22
					, NVL(D61.YN_23, 'Ｘ') AS YN_23
					, NVL(D61.YN_24, 'Ｘ') AS YN_24
					, NVL(D61.YN_25, 'Ｘ') AS YN_25
					, NVL(D61.YN_26, 'Ｘ') AS YN_26
					, NVL(D61.YN_27, 'Ｘ') AS YN_27
					, NVL(D61.YN_28, 'Ｘ') AS YN_28
					, NVL(D61.YN_29, 'Ｘ') AS YN_29
					, NVL(D61.YN_30, 'Ｘ') AS YN_30
					, NVL(D61.YN_31, 'Ｘ') AS YN_31
			FROM	TBCSPSAE114C D60
					, TBDCMACM013C D62
					, (
						SELECT	D50.YR
								, D50.YM
								, D50.LCT_RM_NO
								, D50.CRS_CD_01
								, D50.CRS_CD_02
								, D50.CRS_CD_03
								, D50.CRS_CD_04
								, D50.CRS_CD_05
								, D50.CRS_CD_06
								, D50.CRS_CD_07
								, D50.CRS_CD_08
								, D50.CRS_CD_09
								, D50.CRS_CD_10
								, D50.CRS_CD_11
								, D50.CRS_CD_12
								, D50.CRS_CD_13
								, D50.CRS_CD_14
								, D50.CRS_CD_15
								, D50.CRS_CD_16
								, D50.CRS_CD_17
								, D50.CRS_CD_18
								, D50.CRS_CD_19
								, D50.CRS_CD_20
								, D50.CRS_CD_21
								, D50.CRS_CD_22
								, D50.CRS_CD_23
								, D50.CRS_CD_24
								, D50.CRS_CD_25
								, D50.CRS_CD_26
								, D50.CRS_CD_27
								, D50.CRS_CD_28
								, D50.CRS_CD_29
								, D50.CRS_CD_30
								, D50.CRS_CD_31
								, D50.CRS_CDN_01
								, D50.CRS_CDN_02
								, D50.CRS_CDN_03
								, D50.CRS_CDN_04
								, D50.CRS_CDN_05
								, D50.CRS_CDN_06
								, D50.CRS_CDN_07
								, D50.CRS_CDN_08
								, D50.CRS_CDN_09
								, D50.CRS_CDN_10
								, D50.CRS_CDN_11
								, D50.CRS_CDN_12
								, D50.CRS_CDN_13
								, D50.CRS_CDN_14
								, D50.CRS_CDN_15
								, D50.CRS_CDN_16
								, D50.CRS_CDN_17
								, D50.CRS_CDN_18
								, D50.CRS_CDN_19
								, D50.CRS_CDN_20
								, D50.CRS_CDN_21
								, D50.CRS_CDN_22
								, D50.CRS_CDN_23
								, D50.CRS_CDN_24
								, D50.CRS_CDN_25
								, D50.CRS_CDN_26
								, D50.CRS_CDN_27
								, D50.CRS_CDN_28
								, D50.CRS_CDN_29
								, D50.CRS_CDN_30
								, D50.CRS_CDN_31
								, D50.TOOLTIP_01
								, D50.TOOLTIP_02
								, D50.TOOLTIP_03
								, D50.TOOLTIP_04
								, D50.TOOLTIP_05
								, D50.TOOLTIP_06
								, D50.TOOLTIP_07
								, D50.TOOLTIP_08
								, D50.TOOLTIP_09
								, D50.TOOLTIP_10
								, D50.TOOLTIP_11
								, D50.TOOLTIP_12
								, D50.TOOLTIP_13
								, D50.TOOLTIP_14
								, D50.TOOLTIP_15
								, D50.TOOLTIP_16
								, D50.TOOLTIP_17
								, D50.TOOLTIP_18
								, D50.TOOLTIP_19
								, D50.TOOLTIP_20
								, D50.TOOLTIP_21
								, D50.TOOLTIP_22
								, D50.TOOLTIP_23
								, D50.TOOLTIP_24
								, D50.TOOLTIP_25
								, D50.TOOLTIP_26
								, D50.TOOLTIP_27
								, D50.TOOLTIP_28
								, D50.TOOLTIP_29
								, D50.TOOLTIP_30
								, D50.TOOLTIP_31
								, D51.YN_01
								, D51.YN_02
								, D51.YN_03
								, D51.YN_04
								, D51.YN_05
								, D51.YN_06
								, D51.YN_07
								, D51.YN_08
								, D51.YN_09
								, D51.YN_10
								, D51.YN_11
								, D51.YN_12
								, D51.YN_13
								, D51.YN_14
								, D51.YN_15
								, D51.YN_16
								, D51.YN_17
								, D51.YN_18
								, D51.YN_19
								, D51.YN_20
								, D51.YN_21
								, D51.YN_22
								, D51.YN_23
								, D51.YN_24
								, D51.YN_25
								, D51.YN_26
								, D51.YN_27
								, D51.YN_28
								, D51.YN_29
								, D51.YN_30
								, D51.YN_31
						FROM	(
									SELECT	D2.YR
											, D2.YM
											, D2.LCT_RM_NO
											, AGGR_CONCAT( D2.CRS_CD_01, '@' ) AS CRS_CD_01
											, AGGR_CONCAT( D2.CRS_CD_02, '@' ) AS CRS_CD_02
											, AGGR_CONCAT( D2.CRS_CD_03, '@' ) AS CRS_CD_03
											, AGGR_CONCAT( D2.CRS_CD_04, '@' ) AS CRS_CD_04
											, AGGR_CONCAT( D2.CRS_CD_05, '@' ) AS CRS_CD_05
											, AGGR_CONCAT( D2.CRS_CD_06, '@' ) AS CRS_CD_06
											, AGGR_CONCAT( D2.CRS_CD_07, '@' ) AS CRS_CD_07
											, AGGR_CONCAT( D2.CRS_CD_08, '@' ) AS CRS_CD_08
											, AGGR_CONCAT( D2.CRS_CD_09, '@' ) AS CRS_CD_09
											, AGGR_CONCAT( D2.CRS_CD_10, '@' ) AS CRS_CD_10
											, AGGR_CONCAT( D2.CRS_CD_11, '@' ) AS CRS_CD_11
											, AGGR_CONCAT( D2.CRS_CD_12, '@' ) AS CRS_CD_12
											, AGGR_CONCAT( D2.CRS_CD_13, '@' ) AS CRS_CD_13
											, AGGR_CONCAT( D2.CRS_CD_14, '@' ) AS CRS_CD_14
											, AGGR_CONCAT( D2.CRS_CD_15, '@' ) AS CRS_CD_15
											, AGGR_CONCAT( D2.CRS_CD_16, '@' ) AS CRS_CD_16
											, AGGR_CONCAT( D2.CRS_CD_17, '@' ) AS CRS_CD_17
											, AGGR_CONCAT( D2.CRS_CD_18, '@' ) AS CRS_CD_18
											, AGGR_CONCAT( D2.CRS_CD_19, '@' ) AS CRS_CD_19
											, AGGR_CONCAT( D2.CRS_CD_20, '@' ) AS CRS_CD_20
											, AGGR_CONCAT( D2.CRS_CD_21, '@' ) AS CRS_CD_21
											, AGGR_CONCAT( D2.CRS_CD_22, '@' ) AS CRS_CD_22
											, AGGR_CONCAT( D2.CRS_CD_23, '@' ) AS CRS_CD_23
											, AGGR_CONCAT( D2.CRS_CD_24, '@' ) AS CRS_CD_24
											, AGGR_CONCAT( D2.CRS_CD_25, '@' ) AS CRS_CD_25
											, AGGR_CONCAT( D2.CRS_CD_26, '@' ) AS CRS_CD_26
											, AGGR_CONCAT( D2.CRS_CD_27, '@' ) AS CRS_CD_27
											, AGGR_CONCAT( D2.CRS_CD_28, '@' ) AS CRS_CD_28
											, AGGR_CONCAT( D2.CRS_CD_29, '@' ) AS CRS_CD_29
											, AGGR_CONCAT( D2.CRS_CD_30, '@' ) AS CRS_CD_30
											, AGGR_CONCAT( D2.CRS_CD_31, '@' ) AS CRS_CD_31
											, AGGR_CONCAT( D2.CRS_CDN_01, '@' ) AS CRS_CDN_01
											, AGGR_CONCAT( D2.CRS_CDN_02, '@' ) AS CRS_CDN_02
											, AGGR_CONCAT( D2.CRS_CDN_03, '@' ) AS CRS_CDN_03
											, AGGR_CONCAT( D2.CRS_CDN_04, '@' ) AS CRS_CDN_04
											, AGGR_CONCAT( D2.CRS_CDN_05, '@' ) AS CRS_CDN_05
											, AGGR_CONCAT( D2.CRS_CDN_06, '@' ) AS CRS_CDN_06
											, AGGR_CONCAT( D2.CRS_CDN_07, '@' ) AS CRS_CDN_07
											, AGGR_CONCAT( D2.CRS_CDN_08, '@' ) AS CRS_CDN_08
											, AGGR_CONCAT( D2.CRS_CDN_09, '@' ) AS CRS_CDN_09
											, AGGR_CONCAT( D2.CRS_CDN_10, '@' ) AS CRS_CDN_10
											, AGGR_CONCAT( D2.CRS_CDN_11, '@' ) AS CRS_CDN_11
											, AGGR_CONCAT( D2.CRS_CDN_12, '@' ) AS CRS_CDN_12
											, AGGR_CONCAT( D2.CRS_CDN_13, '@' ) AS CRS_CDN_13
											, AGGR_CONCAT( D2.CRS_CDN_14, '@' ) AS CRS_CDN_14
											, AGGR_CONCAT( D2.CRS_CDN_15, '@' ) AS CRS_CDN_15
											, AGGR_CONCAT( D2.CRS_CDN_16, '@' ) AS CRS_CDN_16
											, AGGR_CONCAT( D2.CRS_CDN_17, '@' ) AS CRS_CDN_17
											, AGGR_CONCAT( D2.CRS_CDN_18, '@' ) AS CRS_CDN_18
											, AGGR_CONCAT( D2.CRS_CDN_19, '@' ) AS CRS_CDN_19
											, AGGR_CONCAT( D2.CRS_CDN_20, '@' ) AS CRS_CDN_20
											, AGGR_CONCAT( D2.CRS_CDN_21, '@' ) AS CRS_CDN_21
											, AGGR_CONCAT( D2.CRS_CDN_22, '@' ) AS CRS_CDN_22
											, AGGR_CONCAT( D2.CRS_CDN_23, '@' ) AS CRS_CDN_23
											, AGGR_CONCAT( D2.CRS_CDN_24, '@' ) AS CRS_CDN_24
											, AGGR_CONCAT( D2.CRS_CDN_25, '@' ) AS CRS_CDN_25
											, AGGR_CONCAT( D2.CRS_CDN_26, '@' ) AS CRS_CDN_26
											, AGGR_CONCAT( D2.CRS_CDN_27, '@' ) AS CRS_CDN_27
											, AGGR_CONCAT( D2.CRS_CDN_28, '@' ) AS CRS_CDN_28
											, AGGR_CONCAT( D2.CRS_CDN_29, '@' ) AS CRS_CDN_29
											, AGGR_CONCAT( D2.CRS_CDN_30, '@' ) AS CRS_CDN_30
											, AGGR_CONCAT( D2.CRS_CDN_31, '@' ) AS CRS_CDN_31
											, AGGR_CONCAT( D2.TOOLTIP_01, '' ) AS TOOLTIP_01
											, AGGR_CONCAT( D2.TOOLTIP_02, '' ) AS TOOLTIP_02
											, AGGR_CONCAT( D2.TOOLTIP_03, '' ) AS TOOLTIP_03
											, AGGR_CONCAT( D2.TOOLTIP_04, '' ) AS TOOLTIP_04
											, AGGR_CONCAT( D2.TOOLTIP_05, '' ) AS TOOLTIP_05
											, AGGR_CONCAT( D2.TOOLTIP_06, '' ) AS TOOLTIP_06
											, AGGR_CONCAT( D2.TOOLTIP_07, '' ) AS TOOLTIP_07
											, AGGR_CONCAT( D2.TOOLTIP_08, '' ) AS TOOLTIP_08
											, AGGR_CONCAT( D2.TOOLTIP_09, '' ) AS TOOLTIP_09
											, AGGR_CONCAT( D2.TOOLTIP_10, '' ) AS TOOLTIP_10
											, AGGR_CONCAT( D2.TOOLTIP_11, '' ) AS TOOLTIP_11
											, AGGR_CONCAT( D2.TOOLTIP_12, '' ) AS TOOLTIP_12
											, AGGR_CONCAT( D2.TOOLTIP_13, '' ) AS TOOLTIP_13
											, AGGR_CONCAT( D2.TOOLTIP_14, '' ) AS TOOLTIP_14
											, AGGR_CONCAT( D2.TOOLTIP_15, '' ) AS TOOLTIP_15
											, AGGR_CONCAT( D2.TOOLTIP_16, '' ) AS TOOLTIP_16
											, AGGR_CONCAT( D2.TOOLTIP_17, '' ) AS TOOLTIP_17
											, AGGR_CONCAT( D2.TOOLTIP_18, '' ) AS TOOLTIP_18
											, AGGR_CONCAT( D2.TOOLTIP_19, '' ) AS TOOLTIP_19
											, AGGR_CONCAT( D2.TOOLTIP_20, '' ) AS TOOLTIP_20
											, AGGR_CONCAT( D2.TOOLTIP_21, '' ) AS TOOLTIP_21
											, AGGR_CONCAT( D2.TOOLTIP_22, '' ) AS TOOLTIP_22
											, AGGR_CONCAT( D2.TOOLTIP_23, '' ) AS TOOLTIP_23
											, AGGR_CONCAT( D2.TOOLTIP_24, '' ) AS TOOLTIP_24
											, AGGR_CONCAT( D2.TOOLTIP_25, '' ) AS TOOLTIP_25
											, AGGR_CONCAT( D2.TOOLTIP_26, '' ) AS TOOLTIP_26
											, AGGR_CONCAT( D2.TOOLTIP_27, '' ) AS TOOLTIP_27
											, AGGR_CONCAT( D2.TOOLTIP_28, '' ) AS TOOLTIP_28
											, AGGR_CONCAT( D2.TOOLTIP_29, '' ) AS TOOLTIP_29
											, AGGR_CONCAT( D2.TOOLTIP_30, '' ) AS TOOLTIP_30
											, AGGR_CONCAT( D2.TOOLTIP_31, '' ) AS TOOLTIP_31
									FROM	(
												SELECT	D1.YR
														, D1.YM
														, D1.LCT_RM_NO
														, ( CASE WHEN D1.YM || '01' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_01
														, ( CASE WHEN D1.YM || '02' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_02
														, ( CASE WHEN D1.YM || '03' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_03
														, ( CASE WHEN D1.YM || '04' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_04
														, ( CASE WHEN D1.YM || '05' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_05
														, ( CASE WHEN D1.YM || '06' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_06
														, ( CASE WHEN D1.YM || '07' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_07
														, ( CASE WHEN D1.YM || '08' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_08
														, ( CASE WHEN D1.YM || '09' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_09
														, ( CASE WHEN D1.YM || '10' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_10
														, ( CASE WHEN D1.YM || '11' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_11
														, ( CASE WHEN D1.YM || '12' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_12
														, ( CASE WHEN D1.YM || '13' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_13
														, ( CASE WHEN D1.YM || '14' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_14
														, ( CASE WHEN D1.YM || '15' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_15
														, ( CASE WHEN D1.YM || '16' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_16
														, ( CASE WHEN D1.YM || '17' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_17
														, ( CASE WHEN D1.YM || '18' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_18
														, ( CASE WHEN D1.YM || '19' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_19
														, ( CASE WHEN D1.YM || '20' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_20
														, ( CASE WHEN D1.YM || '21' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_21
														, ( CASE WHEN D1.YM || '22' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_22
														, ( CASE WHEN D1.YM || '23' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_23
														, ( CASE WHEN D1.YM || '24' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_24
														, ( CASE WHEN D1.YM || '25' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_25
														, ( CASE WHEN D1.YM || '26' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_26
														, ( CASE WHEN D1.YM || '27' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_27
														, ( CASE WHEN D1.YM || '28' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_28
														, ( CASE WHEN D1.YM || '29' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_29
														, ( CASE WHEN D1.YM || '30' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_30
														, ( CASE WHEN D1.YM || '31' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CD ELSE NULL END ) AS CRS_CD_31
														, ( CASE WHEN D1.YM || '01' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_01
														, ( CASE WHEN D1.YM || '02' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_02
														, ( CASE WHEN D1.YM || '03' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_03
														, ( CASE WHEN D1.YM || '04' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_04
														, ( CASE WHEN D1.YM || '05' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_05
														, ( CASE WHEN D1.YM || '06' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_06
														, ( CASE WHEN D1.YM || '07' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_07
														, ( CASE WHEN D1.YM || '08' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_08
														, ( CASE WHEN D1.YM || '09' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_09
														, ( CASE WHEN D1.YM || '10' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_10
														, ( CASE WHEN D1.YM || '11' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_11
														, ( CASE WHEN D1.YM || '12' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_12
														, ( CASE WHEN D1.YM || '13' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_13
														, ( CASE WHEN D1.YM || '14' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_14
														, ( CASE WHEN D1.YM || '15' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_15
														, ( CASE WHEN D1.YM || '16' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_16
														, ( CASE WHEN D1.YM || '17' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_17
														, ( CASE WHEN D1.YM || '18' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_18
														, ( CASE WHEN D1.YM || '19' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_19
														, ( CASE WHEN D1.YM || '20' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_20
														, ( CASE WHEN D1.YM || '21' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_21
														, ( CASE WHEN D1.YM || '22' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_22
														, ( CASE WHEN D1.YM || '23' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_23
														, ( CASE WHEN D1.YM || '24' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_24
														, ( CASE WHEN D1.YM || '25' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_25
														, ( CASE WHEN D1.YM || '26' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_26
														, ( CASE WHEN D1.YM || '27' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_27
														, ( CASE WHEN D1.YM || '28' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_28
														, ( CASE WHEN D1.YM || '29' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_29
														, ( CASE WHEN D1.YM || '30' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_30
														, ( CASE WHEN D1.YM || '31' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN CRS_CDN ELSE NULL END ) AS CRS_CDN_31
														, ( CASE WHEN D1.YM || '01' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_01
														, ( CASE WHEN D1.YM || '02' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_02
														, ( CASE WHEN D1.YM || '03' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_03
														, ( CASE WHEN D1.YM || '04' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_04
														, ( CASE WHEN D1.YM || '05' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_05
														, ( CASE WHEN D1.YM || '06' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_06
														, ( CASE WHEN D1.YM || '07' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_07
														, ( CASE WHEN D1.YM || '08' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_08
														, ( CASE WHEN D1.YM || '09' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_09
														, ( CASE WHEN D1.YM || '10' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_10
														, ( CASE WHEN D1.YM || '11' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_11
														, ( CASE WHEN D1.YM || '12' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_12
														, ( CASE WHEN D1.YM || '13' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_13
														, ( CASE WHEN D1.YM || '14' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_14
														, ( CASE WHEN D1.YM || '15' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_15
														, ( CASE WHEN D1.YM || '16' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_16
														, ( CASE WHEN D1.YM || '17' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_17
														, ( CASE WHEN D1.YM || '18' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_18
														, ( CASE WHEN D1.YM || '19' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_19
														, ( CASE WHEN D1.YM || '20' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_20
														, ( CASE WHEN D1.YM || '21' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_21
														, ( CASE WHEN D1.YM || '22' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_22
														, ( CASE WHEN D1.YM || '23' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_23
														, ( CASE WHEN D1.YM || '24' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_24
														, ( CASE WHEN D1.YM || '25' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_25
														, ( CASE WHEN D1.YM || '26' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_26
														, ( CASE WHEN D1.YM || '27' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_27
														, ( CASE WHEN D1.YM || '28' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_28
														, ( CASE WHEN D1.YM || '29' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_29
														, ( CASE WHEN D1.YM || '30' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_30
														, ( CASE WHEN D1.YM || '31' BETWEEN D1.USE_STR_DT AND D1.USE_END_DT THEN TOOLTIP ELSE NULL END ) AS TOOLTIP_31
												FROM	CRS_DATA D1
											) D2
									GROUP BY D2.YR
											, D2.YM
											, D2.LCT_RM_NO
								) D50
								, (
									SELECT	D4.YR
											, D4.YM
											, D4.LCT_RM_NO
                                            ,(CASE WHEN SUM(CNT_01) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_01) THEN '○' ELSE '' END ) AS YN_01
                                            ,(CASE WHEN SUM(CNT_02) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_02) THEN '○' ELSE '' END ) AS YN_02
                                            ,(CASE WHEN SUM(CNT_03) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_03) THEN '○' ELSE '' END ) AS YN_03
                                            ,(CASE WHEN SUM(CNT_04) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_04) THEN '○' ELSE '' END ) AS YN_04
                                            ,(CASE WHEN SUM(CNT_05) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_05) THEN '○' ELSE '' END ) AS YN_05
                                            ,(CASE WHEN SUM(CNT_06) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_06) THEN '○' ELSE '' END ) AS YN_06
                                            ,(CASE WHEN SUM(CNT_07) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_07) THEN '○' ELSE '' END ) AS YN_07
                                            ,(CASE WHEN SUM(CNT_08) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_08) THEN '○' ELSE '' END ) AS YN_08
                                            ,(CASE WHEN SUM(CNT_09) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_09) THEN '○' ELSE '' END ) AS YN_09
                                            ,(CASE WHEN SUM(CNT_10) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_10) THEN '○' ELSE '' END ) AS YN_10
                                            ,(CASE WHEN SUM(CNT_11) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_11) THEN '○' ELSE '' END ) AS YN_11
                                            ,(CASE WHEN SUM(CNT_12) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_12) THEN '○' ELSE '' END ) AS YN_12
                                            ,(CASE WHEN SUM(CNT_13) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_13) THEN '○' ELSE '' END ) AS YN_13
                                            ,(CASE WHEN SUM(CNT_14) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_14) THEN '○' ELSE '' END ) AS YN_14
                                            ,(CASE WHEN SUM(CNT_15) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_15) THEN '○' ELSE '' END ) AS YN_15
                                            ,(CASE WHEN SUM(CNT_16) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_16) THEN '○' ELSE '' END ) AS YN_16
                                            ,(CASE WHEN SUM(CNT_17) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_17) THEN '○' ELSE '' END ) AS YN_17
                                            ,(CASE WHEN SUM(CNT_18) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_18) THEN '○' ELSE '' END ) AS YN_18
                                            ,(CASE WHEN SUM(CNT_19) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_19) THEN '○' ELSE '' END ) AS YN_19
                                            ,(CASE WHEN SUM(CNT_20) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_20) THEN '○' ELSE '' END ) AS YN_20
                                            ,(CASE WHEN SUM(CNT_21) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_21) THEN '○' ELSE '' END ) AS YN_21
                                            ,(CASE WHEN SUM(CNT_22) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_22) THEN '○' ELSE '' END ) AS YN_22
                                            ,(CASE WHEN SUM(CNT_23) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_23) THEN '○' ELSE '' END ) AS YN_23
                                            ,(CASE WHEN SUM(CNT_24) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_24) THEN '○' ELSE '' END ) AS YN_24
                                            ,(CASE WHEN SUM(CNT_25) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_25) THEN '○' ELSE '' END ) AS YN_25
                                            ,(CASE WHEN SUM(CNT_26) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_26) THEN '○' ELSE '' END ) AS YN_26
                                            ,(CASE WHEN SUM(CNT_27) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_27) THEN '○' ELSE '' END ) AS YN_27
                                            ,(CASE WHEN SUM(CNT_28) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_28) THEN '○' ELSE '' END ) AS YN_28
                                            ,(CASE WHEN SUM(CNT_29) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_29) THEN '○' ELSE '' END ) AS YN_29
                                            ,(CASE WHEN SUM(CNT_30) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_30) THEN '○' ELSE '' END ) AS YN_30
                                            ,(CASE WHEN SUM(CNT_31) = 0 THEN 'Ｘ' WHEN COUNT(D4.SRT_SNO) >= SUM(CNT_31) THEN '○' ELSE '' END ) AS YN_31
									FROM	(
												SELECT	D3.YR
														, D3.YM
														, D3.LCT_RM_NO
														, D1.SRT_SNO 
														, MAX( CASE WHEN ( D3.YM || '01' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_01
														, MAX( CASE WHEN ( D3.YM || '02' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_02
														, MAX( CASE WHEN ( D3.YM || '03' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_03
														, MAX( CASE WHEN ( D3.YM || '04' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_04
														, MAX( CASE WHEN ( D3.YM || '05' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_05
														, MAX( CASE WHEN ( D3.YM || '06' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_06
														, MAX( CASE WHEN ( D3.YM || '07' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_07
														, MAX( CASE WHEN ( D3.YM || '08' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_08
														, MAX( CASE WHEN ( D3.YM || '09' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_09
														, MAX( CASE WHEN ( D3.YM || '10' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_10
														, MAX( CASE WHEN ( D3.YM || '11' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_11
														, MAX( CASE WHEN ( D3.YM || '12' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_12
														, MAX( CASE WHEN ( D3.YM || '13' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_13
														, MAX( CASE WHEN ( D3.YM || '14' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_14
														, MAX( CASE WHEN ( D3.YM || '15' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_15
														, MAX( CASE WHEN ( D3.YM || '16' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_16
														, MAX( CASE WHEN ( D3.YM || '17' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_17
														, MAX( CASE WHEN ( D3.YM || '18' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_18
														, MAX( CASE WHEN ( D3.YM || '19' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_19
														, MAX( CASE WHEN ( D3.YM || '20' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_20
														, MAX( CASE WHEN ( D3.YM || '21' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_21
														, MAX( CASE WHEN ( D3.YM || '22' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_22
														, MAX( CASE WHEN ( D3.YM || '23' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_23
														, MAX( CASE WHEN ( D3.YM || '24' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_24
														, MAX( CASE WHEN ( D3.YM || '25' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_25
														, MAX( CASE WHEN ( D3.YM || '26' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_26
														, MAX( CASE WHEN ( D3.YM || '27' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_27
														, MAX( CASE WHEN ( D3.YM || '28' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_28
														, MAX( CASE WHEN ( D3.YM || '29' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_29
														, MAX( CASE WHEN ( D3.YM || '30' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_30
														, MAX( CASE WHEN ( D3.YM || '31' BETWEEN D3.USE_STR_DT AND D3.USE_END_DT ) AND D1.HUC_STR_HM >= D3.USE_STR_HM AND D1.HUC_END_HM <= D3.USE_END_HM THEN 1 ELSE 0 END ) AS CNT_31
												FROM	TBCSPSAE111B D1
														, (
															SELECT	DISTINCT D2.YR
																	, D2.YM
																	, D2.LCT_RM_NO
																	, D2.USE_STR_DT
																	, D2.USE_END_DT
																	, DECODE(D2.ASG_YN, 'Y', ( SELECT HUC_STR_HM FROM MAX_TIME_DATA ), D2.USE_STR_HM) AS USE_STR_HM
																	, DECODE(D2.ASG_YN, 'Y', ( SELECT HUC_END_HM FROM MAX_TIME_DATA ), D2.USE_END_HM) AS USE_END_HM
															FROM	CRS_DATA D2
														) D3
												GROUP BY YR
														, YM
														, LCT_RM_NO
														, SRT_SNO
											) D4
									GROUP BY YR
											, YM
											, LCT_RM_NO
								) D51
						WHERE	D50.YR = D51.YR
						AND		D50.YM = D51.YM
						AND		D50.LCT_RM_NO = D51.LCT_RM_NO
					) D61
			WHERE	D60.LCT_RM_NO = D61.LCT_RM_NO(+)
			  AND   D62.CMM_CD_DVSN_CD = '1000139'
			  AND   D60.LCT_RM_DVSN_CD = D62.CD		
		]]>
		<dynamic>
	        <isNotEmpty property="strLctRmDvsn">
				AND	D60.LCT_RM_DVSN_CD = #strLctRmDvsn#
	       	</isNotEmpty>
	        <isNotEmpty property="strLctRmNm">
				AND	D60.LCT_RM_NM LIKE '%' || #strLctRmNm# ||'%'
	       	</isNotEmpty>
	    </dynamic>
       	<![CDATA[
			ORDER BY LCT_RM_NO
       	]]>
	</select>

	<select id="CSPSAE306PSelectRequset" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			 SELECT EDU_DVSN_CD
			      , EDU_CAT_CD
			   FROM TBCSPSAE103C
 			 WHERE CRS_CD = #strEDU_CRS_CD#
		]]>
	</select>
	
	<select id="CSPSAE306PSelectMain" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT A.YR
			     , B.EDU_DVSN_CD
			     , B.EDU_CAT_CD
			     , A.CRS_CD
			     , A.CRS_CDN
			     , A.ASG_YN
			     , D.LCT_RM_DVSN_CD
			     , A.LCT_RM_NO
			     , A.LCT_RM_NO AS BF_LCT_RM_NO
			     , A.USE_STR_DT
			     , A.USE_END_DT
			     , A.USE_STR_HM
			     , A.USE_END_HM
			 FROM TBCSPSAE203D A
			    , TBCSPSAE103C B
			    , TBDCMACM013C C
			    , TBCSPSAE114C D
			WHERE B.CRS_CD = A.CRS_CD
			  AND C.CMM_CD_DVSN_CD = '1000139'
			  AND D.LCT_RM_DVSN_CD = C.CD
			  AND D.LCT_RM_NO = A.LCT_RM_NO
		]]>
		<dynamic>
	        <isNotEmpty property="strYR_CD">
 				AND A.YR = #strYR_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_DVSN_CD">
  				AND B.EDU_DVSN_CD = #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
  				AND B.EDU_CAT_CD = #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
  				AND A.CRS_CD = #strEDU_CRS_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strCRS_CDN">
				AND A.CRS_CDN = #strCRS_CDN#
	       	</isNotEmpty>
	    </dynamic>
       	<![CDATA[
			ORDER BY A.YR, B.EDU_DVSN_CD, B.EDU_CAT_CD, A.CRS_CD, A.CRS_CDN, A.ASG_YN DESC, D.LCT_RM_DVSN_CD, A.LCT_RM_NO, A.USE_STR_DT, A.USE_STR_HM
       	]]>
	</select>
	
	<insert id="CSPSAE306PInsertMain" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO TBCSPSAE203D 
	 			      ( YR
	 			      , CRS_CD
	 			      , CRS_CDN
	 			      , LCT_RM_NO
	 			      , ASG_YN
	 			      , USE_STR_DT
	 			      , USE_END_DT
	 			      , USE_STR_HM
	 			      , USE_END_HM
	 			      , FRT_USR_ID
	 			      , FNL_USR_ID
	 			      , FNL_DEAL_DPT_CD
	 			      , FNL_MNU_ID
	 			      , FRT_REGI_DH
	 			      , FNL_MDF_DH
	 			      )
 			      VALUES (
 			            #YR#
 			          , #CRS_CD#
 			          , #CRS_CDN# 
 			          , #LCT_RM_NO#
	 			      , #ASG_YN#
	 			      , #USE_STR_DT#
	 			      , #USE_END_DT#
	 			      , #USE_STR_HM#
	 			      , #USE_END_HM#
	 			      , #FRT_USR_ID#
	 			      , #FNL_USR_ID#
	 			      , #FNL_DEAL_DPT_CD#
	 			      , #FNL_MNU_ID#
	 			      , SYSDATE
	 			      , SYSDATE
	 			      )
        ]]>
	</insert>
	
	<update id="CSPSAE306PUpdateMain" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE203D
			   SET LCT_RM_NO 		= #LCT_RM_NO#
			     , USE_STR_DT		= #USE_STR_DT#
			     , USE_END_DT		= #USE_END_DT#
			     , USE_STR_HM		= #USE_STR_HM#
			     , USE_END_HM		= #USE_END_HM#
			     , FNL_USR_ID      = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID      = #FNL_MNU_ID#
			     , FNL_MDF_DH      = SYSDATE
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND LCT_RM_NO = #BF_LCT_RM_NO#
		]]>
	</update>
	
	<delete id="CSPSAE306PDeleteMain" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE203D
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND LCT_RM_NO = #LCT_RM_NO#
		]]>  
	</delete>
	
	<select id="CSPSAE307ESelectMain" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT A.LCT_RM_NO
			     , A.LCT_RM_DVSN_CD
			     , B.CD_NM AS LCT_RM_DVSN_NM
			     , A.LCT_RM_NM
			     , A.RCV_NOP_CNT
			     , A.SEAT_NM
			     , A.CHR_DPT_NM
			     , A.CHGR_NM
			     , A.USE_YN
			  FROM TBCSPSAE114C A
			     , TBDCMACM013C B
			 WHERE B.CMM_CD_DVSN_CD = '1000139'
			   AND A.LCT_RM_DVSN_CD = B.CD
		]]>
		<dynamic>
	        <isNotEmpty property="strLctRmDvsn">
 				AND A.LCT_RM_DVSN_CD = #strLctRmDvsn#
	       	</isNotEmpty>
	        <isNotEmpty property="strLctRmNm">
  				AND A.LCT_RM_NM LIKE '%' || #strLctRmNm# || '%'
	       	</isNotEmpty>
	    </dynamic>
       	<![CDATA[
			ORDER BY A.LCT_RM_NO, A.LCT_RM_DVSN_CD, A.LCT_RM_NM, A.RCV_NOP_CNT
       	]]>
	</select>

	<select id="CSPSAE307EMaxLctRmNo" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT MAX(LCT_RM_NO)+1 FROM TBCSPSAE114C
		]]>
	</select>
	
	<insert id="CSPSAE307EInsertMain" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO TBCSPSAE114C 
	 			      ( LCT_RM_NO
	 			      , LCT_RM_DVSN_CD
	 			      , LCT_RM_NM
	 			      , RCV_NOP_CNT
	 			      , SEAT_NM
	 			      , USE_YN
	 			      , CHR_DPT_NM
	 			      , CHGR_NM 
	 			      , FRT_USR_ID
	 			      , FNL_USR_ID
	 			      , FNL_DEAL_DPT_CD
	 			      , FNL_MNU_ID
	 			      , FRT_REGI_DH
	 			      , FNL_MDF_DH
	 			      )
 			      VALUES (
 			            #LCT_RM_NO#
 			          , #LCT_RM_DVSN_CD#
 			          , #LCT_RM_NM# 
 			          , #RCV_NOP_CNT#
	 			      , #SEAT_NM#
	 			      , #USE_YN#
	 			      , #CHR_DPT_NM#
	 			      , #CHGR_NM#
	 			      , #FRT_USR_ID#
	 			      , #FNL_USR_ID#
	 			      , #FNL_DEAL_DPT_CD#
	 			      , #FNL_MNU_ID#
	 			      , SYSDATE
	 			      , SYSDATE
	 			      )
        ]]>
	</insert>
	
	<update id="CSPSAE307EUpdateMain" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE114C
			   SET LCT_RM_DVSN_CD	= #LCT_RM_DVSN_CD#
			     , LCT_RM_NM		= #LCT_RM_NM#
			     , RCV_NOP_CNT		= #RCV_NOP_CNT#
			     , SEAT_NM			= #SEAT_NM#
			     , USE_YN			= #USE_YN#
			     , CHR_DPT_NM		= #CHR_DPT_NM#
			     , CHGR_NM			= #CHGR_NM#
			     , FNL_USR_ID      = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID      = #FNL_MNU_ID#
			     , FNL_MDF_DH      = SYSDATE
			 WHERE LCT_RM_NO = #LCT_RM_NO#
		]]>
	</update>
	
	<select id="CSPSAE307EExistLctRmNo" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT DECODE(NVL(MAX(A.YR), '0'), '0', 'N', MAX(B.LCT_RM_NM)) AS EXIST_YN
			  FROM TBCSPSAE203D A
			     , TBCSPSAE114C B
			 WHERE B.LCT_RM_NO = A.LCT_RM_NO
			   AND A.LCT_RM_NO = #LCT_RM_NO#
		]]>
	</select>
	
	<delete id="CSPSAE307EDeleteMain" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE114C
			 WHERE LCT_RM_NO = #LCT_RM_NO#
		]]>  
	</delete>

	<select id="CSPSAE308ECbbDmt" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT B.CD_NM || '-' || A.RMN_NM || '호'  AS DMT_NM
			     , A.DMT_NO
			     , A.ESN
			  FROM TBCSPSAE115B A
			     , TBDCMACM013C B
			 WHERE B.CMM_CD_DVSN_CD = '1000140'
			   AND A.DMT_DVSN_CD = B.CD
			   AND B.USE_YN = 'Y'
			   AND A.USE_YN = 'Y'
			 ORDER BY A.RMN_NM
		]]>
	</select>
	
	<select id="CSPSAE308ESelectMain" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT A.YR /* CSPSAE308ESelectMain */
			     , A.CRS_CD
			     , A.CRS_CDN
			     , A.SNO
			     , A.TANE_ID
			     , A.NAM
			     , A.SEX_CD
			     , B.ORG_NM
			     , A.RANK_NM
			     , C.DMT_NO
			     , NVL(C.USE_STR_DT, E.EDU_STR_DT) AS USE_STR_DT
			     , NVL(C.USE_END_DT, E.EDU_END_DT) AS USE_END_DT
			     , D.CRS_NM
			     , A.EML_AD
			     , SUBSTR(E.EDU_STR_DT, 0, 4) || '.' || SUBSTR(E.EDU_STR_DT, 5, 2) || '.' || SUBSTR(E.EDU_STR_DT, 7, 2)
			       || ' ~ ' || SUBSTR(E.EDU_END_DT, 0, 4) || '.' || SUBSTR(E.EDU_END_DT, 5, 2) || '.' || SUBSTR(E.EDU_END_DT, 7, 2) AS EDU_DT
			     , A.DPT_NM
			     , A.OW_RM_TNB
			     , REPLACE(A.HPN, '-', '') AS HPN
			     , A.SNDY_LODG_YN
			     , '' AS SMS_MSG
			     , '' AS TNB
			     , F.RMN_NM
			     , F.ESN
			     , NVL(C.USE_YN, 'N') AS USE_YN
			  FROM TBCSPSAE301D A
			     , TBDCMACM015M B
			     , TBCSPSAE401D C
			     , TBCSPSAE103C D
			     , TBCSPSAE201D E
     			 , TBCSPSAE115B F
			     , TBCSPSAE102C G
			     , TBCSPSAE101C H
			 WHERE 1=1
			   AND B.ORG_CD(+)		= A.ORG_CD
			   AND C.YR(+)			= A.YR
			   AND C.CRS_CD(+)		= A.CRS_CD
			   AND C.CRS_CDN(+)		= A.CRS_CDN
			   AND C.TANE_ID(+)		= A.TANE_ID
			   AND D.CRS_CD			= A.CRS_CD
			   AND G.EDU_CAT_CD		= D.EDU_CAT_CD
			   AND G.EDU_DVSN_CD	= D.EDU_DVSN_CD
			   AND H.EDU_DVSN_CD	= G.EDU_DVSN_CD
			   AND E.YR				= A.YR
			   AND E.CRS_CD			= A.CRS_CD
			   AND E.CRS_CDN		= A.CRS_CDN
   			   AND F.DMT_NO(+)	    = C.DMT_NO
   			   AND A.DMT_UE_YN = 'Y'
   			   AND A.YR BETWEEN SUBSTR(#strFromYm#, 0, 4) AND SUBSTR(#strToYm#, 0, 4) 
   			   AND ((E.EDU_STR_DT <= #strFromYm# AND E.EDU_END_DT >= #strFromYm#) 
   			   		OR (E.EDU_STR_DT >= #strFromYm# AND E.EDU_STR_DT <= #strToYm#)
   			    	OR (E.EDU_END_DT >= #strFromYm# AND E.EDU_END_DT <= #strToYm#))
		]]>
		<dynamic>
	        <isNotEmpty property="strYR_CD">
 				 
	       	</isNotEmpty> 
	        <isNotEmpty property="strEDU_DVSN_CD">
  				AND H.EDU_DVSN_CD = #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
  				AND G.EDU_CAT_CD = #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
  				AND A.CRS_CD = #strEDU_CRS_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strCRS_CDN">
 				AND A.CRS_CDN = #strCRS_CDN#
	       	</isNotEmpty>
	        <isNotEmpty property="strSEX_CD">
  				AND A.SEX_CD = #strSEX_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strSNDY_LODG_YN">
  				AND A.SNDY_LODG_YN = #strSNDY_LODG_YN#
	       	</isNotEmpty>
	    </dynamic>
       	<![CDATA[
			ORDER BY A.YR, A.CRS_CD, A.CRS_CDN, A.SNO
       	]]>
	</select>
	
	<select id="CSPSAE308EExistMain1" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT DECODE(COUNT(*), 0, 'N', 'Y') AS EXIST_YN FROM TBCSPSAE401D
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND TANE_ID = #TANE_ID#
		]]>
	</select>

	<insert id="CSPSAE308EInsertMain1" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO TBCSPSAE401D /* CSPSAE308EInsertMain1 */
	 			      ( YR
	 			      , CRS_CD
	 			      , CRS_CDN
	 			      , DMT_NO
	 			      , TANE_ID
	 			      , USE_STR_DT
	 			      , USE_END_DT
	 			      , USE_YN
	 			      , FRT_USR_ID
	 			      , FNL_USR_ID
	 			      , FNL_DEAL_DPT_CD
	 			      , FNL_MNU_ID
	 			      , FRT_REGI_DH
	 			      , FNL_MDF_DH
	 			      )
 			      VALUES (
 			            #YR#
	 			      , #CRS_CD#
	 			      , #CRS_CDN#
	 			      , #DMT_NO#
	 			      , #TANE_ID#
	 			      , #USE_STR_DT#
	 			      , #USE_END_DT#
	 			      , #USE_YN#
	 			      , #FNL_USR_ID#
	 			      , #FNL_USR_ID#
	 			      , #FNL_DEAL_DPT_CD#
	 			      , #FNL_MNU_ID#
	 			      , SYSDATE
	 			      , SYSDATE
	 			      )
        ]]>
	</insert>

	<update id="CSPSAE308EUpdateMain1" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE401D /* CSPSAE308EUpdateMain1 */
			   SET DMT_NO		   = #DMT_NO#
			     , USE_STR_DT	   = #USE_STR_DT#
			     , USE_END_DT	   = #USE_END_DT#
			     , USE_YN		   = #USE_YN#
			     , FNL_USR_ID      = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID      = #FNL_MNU_ID#
			     , FNL_MDF_DH      = SYSDATE
			 WHERE YR		 	   = #YR#
			   AND CRS_CD		   = #CRS_CD#
			   AND CRS_CDN		   = #CRS_CDN#
			   AND TANE_ID		   = #TANE_ID#
		]]>
	</update>

	<update id="CSPSAE308EUpdateMain2" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE301D /* CSPSAE308EUpdateMain2 */
			   SET SNDY_LODG_YN	   = #SNDY_LODG_YN#
			     , FNL_USR_ID      = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID      = #FNL_MNU_ID#
			     , FNL_MDF_DH      = SYSDATE
			 WHERE YR		 	   = #YR#
			   AND CRS_CD		   = #CRS_CD#
			   AND CRS_CDN		   = #CRS_CDN#
			   AND TANE_ID		   = #TANE_ID#
		]]>
	</update>
	
	<delete id="CSPSAE308EDeleteMain1" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE401D /* CSPSAE308EDeleteMain1 */
			 WHERE YR		 	   = #YR#
			   AND CRS_CD		   = #CRS_CD#
			   AND CRS_CDN		   = #CRS_CDN#
			   AND TANE_ID		   = #TANE_ID#
		]]>  
	</delete>
	
	<insert id="CSPSAE308ESendSms" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO MSG_DATA 
	 			      ( MSG_SEQ
	 			      , REQ_DATE
	 			      , CUR_STATE
	 			      , CALL_TO
	 			      , CALL_FROM
	 			      , SMS_TXT
	 			      , MSG_TYPE
	 			      , CONT_SEQ)
 			      VALUES (
 			            MSG_DATA_SEQ.NEXTVAL
 			          , SYSDATE
 			          , 0
 			          , REPLACE(#CALL_TO#, '-')
 			          , REPLACE(#CALL_FROM#, '-')
 			          , ''
 			          ,6
 			          , #CONT_SEQ# )
        ]]>
	</insert>

	<select id="CSPSAE309ESelectMain" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT A.DMT_NO
			     , A.DMT_DVSN_CD
			     , A.RMN_NM
			     , A.RCV_NOP_CNT
			     , A.SEAT_NM
			     , A.CHR_DPT_NM
			     , A.CHGR_NM
			     , A.USE_PPS_TXT
			     , A.ESN
			     , A.USE_YN
			     , A.RMK
			  FROM TBCSPSAE115B A
			 WHERE 1=1
		]]>
		<dynamic>
	        <isNotEmpty property="strDmtDvsn">
 				 AND A.DMT_DVSN_CD = #strDmtDvsn#
	       	</isNotEmpty>
	        <isNotEmpty property="strUseYn">
  				 AND A.USE_YN = #strUseYn#
	       	</isNotEmpty>
	    </dynamic>
       	<![CDATA[
			ORDER BY TO_NUMBER(A.RMN_NM) 
       	]]>
	</select>
	
	<select id="CSPSAE309EMAXDmtNo" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT MAX(DMT_NO)+1 AS DMT_NO FROM TBCSPSAE115B
		]]>
	</select>
	
	<insert id="CSPSAE309EInsertMain" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO TBCSPSAE115B 
	 			      ( DMT_NO
				      , DMT_DVSN_CD
				      , SEAT_NM
				      , RMN_NM
				      , RCV_NOP_CNT
				      , CHR_DPT_NM
				      , CHGR_NM
				      , USE_PPS_TXT
				      , ESN
				      , USE_YN
				      , RMK
	 			      , FRT_USR_ID
	 			      , FNL_USR_ID
	 			      , FNL_DEAL_DPT_CD
	 			      , FNL_MNU_ID
	 			      , FRT_REGI_DH
	 			      , FNL_MDF_DH
	 			      )
 			      VALUES (
 			            #DMT_NO#
 			          , #DMT_DVSN_CD#
				      , #SEAT_NM#
				      , #RMN_NM#
				      , #RCV_NOP_CNT#
				      , #CHR_DPT_NM#
				      , #CHGR_NM#
				      , #USE_PPS_TXT#
				      , #ESN#
				      , #USE_YN#
				      , #RMK#
	 			      , #FRT_USR_ID#
	 			      , #FNL_USR_ID#
	 			      , #FNL_DEAL_DPT_CD#
	 			      , #FNL_MNU_ID#
	 			      , SYSDATE
	 			      , SYSDATE
	 			      )
        ]]>
	</insert>
	
	<update id="CSPSAE309EUpdateMain" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE115B
			   SET DMT_DVSN_CD = #DMT_DVSN_CD#
     			 , RMN_NM      = #RMN_NM#
     			 , RCV_NOP_CNT = #RCV_NOP_CNT#
     			 , SEAT_NM     = #SEAT_NM#
     			 , CHR_DPT_NM  = #CHR_DPT_NM#
     			 , CHGR_NM     = #CHGR_NM#
     			 , USE_PPS_TXT = #USE_PPS_TXT#
     			 , ESN     	   = #ESN#
     			 , USE_YN      = #USE_YN#
     			 , RMK         = #RMK#
			     , FNL_USR_ID      = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				 , FNL_MNU_ID      = #FNL_MNU_ID#
			     , FNL_MDF_DH      = SYSDATE
			 WHERE DMT_NO = #DMT_NO#
		]]>
	</update>
	
	<select id="CSPSAE309EExistDmtNo" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT DECODE(NVL(MAX(A.YR), '0'), '0', 'N', MAX(B.RMN_NM)) AS EXIST_YN
			  FROM TBCSPSAE401D A
			     , TBCSPSAE115B B
			 WHERE B.DMT_NO = A.DMT_NO
			   AND A.DMT_NO = #DMT_NO#
		]]>
	</select>
	
	<delete id="CSPSAE309EDeleteMain" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE115B
			 WHERE DMT_NO = #DMT_NO#
		]]>  
	</delete>
	
	<select id="CSPSAE301EExcel1" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	(CASE
						WHEN C.CRS_CD = '057' THEN D.EDU_CAT_NM || '(' || C.CRS_NM || ')'
						ELSE C.CRS_NM
					END) AS CRS_NM
					, B.CRS_CDN
					, SUBSTR(TO_CHAR(SYSDATE, 'YYYYMMDD'), 0, 4) || '. ' || SUBSTR(TO_CHAR(SYSDATE, 'YYYYMMDD'), 5, 2) || '. ' || SUBSTR(TO_CHAR(SYSDATE, 'YYYYMMDD'), 7, 2) AS TODAY
					, A.EAN
					, (CASE 
						WHEN C.CRS_CD = '063' OR C.CRS_CD = '082' THEN '기본-'
						WHEN C.CRS_CD = '069' THEN '관리-'
						WHEN C.CRS_CD = '064' OR C.CRS_CD = '065' OR C.CRS_CD = '066' OR C.CRS_CD = '109' THEN '전문-'
						WHEN C.CRS_CD = '046' THEN '監事-'
						WHEN C.CRS_CD = '045' OR C.CRS_CD = '049' OR C.CRS_CD = '054' OR C.CRS_CD = '057' OR C.CRS_CD = '125' OR C.CRS_CD = '126' THEN '제'
						ELSE '기본-'
					END) AS CRS_GUBUN
			FROM	TBCSPSAE201M A
					, TBCSPSAE201D B
					, TBCSPSAE103C C
					, TBCSPSAE102C D
			WHERE	B.YR = A.YR
			AND		B.CRS_CD = A.CRS_CD
			AND		C.CRS_CD = A.CRS_CD
			AND		C.EDU_DVSN_CD = D.EDU_DVSN_CD
			AND		C.EDU_CAT_CD = D.EDU_CAT_CD
			AND		A.YR = SUBSTR(#strFromYm#, 0, 4)
			AND		A.CRS_CD = #strEDU_CRS_CD#
			AND		B.CRS_CDN = #strCRS_CDN#
		]]>
	</select>
	
	<select id="CSPSAE301EExcel2" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	'환불' AS DVSN_NM /* CSPSAE301EExcel2 */
					, A.SNO || ' ' || A.NAM AS NAM
					, (A.EDU_EXS + A.DMT_EXS + A.FDEX) AS TOT_AMT
					, A.PD_AMT
					, (A.UNP_AMT) AS UNP_AMT
					, '환불 ' AS RMK
			FROM	TBCSPSAE301D A
			WHERE	A.YR = SUBSTR(#strFromYm#, 0, 4)
			AND		A.CRS_CD = #strEDU_CRS_CD#
			AND		A.CRS_CDN = #strCRS_CDN#
			AND		A.UNP_AMT > 0 
			ORDER BY A.SNO
		]]>
	</select>
	
	<select id="CSPSAE301EExcel3" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	'미납' AS DVSN_NM /* CSPSAE301EExcel3 */
					, A.SNO || ' ' || A.NAM AS NAM
				    , NVL( (SELECT (Z.EDU_EXS*F.EDU_DAY) + (Z.DMT_EXS* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0))) + 
			     								DECODE(A.DMT_UE_YN, 'Y', Z.BRKF_FDEX*(F.EDU_DAY-1) + Z.LUNCH_FDEX*(F.EDU_DAY) +Z.DINR_FDEX*(F.EDU_DAY-1), Z.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정_천은정감사관 */
			                                       FROM TBCSPSAE113B Z
			                                      WHERE Z.CRS_CD = A.CRS_CD
				                                        AND APC_DT = (SELECT MAX(APC_DT)
				                                                        FROM TBCSPSAE113B X
				                                                       WHERE X.CRS_CD = Z.CRS_CD
				                                                       AND X.APC_DT < F.EDU_STR_DT)
				                                     ), (SELECT (Y.EDU_EXS*F.EDU_DAY) + (Y.DMT_EXS* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0))) + 
				                                      DECODE(A.DMT_UE_YN, 'Y', Y.BRKF_FDEX*(F.EDU_DAY-1) + Y.LUNCH_FDEX*(F.EDU_DAY) +Y.DINR_FDEX*(F.EDU_DAY-1), Y.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정_천은정감사관 */
			                                       FROM TBCSPSAE113B Y
			                                      WHERE Y.CRS_CD = '000'
				                                        AND APC_DT = (SELECT MAX(APC_DT)
				                                                        FROM TBCSPSAE113B X
				                                                       WHERE X.CRS_CD = '000'
				                                                       AND X.APC_DT < F.EDU_STR_DT)
				                                       )
				       ) AS TOT_AMT
			     , NVL(A.PD_AMT, 0) AS PD_AMT
				 , DECODE(NVL(A.UNP_AMT, 0), 0, (NVL(A.PD_AMT, 0) - NVL( (SELECT (Z.EDU_EXS*F.EDU_DAY) + (Z.DMT_EXS* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0))) + 
						     								DECODE(A.DMT_UE_YN, 'Y', Z.BRKF_FDEX*(F.EDU_DAY-1) + Z.LUNCH_FDEX*(F.EDU_DAY) +Z.DINR_FDEX*(F.EDU_DAY-1), Z.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정_천은정감사관 */
						                                       FROM TBCSPSAE113B Z
						                                      WHERE Z.CRS_CD = A.CRS_CD
			 			                                        AND APC_DT = (SELECT MAX(APC_DT)
			 			                                                        FROM TBCSPSAE113B X
			 			                                                       WHERE X.CRS_CD = Z.CRS_CD
			 			                                                       AND X.APC_DT < F.EDU_STR_DT)
			 			                                     ), (SELECT (Y.EDU_EXS*F.EDU_DAY) + (Y.DMT_EXS* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0))) + 
			 			                                      DECODE(A.DMT_UE_YN, 'Y', Y.BRKF_FDEX*(F.EDU_DAY-1) + Y.LUNCH_FDEX*(F.EDU_DAY) +Y.DINR_FDEX*(F.EDU_DAY-1), Y.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정_천은정감사관 */
						                                       FROM TBCSPSAE113B Y
						                                      WHERE Y.CRS_CD = '000'
			 			                                        AND APC_DT = (SELECT MAX(APC_DT)
			 			                                                        FROM TBCSPSAE113B X
			 			                                                       WHERE X.CRS_CD = '000'
			 			                                                       AND X.APC_DT < F.EDU_STR_DT)
			 			                                       )
			 			       )), A.UNP_AMT) AS UNP_AMT
					, '' AS RMK
			FROM	TBCSPSAE301D A
				     , (SELECT TO_DATE(EDU_END_DT, 'YYYYMMDD')+1 - TO_DATE(EDU_STR_DT, 'YYYYMMDD') AS EDU_DAY
			                 , CEIL((TO_DATE(EDU_END_DT, 'YYYYMMDD') - NEXT_DAY(TO_DATE(EDU_STR_DT, 'YYYYMMDD') -1, '6') +1)/7) AS FRIDY_DCN /* 20240613 교육과정 점심식비에 금요일 미포함 계산식 조정으로 추가 */
			                 , YR
			                 , CRS_CD
			                 , CRS_CDN
			                 , EDU_STR_DT
			                 , EDU_END_DT
			             FROM TBCSPSAE201D) F
			WHERE	F.YR	= A.YR
			AND		F.CRS_CD = A.CRS_CD
			AND 	F.CRS_CDN = A.CRS_CDN
			AND		A.YR = SUBSTR(#strFromYm#, 0, 4)
			AND		A.CRS_CD = #strEDU_CRS_CD#
			AND		A.CRS_CDN = #strCRS_CDN#
    		AND (A.PD_YN = 'N' OR A.UNP_AMT < 0)
    		AND A.PD_MEAN_CD IS NOT NULL /* 취소자 구분 */
			ORDER BY A.SNO
		]]>
	</select>
	
	<select id="CSPSAE301EExcel4" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			WITH DATA AS ( /* CSPSAE301EExcel4 */
			SELECT A.EDU_EXS
			       , A.DMT_EXS
			       , A.BRKF_FDEX
			       , A.LUNCH_FDEX
			       , A.DINR_FDEX
			  FROM TBCSPSAE113B A
			  WHERE A.APC_DT = (SELECT NVL(MAX(B.APC_DT), (SELECT MAX(APC_DT) FROM TBCSPSAE113B WHERE CRS_CD = '000' AND APC_DT < (SELECT EDU_STR_DT FROM TBCSPSAE201D WHERE YR = SUBSTR(#strFromYm#, 0, 4) AND CRS_CD = #strEDU_CRS_CD# AND CRS_CDN = #strCRS_CDN#))) AS APC_DT
								  FROM TBCSPSAE201D A
								     , TBCSPSAE113B B
								  WHERE B.APC_DT < A.EDU_STR_DT
								    AND A.CRS_CD = B.CRS_CD /* 150520  교육과정이 전체가 아니면 그 교육과정에 대한 금액을 들고가도록 변경 */
								   	AND A.YR			= SUBSTR(#strFromYm#, 0, 4)
						  			AND A.CRS_CD		= #strEDU_CRS_CD#
								  	AND A.CRS_CDN		= #strCRS_CDN#
				  				)			
				AND A.CRS_CD =  NVL((SELECT A.CRS_CD
								  FROM TBCSPSAE201D A
								     , TBCSPSAE113B B
								  WHERE B.APC_DT < A.EDU_STR_DT
								    AND A.CRS_CD = B.CRS_CD /* 150520  교육과정이 전체가 아니면 그 교육과정에 대한 금액을 들고가도록 변경 */
								   	AND A.YR			= SUBSTR(#strFromYm#, 0, 4)
						  			AND A.CRS_CD		= #strEDU_CRS_CD#
								  	AND A.CRS_CDN		= #strCRS_CDN#
								  	GROUP BY A.CRS_CD
				  				),'000')
			)
			
			 SELECT SUBSTR(B.EDU_STR_DT, 0, 4) || '. ' || SUBSTR(B.EDU_STR_DT, 5, 2) || '. ' || SUBSTR(B.EDU_STR_DT, 7, 2) ||
			 		' ~ ' || SUBSTR(B.EDU_END_DT, 0, 4) || '. ' || SUBSTR(B.EDU_END_DT, 5, 2) || '. ' || SUBSTR(B.EDU_END_DT, 7, 2) AS EDU_DT
			 		, A.EDU_PRD_TXT
			 		, COUNT(C.TANE_ID) AS TANE_CNT
			 		, MAX(D.DMT_UE_CNT) AS DMT_UE_CNT
			 		, MAX(E.SNDY_CNT) AS SNDY_CNT
			 		, NVL(SUM(C.PD_AMT),0) AS TOT_AMT
			 		, (SELECT EDU_EXS FROM DATA) AS EDU_EXS
			 		, (SELECT DMT_EXS FROM DATA) AS DMT_EXS
			 		, (SELECT BRKF_FDEX FROM DATA) AS BRKF_FDEX
			 		, (SELECT LUNCH_FDEX FROM DATA) AS LUNCH_FDEX
			 		, (SELECT DINR_FDEX FROM DATA) AS DINR_FDEX
			 		, NVL(SUM(C.EDU_EXS),0) AS TOT_EDU_EXS
			 		, NVL(SUM(C.DMT_EXS),0) AS TOT_DMT_EXS
			 		, NVL(SUM(C.FDEX),0) AS TOT_FDEX
			 		, (TO_NUMBER(A.EDU_PRD_TXT)-1) * (SELECT BRKF_FDEX FROM DATA) * (MAX(D.DMT_UE_CNT)) AS TOT_BRKF_FDEX
			 		, (TO_NUMBER(A.EDU_PRD_TXT)) * (SELECT LUNCH_FDEX FROM DATA) * COUNT(C.TANE_ID) AS TOT_LUNCH_FDEX /* 20240613 교육과정 점심식비에 금요일 미포함 계산식 조정으로 추가 -> 20250312 감사교육 금요일 점심식비 추가에 따른 수정_천은정감사관*/
			 		, (TO_NUMBER(A.EDU_PRD_TXT)-1) * (SELECT DINR_FDEX FROM DATA) * (MAX(D.DMT_UE_CNT)) AS TOT_DINR_FDEX
			 		, NVL(MAX(F.PAYBACK), 0) AS PAYBACK
			 		, NVL(MAX(G.RMK_SBJ), '없음') AS RMK_SBJ
			 		, SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'), 0, 4) || '. ' || SUBSTR(TO_CHAR(SYSDATE, 'YYYYMM'), 5, 2) AS TODAY
			 		, (SELECT USR_NAM FROM TBDCMACM001M WHERE CNB = #CNB#) AS USR_NAM
			 		, (SELECT DPT_NM FROM TBDCMACM002M WHERE DPT_CD = (SELECT DPT_CD FROM TBDCMACM001M WHERE CNB = #CNB#)) AS DPT_NM
			 		, MAX(H.FRIDY_DCN) AS FRIDY_DCN /* 20240613 교육과정 점심식비에 금요일 미포함 계산식 조정으로 추가 */
			   FROM TBCSPSAE201M A,
			        TBCSPSAE201D B,
			        TBCSPSAE301D C,
			        (SELECT COUNT(TANE_ID) AS DMT_UE_CNT FROM TBCSPSAE301D
					WHERE YR = SUBSTR(#strFromYm#, 0, 4)
					AND CRS_CD = #strEDU_CRS_CD#
					AND CRS_CDN = #strCRS_CDN#
					AND DMT_UE_YN = 'Y'
					) D,
					(SELECT COUNT(TANE_ID) AS SNDY_CNT FROM TBCSPSAE301D
					WHERE YR = SUBSTR(#strFromYm#, 0, 4)
					AND CRS_CD = #strEDU_CRS_CD#
					AND CRS_CDN = #strCRS_CDN#
					AND SNDY_LODG_YN = 'Y'
					) E,
					(SELECT SUM(UNP_AMT) AS PAYBACK FROM TBCSPSAE301D
					WHERE YR = SUBSTR(#strFromYm#, 0, 4)
					AND CRS_CD = #strEDU_CRS_CD#
					AND CRS_CDN = #strCRS_CDN#
					AND UNP_AMT > 0) F,
					(SELECT DISTINCT RMK_SBJ FROM TBCSPSAE113B) G,
					(SELECT CEIL((TO_DATE(EDU_END_DT, 'YYYYMMDD') - NEXT_DAY(TO_DATE(EDU_STR_DT, 'YYYYMMDD') -1, '6') +1)/7) AS FRIDY_DCN
					FROM TBCSPSAE201D
					WHERE YR = SUBSTR(#strFromYm#, 0, 4)
					AND CRS_CD = #strEDU_CRS_CD#
					AND CRS_CDN = #strCRS_CDN#
					) H /* 20240613 교육과정 점심식비에 금요일 미포함 계산식 조정으로 추가 */
			  WHERE B.YR = A.YR
			    AND B.CRS_CD = A.CRS_CD
			    AND C.YR = A.YR
			    AND C.CRS_CD = A.CRS_CD
			    AND C.CRS_CDN = B.CRS_CDN
			    AND A.YR = SUBSTR(#strFromYm#, 0, 4)
			    AND A.CRS_CD = #strEDU_CRS_CD#
			    AND B.CRS_CDN = #strCRS_CDN#
			GROUP BY B.EDU_STR_DT, B.EDU_END_DT, A.EDU_PRD_TXT
		]]>
	</select>
	
	<select id="CSPSAE312PCrsCdList" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	DISTINCT /* CSPSAE312PCrsCdList */
	       			A.YR
	       			, A.CRS_CD
	       			, A.CRS_CDN
	       			, B.CRS_NM
	       FROM		TBCSPSAE201D A
	       			, TBCSPSAE103C B
	       			, TBCSPSAE301D C
	       WHERE	A.CRS_CD = B.CRS_CD
	       AND		A.YR = C.YR
	       AND		A.CRS_CD = C.CRS_CD
	       AND		A.CRS_CDN = C.CRS_CDN
	       AND		((A.EDU_STR_DT <= #strFromDt# AND A.EDU_END_DT >= #strFromDt#) 
	       			OR (A.EDU_STR_DT >= #strFromDt# AND A.EDU_STR_DT <= #strToDt#)
   					OR (A.EDU_END_DT >= #strFromDt# AND A.EDU_END_DT <= #strToDt#) )
	       ORDER BY A.YR, A.CRS_CD, A.CRS_CDN
		]]>
	</select>
	
	<select id="CSPSAE312PSndyLodgList" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			WITH USE_INFO AS ( /* CSPSAE312PSndyLodgList */
				SELECT	C.NAM AS USR_NAM
						, A.USE_YN
						, D.CRS_NM
						, A.USE_STR_DT
						, A.USE_END_DT
						, B.RMN_NM
				FROM	TBCSPSAE401D A
						, TBCSPSAE115B B
						, TBCSPSAE301D C
						, TBCSPSAE103C D
				WHERE	B.DMT_NO = A.DMT_NO
				AND		C.YR = A.YR
				AND		C.CRS_CD = A.CRS_CD
				AND		C.CRS_CDN = A.CRS_CDN
				AND		C.TANE_ID = A.TANE_ID
				AND		D.CRS_CD = A.CRS_CD
				AND		C.SNDY_LODG_YN = 'Y'
				AND		A.YR = #YR#
				AND		A.CRS_CD = #CRS_CD#
				AND		A.CRS_CDN = #CRS_CDN#
			)
			
			SELECT A.FLOOR2
			     , DECODE((SELECT USE_YN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR2), 'N', '미사용', 
				     (SELECT AGGR_CONCAT(USR_NAM, ', ') FROM USE_INFO WHERE A.FLOOR2 IN RMN_NM)) AS USE_NAM_2
			     , (SELECT MAX(CRS_NM) FROM USE_INFO WHERE A.FLOOR2 IN RMN_NM) || CHR(10) ||
			     (SELECT DECODE(MIN(USE_STR_DT), NULL, '', '(' || SUBSTR(MIN(USE_STR_DT), 5, 2) || '.' || SUBSTR(MIN(USE_STR_DT), 7, 2) || '~' ||
			        SUBSTR(MAX(USE_END_DT), 5, 2) || '.' || SUBSTR(MAX(USE_END_DT), 7, 2) || ')') FROM USE_INFO WHERE A.FLOOR2 IN RMN_NM) AS USE_DT_2
			     , A.FLOOR3
			     , DECODE((SELECT USE_YN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR3), 'N', '미사용', 
			     	(SELECT AGGR_CONCAT(USR_NAM, ', ') FROM USE_INFO WHERE A.FLOOR3 IN RMN_NM)) AS USE_NAM_3
			     , (SELECT MAX(CRS_NM) FROM USE_INFO WHERE A.FLOOR3 IN RMN_NM) || CHR(10) ||
				   (SELECT DECODE(MIN(USE_STR_DT), NULL, '', '(' || SUBSTR(MIN(USE_STR_DT), 5, 2) || '.' || SUBSTR(MIN(USE_STR_DT), 7, 2) || '~' ||
			       SUBSTR(MAX(USE_END_DT), 5, 2) || '.' || SUBSTR(MAX(USE_END_DT), 7, 2) || ')') FROM USE_INFO WHERE A.FLOOR3 IN RMN_NM) AS USE_DT_3
			     , A.FLOOR4
			     , DECODE((SELECT USE_YN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR4), 'N', '미사용', 
			       (SELECT AGGR_CONCAT(USR_NAM, ', ') FROM USE_INFO WHERE A.FLOOR4 IN RMN_NM)) AS USE_NAM_4
			     , (SELECT MAX(CRS_NM) FROM USE_INFO WHERE A.FLOOR4 IN RMN_NM) || CHR(10) ||
			       (SELECT DECODE(MIN(USE_STR_DT), NULL, '', '(' || SUBSTR(MIN(USE_STR_DT), 5, 2) || '.' || SUBSTR(MIN(USE_STR_DT), 7, 2) || '~' ||
			       SUBSTR(MAX(USE_END_DT), 5, 2) || '.' || SUBSTR(MAX(USE_END_DT), 7, 2) || ')') FROM USE_INFO WHERE A.FLOOR4 IN RMN_NM) AS USE_DT_4
			  FROM (
					SELECT ROW_NO
					     , MIN(DECODE(SEAT_NM, '2층', RMN_NM)) FLOOR2
					     , MIN(DECODE(SEAT_NM, '3층', RMN_NM)) FLOOR3
					     , MIN(DECODE(SEAT_NM, '4층', RMN_NM)) FLOOR4
					  FROM (
					        SELECT ROW_NUMBER() OVER (PARTITION BY SEAT_NM ORDER BY RMN_NM) ROW_NO
					             , SEAT_NM
					             , RMN_NM
					        FROM TBCSPSAE115B
					        ORDER BY RMN_NM
					        )
					  GROUP BY ROW_NO
			       ) A
			  ORDER BY A.FLOOR2
		]]>
	</select>
	
	<select id="CSPSAE312PUseList" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			WITH USE_INFO AS ( /* CSPSAE312PUseList */
				SELECT	C.NAM AS USR_NAM
						, A.USE_YN
						, D.CRS_NM
						, A.USE_STR_DT
						, A.USE_END_DT
						, B.RMN_NM
				FROM	TBCSPSAE401D A
						, TBCSPSAE115B B
						, TBCSPSAE301D C
						, TBCSPSAE103C D
				WHERE	B.DMT_NO = A.DMT_NO
				AND		C.YR = A.YR
				AND		C.CRS_CD = A.CRS_CD
				AND		C.CRS_CDN = A.CRS_CDN
				AND		C.TANE_ID = A.TANE_ID
				AND		D.CRS_CD = A.CRS_CD
				AND		((A.USE_STR_DT <= #strFromDt# AND A.USE_END_DT >= #strFromDt#) 
						OR (A.USE_STR_DT >= #strFromDt# AND A.USE_STR_DT <= #strToDt#)
   			    		OR (A.USE_END_DT >= #strFromDt# AND A.USE_END_DT <= #strToDt#))
				
			)
			
			SELECT A.FLOOR2
			     , DECODE((SELECT USE_YN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR2), 'N', '미사용', 
				     (SELECT AGGR_CONCAT(USR_NAM, ', ') FROM USE_INFO WHERE A.FLOOR2 IN RMN_NM)) AS USE_NAM_2
			     , (SELECT MAX(CRS_NM) FROM USE_INFO WHERE A.FLOOR2 IN RMN_NM) || CHR(10) ||
			     (SELECT DECODE(MIN(USE_STR_DT), NULL, '', '(' || SUBSTR(MIN(USE_STR_DT), 5, 2) || '.' || SUBSTR(MIN(USE_STR_DT), 7, 2) || '~' ||
			        SUBSTR(MAX(USE_END_DT), 5, 2) || '.' || SUBSTR(MAX(USE_END_DT), 7, 2) || ')') FROM USE_INFO WHERE A.FLOOR2 IN RMN_NM) AS USE_DT_2
			     , A.FLOOR3
			     , DECODE((SELECT USE_YN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR3), 'N', '미사용', 
			     	(SELECT AGGR_CONCAT(USR_NAM, ', ') FROM USE_INFO WHERE A.FLOOR3 IN RMN_NM)) AS USE_NAM_3
			     , (SELECT MAX(CRS_NM) FROM USE_INFO WHERE A.FLOOR3 IN RMN_NM) || CHR(10) ||
				   (SELECT DECODE(MIN(USE_STR_DT), NULL, '', '(' || SUBSTR(MIN(USE_STR_DT), 5, 2) || '.' || SUBSTR(MIN(USE_STR_DT), 7, 2) || '~' ||
			       SUBSTR(MAX(USE_END_DT), 5, 2) || '.' || SUBSTR(MAX(USE_END_DT), 7, 2) || ')') FROM USE_INFO WHERE A.FLOOR3 IN RMN_NM) AS USE_DT_3
			     , A.FLOOR4
			     , DECODE((SELECT USE_YN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR4), 'N', '미사용', 
			       (SELECT AGGR_CONCAT(USR_NAM, ', ') FROM USE_INFO WHERE A.FLOOR4 IN RMN_NM)) AS USE_NAM_4
			     , (SELECT MAX(CRS_NM) FROM USE_INFO WHERE A.FLOOR4 IN RMN_NM) || CHR(10) ||
			       (SELECT DECODE(MIN(USE_STR_DT), NULL, '', '(' || SUBSTR(MIN(USE_STR_DT), 5, 2) || '.' || SUBSTR(MIN(USE_STR_DT), 7, 2) || '~' ||
			       SUBSTR(MAX(USE_END_DT), 5, 2) || '.' || SUBSTR(MAX(USE_END_DT), 7, 2) || ')') FROM USE_INFO WHERE A.FLOOR4 IN RMN_NM) AS USE_DT_4
			  FROM (
					SELECT ROW_NO
					     , MIN(DECODE(SEAT_NM, '2층', RMN_NM)) FLOOR2
					     , MIN(DECODE(SEAT_NM, '3층', RMN_NM)) FLOOR3
					     , MIN(DECODE(SEAT_NM, '4층', RMN_NM)) FLOOR4
					  FROM (
					        SELECT ROW_NUMBER() OVER (PARTITION BY SEAT_NM ORDER BY RMN_NM) ROW_NO
					             , SEAT_NM
					             , RMN_NM
					        FROM TBCSPSAE115B
					        ORDER BY RMN_NM
					        )
					  GROUP BY ROW_NO
			       ) A
			  ORDER BY A.FLOOR2
		]]>
	</select>
	
	<select id="CSPSAE312PByCrsCdList" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			WITH USE_INFO AS (
				SELECT	C.NAM AS USR_NAM
						, A.USE_YN
						, D.CRS_NM
						, A.USE_STR_DT
						, A.USE_END_DT
						, B.RMN_NM
				FROM	TBCSPSAE401D A
						, TBCSPSAE115B B
						, TBCSPSAE301D C
						, TBCSPSAE103C D
				WHERE	B.DMT_NO = A.DMT_NO
				AND		C.YR = A.YR
				AND		C.CRS_CD = A.CRS_CD
				AND		C.CRS_CDN = A.CRS_CDN
				AND		C.TANE_ID = A.TANE_ID
				AND		D.CRS_CD = A.CRS_CD
				AND		A.YR = #YR#
				AND		A.CRS_CD = #CRS_CD#
				AND		A.CRS_CDN = #CRS_CDN#
			)
			
			SELECT A.FLOOR2
			     , DECODE((SELECT USE_YN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR2), 'N', '미사용', 
				     (SELECT AGGR_CONCAT(USR_NAM, ', ') FROM USE_INFO WHERE A.FLOOR2 IN RMN_NM)) AS USE_NAM_2
			     , DECODE ( (SELECT MAX(USR_NAM) FROM USE_INFO WHERE A.FLOOR2 = RMN_NM) , NULL, '', (SELECT ESN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR2)) AS ESN_2
			     , A.FLOOR3
			     , DECODE((SELECT USE_YN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR3), 'N', '미사용', 
			     	(SELECT AGGR_CONCAT(USR_NAM, ', ') FROM USE_INFO WHERE A.FLOOR3 IN RMN_NM)) AS USE_NAM_3
			     , DECODE ( (SELECT MAX(USR_NAM) FROM USE_INFO WHERE A.FLOOR3 = RMN_NM) , NULL, '', (SELECT ESN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR3)) AS ESN_3
			     , A.FLOOR4
			     , DECODE((SELECT USE_YN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR4), 'N', '미사용', 
			       (SELECT AGGR_CONCAT(USR_NAM, ', ') FROM USE_INFO WHERE A.FLOOR4 IN RMN_NM)) AS USE_NAM_4
			     , DECODE ( (SELECT MAX(USR_NAM) FROM USE_INFO WHERE A.FLOOR4 = RMN_NM) , NULL, '', (SELECT ESN FROM TBCSPSAE115B WHERE RMN_NM = A.FLOOR4)) AS ESN_4
			  FROM (
					SELECT ROW_NO
					     , MIN(DECODE(SEAT_NM, '2층', RMN_NM)) FLOOR2
					     , MIN(DECODE(SEAT_NM, '3층', RMN_NM)) FLOOR3
					     , MIN(DECODE(SEAT_NM, '4층', RMN_NM)) FLOOR4
					  FROM (
					        SELECT ROW_NUMBER() OVER (PARTITION BY SEAT_NM ORDER BY RMN_NM) ROW_NO
					             , SEAT_NM
					             , RMN_NM
					        FROM TBCSPSAE115B
					        ORDER BY RMN_NM
					        )
					  GROUP BY ROW_NO
			       ) A
			  ORDER BY A.FLOOR2
		]]>
	</select>
	
	<select id="CSPSAE301EMainListExcel" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.YR /* CSPSAE301EMainListExcel */
				 , A.CRS_CD
				 , A.CRS_NM
				 , A.CRS_CDN
				 , A.SNO
				 , CAST(A.SNO AS VARCHAR(10)) AS SNO2
				 , A.TANE_ID
				 , A.NAM
				 , A.ORG_CD
				 , A.ORG_NM
				 , A.RANK_NM
				 , TRIM(TO_CHAR(A.EDU_EXS, '999,999,999,999')) AS EDU_EXS
				 , TRIM(TO_CHAR(A.DMT_EXS, '999,999,999,999')) AS DMT_EXS
				 , TRIM(TO_CHAR(A.FDEX, '999,999,999,999')) AS FDEX
				 , TRIM(TO_CHAR((A.EDU_EXS + A.DMT_EXS + A.FDEX), '999,999,999,999')) AS TOT_AMT
				 , TRIM(TO_CHAR(A.PD_AMT, '999,999,999,999')) AS PD_AMT
				 , TRIM(TO_CHAR((A.PD_AMT - (A.EDU_EXS + A.DMT_EXS + A.FDEX)), '999,999,999,999')) AS UNP_AMT
				 , A.PD_MEAN_CD
				 , DECODE(A.PD_MEAN_CD, 1, '은행', '현금') AS PD_MEAN_NM
			     , A.PD_YN
			     , DECODE(A.PD_YN, 'Y', '납부', '미납') AS PD_YN_NM
			     , A.EDU_DVSN_NM
			     , A.EDU_CAT_NM
				 , A.DMT_UE_YN
				 , A.BUS_UE_YN
				 , A.SEX_CD
			     , A.PD_DT
			     , A.HPN
			     , A.PD_SMS_SEN_DT
			     , A.UNP_SMS_SEN_DT
			     , A.EDU_DT
			     , A.EAN
			FROM (
				SELECT A.YR
					 , B.EDU_DVSN_CD
	 		     	 , C.EDU_CAT_CD
				     , A.CRS_CD
				     , D.CRS_NM
				     , A.CRS_CDN
				     , A.SNO
				     , A.TANE_ID
				     , A.NAM
				     , A.ORG_CD
				     , E.ORG_NM
				     , A.RANK_NM
				      , DECODE(NVL(A.EDU_EXS, 0), 0, NVL( (SELECT Z.EDU_EXS 
				                                       FROM TBCSPSAE113B Z
				                                      WHERE Z.CRS_CD = A.CRS_CD
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = Z.CRS_CD
	 			                                                       AND X.APC_DT < F.EDU_STR_DT)
	 			                                     )* F.EDU_DAY,
	 			                                      (SELECT Y.EDU_EXS 
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   	  		      FROM TBCSPSAE113B
																	     WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )* F.EDU_DAY
	 			       ), A.EDU_EXS) AS EDU_EXS
				     , DECODE(NVL(A.DMT_EXS, 0), 0, NVL( (SELECT Z.DMT_EXS 
				                                       FROM TBCSPSAE113B Z
				                                      WHERE Z.CRS_CD = A.CRS_CD
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = Z.CRS_CD
	 			                                                       AND X.APC_DT < F.EDU_STR_DT)
	 			                                     )* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0)),
	 			                                    (SELECT Y.DMT_EXS 
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   	  		      FROM TBCSPSAE113B
																	     WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0))
	 			       ), A.DMT_EXS) AS DMT_EXS
					  , DECODE(NVL(A.FDEX, 0), 0, NVL( (SELECT DECODE(A.DMT_UE_YN, 'Y', Z.BRKF_FDEX*(F.EDU_DAY-1) + Z.LUNCH_FDEX*(F.EDU_DAY) +Z.DINR_FDEX*(F.EDU_DAY-1)
				                                                                    , Z.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정 _천은정감사관*/
				                                       FROM TBCSPSAE113B Z
				                                      WHERE Z.CRS_CD = A.CRS_CD
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = Z.CRS_CD
	 			                                                       AND X.APC_DT < F.EDU_STR_DT)
	 			                                     ), (SELECT DECODE(A.DMT_UE_YN, 'Y', Y.BRKF_FDEX*(F.EDU_DAY-1) + Y.LUNCH_FDEX*(F.EDU_DAY) +Y.DINR_FDEX*(F.EDU_DAY-1)
	 			                                                                       , Y.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정 _천은정감사관*/
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
																		  FROM TBCSPSAE113B
																		 WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )), (SELECT DECODE(A.DMT_UE_YN, 'Y', Y.BRKF_FDEX*(F.EDU_DAY-1) + Y.LUNCH_FDEX*(F.EDU_DAY) +Y.DINR_FDEX*(F.EDU_DAY-1)
	 			                                                                       , Y.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정 _천은정감사관*/
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   				  FROM TBCSPSAE113B
																		  WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )) AS FDEX
				     , NVL(A.PD_AMT, 0) AS PD_AMT
				     , A.PD_MEAN_CD
				     , A.PD_YN
				     , B.EDU_DVSN_NM
				     , C.EDU_CAT_NM
				     , DECODE(A.SNDY_LODG_YN, 'Y', '전일입교', DECODE(A.DMT_UE_YN, 'Y', '숙박', '비숙박')) AS DMT_UE_YN
				     , A.BUS_UE_YN
				     , DECODE(A.SEX_CD, 1, '남', DECODE(A.SEX_CD, 2, '여', '') )AS SEX_CD
				     , A.PD_DT
				     , A.HPN
				     , A.PD_SMS_SEN_DT
				     , A.UNP_SMS_SEN_DT
				     , SUBSTR(F.EDU_STR_DT, 0, 4) || '.' || SUBSTR(F.EDU_STR_DT, 5, 2) || '.' || SUBSTR(F.EDU_STR_DT, 7, 2) || ' ~ ' ||
				       SUBSTR(F.EDU_END_DT, 0, 4) || '.' || SUBSTR(F.EDU_END_DT, 5, 2) || '.' || SUBSTR(F.EDU_END_DT, 7, 2) AS EDU_DT
				     , F.EAN
				  FROM TBCSPSAE301D A
				  	 , TBCSPSAE101C B
				  	 , TBCSPSAE102C C
				     , TBCSPSAE103C D
				     , TBDCMACM015M E
				     , (SELECT TO_DATE(A.EDU_END_DT, 'YYYYMMDD')+1 - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') AS EDU_DAY
	                         , CEIL((TO_DATE(A.EDU_END_DT, 'YYYYMMDD') - NEXT_DAY(TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') -1, '6') +1)/7) AS FRIDY_DCN /* 20240613 교육과정 점심식비에 금요일 미포함 계산식 조정으로 추가 */
	                         , A.YR
	                         , A.CRS_CD
	                         , A.CRS_CDN
	                         , A.EDU_STR_DT
	                         , A.EDU_END_DT
	                         , B.EAN
			             FROM TBCSPSAE201D A
			                , TBCSPSAE201M B
			             WHERE A.YR = B.YR
			             AND A.CRS_CD = B.CRS_CD) F
				 WHERE B.EDU_DVSN_CD = D.EDU_DVSN_CD
				   AND B.EDU_DVSN_CD = C.EDU_DVSN_CD
				   AND C.EDU_CAT_CD = D.EDU_CAT_CD
				   AND D.CRS_CD = A.CRS_CD
				   AND E.ORG_CD(+) = A.ORG_CD
				   AND F.YR	= A.YR
				   AND F.CRS_CD = A.CRS_CD
				   AND F.CRS_CDN = A.CRS_CDN
				   AND A.ORG_CD IS NOT NULL
				   AND A.YR BETWEEN SUBSTR(#strFROM_YM#, 0, 4) AND SUBSTR(#strTO_YM#, 0, 4)
				   AND F.EDU_STR_DT BETWEEN #strFROM_YM# AND #strTO_YM#
        ]]>
        <dynamic>
	        <isNotEmpty property="strEDU_DVSN_CD">
	        	AND B.EDU_DVSN_CD	= #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
	        	AND C.EDU_CAT_CD 	= #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
	        	AND A.CRS_CD 		= #strEDU_CRS_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strCRS_CDN">
	        	AND A.CRS_CDN 		= #strCRS_CDN#
	       	</isNotEmpty>
	        <isNotEmpty property="strPD_YN">
				AND A.PD_YN = #strPD_YN#
	       	</isNotEmpty>
	        <isNotEmpty property="strNAM">
				AND A.NAM LIKE '%' || #strNAM# || '%'
	       	</isNotEmpty>
	    </dynamic>
       	<![CDATA[
			ORDER BY A.YR, A.CRS_CD, A.CRS_CDN, A.SNO
			) A
		
			UNION
		
			SELECT '' AS YR 
				 , '' AS CRS_CD
				 , '' AS CRS_NM
				 , 0 AS CRS_CDN
				 , 0 AS SNO
				 , '' AS SNO2
				 , '' AS TANE_ID
				 , '' AS NAM
				 , '' AS ORG_CD
				 , '합계' AS ORG_NM
				 , '' AS RANK_NM
				 , TRIM(TO_CHAR(SUM(A.EDU_EXS), '999,999,999,999')) AS EDU_EXS
				 , TRIM(TO_CHAR(SUM(A.DMT_EXS), '999,999,999,999')) AS DMT_EXS
				 , TRIM(TO_CHAR(SUM(A.FDEX), '999,999,999,999')) AS FDEX
				 , TRIM(TO_CHAR(SUM((A.EDU_EXS + A.DMT_EXS + A.FDEX)), '999,999,999,999')) AS TOT_AMT
				 , TRIM(TO_CHAR(SUM(A.PD_AMT), '999,999,999,999')) AS PD_AMT
				 , TRIM(TO_CHAR(SUM((A.PD_AMT - (A.EDU_EXS + A.DMT_EXS + A.FDEX))), '999,999,999,999')) AS UNP_AMT
				 , '' AS PD_MEAN_CD
				 , '' AS PD_MEAN_NM
			     , '' AS PD_YN
			     , '' AS PD_YN_NM
			     , '' AS EDU_DVSN_NM
			     , '' AS EDU_CAT_NM
				 , '' AS DMT_UE_YN
				 , '' AS BUS_UE_YN
				 , '' AS SEX_CD
			     , '' AS PD_DT
			     , '' AS HPN
			     , '' AS PD_SMS_SEN_DT
			     , '' AS UNP_SMS_SEN_DT
			     , '' AS EDU_DT
			     , '' AS EAN
			FROM (
				SELECT A.YR
					 , B.EDU_DVSN_CD
	 		     	 , C.EDU_CAT_CD
				     , A.CRS_CD
				     , D.CRS_NM
				     , A.CRS_CDN
				     , A.SNO
				     , A.TANE_ID
				     , A.NAM
				     , A.ORG_CD
				     , E.ORG_NM
				     , A.RANK_NM
				      , DECODE(NVL(A.EDU_EXS, 0), 0, NVL( (SELECT Z.EDU_EXS 
				                                       FROM TBCSPSAE113B Z
				                                      WHERE Z.CRS_CD = A.CRS_CD
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = Z.CRS_CD
	 			                                                       AND X.APC_DT < F.EDU_STR_DT)
	 			                                     )* F.EDU_DAY,
	 			                                      (SELECT Y.EDU_EXS 
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   	  		      FROM TBCSPSAE113B
																	     WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )* F.EDU_DAY
	 			       ), A.EDU_EXS) AS EDU_EXS
				     , DECODE(NVL(A.DMT_EXS, 0), 0, NVL( (SELECT Z.DMT_EXS 
				                                       FROM TBCSPSAE113B Z
				                                      WHERE Z.CRS_CD = A.CRS_CD
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = Z.CRS_CD
	 			                                                       AND X.APC_DT < F.EDU_STR_DT)
	 			                                     )* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0)),
	 			                                    (SELECT Y.DMT_EXS 
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   	  		      FROM TBCSPSAE113B
																	     WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )* (DECODE(A.DMT_UE_YN, 'Y', F.EDU_DAY-1, 0) + DECODE(A.SNDY_LODG_YN, 'Y', 1, 0))
	 			       ), A.DMT_EXS) AS DMT_EXS
					  , DECODE(NVL(A.FDEX, 0), 0, NVL( (SELECT DECODE(A.DMT_UE_YN, 'Y', Z.BRKF_FDEX*(F.EDU_DAY-1) + Z.LUNCH_FDEX*(F.EDU_DAY) +Z.DINR_FDEX*(F.EDU_DAY-1)
				                                                                    , Z.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정 _천은정감사관*/
				                                       FROM TBCSPSAE113B Z
				                                      WHERE Z.CRS_CD = A.CRS_CD
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = Z.CRS_CD
	 			                                                       AND X.APC_DT < F.EDU_STR_DT)
	 			                                     ), (SELECT DECODE(A.DMT_UE_YN, 'Y', Y.BRKF_FDEX*(F.EDU_DAY-1) + Y.LUNCH_FDEX*(F.EDU_DAY) +Y.DINR_FDEX*(F.EDU_DAY-1)
	 			                                                                       , Y.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정 _천은정감사관*/
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   				  FROM TBCSPSAE113B
																    	 WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )), (SELECT DECODE(A.DMT_UE_YN, 'Y', Y.BRKF_FDEX*(F.EDU_DAY-1) + Y.LUNCH_FDEX*(F.EDU_DAY) +Y.DINR_FDEX*(F.EDU_DAY-1)
	 			                                                                       , Y.LUNCH_FDEX*(F.EDU_DAY)) /* 20250312 감사교육 금요일 점심식비 추가에 따른 수정 _천은정감사관*/
				                                       FROM TBCSPSAE113B Y
				                                      WHERE Y.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   	  		      FROM TBCSPSAE113B
																	     WHERE CRS_CD = A.CRS_CD)
	 			                                        AND APC_DT = (SELECT MAX(APC_DT)
	 			                                                        FROM TBCSPSAE113B X
	 			                                                       WHERE X.CRS_CD = (SELECT NVL(MAX(CRS_CD), '000')
														   								   FROM TBCSPSAE113B
																						  WHERE CRS_CD = A.CRS_CD)
																	   AND X.APC_DT < F.EDU_STR_DT)
	 			                                       )) AS FDEX
				     , NVL(A.PD_AMT, 0) AS PD_AMT
				     , A.PD_MEAN_CD
				     , A.PD_YN
				     , B.EDU_DVSN_NM
				     , C.EDU_CAT_NM
				     , DECODE(A.SNDY_LODG_YN, 'Y', '전일입교', DECODE(A.DMT_UE_YN, 'Y', '숙박', '비숙박')) AS DMT_UE_YN
				     , A.BUS_UE_YN
				     , DECODE(A.SEX_CD, 1, '남', DECODE(A.SEX_CD, 2, '여', '') )AS SEX_CD
				     , A.PD_DT
				     , A.HPN
				     , A.PD_SMS_SEN_DT
				     , A.UNP_SMS_SEN_DT
				     , SUBSTR(F.EDU_STR_DT, 0, 4) || '.' || SUBSTR(F.EDU_STR_DT, 5, 2) || '.' || SUBSTR(F.EDU_STR_DT, 7, 2) || ' ~ ' ||
				       SUBSTR(F.EDU_END_DT, 0, 4) || '.' || SUBSTR(F.EDU_END_DT, 5, 2) || '.' || SUBSTR(F.EDU_END_DT, 7, 2) AS EDU_DT
				     , F.EAN
				  FROM TBCSPSAE301D A
				  	 , TBCSPSAE101C B
				  	 , TBCSPSAE102C C
				     , TBCSPSAE103C D
				     , TBDCMACM015M E
				     , (SELECT TO_DATE(A.EDU_END_DT, 'YYYYMMDD')+1 - TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') AS EDU_DAY
	                         , CEIL((TO_DATE(A.EDU_END_DT, 'YYYYMMDD') - NEXT_DAY(TO_DATE(A.EDU_STR_DT, 'YYYYMMDD') -1, '6') +1)/7) AS FRIDY_DCN /* 20240613 교육과정 점심식비에 금요일 미포함 계산식 조정으로 추가 */
	                         , A.YR
	                         , A.CRS_CD
	                         , A.CRS_CDN
	                         , A.EDU_STR_DT
	                         , A.EDU_END_DT
	                         , B.EAN
			             FROM TBCSPSAE201D A
			                , TBCSPSAE201M B
			             WHERE A.YR = B.YR
			             AND A.CRS_CD = B.CRS_CD) F
				 WHERE B.EDU_DVSN_CD = D.EDU_DVSN_CD
				   AND B.EDU_DVSN_CD = C.EDU_DVSN_CD
				   AND C.EDU_CAT_CD = D.EDU_CAT_CD
				   AND D.CRS_CD = A.CRS_CD
				   AND E.ORG_CD(+) = A.ORG_CD
				   AND F.YR	= A.YR
				   AND F.CRS_CD = A.CRS_CD
				   AND F.CRS_CDN = A.CRS_CDN
				   AND A.ORG_CD IS NOT NULL
				   AND A.YR BETWEEN SUBSTR(#strFROM_YM#, 0, 4) AND SUBSTR(#strTO_YM#, 0, 4)
				   AND F.EDU_STR_DT BETWEEN #strFROM_YM# AND #strTO_YM#
        ]]>
        <dynamic>
	        <isNotEmpty property="strEDU_DVSN_CD">
	        	AND B.EDU_DVSN_CD	= #strEDU_DVSN_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CAT_CD">
	        	AND C.EDU_CAT_CD 	= #strEDU_CAT_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strEDU_CRS_CD">
	        	AND A.CRS_CD 		= #strEDU_CRS_CD#
	       	</isNotEmpty>
	        <isNotEmpty property="strCRS_CDN">
	        	AND A.CRS_CDN 		= #strCRS_CDN#
	       	</isNotEmpty>
	        <isNotEmpty property="strPD_YN">
				AND A.PD_YN = #strPD_YN#
	       	</isNotEmpty>
	        <isNotEmpty property="strNAM">
				AND A.NAM LIKE '%' || #strNAM# || '%'
	       	</isNotEmpty>
	    </dynamic>
       	<![CDATA[
			) A
       	]]>
	</select>
	
	<select id="CSPSAE301ENearInfo" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT    
				  EDU_DVSN_CD
				, EDU_CAT_CD
				, CRS_CD
				, CRS_CDN
			FROM    
				(SELECT
					  T1.EDU_DVSN_CD
					, T2.EDU_CAT_CD
					, D1.CRS_CD
					, D1.CRS_CDN
				FROM    
					  TBCSPSAE201D D1
					, TBCSPSAE101C T1
					, TBCSPSAE102C T2
					, TBCSPSAE103C T3
				WHERE 1 = 1
				AND   D1.EDU_STR_DT = #strFromYm#
				AND   T3.CRS_CD = D1.CRS_CD
				AND   T2.EDU_CAT_CD = T3.EDU_CAT_CD
				AND   T2.EDU_DVSN_CD = T3.EDU_DVSN_CD
				AND   T1.EDU_DVSN_CD = T2.EDU_DVSN_CD
				ORDER BY D1.CRS_CD, D1.CRS_CDN)
			WHERE    ROWNUM = 1;
        ]]>
	</select>
	
	<insert id="CSPSAE301E_EH_INF_SP_AE_005_Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO EH_INF_SP_AE_005
			(
				IF_SEQ,
				IF_TYPE,
				YR,
				CRS_CD,
				CRS_CDN,
				TANE_ID,
				PD_YN,
				EDU_EXS,
				DMT_EXS,
				FDEX,
				PD_AMT,
				FRT_USR_ID,
				PD_DT
			)
			VALUES
			(
				#IF_SEQ#,
				'SND',
				#YR#,
				#CRS_CD#,
				#CRS_CDN#,
				#TANE_ID#,
				#PD_YN#,
				#EDU_EXS#,
				#DMT_EXS#,
				#FDEX#,
				#PD_AMT#,
				#FRT_USR_ID#,
				#PD_DT#
			)
		]]>
	</insert>
	
	
	<select id="CSPSAE313ERegLecList" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.YR,T1.CRS_CD, T1.LCT_NM ,
			       T1.CRS_CDN ,
			       T1.LCT_PLACE ,
			       SUBSTR(T1.EDU_STR_DT, 0, 4) || '.' || SUBSTR(T1.EDU_STR_DT, 5, 2) || '.' || SUBSTR(T1.EDU_STR_DT, 7, 2) || ' ~ ' || SUBSTR(T1.EDU_END_DT, 0, 4) || '.' || SUBSTR(T1.EDU_END_DT, 5, 2) || '.' || SUBSTR(T1.EDU_END_DT, 7, 2) AS EDU_DT ,
			       SUBSTR(T1.REG_STR_DT, 0, 4) || '.' || SUBSTR(T1.REG_STR_DT, 5, 2) || '.' || SUBSTR(T1.REG_STR_DT, 7, 2) || ' ~ ' || SUBSTR(T1.REG_END_DT, 0, 4) || '.' || SUBSTR(T1.REG_END_DT, 5, 2) || '.' || SUBSTR(T1.REG_END_DT, 7, 2) AS REG_DT ,
			       T1.NOP_CNT ,
			       (SELECT COUNT(*)
			          FROM TBCSPSAE306D s1
			         WHERE s1.YR = T1.YR
			           AND s1.CRS_CD = T1.CRS_CD
			           AND s1.CRS_CDN = T1.CRS_CDN
			           AND (S1.SIGN_STATUS = '3' OR S1.SIGN_STATUS = '2' OR S1.SIGN_STATUS = '1') ) AS REG_CNT
			        ,CASE WHEN T2.SIGN_STATUS IS NULL OR T2.SIGN_STATUS = '1' THEN '미신청'
			                WHEN T2.SIGN_STATUS = '2' THEN '결재중'
			                WHEN T2.SIGN_STATUS = '3' THEN '신청완료'
			                WHEN T2.SIGN_STATUS = '4' THEN '반려'
			                WHEN T2.SIGN_STATUS = '5' THEN '상신취소'
			                ELSE '' END AS SIGN_STATUS_NM
			        ,T2.SIGN_STATUS
			        ,T2.APV_KEY
			        ,NVL(T2.CNB,#strREGPER_CNB#) AS CNB
			 FROM   TBCSPSAE201D T1
			        ,TBCSPSAE306D T2
			   WHERE T1.YR = T2.YR(+)
			   AND   T1.CRS_CD = T2.CRS_CD(+)
			   AND   T1.CRS_CDN = T2.CRS_CDN(+)
			   AND TO_CHAR(SYSDATE,'yyyymmdd')  BETWEEN SUBSTR(T1.REG_STR_DT, 0, 8) AND SUBSTR(T1.REG_END_DT, 0, 8)      
                    AND T1.REG_OPEN_YN = 'Y'
			   AND   T2.CNB(+) = #strREGPER_CNB#
			   AND  CASE WHEN NVL(T1.INCLUDE_SC,'N') = 'N' AND  (SELECT inn_rank_cd FROM TBDCMACM001M WHERE cnb = #strREGPER_CNB#)  >'30' THEN 1 
   					     WHEN NVL(T1.INCLUDE_SC,'N') = 'Y' THEN 1 
    			    ELSE 0 
    				END  = 1 
			   ORDER BY T1.REG_STR_DT, T1.CRS_CD, T1.CRS_CDN
		]]>
	</select> 
	
	
	<insert id="CSPSAE313EInsertTane" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO TBCSPSAE306D 
 				( 	YR
 				  , CRS_CD
 				  , CRS_CDN
 				  , NAM
 				  , RANK_NM
 				  , CNB
 				  , RAL_BLT_NM
 				  , NPL_BLT_NM
 				  , HPN
 				  , SIGN_STATUS
 				  , FRT_USR_ID
 				  , FNL_USR_ID
 				  , FNL_DEAL_DPT_CD
 				  , FNL_MNU_ID
 				  , FRT_REGI_DH
 				  , FNL_MDF_DH
 				  , APV_KEY)
        	VALUES( #YR#
 				  , #CRS_CD#
 				  , #CRS_CDN#
 				  , #strREGPER_NAM#
 				  , #strREGPER_RANKNM#
 				  , #strREGPER_CNB#
 				  , #strREGPER_DPTNM#
 				  , #strREGPER_DPTNM#
 				  , TRIM(REPLACE(#strREGPER_HOMTNB#, '-'))
 				  , '3'
				  , #FRT_USR_ID#              
				  , #FNL_USR_ID#              
				  , #FNL_DEAL_DPT_CD#         
				  , #FNL_MNU_ID#              
				  , SYSDATE
				  , SYSDATE
				  , #APV_KEY#)
        ]]>
	</insert>
	
	
	<update id="CSPSAE313EUpdaeTane" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE306D
			   SET APV_KEY = #APV_KEY# 
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND CNB = #strREGPER_CNB#
		]]>
	</update>
	
	<!-- 신청자 초과 확인 -->
    <select id="CSPSAE313EExcessYn" parameterClass="paramMap" resultClass="String">
        <![CDATA[
		   SELECT CASE WHEN NOP_CNT <= REG_CNT  THEN 'Y' 
                       ELSE 'N' 
          		  END                 
          		  	   AS YN
             FROM (
                  SELECT NOP_CNT,
                         (SELECT COUNT(*)
                          FROM TBCSPSAE306D 
                          WHERE YR = #YR#
                          AND CRS_CD = #CRS_CD#
                          AND CRS_CDN = #CRS_CDN#
                          AND (SIGN_STATUS = '3' OR SIGN_STATUS = '2' OR SIGN_STATUS = '1') ) AS REG_CNT
                  FROM 
                         TBCSPSAE201D
                  WHERE
                         YR = #YR#
                         AND CRS_CD = #CRS_CD#
                         AND CRS_CDN = #CRS_CDN#
                )
        ]]>
	</select>
	
	<!-- 교육과정 중복 확인 -->
    <select id="CSPSAE313EIsExistYn" parameterClass="paramMap" resultClass="String">
        <![CDATA[
		   SELECT DECODE(COUNT(CNB), 0, 'N', 'Y') AS EXIST
		     FROM TBCSPSAE306D
		    WHERE YR = #YR#
		      AND CRS_CD = #CRS_CD#
		      AND CNB = #strREGPER_CNB#
		      AND SIGN_STATUS = '3'
        ]]>
	</select>
	
	<delete id="CSPSAE313EDeleteTane" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE306D
			 WHERE YR = #YR#
		       AND CRS_CD = #CRS_CD#
		       AND CRS_CDN = #CRS_CDN#
		       AND CNB = #CNB#
		       AND SIGN_STATUS = '3'
		]]>  
	</delete>
	
	
	<select id="CSPSAE313ESelectApvKey" parameterClass="paramMap" resultClass="Integer">
		<![CDATA[
			SELECT	APV_KEY_SEQ.NEXTVAL
			FROM	DUAL
		]]>
	</select>	
	
	
	<update id="CSPSAE313EClearKey" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE306D
			  SET APV_KEY = NULL
		    WHERE APV_KEY = #APV_KEY#
		    AND SIGN_STATUS = '4'
		]]>
	</update>
	
	<!-- 반려 건이 없는 결재상신 취소에서 상신 이뤄지지 않고 닫기시 삭제 -->
	<delete id="CSPSAE313EDelKey" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE306D
			 WHERE APV_KEY = #APV_KEY# 
		]]>  
	</delete>
	
		<!-- 반려 건이 있는 결재상신 취소에서 상신 이뤄지지 않고 닫기시 삭제 -->
	<delete id="CSPSAE313EDelKey2" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE306D
			 WHERE APV_KEY = #APV_KEY# 
			 AND SIGN_STATUS ='1' 
		]]>  
	</delete>
	
	
	<update id="CSPSAE313PApvupdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE306D
			  SET SIGN_STATUS =#APV_STA_CD#
			      ,APV_DOC_NO = #APV_DOC_NO#
		    WHERE APV_KEY = #APV_KEY#
		]]>
	</update>	
	
	
	<update id="CSPSAE313PApvupdate2" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE306D
			  SET SIGN_STATUS =#APV_STA_CD#
		    WHERE APV_DOC_NO = #APV_DOC_NO#
		]]>
	</update>
	
	
	<update id="CSPSAE313PApvupdate3" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE306D
			  SET SIGN_STATUS =#APV_STA_CD#
			  		,APV_DOC_NO = NULL
			  		,APV_KEY = NULL
		    WHERE APV_DOC_NO = #APV_DOC_NO#
		]]>
	</update>
	
	<!-- 상신취소시 신청자명단 삭제 -->
	<delete id="CSPSAE313PApvupdate4" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE306D
			 WHERE APV_DOC_NO = #APV_DOC_NO# 
		]]>  
	</delete>
	
	
	<select id="CSPSAE313PMainSelect" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[    
	SELECT  T1.LCT_NM ,
			       T1.CRS_CDN ,
			       T1.LCT_PLACE ,
			       SUBSTR(T1.EDU_STR_DT, 0, 4) || '.' || SUBSTR(T1.EDU_STR_DT, 5, 2) || '.' || SUBSTR(T1.EDU_STR_DT, 7, 2) || ' ~ ' || SUBSTR(T1.EDU_END_DT, 0, 4) || '.' || SUBSTR(T1.EDU_END_DT, 5, 2) || '.' || SUBSTR(T1.EDU_END_DT, 7, 2) AS EDU_DT ,
			       SUBSTR(T1.REG_STR_DT, 0, 4) || '.' || SUBSTR(T1.REG_STR_DT, 5, 2) || '.' || SUBSTR(T1.REG_STR_DT, 7, 2) || ' ~ ' || SUBSTR(T1.REG_END_DT, 0, 4) || '.' || SUBSTR(T1.REG_END_DT, 5, 2) || '.' || SUBSTR(T1.REG_END_DT, 7, 2) AS REG_DT ,
			       T1.NOP_CNT ,
			       (SELECT COUNT(*)
			          FROM TBCSPSAE306D s1
			         WHERE s1.YR = T1.YR
			           AND s1.CRS_CD = T1.CRS_CD
			           AND s1.CRS_CDN = T1.CRS_CDN
			           AND S1.SIGN_STATUS = '3') AS REG_CNT
			        ,CASE WHEN T2.SIGN_STATUS IS NULL OR T2.SIGN_STATUS = '1' THEN '미신청'
			                WHEN T2.SIGN_STATUS = '2' THEN '결재중'
			                WHEN T2.SIGN_STATUS = '3' THEN '승인(신청완료)'
			                WHEN T2.SIGN_STATUS = '4' THEN '반려'
			                WHEN T2.SIGN_STATUS = '5' THEN '상신취소'
			                ELSE '' END AS SIGN_STATUS_NM
			        ,T2.SIGN_STATUS
			        ,T2.APV_KEY
			        ,T2.CNB
			        ,F_USR_INFO(T2.CNB,'2') AS NAM
			 FROM   TBCSPSAE201D T1
			        ,TBCSPSAE306D T2
			   WHERE T1.YR = T2.YR
			   AND   T1.CRS_CD = T2.CRS_CD
			   AND   T1.CRS_CDN = T2.CRS_CDN
	]]>		
	<isNotEmpty property="APV_KEY">	
			   AND   T2.APV_KEY = #APV_KEY#
	</isNotEmpty>
	<isNotEmpty property="SND_APV_DOC_NO">	
			   AND T2.APV_DOC_NO = #SND_APV_DOC_NO#	
	</isNotEmpty>	             
	<![CDATA[
			   ORDER BY T1.REG_STR_DT, T1.CRS_CD, T1.CRS_CDN					 
	]]>
	</select>	
	
	<!-- 반려 된 건 유무 확인 -->
    <select id="CSPSAE313EKeyExistYn" parameterClass="paramMap" resultClass="String">
        <![CDATA[
		   SELECT DECODE(NVL(MAX(YR), 0), 0, 'N', 'Y') FROM TBCSPSAE306D
			WHERE APV_KEY = #APV_KEY# 
			AND SIGN_STATUS ='4'
        ]]>
	</select> 


	<select id="CSPSAE314PTaneExistYn" parameterClass="paramMap" resultClass="String">
        <![CDATA[
		   SELECT DECODE(NVL(MAX(YR), 0), 0, 'N', 'Y') FROM TBCSPSAE301D
			WHERE YR = #YR#
			  AND CRS_CD = #CRS_CD#
			  AND CRS_CDN = #CRS_CDN#
			  AND NAM = #NAM#
			  AND CNB = #CNB#
        ]]>
	</select>

	
	<select id="CSPSAE314PSelectMaxTaneId" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT LPAD(NVL(MAX(TANE_ID), 0)+1, 13, '0') AS TANE_ID FROM TBCSPSAE301D
			WHERE YR = #YR#
			  AND CRS_CD = #CRS_CD#
			  AND CRS_CDN = #CRS_CDN#
			  AND TANE_ID LIKE '0%'
        ]]>
	</select>
	
	
	<select id="CSPSAE314PSelectMaxSno" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT NVL(MAX(SNO), 0)+1 AS SNO FROM TBCSPSAE301D
			WHERE YR = #YR#
			  AND CRS_CD = #CRS_CD#
			  AND CRS_CDN = #CRS_CDN#
        ]]>
	</select>
	

		<!-- 교육생목록 조회 -->
	<select id="CSPSAE314PSelectTaneList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.YR
			     , A.CRS_CD
			     , A.CRS_CDN
			     , A.TANE_ID
			     , NVL(A.SNO,'') AS SNO 
			     , A.NAM
			     , A.RAL_BLT_NM
			     , A.NPL_BLT_NM
			     , A.RANK_NM
			     , TRIM(REPLACE(A.HPN, '-')) AS HPN
			     , A.CNB
			  FROM TBCSPSAE306D A
			 WHERE A.YR = #strYR#
		       AND A.CRS_CD = #strCRS_CD#
		       AND A.CRS_CDN = #strCRS_CDN#
		       AND A.SIGN_STATUS = '3'
		       ORDER BY FRT_REGI_DH
        ]]>
	</select>	
	
	
	<insert id="CSPSAE314PInsertTane" parameterClass="paramMap">
        <![CDATA[
 			INSERT INTO TBCSPSAE301D 
 				( 	YR
 				  , CRS_CD
 				  , CRS_CDN
 				  , TANE_ID
 				  , SNO
 				  , NAM
 				  , RAL_BLT_NM
 				  , NPL_BLT_NM
 				  , RANK_NM
 				  , DMT_UE_YN
 				  , SNDY_LODG_YN
 				  , BUS_UE_YN
 				  , FIN_YN
 				  , PD_YN
 				  , WRK_PRD_TXT
 				  , HPN
 				  , CNB
 				  , ORG_CD
 				  , DPT_NM
 				  , FRT_USR_ID
 				  , FNL_USR_ID
 				  , FNL_DEAL_DPT_CD
 				  , FNL_MNU_ID
 				  , FRT_REGI_DH
 				  , FNL_MDF_DH)
        	VALUES( #YR#
 				  , #CRS_CD#
 				  , #CRS_CDN#
 				  , #TANE_ID#
 				  , #SNO#
 				  , #NAM#
 				  , #NPL_BLT_NM#
 				  , #NPL_BLT_NM#
 				  , #RANK_NM#
 				  , 'N'
 				  , 'N'
 				  , 'N'
 				  , 'N'
 				  , 'N'
 				  , '0000'
 				  , TRIM(REPLACE(#HPN#, '-'))
 				  , #CNB#
 				  , '011000000000'
 				  , #NPL_BLT_NM#
				  , #FRT_USR_ID#              
				  , #FNL_USR_ID#              
				  , #FNL_DEAL_DPT_CD#         
				  , #FNL_MNU_ID#              
				  , SYSDATE
				  , SYSDATE)
        ]]>
	</insert>
	
	<update id="CSPSAE314PUpdateTaneHpn" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE306D
			  SET HPN = TRIM(REPLACE(#HPN#, '-'))
		    WHERE YR = #YR#
		       AND CRS_CD = #CRS_CD#
		       AND CRS_CDN = #CRS_CDN#
		       AND CNB = #CNB#
		]]>
	</update>
	
	
	<delete id="CSPSAE313PApvdelete23H" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBDCMACM023H
			 WHERE APV_DOC_NO = #APV_DOC_NO# 
			 AND  APV_DVSN_CD ='RegLecSend'
		]]>  
	</delete> 
	
	<delete id="CSPSAE313PApvdelete23L" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBDCMACM023L
			 WHERE APV_DOC_NO = #APV_DOC_NO# 
			 AND  APV_DVSN_CD ='RegLecSend'
		]]>  
	</delete> 
	
	<delete id="CSPSAE313PApvdelete22L" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBDCMACM022L
			 WHERE APV_DOC_NO = #APV_DOC_NO# 
			 AND  APV_DVSN_CD ='RegLecSend'
		]]>  
	</delete> 
	
	
	<select id="CSPSAE313ESelectUserInfo" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.HOM_TNB AS "strREGPER_HOMTNB"
				   ,F_CODE_NM('1000173',T1.RANK_CD) AS "strREGPER_RANKNM"
				   ,F_DPT_INFO(T1.DPT_CD,'1') AS "strREGPER_DPTNM"
			  FROM TBDCMACM001M T1
			 WHERE T1.CNB = #strREGPER_CNB# 
		]]>
	</select>
	
	<delete id="CSPSAE314PDeleteTane" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE306D
			 WHERE YR = #YR#
			   AND CRS_CD = #CRS_CD#
			   AND CRS_CDN = #CRS_CDN#
			   AND CNB = #CNB#
		]]>  
	</delete>
	
	<insert id="CSPSAE302PInsertMSGSend" parameterClass="paramMap">
		<![CDATA[
			CALL NURI2_MESSAGE_SEND(#CALL_FROM#, #CALL_TO#, #SMS_TLT#, #SMS_TXT#)
		]]>
	</insert>
	
</sqlMap> 
