<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/kde/001">

	<select id="CSPKDE001QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT A.* FROM 		
			(	
			SELECT	A.LAW_SNO,
					A.LAW_KND_CD,
					A.LAW_TIT_NM,
					F_DPT_INFO(A.LAW_MNG_BRDV_CD, '1') AS DPT_NM,
					A.LAW_SRT_CD,
					A.LAW_ABRG_YN,
					(SELECT MIN(Z.LAW_AMD_DT) FROM TBCSPKDE002D Z WHERE Z.LAW_SNO = A.LAW_SNO) AS FRT_LAW_DT,
					B.LAW_AMD_DT,
					B.LAW_AMD_HST_TXT
			  FROM	TBCSPKDE001M A,
                 (
                 	SELECT *
                 	FROM TBCSPKDE002D  B 
       ]]>
		<dynamic>
			<isEmpty property="hist">
                 	WHERE (B.LAW_SNO, B.LAW_AMD_DT) IN( SELECT C.LAW_SNO,
					                                           MAX(C.LAW_AMD_DT)
					                                      FROM TBCSPKDE002D C
					                                     GROUP BY C.LAW_SNO)
		</isEmpty>
				</dynamic>
				<![CDATA[
                 )B
                 
			 WHERE	1=1
			   AND	A.LAW_SNO = B.LAW_SNO(+)		
			 /*ORDER BY A.LAW_SRT_CD, B.LAW_AMD_DT DESC*/
			 ORDER BY B.LAW_AMD_DT DESC
			) A
		 WHERE 1=1
		]]>
		<dynamic>
			<isNotEmpty property="kndCd">
		   AND A.LAW_KND_CD = #kndCd#
		   	</isNotEmpty>
		   	<isNotEmpty property="srtCd">
		   AND A.LAW_SRT_CD = #srtCd#
		    </isNotEmpty>
		   	<isNotEmpty property="frtDt1">
		   AND A.FRT_LAW_DT &gt;= #frtDt1#
		   	</isNotEmpty>
		   	<isNotEmpty property="frtDt2">
		   AND A.FRT_LAW_DT &lt;= #frtDt2#
		    </isNotEmpty>
		    <isNotEmpty property="fnlDt1">
		   AND A.LAW_AMD_DT &gt;= #fnlDt1#
		    </isNotEmpty>
		    <isNotEmpty property="fnlDt2">
		   AND A.LAW_AMD_DT &lt;= #fnlDt2#
		    </isNotEmpty>
		    <isNotEmpty property="tit">
		   AND A.LAW_TIT_NM LIKE '%'|| #tit# ||'%'
		    </isNotEmpty>
		</dynamic>
	</select>
	
	
	<select id="CSPKDE001QReportSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT A.* FROM 		
			(	
			SELECT	A.LAW_SNO,
					A.LAW_KND_CD,
					F_CODE_NM('1000288', A.LAW_KND_CD) AS LAW_KND_NM,
					A.LAW_TIT_NM,
					F_DPT_INFO(A.LAW_MNG_BRDV_CD, '1') AS DPT_NM,
					A.LAW_SRT_CD,
					F_CODE_NM('1000289', A.LAW_SRT_CD) AS LAW_SRT_NM,
					A.LAW_ABRG_YN,
                    (SELECT TO_CHAR(TO_DATE(MIN(Z.LAW_AMD_DT)), 'YYYY-MM-DD') FROM TBCSPKDE002D Z WHERE Z.LAW_SNO = A.LAW_SNO) AS FRT_LAW_DT,
                    (SELECT TO_CHAR(TO_DATE(MAX(Z.LAW_AMD_DT)), 'YYYY-MM-DD') FROM TBCSPKDE002D Z WHERE Z.LAW_SNO = A.LAW_SNO) AS FNL_LAW_DT,
					B.LAW_AMD_DT,
					B.LAW_AMD_HST_TXT
			  FROM	TBCSPKDE001M A,
                 (
                 	SELECT *
                 	FROM TBCSPKDE002D  B 
       ]]>
		<dynamic>
			<isEmpty property="hist">
                 	WHERE (B.LAW_SNO, B.LAW_AMD_DT) IN( SELECT C.LAW_SNO,
					                                           MAX(C.LAW_AMD_DT)
					                                      FROM TBCSPKDE002D C
					                                     GROUP BY C.LAW_SNO)
		</isEmpty>
				</dynamic>
				<![CDATA[
                 )B
                 
			 WHERE	1=1
			   AND	A.LAW_SNO = B.LAW_SNO(+)		
			 ORDER BY A.LAW_SRT_CD, B.LAW_AMD_DT DESC
			) A
		 WHERE 1=1
		]]>
		<dynamic>
			<isNotEmpty property="kndCd">
		   AND A.LAW_KND_CD = #kndCd#
		   	</isNotEmpty>
		   	<isNotEmpty property="srtCd">
		   AND A.LAW_SRT_CD = #srtCd#
		    </isNotEmpty>
		   	<isNotEmpty property="frtDt1">
		   AND A.FRT_LAW_DT &gt;= #frtDt1#
		   	</isNotEmpty>
		   	<isNotEmpty property="frtDt2">
		   AND A.FRT_LAW_DT &lt;= #frtDt2#
		    </isNotEmpty>
		    <isNotEmpty property="fnlDt1">
		   AND A.LAW_AMD_DT &gt;= #fnlDt1#
		    </isNotEmpty>
		    <isNotEmpty property="fnlDt2">
		   AND A.LAW_AMD_DT &lt;= #fnlDt2#
		    </isNotEmpty>
		    <isNotEmpty property="tit">
		   AND A.LAW_TIT_NM LIKE '%'|| #tit# ||'%'
		    </isNotEmpty>
		</dynamic>
	</select>
	
	<insert id="CSPKDE003EInsert" parameterClass="paramMap">
        <![CDATA[       
			INSERT INTO TBCSPKDE001M
			(
				LAW_SNO
				,LAW_KND_CD
				,LAW_SRT_CD
				,LAW_TIT_NM
				,LAW_MNG_BRDV_CD
				,LAW_REGN_CNB
				,LAW_REGI_DT
				,LAW_ABRG_YN
				,FRT_USR_ID
				,FNL_USR_ID
				,FNL_DEAL_DPT_CD
				,FNL_MNU_ID
				,FRT_REGI_DH
				,FNL_MDF_DH
			)
			VALUES
			(
				(SELECT MAX(TO_NUMBER(LAW_SNO)) + 1 FROM TBCSPKDE001M)
				,#LAW_KND_CD#
				,#LAW_SRT_CD#
				,#LAW_TIT_NM#
				,#LAW_MNG_BRDV_CD#
				,#LAW_REGN_CNB#
				,#LAW_REGI_DT#
				,#LAW_ABRG_YN#
				,#FRT_USR_ID#
				,#FNL_USR_ID#
				,#FNL_DEAL_DPT_CD#
				,#FNL_MNU_ID#
				,SYSDATE
				,SYSDATE
			)
        ]]>
	</insert>
	
	<insert id="CSPKDE003EDetailInsert" parameterClass="paramMap">
        <![CDATA[       
			INSERT INTO TBCSPKDE002D
			(
				LAW_SNO
				,LAW_SEQ
				,LAW_AMD_DT
				,LAW_AMD_HST_TXT
				,DOC_ID
				,DOC_TYP_CD
				,DOC_ID_2
				,DOC_TYP_CD_2
				,FRT_USR_ID
				,FNL_USR_ID
				,FNL_DEAL_DPT_CD
				,FNL_MNU_ID
				,FRT_REGI_DH
				,FNL_MDF_DH
			)
			VALUES
			(
				(SELECT MAX(TO_NUMBER(LAW_SNO)) FROM TBCSPKDE001M)
				,(SELECT NVL(MAX(TO_NUMBER(LAW_SEQ)) + 1, 1) 
				    FROM TBCSPKDE002D 
				   WHERE LAW_SNO = (SELECT MAX(TO_NUMBER(LAW_SNO)) + 1 FROM TBCSPKDE001M))
				,#LAW_AMD_DT#
				,#LAW_AMD_HST_TXT#
				,#DOC_ID#
				,#DOC_TYP_CD#
				,#DOC_ID_2#
				,#DOC_TYP_CD_2#
				,#FRT_USR_ID#
				,#FNL_USR_ID#
				,#FNL_DEAL_DPT_CD#
				,#FNL_MNU_ID#
				,SYSDATE
				,SYSDATE
			)
        ]]>
	</insert>
	
	<select id="CSPKDE004EMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	A.LAW_SNO,
					A.LAW_KND_CD,
					A.LAW_REGI_DT,
					A.LAW_TIT_NM,
					F_DPT_INFO(F_USR_INFO(A.LAW_REGN_CNB, '5'), '1') AS DPT_NM,
					F_USR_INFO(A.LAW_REGN_CNB, '2') AS USR_NAM,
					A.LAW_REGN_CNB,
					F_DPT_INFO(LAW_MNG_BRDV_CD, '1') AS DPTNM,
					A.LAW_MNG_BRDV_CD,
					(SELECT MIN(Z.LAW_AMD_DT) FROM TBCSPKDE002D Z WHERE Z.LAW_SNO = A.LAW_SNO) AS FRT_LAW_DT,
					(SELECT MAX(Z.LAW_AMD_DT) FROM TBCSPKDE002D Z WHERE Z.LAW_SNO = A.LAW_SNO) AS FNL_LAW_DT,
					A.LAW_ABRG_YN,
					A.LAW_SRT_CD
			  FROM	TBCSPKDE001M A
			 WHERE	1=1
		]]>
		<dynamic>
			<isNotEmpty property="lawSno">
			   AND	A.LAW_SNO = #lawSno#
			</isNotEmpty>
			<isNotEmpty property="key1">
			   AND	A.LAW_SNO = #key1#
			</isNotEmpty>
		</dynamic>
		<![CDATA[
		]]>
	</select>
	
	<select id="CSPKDE004ESubSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT   A.LAW_SNO
			        ,A.LAW_SEQ
			        ,A.LAW_AMD_DT
			        ,A.LAW_AMD_HST_TXT
			        ,A.DOC_ID
			        ,A.DOC_ID_2
			        ,(  SELECT  MIN(B.FILE_NAME)
                        FROM    ECM_FILE_LIST_VIEW2 B
                        WHERE   A.DOC_ID    = B.DOC_ID
                     ) AS FILE_NAME1
			        ,( SELECT   MIN(C.FILE_NAME) AS FILE_NAME2
                        FROM    ECM_FILE_LIST_VIEW2 C
                        WHERE A.DOC_ID_2  = C.DOC_ID 
                     ) AS FILE_NAME2
			  FROM	TBCSPKDE002D A
			 WHERE  1=1
		]]>
		<dynamic>
			<isNotEmpty property="lawSno">
			   AND	A.LAW_SNO = #lawSno#
			</isNotEmpty>
			<isNotEmpty property="key1">
			   AND	A.LAW_SNO = #key1#
			</isNotEmpty>
			<isNotEmpty property="key2">
			   AND	A.LAW_SEQ = #key2#
			</isNotEmpty>
		</dynamic>
		<![CDATA[
			 ORDER  BY 	A.LAW_AMD_DT DESC, A.LAW_SEQ DESC
		]]>
	</select>
	
	<select id="CSPKDE004ESubCntselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(COUNT(LAW_SEQ)) AS CNT FROM TBCSPKDE002D WHERE LAW_SNO = #LAW_SNO#
		]]>
	</select>
	
	<delete id="CSPKDE004EDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPKDE001M WHERE LAW_SNO = #LAW_SNO#
		]]>
	</delete>
	
	<update id="CSPKDE004EUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPKDE001M
			   SET	FNL_MDF_DH 			= SYSDATE
			   		,LAW_KND_CD			= #LAW_KND_CD# 
					,LAW_TIT_NM 		= #LAW_TIT_NM#
					,LAW_MNG_BRDV_CD 	= #LAW_MNG_BRDV_CD#
					,LAW_ABRG_YN 		= #LAW_ABRG_YN#
					,LAW_SRT_CD 		= #LAW_SRT_CD#
					,FNL_USR_ID			= #FNL_USR_ID#
					,FNL_DEAL_DPT_CD	= #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID			= #FNL_MNU_ID#
			 WHERE 	1=1
			   AND	LAW_SNO = #LAW_SNO#
		]]>
	</update>
	
	<insert id="CSPKDE004EDetailInsert" parameterClass="paramMap">
        <![CDATA[       
			INSERT INTO TBCSPKDE002D
			(
				 LAW_SNO
				,LAW_SEQ
				,LAW_AMD_DT
				,LAW_AMD_HST_TXT
				,DOC_ID
				,DOC_TYP_CD
				,DOC_ID_2
				,DOC_TYP_CD_2
				,FRT_USR_ID
				,FNL_USR_ID
				,FNL_DEAL_DPT_CD
				,FNL_MNU_ID
				,FRT_REGI_DH
				,FNL_MDF_DH
			)
			VALUES
			(
				 #LAW_SNO#
				,(SELECT NVL(MAX(LAW_SEQ) + 1 , 1) FROM TBCSPKDE002D WHERE LAW_SNO = #LAW_SNO#)
				,#LAW_AMD_DT#
				,#LAW_AMD_HST_TXT#
				,#DOC_ID#
				,#DOC_TYP_CD#
				,#DOC_ID_2#
				,#DOC_TYP_CD_2#
				,#FRT_USR_ID#
				,#FNL_USR_ID#
				,#FNL_DEAL_DPT_CD#
				,#FNL_MNU_ID#
				,SYSDATE
				,SYSDATE
			)
        ]]>
	</insert>
	
	<delete id="CSPKDE004EDetailDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPKDE002D 
			 WHERE LAW_SNO = #LAW_SNO# 
			   AND LAW_SEQ = #LAW_SEQ#
		]]>
	</delete>
	
	<update id="CSPKDE004EDetailUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPKDE002D
			   SET	FNL_MDF_DH 	= SYSDATE
		]]>
			<dynamic>
				<isNotEmpty prepend="," property="LAW_AMD_DT">
					LAW_AMD_DT	= #LAW_AMD_DT#
				</isNotEmpty>
				<isNotEmpty prepend="," property="LAW_AMD_HST_TXT">
					LAW_AMD_HST_TXT	= #LAW_AMD_HST_TXT#
				</isNotEmpty>
				<isNotEmpty prepend="," property="DOC_ID">
					DOC_ID	= #DOC_ID#
				</isNotEmpty>
				<isNotEmpty prepend="," property="DOC_TYP_CD">
					DOC_TYP_CD	= #DOC_TYP_CD#
				</isNotEmpty>
				<isNotEmpty prepend="," property="DOC_ID_2">
					DOC_ID_2	= #DOC_ID_2#
				</isNotEmpty>
				<isNotEmpty prepend="," property="DOC_TYP_CD_2">
					DOC_TYP_CD_2	= #DOC_TYP_CD_2#
				</isNotEmpty>
			</dynamic>
		<![CDATA[
					,FNL_USR_ID		= #FNL_USR_ID#
					,FNL_DEAL_DPT_CD	= #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID		= #FNL_MNU_ID#
			 WHERE	1=1
			   AND	LAW_SNO = #LAW_SNO#
			   AND	LAW_SEQ = #LAW_SEQ#
		]]>
	</update>
</sqlMap>
