<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="aep/gkm/022">
	<select id="AEPGKM022Emainselect" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT	KLD_CHR_CAT_CD AS C_KLD_CHR_CAT_CD,
				KLD_CHR_CAT_CD AS O_KLD_CHR_CAT_CD,
				F_DPT_INFO(F_USR_INFO(CNB, '5'), '1') AS DPT_NM,
				F_CODE_NM('1000173', F_USR_INFO(CNB, '3')) AS RANK_NM,
				F_CODE_NM('1000176', F_USR_INFO(CNB, '4')) AS PST_NM,
				CNB AS CHANGE_CNB,
				CNB AS ORIGIN_CNB,
				F_USR_INFO(CNB, '2') AS USR_NAM
		FROM	TBAEPGKM005L
		WHERE	1=1
		<isNotEmpty property="KLD_CHR_CAT_CD" prepend="AND">
				KLD_CHR_CAT_CD = #KLD_CHR_CAT_CD#
		</isNotEmpty>
		<isNotEmpty property="CNB">
		AND		(
				CNB IN (
						SELECT	CNB
						FROM	TBDCMACM001M
						WHERE	USR_NAM LIKE '%' || #CNB# || '%'
						OR		CNB = #CNB#
						)
				)
		</isNotEmpty>
	</select>
	
	<insert id="AEPGKM022Emaininsert" parameterClass="java.util.Map">
		INSERT INTO TBAEPGKM005L
			(KLD_CHR_CAT_CD
			,CNB
			, USE_YN
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH)
		VALUES 
			(#C_KLD_CHR_CAT_CD#
			, #CHANGE_CNB#
			, 'Y'
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE)
</insert>
	
	<update id="AEPGKM022Emainupdate" parameterClass="java.util.Map">
		UPDATE TBAEPGKM005L
		SET	
		<isNotEqual property="O_KLD_CHR_CAT_CD" compareProperty="C_KLD_CHR_CAT_CD">
			KLD_CHR_CAT_CD = #C_KLD_CHR_CAT_CD#,
		</isNotEqual>
		<isNotEqual property="ORIGIN_CNB" compareProperty="CHANGE_CNB">
			CNB = #CHANGE_CNB#,
		</isNotEqual>
			FNL_USR_ID = #FNL_USR_ID#,
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			FNL_MNU_ID = #FNL_MNU_ID#,
			FNL_MDF_DH = SYSDATE 
		WHERE
			CNB = #ORIGIN_CNB#
		AND	KLD_CHR_CAT_CD = #O_KLD_CHR_CAT_CD#
	</update>
	
	<delete id="AEPGKM022Emaindelete" parameterClass="java.util.Map">
		DELETE FROM TBAEPGKM005L
		WHERE KLD_CHR_CAT_CD = #O_KLD_CHR_CAT_CD#
		AND CNB = #ORIGIN_CNB#
	</delete>
</sqlMap>

