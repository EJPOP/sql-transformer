<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/cmr/022">
	
	<!-- 법령모니터링첨부파일기본(TBBADCMR012M) 삭제 -->
	<update id="BADCMR022EFiledelete" parameterClass="paramMap">
		<![CDATA[   
			DELETE FROM TBBADCMR012M
			 WHERE LAW_YE      = #LAW_YE#
			   AND LAW_MNT_SNO = #LAW_MNT_SNO#
		]]>
	</update>

	<!-- 법령모니터링기본(TBBADCMR011M) 삭제 -->
	<update id="BADCMR022Emaindelete" parameterClass="paramMap">
		<![CDATA[   
			DELETE FROM TBBADCMR011M
			 WHERE LAW_YE      = #LAW_YE#
			   AND LAW_MNT_SNO = #LAW_MNT_SNO#
		]]>
	</update>	
	
	<!-- 결제제출시 뜨는 subPage select -->
	<select id="BADCMR022Pmainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[   
			SELECT F_CODE_NM('1000256', AUD_MNT_HNDL_STA_CD)   AS AUD_MNT_HNDL_STA_NM /*감사모니터링처리상태*/
			     , CASE WHEN COPT_GD_CD IS NOT NULL THEN (SELECT ORG_NM FROM TBDCMACM015M WHERE ORG_CD = D1.COPT_GD_CD) || '(' || COPT_GD_CD || ')' ELSE '' END  AS COPT_GD_NM          /*소관기관명*/
			     , F_CODE_NM('1000253', MTRL_CAT_CD)           AS MTRL_CAT_NM         /*자료분류코드*/
			     , D2.EPS_MNG_LAW_NM                           AS REL_EPS_MNG_LAW_NM  /*중접법령*/
			     , CASE WHEN LAW_KND_CD IS NOT NULL THEN '(' || F_CODE_NM('1000254', LAW_KND_CD) ||') ' || TRIM(MNT_TIT_NM)
			            ELSE TRIM(MNT_TIT_NM) END                    AS MNT_TIT_NM          /*모니터링 제목*/
			     , NVL2(MNT_URL_AD, '', TRIM(MNT_TXT))         AS MNT_TXT             /*모니터링 내용 - 모니터링 URL이 있을경우엔 내용을 보여주지 않는다.*/
			     , TRIM(LAW_URL_AD)                            AS LAW_URL_AD          /*법령URL주소*/
			     , TRIM(LAW_URL_AD_1)                          AS LAW_URL_AD_1
			     , BLE_DIV_HNDL_OPIN_TXT
			     , DECODE(NVL(HNDL_OPIN_YO, 'N'), 'Y', 'O', 'X') AS HNDL_OPIN_YO        /*의견*/
			     , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = D1.LAW_YE AND LAW_MNT_SNO = D1.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-001') AS DOC_ID_1 /*모니터링내용 첨부파일*/
			FROM TBBADCMR011M D1
               , TBBADCMR014M D2
			WHERE D1.REL_EPS_MNG_LAW_YE = D2.EPS_LAW_YE (+)
              AND D1.REL_EPS_MNG_LAW_SNO = D2.EPS_LAW_SNO (+)
		]]>
		<isNotEmpty property="strDocNo">
			AND APV_REF_ID = #strDocNo#
		</isNotEmpty>
		<isEmpty property="strDocNo">
			AND LAW_MNT_SNO = #strLawMntSno#
			AND LAW_YE      = #strLawYe#
		</isEmpty>
	</select>
	
</sqlMap> 
