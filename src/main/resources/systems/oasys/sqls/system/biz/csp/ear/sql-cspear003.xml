<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/ear/003">
 	<select id="CSPEAR003EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.REQ_DVSN_CD
					,A.ACP_YR
   					,A.CVPT_ACP_NO
   					,A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||A.CVPT_ACP_NO AS ACP_NO
   					,A.CVPTR_NM
   					,A.TIT_NM
   					,A.ACP_DH
   					,B.REQR_DVSN_CD
   					,A.CVPT_HNDL_STA_CD
   					,F_USR_INFO_BY_ID(B.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
   					,B.TRNF_YN
   					,F_DPT_INFO(B.HNDL_DPT_CD,'1')AS HNDL_DPT_NM
   					,B.HNDL_CHGR_ID
   					,B.HNDL_DPT_CD AS HNDL_DPT_CD
   			FROM	TBCSPDCP101M A
   					,TBCSPEAR001M B
   			WHERE	1=1
   			AND		A.REQ_DVSN_CD = B.REQ_DVSN_CD(+)
   			AND		A.ACP_YR = B.ACP_YR(+)
   			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO(+)
   			AND		A.CVPT_HNDL_STA_CD NOT IN ('10','21')
		]]>
		<dynamic>
			<isNotEmpty property="strREQ_DVSN_CD">
				AND	A.REQ_DVSN_CD = #strREQ_DVSN_CD#
			</isNotEmpty>
			<isEmpty property="strREQ_DVSN_CD">
				AND	A.REQ_DVSN_CD IN ('2','3')
			</isEmpty>
			<isNotEmpty property="strACP_DHS">
				AND	TO_CHAR(A.ACP_DH,'YYYYMMDD') &gt;= #strACP_DHS#
			</isNotEmpty>
			<isNotEmpty property="strACP_DHE">
				AND	TO_CHAR(A.ACP_DH,'YYYYMMDD') &lt;= #strACP_DHE#
			</isNotEmpty>
			<isNotEmpty property="strTIT_NM">
				AND	A.TIT_NM LIKE '%'||#strTIT_NM#||'%'
			</isNotEmpty>
			<isNotEmpty property="strACP_YR">
				AND	A.ACP_YR = #strACP_YR#
			</isNotEmpty>
			<isNotEmpty property="strCVPT_ACP_NO">
				AND	A.CVPT_ACP_NO = #strCVPT_ACP_NO#
			</isNotEmpty>
			<isEqual property="strDTB_YN" compareValue="Y">
				AND	(B.HNDL_DPT_CD IS NOT NULL)
			</isEqual>
			<isEqual property="strDTB_YN" compareValue="N">
				AND	(B.HNDL_DPT_CD IS NULL)
			</isEqual>
			<isNotEmpty property="strCVPTR_NM">
				AND	(A.CVPTR_NM LIKE '%'||#strCVPTR_NM#||'%' OR A.RPST_PEN_NM LIKE '%'||#strCVPTR_NM#||'%')
			</isNotEmpty>
		</dynamic>
		<![CDATA[ 
			ORDER BY A.ACP_DH DESC
		]]>
	</select>
	
	<select id="CSPEAR003EBruDptSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT 	DPT_CD
					, DPT_NM 
			FROM	TBDCMACM002M 
			WHERE 	DPT_CD LIKE '%000' 
			AND 	USE_YN = 'Y'
		]]>
	</select>
	
	<select id="CSPEAR003EDptSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT 	DPT_CD
					, DPT_NM
					, HIRK_DPT_CD AS BRU_DPT_CD 
			FROM	TBDCMACM002M 
			WHERE 	DPT_CD NOT LIKE '%000' 
			AND 	USE_YN = 'Y'
		]]>
	</select>
	
	<select id="CSPEAR003EUsrSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT 	USR_ID
					, USR_NAM
					, DPT_CD 
			FROM	TBDCMACM001M 
		]]>
	</select>
	
	<update id="CSPEAR003EEAR001Update" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPEAR001M
			SET		HNDL_DPT_CD = #HNDL_DPT_CD#
					,HNDL_CHGR_ID = #HNDL_CHGR_ID#
					,FNL_USR_ID = #FNL_USR_ID#
   					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
   					,FNL_MNU_ID = #FNL_MNU_ID#
   					,FNL_MDF_DH = SYSDATE
			WHERE	REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</update>
</sqlMap> 
