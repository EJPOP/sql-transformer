<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/hpm/006">
	
	<!--발간자료목록 정보를 조회한다.-->
	<select id="CSPHPM006Qmainselect" parameterClass="paramMap" 	resultClass="resultMap">
		<include refid = "include.pageSelct"/><!-- 페이징 -->
        <![CDATA[
				SELECT
					A.NTT_ID, A.BBS_ID, A.NTT_SJ, A.NTT_CN, A.DOC_YEAR
					,A.BUSEO,
				    ( SELECT DPT_NM
				        FROM TBDCMACM002M
				       WHERE USE_YN = 'Y'
				         AND DPT_CD = A.BUSEO) AS BUSEO_NM
					,A.DATE_SUB
					,A.INSTITUTION
					,(SELECT NVL(ORG_NM,'') 
					   FROM TBDCMACM015M 
				      WHERE ORG_CD(+) = A.INSTITUTION) AS INSTITUTION_NM
				    ,A.CATEGORY
				    ,A.KEYWORD
				    ,A.SUB1
				    ,A.SUB2
				    ,A.CATEGORY_SUB
				    ,A.CNN_CNT1
				 FROM TBCSPTSM002L A
				 LEFT OUTER JOIN  TBDCMACM001M B
				  ON A.FRST_REGISTER_ID = B.USR_ID 
				WHERE BBS_ID='BBSMSTR_100000000020'
				  AND A.USE_AT = 'Y' 
				  AND A.NOTICE_YN != 'Y'
		]]>				
		<isEqual property="strSearchCd" compareValue="1"> <!-- 제목 -->
		 	AND UPPER(A.NTT_SJ) LIKE UPPER('%' || #strSearchBox# || '%')
		</isEqual>
		<isEqual property="strSearchCd" compareValue="2"> <!-- 내용 -->
			AND UPPER(A.NTT_CN) LIKE UPPER('%' || #strSearchBox# || '%')
		</isEqual> 
		<isEqual property="strSearchCd" compareValue="3"> <!-- 작성자 -->
			AND UPPER(A.NTCR_NM) LIKE UPPER('%' || #strSearchBox# || '%')
		</isEqual>
		
		 <isNotEmpty property="strYr" > <!-- 연도별 -->
			AND A.DOC_YEAR = #strYr#	
		</isNotEmpty>
		
		<isNotEmpty property="strSearchBgnDe">  <!-- 시작 작성일 -->
			AND (TO_CHAR(a.FRST_REGIST_PNTTM,'YYYYMMDD') <![CDATA[ >= ]]> #strSearchBgnDe# OR  a.FRST_REGIST_PNTTM IS NULL)
		</isNotEmpty>
		
		<isNotEmpty  property="strSearchEndDe">   <!-- 종료 작성일 -->
			AND (TO_CHAR(a.FRST_REGIST_PNTTM,'YYYYMMDD') <![CDATA[ <= ]]> #strSearchEndDe# OR a.FRST_REGIST_PNTTM IS NULL)
		</isNotEmpty>
		<include refid = "include.pageOrder"/> <!-- 페이징 -->
	</select>
	
		
	<!-- 수정한 내용 저장하기 -->
	<update id="CSPHPM006QUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPTSM002L
			   SET 	NTT_SJ           = #NTT_SJ#
					,NTT_CN          = #NTT_CN#
					,DOC_YEAR        = #DOC_YEAR#
					,BUSEO           = #BUSEO#
					,DATE_SUB        = #DATE_SUB#
					,INSTITUTION     = #INSTITUTION#
					,CATEGORY        = #CATEGORY#
					,KEYWORD         = #KEYWORD#
					,SUB1            = #SUB1#
					,SUB2            = #SUB2#
					,CATEGORY_SUB    = #CATEGORY_SUB#
					,CNN_CNT1        = #CNN_CNT1#
					,LAST_UPDUSR_ID  = #LAST_UPDUSR_ID#
					,LAST_UPDT_PNTTM = SYSDATE
			 WHERE NTT_ID = #NTT_ID#
			   AND BBS_ID = #BBS_ID#
		]]>
	</update>
	     
	<!-- 신규등록 -->
	<update id="CSPHPM006QInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPTSM002L
				(
					NTT_ID, BBS_ID, NTT_SJ, NTT_CN, SORT_ORDR, 
					NTCR_ID, NTCR_NM, PASSWORD, RDCNT, 
					NTCE_BGNDE, NTCE_ENDDE, ANSWER_AT,  			   
					PARNTSCTT_NO, NTT_NO, ANSWER_LC, DOC_ID,
					FRST_REGISTER_ID, FRST_REGIST_PNTTM, USE_AT,
					KEYWORD, MAIN_IMG_ID, QNA_STATE, QNA_ANSWER, DOC_YEAR, HTML_YN, LIST_IMG_ID, PUBLIC_YN,
					NOTICE_YN, SECRET_YN, URL_LINK, CATEGORY, THUMB_IMG_ID, LIST_TOP_IMG_YN, FAQ_DSJ, FAQ_ANSWER,
					SUB1, SUB2, CATEGORY_SUB, BUSEO, EMAIL, TEL, JUSO, INSTITUTION, DATE_SUB, QNA_ANSWER_NM, QNA_REG_DATE, 
					CNN_CNT1, CNN_CON2, CNN_CON1, CNN_CON3, CLIENT_IP, BOGO_DATE
				)
			VALUES
				(
				    #NTT_ID#,'BBSMSTR_100000000020',#NTT_SJ#,#NTT_CN#,#SORT_ORDR#
					,#NTCR_ID#,#NTCR_NM#,#PASSWORD#,#RDCNT#
					,#NTCE_BGNDE#,#NTCE_ENDDE#,#ANSWER_AT#
					,#PARNTSCTT_NO#,#NTT_NO#,#ANSWER_LC#,#ATCH_FILE_ID#
					,#FRST_REGISTER_ID#,SYSDATE,'Y'
					,#KEYWORD#,#MAIN_IMG_ID#,#QNA_STATE#,#QNA_ANSWER#,#DOC_YEAR#,#HTML_YN#,#LIST_IMG_ID#,#PUBLIC_YN#
					,'N',#SECRET_YN#,#URL_LINK#,#CATEGORY#,#THUMB_IMG_ID#,#LIST_TOP_IMG_YN#,#FAQ_DSJ#,#FAQ_ANSWER#
					,#SUB1#,#SUB2#,#CATEGORY_SUB#,#BUSEO#,#EMAIL#,#TEL#,#JUSO#,#INSTITUTION#,#DATE_SUB#,#QNA_ANSWER_NM#,#QNA_REG_DATE#
					,#CNN_CNT1#,#CNN_CON2#,#CNN_CON1#,#CNN_CON3#,#CLIENT_IP#,#BOGO_DATE#
				)
		]]>
	</update>
	   
	<!-- 삭제 -->
	<delete id="CSPHPM006QDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE
			  FROM TBCSPTSM002L 				
			 WHERE NTT_ID = #NTT_ID#
			   AND BBS_ID = 'BBSMSTR_100000000020'
		]]>
	</delete>
	  
    <!-- 홈페이지용 select :: 홈페이지 연계 -->
    <select id="CSPHPM006QSendHomepageselect" parameterClass="paramMap"	resultClass="resultMap">
    	<![CDATA[
			SELECT
					NTT_ID, BBS_ID, NTT_NO, NTT_SJ, NTT_CN, ANSWER_AT, 
			       PARNTSCTT_NO, ANSWER_LC, SORT_ORDR, RDCNT, USE_AT, 
			       NTCE_BGNDE, NTCE_ENDDE, NTCR_ID, NTCR_NM, PASSWORD, 
			       DOC_ID AS ATCH_FILE_ID, FRST_REGIST_PNTTM, FRST_REGISTER_ID, 
			       LAST_UPDT_PNTTM, LAST_UPDUSR_ID, THUMB_IMG_ID, CATEGORY, 
			       HEADER, KEYWORD, MAIN_IMG_ID, QNA_STATE, QNA_ANSWER, DOC_YEAR,
			       HTML_YN, LIST_IMG_ID, PUBLIC_YN, NOTICE_YN, SECRET_YN, URL_LINK, 
			       LIST_TOP_IMG_YN, MAIN_YN, FAQ_ANSWER, FAQ_DSJ, SUB1, SUB2, CATEGORY_SUB, 
			       BUSEO, EMAIL, TEL, JUSO, INSTITUTION, DATE_SUB, CNN_STATE1, CNN_STATE2, 
			       CNN_STATE3, CNN_STATE4, CNN_CON1, CNN_CON2, CNN_CON3, CNN_CON4, CNN_CNT1, QNA_ANSWER_NM, 
			       QNA_REG_DATE, PARENT_NO, LEVEL_NO, CNN_ACCT_DATE, CNN_PROP_DATE, 
			       CLIENT_IP, BOGO_DATE, #FLAG# AS FLAG
			 FROM TBCSPTSM002L 
			WHERE NTT_ID = #NTT_ID#
    	]]>
    </select>
    
    <!--  연계 테이블 안에 데이터 insert -->
    <insert id="CSPHPM006QSEND001Insert" parameterClass="paramMap">
    	<![CDATA[
    		INSERT INTO EH_INF_SP_HP_001 
			       (
			           IF_SEQ,IF_TYPE,IF_SIID, 
			           NTT_ID, BBS_ID, NTT_NO, NTT_SJ, NTT_CN, ANSWER_AT, 
			           PARNTSCTT_NO, ANSWER_LC, SORT_ORDR, RDCNT, USE_AT, 
			           NTCE_BGNDE, NTCE_ENDDE, NTCR_ID, NTCR_NM, PASSWORD, 
			           ATCH_FILE_ID, FRST_REGIST_PNTTM, FRST_REGISTER_ID, 
			           LAST_UPDT_PNTTM, LAST_UPDUSR_ID, THUMB_IMG_ID, CATEGORY, 
			           HEADER, KEYWORD, MAIN_IMG_ID, QNA_STATE, QNA_ANSWER, DOC_YEAR,
			           HTML_YN, LIST_IMG_ID, PUBLIC_YN, NOTICE_YN, SECRET_YN, URL_LINK, 
			           LIST_TOP_IMG_YN, MAIN_YN, FAQ_ANSWER, FAQ_DSJ, SUB1, SUB2, CATEGORY_SUB, 
			           BUSEO, EMAIL, TEL, JUSO, INSTITUTION, DATE_SUB, CNN_STATE1, CNN_STATE2, 
			           CNN_STATE3, CNN_STATE4, CNN_CON1, CNN_CON2, CNN_CON3, CNN_CON4, CNN_CNT1, QNA_ANSWER_NM, 
			           QNA_REG_DATE, PARENT_NO, LEVEL_NO, CNN_ACCT_DATE, CNN_PROP_DATE, 
			           CLIENT_IP, BOGO_DATE, FLAG,ETC1,ETC2,ETC3,ETC4,ETC5
			       ) 
			  VALUES
			       (
			           #IF_SEQ#,'SND',#IF_SIID#
			          ,#NTT_ID#,#BBS_ID#,#NTT_NO#,#NTT_SJ#,#NTT_CN#,#ANSWER_AT#
			          ,#PARNTSCTT_NO#,#ANSWER_LC#,#SORT_ORDR#,#RDCNT#,#USE_AT#
			          ,#NTCE_BGNDE#,#NTCE_ENDDE#,#NTCR_ID#,#NTCR_NM#,#PASSWORD#
			          ,#ATCH_FILE_ID#,#FRST_REGIST_PNTTM#,#FRST_REGISTER_ID#
			          ,#LAST_UPDT_PNTTM#,#LAST_UPDUSR_ID#,#THUMB_IMG_ID#,#CATEGORY#
			          ,#HEADER#,#KEYWORD#,#MAIN_IMG_ID#,#QNA_STATE#,#QNA_ANSWER#,#DOC_YEAR#
			          ,#HTML_YN#,#LIST_IMG_ID#,#PUBLIC_YN#,#NOTICE_YN#,#SECRET_YN#,#URL_LINK#
			          ,#LIST_TOP_IMG_YN#,#MAIN_YN#,#FAQ_ANSWER#,#FAQ_DSJ#,#SUB1#,#SUB2#,#CATEGORY_SUB#
			          ,#BUSEO#,#EMAIL#,#TEL#,#JUSO#,#INSTITUTION#,#DATE_SUB#,#CNN_STATE1#,#CNN_STATE2#
			          ,#CNN_STATE3#,#CNN_STATE4#,#CNN_CON1#,#CNN_CON2#,#CNN_CON3#,#CNN_CON4#,#CNN_CNT1#,#QNA_ANSWER_NM#
			          ,#QNA_REG_DATE#,#PARENT_NO#,#LEVEL_NO#,#CNN_ACCT_DATE#,#CNN_PROP_DATE#
			          ,#CLIENT_IP#,#BOGO_DATE#,#FLAG#,#ETC1#,#ETC2#,#ETC3#,#ETC4#,#ETC5#
			       )
    	]]>
    </insert>
	
	<select id="CSPHPM006QGetMaxFmdxIdx" parameterClass="paramMap" resultClass="Integer">
		<![CDATA[
			SELECT NVL(MAX(NTT_ID),0)+1 AS NTT_ID 
			  FROM TBCSPTSM002L
		]]>
	</select>
	
</sqlMap> 
