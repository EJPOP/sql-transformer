<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ear/058">

	<!--처분요구목록 조회-->
	<select id="BADEAR058PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR                                                              AS AUD_YR
			      ,D1.AUD_NO                                                              AS AUD_NO
			      ,D1.DSP_RQ_SNO                                                          AS DSP_RQ_SNO
			      ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, '', '-') ||'-'|| D1.DSP_RQ_SNO AS AUD_YR_NO
			      ,D1.DSP_RQ_KND_CD                                                       AS DSP_RQ_KND_CD			      
			      ,F_CODE_NM('1000002',D1.DSP_RQ_KND_CD )                                 AS DSP_RQ_KND_NM
			      ,D1.TIT_TXT                                                             AS TIT_TXT
			  FROM TBBADEAR001M D1
			     , TBBADEAR002D D2
			 WHERE D1.AUD_YR     = D2.AUD_YR
			   AND D1.AUD_NO     = D2.AUD_NO
			   AND D1.DSP_RQ_SNO = D2.DSP_RQ_SNO
		]]>			             
           		
		<isNotEmpty property="AUD_YR">	
			   AND D1.AUD_YR = #AUD_YR#
		</isNotEmpty>

		<isNotEmpty property="AUD_NO">	
			   AND D1.AUD_NO = #AUD_NO#
		</isNotEmpty>

		<isNotEmpty property="DSP_RQ_SNO">
			   AND D1.DSP_RQ_SNO IN
					<iterate property="DSP_RQ_SNO" open="(" close=")" conjunction=",">
						#DSP_RQ_SNO[]#
					</iterate>
		</isNotEmpty>
	     
		<isNotEmpty property="SND_APV_DOC_NO">	
			   AND D2.SND_APV_DOC_NO = #SND_APV_DOC_NO#
		</isNotEmpty>	     
	     
	     ORDER BY D1.AUD_YR
	             ,D1.AUD_NO
	             ,D1.DSP_RQ_SNO
	</select>


	<!-- 결재상신 update -->
	<update id="BADEAR058PApvupdate_1" parameterClass="paramMap">
        <![CDATA[
			UPDATE TBBADEAR002D
			SET
                SND_STA_CD        = #SND_STA_CD#         /* 송부상태코드 */
			   ,SND_APV_DOC_NO    = #SND_APV_DOC_NO#     /* 송부결재문서번호 */
			   ,SND_RET_RSN_TXT   = ''                   /* 송부반려사유내용 */
			   ,FNL_USR_ID        = #FNL_USR_ID#
			   ,FNL_DEAL_DPT_CD   = #FNL_DEAL_DPT_CD#
			   ,FNL_MNU_ID        = #FNL_MNU_ID#
			   ,FNL_MDF_DH        = SYSDATE
			WHERE 1 = 1
			  AND AUD_YR = #AUD_YR#
			  AND AUD_NO = #AUD_NO#
			  AND DSP_RQ_SNO IN
        ]]>
		<iterate property="DSP_RQ_SNO" open="(" close=")" conjunction=",">
				#DSP_RQ_SNO[]#
		</iterate>
	</update>	
	
		
	<!-- 결재 update -->
	<update id="BADEAR058PApvupdate_2" parameterClass="paramMap">
        <![CDATA[
			UPDATE TBBADEAR002D
			SET
                SND_STA_CD        = #SND_STA_CD#                           /* 송부상태코드 */
			   ,SND_APV_DOC_NO    = #SND_APV_DOC_NO#                       /* 송부결재문서번호 */
			   ,FNL_USR_ID        = #FNL_USR_ID#
			   ,FNL_DEAL_DPT_CD   = #FNL_DEAL_DPT_CD#
			   ,FNL_MNU_ID        = #FNL_MNU_ID#
			   ,FNL_MDF_DH        = SYSDATE
			WHERE 1 = 1
			  AND SND_APV_DOC_NO = #SND_APV_DOC_NO#
        ]]>
	</update>	
			
</sqlMap> 
