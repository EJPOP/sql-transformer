<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/acp/002">
	
	<!-- 물품수리요청 상세 조회 -->
	<select id="CSPACP002EDetailSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* csp/acp/002/CSPACP002EDetailSelect */ ]]>
        <![CDATA[
			SELECT	A.GDS_RQS_SNO,		/*물품요청순번*/ 
			        A.GDS_DVSN_CD, 		/*물품구분코드*/
			        A.RQS_DT,		/*요청일*/ 
			        A.RQR_CNB,		/*요청자전산번호*/
			        (SELECT USR_NAM 
			        FROM TBDCMACM001M Z
			        WHERE A.RQR_CNB = Z.CNB
			        ) AS RQR_NAM,		/*요청자명*/
			        A.RQS_TIT_NM,	/*요청제목명*/
			        A.RQS_TXT, 		/*요청내용*/
			        A.HNDL_DT, 		/*처리일*/
			        A.HNDL_PEN_CNB, 	/*처리자전산번호*/
			        (SELECT USR_NAM 
			        FROM TBDCMACM001M Z
			        WHERE A.HNDL_PEN_CNB = Z.CNB
			        ) AS HNDL_PEN_NAM,		/*처리자명*/
			        A.HNDL_TXT, 		/*처리내용*/
			        (SELECT DOC_ID FROM TBCSPACP002M Z 
			        WHERE Z.GDS_RQS_SNO = A.GDS_RQS_SNO 
			        AND Z.GDS_RQS_ATT_FL_DVSN_CD = '1') AS RQS_DOC_ID,	/*요청문서ID*/
			        (SELECT DOC_ID FROM TBCSPACP002M Z 
			        WHERE Z.GDS_RQS_SNO = A.GDS_RQS_SNO 
			        AND Z.GDS_RQS_ATT_FL_DVSN_CD = '2') AS HNDL_DOC_ID,	/*처리문서ID*/
			        F_DPT_INFO(A.RQS_DPT_CD,'1') AS RQS_DPT_NM,
			        (SELECT	TNB
			        FROM	TBDCMACM001M
			        WHERE	CNB = A.RQR_CNB ) AS TNB,
			        A.HNDL_PEN_CNB AS OLD_HNDL_PEN_CNB
			FROM	TBCSPACP001M A
        	WHERE 	A.GDS_RQS_SNO = #strGDS_RQS_SNO# AND A.GDS_KBN='1'
		]]>
	</select>
	
	
	<!-- 전산장애 요청 년도, 요청연번 Max값 가져오기 -->
	<select id="CSPACP002EKeySelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* csp/acp/002/CSPACP002EKeySelect */ ]]>
        <![CDATA[     	
			SELECT  TO_CHAR(NVL(MAX(TO_NUMBER(GDS_RQS_SNO)),0)+1) AS GDS_RQS_SNO
			FROM    TBCSPACP001M WHERE GDS_KBN='1'
		]]>
	</select>
	
	
	<insert id="CSPACP002EMainInsert" parameterClass="paramMap">
		<![CDATA[  /* csp/acp/002/CSPACP002EMainInsert */ ]]>
        <![CDATA[
        	INSERT INTO TBCSPACP001M
        	(		
        			GDS_KBN,
        			GDS_RQS_SNO,	/*물품요청순번*/
        			GDS_DVSN_CD,	/*물품구분코드*/
        			RQS_DT,			/*요청일*/
        			RQS_DPT_CD,		/*요청부서*/
        			RQR_CNB,		/*요청자전산번호*/
        			RQS_TIT_NM,		/*요청제목명*/
        			RQS_TXT,		/*요청내용*/
        			FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
        	) VALUES (
        			'1',
        			#GDS_RQS_SNO#,
	        		#GDS_DVSN_CD#,
	        		#RQS_DT#,
	        		F_USR_INFO(#RQR_CNB#,'5'),
	        		#RQR_CNB#,
	        		#RQS_TIT_NM#,
	        		#RQS_TXT#,
	        		#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE
        	)
        ]]>
	</insert>
	
	
	<insert id="CSPACP002ERqsFileInsert" parameterClass="paramMap">
		<![CDATA[  /* csp/acp/002/CSPACP002ERqsFileInsert */ ]]>
        <![CDATA[
        	INSERT INTO TBCSPACP002M
        	(
        			GDS_RQS_SNO,			/*물품요청순번*/
        			GDS_RQS_ATT_FL_DVSN_CD,	/*물품요청첨부파일구분코드*/
        			DOC_ID,			/*요청일*/
        			FRT_USR_ID,
        			FNL_USR_ID,
        			FNL_DEAL_DPT_CD,
        			FNL_MNU_ID,
        			FRT_REGI_DH,
        			FNL_MDF_DH
        	) VALUES (
        			#GDS_RQS_SNO#,
	        		'1',
	        		#RQS_DOC_ID#,
	        		#FRT_USR_ID#,
	        		#FNL_USR_ID#,
	        		#FNL_DEAL_DPT_CD#,
	        		#FNL_MNU_ID#,
	        		SYSDATE,
	        		SYSDATE
        	)
        ]]>
	</insert>
	
	
	<insert id="CSPACP002EHndlFileInsert" parameterClass="paramMap">
		<![CDATA[  /* csp/acp/002/CSPACP002EHndlFileInsert */ ]]>
        <![CDATA[
        	INSERT INTO TBCSPACP002M
        	(	
        			GDS_RQS_SNO,			/*물품요청순번*/
        			GDS_RQS_ATT_FL_DVSN_CD,		/*물품요청첨부파일구분코드*/
        			DOC_ID,			/*요청일*/
        			FRT_USR_ID,
        			FNL_USR_ID,
        			FNL_DEAL_DPT_CD,
        			FNL_MNU_ID,
        			FRT_REGI_DH,
        			FNL_MDF_DH
        	) VALUES (
        			#GDS_RQS_SNO#,
	        		'2',
	        		#HNDL_DOC_ID#,
	        		#FRT_USR_ID#,
	        		#FNL_USR_ID#,
	        		#FNL_DEAL_DPT_CD#,
	        		#FNL_MNU_ID#,
	        		SYSDATE,
	        		SYSDATE
        	)
        ]]>
	</insert>
	
	
	<update id="CSPACP002EMainUpdate" parameterClass="paramMap">
		<![CDATA[  /* csp/acp/002/CSPACP002EMainUpdate */ ]]>
		<![CDATA[
			UPDATE 	TBCSPACP001M
			SET		GDS_DVSN_CD = #GDS_DVSN_CD# ,	/*물품구분코드*/
					RQS_DT = #RQS_DT#,			/*요청일*/
					RQR_CNB = #RQR_CNB#,		/*요청자전산번호*/
					RQS_DPT_CD = F_USR_INFO(#RQR_CNB#,'5'),	/*요청자부서코드*/
					RQS_TIT_NM = #RQS_TIT_NM#,	/*요청제목명*/
					RQS_TXT = #RQS_TXT#,		/*요청내용*/
					HNDL_DT = #HNDL_DT#,	/*처리일*/
					HNDL_PEN_CNB = #HNDL_PEN_CNB#, /*처리자전산번호*/
					HNDL_TXT = #HNDL_TXT#,	/*처리내용*/
					FNL_USR_ID = #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID = #FNL_MNU_ID#,
					FNL_MDF_DH = SYSDATE
			WHERE	GDS_RQS_SNO = #GDS_RQS_SNO# AND GDS_KBN = '1'
		]]>
	</update>
	
	
	<delete id="CSPACP002EMainDelete" parameterClass="paramMap">
		<![CDATA[  /* csp/acp/002/CSPACP002EMainDelete */ ]]>
		<![CDATA[
			DELETE	TBCSPACP001M
			WHERE	GDS_RQS_SNO = #GDS_RQS_SNO# AND GDS_KBN = '1'
		]]>
	</delete>
	
	
	<delete id="CSPACP002EFileDelete" parameterClass="paramMap">
		<![CDATA[  /* csp/acp/002/CSPACP002EFileDelete */ ]]>
		<![CDATA[
			DELETE	TBCSPACP002M
			WHERE	GDS_RQS_SNO = #GDS_RQS_SNO#
		]]>
	</delete>
	
	
	
</sqlMap>