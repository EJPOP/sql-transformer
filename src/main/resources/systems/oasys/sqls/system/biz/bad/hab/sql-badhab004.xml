<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<!-- 감사사무처리부관리(자동)  -->
<sqlMap namespace="bad/hab/004">
	<!-- 이관내역 조회-->
	<select id="BADHAB004QTrfHisselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT YR					/*년도*/
				 , TSK_DVSN_CD			/*업무구분코드*/
				 , F_CODE_NM ('1000406', TSK_DVSN_CD) AS TSK_DVSN_NM	/*업무구분*/
				 , SNO					/*순번*/
				 , FNL_YN				/*최종여부*/
				 , REF_YR				/*참조연도*/
				 , REF_SRNO			    /*참조일련번호*/
				 , REF_DPT_CD			/*참조부서코드*/
				 , F_DPT_INFO(REF_DPT_CD, '1') AS REF_DPT_NM 	/*참조부서*/
				 , REF_ORG_CD			/*참조기관코드*/
				 , F_ORG_INFO(REF_ORG_CD, '1') AS REF_ORG_NM	/*참조기관*/
				 , REF_DVSN_CD		    /*참조구분코드*/
				 , TRF_BEF_CHR_DPT_CD	/*이관전담당부서코드*/
				 , F_DPT_INFO(TRF_BEF_CHR_DPT_CD, '1') AS TRF_BEF_CHR_DPT_NM	/*이관전담당부서*/
				 , TRF_AF_CHR_DPT_CD	/*이관이후담당부서코드*/
				 , F_DPT_INFO(TRF_AF_CHR_DPT_CD, '1') AS TRF_AF_CHR_DPT_NM	/*이관후담당부서*/
				 , TRF_DT				/*이관일*/
				 , TRF_TXT			    /*이관내용*/
				 , HNDL_CHGR_CNB		/*처리담당자전산번호*/
				 , F_USR_INFO(HNDL_CHGR_CNB, '2') AS HNDL_CHGR_NM	/*처리담당자*/
				 , TIT_NM   /* 이관제목 */
				 , CASE WHEN TRF_AF_CHR_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
				         AND TRF_AF_CHR_DPT_CD = NVL(#strDptCd2#, TRF_AF_CHR_DPT_CD)  THEN 'Y'
				        ELSE 'N' END AS MYSELF_YN
			  FROM TBBADHAB002H
			 WHERE FNL_YN	= 'Y'
               AND (TRF_AF_CHR_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
                 OR TRF_BEF_CHR_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#))))
		]]>
		<isNotEmpty property="strYr">	 
			   AND YR = #strYr#
		</isNotEmpty>
			   
		<isNotEmpty property="strDptCd2">
        	   AND (TRF_AF_CHR_DPT_CD = #strDptCd2#
        	     OR TRF_BEF_CHR_DPT_CD = #strDptCd2#)
        </isNotEmpty> 		
		<isNotEmpty property="strOwHndlSuCd">	 	
			   AND TSK_DVSN_CD = #strOwHndlSuCd#
		</isNotEmpty>
		
        <![CDATA[       
			  ORDER BY TSK_DVSN_CD, SNO DESC
        ]]>
	</select>
</sqlMap> 
