<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/cav/051"> 
	 
	<parameterMap id="prcAmCCountParm" class="java.util.HashMap">
		<parameter property="I_COPT_CD"		jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="I_ACNT_CD"		jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="I_BLL_CD"	    jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="I_PROF_DRTR_SRNO"	jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="I_DL_XPN_RCDB_PBSVT_SRNO"	jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="I_PROV_YEAR"	jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="I_PROV_MON"	jdbcType="VARCHAR"	javaType="java.lang.String" mode="IN" />
		<parameter property="vRetCode"	jdbcType="VARCHAR"	javaType="java.lang.String" mode="OUT" />
		<parameter property="vUserMessage"	jdbcType="VARCHAR"	javaType="java.lang.String" mode="OUT" />		
	</parameterMap>
		
	<!-- delete-->
	<procedure id="FAACAV051EMainDelete" parameterMap="prcAmCCountParm">
		<![CDATA[  /* faa/cav/051/FAACAV051EMainDelete */ ]]>
		{ CALL PRC_AV_ACCOUNT_DELETE(?, ?, ?, ?, ?, ?, ?,?,?) }
	</procedure>
	
	
	<select id="FAACAV051EMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/051/FAACAV051MMainSelect */ ]]>
		SELECT  A.COPT_CD||'-'||A.ACNT_CD||'-'||A.BLL_CD||'-'||A.PROF_DRTR_SRNO||'-'||A.DL_XPN_RCDB_PBSVT_SRNO AS ACCMN_ID,
		        A.ORG_NM,
		        F_AV_BLL_COPT_CD_NM(A.COPT_CD) AS COPT_NM,
		        F_AV_ACNT_CD_NM(A.ACNT_CD) AS ACNT_NM,
		        (SELECT  ACNT_CD_NM
		        FROM    TWFAACAV024C
		        WHERE   ACNT_DVSN_CD = '30'
		        AND     ACNT_CD = #strBllCd#|| CASE WHEN #strDlXpnRcdbPbsvtSrno# = '000' THEN '000' WHEN #strDlXpnRcdbPbsvtSrno# != '000' THEN 'XXX' END) AS BLL_NM,
		        A.CRE_DT,
		        A.ABLT_DT,
		        A.MDF_PEN_NM,
		        A.BZN,
		        A.TNB,
		        A.AD
		FROM    TWFAACAV003M A,
		        TWFAACAV001M B
		WHERE   A.COPT_CD = B.COPT_CD
		AND     A.ACNT_CD = B.ACNT_CD
		AND     A.BLL_CD  = B.BLL_CD
		AND     A.PROF_DRTR_SRNO = B.PROF_DRTR_SRNO
		AND     A.DL_XPN_RCDB_PBSVT_SRNO = B.DL_XPN_RCDB_PBSVT_SRNO
		AND     B.COPT_CD = #strCoptCd#
		AND     B.ACNT_CD = #strAcntCd#
		AND     B.BLL_CD  = #strBllCd#
		AND     B.PROF_DRTR_SRNO = #strProfDrtrSrno#
		AND     B.DL_XPN_RCDB_PBSVT_SRNO = #strDlXpnRcdbPbsvtSrno#
		AND     B.PROF_YM = #strProfYm#
	</select>
		

</sqlMap> 
