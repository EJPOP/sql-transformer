<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/419">
 	
	<resultMap class="java.util.HashMap" id="CSPDCP419PMainSelect">
		<result property="REQ_DVSN_CD" 		column="REQ_DVSN_CD" 		jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ACP_YR" 			column="ACP_YR" 			jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="CVPT_ACP_NO" 		column="CVPT_ACP_NO" 		jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="HMP_TRNM_HST_SRNO" column="HMP_TRNM_HST_SRNO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DGE" 				column="DGE" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TRNM_DH" 			column="TRNM_DH" 			jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TRNM_CMPT_YN" 	column="TRNM_CMPT_YN" 		jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="IF_ID" 			column="IF_ID" 				jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TRNM_TXT" 		column="TRNM_TXT" 			jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ANS_TXT" 			column="ANS_TXT" 			jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	<!-- 홈페이지 통보이력 : 답변만 보임 -->
 	<select id="CSPDCP419PMainSelect" parameterClass="paramMap" 	resultMap="CSPDCP419PMainSelect">
		<![CDATA[
			SELECT	/*CSPDCP419PMainSelect*/
					D1.REQ_DVSN_CD
					,D1.ACP_YR
					,D1.CVPT_ACP_NO
					,D1.HMP_TRNM_HST_SRNO
					,D1.DGE
					,TO_CHAR(TRNM_DH, 'YYYY-MM-DD') AS TRNM_DH
					,D1.TRNM_CMPT_YN
					,D1.IF_ID
					,D1.TRNM_TXT
					,D1.ANS_TXT
			FROM 	TBCSPDCP305H D1
			WHERE	D1.REQ_DVSN_CD = #strREQ_DVSN_CD#
			AND		D1.ACP_YR = #strACP_YR#
			AND		D1.CVPT_ACP_NO = #strCVPT_ACP_NO#
			AND		(D1.IF_ID = 'EH_INF-SP-CP-012' OR D1.IF_ID IS NULL)
			ORDER 	BY  D1.TRNM_DH DESC
		]]>
	</select>
	
	<insert id="CSPDCP419PImsiInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO /*CSPDCP419PImsiInsert*/
						TBCSPDCP305H
			(
				 REQ_DVSN_CD
				,ACP_YR
				,CVPT_ACP_NO
				,HMP_TRNM_HST_SRNO
				,DGE
				,TRNM_DH
				,TRNM_CMPT_YN
				,IF_ID
				,TRNM_TXT
				,ANS_TXT
				,FRT_USR_ID
				,FNL_USR_ID
				,FNL_DEAL_DPT_CD
				,FNL_MNU_ID
				,FRT_REGI_DH
				,FNL_MDF_DH
			)
			VALUES
			(
				 #REQ_DVSN_CD#
				,#ACP_YR#
				,#CVPT_ACP_NO#
				,#HMP_TRNM_HST_SRNO#
				,#DGE#
				,SYSDATE
				,'N'
				,#IF_ID#
				,#TRNM_TXT#
				,#ANS_TXT#
				,#FRT_USR_ID#
				,#FNL_USR_ID#
				,#FNL_DEAL_DPT_CD#
				,#FNL_MNU_ID#
				,SYSDATE
				,SYSDATE
			)
		]]>
	</insert>
	
	<update id="CSPDCP419PImsiUpdate" parameterClass="paramMap" >
		<![CDATA[
			UPDATE 	TBCSPDCP305H
			SET 	ANS_TXT = #ANS_TXT#
					,FNL_MDF_DH = SYSDATE
					,FNL_USR_ID = #FNL_USR_ID#
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID = #FNL_MNU_ID#
			WHERE	1=1
			AND		REQ_DVSN_CD = #REQ_DVSN_CD#
			AND		ACP_YR = #ACP_YR#
			AND		CVPT_ACP_NO = #CVPT_ACP_NO#
			AND		HMP_TRNM_HST_SRNO =#HMP_TRNM_HST_SRNO#
		]]>
	</update>

	<delete id="CSPDCP419PImsiDelete" parameterClass="paramMap">
	<![CDATA[
		      DELETE 
                FROM TBCSPDCP305H
               WHERE 1=1
                 AND REQ_DVSN_CD 		= #REQ_DVSN_CD#
                 AND ACP_YR      		= #ACP_YR#
                 AND CVPT_ACP_NO 		= #CVPT_ACP_NO#
                 AND HMP_TRNM_HST_SRNO 	= #HMP_TRNM_HST_SRNO#
	]]>
	</delete>
	
 	<select id="CSPDCP419PKeySelect" parameterClass="paramMap" 	resultClass="resultMap">
		<![CDATA[
			SELECT /*CSPDCP419PKeySelect*/
				   NVL(MAX(D1.HMP_TRNM_HST_SRNO),0)+1 AS HMP_TRNM_HST_SRNO
			  FROM TBCSPDCP305H D1
			 WHERE 1=1
			   AND D1.REQ_DVSN_CD = #REQ_DVSN_CD#
			   AND D1.ACP_YR      = #ACP_YR#
			   AND D1.CVPT_ACP_NO = #CVPT_ACP_NO#
		]]>
	</select>
	

</sqlMap> 
