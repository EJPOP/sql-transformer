<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/cis/001">
	
	<select id="CSPCIS002EKeySelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT 	NVL(MAX(INSP_REGI_NO)+1,1) AS INSP_REGI_NO
			FROM	TBCSPCIS001M
		]]>
	</select>
	
	<select id="CSPCIS001QAuthCheck" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(COUNT(*)) AS CNT
			FROM TBDCMACM001M 
			WHERE PST_CD = '0067400' /* 직위가 원장 */
			AND RSG_DT IS NULL /* 퇴사자가 아니고 */
			AND RQS_STA_CD = '3' /* 신청상태가 승인 */
			AND INN_RANK_CD = '11' /* 내부직급코드 원장, 교육원장/연구원장은 내부직급코드가 실국장임 */
			AND CNB = #cnb#
		]]>
	</select>
	
	<insert id="CSPCIS002EInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPCIS001M
			(
				 INSP_REGI_DT
				,INSP_REGI_NO
				,INSP_LVL_CNT
				,INSP_DVSN_CD
				,INSP_TIT_ENN
				,INSP_ENTX
				,INSP_ECN
				,INSP_USR_EID
				,INSP_USR_NAM
				,INSP_ATT_FL_EID
				,STA_YN
				
			)
			VALUES
			(
				 #INSP_REGI_DT#
				,#INSP_REGI_NO#
				,0
				,#INSP_DVSN_CD#
				,#INSP_TIT_ENN#
				,#INSP_ENTX#
				,#INSP_ECN#
				,#INSP_USR_EID#
				,#INSP_USR_NAM#
				,#INSP_ATT_FL_EID#
				,'N'
				
			)
		]]>
	</insert>
	
	<update id="CSPCIS002EUpdate" parameterClass="paramMap" >
		<![CDATA[
		 UPDATE TBCSPCIS001M
			SET  INSP_DVSN_CD 	= #INSP_DVSN_CD#
				,INSP_TIT_ENN 	= #INSP_TIT_ENN#
				,INSP_ENTX		= #INSP_ENTX#
				,INSP_ECN		= #INSP_ECN#
				,INSP_USR_EID	= #INSP_USR_EID#
				,INSP_USR_NAM	= #INSP_USR_NAM#
				,INSP_ATT_FL_EID= #INSP_ATT_FL_EID#
				,STA_YN			= 'N'
			WHERE	INSP_REGI_DT    =   #INSP_REGI_DT#
			  AND	INSP_REGI_NO    =   #INSP_REGI_NO#
			  AND	INSP_LVL_CNT    =   0
		]]>
	</update>
	
	<resultMap class="java.util.HashMap" id="CSPCIS002EMainSelectMap">
		<result property="INSP_REGI_DT" column="INSP_REGI_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_REGI_NO" column="INSP_REGI_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_LVL_CNT" column="INSP_LVL_CNT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DVSN_CD" column="INSP_DVSN_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_TIT_ENN" column="INSP_TIT_ENN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ENTX" column="INSP_ENTX" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ECN" column="INSP_ECN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_EID" column="INSP_USR_EID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_NAM" column="INSP_USR_NAM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ATT_FL_EID" column="INSP_ATT_FL_EID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DOC_TYP_CD" column="INSP_DOC_TYP_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="STA_YN" column="STA_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	<select id="CSPCIS002EMainSelect" parameterClass="paramMap" resultMap="CSPCIS002EMainSelectMap">
		<![CDATA[
			SELECT	
					INSP_REGI_DT,
					INSP_REGI_NO,
					INSP_LVL_CNT,
					INSP_DVSN_CD,
					INSP_TIT_ENN,
					INSP_ENTX,
					INSP_ECN,
					INSP_USR_EID,
					INSP_USR_NAM,
					INSP_ATT_FL_EID,
					INSP_DOC_TYP_CD,
					STA_YN
			  FROM 	TBCSPCIS001M
			 WHERE	1=1
			   AND	INSP_REGI_DT = #INSPREGIDT#
			   AND	INSP_REGI_NO = #INSPREGINO#
			   AND	INSP_LVL_CNT = 0
		]]>
	</select>
	
	<select id="CSPCIS002ESaveSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
		   SELECT	NVL(MAX(INSP_REGI_DT), TO_CHAR(SYSDATE, 'YYYYMMDD')) AS INSPREGIDT,
			       	NVL(MAX(INSP_REGI_NO) +1, 1) AS INSPREGINO
			 FROM 	TBCSPCIS001M 
			WHERE 	INSP_REGI_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
			  AND 	INSP_LVL_CNT = 0
		]]>
	</select>
	
	<select id="CSPCIS002EUpdateDeleteYn" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT 	STA_YN FROM TBCSPCIS001M 
			 WHERE	INSP_REGI_DT    =   #INSP_REGI_DT#
			   AND	INSP_REGI_NO    =   #INSP_REGI_NO#
			   AND 	INSP_LVL_CNT 	= 	'0'
		]]>
	</select>
	
	<select id="CSPCIS001QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			 SELECT A.INSP_REGI_DT,
			        A.INSP_REGI_NO,
			        A.INSP_LVL_CNT,
			        A.INSP_DVSN_CD,
			        A.INSP_TIT_ENN,
			        A.INSP_ECN,
			        A.INSP_USR_EID,
			        A.INSP_USR_NAM,
			        A.INSP_ATT_FL_EID,
			        A.INSP_DOC_TYP_CD,
			        A.STA_YN
			   FROM TBCSPCIS001M A
			  WHERE 1=1
			  AND (A.INSP_ECN = #cnb#
			  OR (A.INSP_REGI_DT , A.INSP_REGI_NO) 
			  IN (SELECT  A.INSP_REGI_DT , A.INSP_REGI_NO  FROM TBCSPCIS001M A WHERE A.INSP_ECN = #cnb#))
		]]>
			<dynamic>
				<isNotEmpty property="dvsn">
			   		AND	INSP_DVSN_CD = #dvsn#
			    </isNotEmpty>
				<isNotEmpty property="fromYmd">
			   		AND	INSP_REGI_DT &gt;= #fromYmd#
			    </isNotEmpty>
				<isNotEmpty property="toYmd">
			   		AND	INSP_REGI_DT &lt;= #toYmd#
			    </isNotEmpty>
			</dynamic>
		<![CDATA[
			 ORDER	BY INSP_REGI_DT DESC, INSP_REGI_NO DESC, INSP_LVL_CNT
		]]>
	</select>
	
	<select id="CSPCIS005QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			 SELECT INSP_REGI_DT,
			        INSP_REGI_NO,
			        INSP_LVL_CNT,
			        INSP_DVSN_CD,
			        INSP_TIT_ENN,
			        INSP_ECN,
			        INSP_USR_EID,
			        INSP_USR_NAM,
			        INSP_ATT_FL_EID,
			        INSP_DOC_TYP_CD,
			        DECODE(INSP_LVL_CNT, 0, STA_YN, '') AS STA_YN
			   FROM TBCSPCIS001M
			 WHERE	1=1
		]]>
			<dynamic>
				<isNotEmpty property="name">
				    AND (INSP_USR_NAM like '%' || #name# || '%' 
				         or (INSP_REGI_DT , INSP_REGI_NO) 
				         IN (SELECT  A.INSP_REGI_DT , A.INSP_REGI_NO  FROM TBCSPCIS001M A WHERE A.INSP_USR_NAM like '%' || #name# || '%')
				        )
			    </isNotEmpty>
				<isNotEmpty property="dvsn">
			   		AND	INSP_DVSN_CD = #dvsn#
			    </isNotEmpty>
				<isNotEmpty property="fromYmd">
			   		AND	INSP_REGI_DT &gt;= #fromYmd#
			    </isNotEmpty>
				<isNotEmpty property="toYmd">
			   		AND	INSP_REGI_DT &lt;= #toYmd#
			    </isNotEmpty>
				<isNotEmpty property="title">
				    AND (INSP_TIT_ENN like '%' || #title# || '%' 
				         or (INSP_REGI_DT , INSP_REGI_NO) 
				         IN (SELECT  A.INSP_REGI_DT , A.INSP_REGI_NO  FROM TBCSPCIS001M A WHERE A.INSP_TIT_ENN like '%' || #title# || '%')
				        )
			    </isNotEmpty>
				<isNotEmpty property="readYn">
			   		AND	STA_YN = #readYn#
			    </isNotEmpty>
			</dynamic>
		<![CDATA[
			 ORDER	BY INSP_REGI_DT DESC, INSP_REGI_NO DESC, INSP_LVL_CNT
		]]>
	</select>
	
	<select id="CSPCIS005QReportSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT 	A.INSP_REGI_DT,
				    A.INSP_REGI_NO,
				    A.INSP_LVL_CNT,
				    B.CD_NM,
				    A.INSP_TIT_ENN,
				    A.INSP_ECN,
				    A.INSP_USR_EID,
				    A.INSP_USR_NAM,
				    #fromYmd# as FROMYMD,
				    #toYmd# AS TOYMD
			  FROM 	TBCSPCIS001M A, TBDCMACM013C B
			 WHERE	1=1
			   AND	A.INSP_DVSN_CD = B.CD
			   AND	B.CMM_CD_DVSN_CD = '1000308'
			   AND	A.INSP_LVL_CNT = 0
		]]>
			<dynamic>
				<isNotEmpty property="name">
				    AND (INSP_USR_NAM like '%' || #name# || '%' 
				         or (INSP_REGI_DT , INSP_REGI_NO) 
				         IN (SELECT  A.INSP_REGI_DT , A.INSP_REGI_NO  FROM TBCSPCIS001M A WHERE A.INSP_USR_NAM like '%' || #name# || '%')
				        )
			    </isNotEmpty>
				<isNotEmpty property="dvsn">
			   		AND	INSP_DVSN_CD = #dvsn#
			    </isNotEmpty>
				<isNotEmpty property="fromYmd">
			   		AND	INSP_REGI_DT &gt;= #fromYmd#
			    </isNotEmpty>
				<isNotEmpty property="toYmd">
			   		AND	INSP_REGI_DT &lt;= #toYmd#
			    </isNotEmpty>
				<isNotEmpty property="title">
				    AND (INSP_TIT_ENN like '%' || #title# || '%' 
				         or (INSP_REGI_DT , INSP_REGI_NO) 
				         IN (SELECT  A.INSP_REGI_DT , A.INSP_REGI_NO  FROM TBCSPCIS001M A WHERE A.INSP_TIT_ENN like '%' || #title# || '%')
				        )
			    </isNotEmpty>
				<isNotEmpty property="readYn">
			   		AND	STA_YN = #readYn#
			    </isNotEmpty>
			</dynamic>
		<![CDATA[
			 ORDER	BY INSP_REGI_DT DESC, INSP_REGI_NO DESC, INSP_LVL_CNT
		]]>
	</select>
	
	<resultMap class="java.util.HashMap" id="CSPCIS006EMainSelectMap">
		<result property="INSP_REGI_DT" column="INSP_REGI_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_REGI_NO" column="INSP_REGI_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_LVL_CNT" column="INSP_LVL_CNT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DVSN_CD" column="INSP_DVSN_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_TIT_ENN" column="INSP_TIT_ENN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ENTX" column="INSP_ENTX" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ECN" column="INSP_ECN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_EID" column="INSP_USR_EID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_NAM" column="INSP_USR_NAM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ATT_FL_EID" column="INSP_ATT_FL_EID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DOC_TYP_CD" column="INSP_DOC_TYP_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="STA_YN" column="STA_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	<select id="CSPCIS006EMainSelect" parameterClass="paramMap" resultMap="CSPCIS006EMainSelectMap">
		<![CDATA[
			SELECT	
					INSP_REGI_DT,
					INSP_REGI_NO,
					INSP_LVL_CNT,
					INSP_DVSN_CD,
					INSP_TIT_ENN,
					INSP_ENTX,
					INSP_ECN,
					INSP_USR_EID,
					INSP_USR_NAM,
					INSP_ATT_FL_EID,
					INSP_DOC_TYP_CD,
					STA_YN
			  FROM 	TBCSPCIS001M
			 WHERE	1=1
			   AND	INSP_REGI_DT = #INSPREGIDT#
			   AND	INSP_REGI_NO = #INSPREGINO#
			   AND	INSP_LVL_CNT = 0
		]]>
	</select>
	
	<resultMap class="java.util.HashMap" id="CSPCIS006EReportSelectMap">
		<result property="INSP_REGI_DT" column="INSP_REGI_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_TIT_ENN" column="INSP_TIT_ENN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ENTX" column="INSP_ENTX" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_NAM" column="INSP_USR_NAM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_ENN" column="B_ENN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="B_ENTX" column="B_ENTX" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="CD_NM" column="CD_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	<select id="CSPCIS006EReportSelect" parameterClass="paramMap" resultMap="CSPCIS006EReportSelectMap">
		<![CDATA[
			SELECT	A.INSP_REGI_DT,
					B.CD_NM,
					A.INSP_TIT_ENN,
					A.INSP_ENTX,
					A.INSP_USR_NAM,
					(SELECT INSP_TIT_ENN FROM TBCSPCIS001M 
			 						 	WHERE 1=1
			  				 		      AND INSP_REGI_DT = #INSPREGIDT#
									      AND INSP_REGI_NO = #INSPREGINO#
									      AND INSP_LVL_CNT = 1 ) AS B_ENN,
					(SELECT INSP_ENTX FROM TBCSPCIS001M 
			 						 WHERE 1=1
			  				 		   AND INSP_REGI_DT = #INSPREGIDT#
									   AND INSP_REGI_NO = #INSPREGINO#
									   AND INSP_LVL_CNT = 1 ) AS B_ENTX
			  FROM 	TBCSPCIS001M A, TBDCMACM013C B
			 WHERE	1=1
			   AND	A.INSP_REGI_DT = #INSPREGIDT#
			   AND	A.INSP_REGI_NO = #INSPREGINO#
			   AND	A.INSP_LVL_CNT = 0
			   AND	A.INSP_DVSN_CD = B.CD
			   AND	B.CMM_CD_DVSN_CD = '1000308'
		]]>
	</select>
	
	<update id="CSPCIS006EStaYnUpdate" parameterClass="paramMap" >
		<![CDATA[
			UPDATE TBCSPCIS001M
			  SET   STA_YN			= 	'Y'
			WHERE	INSP_REGI_DT    =   #INSPREGIDT#
			  AND	INSP_REGI_NO    =   #INSPREGINO#
		]]>
	</update>
	
	
	<resultMap class="java.util.HashMap" id="CSPCIS004PMainSelectMap">
		<result property="INSP_REGI_DT" column="INSP_REGI_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_REGI_NO" column="INSP_REGI_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_LVL_CNT" column="INSP_LVL_CNT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DVSN_CD" column="INSP_DVSN_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_TIT_ENN" column="INSP_TIT_ENN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ENTX" column="INSP_ENTX" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ECN" column="INSP_ECN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_EID" column="INSP_USR_EID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_USR_NAM" column="INSP_USR_NAM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_ATT_FL_EID" column="INSP_ATT_FL_EID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSP_DOC_TYP_CD" column="INSP_DOC_TYP_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="STA_YN" column="STA_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	<select id="CSPCIS004PMainSelect" parameterClass="paramMap" resultMap="CSPCIS004PMainSelectMap">
		<![CDATA[
			SELECT	INSP_REGI_DT,
					INSP_REGI_NO,
					INSP_LVL_CNT,
					INSP_DVSN_CD,
					INSP_TIT_ENN,
					INSP_ENTX,
					INSP_ECN,
					INSP_USR_EID,
					INSP_USR_NAM,
					INSP_ATT_FL_EID,
					INSP_DOC_TYP_CD,
					STA_YN
			  FROM	TBCSPCIS001M
			 WHERE	1=1
			   AND	INSP_REGI_DT = #INSPREGIDT#
			   AND	INSP_REGI_NO = #INSPREGINO#
			   AND	INSP_LVL_CNT = #level#
		]]>
	</select>
	
	<insert id="CSPCIS004PInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPCIS001M
			(
				 INSP_REGI_DT
				,INSP_REGI_NO
				,INSP_LVL_CNT
				,INSP_DVSN_CD
				,INSP_TIT_ENN
				,INSP_ENTX
				,INSP_ECN
				,INSP_USR_EID
				,INSP_USR_NAM
				,INSP_ATT_FL_EID
				,STA_YN
				
			)
			VALUES
			(
				 #INSPREGIDT#
				,#INSPREGINO#
				,(SELECT MAX(INSP_LVL_CNT) +1 FROM TBCSPCIS001M 
				   WHERE INSP_REGI_DT = #INSPREGIDT# AND INSP_REGI_NO = #INSPREGINO#)
				,(SELECT INSP_DVSN_CD FROM TBCSPCIS001M 
				   WHERE INSP_REGI_DT = #INSPREGIDT# AND INSP_REGI_NO = #INSPREGINO# AND INSP_LVL_CNT = 0)
				,#INSP_TIT_ENN#
				,#INSP_ENTX#
				,#INSP_ECN#
				,#INSP_USR_EID#
				,#INSP_USR_NAM#
				,#INSP_ATT_FL_EID#
				,'N'
			)
		]]>
	</insert>
	
	<update id="CSPCIS004PUpdate" parameterClass="paramMap" >
		<![CDATA[
			UPDATE TBCSPCIS001M
			  SET  INSP_DVSN_CD 	= 	#INSP_DVSN_CD#
				  ,INSP_TIT_ENN 	= 	#INSP_TIT_ENN#
				  ,INSP_ENTX		= 	#INSP_ENTX#
				  ,INSP_ECN			= 	#INSP_ECN#
				  ,INSP_USR_EID		= 	#INSP_USR_EID#
				  ,INSP_USR_NAM		= 	#INSP_USR_NAM#
				  ,INSP_ATT_FL_EID	= 	#INSP_ATT_FL_EID#
				  ,STA_YN			= 	'N'
			WHERE	INSP_REGI_DT    =   #INSP_REGI_DT#
			  AND	INSP_REGI_NO    =   #INSP_REGI_NO#
			  AND	INSP_LVL_CNT    =   #INSP_LVL_CNT#
		]]>
	</update>
	
	<delete id="CSPCIS002EDelete" parameterClass="paramMap" >
		<![CDATA[
			DELETE FROM TBCSPCIS001M
			WHERE INSP_REGI_DT = #INSP_REGI_DT#
			AND INSP_REGI_NO = #INSP_REGI_NO#
		]]>
	</delete>
	
</sqlMap> 
