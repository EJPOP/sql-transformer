<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="csp/nbk/112">
	
	<select id="CSPNBK112ELendItrListSelect" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT	/* CSPNBK112ELendItrListSelect */
				D1.ITR_APC_DT
				, D1.LEND_KND_CD
				/*, F_CODE_NM( '1000330', D1.LEND_KND_CD ) AS LEND_KND_CD_NM*/
				, ( SELECT D2.CD_NM FROM TBDCMACM013C D2 WHERE D2.CMM_CD_DVSN_CD = '1000330' AND D2.CD = D1.LEND_KND_CD ) AS LEND_KND_CD_NM
				, D1.LEND_ITR
				, D1.ARR_ITR
				, D1.PIA_DVD_RTS
				, (
					CASE
						WHEN (
								SELECT	COUNT(D2.LEND_SLN) AS CNT
								FROM	TBCSPNBK203D D2
								WHERE	D2.LEND_DT >= D1.ITR_APC_DT
								AND		ROWNUM = 1
							) > 0
						THEN 'N'
						ELSE 'Y'
					END
				) AS ITR_APC_EDIT_YN
		FROM	TBCSPNBK201M D1		
	]]>
		<dynamic prepend="WHERE">
			<isNotEmpty property="lendKndCd"  prepend="AND">
				D1.LEND_KND_CD = #lendKndCd#
			</isNotEmpty>
			<isNotEmpty property="beginItrApcDt">
				<isNotEmpty property="endItrApcDt" prepend="AND">
				D1.ITR_APC_DT BETWEEN #beginItrApcDt# AND #endItrApcDt#	
				</isNotEmpty>
				<isEmpty property="endItrApcDt" prepend="AND">
				<![CDATA[
				D1.ITR_APC_DT >= #beginItrApcDt#
				]]>
				</isEmpty>
			</isNotEmpty>
			<isNotEmpty property="endItrApcDt" prepend="AND">
				<![CDATA[
				D1.ITR_APC_DT <= #endItrApcDt#
				]]>
			</isNotEmpty>
		</dynamic>
	<![CDATA[
		ORDER BY ITR_APC_DT DESC
	]]>
	</select>
	
	<insert id="CSPNBK112ELendItrListInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* CSPNBK112ELendItrListInsert */ TBCSPNBK201M
		( 
			ITR_APC_DT
			, LEND_KND_CD
			, LEND_ITR
			, ARR_ITR
			, PIA_DVD_RTS
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		VALUES
		(
			#ITR_APC_DT#
			, #LEND_KND_CD#
			, #LEND_ITR#
			, #ARR_ITR#
			, #PIA_DVD_RTS#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	]]>
	</insert>
	
	<update id="CSPNBK112ELendItrListUpdate" parameterClass="paramMap">
	<![CDATA[
		UPDATE	/* CSPNBK112ELendItrListUpdate */ TBCSPNBK201M D1
		SET		D1.LEND_ITR = #LEND_ITR#
				, D1.ARR_ITR = #ARR_ITR#
				, D1.PIA_DVD_RTS = #PIA_DVD_RTS#
				, D1.FNL_USR_ID = #FNL_USR_ID#
				, D1.FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				, D1.FNL_MNU_ID = #FNL_MNU_ID#
				, D1.FNL_MDF_DH = SYSDATE
		WHERE	D1.ITR_APC_DT = #ITR_APC_DT#
		AND		D1.LEND_KND_CD = #LEND_KND_CD#
	]]>
	</update>
	
	<delete id="CSPNBK112ELendItrListDelete" parameterClass="paramMap">
	<![CDATA[
		DELETE	/* CSPNBK112ELendItrListDelete */
		FROM	TBCSPNBK201M D1
		WHERE	D1.ITR_APC_DT = #ITR_APC_DT#
		AND		D1.LEND_KND_CD = #LEND_KND_CD#
	]]>
	</delete>
	
	<select id="CSPNBK112ELendDtChkSelect" parameterClass="paramMap" resultClass="int">
	<![CDATA[
		SELECT	/* CSPNBK112ELendDtChkSelect*/
				COUNT(LEND_KND_CD) AS CNT 
		FROM	TBCSPNBK203D D1
		WHERE	D1.LEND_KND_CD = #LEND_KND_CD#
		AND		D1.LEND_DT >= #ITR_APC_DT#
	]]>
	</select>
	
</sqlMap>