<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/fpl/004">

	<!-- 질의서목록 조회 -->
	<select id="CSPFPL004WrtQueListSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
		 SELECT D1.QSTNAI_NO AS QSTNAI_NO /*질의서번호*/,
		        D1.QSTNAI_YR AS QSTNAI_YR /*연도*/,
		        D1.QSTNAI_YR|| '-' ||D1.QSTNAI_NO AS QSTNAI_YR_NO /*질의서연번호*/,
		        D1.CMTR_NM AS CMTR_NM /*위원명*/,
		        D1.CMT_CD AS CMT_CD /*위원회명*/,
		        D1.RQ_DT AS RQ_DT /*요구일자*/,
		        D1.NTAS_RQ_MTRL_DVSN_CD AS MTRL_DVSN_CD /*자료구분코드*/,
		        D1.RQ_SHP_CD AS RQ_SHP_CD /*요구형태코드*/,
		        D1.NTAS_RQ_MTRL_HNDL_STA_CD AS NTAS_RQ_MTRL_HNDL_STA_CD /*처리상태코드*/,
		        D1.QSTNAI_TIT_NM AS QSTNAI_TIT_NM /*질의서제목*/,
		        D1.FNL_WRTANS_REGI_DT AS FNL_WRTANS_REGI_DT, /*답변서제출일자*/
		        D1.WRTANS_PRSR_NM AS WRTANS_PRSR_NM, /*답변서제출자명*/
		        D1.NTAS_SMT_DDLN_DT AS NTAS_SMT_DDLN_DT, /*국회제출기한*/
		        D1.SMT_RQ_DT     AS SMT_RQ_DT,		/*제출일자*/
   			    D1.SITT_NO     AS SITT_NO,		/*회기번호*/
			    D1.RQR_NM     AS RQR_NM,		/*요청자명*/
			    (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A1') AS QSTNAIPDF_DOC_ID,
			    (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A2') AS QSTNAIHWP_DOC_ID,
			    (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A3') AS QSTNAIETC_DOC_ID
		        
		   FROM TBCSPFPL001M D1
		  where 1=1
		]]>
		<dynamic>
			<isNotEmpty prepend="AND" property="strYear">
				D1.QSTNAI_YR =
				#strYear#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnai">
				D1.QSTNAI_NO =
				#strQstnai#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strQstnaiTitleNm">
				D1.QSTNAI_TIT_NM LIKE '%'||#strQstnaiTitleNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtrNm">
				D1.CMTR_NM LIKE '%'||#strCmtrNm#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtFrom">
				D1.RQ_DT >
				#strRqDtFrom#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqDtTo">
				D1.RQ_DT &lt;
				#strRqDtTo#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strCmtCd">
				D1.CMT_CD = #strCmtCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strMtrlDvsnCd">
				D1.NTAS_RQ_MTRL_DVSN_CD =
				#strMtrlDvsnCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strRqShpCd">
				D1.RQ_SHP_CD =
				#strRqShpCd#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="strWrtansPrsrNm">
				D1.WRTANS_PRSR_NM LIKE '%'||#strWrtansPrsrNm#||'%'
			</isNotEmpty>
		</dynamic>
		<![CDATA[       
			ORDER BY D1.QSTNAI_NO ASC
		]]>
	</select>
	<!-- 질의서목록 조회 -->
	<select id="CSPFPL004WrtQueFrfListSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
		 SELECT D1.QSTNAI_NO AS QSTNAI_NO /*질의서번호*/,
		        D1.QSTNAI_YR AS QSTNAI_YR /*연도*/,
		        D1.QSTNAI_YR|| '-' ||D1.QSTNAI_NO AS QSTNAI_YR_NO /*질의서연번호*/,
		        D1.CMTR_NM AS CMTR_NM /*위원명*/,
		        F_CODE_NM ('1000092',D1.CMT_CD)as CMT_CD,
		        D1.RQ_DT AS RQ_DT /*요구일자*/,
		        D1.NTAS_RQ_MTRL_DVSN_CD AS MTRL_DVSN_CD /*자료구분코드*/,
		        D1.RQ_SHP_CD AS RQ_SHP_CD /*요구형태코드*/,
		        D1.NTAS_RQ_MTRL_HNDL_STA_CD AS NTAS_RQ_MTRL_HNDL_STA_CD /*처리상태코드*/,
		        D1.QSTNAI_TIT_NM AS QSTNAI_TIT_NM /*질의서제목*/,
		        D1.FNL_WRTANS_REGI_DT AS FNL_WRTANS_REGI_DT,
		        D1.WRTANS_PRSR_NM AS WRTANS_PRSR_NM,
			    (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A1') AS QSTNAIPDF_DOC_ID,
			    (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A2') AS QSTNAIHWP_DOC_ID,
			    (SELECT D6.DOC_ID AS DOC_ID FROM TBCSPFPL006M D6 WHERE	D1.QSTNAI_YR=D6.QSTNAI_YR and D1.QSTNAI_NO=D6.QSTNAI_NO AND D6.NTAS_RQ_MTRL_DOC_KND_CD = 'A3') AS QSTNAIETC_DOC_ID
		        
		   FROM TBCSPFPL001M D1
		  where 1=1 and D1.QSTNAI_YR = #strQstnaiYr# and D1.QSTNAI_NO = #strQstnaiNo#
		]]>
		<![CDATA[       
			ORDER BY D1.QSTNAI_NO ASC
		]]>
	</select>	


	<resultMap class="java.util.HashMap" id="hwpDocMap">
		<result property="WRTANS_NO" column="WRTANS_NO" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="QSTNAI_YR" column="QSTNAI_YR" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="QSTNAI_NO" column="QSTNAI_NO" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="SITT_NO" column="SITT_NO" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="RQR_NM" column="RQR_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="SMT_TIT_NM" column="SMT_TIT_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="QUE_TXT" column="QUE_TXT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="CHR_DPT_NM" column="CHR_DPT_NM" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="WRTANS_REGI_DT" column="WRTANS_REGI_DT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="HWP_DOC_ID" column="HWP_DOC_ID" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="ETC_DOC_ID" column="ETC_DOC_ID" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="TOTAL_ETC_DOC_ID" column="TOTAL_ETC_DOC_ID" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="ANS_MTRL_TXT_BUT" column="ANS_MTRL_TXT_BUT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="WRTANS_TXT_BUT" column="WRTANS_TXT_BUT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="ETC_DOC_ID_BUT" column="ETC_DOC_ID_BUT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="TOTAL_ETC_DOC_ID_BUT" column="TOTAL_ETC_DOC_ID_BUT" jdbcType="VARCHAR2"
			javaType="java.lang.String" />
		<result property="WRTANS_TXT" column="WRTANS_TXT" jdbcType="CLOB"
			javaType="java.lang.String" />
		<result property="ANS_MTRL_TXT" column="ANS_MTRL_TXT" jdbcType="CLOB"
			javaType="java.lang.String" />
	</resultMap>

	<!-- 질의서목록 조회 -->
	<select id="CSPFPL004WrtQueGridListSelect" parameterClass="paramMap"
		resultMap="hwpDocMap">
        <![CDATA[       
		 select D2.WRTANS_NO as WRTANS_NO,
		        D3.QSTNAI_YR as QSTNAI_YR,
        		D3.QSTNAI_NO as QSTNAI_NO,
		        D3.SMT_TIT_NM as SMT_TIT_NM,
   			    D1.SITT_NO     AS SITT_NO,		/*회기번호*/
			    D1.RQR_NM     AS RQR_NM,		/*요청자명*/
		        D2.QUE_TXT as QUE_TXT,
		        D2.CHR_DPT_NM as CHR_DPT_NM,
		        D3.WRTANS_REGI_DT as WRTANS_REGI_DT,
		        ( SELECT D7.DOC_ID AS DOC_ID
		             FROM TBCSPFPL007M D7
		            WHERE D2.QSTNAI_YR=D7.QSTNAI_YR
		              and D2.QSTNAI_NO=D7.QSTNAI_NO
		              and D2.DTIL_ANS_NO=D7.DTIL_ANS_NO
		              and D2.DTIL_DVSN_NO=D7.DTIL_DVSN_NO
		              AND D7.NTAS_RQ_MTRL_DOC_KND_CD = 'B1') AS HWP_DOC_ID,
		        D2.ANS_MTRL_TXT AS ANS_MTRL_TXT,
		        '답변자료' AS ANS_MTRL_TXT_BUT,
		        '답변자료첨부파일' AS ETC_DOC_ID_BUT,
		        ( SELECT D7.DOC_ID AS DOC_ID
		             FROM TBCSPFPL007M D7
		            WHERE D2.QSTNAI_YR=D7.QSTNAI_YR
		              and D2.QSTNAI_NO=D7.QSTNAI_NO
		              and D2.DTIL_ANS_NO=D7.DTIL_ANS_NO
		              and D2.DTIL_DVSN_NO=D7.DTIL_DVSN_NO
		              AND D7.NTAS_RQ_MTRL_DOC_KND_CD = 'B2') AS ETC_DOC_ID,
		        D3.GTR_TXT as WRTANS_TXT,
		        '답변서' as WRTANS_TXT_BUT,
		        '답변서첨부파일' as TOTAL_ETC_DOC_ID_BUT,
		        ( SELECT D8.DOC_ID AS DOC_ID
		             FROM TBCSPFPL008M D8
		            WHERE D3.QSTNAI_YR=D8.QSTNAI_YR
		              and D3.QSTNAI_NO=D8.QSTNAI_NO
		              and D3.WRTANS_NO=D8.WRTANS_NO
		              AND D8.NTAS_RQ_MTRL_DOC_KND_CD = 'C2') AS TOTAL_ETC_DOC_ID
		   from tbcspfpl002m D2,
		        tbcspfpl003m D3,
		        tbcspfpl001m D1
		  where 1=1
		    and d2.QSTNAI_YR = #strQstnaiYr#
		    and d2.QSTNAI_NO = #strQstnaiNo#
		    and d2.QSTNAI_YR = d3.QSTNAI_YR
		    and d2.QSTNAI_NO = d3.QSTNAI_NO
		    and d3.QSTNAI_YR = d1.QSTNAI_YR
		    and d3.QSTNAI_NO = d1.QSTNAI_NO
		    and d2.WRTANS_NO = d3.WRTANS_NO
		  
		]]>
		<![CDATA[       
			order by d2.WRTANS_NO asc; 
		]]>
	</select>	
	
</sqlMap> 