<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="csp/bii/174">

	<!-- 마일리지내역 조회-->
	<select id="CSPBII174QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT USR_NAM
			      ,RANK_NM
			      ,DTM_YN
			      ,DPT_NM
			      ,SMT_NOC
			      ,SMT_NOC_CPT
			      ,SMT_DEL_CPT
			      ,WRK_MN_CNT
			      ,SMT_DPT_WRK_YN_1
			      ,SMT_DPT_WRK_YN_2
			      ,SMT_DPT_WRK_YN_3
			      ,SMT_DPT_WRK_YN_4
			      ,SMT_DPT_WRK_YN_5
			      ,SMT_DPT_WRK_YN_6
			      ,YE
			      ,QR_DVSN_CD
			      ,CNB
			      ,HOM_TNB
			      ,CRNT_DPT_APM_DT
			      ,PST_NM
			      ,EVL_RSLT_CD
			      ,SMT_TSC_CNT
			      ,SMT_TOT_NOC
			      ,CRNT_RANK_APM_DT
			      ,GEN_ADMN_DVSN_NM
			      ,SMT_DT1
			      ,(SELECT MIN(M.SMT_DT)
                      FROM TBCSPBII100M M
                     WHERE M.PRSR_CNB = AA.CNB
                       AND M.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt#
                       AND M.SRNO != AA.SRNO ) AS SMT_DT2
			      ,SC_RANK
			      ,MLG_RMK
			FROM (
			SELECT B.USR_NAM
			     , F_CODE_NM('1000173', B.RANK_CD)             AS RANK_NM
			     , A.DTM_YN
			     , C.ABR_DPT_NM_1 AS DPT_NM
			     , (SELECT count(*) FROM TBCSPBII100M M WHERE M.PRSR_CNB = A.CNB 
			           AND M.AUD_INF_PRSS_STA_CD NOT IN ('15','20','99') 
                       AND M.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt#
                       AND M.AUD_INF_PRSS_STA_CD >= '05') AS SMT_NOC /* 제출건수(평가중) */
			     , (SELECT count(*) FROM TBCSPBII100M M WHERE M.PRSR_CNB = A.CNB AND M.AUD_INF_PRSS_STA_CD IN ('15','20','99') 
                       AND M.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt#
                       AND M.AUD_INF_PRSS_STA_CD >= '05'
                       AND M.HNDL_ORD_CD != '7') AS SMT_NOC_CPT /* 제출건수(평가완료) */
				 , (SELECT count(*) FROM TBCSPBII100M M WHERE M.PRSR_CNB = A.CNB AND M.AUD_INF_PRSS_STA_CD IN ('15','20','99') 
				       AND M.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt#
                       AND M.AUD_INF_PRSS_STA_CD >= '05'
				       AND M.HNDL_ORD_CD = '7' ) AS SMT_DEL_CPT /* 폐기건수 */
			     , A.MLG_RMK                                                     /* 마일리지비고 */
			     , DECODE(A.SMT_DPT_WRK_YN_1, '1', 1, 0)
			     + DECODE(A.SMT_DPT_WRK_YN_2, '1', 1, 0)
			     + DECODE(A.SMT_DPT_WRK_YN_3, '1', 1, 0)
			     + DECODE(A.SMT_DPT_WRK_YN_4, '1', 1, 0)
			     + DECODE(A.SMT_DPT_WRK_YN_5, '1', 1, 0)
			     + DECODE(A.SMT_DPT_WRK_YN_6, '1', 1, 0)       AS WRK_MN_CNT     /* 근무월수 */
			     , CASE A.SMT_DPT_WRK_YN_1 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_1 /* 제출부서근무여부1 */
			     , CASE A.SMT_DPT_WRK_YN_2 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_2 /* 제출부서근무여부2 */
			     , CASE A.SMT_DPT_WRK_YN_3 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_3  /* 제출부서근무여부3 */
			     , CASE A.SMT_DPT_WRK_YN_4 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_4 /* 제출부서근무여부4 */
			     , CASE A.SMT_DPT_WRK_YN_5 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_5 /* 제출부서근무여부5 */
			     , CASE A.SMT_DPT_WRK_YN_6 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_6 /* 제출부서근무여부6 */
			     , A.YE
			     , A.QR_DVSN_CD
			     , A.CNB
			     , B.HOM_TNB
			     , (SELECT CRNT_GD_APM_DT
                    FROM TBDCMACM903O S1
                    WHERE S1.EIN = B.EIN) AS CRNT_DPT_APM_DT
			     , F_CODE_NM('1000176',B.PST_CD)  AS PST_NM
			     , NVL(EVL_RSLT_CD,'0') AS EVL_RSLT_CD
			     , A.SMT_TSC_CNT
			     , A.SMT_TOT_NOC
			     , B.CRNT_RANK_APM_DT
			     , CASE WHEN C.DPT_CD IN ('062500','062600','062700','062800','170300','170320','071100','071300','180100','180110','100100','081100','081200','081300','081400','081500','081600','081700','081800','081900','0L0100','0L0200','0L0300') 
		                        						THEN '감사' 
		                        				ELSE DECODE(C.DPT_TP_CD,'A','감사','지원') END  AS GEN_ADMN_DVSN_NM
				 , D.SMT_DT AS SMT_DT1
				 , (SELECT MAX(S.SRNO) FROM TBCSPBII100M S WHERE S.PRSR_CNB = A.CNB AND S.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND S.SMT_DT = D.SMT_DT ) AS SRNO
				 , SC_RANK
			  FROM TBCSPBII160L A
			     , TBDCMACM001M B
			     , TBDCMACM002M C
		         , (SELECT MIN(SMT_DT) AS SMT_DT, PRSR_CNB FROM TBCSPBII100M 
		             WHERE SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt# GROUP BY PRSR_CNB) D			     
			 WHERE A.CNB = B.CNB
			   AND A.CNB = D.PRSR_CNB(+)
			   AND A.YE = #strYe#  
			   AND A.QR_DVSN_CD = #strQrDvsnCd#
			   AND nvl(A.DPT_CD,B.DPT_CD) = C.DPT_CD
		]]>
		
		<!-- 성명 -->
		<isNotEmpty property="strMlgCnb">
			AND A.CNB = #strMlgCnb#
		</isNotEmpty>
		
		<dynamic prepend="AND ( 1=1 ">
		<isEmpty property="strDptCheck">
			<isNotEmpty property="strDPT_YN">
				AND
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD" prepend="OR">
				B.DPT_CD = #strDPT_CD#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD2" prepend="OR">
				B.DPT_CD = #strDPT_CD2#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD3" prepend="OR">
				B.DPT_CD = #strDPT_CD3#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD4" prepend="OR">
				B.DPT_CD = #strDPT_CD4#
			</isNotEmpty>
			        )
		</isEmpty>
		</dynamic>
		<dynamic prepend="AND ( 1=1 AND ">
		<isNotEmpty property="strDptCheck">
			<isNotEmpty property="strDPT_CD" prepend="AND">
				B.DPT_CD != #strDPT_CD#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD2" prepend="AND">
				B.DPT_CD != #strDPT_CD2#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD3" prepend="AND">
				B.DPT_CD != #strDPT_CD3#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD4" prepend="AND">
				B.DPT_CD != #strDPT_CD4#
			</isNotEmpty>
			        )
		</isNotEmpty>
		</dynamic>
		
		<isNotEmpty property="strMlgRmk">
			AND A.MLG_RMK LIKE '%'||#strMlgRmk#||'%'
		</isNotEmpty>
		
		<isEqual property="strSmtTp" compareValue="Y">
			AND A.SMT_TOT_NOC <![CDATA[>]]> 0
		</isEqual>
		<isEqual property="strSmtTp" compareValue="N">
			AND A.SMT_TOT_NOC <![CDATA[<=]]> 0
		</isEqual>
		
		<isNotEmpty property="strDPT_TP_CD">
			AND CASE WHEN C.DPT_CD IN ('062500','062600','062700','062800','170300','170320','071100','071300','180100','180110','100100','081100','081200','081300','081400','081500','081600','081700','081800','081900','0L0100','0L0200','0L0300') 
		                        						THEN 'A'
		                        				ELSE C.DPT_TP_CD END  
			= #strDPT_TP_CD#
		</isNotEmpty>
		<isNotEmpty property="strGEN_ADMN_DVSN_CD">
			AND B.GEN_ADMN_DVSN_CD = #strGEN_ADMN_DVSN_CD#
		</isNotEmpty>
		) AA
		
		ORDER BY SMT_TSC_CNT DESC, SMT_DT1 ASC , nvl((SELECT MIN(M.SMT_DT) FROM TBCSPBII100M M WHERE M.PRSR_CNB = AA.CNB
																	   AND M.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt#
																	   AND M.SRNO != AA.SRNO ),'0') ASC , RANK_NM ASC, CNB ASC
		
	</select>	
	
	<!-- 마일리지 정보 조회 -->
	<select id="CSPBII174EMlgReCalcSelect" parameterClass="paramMap" resultClass="resultMap">
    SELECT SUM(nvl(SMT_TSC_CNT,0))  AS SMT_TSC_CNT
         , SUM(nvl(UTL_TOT_SC,0))      AS UTL_TOT_SC
         , SUM(nvl(RIBLY_TOT_SC,0))    AS RIBLY_TOT_SC
         , SUM(nvl(FDLTY_TOT_SC,0))    AS FDLTY_TOT_SC
         , MAX(nvl(SMT_DEL_CPT,0))     AS SMT_DEL_CPT
         , MAX(nvl(SMT_NOC,0))         AS SMT_NOC
         , MAX(nvl(SMT_NOC_CPT,0))     AS SMT_NOC_CPT
         , MAX(nvl(SMT_TOT_NOC,0))     AS SMT_TOT_NOC
         , CNB               AS CNB
         , YE                AS YE
         , QR_DVSN_CD        AS QR_DVSN_CD
       FROM ( 
		<![CDATA[
			SELECT /* csp.bii.service.impl.CSPBII174QServiceImpl.CSPBII174EMlgReCalcSelect */
 				   SUM(AA.UTL_SC) + SUM(AA.RIBLY_SC) + SUM(AA.FDLTY_SC) AS SMT_TSC_CNT /* 제출 합계 총점수 */
				 , SUM(AA.UTL_SC) AS UTL_TOT_SC /* 부서정보총점수 */
				 , SUM(AA.RIBLY_SC) AS RIBLY_TOT_SC /* 품질가점총점수 */
				 , SUM(AA.FDLTY_SC) AS FDLTY_TOT_SC /* 마일리지추가총건수 */
				 , MAX(AA.SMT_DEL_CPT) AS SMT_DEL_CPT /* 폐기건수 */
				 , MAX(AA.SMT_NOC) AS SMT_NOC /* 제출건수(평가중) */
				 , MAX(AA.SMT_NOC_CPT) AS SMT_NOC_CPT /* 제출건수(평가완료) */
				 , MAX(AA.SMT_DEL_CPT) + MAX(AA.SMT_NOC) + MAX(AA.SMT_NOC_CPT) AS SMT_TOT_NOC
				 , AA.CNB
				 , AA.YE
				 , AA.QR_DVSN_CD
			  FROM 
			    (
				SELECT UTL_SC
					 , RIBLY_SC
					 , FDLTY_SC
					 , ROW_NUMBER() OVER (PARTITION BY A.PRSR_CNB ORDER BY (UTL_SC + RIBLY_SC + FDLTY_SC) DESC) AS SC_RANK
				     , (SELECT count(*) FROM TBCSPBII100M M WHERE M.PRSR_CNB = B.CNB 
				           AND M.AUD_INF_PRSS_STA_CD NOT IN ('15','20','99') 
	                       AND M.SMT_DT BETWEEN #strStrDt# AND #strEndDt#
	                       AND M.AUD_INF_PRSS_STA_CD >= '05') AS SMT_NOC /* 제출건수(평가중) */
				     , (SELECT count(*) FROM TBCSPBII100M M WHERE M.PRSR_CNB = B.CNB AND M.AUD_INF_PRSS_STA_CD IN ('15','20','99') 
	                       AND M.SMT_DT BETWEEN #strStrDt# AND #strEndDt#
	                       AND M.AUD_INF_PRSS_STA_CD >= '05'
	                       AND M.HNDL_ORD_CD != '7') AS SMT_NOC_CPT /* 제출건수(평가완료) */
					 , (SELECT count(*) FROM TBCSPBII100M M WHERE M.PRSR_CNB = B.CNB AND M.AUD_INF_PRSS_STA_CD IN ('15','20','99') 
					       AND M.SMT_DT BETWEEN #strStrDt# AND #strEndDt#
	                       AND M.AUD_INF_PRSS_STA_CD >= '05'
					       AND M.HNDL_ORD_CD = '7' ) AS SMT_DEL_CPT /* 폐기건수 */
                      , B.CNB 
					  , B.YE
					  , B.QR_DVSN_CD
					  , A.PRSR_CNB
				  FROM (SELECT PRSR_CNB, SMT_DT, UTL_SC, RIBLY_SC, FDLTY_SC FROM TBCSPBII100M WHERE SMT_DT BETWEEN #strStrDt# AND #strEndDt# AND CLC_DVSN_CD IN ('1','2')) A,
				       TBCSPBII160L B
				 WHERE B.YE = #strYe#  
				   AND B.QR_DVSN_CD = #strQrDvsnCd#
				   AND B.CNB = A.PRSR_CNB(+)
			) AA
			WHERE SC_RANK < 3
			GROUP BY CNB, YE, QR_DVSN_CD
			]]>	
			
			UNION ALL
			
		<![CDATA[
			SELECT /* csp.bii.service.impl.CSPBII174QServiceImpl.CSPBII174EMlgReCalcSelect */
 				   SUM(AA.UTL_SC) + SUM(AA.RIBLY_SC) + SUM(AA.FDLTY_SC) AS SMT_TSC_CNT /* 제출 합계 총점수 */
				 , SUM(AA.UTL_SC) AS UTL_TOT_SC /* 부서정보총점수 */
				 , SUM(AA.RIBLY_SC) AS RIBLY_TOT_SC /* 품질가점총점수 */
				 , SUM(AA.FDLTY_SC) AS FDLTY_TOT_SC /* 마일리지추가총건수 */
				 , MAX(AA.SMT_DEL_CPT) AS SMT_DEL_CPT /* 폐기건수 */
				 , MAX(AA.SMT_NOC) AS SMT_NOC /* 제출건수(평가중) */
				 , MAX(AA.SMT_NOC_CPT) AS SMT_NOC_CPT /* 제출건수(평가완료) */
				 , MAX(AA.SMT_DEL_CPT) + MAX(AA.SMT_NOC) + MAX(AA.SMT_NOC_CPT) AS SMT_TOT_NOC
				 , AA.CNB
				 , AA.YE
				 , AA.QR_DVSN_CD
			  FROM 
			    (
				SELECT UTL_SC
					 , RIBLY_SC
					 , FDLTY_SC
				     , 0 AS SMT_NOC /* 제출건수(평가중) */
				     , 0 AS SMT_NOC_CPT /* 제출건수(평가완료) */
					 , 0 AS SMT_DEL_CPT /* 폐기건수 */
                     , B.CNB 
					 , B.YE
					 , B.QR_DVSN_CD
					 , A.PRSR_CNB
				  FROM (SELECT PRSR_CNB, SMT_DT, UTL_SC, RIBLY_SC, FDLTY_SC FROM TBCSPBII100M WHERE SMT_DT BETWEEN #strStrDt# AND #strEndDt# AND CLC_DVSN_CD NOT IN ('1','2')) A,
				       TBCSPBII160L B
				 WHERE B.YE = #strYe#  
				   AND B.QR_DVSN_CD = #strQrDvsnCd#
				   AND B.CNB = A.PRSR_CNB(+)
			) AA
			GROUP BY CNB, YE, QR_DVSN_CD
			]]>	
			
		) GROUP BY CNB, YE, QR_DVSN_CD
		
	</select>	
	
	<!-- 제출실적 계산 -->
	<insert id="CSPBII174EMlgReCalcExecute1" parameterClass="paramMap">
	<![CDATA[
	   INSERT INTO TBCSPBII160L ( YE                    /* 연도 */
	                            , QR_DVSN_CD            /* 분기구분코드 */
	                            , CNB                   /* 전산번호 */
	                            , SMT_TOT_NOC           /* 제출건수 */
	                            , SMT_TSC_CNT            /* 제출총점수 */     
	                            , FDLTY_TOT_SC          /* 충실성총점수 */
	                            , RIBLY_TOT_SC          /* 신뢰성총점수*/
	                            , UTL_TOT_SC            /* 활용가능성총점수 */
	                            , FRT_USR_ID            /* 최초사용자ID */
	                            , FNL_USR_ID            /* 최종사용자ID */
	                            , FNL_DEAL_DPT_CD       /* 최종거래부서*/
	                            , FNL_MNU_ID            /* 최종메뉴ID */
	                            , FRT_REGI_DH           /* 최초등록일시 */
	                            , FNL_MDF_DH            /* 최종수정일시 */
	                             )
	    SELECT #strYe#
	         , #strQrDvsnCd#
	         , A.CNB
	         , 0
	         , 0
	         , 0
	         , 0
	         , 0
	         , #FRT_USR_ID#
	         , #FNL_USR_ID#
	         , #FNL_DEAL_DPT_CD#
	         , #FNL_MNU_ID#
	         , SYSDATE
	         , SYSDATE
	      FROM TBDCMACM001M A
	     WHERE NOT EXISTS (SELECT 1
	                         FROM TBCSPBII160L B
	                        WHERE B.YE         = #strYe#
	                          AND B.QR_DVSN_CD = #strQrDvsnCd#
	                          AND B.CNB        = A.CNB)
	       AND (A.INN_RANK_CD > '30' OR A.INN_RANK_CD IS NULL) /*과장급 이상 제외*/
	       AND RTRIM(A.RSG_DT) IS NULL 
	       AND A.DPT_CD <= '770770'
	       AND USR_DVSN_CD = '1'
	       AND GEN_ADMN_DVSN_CD IN ('1')
	       AND A.CNB < '5000'
	]]>
	</insert>
	
	<!-- 제출실적 계산 -->
	<insert id="CSPBII174EMlgReCalcExecute2" parameterClass="paramMap">
	<![CDATA[
	   INSERT INTO TBCSPBII160L ( YE                    /* 연도 */
	                            , QR_DVSN_CD            /* 분기구분코드 */
	                            , CNB                   /* 전산번호 */
	                            , SMT_TOT_NOC           /* 제출건수 */
	                            , SMT_TSC_CNT            /* 제출총점수 */     
	                            , FDLTY_TOT_SC          /* 충실성총점수 */
	                            , RIBLY_TOT_SC          /* 신뢰성총점수*/
	                            , UTL_TOT_SC            /* 활용가능성총점수 */
	                            , FRT_USR_ID            /* 최초사용자ID */
	                            , FNL_USR_ID            /* 최종사용자ID */
	                            , FNL_DEAL_DPT_CD       /* 최종거래부서*/
	                            , FNL_MNU_ID            /* 최종메뉴ID */
	                            , FRT_REGI_DH           /* 최초등록일시 */
	                            , FNL_MDF_DH            /* 최종수정일시 */
	                             )
	    SELECT #strYe#
	         , #strQrDvsnCd#
	         , A.CNB
	         , 0
	         , 0
	         , 0
	         , 0
	         , 0
	         , #FRT_USR_ID#
	         , #FNL_USR_ID#
	         , #FNL_DEAL_DPT_CD#
	         , #FNL_MNU_ID#
	         , SYSDATE
	         , SYSDATE
	      FROM TBDCMACM001M A
	     WHERE EXISTS     (SELECT 1 
	                         FROM TBCSPBII100M B
	                        WHERE B.PRSR_CNB = A.CNB
	                          AND B.HNDL_RSLT_CD IN ('31', '32', '33')
	                          AND CMPT_DT BETWEEN #strStrDt# AND #strEndDt#)
	       AND NOT EXISTS (SELECT 1
	                         FROM TBCSPBII160L B
	                        WHERE B.YE         = #strYe#
	                          AND B.QR_DVSN_CD = #strQrDvsnCd#
	                          AND B.CNB        = A.CNB)
	       AND (A.INN_RANK_CD > '30' OR A.INN_RANK_CD IS NULL) /*과장급 이상 제외*/
	       AND RTRIM(A.RSG_DT) IS NULL 
	       AND A.DPT_CD <= '770770'
	       AND USR_DVSN_CD = '1'
	       AND GEN_ADMN_DVSN_CD IN ('1')
	       AND A.CNB < '5000'
	]]>
	</insert>	
	
	<update id="CSPBII174EMlgReCalcExecute3" parameterClass="paramMap">
	<![CDATA[
		MERGE INTO TBCSPBII160L
		    USING DUAL
			   ON ( 
				        YE          = #YE#
				    AND QR_DVSN_CD  = #QR_DVSN_CD#
				    AND CNB         = #CNB#
			  	   )
			WHEN MATCHED  THEN 		
				UPDATE
				SET		  SMT_TOT_NOC 	  = #SMT_TOT_NOC#
						, SMT_TSC_CNT  	  = #SMT_TSC_CNT#
						, FDLTY_TOT_SC    = #FDLTY_TOT_SC#
						, RIBLY_TOT_SC 	  = #RIBLY_TOT_SC#
						, UTL_TOT_SC 	  = #UTL_TOT_SC#
						, FNL_USR_ID      = #FNL_USR_ID#        /* 최종사용자ID */
						, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#   /* 최종거래부서코드 */
						, FNL_MNU_ID      = #FNL_MNU_ID#        /* 최종메뉴ID */
						, FNL_MDF_DH      = SYSDATE             /* 최종수정일시 */
		    WHEN NOT MATCHED THEN 
		        INSERT
				     (  YE
				      , QR_DVSN_CD
				      , CNB
				      , SMT_TOT_NOC
				      , SMT_TSC_CNT
				      , FDLTY_TOT_SC
				      , RIBLY_TOT_SC
				      , UTL_TOT_SC
				      , FRT_USR_ID
				      , FRT_REGI_DH
					  , FNL_USR_ID
					  , FNL_DEAL_DPT_CD
					  , FNL_MNU_ID
					  , FNL_MDF_DH
				     )
				  VALUES
				     (  #YE#
				      , #QR_DVSN_CD#
				      , #CNB#
				      , #SMT_TOT_NOC#
				      , #SMT_TSC_CNT#   
				      , #FDLTY_TOT_SC#   
				      , #RIBLY_TOT_SC#   
				      , #UTL_TOT_SC#    
				      , #FRT_USR_ID#
				      , SYSDATE
					  , #FNL_USR_ID#
					  , #FNL_DEAL_DPT_CD#
					  , #FNL_MNU_ID#
					  , SYSDATE
				     )
	]]>			     
	</update>	
	
	<!-- 목표 마일리지 재계산 수정 -->
	<!-- <update id="CSPBII174EGlMlgCalcUpdate" parameterClass="paramMap">
	<![CDATA[
		UPDATE TBCSPBII160L A                 
		   SET QR_GL_SC        = (NVL(SMT_DPT_WRK_YN_1, 0) + NVL(SMT_DPT_WRK_YN_2, 0) + NVL(SMT_DPT_WRK_YN_3, 0)
		                        + NVL(SMT_DPT_WRK_YN_4, 0) + NVL(SMT_DPT_WRK_YN_5, 0) + NVL(SMT_DPT_WRK_YN_6, 0)) * 10
		                       + NVL(CASE WHEN  TO_CHAR(SYSDATE,'YYYY') <> A.YE THEN 0 
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '01' AND '06' AND QR_DVSN_CD ='A' AND TO_CHAR(SYSDATE,'MM')  = '01' THEN 60
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '01' AND '06' AND QR_DVSN_CD ='A' AND TO_CHAR(SYSDATE,'MM')  = '02' THEN 50
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '01' AND '06' AND QR_DVSN_CD ='A' AND TO_CHAR(SYSDATE,'MM')  = '03' THEN 40
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '01' AND '06' AND QR_DVSN_CD ='A' AND TO_CHAR(SYSDATE,'MM')  = '04' THEN 30
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '01' AND '06' AND QR_DVSN_CD ='A' AND TO_CHAR(SYSDATE,'MM')  = '05' THEN 20
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '01' AND '06' AND QR_DVSN_CD ='A' AND TO_CHAR(SYSDATE,'MM')  = '06' THEN 10
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '07' AND '12' AND QR_DVSN_CD ='B' AND TO_CHAR(SYSDATE,'MM')  = '07' THEN 60
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '07' AND '12' AND QR_DVSN_CD ='B' AND TO_CHAR(SYSDATE,'MM')  = '08' THEN 50
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '07' AND '12' AND QR_DVSN_CD ='B' AND TO_CHAR(SYSDATE,'MM')  = '09' THEN 40
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '07' AND '12' AND QR_DVSN_CD ='B' AND TO_CHAR(SYSDATE,'MM')  = '10' THEN 30
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '07' AND '12' AND QR_DVSN_CD ='B' AND TO_CHAR(SYSDATE,'MM')  = '11' THEN 20
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '07' AND '12' AND QR_DVSN_CD ='B' AND TO_CHAR(SYSDATE,'MM')  = '12' THEN 10
             ELSE 0
             END,0)
		     , FNL_USR_ID      = #FNL_USR_ID#        /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#   /* 최종거래부서코드 */
		     , FNL_MNU_ID      = #FNL_MNU_ID#        /* 최종메뉴ID */
		     , FNL_MDF_DH      = SYSDATE             /* 최종수정일시 */
		 WHERE YE         = #strYe#
		   AND QR_DVSN_CD = #strQrDvsnCd#
	]]>
	</update> -->
	
	
	<update id="CSPBII174EGlMlgCalcUpdate" parameterClass="paramMap">
	<![CDATA[
		UPDATE TBCSPBII160L A                 
		   SET QR_GL_SC        = CASE WHEN (SELECT GEN_ADMN_DVSN_CD FROM TBDCMACM001M S1 WHERE A.CNB = S1.CNB ) IN ('2','3') THEN 1 ELSE (  
		   							(NVL(SMT_DPT_WRK_YN_1, 0) + NVL(SMT_DPT_WRK_YN_2, 0) + NVL(SMT_DPT_WRK_YN_3, 0)
		                        ) * 10
		                       + NVL(CASE WHEN  TO_CHAR(SYSDATE,'YYYY') <> A.YE THEN 0 
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '01' AND '03' AND QR_DVSN_CD ='1' AND TO_CHAR(SYSDATE,'MM')  = '01' THEN 30
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '01' AND '03' AND QR_DVSN_CD ='1' AND TO_CHAR(SYSDATE,'MM')  = '02' THEN 20
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '01' AND '03' AND QR_DVSN_CD ='1' AND TO_CHAR(SYSDATE,'MM')  = '03' THEN 10
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '04' AND '06' AND QR_DVSN_CD ='2' AND TO_CHAR(SYSDATE,'MM')  = '04' THEN 30
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '04' AND '06' AND QR_DVSN_CD ='2' AND TO_CHAR(SYSDATE,'MM')  = '05' THEN 20
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '04' AND '06' AND QR_DVSN_CD ='2' AND TO_CHAR(SYSDATE,'MM')  = '06' THEN 10
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '07' AND '09' AND QR_DVSN_CD ='3' AND TO_CHAR(SYSDATE,'MM')  = '07' THEN 30
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '07' AND '09' AND QR_DVSN_CD ='3' AND TO_CHAR(SYSDATE,'MM')  = '08' THEN 20
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '07' AND '09' AND QR_DVSN_CD ='3' AND TO_CHAR(SYSDATE,'MM')  = '09' THEN 10
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '10' AND '12' AND QR_DVSN_CD ='4' AND TO_CHAR(SYSDATE,'MM')  = '10' THEN 30
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '10' AND '12' AND QR_DVSN_CD ='4' AND TO_CHAR(SYSDATE,'MM')  = '11' THEN 20
                 WHEN  TO_CHAR(SYSDATE,'YYYY') = A.YE AND TO_CHAR(SYSDATE,'MM')  BETWEEN '10' AND '12' AND QR_DVSN_CD ='4' AND TO_CHAR(SYSDATE,'MM')  = '12' THEN 10
             ELSE 0
             END,0) ) END 
		     , FNL_USR_ID      = #FNL_USR_ID#        /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#   /* 최종거래부서코드 */
		     , FNL_MNU_ID      = #FNL_MNU_ID#        /* 최종메뉴ID */
		     , FNL_MDF_DH      = SYSDATE             /* 최종수정일시 */
		 WHERE YE         = #strYe#
		   AND QR_DVSN_CD = #strQrDvsnCd#
	]]>
	</update>
	
	<update id="CSPBII174EGlMlgCalcUpdate2" parameterClass="paramMap">
		UPDATE TBCSPBII160L    
		SET    QR_GL_SC = CASE WHEN QR_GL_SC > 30 THEN 30 ELSE QR_GL_SC END
		WHERE YE         = #strYe#
		   AND QR_DVSN_CD = #strQrDvsnCd# 
	</update>
	
	<!-- 마일리지내역 수정 -->
	<update id="CSPBII174EMainUpdate" parameterClass="paramMap">
		UPDATE TBCSPBII160L                     
		   SET MLG_RMK         = #MLG_RMK# 	         /* 마일리지비고 */
		     , SC_RANK         = #SC_RANK# 	         /* 점수등급 */
		     , FNL_USR_ID      = #FNL_USR_ID#        /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#   /* 최종거래부서코드 */
		     , FNL_MNU_ID      = #FNL_MNU_ID#        /* 최종메뉴ID */
		     , FNL_MDF_DH      = SYSDATE             /* 최종수정일시 */
		     , EVL_RSLT_CD     = #EVL_RSLT_CD#
		 WHERE YE         = #YE#
		   AND QR_DVSN_CD = #QR_DVSN_CD#
		   AND CNB        = #CNB#
	</update>
	
	<!-- 마일리지내역 엑셀다운로드-->
	<select id="CSPBII174QMainSelectExcel" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT USR_NAM
			      ,RANK_NM
			      ,DPT_NM
			      ,SMT_NOC
			      ,SMT_NOC_CPT
			      ,SMT_DEL_CPT
			      ,WRK_MN_CNT
			      ,SMT_DPT_WRK_YN_1
			      ,SMT_DPT_WRK_YN_2
			      ,SMT_DPT_WRK_YN_3
			      ,SMT_DPT_WRK_YN_4
			      ,SMT_DPT_WRK_YN_5
			      ,SMT_DPT_WRK_YN_6
			      ,YE
			      ,QR_DVSN_CD
			      ,CNB
			      ,CRNT_DPT_APM_DT
			      ,PST_NM
			      ,EVL_RSLT_CD
			      ,SMT_TSC_CNT
			      ,SMT_TOT_NOC
			      ,CRNT_RANK_APM_DT
			      ,GEN_ADMN_DVSN_NM
			      ,SMT_DT1
			      ,(SELECT MIN(M.SMT_DT)
                      FROM TBCSPBII100M M
                     WHERE M.PRSR_CNB = AA.CNB
                       AND M.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt#
                       AND M.SRNO != AA.SRNO ) AS SMT_DT2
			      ,SC_RANK
			      ,MLG_RMK
			FROM (
			SELECT B.USR_NAM
			     , F_CODE_NM('1000173', B.RANK_CD)             AS RANK_NM
			     , C.ABR_DPT_NM_1 AS DPT_NM
			     , (SELECT count(*) FROM TBCSPBII100M M WHERE M.PRSR_CNB = A.CNB 
			           AND M.AUD_INF_PRSS_STA_CD NOT IN ('15','20','99') 
                       AND M.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt#
                       AND M.AUD_INF_PRSS_STA_CD >= '05') AS SMT_NOC /* 제출건수(평가중) */
			     , (SELECT count(*) FROM TBCSPBII100M M WHERE M.PRSR_CNB = A.CNB AND M.AUD_INF_PRSS_STA_CD IN ('15','20','99') 
                       AND M.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt#
                       AND M.AUD_INF_PRSS_STA_CD >= '05'
                       AND M.HNDL_ORD_CD != '7') AS SMT_NOC_CPT /* 제출건수(평가완료) */
				 , (SELECT count(*) FROM TBCSPBII100M M WHERE M.PRSR_CNB = A.CNB AND M.AUD_INF_PRSS_STA_CD IN ('15','20','99') 
				       AND M.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt#
                       AND M.AUD_INF_PRSS_STA_CD >= '05'
				       AND M.HNDL_ORD_CD = '7' ) AS SMT_DEL_CPT /* 폐기건수 */
			     , A.MLG_RMK                                                     /* 마일리지비고 */
			     , DECODE(A.SMT_DPT_WRK_YN_1, '1', 1, 0)
			     + DECODE(A.SMT_DPT_WRK_YN_2, '1', 1, 0)
			     + DECODE(A.SMT_DPT_WRK_YN_3, '1', 1, 0)
			     + DECODE(A.SMT_DPT_WRK_YN_4, '1', 1, 0)
			     + DECODE(A.SMT_DPT_WRK_YN_5, '1', 1, 0)
			     + DECODE(A.SMT_DPT_WRK_YN_6, '1', 1, 0)       AS WRK_MN_CNT     /* 근무월수 */
			     , CASE A.SMT_DPT_WRK_YN_1 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_1 /* 제출부서근무여부1 */
			     , CASE A.SMT_DPT_WRK_YN_2 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_2 /* 제출부서근무여부2 */
			     , CASE A.SMT_DPT_WRK_YN_3 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_3  /* 제출부서근무여부3 */
			     , CASE A.SMT_DPT_WRK_YN_4 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_4 /* 제출부서근무여부4 */
			     , CASE A.SMT_DPT_WRK_YN_5 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_5 /* 제출부서근무여부5 */
			     , CASE A.SMT_DPT_WRK_YN_6 WHEN '1' THEN 'Y'
			                               WHEN '0' THEN 'N'
			                               ELSE '-'
			       END                                       AS SMT_DPT_WRK_YN_6 /* 제출부서근무여부6 */
			     , A.YE
			     , A.QR_DVSN_CD
			     , A.CNB
			     , (SELECT CRNT_GD_APM_DT
                    FROM TBDCMACM903O S1
                    WHERE S1.EIN = B.EIN) AS CRNT_DPT_APM_DT
			     , F_CODE_NM('1000176',B.PST_CD)  AS PST_NM
			     , NVL(EVL_RSLT_CD,'0') AS EVL_RSLT_CD
			     , A.SMT_TSC_CNT
			     , A.SMT_TOT_NOC
			     , B.CRNT_RANK_APM_DT
			     , CASE WHEN C.DPT_CD IN ('062500','062600','062700','062800','170300','170320','071100','071300','180100','180110','100100','081100','081200','081300','081400','081500','081600','081700','081800','081900','0L0100','0L0200','0L0300') 
		                        						THEN '감사' 
		                        				ELSE DECODE(C.DPT_TP_CD,'A','감사','지원') END  AS GEN_ADMN_DVSN_NM
				 , D.SMT_DT AS SMT_DT1
				 , (SELECT MAX(S.SRNO) FROM TBCSPBII100M S WHERE S.PRSR_CNB = A.CNB AND S.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt# AND S.SMT_DT = D.SMT_DT ) AS SRNO
				 , SC_RANK
			  FROM TBCSPBII160L A
			     , TBDCMACM001M B
			     , TBDCMACM002M C
		         , (SELECT MIN(SMT_DT) AS SMT_DT, PRSR_CNB FROM TBCSPBII100M 
		             WHERE SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt# GROUP BY PRSR_CNB) D			     
			 WHERE A.CNB = B.CNB
			   AND A.CNB = D.PRSR_CNB(+)
			   AND A.YE = #strYe#  
			   AND A.QR_DVSN_CD = #strQrDvsnCd#
			   AND nvl(A.DPT_CD,B.DPT_CD) = C.DPT_CD
		]]>
		
		<!-- 성명 -->
		<isNotEmpty property="strMlgCnb">
			AND A.CNB = #strMlgCnb#
		</isNotEmpty>
		
		<dynamic prepend="AND ( 1=1 ">
		<isEmpty property="strDptCheck">
			<isNotEmpty property="strDPT_YN">
				AND
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD" prepend="OR">
				B.DPT_CD = #strDPT_CD#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD2" prepend="OR">
				B.DPT_CD = #strDPT_CD2#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD3" prepend="OR">
				B.DPT_CD = #strDPT_CD3#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD4" prepend="OR">
				B.DPT_CD = #strDPT_CD4#
			</isNotEmpty>
			        )
		</isEmpty>
		</dynamic>
		<dynamic prepend="AND ( 1=1 AND ">
		<isNotEmpty property="strDptCheck">
			<isNotEmpty property="strDPT_CD" prepend="AND">
				B.DPT_CD != #strDPT_CD#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD2" prepend="AND">
				B.DPT_CD != #strDPT_CD2#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD3" prepend="AND">
				B.DPT_CD != #strDPT_CD3#
			</isNotEmpty>
			<isNotEmpty property="strDPT_CD4" prepend="AND">
				B.DPT_CD != #strDPT_CD4#
			</isNotEmpty>
			        )
		</isNotEmpty>
		</dynamic>
		
		<isNotEmpty property="strMlgRmk">
			AND A.MLG_RMK LIKE '%'||#strMlgRmk#||'%'
		</isNotEmpty>
		
		<isEqual property="strSmtTp" compareValue="Y">
			AND A.SMT_TOT_NOC <![CDATA[>]]> 0
		</isEqual>
		<isEqual property="strSmtTp" compareValue="N">
			AND A.SMT_TOT_NOC <![CDATA[<=]]> 0
		</isEqual>		
		
		<isNotEmpty property="strDPT_TP_CD">
			AND CASE WHEN C.DPT_CD IN ('062500','062600','062700','062800','170300','170320','071100','071300','180100','180110','100100','081100','081200','081300','081400','081500','081600','081700','081800','081900','0L0100','0L0200','0L0300') 
		                        						THEN 'A'
		                        				ELSE C.DPT_TP_CD END  
			= #strDPT_TP_CD#
		</isNotEmpty>
		<isNotEmpty property="strGEN_ADMN_DVSN_CD">
			AND B.GEN_ADMN_DVSN_CD = #strGEN_ADMN_DVSN_CD#
		</isNotEmpty>
		) AA
		
		ORDER BY SMT_TSC_CNT DESC, SMT_DT1 ASC , nvl((SELECT MIN(M.SMT_DT) FROM TBCSPBII100M M WHERE M.PRSR_CNB = AA.CNB
																	   AND M.SMT_DT BETWEEN #strStrSmtDt# AND #strEndSmtDt#
																	   AND M.SRNO != AA.SRNO ),'0') ASC, RANK_NM ASC, CNB ASC
		
	</select>	
	
	<!-- 비고 초기화 -->
	<update id="CSPBII174QRmkCopyClear" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPBII160L
			SET		MLG_RMK = NULL
			WHERE	YE = #strYe#
			AND		QR_DVSN_CD = #strQrDvsnCd#
		]]>
	</update>
	
	<!-- 비고 복사 -->
	<update id="CSPBII174QRmkCopySave" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPBII160L D1
			SET		MLG_RMK = (	SELECT	S1.MLG_RMK
								FROM	TBCSPBII160L S1
								WHERE	S1.YE = CASE WHEN #strQrDvsnCd# = '1' THEN TO_NUMBER(#strYe#) -1 ELSE  TO_NUMBER(#strYe#) END
								AND		S1.QR_DVSN_CD = DECODE(#strQrDvsnCd#, '1', '4', '2','1','3','2','4','3')
								AND		S1.CNB = D1.CNB)
			WHERE	YE = #strYe#
			AND		QR_DVSN_CD = #strQrDvsnCd#
		]]>
		
	</update>
	
	<!-- 제출실적 확정 -->
	<update id="CSPBII174EConfirmUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPBII160L
			SET		DTM_YN = 'Y'
			WHERE	YE = #strYe#
			AND		QR_DVSN_CD = #strQrDvsnCd#
		]]>
		
	</update>	
	
	<!-- 제출실적 재계산/확정 로그 등록 -->
	<insert id="CSPBII174QTBCSPBII190LLogInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	TBCSPBII190L
					(	SRNO
						,YE
						,QR_DVSN_CD
						,CNB
						,PET_TXT
						,PET_DH
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
					)
				VALUES	(	(	SELECT 	NVL(MAX(SRNO),0)+1
								FROM	TBCSPBII190L
							)
							,#strYe#
							,#strQrDvsnCd#
							,#S_CNB#
							,#strPetTxt#
							,SYSDATE
							,#FNL_USR_ID#
							,#FNL_USR_ID#
							,#FNL_DEAL_DPT_CD#
							,#FNL_MNU_ID#
							,SYSDATE
							,SYSDATE
						)
		]]>
	</insert>
	
	<select id="CSPBII174ECallFromSelect" parameterClass="paramMap" resultClass="string">
		<![CDATA[
			SELECT REPLACE(D2.TNB,'-','')
							FROM TBDCMACM001M D1, TBDCMACM002M D2
							WHERE D1.DPT_CD = D2.DPT_CD
							AND D1.USR_ID = #FNL_USR_ID#
		]]>	
	</select>
	
	<insert id="CSPBII174EMmsMsgInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MMS_CONTENTS_INFO 
				 	(	CONT_SEQ
				 		, FILE_CNT
				 		, MMS_BODY
				 		, MMS_SUBJECT
				 	) 
			VALUES (	#CONT_SEQ#
						, 1
						, #SMS_TXT#||''
						, '감사원 문자통보'
					)
		]]>
	</insert>
	
	<insert id="CSPBII174EMsgInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MSG_DATA
				 	(	MSG_SEQ
				 		, CUR_STATE
				 		, REQ_DATE
				 		, CALL_TO
				 		, CALL_FROM
				 		, SMS_TXT
				 		, MSG_TYPE
				 		, CONT_SEQ
				 	) 
			VALUES (	MSG_DATA_SEQ.NEXTVAL
						, 0
						, SYSDATE
						, REPLACE(REPLACE(REPLACE(#HOM_TNB#,' ',''),'-',''),')','')
						, (SELECT REPLACE(D2.TNB,'-','')
							FROM TBDCMACM001M D1, TBDCMACM002M D2
							WHERE D1.DPT_CD = D2.DPT_CD
							AND D1.USR_ID = #FNL_USR_ID# )
						, ''
						, 6
						, #CONT_SEQ#
					)
		]]>
	</insert>
	
	<insert id="CSPBII174EInsertMSGSend" parameterClass="paramMap">
		<![CDATA[
			CALL NURI2_MESSAGE_SEND(#CALL_FROM#, #CALL_TO#, #SMS_TLT#, #SMS_TXT#)
		]]>
	</insert>
</sqlMap>