<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="in/ep/ps">
	<insert id="BAINewsinsert" parameterClass="java.util.Map">
		INSERT INTO PTL_BAI_NEWS
		(
		NTT_ID					/* 게시물아이디 */
		,BBS_ID					/* 게시판아이디 */
		,NTT_NO					/* 번호 */
		,NTT_SJ					/* 제목 */
		,NTT_CN					/* 내용 */
		,NTCR_NM				/* 작성 */
		,FRST_REGIST_PNTTM		/* 작성일자 */
		,MAIN_IMG_ID			/* 메인이미지아이디 */
		,THUMB_IMG_ID			/* 첨부이미지아이디 */
		,LIST_IMG_ID			/* 리스트이미지아이디 */
		) VALUES
		(
		#NTT_ID#
		,#BBS_ID#
		,#NTT_NO#
		,#NTT_SJ#
		,#NTT_CN#
		,#NTCR_NM#
		,SYSDATE
		,#MAIN_IMG_ID#
		,#THUMB_IMG_ID#
		,#LIST_IMG_ID#
		)
	</insert>
	
	<!-- 게시물이 수정됬다. -->
	<update id="BAINewsupdate" parameterClass="paramMap">
		UPDATE PTL_BAI_NEWS
		   SET NTT_NO	         = #NTT_NO#				
			 , NTT_SJ	         = #NTT_SJ#				
			 , NTT_CN	         = #NTT_CN#			
			 , NTCR_NM	         = #NTCR_NM#			
			 , FRST_REGIST_PNTTM = SYSDATE	
			 , MAIN_IMG_ID       = #MAIN_IMG_ID#			
			 , THUMB_IMG_ID		 = #THUMB_IMG_ID#	
			 , LIST_IMG_ID	     = #LIST_IMG_ID#		
		 WHERE NTT_ID  = #NTT_ID#
		   AND BBS_ID  = #BBS_ID#
	</update>
	
	<!-- 게시물 삭제 -->
	<update id="BAINewsdelete" parameterClass="paramMap">
		DELETE FROM PTL_BAI_NEWS
	     WHERE NTT_ID  = #NTT_ID#
		   AND BBS_ID  = #BBS_ID#
	</update>

	<!-- insert하기전에 파일이 있는지 체크한다. -->
	<select id="BAIFileCntselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT TO_CHAR(COUNT(*)) AS CNT
		  FROM PTL_BAI_NEWS_FILE
		 WHERE ATCH_FILE_ID = #ATCH_FILE_ID#
	</select>
	
	<!-- 기존에 있었다. -->
	<update id="BAIFiledelete" parameterClass="paramMap">
		DELETE FROM PTL_BAI_NEWS_FILE
	     WHERE 1=1
		   AND ATCH_FILE_ID = #ATCH_FILE_ID#
	</update>
		
	<insert id="BAIFileinsert" parameterClass="java.util.Map">
		INSERT INTO PTL_BAI_NEWS_FILE
		(
		 ATCH_FILE_ID		/* 파일아이디 */
		,FILE_SN			/* 파일시리얼번호 */
		,FILE_STRE_COURS	/* 저장경로 */
		,STRE_FILE_NM		/* 저장된파일이름 */
		,ORIGNL_FILE_NM		/* 실제파일이름 */
		,FILE_EXTSN			/* 확장자 */
		,FILE_CN			/* 파일설명 */
		,FILE_SIZE			/* 사이즈 */
		) VALUES
		(
		 #ATCH_FILE_ID#
		,#FILE_SN#
		,#FILE_STRE_COURS#
		,#STRE_FILE_NM#
		,#ORIGNL_FILE_NM#
		,#FILE_EXTSN#
		,#FILE_CN#
		,#FILE_SIZE#
		)
	</insert>
</sqlMap>