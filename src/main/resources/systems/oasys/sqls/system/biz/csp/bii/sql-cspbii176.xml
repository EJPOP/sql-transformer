<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/bii/176">
	<!-- 감사정보기본 수정 -->
	<update id="CSPBII176EMainUpdate170M" parameterClass="paramMap">
		UPDATE TBCSPBII170M                       
		   SET HNDL_DT         = TO_CHAR(SYSDATE, 'YYYYMMDD') /* 처리일 */
		     , HNDL_PEN_CNB    = #HNDL_PEN_CNB#    /* 처리자전산번호  */
		     , HNDL_RANK_CD    = (SELECT RANK_CD FROM TBDCMACM001M WHERE CNB = #HNDL_PEN_CNB#) /* 처리자직급  */
		     , HNDL_RSLT_CD    = #HNDL_RSLT_CD#    /* 처리결과코드 */
		     , AUD_INF_PRSS_STA_CD = '21'          /* 감사정보진행상태코드[21:처리작성] */		     
		     , FNL_USR_ID      = #FNL_USR_ID#      /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD# /* 최종거래부서코드 */
		     , FNL_MNU_ID      = #FNL_MNU_ID#      /* 최종메뉴ID */
		     , FNL_MDF_DH      = SYSDATE           /* 최종수정일시 */
		 WHERE YE = #YE#
		   AND SRNO = #SRNO#
	</update>
	
	<!-- 감사정보내역 수정 -->
	<update id="CSPBII176EMainUpdate101L" parameterClass="paramMap">
		UPDATE TBCSPBII101L                     
		   SET HNDL_RSLT_SMM_TXT = #HNDL_RSLT_SMM_TXT# /* 처리결과요약내용  */		     
		     , FNL_USR_ID        = #FNL_USR_ID#        /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD   = #FNL_DEAL_DPT_CD#   /* 최종거래부서코드 */
		     , FNL_MNU_ID        = #FNL_MNU_ID#        /* 최종메뉴ID */
		     , FNL_MDF_DH        = SYSDATE             /* 최종수정일시 */
		 WHERE YE = #YE#
		   AND SRNO = #SRNO#
	</update>		
		
	<!-- 감사정보관련처분내역 등록  -->
	<insert id="CSPBII176ERelDspInsert120L" parameterClass="paramMap">
		INSERT INTO TBCSPBII120L (
		                          YE                  /* 연도 */
		                        , SRNO                /* 일련번호 */
		                        , AUD_YR             /* 제목내용 */
		                        , AUD_NO             /* 수집구본코드 */
		                        , DSP_RQ_SNO         /* 출처구분코드 */
		                        , FRT_USR_ID          /* 최초사용자ID */
		                        , FNL_USR_ID          /* 최종사용자ID */
		                        , FNL_DEAL_DPT_CD     /* 최종거래부서코드 */
		                        , FNL_MNU_ID          /* 최종메뉴ID */
		                        , FRT_REGI_DH         /* 최초등록일시 */
		                        , FNL_MDF_DH          /* 최종수정일시 */
		                         ) 
		                  VALUES (
		                          #YE#
		                        , #SRNO#
		                        , #AUD_YR#
		                        , #AUD_NO#
		                        , #DSP_RQ_SNO#
		                        , #FRT_USR_ID#
		                        , #FNL_USR_ID#
		                        , #FNL_DEAL_DPT_CD#
		                        , #FNL_MNU_ID#
		                        , SYSDATE
		                        , SYSDATE
				                 )
	</insert>
	
	
	<insert id="CSPBII176ERelDspInsertBADEAR035L" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	TBBADEAR035L
					(	AUD_YR
						,AUD_NO
						,DSP_RQ_SNO
						,DVSN_CD
						,TSK_KEY1
						,TSK_KEY2
						,FRT_USR_ID          /* 최초사용자ID */
                        , FNL_USR_ID          /* 최종사용자ID */
                        , FNL_DEAL_DPT_CD     /* 최종거래부서코드 */
                        , FNL_MNU_ID          /* 최종메뉴ID */
                        , FRT_REGI_DH         /* 최초등록일시 */
                        , FNL_MDF_DH          /* 최종수정일시 */
					)
				VALUES	(	#AUD_YR#
							, #AUD_NO#
							, #DSP_RQ_SNO#
							,'0'
							,#YE#
							, #SRNO#
							, #FRT_USR_ID#
	                        , #FNL_USR_ID#
	                        , #FNL_DEAL_DPT_CD#
	                        , #FNL_MNU_ID#
	                        , SYSDATE
	                        , SYSDATE
						)
		]]>
	
	</insert>
	
	<!-- 감사정보관련처분내역 수정 -->
	<update id="CSPBII176ERelDspUpdate120L" parameterClass="paramMap">
		UPDATE TBCSPBII120L                       
		   SET AUD_YR          = #AUD_YR#          /* 감사년도  */
		     , AUD_NO          = #AUD_NO#          /* 감사번호  */
		     , DSP_RQ_SNO      = #DSP_RQ_SNO#      /* 처분요구순번  */
		     , FNL_USR_ID      = #FNL_USR_ID#      /* 최종사용자ID */
		     , FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD# /* 최종거래부서코드 */
		     , FNL_MNU_ID      = #FNL_MNU_ID#      /* 최종메뉴ID */
		     , FNL_MDF_DH      = SYSDATE           /* 최종수정일시 */
		 WHERE YE         = #YE#
		   AND SRNO       = #SRNO#
		   AND AUD_YR     = #CHG_BF_AUD_YR#
		   AND AUD_NO     = #CHG_BF_AUD_NO#
		   AND DSP_RQ_SNO = #CHG_BF_DSP_RQ_SNO#
	</update>
	
	<delete id="CSPBII176ERelDspUpdateBADEAR035L" parameterClass="paramMap">
		<![CDATA[
			DELETE
			FROM	TBBADEAR035L
			WHERE	AUD_YR = #CHG_BF_AUD_YR#
			AND		AUD_NO = #CHG_BF_AUD_NO#
			AND		DSP_RQ_SNO = #CHG_BF_DSP_RQ_SNO#
			AND		DVSN_CD = '0'
			AND		YE = #YE#
			AND		SRNO = #SRNO#
		]]>
	</delete>
	
	<select id="CSPBII176ERelDspBADEAR035LCheck" parameterClass="paramMap" resultClass="Integer">
		<![CDATA[
			SELECT 	COUNT(*) CNT
			FROM 	TBBADEAR035L
			WHERE 	AUD_YR = #AUD_YR#
			AND		AUD_NO = #AUD_NO#
			AND		DSP_RQ_SNO = #DSP_RQ_SNO#
		]]>
	</select>
	
	<!-- 감사정보관련처분내역 삭제 -->
	<delete id="CSPBII176ERelDspDelete120L" parameterClass="paramMap">
		DELETE TBCSPBII120L
		 WHERE YE         = #YE#
		   AND SRNO       = #SRNO#
		   AND AUD_YR     = #CHG_BF_AUD_YR#
		   AND AUD_NO     = #CHG_BF_AUD_NO#
		   AND DSP_RQ_SNO = #CHG_BF_DSP_RQ_SNO#
	</delete>
	
	<!-- 감사정보내역 등록  -->
	<insert id="CSPBII176EMainInsert102L" parameterClass="paramMap">
		INSERT INTO TBCSPBII102L (
		                          YE                     /* 연도 */
		                        , SRNO                   /* 일련번호 */
		                        , DOC_TYP_CD             /* 문서유형코드 */
		                        , DOC_ID                 /* 문서ID */
		                        , FRT_USR_ID             /* 최초사용자ID */
		                        , FNL_USR_ID             /* 최종사용자ID */
		                        , FNL_DEAL_DPT_CD        /* 최종거래부서코드 */
		                        , FNL_MNU_ID             /* 최종메뉴ID */
		                        , FRT_REGI_DH            /* 최초등록일시 */
		                        , FNL_MDF_DH             /* 최종수정일시 */
		                         ) 
		                  VALUES (
		                          #YE#
		                        , #SRNO#
		                        , 'SP-II-002' <!-- [2:직원제출감사정보처리전] -->
		                        , #DOC_ID#
		                        , #FNL_USR_ID#
		                        , #FNL_USR_ID#
		                        , #FNL_DEAL_DPT_CD#
		                        , #FNL_MNU_ID#
		                        , SYSDATE
		                        , SYSDATE
				                 )
	</insert>
	
	<select id="CSPBII176ERelDspSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT /* csp.bii.service.impl.CSPBII176QServiceImpl.CSPBII176ERelDspSelect */
			       A.AUD_YR                                               /* 감사연도 */
			     , A.AUD_NO                                               /* 감사번호 */
			     , A.DSP_RQ_SNO                                           /* 처분요구순번 */	
			     , F_CODE_NM('1000002', A.DSP_RQ_KND_CD) AS DSP_RQ_KND_NM /* 처분요구종류명 */	
			     , A.TIT_TXT                             AS DSP_TIT_TXT   /* 처분제목내용 */
			  FROM TBBADEAR001M A /* 처분요구사항기본 */
			 WHERE A.AUD_YR     = #strAudYr#
			   AND A.AUD_NO     = #strAudNo#
			   AND A.DSP_RQ_SNO = #strDspRqSno#
		]]>		
	</select>	
</sqlMap> 
