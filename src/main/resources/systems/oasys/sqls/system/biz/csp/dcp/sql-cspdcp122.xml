<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/122">
 	
 	<select id="CSPDCP122ECodeSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT D1.CD
           		 , D1.USR_DFN_TXT_1
                 , (SELECT S1.CD_NM 
	                  FROM TBDCMACM013C S1 
	                 WHERE 1=1
	                   AND S1.CMM_CD_DVSN_CD = '1000447'
	                   AND S1.CD = D1.USR_DFN_TXT_1) AS CD_NM
              FROM TBDCMACM013C D1 
             WHERE 1=1 
         	   AND D1.CMM_CD_DVSN_CD = '1000128'
		]]>
	</select>
	
	<select id="CSPDCP122InfRprtInfoByInfRprtNoSelect" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT	/* CSPDCP122InfRprtInfoByInfRprtNoSelect */
				D1.YM
				, D1.INF_RPRT_NO
				, '정보' || '-' || SUBSTR(D1.YM, 3, 4) || '-' || LPAD(D1.INF_RPRT_NO, 4, '0') AS INF_RPRT_NO_NM
				, SUBSTR(D1.INF_TYP_CD, 1, 2) || '00' AS INF_TYP_CD_TOP
				, D1.INF_TYP_CD
				, D1.TIT_NM
				, D1.DOC_ID
				, D1.DOC_TYP_CD
				, D1.WRIT_STA_CD
				, TO_CHAR(D1.SMT_DH, 'YYYYMMDD') AS SMT_DH
				, TO_CHAR(D1.SMT_CNL_DH, 'YYYYMMDD') AS SMT_CNL_DH
				, D1.FRT_USR_ID
		FROM	TBCSPDCP501M D1
		WHERE	D1.YM = #YM#
		AND		D1.INF_RPRT_NO = #INF_RPRT_NO#
	]]>
	</select>
	
	<select id="CSPDCP122InfRprtInfoCntSelect" parameterClass="paramMap" resultClass="int">
	<![CDATA[
		SELECT	/* CSPDCP122InfRprtInfoCntSelect */
				COUNT(INF_RPRT_NO) AS CNT
		FROM	TBCSPDCP501M D1
		WHERE	D1.YM = #YM#
		AND		D1.INF_RPRT_NO = #INF_RPRT_NO#
	]]>
	</select>
 	
 	<select id="CSPDCP122EMainSelect" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT T2.YM
		     , T2.INF_RPRT_NO
		     , T2.APV_RPT_PEN_DVSN_CD
		     , T2.APVR_ID
		     , F_CODE_NM('1000173', T3.RANK_CD) AS RANK_NM
		     , F_DPT_INFO(T3.DPT_CD, '1') AS DPT_NM
		     , T3.USR_NAM
		     , T2.FRT_USR_ID
		     , T2.FNL_USR_ID
		     , T2.FNL_DEAL_DPT_CD
		     , T2.FNL_MNU_ID
		     , T2.FRT_REGI_DH
		     , T2.FNL_MDF_DH
		  FROM TBCSPDCP501M T1
		     , TBCSPDCP503L T2
		     , TBDCMACM001M T3
	     WHERE 1=1
		   AND T1.YM = T2.YM
		   AND T1.INF_RPRT_NO = T2.INF_RPRT_NO
		   AND T2.APVR_ID  = T3.USR_ID(+)
	]]>
		<dynamic>
			<isNotEmpty property="YM">
		    AND T1.YM = #YM#
			</isNotEmpty>
			<isNotEmpty property="INF_RPRT_NO">
			AND T1.INF_RPRT_NO  = #INF_RPRT_NO#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="CSPDCP122ESubSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
		SELECT T2.YM
         	  ,T2.INF_RPRT_NO
	          ,T2.ORG_CD
	          ,T3.ORG_NM
	          ,(SELECT ORG_NM 
	              FROM TBDCMACM015M 
	             WHERE ORG_CD LIKE SUBSTR(T3.ORG_CD, 0 , 3)||'000000000') AS SMALL_ORG_NM
	          ,T3.PUB_DVSN_CD
     	  FROM TBCSPDCP501M T1
              ,TBCSPDCP502L T2
              ,TBDCMACM015M T3
   		 WHERE 1=1 
	       AND T1.YM = T2.YM
	       AND T1.INF_RPRT_NO = T2.INF_RPRT_NO
	       AND T2.ORG_CD = T3.ORG_CD(+)
		]]>
		<dynamic>
			<isNotEmpty property="YM">
		    AND T1.YM = #YM#
			</isNotEmpty>
			<isNotEmpty property="INF_RPRT_NO">
			AND T1.INF_RPRT_NO  = #INF_RPRT_NO#
			</isNotEmpty>
		</dynamic>
	</select>
	
	
	<select id="CSPDCP122ESub2Select" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			   SELECT T2.YM
		             ,T2.INF_RPRT_NO
		             ,T2.SRNO
		             ,T2.NAM
		             ,T2.BTDT
		             ,T2.BLT_ORG_NM
		             ,T2.RANK_NM
		             ,T2.PST_NM
		        FROM TBCSPDCP501M T1
		            ,TBCSPDCP504L T2
		       WHERE 1=1 
		         AND T1.YM = T2.YM
		         AND T1.INF_RPRT_NO = T2.INF_RPRT_NO
		]]>
		<dynamic>
			<isNotEmpty property="YM">
		    AND T1.YM = #YM#
			</isNotEmpty>
			<isNotEmpty property="INF_RPRT_NO">
			AND T1.INF_RPRT_NO  = #INF_RPRT_NO#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<update id="CSPDCP122EInfRprtInfoUpdate" parameterClass="paramMap">
	<![CDATA[
		UPDATE /* CSPDCP122EInfRprtInfoUpdate */ TBCSPDCP501M
		   SET FNL_USR_ID      = #USR_ID#
  				  ,FNL_DEAL_DPT_CD = #DPT_CD#
  				  ,FNL_MNU_ID      = #MNU_ID#
  				  ,FNL_MDF_DH      = SYSDATE 
  	]]>
		   <dynamic>
		    	<isNotEmpty prepend="," property="WRIT_STA_CD">
		    		WRIT_STA_CD     = #WRIT_STA_CD#
		    	</isNotEmpty>
				<isEqual prepend="," property="WRIT_STA_CD" compareValue="20">
					SMT_DH			= SYSDATE
					, SMT_CNL_DH	= NULL
				</isEqual>
				<isEqual prepend="," property="WRIT_STA_CD" compareValue="21">
					SMT_DH			= NULL
					, SMT_CNL_DH	= SYSDATE
				</isEqual>
		   		<isNotEmpty prepend="," property="TIT_NM">
		   		    TIT_NM          = #TIT_NM#
		   		</isNotEmpty>
		   		<isNotEmpty prepend="," property="INF_TYP_CD">
		   		   INF_TYP_CD       = #INF_TYP_CD#
		   		</isNotEmpty>
		   		<isNotEmpty prepend="," property="DOC_ID">
		   		   DOC_ID           = #DOC_ID#
		   		</isNotEmpty>
		   </dynamic>
	<![CDATA[
		 WHERE YM = #YM#
		   AND INF_RPRT_NO = #INF_RPRT_NO#
	]]>
	</update>
	
	<select id="CSPDCP122EgetWritStaCd" parameterClass="paramMap" resultClass="java.lang.String">
	<![CDATA[
		SELECT WRIT_STA_CD
		  FROM TBCSPDCP501M
 		 WHERE YM = #YM#
	       AND INF_RPRT_NO = #INF_RPRT_NO#
	]]>
	</select>
	
	<select id="CSPDCP122EInfRprtNoMaxSelect" parameterClass="paramMap" resultClass="String">
	<![CDATA[
		SELECT  /* CSPDCP122EInfRprtNoMaxSelect */ NVL(MAX(INF_RPRT_NO), 0) + 1 AS INF_RPRT_NO_MAX
		FROM 	TBCSPDCP501M D1
		WHERE	D1.YM = #YM#
	]]>
	</select>
	
	
	<select id="CSPDCP122ECurentYmSelect" parameterClass="paramMap" resultClass="String">
	<![CDATA[
		SELECT 	/* CSPDCP122ECurentYmSelect */ TO_CHAR(SYSDATE, 'YYYYMM') AS YM
        FROM 	DUAL
	]]>
	</select>
	
	<insert id="CSPDCP122EInfRprtInfoInsert" parameterClass="paramMap">
	<![CDATA[
		 INSERT INTO /* CSPDCP122EInfRprtInfoInsert */ TBCSPDCP501M(
                            YM
                           ,INF_RPRT_NO
                           ,INF_TYP_CD                           
                           ,TIT_NM
                           ,DOC_ID
                           ,WRIT_STA_CD
                           ,FRT_USR_ID
                           ,FNL_USR_ID
                           ,FNL_DEAL_DPT_CD
                           ,FNL_MNU_ID
                           ,FRT_REGI_DH
                           ,FNL_MDF_DH
                           )
                    VALUES(
                            #YM#
                           ,#INF_RPRT_NO#
                           ,#INF_TYP_CD#
                           ,#TIT_NM#
                           ,#DOC_ID#
                           ,'10'     
                           ,#USR_ID#
                           ,#USR_ID#
                           ,#DPT_CD#
                           ,#MNU_ID#
                           ,SYSDATE
                           ,SYSDATE
                           )
	]]>
	</insert>
	
	<delete id="CSPDCP122EInfRrptInfoDelete" parameterClass="paramMap">
	<![CDATA[
		DELETE /* CSPDCP122EInfRrptInfoDelete */
		  FROM TBCSPDCP501M
		 WHERE YM = #YM#
		   AND INF_RPRT_NO = #INF_RPRT_NO#
	]]>
	</delete>
	
	<delete id="CSPDCP122EInfRrptLineInfoAllDelete" parameterClass="paramMap">
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptLineInfoAllDelete */
			  FROM TBCSPDCP503L
			 WHERE 1=1 
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
	]]>
	</delete>
	
	<delete id="CSPDCP122EInfRrptLineInfoDelete" parameterClass="paramMap">
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptLineInfoAllDelete */
			  FROM TBCSPDCP503L
			 WHERE 1=1 
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
			   AND APV_RPT_PEN_DVSN_CD = #APV_RPT_PEN_DVSN_CD#
			   AND APVR_ID = #APVR_ID#
	]]>
	</delete>
	
	<insert id="CSPDCP122EInfRrptLineInfoInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* CSPDCP122EInfRrptLineInfoInsert */ TBCSPDCP503L(
								 YM
								,INF_RPRT_NO
								,APV_RPT_PEN_DVSN_CD
								,APVR_ID
								,FRT_USR_ID
								,FNL_USR_ID
								,FNL_DEAL_DPT_CD
								,FNL_MNU_ID
								,FRT_REGI_DH
								,FNL_MDF_DH
								)
						VALUES (
								#YM#
								,#INF_RPRT_NO#
								,#APV_RPT_PEN_DVSN_CD#
								,#APVR_ID#
								,#USR_ID#
								,#USR_ID#
								,#DPT_CD#
								,#MNU_ID#
								,SYSDATE
								,SYSDATE
								)
	]]>
	</insert>
	
	<delete id="CSPDCP122EInfRrptOrgInfoAllDelete" parameterClass="paramMap">
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptOrgInfoAllDelete */
			  FROM TBCSPDCP502L
			 WHERE 1=1 
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
	]]>
	</delete>
	
	<delete id="CSPDCP122EInfRrptOrgInfoDelete" parameterClass="paramMap">
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptOrgInfoAllDelete */
			  FROM TBCSPDCP502L
			 WHERE 1=1 
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
			   AND ORG_CD = #ORG_CD#
	]]>
	</delete>
	
	<insert id="CSPDCP122EInfRrptOrgInfoInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* CSPDCP122EInfRrptOrgInfoInsert */ TBCSPDCP502L(
								 YM
								,INF_RPRT_NO
								,ORG_CD
								,FRT_USR_ID
								,FNL_USR_ID
								,FNL_DEAL_DPT_CD
								,FNL_MNU_ID
								,FRT_REGI_DH
								,FNL_MDF_DH
								)
						VALUES (
								#YM#
								,#INF_RPRT_NO#
								,#ORG_CD#
								,#USR_ID#
								,#USR_ID#
								,#DPT_CD#
								,#MNU_ID#
								,SYSDATE
								,SYSDATE
								)
	]]>
	</insert>
	
	<delete id="CSPDCP122EInfRrptPeopleInfoAllDelete" parameterClass="paramMap">
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptPeopleInfoAllDelete */ 
			  FROM TBCSPDCP504L
			 WHERE 1=1 
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
	]]>
	</delete>
	
	<delete id="CSPDCP122EInfRrptPeopleInfoDelete" parameterClass="paramMap">
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptPeopleInfoAllDelete */ 
			  FROM TBCSPDCP504L
			 WHERE 1=1 
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
			   AND SRNO = #SRNO#
	]]>
	</delete>
	
	<insert id="CSPDCP122EInfRrptPeopleInfoInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* CSPDCP122EInfRrptPeopleInfoInsert */ TBCSPDCP504L(
								 YM
								,INF_RPRT_NO
								,SRNO
								,NAM
								,BTDT
								,BLT_ORG_NM
								,RANK_NM
								,PST_NM
								,FRT_USR_ID
								,FNL_USR_ID
								,FNL_DEAL_DPT_CD
								,FNL_MNU_ID
								,FRT_REGI_DH
								,FNL_MDF_DH
								)
						VALUES (
								#YM#
								,#INF_RPRT_NO#
								,(SELECT NVL(MAX(SRNO), 0) + 1
                                     FROM TBCSPDCP504L
                                    WHERE YM = #YM#
                                      AND INF_RPRT_NO = #INF_RPRT_NO#)
								,#NAM#
								,#BTDT#
								,#BLT_ORG_NM#
								,#RANK_NM#
								,#PST_NM#
								,#USR_ID#
								,#USR_ID#
								,#DPT_CD#
								,#MNU_ID#
								,SYSDATE
								,SYSDATE
								)
	]]>
	</insert>
	
	<delete id="CSPDCP122EInfRrptDocDelete" parameterClass="paramMap">
	<![CDATA[
			DELETE /* CSPDCP122EInfRrptDocDelete */
			  FROM TBCSPDCP505M
			 WHERE 1=1 
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
	]]>
	</delete>
	
	<delete id="CSPDCP122EDeleteTBCSPDCP503L" parameterClass="paramMap">
			DELETE 
			  FROM TBCSPDCP503L
			 WHERE 1=1 
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
			   AND APV_RPT_PEN_DVSN_CD = #APV_RPT_PEN_DVSN_CD#
			   AND APVR_ID = #APVR_ID# 
	</delete>
	
	<!-- <update id="CSPDCP122EUpdateTBCSPDCP503L" parameterClass="paramMap">
			UPDATE TBCSPDCP503L
			   SET APV_RPT_PEN_DVSN_CD     = #APV_RPT_PEN_DVSN_CD#
			      ,APVR_ID                 = #APVR_ID# 
			      ,FNL_USR_ID              = #FNL_USR_ID#
   				  ,FNL_DEAL_DPT_CD         = #FNL_DEAL_DPT_CD#
   				  ,FNL_MNU_ID              = #FNL_MNU_ID#
   				  ,FNL_MDF_DH              = SYSDATE 
			 WHERE 1=1
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
			   AND APV_RPT_PEN_DVSN_CD = #APV_RPT_PEN_DVSN_CD#
			   AND APVR_ID = #APVR_ID#
	</update> -->
	
	<delete id="CSPDCP122EDeleteTBCSPDCP502L"  parameterClass="paramMap">
	DELETE 
	  FROM TBCSPDCP502L
	 WHERE 1=1
	   AND YM = #YM#
	   AND INF_RPRT_NO = #INF_RPRT_NO#
	   AND ORG_CD = #ORG_CD#
	</delete>
	
	
	<!-- <update id="CSPDCP122EUpdateTBCSPDCP502L" parameterClass="paramMap">
			UPDATE TBCSPDCP502L
			   SET ORG_CD = #ORG_CD#
			      ,FNL_USR_ID              = #FNL_USR_ID#
   				  ,FNL_DEAL_DPT_CD         = #FNL_DEAL_DPT_CD#
   				  ,FNL_MNU_ID              = #FNL_MNU_ID#
   				  ,FNL_MDF_DH              = SYSDATE 
			 WHERE 1=1
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
			   AND ORG_CD = #ORG_CD#
	</update> -->
	
	<delete id="CSPDCP122EDeleteTBCSPDCP504L"  parameterClass="paramMap">
	DELETE 
	  FROM TBCSPDCP504L
	 WHERE 1=1
	   AND YM = #YM#
	   AND INF_RPRT_NO = #INF_RPRT_NO#
	   AND SRNO = #SRNO#
	</delete>
	
	<!-- <update id="CSPDCP122EUpdateTBCSPDCP504L" parameterClass="paramMap">
			UPDATE TBCSPDCP504L
			   SET NAM                     = NVL(#NAM#, '')
			      ,BTDT                    = NVL(#BTDT#, '')
			      ,BLT_ORG_NM              = NVL(#BLT_ORG_NM#, '')
			      ,RANK_NM                 = NVL(#RANK_NM#, '')
			      ,PST_NM                  = NVL(#PST_NM#, '')
			      ,FNL_USR_ID              = #FNL_USR_ID#
   				  ,FNL_DEAL_DPT_CD         = #FNL_DEAL_DPT_CD#
   				  ,FNL_MNU_ID              = #FNL_MNU_ID#
   				  ,FNL_MDF_DH              = SYSDATE 
			 WHERE 1=1
			   AND YM = #YM#
			   AND INF_RPRT_NO = #INF_RPRT_NO#
			   AND SRNO = #SRNO#
	</update> -->
	
</sqlMap> 
