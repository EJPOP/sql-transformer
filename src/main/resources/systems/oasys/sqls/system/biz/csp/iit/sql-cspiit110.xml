<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/iit/110">

<resultMap class="java.util.HashMap" id="mainselectMap">
     <result property="CSR_BRD_DVSN_CD"           column="CSR_BRD_DVSN_CD"          jdbcType="VARCHAR2"       javaType="java.lang.String"/>     
     <result property="CSR_ACP_DT"                column="CSR_ACP_DT"               jdbcType="VARCHAR2"       javaType="java.lang.String"/>     
     <result property="CSR_DIST_DT"               column="CSR_DIST_DT"              jdbcType="VARCHAR2"       javaType="java.lang.String"/>       
     <result property="CSR_SVC_BEGIN_DT"          column="CSR_SVC_BEGIN_DT"         jdbcType="VARCHAR2"       javaType="java.lang.String"/>       
     <result property="CSR_HNDL_APT_DT"           column="CSR_HNDL_APT_DT"          jdbcType="VARCHAR2"       javaType="java.lang.String"/>    
     <result property="CSR_HNDL_TXT"              column="CSR_HNDL_TXT"             jdbcType="VARCHAR2"       javaType="java.lang.String"/>          
     <result property="CSR_HNDL_CHGR_USR_NM"      column="CSR_HNDL_CHGR_USR_NM"     jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_RCEP_USR_NM"           column="CSR_RCEP_USR_NM"          jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_HNDL_ORD_TXT"          column="CSR_HNDL_ORD_TXT"         jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_MTRL_RQS_SNO"          column="CSR_MTRL_RQS_SNO"         jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_MNG_TSK_DVSN_CD"       column="CSR_MNG_TSK_DVSN_CD"      jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_RQS_DT"                column="CSR_RQS_DT"               jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_RQS_OPEN_YN"           column="CSR_RQS_OPEN_YN"          jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_RQR_USR_NM"            column="CSR_RQR_USR_NM"           jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_RQR_CNB"               column="CSR_RQR_CNB"              jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_RQS_TIT"               column="CSR_RQS_TIT"              jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_RQS_TXT"               column="CSR_RQS_TXT"              jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_RQS_DPT_NM"            column="CSR_RQS_DPT_NM"           jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_PRSS_STA_NM"           column="CSR_PRSS_STA_NM"          jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_RQS_DVSN_CD"           column="CSR_RQS_DVSN_CD"          jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_RET_RSN_TXT"           column="CSR_RET_RSN_TXT"          jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_PRPS_YR"               column="CSR_PRPS_YR"              jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_PRPS_SLN"              column="CSR_PRPS_SLN"             jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_HNDL_RESULT_SEN_YN"    column="CSR_HNDL_RESULT_SEN_YN"   jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="RQS_DOC_ID"                column="RQS_DOC_ID"               jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="HNDL_DOC_ID"               column="HNDL_DOC_ID"              jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="TNB"                		  column="TNB"                  	jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_DTS_TSK_DVSN_CD"       column="CSR_DTS_TSK_DVSN_CD"      jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_HWP_DOC"               column="CSR_HWP_DOC"              jdbcType="CLOB"       	  javaType="java.lang.String"/>  
     <result property="CSR_PRSS_STA_CD"           column="CSR_PRSS_STA_CD"          jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_APV_STA_NM"            column="CSR_APV_STA_NM"           jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_APV_STA_CD"            column="CSR_APV_STA_CD"           jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
     <result property="CSR_APV_DOC_NO"            column="CSR_APV_DOC_NO"           jdbcType="VARCHAR2"       javaType="java.lang.String"/>  
  </resultMap>
	
	<select id="CSPIIT110QMainSelect" parameterClass="paramMap"
		resultClass="resultMap"> 
		<include refid = "include.pageSelct"/>
        <![CDATA[
        SELECT T1.*, 
			   ROWNUM AS NO
          FROM (
			SELECT 		
				A.CSR_BRD_DVSN_CD AS CSR_BRD_DVSN_CD,
		        A.CSR_MTRL_RQS_SNO AS CSR_MTRL_RQS_SNO,			/*자료요청순번*/
		        F_CODE_NM('1001002',A.CSR_MNG_TSK_DVSN_CD) AS CSR_MNG_TSK_DVSN_NM,
		        F_CODE_NM('1001004',A.CSR_RQS_DVSN_CD) AS CSR_RQS_DVSN_NM,
		        A.CSR_RQS_DT AS CSR_RQS_DT,
		        F_USR_INFO(A.CSR_RQR_CNB,'2') AS CSR_RQR_USR_NM,
		        A.CSR_RQR_CNB AS CSR_RQR_CNB,
		        F_DPT_INFO(A.CSR_RQS_DPT_CD,'4') AS CSR_RQS_DPT_NM,
		        A.CSR_RQS_TIT AS CSR_RQS_TIT,
		        F_CODE_NM('1001005',A.CSR_PRSS_STA_CD) AS CSR_PRSS_STA_NM,
		        A.CSR_STSFDG_OPRTN_YN AS CSR_STSFDG_OPRTN_YN,
		        F_USR_INFO(A.CSR_RCEP_CNB,'2') AS CSR_RCEP_NM,
		        A.CSR_ACP_DT AS CSR_ACP_DT,
		        F_USR_INFO(A.CSR_HNDL_CHGR_CNB,'2') AS CSR_HNDL_CHGR_NM,
		        A.CSR_DIST_DT AS CSR_DIST_DT,
		        A.CSR_SVC_BEGIN_DT AS CSR_SVC_BEGIN_DT,
		        A.CSR_RQS_OPEN_YN AS CSR_RQS_OPEN_YN
			FROM   	TBCSPIIT100M A
			WHERE A.CSR_BRD_DVSN_CD = #strBRD_DVSN_CD#
			  AND A.CSR_MNG_DVSN_CD = '04'
        ]]>
        <dynamic>
        	<isNotEmpty property="strCSR_RQS_DTS">
        		AND A.CSR_RQS_DT &gt;= #strCSR_RQS_DTS#
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_RQS_DTE">
        		AND A.CSR_RQS_DT &lt;= #strCSR_RQS_DTE#
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_MNG_TSK_DVSN_CD">
        		AND A.CSR_MNG_TSK_DVSN_CD = #strCSR_MNG_TSK_DVSN_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_RQS_DVSN_CD">
        		AND A.CSR_RQS_DVSN_CD = #strCSR_RQS_DVSN_CD#
        	</isNotEmpty>
        	<isEqual property="strRESULT_CD" compareValue="0">
        		AND	A.CSR_SVC_BEGIN_DT IS NULL 
        		AND A.CSR_PRSS_STA_CD = '01'
        	</isEqual>
        	<isEqual property="strRESULT_CD" compareValue="1">
        		AND	A.CSR_SVC_BEGIN_DT IS NULL 
        		AND A.CSR_PRSS_STA_CD > '01'         		
        	</isEqual>
        	<isEqual property="strRESULT_CD" compareValue="2">
        		AND	A.CSR_SVC_BEGIN_DT IS NOT NULL
        	</isEqual>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	(F_DPT_INFO(A.CSR_RQS_DPT_CD,'1') LIKE '%'||#strSEARCH_NM#||'%'        			
			        OR F_DPT_INFO(A.CSR_HNDL_DPT_CD,'1') LIKE '%'||#strSEARCH_NM#||'%'
			        OR A.CSR_RQS_TIT LIKE '%'||#strSEARCH_NM#||'%'
			        OR A.CSR_RQS_TXT LIKE '%'||#strSEARCH_NM#||'%'
			        OR A.CSR_HNDL_TXT LIKE '%'||#strSEARCH_NM#||'%')
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_RQR_USR_NM">
        		AND F_USR_INFO(A.CSR_RQR_CNB,'2') LIKE '%'||#strCSR_RQR_USR_NM#||'%'
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_RCEP_USR_NM">
        		AND F_USR_INFO(A.CSR_RCEP_CNB,'2') LIKE '%'||#strCSR_RCEP_USR_NM#||'%'
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_HNDL_CHGR_USR_NM">
        		AND F_USR_INFO(A.CSR_HNDL_CHGR_CNB,'2') LIKE '%'||#strCSR_HNDL_CHGR_USR_NM#||'%'
        	</isNotEmpty>
        	
        	<isEmpty property="strAUTH_CD" >
        		AND	 A.CSR_RQR_CNB = #strCNB#
        	</isEmpty>
			<isNotEmpty property="strAUTH_CD" >	
	        	<isEqual property="strAUTH_CD" compareValue="PERS">
	        		AND	 A.CSR_RQR_CNB = #strCNB#
	        	</isEqual> 	
	        	<isEqual property="strAUTH_CD" compareValue="DEPT">
	        		AND	(A.CSR_RQS_OPEN_YN='Y' OR A.CSR_RQR_CNB = #strCNB#) 
	        		AND (A.CSR_PRSS_STA_CD > '01' OR A.CSR_RQR_CNB = #strCNB#)	        		 
	        	</isEqual>
		        <isEqual property="strAUTH_CD" compareValue="ALL">
		        	
		        </isEqual>
	        </isNotEmpty>
        </dynamic>
			    
        <![CDATA[
        	ORDER BY A.CSR_RQS_DT, TO_NUMBER(A.CSR_MTRL_RQS_SNO) ASC ) T1
        ]]>
        <include refid = "include.pageOrder"/> 
	</select>     
	
	<select id="CSPIIT111EMainSelect" parameterClass="paramMap"
		resultMap="mainselectMap">
        <![CDATA[
        	SELECT  A.CSR_BRD_DVSN_CD AS CSR_BRD_DVSN_CD
        			,A.CSR_ACP_DT AS CSR_ACP_DT
			        ,A.CSR_DIST_DT AS CSR_DIST_DT
			        ,A.CSR_HNDL_APT_DT AS CSR_HNDL_APT_DT
			        ,A.CSR_SVC_BEGIN_DT AS CSR_SVC_BEGIN_DT
			        ,A.CSR_HNDL_TXT AS CSR_HNDL_TXT
			        ,F_USR_INFO(A.CSR_HNDL_CHGR_CNB,'2') AS CSR_HNDL_CHGR_USR_NM
			        ,F_USR_INFO(A.CSR_RCEP_CNB,'2') AS CSR_RCEP_USR_NM
			        ,A.CSR_HNDL_ORD_TXT AS CSR_HNDL_ORD_TXT
			        ,A.CSR_MTRL_RQS_SNO AS CSR_MTRL_RQS_SNO
			        ,A.CSR_MNG_TSK_DVSN_CD AS CSR_MNG_TSK_DVSN_CD
			        ,A.CSR_RQS_DT AS CSR_RQS_DT
			        ,A.CSR_RQS_OPEN_YN AS CSR_RQS_OPEN_YN
			        ,F_USR_INFO(A.CSR_RQR_CNB,'2')  AS CSR_RQR_USR_NM
			        ,A.CSR_RQR_CNB AS CSR_RQR_CNB
			        ,A.CSR_RQS_TIT AS CSR_RQS_TIT
			        ,A.CSR_RQS_TXT AS CSR_RQS_TXT
			        ,F_DPT_INFO(A.CSR_RQS_DPT_CD,'1') AS CSR_RQS_DPT_NM
			        ,F_CODE_NM('1001005',A.CSR_PRSS_STA_CD) AS CSR_PRSS_STA_NM
			        ,A.CSR_RQS_DVSN_CD AS CSR_RQS_DVSN_CD
			        ,A.CSR_RET_RSN_TXT AS CSR_RET_RSN_TXT
			        ,A.CSR_PRPS_YR AS CSR_PRPS_YR
			        ,A.CSR_PRPS_SLN AS CSR_PRPS_SLN
			        ,NVL(A.CSR_HNDL_RESULT_SEN_YN, 'N') AS CSR_HNDL_RESULT_SEN_YN 
			        ,(SELECT DOC_ID
			          FROM TBCSPIIT009M Z
			             WHERE Z.MTRL_RQS_SNO = A.CSR_MTRL_RQS_SNO
			               AND Z.COPUT_BRD_DVSN_CD = A.CSR_BRD_DVSN_CD
			               AND Z.MTRL_RQS_ATT_FL_DVSN_CD = '3' ) AS RQS_DOC_ID
			        ,(SELECT DOC_ID
			          FROM TBCSPIIT009M Z
			            WHERE Z.MTRL_RQS_SNO = A.CSR_MTRL_RQS_SNO
			               AND Z.COPUT_BRD_DVSN_CD = A.CSR_BRD_DVSN_CD
			               AND Z.MTRL_RQS_ATT_FL_DVSN_CD = '4' ) AS HNDL_DOC_ID 
			        ,(SELECT TNB
			          FROM TBDCMACM001M
			            WHERE CNB = A.CSR_RQR_CNB ) AS TNB
			        ,A.CSR_DTS_TSK_DVSN_CD AS CSR_DTS_TSK_DVSN_CD
			        ,A.CSR_HWP_DOC AS CSR_HWP_DOC
			        ,A.CSR_PRSS_STA_CD AS CSR_PRSS_STA_CD
			        ,F_CODE_NM('1000333',NVL(A.CSR_APV_STA_CD,'1')) AS CSR_APV_STA_NM
			        ,A.CSR_APV_STA_CD AS CSR_APV_STA_CD
			        ,A.CSR_APV_DOC_NO AS CSR_APV_DOC_NO
			  FROM TBCSPIIT100M A
			    WHERE 1=1 
			    ]]>
			    <isNotEmpty property="strMTRL_RQS_SNO">
				    AND 	A.CSR_MTRL_RQS_SNO = #strMTRL_RQS_SNO#
				</isNotEmpty>
				<isNotEmpty property="strBRD_DVSN_CD">
				 	AND		A.CSR_BRD_DVSN_CD = #strBRD_DVSN_CD# /*게시판구분코드 - 개선요청01, 자료요청02*/
				</isNotEmpty>
				<isEmpty property="strMTRL_RQS_SNO">
					AND 	(A.CSR_APV_DOC_NO = #strDOC_NO# OR A.CSR_HNDL_APV_DOC_NO = #strDOC_NO#)
				</isEmpty>
		
	</select>
	
	<select id="CSPIIT110QselectCheckOprtnYn" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
        	SELECT  A.CSR_RQR_CNB, A.CSR_STSFDG_OPRTN_YN
			  FROM TBCSPIIT100M A
			    WHERE A.CSR_MTRL_RQS_SNO = #strMTRL_RQS_SNO#
			    AND A.CSR_BRD_DVSN_CD = #strBRD_DVSN_CD#
		]]>
	</select>
	
	<!-- 전산장애 요청 년도, 요청연번 Max값 가져오기 -->
	<select id="CSPIIT111EPrpsKeySelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(CSR_MTRL_RQS_SNO)),0)+1) AS CSR_MTRL_RQS_SNO
				  FROM TBCSPIIT100M
				 WHERE 1=1
		]]>
				   AND CSR_BRD_DVSN_CD = '01' 
	</select>
	
	<select id="CSPIIT111EKeySelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(CSR_MTRL_RQS_SNO)),0)+1) AS CSR_MTRL_RQS_SNO
				  FROM TBCSPIIT100M
				 WHERE 1=1
		]]>
				   AND CSR_BRD_DVSN_CD = #CSR_BRD_DVSN_CD# 
	</select>
	
	<insert id="CSPIIT111EMainInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPIIT100M
        	(		CSR_BRD_DVSN_CD,
        			CSR_MNG_DVSN_CD,
                    CSR_MNG_TSK_DVSN_CD, 
                    CSR_DTS_TSK_DVSN_CD, 
                    CSR_RQS_DVSN_CD, 
                    CSR_RQS_OPEN_YN, 
                    CSR_RQR_CNB,		
                    CSR_RQS_DPT_CD, 
                    CSR_RQS_YR,
                    CSR_RQS_DT,			
                    CSR_RQS_TIT,	
        			CSR_RQS_TXT,		
        			CSR_MTRL_RQS_SNO,			
					CSR_PRSS_STA_CD,
                    CSR_STSFDG_OPRTN_YN,
					CSR_HWP_DOC,
        			FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
        	) VALUES (
        			#CSR_BRD_DVSN_CD#,
        			'04',
	        		#CSR_MNG_TSK_DVSN_CD#, 
                    #CSR_DTS_TSK_DVSN_CD#, 
                    #CSR_RQS_DVSN_CD#, 
                    #CSR_RQS_OPEN_YN#, 
                    #CSR_RQR_CNB#,		
                    F_USR_INFO(#CSR_RQR_CNB#,'5'),
                    SUBSTR(#CSR_RQS_DT#,'1','4'),
                    #CSR_RQS_DT#,			
                    #CSR_RQS_TIT#,		
        			#CSR_RQS_TXT#,		
        			#CSR_MTRL_RQS_SNO#,			
					'01',
					'N',
                    #CSR_HWP_DOC#,
					#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
                    SYSDATE
        	)
        ]]>
	</insert>
	
	<insert id="CSPIIT110LInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPIIT100L
        	(		CSR_BRD_DVSN_CD,
					CSR_MTRL_RQS_SNO,
					CSR_WRK_NO,
					CSR_STFT_CHO_TYP_CD,
					CSR_STFT_SC,
					CSR_STFT_OPIN_TXT,
					CSR_STFT_SVY_TYP_CD,
        			FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
        	) VALUES (
        			#CSR_BRD_DVSN_CD#,
					#CSR_MTRL_RQS_SNO#,
					(SELECT CSR_HNDL_YR||'-'||CSR_HNDL_WRK_SNO 
					   FROM TBCSPIIT100M 
					  WHERE CSR_BRD_DVSN_CD = #CSR_BRD_DVSN_CD# 
					    AND CSR_MTRL_RQS_SNO = #CSR_MTRL_RQS_SNO#),
					#CSR_STFT_CHO_TYP_CD#,
					#CSR_STFT_SC#,
					#CSR_STFT_OPIN_TXT#,
					'01',
					#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
                    SYSDATE
        	)
        ]]>
	</insert>
	
	<update id="CSPIIT111EMainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE 	TBCSPIIT100M
			SET		
                    CSR_MNG_TSK_DVSN_CD = #CSR_MNG_TSK_DVSN_CD#
                    ,CSR_DTS_TSK_DVSN_CD = #CSR_DTS_TSK_DVSN_CD#
                    ,CSR_RQS_DVSN_CD = #CSR_RQS_DVSN_CD# 
                    ,CSR_RQS_OPEN_YN = #CSR_RQS_OPEN_YN#
                    ,CSR_RQR_CNB = #CSR_RQR_CNB#		
                    ,CSR_RQS_DPT_CD = F_USR_INFO(#CSR_RQR_CNB#,'5') 
                    ,CSR_RQS_YR = SUBSTR(#CSR_RQS_DT#,'1','4')
                    ,CSR_RQS_DT = #CSR_RQS_DT#			
                    ,CSR_RQS_TIT = #CSR_RQS_TIT#		
        			,CSR_RQS_TXT = #CSR_RQS_TXT#		
					,CSR_HWP_DOC = #CSR_HWP_DOC#
					,CSR_PRSS_STA_CD = #CSR_PRSS_STA_CD#
					,FNL_USR_ID = #FNL_USR_ID#
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID = #FNL_MNU_ID#
					,FNL_MDF_DH = SYSDATE
			WHERE	CSR_MTRL_RQS_SNO = #CSR_MTRL_RQS_SNO#
			AND		CSR_BRD_DVSN_CD = #CSR_BRD_DVSN_CD#
		]]>
	</update>
	<update id="CSPIIT111EMainUpdateStsfdg" parameterClass="paramMap">
		<![CDATA[
			UPDATE 	TBCSPIIT100M
			SET		
                    CSR_STSFDG_OPRTN_YN = 'Y'		
					,FNL_USR_ID = #FNL_USR_ID#
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID = #FNL_MNU_ID#
					,FNL_MDF_DH = SYSDATE
			WHERE	CSR_MTRL_RQS_SNO = #strMTRL_RQS_SNO#
			AND		CSR_BRD_DVSN_CD = #strBRD_DVSN_CD#
		]]>
	</update> 
	
	<delete id="CSPIIT111EMainDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE	
			FROM	TBCSPIIT100M
			WHERE	CSR_MTRL_RQS_SNO = #CSR_MTRL_RQS_SNO#
			AND		CSR_BRD_DVSN_CD = #CSR_BRD_DVSN_CD#
		]]>
	</delete>
	
	<insert id="CSPIIT111ERqsFileInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPIIT009M
        	(
        			COPUT_BRD_DVSN_CD,	/*게시판구분코드 - 전산개선요청*/
        			MTRL_RQS_SNO,			/*자료요청순번*/
        			MTRL_RQS_ATT_FL_DVSN_CD,		/*자료요청첨부파일구분코드*/
        			DOC_ID,			/*요청일*/
        			FRT_USR_ID,
        			FNL_USR_ID,
        			FNL_DEAL_DPT_CD,
        			FNL_MNU_ID,
        			FRT_REGI_DH,
        			FNL_MDF_DH
        	) VALUES (
        			#CSR_BRD_DVSN_CD#,
	        		#CSR_MTRL_RQS_SNO#,
	        		'3',
	        		#RQS_DOC_ID#,
	        		#FRT_USR_ID#,
	        		#FNL_USR_ID#,
	        		#FNL_DEAL_DPT_CD#,
	        		#FNL_MNU_ID#,
	        		SYSDATE,
	        		SYSDATE
        	)
        ]]>
	</insert>
	
	<insert id="CSPIIT111EHndlFileInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPIIT009M
        	(	
        			COPUT_BRD_DVSN_CD,	/*게시판구분코드 - 전산개선요청*/
        			MTRL_RQS_SNO,			/*자료요청순번*/
        			MTRL_RQS_ATT_FL_DVSN_CD,		/*자료요청첨부파일구분코드*/
        			DOC_ID,			/*요청일*/
        			FRT_USR_ID,
        			FNL_USR_ID,
        			FNL_DEAL_DPT_CD,
        			FNL_MNU_ID,
        			FRT_REGI_DH,
        			FNL_MDF_DH
        	) VALUES (
        			#CSR_BRD_DVSN_CD#,
	        		#CSR_MTRL_RQS_SNO#,
	        		'4',
	        		#HNDL_DOC_ID#,
	        		#FRT_USR_ID#,
	        		#FNL_USR_ID#,
	        		#FNL_DEAL_DPT_CD#,
	        		#FNL_MNU_ID#,
	        		SYSDATE,
	        		SYSDATE
        	)
        ]]>
	</insert>
	
	<delete id="CSPIIT111EFileDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE	
			FROM	TBCSPIIT009M
			WHERE	MTRL_RQS_SNO = #CSR_MTRL_RQS_SNO#
			AND		COPUT_BRD_DVSN_CD = #CSR_BRD_DVSN_CD#
			AND		MTRL_RQS_ATT_FL_DVSN_CD IN('3','4')
		]]>
	</delete>
	
	<!-- 사이버보안요청 엑셀다운로드 -->
	<select id="CSPIIT110QExcelExportSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
			/*CSPIIT110QExcelExportSelect*/
			SELECT 		
		        A.CSR_MTRL_RQS_SNO AS CSR_MTRL_RQS_SNO,			/*자료요청순번*/
		        F_CODE_NM('1001002',A.CSR_MNG_TSK_DVSN_CD) AS CSR_MNG_TSK_DVSN_NM,
		        F_CODE_NM('1001004',A.CSR_RQS_DVSN_CD) AS CSR_RQS_DVSN_NM,
		        A.CSR_RQS_DT AS CSR_RQS_DT,
		        F_USR_INFO(A.CSR_RQR_CNB,'2') AS CSR_RQR_USR_NM,
		        F_DPT_INFO(A.CSR_RQS_DPT_CD,'4') AS CSR_RQS_DPT_NM,
		        A.CSR_RQS_TIT AS CSR_RQS_TIT,
		        F_CODE_NM('1001005',A.CSR_PRSS_STA_CD) AS CSR_PRSS_STA_NM,
		        A.CSR_STSFDG_OPRTN_YN AS CSR_STSFDG_OPRTN_YN,
		        F_USR_INFO(A.CSR_RCEP_CNB,'2') AS CSR_RCEP_NM,
		        A.CSR_ACP_DT AS CSR_ACP_DT,
		        F_USR_INFO(A.CSR_HNDL_CHGR_CNB,'2') AS CSR_HNDL_CHGR_NM,
		        A.CSR_DIST_DT AS CSR_DIST_DT
			FROM   	TBCSPIIT100M A
			WHERE	A.CSR_BRD_DVSN_CD = #strBRD_DVSN_CD#
			  AND   A.CSR_MNG_DVSN_CD = '04'
        ]]>
        <dynamic>
        	<isNotEmpty property="strCSR_RQS_DTS">
        		AND A.CSR_RQS_DT &gt;= #strCSR_RQS_DTS#
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_RQS_DTE">
        		AND A.CSR_RQS_DT &lt;= #strCSR_RQS_DTE#
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_MNG_TSK_DVSN_CD">
        		AND A.CSR_MNG_TSK_DVSN_CD = #strCSR_MNG_TSK_DVSN_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_RQS_DVSN_CD">
        		AND A.CSR_RQS_DVSN_CD = #strCSR_RQS_DVSN_CD#
        	</isNotEmpty>
        	<isEqual property="strRESULT_CD" compareValue="0">
        		AND	A.CSR_SVC_BEGIN_DT IS NULL 
        		AND A.CSR_PRSS_STA_CD = '01'
        	</isEqual>
        	<isEqual property="strRESULT_CD" compareValue="1">
        		AND	A.CSR_SVC_BEGIN_DT IS NULL 
        		AND A.CSR_PRSS_STA_CD > '01' 
        	</isEqual>
        	<isEqual property="strRESULT_CD" compareValue="2">
        		AND	A.CSR_SVC_BEGIN_DT IS NOT NULL
        	</isEqual>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	(F_DPT_INFO(A.CSR_RQS_DPT_CD,'1') LIKE '%'||#strSEARCH_NM#||'%'        			
			        OR F_DPT_INFO(A.CSR_HNDL_DPT_CD,'1') LIKE '%'||#strSEARCH_NM#||'%'
			        OR A.CSR_RQS_TIT LIKE '%'||#strSEARCH_NM#||'%'
			        OR A.CSR_RQS_TXT LIKE '%'||#strSEARCH_NM#||'%'
			        OR A.CSR_HNDL_TXT LIKE '%'||#strSEARCH_NM#||'%')
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_RQR_USR_NM">
        		AND F_USR_INFO(A.CSR_RQR_CNB,'2') LIKE '%'||#strCSR_RQR_USR_NM#||'%'
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_RCEP_USR_NM">
        		AND F_USR_INFO(A.CSR_RCEP_CNB,'2') LIKE '%'||#strCSR_RCEP_USR_NM#||'%'
        	</isNotEmpty>
        	<isNotEmpty property="strCSR_HNDL_CHGR_USR_NM">
        		AND F_USR_INFO(A.CSR_HNDL_CHGR_CNB,'2') LIKE '%'||#strCSR_HNDL_CHGR_USR_NM#||'%'
        	</isNotEmpty>
        	
			<isEmpty property="strAUTH_CD" >
        		AND	 A.CSR_RQR_CNB = #strCNB#
        	</isEmpty>
			<isNotEmpty property="strAUTH_CD" >	
	        	<isEqual property="strAUTH_CD" compareValue="PERS">
	        		AND	 A.CSR_RQR_CNB = #strCNB#
	        	</isEqual> 	
	        	<isEqual property="strAUTH_CD" compareValue="DEPT">
	        		AND	(A.CSR_RQS_OPEN_YN='Y' OR A.CSR_RQR_CNB = #strCNB#) 
	        		AND (A.CSR_PRSS_STA_CD > '01' OR A.CSR_RQR_CNB = #strCNB#)	        		 
	        	</isEqual>
		        <isEqual property="strAUTH_CD" compareValue="ALL">
		        	
		        </isEqual>
	        </isNotEmpty>
	        
        </dynamic>
        <![CDATA[
        	ORDER BY TO_NUMBER(A.CSR_MTRL_RQS_SNO) DESC
        ]]>
	</select>
	
	<select id="CSPIIT110PselectStsfdg" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
        	SELECT  CSR_BRD_DVSN_CD,
        			CSR_MTRL_RQS_SNO,
					CSR_STFT_OPIN_TXT,
					CSR_STFT_CHO_TYP_CD,
					CSR_STFT_SC
			  FROM TBCSPIIT100L A
			    WHERE A.CSR_MTRL_RQS_SNO = #strMTRL_RQS_SNO#
			    AND A.CSR_BRD_DVSN_CD = #strBRD_DVSN_CD#
		]]>
	</select>
	
	<delete id="CSPIIT110LDelete" parameterClass="paramMap">
        <![CDATA[
	        DELETE	
				FROM	TBCSPIIT100L
				WHERE	CSR_BRD_DVSN_CD = #CSR_BRD_DVSN_CD#
					AND CSR_MTRL_RQS_SNO = #CSR_MTRL_RQS_SNO#
        ]]>
	</delete>
	
	<update id="CSPIIT111EApvSave" parameterClass="paramMap">
			UPDATE	TBCSPIIT100M
			SET		CSR_APV_STA_CD = #APV_STA_CD#
					,CSR_APV_DOC_NO = #APV_DOC_NO#
			<isEqual property="APV_STA_CD" compareValue="3">
				<isNotEqual property="PRSS_STA_CD" compareValue="04">				
					,CSR_HNDL_YR = SUBSTR(SYSDATE,0,4)
					,CSR_HNDL_WRK_SNO = (SELECT TO_CHAR(NVL(MAX(TO_NUMBER(CSR_HNDL_WRK_SNO)),0)+1) 
									   FROM TBCSPIIT100M 
									  WHERE CSR_HNDL_YR = SUBSTR(SYSDATE,0,4))
				</isNotEqual>					
					,CSR_PRSS_STA_CD = '02'
			</isEqual>					
					,FNL_USR_ID = #FNL_USR_ID#
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID = #FNL_MNU_ID#
					,FNL_MDF_DH = SYSDATE
			WHERE	CSR_BRD_DVSN_CD = #brdDvsnCd#
			AND		CSR_MTRL_RQS_SNO = #mtrlRqsSno#
	</update>

	
	<select id="CSPIIT111ESelectKey" parameterClass="paramMap"	resultClass="resultMap">
        	SELECT	A.CSR_BRD_DVSN_CD 
        			,A.CSR_MTRL_RQS_SNO
        	FROM	TBCSPIIT100M A 
        	WHERE   A.CSR_APV_DOC_NO = #APV_DOC_NO#
	</select>
	
	<select id="CSPIIT111ESelectPrssStaCd" parameterClass="paramMap"	resultClass="resultMap">
        	SELECT	A.CSR_PRSS_STA_CD AS PRSS_STA_CD        				        		
        	FROM	TBCSPIIT100M A 
        	WHERE   A.CSR_BRD_DVSN_CD = #brdDvsnCd#
			AND		A.CSR_MTRL_RQS_SNO = #mtrlRqsSno#
	</select>
	
	<update id="CSPIIT111ESubmit" parameterClass="paramMap">
		UPDATE	TBCSPIIT100M
		SET		
				CSR_PRSS_STA_CD = '02'
		<isNotEqual property="strPRSS_STA_CD" compareValue="04">				
				,CSR_HNDL_YR = SUBSTR(SYSDATE,0,4)
				,CSR_HNDL_WRK_SNO = (SELECT TO_CHAR(NVL(MAX(TO_NUMBER(CSR_HNDL_WRK_SNO)),0)+1) 
									   FROM TBCSPIIT100M 
									  WHERE CSR_HNDL_YR = SUBSTR(SYSDATE,0,4))
		</isNotEqual>			
				,FNL_USR_ID = #FNL_USR_ID#
				,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				,FNL_MNU_ID = #FNL_MNU_ID#
				,FNL_MDF_DH = SYSDATE
		WHERE	CSR_BRD_DVSN_CD = #strBRD_DVSN_CD#
		AND		CSR_MTRL_RQS_SNO = #strMTRL_RQS_SNO#
	
	</update>
	
</sqlMap> 
