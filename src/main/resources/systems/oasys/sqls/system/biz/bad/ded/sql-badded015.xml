<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ded/015">
	<!-- 출장여비수령계좌관리를 조회한다.  -->
	<select id="BADDED015PMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT D1.BZT_YR            AS BZT_YR
			     , D1.BZT_SNO           AS BZT_SNO
			     , D1.PCT_CNB           AS PCT_CNB
			     , D1.PCT_NM            AS PCT_NM
			     , D1.PCT_RANK_CD                                           AS PCT_RANK_CD
			     , F_CODE_NM('1000173', D1.PCT_RANK_CD)                     AS PCT_RANK_NM
			     , NVL(D1.BNK_CD, NVL(D3.BZT_TREXP_RCIT_BNK_CD,D2.BNK_CD))  AS BNK_CD
			     , F_CODE_NM('1000166',NVL(D1.BNK_CD, NVL(D3.BZT_TREXP_RCIT_BNK_CD,D2.BNK_CD)) ) AS BNK_NM
			     , NVL(D1.EAN , NVL(D3.BZT_TREXP_RCIT_EAN, D2.EAN))         AS EAN
			     , D1.LEAD_EXS_RCV_EXS_RCIT_PEN_YN                          AS LEAD_EXS_RCV_EXS_RCIT_PEN_YN    
			  FROM TBBADDED010L D1
			     , TBCSPLFI103M D2
                 , TBDCMACM001M D3 /* 사용자정보기본 - 2017.04.10 yyh */			     
			 WHERE 1=1
			  AND D1.PCT_CNB = D2.CNB(+)
              AND D1.PCT_CNB = D3.CNB(+) 			  
		]]>
		<isNotEmpty property="BZT_YR">	 
			     AND D1.BZT_YR      = #BZT_YR#
		</isNotEmpty>
		<isNotEmpty property="BZT_SNO">	 
			     AND D1.BZT_SNO      = #BZT_SNO#
		</isNotEmpty>		
        <![CDATA[       
 ORDER BY D1.PCT_RANK_CD, D1.PCT_CNB
        ]]>
	</select>

	<!-- 수당은행게좌기본 수정 -->
	<update id="BADDED015PMainupdate" parameterClass="paramMap">
        <![CDATA[ 
        	/* TBCSPLFI103M -> TBDCMACM001M 변경 - 2017.04.10 yyh */
        	UPDATE TBDCMACM001M  	
        	   SET BZT_TREXP_RCIT_BNK_CD  = #BNK_CD#
				 , BZT_TREXP_RCIT_EAN	  = #EAN#			 
				 , FNL_USR_ID             = #FNL_USR_ID#
				 , FNL_DEAL_DPT_CD        = #FNL_DEAL_DPT_CD#
	 			 , FNL_MNU_ID             = #FNL_MNU_ID#
	 			 , FNL_MDF_DH             = SYSDATE
			  WHERE 1=1
				AND CNB = #PCT_CNB#
		]]>				    
	</update>
	
</sqlMap> 

