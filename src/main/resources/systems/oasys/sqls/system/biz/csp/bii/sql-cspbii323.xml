<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/bii/323">

	<!-- 기본정보 조회 -->   
	<select id="CSPBII323PMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.EIN
			      ,T1.DBT_PSN_DVSN_CD
			      ,T1.TYP_DVSN_CD
			      ,T1.BLT_ORG_NM
			      ,T1.BLT_PST_NM
			      ,T1.SMM_TXT
			      ,T1.ASG_DT
			      ,T1.CHGR_CNB
			      ,F_USR_INFO(T1.CHGR_CNB,'2') AS CHGR_NM
			  FROM TBCSPBII380M T1
			 WHERE T1.EIN = #strEin#
		]]>
	</select>
	
	<select id="CSPBII323PDtlSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.EIN
			      ,T2.SRNO
			      ,T2.REL_INF_DVSN_CD
			      ,F_CODE_NM('1000910',T2.REL_INF_DVSN_CD) AS REL_INF_DVSN_NM
			      ,T2.TSK_KEY1
			      ,T2.TSK_KEY2
			      ,T2.TSK_KEY3
			      ,T2.TSK_KEY4
			      ,T2.TSK_KEY5
			      ,T2.REL_INF_TXT
			  FROM TBCSPBII380M T1
			      ,TBCSPBII381L T2
			 WHERE T1.EIN = #strEin#
			   AND T1.EIN = T2.EIN
			 ORDER BY T2.SRNO DESC
		]]>
	</select>
	
	
	
	<update id="CSPBII323PMainMerge" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO TBCSPBII380M T1
			USING ( SELECT #EIN# AS EIN
			          FROM DUAL
			      ) T2
			   ON ( T1.EIN = T2.EIN
			      )
			 WHEN MATCHED THEN
			      UPDATE 
			         SET DBT_PSN_DVSN_CD = #DBT_PSN_DVSN_CD#
			            ,TYP_DVSN_CD = #TYP_DVSN_CD#
			            ,BLT_ORG_NM = #BLT_ORG_NM#
			            ,BLT_PST_NM = #BLT_PST_NM#
			            ,SMM_TXT = #SMM_TXT#
			            ,ASG_DT = #ASG_DT#
			            ,FNL_USR_ID = #FNL_USR_ID#
			            ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			            ,FNL_MNU_ID = #FNL_MNU_ID#
			            ,FNL_MDF_DH = SYSDATE
			            ,CHGR_CNB = #CHGR_CNB#
			 WHEN NOT MATCHED THEN
			      INSERT ( EIN
			              ,DBT_PSN_DVSN_CD
			              ,TYP_DVSN_CD
			              ,BLT_ORG_NM
			              ,BLT_PST_NM
			              ,SMM_TXT
			              ,ASG_DT
			              ,FRT_USR_ID
			              ,FNL_USR_ID
			              ,FNL_DEAL_DPT_CD
			              ,FNL_MNU_ID
			              ,FRT_REGI_DH
			              ,FNL_MDF_DH
			              ,CHGR_CNB
			             )
			      VALUES ( #EIN#
			              ,#DBT_PSN_DVSN_CD#
			              ,#TYP_DVSN_CD#
			              ,#BLT_ORG_NM#
			              ,#BLT_PST_NM#
			              ,#SMM_TXT#
			              ,#ASG_DT#
			              ,#FNL_USR_ID#
			              ,#FNL_USR_ID#
			              ,#FNL_DEAL_DPT_CD#
			              ,#FNL_MNU_ID#
			              ,SYSDATE
			              ,SYSDATE
			              ,#CHGR_CNB#
			             )
		]]>
	</update>
	
	
	<insert id="CSPBII323PDtlInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPBII381L 
					( EIN
					 ,SRNO
					 ,REL_INF_DVSN_CD
					 ,TSK_KEY1
					 ,TSK_KEY2
					 ,TSK_KEY3
					 ,TSK_KEY4
					 ,TSK_KEY5
					 ,REL_INF_TXT
					 ,FRT_USR_ID
		             ,FNL_USR_ID
		             ,FNL_DEAL_DPT_CD
		             ,FNL_MNU_ID
		             ,FRT_REGI_DH
		             ,FNL_MDF_DH
					)
				VALUES ( #EIN#
					    ,(SELECT NVL(MAX(SRNO),0)+1 FROM TBCSPBII381L WHERE EIN = #EIN#)
					    ,#REL_INF_DVSN_CD#
					    ,#TSK_KEY1#
					    ,#TSK_KEY2#
					    ,#TSK_KEY3#
					    ,#TSK_KEY4#
					    ,#TSK_KEY5#
					    ,#REL_INF_TXT#
					    ,#FRT_USR_ID#
		                ,#FNL_USR_ID#
		                ,#FNL_DEAL_DPT_CD#
		                ,#FNL_MNU_ID#
		                ,SYSDATE
		                ,SYSDATE
				       )
		]]>
	</insert>
	
	<update id="CSPBII323PDtlUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPBII381L
			   SET REL_INF_DVSN_CD = #REL_INF_DVSN_CD#
			      ,TSK_KEY1 = #TSK_KEY1#
			      ,TSK_KEY2 = #TSK_KEY2#
			      ,TSK_KEY3 = #TSK_KEY3#
			      ,TSK_KEY4 = #TSK_KEY4#
			      ,TSK_KEY5 = #TSK_KEY5#
			      ,REL_INF_TXT = #REL_INF_TXT#
			      ,FNL_USR_ID = #FNL_USR_ID#
			      ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			      ,FNL_MNU_ID = #FNL_MNU_ID#
			      ,FNL_MDF_DH = SYSDATE
			 WHERE EIN = #EIN#
			   AND SRNO = #SRNO#
		]]>
	</update>
	
	<delete id="CSPBII323PDtlDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE
			  FROM TBCSPBII381L
			 WHERE EIN = #EIN#
			   AND SRNO = #SRNO#
		]]>
	</delete>
	
</sqlMap> 
