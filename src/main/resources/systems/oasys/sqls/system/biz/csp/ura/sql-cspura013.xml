<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/ura/013">

	<select id="CSPURA013EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT	DISTINCT
					A.STD_YE
					, A.STD_SLN
					, A.STD_TASK_NM
					, A.STD_DVSN_TXT
					, A.TASK_TYP_NM
					, A.STD_PRD_TXT
					, A.STD_MNTH_CNT
					, A.RT
					, A.RMK_SBJ
			FROM	TBCSPURA008M A
					, TBCSPURA009D B
			WHERE	A.STD_YE = B.STD_YE(+)
			AND		A.STD_SLN = B.STD_SLN(+)
		]]>	
		<isNotEmpty property="fromSTD_YE">
			<isNotEmpty property="toSTD_YE">
			AND		A.STD_YE BETWEEN #fromSTD_YE# AND #toSTD_YE#
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty property="strDPT_CD">
			AND		B.CNB IN (SELECT 	CNB
					  FROM		TBDCMACM001M
					  WHERE		DPT_CD = #strDPT_CD#)
		</isNotEmpty>
		<isNotEmpty property="strROLE_DVSN_CD">
			AND		B.ROLE_DVSN_CD = #strROLE_DVSN_CD#
		</isNotEmpty>
		<isNotEmpty property="strTASK_TYP_NM">
			AND		A.TASK_TYP_NM LIKE '%' || #strTASK_TYP_NM# || '%'		
		</isNotEmpty>
		<isNotEmpty property="strUSR_NAM">
			AND 	B.CNB IN (SELECT 	CNB
				  FROM		TBDCMACM001M
				  WHERE		USR_NAM LIKE '%' || #strUSR_NAM# || '%')
		</isNotEmpty>
		<isNotEmpty property="strSTD_TASK_NM">
			AND		A.STD_TASK_NM LIKE '%' || #strSTD_TASK_NM# || '%'
		</isNotEmpty>
		<isNotEmpty property="strRMK_SBJ">
			AND		A.RMK_SBJ LIKE '%' || #strRMK_SBJ# || '%'
		</isNotEmpty>
		<![CDATA[
			ORDER BY A.STD_YE, A.RT, A.STD_DVSN_TXT
		]]>	
	</select>
	
	<select id="CSPURA013EUsrSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
		 SELECT A.STD_YE,
		        A.STD_SLN,
		        A.CNB,
		        C.DPT_NM,
		        (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000173' AND CD = B.RANK_CD) AS CD_NM,
		        B.USR_NAM,
		        A.ROLE_DVSN_CD
		   FROM TBCSPURA009D A,
		        TBDCMACM001M B,
		        TBDCMACM002M C
		  WHERE A.CNB = B.CNB
		    AND B.DPT_CD = C.DPT_CD
			AND		A.STD_YE = #strSTD_YE#
			AND		A.STD_SLN = #strSTD_SLN#
		  ORDER BY B.USR_NAM
		]]>	
	</select>
	
	<select id="CSPURA013ESubSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT	A.STD_YE
					, A.STD_SLN
					, A.PLN_ACMP_DVSN_CD
					, A.MN_1_TXT
					, A.MN_2_TXT
					, A.MN_3_TXT
					, A.MN_4_TXT
					, A.MN_5_TXT
					, A.MN_6_TXT
					, A.MN_7_TXT
					, A.MN_8_TXT
					, A.MN_9_TXT
					, A.MN_10_TXT
					, A.MN_11_TXT
					, A.MN_12_TXT
					, A.MN_1_PT_NM
					, A.MN_2_PT_NM
					, A.MN_3_PT_NM
					, A.MN_4_PT_NM
					, A.MN_5_PT_NM
					, A.MN_6_PT_NM
					, A.MN_7_PT_NM
					, A.MN_8_PT_NM
					, A.MN_9_PT_NM
					, A.MN_10_PT_NM
					, A.MN_11_PT_NM
					, A.MN_12_PT_NM
			FROM	TBCSPURA010D A
			WHERE	A.STD_YE = #strSTD_YE#
			AND		A.STD_SLN = #strSTD_SLN#
		]]>	
	</select>
	
	<select id="CSPURA013EMaxStdSln" parameterClass="paramMap"	resultClass="String">
		<![CDATA[       
			SELECT 	NVL(MAX(TO_NUMBER(STD_SLN)), 0) +1 AS STD_SLN FROM TBCSPURA008M
			WHERE	STD_YE = #STD_YE#
		]]>	
	</select>
	
	<select id="CSPURA013EExistOrder" parameterClass="paramMap"	resultClass="String">
		<![CDATA[       
			SELECT	COUNT(*)
			FROM	TBCSPURA008M
			WHERE	STD_YE = #strSTD_YE#
			AND		RT = #strRT#
		]]>	
		<isNotEmpty property="strSTD_SLN">
		<![CDATA[       
			AND		STD_SLN <> #strSTD_SLN#
		]]>	
		</isNotEmpty>
	</select>
	
	<insert id="CSPURA013EInsertMain" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPURA008M
			(
					STD_YE
				  , STD_SLN
				  , STD_TASK_NM
				  , STD_DVSN_TXT
				  , TASK_TYP_NM
				  , STD_PRD_TXT
				  , STD_MNTH_CNT
				  , RT
				  , RMK_SBJ
				  , FRT_USR_ID
				  , FNL_USR_ID
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID
				  , FRT_REGI_DH
				  , FNL_MDF_DH
			) VALUES (
					#STD_YE#
				  , #STD_SLN#
				  , #STD_TASK_NM#
				  , #STD_DVSN_TXT#
				  , #TASK_TYP_NM#
				  , #STD_PRD_TXT#
				  , #STD_MNTH_CNT#
				  , #RT#
				  , #RMK_SBJ#
				  , #FRT_USR_ID#
				  , #FNL_USR_ID#
				  , #FNL_DEAL_DPT_CD#
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE
			)
        ]]>
	</insert>
	
	<update id="CSPURA013EUpdateMain" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPURA008M
			SET     STD_TASK_NM       = #STD_TASK_NM#      
				  , STD_DVSN_TXT      = #STD_DVSN_TXT#     
				  , TASK_TYP_NM       = #TASK_TYP_NM#      
				  , STD_PRD_TXT       = #STD_PRD_TXT#      
				  , STD_MNTH_CNT      = #STD_MNTH_CNT#     
				  , RT                = #RT#               
				  , RMK_SBJ           = #RMK_SBJ#          
				  , FNL_USR_ID        = #FNL_USR_ID#       
				  , FNL_DEAL_DPT_CD   = #FNL_DEAL_DPT_CD#    
				  , FNL_MNU_ID        = #FNL_MNU_ID#       
				  , FNL_MDF_DH       = SYSDATE            
			WHERE	STD_YE            = #STD_YE#
			  AND   STD_SLN           = #STD_SLN#          
		]]>
	</update>
	
	<delete id="CSPURA013EDeleteMain" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPURA008M A
			 WHERE A.STD_YE = #STD_YE#
			   AND A.STD_SLN = #STD_SLN#
		]]>  
	</delete>

	<insert id="CSPURA013EInsertUsr" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPURA009D
			(
					STD_YE
				  , STD_SLN
				  , CNB
				  , ROLE_DVSN_CD
				  , FRT_USR_ID
				  , FNL_USR_ID
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID
				  , FRT_REGI_DH
				  , FNL_MDF_DH
			) VALUES (
					#STD_YE#
				  , #STD_SLN#
				  , #CNB#
				  , #ROLE_DVSN_CD#
				  , #FRT_USR_ID#
				  , #FNL_USR_ID#
				  , #FNL_DEAL_DPT_CD#
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE
			)
        ]]>
	</insert>
	
	<update id="CSPURA013EUpdateUsr" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPURA009D
			SET     CNB				  = #CNB#
				  , ROLE_DVSN_CD      = #ROLE_DVSN_CD#
				  , FNL_USR_ID        = #FNL_USR_ID#       
				  , FNL_DEAL_DPT_CD   = #FNL_DEAL_DPT_CD#    
				  , FNL_MNU_ID        = #FNL_MNU_ID#       
				  , FNL_MDF_DH        = SYSDATE            
			WHERE	STD_YE            = #STD_YE#
			  AND   STD_SLN           = #STD_SLN#          
		]]>
	</update>
	
	<delete id="CSPURA013EDeleteUsrAll" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPURA009D A
			 WHERE A.STD_YE = #STD_YE#
			   AND A.STD_SLN = #STD_SLN#
		]]>  
	</delete>
	
	<delete id="CSPURA013EDeleteUsr" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPURA009D A
			 WHERE A.STD_YE = #STD_YE#
			   AND A.STD_SLN = #STD_SLN#
			   AND A.CNB = #CNB#
		]]>  
	</delete>
	
	<insert id="CSPURA013EInsertResult" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPURA010D
			(
					STD_YE
				  , STD_SLN
				  , PLN_ACMP_DVSN_CD
				  , MN_1_TXT
				  , MN_2_TXT
				  , MN_3_TXT
				  , MN_4_TXT
				  , MN_5_TXT
				  , MN_6_TXT
				  , MN_7_TXT
				  , MN_8_TXT
				  , MN_9_TXT
				  , MN_10_TXT
				  , MN_11_TXT
				  , MN_12_TXT
				  , MN_1_PT_NM
				  , MN_2_PT_NM
				  , MN_3_PT_NM
				  , MN_4_PT_NM
				  , MN_5_PT_NM
				  , MN_6_PT_NM
				  , MN_7_PT_NM
				  , MN_8_PT_NM
				  , MN_9_PT_NM
				  , MN_10_PT_NM
				  , MN_11_PT_NM
				  , MN_12_PT_NM
				  , FRT_USR_ID
				  , FNL_USR_ID
				  , FNL_DEAL_DPT_CD
				  , FNL_MNU_ID
				  , FRT_REGI_DH
				  , FNL_MDF_DH
			) VALUES (
					#STD_YE#
				  , #STD_SLN#
				  , #PLN_ACMP_DVSN_CD#
				  , #MN_1_TXT#
				  , #MN_2_TXT#
				  , #MN_3_TXT#
				  , #MN_4_TXT#
				  , #MN_5_TXT#
				  , #MN_6_TXT#
				  , #MN_7_TXT#
				  , #MN_8_TXT#
				  , #MN_9_TXT#
				  , #MN_10_TXT#
				  , #MN_11_TXT#
				  , #MN_12_TXT#
				  , #MN_1_PT_NM#
				  , #MN_2_PT_NM#
				  , #MN_3_PT_NM#
				  , #MN_4_PT_NM#
				  , #MN_5_PT_NM#
				  , #MN_6_PT_NM#
				  , #MN_7_PT_NM#
				  , #MN_8_PT_NM#
				  , #MN_9_PT_NM#
				  , #MN_10_PT_NM#
				  , #MN_11_PT_NM#
				  , #MN_12_PT_NM#
				  , #FRT_USR_ID#
				  , #FNL_USR_ID#
				  , #FNL_DEAL_DPT_CD#
				  , #FNL_MNU_ID#
				  , SYSDATE
				  , SYSDATE
			)
        ]]>
	</insert>
	
	<update id="CSPURA013EUpdateResult" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPURA010D
			SET     STD_YE             = #STD_YE#           
				  , STD_SLN            = #STD_SLN#          
				  , PLN_ACMP_DVSN_CD   = #PLN_ACMP_DVSN_CD# 
				  , MN_1_TXT           = #MN_1_TXT#         
				  , MN_2_TXT           = #MN_2_TXT#         
				  , MN_3_TXT           = #MN_3_TXT#         
				  , MN_4_TXT           = #MN_4_TXT#         
				  , MN_5_TXT           = #MN_5_TXT#         
				  , MN_6_TXT           = #MN_6_TXT#         
				  , MN_7_TXT           = #MN_7_TXT#         
				  , MN_8_TXT           = #MN_8_TXT#         
				  , MN_9_TXT           = #MN_9_TXT#         
				  , MN_10_TXT          = #MN_10_TXT#        
				  , MN_11_TXT          = #MN_11_TXT#        
				  , MN_12_TXT          = #MN_12_TXT#        
				  , MN_1_PT_NM         = #MN_1_PT_NM#       
				  , MN_2_PT_NM         = #MN_2_PT_NM#       
				  , MN_3_PT_NM         = #MN_3_PT_NM#       
				  , MN_4_PT_NM         = #MN_4_PT_NM#       
				  , MN_5_PT_NM         = #MN_5_PT_NM#       
				  , MN_6_PT_NM         = #MN_6_PT_NM#       
				  , MN_7_PT_NM         = #MN_7_PT_NM#       
				  , MN_8_PT_NM         = #MN_8_PT_NM#       
				  , MN_9_PT_NM         = #MN_9_PT_NM#       
				  , MN_10_PT_NM        = #MN_10_PT_NM#      
				  , MN_11_PT_NM        = #MN_11_PT_NM#      
				  , MN_12_PT_NM        = #MN_12_PT_NM#
				  , FNL_USR_ID        = #FNL_USR_ID#       
				  , FNL_DEAL_DPT_CD   = #FNL_DEAL_DPT_CD#    
				  , FNL_MNU_ID        = #FNL_MNU_ID#       
				  , FNL_MDF_DH        = SYSDATE            
			WHERE	STD_YE            = #STD_YE#
			  AND   STD_SLN           = #STD_SLN#
			  AND   PLN_ACMP_DVSN_CD  = #PLN_ACMP_DVSN_CD#
		]]>
	</update>
	
	<delete id="CSPURA013EDeleteResult" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPURA010D A
			 WHERE A.STD_YE = #STD_YE#
			   AND A.STD_SLN = #STD_SLN#
		]]>  
	</delete>
</sqlMap> 
