<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/ear/009">
 	<select id="CSPEAR009QMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A_CNT0,A_CNT1, A_CNT2, A_CNT3, A_CNT4, A_CNT5, A_CNT6, A_CNT7, A_CNT8, A_CNT9, A_CNT10,
					(A_CNT0+A_CNT1+A_CNT2+A_CNT3+A_CNT4+A_CNT5+A_CNT6+A_CNT7+A_CNT8+A_CNT9+A_CNT10) AS A_SUM,
					B_CNT0,B_CNT1, B_CNT2, B_CNT3, B_CNT4, B_CNT5, B_CNT6, B_CNT7, B_CNT8, B_CNT9, B_CNT10,
					(B_CNT0+B_CNT1+B_CNT2+B_CNT3+B_CNT4+B_CNT5+B_CNT6+B_CNT7+B_CNT8+B_CNT9+B_CNT10) AS B_SUM,
					(A_CNT0+B_CNT0) AS SUM0,
					(A_CNT1+B_CNT1) AS SUM1, (A_CNT2+B_CNT2) AS SUM2, (A_CNT3+B_CNT3) AS SUM3, (A_CNT4+B_CNT4) AS SUM4,
					(A_CNT5+B_CNT5) AS SUM5, (A_CNT6+B_CNT6) AS SUM6, (A_CNT7+B_CNT7) AS SUM7, (A_CNT8+B_CNT8) AS SUM8,
					(A_CNT9+B_CNT9) AS SUM9, (A_CNT10+B_CNT10) AS SUM10, 
					(A_CNT0+A_CNT1+A_CNT2+A_CNT3+A_CNT4+A_CNT5+A_CNT6+A_CNT7+A_CNT8+A_CNT9+A_CNT10+B_CNT0+B_CNT1+B_CNT2+B_CNT3+B_CNT4+B_CNT5+B_CNT6+B_CNT7+B_CNT8+B_CNT9+B_CNT10) AS TOTAL_SUM
			FROM	(
						SELECT 	SUM(CASE WHEN  B.REQ_DVSN_CD ='2' AND B.CVPT_HNDL_STA_CD = '10' THEN 1 ELSE 0 END) AS A_CNT0
								,SUM(CASE WHEN  B.REQ_DVSN_CD ='2' AND B.CVPT_HNDL_STA_CD = '20' THEN 1 ELSE 0 END) AS A_CNT1
								,SUM(CASE WHEN B.REQ_DVSN_CD ='2' AND ( B.CVPT_HNDL_STA_CD = '30' OR  B.CVPT_HNDL_STA_CD = '110' ) THEN 1 ELSE 0 END) AS A_CNT2
								,SUM(CASE WHEN B.REQ_DVSN_CD ='2' AND B.CVPT_HNDL_STA_CD = '120' THEN 1 ELSE 0 END) AS A_CNT3
								,SUM(CASE WHEN B.REQ_DVSN_CD ='2' AND B.CVPT_HNDL_STA_CD = '125' THEN 1 ELSE 0 END) AS A_CNT4
								,SUM(CASE WHEN B.REQ_DVSN_CD ='2' AND B.CVPT_HNDL_STA_CD = '130' THEN 1 ELSE 0 END) AS A_CNT5
								,SUM(CASE WHEN B.REQ_DVSN_CD ='2' AND B.CVPT_HNDL_STA_CD = '140' THEN 1 ELSE 0 END) AS A_CNT6
								,SUM(CASE WHEN B.REQ_DVSN_CD ='2' AND B.CVPT_HNDL_STA_CD IN ('150', '160') AND C.PRSS_STEP_CD NOT IN ('02','03','04','05','06','07','08','09') THEN 1 ELSE 0 END) AS A_CNT7
								,SUM(CASE WHEN B.REQ_DVSN_CD ='2' AND B.CVPT_HNDL_STA_CD IN ('150', '160') AND C.PRSS_STEP_CD ='02' THEN 1 ELSE 0 END) AS A_CNT8
								,SUM(CASE WHEN B.REQ_DVSN_CD ='2' AND B.CVPT_HNDL_STA_CD IN ('150', '160') AND C.PRSS_STEP_CD ='03' THEN 1 ELSE 0 END) AS A_CNT9
								,SUM(CASE WHEN B.REQ_DVSN_CD ='2' AND B.CVPT_HNDL_STA_CD IN ('150', '160') AND C.PRSS_STEP_CD IN ('04','05','06','07','08','09') THEN 1 ELSE 0 END) AS A_CNT10
								,SUM(CASE WHEN  B.REQ_DVSN_CD ='3' AND B.CVPT_HNDL_STA_CD = '10' THEN 1 ELSE 0 END) AS B_CNT0
								,SUM(CASE WHEN  B.REQ_DVSN_CD ='3' AND B.CVPT_HNDL_STA_CD = '20' THEN 1 ELSE 0 END) AS B_CNT1
								,SUM(CASE WHEN B.REQ_DVSN_CD ='3' AND ( B.CVPT_HNDL_STA_CD = '30' OR  B.CVPT_HNDL_STA_CD = '110' ) THEN 1 ELSE 0 END) AS B_CNT2
								,SUM(CASE WHEN B.REQ_DVSN_CD ='3' AND B.CVPT_HNDL_STA_CD = '120' THEN 1 ELSE 0 END) AS B_CNT3
								,SUM(CASE WHEN B.REQ_DVSN_CD ='3' AND B.CVPT_HNDL_STA_CD = '125' THEN 1 ELSE 0 END) AS B_CNT4
								,SUM(CASE WHEN B.REQ_DVSN_CD ='3' AND B.CVPT_HNDL_STA_CD = '130' THEN 1 ELSE 0 END) AS B_CNT5
								,SUM(CASE WHEN B.REQ_DVSN_CD ='3' AND B.CVPT_HNDL_STA_CD = '140' THEN 1 ELSE 0 END) AS B_CNT6
								,SUM(CASE WHEN B.REQ_DVSN_CD ='3' AND B.CVPT_HNDL_STA_CD IN ('150', '160') AND C.PRSS_STEP_CD NOT IN ('02','03','04','05','06','07','08','09') THEN 1 ELSE 0 END) AS B_CNT7
								,SUM(CASE WHEN B.REQ_DVSN_CD ='3' AND B.CVPT_HNDL_STA_CD IN ('150', '160') AND C.PRSS_STEP_CD ='02' THEN 1 ELSE 0 END) AS B_CNT8
								,SUM(CASE WHEN B.REQ_DVSN_CD ='3' AND B.CVPT_HNDL_STA_CD IN ('150', '160') AND C.PRSS_STEP_CD ='03' THEN 1 ELSE 0 END) AS B_CNT9
								,SUM(CASE WHEN B.REQ_DVSN_CD ='3' AND B.CVPT_HNDL_STA_CD IN ('150', '160') AND C.PRSS_STEP_CD IN ('04','05','06','07','08','09') THEN 1 ELSE 0 END) AS B_CNT10
						FROM	TBCSPEAR001M A
								,TBCSPDCP101M B
								,TBBADDED001M C
						WHERE	A.REQ_DVSN_CD(+) = B.REQ_DVSN_CD
						AND		A.ACP_YR(+) = B.ACP_YR
						AND		A.CVPT_ACP_NO(+) = B.CVPT_ACP_NO
						AND		B.REQ_DVSN_CD IN ('2','3')
						AND		A.REQ_DVSN_CD = C.REQ_DVSN_CD(+)
						AND		A.ACP_YR = C.ACP_YR(+)
						AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO(+)
		]]>
					<isNotEmpty property="strDTS">
						AND	(TO_CHAR(B.ACP_DH,'YYYYMMDD') &gt; #strDTS# OR B.ACP_DH IS NULL)
					</isNotEmpty>
					<isNotEmpty property="strDTE">
						AND	(TO_CHAR(B.ACP_DH,'YYYYMMDD') &lt; #strDTE# OR B.ACP_DH IS NULL)
					</isNotEmpty>
		<![CDATA[
					) A
		]]>
	</select>
	
	<select id="CSPEAR009QExcelExportSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT  DECODE(D1.REQ_DVSN_CD ,'2','국민','3','공익') AS REQ_DVSN_NM
					, CASE WHEN D1.CVPT_HNDL_STA_CD = '110' THEN F_CODE_NM('1000361','30')
						WHEN D1.CVPT_HNDL_STA_CD IN ('150','160') AND D3.PRSS_STEP_CD NOT IN ('02','03','04','05','06','07','08','09') THEN '감사실시에정'
						WHEN D1.CVPT_HNDL_STA_CD IN ('150','160') AND D3.PRSS_STEP_CD  ='02' THEN '감사실시중' 
						WHEN D1.CVPT_HNDL_STA_CD IN ('150','160') AND D3.PRSS_STEP_CD = '03' THEN '귀청보고'
						WHEN D1.CVPT_HNDL_STA_CD IN ('150','160') AND D3.PRSS_STEP_CD IN ('04','05','06','07','08','09') THEN '처리안작성중' ELSE F_CODE_NM('1000361', D1.CVPT_HNDL_STA_CD) END AS CVPT_HNDL_STA_NM
					, D1.ACP_DH
					, DECODE(D1.REQR_KND_CD,'1',D1.CVPTR_NM,'2',D1.RPST_PEN_NM,'3',D1.RPST_PEN_NM,'4',D1.CVPTR_NM) AS CVPTR_NM
					, D1.TIT_NM
					, D2.TRNF_DT
					, F_DPT_INFO(D2.TRNF_DPT_CD,'1') AS TRNF_DPT_NM
					, DECODE(D2.REQ_EXAM_RSLT_CD,'01',TO_CHAR(TO_DATE(D2.EXAM_RSLT_RPL_DT),'YYYY-MM-DD'), '' ) AS  EXAM_RSLT_RPL_DT
					, DECODE(D4.FLD_AUD_STR_DT,NULL,'',TO_CHAR(TO_DATE(D4.FLD_AUD_STR_DT),'YYYY-MM-DD')||'-'||TO_CHAR(TO_DATE(D4.FLD_AUD_END_DT),'YYYY-MM-DD') ||'('||D4.FLD_AUD_EXEC_DCN ||')') AS FLD_AUD_DT
					, ( SELECT  CASE WHEN COUNT(*) > 1 THEN F_ORG_INFO(MIN(ORG_CD),'1')||'외 '|| TO_CHAR(COUNT(*)-1)||'건' ELSE F_ORG_INFO(MIN(ORG_CD),'1') END 
						FROM	TBBADDED002M Z1,
								TBBADDED008L Z2
						WHERE	D3.AUD_YR = Z1.REL_AUD_YR
						AND		D3.AUD_NO = Z1.REL_AUD_NO
						AND		Z1.BZT_YR = Z2.BZT_YR
						AND		Z1.BZT_SNO = Z2.BZT_SNO) AS ORG_CNT
					, F_DPT_INFO(D2.HNDL_DPT_CD,'1') AS HNDL_DPT_NM
					, F_USR_INFO_BY_ID(D2.HNDL_CHGR_ID,'2') AS HNDL_CHGR_NM
			FROM	TBCSPDCP101M D1
					, TBCSPEAR001M D2
					, TBBADDED001M D3
					, TBBADDED003M D4
			WHERE	D1.REQ_DVSN_CD = D2.REQ_DVSN_CD(+)
			AND		D1.ACP_YR = D2.ACP_YR(+)
			AND		D1.CVPT_ACP_NO = D2.CVPT_ACP_NO(+)
			AND		D1.REQ_DVSN_CD = D3.REQ_DVSN_CD(+)
			AND		D1.ACP_YR = D3.ACP_YR(+)
			AND		D1.CVPT_ACP_NO = D3.CVPT_ACP_NO(+)
			AND		D3.AUD_YR = D4.AUD_YR(+)
			AND		D3.AUD_NO = D4.AUD_NO(+)
			AND		D1.REQ_DVSN_CD IN ('2','3')
			AND		D1.CVPT_HNDL_STA_CD NOT IN ('21','170')
		]]>
			<isNotEmpty property="strDTS">
				AND	(TO_CHAR(D1.ACP_DH,'YYYYMMDD') &gt; #strDTS# OR D1.ACP_DH IS NULL)
			</isNotEmpty>
			<isNotEmpty property="strDTE">
				AND	(TO_CHAR(D1.ACP_DH,'YYYYMMDD') &lt; #strDTE# OR D1.ACP_DH IS NULL)
			</isNotEmpty>
	</select>
	
</sqlMap> 
