<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="csp/bii/911-ndw">
	<!-- 추진실적(공문) 목록 조회-->
	<select id="CSPBII911QMainSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT A.DOCNO                             /* 문서번호 */
			     , SUBSTR(A.SENDDT, 1, 8)   AS SENDDT  /* 시행일자 */			    
			     , A.DOCTITLE                          /* 문서제목 */
			     , A.SENDRECVNAME                      /* 수발신부서명 */
			     , A.AUTHORNAME                        /* 기안자명 */
			     , A.APPROVAL_USERNAME                 /* 결재자명 */
			     , A.STATUS                 AS DOCSTATUS /* 상태 */
			     , A.PAPERFLAG                         /* 문서유형 */			     
			     , SUBSTR(A.REGDT, 1, 8)    AS REGDT   /* 등록일자 */
			     , A.AUTHORDEPTDISPNAME                /* 기안부서표시명 */	
			     , A.AUTHORDEPTNAME                    /* 기안부서명 */	
			     /*, A.AUTHORDEPTID    */                  /* 기안부서ID */	
			     , A.OPENCDNAME		                   /* 공개여부 */		     
			     , A.ENFGUBUN                          /* 시행범위 */	
			     , A.OPENLISTFLAG	                   /* 목록공개여부 */			     
			     , A.SENDNAME                          /* 발신명의 */	
			     , A.DOCTYPE                           /* 등록구분 */	
			     , A.APPRDOCNUMBER                     /* 생산문서번호 */	
			     , A.DOCRMPPERIOD                      /* 문서보존기간 */	
			    /* , A.SENDRECVID	*/	                   /* 수발신부서ID */		     
			     /* , A.PJTCARDID  */                       /* 단위과제카드코드 */
			     /*, A.BIZCARDNAME*/		     
			     , '관리 : ' || A.PJTNAME
			    || CHAR(13)
			    || '단위 : ' || A.BIZCARDNAME AS RELPJTNAME /* 단위과제카드명 */			     
			     , A.PJTNAME                           /* 과제명 */
			     , A.PJTID                             /* 과제ID */
			     , A.PJTKIND                           /* 과제종류 */
			     , A.PJTTYPE                           /* 과제형식 */
			     , A.STARTDT                           /* 시작일 */
			     , A.ENDDT                             /* 종료일 */
			     , A.PJTPATH                           /* 분류체계경로 */
			     , A.PARENTPJTID                       /* 상위과제ID */
			     , A.PJTRMPPERIOD                      /* 과제보존기간 */
			  FROM AM_ONNARA_DOC A
			 WHERE A.PJTDEPTID = #strGccOrgCd#		
			 AND A.SENDDT BETWEEN #strStrSendDt# AND #strEndSendDt#	
		]]>
		
		<!-- 제목 -->
		<isNotEmpty property="strDocTitle">
			AND A.DOCTITLE LIKE '%' || #strDocTitle# || '%'					
		</isNotEmpty>
		
		<!-- 제목 -->
		<isNotEmpty property="strDocNo">
			AND SUBSTRING(A.DOCNO, LOCATE(A.DOCNO, '-') + 1) = #strDocNo#					
		</isNotEmpty>
		
		<!-- 상태 -->
		AND CASE WHEN '' = #strStatus1# AND '' = #strStatus2# AND '' = #strStatus3# AND 
		              '' = #strStatus4# AND '' = #strStatus5# AND '' = #strStatus6# AND
		              '' = #strStatus7# AND '' = #strStatus8# AND '' = #strStatus9# THEN '1'
		         WHEN A.STATUS = #strStatus1# THEN '1'
		         WHEN A.STATUS = #strStatus2# THEN '1'
		         WHEN A.STATUS = #strStatus3# THEN '1'
		         WHEN A.STATUS = #strStatus4# THEN '1'
		         WHEN A.STATUS = #strStatus5# THEN '1'
		         WHEN A.STATUS = #strStatus6# THEN '1'
		         WHEN A.STATUS = #strStatus7# THEN '1'
		         WHEN A.STATUS = #strStatus8# THEN '1'
		         WHEN A.STATUS = #strStatus9# THEN '1'
		         ELSE '0'
		    END = '1'       			
	
		
		<!-- 수(발)신자 -->
		<isNotEmpty property="strSendRecvName">
			AND A.SENDRECVNAME LIKE '%' || #strSendRecvName# || '%'					
		</isNotEmpty>
		
		<!-- 문서구분 -->
		AND CASE WHEN '' = #strDocType1# AND '' = #strDocType2# THEN '1'
		         WHEN A.DOCTYPE = #strDocType1# THEN '1'
		         WHEN A.DOCTYPE = #strDocType2# THEN '1'
		         ELSE '0'
		    END = '1'
		    
		<!-- 문서종류 -->
		AND CASE WHEN '' = #strPaperFlag1# AND '' = #strPaperFlag2# THEN '1'
		         WHEN A.PAPERFLAG = #strPaperFlag1# THEN '1'
		         WHEN A.PAPERFLAG = #strPaperFlag2# THEN '1'
		         ELSE '0'
		    END = '1'

		<!-- 시행구분 -->
		AND CASE WHEN '' = #strEnfGubun1# AND '' = #strEnfGubun2# AND '' = #strEnfGubun3# THEN '1'
		         WHEN A.ENFGUBUN = #strEnfGubun1# THEN '1'
		         WHEN A.ENFGUBUN = #strEnfGubun2# THEN '1'
		         WHEN A.ENFGUBUN = #strEnfGubun3# THEN '1'
		         ELSE '0'
		    END = '1'		        
		
		<!-- 공개여부 -->
		<isNotEmpty property="strOpenCdName">
			AND A.OPENCDNAME = #strOpenCdName#
		</isNotEmpty>

		<!-- 생산등록번호 -->
		<isNotEmpty property="strApprDocNumber">
			AND A.APPRDOCNUMBER LIKE '%' || #strApprDocNumber# || '%'					
		</isNotEmpty>
		
		<!-- 단위과제카드명 -->
		<isNotEmpty property="strBizCardName">
			AND A.BIZCARDNAME LIKE '%' || #strBizCardName# || '%'					
		</isNotEmpty>
		ORDER BY CONVERT(NUMERIC, SUBSTRING(DOCNO, CHARINDEX('-', DOCNO)+1, 10))
	</select>
</sqlMap>