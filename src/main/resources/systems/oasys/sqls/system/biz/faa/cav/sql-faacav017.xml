<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/cav/017"> 
	 
	<!--정정분계산서목록-->
	<select id="FAACAV017EMainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  /* faa/cav/017/FAACAV017EMainselect */ ]]>
		<include refid="include.pageSelct" />		
        <![CDATA[       
            SELECT  
            	ROWNUM AS KEY, 
                 dis.COPT_CD 
                ,dis.ACNT_CD 
                ,dis.BLL_CD 
                ,dis.PROF_DRTR_SRNO 
                ,dis.DL_XPN_RCDB_PBSVT_SRNO 
                ,dis.COPT_CD||'-'||dis.ACNT_CD||'-'||dis.BLL_CD||'-'||dis.PROF_DRTR_SRNO||'-'|| dis.DL_XPN_RCDB_PBSVT_SRNO ACCMN_ID
                ,PROF_YM 
                ,DISAG_NO 
                ,dis.BR_CD 
                ,dis.DIV_CD 
                ,dis.BR_CD||'-'||dis.DIV_CD BRDIVCD
                ,DISAG_CFM_DH 
                ,CASE
                    WHEN (dis.BLL_CD='17' and dis.DL_XPN_RCDB_PBSVT_SRNO <> '000') or (dis.BLL_CD='18' and dis.DL_XPN_RCDB_PBSVT_SRNO<> '000') 
                    THEN '관서운영경비출납계산서' 
                 ELSE   
                    CASE  
                        WHEN (dis.BLL_CD='22' and dis.DL_XPN_RCDB_PBSVT_SRNO<> '000') or (dis.BLL_CD='23' and dis.DL_XPN_RCDB_PBSVT_SRNO<> '000') 
                                or (dis.BLL_CD='24' and dis.DL_XPN_RCDB_PBSVT_SRNO<> '000')  
                        THEN '기금관서운영경비출납계산서' 
                    ELSE cd.ACNT_CD_NM 
                    END  
                 END chck_nm 
                ,dis.AUD_STT_TXT 
                ,dis.WT_ATB_HNDL_DT 
                ,dis.WT_ATB_APV_DT 
                ,dis.QSTNAI_IS_DT 
                ,dis.QSTNAI_ANS_DT 
                ,dis.TRTM_APV_DT 
                ,dis.TRTM_TYP_NM 
                ,dis.CMTR_CFR_TXT 
                ,dis.ENF_DT 
                ,dis.DISAG_RMK AS RMK
                ,RSLT_RPL_DT 
                ,ACNT_YR  
                ,ACP_DH  
                ,TOMN_NAM 
                ,DTB_DT 
                ,MTRL_CLC_DT 
                ,DSP_RQ_NM 
                ,DISAG_AMT 
                ,DISAG_RSN 
                ,MDF_DH 
                ,cd1.ACNT_CD_NM fscl_nm
                ,cm.ORG_NM offc_nm
                ,mn.ORG_NM
                ,mn.MDF_PEN_NM
                ,mn.TNB 
                ,mn.ORG_CD
            FROM TWFAACAV019M dis, TWFAACAV024C cd, TWFAACAV024C cd1, TBDCMACM015M cm , TWFAACAV003M mn 
			WHERE 1 = 1
		]]>

		<isNotEmpty property="strCoptCd">	 	   
			   AND dis.COPT_CD     = #strCoptCd#
		</isNotEmpty>   	
		<isNotEmpty property="strAcntCd">	 	   
			   AND dis.ACNT_CD     = #strAcntCd#
		</isNotEmpty>  
		
		<isNotEmpty property="strBllCd">
			<isEqual property="strBllCdType" compareValue="99">
				AND  dis.BLL_CD = #strBllCd#
			</isEqual>	 	   
			<isEqual property="strBllCd" compareValue="17">	 	   
					AND  dis.BLL_CD IN('17','18')
			</isEqual>			
			<isEqual property="strBllCd" compareValue="22">	 	   
					AND  dis.BLL_CD IN('22','23','24')
			</isEqual>	
			<isEqual property="strBllCd" compareValue="42">	 	   
					AND  dis.BLL_CD IN('42','43')
			</isEqual>	
		</isNotEmpty>  

		<isEqual property="strFildSsecYn" compareValue="N">
			<isNotEmpty property="strDlXpnRcdbPbsvtSrno">	
				AND  dis.DL_XPN_RCDB_PBSVT_SRNO = #strDlXpnRcdbPbsvtSrno#
			</isNotEmpty>
			<isEmpty property="strDlXpnRcdbPbsvtSrno">	
				AND  dis.DL_XPN_RCDB_PBSVT_SRNO = '000'
			</isEmpty>	
		</isEqual>
		
		<isEqual property="strFildSsecYn" compareValue="Y">
			<isNotEmpty property="strDlXpnRcdbPbsvtSrno">	
				AND  dis.DL_XPN_RCDB_PBSVT_SRNO = #strDlXpnRcdbPbsvtSrno#
			</isNotEmpty>
			<isEmpty property="strDlXpnRcdbPbsvtSrno">	
				AND  dis.DL_XPN_RCDB_PBSVT_SRNO &lt;&gt; '000'
			</isEmpty>	
		</isEqual>	
		
		<isNotEmpty property="strProfDrtrSrno">	 	   
			   AND dis.PROF_DRTR_SRNO     = #strProfDrtrSrno#
		</isNotEmpty> 
	 	
		<isEmpty property="strMm">	/*증명월이없으면 */	
    		<isNotEmpty property="strYr">
			    AND PROF_YM    BETWEEN  #strYr#||'00' AND #strYr#||'13'
			</isNotEmpty>   
		</isEmpty>  			

		<isNotEmpty property="strMm">	/*증명월이있으면 */	
    		<isNotEmpty property="strYr">
			    AND dis.PROF_YM     = #strYm# 
			</isNotEmpty>   
    		<isEmpty property="strYr">
			    AND dis.PROF_YM like '%' || #strMm#
			</isEmpty>			
		</isNotEmpty> 	
        <!-- 처리상태 -->
		<isNotEmpty property="strProcStatus">	
			<isEqual property="strProcStatus" compareValue="Y"> 	   
			   AND MDF_DH    IS NOT NULL
			</isEqual>
			<isEqual property="strProcStatus" compareValue="N"> 	   
			    AND MDF_DH    IS NULL
			</isEqual>			
		</isNotEmpty> 

        <!-- 국 -->
		<isNotEmpty property="strBruCd">	
  			   AND dis.BR_CD = #strBrCd#
		</isNotEmpty> 
        <!-- 과 -->
		<isNotEmpty property="strDivCd">	
  			   AND dis.DIV_CD = #strDivCd#
		</isNotEmpty> 				
 		       	
               AND cd.ACNT_CD = dis.BLL_CD
               AND cd.ACNT_DVSN_CD = '03'
               AND cd1.ACNT_CD = dis.ACNT_CD
               AND cd1.ACNT_DVSN_CD = '01'
               AND dis.COPT_CD = mn.COPT_CD 
               AND dis.ACNT_CD = mn.ACNT_CD 
               AND dis.BLL_CD = mn.BLL_CD 
               AND dis.PROF_DRTR_SRNO = mn.PROF_DRTR_SRNO 
               AND dis.DL_XPN_RCDB_PBSVT_SRNO = mn.DL_XPN_RCDB_PBSVT_SRNO 
               AND cm.ORG_CD = dis.COPT_CD||'000000000'

		<include refid="include.pageOrder" />
		  ORDER BY KEY, ACCMN_ID                			 
	</select>

	<!-- 불부합상세내역 조회-->
	<select id="FAACAV017EMainDtlselect" parameterClass="paramMap" 	resultClass="resultMap">
		<![CDATA[  /* faa/cav/017/FAACAV017EMainDtlselect */ ]]>
        <![CDATA[ /*불부합종결 상세목록*/
            SELECT SUM_DVSN_ID, ERR_SUBJ_NM, DISAG_CD, BLL_AMT,
                   RE_BLL_AMT, DISAG_MGN  , cd.RMK_2
            FROM   TWFAACAV020D DTL, TWFAACAV024C CD
            WHERE 1 = 1
              AND COPT_CD = #strCoptCd#
              AND DTL.ACNT_CD = #strAcntCd#              
		]]>	   

		<isNotEmpty property="strBllCd">
			<isEqual property="strBllCd" compareValue="17">	 	   
				<isEqual property="strFildSsecYn" compareValue="N">
				   AND BLL_CD IN('17','18')
				   AND DL_XPN_RCDB_PBSVT_SRNO = '000'
				</isEqual>
			</isEqual>	
			<isEqual property="strBllCd" compareValue="17">	 	   
				<isEqual property="strFildSsecYn" compareValue="Y">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('17','18')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
					<isNotEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('17','18')
					    AND DL_XPN_RCDB_PBSVT_SRNO &lt;&gt; '000'					
					</isNotEmpty>					
				</isEqual>
			</isEqual>
			<isEqual property="strBllCd" compareValue="18">	 
				<isEqual property="strFildSsecYn" compareValue="N">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('17','18')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
				</isEqual>
			</isEqual>				
			<isEqual property="strBllCd" compareValue="18">	 
				<isEqual property="strFildSsecYn" compareValue="Y">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('17','18')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
					<isNotEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('17','18')
					    AND DL_XPN_RCDB_PBSVT_SRNO &lt;&gt; '000'					
					</isNotEmpty>					
				</isEqual>
			</isEqual>				
			<isEqual property="strBllCd" compareValue="27">	 
				<isEqual property="strFildSsecYn" compareValue="N">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('27')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
				</isEqual>
			</isEqual>			
			<isEqual property="strBllCd" compareValue="27">	 	   
				<isEqual property="strFildSsecYn" compareValue="Y">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('27')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
					<isNotEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('27')
					    AND DL_XPN_RCDB_PBSVT_SRNO &lt;&gt; '000'					
					</isNotEmpty>					
				</isEqual>
			</isEqual>		
				
			<isEqual property="strBllCd" compareValue="19">	 
				<isEqual property="strFildSsecYn" compareValue="N">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('19')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
				</isEqual>
			</isEqual>				
			<isEqual property="strBllCd" compareValue="19">	 	   
				<isEqual property="strFildSsecYn" compareValue="Y">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('19')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
					<isNotEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('19')
					    AND DL_XPN_RCDB_PBSVT_SRNO &lt;&gt; '000'					
					</isNotEmpty>					
				</isEqual>
			</isEqual>				
			
			<isEqual property="strBllCd" compareValue="22">	 
				<isEqual property="strFildSsecYn" compareValue="N">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('22','23','24')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
				</isEqual>
			</isEqual>			
			<isEqual property="strBllCd" compareValue="22">	 	   
				<isEqual property="strFildSsecYn" compareValue="Y">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('22','23','24')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
					<isNotEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('22','23','24')
					    AND DL_XPN_RCDB_PBSVT_SRNO &lt;&gt; '000'					
					</isNotEmpty>					
				</isEqual>
			</isEqual>					

			<isEqual property="strBllCd" compareValue="42">	 
				<isEqual property="strFildSsecYn" compareValue="N">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('42','43')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
				</isEqual>
			</isEqual>
			<isEqual property="strBllCd" compareValue="42">	 	   
				<isEqual property="strFildSsecYn" compareValue="Y">
					<isEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('42','43')
					    AND DL_XPN_RCDB_PBSVT_SRNO = '000'					
					</isEmpty>
					<isNotEmpty property="strDlXpnRcdbPbsvtSrno">
						AND BLL_CD IN('42','43')
					    AND DL_XPN_RCDB_PBSVT_SRNO &lt;&gt; '000'					
					</isNotEmpty>					
				</isEqual>
			</isEqual>	
		</isNotEmpty>

															
  		<![CDATA[
  			  AND DTL.PROF_DRTR_SRNO     = #strProfDrtrSrno#
  			  AND PROF_YM  = #strYm#
              AND DTL.DISAG_CD = CD.ACNT_CD
              AND CD.ACNT_DVSN_CD = '12'
        ]]>	            
	</select>
	
	<!-- 처리 전말입력 조회-->
	<select id="FAACAV017EMainDtlJunMalselect" parameterClass="paramMap" 	resultClass="resultMap">
		<![CDATA[  /* faa/cav/017/FAACAV017EMainDtlJunMalselect */ ]]>
        <![CDATA[ /*전말입력 조회*/
				SELECT COPT_CD, ACNT_CD, BLL_CD, PROF_DRTR_SRNO, DL_XPN_RCDB_PBSVT_SRNO, PROF_YM, DISAG_NO, BR_CD, DIV_CD, DISAG_CFM_DH, RSLT_RPL_DT, ACNT_YR , TOMN_NAM, DTB_DT, MTRL_CLC_DT, DSP_RQ_NM, DISAG_AMT, DISAG_RSN
				FROM TWFAACAV019M 
				WHERE  PROF_YM = #strYm#
				  AND  COPT_CD = #strCoptCd#
				  AND  ACNT_CD = #strAcntCd#
				  AND  BLL_CD = #strBllCd#
				  AND  PROF_DRTR_SRNO = #strProfDrtrSrno#
				  AND  DL_XPN_RCDB_PBSVT_SRNO = #strDlXpnRcdbPbsvtSrno#       
		]]>	   

	</select>	
	
	<!-- 기관별불부합현황 조회-->
	<select id="FAACAV017EMainDtlDisagselect" parameterClass="paramMap" 	resultClass="resultMap">
		<![CDATA[  /* faa/cav/017/FAACAV017EMainDtlDisagselect */ ]]>
        <![CDATA[ /*기관별불부합현황 조회*/
            SELECT mn.COPT_CD||'-'||mn.ACNT_CD||'-'||mn.BLL_CD||'-'||mn.PROF_DRTR_SRNO||'-'|| mn.DL_XPN_RCDB_PBSVT_SRNO 
                   PROF_DRTR_SG,mn.ORG_NM, mn.COPT_CD, mn.ACNT_CD, mn.BLL_CD,mn.PROF_DRTR_SRNO,
                   mn.DL_XPN_RCDB_PBSVT_SRNO, cd1.ACNT_CD_NM chck_nm, dtl.PROF_YM, dtl.DISAG_NO,  
                   cd.RMK_2 AS disag_cont, con.MDF_DH  
            FROM   TWFAACAV020D dtl, TWFAACAV024C cd, TWFAACAV003M mn, TWFAACAV024C cd1, TWFAACAV019M con
            WHERE  mn.COPT_CD = dtl.COPT_CD 
              AND  mn.ACNT_CD = dtl.ACNT_CD 
              AND  mn.BLL_CD = dtl.BLL_CD 
              AND  mn.PROF_DRTR_SRNO = dtl.PROF_DRTR_SRNO 
              AND  mn.DL_XPN_RCDB_PBSVT_SRNO = dtl.DL_XPN_RCDB_PBSVT_SRNO 
              AND  mn.COPT_CD = con.COPT_CD 
              AND  mn.ACNT_CD = con.ACNT_CD 
              AND  mn.BLL_CD = con.BLL_CD 
              AND  mn.PROF_DRTR_SRNO = con.PROF_DRTR_SRNO 
              AND  mn.DL_XPN_RCDB_PBSVT_SRNO = con.DL_XPN_RCDB_PBSVT_SRNO 
              AND  dtl.DISAG_CD = cd.ACNT_CD 
              AND  cd.ACNT_DVSN_CD = '12'
              AND  mn.BLL_CD = cd1.ACNT_CD 
              AND  cd1.ACNT_DVSN_CD = '03'
              AND  con.PROF_YM  = dtl.PROF_YM
              AND  con.PROF_YM < #strYm#
              AND  mn.ORG_CD = #strOrgCd#
            ORDER BY  mn.COPT_CD, mn.ACNT_CD, mn.BLL_CD, mn.PROF_DRTR_SRNO, mn.DL_XPN_RCDB_PBSVT_SRNO, dtl.PROF_YM      
		]]>	   

	</select>
		
	<!-- 처리 전말입력 조회-->
	<update id="FAACAV017EMainDtlJunMalUpdate" parameterClass="paramMap"	>
		<![CDATA[  /* faa/cav/017/FAACAV017EMainDtlJunMalUpdate */ ]]>
        <![CDATA[ /*전말입력 UPDATE */
				UPDATE TWFAACAV019M 
				   SET TOMN_NAM = #TOMN_NAM#,
				       DTB_DT = #DTB_DT#,
				       RSLT_RPL_DT = #RSLT_RPL_DT#,
				       MTRL_CLC_DT = #MTRL_CLC_DT#,
				       DSP_RQ_NM = #DSP_RQ_NM#,
				       DISAG_AMT = #DISAG_AMT#,
				       DISAG_RSN = #DISAG_RSN#
				WHERE  PROF_YM = #PROF_YM#
				  AND  COPT_CD = #COPT_CD#
				  AND  ACNT_CD = #ACNT_CD#
				  AND  BLL_CD = #BLL_CD#
				  AND  PROF_DRTR_SRNO = #PROF_DRTR_SRNO#
				  AND  DL_XPN_RCDB_PBSVT_SRNO = #DL_XPN_RCDB_PBSVT_SRNO#       
		]]>	   

	</update>
	
	<select id="FAACAV017R_02" parameterClass="paramMap" resultClass="resultMap" >
		<![CDATA[  /* faa/cav/017/FAACAV017R_02 */ ]]>
		SELECT A.COPT_CD||'-'||A.ACNT_CD||'-'||A.BLL_CD||'-'||A.PROF_DRTR_SRNO||'-'||A.DL_XPN_RCDB_PBSVT_SRNO AS 증명책임자부호
		       , A.DISAG_NO AS 불부합번호
		       , A.SUM_DVSN_ID AS 합계구분ID
		       , A.ERR_SUBJ_NM AS 오류과목명
		       , A.DISAG_CD AS 불부합코드
		       , NVL(B.RMK_2,' ') AS 비고
		       , A.BLL_AMT AS 계산서액
		       , A.RE_BLL_AMT AS 재계산서액
		       , A.DISAG_MGN AS 불부합차액
		  FROM TWFAACAV020D A, TWFAACAV024C B
		 WHERE A.PROF_YM = #strYm#
		   AND A.COPT_CD = #strCoptCd#
		   AND A.ACNT_CD = #strAcntCd#
		   AND A.BLL_CD = #strBllCd#
		   AND A.PROF_DRTR_SRNO = #strProfDrtrSrno#
		   AND A.DL_XPN_RCDB_PBSVT_SRNO = #strDlXpnRcdbPbsvtSrno#  
		   AND B.ACNT_DVSN_CD = '12'
		   AND B.ACNT_CD = A.DISAG_CD
		 ORDER BY A.SUM_DVSN_ID, A.ERR_SUBJ_NM, A.DISAG_CD
	</select>
	
	<select id="FAACAV017R_03" parameterClass="paramMap" resultClass="resultMap" >
		<![CDATA[  /* faa/cav/017/FAACAV017R_03 */ ]]>
		SELECT A.ACNT_YR 
		       , A.DISAG_NO
		       , A.COPT_CD||'-'||A.ACNT_CD||'-'||A.BLL_CD||'-'||A.PROF_DRTR_SRNO||'-'||A.DL_XPN_RCDB_PBSVT_SRNO AS CODE
		       , A.COPT_CD
		       , A.ACNT_CD
		       , A.BLL_CD 
		       , A.PROF_DRTR_SRNO
		       , A.DL_XPN_RCDB_PBSVT_SRNO
		       , A.BR_CD||'국 '||A.DIV_CD||'과' AS BRUDIV 
		       , A.PROF_YM
		       , A.TOMN_NAM
		       , A.DTB_DT
		       , A.RSLT_RPL_DT 
		       , NVL(A.MTRL_CLC_DT,' ') AS MATRL_COL_DATE
		       , A.DSP_RQ_NM 
		       , A.DISAG_RSN 
		       , A.DISAG_AMT
		       , B.ACNT_CD_NM AS BNM
		       , C.ACNT_CD_NM AS CNM
		       , D.ACNT_CD_NM AS DNM
		       , F.ORG_NM AS KIDIVN	
		FROM TWFAACAV019M A, TWFAACAV024C B, TWFAACAV024C C, TWFAACAV024C D, TWFAACAV003M E, TBDCMACM015M F	
		WHERE A.COPT_CD=#strCoptCd#
		    AND A.ACNT_CD=#strAcntCd#
		    AND A.BLL_CD=#strBllCd#
		    AND A.PROF_DRTR_SRNO=#strProfDrtrSrno#
		    AND A.DL_XPN_RCDB_PBSVT_SRNO=#strDlXpnRcdbPbsvtSrno#
		    AND A.PROF_YM=#strYm#
		    AND A.COPT_CD=B.ACNT_CD AND B.ACNT_DVSN_CD='02'	
		    AND A.ACNT_CD=C.ACNT_CD AND C.ACNT_DVSN_CD='01'	
		    AND A.BLL_CD=D.ACNT_CD AND D.ACNT_DVSN_CD='03'	
		    AND A.COPT_CD=E.COPT_CD		
		    AND A.ACNT_CD=E.ACNT_CD		
		    AND A.BLL_CD=E.BLL_CD		
		    AND A.PROF_DRTR_SRNO=E.PROF_DRTR_SRNO		
		    AND A.DL_XPN_RCDB_PBSVT_SRNO=E.DL_XPN_RCDB_PBSVT_SRNO		
		    AND E.ORG_CD=F.ORG_CD
	</select>		
</sqlMap> 
