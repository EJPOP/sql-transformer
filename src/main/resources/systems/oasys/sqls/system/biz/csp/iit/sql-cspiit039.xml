<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/iit/039">
	
	<select id="CSPIIT039QMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<include refid = "include.pageSelct"/>
        <![CDATA[
			SELECT 	DISTINCT A.ACMP_SNO,				/*입건실적순번*/
					A.ACMP_DVSN_CD,			/*입건실적구분코드*/
					A.SMT_DT,				/*제출일자*/
					A.RQS_TIT_NM,			/*요청제목*/
					B.USR_NAM AS RQR_NAM,	/*제출자명*/
					A.SMT_CNB,			/*제출자전산번호*/
					A.APV_DOC_NO,	    /*결재문서번호*/
                    F.APV_STA_CD,       /*결재상태코드*/
                    A.PRSS_STA_CD,		/*처리상태코드*/
                    A.CHF_APV_STA_CD,   /*정보2과장 승인반려 상태코드*/
                    (SELECT C.AUD_YR
                       FROM TBCSPIIT022M C
                      WHERE A.ACMP_SNO = C.ACMP_SNO) AS AUD_YR,
                    (SELECT C.AUD_NO
                       FROM TBCSPIIT022M C
                      WHERE A.ACMP_SNO = C.ACMP_SNO) AS AUD_NO,
                    (SELECT C.DSP_RQ_ENF_DT
                       FROM TBCSPIIT022M C
                      WHERE A.ACMP_SNO = C.ACMP_SNO) AS DSP_RQ_ENF_DT,
                    (SELECT C.DSP_RQ_KND_CD
                       FROM TBCSPIIT022M C
                      WHERE A.ACMP_SNO = C.ACMP_SNO) AS DSP_RQ_KND_CD,
                      (SELECT C.DSP_RQ_KND_NM
                       FROM TBCSPIIT022M C
                      WHERE A.ACMP_SNO = C.ACMP_SNO) AS DSP_RQ_KND_NM,
                    (SELECT C.AUD_SBJ_NM
                       FROM TBCSPIIT022M C
                      WHERE A.ACMP_SNO = C.ACMP_SNO) AS AUD_SBJ_NM,
                    (SELECT C.DSP_RQ_NM
                       FROM TBCSPIIT022M C
                      WHERE A.ACMP_SNO = C.ACMP_SNO) AS DSP_RQ_NM,
                    (SELECT C.DSP_RQ_SNO
                       FROM TBCSPIIT022M C
                      WHERE A.ACMP_SNO = C.ACMP_SNO) AS DSP_RQ_SNO,
                    A.RQS_DPT_CD,
                    D.DPT_NM AS RQS_DPT_NM,
                    A.ACP_DT,
                    A.DOC_ID
			FROM   	TBCSPIIT021M A,			/*입건실적등록테이블*/
					TBDCMACM001M B, 		/*사용자테이블(제출자)*/
                    TBDCMACM002M D,			/*부서코드(요청자)*/
					TBDCMACM022L F			/*결재문서내역*/
			WHERE	A.SMT_CNB = B.CNB(+)
			AND		A.COPUT_BRD_DVSN_CD = '02' /*게시판구분코드 - BARON요청*/
			AND		A.APV_DOC_NO = F.APV_DOC_NO(+)
            AND     A.RQS_DPT_CD = D.DPT_CD(+)
        ]]>
        <dynamic>
        	<isNotEmpty property="strSMT_DTS">
        		AND	A.SMT_DT &gt;= #strSMT_DTS#
        	</isNotEmpty>
        	<isNotEmpty property="strSMT_DTE">
        		AND	A.SMT_DT &lt;= #strSMT_DTE#
        	</isNotEmpty>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	(D.DPT_NM LIKE '%'||#strSEARCH_NM#||'%'
        				OR A.RQS_TIT_NM LIKE '%'||#strSEARCH_NM#||'%'
        				OR A.RQS_TXT LIKE '%'||#strSEARCH_NM#||'%')
        	</isNotEmpty>
        	<isNotEmpty property="strRQR_NAM">
        		AND B.USR_NAM LIKE '%'||#strRQR_NAM#||'%'
        	</isNotEmpty>
        	<isNotEmpty property="strPRSS_STA_CD">
        		<isEqual property="strPRSS_STA_CD" compareValue="01">
        			AND PRSS_STA_CD = #strPRSS_STA_CD#
        		</isEqual>
        		<isEqual property="strPRSS_STA_CD" compareValue="03">
        			AND PRSS_STA_CD <![CDATA[ >= ]]> #strPRSS_STA_CD#
        		</isEqual>
        	</isNotEmpty>
        	<isNotEmpty property="strSpvBrdvCd">
			     AND A.RQS_DPT_CD = #strSpvBrdvCd#
			</isNotEmpty>
			<isNotEmpty property="strACMP_DVSN_CD">	 
			     AND A.ACMP_DVSN_CD = #strACMP_DVSN_CD#
			</isNotEmpty>
        </dynamic> 
        <include refid = "include.pageOrder"/> 
	</select>     
	
	<select id="CSPIIT040EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
        	SELECT  A.ACMP_SNO,		/*자료요청순번*/ 
        			A.ACMP_DVSN_CD, 		/*자료요청구분코드*/
        			A.SMT_DT,	/*요청일*/ 
        			A.SMT_CNB,		/*요청자전산번호*/
        			(SELECT USR_NAM 
        			FROM TBDCMACM001M Z
        			WHERE A.SMT_CNB = Z.CNB
        			) AS RQR_NAM,		/*요청자명*/
        			A.RQS_TIT_NM,	/*요청제목명*/
			 		A.RQS_TXT, 		/*BARON활용내용*/
			 		A.RQS_DPT_CD,
                    A.APV_DOC_NO
                    ,B.APV_STA_CD
                    ,A.CHF_APV_STA_CD
                    ,A.MTRL_RQS_SNO
                    ,A.PRSS_STA_CD
                    ,A.ACP_DT
                    ,A.DOC_ID
        	FROM	TBCSPIIT021M A ,TBDCMACM022L B 
        	WHERE 1=1
              
        	]]>
        	<isNotEmpty property="strACMP_SNO">
        	 	AND A.ACMP_SNO = #strACMP_SNO#
        	</isNotEmpty>
        	<isNotEmpty property="strAPV_DOC_NO">
        	 	AND A.APV_DOC_NO = #strAPV_DOC_NO#
        	</isNotEmpty>
        	<![CDATA[
        	AND       A.APV_DOC_NO = B.APV_DOC_NO(+)
        	AND		A.COPUT_BRD_DVSN_CD = '02' /*게시판구분코드 - 전산개선요청*/
		]]>
	</select>
	
	<!-- 전산장애 요청 년도, 요청연번 Max값 가져오기 -->
	<select id="CSPIIT040EKeySelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(ACMP_SNO)),0)+1) AS ACMP_SNO
				 FROM TBCSPIIT021M
				 WHERE 1=1
				 AND		COPUT_BRD_DVSN_CD = '02' /*게시판구분코드 - 전산개선요청*/
		]]>
	</select>
	
	<!-- 처분요구 INSERT시 ACMP_SNO MAX값 구해서 INSERT시키기 -->
	<select id="CSPIIT040EKeySelect2" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(NVL(MAX(TO_NUMBER(ACMP_SNO)),0)) AS ACMP_SNO
  			  FROM TBCSPIIT021M
  			 WHERE 1=1
  			   AND COPUT_BRD_DVSN_CD = '02'
		]]>
	</select>
	
	<select id="CSPIIT039ERelDspSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT DISTINCT
				F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, C.AUD_KND_CD, '-') ||'-'|| A.DSP_RQ_SNO AS DSP_NO
			     , B.ENF_DT                                                                  /* 시행일 */
			     , A.DSP_RQ_KND_CD                                                           /* 처분요구종류코드 */
			     , F_CODE_NM('1000002', A.DSP_RQ_KND_CD)              AS DSP_RQ_KND_NM       /* 처분요구종류명 */
			     , A.TIT_TXT                                          AS DSP_TIT_TXT         /* 처분제목내용 */
			     , B.RLTN_ORG_CD                                                             /* 관계기관코드 */
			     , (SELECT C.ORG_NM
			          FROM TBDCMACM015M C
			         WHERE C.ORG_CD = B.RLTN_ORG_CD)                  AS RLTN_ORG_NM         /* 관계기관명 */			    
			     , A.AUD_YR                                                                  /* 감사연도 */
			     , A.AUD_NO                                                                  /* 감사번호 */
			     , A.DSP_RQ_SNO                                                              /* 처분요구순번 */
			     , C.AUD_SBJ_NM																 /* 감사사항명 */		  
			  FROM TBBADEAR001M A /* 처분요구사항기본 */
			     , TBBADEAR002D B /* 처분요구사항상세 */
			     , TBBADDED001M C
			 WHERE A.AUD_YR     = B.AUD_YR
			   AND A.AUD_NO     = B.AUD_NO
			   AND A.DSP_RQ_SNO = B.DSP_RQ_SNO
			   AND     A.AUD_YR = C.AUD_YR
			   AND     A.AUD_NO = C.AUD_NO
			   AND A.AUD_YR     = #strAudYr#
			   AND A.AUD_NO     = #strAudNo#
			   AND A.DSP_RQ_SNO = #strDspSno#
		]]>
	</select>
	
	<select id="CSPIIT040ERelDspSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT DISTINCT
				 A.ACMP_SNO
				 ,F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, C.AUD_KND_CD, '-') ||'-'|| A.DSP_RQ_SNO AS DSP_NO
			     , A.DSP_RQ_ENF_DT                                    AS ENF_DT              /* 시행일 */
			     , B.DSP_RQ_KND_CD                                                           /* 처분요구종류코드 */
			     , F_CODE_NM('1000002', B.DSP_RQ_KND_CD)              AS DSP_RQ_KND_NM       /* 처분요구종류명 */
			     , B.TIT_TXT                                          AS DSP_TIT_TXT         /* 처분제목내용 */
			     , A.AUD_YR                                                                  /* 감사연도 */
			     , A.AUD_NO                                                                  /* 감사번호 */
			     , A.AUD_SBJ_NM
			     , B.DSP_RQ_SNO                                                              /* 처분요구순번 */		
			     , A.AUD_YR                                           AS CHG_BF_AUD_YR       /* 감사연도 */
			     , A.AUD_NO                                           AS CHG_BF_AUD_NO       /* 감사번호 */
			     , B.DSP_RQ_SNO                                       AS DSP_RQ_SNO          /* 처분요구순번 */
			  FROM TBCSPIIT022M A /* BARON활용 처분요구 */
			     , TBBADEAR001M B /* 처분요구사항기본 */
			     , TBBADDED001M C
                 , TBCSPIIT021M D
			 WHERE A.AUD_YR     = B.AUD_YR  
			   AND A.AUD_NO     = B.AUD_NO
			   AND A.DSP_RQ_SNO = B.DSP_RQ_SNO
			   AND B.AUD_YR     = C.AUD_YR
			   AND B.AUD_NO     = C.AUD_NO
               AND A.ACMP_SNO   = D.ACMP_SNO
               ]]>
               <isNotEmpty property="strACMP_SNO">
        			AND A.ACMP_SNO = #strACMP_SNO#
        		</isNotEmpty>
        		<isNotEmpty property="strAPV_DOC_NO">
        			AND D.APV_DOC_NO = #strAPV_DOC_NO#
        		</isNotEmpty>
	</select>
	
	<select id="CSPIIT041PMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
        	SELECT 
			       A.MTRL_RQS_SNO ,
			       A.RQS_DT ,
			       A.RQR_CNB ,
			       A.RQS_TIT_NM ,
			       B.USR_NAM AS RQR_NAM ,
			       C.DPT_NM AS RQS_DPT_NM ,
			       B.DPT_CD AS RQS_DPT_CD
			  FROM TBCSPIIT018M A
			      ,TBDCMACM001M B
			      ,TBDCMACM002M C
			 WHERE 1=1
			   AND A.RQR_CNB = B.CNB(+)
			   AND B.DPT_CD  = C.DPT_CD(+)
			]]>
        	<isNotEmpty property="strSpvBrdvCd">	 
			     AND A.RQS_DPT_CD = #strSpvBrdvCd#
			</isNotEmpty>
        	<isNotEmpty property="strPrssStepCd">
        		<isEqual property="strPrssStepCd" compareValue="1">
        			AND A.HNDL_DT IS NULL
        		</isEqual>
        		<isEqual property="strPrssStepCd" compareValue="2">
        			AND A.HNDL_DT IS NOT NULL
        		</isEqual>
        	</isNotEmpty>
        	<![CDATA[
			 ORDER BY MTRL_RQS_SNO DESC
			]]>
	</select>
	
	<insert id="CSPIIT040EMainInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPIIT021M
        	(		COPUT_BRD_DVSN_CD,
        			ACMP_SNO,			/*자료요청순번*/
        			ACMP_DVSN_CD,		/*자료요청구분코드*/
        			SMT_DT,			/*요청일*/
        			SMT_CNB,		/*요청자전산번호*/
        			RQS_TIT_NM,		/*요청제목명*/
        			RQS_TXT,		/*요청내용*/
        			PRSS_STA_CD,
        			MTRL_RQS_SNO,
        			FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH,
					RQS_DPT_CD,
					CHF_APV_STA_CD,
					WORK_SNO,
					WORK_YE,
					ACP_DT,
					DOC_ID
        	) VALUES (
        			'02',
	        		#ACMP_SNO#,
	        		#ACMP_DVSN_CD#,
	        		#SMT_DT#,
	        		#SMT_CNB#,
	        		#RQS_TIT_NM#,
	        		#RQS_TXT#,
	        		'01',
	        		#MTRL_RQS_SNO#,
	        		#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE,
					F_USR_INFO(#SMT_CNB#,'5'),
					'01',
					#WORK_SNO#,
					#WORK_YE#,
					SYSDATE,
					#DOC_ID#
        	)
        ]]>
	</insert>
	
	<insert id="CSPIIT040ESubInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPIIT022M
        	(		
        			ACMP_SNO,
        			AUD_YR,
        			AUD_NO,
        			DSP_RQ_KND_CD,
        			DSP_RQ_ENF_DT,
        			DSP_RQ_NM,
        			DSP_RQ_SNO,
        			AUD_SBJ_NM,
        			DSP_RQ_KND_NM,
        			SMT_CNB,
        			FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
        			
        	) VALUES (
	        		#ACMP_SNO#,
					#AUD_YR#,
					#AUD_NO#,
					#DSP_RQ_KND_CD#,
					#ENF_DT#,
					#DSP_TIT_TXT#,
					#DSP_RQ_SNO#,
					#AUD_SBJ_NM#,
					#DSP_RQ_KND_NM#,
					#S_CNB#,
					#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE
        	)
        ]]>
	</insert>
	
	<update id="CSPIIT040EMainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE 	TBCSPIIT021M
			SET		ACMP_DVSN_CD = #ACMP_DVSN_CD# ,	/*자료요청구분코드*/
					SMT_DT = #SMT_DT#,			/*요청일*/
					SMT_CNB = #SMT_CNB#,		/*요청자전산번호*/
					RQS_TIT_NM = #RQS_TIT_NM#,	/*요청제목명*/
					RQS_TXT = #RQS_TXT#,		/*요청내용*/
					FNL_USR_ID = #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID = #FNL_MNU_ID#,
					FNL_MDF_DH = SYSDATE,
					RQS_DPT_CD = F_USR_INFO(#SMT_CNB#,'5'),
					PRSS_STA_CD = #PRSS_STA_CD#,
					ACP_DT      = SYSDATE,
					DOC_ID      = #DOC_ID#
			WHERE	ACMP_SNO = #ACMP_SNO#
			AND		COPUT_BRD_DVSN_CD = '02' /*게시판구분코드 - 전산개선요청*/
		]]>
	</update>
	
	<update id="CSPIIT040ESubUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE 	TBCSPIIT022M
			SET		AUD_NO        = #AUD_NO#,
					AUD_YR        = #AUD_YR#,
					DSP_RQ_KND_CD = #DSP_RQ_KND_CD#,
					DSP_RQ_ENF_DT = #ENF_DT#,
					DSP_RQ_NM     = #DSP_TIT_TXT#
			WHERE	ACMP_SNO = #ACMP_SNO#
		]]>
	</update>
	
	<delete id="CSPIIT040EMainDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE	
			FROM	TBCSPIIT021M
			WHERE	ACMP_SNO = #ACMP_SNO#
			AND		COPUT_BRD_DVSN_CD = '02' /*게시판구분코드 - 전산개선요청*/
		]]>
	</delete>

	
	<delete id="CSPIIT040ESubDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE	
			FROM	TBCSPIIT022M
			WHERE	ACMP_SNO = #ACMP_SNO#
		]]>
	</delete>
	
	<!-- 전산개선 및 자료요청 엑셀다운로드 -->
	<select id="CSPIIT039QExcelExportSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
			SELECT 	/*CSPIIT039QExcelExportSelect*/
					F_CODE_NM('1000970',A.ACMP_DVSN_CD) AS ACMP_DVSN_NM,	/*자료요청구분코드*/
					TO_CHAR(TO_DATE(A.SMT_DT),'YYYY-MM-DD') AS SMT_DT,		/*요청일*/
					C.DPT_NM AS RQS_DPT_NM,	/*요청자부서명*/
					B.USR_NAM AS RQR_NAM,	/*요청자명*/
					A.RQS_TIT_NM,			/*요청제목*/
                    F_CODE_NM('1000973',A.PRSS_STA_CD) AS PRSS_STA_CD,
                    F.AUD_SBJ_NM,
                    TO_CHAR(TO_DATE(F.DSP_RQ_ENF_DT),'YYYY-MM-DD') AS DSP_RQ_ENF_DT,
                    F_CODE_NM('1000002', F.DSP_RQ_KND_CD) AS DSP_RQ_KND_NM,
                    F.DSP_RQ_NM
			FROM   	TBCSPIIT021M A,			/*PC장비관리테이블*/
					TBDCMACM001M B, 		/*사용자테이블(요청자)*/
					TBDCMACM002M C,			/*부서코드(요청자)*/
                    TBCSPIIT022M F
			WHERE	A.SMT_CNB = B.CNB(+)
			AND		A.RQS_DPT_CD = C.DPT_CD(+)
            AND     A.ACMP_SNO = F.ACMP_SNO(+)
			AND		COPUT_BRD_DVSN_CD = '02'
        ]]>
        <dynamic>
        	<isNotEmpty property="strSMT_DTS">
        		AND	A.SMT_DT &gt;= #strSMT_DTS#
        	</isNotEmpty>
        	<isNotEmpty property="strSMT_DTE">
        		AND	A.SMT_DT &lt;= #strSMT_DTE#
        	</isNotEmpty>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	(D.DPT_NM LIKE '%'||#strSEARCH_NM#||'%'
        				OR C.DPT_NM LIKE '%'||#strSEARCH_NM#||'%'
        				OR A.RQS_TIT_NM LIKE '%'||#strSEARCH_NM#||'%'
        				OR A.RQS_TXT LIKE '%'||#strSEARCH_NM#||'%')
        	</isNotEmpty>
        	<isNotEmpty property="strRQR_NAM">
        		AND B.USR_NAM LIKE '%'||#strRQR_NAM#||'%'
        	</isNotEmpty>
        	<isEqual property="strAUTH_CD" compareValue="PERS">
        		AND	  A.SMT_CNB = #strCNB#
        	</isEqual>
        	<isEqual property="strAUTH_CD" compareValue="DEPT">
        		AND	 TO_NUMBER(A.CHF_APV_STA_CD) > CASE WHEN ((F_USR_INFO( #strCNB#,'5') = A.RQS_DPT_CD) )  THEN 0 ELSE 1 END  /*요청결재전 표시하지 않음 (요청부서  제외) */ 
        	</isEqual>
        	<isNotEmpty property="strCHF_APV_STA_CD">
        		<isEqual property="strCHF_APV_STA_CD" compareValue="01">
        			AND  A.CHF_APV_STA_CD = #strCHF_APV_STA_CD#
	        	</isEqual>
	        	<isEqual property="strCHF_APV_STA_CD" compareValue="03">
	        		AND  A.CHF_APV_STA_CD <![CDATA[ >= ]]> #strCHF_APV_STA_CD#
	        	</isEqual>
        	</isNotEmpty>
        	<isEqual property="strRESULT_CD" compareValue="01">
        		AND	A.PRSS_STA_CD IS NULL
        	</isEqual>
        	<isEqual property="strRESULT_CD" compareValue="03">
        		AND	A.PRSS_STA_CD IS NOT NULL
        	</isEqual>
        	<isNotEmpty property="strSpvBrdvCd">	 
			     AND A.RQS_DPT_CD = #strSpvBrdvCd#
			</isNotEmpty>
			<isNotEmpty property="strACMP_DVSN_CD">	 
			     AND A.ACMP_DVSN_CD = #strACMP_DVSN_CD#
			</isNotEmpty>
        </dynamic>
        <![CDATA[
        	ORDER BY TO_NUMBER(A.ACMP_SNO) DESC
        ]]>
	</select>
	
	<!-- 결재처리정보를 수정한다 -->
	<update id="CSPIIT040EApvInfoupdate" parameterClass="paramMap">
           UPDATE TBCSPIIT021M                    		/* 자료요청기본 */ 
              SET APV_DOC_NO        = #APV_DOC_NO#,		/* 결재문서번호 */
                  CHF_APV_STA_CD    = #CHF_APV_STA_CD#,
                  PRSS_STA_CD       = #PRSS_STA_CD#
           WHERE  COPUT_BRD_DVSN_CD = '02'         		/* 전산게시판구분코드 */ 
              AND ACMP_SNO      = #ACMP_SNO#	/* 자료요청순번 */
	</update>
	
	<!-- 과장승인상태코드를 업데이트한다 -->
	<update id="CSPIIT040EChfApvStaCdupdate" parameterClass="paramMap">
           UPDATE TBCSPIIT021M                    		/* 자료요청기본 */ 
              SET 	CHF_APV_STA_CD    = #CHF_APV_STA_CD#,	/* 과장승인상태코드 01 승인반려전 02 승인 03 반려*/
              		PRSS_STA_CD       = #PRSS_STA_CD#,
              		FNL_USR_ID = #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID = #FNL_MNU_ID#,
					FNL_MDF_DH = SYSDATE
           WHERE  COPUT_BRD_DVSN_CD = '02'         		/* 전산게시판구분코드 */ 
              AND ACMP_SNO          = #ACMP_SNO#		/* 자료요청순번 */
	</update>
	
	<select id="CSPIIT040EUpdateSelect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[
        	SELECT	A.ACMP_SNO,		/*자료요청순번*/ 
        			A.ACMP_DVSN_CD, /*자료요청구분코드*/ 			
        			A.SMT_DT	/*요청일*/ 
        	FROM	TBCSPIIT021M A 
        	WHERE 1=1 
        	 	AND A.APV_DOC_NO = #APV_DOC_NO#        
        		AND	A.COPUT_BRD_DVSN_CD = '02' /*게시판구분코드 - 전산개선요청*/
		]]>
	</select>
	
	<select id="CSPIIT040ERqrUsrID" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[   
			SELECT SMT_CNB, (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = SMT_CNB) AS USR_ID FROM TBCSPIIT021M    
        		WHERE  COPUT_BRD_DVSN_CD = '02'      		/* 전산게시판구분코드 */ 
              	AND ACMP_SNO      = #ACMP_SNO#
		]]>
	</select>
	<!-- BARON담당자전산번호 가져오기 -->
	<select id="CSPIIT040ECnbSelect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[     	
			SELECT TO_CHAR( EXTRACT(XMLAGG(XMLELEMENT(A, ''|| USR_DFN_TXT_1) ORDER BY USR_DFN_TXT_1), '//text()') ) AS RCNT_CNB
            FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD='1000882' AND USR_DFN_TXT_3='BARON'
		]]>
	</select>
	
	<insert id="CSPIIT040EMsgInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO
			TBDCMACM026L
			(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
	        , MSG_TP_YN
	  
	        , MSG_TXT_2
	        , RCNT_CNT
	        , RCNT_HIS
	        , MSG_REGI_DH
	
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
	
			)
			VALUES
			(
			  (SELECT NVL(MAX(MSG_SNO),0)+1 FROM TBDCMACM026L)
			, 'SP'
			, 'BO'
			, #SEND_ID#
	        , '0'
	        , #MSG_TXT#
	        , 4
	        , #RCNT_CNB#
	        , SYSDATE
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
	
			);
			
		]]>
	</insert>
</sqlMap> 
