<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/iit/001">
	
	<select id="CSPIIT001QMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<include refid = "include.pageSelct"/>
        <![CDATA[
			SELECT 	A.RQS_YE||'-'||A.RQS_SLN AS RQS_NUM,        /*요청연도, 요청연번*/
					A.RQS_DT,   	/*요청일자*/
			 		A.RQS_SER_CD, 		/*요청부문코드*/
			 		(SELECT Z.DPT_NM 
			 		FROM 	TBDCMACM002M Z 
			 		WHERE 	A.RQR_DPT_CD = Z.DPT_CD) AS RQR_DPT_CD, /*요청국과*/													
			 		A.RQR_NM, 			  /*요청자*/
			 		A.RQS_TXT,       	 /*요청내용*/
			 		A.EOR_HND_DT,		/*장애조치일*/								
			 		A.EOR_HND_TXT, /*조치내용*/
			 		A.RQS_YE,		/*요청연도*/
			 		A.RQS_SLN,		/*요청연번*/
			 		A.HND_STA_CD,	/*조치상태코드*/
			 		A.HND_PEN_NM,
			 		A.DRTR_CNB, 	/*책임자전산번호*/
			 		A.DRTR_NAM	/*책임자명*/
			FROM   	TBCSPIIT001M A	/*PC장비관리테이블*/
			WHERE	1=1
        ]]>
        <dynamic>
        	<isNotEmpty property="strRQS_DTS">
        		AND	A.RQS_DT &gt;= #strRQS_DTS#
        	</isNotEmpty>
        	<isNotEmpty property="strRQS_DTE">
        		AND	A.RQS_DT &lt;= #strRQS_DTE#
        	</isNotEmpty>
        	<isNotEmpty property="strIPTC_CD">
        		AND	A.IPTC_CD = #strIPTC_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strHND_STA_CD">
        		AND	A.HND_STA_CD = #strHND_STA_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strEOR_HND_DT">
        		AND	A.EOR_HND_DT = #strEOR_HND_DT#
        	</isNotEmpty>
        	<isNotEmpty property="strRQS_SER_CD">
        		AND	A.RQS_SER_CD = #strRQS_SER_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strHND_PEN_NM">
        		AND	A.HND_PEN_NM LIKE '%'||#strHND_PEN_NM#||'%'
        	</isNotEmpty>
        	<isNotEmpty property="strRQR_DPT_CD">
        		AND	A.RQR_DPT_CD = #strRQR_DPT_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	(A.RQS_TXT LIKE '%'||#strSEARCH_NM#||'%' OR A.EOR_HND_TXT LIKE '%'||#strSEARCH_NM#||'%'
        				OR A.RQR_NM LIKE '%'||#strSEARCH_NM#||'%')
        	</isNotEmpty>
        	<isNotEmpty property="strDRTR_NAM">
        		AND	A.DRTR_NAM LIKE '%'||#strDRTR_NAM#||'%'
        	</isNotEmpty>
        </dynamic>
         <![CDATA[
         	ORDER BY A.RQS_YE DESC, A.RQS_SLN DESC
         ]]>
         <include refid = "include.pageOrder"/> 
	</select>     
	
	<insert id="CSPIIT002EMainInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPIIT001M
        	(
        			RQS_YE,			/*요청연도*/
        			RQS_SLN,		/*요청연번*/
        			RQS_SER_CD,		/*요청부문코드*/
        			RQS_DT,			/*요청일*/
        			RQR_DPT_CD,		/*요청부서코드*/
        			RQR_NM,			/*요청자명*/
        			RQR_CNB,		/*요청자전산번호*/
        			RQR_TNB,		/*요청자전화번호*/
        			RQS_TIT_NM,		/*요청제목명*/
        			RQS_TXT,		/*요청내용*/
        			HND_STA_CD,		/*조치상태코드*/
        			DRTR_CNB,		/*책임자전산번호*/
        			DRTR_NAM,		/*책임자명*/
        			FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
        	) VALUES (
	        		#RQS_YE#,
	        		#RQS_SLN#,
	        		#RQS_SER_CD#,
	        		#RQS_DT#,
	        		#RQR_DPT_CD#,
	        		#RQR_NM#,
	        		#RQR_CNB#,
	        		#RQR_TNB#,
	        		#RQS_TIT_NM#,
	        		#RQS_TXT#,
	        		'1',
	        		#DRTR_CNB#,
	        		#DRTR_NAM#,
	        		#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE
        	)
        ]]>
	</insert>
	
	<!-- 전산장애 요청 년도, 요청연번 Max값 가져오기 -->
	<select id="CSPIIT002EKeySelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT TO_CHAR(NVL(MAX(TO_NUMBER(RQS_SLN)),0)+1) AS RQS_SLN
				  FROM TBCSPIIT001M
				 WHERE 1=1
			       AND RQS_YE			   = #strRQS_YE# 
		]]>
	</select>
	
	<select id="CSPIIT002EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
        	SELECT	A.RQS_YE,		/*요청연도*/ 
        			A.RQS_SLN, 		/*요청연번*/
        			A.RQS_SER_CD,	/*요청부문코드*/ 
        			A.IPTC_CD,		/*조회수*/
        			A.RQS_DT,		/*요청일*/ 
        			A.RQR_DPT_CD,	/*요청자부서코드*/
        			(SELECT Z.DPT_NM 
			 		FROM 	TBDCMACM002M Z 
			 		WHERE 	A.RQR_DPT_CD = Z.DPT_CD
			 		) AS RQR_DPT_NM,	/*부서명*/
			 		A.RQR_CNB, 		/*요청자전산번호*/
			 		A.RQR_NM, 		/*요청자명*/
			 		A.RQS_TIT_NM, 	/*요청제목명*/
			 		A.RQS_TXT, 		/*요청내용*/
			 		A.EOR_HND_DT, 	/*장애조치일*/
			 		A.HND_PEN_CNB,	/*조치자전산번호*/
			 		A.HND_PEN_NM, 	/*조치자명*/
			 		A.HND_STA_CD, 	/*조치상태코드*/
			 		A.EOR_HND_TXT, 	/*장애조치내용*/
			 		A.RQR_TNB, 		/*요청자전화번호*/
			 		A.HND_PEN_TNB,		/*조치자전화번호*/
			 		A.HND_PEN_CNB AS OLD_HNDL_PEN_CNB,	/*조치자전산번호*/
			 		NVL(A.SEN_YN,'N') AS SEN_YN,
			 		(SELECT DOC_ID FROM TBCSPIIT008M Z 
			 		WHERE Z.RQS_YE = A.RQS_YE 
			 		AND Z.RQS_SLN = A.RQS_SLN 
			 		AND Z.EOR_ATT_FL_DVSN_CD = '1') AS RQS_DOC_ID,
			 		(SELECT DOC_ID FROM TBCSPIIT008M Z 
			 		WHERE Z.RQS_YE = A.RQS_YE 
			 		AND Z.RQS_SLN = A.RQS_SLN 
			 		AND Z.EOR_ATT_FL_DVSN_CD = '2') AS HND_DOC_ID,
			 		A.DRTR_CNB, 	/*책임자전산번호*/
			 		A.DRTR_NAM,		/*책임자명*/
                    (SELECT USR_DFN_TXT_1 FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD='1000882' AND CD='4') AS CHAR_CNB, /*기본책임자전산번호*/
                    (SELECT USR_DFN_TXT_2 FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD='1000882' AND CD='4') AS CHAR_NAM  /*기본책임자명*/
        	FROM	TBCSPIIT001M A
        	WHERE 	A.RQS_YE = #strRQS_YE#
	        AND		A.RQS_SLN = #strRQS_SLN#
		]]>
	</select>
	
	<update id="CSPIIT002EMainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE 	TBCSPIIT001M
			SET		RQS_SER_CD = #RQS_SER_CD# ,	/*요청부문코드*/
					RQS_DT = #RQS_DT#,			/*요청일*/
					RQR_DPT_CD = #RQR_DPT_CD#,	/*요청자부서코드*/
					RQR_NM = #RQR_NM#,			/*요청자명*/
					RQR_CNB = #RQR_CNB#,		/*요청자전산번호*/
					RQR_TNB = #RQR_TNB#,		/*요청자전화번호*/
					RQS_TIT_NM = #RQS_TIT_NM#,	/*요청제목명*/
					RQS_TXT = #RQS_TXT#,		/*요청내용*/
					EOR_HND_DT = #EOR_HND_DT#,	/*장애조치일*/
					HND_PEN_CNB = #HND_PEN_CNB#, /*조치자전산번호*/
					HND_PEN_NM = #HND_PEN_NM#,	/*조치자명*/
					HND_STA_CD = #HND_STA_CD#, 	/*조치상태코드*/
					EOR_HND_TXT = #EOR_HND_TXT#, /*장애조치내용*/
					HND_PEN_TNB = #HND_PEN_TNB#, /*조치자전화번호*/
					IPTC_CD = #IPTC_CD#,		/*중요도코드*/
					FNL_USR_ID = #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID = #FNL_MNU_ID#,
					FNL_MDF_DH = SYSDATE,
					DRTR_CNB = #DRTR_CNB#,
					DRTR_NAM = #DRTR_NAM#
			WHERE	RQS_YE = #RQS_YE#
			AND		RQS_SLN = #RQS_SLN#
		]]>
	</update>
	
	<delete id="CSPIIT002EMainDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE	
			FROM	TBCSPIIT001M
			WHERE	RQS_YE = #RQS_YE#
			AND		RQS_SLN = #RQS_SLN#
		]]>
	</delete>
	
	<insert id="CSPIIT002ERqsFileInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPIIT008M
        	(
        			RQS_YE,			/*요청연도*/
        			RQS_SLN,		/*요청연번*/
        			EOR_ATT_FL_DVSN_CD,		/*요청부문코드*/
        			DOC_ID,			/*요청일*/
        			FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
        	) VALUES (
	        		#RQS_YE#,
	        		#RQS_SLN#,
	        		'1',
	        		#RQS_DOC_ID#,
	        		#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE
        	)
        ]]>
	</insert>
	
	<insert id="CSPIIT002EHndFileInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPIIT008M
        	(
        			RQS_YE,			/*요청연도*/
        			RQS_SLN,		/*요청연번*/
        			EOR_ATT_FL_DVSN_CD,		/*요청부문코드*/
        			DOC_ID,			/*요청일*/
        			FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
        	) VALUES (
	        		#RQS_YE#,
	        		#RQS_SLN#,
	        		'2',
	        		#HND_DOC_ID#,
	        		#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE
        	)
        ]]>
	</insert>
	
	<delete id="CSPIIT002EFileDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE	
			FROM	TBCSPIIT008M
			WHERE	RQS_YE = #RQS_YE#
			AND		RQS_SLN = #RQS_SLN#
		]]>
	</delete>
	
	
	<select id="CSPIIT001QReportSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
			SELECT 	TO_CHAR(TO_DATE(A.RQS_DT),'YYYY-MM-DD') AS RQS_DT,   	/*요청일자*/
			 		F_CODE_NM('1000327',A.RQS_SER_CD) AS RQS_SER_NM, 		/*요청부문코드*/
			 		(SELECT Z.DPT_NM 
			 		FROM 	TBDCMACM002M Z 
			 		WHERE 	A.RQR_DPT_CD = Z.DPT_CD) AS RQR_DPT_NM, /*요청국과*/													
			 		A.RQR_NM, 			  /*요청자*/
			 		A.RQS_TXT,       	 /*요청내용*/
			 		A.EOR_HND_TXT /*조치내용*/
			FROM   	TBCSPIIT001M A	/*PC장비관리테이블*/
			WHERE	1=1
        ]]>
        <dynamic>
        	<isNotEmpty property="strRQS_DTS">
        		AND	A.RQS_DT &gt;= #strRQS_DTS#
        	</isNotEmpty>
        	<isNotEmpty property="strRQS_DTE">
        		AND	A.RQS_DT &lt;= #strRQS_DTE#
        	</isNotEmpty>
        	<isNotEmpty property="strIPTC_CD">
        		AND	A.IPTC_CD = #strIPTC_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strHND_STA_CD">
        		AND	A.HND_STA_CD = #strHND_STA_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strEOR_HND_DT">
        		AND	A.EOR_HND_DT = #strEOR_HND_DT#
        	</isNotEmpty>
        	<isNotEmpty property="strRQS_SER_CD">
        		AND	A.RQS_SER_CD = #strRQS_SER_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strHND_PEN_NM">
        		AND	A.HND_PEN_NM LIKE '%'||#strHND_PEN_NM#||'%'
        	</isNotEmpty>
        	<isNotEmpty property="strRQR_DPT_CD">
        		AND	A.RQR_DPT_CD = #strRQR_DPT_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	(A.RQS_TXT LIKE '%'||#strSEARCH_NM#||'%' OR A.EOR_HND_TXT LIKE '%'||#strSEARCH_NM#||'%'
        				OR A.RQR_NM LIKE '%'||#strSEARCH_NM#||'%')
        	</isNotEmpty>
        </dynamic>
         <![CDATA[
         	ORDER BY A.RQS_YE DESC, A.RQS_SLN DESC
         ]]>
	</select> 
	
	<select id="CSPIIT001QExcelExportSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
			SELECT 	A.RQS_YE||'-'||A.RQS_SLN AS RQS_NUM        		/*요청연도, 요청연번*/
					,F_CODE_NM('1000295',A.HND_STA_CD) AS HND_STA_NM	/*조치상태코드*/
					,F_CODE_NM('1000327',A.RQS_SER_CD) AS RQS_SER_NM 		/*요청부문코드*/
					,TO_CHAR(TO_DATE(A.RQS_DT),'YYYY-MM-DD') AS RQS_DT   	/*요청일자*/
			 		,(	SELECT Z.DPT_NM 
			 			FROM 	TBDCMACM002M Z 
			 			WHERE 	A.RQR_DPT_CD = Z.DPT_CD
			 		) AS RQR_DPT_NM 					/*요청국과*/													
			 		,A.RQR_NM 			  				/*요청자*/
			 		,A.HND_PEN_NM		  				/*조치자*/
			 		,A.RQS_TXT       	 				/*요청내용*/
			 		,TO_CHAR(TO_DATE(A.EOR_HND_DT),'YYYY-MM-DD') AS	EOR_HND_DT	/*장애조치일*/								
			 		,A.EOR_HND_TXT 						/*조치내용*/
			FROM   	TBCSPIIT001M A	/*PC장비관리테이블*/
			WHERE	1=1
        ]]>
        <dynamic>
        	<isNotEmpty property="strRQS_DTS">
        		AND	A.RQS_DT &gt;= #strRQS_DTS#
        	</isNotEmpty>
        	<isNotEmpty property="strRQS_DTE">
        		AND	A.RQS_DT &lt;= #strRQS_DTE#
        	</isNotEmpty>
        	<isNotEmpty property="strIPTC_CD">
        		AND	A.IPTC_CD = #strIPTC_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strHND_STA_CD">
        		AND	A.HND_STA_CD = #strHND_STA_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strEOR_HND_DT">
        		AND	A.EOR_HND_DT = #strEOR_HND_DT#
        	</isNotEmpty>
        	<isNotEmpty property="strRQS_SER_CD">
        		AND	A.RQS_SER_CD = #strRQS_SER_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strHND_PEN_NM">
        		AND	A.HND_PEN_NM LIKE '%'||#strHND_PEN_NM#||'%'
        	</isNotEmpty>
        	<isNotEmpty property="strRQR_DPT_CD">
        		AND	A.RQR_DPT_CD = #strRQR_DPT_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strSEARCH_NM">
        		AND	(A.RQS_TXT LIKE '%'||#strSEARCH_NM#||'%' OR A.EOR_HND_TXT LIKE '%'||#strSEARCH_NM#||'%'
        				OR A.RQR_NM LIKE '%'||#strSEARCH_NM#||'%')
        	</isNotEmpty>
        </dynamic>
         <![CDATA[
         	ORDER BY A.RQS_YE DESC, A.RQS_SLN DESC
         ]]>
	</select>  

	<select id="CSPIIT002EPrintSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	A.RQS_YE,		/*요청연도*/ 
        			A.RQS_SLN, 		/*요청연번*/
        			F_CODE_NM('1000327',A.RQS_SER_CD) AS RQS_SER_NM,	/*요청부문코드*/ 
        			F_CODE_NM('1000063',A.IPTC_CD) AS IPTC_NM,		/*조회수*/
        			TO_CHAR(TO_DATE(A.RQS_DT),'YYYY-MM-DD') AS RQS_DT,		/*요청일*/ 
        			(SELECT Z.DPT_NM 
			 		FROM 	TBDCMACM002M Z 
			 		WHERE 	A.RQR_DPT_CD = Z.DPT_CD
			 		) AS RQR_DPT_NM,	/*부서명*/
			 		A.RQR_NM, 		/*요청자명*/
			 		A.RQS_TIT_NM, 	/*요청제목명*/
			 		A.RQS_TXT, 		/*요청내용*/
			 		TO_CHAR(TO_DATE(A.EOR_HND_DT),'YYYY-MM-DD') AS EOR_HND_DT, 	/*장애조치일*/
			 		A.HND_PEN_NM, 	/*조치자명*/
			 		F_CODE_NM('1000295',A.HND_STA_CD) AS HND_STA_NM, 	/*조치상태코드*/
			 		A.EOR_HND_TXT, 	/*장애조치내용*/
			 		A.RQR_TNB, 		/*요청자전화번호*/
			 		A.HND_PEN_TNB		/*조치자전화번호*/
        	FROM	TBCSPIIT001M A
        	WHERE 	A.RQS_YE = #strRQS_YE#
	        AND		A.RQS_SLN = #strRQS_SLN#
		]]>
	</select>
	
	<update id="CSPIIT002EMsgUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE 	TBCSPIIT001M
			SET		SEN_YN = 'Y'
			WHERE	RQS_YE = #RQS_YE#
			AND		RQS_SLN = #RQS_SLN#
		]]>
	</update>
	
</sqlMap> 
