<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ded/029">

	<!-- 조회조건 데이터 조회  -->
	<select id="BADDED029QSearchBoxselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       		         
	    SELECT BZT_YR || ' - ' || SPRT_NO   AS SPRT_YR_NO_SNO /*감사연번호*/
		            , CASE WHEN AUD_STR_DT IS NOT NULL THEN SUBSTR(AUD_STR_DT, 0, 4) || '.' || SUBSTR(AUD_STR_DT, 5, 2) || '.' || SUBSTR(AUD_STR_DT, 7, 2) ELSE '' END
		              || ' ~ ' ||
		              CASE WHEN AUD_END_DT IS NOT NULL THEN SUBSTR(AUD_END_DT, 0, 4) || '.' || SUBSTR(AUD_END_DT, 5, 2) || '.' || SUBSTR(AUD_END_DT, 7, 2) ELSE '' END
		              || CASE WHEN AUD_DCN IS NOT NULL THEN '(' || AUD_DCN || '일)' ELSE '' END AS SITU_AUD_DT /*출장기간*/
		            , TIT_TXT || ' (' ||  F_CODE_NM('1000030', AUD_BZT_KND_CD) ||')' AS TIT_TXT /*출장상황명*/
		            , F_DPT_INFO(BZT_BRDV_CD, '1') || ' (' || BZT_BRDV_CD || ')' AS BZT_BRDV_NM /*출장부서*/
		            , F_DPT_INFO(BZT_TL_BRDV_CD, '1') || ' ' || F_CODE_NM('1000173', BZT_TL_RANK_CD) || ' ' || F_USR_INFO(BZT_TL_CNB, '2') || '( ' || BZT_TL_CNB || ' )' AS BZT_TL_BRDV_INFO 

		            , BZT_YR /*출장년도*/
		            , BZT_SNO /*출장순번*/
		        FROM TBBADDED002M
		       WHERE BZT_YR   = #strBztYr#
		         AND SPRT_NO   = #strSprtNo#
        ]]>
	</select>
	
	<!-- #################################### 6-1 조회 시작 ################################# -->
	
	<select id="BADDED029Qselect6_1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
		SELECT BZT_YR,
               BZT_SNO,
               REL_AUD_YR,
               REL_AUD_NO,
               AUD_STEP_SNO,
               SPRT_NO
          FROM TBBADDED002M
         WHERE BZT_YR = #strBztYr#
           AND BZT_SNO = #strBztSno#
        ]]>
	</select>	
	
	<select id="BADDED029Qselect6_2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
               SELECT DISTINCT TEAM_SNO
                 FROM TBBADDED009L tl
                WHERE tl.BZT_YR =#strBztYr#
                 AND tl.BZT_SNO = #strBztSno#
        ]]>
	</select>
	
	<!-- #################################### 6-1 조회 끝 ################################# -->
	
	<!-- ####################################  6-2조회 시작 ################################# -->
	<!--  감사출장여비 계산 목록 조회 - master  -->
	<select id="BADDED029Qselect6_3" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT tl.BZT_YR ,  /* 출장년도*/
                   tl.BZT_SNO ,  /* 출장순번*/
                   tl.TEAM_SNO ,  /* 팀번호*/
                   tl.RID_DT ,      /* 승차일*/
                   F_CODE_NM('1000025',tl.TRIN_KND_CD) TRAIN_TYPE_NM,  /* 열차종류종류명 */
                   F_CODE_NM('1000026',tl.CHRG_DVSN_CD) CHRG_TYPE_NM,  /* 요금종류종류명 */
                   tl.DEP_STN_NM ,  /* 출발명*/
                   tl.ARV_STN_NM ,  /* 도착명*/
                   tl.RL_FR_EXS ,  /* 철도임*/
                  (
                    CASE
                       WHEN tl.STND_CHRG_YN = 'N' THEN '미승인'
                       ELSE ''
                   END) AS STD_YN  /*승인여부*/
             FROM TBBADDED009L tl
             WHERE 1 = 1
               AND tl.BZT_YR = #strBztYr#
               AND tl.BZT_SNO = #strBztSno#
               AND TO_CHAR(tl.TEAM_SNO) = #TEAM_SNO#
        ]]>
	</select>
	
	<!--  감사출장여비 계산 목록 조회 - sub  -->
	<select id="BADDED029Qselect6_4" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
            SELECT tma.BZT_YR ,
			       tma.BZT_SNO ,
			       tma.TEAM_SNO ,
			       tma.PCT_CNB ,
			       F_DPT_INFO(tma.BLT_BRDV_CD,'4') DPT_NM, /* 부서명*/
			       tma.PCT_RANK_CD ,
			       F_CODE_NM('1000173',tma.PCT_RANK_CD) POS_CLASS_NM , /* 직급명*/
			       tma.PCT_NM
			  FROM TBBADDED005L tma
			 WHERE 1 = 1
			   AND tma.BZT_YR = #strBztYr#
			   AND tma.BZT_SNO = #strBztSno#
			   AND TO_CHAR(tma.TEAM_SNO) = #TEAM_SNO#
			  
        ]]>
	</select>
	<!-- #################################### 6-2 조회 끝 ################################# -->
	
	
	
	<!-- #################################### 5-1 조회 시작 ################################# -->
	<select id="BADDED029Qselect5_1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT SITU.BZT_YR,   /*출장년도*/
			       SITU.BZT_SNO,  /*출장순번*/
			       SITU.BZT_YR ||'-'||SITU.SPRT_NO AS SPRT_NO, /*지원번호 */
			       
			       F_CODE_NM('1000173',SITU.BZT_TL_RANK_CD) TRIP_LEADER_POS_CLASS_NM ,  /*선임자 직급명*/
			       F_USR_INFO(SITU.BZT_TL_CNB,'2') AS TRIP_LEADER_NM ,  /*선임자명*/
			       F_CODE_NM('1000021',SITU.GEN_BZT_KND_CD) GEN_TRIP_CATE_NM, /*일반출장종류명 */
			       
			       SITU.TIT_TXT,  /*출장제목*/
			       PSON.BZT_STR_DT,  /*출장기간 시작일*/
			       PSON.BZT_END_DT,  /*출장기간 종료일*/
			       PSON.BZT_DCN,     /*출장일수*/
			       PSON.PSON_CNT,    /*출장인원*/
			       F_DPT_INFO(SITU.BZT_TL_BRDV_CD,'1') DPT_NM /*선임자 부서명*/
			  FROM TBBADDED002M SITU,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               MIN(BZT_STR_DT) AS BZT_STR_DT,
			               MAX(BZT_END_DT) AS BZT_END_DT,
			               MAX(BZT_DCN) AS BZT_DCN,
			               COUNT(*) AS PSON_CNT
			          FROM (SELECT TMA.BZT_YR,
			                       TMA.BZT_SNO,
			                       TMA.PCT_CNB,
			                       MIN(PTD.BZT_STR_DT) AS BZT_STR_DT,
			                       MAX(PTD.BZT_END_DT) AS BZT_END_DT,
			                       SUM(PTD.BZT_DCN) AS BZT_DCN
			                  FROM TBBADDED005L TMA,
			                       TBBADDED006L PTD
			                 WHERE PTD.BZT_YR = TMA.BZT_YR
			                   AND PTD.BZT_SNO = TMA.BZT_SNO
			                   AND PTD.TEAM_SNO = TMA.TEAM_SNO
			                   AND PTD.PCT_ALC_SNO = TMA.PCT_ALC_SNO
			                   AND PTD.BZT_YR =#strBztYr#
			                   AND PTD.BZT_SNO = #strBztSno#
			                 GROUP BY TMA.BZT_YR,
			                       TMA.BZT_SNO,
			                       TMA.PCT_CNB) PTD1
			         GROUP BY BZT_YR,
			               BZT_SNO ) PSON
			 WHERE SITU.BZT_YR = #strBztYr#
			   AND SITU.BZT_SNO = #strBztSno#
			   AND PSON.BZT_YR = SITU.BZT_YR
			   AND PSON.BZT_SNO = SITU.BZT_SNO 
        ]]>
	</select>	
	
	<select id="BADDED029Qselect5_2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT TER.BZT_YR,  /*출장년도*/
			       TER.BZT_SNO,  /*출장순번*/
			       TER.PCT_CNB,  /*전산번호*/
			       TER.PCT_NM,    /*출장자명*/
			       F_CODE_NM('1000173',TER.PCT_RANK_CD) POS_CLASS_NM ,  /*출장자 직급명*/
			       TER.STF_DVSN_CD,  /*출장구분*/
			       
			       F_DPT_INFO(BL.BLT_BRDV_CD ,'4') DPT_NM, /*출장자  부서약칭명*/
			
			       TE.SPM_XPN,  /*보충경비
			       (CASE
			          WHEN SITU.BZT_TL_CNB = TER.PCT_CNB THEN TER2.LEAD_EXS
			          ELSE 0
			        END) AS LEAD_EXS,  /*지휘비*/
			       TE.SPM_XPN + (CASE
			                       WHEN SITU.BZT_TL_CNB = TER.PCT_CNB THEN TER2.LEAD_EXS
			                       ELSE 0
			                     END) AS SUM_ALL,  /*지급액*/
			       TE.BZT_DCN,  /*출장일수*/
			       TE.BZT_STR_DT,  /*출장시작일*/
			       TE.BZT_END_DT,  /*출장종료일*/
			       '' RECIPIENT  /*영수인*/
			  FROM TBBADDED010L TER,
			       TBBADDED002M SITU,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               SUM(TE0.SPM_XPN) AS SPM_XPN,
			               SUM(TE0.BZT_DCN) AS BZT_DCN,
			               MIN(TE0.BZT_STR_DT) AS BZT_STR_DT,
			               MAX(TE0.BZT_END_DT) AS BZT_END_DT
			          FROM TBBADDED011L TE0
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			           AND CALC_YN= 'N'
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB) TE,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               SUM(LEAD_EXS) AS LEAD_EXS
			          FROM TBBADDED011L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			           AND CALC_YN= 'N'
			         GROUP BY BZT_YR,
			               BZT_SNO) TER2,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               SUM(RL_FR_EXS) AS RL_FR_EXS
			          FROM TBBADDED017L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			           AND CALC_YN= 'N'
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB ) TFD,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               MAX(BLT_BRDV_CD) AS BLT_BRDV_CD
			          FROM TBBADDED005L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB) BL
			     
			 WHERE TER.BZT_YR = #strBztYr#
			   AND TER.BZT_SNO = #strBztSno#
			   AND TE.BZT_YR(+) = TER.BZT_YR
			   AND TE.BZT_SNO(+) = TER.BZT_SNO
			   AND TE.PCT_CNB(+) = TER.PCT_CNB
			   AND TFD.BZT_YR(+) = TER.BZT_YR
			   AND TFD.BZT_SNO(+) = TER.BZT_SNO
			   AND TFD.PCT_CNB(+) = TER.PCT_CNB
			   AND TER2.BZT_YR = TER.BZT_YR
			   AND TER2.BZT_SNO = TER.BZT_SNO
			   AND SITU.BZT_YR = TER.BZT_YR
			   AND SITU.BZT_SNO = TER.BZT_SNO
			   AND BL.BZT_YR(+) = TER.BZT_YR
			   AND BL.BZT_SNO(+) = TER.BZT_SNO
			   AND BL.PCT_CNB(+) = TER.PCT_CNB
        ]]>
	</select>
	
	<!-- ####################################  청구 내역표 조회 끝 ################################# -->
	
	<!-- #################################### 여비 명세서1(국내여비 등) 조회 시작 ################################# -->
	<select id="BADDED029Qselect4_1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
		SELECT SITU.BZT_YR,  /*출장년도*/
		       SITU.BZT_SNO,  /*출장순번*/
		       SITU.BZT_YR ||'-'||SITU.SPRT_NO AS SPRT_NO, /*지원번호 */
		       
		       F_CODE_NM('1000173',SITU.BZT_TL_RANK_CD) TRIP_LEADER_POS_CLASS_NM ,  /*선임자 직급명*/
		       F_USR_INFO(SITU.BZT_TL_CNB,'2') AS TRIP_LEADER_NM ,  /*선임자명*/
		       F_CODE_NM('1000021',SITU.GEN_BZT_KND_CD) GEN_TRIP_CATE_NM,  /*일반출장종류명*/
		       SITU.TIT_TXT,  /*출장제목*/
		       PSON.BZT_STR_DT,  /*출장기간 시작일*/
		       PSON.BZT_END_DT,  /*출장기간 종료일*/
		       PSON.BZT_DCN,  /*출장일수*/
		       PSON.PSON_CNT,  /* 출장인원*/
		       F_DPT_INFO(SITU.BZT_TL_BRDV_CD,'1') DPT_NM /*선임자 부서명*/
		  FROM TBBADDED002M SITU,
		       (SELECT BZT_YR,
		               BZT_SNO,
		               MIN(BZT_STR_DT) AS BZT_STR_DT,
		               MAX(BZT_END_DT) AS BZT_END_DT,
		               MAX(BZT_DCN) AS BZT_DCN,
		               COUNT(*) AS PSON_CNT
		          FROM (SELECT TMA.BZT_YR,
		                       TMA.BZT_SNO,
		                       TMA.PCT_CNB,
		                       MIN(PTD.BZT_STR_DT) AS BZT_STR_DT,
		                       MAX(PTD.BZT_END_DT) AS BZT_END_DT,
		                       SUM(PTD.BZT_DCN) AS BZT_DCN
		                  FROM TBBADDED005L TMA,
		                       TBBADDED006L PTD
		                 WHERE PTD.BZT_YR = TMA.BZT_YR
		                   AND PTD.BZT_SNO = TMA.BZT_SNO
		                   AND PTD.TEAM_SNO = TMA.TEAM_SNO
		                   AND PTD.PCT_ALC_SNO = TMA.PCT_ALC_SNO
		                   AND PTD.BZT_YR =#strBztYr#
		                   AND PTD.BZT_SNO = #strBztSno#
		                 GROUP BY TMA.BZT_YR,
		                       TMA.BZT_SNO,
		                       TMA.PCT_CNB) PTD1
		         GROUP BY BZT_YR,
		               BZT_SNO ) PSON
		 WHERE SITU.BZT_YR = #strBztYr#
		   AND SITU.BZT_SNO = #strBztSno#
		   AND PSON.BZT_YR = SITU.BZT_YR
		   AND PSON.BZT_SNO = SITU.BZT_SNO
		   
        ]]>
	</select>	
	
	<!-- 전산번호 가져오기 -->
	<select id="BADDED029Qselect4_2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
		   SELECT TER.PCT_CNB  /*출장자 전산번호*/
			  FROM TBBADDED010L TER,
			       TBBADDED011L TE,
			       (SELECT BZT_YR,
			               BZT_SNO,
			               PCT_CNB,
			               MAX(BLT_BRDV_CD) AS BLT_BRDV_CD
			          FROM TBBADDED005L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO =#strBztSno#
			         GROUP BY BZT_YR,
			               BZT_SNO,
			               PCT_CNB) BL
			 WHERE TER.BZT_YR = #strBztYr#
			   AND TER.BZT_SNO = #strBztSno#
			   AND BL.BZT_YR(+) = TER.BZT_YR
			   AND BL.BZT_SNO(+) = TER.BZT_SNO
			   AND BL.PCT_CNB(+) = TER.PCT_CNB
			   AND TE.BZT_YR = TER.BZT_YR
			   AND TE.BZT_SNO = TER.BZT_SNO
			   AND TE.PCT_CNB = TER.PCT_CNB
			 GROUP BY TER.PCT_CNB
        ]]>
	</select>	
	
	<select id="BADDED029Qselect4_3" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
		SELECT TER.BZT_YR,  /*출장년도*/
		       TER.BZT_SNO,  /*출장순번*/
		       TER.PCT_CNB,  /*전산번호*/
		       TER.PCT_NM,   /*출장자명*/
		       F_CODE_NM('1000173',TER.PCT_RANK_CD) POS_CLASS_NM ,  /*출장자 직급명*/
		       TE.FDEX, /*식비*/
		       TE.LDC, /*숙박비*/
		       TE.DT_EXS,  /*일비*/
			   NVL(TE.CPRG_FR_EXS,0) AS CPRG_FR_EXS, /*수도권운임비추가 - 2015.05.06 yyh*/		       
		       NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS,0) AS RL_FR_EXS,
		       TE.FDEX + TE.LDC + TE.DT_EXS + NVL(TE.CPRG_FR_EXS,0) + NVL(TFD.RL_FR_EXS, 0) AS SUM_ALL,  /*지급액 - 수도권운임비추가 - 2015.05.06 yyh*/
		       TE.LODG_DCN,  /*숙박일수*/
		       F_CODE_NM('1000001',TE.RGN_CD) 
			   || (SELECT '(' || SUBSTR(F_CODE_NM('1000727',CPRG_LN_DVSN_CD),4)  || ')'
			         FROM TBBADDED014B
			        WHERE DEP_RGN_CD = TER.DEP_RGN_CD
			          AND ARV_RGN_CD = TE.RGN_CD
			          AND CPRG_LN_DVSN_CD != '90'
			          AND ROWNUM = 1)    AS LCL_NM,   /*지역명*/
		       TE.BZT_DCN,  /*출장일수*/
		       TE.BZT_STR_DT,  /*출장기간시작일*/
		       TE.BZT_END_DT,  /*출장기간종료일    */
		       F_DPT_INFO(BL.BLT_BRDV_CD,'4') DPT_NM /*영수인*/
		  FROM TBBADDED010L TER,
		       TBBADDED011L TE,
		       (SELECT BZT_YR,
		               BZT_SNO,
		               PCT_CNB,
		               BZT_EXS_SNO,
		               SUM(RL_FR_EXS) AS RL_FR_EXS
		          FROM TBBADDED017L
		         WHERE BZT_YR = #strBztYr#
		           AND BZT_SNO =#strBztSno#
		           AND CALC_YN= 'N'
		         GROUP BY BZT_YR,
		               BZT_SNO,
		               PCT_CNB,
		               BZT_EXS_SNO ) TFD,
		       (SELECT BZT_YR,
		               BZT_SNO,
		               PCT_CNB,
		               MAX(BLT_BRDV_CD) AS BLT_BRDV_CD
		          FROM TBBADDED005L
		         WHERE BZT_YR =#strBztYr#
		           AND BZT_SNO =#strBztSno#
		         GROUP BY BZT_YR,
		               BZT_SNO,
		               PCT_CNB) BL
		 WHERE TER.BZT_YR = #strBztYr#
		   AND TER.BZT_SNO = #strBztSno#
		   AND BL.BZT_YR(+) = TER.BZT_YR
		   AND BL.BZT_SNO(+) = TER.BZT_SNO
		   AND BL.PCT_CNB(+) = TER.PCT_CNB
		   AND TE.BZT_YR = TER.BZT_YR
		   AND TE.BZT_SNO = TER.BZT_SNO
		   AND TE.PCT_CNB = TER.PCT_CNB
		   AND TE.CALC_YN = 'N'
		   AND TFD.BZT_YR(+) = TE.BZT_YR
		   AND TFD.BZT_SNO(+) = TE.BZT_SNO
		   AND TFD.PCT_CNB(+) = TE.PCT_CNB
		   AND TFD.BZT_EXS_SNO(+) = TE.BZT_EXS_SNO
		   AND TER.PCT_CNB = #PCT_CNB# /*상위 전산번호*/
		 ORDER BY TE.BZT_STR_DT  
		         ,TE.BZT_END_DT /* 정렬추가 - 2018.03.05 yyh */   
        ]]>
	</select>	

	<!-- 맨 뒷장 합계 -->
	<select id="BADDED029Qselect4_4" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
		
			SELECT SUM(FDEX) AS FDEX,  /*식비 합계*/
			       SUM(DT_EXS) AS DT_EXS,  /*일비 합계*/
			       SUM(LDC) AS LDC,  /*숙박비 합계*/
			       SUM(RL_FR_EXS) AS RL_FR_EXS5,  /*철도비 합계*/
			       SUM(LODG_DCN) AS LODG_DCN,  /*숙박일수 합계*/
			       SUM(BZT_DCN) AS BZT_DCN,   /*출장일수 합계*/
			       SUM(SUM_ALL) AS SUM_ALL,    /*지급액 합계*/
			       MAX(TER.PSON_CNT) PSON_CNT  /*출장인원수 합계*/
			  FROM (SELECT TE.BZT_DCN,
			               TE.FDEX,
			               TE.LDC,
			               TE.DT_EXS,
			               NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS, 0) AS RL_FR_EXS,    /*철도비+수도권운임비 2015.05.07 yyh*/
			               TE.FDEX + TE.LDC + TE.DT_EXS + NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS, 0) AS SUM_ALL,
			               TE.LODG_DCN
			          FROM TBBADDED011L TE,
			               (SELECT BZT_YR,
			                       BZT_SNO,
			                       PCT_CNB,
			                       BZT_EXS_SNO,
			                       SUM(RL_FR_EXS) AS RL_FR_EXS
			                  FROM TBBADDED017L
			                 WHERE BZT_YR = #strBztYr#
			                   AND BZT_SNO = #strBztSno#
			                   AND CALC_YN= 'N'
			                 GROUP BY BZT_YR,
			                       BZT_SNO,
			                       PCT_CNB,
			                       BZT_EXS_SNO ) TFD
			         WHERE TE.BZT_YR = #strBztYr#
			           AND TE.BZT_SNO = #strBztSno#
			           AND TE.CALC_YN = 'N'
			           AND TFD.BZT_YR(+) = TE.BZT_YR
			           AND TFD.BZT_SNO(+) = TE.BZT_SNO
			           AND TFD.PCT_CNB(+) = TE.PCT_CNB
			           AND TFD.BZT_EXS_SNO(+) = TE.BZT_EXS_SNO ) AGGR,
			       (SELECT COUNT(*) AS PSON_CNT
			          FROM TBBADDED010L
			         WHERE BZT_YR = #strBztYr#
			           AND BZT_SNO = #strBztSno#) TER 

        ]]>
	</select>
	
	<!-- #################################### 여비 명세서1(국내여비 등) 조회 끝 ################################# -->
	
	<!-- #################################### 청구내역표(일반) 조회 시작 ################################# -->
	<select id="BADDED029Qselect3_1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
		SELECT SITU.BZT_YR,
		       SITU.SPRT_NO,
		       SITU.BZT_YR ||'-' || SITU.SPRT_NO  TRIP_NO,  /*지원번호*/
		       F_CODE_NM('1000021',SITU.GEN_BZT_KND_CD) GEN_TRIP_CATE_NM,  /*일반출장명*/
		       F_DPT_INFO(SITU.BZT_TL_BRDV_CD,'1') DPT_NM /*선임자 부서명*/
		  FROM TBBADDED002M SITU
		 WHERE SITU.BZT_YR = #strBztYr#
		   AND SITU.BZT_SNO = #strBztSno#
        ]]>
	</select>	
	
	<select id="BADDED029Qselect3_2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT RGN_DVSN_CD,
			       F_CODE_NM('1000023',TE.RGN_DVSN_CD) AREA_KIND_NM,  /*구분*/
			       SUM(BZT_DCN) AS MAN_DAY,  /*연인원*/
			       SUM(LEAD_EXS) LEAD_EXS,  /*지휘비*/
			       SUM(SPM_XPN) SPM_XPN,  /*보충경비*/
			       SUM(LEAD_EXS) + SUM(SPM_XPN) AS SUM_ALL  /*계*/
			  FROM TBBADDED011L TE
			 WHERE BZT_YR = #strBztYr#
			   AND BZT_SNO =#strBztSno#
			   AND FNL_YN = 'Y'
			 GROUP BY RGN_DVSN_CD
        ]]>
	</select>	
	
	<select id="BADDED029Qselect3_3" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT SITU.BZT_YR,
		    	   SITU.SPRT_NO,         
			       F_CODE_NM('1000021',SITU.GEN_BZT_KND_CD) GEN_TRIP_CATE_NM,  /*일반출장명*/
			       F_DPT_INFO(SITU.BZT_BRDV_CD,'1') DPT_NM /*부서명*/
			  FROM TBBADDED002M SITU
			 WHERE SITU.BZT_YR = #strBztYr#
			   AND SITU.BZT_SNO = #strBztSno#
        ]]>
	</select>
	<select id="BADDED029Qselect3_4" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT CD.CD_NM AS AREA_KIND_NM,  /*지역명*/
			       AGGR.MAN_DAY,  /*연인원*/
			       AGGR.IN_EXP,  /*여비*/
			       AGGR.RL_FR_EXS,  /*철도비*/
			       AGGR.SUM_ALL  /*계*/
			  FROM (SELECT RGN_DVSN_CD,
			               SUM(TE.BZT_DCN) AS MAN_DAY,
			               SUM(TE.FDEX)+ SUM(TE.DT_EXS) + SUM(TE.LDC) AS IN_EXP,
			               NVL(SUM(TFD.RL_FR_EXS), 0) + NVL(SUM(TE.CPRG_FR_EXS), 0) AS RL_FR_EXS,    /*2015.05.11 - 수도권운임추가 yyh*/
			               SUM(TE.FDEX)+ SUM(TE.DT_EXS) + SUM(TE.LDC) +NVL(SUM(TFD.RL_FR_EXS), 0) + NVL(SUM(TE.CPRG_FR_EXS), 0)  AS SUM_ALL /*2015.05.11 - 수도권운임추가 yyh*/
			          FROM TBBADDED011L TE,
			               (SELECT BZT_YR,
			                       BZT_SNO,
			                       PCT_CNB,
			                       BZT_EXS_SNO,
			                       CALC_YN,
			                       SUM(RL_FR_EXS) AS RL_FR_EXS
			                  FROM TBBADDED017L
			                 WHERE BZT_YR = #strBztYr#  /*인자값 출장년도*/
			                   AND BZT_SNO = #strBztSno#   /*인자값 출장순번*/
			                 GROUP BY BZT_YR,
			                       BZT_SNO,
			                       PCT_CNB,
			                       BZT_EXS_SNO,
			                       CALC_YN ) TFD
			         WHERE TE.BZT_YR = #strBztYr# /*인자값 출장년도*/
			           AND TE.BZT_SNO = #strBztSno#  /*인자값 출장순번*/
			           AND TE.FNL_YN = 'Y'
			           AND TFD.BZT_YR(+) = TE.BZT_YR
			           AND TFD.BZT_SNO(+) = TE.BZT_SNO
			           AND TFD.PCT_CNB(+) = TE.PCT_CNB
			           AND TFD.BZT_EXS_SNO(+) = TE.BZT_EXS_SNO
			           AND TFD.CALC_YN(+) = TE.CALC_YN
			         GROUP BY TE.RGN_DVSN_CD) AGGR,
			       TBDCMACM013C CD
			 WHERE CD.CMM_CD_DVSN_CD = '1000023'
			   AND CD.CD = AGGR.RGN_DVSN_CD
			   AND CD.CD IN ('1', '2', '3') 
        ]]>
	</select>		
	<!-- #################################### 청구내역표(일반) 조회 끝 ################################# -->
	
	<!-- #################################### 일반출장여비 계산목록 조회 시작 ################################# -->
	<select id="BADDED029Qselect2_1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
		SELECT SITU.BZT_YR ,  /*출장년도*/
		       SITU.BZT_SNO ,  /*출장순번*/
		       SITU.SPRT_NO ,  /*지원번호*/
		       SITU.TIT_TXT ,  /*출장명*/
		       SITU.BZT_BRDV_CD ,  /*주관국과코드     */  
		       F_CODE_NM('1000021',SITU.GEN_BZT_KND_CD) GEN_TRIP_CATE_NM,  /*일반출장명*/
		       DEPT.DPT_NM AS TRIP_DPT_NM ,  /*주관국과명*/
		       F_USR_INFO(SITU.BZT_TL_CNB,'2') AS TRIP_LEADER_NM ,  /*선임자명*/
		       SITU.BZT_TL_CNB ,  /*선임자 직급*/
		       SITU.BZT_TL_RANK_CD ,  /*선입자 직급코드*/
		       F_CODE_NM('1000173',SITU.BZT_TL_RANK_CD) RIP_LEADER_POS_CLASS_NM ,  /*선임자 직급명*/
		       SITU.BZT_TL_BRDV_CD ,  /*선임자 부서코드     */
		       F_DPT_INFO(SITU.BZT_TL_BRDV_CD,'4') TRIP_LEADER_DPT_NM /*선임자 부서명*/
		  FROM TBBADDED002M SITU,
		       TBDCMACM002M DEPT
		 WHERE 1 = 1
		   AND SITU.BZT_YR = #strBztYr#
		   AND SITU.BZT_SNO = #strBztSno#
		   AND DEPT.DPT_CD(+) = SITU.BZT_BRDV_CD   
        ]]>
	</select>
	
	<select id="BADDED029Qselect2_2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
				SELECT TER.BZT_YR ,   /*출장년도 */
				       TER.BZT_SNO ,  /*출장순번 */
				       TER.PCT_CNB ,  /*출장자전산번호 */
				       TER.PCT_NM ,   /*출장자성명 */
				       TER.PCT_RANK_CD ,  /*출장자 직급코드 */
				       
				       F_CODE_NM('1000173',TER.PCT_RANK_CD) POS_CLASS_NM ,  /*직급명   */
				       TER.STF_DVSN_CD ,  /*출장구분코드 */
				       
				       
				       F_DPT_INFO(BL.BLT_BRDV_CD,'4') DPT_NM, /*소속명 */
				       NVL(TE.FDEX,0) AS FDEX,  /*식비 */
				       NVL(TE.DT_EXS,0) AS DT_EXS,  /*일비 */
				       NVL(TE.LDC,0) AS LDC,  /*숙박비 */
				       NVL(TE.CPRG_FR_EXS,0) AS CPRG_FR_EXS, /*수도권운임비*/
				       NVL(TE.IN_EXP,0) AS IN_EXP,  /*국내여비 */
				       NVL(TE.SPM_XPN,0) AS SPM_XPN ,  /*보충경비 */
				       NVL(TE.BZT_DCN,0) AS BZT_DCN ,  /*출장일수 */
				       NVL(TFD.RL_FR_EXS, 0) + NVL(TE.CPRG_FR_EXS,0) RL_FR_EXS ,   /*철도비+수도권운임비*/
				       (
				       CASE
				         WHEN SITU.BZT_TL_CNB = TER.PCT_CNB THEN TER2.LEAD_EXS
				         ELSE 0
				       END) AS LEAD_EXS ,  /*지휘비 */
				       NVL(NVL(TFD.RL_FR_EXS,0), 0) + NVL(NVL(TE.CPRG_FR_EXS,0), 0) + NVL(TE.IN_EXP,0) + NVL(TE.SPM_XPN,0) + (
				                       CASE
				                         WHEN SITU.BZT_TL_CNB = TER.PCT_CNB THEN NVL(TER2.LEAD_EXS,0)
				                         ELSE 0
				                       END) AS SUM_ALL  /*계 */
				  FROM TBBADDED010L TER ,
				       TBBADDED002M SITU ,
				       (SELECT BZT_YR ,
				               BZT_SNO ,
				               PCT_CNB ,
				               SUM(NVL(TE0.FDEX,0)) AS FDEX ,
				               SUM(NVL(TE0.DT_EXS,0)) AS DT_EXS ,
				               SUM(NVL(TE0.LDC,0)) AS LDC ,
				               SUM(NVL(TE0.CPRG_FR_EXS,0)) AS CPRG_FR_EXS , /*수도권운임비추가 - 2015.05.06 yyh*/
				               SUM(NVL(TE0.SPM_XPN,0)) AS SPM_XPN ,
				               SUM(NVL(TE0.FDEX,0)) + SUM(NVL(TE0.DT_EXS,0)) + SUM(NVL(TE0.LDC,0)) AS IN_EXP ,
				               SUM(NVL(TE0.BZT_DCN,0)) AS BZT_DCN
				          FROM TBBADDED011L TE0
				         WHERE 1 = 1
				           AND BZT_YR =#strBztYr#
				           AND BZT_SNO =#strBztSno#
				           AND CALC_YN = 'N'
				         GROUP BY BZT_YR,
				               BZT_SNO,
				               PCT_CNB ) TE ,
				       (SELECT BZT_YR ,
				               BZT_SNO ,
				               SUM(LEAD_EXS) AS LEAD_EXS
				          FROM TBBADDED011L
				         WHERE 1 = 1
				           AND BZT_YR = #strBztYr#
				           AND BZT_SNO = #strBztSno#
				           AND CALC_YN = 'N'
				         GROUP BY BZT_YR,
				               BZT_SNO ) TER2 ,
				       (SELECT BZT_YR ,
				               BZT_SNO ,
				               PCT_CNB ,
				               SUM(RL_FR_EXS) AS RL_FR_EXS
				          FROM TBBADDED017L
				         WHERE 1 = 1
				           AND BZT_YR = #strBztYr#
				           AND BZT_SNO = #strBztSno#
				           AND CALC_YN = 'N'
				         GROUP BY BZT_YR,
				               BZT_SNO,
				               PCT_CNB ) TFD ,
				       (SELECT BZT_YR ,
				               BZT_SNO ,
				               PCT_CNB ,
				               MAX(BLT_BRDV_CD) AS BLT_BRDV_CD
				          FROM TBBADDED005L
				         WHERE 1 = 1
				           AND BZT_YR = #strBztYr#
				           AND BZT_SNO = #strBztSno#
				         GROUP BY BZT_YR,
				               BZT_SNO,
				               PCT_CNB ) BL
				 WHERE 1 = 1
				   AND TE.BZT_YR(+) = TER.BZT_YR
				   AND TE.BZT_SNO(+) = TER.BZT_SNO
				   AND TE.PCT_CNB(+) = TER.PCT_CNB
				   AND TFD.BZT_YR(+) = TER.BZT_YR
				   AND TFD.BZT_SNO(+) = TER.BZT_SNO
				   AND TFD.PCT_CNB(+) = TER.PCT_CNB
				   AND TER2.BZT_YR = TER.BZT_YR
				   AND TER2.BZT_SNO = TER.BZT_SNO
				   AND SITU.BZT_YR = TER.BZT_YR
				   AND SITU.BZT_SNO = TER.BZT_SNO
				   AND BL.BZT_YR(+) = TER.BZT_YR
				   AND BL.BZT_SNO(+) = TER.BZT_SNO
				   AND BL.PCT_CNB(+) = TER.PCT_CNB
				   AND TER.BZT_YR = #strBztYr#
				   AND TER.BZT_SNO = #strBztSno#
        ]]>
	</select>
		<!-- #################################### 일반출장여비계산조회 끝 ################################# -->	
		
	<!-- #################################### 일반출장상황표 조회 시작################################# -->		
	<select id="BADDED029Qselect1_1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
		SELECT  
			    SITU.BZT_YR
			   ,SITU.BZT_SNO
			   ,SITU.AUD_STEP_SNO
			   ,F_DPT_INFO(SITU.BZT_BRDV_CD,'1') DPT_NM /*부서명*/
			   ,SITU.SPRT_NO
			FROM TBBADDED002M SITU
			WHERE 1 = 1
			AND  SITU.BZT_DVSN_CD = '2'
			AND  SITU.BZT_YR = #strBztYr#
			AND  SITU.BZT_SNO = #strBztSno#
        ]]>
	</select>
	
	<select id="BADDED029Qselect1_2" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT 
				   TEAM.TEAM_SNO
			FROM TBBADDED004L TEAM
			   , TBBADDED002M SITU
				WHERE 1 = 1
				AND  TEAM.BZT_YR = SITU.BZT_YR
				AND  TEAM.BZT_SNO = SITU.BZT_SNO
				AND  SITU.BZT_DVSN_CD = '2'
				AND  SITU.BZT_YR = #strBztYr#
				AND  SITU.BZT_SNO =  #strBztSno# 
        ]]>
	</select>
	
	<select id="BADDED029Qselect1_3" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			
				SELECT
				    TTO.BZT_YR  /*출장년도*/
				  , TTO.BZT_SNO  /*출장순번*/
				  , TTO.TEAM_SNO  /*팀번호*/
				  , F_ORG_INFO(TTO.ORG_CD,'1') ORG_NM  /*대상기관*/
				  , F_CODE_NM('1000001',TTO.RGN_CD) AS LCL_NM  /*지역*/
				  , TTO.AUD_STR_DT  /*감사시작일*/
				  , TTO.AUD_END_DT  /*감사종료일*/
				  , PSON.AUD_DCN   /*감사일수*/
				  , PSON.BZT_STR_DT  /*출장시작일*/
				  , PSON.BZT_END_DT  /*출장종료일*/
				  , PSON.BZT_DCN   /*출장일수*/
				FROM
				    TBBADDED008L TTO
				  , TBBADDED002M SITU
				  , (
				   SELECT 
				       BZT_YR
				     , BZT_SNO
				     , TEAM_SNO
				     , BGRP_TG_ORG_SNO
				     , MIN(AUD_STR_DT) AS AUD_STR_DT
				     , MAX(AUD_END_DT) AS AUD_END_DT
				     , MAX(AUD_DCN) AS AUD_DCN
				     , MIN(BZT_STR_DT) AS BZT_STR_DT
				     , MAX(BZT_END_DT) AS BZT_END_DT
				     , MAX(BZT_DCN) AS BZT_DCN
				   FROM TBBADDED006L
				   WHERE BZT_YR =#strBztYr#  /* 출장년도*/
				   GROUP BY BZT_YR, BZT_SNO, TEAM_SNO, BGRP_TG_ORG_SNO
				  ) PSON
				WHERE 1 = 1
				AND  TTO.BZT_YR = SITU.BZT_YR 
				AND  TTO.BZT_SNO = SITU.BZT_SNO  
				AND  PSON.BZT_YR = TTO.BZT_YR
				AND  PSON.BZT_SNO = TTO.BZT_SNO
				AND  PSON.TEAM_SNO = TTO.TEAM_SNO
				AND  PSON.BGRP_TG_ORG_SNO = TTO.BGRP_TG_ORG_SNO
				AND  TTO.BZT_YR = #strBztYr#
				AND  TTO.BZT_SNO = #strBztSno#				
				AND TTO.TEAM_SNO =#TEAM_SNO#
        ]]>
	</select>
	
	<select id="BADDED029Qselect1_4" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[   
        SELECT 
			    TMA.BZT_YR
			  , TMA.BZT_SNO
			  , TMA.TEAM_SNO
			  , TMA.PCT_CNB
			  , F_DPT_INFO(TMA.BLT_BRDV_CD,'4') DPT_NM  /*부서명 약칭1*/
			  , TMA.PCT_RANK_CD  
			  , F_CODE_NM('1000173',TMA.PCT_RANK_CD) AS RANK_NM /*출장자직급명  */
			  , TMA.PCT_NM
			FROM TBBADDED005L TMA
			   , TBBADDED002M SITU
			WHERE 1 = 1
			AND  TMA.BZT_YR = SITU.BZT_YR 
			AND  TMA.BZT_SNO = SITU.BZT_SNO  
			AND  SITU.BZT_DVSN_CD = '2'   
			AND  SITU.BZT_YR = #strBztYr#
			AND  SITU.BZT_SNO = #strBztSno#
			AND TMA.TEAM_SNO = #TEAM_SNO#        /*상위의쿼리(SQL_SUB)의 팀번호*/
        
        
        
        
            
        ]]>
	</select>
	
	<select id="BADDED029Qselect1_5" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[   
      
			SELECT M.TEAM_SNO ,  /*팀번호
			       MIN(M.AUD_STR_DT) AS AUD_STR_DT ,  /*감사시작일*/
			       MAX(M.AUD_END_DT) AS AUD_END_DT ,  /*감사종료일*/
			       SUM(M.AUD_DCN) AS AUD_DCN ,    /*감사일수*/
			       MIN(M.BZT_STR_DT) AS BZT_STR_DT ,  /*출장시작일*/
			       MAX(M.BZT_END_DT) AS BZT_END_DT ,  /*출장종료일*/
			       SUM(M.BZT_DCN) AS BZT_DCN   /*출장일수*/
			  FROM (SELECT PTD.BZT_YR ,
			               PTD.BZT_SNO ,
			               PTD.TEAM_SNO ,
			               PTD.BGRP_TG_ORG_SNO ,
			               MIN(PTD.AUD_STR_DT) AS AUD_STR_DT ,
			               MAX(PTD.AUD_END_DT) AS AUD_END_DT ,
			               MAX(PTD.AUD_DCN) AS AUD_DCN ,
			               MIN(PTD.BZT_STR_DT) AS BZT_STR_DT ,
			               MAX(PTD.BZT_END_DT) AS BZT_END_DT ,
			               MAX(PTD.BZT_DCN) AS BZT_DCN
			          FROM TBBADDED006L PTD,
			               TBBADDED002M SITU
			         WHERE 1 = 1
			           AND PTD.BZT_YR = SITU.BZT_YR
			           AND PTD.BZT_SNO = SITU.BZT_SNO
			           AND SITU.BZT_DVSN_CD = '2'
			           AND SITU.BZT_YR = #strBztYr# /*인자값 출장년도*/
			           AND SITU.BZT_SNO =  #strBztSno# /*인자값 출장순번*/
			           AND PTD.TEAM_SNO = #TEAM_SNO# /*상위의쿼리(SQL_SUB)의 팀번호*/
			         GROUP BY PTD.BZT_YR,
			               PTD.BZT_SNO,
			               PTD.TEAM_SNO,
			               PTD.BGRP_TG_ORG_SNO ) M
			 GROUP BY M.TEAM_SNO

        ]]>
	</select>
	<!-- #################################### 개인별 운임명세서 조회 끝 ################################# -->	

	
	<!-- 일반출장여비정산 계산목록 - 정상집계표 - 2015.07.20 yyh -->
	<select id="BADDED029Qselect2_2_1" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
        SELECT BZT_YR
		     , BZT_SNO
		     , PCT_CNB
		     , PCT_NM
		     , RANK_NM AS POS_CLASS_NM
		     , BLT_BRDV_NM AS DPT_NM
		     , FDEX
		     , DT_EXS
		     , LDC
		     , CPRG_FR_EXS
		     , NVL(FDEX, 0) + NVL(DT_EXS, 0) + NVL(LDC, 0) AS IN_EXP
		     , SPM_XPN
		     , BZT_DCN
		     , RL_FR_EXS
		     , LEAD_EXS
		     , AUD_ACTV_RCV_EXS
		     , SUM_ALL AS SUM_ALL
		     , '' AS SORTER
  		  FROM (
			SELECT D1.BZT_YR							  		  AS BZT_YR           /*출장년도*/
			     , D1.BZT_SNO									  AS BZT_SNO          /*출장순번*/
			     , D1.PCT_CNB									  AS PCT_CNB          /*출장자전산번호*/
			     , D1.PCT_NM									  AS PCT_NM           /*출장자성명*/
			     , D1.RANK_NM									  AS RANK_NM          /*출장자직급명*/
			     , F_DPT_INFO(D1.BLT_BRDV_CD, '4') 				  AS BLT_BRDV_NM      /*소속명*/
			     , NVL(D1.DT_EXS,0) - NVL(D2.DT_EXS,0)            AS DT_EXS           /*일비*/
			     , NVL(D1.LDC,0) - NVL(D2.LDC,0)                  AS LDC              /*숙박비*/              
			     , NVL(D1.FDEX,0) - NVL(D2.FDEX,0)                AS FDEX             /*식비*/
			     , NVL(D1.CPRG_FR_EXS,0) - NVL(D2.CPRG_FR_EXS,0)  AS CPRG_FR_EXS      /*수도권운임 - 2015.05.06 yyh*/			     
			     , NVL(D1.SPM_XPN,0) - NVL(D2.SPM_XPN,0)          AS SPM_XPN          /*보충경비*/
			     , NVL(D1.BZT_DCN,0) - NVL(D2.BZT_DCN,0)          AS BZT_DCN          /*출장일수*/
			     , NVL(D1.RL_FR_EXS,0) - NVL(D2.RL_FR_EXS,0)      AS RL_FR_EXS        /*철도운임비*/
			     , NVL(D1.LEAD_EXS,0) - NVL(D2.LEAD_EXS,0)        AS LEAD_EXS         /*지휘비*/
			     , NVL(D1.AUD_ACTV_RCV_EXS,0) - NVL(D2.AUD_ACTV_RCV_EXS,0) AS AUD_ACTV_RCV_EXS   /*감사활동수용비*/
			     , NVL(D1.SUM_COST,0) - NVL(D2.SUM_COST,0)        AS SUM_COST         /*국내여비*/
			     , NVL(D1.ALL_COST,0) - NVL(D2.ALL_COST,0)        AS SUM_ALL         /*합계*/
			     , '' 											  AS AJT_YN 		  /*정산완료처리에 flag로 사용*/
			     , D1.MAX_SNO									  AS MAX_SNO		  /*이력변경번호*/
			     , D1.AJT_CHG_RSN								  AS AJT_CHG_RSN	  /*정산사유*/
			  FROM (
			        SELECT D2.*
			             , MAX_SNO
			             , AJT_CHG_RSN 
			          FROM (
			                    SELECT BZT_YR
			                         , BZT_SNO
			                         , PCT_CNB
			                         , MAX(BZT_AJT_SNO) MAX_SNO
			                         , MAX(AJT_CHG_RSN) AJT_CHG_RSN
			                      FROM TBBADDED019H
			                     WHERE BZT_YR  = #strBztYr#
			                       AND BZT_SNO = #strBztSno#
			                       AND NVL(AJT_YN,'N') = 'N'
			                     GROUP BY BZT_YR , BZT_SNO , PCT_CNB  
			              ) D1
			            , VADED001 D2
			         WHERE 1=1
			           AND D1.BZT_YR  = D2.BZT_YR
			           AND D1.BZT_SNO = D2.BZT_SNO
			           AND D1.PCT_CNB = D2.PCT_CNB
			           AND D1.MAX_SNO = D2.BZT_AJT_SNO 
			           AND D1.BZT_YR  = #strBztYr#
			           AND D1.BZT_SNO = #strBztSno#
			      ) D1
			    , (
			        SELECT D2.* 
			          FROM (
			                    SELECT BZT_YR
			                         , BZT_SNO
			                         , PCT_CNB
			                         , MAX(BZT_AJT_SNO) MAX_SNO
			                      FROM TBBADDED019H
			                     WHERE BZT_YR  = #strBztYr#
			                       AND BZT_SNO = #strBztSno#
			                       AND NVL(AJT_YN,'N') = 'Y'
			                     GROUP BY BZT_YR , BZT_SNO , PCT_CNB  
			              ) D1
			            , VADED001 D2
			         WHERE 1=1
			           AND D1.BZT_YR  = D2.BZT_YR
			           AND D1.BZT_SNO = D2.BZT_SNO
			           AND D1.PCT_CNB = D2.PCT_CNB
			           AND D1.MAX_SNO = D2.BZT_AJT_SNO 
			           AND D1.BZT_YR  = #strBztYr#
			           AND D1.BZT_SNO = #strBztSno#
			      ) D2
			WHERE 1=1
			  AND D1.BZT_YR  = D2.BZT_YR(+)
			  AND D1.BZT_SNO = D2.BZT_SNO(+)
			  AND D1.PCT_CNB = D2.PCT_CNB(+)
			) 	
			WHERE 1=1
  			  AND DT_EXS <>0 OR LDC<>0 OR FDEX<>0 OR SPM_XPN<>0 OR BZT_DCN<>0 OR RL_FR_EXS<>0 OR LEAD_EXS<>0 OR AUD_ACTV_RCV_EXS<>0 OR SUM_COST<>0 OR SUM_ALL<>0
  			      OR CPRG_FR_EXS <> 0
 	  	    ORDER BY PCT_CNB 
        ]]>
	</select>
</sqlMap> 

