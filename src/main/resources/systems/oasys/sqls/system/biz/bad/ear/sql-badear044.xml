<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ear/044">

	<resultMap class="java.util.HashMap" id="resultColbMap">
		<result property="AUD_YR" column="AUD_YR" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_YR_NO" column="AUD_YR_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_NO" column="AUD_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="SPV_BRDV_NM" column="SPV_BRDV_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_SBJ_NM" column="AUD_SBJ_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_ORG_CNT" column="AUD_ORG_CNT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DSP_RQ_SNO" column="DSP_RQ_SNO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DSP_RQ_SNO_NM" column="DSP_RQ_SNO_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="FRM_NO" column="FRM_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="RPRT_NO" column="RPRT_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TIT_TXT" column="TIT_TXT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DSP_RQ_KND_CD" column="DSP_RQ_KND_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ORG_DVSN_CD" column="ORG_DVSN_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_EPS_CD" column="AUD_EPS_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DSP_RQ_SRNO" column="DSP_RQ_SRNO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ENF_DT" column="ENF_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="HNDL_DDLN_DT" column="HNDL_DDLN_DT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ENF_BRDV_CD" column="ENF_BRDV_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ENF_BRDV_NM" column="ENF_BRDV_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DOC_SEN_NO" column="DOC_SEN_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="WRDO_CAU_CD" column="WRDO_CAU_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ENFM_MNG_BRDV_CD" column="ENFM_MNG_BRDV_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DTM_YN" column="DTM_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DTM_STA_CD" column="DTM_STA_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="HMP_OPEN_YN" column="HMP_OPEN_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DTY_OBV_UTL_YN" column="DTY_OBV_UTL_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="WRDO_TYP_CD" column="WRDO_TYP_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DSP_RQ_APV_STA_CD" column="DSP_RQ_APV_STA_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TSK_CAT_CD" column="TSK_CAT_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="WRDO_TYP_NM" column="WRDO_TYP_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TSK_CAT_NM" column="TSK_CAT_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DSP_RQ_KND_NM" column="DSP_RQ_KND_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DTM_STA_NM" column="DTM_STA_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="AUD_YR_NO_KND_NM" column="AUD_YR_NO_KND_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
    </resultMap>
    
	<!--처분요구관리 조회-->
	<select id="BADEAR044PMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT D1.AUD_YR                         AS AUD_YR                          /*감사년도*/
			     , D1.AUD_NO                         AS AUD_NO                          /*감사번호*/
			     , T1.AUD_GRN_NO                     AS AUD_GRN_NO                      /*감사부여번호 - 2016.06.01 yyh*/
			     , D1.AUD_YR||D1.AUD_NO              AS AUD_YR_NO   
			     , (SELECT F_ORG_CNT_NM_AUD(D1.AUD_YR,D1.AUD_NO,'AUD') FROM DUAL )  AS AUD_ORG_CNT /*기관명*/
			     , D1.DSP_RQ_SNO                     AS DSP_RQ_SNO                      /*처분요구순번*/
                 , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO      
                                                     AS DSP_RQ_SNO_NM       /*처분요구순번DISP*/			
 		     	 , CASE WHEN T1.AUD_YR >= '2016' 
			                 THEN SUBSTR(T1.AUD_KND_CD,3,1)
			            ELSE '' 
			        END                              AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.24 yyh*/
 		     	 , CASE WHEN T1.AUD_YR >= '2016' 
			                 THEN F_CODE_NM('1000739',SUBSTR(T1.AUD_KND_CD,3,1)) 
			            ELSE '' 
			        END                              AS AUD_YR_NO_KND_NM /*감사연번호종류코드 추가 - 2015.12.24 yyh*/  			        
			     , D1.FRM_NO                         AS FRM_NO                          /*서식번호*/
			     , D1.RPRT_NO                        AS RPRT_NO                      /*보고서식번호*/
			     , D1.TIT_TXT                        AS TIT_TXT                         /*제목내용*/    
			     , D1.DSP_RQ_KND_CD                  AS DSP_RQ_KND_CD                   /*처분요구종류코드*/
			     , D1.ORG_DVSN_CD                    AS ORG_DVSN_CD                     /*기관구분코드*/
			     , D1.AUD_EPS_CD                     AS AUD_EPS_CD                      /*감사중점코드*/
			     , D2.DSP_RQ_SRNO                    AS DSP_RQ_SRNO                     /*처분요구일련번호*/
			     , D2.ENF_DT                         AS ENF_DT                          /*시행일*/
			     , D2.HNDL_DDLN_DT                   AS HNDL_DDLN_DT                    /*처리기한일*/
			     , D2.ENF_BRDV_CD                    AS ENF_BRDV_CD                     /*시행국과코드*/
			     , F_DPT_INFO(D2.ENF_BRDV_CD,'1')	 AS ENF_BRDV_NM                     /*시행국과명*/
			     , D2.DOC_SEN_NO                     AS DOC_SEN_NO                      /*문서발송코드*/
			     , D2.WRDO_CAU_CD                    AS WRDO_CAU_CD                     /*비위원인코드*/
			     , D2.ENFM_MNG_BRDV_CD               AS ENFM_MNG_BRDV_CD                /*집행관리국과코드*/    
			     , D2.DTM_YN                         AS DTM_YN                          /*확정여부*/
			     , D2.DTM_STA_CD                     AS DTM_STA_CD                      /*확정상태코드*/
			     , D2.HMP_OPEN_YN                    AS HMP_OPEN_YN                     /*홈페이지공개여부*/
			     , D2.DTY_OBV_UTL_YN                 AS DTY_OBV_UTL_YN                  /*직무관철활용여부*/
			     , D2.WRDO_TYP_CD                    AS WRDO_TYP_CD                     /*비위유형코드*/
			     , D2.DSP_RQ_APV_STA_CD              AS DSP_RQ_APV_STA_CD               /*처분요구결재상태코드*/
			     , D2.TSK_CAT_CD                     AS TSK_CAT_CD                      /*업무분류코드*/
			     , F_CODE_NM('1000121',D2.WRDO_TYP_CD) AS WRDO_TYP_NM                   /*비위유형코드명*/      
			     , F_CODE_NM('1000120',D2.TSK_CAT_CD)  AS TSK_CAT_NM                    /*업무분류명*/
			     , F_CODE_NM('1000002',D1.DSP_RQ_KND_CD )  AS DSP_RQ_KND_NM                    /*처분요구종류명*/
			     , F_CODE_NM('1000017',D2.DTM_STA_CD )  AS DTM_STA_NM                    /*결재상태명*/
			  FROM TBBADEAR001M D1
			     , TBBADEAR002D D2
			     , TBBADDED001M T1
			 WHERE 1=1
			   AND D1.AUD_YR     = D2.AUD_YR
			   AND D1.AUD_NO     = D2.AUD_NO
			   AND D1.DSP_RQ_SNO = D2.DSP_RQ_SNO
			   AND D1.AUD_YR     = T1.AUD_YR
			   AND D1.AUD_NO     = T1.AUD_NO			   
		]]>
		<isNotEmpty property="strDspRqKndCd">	 
			<![CDATA[  		
			   AND D1.DSP_RQ_KND_CD     = #strDspRqKndCd#
			]]>
		</isNotEmpty>		
		<isNotEmpty property="strEnfDtSt">	 
			<![CDATA[  		
			   AND D2.ENF_DT     >= #strEnfDtSt#
			]]>
		</isNotEmpty>
		<isNotEmpty property="strEnfDtEnd">	 
        	<![CDATA[  			
			   AND D2.ENF_DT     <= #strEnfDtEnd#
			]]>   
		</isNotEmpty>	
		
		<isNotEmpty property="strAudYrSt">	 
        	<![CDATA[  		
			   AND D1.AUD_YR   >= #strAudYrSt#
			]]>    
		</isNotEmpty>	
		
		<isNotEmpty property="strAudYrEnd">	 
        	<![CDATA[  		
			   AND D1.AUD_YR  <= #strAudYrEnd#
			]]>   
		</isNotEmpty>					
			
		<isNotEmpty property="strAudYrSt">
			<isNotEmpty property="strAudGrnNoSt"> 
        	<![CDATA[     		
			  AND D1.AUD_YR||LPAD(T1.AUD_GRN_NO,4,'0') >= #strAudYrSt#||DECODE(#strAudGrnNoSt#,'','0000', LPAD(#strAudGrnNoSt#,4,'0'))
			]]>
			</isNotEmpty>
		</isNotEmpty>	
		<isNotEmpty property="strAudYrEnd">
		<isNotEmpty property="strAudGrnNoEnd">
        	<![CDATA[     		
			  AND D1.AUD_YR||LPAD(T1.AUD_GRN_NO,4,'0') <= #strAudYrEnd#||DECODE(#strAudGrnNoEnd#,'','9999', LPAD(#strAudGrnNoEnd#,4,'0'))
			]]>
			</isNotEmpty>
		</isNotEmpty>	
		
		/* 감사연번종류코드 추가 - 2015.12.22 yyh */		
		<isNotEmpty property="strAudYrNoKndCdSt">
        	<![CDATA[ 			
                AND SUBSTR(T1.AUD_KND_CD,3,1) = SUBSTR(#strAudYrNoKndCdSt#,3,1)
			]]>                 
		</isNotEmpty>							
		
			
		<isNotEmpty property="strEnfBrdvCd">	 
			   AND D2.ENF_BRDV_CD  = #strEnfBrdvCd#
		</isNotEmpty>		
		<isNotEmpty property="strTitTxt">	 
			    AND D1.TIT_TXT LIKE '%'||#strTitTxt#||'%'
		</isNotEmpty>		
		<isNotEmpty property="strRltnOrgNm">	 
			   AND (SELECT ORG_NM
			          FROM TBDCMACM015M
			         WHERE ORG_CD = D2.RLTN_ORG_CD) LIKE #strRltnOrgNm#||'%'	
		</isNotEmpty>	
		<isNotEmpty property="strDfntNam">	 
               AND EXISTS (SELECT 1
		                     FROM TBBADEAR007M
                             WHERE 1=1
                               AND AUD_YR 		= D1.AUD_YR
                               AND AUD_NO 		= D1.AUD_NO
                               AND DSP_RQ_SNO 	= D1.DSP_RQ_SNO 
                               AND DFNT_NAM LIKE #strDfntNam#||'%')				   		   
		</isNotEmpty>			
		
        <![CDATA[       
			  ORDER BY D1.AUD_YR , D1.AUD_NO DESC, D1.DSP_RQ_SNO DESC
        ]]>
	</select>



<!--처분요구관리 조회-->
	<select id="BADEAR044PMainSelectType1" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT MASTER.AUD_YR AUD_YR
			     , MASTER.AUD_NO AUD_NO
			     , T1.AUD_GRN_NO                     AS AUD_GRN_NO          /*감사부여번호 - 2016.06.01 yyh*/			     
			     , MASTER.DSP_RQ_SNO DSP_RQ_SNO
                 , F_MNG_KND_AUDYRNO(T1.AUD_YR, T1.AUD_NO, T1.AUD_KND_CD, '-') || '-' || MASTER.DSP_RQ_SNO      
                                                     AS DSP_RQ_SNO_NM       /*처분요구순번DISP*/			
 		     	 , CASE WHEN T1.AUD_YR >= '2016' 
			                 THEN SUBSTR(T1.AUD_KND_CD,3,1)
			            ELSE '' 
			        END                              AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.24 yyh*/
 		     	 , CASE WHEN T1.AUD_YR >= '2016' 
			                 THEN F_CODE_NM('1000739',SUBSTR(T1.AUD_KND_CD,3,1)) 
			            ELSE '' 
			        END                              AS AUD_YR_NO_KND_NM /*감사연번호종류코드 추가 - 2015.12.24 yyh*/  				        
			     , RELORG.RLTN_ORG_CD                           AS RLTN_ORG_CD
			     , (SELECT ORG_NM
			          FROM TBDCMACM015M
			          WHERE ORG_CD = RELORG.RLTN_ORG_CD)        AS AUD_ORG_CNT
			     , MASTER.DSP_RQ_KND_CD                         AS DSP_RQ_KND_CD
			     , (SELECT CD_NM
			          FROM TBDCMACM013C
			         WHERE CMM_CD_DVSN_CD = '1000002'
			           AND CD = MASTER.DSP_RQ_KND_CD)           AS DSP_RQ_KND_NM
			     , DETAIL.ENF_BRDV_CD ENF_BRDV_CD
			     , (SELECT DPT_NM
			          FROM TBDCMACM002M
			         WHERE DPT_CD = DETAIL.ENF_BRDV_CD)         AS OPER_BURDIV_NM
			     , DETAIL.ENFM_MNG_BRDV_CD                      AS ENFM_MNG_BRDV_CD
			     , (SELECT DPT_NM
			          FROM TBDCMACM002M
			         WHERE DPT_CD = DETAIL.ENFM_MNG_BRDV_CD)    AS ENFM_MNG_BRDV_NM
			     , DETAIL.PNL_DRIN_PSVT_AM                      AS PNL_DRIN_PSVT_AM
			     , DETAIL.ENF_DT                                AS ENF_DT
			     , RELPSN.DFNT_NAM                              AS DETAILUSR_NAM
			     , RELPSN.AD                                    AS AD
			     , RELPSN.AM                                    AS AM
			     , DETAIL.ENF_DT                                AS ENF_DT                          /*시행일*/
			     , DETAIL.ENF_BRDV_CD                           AS ENF_BRDV_CD                     /*시행국과코드*/
			     , F_DPT_INFO(DETAIL.ENF_BRDV_CD,'1')	        AS ENF_BRDV_NM                     /*시행국과명*/     
			     , MASTER.TIT_TXT                               AS TIT_TXT                         /*제목내용*/   
			     , DETAIL.EXAM_RPRT_DSP_RQ_SBT                  AS EXAM_RPRT_DSP_RQ_SBT            /*검토보고서처분요구요지*/
			  FROM TBBADEAR001M MASTER
			     , TBBADEAR002D DETAIL
			     , TBBADEAR006M RELORG
			     , TBBADEAR007M RELPSN
			     , TBBADDED001M T1			     
			 WHERE 1=1
			   AND MASTER.AUD_YR 		= DETAIL.AUD_YR
			   AND MASTER.AUD_NO 		= DETAIL.AUD_NO
			   AND MASTER.DSP_RQ_SNO 	= DETAIL.DSP_RQ_SNO
			   AND MASTER.AUD_YR 		= RELORG.AUD_YR
			   AND MASTER.AUD_NO 		= RELORG.AUD_NO
			   AND MASTER.DSP_RQ_SNO 	= RELORG.DSP_RQ_SNO
			   AND RELORG.AUD_YR 		= RELPSN.AUD_YR
			   AND RELORG.AUD_NO 		= RELPSN.AUD_NO
			   AND RELORG.DSP_RQ_SNO 	= RELPSN.DSP_RQ_SNO
			   AND RELORG.RLTN_ORG_CD 	= RELPSN.RLTN_ORG_CD 
			   AND MASTER.AUD_YR 		= T1.AUD_YR
			   AND MASTER.AUD_NO 		= T1.AUD_NO			   
		]]>
		<isNotEmpty property="strEnfDtSt">	 
			<![CDATA[  		
			   AND DETAIL.ENF_DT     >= #strEnfDtSt#
			]]>
		</isNotEmpty>
		<isNotEmpty property="strEnfDtEnd">	 
        	<![CDATA[  			
			   AND DETAIL.ENF_DT     <= #strEnfDtEnd#
			]]>   
		</isNotEmpty>
		
		<isNotEmpty property="strAudYrSt">	 
        	<![CDATA[  		
			   AND MASTER.AUD_YR   >= #strAudYrSt#
			]]>    
		</isNotEmpty>
		
		<isNotEmpty property="strAudYrEnd">	 
        	<![CDATA[  		
			   AND MASTER.AUD_YR  <= #strAudYrEnd#
			]]>   
		</isNotEmpty>
				
		<isNotEmpty property="strAudYrSt">
			<isNotEmpty property="strAudGrnNoSt"> 
        	<![CDATA[     		
			  AND MASTER.AUD_YR||LPAD(T1.AUD_GRN_NO,4,'0') >= #strAudYrSt#||DECODE(#strAudGrnNoSt#,'','0000', LPAD(#strAudGrnNoSt#,4,'0'))
			]]>
			</isNotEmpty>
		</isNotEmpty>	
		<isNotEmpty property="strAudYrEnd">
		<isNotEmpty property="strAudGrnNoEnd">
        	<![CDATA[     		
			  AND MASTER.AUD_YR||LPAD(T1.AUD_GRN_NO,4,'0') <= #strAudYrEnd#||DECODE(#strAudGrnNoEnd#,'','9999', LPAD(#strAudGrnNoEnd#,4,'0'))
			]]>
			</isNotEmpty>
		</isNotEmpty>	
		
		/* 감사연번종류코드 추가 - 2015.12.22 yyh */		
		<isNotEmpty property="strAudYrNoKndCdSt">
        	<![CDATA[ 			
                AND SUBSTR(T1.AUD_KND_CD,3,1) = SUBSTR(#strAudYrNoKndCdSt#,3,1)
			]]>                 
		</isNotEmpty>							
		
				
		<isNotEmpty property="strEnfBrdvCd">	 
			   AND DETAIL.ENF_BRDV_CD  = #strEnfBrdvCd#
		</isNotEmpty>		
		<isNotEmpty property="strTitTxt">	 
			    AND MASTER.TIT_TXT LIKE '%'||#strTitTxt#||'%'
		</isNotEmpty>		
		<isNotEmpty property="strRltnOrgNm">	 
			   AND (SELECT ORG_NM
			          FROM TBDCMACM015M
			         WHERE ORG_CD = RELORG.RLTN_ORG_CD) LIKE #strRltnOrgNm#||'%'	
		</isNotEmpty>		
		<isNotEmpty property="strDfntNam">	 
			   AND RELPSN.DFNT_NAM LIKE #strDfntNam#||'%'	
		</isNotEmpty>	
		
        <![CDATA[       
			  ORDER BY MASTER.AUD_YR , MASTER.AUD_NO DESC, MASTER.DSP_RQ_SNO DESC
        ]]>
	</select>


</sqlMap> 
