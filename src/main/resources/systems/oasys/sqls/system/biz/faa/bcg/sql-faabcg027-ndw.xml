<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="faa/bcg/027-ndw"> 
	
	<select id="FAABCG288EMainselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
		     SELECT D1.FSCL_YY                                   AS  FSCL_YY                
					,'['||D1.FSCL_CD||'] '||ISNULL(D5.FSCL_NM,'')    AS  FSCL_NM
					,'['||D1.OFFC_CD||'] '||ISNULL(D4.OFFC_NM, '')  AS  OFFC_NM                 
					,D1.BZ_ID                                       AS  BZ_ID                  
					,D1.CTR_NM                                      AS  CTR_NM                  
					,D1.CTR_MG_NO                                   AS  CTR_MG_NO            
					,'['||D1.FGO_CD||'] '||ISNULL(D3.FGO_NM, '')    AS  FGO_NM
					,D1.CTR_DT                                      AS  CTR_DT                
			   FROM DWMGR.TB_NPAQ300 D1
	LEFT OUTER JOIN DWMGR.TB_BICD102 D2
	             ON D2.ITG_CLS_CD = 'NP117'
				AND D2.ITG_DTS_CD = D1.DUT_PRG_STAT_CD
	LEFT OUTER JOIN DWMGR.TB_BICD031 D3 
				 ON D3.FGO_CD = D1.RQ_PADM_GOF_CD
	LEFT OUTER JOIN DWMGR.TB_BICD011 D4
				 ON D4.OFFC_CD = D1.OFFC_CD     
	LEFT OUTER JOIN DWMGR.TB_BICD001 D5
				 ON D1.FSCL_CD = D5.FSCL_CD
			  WHERE D1.DUT_PRG_STAT_CD IN ('800', '810')  
			    AND D1.NEW_CHG_DIV_CD <> '9'      
			    AND D1.DEL_YN = 'N'         
				]]>
				<isNotEmpty property="strFsclYy">
		     	AND D1.FSCL_YY = #strFsclYy#
				</isNotEmpty>
				<isNotEmpty property="strFsclCd">
				AND D1.FSCL_CD = #strFsclCd#
				</isNotEmpty>
				<isNotEmpty property="strOffcCd">
				AND D1.OFFC_CD = #strOffcCd#
				</isNotEmpty>
				<isNotEmpty property="strCtrNm">
				AND D1.CTR_NM LIKE '%'||#strCtrNm#||'%'
				</isNotEmpty>
	</select>
	
	<select id="FAABCG288EFSCLYYselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
		      SELECT DISTINCT FSCL_YY AS FSCL_YY                
				FROM DWMGR.TB_NPAQ300 
			   WHERE DUT_PRG_STAT_CD IN ('800', '810')  
				AND NEW_CHG_DIV_CD <> '9'      
				AND DEL_YN = 'N'       
				AND FSCL_YY > '2008'  
				]]>
				<isNotEmpty property="strFsclCd">
				AND FSCL_CD = #strFsclCd#
				</isNotEmpty>
				<isNotEmpty property="strOffcCd">
				AND OFFC_CD = #strOffcCd#
				</isNotEmpty>
		   ORDER BY FSCL_YY
	</select>
	
	<select id="FAABCG288EFSCLCDselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
		      SELECT DISTINCT D.FSCL_CD AS FSCL_CD
					 ,'['||D.FSCL_CD||'] '||C.FSCL_NM AS FSCL_NM                
				FROM DWMGR.TB_NPAQ300 D
	 LEFT OUTER JOIN DWMGR.TB_BICD001 C
				  ON D.FSCL_CD = C.FSCL_CD
			   WHERE D.DUT_PRG_STAT_CD IN ('800', '810')  
				 AND D.NEW_CHG_DIV_CD <> '9'      
				 AND D.DEL_YN = 'N'         
				 AND D.FSCL_CD IS NOT NULL
				 AND D.FSCL_CD NOT LIKE '% %'
				]]>
				<isNotEmpty property="strFsclYy">
				 AND D.FSCL_YY = #strFsclYy#
				</isNotEmpty>
				<isNotEmpty property="strOffcCd">
				 AND D.OFFC_CD = #strOffcCd#
				</isNotEmpty>
		       ORDER BY D.FSCL_CD
	</select>

	<select id="FAABCG288EOFFCCDselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
	        SELECT DISTINCT	D1.OFFC_CD AS OFFC_CD
				   ,'['||D1.OFFC_CD||'] '||D2.OFFC_NM AS OFFC_NM                
			  FROM DWMGR.TB_NPAQ300 D1
   LEFT OUTER JOIN DWMGR.TB_BICD011 D2
			    ON D2.OFFC_CD = D1.OFFC_CD 
		 	 WHERE D1.DUT_PRG_STAT_CD IN ('800', '810')  
			   AND D1.NEW_CHG_DIV_CD <> '9'      
			   AND D1.DEL_YN = 'N'         
			   AND D1.OFFC_CD IS NOT NULL
			   AND D1.OFFC_CD NOT LIKE '% %'
			]]>
			<isNotEmpty property="strFsclYy">
			   AND D1.FSCL_YY = #strFsclYy#
			</isNotEmpty>
			<isNotEmpty property="strFsclCd">
			   AND D1.FSCL_CD = #strFsclCd#
			</isNotEmpty>
		  ORDER BY SUBSTRING(OFFC_NM,6)
	</select>

	<select id="FAABCG288EDetail1select" parameterClass="paramMap"	resultClass="resultMap">
		     SELECT '['||D1.AST_DUT_DIV_CD||'] '||D2.ITG_DTS_CD_NM AS AST_DUT_DIV_CD
			    	,'['||D1.CTR_CHRG_GOF_CD||'] '||D3.FGO_NM AS CTR_CHRG_GOF_CD
			    	,D1.CLT_NM
			    	,'['||D1.CTR_TY_CD||'] '||D4.ITG_DTS_CD_NM AS CTR_TY_CD
			    	,CAST(D1.TOT_BOKP_AMT AS INT) AS TOT_BOKP_AMT 
			    	,CAST(D1.CTR_AMT AS INT) AS CTR_AMT
			    	,CAST(D1.CTR_GUR_AMT AS INT) AS CTR_GUR_AMT
			    	,D1.DELAY_REWD_PRRT
			    	,D1.PAT_SPLY_YN
			    	,D1.SPLY_DLN
			    	,CAST(D1.PAT_PAY_TOT_TN AS INT) AS PAT_PAY_TOT_TN
			    	,D1.CTR_CGP_NM
			    	,D1.CTR_MG_NO
			    	,D1.CTR_DT
			    	,D1.CTR_COC_DT
			    	,D1.CTR_EDT
			    	,D1.MTEXT_1_DES
			   FROM DWMGR.TB_NPAQ300 D1
	LEFT OUTER JOIN DWMGR.TB_BICD102 D2
			   	 ON D2.ITG_CLS_CD = 'NP101'
			   	AND D1.AST_DUT_DIV_CD = D2.ITG_DTS_CD
	LEFT OUTER JOIN DWMGR.TB_BICD031 D3
			   	 ON D1.CTR_CHRG_GOF_CD = D3.FGO_CD
	LEFT OUTER JOIN DWMGR.TB_BICD102 D4
			   	 ON D4.ITG_CLS_CD = 'NP102'
			   	AND D1.CTR_TY_CD = D4.ITG_DTS_CD
			  <isNotEmpty property="strFsclYy">
		     	AND D1.FSCL_YY = #strFsclYy#
			  </isNotEmpty>
			  <isNotEmpty property="strFsclCd">
				AND D1.FSCL_CD = #strFsclCd#
			  </isNotEmpty>
			  <isNotEmpty property="strOffcCd">
				AND D1.OFFC_CD = #strOffcCd#
			  </isNotEmpty>
			  <isNotEmpty property="strCtrMgNo">
			  WHERE D1.CTR_MG_NO = #strCtrMgNo#
			  </isNotEmpty>
	</select>

	<select id="FAABCG288ESub1select" parameterClass="paramMap"	resultClass="resultMap">
        SELECT 
        <isEqual property="strSearchSum" compareValue="1"><!-- 검색조건 전체 -->
			D1.FSCL_YY
			,D1.BZ_ID
			,'['||D1.SACTV_CD||'] '||D2.SACTV_NM AS SACTV_NM
			,D1.CITM_CD
			,'['||D1.CITM_CD||'] '||D3.CITM_NM AS CITM_NM
			,D1.ALC_TAMT AS ALC_TAMT 
			,D1.BDG_ALAMT AS BDG_ALAMT
			,D1.RE_ALAMT AS RE_ALAMT
			,D1.BZ_ALC_AMT AS BZ_ALC_AMT
			,D1.OACT_AMT AS OACT_AMT
			,D1.EPRS_AMT AS EPRS_AMT
			,D1.NPBF_AMT AS NPBF_AMT
		</isEqual>
		<isEqual property="strSearchSum" compareValue="2"><!-- 검색조건 회계연도 -->
			D1.FSCL_YY
			,'' AS BZ_ID
			,'' AS SACTV_NM
			,'' AS CITM_CD
			,'' AS CITM_NM
			,SUM(D1.ALC_TAMT) AS ALC_TAMT
			,SUM(D1.BDG_ALAMT) AS BDG_ALAMT
			,SUM(D1.RE_ALAMT) AS RE_ALAMT
			,SUM(D1.BZ_ALC_AMT) AS BZ_ALC_AMT
			,SUM(D1.OACT_AMT) AS OACT_AMT
			,SUM(D1.EPRS_AMT) AS EPRS_AMT
			,SUM(D1.NPBF_AMT) AS NPBF_AMT
		</isEqual>
		<isEqual property="strSearchSum" compareValue="3"><!-- 검색조건 지출목 -->
			D1.FSCL_YY
			,D1.BZ_ID
			,'['||D1.SACTV_CD||'] '||D2.SACTV_NM AS SACTV_NM
			,D1.CITM_CD
			,'['||D1.CITM_CD||'] '||D3.CITM_NM AS CITM_NM
			,SUM(D1.ALC_TAMT) AS ALC_TAMT
			,SUM(D1.BDG_ALAMT) AS BDG_ALAMT
			,SUM(D1.RE_ALAMT) AS RE_ALAMT
			,SUM(D1.BZ_ALC_AMT) AS BZ_ALC_AMT
			,SUM(D1.OACT_AMT) AS OACT_AMT
			,SUM(D1.EPRS_AMT) AS EPRS_AMT
			,SUM(D1.NPBF_AMT) AS NPBF_AMT
		</isEqual>
		FROM DWMGR.TB_BMBQ301 D1
		<isNotEqual property="strSearchSum" compareValue="2"><!-- 검색조건이 회계연도가 아닌경우 -->
		LEFT OUTER JOIN DWMGR.TB_BIBM071 D2
		  ON D2.FSCL_YY = D1.FSCL_YY
		 AND D2.BZ_ID = D1.BZ_ID
		 AND D2.FLD_CD = D1.FLD_CD
		 AND D2.SECT_CD = D1.SECT_CD
		 AND D2.PGM_CD = D1.PGM_CD
		 AND D2.ACTV_CD = D1.ACTV_CD
		 AND D2.SACTV_CD = D1.SACTV_CD
		 AND D2.CITM_CD = D1.CITM_CD
		 AND D2.EITM_CD = D1.EITM_CD
		LEFT OUTER JOIN DWMGR.TB_BIBM051 D3
		  ON D1.CITM_CD = D3.CITM_CD
		 AND D1.FSCL_YY = D3.FSCL_YY
		</isNotEqual>
		WHERE 1=1
		<isEqual property="strSubFsclYy" compareValue="1"><!-- 회계연도만 -->
		  AND D1.FSCL_YY = #strMainFsclYy# 
		</isEqual>
		<isEqual property="strSubFsclYy" compareValue="2"><!-- 회계연도이전만 -->
		 <![CDATA[AND D1.FSCL_YY <= #strMainFsclYy# ]]>
		</isEqual>
		<isEqual property="strSubFsclYy" compareValue="3"><!-- 회계연도이후만 -->
		 <![CDATA[AND D1.FSCL_YY >= #strMainFsclYy# ]]>
		</isEqual>
		  AND D1.BZ_ID = #strMainBzId#
		<isEqual property="strSearchSum" compareValue="1"><!-- 검색조건 전체 -->
		ORDER BY 1,3,4
		</isEqual>
		<isEqual property="strSearchSum" compareValue="2"><!-- 검색조건 회계연도 -->
		GROUP BY D1.FSCL_YY
		ORDER BY 1
		</isEqual>
		<isEqual property="strSearchSum" compareValue="3"><!-- 검색조건 지출목 -->
		GROUP BY D1.FSCL_YY, D1.BZ_ID, SACTV_NM, D1.CITM_CD, CITM_NM
		ORDER BY 1,3,4
		</isEqual>
	</select>
	
	<select id="FAABCG288ESub2select" parameterClass="paramMap"	resultClass="resultMap">
		     SELECT D1.FSCL_YY
					,D1.BZ_ID
					,D1.OFFC_CD
					,'['||D1.SACTV_CD||'] '||D3.SACTV_NM AS SACTV_NM
					,D1.CITM_CD
					,'['||D1.CITM_CD||'] '||D2.CITM_NM AS CITM_NM
					,D1.OACT_NO
					,D1.FGO_CD
					,SUM(D1.OACT_AMT) AS OACT_AMT
					,SUM(D1.DDT_SUMAMT) AS DDT_SUMAMT1
					,D4.OACT_INM
					,SUM(D7.EPRS_AMT) AS EPRS_AMT
				    ,SUM(D7.DDT_SUMAMT) AS DDT_SUMAMT2
				    ,SUM(D7.FT_AMT)     AS FT_AMT
			   FROM DWMGR.TB_EMEP202 D1
    LEFT OUTER JOIN DWMGR.TB_BIBM071 D2
				 ON  D2.FSCL_YY = D1.FSCL_YY
				AND D2.BZ_ID = D1.BZ_ID
				AND D2.FLD_CD = D1.FLD_CD
				AND D2.SECT_CD = D1.SECT_CD
				AND D2.PGM_CD = D1.PGM_CD
				AND D2.ACTV_CD = D1.ACTV_CD
				AND D2.SACTV_CD = D1.SACTV_CD
				AND D2.CITM_CD = D1.CITM_CD
				AND D2.EITM_CD = D1.EITM_CD
	LEFT OUTER JOIN DWMGR.TB_BIBM071 D3
				 ON  D3.FSCL_YY = D1.FSCL_YY
				AND D3.BZ_ID = D1.BZ_ID
				AND D3.FLD_CD = D1.FLD_CD
				AND D3.SECT_CD = D1.SECT_CD
				AND D3.PGM_CD = D1.PGM_CD
				AND D3.ACTV_CD = D1.ACTV_CD
				AND D3.SACTV_CD = D1.SACTV_CD
				AND D3.CITM_CD = D1.CITM_CD
				AND D3.EITM_CD = D1.EITM_CD       
	     INNER JOIN DWMGR.TB_EMEP201 D4
				 ON D1.FSCL_YY = D4.FSCL_YY
				AND D1.OFFC_CD = D4.OFFC_CD	
				AND D1.FGO_CD = D4.FGO_CD
				AND D1.OACT_NO = D4.OACT_NO
       	 INNER JOIN (
					 SELECT D6.EPRS_AMT,
				            D6.DDT_SUMAMT,
				            D6.FT_AMT,
				            D5.FSCL_YY,
				            D5.OFFC_CD,
				            D6.BZ_ID,
				            D6.CITM_CD,
				            D5.OACT_NO,
				            D6.SACTV_CD,
				            D5.FGO_CD
					   FROM DWMGR.TB_EMEP301 D5
				    	    ,DWMGR.TB_EMEP302 D6
					  WHERE 1=1
					    AND D5.FSCL_YY = D6.FSCL_YY
				        AND D5.OFFC_CD = D6.OFFC_CD
					    AND D5.EPRS_NO = D6.EPRS_NO
					    AND D5.FGO_CD  = D6.FGO_CD	
				    ) D7
				 ON D1.FSCL_YY = D7.FSCL_YY
				AND D1.BZ_ID = D7.BZ_ID
				AND D1.OFFC_CD = D7.OFFC_CD
				AND D1.SACTV_CD = D7.SACTV_CD
				AND D1.CITM_CD = D7.CITM_CD
				AND D1.OACT_NO = D7.OACT_NO
			  WHERE  1=1
				AND D1.FSCL_YY = #strSub1FsclYy#
			    AND D1.BZ_ID = #strSub1BzId#
				AND D1.CITM_CD = #strSub1CitmCd#
	   	   GROUP BY D1.FSCL_YY, D1.BZ_ID, D1.OFFC_CD, SACTV_NM, D1.CITM_CD,CITM_NM, D1.OACT_NO, D1.FGO_CD, OACT_INM
	</select>
	
	<select id="FAABCG288ESub3select" parameterClass="paramMap"	resultClass="resultMap">
		     SELECT D1.FSCL_YY
					,'['||D1.EITM_CD||'] '||D2.EITM_NM AS EITM_NM
					,D1.EPRS_NO
					,D3.OACT_NO
					,D1.EPRS_AMT
					,D1.DDT_SUMAMT
					,D1.FT_AMT
					,D1.ACC_NO
					,CASE WHEN LENGTH(D1.ACC_RNNO) = 13 THEN SUBSTR(D1.ACC_RNNO, 1, 7) + '******' ELSE D1.ACC_RNNO  END  AS ACC_RNNO
				    ,D1.DPOR_NM
				    ,D1.FT_DT
			   FROM DWMGR.TB_EMEP302 D1
	LEFT OUTER JOIN DWMGR.TB_BIBM071 D2
				 ON  D2.fscl_yy = D1.fscl_yy
				AND D2.BZ_ID = D1.BZ_ID
			    AND D2.FLD_CD = D1.FLD_CD
				AND D2.SECT_CD = D1.SECT_CD
				AND D2.PGM_CD = D1.PGM_CD
				AND D2.ACTV_CD = D1.ACTV_CD
				AND D2.SACTV_CD = D1.SACTV_CD
				AND D2.CITM_CD = D1.CITM_CD
				AND D2.EITM_CD = D1.EITM_CD    
				    ,DWMGR.TB_EMEP301 D3
			  WHERE 1=1 
				AND D1.OFFC_CD = D3.OFFC_CD
				AND D1.FSCL_YY = D3.FSCL_YY
				AND D1.FGO_CD  = D3.FGO_CD
				AND D1.EPRS_NO = D3.EPRS_NO
				AND D1.BZ_ID = #strSub2BzId#
				AND D1.FSCL_YY = #strSub2FsclYy#
				AND D3.OACT_NO = #strSub2OactNo#
				AND D1.CITM_CD = #strSub2CitmCd#
	</select>
	
	<!--========================================================================================-->
	
	<!--거래처별 계약 목록 조회-->
	<select id="FAABCG290EMainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[ 
			SELECT C.FSCL_YY 								AS FSCL_YY
				 ,'['||C.OFFC_CD||'] '||C.OFFC_NM 			AS OFFC_CD_NM
				 ,C.BZ_ID                   				AS BIZ_ID
				 ,C.CTR_MG_NO 								AS CTR_MG_NO
				 ,C.CTR_NM 									AS CTR_NM
				 ,C.CLT_NM 									AS CLT_NM
				 ,C.CLT_RNNO 								AS CLT_RNNO
				 ,C.ITG_DTS_CD_NM 							AS CTR_WAY
				 ,C.CLT_CD
			 FROM (
				 SELECT D1.FSCL_YY
					   ,D1.OFFC_CD
					   ,ISNULL(D3.OFFC_NM, '')       		AS  OFFC_NM
					   ,D1.BZ_ID
					   ,D1.CTR_MG_NO
					   ,D1.CTR_NM
					   ,D1.CLT_NM
					   ,D1.CLT_RNNO
					   ,ISNULL(D2.ITG_DTS_CD_NM, '') 		AS ITG_DTS_CD_NM
					   ,D1.CLT_CD
				   FROM DWMGR.TB_NPAQ300 D1
	    LEFT OUTER JOIN DWMGR.TB_BICD102 D2
				     ON D2.ITG_CLS_CD = 'NP105'  
				    AND D2.ITG_DTS_CD = D1.CTR_MTH_CD      
	    LEFT OUTER JOIN DWMGR.TB_BICD011 D3
				     ON D3.OFFC_CD = D1.OFFC_CD
				  WHERE D1.DUT_PRG_STAT_CD IN ('800', '810')
				    AND D1.NEW_CHG_DIV_CD <> '9'
				    AND D1.DEL_YN = 'N'
			]]>
					<isNotEmpty property="strFsclYySt">
						<![CDATA[AND D1.FSCL_YY >=]]> #strFsclYySt#
					</isNotEmpty>
					<isNotEmpty property="strFsclYyEd">
						<![CDATA[AND D1.FSCL_YY <=]]> #strFsclYyEd#
					</isNotEmpty>
					<isNotEmpty property="strFsclCd">
						AND D1.FSCL_CD = #strFsclCd#
					</isNotEmpty>
					<isNotEmpty property="strOffcCd">
						AND D1.OFFC_CD = #strOffcCd#
					</isNotEmpty>
					<isNotEmpty property="strCltNo">
						AND (SELECT dg_decrypt('TB_ENC', 'EIN', D1.CLT_RNNO)) LIKE '%'||#strCltNo#||'%'
					</isNotEmpty>
			    ) C
			    ,DWMGR.TB_BICD051 D4
		    WHERE C.CLT_CD = D4.CLT_CD
			<isNotEmpty property="strCltNm">	
				AND D4.CLT_NM LIKE '%'||#strCltNm#||'%'
			</isNotEmpty>
			ORDER BY FSCL_YY, OFFC_CD_NM, BIZ_ID, CTR_MG_NO
	</select>
	
	<select id="FAABCG290EYearselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT D1.Y_CD AS FSCL_YY
		  FROM DWMGR.IT_DWCOMM001 D1
		 ORDER BY 1
	</select>
	
	<select id="FAABCG290EFsclselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
		     SELECT DISTINCT D1.FSCL_CD
			        ,'['||D1.FSCL_CD||'] '||ISNULL(D2.FSCL_NM, '') AS  FSCL_NM
		       FROM DWMGR.TB_NPAQ300 D1
	LEFT OUTER JOIN DWMGR.TB_BICD001 D2
		         ON D2.FSCL_CD = D1.FSCL_CD
		      WHERE 1=1
		]]>
		<isNotEmpty property="strFsclYySt">
			<isEmpty property="strFsclYyEd">
	 			AND D1.FSCL_YY = #strFsclYySt#
			</isEmpty>
			<isNotEmpty property="strFsclYyEd">
	 			AND D1.FSCL_YY BETWEEN #strFsclYySt# AND #strFsclYyEd# 
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty property="strFsclYyEd">
			    AND D1.FSCL_YY = #strFsclYyEd#
		</isNotEmpty>
		<isNotEmpty property="strOffcCd">
		    	AND D1.OFFC_CD = #strOffcCd#
		</isNotEmpty>
		   ORDER BY 1
	</select>
	
	<select id="FAABCG290EOffcselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT DISTINCT A.OFFC_CD AS OFFC_CD, 
			       '['||A.OFFC_CD||'] '||ISNULL(A.OFFC_NM, '') AS  OFFC_NM
			  FROM DWMGR.TB_BICD011 A,
			       DWMGR.TB_BICD014 B
			 WHERE A.OFFC_CD = B.OFFC_CD
		]]>
		<isNotEmpty property="strFsclYySt">
			<isEmpty property="strFsclYyEd">
	 			AND B.FSCL_YY = #strFsclYySt#
			</isEmpty>
			<isNotEmpty property="strFsclYyEd">
	 			AND B.FSCL_YY BETWEEN #strFsclYySt# AND #strFsclYyEd# 
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty property="strFsclYyEd">
				AND B.FSCL_YY = #strFsclYyEd#
		</isNotEmpty>
		   ORDER BY SUBSTRING(OFFC_NM,6)
	</select>
	
	<select id="FAABCG290EDetlselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT CTR_MG_NO
				  ,CTR_MG_CNU
				  ,AST_NM
				  ,GAG_NM
				  ,CTR_QTY
				  ,CTR_UCOST
				  ,CTR_AMT
				  ,SPLY_DLN
			  FROM DWMGR.TB_NPAQ310
			 WHERE CTR_MG_NO = #strCtrMgNo#
		]]>
	</select>
	
	<select id="FAABCG290EBzInfoselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT BZ_ID
				  ,BZ_NM
				  ,BZ_PURP_EPL
				  ,BZ_PFM_SUJ_NM
				  ,DRIVE_PTC_EPL
			  FROM DWMGR.TB_PMPR005
			 WHERE FSCL_YY = #strFsclYy#
			   AND BZ_ID = #strBzId#
		]]>
	</select>
	
	<!-- ======================================================================================= -->
	
	<select id="FAABCG287EMainselect" parameterClass="paramMap"	resultClass="resultMap">
		     SELECT D1.FSCL_YY
					,'['||D3.OFFC_CD||'] '||D4.OFFC_NM AS OFFC_CD
					,'['||D1.FSCL_CD||'] '||D5.FSCL_NM AS FSCL_CD
					,D1.BZ_ID
					,D1.BZ_NM
					,'['||D1.BZ_TY_CD||'] '||D2.ITG_DTS_CD_NM AS BZ_TY_CD
			   FROM DWMGR.TB_PMPR005 D1
	LEFT OUTER JOIN DWMGR.TB_BICD102 D2
	 			 ON D2.ITG_CLS_CD = 'PM002'
				AND D1.BZ_TY_CD = D2.ITG_DTS_CD
	LEFT OUTER JOIN DWMGR.TB_BIBM021 D3
				 ON D1.FSCL_YY = D3.FSCL_YY
				AND D1.BZ_ID = D3.BZ_ID
	LEFT OUTER JOIN DWMGR.TB_BICD011 D4
				 ON D3.OFFC_CD = D4.OFFC_CD
	LEFT OUTER JOIN DWMGR.TB_BICD001 D5
				 ON D1.FSCL_CD = D5.FSCL_CD
			  WHERE 1=1
			<isNotEmpty property="strFsclYy">			   
			    AND D1.FSCL_YY = #strFsclYy#
			</isNotEmpty>
			<isNotEmpty property="strOffcCd">			   
			    AND D3.OFFC_CD = #strOffcCd#
			</isNotEmpty>
			<isNotEmpty property="strFsclCd">			   
			    AND D1.FSCL_CD = #strFsclCd#
			</isNotEmpty>
			<isNotEmpty property="strBzId">
				AND D1.BZ_ID = #strBzId#
			</isNotEmpty>
			<isNotEmpty property="strBzNm">
				AND D1.BZ_NM LIKE '%'||#strBzNm#||'%'
			</isNotEmpty>
				AND D1.PERM_STAT_CD = '102'      
	</select>
	
	<select id="FAABCG287EFSCLYYselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
		      SELECT DISTINCT D1.FSCL_YY AS FSCL_YY                
				FROM DWMGR.TB_PMPR005 D1
	 LEFT OUTER JOIN DWMGR.TB_BIBM021 D2
				  ON D1.FSCL_YY = D2.FSCL_YY
				 AND D1.BZ_ID = D2.BZ_ID
			   WHERE D1.PERM_STAT_CD = '102'
			     AND D1.FSCL_YY > '2008'    
				]]>
				<isNotEmpty property="strFsclCd">
				AND D1.FSCL_CD = #strFsclCd#
				</isNotEmpty>
				<isNotEmpty property="strOffcCd">
				AND D2.OFFC_CD = #strOffcCd#
				</isNotEmpty>
		   ORDER BY FSCL_YY
	</select>
	
	<select id="FAABCG287EFSCLCDselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
		      SELECT DISTINCT D1.FSCL_CD AS FSCL_CD
					 ,'['||D1.FSCL_CD||'] '||D3.FSCL_NM AS FSCL_NM                
				FROM DWMGR.TB_PMPR005 D1
	 LEFT OUTER JOIN DWMGR.TB_BIBM021 D2
				  ON D1.FSCL_YY = D2.FSCL_YY
				 AND D1.BZ_ID = D2.BZ_ID			
	 LEFT OUTER JOIN DWMGR.TB_BICD001 D3
				  ON D1.FSCL_CD = D3.FSCL_CD
			   WHERE D1.PERM_STAT_CD = '102'    
			     AND D1.FSCL_CD IS NOT NULL
				 AND D1.FSCL_CD NOT LIKE '% %'
				]]>
				<isNotEmpty property="strFsclYy">
				 AND D1.FSCL_YY = #strFsclYy#
				</isNotEmpty>
				<isNotEmpty property="strOffcCd">
				 AND D2.OFFC_CD = #strOffcCd#
				</isNotEmpty>
		       ORDER BY FSCL_CD
	</select>

	<select id="FAABCG287EOFFCCDselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
	        SELECT DISTINCT	D2.OFFC_CD AS OFFC_CD
				   ,'['||D2.OFFC_CD||'] '||D3.OFFC_NM AS OFFC_NM                
			  FROM DWMGR.TB_PMPR005 D1
   LEFT OUTER JOIN DWMGR.TB_BIBM021 D2
			    ON D1.FSCL_YY = D2.FSCL_YY
			   AND D1.BZ_ID = D2.BZ_ID
   LEFT OUTER JOIN DWMGR.TB_BICD011 D3
			    ON D3.OFFC_CD = D2.OFFC_CD 
		 	 WHERE D1.PERM_STAT_CD = '102' 
		 	   AND D2.OFFC_CD IS NOT NULL
			   AND D2.OFFC_CD NOT LIKE '% %'
			]]>
			<isNotEmpty property="strFsclYy">
			   AND D1.FSCL_YY = #strFsclYy#
			</isNotEmpty>
			<isNotEmpty property="strFsclCd">
			   AND D1.FSCL_CD = #strFsclCd#
			</isNotEmpty>
		  ORDER BY SUBSTRING(OFFC_NM,6)
	</select>

	<select id="FAABCG287EDetail1select" parameterClass="paramMap"	resultClass="resultMap">
		     SELECT D1.BZ_ID
					,D1.BZ_NM
					,D1.BZ_PURP_EPL
					,D1.BZ_PFM_SUJ_NM
					,D1.DRIVE_PTC_EPL
					,D1.BZ_OPER_BAS_DRC_EPL
					,D1.SUPPT_GRND_EPL
					,D1.BZ_PERI_B_DT||' ~ '||D1.BZ_PERI_EDT AS BZ_PERI_DT
					,D1.BZ_SCAL_EPL
			   FROM DWMGR.TB_PMPR005 D1
	LEFT OUTER JOIN DWMGR.TB_BIBM021 D3
				 ON D1.FSCL_YY = D3.FSCL_YY
				AND D1.BZ_ID = D3.BZ_ID
			<isNotEmpty property="strBzId">
			  WHERE D1.BZ_ID = #strBzId#
			</isNotEmpty>
			<isNotEmpty property="strBzId">
			  	AND D1.FSCL_YY = #strFsclYy#
			</isNotEmpty>
			<isNotEmpty property="strOffcCd">			   
			    AND D3.OFFC_CD = #strOffcCd#
			</isNotEmpty>
			<isNotEmpty property="strFsclCd">			   
			    AND D1.FSCL_CD = #strFsclCd#
			</isNotEmpty>
	</select>

	<select id="FAABCG287ESub1select" parameterClass="paramMap"	resultClass="resultMap">
        SELECT 
        <isEqual property="strSearchSum" compareValue="1"><!-- 검색조건 전체 -->
			D1.FSCL_YY
			,D1.BZ_ID
			,'['||D1.SACTV_CD||'] '||D2.SACTV_NM AS SACTV_NM
			,D1.CITM_CD
			,'['||D1.CITM_CD||'] '||D3.CITM_NM AS CITM_NM
			,D1.ALC_TAMT AS ALC_TAMT 
			,D1.BDG_ALAMT AS BDG_ALAMT
			,D1.RE_ALAMT AS RE_ALAMT
			,D1.BZ_ALC_AMT AS BZ_ALC_AMT
			,D1.OACT_AMT AS OACT_AMT
			,D1.EPRS_AMT AS EPRS_AMT
			,D1.NPBF_AMT AS NPBF_AMT
		</isEqual>
		<isEqual property="strSearchSum" compareValue="2"><!-- 검색조건 회계연도 -->
			D1.FSCL_YY
			,'' AS BZ_ID
			,'' AS SACTV_NM
			,'' AS CITM_CD
			,'' AS CITM_NM
			,SUM(D1.ALC_TAMT) AS ALC_TAMT
			,SUM(D1.BDG_ALAMT) AS BDG_ALAMT
			,SUM(D1.RE_ALAMT) AS RE_ALAMT
			,SUM(D1.BZ_ALC_AMT) AS BZ_ALC_AMT
			,SUM(D1.OACT_AMT) AS OACT_AMT
			,SUM(D1.EPRS_AMT) AS EPRS_AMT
			,SUM(D1.NPBF_AMT) AS NPBF_AMT
		</isEqual>
		<isEqual property="strSearchSum" compareValue="3"><!-- 검색조건 지출목 -->
			D1.FSCL_YY
			,D1.BZ_ID
			,'['||D1.SACTV_CD||'] '||D2.SACTV_NM AS SACTV_NM
			,D1.CITM_CD
			,'['||D1.CITM_CD||'] '||D3.CITM_NM AS CITM_NM
			,SUM(D1.ALC_TAMT) AS ALC_TAMT
			,SUM(D1.BDG_ALAMT) AS BDG_ALAMT
			,SUM(D1.RE_ALAMT) AS RE_ALAMT
			,SUM(D1.BZ_ALC_AMT) AS BZ_ALC_AMT
			,SUM(D1.OACT_AMT) AS OACT_AMT
			,SUM(D1.EPRS_AMT) AS EPRS_AMT
			,SUM(D1.NPBF_AMT) AS NPBF_AMT
		</isEqual>
		FROM DWMGR.TB_BMBQ301 D1
		<isNotEqual property="strSearchSum" compareValue="2"><!-- 검색조건이 회계연도가 아닌경우 -->
		LEFT OUTER JOIN DWMGR.TB_BIBM071 D2
		  ON D2.FSCL_YY = D1.FSCL_YY
		 AND D2.BZ_ID = D1.BZ_ID
		 AND D2.FLD_CD = D1.FLD_CD
		 AND D2.SECT_CD = D1.SECT_CD
		 AND D2.PGM_CD = D1.PGM_CD
		 AND D2.ACTV_CD = D1.ACTV_CD
		 AND D2.SACTV_CD = D1.SACTV_CD
		 AND D2.CITM_CD = D1.CITM_CD
		 AND D2.EITM_CD = D1.EITM_CD
		LEFT OUTER JOIN DWMGR.TB_BIBM051 D3
		  ON D1.CITM_CD = D3.CITM_CD
		 AND D1.FSCL_YY = D3.FSCL_YY
		</isNotEqual>
		WHERE 1=1
		<isEqual property="strSubFsclYy" compareValue="1"><!-- 회계연도만 -->
		  AND D1.FSCL_YY = #strMainFsclYy# 
		</isEqual>
		<isEqual property="strSubFsclYy" compareValue="2"><!-- 회계연도이전만 -->
		 <![CDATA[AND D1.FSCL_YY <= #strMainFsclYy# ]]>
		</isEqual>
		<isEqual property="strSubFsclYy" compareValue="3"><!-- 회계연도이후만 -->
		 <![CDATA[AND D1.FSCL_YY >= #strMainFsclYy# ]]>
		</isEqual>
		  AND D1.BZ_ID = #strMainBzId#
		<isEqual property="strSearchSum" compareValue="1"><!-- 검색조건 전체 -->
		ORDER BY 1,3,4
		</isEqual>
		<isEqual property="strSearchSum" compareValue="2"><!-- 검색조건 회계연도 -->
		GROUP BY D1.FSCL_YY
		ORDER BY 1
		</isEqual>
		<isEqual property="strSearchSum" compareValue="3"><!-- 검색조건 지출목 -->
		GROUP BY D1.FSCL_YY, D1.BZ_ID, SACTV_NM, D1.CITM_CD, CITM_NM
		ORDER BY 1,3,4
		</isEqual>
	</select>
	
	<select id="FAABCG287ESub2select" parameterClass="paramMap"	resultClass="resultMap">
		     SELECT D1.FSCL_YY
					,D1.BZ_ID
					,D1.OFFC_CD
					,'['||D1.SACTV_CD||'] '||D3.SACTV_NM AS SACTV_NM
					,D1.CITM_CD
					,'['||D1.CITM_CD||'] '||D2.CITM_NM AS CITM_NM
					,D1.OACT_NO
					,D1.FGO_CD
					,SUM(D1.OACT_AMT) AS OACT_AMT
					,SUM(D1.DDT_SUMAMT) AS DDT_SUMAMT1
					,D4.OACT_INM
					,SUM(D7.EPRS_AMT) AS EPRS_AMT
				    ,SUM(D7.DDT_SUMAMT) AS DDT_SUMAMT2
				    ,SUM(D7.FT_AMT)     AS FT_AMT
			   FROM DWMGR.TB_EMEP202 D1
    LEFT OUTER JOIN DWMGR.TB_BIBM071 D2
				 ON  D2.FSCL_YY = D1.FSCL_YY
				AND D2.BZ_ID = D1.BZ_ID
				AND D2.FLD_CD = D1.FLD_CD
				AND D2.SECT_CD = D1.SECT_CD
				AND D2.PGM_CD = D1.PGM_CD
				AND D2.ACTV_CD = D1.ACTV_CD
				AND D2.SACTV_CD = D1.SACTV_CD
				AND D2.CITM_CD = D1.CITM_CD
				AND D2.EITM_CD = D1.EITM_CD
	LEFT OUTER JOIN DWMGR.TB_BIBM071 D3
				 ON  D3.FSCL_YY = D1.FSCL_YY
				AND D3.BZ_ID = D1.BZ_ID
				AND D3.FLD_CD = D1.FLD_CD
				AND D3.SECT_CD = D1.SECT_CD
				AND D3.PGM_CD = D1.PGM_CD
				AND D3.ACTV_CD = D1.ACTV_CD
				AND D3.SACTV_CD = D1.SACTV_CD
				AND D3.CITM_CD = D1.CITM_CD
				AND D3.EITM_CD = D1.EITM_CD       
	     INNER JOIN DWMGR.TB_EMEP201 D4
				 ON D1.FSCL_YY = D4.FSCL_YY
				AND D1.OFFC_CD = D4.OFFC_CD	
				AND D1.FGO_CD = D4.FGO_CD
				AND D1.OACT_NO = D4.OACT_NO
       	 INNER JOIN (
					 SELECT D6.EPRS_AMT,
				            D6.DDT_SUMAMT,
				            D6.FT_AMT,
				            D5.FSCL_YY,
				            D5.OFFC_CD,
				            D6.BZ_ID,
				            D6.CITM_CD,
				            D5.OACT_NO,
				            D6.SACTV_CD,
				            D5.FGO_CD
					   FROM DWMGR.TB_EMEP301 D5
				    	    ,DWMGR.TB_EMEP302 D6
					  WHERE 1=1
					    AND D5.FSCL_YY = D6.FSCL_YY
				        AND D5.OFFC_CD = D6.OFFC_CD
					    AND D5.EPRS_NO = D6.EPRS_NO
					    AND D5.FGO_CD  = D6.FGO_CD	
				    ) D7
				 ON D1.FSCL_YY = D7.FSCL_YY
				AND D1.BZ_ID = D7.BZ_ID
				AND D1.OFFC_CD = D7.OFFC_CD
				AND D1.SACTV_CD = D7.SACTV_CD
				AND D1.CITM_CD = D7.CITM_CD
				AND D1.OACT_NO = D7.OACT_NO
			  WHERE  1=1
				AND D1.FSCL_YY = #strSub1FsclYy#
			    AND D1.BZ_ID = #strSub1BzId#
				AND D1.CITM_CD = #strSub1CitmCd#
	   	   GROUP BY D1.FSCL_YY, D1.BZ_ID, D1.OFFC_CD, SACTV_NM, D1.CITM_CD,CITM_NM, D1.OACT_NO, D1.FGO_CD, OACT_INM
	</select>
	
	<select id="FAABCG287ESub3select" parameterClass="paramMap"	resultClass="resultMap">
		     SELECT D1.FSCL_YY
					,'['||D1.EITM_CD||'] '||D2.EITM_NM AS EITM_NM
					,D1.EPRS_NO
					,D3.OACT_NO
					,D1.EPRS_AMT
					,D1.DDT_SUMAMT
					,D1.FT_AMT
					,D1.ACC_NO
					,CASE WHEN LENGTH(D1.ACC_RNNO) = 13 THEN SUBSTR(D1.ACC_RNNO, 1, 7) + '******' ELSE D1.ACC_RNNO  END  AS ACC_RNNO
				    ,D1.DPOR_NM
				    ,D1.FT_DT
			   FROM DWMGR.TB_EMEP302 D1
	LEFT OUTER JOIN DWMGR.TB_BIBM071 D2
				 ON  D2.fscl_yy = D1.fscl_yy
				AND D2.BZ_ID = D1.BZ_ID
			    AND D2.FLD_CD = D1.FLD_CD
				AND D2.SECT_CD = D1.SECT_CD
				AND D2.PGM_CD = D1.PGM_CD
				AND D2.ACTV_CD = D1.ACTV_CD
				AND D2.SACTV_CD = D1.SACTV_CD
				AND D2.CITM_CD = D1.CITM_CD
				AND D2.EITM_CD = D1.EITM_CD    
				    ,DWMGR.TB_EMEP301 D3
			  WHERE 1=1 
				AND D1.OFFC_CD = D3.OFFC_CD
				AND D1.FSCL_YY = D3.FSCL_YY
				AND D1.FGO_CD  = D3.FGO_CD
				AND D1.EPRS_NO = D3.EPRS_NO
				AND D1.BZ_ID = #strSub2BzId#
				AND D1.FSCL_YY = #strSub2FsclYy#
				AND D3.OACT_NO = #strSub2OactNo#
				AND D1.CITM_CD = #strSub2CitmCd#
	</select>
	
	<!-- ========================================================================================= -->
	
	<select id="FAABCG289EFSCLYYselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
		      SELECT DISTINCT D1.FSCL_YY AS FSCL_YY                
				FROM DWMGR.TB_PMPR005 D1
		  INNER JOIN DWMGR.TB_NPAQ300 D2
		  		  ON D1.FSCL_YY = D2.FSCL_YY
		  		 AND D1.BZ_ID = D2.BZ_ID
	 LEFT OUTER JOIN DWMGR.TB_BIBM021 D3
				  ON D1.FSCL_YY = D3.FSCL_YY
				 AND D1.BZ_ID = D3.BZ_ID
			   WHERE D2.DUT_PRG_STAT_CD IN ('800', '810')
				 AND D2.NEW_CHG_DIV_CD <> '9'
				 AND D2.DEL_YN = 'N'
				 AND D2.CTR_TY_CD  IN ('A13', 'A14', 'A15', 'A16')
				 AND D1.FSCL_YY > '2008'      
				]]>
				<isNotEmpty property="strFsclCd">
				AND D1.FSCL_CD = #strFsclCd#
				</isNotEmpty>
				<isNotEmpty property="strOffcCd">
				AND D3.OFFC_CD = #strOffcCd#
				</isNotEmpty>
		   ORDER BY FSCL_YY
	</select>
	
	<select id="FAABCG289EFSCLCDselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
		      SELECT DISTINCT D1.FSCL_CD AS FSCL_CD
					 ,'['||D1.FSCL_CD||'] '||D4.FSCL_NM AS FSCL_NM                
				FROM DWMGR.TB_PMPR005 D1
		  INNER JOIN DWMGR.TB_NPAQ300 D2
		  		  ON D1.FSCL_YY = D2.FSCL_YY
		  		 AND D1.BZ_ID = D2.BZ_ID
	 LEFT OUTER JOIN DWMGR.TB_BIBM021 D3
				  ON D1.FSCL_YY = D3.FSCL_YY
				 AND D1.BZ_ID = D3.BZ_ID			
	 LEFT OUTER JOIN DWMGR.TB_BICD001 D4
				  ON D1.FSCL_CD = D4.FSCL_CD
			   WHERE D2.DUT_PRG_STAT_CD IN ('800', '810')
				 AND D2.NEW_CHG_DIV_CD <> '9'
				 AND D2.DEL_YN = 'N'
				 AND D2.CTR_TY_CD  IN ('A13', 'A14', 'A15', 'A16')      
				 AND D1.FSCL_CD IS NOT NULL
				 AND D1.FSCL_CD NOT LIKE '% %'
				]]>
				<isNotEmpty property="strFsclYy">
				 AND D1.FSCL_YY = #strFsclYy#
				</isNotEmpty>
				<isNotEmpty property="strOffcCd">
				 AND D3.OFFC_CD = #strOffcCd#
				</isNotEmpty>
		       ORDER BY FSCL_CD
	</select>

	<select id="FAABCG289EOFFCCDselect" parameterClass="paramMap"	resultClass="resultMap">
        <![CDATA[       
	        SELECT DISTINCT	D3.OFFC_CD AS OFFC_CD
				   ,'['||D3.OFFC_CD||'] '||D4.OFFC_NM AS OFFC_NM                
			  FROM DWMGR.TB_PMPR005 D1
		INNER JOIN DWMGR.TB_NPAQ300 D2
		        ON D1.FSCL_YY = D2.FSCL_YY
		  	   AND D1.BZ_ID = D2.BZ_ID
   LEFT OUTER JOIN DWMGR.TB_BIBM021 D3
			    ON D1.FSCL_YY = D3.FSCL_YY
			   AND D1.BZ_ID = D3.BZ_ID
   LEFT OUTER JOIN DWMGR.TB_BICD011 D4
			    ON D4.OFFC_CD = D3.OFFC_CD 
		 	 WHERE D2.DUT_PRG_STAT_CD IN ('800', '810')
			   AND D2.NEW_CHG_DIV_CD <> '9'
			   AND D2.DEL_YN = 'N'
			   AND D2.CTR_TY_CD  IN ('A13', 'A14', 'A15', 'A16')  
			   AND D3.OFFC_CD IS NOT NULL
			   AND D3.OFFC_CD NOT LIKE '% %'
			]]>
			<isNotEmpty property="strFsclYy">
			   AND D1.FSCL_YY = #strFsclYy#
			</isNotEmpty>
			<isNotEmpty property="strFsclCd">
			   AND D1.FSCL_CD = #strFsclCd#
			</isNotEmpty>
		  ORDER BY SUBSTRING(OFFC_NM,6)
	</select>
	
	<select id="FAABCG289EMainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT D1.FSCL_YY AS FSCL_YY
				   ,'['||D3.FSCL_CD||'] '||D5.FSCL_NM AS FSCL_CD_NM
				   ,'['||D3.OFFC_CD||'] '||D4.OFFC_NM AS OFFC_CD_NM
				   ,D1.BZ_ID AS BIZ_ID
				   ,D2.CTR_MG_NO AS CTR_MG_NO
				   ,D2.CTR_NM AS CTR_NM
				   ,D1.BZ_NM AS BZ_NM
			  FROM DWMGR.TB_PMPR005    D1
		INNER JOIN DWMGR.TB_NPAQ300    D2
				ON D1.FSCL_YY = D2.FSCL_YY
			   AND D1.BZ_ID = D2.BZ_ID
   LEFT OUTER JOIN DWMGR.TB_BIBM021 D3
				ON D1.FSCL_YY = D3.FSCL_YY
  			   AND D1.BZ_ID = D3.BZ_ID
   LEFT OUTER JOIN DWMGR.TB_BICD011 D4
				ON D3.OFFC_CD = D4.OFFC_CD
   LEFT OUTER JOIN DWMGR.TB_BICD001 D5
				ON D3.FSCL_CD = D5.FSCL_CD
			 WHERE D2.DUT_PRG_STAT_CD IN ('800', '810')
			   AND D2.NEW_CHG_DIV_CD <> '9'
			   AND D2.DEL_YN = 'N'
			   AND D2.CTR_TY_CD  IN ('A13', 'A14', 'A15', 'A16')
		]]>
			<isNotEmpty property="strFsclYy">
			   AND D1.FSCL_YY = #strFsclYy#
			</isNotEmpty>
			<isNotEmpty property="strFsclCd">
			   AND D3.FSCL_CD = #strFsclCd#
			</isNotEmpty>
			<isNotEmpty property="strOffcCd">
			   AND D3.OFFC_CD = #strOffcCd#
			</isNotEmpty>
			<isNotEmpty property="strCtrBzNm">
			   AND (D2.CTR_NM LIKE '%'||#strCtrBzNm#||'%' OR D1.BZ_NM LIKE '%'||#strCtrBzNm#||'%')
			</isNotEmpty>
	</select>
	
	<select id="FAABCG289EDetlselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
		SELECT MAX(D1.BZ_ID) AS BZ_ID
			   ,D1.BZ_NM AS BZ_NM
			   ,D1.BZ_PURP_EPL AS BZ_PURP_EPL
			   ,D1.BZ_PFM_SUJ_NM AS BZ_PFM_SUJ_NM
			   ,D1.DRIVE_PTC_EPL AS DRIVE_PTC_EPL
			   ,D1.BZ_OPER_BAS_DRC_EPL AS BZ_OPER_BAS_DRC_EPL
			   ,D1.BZ_SCAL_EPL AS BZ_SCAL_EPL
			   ,D1.SUPPT_GRND_EPL AS SUPPT_GRND_EPL
			   ,D1.BZ_PERI_B_DT||' ~ '||D1.BZ_PERI_EDT AS BZ_PERI_DT
			   ,CAST(D1.TBCOST AS NUMERIC(22,0)) AS TBCOST
		  FROM DWMGR.TB_PMPR005 D1
	INNER JOIN DWMGR.TB_NPAQ300 D2    
			ON D1.FSCL_YY = D2.FSCL_YY
		   AND D1.BZ_ID = D2.BZ_ID
		 WHERE D2.DUT_PRG_STAT_CD IN ('800', '810')
		   AND D2.NEW_CHG_DIV_CD <> '9'
		   AND D2.DEL_YN = 'N'
		   AND D2.CTR_TY_CD  IN ('A13', 'A14', 'A15', 'A16')
		]]>
		   AND D1.BZ_ID = #strBzId# 
		   AND D1.FSCL_YY = #strFsclYy#
	  GROUP BY D1.BZ_NM,D1.BZ_PURP_EPL,D1.BZ_PFM_SUJ_NM,D1.DRIVE_PTC_EPL,D1.SUPPT_GRND_EPL,D1.TBCOST,D1.BZ_PERI_B_DT,D1.BZ_PERI_EDT,D1.BZ_OPER_BAS_DRC_EPL,D1.BZ_SCAL_EPL
	</select>
	
	<select id="FAABCG289ESubselect" parameterClass="paramMap" resultClass="resultMap">
          SELECT BZ_ID
                 ,BZ_NM
                 ,AMT_TYPE
                 ,AMT_CUR
                 ,AMT_NEXT
                 ,AMT_NEXT_NEXT
                 ,LEV
            FROM (
                 SELECT MAX(BZ_ID) AS BZ_ID
                        ,MAX(BZ_NM) AS BZ_NM
                        ,MAX(AMT_TYPE) AS AMT_TYPE
                        ,SUM(AMT_CUR) AS AMT_CUR
                        ,SUM(AMT_NEXT) AS AMT_NEXT
                        ,SUM(AMT_NEXT_NEXT) AS AMT_NEXT_NEXT
                        ,MAX(LEV) AS LEV
                   FROM (
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'buki' AS AMT_TYPE
			                    ,CASE WHEN SUM(D2.TOT_BOKP_AMT) IS NULL THEN 0 ELSE SUM(D2.TOT_BOKP_AMT) END AS AMT_CUR
			                    ,0 AS AMT_NEXT
			                    ,0 AS AMT_NEXT_NEXT
			                    ,1 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_NPAQ300 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                      UNION ALL
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'buki' AS AMT_TYPE
			                    ,0 AS AMT_CUR
			                    ,CASE WHEN SUM(D2.TOT_BOKP_AMT) IS NULL THEN 0 ELSE SUM(D2.TOT_BOKP_AMT) END AS AMT_NEXT
			                    ,0 AS AMT_NEXT_NEXT
			                    ,1 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_NPAQ300 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy_1#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                      UNION ALL
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'buki' AS AMT_TYPE
			                    ,0 AS AMT_CUR
			                    ,0 AS AMT_NEXT
			                    ,CASE WHEN SUM(D2.TOT_BOKP_AMT) IS NULL THEN 0 ELSE SUM(D2.TOT_BOKP_AMT) END AS AMT_NEXT_NEXT
			                    ,1 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_NPAQ300 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy_2#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                        ) D1
             UNION ALL
                 SELECT MAX(BZ_ID) AS BZ_ID
                        ,MAX(BZ_NM) AS BZ_NM
                        ,MAX(AMT_TYPE) AS AMT_TYPE
                        ,SUM(AMT_CUR) AS AMT_CUR
                        ,SUM(AMT_NEXT) AS AMT_NEXT
                        ,SUM(AMT_NEXT_NEXT) AS AMT_NEXT_NEXT
                        ,MAX(LEV) AS LEV
                   FROM (
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'ctr' AS AMT_TYPE
			                    ,CASE WHEN SUM(D2.CTR_AMT) IS NULL THEN 0 ELSE SUM(D2.CTR_AMT) END AS AMT_CUR
			                    ,0 AS AMT_NEXT
			                    ,0 AS AMT_NEXT_NEXT
			                    ,2 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_NPAQ300 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                      UNION ALL
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'ctr' AS AMT_TYPE
			                    ,0 AS AMT_CUR
			                    ,CASE WHEN SUM(D2.CTR_AMT) IS NULL THEN 0 ELSE SUM(D2.CTR_AMT) END AS AMT_NEXT
			                    ,0 AS AMT_NEXT_NEXT
			                    ,2 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_NPAQ300 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy_1#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                      UNION ALL
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'ctr' AS AMT_TYPE
			                    ,0 AS AMT_CUR
			                    ,0 AS AMT_NEXT
			                    ,CASE WHEN SUM(D2.CTR_AMT) IS NULL THEN 0 ELSE SUM(D2.CTR_AMT) END AS AMT_NEXT_NEXT
			                    ,2 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_NPAQ300 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy_2#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                        ) D1
             UNION ALL
                 SELECT MAX(BZ_ID) AS BZ_ID
                        ,MAX(BZ_NM) AS BZ_NM
                        ,MAX(AMT_TYPE) AS AMT_TYPE
                        ,SUM(AMT_CUR) AS AMT_CUR
                        ,SUM(AMT_NEXT) AS AMT_NEXT
                        ,SUM(AMT_NEXT_NEXT) AS AMT_NEXT_NEXT
                        ,MAX(LEV) AS LEV
                   FROM (
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'oact' AS AMT_TYPE
			                    ,CASE WHEN SUM(D2.OACT_AMT) IS NULL THEN 0 ELSE SUM(D2.OACT_AMT) END AS AMT_CUR
			                    ,0 AS AMT_NEXT
			                    ,0 AS AMT_NEXT_NEXT
			                    ,3 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_EMEP202 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                      UNION ALL
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'oact' AS AMT_TYPE
			                    ,0 AS AMT_CUR
			                    ,CASE WHEN SUM(D2.OACT_AMT) IS NULL THEN 0 ELSE SUM(D2.OACT_AMT) END AS AMT_NEXT
			                    ,0 AS AMT_NEXT_NEXT
			                    ,3 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_EMEP202 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy_1#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                      UNION ALL
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'oact' AS AMT_TYPE
			                    ,0 AS AMT_CUR
			                    ,0 AS AMT_NEXT
			                    ,CASE WHEN SUM(D2.OACT_AMT) IS NULL THEN 0 ELSE SUM(D2.OACT_AMT) END AS AMT_NEXT_NEXT
			                    ,3 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_EMEP202 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy_2#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                        ) D1
             UNION ALL
                 SELECT MAX(BZ_ID) AS BZ_ID
                        ,MAX(BZ_NM) AS BZ_NM
                        ,MAX(AMT_TYPE) AS AMT_TYPE
                        ,SUM(AMT_CUR) AS AMT_CUR
                        ,SUM(AMT_NEXT) AS AMT_NEXT
                        ,SUM(AMT_NEXT_NEXT) AS AMT_NEXT_NEXT
                        ,MAX(LEV) AS LEV
                   FROM (
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'espr' AS AMT_TYPE
			                    ,CASE WHEN SUM(D2.EPRS_AMT) IS NULL THEN 0 ELSE SUM(D2.EPRS_AMT) END AS AMT_CUR
			                    ,0 AS AMT_NEXT
			                    ,0 AS AMT_NEXT_NEXT
			                    ,4 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_EMEP302 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                      UNION ALL
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'espr' AS AMT_TYPE
			                    ,0 AS AMT_CUR
			                    ,CASE WHEN SUM(D2.EPRS_AMT) IS NULL THEN 0 ELSE SUM(D2.EPRS_AMT) END AS AMT_NEXT
			                    ,0 AS AMT_NEXT_NEXT
			                    ,4 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_EMEP302 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy_1#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                      UNION ALL
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'espr' AS AMT_TYPE
			                    ,0 AS AMT_CUR
			                    ,0 AS AMT_NEXT
			                    ,CASE WHEN SUM(D2.EPRS_AMT) IS NULL THEN 0 ELSE SUM(D2.EPRS_AMT) END AS AMT_NEXT_NEXT
			                    ,4 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_EMEP302 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy_2#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM
                        ) D1
             UNION ALL
                 SELECT MAX(BZ_ID) AS BZ_ID
                        ,MAX(BZ_NM) AS BZ_NM
                        ,MAX(AMT_TYPE) AS AMT_TYPE
                        ,SUM(AMT_CUR) AS AMT_CUR
                        ,SUM(AMT_NEXT) AS AMT_NEXT
                        ,SUM(AMT_NEXT_NEXT) AS AMT_NEXT_NEXT
                        ,MAX(LEV) AS LEV
                   FROM (
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'rate' AS AMT_TYPE
			                    ,CASE WHEN D3.TOT_BOKP_AMT = 0 THEN 0 ELSE SUM(D2.EPRS_AMT)/SUM(D3.TOT_BOKP_AMT)OVER()*100 END AS AMT_CUR
			                    ,0 AS AMT_NEXT
			                    ,0 AS AMT_NEXT_NEXT
			                    ,5 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_EMEP302 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
                LEFT OUTER JOIN DWMGR.TB_NPAQ300 D3
			                 ON D1.FSCL_YY = D3.FSCL_YY
			                AND D1.BZ_ID = D3.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM,D3.TOT_BOKP_AMT,D2.EPRS_AMT
                      UNION ALL
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'rate' AS AMT_TYPE
			                    ,0 AS AMT_CUR
			                    ,CASE WHEN D3.TOT_BOKP_AMT = 0 THEN 0 ELSE SUM(D2.EPRS_AMT)/SUM(D3.TOT_BOKP_AMT)OVER()*100 END AS AMT_NEXT
			                    ,0 AS AMT_NEXT_NEXT
			                    ,5 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_EMEP302 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
                LEFT OUTER JOIN DWMGR.TB_NPAQ300 D3
			                 ON D1.FSCL_YY = D3.FSCL_YY
			                AND D1.BZ_ID = D3.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy_1#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM,D3.TOT_BOKP_AMT,D2.EPRS_AMT
                      UNION ALL
	                     SELECT D1.BZ_ID
			                    ,D1.BZ_NM
			                    ,'rate' AS AMT_TYPE
			                    ,0 AS AMT_CUR
			                    ,0 AS AMT_NEXT
			                    ,CASE WHEN D3.TOT_BOKP_AMT = 0 THEN 0 ELSE SUM(D2.EPRS_AMT)/SUM(D3.TOT_BOKP_AMT)OVER()*100 END AS AMT_NEXT_NEXT
   			                    ,5 AS LEV
					       FROM DWMGR.TB_PMPR005 D1
			    LEFT OUTER JOIN DWMGR.TB_EMEP302 D2
			                 ON D1.FSCL_YY = D2.FSCL_YY
			                AND D1.BZ_ID = D2.BZ_ID
                LEFT OUTER JOIN DWMGR.TB_NPAQ300 D3
			                 ON D1.FSCL_YY = D3.FSCL_YY
			                AND D1.BZ_ID = D3.BZ_ID
						  WHERE  1=1
							AND D1.FSCL_YY = #strFsclYy_2#
                            AND D1.BZ_ID = #strBzId#
				   	   GROUP BY D1.BZ_ID,D1.BZ_NM,D3.TOT_BOKP_AMT,D2.EPRS_AMT
                        ) D1
               ) D1
      ORDER BY LEV

	</select>

	<select id="FAABCGETLselect" parameterClass="paramMap" resultClass="resultMap">
SELECT CASE A.AUTO_YN 
			       WHEN 'Y' THEN '자동'
			       WHEN 'N' THEN '수동'
			       ELSE A.AUTO_YN 
			       END AS AUTO_YN,
			       A.TRAN_ORG,
			       A.TAB_ID,
			       (SELECT TAB_NM FROM DWMGR.IT_DWCOMM013 WHERE A.TAB_ID = TAB_ID) AS TAB_NM,
			       A.FNL_TRAN_DTM,
			       A.PRPR_FREQ,
			       A.ETL_WORK_FREQ,
			       SUM(A.PRPR_FREQ - A.ETL_WORK_FREQ) AS DIFF_FREQ,
			       A.PRPR_SUM,
			       ISNULL(A.ETL_CHKSUM, 0) AS ETL_CHKSUM,
			       SUM(A.PRPR_SUM - ISNULL(A.ETL_CHKSUM, 0)) AS DIFF_SUM
			  FROM DWMGR.IT_DWCOMM012 A
			 WHERE 1=1
					<isNotEmpty property="strAutoYn">
						   AND AUTO_YN = #strAutoYn#
					</isNotEmpty> 
					<isNotEmpty property="strTranOrg">
						   AND A.TRAN_ORG LIKE '%'||#strTranOrg#||'%'
					</isNotEmpty>
					<isNotEmpty property="strTranYm">
						   AND  PRPR_DATE = #strTranYm#
					</isNotEmpty>		 
			 GROUP BY A.AUTO_YN, A.TRAN_ORG, A.TAB_ID, A.FNL_TRAN_DTM, A.PRPR_FREQ,
			          A.ETL_WORK_FREQ, A.PRPR_SUM, A.ETL_CHKSUM
			 ORDER BY A.AUTO_YN, A.TRAN_ORG, A.TAB_ID, TAB_NM, A.FNL_TRAN_DTM
</select>

	<select id="FAABCGETLDtlselect" parameterClass="paramMap" resultClass="resultMap">
	      	SELECT D1.TRAN_ORG
				   ,D1.TAB_ID
				   ,D2.TAB_NM
				   ,D1.FNL_TRAN_DTM
				   ,D1.PRPR_FREQ
				   ,D1.ETL_WORK_FREQ
				   ,D1.DATA_BEGIN_DATE
				   ,D1.DATA_END_DATE
				   ,D1.ETL_WORK_FIN_DATE
				   ,CASE D1.AUTO_YN 
		            WHEN 'Y' THEN '자동' 
		            WHEN 'N' THEN '수동' 
		            ELSE D1.AUTO_YN 
		            END AS AUTO_YN
				   ,D1.REMARK
				   ,D1.FILE_ID
			  FROM DWMGR.IT_DWCOMM012 D1
   LEFT OUTER JOIN DWMGR.IT_DWCOMM013 D2
				ON D1.TAB_ID = D2.TAB_ID
			 WHERE D1.TAB_ID = #strTblId#
		  ORDER BY D1.FNL_TRAN_DTM DESC
	</select>

	<select id="FAABCG291Mainselect" parameterClass="paramMap" resultClass="resultMap">
	      	 SELECT 회계명,
        구분,
        세출예산액1 / 1000000 AS 세출예산액1,
        세출예산액3 / 1000000 AS 세출예산액3,
        증가율1,
        세출예산액5 / 1000000 AS 세출예산액5,
        증가율2,
        1 AS NUM
   FROM ( SELECT 회계명,
                 구분,
                 세출예산액1,
                 세출예산액3,
<![CDATA[  		 ROUND(CASE WHEN 세출예산액1 <> 0 THEN ( (세출예산액3 - 세출예산액1) / 세출예산액1) * 100 ELSE 0 END,2) AS 증가율1, ]]>
                 세출예산액5,
<![CDATA[        ROUND(CASE WHEN 세출예산액3 <> 0 THEN ( (세출예산액5 - 세출예산액3) / 세출예산액3) * 100 ELSE 0 END,2) AS 증가율2  ]]>
            FROM ( SELECT TT.FSCL_NM AS 회계명,
                          '세출' AS 구분,
                          SUM(TT.세출예산현액11) AS 세출예산액1,
                          SUM(TT.세출예산현액21) AS 세출예산액3,
                          SUM(TT.세출예산현액31) AS 세출예산액5
                     FROM ( SELECT SUBSTRING (T1.FSCL_YM,1,4) AS FS,
                                   '['||T1.FSCL_CD||'] '||T1.FSCL_NM AS FSCL_NM,
                                   SUM(T1.ANEXP_BDG_CAMT) AS 세출예산현액11,
                                   0 AS 세출예산현액21,
                                   0 AS 세출예산현액31
                              FROM DWMGR.TB_ACOLF02 T1
                             WHERE SUBSTRING (T1.FSCL_YM,1,4) = #strYy#
                               AND T1.OFFC_CD IN(#strOffcCd#)
<![CDATA[                      AND T1.FSCL_YM <= '2100' ]]>
                             GROUP BY SUBSTRING (T1.FSCL_YM,1,4),
                                   T1.FSCL_NM, T1.FSCL_CD
                             UNION ALL
                            SELECT SUBSTRING (T1.FSCL_YM,1,4) AS FS,
                                   '['||T1.FSCL_CD||'] '||T1.FSCL_NM AS FSCL_NM,
                                   0 AS 세출예산현액11,
                                   SUM(T1.ANEXP_BDG_CAMT) AS 세출예산현액21,
                                   0 AS 세출예산현액31
                              FROM DWMGR.TB_ACOLF02 T1
                             WHERE SUBSTRING (T1.FSCL_YM,1,4) = CONVERT(CHAR,(CONVERT(NUMERIC(4),#strYy#)-1))
                               AND T1.OFFC_CD IN(#strOffcCd#)
<![CDATA[                      AND T1.FSCL_YM <= '2100'  ]]>
                             GROUP BY SUBSTRING (T1.FSCL_YM,1,4),
                                   T1.FSCL_NM, T1.FSCL_CD
                             UNION ALL
                            SELECT SUBSTRING (T1.FSCL_YM,1,4) AS FS,
                                   '['||T1.FSCL_CD||'] '||T1.FSCL_NM AS FSCL_NM,
                                   0 AS 세출예산현액11,
                                   0 AS 세출예산현액21,
                                   SUM(T1.ANEXP_BDG_CAMT) AS 세출예산현액31
                              FROM DWMGR.TB_ACOLF02 T1
                             WHERE SUBSTRING (T1.FSCL_YM,1,4) = CONVERT(CHAR,(CONVERT(NUMERIC(4),#strYy#)-2))
                               AND T1.OFFC_CD IN(#strOffcCd#)
<![CDATA[                      AND T1.FSCL_YM <= '2100'  ]]>
                             GROUP BY SUBSTRING (T1.FSCL_YM,1,4),
                                   T1.FSCL_NM, T1.FSCL_CD) TT
                    GROUP BY TT.FSCL_NM
                    UNION ALL
                   SELECT 회계명,
                          구분,
                          세입예산액1,
                          세입예산액3,
                          세입예산액5
                     FROM ( SELECT TT.FSCL_NM AS 회계명,
                                   '세입' AS 구분,
                                   SUM(TT.세입예산현액11) AS 세입예산액1,
                                   SUM(TT.세입예산현액21) AS 세입예산액3,
                                   SUM(TT.세입예산현액31) AS 세입예산액5
                              FROM ( SELECT SUBSTRING (T1.FSCL_YM,1,4) AS FS,
                                            '['||T1.FSCL_CD||'] '||T1.FSCL_NM AS FSCL_NM,
                                            SUM(T1.REVN_BDG_CAMT) AS 세입예산현액11,
                                            0 AS 세입예산현액21,
                                            0 AS 세입예산현액31
                                       FROM DWMGR.TB_ACOLF01 T1
                                      WHERE SUBSTRING (T1.FSCL_YM,1,4) = #strYy#
                                        AND T1.OFFC_CD IN(#strOffcCd#)
<![CDATA[                               AND T1.FSCL_YM <= '2100'  ]]>
                                      GROUP BY SUBSTRING (T1.FSCL_YM,1,4),
                                            T1.FSCL_NM, T1.FSCL_CD
                                      UNION ALL
                                     SELECT SUBSTRING (T1.FSCL_YM,1,4) AS FS,
                                            '['||T1.FSCL_CD||'] '||T1.FSCL_NM AS FSCL_NM,
                                            0 AS 세입예산현액11,
                                            SUM(T1.REVN_BDG_CAMT) AS 세입예산현액21,
                                            0 AS 세입예산현액31
                                       FROM DWMGR.TB_ACOLF01 T1
                                      WHERE SUBSTRING (T1.FSCL_YM,1,4) = CONVERT(CHAR,(CONVERT(NUMERIC(4),#strYy#)-1))
                                        AND T1.OFFC_CD IN(#strOffcCd#)
<![CDATA[                               AND T1.FSCL_YM <= '2100'  ]]>
                                      GROUP BY SUBSTRING (T1.FSCL_YM,1,4),
                                            T1.FSCL_NM, T1.FSCL_CD
                                      UNION ALL
                                     SELECT SUBSTRING (T1.FSCL_YM,1,4) AS FS,
                                            '['||T1.FSCL_CD||'] '||T1.FSCL_NM AS FSCL_NM,
                                            0 AS 세입예산현액11,
                                            0 AS 세입예산현액21,
                                            SUM(T1.REVN_BDG_CAMT) AS 세입예산현액31
                                       FROM DWMGR.TB_ACOLF01 T1
                                      WHERE SUBSTRING (T1.FSCL_YM,1,4) = CONVERT(CHAR,(CONVERT(NUMERIC(4),#strYy#)-2))
                                        AND T1.OFFC_CD IN(#strOffcCd#)
<![CDATA[                               AND T1.FSCL_YM <= '2100'  ]]>
                                      GROUP BY SUBSTRING (T1.FSCL_YM,1,4),
                                            T1.FSCL_NM, T1.FSCL_CD) TT
                             GROUP BY TT.FSCL_NM) TT) TT) TT
  UNION ALL
 SELECT 회계명,
        구분,
        세출예산액1 / 1000000 AS 세출예산액1,
        세출예산액3 / 1000000 AS 세출예산액3,
        증가율1,
        세출예산액5 / 1000000 AS 세출예산액5,
        증가율2,
        999 AS NUM
   FROM ( SELECT 회계명,
                 구분,
                 세출예산액1,
                 세출예산액3,
<![CDATA[        ROUND(CASE WHEN 세출예산액1 <> 0 THEN ( (세출예산액3 - 세출예산액1) / 세출예산액1) * 100 ELSE 0 END,2) AS 증가율1, ]]>
                 세출예산액5,
<![CDATA[        ROUND(CASE WHEN 세출예산액3 <> 0 THEN ( (세출예산액5 - 세출예산액3) / 세출예산액3) * 100 ELSE 0 END,2) AS 증가율2  ]]>
            FROM ( SELECT MAX(회계명) AS 회계명,
                          MAX(구분) AS 구분,
                          SUM(세출예산액1) AS 세출예산액1,
                          SUM(세출예산액3) AS 세출예산액3,
                          SUM(세출예산액5) AS 세출예산액5
                     FROM ( SELECT '총 재정규모' AS 회계명,
                                   '세출의합' AS 구분,
                                   SUM(TT.세출예산현액11) AS 세출예산액1,
                                   SUM(TT.세출예산현액21) AS 세출예산액3,
                                   SUM(TT.세출예산현액31) AS 세출예산액5
                              FROM ( SELECT SUBSTRING (T1.FSCL_YM,1,4) AS FS,
                                            SUM(T1.ANEXP_BDG_CAMT) AS 세출예산현액11,
                                            0 AS 세출예산현액21,
                                            0 AS 세출예산현액31
                                       FROM DWMGR.TB_ACOLF02 T1
                                      WHERE SUBSTRING (T1.FSCL_YM,1,4) = #strYy#
                                        AND T1.OFFC_CD IN(#strOffcCd#)
<![CDATA[                               AND T1.FSCL_YM <= '2100'  ]]>
                                      GROUP BY SUBSTRING (T1.FSCL_YM,1,4)
                                      UNION ALL
                                     SELECT SUBSTRING (T1.FSCL_YM,1,4) AS FS,
                                            0 AS 세출예산현액11,
                                            SUM(T1.ANEXP_BDG_CAMT) AS 세출예산현액21,
                                            0 AS 세출예산현액31
                                       FROM DWMGR.TB_ACOLF02 T1
                                      WHERE SUBSTRING (T1.FSCL_YM,1,4) = CONVERT(CHAR,(CONVERT(NUMERIC(4),#strYy#)-1))
                                        AND T1.OFFC_CD IN(#strOffcCd#)
<![CDATA[                               AND T1.FSCL_YM <= '2100'  ]]>
                                      GROUP BY SUBSTRING (T1.FSCL_YM,1,4)
                                      UNION ALL
                                     SELECT SUBSTRING (T1.FSCL_YM,1,4) AS FS,
                                            0 AS 세출예산현액11,
                                            0 AS 세출예산현액21,
                                            SUM(T1.ANEXP_BDG_CAMT) AS 세출예산현액31
                                       FROM DWMGR.TB_ACOLF02 T1
                                      WHERE SUBSTRING (T1.FSCL_YM,1,4) = CONVERT(CHAR,(CONVERT(NUMERIC(4),#strYy#)-2))
                                        AND T1.OFFC_CD IN(#strOffcCd#)
<![CDATA[                               AND T1.FSCL_YM <= '2100'  ]]>
                                      GROUP BY SUBSTRING (T1.FSCL_YM,1,4) ) TT
                             GROUP BY TT.FS) TT) TT) TT
  ORDER BY 8,1,2
	</select>
	
	<select id="FAABCG291FsclYyselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT SUBSTR(FSCL_YM,1,4) AS FSCL_YY, 
			   SUBSTR(FSCL_YM,1,4)||'년' AS FSCL_YY_NM
		  FROM (
			    SELECT DISTINCT FSCL_YM 
			      FROM DWMGR.TB_ACOLF02
				 WHERE FSCL_YM BETWEEN '2009' AND '2100'
		  ) D1
	  ORDER BY 1
	</select>
	
	<select id="FAABCG291OffcCdselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT OFFC_CD, 
			   '['||OFFC_CD||'] '||OFFC_NM AS OFFC_NM
		  FROM (
				SELECT DISTINCT OFFC_CD, 
					   OFFC_NM
				  FROM DWMGR.TB_ACOLF02
		  ) D1
	  ORDER BY SUBSTR(OFFC_NM,6)
	</select>
	
	<select id="FAABCG292Topselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT 
			C.TOT_REVN_BDG_CAMT
			, C.TOT_RD_AMT
			, C.TOT_RC_AMT
			, C.TOT_NPL_AMT
			, C.TOT_NRC_AMT
		FROM ( 
			SELECT 
				TOT_REVN_BDG_CAMT
				, TOT_RD_AMT
				, TOT_RC_AMT 
				, TOT_NPL_AMT
				, TOT_NRC_AMT
			FROM (
				SELECT 
				SUM(REVN_BDG_CAMT) AS TOT_REVN_BDG_CAMT
				, SUM(RD_AMT) AS TOT_RD_AMT
				, SUM(RC_AMT) AS TOT_RC_AMT
				, SUM(NPL_AMT) AS TOT_NPL_AMT 
				, SUM(NRC_AMT) AS TOT_NRC_AMT
		        , A.OFFC_CD 
				FROM DWMGR.TB_ACKQ001 A 
				WHERE A.FSCL_YM = #strYy#||'12'
				<isNotEmpty property="strOffcCd">
				AND OFFC_CD = #strOffcCd#
				</isNotEmpty>
				<isNotEmpty property="strFsclCd">
				AND FSCL_CD = #strFsclCd#
				</isNotEmpty>
				GROUP BY 
					A.OFFC_CD
			) A
			,(
				SELECT 
					OFFC_CD
					, OFFC_NM
					, ORG_CD 
				FROM DWMGR.TB_BICD014 
				WHERE FSCL_YY = #strYy#
			) B 
			WHERE A.OFFC_CD = B.OFFC_CD
		)C 
	</select>
	
	<select id="FAABCG292FsclYyselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT SUBSTR(C.FSCL_YM,1,4) AS FSCL_YY, 
			   SUBSTR(C.FSCL_YM,1,4)||'년' AS FSCL_YY_NM
		  FROM (
				SELECT DISTINCT FSCL_YM 
				  FROM DWMGR.TB_ACKQ001 
	<![CDATA[	 WHERE FSCL_YM >= '2009'	]]>
		  ) C
	  ORDER BY 1 
	</select>
	
	<select id="FAABCG292OffcCdselect" parameterClass="paramMap" resultClass="resultMap">
			SELECT A.OFFC_CD
				   ,'['||A.OFFC_CD||'] '||B.OFFC_NM AS OFFC_NM
			  FROM (
					SELECT DISTINCT OFFC_CD
				 	  FROM DWMGR.TB_ACKQ001
				 	 WHERE SUBSTR(FSCL_YM,1,4) = #strYy#
			  ) A
   LEFT OUTER JOIN DWMGR.TB_BICD011 B
				ON A.OFFC_CD = B.OFFC_CD
		  WHERE B.OFFC_NM IS NOT NULL
		  ORDER BY B.OFFC_NM
	</select>
	
	<select id="FAABCG292FsclCdselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT	DISTINCT '['||B.FSCL_CD||'] '||B.FSCL_NM AS FSCL_NM, 
				B.FSCL_CD AS FSCL_CD
		FROM	(
				SELECT	DISTINCT FSCL_CD,
						OFFC_CD
				FROM	DWMGR.TB_ACKQ001
				WHERE	SUBSTR(FSCL_YM,1,4) = #strYy#
				<isNotEmpty property="strOffcCd">
				AND		OFFC_CD = #strOffcCd#
				</isNotEmpty>
				) C,
				DWMGR.TB_BICD023 A,
				DWMGR.TB_BICD001 B
          WHERE A.FSCL_CD = B.FSCL_CD
          AND	A.OFFC_CD = C.OFFC_CD
          AND	A.FSCL_CD = C.FSCL_CD
       ORDER BY 2
	</select>
	
	<select id="FAABCG293Topselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT C.TOT_ANEXP_BDG_CAMT
        	   ,C.TOT_EP_AMT
               ,CONVERT(NUMERIC(22,2),ROUND((C.TOT_EP_AMT/C.TOT_ANEXP_BDG_CAMT)*100,2)) AS RATE  
        	   ,C.TOT_NEXT_YY_BFWAMT + C.TOT_DUSEAMT AS TOT_NEXT_YY_BFWAMT
		 FROM(	
	          SELECT TOT_ANEXP_BDGAMT
	              	 ,TOT_ANEXP_BDG_CAMT
	              	 ,TOT_EP_AMT
	              	 ,TOT_NEXT_YY_BFWAMT
	              	 ,TOT_DUSEAMT 
	           FROM ( 
	              	 SELECT OFFC_CD
	                      	,SUM(ANEXP_BDGAMT) AS TOT_ANEXP_BDGAMT
	                      	,SUM(ANEXP_BDG_CAMT) AS TOT_ANEXP_BDG_CAMT
	                      	,SUM(EP_AMT) AS TOT_EP_AMT
	                      	,SUM(NEXT_YY_BFWAMT) AS TOT_NEXT_YY_BFWAMT
	                      	,SUM(DUSEAMT) AS TOT_DUSEAMT 
	              	   FROM DWMGR.TB_ACKQ002 
	              	  WHERE FSCL_YM = #strYy#||'12'
	              	  	<isNotEmpty property="strOffcCd">
	                    AND OFFC_CD = #strOffcCd#
	                    </isNotEmpty>
	                    <isNotEmpty property="strFsclCd">
	                    AND FSCL_CD = #strFsclCd#
	                    </isNotEmpty>
	               GROUP BY OFFC_CD
	        	) A
	        	, (
	        		SELECT OFFC_CD
	                	   ,OFFC_NM
	                	   ,ORG_CD 
	        		  FROM DWMGR.TB_BICD014 
	        		 WHERE FSCL_YY = #strYy#
	        	) B 
	          WHERE A.OFFC_CD = B.OFFC_CD
		)C 
	</select>
	
	<select id="FAABCG293FsclYyselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT SUBSTR(C.FSCL_YM,1,4) AS FSCL_YY, 
			   SUBSTR(C.FSCL_YM,1,4)||'년' AS FSCL_YY_NM
		  FROM (
				SELECT DISTINCT FSCL_YM 
				  FROM DWMGR.TB_ACKQ002 
	<![CDATA[	 WHERE FSCL_YM >= '2009'	]]>
		  ) C
	  ORDER BY 1 
	</select>
	
	<select id="FAABCG293OffcCdselect" parameterClass="paramMap" resultClass="resultMap">
			SELECT A.OFFC_CD
				   ,'['||A.OFFC_CD||'] '||B.OFFC_NM AS OFFC_NM
			  FROM (
					SELECT DISTINCT OFFC_CD
				 	  FROM DWMGR.TB_ACKQ002
				 	 WHERE SUBSTR(FSCL_YM,1,4) = #strYy#
			  ) A
   LEFT OUTER JOIN DWMGR.TB_BICD011 B
				ON A.OFFC_CD = B.OFFC_CD
		  WHERE B.OFFC_NM IS NOT NULL
		  ORDER BY B.OFFC_NM
	</select>
	
	<select id="FAABCG293BaiOffcCdselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT  BAI_OFFC_CD
		FROM	DWMGR.TB_BICD011
		<isNotEmpty property="strOffcCd">
		WHERE	OFFC_CD = #strOffcCd#
		</isNotEmpty>
	</select>
	
	<select id="FAABCG293BaiFsclCdselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT	BAI_FSCL_CD
		FROM	DWMGR.TB_BICD001
		WHERE	FSCL_CD = #strFsclCd#
	</select>
	
	<select id="FAABCG293FsclCdselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT	DISTINCT '['||B.FSCL_CD||'] '||B.FSCL_NM AS FSCL_NM, 
				B.FSCL_CD AS FSCL_CD
		FROM	(
				SELECT	DISTINCT FSCL_CD,
						OFFC_CD
				FROM	DWMGR.TB_ACKQ002
				WHERE	SUBSTR(FSCL_YM,1,4) = #strYy#
				<isNotEmpty property="strOffcCd">
				AND		OFFC_CD = #strOffcCd#
				</isNotEmpty>
				) C,
				DWMGR.TB_BICD023 A,
				DWMGR.TB_BICD001 B
          WHERE A.FSCL_CD = B.FSCL_CD
          AND	A.OFFC_CD = C.OFFC_CD
          AND	A.FSCL_CD = C.FSCL_CD
       ORDER BY 2
	</select>
	
	<select id="FAABCG293EChart1select" parameterClass="paramMap" resultClass="resultMap">
	     SELECT '예산' AS CH_DIV,
		        SUM(TT.세출예산현액11) AS FSCL_YY,
		        SUM(TT.세출예산현액21) AS FSCL_YY_1,
		        SUM(TT.세출예산현액31) AS FSCL_YY_2
		   FROM ( SELECT SUM(T1.ANEXP_BDG_CAMT) AS 세출예산현액11,
		                 0 AS 세출예산현액21,
		                 0 AS 세출예산현액31
		            FROM DWMGR.TB_ACKQ002 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = convert(char (4),convert(numeric (4), #strYy#) - 2)			
		             AND T1.OFFC_CD = #strOffcCd#
		  <![CDATA[  AND T1.FSCL_YM <= '2100' ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4)
		           UNION ALL
		          SELECT 0 AS 세출예산현액11,
		                 SUM(T1.ANEXP_BDG_CAMT) AS 세출예산현액21,
		                 0 AS 세출예산현액31
		            FROM DWMGR.TB_ACKQ002 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = convert(char (4),convert(numeric (4), #strYy#) - 1)			
		             AND T1.OFFC_CD = #strOffcCd#
		  <![CDATA[  AND T1.FSCL_YM <= '2100' ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4)
		           UNION ALL
		          SELECT 0 AS 세출예산현액11,
		                 0 AS 세출예산현액21,
		                 SUM(T1.ANEXP_BDG_CAMT) AS 세출예산현액31
		            FROM DWMGR.TB_ACKQ002 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = #strYy#			
		             AND T1.OFFC_CD = #strOffcCd#
		  <![CDATA[  AND T1.FSCL_YM <= '2100'  ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4) 
		  ) TT
		  UNION ALL
		 SELECT '지출' AS 과명,
		        SUM(TT.세출예산현액11) AS 기준년1,
		        SUM(TT.세출예산현액21) AS 기준년2,
		        SUM(TT.세출예산현액31) AS 기준년3
		   FROM ( SELECT SUM(T1.EP_AMT) AS 세출예산현액11,
		                 0 AS 세출예산현액21,
		                 0 AS 세출예산현액31
		            FROM DWMGR.TB_ACKQ002 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = convert(char (4),convert(numeric (4), #strYy#) - 2)			
		             AND T1.OFFC_CD = #strOffcCd#
		  <![CDATA[  AND T1.FSCL_YM <= '2100'  ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4)
		           UNION ALL
		          SELECT 0 AS 세출예산현액11,
		                 SUM(T1.EP_AMT) AS 세출예산현액21,
		                 0 AS 세출예산현액31
		            FROM DWMGR.TB_ACKQ002 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = convert(char (4),convert(numeric (4), #strYy#) - 1)			
		             AND T1.OFFC_CD = #strOffcCd#
		  <![CDATA[  AND T1.FSCL_YM <= '2100'  ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4)
		           UNION ALL
		          SELECT 0 AS 세출예산현액11,
		                 0 AS 세출예산현액21,
		                 SUM(T1.EP_AMT) AS 세출예산현액31
		            FROM DWMGR.TB_ACKQ002 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = #strYy#			
		             AND T1.OFFC_CD = #strOffcCd#
		<![CDATA[    AND T1.FSCL_YM <= '2100'  ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4) 
		    ) TT
	</select>
	
	<select id="FAABCGChart1FsclYyselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT SUBSTR(C.FSCL_YM,1,4) AS FSCL_YY, 
			   SUBSTR(C.FSCL_YM,1,4)||'년' AS FSCL_YY_NM
		  FROM (
				SELECT DISTINCT FSCL_YM 
				  FROM DWMGR.TB_ACKQ002 
				 WHERE FSCL_YM BETWEEN '2009' AND '2100'
		  ) C
	  ORDER BY 1 
	</select>
	
	<select id="FAABCGChart1OffcCdselect" parameterClass="paramMap" resultClass="resultMap">
			SELECT A.OFFC_CD
				   ,'['||A.OFFC_CD||'] '||B.OFFC_NM AS OFFC_NM
			  FROM (
					SELECT DISTINCT OFFC_CD
				 	  FROM DWMGR.TB_ACKQ002
			  ) A
   LEFT OUTER JOIN DWMGR.TB_BICD011 B
				ON A.OFFC_CD = B.OFFC_CD
		     WHERE B.OFFC_NM IS NOT NULL
		  ORDER BY B.OFFC_NM
	</select>
	
	<select id="FAABCG293EChart2select" parameterClass="paramMap" resultClass="resultMap">
		 SELECT '예산' AS CH_DIV,
		        SUM(TT.세입예산현액11) AS FSCL_YY,
		        SUM(TT.세입예산현액21) AS FSCL_YY_1,
		        SUM(TT.세입예산현액31) AS FSCL_YY_2
		   FROM ( SELECT SUM(T1.REVN_BDG_CAMT) AS 세입예산현액11,
		                 0 AS 세입예산현액21,
		                 0 AS 세입예산현액31
		            FROM DWMGR.TB_ACKQ001 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = convert(char (4),convert(numeric (4), #strYy2#) - 2)
		             AND T1.OFFC_CD = #strOffcCd2#
		<![CDATA[    AND T1.FSCL_YM <= '2100'  ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4)
		           UNION ALL
		          SELECT 0 AS 세입예산현액11,
		                 SUM(T1.REVN_BDG_CAMT) AS 세입예산현액21,
		                 0 AS 세입예산현액31
		            FROM DWMGR.TB_ACKQ001 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = convert(char (4),convert(numeric (4), #strYy2#) - 1)
		             AND T1.OFFC_CD = #strOffcCd2#
		<![CDATA[    AND T1.FSCL_YM <= '2100' ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4)
		           UNION ALL
		          SELECT 0 AS 세입예산현액11,
		                 0 AS 세입예산현액21,
		                 SUM(T1.REVN_BDG_CAMT) AS 세입예산현액31
		            FROM DWMGR.TB_ACKQ001 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = #strYy2#
		             AND T1.OFFC_CD = #strOffcCd2#
		<![CDATA[    AND T1.FSCL_YM <= '2100'  ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4) 
		  ) TT
	  UNION ALL
		 SELECT '수입' AS 과명,
		        SUM(TT.세입예산현액11) AS 기준년1,
		        SUM(TT.세입예산현액21) AS 기준년2,
		        SUM(TT.세입예산현액31) AS 기준년3
		   FROM ( SELECT SUM(T1.RC_AMT) AS 세입예산현액11,
		                 0 AS 세입예산현액21,
		                 0 AS 세입예산현액31
		            FROM DWMGR.TB_ACKQ001 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = convert(char (4),convert(numeric (4), #strYy2#) - 2)
		             AND T1.OFFC_CD = #strOffcCd2#
		<![CDATA[    AND T1.FSCL_YM <= '2100'  ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4)
		           UNION ALL
		          SELECT 0 AS 세입예산현액11,
		                 SUM(T1.RC_AMT) AS 세입예산현액21,
		                 0 AS 세입예산현액31
		            FROM DWMGR.TB_ACKQ001 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = convert(char (4),convert(numeric (4), #strYy2#) - 1)
		             AND T1.OFFC_CD = #strOffcCd2#
		<![CDATA[    AND T1.FSCL_YM <= '2100'  ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4)
		           UNION ALL
		          SELECT 0 AS 세입예산현액11,
		                 0 AS 세입예산현액21,
		                 SUM(T1.RC_AMT) AS 세입예산현액31
		            FROM DWMGR.TB_ACKQ001 T1
		           WHERE SUBSTRING (T1.FSCL_YM,1,4) = #strYy2#
		             AND T1.OFFC_CD = #strOffcCd2#
		<![CDATA[    AND T1.FSCL_YM <= '2100'  ]]>
		           GROUP BY SUBSTRING (T1.FSCL_YM,1,4) 
		  ) TT
	</select>
	
	<select id="FAABCGChart2FsclYyselect" parameterClass="paramMap" resultClass="resultMap">
		SELECT SUBSTR(C.FSCL_YM,1,4) AS FSCL_YY, 
			   SUBSTR(C.FSCL_YM,1,4)||'년' AS FSCL_YY_NM
		  FROM (
				SELECT DISTINCT FSCL_YM 
				  FROM DWMGR.TB_ACKQ001 
				 WHERE FSCL_YM BETWEEN '2009' AND '2100'
		  ) C
	  ORDER BY 1 
	</select>
	
	<select id="FAABCGChart2OffcCdselect" parameterClass="paramMap" resultClass="resultMap">
			SELECT A.OFFC_CD
				   ,'['||A.OFFC_CD||'] '||B.OFFC_NM AS OFFC_NM
			  FROM (
					SELECT DISTINCT OFFC_CD
				 	  FROM DWMGR.TB_ACKQ001
			  ) A
   LEFT OUTER JOIN DWMGR.TB_BICD011 B
				ON A.OFFC_CD = B.OFFC_CD
		     WHERE B.OFFC_NM IS NOT NULL
		  ORDER BY B.OFFC_NM
	</select>


	<!-- 전체 조회 -->
	<select id="FAABCGAMZAllselect" parameterClass="paramMap" resultClass="resultMap">
<![CDATA[	
			SELECT /* 전체조회 */
				   (   
				       SELECT M1.USR_NAM ||'('||M1.CNB||')'
				         FROM TBDCMACM001M M1 
				        WHERE M1.CNB = SUBSTR(D1.USER_CODE,1,4)
				   ) AS USER_ID 
				   ,D1.USER_IPADDR AS USER_IP
				   ,D3.FOLDER_NAME AS FOLDER_NM 
			       ,D2.REPORT_NAME AS REPORT_NM	
			       ,F_DPT_INFO(F_USR_INFO(M2.CNB,'5'),'1')      AS DPT_NM
				   ,TO_CHAR(D1.LOG_TIME,'YYYY-MM-DD HH24:MI:SS') AS LOG_TIME
			  FROM MTX_LOG D1
		INNER JOIN MTX_REPORT D2
				ON D1.LOG_ATTRIBUTE1 = D2.REPORT_CODE
		INNER JOIN MTX_FOLDER D3
			    ON D2.FOLDER_CODE = D3.FOLDER_CODE 
		INNER JOIN TBDCMACM001M M2
			    ON SUBSTR(D1.USER_CODE,1,4) = M2.CNB
		]]>	  
			  <isNotEmpty prepend="AND" property="strDptNm">
			     F_DPT_INFO(F_USR_INFO(M2.CNB,'5'),'1') LIKE '%'||#strDptNm#||'%' /* 검색조건:부서 */
			  </isNotEmpty>
			 WHERE 1=1
			   AND D1.LOGTYPE_CODE = 40
			  <isNotEmpty prepend="AND" property="strFrom">
		       D1.LOG_TIME BETWEEN TO_DATE(#strFrom#||'000000','YYYYMMDDHH24MISS') AND TO_DATE(#strTo#||'235959','YYYYMMDDHH24MISS') /* 검색조건:기간 */
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="strUserNm">  
			   EXISTS (   /* 검색조건:사용자 */
							 SELECT M1.CNB
							   FROM TBDCMACM001M M1
							  WHERE M1.CNB = SUBSTR(D1.USER_CODE,1,4)
							    AND M1.USR_NAM LIKE '%'||#strUserNm#||'%' /* 검색조건: 사용자명 */	
			              )
		      </isNotEmpty>	    
			ORDER BY D1.USER_CODE, D1.LOG_TIME DESC;
</select>

	<!-- 메뉴 별 조회 -->
	<select id="FAABCGAMZMenuUseselect" parameterClass="paramMap" resultClass="resultMap">
<![CDATA[
			SELECT /* 메뉴명 - 폴더명,보고서, 부서명, 부서별건수*/
				    D3.FOLDER_NAME AS FOLDER_NM 
			       ,D2.REPORT_NAME AS REPORT_NM	
			       ,F_DPT_INFO(F_USR_INFO(M2.CNB,'5'),'1')      AS DPT_NM
   				   ,TO_CHAR(D1.LOG_TIME,'YYYY-MM-DD') AS LOG_TIME
                   ,COUNT(*) AS DPT_CNT
			  FROM MTX_LOG D1
		INNER JOIN MTX_REPORT D2
				ON D1.LOG_ATTRIBUTE1 = D2.REPORT_CODE
		INNER JOIN MTX_FOLDER D3
			    ON D2.FOLDER_CODE = D3.FOLDER_CODE 
		INNER JOIN TBDCMACM001M M2
			    ON SUBSTR(D1.USER_CODE,1,4) = M2.CNB
		]]>	  
			     
			  <isNotEmpty prepend="AND" property="strDptNm"> 
			   F_DPT_INFO(F_USR_INFO(M2.CNB,'5'),'1') LIKE '%'||#strDptNm#||'%' /* 검색조건:부서 */
			  </isNotEmpty> 
			  
			 WHERE 1=1
			   AND D1.LOGTYPE_CODE = 40
			   
			  <isNotEmpty prepend="AND" property="strFrom">
		       D1.LOG_TIME BETWEEN TO_DATE(#strFrom#||'000000','YYYYMMDDHH24MISS') AND TO_DATE(#strTo#||'235959','YYYYMMDDHH24MISS') /* 검색조건:기간 */
			  </isNotEmpty>
		  		   
			  <isNotEmpty prepend="AND" property="strUserNm">  
			   EXISTS (   /* 검색조건:사용자 */
							 SELECT M1.CNB
							   FROM TBDCMACM001M M1
							  WHERE M1.CNB = SUBSTR(D1.USER_CODE,1,4)
							    AND M1.USR_NAM LIKE '%'||#strUserNm#||'%' /* 검색조건: 사용자명 */	
			              )
		      </isNotEmpty>	              
			 GROUP BY D3.FOLDER_NAME,D2.REPORT_NAME,F_DPT_INFO(F_USR_INFO(M2.CNB,'5'),'1'),TO_CHAR(D1.LOG_TIME,'YYYY-MM-DD')
</select>

    <!-- 사용자 별 조회 -->
	<select id="FAABCGAMZUserUseselect" parameterClass="paramMap" resultClass="resultMap">
<![CDATA[
		    SELECT /* 사용자별 - 사용자명,전산번호,부서명,화면명, 화면별건수 */
				    M1.USR_NAM     AS USER_NM
				   ,M1.CNB         AS CNB
				   ,M1.USR_NAM ||'(' || M1.CNB || ')' AS USER_ID
			       ,F_DPT_INFO(F_USR_INFO(M1.CNB,'5'),'1')      AS DPT_NM
			       ,D3.FOLDER_NAME AS FOLDER_NM
			       ,D2.REPORT_NAME AS REPORT_NM
			       ,TO_CHAR(D1.LOG_TIME,'YYYY-MM-DD') AS LOG_TIME
			       ,COUNT(*)       AS REPORT_CNT
			  FROM MTX_LOG D1
		INNER JOIN TBDCMACM001M M1
				ON SUBSTR(D1.USER_CODE,1,4) = M1.CNB
		]]>
	 		  <isNotEmpty prepend="AND" property="strUserNm">
			   M1.USR_NAM LIKE '%'||#strUserNm#||'%' /* 검색조건:사용자명 */
			  </isNotEmpty>
              <isNotEmpty prepend="AND" property="strDptNm"> 
			   F_DPT_INFO(F_USR_INFO(M1.CNB,'5'),'1') LIKE '%'||#strDptNm#||'%' /* 검색조건:부서 */
			  </isNotEmpty>
		INNER JOIN MTX_REPORT D2
				ON D1.LOG_ATTRIBUTE1 = D2.REPORT_CODE
		INNER JOIN MTX_FOLDER D3
			    ON D2.FOLDER_CODE = D3.FOLDER_CODE 
			 WHERE 1=1
			  <isNotEmpty prepend="AND" property="strFrom">  
			   D1.LOG_TIME BETWEEN TO_DATE(#strFrom#||'000000','YYYYMMDDHH24MISS') AND TO_DATE(#strTo#||'235959','YYYYMMDDHH24MISS') /* 검색조건:기간 */
			  </isNotEmpty>	 
			   AND D1.LOGTYPE_CODE = 40  
			 GROUP BY   M1.USR_NAM
					   ,M1.CNB
				       ,D3.FOLDER_NAME
				       ,D2.REPORT_NAME
				       ,TO_CHAR(D1.LOG_TIME,'YYYY-MM-DD')
</select>		
	
</sqlMap> 
