<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/cmr/020">
	<!-- 법령모니터링관리(법무) 조회한다. -->
	<select id="BADCMR020Emainselect" parameterClass="paramMap" resultClass="resultMap">
		<include refid = "include.pageSelct"/>
		<![CDATA[   
			SELECT LAW_YE || '-' || LAW_MNT_SNO AS LAW_YE_SNO /*NO*/
			     , CASE WHEN #strDtKind# = '01' THEN DECODE(MTRL_OGN_DT, NULL, NULL, SUBSTR(MTRL_OGN_DT, 1, 4) || '.' || SUBSTR(MTRL_OGN_DT, 5, 2) || '.' || SUBSTR(MTRL_OGN_DT, 7, 2))                     /*발생일자-자료발생일*/
			            WHEN #strDtKind# = '02' THEN DECODE(CAT_DT, NULL, NULL, SUBSTR(CAT_DT, 1, 4) || '.' || SUBSTR(CAT_DT, 5, 2) || '.' || SUBSTR(CAT_DT, 7, 2))                                         /*분류일자-분류일*/
			            WHEN #strDtKind# = '03' THEN DECODE(BLE_DIV_ACP_DT, NULL, NULL, SUBSTR(BLE_DIV_ACP_DT, 1, 4) || '.' || SUBSTR(BLE_DIV_ACP_DT, 5, 2) || '.' || SUBSTR(BLE_DIV_ACP_DT, 7, 2))         /*분류접수일자-총괄과 접수일*/
			            WHEN #strDtKind# = '04' THEN DECODE(OPIN_SMT_DT, NULL, NULL, SUBSTR(OPIN_SMT_DT, 1, 4) || '.' || SUBSTR(OPIN_SMT_DT, 5, 2) || '.' || SUBSTR(OPIN_SMT_DT, 7, 2))                     /*의견제출일자-의견제출일*/
			            WHEN #strDtKind# = '05' THEN DECODE(OPIN_ACP_DT, NULL, NULL, SUBSTR(OPIN_ACP_DT, 1, 4) || '.' || SUBSTR(OPIN_ACP_DT, 5, 2) || '.' || SUBSTR(OPIN_ACP_DT, 7, 2))                     /*의견접수일자-의견저접수일*/
			            WHEN #strDtKind# = '06' THEN DECODE(RPL_RQS_DT, NULL, NULL, SUBSTR(RPL_RQS_DT, 1, 4) || '.' || SUBSTR(RPL_RQS_DT, 5, 2) || '.' || SUBSTR(RPL_RQS_DT, 7, 2))                         /*회신요청일자-회신요청일*/
			            WHEN #strDtKind# = '07' THEN DECODE(RPL_RQS_ACP_DT, NULL, NULL, SUBSTR(RPL_RQS_ACP_DT, 1, 4) || '.' || SUBSTR(RPL_RQS_ACP_DT, 5, 2) || '.' || SUBSTR(RPL_RQS_ACP_DT, 7, 2))         /*회신요청저접수일자-회신요청접수일*/
			            WHEN #strDtKind# = '08' THEN DECODE(HNDL_OPIN_RPL_DT, NULL, NULL, SUBSTR(HNDL_OPIN_RPL_DT, 1, 4) || '.' || SUBSTR(HNDL_OPIN_RPL_DT, 5, 2) || '.' || SUBSTR(HNDL_OPIN_RPL_DT, 7, 2)) /*처리의견회신일-처리의견회신일*/
			            WHEN #strDtKind# = '09' THEN DECODE(OPIN_DTM_DT, NULL, NULL, SUBSTR(OPIN_DTM_DT, 1, 4) || '.' || SUBSTR(OPIN_DTM_DT, 5, 2) || '.' || SUBSTR(OPIN_DTM_DT, 7, 2))                     /*의견확정일자-의견확정일*/
			            WHEN #strDtKind# = '10' THEN DECODE(CBT_CFR_BILL_DT, NULL, NULL, SUBSTR(CBT_CFR_BILL_DT, 1, 4) || '.' || SUBSTR(CBT_CFR_BILL_DT, 5, 2) || '.' || SUBSTR(CBT_CFR_BILL_DT, 7, 2))     /*사후개시일자-국무회의상정일*/
			            WHEN #strDtKind# = '11' THEN DECODE(EXPOT_HNDL_HNDL_OPIN_RPL_DT, NULL, NULL, SUBSTR(EXPOT_HNDL_HNDL_OPIN_RPL_DT, 1, 4) || '.' || SUBSTR(EXPOT_HNDL_HNDL_OPIN_RPL_DT, 5, 2) || '.' || SUBSTR(EXPOT_HNDL_HNDL_OPIN_RPL_DT, 7, 2)) /*사후처리의견회신일-사후처리 처리의견 회신일*/
			            WHEN #strDtKind# = '12' THEN DECODE(CPLT_DT, NULL, NULL, SUBSTR(CPLT_DT, 1, 4) || '.' || SUBSTR(CPLT_DT, 5, 2) || '.' || SUBSTR(CPLT_DT, 7, 2))                                     /*완결일자-완결일*/
			            ELSE '' END                                                          AS DT_KIND             /*발생일자*/
			      , F_CODE_NM('1000253', MTRL_CAT_CD)                                        AS MTRL_CAT_NM         /*자료구분*/
			      , F_DPT_INFO(NVL(CHGD_DPT_CD, BLE_DIV_DPT_CD),'1')                         AS DPT_NM              /*소관과*/
			      , NVL2(CHGD_DPT_CD, 1, 2)                                                  AS DPT_NM_COLOR        /*담당과부서코드가 있으면 검정색 없으면 빨간색 */
			      , (SELECT ORG_NM FROM TBDCMACM015M WHERE ORG_CD = TBBADCMR011M.COPT_GD_CD) AS COPT_GD_NM          /*소관기관*/
			      , CASE WHEN LAW_KND_CD IS NOT NULL THEN '('|| F_CODE_NM('1000254',LAW_KND_CD) || ')' || MNT_TIT_NM               
			             ELSE MNT_TIT_NM END                                                 AS MNT_TIT_NM          /*모니터링 사항*/
			      , F_CODE_NM('1000256', AUD_MNT_HNDL_STA_CD)                                AS AUD_MNT_HNDL_STA_NM /*처리상태*/
			      , AUD_MNT_HNDL_STA_CD                                                      AS AUD_MNT_HNDL_STA_CD /*처리상태코드*/
			      , NVL2(TRIM(REL_EPS_MNG_LAW_YE), 'O', 'X')                                 AS REL_EPS_MNG_LAW_YE  /*중점*/
			      , DECODE(NVL(HNDL_OPIN_YO, 'N'), 'Y', 'O', 'X')                            AS HNDL_OPIN_YO        /*의견*/
			      , NVL2(TRIM(HNDL_OPIN_RPL_DT), 'O', '')                                    AS HNDL_OPIN_RPL_YN    /*회신*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-001') AS DOC_ID_1 /*모니터링내용 첨부파일*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-002') AS DOC_ID_2 /*총괄과 처리의견 첨부파일*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-003') AS DOC_ID_3 /*소관과 처리의견 첨부파일*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-004') AS DOC_ID_4 /*국무회의첨부파일*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-005') AS DOC_ID_5 /*총괄과 사후처리내용 첨부파일*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-006') AS DOC_ID_6 /*소관과 사후처리내용 첨부파일*/
			      , LAW_YE
			      , LAW_MNT_SNO
			      , MTRL_CAT_CD
			      , CHGD_DPT_CD /*담당과부서코드*/
			 FROM TBBADCMR011M 
		    WHERE 1 = 1
		]]>
		<dynamic prepend="AND">
			<isNotEmpty property="strAudMntHndStaCd">
				AUD_MNT_HNDL_STA_CD IN
					<iterate property="strAudMntHndStaCd" open="(" close=")" conjunction=",">
						#strAudMntHndStaCd[]#
					</iterate>
			</isNotEmpty>
			<isEmpty property="strAudMntHndStaCd">
				NVL(AUD_MNT_HNDL_STA_CD, 'N') = 'N'
			</isEmpty>
		</dynamic>
		<isNotEmpty property="strHndlOpinYo">
			AND HNDL_OPIN_YO = #strHndlOpinYo#  /*의견구분*/ 
		</isNotEmpty>
		<isNotEmpty property="strHndlOpinRplDt">
			AND NVL2(TRIM(HNDL_OPIN_RPL_DT), 'Y', 'N') = #strHndlOpinRplDt# /*회신여부*/
		</isNotEmpty>
		<isNotEmpty property="strExpotHndlRfcYnCd">
			AND EXPOT_HNDL_RFC_YN_CD = #strExpotHndlRfcYnCd# /*사후처리구분 - 조회조건(의견반영여부) */
		</isNotEmpty>
		<!-- 일자 범위마다 조건 컬럼들이 달라진다. 시작 -->
		<isEqual property="strDtKind" compareValue="01">
			<isNotEmpty property="strFromDt">
				AND MTRL_OGN_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND MTRL_OGN_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="02">
			<isNotEmpty property="strFromDt">
				AND CAT_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND CAT_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="03">
			<isNotEmpty property="strFromDt">
				AND ( BLE_DIV_ACP_DT <![CDATA[ >= ]]> #strFromDt# OR COPT_DIV_ACP_DT <![CDATA[ >= ]]> #strFromDt# )
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND ( BLE_DIV_ACP_DT <![CDATA[ <= ]]> #strToDT# OR COPT_DIV_ACP_DT <![CDATA[ <= ]]> #strFromDt# )
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="04">
			<isNotEmpty property="strFromDt">
				AND OPIN_SMT_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND OPIN_SMT_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="05">
			<isNotEmpty property="strFromDt">
				AND OPIN_ACP_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND OPIN_ACP_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="06">
			<isNotEmpty property="strFromDt">
				AND RPL_RQS_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND RPL_RQS_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="07">
			<isNotEmpty property="strFromDt">
				AND RPL_RQS_ACP_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND RPL_RQS_ACP_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="08">
			<isNotEmpty property="strFromDt">
				AND HNDL_OPIN_RPL_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND HNDL_OPIN_RPL_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="09">
			<isNotEmpty property="strFromDt">
				AND OPIN_DTM_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND OPIN_DTM_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="10">
			<isNotEmpty property="strFromDt">
				AND CBT_CFR_BILL_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND CBT_CFR_BILL_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="11">
			<isNotEmpty property="strFromDt">
				AND EXPOT_HNDL_HNDL_OPIN_RPL_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND EXPOT_HNDL_HNDL_OPIN_RPL_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="12">
			<isNotEmpty property="strFromDt">
				AND CPLT_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND CPLT_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<!-- 일자 범위마다 조건 컬럼들이 달라진다. 끝 -->
		<isNotEmpty property="strCbtCfrBillDt">
			AND NVL2(TRIM(CBT_CFR_BILL_DT), 'Y', 'N') = #strCbtCfrBillDt# /*국무회의 상정여부*/
		</isNotEmpty>
		<isNotEmpty property="strRelDpsMngLawYe">
			AND NVL2(TRIM(REL_EPS_MNG_LAW_YE), 'Y', 'N') = #strRelDpsMngLawYe# /*중점관리법령 대상여부*/
		</isNotEmpty>
		<isNotEmpty property="strMtrlCatCd">
			AND MTRL_CAT_CD = #strMtrlCatCd# /*발생구분*/
		</isNotEmpty>
		<isNotEmpty property="strDptCd">
		    AND CHGD_DPT_CD LIKE CASE WHEN SUBSTR(#strDptCd#, 4, 3) = '000' THEN SUBSTR(#strDptCd#, 1, 3)  
			                          ELSE #strDptCd# END || '%' /*소관과*/
		</isNotEmpty>
		<isNotEmpty property="strCnbNum">
			AND ( BLE_DIV_CHGR_CNB = #strCnbNum# OR COPT_DIV_CHGR_CNB = #strCnbNum#) /*담당자*/
		</isNotEmpty>
		<isNotEmpty property="strCoptGdCd">
			AND COPT_GD_CD = #strCoptGdCd# /*소관기관*/
		</isNotEmpty>
		<isNotEmpty property="strAtCpltYn">
			AND NVL(AT_CPLT_YN, 'N') = #strAtCpltYn# /*자동완결여부*/
		</isNotEmpty>
		<isNotEmpty property="strLawNm">
			AND (  UPPER(TRIM(LAW_KND_CD)) LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%' OR UPPER(TRIM(MNT_TIT_NM))  like '%' || UPPER(TRIM(#strLawNm#)) ||'%'  
			    OR UPPER(TRIM(MNT_TXT))    LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%' OR UPPER(TRIM(CBT_CFR_TXT)) like '%' || UPPER(TRIM(#strLawNm#)) ||'%'   
			    OR UPPER(TRIM(BLE_DIV_HNDL_OPIN_TXT))  LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%'  OR  UPPER(TRIM(COPT_DIV_HNDL_OPIN_TXT))  LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%'   
			    OR UPPER(TRIM(BLE_DIV_EXPOT_HNDL_TXT)) LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%'  OR  UPPER(TRIM(COPT_DIV_EXPOT_HNDL_TXT)) LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%'  )  /*법령명(검색어)*/ 
		</isNotEmpty>
		<include refid = "include.pageOrder"/>   
	</select>
	
	<!-- 목록 삭제 -->
	<delete id="BADCMR020Emaindelete" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBBADCMR011M
			 WHERE LAW_YE      = #LAW_YE#
			   AND LAW_MNT_SNO = #LAW_MNT_SNO#		
		]]>
	</delete>
	
	<!-- 법령모니터링첨부파일기본(TBBADCMR012M) 삭제 -->
	<update id="BADCMR020EFiledelete" parameterClass="paramMap">
		<![CDATA[   
			DELETE FROM TBBADCMR012M
			 WHERE LAW_YE      = #LAW_YE#
			   AND LAW_MNT_SNO = #LAW_MNT_SNO#
		]]>
	</update>
	
	<!-- 자동완결전 자동완결 할 데이터 건수를 체크한다. -->
	<select id="BADCMR020EmainAtCpltYnuCntselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBBADCMR011M
			 WHERE CPLT_DT IS NULL 
			   AND 'Y' = (CASE WHEN MTRL_CAT_CD = '1' AND TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMMDD')) - TO_NUMBER(REGI_DT) >= (SELECT TO_NUMBER(USR_DFN_TXT_1) FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000253' AND CD = '1') THEN 'Y' /*의견조회 :14일*/
			                   WHEN MTRL_CAT_CD = '2' AND TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMMDD')) - TO_NUMBER(REGI_DT) >= (SELECT TO_NUMBER(USR_DFN_TXT_1) FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000253' AND CD = '2') THEN 'Y' /*입법예고 :40일*/
			                   WHEN MTRL_CAT_CD = '3' AND TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMMDD')) - TO_NUMBER(REGI_DT) >= (SELECT TO_NUMBER(USR_DFN_TXT_1) FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000253' AND CD = '3') THEN 'Y' /*차관국무회의상정법안 :7일*/
			                   ELSE 'N' END)	
		]]>
	</select>
	
	<!-- 자동완결 -->
	<update id="BADCMR020EmainAtCpltYnupdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBBADCMR011M
			   SET AT_CPLT_YN             = 'Y' /*자동완결여부*/
			     , BLE_DIV_HNDL_OPIN_TXT  = NVL(BLE_DIV_HNDL_OPIN_TXT, '의견없음(자동)')  /*총괄과처리의견내용*/
			     , COPT_DIV_HNDL_OPIN_TXT = NVL(COPT_DIV_HNDL_OPIN_TXT, '의견없음(자동)') /*소관과처리의견내용*/
			     , FNL_MDF_DH             = SYSDATE
			     , CPLT_DT                = TO_CHAR(SYSDATE, 'YYYYMMDD') /*완결일*/
			     , AUD_MNT_HNDL_STA_CD    = '91' /*감사모니터링 처리상태코드 완결*/
		]]>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD =
			#FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		<![CDATA[		
			 WHERE CPLT_DT IS NULL 
			   AND 'Y' = (CASE WHEN MTRL_CAT_CD = '1' AND TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMMDD')) - TO_NUMBER(REGI_DT) >= (SELECT TO_NUMBER(USR_DFN_TXT_1) FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000253' AND CD = '1') THEN 'Y' /*의견조회 :14일*/
			                   WHEN MTRL_CAT_CD = '2' AND TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMMDD')) - TO_NUMBER(REGI_DT) >= (SELECT TO_NUMBER(USR_DFN_TXT_1) FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000253' AND CD = '2') THEN 'Y' /*입법예고 :40일*/
			                   WHEN MTRL_CAT_CD = '3' AND TO_NUMBER(TO_CHAR(SYSDATE, 'YYYYMMDD')) - TO_NUMBER(REGI_DT) >= (SELECT TO_NUMBER(USR_DFN_TXT_1) FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000253' AND CD = '3') THEN 'Y' /*차관국무회의상정법안 :7일*/
			                   ELSE 'N' END)	
		]]>
	</update>
	
	<!-- 소관부처명이 있을경우 명으로 총괄과부서코드, 담당과부서코드, 소관부처코드를 가져온다. -->
	<select id="BADCMR020ERssdptCdselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT D1.ORG_CD AS COPT_GD_CD /*소관부처코드*/
			     , D1.ENFM_DPT_CD AS CHGD_DPT_CD /*담당과부서코드*/
			     , D2.DPT_CD AS BLE_DIV_DPT_CD /*총괄과부서코드*/
			  FROM TBDCMACM015M D1
			     , (
			   SELECT DPT_CD
			        , HIRK_DPT_CD
			     FROM TBDCMACM002M
			    WHERE 1 = 1
			      AND ( DPT_CD LIKE '__0100' 
			             OR ( DPT_CD > '1' AND DPT_CD < '7' AND DPT_CD NOT LIKE '__0000' AND SUBSTR(DPT_CD,4,2) >= '10' ))
			      AND USE_YN ='Y' 
			     )D2			     
			 WHERE SUBSTR(D1.ENFM_DPT_CD,1,3)||'000' = D2.HIRK_DPT_CD (+)
			   AND D1.ORG_NM = TRIM(#strCoptGdCdNm#)
			   AND D1.USE_DVSN_NO = 'Y'
		]]>
	</select>
		
	<!-- 소관부처명이 있을경우 명으로 총괄과부서코드, 담당과부서코드, 소관부처코드를 가져온다. -->
	<select id="BADCMR020ERssdptCdselect_backup" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT D1.ORG_CD AS COPT_GD_CD /*소관부처코드*/
			     , D3.DPT_CD AS CHGD_DPT_CD /*담당과부서코드*/
			     , D2.DPT_CD AS BLE_DIV_DPT_CD /*총괄과부서코드*/
			  FROM TBDCMACM015M D1
			     , (
			   SELECT DPT_CD
			        , HIRK_DPT_CD
			     FROM TBDCMACM002M
			    WHERE 1 = 1
			      AND ( DPT_CD LIKE '__0100' 
			             OR ( DPT_CD > '1' AND DPT_CD < '7' AND DPT_CD NOT LIKE '__0000' AND SUBSTR(DPT_CD,4,2) >= '10' ))
			      AND USE_YN ='Y' 
			     )D2
			     , (
			    SELECT DPT_CD 
			         , HIRK_DPT_CD
			      FROM TBDCMACM002M
			     WHERE 1=1 
			       AND DPT_CD LIKE '0%' AND SUBSTR(DPT_CD,4,2) > '10'
			       AND USE_YN ='Y'
			     ) D3			     
			 WHERE SUBSTR(D1.ENFM_DPT_CD,1,3)||'000' = D2.HIRK_DPT_CD (+)
			   AND SUBSTR(D1.ENFM_DPT_CD,1,3)||'000' = D3.HIRK_DPT_CD (+)
			   AND D1.ORG_NM = TRIM(#strCoptGdCdNm#)
			   AND D1.USE_DVSN_NO = 'Y'
		]]>
	</select>
	
	<!-- RSS연동해서 가져온 데이터 INSERT 하기전에 중복데이터 체크하기. -->
	<select id="BADCMR020ERssCntselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(COUNT(*)) AS CNT
			  FROM TBBADCMR011M 
			 WHERE UPPER(TRIM(MNT_TIT_NM)) = UPPER(TRIM(#MNT_TIT_NM#))
		]]>
	</select>

 	<!-- RSS 연동으로 신규등록 -->
	<insert id="BADCMR020ERssmaininsert" parameterClass="paramMap">
		INSERT INTO TBBADCMR011M 
		    (
		        LAW_YE
		      , LAW_MNT_SNO
		      , MTRL_CAT_CD
		      , MTRL_OGN_DT
		      , AUD_MNT_HNDL_STA_CD
		      , BLE_DIV_DPT_CD
		      , CHGD_DPT_CD
		      , COPT_GD_CD
		      , LAW_KND_CD
		      , MNT_TIT_NM
		      , MNT_TXT
		      , MNT_URL_AD
		      , REGI_DT
			  , FRT_USR_ID
			  , FNL_USR_ID
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID
			  , FRT_REGI_DH
			  , FNL_MDF_DH		      
		   )
		VALUES
		    (   TO_CHAR(SYSDATE, 'YYYY')
		      , (SELECT NVL(MAX(LAW_MNT_SNO), 0) +1 FROM TBBADCMR011M WHERE LAW_YE = TO_CHAR(SYSDATE, 'YYYY'))
		      , '2' /*입법예고*/
		      , TO_CHAR(SYSDATE, 'YYYYMMDD')
		      , #AUD_MNT_HNDL_STA_CD#
		      , #BLE_DIV_DPT_CD#
		      , #CHGD_DPT_CD#
		      , #COPT_GD_CD#
		      , #LAW_KND_CD#
		      , #MNT_TIT_NM#
		      , TRIM(SUBSTRB(#MNT_TXT#, 0, 4000))
		      , #MNT_URL_AD# 
		      , TO_CHAR(SYSDATE, 'YYYYMMDD')
			  , #FRT_USR_ID#
			  , #FNL_USR_ID#
			  , #FNL_DEAL_DPT_CD#
			  , #FNL_MNU_ID#
			  , SYSDATE
			  , SYSDATE		      
		   )
	</insert>
	
	
	<select id="badcmr020ExcelSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[   
			SELECT LAW_YE || '-' || LAW_MNT_SNO AS LAW_YE_SNO /*NO*/
			     , CASE WHEN #strDtKind# = '01' THEN DECODE(MTRL_OGN_DT, NULL, NULL, SUBSTR(MTRL_OGN_DT, 1, 4) || '.' || SUBSTR(MTRL_OGN_DT, 5, 2) || '.' || SUBSTR(MTRL_OGN_DT, 7, 2))                     /*발생일자-자료발생일*/
			            WHEN #strDtKind# = '02' THEN DECODE(CAT_DT, NULL, NULL, SUBSTR(CAT_DT, 1, 4) || '.' || SUBSTR(CAT_DT, 5, 2) || '.' || SUBSTR(CAT_DT, 7, 2))                                         /*분류일자-분류일*/
			            WHEN #strDtKind# = '03' THEN DECODE(BLE_DIV_ACP_DT, NULL, NULL, SUBSTR(BLE_DIV_ACP_DT, 1, 4) || '.' || SUBSTR(BLE_DIV_ACP_DT, 5, 2) || '.' || SUBSTR(BLE_DIV_ACP_DT, 7, 2))         /*분류접수일자-총괄과 접수일*/
			            WHEN #strDtKind# = '04' THEN DECODE(OPIN_SMT_DT, NULL, NULL, SUBSTR(OPIN_SMT_DT, 1, 4) || '.' || SUBSTR(OPIN_SMT_DT, 5, 2) || '.' || SUBSTR(OPIN_SMT_DT, 7, 2))                     /*의견제출일자-의견제출일*/
			            WHEN #strDtKind# = '05' THEN DECODE(OPIN_ACP_DT, NULL, NULL, SUBSTR(OPIN_ACP_DT, 1, 4) || '.' || SUBSTR(OPIN_ACP_DT, 5, 2) || '.' || SUBSTR(OPIN_ACP_DT, 7, 2))                     /*의견접수일자-의견저접수일*/
			            WHEN #strDtKind# = '06' THEN DECODE(RPL_RQS_DT, NULL, NULL, SUBSTR(RPL_RQS_DT, 1, 4) || '.' || SUBSTR(RPL_RQS_DT, 5, 2) || '.' || SUBSTR(RPL_RQS_DT, 7, 2))                         /*회신요청일자-회신요청일*/
			            WHEN #strDtKind# = '07' THEN DECODE(RPL_RQS_ACP_DT, NULL, NULL, SUBSTR(RPL_RQS_ACP_DT, 1, 4) || '.' || SUBSTR(RPL_RQS_ACP_DT, 5, 2) || '.' || SUBSTR(RPL_RQS_ACP_DT, 7, 2))         /*회신요청저접수일자-회신요청접수일*/
			            WHEN #strDtKind# = '08' THEN DECODE(HNDL_OPIN_RPL_DT, NULL, NULL, SUBSTR(HNDL_OPIN_RPL_DT, 1, 4) || '.' || SUBSTR(HNDL_OPIN_RPL_DT, 5, 2) || '.' || SUBSTR(HNDL_OPIN_RPL_DT, 7, 2)) /*처리의견회신일-처리의견회신일*/
			            WHEN #strDtKind# = '09' THEN DECODE(OPIN_DTM_DT, NULL, NULL, SUBSTR(OPIN_DTM_DT, 1, 4) || '.' || SUBSTR(OPIN_DTM_DT, 5, 2) || '.' || SUBSTR(OPIN_DTM_DT, 7, 2))                     /*의견확정일자-의견확정일*/
			            WHEN #strDtKind# = '10' THEN DECODE(CBT_CFR_BILL_DT, NULL, NULL, SUBSTR(CBT_CFR_BILL_DT, 1, 4) || '.' || SUBSTR(CBT_CFR_BILL_DT, 5, 2) || '.' || SUBSTR(CBT_CFR_BILL_DT, 7, 2))     /*사후개시일자-국무회의상정일*/
			            WHEN #strDtKind# = '11' THEN DECODE(EXPOT_HNDL_HNDL_OPIN_RPL_DT, NULL, NULL, SUBSTR(EXPOT_HNDL_HNDL_OPIN_RPL_DT, 1, 4) || '.' || SUBSTR(EXPOT_HNDL_HNDL_OPIN_RPL_DT, 5, 2) || '.' || SUBSTR(EXPOT_HNDL_HNDL_OPIN_RPL_DT, 7, 2)) /*사후처리의견회신일-사후처리 처리의견 회신일*/
			            WHEN #strDtKind# = '12' THEN DECODE(CPLT_DT, NULL, NULL, SUBSTR(CPLT_DT, 1, 4) || '.' || SUBSTR(CPLT_DT, 5, 2) || '.' || SUBSTR(CPLT_DT, 7, 2))                                     /*완결일자-완결일*/
			            ELSE '' END                                                          AS DT_KIND             /*발생일자*/
			      , F_CODE_NM('1000253', MTRL_CAT_CD)                                        AS MTRL_CAT_NM         /*자료구분*/
			      , F_DPT_INFO(NVL(CHGD_DPT_CD, BLE_DIV_DPT_CD),'1')                         AS DPT_NM              /*소관과*/
			      , NVL2(CHGD_DPT_CD, 1, 2)                                                  AS DPT_NM_COLOR        /*담당과부서코드가 있으면 검정색 없으면 빨간색 */
			      , (SELECT ORG_NM FROM TBDCMACM015M WHERE ORG_CD = TBBADCMR011M.COPT_GD_CD) AS COPT_GD_NM          /*소관기관*/
			      , CASE WHEN LAW_KND_CD IS NOT NULL THEN '('|| F_CODE_NM('1000254',LAW_KND_CD) || ')' || MNT_TIT_NM               
			             ELSE MNT_TIT_NM END                                                 AS MNT_TIT_NM          /*모니터링 사항*/
			      , F_CODE_NM('1000256', AUD_MNT_HNDL_STA_CD)                                AS AUD_MNT_HNDL_STA_NM /*처리상태*/
			      , AUD_MNT_HNDL_STA_CD                                                      AS AUD_MNT_HNDL_STA_CD /*처리상태코드*/
			      , NVL2(TRIM(REL_EPS_MNG_LAW_YE), 'O', 'X')                                 AS REL_EPS_MNG_LAW_YE  /*중점*/
			      , DECODE(NVL(HNDL_OPIN_YO, 'N'), 'Y', 'O', 'X')                            AS HNDL_OPIN_YO        /*의견*/
			      , NVL2(TRIM(HNDL_OPIN_RPL_DT), 'O', '')                                    AS HNDL_OPIN_RPL_YN    /*회신*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-001') AS DOC_ID_1 /*모니터링내용 첨부파일*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-002') AS DOC_ID_2 /*총괄과 처리의견 첨부파일*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-003') AS DOC_ID_3 /*소관과 처리의견 첨부파일*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-004') AS DOC_ID_4 /*국무회의첨부파일*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-005') AS DOC_ID_5 /*총괄과 사후처리내용 첨부파일*/
			      , (SELECT DOC_ID FROM TBBADCMR012M WHERE LAW_YE = TBBADCMR011M.LAW_YE AND LAW_MNT_SNO = TBBADCMR011M.LAW_MNT_SNO AND DOC_TYP_CD = 'AD-MR-006') AS DOC_ID_6 /*소관과 사후처리내용 첨부파일*/
			      , LAW_YE
			      , LAW_MNT_SNO
			      , MTRL_CAT_CD
			      , CHGD_DPT_CD /*담당과부서코드*/
			 FROM TBBADCMR011M 
		    WHERE 1 = 1
		]]>
		<dynamic prepend="AND">
			<isNotEmpty property="strAudMntHndStaCd">
				AUD_MNT_HNDL_STA_CD IN
					<iterate property="strAudMntHndStaCd" open="(" close=")" conjunction=",">
						#strAudMntHndStaCd[]#
					</iterate>
			</isNotEmpty>
			<isEmpty property="strAudMntHndStaCd">
				NVL(AUD_MNT_HNDL_STA_CD, 'N') = 'N'
			</isEmpty>
		</dynamic>
		<isNotEmpty property="strHndlOpinYo">
			AND HNDL_OPIN_YO = #strHndlOpinYo#  /*의견구분*/ 
		</isNotEmpty>
		<isNotEmpty property="strHndlOpinRplDt">
			AND NVL2(TRIM(HNDL_OPIN_RPL_DT), 'Y', 'N') = #strHndlOpinRplDt# /*회신여부*/
		</isNotEmpty>
		<isNotEmpty property="strExpotHndlRfcYnCd">
			AND EXPOT_HNDL_RFC_YN_CD = #strExpotHndlRfcYnCd# /*사후처리구분 - 조회조건(의견반영여부) */
		</isNotEmpty>
		<!-- 일자 범위마다 조건 컬럼들이 달라진다. 시작 -->
		<isEqual property="strDtKind" compareValue="01">
			<isNotEmpty property="strFromDt">
				AND MTRL_OGN_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND MTRL_OGN_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="02">
			<isNotEmpty property="strFromDt">
				AND CAT_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND CAT_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="03">
			<isNotEmpty property="strFromDt">
				AND ( BLE_DIV_ACP_DT <![CDATA[ >= ]]> #strFromDt# OR COPT_DIV_ACP_DT <![CDATA[ >= ]]> #strFromDt# )
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND ( BLE_DIV_ACP_DT <![CDATA[ <= ]]> #strToDT# OR COPT_DIV_ACP_DT <![CDATA[ <= ]]> #strFromDt# )
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="04">
			<isNotEmpty property="strFromDt">
				AND OPIN_SMT_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND OPIN_SMT_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="05">
			<isNotEmpty property="strFromDt">
				AND OPIN_ACP_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND OPIN_ACP_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="06">
			<isNotEmpty property="strFromDt">
				AND RPL_RQS_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND RPL_RQS_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="07">
			<isNotEmpty property="strFromDt">
				AND RPL_RQS_ACP_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND RPL_RQS_ACP_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="08">
			<isNotEmpty property="strFromDt">
				AND HNDL_OPIN_RPL_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND HNDL_OPIN_RPL_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="09">
			<isNotEmpty property="strFromDt">
				AND OPIN_DTM_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND OPIN_DTM_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="10">
			<isNotEmpty property="strFromDt">
				AND CBT_CFR_BILL_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND CBT_CFR_BILL_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="11">
			<isNotEmpty property="strFromDt">
				AND EXPOT_HNDL_HNDL_OPIN_RPL_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND EXPOT_HNDL_HNDL_OPIN_RPL_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<isEqual property="strDtKind" compareValue="12">
			<isNotEmpty property="strFromDt">
				AND CPLT_DT <![CDATA[ >= ]]> #strFromDt#
			</isNotEmpty> 
			<isNotEmpty property="strToDT">
				AND CPLT_DT <![CDATA[ <= ]]> #strToDT#
			</isNotEmpty> 
		</isEqual>
		<!-- 일자 범위마다 조건 컬럼들이 달라진다. 끝 -->
		<isNotEmpty property="strCbtCfrBillDt">
			AND NVL2(TRIM(CBT_CFR_BILL_DT), 'Y', 'N') = #strCbtCfrBillDt# /*국무회의 상정여부*/
		</isNotEmpty>
		<isNotEmpty property="strRelDpsMngLawYe">
			AND NVL2(TRIM(REL_EPS_MNG_LAW_YE), 'Y', 'N') = #strRelDpsMngLawYe# /*중점관리법령 대상여부*/
		</isNotEmpty>
		<isNotEmpty property="strMtrlCatCd">
			AND MTRL_CAT_CD = #strMtrlCatCd# /*발생구분*/
		</isNotEmpty>
		<isNotEmpty property="strDptCd">
			AND ( BLE_DIV_DPT_CD LIKE SUBSTR(#strDptCd#, 0,2) || '%' OR CHGD_DPT_CD LIKE SUBSTR(#strDptCd#, 0,2) || '%' ) /*소관과*/
		</isNotEmpty>
		<isNotEmpty property="strCnbNum">
			AND ( BLE_DIV_CHGR_CNB = #strCnbNum# OR COPT_DIV_CHGR_CNB = #strCnbNum#) /*담당자*/
		</isNotEmpty>
		<isNotEmpty property="strCoptGdCd">
			AND COPT_GD_CD = #strCoptGdCd#  /*소관기관*/
		</isNotEmpty>
		<isNotEmpty property="strAtCpltYn">
			AND NVL(AT_CPLT_YN, 'N') = #strAtCpltYn# /*자동완결여부*/
		</isNotEmpty>
		<isNotEmpty property="strLawNm">
			AND (  UPPER(TRIM(LAW_KND_CD)) LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%' OR UPPER(TRIM(MNT_TIT_NM))  like '%' || UPPER(TRIM(#strLawNm#)) ||'%'  
			    OR UPPER(TRIM(MNT_TXT))    LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%' OR UPPER(TRIM(CBT_CFR_TXT)) like '%' || UPPER(TRIM(#strLawNm#)) ||'%'   
			    OR UPPER(TRIM(BLE_DIV_HNDL_OPIN_TXT))  LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%'  OR  UPPER(TRIM(COPT_DIV_HNDL_OPIN_TXT))  LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%'   
			    OR UPPER(TRIM(BLE_DIV_EXPOT_HNDL_TXT)) LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%'  OR  UPPER(TRIM(COPT_DIV_EXPOT_HNDL_TXT)) LIKE '%' || UPPER(TRIM(#strLawNm#)) ||'%'  )  /*법령명(검색어)*/ 
		</isNotEmpty>
		
		ORDER BY LAW_YE DESC, LAW_MNT_SNO DESC
	</select>
	
	
	
	       
</sqlMap> 
