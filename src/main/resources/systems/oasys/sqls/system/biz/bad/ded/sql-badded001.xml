<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ded/001">

	<select id="BADDED001EDeptselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
			select DEPT_CD, DEPT_NM
			  from ebaiusr.CM_DEPT
			 where 1=1
         AND DEPT_CD like '%00'
			   and USE_YN = 'Y'
			 order by DEPT_CD 
        ]]>
	</select>
	   
	<!-- 감사사항 조회 팝업 - 2016.05.25 yyh -->
	<select id="BADDED001EPopInqMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[     
	    SELECT T1.AUD_YR           		AS AUD_YR           		/*감사년도*/
	         , T1.AUD_NO           		AS AUD_NO           		/*감사번호*/
	         , T1.AUD_GRN_NO       		AS AUD_GRN_NO         		/*감사부여번호*/
	         , T1.AUD_YR_N0        		AS AUD_YR_N0        		/*감사년번호*/
	         , T1.AUD_YR_NO_KND_CD      AS AUD_YR_NO_KND_CD         /*감사연번호종류코드*/
	         , T1.AUD_YR_NO_KND_NM      AS AUD_YR_NO_KND_NM         /*감사연번호종류코드명*/
	         , T1.AUD_TASK_CD      		AS AUD_TASK_CD      		/*감사과제코드*/
             , T1.AUD_TASK_NM      		AS AUD_TASK_NM      		
	         , T1.ORG_DVSN_CD      		AS ORG_DVSN_CD      		/*기관구분코드*/
	         , T1.AUD_KND_CD       		AS AUD_KND_CD       		/*감사종류코드*/
             , T1.AUD_KND_NM       		AS AUD_KND_NM       		
	         , T1.SPV_BRDV_CD      		AS SPV_BRDV_CD      		/*주관국과코드*/
	         , T1.SPV_BRDV_NM  			AS SPV_BRDV_NM  			/*주관국과명*/
	         , T1.AUD_WAY_CD       		AS AUD_WAY_CD       		/*감사방법코드*/
             , T1.AUD_WAY_NM       		AS AUD_WAY_NM       		
	         , T1.AUD_SBJ_NM       		AS AUD_SBJ_NM       		/*감사사항명*/
	         , T1.AUD_SCL_CD       		AS AUD_SCL_CD       		/*감사규모코드*/
	         , T1.TSK_CAT_CD       		AS TSK_CAT_CD       		/*업무분류코드*/
	         , T1.TSK_CAT_NM       		AS TSK_CAT_NM       		
	         , T1.EPS_TASK_CD      		AS EPS_TASK_CD      		/*중점과제코드*/
             , T1.EPS_TASK_NM      		AS EPS_TASK_NM      		
	         , T1.AUD_TOT_DRTR_CNB 		AS AUD_TOT_DRTR_CNB 		/*감사총책임자전산번호*/
	         , T1.TOT_DRTR_RANK_CD 		AS TOT_DRTR_RANK_CD 		/*총책임자직급코드*/
	         , T1.TOT_DRTR_BRDV_CD 		AS TOT_DRTR_BRDV_CD 		/*총책임자국과코드*/
	         , T1.AUD_RPST_ORG_CD  		AS AUD_RPST_ORG_CD  		/*감사대표기관코드*/
	         , T1.AUD_RPST_ORG_NM  		AS AUD_RPST_ORG_NM  		
	         , T1.SPVR_CNB         		AS SPVR_CNB         		/*주관자전산번호*/
	         , T1.SPVR_BRDV_CD     		AS SPVR_BRDV_CD     		/*주관자국과코드*/
	         , T1.SPVR_RANK_CD     		AS SPVR_RANK_CD     		/*주관자직급코드*/
	         , T1.AST_CNB          		AS AST_CNB          		/*보조자전산번호*/    
	         , T1.AST_BRDV_CD      		AS AST_BRDV_CD      		/*보조자국과코드*/
	         , T1.AST_RANK_CD      		AS AST_RANK_CD      		/*보조자직급코드*/
	         , T1.MNG_DPT_CD       		AS MNG_DPT_CD       		/*관리부서코드*/
	         , T1.MNG_DPT_NM			AS MNG_DPT_NM			    		         
		     , T1.ACP_YR 				AS ACP_YR 				    /*청구연도*/
		     , T1.CVPT_ACP_NO 			AS CVPT_ACP_NO 			    /*청구일련번호*/
		     , T1.REQ_DVSN_CD 			AS REQ_DVSN_CD 			    /*청구구분코드*/
		     , T1.TIT_NM 				AS TIT_NM 				    /*청구제목*/
             , T1.PRSS_STEP_CD          AS PRSS_STEP_CD             /*진행단계코드*/
             , T1.AUD_CTRL_CD           AS AUD_CTRL_CD              /*감사통제코드*/
             , T1.AUD_CTRL_NM           AS AUD_CTRL_NM              /*감사통제코드명*/
             , T1.BZT_BGT_DVSN_CD       AS BZT_BGT_DVSN_CD          /*예산구분코드*/
             , T1.BZT_BGT_DVSN_NM       AS BZT_BGT_DVSN_NM          /*예산구분명*/
             
          FROM (
          
			    SELECT D1.AUD_YR                   	AS AUD_YR           /*감사년도*/
			         , D1.AUD_NO                   	AS AUD_NO           /*감사번호*/
			         , D1.AUD_GRN_NO                AS AUD_GRN_NO       /*감사부여번호*/
			         , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-')
			                                        AS AUD_YR_N0        /*감사년번호 - 수정(2015.12.17-yyh)*/
			         , CASE WHEN D1.AUD_YR >= '2016' 
			                     THEN D1.AUD_KND_CD
			                ELSE '' 
			            END                         AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.18 yyh*/
			         , CASE WHEN D1.AUD_YR >= '2016' 
			                     THEN F_CODE_NM('1000739',D1.AUD_KND_CD)   
			                ELSE '-' 
			            END                         AS AUD_YR_NO_KND_NM /*감사연번호종류코드명 추가 - 2015.12.22 yyh*/			            
			         , D1.AUD_TASK_CD              	AS AUD_TASK_CD      /*감사과제코드*/
                     , F_CODE_NM_YEAR('1000008', D1.AUD_TASK_CD, D1.AUD_YR) AS AUD_TASK_NM 
			         , D1.ORG_DVSN_CD              	AS ORG_DVSN_CD      /*기관구분코드*/
			         , D1.AUD_KND_CD               	AS AUD_KND_CD       /*감사종류코드*/
                     , F_CODE_NM_YEAR('1000007', D1.AUD_KND_CD, D1.AUD_YR) AS AUD_KND_NM 
			         , D1.SPV_BRDV_CD              	AS SPV_BRDV_CD      /*주관국과코드*/
			         , F_DPT_INFO(D1.SPV_BRDV_CD,'1')	AS SPV_BRDV_NM  /*주관국과명*/
			         , D1.AUD_WAY_CD               	AS AUD_WAY_CD       /*감사방법코드*/
                     , F_CODE_NM_YEAR('1000009', D1.AUD_WAY_CD, D1.AUD_YR) AS AUD_WAY_NM 
			         , D1.AUD_SBJ_NM               	AS AUD_SBJ_NM       /*감사사항명*/
			         , D1.AUD_SCL_CD               	AS AUD_SCL_CD       /*감사규모코드*/
			         , D1.TSK_CAT_CD               	AS TSK_CAT_CD       /*업무분류코드*/
			         , F_CODE_NM('1000120',D1.TSK_CAT_CD) AS TSK_CAT_NM
			         , D1.EPS_TASK_CD             	AS EPS_TASK_CD      /*중점과제코드*/
                     , F_CODE_NM_YEAR('1000005', D1.EPS_TASK_CD, D1.AUD_YR) AS EPS_TASK_NM 
			         , D1.AUD_TOT_DRTR_CNB         	AS AUD_TOT_DRTR_CNB /*감사총책임자전산번호*/
			         , D1.TOT_DRTR_RANK_CD         	AS TOT_DRTR_RANK_CD /*총책임자직급코드*/
			         , D1.TOT_DRTR_BRDV_CD         	AS TOT_DRTR_BRDV_CD /*총책임자국과코드*/
			         , D1.AUD_RPST_ORG_CD          	AS AUD_RPST_ORG_CD  /*감사대표기관코드*/
			         , F_ORG_INFO(D1.AUD_RPST_ORG_CD,'1')  AS AUD_RPST_ORG_NM
			         , D1.SPVR_CNB                 	AS SPVR_CNB         /*주관자전산번호*/
			         , D1.SPVR_BRDV_CD             	AS SPVR_BRDV_CD     /*주관자국과코드*/
			         , D1.SPVR_RANK_CD            	AS SPVR_RANK_CD     /*주관자직급코드*/
			         , D1.AST_CNB                  	AS AST_CNB          /*보조자전산번호*/    
			         , D1.AST_BRDV_CD              	AS AST_BRDV_CD      /*보조자국과코드*/
			         , D1.AST_RANK_CD              	AS AST_RANK_CD      /*보조자직급코드*/
			         , D1.MNG_DPT_CD               	AS MNG_DPT_CD       /*관리부서코드*/
			         , F_DPT_INFO(D1.MNG_DPT_CD,'1') 		AS MNG_DPT_NM			         
				     , D1.ACP_YR 					AS ACP_YR 			/*청구연도*/
				     , D1.CVPT_ACP_NO 				AS CVPT_ACP_NO 		/*청구일련번호*/
				     , D1.REQ_DVSN_CD 				AS REQ_DVSN_CD 		/*청구구분코드*/
				     , D2.TIT_NM  					AS TIT_NM 			/*청구제목*/
			         , D1.AUD_CTRL_CD                          AS AUD_CTRL_CD      /*감사통제코드 - 2016.06.03 yyh */
			         , F_CODE_NM('1000753',D1.AUD_CTRL_CD)     AS AUD_CTRL_NM      /*감사통제코드명 - 2016.06.03 yyh */
			         
                	 /* 예산구분 추가 - 2016.06.16 yyh */
                	 , D1.BZT_BGT_DVSN_CD                      AS BZT_BGT_DVSN_CD
                	 , F_CODE_NM('1000751',D1.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM			         
 					 , D1.PRSS_STEP_CD                         AS PRSS_STEP_CD    /*진행단계코드*/         
				FROM TBBADDED001M D1
			       , TBCSPDCP101M D2
      			   , TBBADDED003M D3
			   WHERE 1=1
			     AND D1.ACP_YR        = D2.ACP_YR(+)
			     AND D1.CVPT_ACP_NO   = D2.CVPT_ACP_NO(+)
			     AND D1.REQ_DVSN_CD   = D2.REQ_DVSN_CD(+)
			     AND D1.AUD_YR 		  = D3.AUD_YR(+)
			     AND D1.AUD_NO 		  = D3.AUD_NO(+)	     
			     
		         /*AND D1.AUD_NO NOT LIKE '9%' 서면모니터링을 걸러내야하므로*/
		         AND D1.SPV_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#)))   /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/   		
		]]>
		<isNotEmpty property="strAudYr">	 
			     AND D1.AUD_YR      = #strAudYr#    
		</isNotEmpty>
		
		<isNotEmpty property="strAudYrNoKndCd">	 	
		     	 AND SUBSTR(D1.AUD_KND_CD,3,1) = SUBSTR(#strAudYrNoKndCd#,3,1) 
		</isNotEmpty>
		
		<isNotEmpty property="strAudNo">	 	
			     AND D1.AUD_GRN_NO = #strAudNo#
		</isNotEmpty>
		<isNotEmpty property="strAudSbjNm">	 	   
			     AND D1.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		
		<isNotEmpty property="strAudKndCd">	 
			     AND D1.AUD_KND_CD  = #strAudKndCd#
		</isNotEmpty>
		<isNotEmpty property="strSpvBrdvCd">	 
			     AND D1.SPV_BRDV_CD = #strSpvBrdvCd#
		</isNotEmpty>
		
		<isNotEmpty property="strAudCtrlYn">	 
			<isEqual property="strAudCtrlYn" compareValue="Y">
		         /*감사통제코드가 1:-(해당없음), 2:Y(통제)*/
			     AND D1.AUD_CTRL_CD IN ('1','2') 
			</isEqual>
		</isNotEmpty>
		
        <![CDATA[ 
        	) T1      
 			ORDER BY DECODE(SUBSTR(T1.AUD_GRN_NO,1,1),'9',2,1),T1.AUD_GRN_NO DESC 
        ]]>
	</select>
	
	<!--감사사항관리 조회 -->
	<select id="BADDED001EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     
	    SELECT T1.AUD_YR           		AS AUD_YR           		/*감사년도*/
	         , T1.AUD_NO           		AS AUD_NO           		/*감사번호*/
	         , T1.AUD_GRN_NO       		AS AUD_GRN_NO         		/*감사부여번호 - 2016.05.25 yyh*/
	         , T1.AUD_YR_N0        		AS AUD_YR_N0        		/*감사년번호*/
	         , T1.AUD_YR_NO_KND_CD      AS AUD_YR_NO_KND_CD         /*감사연번호종류코드*/
	         , T1.AUD_YR_NO_KND_NM      AS AUD_YR_NO_KND_NM         /*감사연번호종류코드명*/
	         , T1.AUD_DTL_NO    		AS AUD_DTL_NO    		    /*세부연번호*/
	         , T1.AUD_TASK_CD      		AS AUD_TASK_CD      		/*감사과제코드*/
             , T1.AUD_TASK_NM      		AS AUD_TASK_NM      		
	         , T1.ORG_DVSN_CD      		AS ORG_DVSN_CD      		/*기관구분코드*/
	         , T1.AUD_KND_CD       		AS AUD_KND_CD       		/*감사종류코드*/
             , T1.AUD_KND_NM       		AS AUD_KND_NM       		
	         , T1.SPV_BRDV_CD      		AS SPV_BRDV_CD      		/*주관국과코드*/
	         , T1.SPV_BRDV_NM  			AS SPV_BRDV_NM  			/*주관국과명*/
	         , T1.AUD_WAY_CD       		AS AUD_WAY_CD       		/*감사방법코드*/
             , T1.AUD_WAY_NM       		AS AUD_WAY_NM       		
	         , T1.AUD_SBJ_NM       		AS AUD_SBJ_NM       		/*감사사항명*/
	         , T1.AUD_SCL_CD       		AS AUD_SCL_CD       		/*감사규모코드*/
	         , T1.TSK_CAT_CD       		AS TSK_CAT_CD       		/*업무분류코드*/
	         , T1.TSK_CAT_NM       		AS TSK_CAT_NM       		
	         , T1.EPS_TASK_CD      		AS EPS_TASK_CD      		/*중점과제코드*/
             , T1.EPS_TASK_NM      		AS EPS_TASK_NM      		
	         , T1.AUD_TOT_DRTR_CNB 		AS AUD_TOT_DRTR_CNB 		/*감사총책임자전산번호*/
	         , T1.TOT_DRTR_RANK_CD 		AS TOT_DRTR_RANK_CD 		/*총책임자직급코드*/
	         , T1.TOT_DRTR_BRDV_CD 		AS TOT_DRTR_BRDV_CD 		/*총책임자국과코드*/
	         , T1.AUD_RPST_ORG_CD  		AS AUD_RPST_ORG_CD  		/*감사대표기관코드*/
	         , T1.AUD_RPST_ORG_NM  		AS AUD_RPST_ORG_NM  		
	         , T1.SPVR_CNB         		AS SPVR_CNB         		/*주관자전산번호*/
	         , T1.SPVR_BRDV_CD     		AS SPVR_BRDV_CD     		/*주관자국과코드*/
	         , T1.SPVR_RANK_CD     		AS SPVR_RANK_CD     		/*주관자직급코드*/
	         , T1.AST_CNB          		AS AST_CNB          		/*보조자전산번호*/    
	         , T1.AST_BRDV_CD      		AS AST_BRDV_CD      		/*보조자국과코드*/
	         , T1.AST_RANK_CD      		AS AST_RANK_CD      		/*보조자직급코드*/
	         , T1.MNG_DPT_CD       		AS MNG_DPT_CD       		/*관리부서코드*/
	         , T1.MNG_DPT_NM			AS MNG_DPT_NM			    		         
		     , T1.ACP_YR 				AS ACP_YR 				    /*청구연도*/
		     , T1.CVPT_ACP_NO 			AS CVPT_ACP_NO 			    /*청구일련번호*/
		     , T1.REQ_DVSN_CD 			AS REQ_DVSN_CD 			    /*청구구분코드*/
		     , T1.TIT_NM 				AS TIT_NM 				    /*청구제목*/
	         , T1.AUD_TOT_DRTR_NM       AS AUD_TOT_DRTR_NM          
	         , T1.AUD_TOT_DRTR_BRDV_NM  AS AUD_TOT_DRTR_BRDV_NM     
	         , T1.AUD_TOT_DRTR_RANK_NM  AS AUD_TOT_DRTR_RANK_NM     
	         , T1.SPVR_NM               AS SPVR_NM                  
	         , T1.SPVR_BRDV_NM          AS SPVR_BRDV_NM             
	         , T1.SPVR_RANK_NM          AS SPVR_RANK_NM             
	         , T1.AST_NM                AS AST_NM                   
	         , T1.AST_BRDV_NM           AS AST_BRDV_NM              
	         , T1.AST_RANK_NM           AS AST_RANK_NM              

             , T1.PRSS_STEP_CD          AS PRSS_STEP_CD             /*진행단계코드*/
			 , F_CODE_NM('1000475',T1.PRSS_STEP_CD)  
		       || 
		       (CASE WHEN T1.BZT_BGT_DVSN_CD = '1' AND T1.PRSS_STEP_CD = '02'
		                 THEN 
						     (SELECT '/'|| F_CODE_NM('1000030',AUD_BZT_KND_CD)
						        FROM TBBADDED002M 
						       WHERE BZT_YR || BZT_SNO = (SELECT MAX(BZT_YR || BZT_SNO)
												            FROM TBBADDED002M
												           WHERE REL_AUD_YR = T1.AUD_YR
												             AND REL_AUD_NO = T1.AUD_NO
												          )
							 )
				   END) AS PRSS_STEP_NM     		                /*진행단계코드명*/
		     , T1.GKM_CNT 				AS GKM_CNT 				    /*감사지식갯수*/
		     , T1.BZT_CNT				AS BZT_CNT
		     , T1.DVS_AUD_YR            AS DVS_AUD_YR               /*분할감사년도 - 2015.07.13 yyh*/
		     , T1.DVS_AUD_NO            AS DVS_AUD_NO               /*분할감사번호 - 2015.07.13 yyh*/
		     , T1.DVS_AUD_SBJ_NM        AS DVS_AUD_SBJ_NM           /*분할감사사항명 - 2015.07.13 yyh*/
		     , T1.REF_AUD_INFO          AS REF_AUD_INFO  			/*해당건을 분리전 감사사항으로 사용하는 건 - 2015.07.13 yyh */
		     
		     , T1.ITGT_AUD_YR           AS ITGT_AUD_YR              /*통합감사년도 - 2015.09.15 yyh*/
		     , T1.ITGT_AUD_NO           AS ITGT_AUD_NO              /*통합감사번호 - 2015.09.15 yyh*/
		     , T1.ITGT_AUD_SBJ_NM       AS ITGT_AUD_SBJ_NM          /*통합감사사항명 - 2015.09.15 yyh*/
		     , T1.ITGT_AUD_INFO         AS ITGT_AUD_INFO            /*해당건을 통합 감사사항으로 사용하는 건 - 2015.09.15 yyh*/
		     
		     , T1.DVS_AUD_YR_NO_KND_CD  AS DVS_AUD_YR_NO_KND_CD
		     , T1.ITGT_AUD_YR_NO_KND_CD AS ITGT_AUD_YR_NO_KND_CD
		     
  		     /* 다건의 주관자, 보조자 추가 - 2016.05.03 yyh*/
		     , F_USR_INFO(T1.AUDTOR1_CNB1,'2') AS AUDTOR1_CNB1
			 , F_USR_INFO(T1.AUDTOR1_CNB2,'2') AS AUDTOR1_CNB2
			 , F_USR_INFO(T1.AUDTOR1_CNB3,'2') AS AUDTOR1_CNB3
			 , F_USR_INFO(T1.AUDTOR2_CNB1,'2') AS AUDTOR2_CNB1
			 , F_USR_INFO(T1.AUDTOR2_CNB2,'2') AS AUDTOR2_CNB2
			 , F_USR_INFO(T1.AUDTOR2_CNB3,'2') AS AUDTOR2_CNB3
		     
          FROM (
          
			    SELECT D1.AUD_YR                   	AS AUD_YR           /*감사년도*/
			         , D1.AUD_NO                   	AS AUD_NO           /*감사번호*/
			         , D1.AUD_GRN_NO                AS AUD_GRN_NO       /*감사부여번호*/
			         , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-')
			                                        AS AUD_YR_N0        /*감사년번호 - 수정(2015.12.17-yyh)*/
			         , CASE WHEN D1.AUD_YR >= '2016' 
			                     THEN D1.AUD_KND_CD
			                ELSE '' 
			            END                         AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.18 yyh*/
			         , CASE WHEN D1.AUD_YR >= '2016' 
			                     THEN F_CODE_NM('1000739',D1.AUD_KND_CD)   
			                ELSE '-' 
			            END                         AS AUD_YR_NO_KND_NM /*감사연번호종류코드명 추가 - 2015.12.22 yyh*/			            
			         , D1.AUD_YR||'-'||SUBSTR(D1.AUD_TASK_CD,-1)||'-'||D1.ORG_DVSN_CD||'-'||SUBSTR(D1.AUD_KND_CD,-1)
			         ||'-'||SUBSTR(D1.SPV_BRDV_CD,1,2)||SUBSTR(D1.SPV_BRDV_CD,4,2)||'-'||SUBSTR(D1.AUD_WAY_CD,-1)||'-'||D1.AUD_NO AS AUD_DTL_NO    /*세부연번호*/
			         , D1.AUD_TASK_CD              	AS AUD_TASK_CD      /*감사과제코드*/
                     , F_CODE_NM_YEAR('1000008', D1.AUD_TASK_CD, D1.AUD_YR) AS AUD_TASK_NM 
			         , D1.ORG_DVSN_CD              	AS ORG_DVSN_CD      /*기관구분코드*/
			         , D1.AUD_KND_CD               	AS AUD_KND_CD       /*감사종류코드*/
                     , F_CODE_NM_YEAR('1000007', D1.AUD_KND_CD, D1.AUD_YR) AS AUD_KND_NM 
			         , D1.SPV_BRDV_CD              	AS SPV_BRDV_CD      /*주관국과코드*/
			         , F_DPT_INFO(D1.SPV_BRDV_CD,'1')	AS SPV_BRDV_NM  /*주관국과명*/
			         , D1.AUD_WAY_CD               	AS AUD_WAY_CD       /*감사방법코드*/
                     , F_CODE_NM_YEAR('1000009', D1.AUD_WAY_CD, D1.AUD_YR) AS AUD_WAY_NM 
			         , D1.AUD_SBJ_NM               	AS AUD_SBJ_NM       /*감사사항명*/
			         , D1.AUD_SCL_CD               	AS AUD_SCL_CD       /*감사규모코드*/
			         , D1.TSK_CAT_CD               	AS TSK_CAT_CD       /*업무분류코드*/
			         , F_CODE_NM('1000120',D1.TSK_CAT_CD) AS TSK_CAT_NM
			         , D1.EPS_TASK_CD             	AS EPS_TASK_CD      /*중점과제코드*/
                     , F_CODE_NM_YEAR('1000005', D1.EPS_TASK_CD, D1.AUD_YR) AS EPS_TASK_NM 
			         , D1.AUD_TOT_DRTR_CNB         	AS AUD_TOT_DRTR_CNB /*감사총책임자전산번호*/
			         , D1.TOT_DRTR_RANK_CD         	AS TOT_DRTR_RANK_CD /*총책임자직급코드*/
			         , D1.TOT_DRTR_BRDV_CD         	AS TOT_DRTR_BRDV_CD /*총책임자국과코드*/
			         , D1.AUD_RPST_ORG_CD          	AS AUD_RPST_ORG_CD  /*감사대표기관코드*/
			         , F_ORG_INFO(D1.AUD_RPST_ORG_CD,'1')  AS AUD_RPST_ORG_NM
			         , D1.SPVR_CNB                 	AS SPVR_CNB         /*주관자전산번호*/
			         , D1.SPVR_BRDV_CD             	AS SPVR_BRDV_CD     /*주관자국과코드*/
			         , D1.SPVR_RANK_CD            	AS SPVR_RANK_CD     /*주관자직급코드*/
			         , D1.AST_CNB                  	AS AST_CNB          /*보조자전산번호*/    
			         , D1.AST_BRDV_CD              	AS AST_BRDV_CD      /*보조자국과코드*/
			         , D1.AST_RANK_CD              	AS AST_RANK_CD      /*보조자직급코드*/
			         , D1.MNG_DPT_CD               	AS MNG_DPT_CD       /*관리부서코드*/
			         , F_DPT_INFO(D1.MNG_DPT_CD,'1') 		AS MNG_DPT_NM			         
				     , D1.ACP_YR 					AS ACP_YR 			/*청구연도*/
				     , D1.CVPT_ACP_NO 				AS CVPT_ACP_NO 		/*청구일련번호*/
				     , D1.REQ_DVSN_CD 				AS REQ_DVSN_CD 		/*청구구분코드*/
				     , D2.TIT_NM  					AS TIT_NM 			/*청구제목*/
			         , F_USR_INFO(D1.AUD_TOT_DRTR_CNB,'2')		AS AUD_TOT_DRTR_NM
			         , F_DPT_INFO(D1.TOT_DRTR_BRDV_CD,'1')		AS AUD_TOT_DRTR_BRDV_NM  
			         , F_CODE_NM('1000173',D1.TOT_DRTR_RANK_CD)	AS AUD_TOT_DRTR_RANK_NM
			         , F_USR_INFO(D1.SPVR_CNB,'2')              AS SPVR_NM
			         , F_DPT_INFO(D1.SPVR_BRDV_CD,'1')          AS SPVR_BRDV_NM
			         , F_CODE_NM('1000173',D1.SPVR_RANK_CD)     AS SPVR_RANK_NM
			         , F_USR_INFO(D1.AST_CNB,'2')             	AS AST_NM
			         , F_DPT_INFO(D1.AST_BRDV_CD,'1')         	AS AST_BRDV_NM
			         , F_CODE_NM('1000173',D1.AST_RANK_CD)      AS AST_RANK_NM
 					 , D1.PRSS_STEP_CD                          AS PRSS_STEP_CD   /*진행단계코드*/         
				     
				   , (SELECT COUNT(1) CNT  
					    FROM TBAEPGKM001M
					   WHERE 1=1
					     AND AUD_YR = D1.AUD_YR
					     AND AUD_NO = D1.AUD_NO
					  )                               AS GKM_CNT /*감사지식갯수*/
				   , (SELECT COUNT(1)
				        FROM TBBADDED002M 
				       WHERE REL_AUD_YR = D1.AUD_YR
				         AND REL_AUD_NO = D1.AUD_NO
				      ) AS BZT_CNT
				   , D1.DVS_AUD_YR                    AS DVS_AUD_YR      /* 분할감사년도 - 2015.07.13 yyh */
				   , D1.DVS_AUD_NO                    AS DVS_AUD_NO      /* 분할감사번호 - 2015.07.13 yyh */
				   , (SELECT CASE WHEN MAX(AUD_YR) >= '2016' 
				                       THEN SUBSTR(MAX(AUD_KND_CD),3,1)
				                  ELSE ''
				              END 
				        FROM TBBADDED001M
				       WHERE AUD_YR = D1.DVS_AUD_YR
				         AND AUD_NO = D1.DVS_AUD_NO)  AS DVS_AUD_YR_NO_KND_CD /* 분리전 감사사항 감사연번호종류코드 - 2015.12.28 yyh */
				   , (SELECT MAX(AUD_SBJ_NM)
				        FROM TBBADDED001M 
				       WHERE AUD_YR = D1.DVS_AUD_YR
				         AND AUD_NO = D1.DVS_AUD_NO)  AS DVS_AUD_SBJ_NM  /* 분할감사사항명 - 2015.07.13 yyh */
				   , (SELECT MAX('(' || AUD_YR || '-' || AUD_NO || ')' || AUD_SBJ_NM) 
				        FROM TBBADDED001M 
				       WHERE DVS_AUD_YR = D1.AUD_YR
				         AND DVS_AUD_NO = D1.AUD_NO)  AS REF_AUD_INFO  /* 해당건을 분리전 감사사항으로 사용하는 건 - 2015.07.13 yyh */
				         
				         
				   , D1.ITGT_AUD_YR                   AS ITGT_AUD_YR     /* 통합감사년도 - 2015.09.15 yyh */
				   , D1.ITGT_AUD_NO                   AS ITGT_AUD_NO     /* 통합감사번호 - 2015.09.15 yyh */	
				   , (SELECT CASE WHEN MAX(AUD_YR) >= '2016' 
				                       THEN SUBSTR(MAX(AUD_KND_CD),3,1)
				                  ELSE ''
				              END 
				        FROM TBBADDED001M
				       WHERE AUD_YR = D1.ITGT_AUD_YR
				         AND AUD_NO = D1.ITGT_AUD_NO)  AS ITGT_AUD_YR_NO_KND_CD /* 통합처리 감사사항 감사연번호종류코드 - 2015.12.28 yyh */				   
				   , (SELECT MAX(AUD_SBJ_NM)
				        FROM TBBADDED001M 
				       WHERE AUD_YR = D1.ITGT_AUD_YR
				         AND AUD_NO = D1.ITGT_AUD_NO)  AS ITGT_AUD_SBJ_NM  /* 통합감사사항명 - 2015.09.15 yyh */
				   , (SELECT MAX('(' || AUD_YR || '-' || AUD_NO || ')' || AUD_SBJ_NM) 
				        FROM TBBADDED001M 
				       WHERE ITGT_AUD_YR = D1.AUD_YR
				         AND ITGT_AUD_NO = D1.AUD_NO)  AS ITGT_AUD_INFO  /* 해당건을 통합전 감사사항으로 사용하는 건 - 2015.09.15 yyh */	
				   
				   , D4.AUDTOR1_CNB1
				   , D4.AUDTOR1_CNB2
				   , D4.AUDTOR1_CNB3
				   , D4.AUDTOR2_CNB1
				   , D4.AUDTOR2_CNB2
				   , D4.AUDTOR2_CNB3
				   , D1.BZT_BGT_DVSN_CD	         
				FROM TBBADDED001M D1
			       , TBCSPDCP101M D2
      			   , TBBADDED003M D3
      			   , (SELECT AUD_YR
                            ,AUD_NO 
                            ,MAX(CASE WHEN (AUDTOR_DVSN_CD = '1' AND AUDTOR_SNO = '1') THEN CNB ELSE '' END) AS AUDTOR1_CNB1  /*주관자1*/
                            ,MAX(CASE WHEN (AUDTOR_DVSN_CD = '1' AND AUDTOR_SNO = '2') THEN CNB ELSE '' END) AS AUDTOR1_CNB2  /*주관자2*/
                            ,MAX(CASE WHEN (AUDTOR_DVSN_CD = '1' AND AUDTOR_SNO = '3') THEN CNB ELSE '' END) AS AUDTOR1_CNB3  /*주관자3*/
                            ,MAX(CASE WHEN (AUDTOR_DVSN_CD = '2' AND AUDTOR_SNO = '1') THEN CNB ELSE '' END) AS AUDTOR2_CNB1  /*보조자1*/
                            ,MAX(CASE WHEN (AUDTOR_DVSN_CD = '2' AND AUDTOR_SNO = '2') THEN CNB ELSE '' END) AS AUDTOR2_CNB2  /*보조자2*/
                            ,MAX(CASE WHEN (AUDTOR_DVSN_CD = '2' AND AUDTOR_SNO = '3') THEN CNB ELSE '' END) AS AUDTOR2_CNB3  /*보조자3*/
                        FROM TBBADDED031L 
                       WHERE 1=1
                       GROUP BY AUD_YR, AUD_NO) D4
			   WHERE 1=1
			     AND D1.ACP_YR        = D2.ACP_YR(+)
			     AND D1.CVPT_ACP_NO   = D2.CVPT_ACP_NO(+)
			     AND D1.REQ_DVSN_CD   = D2.REQ_DVSN_CD(+)
			     AND D1.AUD_YR 		  = D3.AUD_YR(+)
			     AND D1.AUD_NO 		  = D3.AUD_NO(+)
			     AND D1.AUD_YR 		  = D4.AUD_YR(+)
			     AND D1.AUD_NO 		  = D4.AUD_NO(+)			     
			     
		         /*AND D1.AUD_NO NOT LIKE '9%' 서면모니터링을 걸러내야하므로*/
		         AND D1.SPV_BRDV_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#)))   /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/   		
		]]>
		<isNotEmpty property="strAudYr">	 
			     AND D1.AUD_YR      = #strAudYr#    
		</isNotEmpty>
		
		<isNotNull property="strAudYrNoKndCd">
			<isNotEmpty property="strAudYrNoKndCd">	 	
	                 /* 감사연번종류코드 - 2015.12.17 yyh */
				     AND SUBSTR(D1.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
			</isNotEmpty>
		</isNotNull>
		
		<isNotEmpty property="strAudNo">	 	
			     AND D1.AUD_NO = #strAudNo#
		</isNotEmpty>
		<isNotEmpty property="strAudSbjNm">	 	   
			     AND D1.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		
		<isNotEmpty property="strPrssStepCd">	 
                 AND D1.PRSS_STEP_CD = #strPrssStepCd#
		</isNotEmpty>
		
		<isNotEmpty property="strAudKndCd">	 
			     AND D1.AUD_KND_CD  = #strAudKndCd#
		</isNotEmpty>
		<isNotEmpty property="strSpvBrdvCd">	 
			     AND D1.SPV_BRDV_CD = #strSpvBrdvCd#
		</isNotEmpty>   
		<isNotEmpty property="strReqDvsnCd">	 
			     AND D1.REQ_DVSN_CD = #strReqDvsnCd#
		</isNotEmpty>     
		<isNotEmpty property="strIsPop">
			 <![CDATA[  
			     /*감사사항검색팝업의 경우 서면/모니터링 감사의 경우 통제가 해제된 건에 대해서만 조회되어야 한다. */
				 AND NOT EXISTS (
		                        SELECT 1
		                          FROM TBBADDED001M 
		                         WHERE 1=1
		                           AND AUD_YR = D1.AUD_YR
		                           AND AUD_NO = D1.AUD_NO
		                           AND SUBSTR(AUD_KND_CD,3,1) = '9' 
		                           AND NVL(SUBSTR(AUD_WAY_CD,3,1),' ') <> '4'
		                       )  
			]]>
		</isNotEmpty>

		
        <![CDATA[ 
        	) T1      
 			ORDER BY DECODE(SUBSTR(T1.AUD_NO,1,1),'9',2,1),T1.AUD_NO DESC 
        ]]>
	</select>
	
	<!--감사사항관리 페이징 조회 2016.01.05 yyh-->
	<select id="BADDED001EMainSelectPaging" parameterClass="paramMap" resultClass="resultMap">
		<include refid="include.pageSelct" />
	
        <![CDATA[     
	    SELECT T1.AUD_YR           		AS AUD_YR           		/*감사년도*/
	         , T1.AUD_NO           		AS AUD_NO           		/*감사번호*/
	         , T1.AUD_GRN_NO       		AS AUD_GRN_NO         		/*감사부여번호 - 2016.05.25 yyh*/	         
	         , T1.AUD_YR_N0        		AS AUD_YR_N0        		/*감사년번호*/
	         , T1.AUD_YR_NO_KND_CD      AS AUD_YR_NO_KND_CD         /*감사연번호종류코드*/
	         , T1.AUD_YR_NO_KND_NM      AS AUD_YR_NO_KND_NM         /*감사연번호종류코드명*/
	         , T1.AUD_DTL_NO    		AS AUD_DTL_NO    		    /*세부연번호*/
	         , T1.AUD_TASK_CD      		AS AUD_TASK_CD      		/*감사과제코드*/
             , T1.AUD_TASK_NM      		AS AUD_TASK_NM      		
	         , T1.ORG_DVSN_CD      		AS ORG_DVSN_CD      		/*기관구분코드*/
	         , T1.AUD_KND_CD       		AS AUD_KND_CD       		/*감사종류코드*/
             , T1.AUD_KND_NM       		AS AUD_KND_NM       		
	         , T1.SPV_BRDV_CD      		AS SPV_BRDV_CD      		/*주관국과코드*/
	         , T1.SPV_BRDV_NM  			AS SPV_BRDV_NM  			/*주관국과명*/
	         , T1.AUD_WAY_CD       		AS AUD_WAY_CD       		/*감사방법코드*/
             , T1.AUD_WAY_NM       		AS AUD_WAY_NM       		
	         , T1.AUD_SBJ_NM       		AS AUD_SBJ_NM       		/*감사사항명*/
	         , T1.AUD_SCL_CD       		AS AUD_SCL_CD       		/*감사규모코드*/
	         , T1.TSK_CAT_CD       		AS TSK_CAT_CD       		/*업무분류코드*/
	         , T1.TSK_CAT_NM       		AS TSK_CAT_NM       		
	         , T1.EPS_TASK_CD      		AS EPS_TASK_CD      		/*중점과제코드*/
             , T1.EPS_TASK_NM      		AS EPS_TASK_NM      		
	         , T1.AUD_TOT_DRTR_CNB 		AS AUD_TOT_DRTR_CNB 		/*감사총책임자전산번호*/
	         , T1.TOT_DRTR_RANK_CD 		AS TOT_DRTR_RANK_CD 		/*총책임자직급코드*/
	         , T1.TOT_DRTR_BRDV_CD 		AS TOT_DRTR_BRDV_CD 		/*총책임자국과코드*/
	         , T1.AUD_RPST_ORG_CD  		AS AUD_RPST_ORG_CD  		/*감사대표기관코드*/
	         , T1.AUD_RPST_ORG_NM  		AS AUD_RPST_ORG_NM  		
	         , T1.SPVR_CNB         		AS SPVR_CNB         		/*주관자전산번호*/
	         , T1.SPVR_BRDV_CD     		AS SPVR_BRDV_CD     		/*주관자국과코드*/
	         , T1.SPVR_RANK_CD     		AS SPVR_RANK_CD     		/*주관자직급코드*/
	         , T1.AST_CNB          		AS AST_CNB          		/*보조자전산번호*/    
	         , T1.AST_BRDV_CD      		AS AST_BRDV_CD      		/*보조자국과코드*/
	         , T1.AST_RANK_CD      		AS AST_RANK_CD      		/*보조자직급코드*/
	         , T1.MNG_DPT_CD       		AS MNG_DPT_CD       		/*관리부서코드*/
	         , T1.MNG_DPT_NM			AS MNG_DPT_NM			    		         
		     , T1.ACP_YR 				AS ACP_YR 				    /*청구연도*/
		     , T1.CVPT_ACP_NO 			AS CVPT_ACP_NO 			    /*청구일련번호*/
		     , T1.REQ_DVSN_CD 			AS REQ_DVSN_CD 			    /*청구구분코드*/
		     , T1.TIT_NM 				AS TIT_NM 				    /*청구제목*/
	         , T1.AUD_TOT_DRTR_NM       AS AUD_TOT_DRTR_NM          
	         , T1.AUD_TOT_DRTR_BRDV_NM  AS AUD_TOT_DRTR_BRDV_NM     
	         , T1.AUD_TOT_DRTR_RANK_NM  AS AUD_TOT_DRTR_RANK_NM  
             , T1.BZT_BGT_DVSN_CD       AS BZT_BGT_DVSN_CD          /*예산구분코드*/
             , T1.BZT_BGT_DVSN_NM       AS BZT_BGT_DVSN_NM          /*예산구분명*/	         
	         
	         /* 주석처리 - 2016.04.14 yyh
	         , T1.SPVR_NM               AS SPVR_NM                  
	         , T1.SPVR_BRDV_NM          AS SPVR_BRDV_NM             
	         , T1.SPVR_RANK_NM          AS SPVR_RANK_NM             
	         , T1.AST_NM                AS AST_NM                   
	         , T1.AST_BRDV_NM           AS AST_BRDV_NM              
	         , T1.AST_RANK_NM           AS AST_RANK_NM              
             */
             , T1.PRSS_STEP_CD          AS PRSS_STEP_CD             /*진행단계코드*/
			 , F_CODE_NM('1000475',T1.PRSS_STEP_CD)  
		       || 
		       (CASE WHEN T1.BZT_BGT_DVSN_CD = '1' AND T1.PRSS_STEP_CD = '02'
		                 THEN 
						     (SELECT '/'|| F_CODE_NM('1000030',AUD_BZT_KND_CD)
						        FROM TBBADDED002M 
						       WHERE BZT_YR || BZT_SNO = (SELECT MAX(BZT_YR || BZT_SNO)
												            FROM TBBADDED002M
												           WHERE REL_AUD_YR = T1.AUD_YR
												             AND REL_AUD_NO = T1.AUD_NO
												          )
							 )
				   END) AS PRSS_STEP_NM     		                /*진행단계코드명*/
		     , T1.GKM_CNT 				         AS GKM_CNT 		/*감사지식갯수*/
		     , T1.BZT_CNT			             AS BZT_CNT         /*출장수*/
		     , T1.DVS_AUD_YR                     AS DVS_AUD_YR      /*분할감사년도 - 2015.07.13 yyh*/
		     , T1.DVS_AUD_NO                     AS DVS_AUD_NO      /*분할감사번호 - 2015.07.13 yyh*/
		     , (SELECT AUD_GRN_NO
		          FROM TBBADDED001M
		         WHERE AUD_YR = T1.DVS_AUD_YR
		           AND AUD_NO = T1.DVS_AUD_NO)   AS DVS_AUD_GRN_NO  /*분할감사부여번호 - 2016.05.26 yyh*/
		     , T1.DVS_AUD_SBJ_NM                 AS DVS_AUD_SBJ_NM  /*분할감사사항명 - 2015.07.13 yyh*/
		     , T1.REF_AUD_INFO                   AS REF_AUD_INFO    /*해당건을 분리전 감사사항으로 사용하는 건 - 2015.07.13 yyh */
		     
		     , T1.ITGT_AUD_YR                    AS ITGT_AUD_YR     /*통합감사년도 - 2015.09.15 yyh*/
		     , T1.ITGT_AUD_NO                    AS ITGT_AUD_NO     /*통합감사번호 - 2015.09.15 yyh*/
		     , (SELECT AUD_GRN_NO
		          FROM TBBADDED001M
		         WHERE AUD_YR = T1.ITGT_AUD_YR
		           AND AUD_NO = T1.ITGT_AUD_NO)  AS ITGT_AUD_GRN_NO /*통합감사부여번호 - 2016.05.26 yyh*/
		     , T1.ITGT_AUD_SBJ_NM                AS ITGT_AUD_SBJ_NM /*통합감사사항명 - 2015.09.15 yyh*/
		     , T1.ITGT_AUD_INFO                  AS ITGT_AUD_INFO   /*해당건을 통합 감사사항으로 사용하는 건 - 2015.09.15 yyh*/
		     
		     , T1.DVS_AUD_YR_NO_KND_CD  AS DVS_AUD_YR_NO_KND_CD
		     , T1.ITGT_AUD_YR_NO_KND_CD AS ITGT_AUD_YR_NO_KND_CD
		     
		     , T1.AUD_CTRL_CD                    AS AUD_CTRL_CD      /*감사통제코드 - 2016.06.03 yyh */
			 , T1.AUD_CTRL_NM                    AS AUD_CTRL_NM      /*감사통제코드명 - 2016.06.03 yyh */		     
          FROM (
          
			    SELECT D1.AUD_YR                   	AS AUD_YR           /*감사년도*/
			         , D1.AUD_NO                   	AS AUD_NO           /*감사번호*/
	                 , D1.AUD_GRN_NO       		    AS AUD_GRN_NO       /*감사부여번호*/			         
			         , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-')
			                                        AS AUD_YR_N0        /*감사년번호 - 수정(2015.12.17-yyh)*/
			         , CASE WHEN D1.AUD_YR >= '2016' 
			                     THEN D1.AUD_KND_CD
			                ELSE '' 
			            END                         AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.18 yyh*/
			         , CASE WHEN D1.AUD_YR >= '2016' 
			                     THEN F_CODE_NM('1000739',D1.AUD_KND_CD)   
			                ELSE '-' 
			            END                         AS AUD_YR_NO_KND_NM /*감사연번호종류코드명 추가 - 2015.12.22 yyh*/			            
			         , D1.AUD_YR||'-'||SUBSTR(D1.AUD_TASK_CD,-1)||'-'||D1.ORG_DVSN_CD||'-'||SUBSTR(D1.AUD_KND_CD,-1)
			         ||'-'||SUBSTR(D1.SPV_BRDV_CD,1,2)||SUBSTR(D1.SPV_BRDV_CD,4,2)||'-'||SUBSTR(D1.AUD_WAY_CD,-1)||'-'||D1.AUD_NO AS AUD_DTL_NO    /*세부연번호*/
			         , D1.AUD_TASK_CD              	AS AUD_TASK_CD      /*감사과제코드*/
                     , F_CODE_NM_YEAR('1000008', D1.AUD_TASK_CD, D1.AUD_YR) AS AUD_TASK_NM 
			         , D1.ORG_DVSN_CD              	AS ORG_DVSN_CD      /*기관구분코드*/
			         , D1.AUD_KND_CD               	AS AUD_KND_CD       /*감사종류코드*/
                     , F_CODE_NM_YEAR('1000007', D1.AUD_KND_CD, D1.AUD_YR) AS AUD_KND_NM 
			         , D1.SPV_BRDV_CD              	AS SPV_BRDV_CD      /*주관국과코드*/
			         , F_DPT_INFO(D1.SPV_BRDV_CD,'1')	AS SPV_BRDV_NM  /*주관국과명*/
			         , D1.AUD_WAY_CD               	AS AUD_WAY_CD       /*감사방법코드*/
                     , F_CODE_NM_YEAR('1000009', D1.AUD_WAY_CD, D1.AUD_YR) AS AUD_WAY_NM 
			         , D1.AUD_SBJ_NM               	AS AUD_SBJ_NM       /*감사사항명*/
			         , D1.AUD_SCL_CD               	AS AUD_SCL_CD       /*감사규모코드*/
			         , D1.TSK_CAT_CD               	AS TSK_CAT_CD       /*업무분류코드*/
			         , F_CODE_NM('1000120',D1.TSK_CAT_CD) AS TSK_CAT_NM
			         , D1.EPS_TASK_CD             	AS EPS_TASK_CD      /*중점과제코드*/
                     , F_CODE_NM_YEAR('1000005', D1.EPS_TASK_CD, D1.AUD_YR) AS EPS_TASK_NM 
			         , D1.AUD_TOT_DRTR_CNB         	AS AUD_TOT_DRTR_CNB /*감사총책임자전산번호*/
			         , D1.TOT_DRTR_RANK_CD         	AS TOT_DRTR_RANK_CD /*총책임자직급코드*/
			         , D1.TOT_DRTR_BRDV_CD         	AS TOT_DRTR_BRDV_CD /*총책임자국과코드*/
			         , D1.AUD_RPST_ORG_CD          	AS AUD_RPST_ORG_CD  /*감사대표기관코드*/
			         , F_ORG_INFO(D1.AUD_RPST_ORG_CD,'1')  AS AUD_RPST_ORG_NM
			         , D1.SPVR_CNB                 	AS SPVR_CNB         /*주관자전산번호*/
			         , D1.SPVR_BRDV_CD             	AS SPVR_BRDV_CD     /*주관자국과코드*/
			         , D1.SPVR_RANK_CD            	AS SPVR_RANK_CD     /*주관자직급코드*/
			         , D1.AST_CNB                  	AS AST_CNB          /*보조자전산번호*/    
			         , D1.AST_BRDV_CD              	AS AST_BRDV_CD      /*보조자국과코드*/
			         , D1.AST_RANK_CD              	AS AST_RANK_CD      /*보조자직급코드*/
			         , D1.MNG_DPT_CD               	AS MNG_DPT_CD       /*관리부서코드*/
			         , F_DPT_INFO(D1.MNG_DPT_CD,'1') 		AS MNG_DPT_NM			         
				     , D1.ACP_YR 					AS ACP_YR 			/*청구연도*/
				     , D1.CVPT_ACP_NO 				AS CVPT_ACP_NO 		/*청구일련번호*/
				     , D1.REQ_DVSN_CD 				AS REQ_DVSN_CD 		/*청구구분코드*/
				     , D2.TIT_NM  					AS TIT_NM 			/*청구제목*/
			         , F_USR_INFO(D1.AUD_TOT_DRTR_CNB,'2')		AS AUD_TOT_DRTR_NM
			         , F_DPT_INFO(D1.TOT_DRTR_BRDV_CD,'1')		AS AUD_TOT_DRTR_BRDV_NM  
			         , F_CODE_NM('1000173',D1.TOT_DRTR_RANK_CD)	AS AUD_TOT_DRTR_RANK_NM
			         
			         /* 주석처리 - 2016.04.14 yyh
			         , F_USR_INFO(D1.SPVR_CNB,'2')              AS SPVR_NM
			         , F_DPT_INFO(D1.SPVR_BRDV_CD,'1')          AS SPVR_BRDV_NM
			         , F_CODE_NM('1000173',D1.SPVR_RANK_CD)     AS SPVR_RANK_NM
			         , F_USR_INFO(D1.AST_CNB,'2')             	AS AST_NM
			         , F_DPT_INFO(D1.AST_BRDV_CD,'1')         	AS AST_BRDV_NM
			         , F_CODE_NM('1000173',D1.AST_RANK_CD)      AS AST_RANK_NM
			         */
			         
 					 ,D1.PRSS_STEP_CD                           AS PRSS_STEP_CD    /*진행단계코드 - 로직제거 2016.10.04 yyh*/         
				     
				   , (SELECT COUNT(1) CNT  
					    FROM TBAEPGKM001M
					   WHERE 1=1
					     AND AUD_YR = D1.AUD_YR
					     AND AUD_NO = D1.AUD_NO
					  )                               AS GKM_CNT /*감사지식갯수*/
					  
				   , (SELECT COUNT(1)
				        FROM TBBADDED002M 
				       WHERE REL_AUD_YR = D1.AUD_YR
				         AND REL_AUD_NO = D1.AUD_NO
				      )                               AS BZT_CNT
				      
				   , D1.DVS_AUD_YR                    AS DVS_AUD_YR      /* 분할감사년도 - 2015.07.13 yyh */
				   , D1.DVS_AUD_NO                    AS DVS_AUD_NO      /* 분할감사번호 - 2015.07.13 yyh */
				   , (SELECT CASE WHEN MAX(AUD_YR) >= '2016' 
				                       THEN SUBSTR(MAX(AUD_KND_CD),3,1)
				                  ELSE ''
				              END 
				        FROM TBBADDED001M
				       WHERE AUD_YR = D1.DVS_AUD_YR
				         AND AUD_NO = D1.DVS_AUD_NO)  AS DVS_AUD_YR_NO_KND_CD /* 분리전 감사사항 감사연번호종류코드 - 2015.12.28 yyh */
				   , (SELECT MAX(AUD_SBJ_NM)
				        FROM TBBADDED001M 
				       WHERE AUD_YR = D1.DVS_AUD_YR
				         AND AUD_NO = D1.DVS_AUD_NO)  AS DVS_AUD_SBJ_NM  /* 분할감사사항명 - 2015.07.13 yyh */
				   , (SELECT MAX('(' || AUD_YR || '-' || AUD_NO || ')' || AUD_SBJ_NM) 
				        FROM TBBADDED001M 
				       WHERE DVS_AUD_YR = D1.AUD_YR
				         AND DVS_AUD_NO = D1.AUD_NO)  AS REF_AUD_INFO  /* 해당건을 분리전 감사사항으로 사용하는 건 - 2015.07.13 yyh */
				         
				         
				   , D1.ITGT_AUD_YR                   AS ITGT_AUD_YR     /* 통합감사년도 - 2015.09.15 yyh */
				   , D1.ITGT_AUD_NO                   AS ITGT_AUD_NO     /* 통합감사번호 - 2015.09.15 yyh */	
				   , (SELECT CASE WHEN MAX(AUD_YR) >= '2016' 
				                       THEN SUBSTR(MAX(AUD_KND_CD),3,1)
				                  ELSE ''
				              END 
				        FROM TBBADDED001M
				       WHERE AUD_YR = D1.ITGT_AUD_YR
				         AND AUD_NO = D1.ITGT_AUD_NO)  AS ITGT_AUD_YR_NO_KND_CD /* 통합처리 감사사항 감사연번호종류코드 - 2015.12.28 yyh */				   
				   , (SELECT MAX(AUD_SBJ_NM)
				        FROM TBBADDED001M 
				       WHERE AUD_YR = D1.ITGT_AUD_YR
				         AND AUD_NO = D1.ITGT_AUD_NO)  AS ITGT_AUD_SBJ_NM  /* 통합감사사항명 - 2015.09.15 yyh */
				   , (SELECT MAX('(' || AUD_YR || '-' || AUD_NO || ')' || AUD_SBJ_NM) 
				        FROM TBBADDED001M 
				       WHERE ITGT_AUD_YR = D1.AUD_YR
				         AND ITGT_AUD_NO = D1.AUD_NO)  AS ITGT_AUD_INFO  /* 해당건을 통합전 감사사항으로 사용하는 건 - 2015.09.15 yyh */	   
				   , D1.AUD_CTRL_CD                          AS AUD_CTRL_CD
			       , F_CODE_NM('1000753',D1.AUD_CTRL_CD)     AS AUD_CTRL_NM      /*감사통제코드명 - 2016.06.03 yyh */		
			       
                   /* 예산구분 추가 - 2016.06.16 yyh */
                   , D1.BZT_BGT_DVSN_CD                      AS BZT_BGT_DVSN_CD
                   , F_CODE_NM('1000751',D1.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM				       		   		         
				FROM TBBADDED001M D1
			       , TBCSPDCP101M D2
      			   , TBBADDED003M D3
			   WHERE 1=1
			     AND D1.ACP_YR        = D2.ACP_YR(+)
			     AND D1.CVPT_ACP_NO   = D2.CVPT_ACP_NO(+)
			     AND D1.REQ_DVSN_CD   = D2.REQ_DVSN_CD(+)
			     AND D1.AUD_YR 		  = D3.AUD_YR(+)
			     AND D1.AUD_NO 		  = D3.AUD_NO(+)
		         /*AND D1.AUD_NO NOT LIKE '9%' 서면모니터링을 걸러내야하므로*/
		         AND D1.MNG_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#)))   /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/   		
		]]>
		<isNotEmpty property="strAudYr">	 
			     AND D1.AUD_YR      = #strAudYr#    
		</isNotEmpty>
		
		<isNotNull property="strAudYrNoKndCd">
			<isNotEmpty property="strAudYrNoKndCd">	 	
	                 /* 감사연번종류코드 - 2015.12.17 yyh */
				     AND SUBSTR(D1.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
			</isNotEmpty>
		</isNotNull>
		
		<isNotEmpty property="strAudNo">	 	
			     AND D1.AUD_GRN_NO = #strAudNo#
		</isNotEmpty>
		<isNotEmpty property="strAudSbjNm">	 	   
			     AND D1.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		
		<isNotEmpty property="strPrssStepCd">	 
                 AND D1.PRSS_STEP_CD = #strPrssStepCd#
		</isNotEmpty>
		
		<isNotEmpty property="strAudKndCd">	 
			     AND D1.AUD_KND_CD  = #strAudKndCd#
		</isNotEmpty>
		<isNotEmpty property="strSpvBrdvCd">	 
			     AND D1.MNG_DPT_CD = #strSpvBrdvCd#
		</isNotEmpty>   
		<isNotEmpty property="strReqDvsnCd">	 
			     AND D1.REQ_DVSN_CD = #strReqDvsnCd#
		</isNotEmpty>  
		   
        <![CDATA[ 
        	) T1      
        ]]>
        
        <include refid="include.pageOrder" />
	</select>	
	
	
	<!--감사사항관리 insert-->
	<insert id="BADDED001EMainInsert" parameterClass="paramMap">
		DECLARE
			BEGIN
				INSERT INTO TBBADDED001M
				 (
					   AUD_YR
				     , AUD_NO
				     , AUD_GRN_NO    /* 감사부여번호 추가 - 2016.05.23 */
				     , AUD_TASK_CD
				     , ORG_DVSN_CD
				     , AUD_KND_CD
				     , SPV_BRDV_CD
				     , AUD_WAY_CD
				     , AUD_SBJ_NM
				     , AUD_SCL_CD
				     , TSK_CAT_CD
				     , EPS_TASK_CD
				     , AUD_TOT_DRTR_CNB
				     , TOT_DRTR_RANK_CD
				     , TOT_DRTR_BRDV_CD
				     , AUD_RPST_ORG_CD
				     , SPVR_CNB
				     , SPVR_BRDV_CD
				     , SPVR_RANK_CD
				     , AST_CNB
				     , AST_BRDV_CD
				     , AST_RANK_CD
				     , PRSS_STEP_CD
				     , MNG_DPT_CD
				     , ACP_YR
				     , CVPT_ACP_NO
				     , REQ_DVSN_CD
				     , DVS_AUD_YR
				     , DVS_AUD_NO
				     , ITGT_AUD_YR
				     , ITGT_AUD_NO
				     , AUD_CTRL_CD     /* 감사통제코드 추가 - 2016.06.03 yyh */
				     , BZT_BGT_DVSN_CD /* 예산구분코드 - 2016.06.16 yyh */
				     , FRT_USR_ID
				     , FNL_USR_ID
				     , FNL_DEAL_DPT_CD
				     , FNL_MNU_ID
				     , FRT_REGI_DH
				     , FNL_MDF_DH
				 ) VALUES
				 (
				      #AUD_YR#
				    , #AUD_NO#
				    , #AUD_GRN_NO#
				    , #AUD_TASK_CD#
				    , #ORG_DVSN_CD#
				    , #AUD_KND_CD#
				    , #SPV_BRDV_CD#
				    , #AUD_WAY_CD#
				    , #AUD_SBJ_NM#
				    , #AUD_SCL_CD#
				    , #TSK_CAT_CD#
				    , #EPS_TASK_CD#
				    , #AUD_TOT_DRTR_CNB#
				    , #TOT_DRTR_RANK_CD#
				    , #TOT_DRTR_BRDV_CD#
				    , #AUD_RPST_ORG_CD#
				    , #SPVR_CNB#
				    , #SPVR_BRDV_CD#
				    , #SPVR_RANK_CD#
				    , #AST_CNB#
				    , #AST_BRDV_CD#
				    , #AST_RANK_CD#
				    , #PRSS_STEP_CD#
				    , #MNG_DPT_CD#
				    , #ACP_YR#
				    , #CVPT_ACP_NO#
				    , #REQ_DVSN_CD#
				    , #DVS_AUD_YR#
				    , #DVS_AUD_NO#
				    , #ITGT_AUD_YR#
				    , #ITGT_AUD_NO#
				    
				    /* 
				        감사통제코드 SET 
				         - 확인출장은        : 1(해당없음)
				         - 확인출장 이외는   : 3(미통제상태)   
				    */
				    , (CASE WHEN SUBSTR(#AUD_KND_CD#,3,1) = '5' THEN '1'
				            ELSE '3' 
				        END)    
				    , #BZT_BGT_DVSN_CD#
				    , #FRT_USR_ID#
				    , #FNL_USR_ID#
				    , #FNL_DEAL_DPT_CD#
				    , #FNL_MNU_ID#
				    , SYSDATE
				    , SYSDATE
				 ) ;

				INSERT INTO TBBADDED024H
				   ( 
				       CON_NO
				     , AUD_YR
				     , AUD_NO
				     , CON_HNDL_CD
				     , USE_YN
				     , FRT_USR_ID
				     , FNL_USR_ID
				     , FNL_DEAL_DPT_CD
				     , FNL_MNU_ID
				     , FRT_REGI_DH
				     , FNL_MDF_DH 
				  ) VALUES(
				       (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADDED024H)
				     , #AUD_YR#
				     , #AUD_NO#
				     , 'C'
				     , 'N'
				     , #FRT_USR_ID#
				     , #FNL_USR_ID#
				     , #FNL_DEAL_DPT_CD#
				     , #FNL_MNU_ID#
				     , SYSDATE
				     , SYSDATE
				  ) ;
		END	;			 
				 
	</insert>
	
	<!--감사사항관리 update-->
	<update id="BADDED001EMainUpdate" parameterClass="paramMap">
		DECLARE
			BEGIN	
		<![CDATA[ 	
			UPDATE TBBADDED001M
			   SET AUD_YR               = #AUD_YR# 
			     , AUD_NO                = #AUD_NO# 		
			   
		]]>	    
		<isNotNull prepend="," property="AUD_TASK_CD">
			   	   AUD_TASK_CD            = #AUD_TASK_CD#
		</isNotNull>
		<isNotNull prepend="," property="ORG_DVSN_CD">	       
			       ORG_DVSN_CD            = #ORG_DVSN_CD#
		</isNotNull>
		<isNotNull prepend="," property="AUD_KND_CD">	       
			       AUD_KND_CD           = #AUD_KND_CD#
		</isNotNull>			       
		<isNotNull prepend="," property="SPV_BRDV_CD">	       
			       SPV_BRDV_CD                  = #SPV_BRDV_CD#
		</isNotNull>				       
		<isNotNull prepend="," property="AUD_WAY_CD">	       
			       AUD_WAY_CD                  = #AUD_WAY_CD#             
		</isNotNull>	       
		<isNotNull prepend="," property="AUD_SBJ_NM">	       
			       AUD_SBJ_NM            = #AUD_SBJ_NM#            
		</isNotNull>		
		<isNotNull prepend="," property="AUD_SCL_CD">	       
			       AUD_SCL_CD             = #AUD_SCL_CD#       
		</isNotNull>		
		<isNotNull prepend="," property="TSK_CAT_CD">	       
			       TSK_CAT_CD           = #TSK_CAT_CD#     
		</isNotNull>			
		<isNotNull prepend="," property="EPS_TASK_CD">	       
			       EPS_TASK_CD         = #EPS_TASK_CD#
		</isNotNull>			
		<isNotNull prepend="," property="AUD_TOT_DRTR_CNB">	       
			       AUD_TOT_DRTR_CNB            = #AUD_TOT_DRTR_CNB#
		</isNotNull>			
		<isNotNull prepend="," property="TOT_DRTR_RANK_CD">	       
			        TOT_DRTR_RANK_CD          = #TOT_DRTR_RANK_CD#
		</isNotNull>			
		<isNotNull prepend="," property="TOT_DRTR_BRDV_CD">	       
			        TOT_DRTR_BRDV_CD          = #TOT_DRTR_BRDV_CD#
		</isNotNull>			
		<isNotNull prepend="," property="AUD_RPST_ORG_CD">	       
			        AUD_RPST_ORG_CD           = #AUD_RPST_ORG_CD#
		</isNotNull>				
		<isNotNull prepend="," property="SPVR_CNB">	       
			         SPVR_CNB     = #SPVR_CNB#
		</isNotNull>				
		<isNotNull prepend="," property="SPVR_BRDV_CD">	       
			        SPVR_BRDV_CD     = #SPVR_BRDV_CD#    
		</isNotNull>			
		<isNotNull prepend="," property="SPVR_RANK_CD">	       
			        SPVR_RANK_CD   = #SPVR_RANK_CD#      
		</isNotNull>		
		<isNotNull prepend="," property="AST_CNB">	       
			        AST_CNB        = #AST_CNB#
		</isNotNull>		
		<isNotNull prepend="," property="AST_BRDV_CD">	       
			       AST_BRDV_CD        = #AST_BRDV_CD#
		</isNotNull>	
		<isNotNull prepend="," property="AST_RANK_CD">	       
			       AST_RANK_CD   = #AST_RANK_CD#
		</isNotNull>	
		<isNotNull prepend="," property="PRSS_STEP_CD">	       
			       PRSS_STEP_CD         = #PRSS_STEP_CD#
		</isNotNull>	
		<isNotNull prepend="," property="MNG_DPT_CD">	       
			      MNG_DPT_CD    = #MNG_DPT_CD#
		</isNotNull>	
		<isNotNull prepend="," property="ACP_YR">	       
			      ACP_YR         = #ACP_YR#
		</isNotNull>		
		<isNotNull prepend="," property="CVPT_ACP_NO">	       
			     CVPT_ACP_NO               = #CVPT_ACP_NO#
		</isNotNull>		
		<isNotNull prepend="," property="REQ_DVSN_CD">	       
			     REQ_DVSN_CD                 = #REQ_DVSN_CD#
		</isNotNull>
		<isNotNull prepend="," property="DVS_AUD_YR">	       
			     DVS_AUD_YR                 = #DVS_AUD_YR#
		</isNotNull>
		
		<isNotNull prepend="," property="DVS_AUD_NO">	       
			     DVS_AUD_NO                 = #DVS_AUD_NO#
		</isNotNull>
		
		<isNotNull prepend="," property="ITGT_AUD_YR">	       
			     ITGT_AUD_YR                 = #ITGT_AUD_YR#
		</isNotNull>
		<isNotNull prepend="," property="ITGT_AUD_NO">	       
			     ITGT_AUD_NO                 = #ITGT_AUD_NO#
		</isNotNull>				

		<!-- 예산구분코드 - 2016.06.16 yyh -->		
		<isNotNull prepend="," property="BZT_BGT_DVSN_CD">	       
			     BZT_BGT_DVSN_CD             = #BZT_BGT_DVSN_CD#
		</isNotNull>		
		
			  WHERE 1=1
			    AND AUD_YR               = #AUD_YR# 
			    AND AUD_NO                = #AUD_NO# ;		

			INSERT INTO TBBADDED023H
			(
			    CON_NO,
			    AUD_YR,
			    AUD_NO,
			    AUD_TASK_CD,
			    ORG_DVSN_CD,
			    AUD_KND_CD,
			    SPV_BRDV_CD,
			    AUD_WAY_CD,
			    AUD_SBJ_NM,
			    AUD_SCL_CD,
			    TSK_CAT_CD,
			    EPS_TASK_CD,
			    AUD_TOT_DRTR_CNB,
			    TOT_DRTR_RANK_CD,
			    TOT_DRTR_BRDV_CD,
			    AUD_RPST_ORG_CD,
			    SPVR_CNB,
			    SPVR_BRDV_CD,
			    SPVR_RANK_CD,
			    AST_CNB,
			    AST_BRDV_CD,
			    AST_RANK_CD,
			    PRSS_STEP_CD,
			    MNG_DPT_CD,
			    ACP_YR,
			    CVPT_ACP_NO,
			    REQ_DVSN_CD,
			    USE_YN,
			    FRT_USR_ID,
			    FNL_USR_ID,
			    FNL_DEAL_DPT_CD,
			    FNL_MNU_ID,
			    FRT_REGI_DH,
			    FNL_MDF_DH
			)
			SELECT (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADDED023H),
				    AUD_YR,
				    AUD_NO,
				    AUD_TASK_CD,
				    ORG_DVSN_CD,
				    AUD_KND_CD,
				    SPV_BRDV_CD,
				    AUD_WAY_CD,
				    AUD_SBJ_NM,
				    AUD_SCL_CD,
				    TSK_CAT_CD,
				    EPS_TASK_CD,
				    AUD_TOT_DRTR_CNB,
				    TOT_DRTR_RANK_CD,
				    TOT_DRTR_BRDV_CD,
				    AUD_RPST_ORG_CD,
				    SPVR_CNB,
				    SPVR_BRDV_CD,
				    SPVR_RANK_CD,
				    AST_CNB,
				    AST_BRDV_CD,
				    AST_RANK_CD,
				    PRSS_STEP_CD,
				    MNG_DPT_CD,
				    ACP_YR,
				    CVPT_ACP_NO,
				    REQ_DVSN_CD,
				    'N',	
				    #FRT_USR_ID#,
				    #FNL_USR_ID#,
				    #FNL_DEAL_DPT_CD#,
				    #FNL_MNU_ID#,
				    SYSDATE,
				    SYSDATE				    		
			  FROM TBBADDED001M
			  WHERE 1=1
			    AND AUD_YR               = #AUD_YR# 
			    AND AUD_NO                = #AUD_NO# ;	
		END	;		        
	</update>
	
	<!--감사사항관리 delete-->
	<update id="BADDED001EMainDelete" parameterClass="paramMap">
		DECLARE
			BEGIN
			DELETE 
			FROM 	TBBADDED001M
			WHERE 1=1
			AND AUD_YR               = #AUD_YR# 
			AND AUD_NO                = #AUD_NO# 
			; 
			INSERT INTO TBBADDED024H
			   ( 
			       CON_NO
			     , AUD_YR
			     , AUD_NO
			     , CON_HNDL_CD
			     , USE_YN
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH 
			  ) VALUES(
			       (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADDED024H)
			     , #AUD_YR#
			     , #AUD_NO#
			     , 'D'
			     , 'N'
			     , #FRT_USR_ID#
			     , #FNL_USR_ID#
			     , #FNL_DEAL_DPT_CD#
			     , #FNL_MNU_ID#
			     , SYSDATE
			     , SYSDATE
			  ) ;			
		END	;		
			
	</update>
	
	<!-- 연번 Max값 찾기 -->
	<select id="BADDED001EMainMaxSnoSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT LPAD(NVL(MAX(TO_NUMBER(AUD_NO)),0)+1,3,0) AS MAX_SEQ
				  FROM TBBADDED001M
				 WHERE 1=1
				   AND AUD_YR = #AUD_YR# 
				   /* AND AUD_NO NOT LIKE '9%'   서면모니터링을 걸러내야하므로 - (주석처리 - 2016.05.23 yyh) */
		]]>
	</select>

	<!-- 감사부여번호 채번 - 2015.05.23 yyh -->
	<select id="BADDED001EMainMaxAudGrnNoSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[     	
			    SELECT LPAD(NVL(MAX(TO_NUMBER(AUD_GRN_NO)),0)+1,3,0) AS MAX_AUD_GRN_NO
				  FROM TBBADDED001M
				 WHERE 1=1
				   AND AUD_YR = #AUD_YR#
				   AND SUBSTR(AUD_KND_CD,3,1) = SUBSTR(#AUD_KND_CD#,3,1) 
		]]>
	</select>
	
	<!--국과별 처리현황 파라미터 -->
	<parameterMap class="java.util.HashMap" id="BADDED001EMainExecuteMap">
		<parameter property="AUD_YR"			jdbcType="VARCHAR2" javaType="java.lang.String" mode="IN"/>
		<parameter property="AUD_NO"			jdbcType="VARCHAR2" javaType="java.lang.String" mode="IN"/>
		<parameter property="DATE_KBN"			jdbcType="VARCHAR2" javaType="java.lang.String" mode="IN"/>
		<parameter property="FRT_USR_ID"		jdbcType="VARCHAR2" javaType="java.lang.String" mode="IN"/>
		<parameter property="FNL_USR_ID"		jdbcType="VARCHAR2" javaType="java.lang.String" mode="IN"/>
		<parameter property="FNL_DEAL_DPT_CD"	jdbcType="VARCHAR2" javaType="java.lang.String" mode="IN"/>
		<parameter property="FNL_MNU_ID"		jdbcType="VARCHAR2" javaType="java.lang.String" mode="IN"/>
	</parameterMap>
	
	<!-- 국과별 처리현황 프로시저 호출 -->
	<procedure id="BADDED001EMainExecute" parameterMap="BADDED001EMainExecuteMap">
		CALL PRC_MAKE_TBBADDED003M(?, ?, ?, ?, ?, ?, ?) 
	</procedure>
	

	<!-- CSD 업로드 파일을 조회한다. - 2015.07.17 yyh -->
	<select id="BADDED001ECsdSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[     
                  SELECT D1.AUD_YR     AS AUD_YR
                        ,D1.AUD_NO     AS AUD_NO
                        ,D1.DOC_ID     AS DOC_ID
                        ,D2.FILE_ID    AS FILE_ID
                    FROM TBBADDED021M D1
                        ,ECM_FILE_LIST_VIEW2 D2
                   WHERE 1=1
                     AND D1.AUD_YR  = #AUD_YR#
                     AND D1.AUD_NO  = #AUD_NO#
                     AND D1.DOC_ID  = D2.DOC_ID
                     AND DOC_TYP_CD = #DOC_TYP_CD#
                             
        ]]>
	</select>


	<!--감사사항 실시 조회-->
	<select id="BADDED001EExecSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
                    /*************************************
                    * DVSN_CD : 구분코드
                    * 1 : 민원
                    * 2 : 국민
                    * 3 : 공익
                    * 4 : 국회
                    * 5 : 심사
                    * 6 : 재심
                    * 7 : 재심판정
                    * 8 : 손망실
                    * 9 : 판정청구
                    * 0 : 정보
                    * A : 특수관리
                    * C : 청금 - 20156.10.31 yyh
                    **************************************/
					SELECT T1.AUD_YR
					      ,T1.AUD_NO
					      ,T1.SRNO
					      ,T1.DVSN_CD
					      ,F_CODE_NM('1000742', T1.DVSN_CD) AS DVSN_NM
					      ,T1.TSK_KEY1
					      ,T1.TSK_KEY2
					      ,T1.TSK_KEY3
					      ,T1.TSK_KEY4
					      ,CASE WHEN DVSN_CD IN ('1','2','3') THEN (SELECT S1.ACP_YR||'-'||F_CODE_NM('1000740',S1.REQ_DVSN_CD)||'-'||S1.RM_CVPT_ACP_NO
					      											  FROM TBCSPDCP101M S1
					      											 WHERE T1.TSK_KEY1 = S1.ACP_YR
					      									  		   AND T1.TSK_KEY2 = S1.REQ_DVSN_CD
					      											   AND T1.TSK_KEY3 = S1.CVPT_ACP_NO)
					      												
					            /* 국회 로직추가 - 2016.12.08 yyh */
					            WHEN DVSN_CD = '4'            THEN T1.TSK_KEY1 ||'-국회-'|| T1.TSK_KEY3
					            
					            WHEN DVSN_CD IN ('5','6','7') THEN (SELECT CASE WHEN S1.ACP_YR >= '2016' 
				 	                                                                 THEN S1.ACP_YR || '-' || DECODE(S1.ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || S1.ACP_SRNO
				 	                                                            ELSE 
				 	                                                                      S1.ACP_YR || '-' || S1.ACP_DVSN_CD || '-' || S1.ACP_SRNO
				 	                                                             END
					                                                  FROM TBBADFRE012M S1 
					                                                 WHERE T1.TSK_KEY1 = S1.ACP_YR   
					                                                   AND T1.TSK_KEY2 = S1.ACP_DVSN_CD
					                                                   AND T1.TSK_KEY3 = S1.ACP_SRNO
					                                                   AND T1.TSK_KEY4 = S1.DPT_CD)
					            WHEN DVSN_CD IN ('8','9')     THEN (SELECT CASE WHEN S1.OGN_DVSN_CD = '6' 
					                                                                 THEN S1.YR||'-판정청구-'||S1.ACP_NO
					                                                            ELSE S1.YR||'-손망실-'||S1.ACP_NO
					                                                        END 
					                                                  FROM TBBADGDA001M S1
					                                                 WHERE T1.TSK_KEY1 = S1.ORG_CD   
					                                                   AND T1.TSK_KEY2 = S1.NTF_DVSN_CD
					                                                   AND T1.TSK_KEY3 = S1.NNB)
					            WHEN DVSN_CD = '0'            THEN TSK_KEY1 ||'-정보-'|| TSK_KEY2
					            WHEN DVSN_CD = 'A'            THEN F_MNG_KND_AUDYRNO(TSK_KEY1, TSK_KEY2, (SELECT AUD_KND_CD 
					                                                                                        FROM TBBADDED001M 
					                                                                                       WHERE AUD_YR = TSK_KEY1 
					                                                                                         AND AUD_NO = TSK_KEY2), '-')  ||'-'|| 
					                                          TSK_KEY3                                                                     ||'-'|| 
					                                          F_ORG_INFO(TSK_KEY4,'1')
					            WHEN DVSN_CD = 'C'            THEN TSK_KEY2 || '-청금-' || (SELECT S1.RM_STTM_ACP_NO
					                                                                         FROM TBCSPDCP811M S1
					                                                                         WHERE S1.STTM_DVSN_CD = TSK_KEY1
					                                                                           AND S1.ACP_YR       = TSK_KEY2
					                                                                           AND S1.STTM_ACP_NO  = TSK_KEY3 )
					            ELSE ''
					        END AS EXEC_NO 
					      ,CASE WHEN DVSN_CD IN ('1','2','3') THEN (SELECT S1.TIT_NM
					      											  FROM TBCSPDCP101M S1
					      											 WHERE T1.TSK_KEY1 = S1.ACP_YR
					      									  		   AND T1.TSK_KEY2 = S1.REQ_DVSN_CD
					      											   AND T1.TSK_KEY3 = S1.CVPT_ACP_NO)
					      												
					            /* 국회 로직추가 - 2016.12.08 yyh */
					            WHEN DVSN_CD = '4'            THEN (SELECT S1.AUD_REQ_TIT_NM
                                                                      FROM TBCSPEAR007M S1
                                                                     WHERE T1.TSK_KEY1 = S1.ACP_YR
                                                                       AND T1.TSK_KEY2 = S1.REQ_DVSN_CD
                                                                       AND T1.TSK_KEY3 = S1.CVPT_ACP_NO
                                                                     )
					            WHEN DVSN_CD IN ('5','6','7') THEN (SELECT S1.TIT_NM
					                                                  FROM TBBADFRE012M S1 
					                                                 WHERE T1.TSK_KEY1 = S1.ACP_YR   
					                                                   AND T1.TSK_KEY2 = S1.ACP_DVSN_CD
					                                                   AND T1.TSK_KEY3 = S1.ACP_SRNO
					                                                   AND T1.TSK_KEY4 = S1.DPT_CD)
					            WHEN DVSN_CD IN ('8','9')     THEN (SELECT S1.TIT_NM  
					                                                  FROM TBBADGDA001M S1
					                                                 WHERE T1.TSK_KEY1 = S1.ORG_CD   
					                                                   AND T1.TSK_KEY2 = S1.NTF_DVSN_CD
					                                                   AND T1.TSK_KEY3 = S1.NNB)
					            WHEN DVSN_CD = '0'            THEN (SELECT TIT_TXT 
					                                                  FROM TBCSPBII100M S1
					                                                 WHERE S1.YE   = T1.TSK_KEY1
					                                                   AND S1.SRNO = T1.TSK_KEY2)
					            WHEN DVSN_CD = 'A'            THEN (SELECT TIT_TXT
					                                                  FROM TBBADEAR001M S1
					                                                 WHERE S1.AUD_YR      = T1.TSK_KEY1
				                                                       AND S1.AUD_NO      = T1.TSK_KEY2
				                                                       AND S1.DSP_RQ_SNO  = T1.TSK_KEY3)	
					            WHEN DVSN_CD = 'C'            THEN (SELECT TIT_NM
					                                                  FROM TBCSPDCP811M S1
					                                                 WHERE S1.STTM_DVSN_CD = T1.TSK_KEY1
				                                                       AND S1.ACP_YR       = T1.TSK_KEY2
				                                                       AND S1.STTM_ACP_NO  = T1.TSK_KEY3)					                                                       				                                                   
					            ELSE ''
					        END AS EXEC_TIT_NM
					  FROM TBBADDED030L T1
					 WHERE 1=1 
        ]]>
        
		<isNotEmpty property="strAudYr">	 
			     AND T1.AUD_YR = #strAudYr#    
		</isNotEmpty>
		<isNotEmpty property="strAudNo">	 	
			     AND T1.AUD_NO = #strAudNo#
		</isNotEmpty> 
        <![CDATA[
        	ORDER BY T1.SRNO
        ]]>		        
	</select>	
	
	
	<!--감사사항 실시 insert-->
	<insert id="BADDED001EExecInsert" parameterClass="paramMap">
				INSERT INTO TBBADDED030L
				 (
					   AUD_YR
				     , AUD_NO
				     , SRNO
				     , DVSN_CD
				     , TSK_KEY1
				     , TSK_KEY2
				     , TSK_KEY3
				     , TSK_KEY4
				     , FRT_USR_ID
				     , FNL_USR_ID
				     , FNL_DEAL_DPT_CD
				     , FNL_MNU_ID
				     , FRT_REGI_DH
				     , FNL_MDF_DH
				 ) VALUES
				 (
				       #AUD_YR#
				     , #AUD_NO#
				     , (SELECT NVL(MAX(SRNO),0) + 1
				          FROM TBBADDED030L
				         WHERE AUD_YR = #AUD_YR# 
				           AND AUD_NO = #AUD_NO#)
				     , #DVSN_CD#
				     , #TSK_KEY1#
				     , #TSK_KEY2#
				     , #TSK_KEY3#
				     , #TSK_KEY4#				    
				     , #FRT_USR_ID#
				     , #FNL_USR_ID#
				     , #FNL_DEAL_DPT_CD#
				     , #FNL_MNU_ID#
				     , SYSDATE
				     , SYSDATE
				 ) 
	</insert>	
	
	<!--감사사항 실시 update-->
	<update id="BADDED001EExecUpdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBBADDED030L
			   SET DVSN_CD          = #DVSN_CD#
				  ,TSK_KEY1         = #TSK_KEY1#
				  ,TSK_KEY2         = #TSK_KEY2#
				  ,TSK_KEY3         = #TSK_KEY3#
				  ,TSK_KEY4         = #TSK_KEY4#
				  ,FNL_USR_ID       = #FNL_USR_ID#
				  ,FNL_DEAL_DPT_CD  = #FNL_DEAL_DPT_CD#
				  ,FNL_MNU_ID       = #FNL_MNU_ID#
				  ,FNL_MDF_DH       = SYSDATE
			 WHERE AUD_YR  = #AUD_YR# 
			   AND AUD_NO  = #AUD_NO#
			   AND SRNO    = #SRNO#
		]]>	    
	</update>
	
	<!--감사사항 실시 delete-->
	<update id="BADDED001EExecDelete" parameterClass="paramMap">
			DELETE 
			  FROM TBBADDED030L
			 WHERE AUD_YR  = #AUD_YR# 
			   AND AUD_NO  = #AUD_NO#
			   
		<isNotEmpty property="SRNO">	 
			   AND SRNO    = #SRNO#    
		</isNotEmpty>
	</update>	
		
		
		
	<!--감사자 조회 - 2016.04.14 yyh -->
	<select id="BADDED001EAudTorSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[     
        			
                 SELECT D1.AUD_YR                         AS AUD_YR
                       ,D1.AUD_NO                         AS AUD_NO
                       ,D1.AUDTOR_DVSN_CD                 AS AUDTOR_DVSN_CD
                       ,D1.AUDTOR_SNO                     AS AUDTOR_SNO
                       ,D1.CNB                            AS CNB
                       ,F_USR_INFO(D1.CNB,'2')            AS CNB_NM
                       ,D1.DPT_CD                         AS DPT_CD
                       ,F_DPT_INFO(D1.DPT_CD,'1')         AS DPT_NM
                       ,D1.RANK_CD                        AS RANK_CD
                       ,F_CODE_NM('1000173',D1.RANK_CD)   AS RANK_NM
                       ,D1.STR_STEP_CD                    AS STR_STEP_CD
                       ,D1.END_STEP_CD                    AS END_STEP_CD
                   FROM TBBADDED031L D1
                  WHERE D1.AUD_YR         = #strAudYr#
                    AND D1.AUD_NO         = #strAudNo#
                  ORDER BY D1.AUDTOR_DVSN_CD
                          ,D1.AUDTOR_SNO  

        ]]>
	</select>
			
	<!-- 감사자 insert - 2016.04.11 yyh -->
	<insert id="BADDED001EAudTorInsert" parameterClass="paramMap">
            INSERT INTO TBBADDED031L
             (
                   AUD_YR
                 , AUD_NO
                 , AUDTOR_DVSN_CD
                 , AUDTOR_SNO
                 , CNB
                 , DPT_CD
                 , RANK_CD
                 , STR_STEP_CD
                 , END_STEP_CD
                 , FRT_USR_ID
                 , FNL_USR_ID
                 , FNL_DEAL_DPT_CD
                 , FNL_MNU_ID
                 , FRT_REGI_DH
                 , FNL_MDF_DH
             ) VALUES
             (
                   #AUD_YR#
                 , #AUD_NO#
                 , #AUDTOR_DVSN_CD#
                 , (SELECT NVL(MAX(AUDTOR_SNO),0) + 1
                      FROM TBBADDED031L
                     WHERE AUD_YR = #AUD_YR# 
                       AND AUD_NO = #AUD_NO#
                       AND AUDTOR_DVSN_CD = #AUDTOR_DVSN_CD#)
                 , #CNB#
                 , #DPT_CD#
                 , #RANK_CD#
                 , #STR_STEP_CD#
                 , #END_STEP_CD#
                 , #FRT_USR_ID#
                 , #FNL_USR_ID#
                 , #FNL_DEAL_DPT_CD#
                 , #FNL_MNU_ID#
                 , SYSDATE
                 , SYSDATE
             ) 
	</insert>			
		
	<!--감사자 delete-->
	<update id="BADDED001EAudTorDelete" parameterClass="paramMap">
			DELETE 
			  FROM TBBADDED031L
			 WHERE AUD_YR  = #AUD_YR# 
			   AND AUD_NO  = #AUD_NO#
	</update>

	<!-- 감사부여번호 재채번 - 2015.05.23 yyh -->
	<select id="BADDED001EMainMaxAudGrnNoSelectForRetry" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[     	
			    SELECT LPAD(NVL(MAX(TO_NUMBER(AUD_GRN_NO)),0)+1,3,0) AS RE_MAX_AUD_GRN_NO
				  FROM TBBADDED001M
				 WHERE 1=1
				   AND AUD_YR = #strAudYr#
				   AND SUBSTR(AUD_KND_CD,3,1) = SUBSTR(#strAudKndCd#,3,1) 
				   AND AUD_CTRL_CD = '2'
		]]>
	</select>
		
	<!--통제처리 - 2016.06.03 yyh 
		1000753 감사통제코드     
		- 1:- (해당없음)     
		- 2:Y (통제)         
		- 3:N (미통제)
	-->
	<update id="BADDED001EAudCtrlUpdate" parameterClass="paramMap">
		DECLARE
			BEGIN	
				
				/* 통제처리 */ 	
				UPDATE TBBADDED001M
				   SET AUD_GRN_NO       = #RE_MAX_AUD_GRN_NO#
				      ,AUD_CTRL_CD      = '2'
					  ,FNL_USR_ID       = #FNL_USR_ID#
					  ,FNL_DEAL_DPT_CD  = #FNL_DEAL_DPT_CD#
					  ,FNL_MNU_ID       = #FNL_MNU_ID#
					  ,FNL_MDF_DH       = SYSDATE
				 WHERE AUD_YR           = #strAudYr# 
				   AND AUD_NO           = #strAudNo#
				   ;
			
			
				/* 공공감사연계 저장 */ 
				INSERT INTO TBBADDED023H
				(
				    CON_NO,
				    AUD_YR,
				    AUD_NO,
				    AUD_TASK_CD,
				    ORG_DVSN_CD,
				    AUD_KND_CD,
				    SPV_BRDV_CD,
				    AUD_WAY_CD,
				    AUD_SBJ_NM,
				    AUD_SCL_CD,
				    TSK_CAT_CD,
				    EPS_TASK_CD,
				    AUD_TOT_DRTR_CNB,
				    TOT_DRTR_RANK_CD,
				    TOT_DRTR_BRDV_CD,
				    AUD_RPST_ORG_CD,
				    SPVR_CNB,
				    SPVR_BRDV_CD,
				    SPVR_RANK_CD,
				    AST_CNB,
				    AST_BRDV_CD,
				    AST_RANK_CD,
				    PRSS_STEP_CD,
				    MNG_DPT_CD,
				    ACP_YR,
				    CVPT_ACP_NO,
				    REQ_DVSN_CD,
				    USE_YN,
				    FRT_USR_ID,
				    FNL_USR_ID,
				    FNL_DEAL_DPT_CD,
				    FNL_MNU_ID,
				    FRT_REGI_DH,
				    FNL_MDF_DH
				)
				SELECT (SELECT NVL(MAX(CON_NO),0)+1 FROM TBBADDED023H),
					    AUD_YR,
					    AUD_NO,
					    AUD_TASK_CD,
					    ORG_DVSN_CD,
					    AUD_KND_CD,
					    SPV_BRDV_CD,
					    AUD_WAY_CD,
					    AUD_SBJ_NM,
					    AUD_SCL_CD,
					    TSK_CAT_CD,
					    EPS_TASK_CD,
					    AUD_TOT_DRTR_CNB,
					    TOT_DRTR_RANK_CD,
					    TOT_DRTR_BRDV_CD,
					    AUD_RPST_ORG_CD,
					    SPVR_CNB,
					    SPVR_BRDV_CD,
					    SPVR_RANK_CD,
					    AST_CNB,
					    AST_BRDV_CD,
					    AST_RANK_CD,
					    PRSS_STEP_CD,
					    MNG_DPT_CD,
					    ACP_YR,
					    CVPT_ACP_NO,
					    REQ_DVSN_CD,
					    'N',	
					    #FNL_USR_ID#,
					    #FNL_USR_ID#,
					    #FNL_DEAL_DPT_CD#,
					    #FNL_MNU_ID#,
					    SYSDATE,
					    SYSDATE				    		
				  FROM TBBADDED001M
				  WHERE 1=1
				    AND AUD_YR = #strAudYr# 
				    AND AUD_NO = #strAudNo#
				    ;
			END	;		        			
	</update>	

	<!--통제후 감사부여번호 재채번 후 배정 - 2016.06.07 yyh-->
	<update id="BADDED001EReAudGrnNoUpdate" parameterClass="paramMap">
		DECLARE
			BEGIN	
			
			  FOR CS IN ( 
							SELECT AUD_YR
							      ,AUD_NO 
							      ,LPAD(NVL(TO_NUMBER(#RE_MAX_AUD_GRN_NO#),0) + ROWNUM, 3, '0') AS AUD_GRN_NO
							  FROM (
									SELECT AUD_YR
									      ,AUD_NO
									  FROM TBBADDED001M
									 WHERE 1=1
									   AND AUD_CTRL_CD = '3'
									   AND SUBSTR(AUD_KND_CD,3,1) = SUBSTR(#strAudKndCd#,3,1)
									 ORDER BY AUD_YR
									         ,AUD_NO
							       ) 
			)
			
			LOOP 		
				UPDATE TBBADDED001M
				   SET AUD_GRN_NO = CS.AUD_GRN_NO
				 WHERE AUD_YR     = CS.AUD_YR
				   AND AUD_NO     = CS.AUD_NO
				   ;
			END LOOP;
						
		END;		
	</update>
	
	<!-- 감사사항 조회 팝업 - 2019.05.28 EUNOK -->
	<select id="BADDED010PPopInqMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[  
        
        
        SELECT * FROM (

			SELECT  '' AS AUD_YR ,
			        '' AS AUD_NO,
			        '' AS AUD_GRN_NO,
		            A1.INPUT_DT AS AUD_YR_N0,        		/*감사년번호*/
		            '' AS AUD_YR_NO_KND_CD,         /*감사연번호종류코드*/
		            '' AS AUD_YR_NO_KND_NM,         /*감사연번호종류코드명*/
		            '' AS AUD_TASK_CD,     			/*감사과제코드*/
	                '' AS AUD_TASK_NM,     		
			        A1.AUD_SBJ_NM AS AUD_SBJ_NM ,
         			TO_CHAR(A1.FNL_MDF_DH,'YYYYMMDDHH24MISS') AS INPUT_DT,
			        '' AS ENF_APV
			FROM TBCSPIIT020M A1
			WHERE A1.DPT_CD = #strRqsDptCd#
			  AND A1.INPUT_DT BETWEEN TO_CHAR(SYSDATE-90, 'YYYYMMDD') AND TO_CHAR(SYSDATE, 'YYYYMMDD')
			
			UNION 
   
		    SELECT T1.AUD_YR           		AS AUD_YR           		/*감사년도*/
		         , T1.AUD_NO           		AS AUD_NO           		/*감사번호*/
		         , T1.AUD_GRN_NO       		AS AUD_GRN_NO         		/*감사부여번호*/
		         , T1.AUD_YR_N0        		AS AUD_YR_N0        		/*감사년번호*/
		         , T1.AUD_YR_NO_KND_CD      AS AUD_YR_NO_KND_CD         /*감사연번호종류코드*/
		         , T1.AUD_YR_NO_KND_NM      AS AUD_YR_NO_KND_NM         /*감사연번호종류코드명*/
		         , T1.AUD_TASK_CD      		AS AUD_TASK_CD      		/*감사과제코드*/
	             , T1.AUD_TASK_NM      		AS AUD_TASK_NM      	
	             , T1.AUD_SBJ_NM       		AS AUD_SBJ_NM       		/*감사사항명*/
        		 ,'00000000000000' AS INPUT_DT
	             , T1.ENF_APV AS ENF_APV 
	          FROM (
	          
				    SELECT D1.AUD_YR                   	AS AUD_YR           /*감사년도*/
				         , D1.AUD_NO                   	AS AUD_NO           /*감사번호*/
				         , D1.AUD_GRN_NO                AS AUD_GRN_NO       /*감사부여번호*/
				         , F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-')
				                                        AS AUD_YR_N0        /*감사년번호 - 수정(2015.12.17-yyh)*/
				         , CASE WHEN D1.AUD_YR >= '2016' 
				                     THEN D1.AUD_KND_CD
				                ELSE '' 
				            END                         AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.18 yyh*/
				         , CASE WHEN D1.AUD_YR >= '2016' 
				                     THEN F_CODE_NM('1000739',D1.AUD_KND_CD)   
				                ELSE '-' 
				            END                         AS AUD_YR_NO_KND_NM /*감사연번호종류코드명 추가 - 2015.12.22 yyh*/			            
				         , D1.AUD_TASK_CD              	AS AUD_TASK_CD      /*감사과제코드*/
	                     , F_CODE_NM_YEAR('1000008', D1.AUD_TASK_CD, D1.AUD_YR) AS AUD_TASK_NM 
				         , D1.ORG_DVSN_CD              	AS ORG_DVSN_CD      /*기관구분코드*/
				         , D1.AUD_KND_CD               	AS AUD_KND_CD       /*감사종류코드*/
	                     , F_CODE_NM_YEAR('1000007', D1.AUD_KND_CD, D1.AUD_YR) AS AUD_KND_NM 
				         , D1.SPV_BRDV_CD              	AS SPV_BRDV_CD      /*주관국과코드*/
				         , F_DPT_INFO(D1.SPV_BRDV_CD,'1')	AS SPV_BRDV_NM  /*주관국과명*/
				         , D1.AUD_WAY_CD               	AS AUD_WAY_CD       /*감사방법코드*/
	                     , F_CODE_NM_YEAR('1000009', D1.AUD_WAY_CD, D1.AUD_YR) AS AUD_WAY_NM 
				         , D1.AUD_SBJ_NM               	AS AUD_SBJ_NM       /*감사사항명*/
				         , D1.AUD_SCL_CD               	AS AUD_SCL_CD       /*감사규모코드*/
				         , D1.TSK_CAT_CD               	AS TSK_CAT_CD       /*업무분류코드*/
				         , F_CODE_NM('1000120',D1.TSK_CAT_CD) AS TSK_CAT_NM
				         , D1.EPS_TASK_CD             	AS EPS_TASK_CD      /*중점과제코드*/
	                     , F_CODE_NM_YEAR('1000005', D1.EPS_TASK_CD, D1.AUD_YR) AS EPS_TASK_NM 
				         , D1.AUD_TOT_DRTR_CNB         	AS AUD_TOT_DRTR_CNB /*감사총책임자전산번호*/
				         , D1.TOT_DRTR_RANK_CD         	AS TOT_DRTR_RANK_CD /*총책임자직급코드*/
				         , D1.TOT_DRTR_BRDV_CD         	AS TOT_DRTR_BRDV_CD /*총책임자국과코드*/
				         , D1.AUD_RPST_ORG_CD          	AS AUD_RPST_ORG_CD  /*감사대표기관코드*/
				         , F_ORG_INFO(D1.AUD_RPST_ORG_CD,'1')  AS AUD_RPST_ORG_NM
				         , D1.SPVR_CNB                 	AS SPVR_CNB         /*주관자전산번호*/
				         , D1.SPVR_BRDV_CD             	AS SPVR_BRDV_CD     /*주관자국과코드*/
				         , D1.SPVR_RANK_CD            	AS SPVR_RANK_CD     /*주관자직급코드*/
				         , D1.AST_CNB                  	AS AST_CNB          /*보조자전산번호*/    
				         , D1.AST_BRDV_CD              	AS AST_BRDV_CD      /*보조자국과코드*/
				         , D1.AST_RANK_CD              	AS AST_RANK_CD      /*보조자직급코드*/
				         , D1.MNG_DPT_CD               	AS MNG_DPT_CD       /*관리부서코드*/
				         , F_DPT_INFO(D1.MNG_DPT_CD,'1') 		AS MNG_DPT_NM			         
					     , D1.ACP_YR 					AS ACP_YR 			/*청구연도*/
					     , D1.CVPT_ACP_NO 				AS CVPT_ACP_NO 		/*청구일련번호*/
					     , D1.REQ_DVSN_CD 				AS REQ_DVSN_CD 		/*청구구분코드*/
					     , D2.TIT_NM  					AS TIT_NM 			/*청구제목*/
				         , D1.AUD_CTRL_CD                          AS AUD_CTRL_CD      /*감사통제코드 - 2016.06.03 yyh */
				         , F_CODE_NM('1000753',D1.AUD_CTRL_CD)     AS AUD_CTRL_NM      /*감사통제코드명 - 2016.06.03 yyh */
				         
	                	 /* 예산구분 추가 - 2016.06.16 yyh */
	                	 , D1.BZT_BGT_DVSN_CD                      AS BZT_BGT_DVSN_CD
	                	 , F_CODE_NM('1000751',D1.BZT_BGT_DVSN_CD) AS BZT_BGT_DVSN_NM			         
	 					 , D1.PRSS_STEP_CD                         AS PRSS_STEP_CD    /*진행단계코드*/ 
	 					 , CASE WHEN D3.ENF_APV_DT IS NULL THEN '1' ELSE '2' END AS ENF_APV /*감사진행여부:1(감사중),2(완료)*/ 
					FROM TBBADDED001M D1
				       , TBCSPDCP101M D2
	      			   , TBBADDED003M D3
				   WHERE 1=1
				     AND D1.ACP_YR        = D2.ACP_YR(+)
				     AND D1.CVPT_ACP_NO   = D2.CVPT_ACP_NO(+)
				     AND D1.REQ_DVSN_CD   = D2.REQ_DVSN_CD(+)
				     AND D1.AUD_YR 		  = D3.AUD_YR(+)
				     AND D1.AUD_NO 		  = D3.AUD_NO(+)	     
				     AND D1.AUD_YR       >= TO_CHAR(SYSDATE, 'YYYY') -1 /*최근 2년내 감사 사항만 조회*/
			         /*AND D1.AUD_NO NOT LIKE '9%' 서면모니터링을 걸러내야하므로*/
			         AND D1.MNG_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, '', 'Y', #strRqsDptCd#)))   /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/   		
			]]>
			<isNotEmpty property="strAudYr">	 
				    /* AND D1.AUD_YR      */
			</isNotEmpty>
			
			<isNotEmpty property="strAudYrNoKndCd">	 	
			     	 AND SUBSTR(D1.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
			</isNotEmpty>
			
			<isNotEmpty property="strAudNo">	 	
				     AND D1.AUD_GRN_NO = #strAudNo#
			</isNotEmpty>
			<isNotEmpty property="strAudSbjNm">	 	   
				     AND D1.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
			</isNotEmpty>
			
			<isNotEmpty property="strAudKndCd">	 
				     AND D1.AUD_KND_CD  = #strAudKndCd#
			</isNotEmpty>
			<isNotEmpty property="strSpvBrdvCd">	 
			    	 AND D1.MNG_DPT_CD = #strSpvBrdvCd#
			</isNotEmpty>
			
			<isNotEmpty property="strAudCtrlYn">	 
				<isEqual property="strAudCtrlYn" compareValue="Y">
			         /*감사통제코드가 1:-(해당없음), 2:Y(통제)*/
				     AND D1.AUD_CTRL_CD IN ('1','2') 
				</isEqual>
			</isNotEmpty>
			<isNotEmpty property="strPrssStepCd">
				<isEqual property="strPrssStepCd" compareValue="1">
			         /*감사진행코드 1:진행중, 2: 종료*/
				     AND D3.ENF_APV_DT IS NULL
				</isEqual>	 
				<isEqual property="strPrssStepCd" compareValue="2">
			         /*감사진행코드 1:진행중, 2: 종료*/
				     AND D3.ENF_APV_DT  IS NOT NULL
				</isEqual>
			</isNotEmpty>
	        <![CDATA[ 
	        	) T1      
	        	
	        	)
           		ORDER BY INPUT_DT DESC, AUD_YR DESC,DECODE(SUBSTR(AUD_GRN_NO,1,1),'9',2,1),AUD_GRN_NO DESC            
	 			 
	        ]]>
	</select>
	
	
	<insert id="BADDED010PMainInsert" parameterClass="paramMap">
				INSERT INTO TBCSPIIT020M
				 (
					   SRNO             /* 일련번호 */
					 , INPUT_DT			/* 등록일 */
				     , AUD_SBJ_NM       /* 감사사항명 */
				     , DPT_CD			/* 부서코드 */
				     , FRT_USR_ID
				     , FNL_USR_ID
				     , FNL_DEAL_DPT_CD
				     , FNL_MNU_ID
				     , FRT_REGI_DH
				     , FNL_MDF_DH
				 ) VALUES
				 (
				     (SELECT NVL(MAX(SRNO),0) + 1
				        FROM TBCSPIIT020M)
				     , TO_CHAR(SYSDATE,'YYYYMMDD')
				     , #AUD_SBJ_NM#	
				     , #RQS_DPT_CD#
				     , #RQS_CNB#
				     , #FNL_USR_ID#
				     , #FNL_DEAL_DPT_CD#
				     , #FNL_MNU_ID#
				     , SYSDATE
				     , SYSDATE
				 ) 
	</insert>				
</sqlMap> 
