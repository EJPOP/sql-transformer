<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/oep/015">

	<select id="CSPOEP015EMmsSeqSelect" parameterClass="paramMap" resultClass="int">
		<![CDATA[
			SELECT MMS_CONTENTS_INFO_SEQ.NEXTVAL AS CONT_SEQ FROM DUAL
		]]>
		
	</select>

	<select id="CSPOEP015EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		/* csp.oep.service.impl.CSPOEP015EServiceImpl.CSPOEP015EMainSelect */
		<![CDATA[       
		SELECT rownum AS NUM
		      ,SNO
    	      ,MSG_DVSN_CD
    	      ,MSG_TXT
    	      ,SEND_CNB
    	      ,TO_CHAR(MSG_OM_DH,'YYYY-MM-DD') AS MSG_OM_DT
    	  FROM
    	      (
		    	SELECT SNO
		    	      ,MSG_DVSN_CD
		    	      ,MSG_TXT
		    	      ,SEND_CNB
		    	      ,MSG_OM_DH
		    	  FROM TBCSPOEP008H
		    	 WHERE MSG_DVSN_CD = #strMsgDvsnCd#
		      ORDER BY SNO DESC
		       )
		 WHERE rownum < 11
		]]>
	</select>
	
	<insert id="CSPOEP015EMmsHisInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO TBCSPOEP008H 
				 	(	  SNO
				 		, MSG_DVSN_CD
				 		, MSG_TXT
				 		, SEND_CNB
				 		, MSG_OM_DH
						, FRT_USR_ID
						, FNL_USR_ID
						, FNL_DEAL_DPT_CD
						, FNL_MNU_ID
						, FRT_REGI_DH
						, FNL_MDF_DH
				 	)
			VALUES
			        (
			            (SELECT nvl(MAX(SNO),0)+1 FROM TBCSPOEP008H WHERE MSG_DVSN_CD = #strMsgDvsnCd#) 
			          , #strMsgDvsnCd#
			          , #strMsgTxt#||''
			          , #S_CNB#
			          , SYSDATE
				      , #FNL_USR_ID#
				      , #FNL_USR_ID#
				      , #FNL_DEAL_DPT_CD#
				      , #FNL_MNU_ID#
				      , SYSDATE
				      , SYSDATE
			        )
		]]>
	</insert>	
	
	<insert id="CSPOEP015EMmsMsgInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MMS_CONTENTS_INFO 
				 	(	  CONT_SEQ
				 		, FILE_CNT
				 		, MMS_BODY
				 		, MMS_SUBJECT
				 	)
			VALUES
			        (
			            #CONT_SEQ#
			          , '1'
			          , #strMsgTxt#||''
			          , '감사원 문자통보'
			        )
		]]>
	</insert>
	
	<insert id="CSPOEP015EMsgInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MSG_DATA
				 	(	  MSG_SEQ
				 		, CUR_STATE
				 		, REQ_DATE
				 		, CALL_TO
				 		, CALL_FROM
				 		, SMS_TXT
				 		, MSG_TYPE
				 		, CONT_SEQ
				 	) 
			VALUES
			        (
			            MSG_DATA_SEQ.NEXTVAL
			          , 0
			          , SYSDATE
			          , replace(#TNB#,'-')
			          , '0220112114'
			          , ''
			          , 6
			          , #CONT_SEQ#
			        )
		]]>
	</insert>
	
	<insert id="CSPOEP015EInsertMSGSend" parameterClass="paramMap">
		<![CDATA[
			CALL NURI2_MESSAGE_SEND('0220112114', #TNB#, '감사원 문자통보', #strMsgTxt#||'')
		]]>
	</insert>
	
</sqlMap> 
