<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/sae/801">

	<select id="selectYearCombo" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT TO_CHAR(2019+LEVEL) CD
				 , TO_CHAR(2019+LEVEL) CD_NM
			  FROM DUAL
			  CONNECT BY LEVEL <= 31	
        ]]>
	</select>
	
	<select id="CSPSAE801EGetCabtGpCd" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT CD, CD_NM
			  FROM TBDCMACM013C
			 WHERE 1 = 1 
			   AND CMM_CD_DVSN_CD = '1000996'
			   AND CD <> '000000000'
			   AND USE_YN = 'Y';	
        ]]>
	</select>
	
	<select id="CSPSAE801EGetCabtCd" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT CD, CD_NM, USR_DFN_TXT_1
			  FROM TBDCMACM013C
			 WHERE 1 = 1 
			   AND CMM_CD_DVSN_CD = '1000997'
			   AND CD <> '000000000'
			   AND USE_YN = 'Y'   
	    ]]>
			  
        
	</select>

	<select id="CSPSAE801EMainList" parameterClass="paramMap" resultClass="resultMap">
        SELECT YE
             , DGE
             , TIT
             , SV_STR_DT
             , SV_END_DT
             , RMK
          FROM TBCSPSAE801M
         WHERE YE = #strYE#   
	</select>
	
	<select id="CSPSAE801ESubList" parameterClass="paramMap" resultClass="resultMap">
        SELECT YE
             , DGE
             , CABT_GP_CD
             , CABT_CD            
             , AV_SC_4RK
             , AV_SC_5RK
             , AV_SC_67RK
             , OCM_AV_SC_5RK
             , OCM_AV_SC_67RK
             , CABT_DF
          FROM TBCSPSAE801D
         WHERE YE = #strYE#
           AND DGE = #strDGE#
	</select>
	
	<select id="CSPSAE801EselectSubListCnt" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(COUNT(A.CABT_GP_CD), 0, 'N', 'Y')
			 FROM TBCSPSAE801D A
			WHERE 1=1
			AND	A.YE = #YE#
			AND A.DGE = #DGE#
         ]]>
	</select>
	
	<select id="CSPSAE801EselectSubListCnt2" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(COUNT(A.QST_NO), 0, 'N', 'Y')
			 FROM TBCSPSAE803M A
			WHERE 1=1
			AND	A.YE = #YE#
			AND A.DGE = #DGE#
			AND	A.CABT_GP_CD = #CABT_GP_CD#
			AND A.CABT_CD = #CABT_CD#
         ]]>
	</select>
	
	<select id="CSPSAE801ESelectMaxDgeNext" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT TO_CHAR(NVL(MAX(DGE), 0)+1)
			  FROM TBCSPSAE801M
			 WHERE YE = #YE#
        ]]>
	</select>
	
	<insert id="CSPSAE801EMainInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPSAE801M
			(
			      YE
			    , DGE
			    , TIT
			    , SV_STR_DT
			    , SV_END_DT
			    , RMK
			    , FRT_REGI_DH
			    , FNL_MDF_DH
			) VALUES (
			      #YE#
			    , #DGE#
			    , #TIT#
			    , #SV_STR_DT#
			    , #SV_END_DT#
			    , #RMK#
			    , SYSDATE
			    , SYSDATE
			);
        ]]>
	</insert>
	
	<update id="CSPSAE801EMainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE801M
			SET		TIT = #TIT#,
					SV_STR_DT = #SV_STR_DT#,
					SV_END_DT = #SV_END_DT#,
					RMK = #RMK#,					
					FNL_MDF_DH = SYSDATE
			WHERE	YE = #YE#
			  AND   DGE = #DGE#
		]]>
	</update>
	
	<delete id="CSPSAE801EMainDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE801M A
			 WHERE 1=1
			   AND A.YE = #YE#
			   AND A.DGE = #DGE#
		]]>  
	</delete>
	
	<delete id="CSPSAE801EMainDelete2" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE802M A
			 WHERE 1=1
			   AND A.YE = #YE#
			   AND A.DGE = #DGE#
		]]>  
	</delete>
	
	<insert id="CSPSAE801ESubInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPSAE801D
			(
			      YE
			    , DGE
			    , CABT_GP_CD
			    , CABT_CD
			    , AV_SC_4RK
			    , AV_SC_5RK
			    , AV_SC_67RK
			    , OCM_AV_SC_5RK
			    , OCM_AV_SC_67RK
			    , CABT_DF
			    , FRT_REGI_DH
			    , FNL_MDF_DH
			) VALUES (
			      #YE#
			    , #DGE#
			    , #CABT_GP_CD#
			    , #CABT_CD#
			    , #AV_SC_4RK#
			    , #AV_SC_5RK#
			    , #AV_SC_67RK#
			    , #OCM_AV_SC_5RK#
			    , #OCM_AV_SC_67RK#
			    , #CABT_DF#
			    , SYSDATE
			    , SYSDATE
			);
        ]]>
	</insert>
	
	<update id="CSPSAE801ESubUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE801D
			SET		AV_SC_4RK = #AV_SC_4RK#,
					AV_SC_5RK = #AV_SC_5RK#,
					AV_SC_67RK = #AV_SC_67RK#,
					OCM_AV_SC_5RK = #OCM_AV_SC_5RK#,					
					OCM_AV_SC_67RK = #OCM_AV_SC_67RK#,					
					CABT_DF = #CABT_DF#,					
					FNL_MDF_DH = SYSDATE
			WHERE	YE = #YE#
			  AND   DGE = #DGE#
			  AND   CABT_GP_CD = #CABT_GP_CD#
			  AND   CABT_CD = #CABT_CD#
		]]>
	</update>
	
	<delete id="CSPSAE801ESubDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE801D A
			 WHERE 1=1
			   AND A.YE = #YE#
			   AND A.DGE = #DGE#
			   AND A.CABT_GP_CD = #CABT_GP_CD#
			   AND A.CABT_CD = #CABT_CD#
		]]>  
	</delete>
	
	<insert id="CSPSAE801ECabtInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPSAE801D (YE, DGE ,CABT_GP_CD, CABT_CD, AV_SC_4RK, AV_SC_5RK, AV_SC_67RK, OCM_AV_SC_5RK, OCM_AV_SC_67RK, CABT_DF, FRT_REGI_DH, FNL_MDF_DH)
			SELECT #strYE# AS YE,
			       #strDGE# AS DGE,
			       CABT_GP_CD,
			       CABT_CD,
			       AV_SC_4RK,
			       AV_SC_5RK,
			       AV_SC_67RK,
			       OCM_AV_SC_5RK,
			       OCM_AV_SC_67RK,
			       CABT_DF,
			       SYSDATE AS FRT_REGI_DH,
			       SYSDATE AS FNL_MDF_DH
			  FROM TBCSPSAE801D
			 WHERE YE = (SELECT MAX(YE) FROM TBCSPSAE801D)
			   AND DGE = (SELECT MAX(DGE) FROM TBCSPSAE801D);
        ]]>
	</insert>
	
	<delete id="CSPSAE801ECabtDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE801D WHERE YE = #strYE# AND DGE = #strDGE#
		]]>  
	</delete>
	
	<select id="CSPSAE801ESelectSubCdExist" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(COUNT(A.CABT_GP_CD), 0, 'N', 'Y')
			  FROM TBCSPSAE801D A
			 WHERE A.YE = #YE#
			   AND A.DGE = #DGE#
			   AND A.CABT_GP_CD = #CABT_GP_CD#
			   AND A.CABT_CD = #CABT_CD#
        ]]>
	</select>
	
	<select id="CSPSAE802EselectYe" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT DISTINCT 
			       YE
			  FROM TBCSPSAE801M
			ORDER BY YE DESC 
        ]]>
	</select>
	<select id="CSPSAE802EselectDge" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT DISTINCT 
			       YE,
			       DGE,
			       DGE || '차 - ' || TIT AS LABEL
			  FROM TBCSPSAE801M
			ORDER BY YE DESC, DGE DESC
        ]]>
	</select>
	
	<insert id="CSPSAE802EFileInsert" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO TBCSPSAE802M T1
			USING (
					SELECT
					#YE# AS YE
					,#DGE# AS DGE
					,#ATT_FL_DVSN_CD# AS ATT_FL_DVSN_CD
					FROM DUAL
				) T2
			ON	(	
					T1.YE = T2.YE
					AND T1.DGE = T2.DGE
					AND T1.ATT_FL_DVSN_CD = T2.ATT_FL_DVSN_CD
				)
			WHEN MATCHED THEN
					UPDATE	
        			SET		DOC_ID = #DOC_ID#,
        					FNL_MDF_DH = SYSDATE
        	WHEN NOT MATCHED THEN
					INSERT (
								YE				    /*연도*/
								,DGE			    /*차수*/
								,ATT_FL_DVSN_CD	    /*첨부파일구분코드*/
								,DOC_ID				/*첨부파일문서ID*/
								,FRT_REGI_DH		/*최초등록일시*/
								,FNL_MDF_DH			/*최종수정일시*/
							)
					VALUES	(
								#YE#			    /*연도*/
								,#DGE#			/*차수*/
								,#ATT_FL_DVSN_CD#	/*첨부파일구분코드*/
								,#DOC_ID#			/*첨부파일문서ID*/
								,SYSDATE			/*최초등록일시*/
								,SYSDATE			/*최종수정일시*/
							)
		]]>
	</insert>
	
	<update id="CSPSAE802EFileUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPSAE802M 
			   SET DOC_ID = ''
			 WHERE 1=1
			   AND YE = #YE#
			   AND DGE = #DGE#
			   AND DOC_ID = #DOC_ID#
		]]>  
	</update>	
	
	<select id="CSPSAE802EMainList" parameterClass="paramMap" resultClass="resultMap">
        SELECT YE
             , DGE
             , ATT_FL_DVSN_CD
             , DOC_ID
          FROM TBCSPSAE802M
         WHERE YE = #strYE#   
           AND DGE = #strDGE#
	</select>
	
	<select id="CSPSAE803EMainList" parameterClass="paramMap" resultClass="resultMap">
        SELECT YE
		     , DGE
		     , CABT_GP_CD
		     , F_CODE_NM('1000996',CABT_GP_CD) AS CABT_GP_NM
		     , CABT_CD
		     , F_CODE_NM('1000997',CABT_CD) AS CABT_NM
		  FROM TBCSPSAE801D
         WHERE YE = #strYE#   
           AND DGE = #strDGE#
           AND CABT_GP_CD != '900'
	</select>
	
	<select id="CSPSAE803ESubList" parameterClass="paramMap" resultClass="resultMap">
        SELECT YE
		     , DGE
		     , CABT_GP_CD
		     , CABT_CD
		     , QST_NO
		     , SNO
		     , QST
		     , ESSNTL_YN
		  FROM TBCSPSAE803M
         WHERE YE = #strYE#   
           AND DGE = #strDGE#
           AND CABT_GP_CD = #strCabtGpCd#
           AND CABT_CD = #strCabtCd#
      ORDER BY SNO ASC
	</select>
	
	<select id="CSPSAE803EselectSubListCnt" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(COUNT(A.CNB), 0, 'N', 'Y')
			 FROM TBCSPSAE803D A
			WHERE 1=1
			AND	A.YE = #YE#
			AND A.DGE = #DGE#
			AND	A.CABT_GP_CD = #CABT_GP_CD#
			AND A.CABT_CD = #CABT_CD#
			AND A.QST_NO = #QST_NO#
         ]]>
	</select>
	
	<insert id="CSPSAE803ESurveyInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPSAE803M
			(
			      YE
			    , DGE
			    , CABT_GP_CD
			    , CABT_CD
			    , QST_NO
			    , SNO
			    , QST
			    , ESSNTL_YN
			    , FRT_REGI_DH
			    , FNL_MDF_DH
			) VALUES (
			      #YE#
			    , #DGE#
			    , #CABT_GP_CD#
			    , #CABT_CD#
			    , (SELECT TO_CHAR(NVL(MAX(QST_NO), 0)+1) FROM TBCSPSAE803M WHERE YE = #YE# AND DGE = #DGE# AND CABT_GP_CD = #CABT_GP_CD# AND CABT_CD = #CABT_CD#)
			    , #SNO#
			    , #QST#
			    , #ESSNTL_YN#
			    , SYSDATE
			    , SYSDATE
			);
        ]]>
	</insert>
	
	<update id="CSPSAE803ESurveyUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE803M
			SET		SNO = #SNO#,
					QST = #QST#,
					ESSNTL_YN = #ESSNTL_YN#,
					FNL_MDF_DH = SYSDATE
			WHERE	YE = #YE#
			  AND   DGE = #DGE#
			  AND   CABT_GP_CD = #CABT_GP_CD#
			  AND   CABT_CD = #CABT_CD#
			  AND   QST_NO = #QST_NO# 
		]]>
	</update>
	
	<delete id="CSPSAE803ESurveyDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE803M A
			 WHERE 1=1
			   AND A.YE = #YE#
			   AND A.DGE = #DGE#
			   AND A.CABT_GP_CD = #CABT_GP_CD#
			   AND A.CABT_CD = #CABT_CD#
			   AND A.QST_NO = #QST_NO#
		]]>  
	</delete>
	
	<select id="CSPSAE804EMainList" parameterClass="paramMap" resultClass="resultMap">
        SELECT T1.YE ,
		       T1.DGE ,
		       T1.CABT_GP_CD ,
		       T1.CABT_CD ,
		       T1.QST_NO ,
		       F_CODE_NM('1000996',T1.CABT_GP_CD) || chr(13)||chr(10) || '[' || F_CODE_NM('1000997',T1.CABT_CD) || ']' AS CABT_NM,
		       T1.SNO ,
		       T1.QST ,
		       T2.CHO_ITM
		  FROM TBCSPSAE803M T1,
		       TBCSPSAE803D T2
		 WHERE T1.YE = T2.YE(+)
		   AND T1.DGE = T2.DGE(+)
		   AND T1.CABT_GP_CD = T2.CABT_GP_CD(+)
		   AND T1.CABT_CD = T2.CABT_CD(+)
		   AND T1.QST_NO = T2.QST_NO(+)
		   AND T1.YE = #strYE#
		   AND T1.DGE = #strDGE#
		   AND T2.CNB(+) = #CNB#
		 ORDER BY CABT_CD, SNO ASC
	</select>
	
	<select id="CSPSAE804ESurveyEnable" parameterClass="paramMap" resultClass="String">
        SELECT
		       CASE
		         WHEN SV_ENB = 'Y' THEN (SELECT DECODE(COUNT(*), 0, 'Y', 'N') AS SV_ENB  /* 설문했으면 저장버튼 비활성화 */
		                                   FROM TBCSPSAE803D
		                                  WHERE YE = #strYE#
		                                    AND DGE = #strDGE#
		                                    AND CNB = #CNB#)
		         ELSE 'N'
		       END AS SV_ENB
		  FROM (SELECT DECODE(COUNT(*), 0, 'N', 'Y') AS SV_ENB    /* 설문기간 체크하여 저장버튼 활성화 */
		          FROM TBCSPSAE801M
		         WHERE YE = #strYE#
		           AND DGE = #strDGE#
		           AND SYSDATE BETWEEN SV_STR_DT AND SV_END_DT)
	</select>
	
	<select id="CSPSAE804ESurveyDt" parameterClass="paramMap" resultClass="resultMap">
        SELECT SV_STR_DT,
		       SV_END_DT
		  FROM TBCSPSAE801M
		 WHERE YE = #strYE#
		   AND DGE = #strDGE# 
	</select>
	
	<select id="CSPSAE804EGetDocId" parameterClass="paramMap" resultClass="String">
	<![CDATA[
        SELECT DOC_ID
		  FROM TBCSPSAE802M
		 WHERE YE = #strYE#
		   AND DGE = #strDGE#
		   AND ATT_FL_DVSN_CD = (SELECT
		                               CASE
		                                 WHEN F_USR_INFO(#CNB#, '3') <= '014' THEN '1'
		                                 WHEN F_USR_INFO(#CNB#, '3') = '187' THEN '1'
		                                 WHEN F_USR_INFO(#CNB#, '3') = '015' THEN '2'
		                                 WHEN F_USR_INFO(#CNB#, '3') IN ('016', '017') THEN '3'
		                                 ELSE '3'
		                               END AS ATT_FL_DVSN_CD
		                          FROM DUAL)
    ]]>
	</select>
	
	<update id="CSPSAE804ESurveySave" parameterClass="paramMap">
		<![CDATA[
			MERGE INTO TBCSPSAE803D
			USING DUAL
			   ON (     
			            YE  = #YE#
			        AND DGE = #DGE#
			        AND CABT_GP_CD = #CABT_GP_CD# 
			        AND CABT_CD = #CABT_CD#
			        AND QST_NO = #QST_NO#
			        AND CNB = #CNB#			        
			      ) 
			 WHEN MATCHED THEN 
			    UPDATE 
			       SET CHO_ITM = #CHO_ITM#,
			           FNL_MDF_DH = SYSDATE			       
			 WHEN NOT MATCHED THEN   
			    INSERT( YE
			    	  ,	DGE
			    	  ,	CABT_GP_CD
			    	  , CABT_CD
			    	  , QST_NO
			    	  , CNB
			    	  , CHO_ITM
			    	  , RANK_CD
			    	  , FRT_REGI_DH
			    	  , FNL_MDF_DH
			        )
			    VALUES( #YE#
			    	  ,	#DGE#
			    	  ,	#CABT_GP_CD#
			    	  , #CABT_CD#
			    	  , #QST_NO#
			    	  , #CNB#
			    	  , #CHO_ITM#
			    	  , F_USR_INFO(#CNB#,'3')
			    	  , SYSDATE
			    	  , SYSDATE
			    	) 
		]]>
	</update>
	
	<select id="CSPSAE805EMainList" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
        SELECT T1.YE,
		       T1.DGE,
		       T1.CABT_GP_CD,
		       T1.CABT_CD,
		       CASE
		         WHEN T1.CABT_GP_CD = '900' THEN ''
		         ELSE F_CODE_NM('1000996',T1.CABT_GP_CD) END AS CABT_GP_NM,
		       F_CODE_NM('1000997',T1.CABT_CD) AS CABT_NM,
		       CASE
		         WHEN T2.RANK_CD <= '014' THEN T1.AV_SC_4RK
		         WHEN T2.RANK_CD = '187' THEN T1.AV_SC_4RK
		         WHEN T2.RANK_CD = '015' THEN T1.AV_SC_5RK
		         WHEN T2.RANK_CD IN ('016', '017') THEN T1.AV_SC_67RK
		         ELSE T1.AV_SC_67RK
		       END AS AV_SC_1,
		       CASE
		         WHEN T2.RANK_CD <= '014' THEN NULL
		         WHEN T2.RANK_CD = '187' THEN NULL
		         WHEN T2.RANK_CD = '015' THEN T1.OCM_AV_SC_5RK
		         WHEN T2.RANK_CD IN ('016', '017') THEN T1.OCM_AV_SC_67RK
		         ELSE T1.OCM_AV_SC_67RK
		       END AS AV_SC_2,
		       CASE
		         WHEN T1.CABT_CD = '900' THEN (SELECT NVL(TRUNC(AVG(NVL(CHO_ITM, 0)), 2),0) FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#)
		         ELSE TRUNC(AVG(NVL(T2.CHO_ITM, 0)), 2) END AS MY_AV_SC,
		       T1.CABT_DF
		  FROM TBCSPSAE801D T1,
		       TBCSPSAE803D T2
		 WHERE 1=1
		   AND T1.YE = T2.YE(+)
		   AND T1.DGE = T2.DGE(+)
		   AND T1.CABT_GP_CD = T2.CABT_GP_CD(+)
		   AND T1.CABT_CD = T2.CABT_CD(+)
		   AND T1.YE = #strYE#
		   AND T1.DGE = #strDGE#
		   AND T2.CNB(+) = #CNB#
		 GROUP BY T1.YE, T1.DGE, T1.CABT_GP_CD, T1.CABT_CD, T1.AV_SC_4RK, T1.AV_SC_5RK, T1.AV_SC_67RK, T1.OCM_AV_SC_5RK, T1.OCM_AV_SC_67RK, T2.RANK_CD, T1.CABT_DF
		
      ORDER BY CABT_GP_CD, CABT_CD
	]]>
	
	<!--  UNION ALL
		 
		 SELECT '' AS YE,
		        '' AS DGE,
		        '' AS CABT_GP_CD,
		        '' AS CABT_CD,
		        '' AS CABT_GP_NM,
		        '전체' AS CABT_NM,
		        (SELECT TRUNC(AVG(NVL((CASE
		                                 WHEN (SELECT DISTINCT RANK_CD FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#) <= '014' THEN AV_SC_4RK
		                                 WHEN (SELECT DISTINCT RANK_CD FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#) = '187' THEN AV_SC_4RK
		                                 WHEN (SELECT DISTINCT RANK_CD FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#) = '015' THEN AV_SC_5RK
		                                 WHEN (SELECT DISTINCT RANK_CD FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#) IN ('016', '017') THEN AV_SC_67RK
		                                 ELSE AV_SC_67RK
		                               END), 0)), 2) FROM TBCSPSAE801D WHERE YE = #strYE# AND DGE = #strDGE#) AS AV_SC_1,  
		        (SELECT TRUNC(AVG(NVL((CASE
		                                 WHEN (SELECT DISTINCT RANK_CD FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#) <= '014' THEN NULL
		                                 WHEN (SELECT DISTINCT RANK_CD FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#) = '187' THEN NULL
		                                 WHEN (SELECT DISTINCT RANK_CD FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#) = '015' THEN OCM_AV_SC_5RK
		                                 WHEN (SELECT DISTINCT RANK_CD FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#) IN ('016', '017') THEN OCM_AV_SC_67RK
		                                 ELSE OCM_AV_SC_67RK
		                               END), 0)), 2) FROM TBCSPSAE801D WHERE YE = #strYE# AND DGE = #strDGE#) AS AV_SC_2,  
		        (SELECT NVL(TRUNC(AVG(NVL(CHO_ITM, 0)), 2),0) FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#) AS MY_AV_SC
		  FROM DUAL -->
	</select>
	
	
	<select id="CSPSAE805EReportListselect" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
        SELECT T1.YE,
		       T1.DGE,
		       T1.CABT_GP_CD,
		       T1.CABT_CD,
		       CASE
		         WHEN T1.CABT_GP_CD = '900' THEN ''
		         ELSE F_CODE_NM('1000996',T1.CABT_GP_CD) END AS CABT_GP_NM,
		       F_CODE_NM('1000997',T1.CABT_CD) AS CABT_NM,
		       CASE
		         WHEN T2.RANK_CD <= '014' THEN T1.AV_SC_4RK
		         WHEN T2.RANK_CD = '187' THEN T1.AV_SC_4RK
		         WHEN T2.RANK_CD = '015' THEN T1.AV_SC_5RK
		         WHEN T2.RANK_CD IN ('016', '017') THEN T1.AV_SC_67RK
		         ELSE T1.AV_SC_67RK
		       END AS AV_SC_1,
		       CASE
		         WHEN T2.RANK_CD <= '014' THEN NULL
		         WHEN T2.RANK_CD = '187' THEN NULL
		         WHEN T2.RANK_CD = '015' THEN T1.OCM_AV_SC_5RK
		         WHEN T2.RANK_CD IN ('016', '017') THEN T1.OCM_AV_SC_67RK
		         ELSE T1.OCM_AV_SC_67RK
		       END AS AV_SC_2,
		       CASE
		         WHEN T1.CABT_CD = '900' THEN (SELECT NVL(TRUNC(AVG(NVL(CHO_ITM, 0)), 2),0) FROM TBCSPSAE803D WHERE YE = #strYE# AND DGE = #strDGE# AND CNB = #CNB#)
		         ELSE TRUNC(AVG(NVL(T2.CHO_ITM, 0)), 2) END AS MY_AV_SC,
		       T1.CABT_DF
		  FROM TBCSPSAE801D T1,
		       TBCSPSAE803D T2
		 WHERE 1=1
		   AND T1.YE = T2.YE(+)
		   AND T1.DGE = T2.DGE(+)
		   AND T1.CABT_GP_CD = T2.CABT_GP_CD(+)
		   AND T1.CABT_CD = T2.CABT_CD(+)
		   AND T1.YE = #strYE#
		   AND T1.DGE = #strDGE#
		   AND T2.CNB(+) = #CNB#
		 GROUP BY T1.YE, T1.DGE, T1.CABT_GP_CD, T1.CABT_CD, T1.AV_SC_4RK, T1.AV_SC_5RK, T1.AV_SC_67RK, T1.OCM_AV_SC_5RK, T1.OCM_AV_SC_67RK, T2.RANK_CD, T1.CABT_DF
		
      ORDER BY CABT_GP_CD, CABT_CD
	]]>
	</select>
	
</sqlMap> 
