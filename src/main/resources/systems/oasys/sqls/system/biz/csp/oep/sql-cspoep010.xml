<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/oep/010">

	<resultMap class="java.util.HashMap" id="mainselect">
	    <result property="NDTY_DT"            column="NDTY_DT"          jdbcType="VARCHAR2"     javaType="java.lang.String"/>
	    <result property="NDTY_DVSN_CD"       column="NDTY_DVSN_CD"     jdbcType="VARCHAR2"		javaType="java.lang.String"/>
	    <result property="NDTY_DVSN_NM"       column="NDTY_DVSN_NM"     jdbcType="VARCHAR2"		javaType="java.lang.String"/>
	    <result property="DOC_ACP_SEQ"        column="DOC_ACP_SEQ"      jdbcType="VARCHAR2"		javaType="java.lang.String"/>
	    <result property="NDTY_AST_NAM"       column="NDTY_AST_NAM"     jdbcType="VARCHAR2"     javaType="java.lang.String"/>
	    <result property="NDTY_AST_CNB"       column="NDTY_AST_CNB"     jdbcType="VARCHAR2"     javaType="java.lang.String"/>
	    <result property="NDTY_AST_RANK"      column="NDTY_AST_RANK"    jdbcType="VARCHAR2"     javaType="java.lang.String"/>
	    <result property="DOC_ACP_MNG_NAM"    column="DOC_ACP_MNG_NAM"  jdbcType="VARCHAR2"		javaType="java.lang.String"/>
	    <result property="DOC_ACP_MNG_CNB"    column="DOC_ACP_MNG_CNB"  jdbcType="VARCHAR2"		javaType="java.lang.String"/>
	    <result property="DOC_ACP_MNG_RANK"   column="DOC_ACP_MNG_RANK" jdbcType="VARCHAR2"		javaType="java.lang.String"/> 
	    <result property="DOC_ACP_TXT"        column="DOC_ACP_TXT"      jdbcType="CLOB"       	javaType="java.lang.String"/>
	    <result property="DOC_ACP_STA_CD"     column="DOC_ACP_STA_CD"   jdbcType="VARCHAR2"     javaType="java.lang.String"/>
    </resultMap>
	
	
	<!-- 문서접수 목록조회 -->
    <select id="CSPOEP010EMainSelect" parameterClass="paramMap" resultClass="resultMap">
    	<![CDATA[  /* csp/oep/010/CSPOEP010EMainSelect */ ]]>
		<![CDATA[
			SELECT  ROWNUM AS KEY, 
			        A.NDTY_DT,
			        A.NDTY_DVSN_CD,
			        F_CODE_NM('1000899', A.NDTY_DVSN_CD) AS NDTY_DVSN_NM,
                    A.DOC_ACP_SEQ,
					F_DPT_INFO(C.DPT_CD, '1') AS NDTY_AST_DPT_NM,
					F_CODE_NM('1000173', C.RANK_CD) AS NDTY_AST_RANK,
			        C.USR_NAM AS NDTY_AST_NAM,
                    F_DPT_INFO(B.DPT_CD, '1') AS DOC_ACP_MNG_DPT_NM,
			        F_CODE_NM('1000173', B.RANK_CD) AS DOC_ACP_MNG_RANK,
					B.USR_NAM AS DOC_ACP_MNG_NAM,
                    A.DOC_ACP_STA_CD,
			        F_CODE_NM('1000901', A.DOC_ACP_STA_CD) AS DOC_ACP_STA_NM
			FROM    TBCSPOEP005M A,
			        TBDCMACM001M B,
			        TBDCMACM001M C
			WHERE   A.DOC_ACP_MNG_CNB = B.CNB
			AND     A.NDTY_AST_CNB  = C.CNB
        ]]>
        <dynamic>
        	<isNotEmpty property="strNDTY_DTS" prepend="AND">
        		A.NDTY_DT &gt;= #strNDTY_DTS#
        	</isNotEmpty>
        	<isNotEmpty property="strNDTY_DTE" prepend="AND">
        		A.NDTY_DT &lt;= #strNDTY_DTE#
        	</isNotEmpty>
        	<isNotEmpty property="strCNB" prepend="AND">
        		A.NDTY_AST_CNB = #strCNB#
        	</isNotEmpty>
        	<isNotEmpty property="strDOC_ACP_STA_CD" prepend="AND">
        		A.DOC_ACP_STA_CD = #strDOC_ACP_STA_CD#
        		<isEqual property="strDOC_ACP_STA_CD" compareValue="0" prepend="AND">
        			A.DOC_ACP_STA_CD IN ('1','2', NULL)
        		</isEqual>  		
        	</isNotEmpty>
        	<isNotEmpty property="strNDTY_DVSN_CD" prepend="AND">
        		A.NDTY_DVSN_CD = #strNDTY_DVSN_CD#
        		<isEqual property="strNDTY_DVSN_CD" compareValue="00" prepend="AND">
        			A.NDTY_DVSN_CD IN ('01','02')
        		</isEqual>  		
        	</isNotEmpty>
        </dynamic>
        ORDER BY A.NDTY_DT DESC, A.NDTY_DVSN_CD ASC
    </select>
    
    
    <!-- 당직근무 상세조회 -->
    <select id="CSPOEP010EDetailSelect" parameterClass="paramMap" resultMap="mainselect">
    	<![CDATA[  /* csp/oep/010/CSPOEP010EDetailSelect */ ]]>
		SELECT  A.NDTY_DT,
				A.NDTY_DVSN_CD,
				F_CODE_NM('1000899', A.NDTY_DVSN_CD) AS NDTY_DVSN_NM,
				A.DOC_ACP_SEQ,
		        C.USR_NAM AS NDTY_AST_NAM,
				A.NDTY_AST_CNB,
				F_CODE_NM('1000173', C.RANK_CD) AS NDTY_AST_RANK,
				B.USR_NAM AS DOC_ACP_MNG_NAM,
		        A.DOC_ACP_MNG_CNB,
		        F_CODE_NM('1000173', B.RANK_CD) AS DOC_ACP_MNG_RANK,
				A.DOC_ACP_TXT,
				A.DOC_ACP_STA_CD
		FROM    TBCSPOEP005M A,
		        TBDCMACM001M B,
		        TBDCMACM001M C
		WHERE   A.DOC_ACP_MNG_CNB = B.CNB
		AND     A.NDTY_AST_CNB  = C.CNB
		<isNotEmpty property="strNDTY_DT" prepend="AND">
			A.NDTY_DT		= #strNDTY_DT#
		</isNotEmpty>
		<isNotEmpty property="strNDTY_DVSN_CD" prepend="AND">
			A.NDTY_DVSN_CD	= #strNDTY_DVSN_CD#
		</isNotEmpty>
		<isNotEmpty property="strDOC_ACP_SEQ" prepend="AND">
			A.DOC_ACP_SEQ	= #strDOC_ACP_SEQ#
		</isNotEmpty>
    </select>
    
    
    <!-- 당직근무 상세조회 -->
    <select id="CSPOEP010EChkCntSelect" parameterClass="paramMap" resultClass="Integer">
    	<![CDATA[  /* csp/oep/010/CSPOEP010EChkCntSelect */ ]]>
		SELECT  COUNT(1) AS CNT
		FROM    TBCSPOEP005M
		WHERE   NDTY_DT			= #strNDTY_DT#
		AND		NDTY_DVSN_CD	= #strNDTY_DVSN_CD#
    </select>
    
    
    <!-- 당직근무 상세조회 -->
    <select id="CSPOEP010EDocAcpSeqSelect" parameterClass="paramMap" resultClass="Integer">
    	<![CDATA[  /* csp/oep/010/CSPOEP010EDocAcpSeqSelect */ ]]>
		SELECT  MAX(DOC_ACP_SEQ)+ 1 AS DOC_ACP_SEQ
		FROM    TBCSPOEP005M
		WHERE   NDTY_DT			= #strNDTY_DT#
		AND		NDTY_DVSN_CD	= #strNDTY_DVSN_CD#
    </select>
    
    
    <!-- 당직근무 등록 -->
    <update id="CSPOEP010EInsert"  parameterClass="paramMap">
    	<![CDATA[  /* csp/oep/010/CSPOEP010EInsert */ ]]>
		INSERT INTO TBCSPOEP005M(
	   			NDTY_DT,
	   			NDTY_DVSN_CD,
	            DOC_ACP_SEQ,
	   			NDTY_AST_CNB,
	            DOC_ACP_MNG_CNB,
	   			DOC_ACP_TXT,
	            DOC_ACP_STA_CD,
	   			FRT_USR_ID,
	   			FNL_USR_ID,
	   			FNL_DEAL_DPT_CD,
	   			FNL_MNU_ID,
	   			FRT_REGI_DH,
	   			FNL_MDF_DH
	   		)VALUES (
	   			#NDTY_DT#,
	   			#NDTY_DVSN_CD#,
			<isNotEmpty property="DOC_ACP_SEQ">
	            #DOC_ACP_SEQ#,
           	</isNotEmpty>
           	<isEmpty property="DOC_ACP_SEQ">
            	1,
           	</isEmpty>
	   			#NDTY_AST_CNB#,
	            #DOC_ACP_MNG_CNB#,
	   			#DOC_ACP_TXT#,
	   			#DOC_ACP_STA_CD#,
	   			#FRT_USR_ID#,
	   			#FNL_USR_ID#,
	   			#FNL_DEAL_DPT_CD#,
	   			#FNL_MNU_ID#,
	   			SYSDATE,
	   			SYSDATE
	   		)
    </update>
    
    
    <!-- 당직근무 수정 -->
    <update id="CSPOEP010EUpdate" parameterClass="paramMap">
    	<![CDATA[  /* csp/oep/010/CSPOEP010EUpdate */ ]]>
   		UPDATE	TBCSPOEP005M
   		SET		NDTY_AST_CNB	= #NDTY_AST_CNB#,
   				DOC_ACP_MNG_CNB	= #DOC_ACP_MNG_CNB#,
   				DOC_ACP_TXT		= #DOC_ACP_TXT#
   		WHERE	NDTY_DT			= #NDTY_DT#
   		AND		NDTY_DVSN_CD	= #NDTY_DVSN_CD#
   		AND		DOC_ACP_SEQ		= #DOC_ACP_SEQ#
	</update>
    
    
    <!-- 당직근무 삭제 -->
    <update id="CSPOEP010EDelete" parameterClass="paramMap">
    	<![CDATA[  /* csp/oep/010/CSPOEP010EDelete */ ]]>
   		DELETE	TBCSPOEP005M
   		WHERE	NDTY_DT			= #NDTY_DT#
   		AND		NDTY_DVSN_CD	= #NDTY_DVSN_CD#
   		AND		DOC_ACP_SEQ		= #DOC_ACP_SEQ#
    </update>
    
    
    <!-- 당직근무 수정 -->
    <update id="CSPOEP010EUpdateDocAcpStaCd" parameterClass="paramMap">
    	<![CDATA[  /* csp/oep/010/CSPOEP010EUpdateDocAcpStaCd */ ]]>
   		UPDATE	TBCSPOEP005M
   		SET		DOC_ACP_STA_CD	= #DOC_ACP_STA_CD#
   		WHERE	NDTY_DT			= #NDTY_DT#
   		AND		NDTY_DVSN_CD	= #NDTY_DVSN_CD#
   		AND		DOC_ACP_SEQ		= #DOC_ACP_SEQ#
	</update>
	
	
	<select id="CSPOEP010EDocAcpMngNamSelect" parameterClass="paramMap" resultClass="resultMap">
    	<![CDATA[  /* csp/oep/010/CSPOEP010EDocAcpMngNamSelect */ ]]>
		SELECT  USR_NAM AS DOC_ACP_MNG_NAM,
		        F_CODE_NM('1000173', RANK_CD) AS DOC_ACP_MNG_RANK
		FROM    TBDCMACM001M
		WHERE   CNB = #strDOC_ACP_MNG_CNB#
    </select>
	
	
    
</sqlMap> 
