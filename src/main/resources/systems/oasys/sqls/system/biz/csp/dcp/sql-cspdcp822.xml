<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/822">
 	
 	<resultMap class="java.util.HashMap" id="CSPDCP822PMainSelect">
			<result property="STTM_DVSN_CD" 			 column="STTM_DVSN_CD" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_YR" 						 column="ACP_YR" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_ACP_NO" 			 column="STTM_ACP_NO" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_NO" 			 column="ACP_NO" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HMP_APL_NO" 				 column="HMP_APL_NO" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_KND_CD" 			 column="STTM_KND_CD" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_KND_DTL_CD" 	 column="STTM_KND_DTL_CD" 	     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_KND_NM" 			 column="STTM_KND_NM" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_KND_DTL_NM" 	 column="STTM_KND_DTL_NM" 	     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="NAM" 							 column="NAM" 							     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EIN" 							 column="EIN" 							     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="JB_NM" 						 column="JB_NM" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="AD" 								 column="AD" 								     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="TNB" 							 column="TNB" 							     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="EML_AD" 						 column="EML_AD" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="TIT_NM" 						 column="TIT_NM" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="DOC_ID" 						 column="DOC_ID" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_EXCU_TXT" 		 column="STTM_EXCU_TXT" 		     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_TXT_DH" 			 column="STTM_TXT_DH" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_PLC_NM" 			 column="STTM_PLC_NM" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="STTM_TXT" 					 column="STTM_TXT" 					     jdbcType="CLOB" javaType="java.lang.String" />
			<result property="RTRN_WAY_TXT" 			 column="RTRN_WAY_TXT" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RMK_TXT" 					 column="RMK_TXT" 					     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="OTR_ORG_NM" 				 column="OTR_ORG_NM" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="INSPC_AGR_YN" 			 column="INSPC_AGR_YN" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="OTR_INSPC_AGR_YN" 	 column="OTR_INSPC_AGR_YN" 	     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_DH" 						 column="ACP_DH" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_RUT_CD" 				 column="ACP_RUT_CD" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_RUT_NM" 				 column="ACP_RUT_NM" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_STA_CD" 			 column="HNDL_STA_CD" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_STA_NM" 			 column="HNDL_STA_NM" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_DH" 					 column="HNDL_DH" 					     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ANS_TXT" 					 column="ANS_TXT" 					     jdbcType="CLOB" javaType="java.lang.String" />
			<result property="FRT_REGI_DH" 			 column="FRT_REGI_DH" 			     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RES_NAM" 					 column="RES_NAM" 					     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RES_TNB" 					 column="RES_TNB" 					     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RES_JB_NM" 				 column="RES_JB_NM" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RES_AD" 						 column="RES_AD" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="CRP_NM" 						 column="CRP_NM" 						     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="FRT_USR_ID" 				 column="FRT_USR_ID" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="RM_STTM_ACP_NO" 				 column="RM_STTM_ACP_NO" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_DPT_CD" 				 column="ACP_DPT_CD" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_DPT_NM" 				 column="ACP_DPT_NM" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_PEN_CNB" 				 column="ACP_PEN_CNB" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ACP_PEN_NAM" 				 column="ACP_PEN_NAM" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_DPT_CD" 				 column="HNDL_DPT_CD" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_CHGR_ID" 				 column="HNDL_CHGR_ID" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="DOC_YN" 				 column="DOC_YN" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="HNDL_YN" 				 column="HNDL_YN" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ONR_APV_RQS_DH" 				 column="ONR_APV_RQS_DH" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ONR_APV_CMPT_DH" 				 column="ONR_APV_CMPT_DH" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="OPM_NTF_DVSN_NM" 				 column="OPM_NTF_DVSN_NM" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ANS_TXT" 				 column="ANS_TXT" 				     jdbcType="CLOB" javaType="java.lang.String" />
			<result property="OPM_ONR_APV_CMPT_DH" 				 column="OPM_ONR_APV_CMPT_DH" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			<result property="ONR_DOC_MNG_CRD_ID" 				 column="ONR_DOC_MNG_CRD_ID" 				     jdbcType="VARCHAR2" javaType="java.lang.String" />
			
	</resultMap>
 	<select id="CSPDCP822PMainSelect" parameterClass="paramMap" resultMap="CSPDCP822PMainSelect">
		<![CDATA[
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
					,T1.STTM_ACP_NO
					,DECODE(T1.RM_STTM_ACP_NO,NULL,NULL,T1.ACP_YR||'-'||'청금-'||T1.RM_STTM_ACP_NO) AS ACP_NO	
					,T1.HMP_APL_NO
					,T1.STTM_KND_CD
					,T1.STTM_KND_DTL_CD
					,F_CODE_NM('1000758',T1.STTM_KND_CD) AS STTM_KND_NM
					,F_CODE_NM('1000759',T1.STTM_KND_DTL_CD) AS STTM_KND_DTL_NM
					,T1.NAM
					,T1.EIN
					,T1.JB_NM
					,T1.AD
					,T1.TNB
					,T1.EML_AD
					,T1.TIT_NM
					,T1.DOC_ID
					,T1.STTM_EXCU_TXT
					,T1.STTM_TXT_DH
					,T1.STTM_PLC_NM
					,T1.STTM_TXT
					,T1.RTRN_WAY_TXT
					,T1.RMK_TXT
					,T1.OTR_ORG_NM
					,T1.INSPC_AGR_YN
					,T1.OTR_INSPC_AGR_YN
					,TO_CHAR(T1.ACP_DH,'YYYY-MM-DD HH24:MI') AS ACP_DH
					,T1.ACP_RUT_CD
					,F_CODE_NM('1000761',T1.ACP_RUT_CD) AS ACP_RUT_NM
					,T1.HNDL_STA_CD
					,F_CODE_NM('1000760',T1.HNDL_STA_CD) AS HNDL_STA_NM
					,T1.HNDL_DH 
					,T1.ANS_TXT
					,T1.FRT_REGI_DH
					,T2.RES_NAM
					,T2.RES_TNB
					,T2.RES_JB_NM
					,T2.RES_AD
					,T2.CRP_NM
					,T1.FRT_USR_ID
					,T1.RM_STTM_ACP_NO
					,T1.ACP_DPT_CD
					,F_DPT_INFO(ACP_DPT_CD,'1') AS ACP_DPT_NM
					,T1.ACP_PEN_CNB
					,F_USR_INFO(T1.ACP_PEN_CNB,'2') AS ACP_PEN_NAM
					,T3.HNDL_DPT_CD
   					,T3.HNDL_CHGR_ID
   					,CASE WHEN T5.STTM_DVSN_CD IS NOT NULL 
   						THEN CASE WHEN T6.ONR_DOC_MNG_CRD_ID IS NOT NULL THEN 'Y' ELSE 'N' END
   						ELSE CASE WHEN T4.ONR_DOC_MNG_CRD_ID IS NOT NULL THEN 'Y' ELSE 'N' END
   					END AS DOC_YN
   					,CASE WHEN T5.STTM_DVSN_CD IS NOT NULL 
   						THEN CASE WHEN T6.OPM_APV_HNDL_STA_CD <> '30' OR T6.OPM_APV_HNDL_STA_CD IS NULL THEN '1' WHEN T6.OPM_APV_HNDL_STA_CD = '30' THEN '2' ELSE '3' END
   						ELSE CASE WHEN T4.OPM_APV_HNDL_STA_CD <> '30' OR T4.OPM_APV_HNDL_STA_CD IS NULL THEN '1' WHEN T4.OPM_APV_HNDL_STA_CD = '30' THEN '2' ELSE '3' END
   					END AS HNDL_YN
   					,CASE WHEN T5.STTM_DVSN_CD IS NOT NULL  THEN TO_CHAR(T6.ONR_APV_RQS_DH,'YYYY-MM-DD HH24:MI')
   						ELSE TO_CHAR(T4.ONR_APV_RQS_DH,'YYYY-MM-DD HH24:MI') 
   					END AS ONR_APV_RQS_DH
   					,CASE WHEN T5.STTM_DVSN_CD IS NOT NULL THEN TO_CHAR(T6.ONR_APV_CMPT_DH,'YYYY-MM-DD HH24:MI')
   						ELSE TO_CHAR(T4.ONR_APV_CMPT_DH,'YYYY-MM-DD HH24:MI') 
   					END AS ONR_APV_CMPT_DH
   					,DECODE(NVL(T1.OPM_NTF_DVSN_CD,'N'),'N','미통보','통보') AS OPM_NTF_DVSN_NM
   					,T1.ANS_TXT
   					,(SELECT	TO_CHAR(S1.ONR_APV_CMPT_DH,'YYYY-MM-DD HH24:MI') AS ONR_APV_CMPT_DH
   						FROM	TBCSPDCP818M S1
   						WHERE	T1.STTM_DVSN_CD = S1.STTM_DVSN_CD
   						AND		T1.ACP_YR = S1.ACP_YR
   						AND		T1.STTM_ACP_NO = S1.STTM_ACP_NO
   						AND		S1.IFM_DVSN_CD = '20'
   					) AS OPM_ONR_APV_CMPT_DH
   					,CASE WHEN T5.STTM_DVSN_CD IS NOT NULL THEN T6.ONR_DOC_MNG_CRD_ID
   						ELSE T4.ONR_DOC_MNG_CRD_ID 
   					END AS ONR_DOC_MNG_CRD_ID
			FROM	TBCSPDCP811M T1
					,TBCSPDCP812M T2
					,TBCSPDCP813M T3
					,TBCSPDCP818M T4
					,TBCSPDCP819L T5
					,TBCSPDCP818M T6
			WHERE	T1.STTM_DVSN_CD = T2.STTM_DVSN_CD
			AND		T1.ACP_YR = T2.ACP_YR
			AND		T1.STTM_ACP_NO = T2.STTM_ACP_NO
			AND		T1.STTM_DVSN_CD = #strSTTM_DVSN_CD# 
			AND		T1.ACP_YR = #strACP_YR#
			AND		T1.STTM_ACP_NO = #strSTTM_ACP_NO#
			AND		T1.STTM_DVSN_CD = T3.STTM_DVSN_CD(+)
			AND		T1.ACP_YR = T3.ACP_YR(+)
			AND		T1.STTM_ACP_NO = T3.STTM_ACP_NO(+)
			AND		T1.STTM_DVSN_CD = T4.STTM_DVSN_CD(+)
			AND		T1.ACP_YR = T4.ACP_YR(+)
			AND		T1.STTM_ACP_NO = T4.STTM_ACP_NO(+)
			AND	    T1.STTM_DVSN_CD = T5.SUC_STTM_DVSN_CD(+)
			AND     T1.ACP_YR = T5.SUC_ACP_YR(+)
			AND     T1.STTM_ACP_NO = T5.SUC_STTM_ACP_NO(+)
			AND     T5.STTM_DVSN_CD = T6.STTM_DVSN_CD(+)
			AND     T5.ACP_YR = T6.ACP_YR(+)
			AND     T5.STTM_ACP_NO = T6.STTM_ACP_NO(+)
			AND		T4.IFM_DVSN_CD(+) = '10'
			AND		T6.IFM_DVSN_CD(+) = '10'
		]]>
	</select>
	
	
	<select id="CSPDCP822PHndlSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[	
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
					,T1.STTM_ACP_NO
   					,T3.SRNO
   					,T3.HNDL_DVSN_CD
   					,T3.TRNF_DPT_CD
   					,F_DPT_INFO(T3.TRNF_DPT_CD,'1') AS TRNF_DPT_NM
   					,F_CODE_NM('1000764',T3.HNDL_DVSN_CD) AS HNDL_DVSN_NM
   					,T3.DOC_ID AS HNDL_DOC_ID
   					,'첨부파일보기' AS DOC_NM
   			FROM	TBCSPDCP811M T1
   					, TBCSPDCP813M T2
   					,TBCSPDCP815L T3
   			WHERE	T1.STTM_DVSN_CD = T2.STTM_DVSN_CD
			AND		T1.ACP_YR = T2.ACP_YR
			AND		T1.STTM_ACP_NO = T2.STTM_ACP_NO
			AND		T1.STTM_DVSN_CD = #strSTTM_DVSN_CD# 
			AND		T1.ACP_YR = #strACP_YR# 
			AND		T1.STTM_ACP_NO = #strSTTM_ACP_NO#
			AND		T1.STTM_DVSN_CD = T3.STTM_DVSN_CD
			AND		T1.ACP_YR = T3.ACP_YR
			AND		T1.STTM_ACP_NO = T3.STTM_ACP_NO
   			ORDER BY T3.SRNO ASC
   		]]>
   	</select>
   	
   	<select id="CSPDCP822PHndlOrgSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	T1.STTM_DVSN_CD
					,T1.ACP_YR
   					,T1.STTM_ACP_NO
   					,T1.HNDL_ORG_SRNO
   					,T1.SRNO
   					,T1.ORG_CD
   					,T1.PUB_DVSN_CD
   					,T1.COPT_SG_CD
   					,F_ORG_HRK_NM(T1.COPT_SG_CD) AS COPT_SG_NM
   					, F_ORG_INFO(T1.ORG_CD,'1') AS ORG_NM 
   					,F_CODE_NM('1000447', T1.PUB_DVSN_CD) AS PUB_DVSN_NM
   			FROM	TBCSPDCP816L T1
   			WHERE	T1.STTM_DVSN_CD = #strSTTM_DVSN_CD#
   			AND		T1.ACP_YR = #strACP_YR#
   			AND		T1.STTM_ACP_NO = #strSTTM_ACP_NO#
   			AND		T1.SRNO = #strSRNO#
   		]]>
   	</select>
   	
   	<select id="CSPDCP822PSucSelect" parameterClass="paramMap" resultClass="resultMap">
   		<![CDATA[
   			SELECT DISTINCT F_CODE_NM('1000758',D2.STTM_KND_CD) AS STTM_KND_NM,
                F_CODE_NM('1000759',D2.STTM_KND_DTL_CD) AS STTM_KND_DTL_NM,
			       TO_CHAR(D2.ACP_DH, 'YYYY.MM.DD HH:MM') AS ACP_DH ,
			       D2.ACP_YR||'-청금-'||D2.RM_STTM_ACP_NO AS ACP_NO ,
			       D2.TIT_NM ,
			       D2.NAM ,
			       'O' AS MAIN_YN ,
			       CASE
			         WHEN D1.STTM_DVSN_CD = #strSTTM_DVSN_CD# 
			   AND D1.ACP_YR = #strACP_YR#
			   AND D1.STTM_ACP_NO = #strSTTM_ACP_NO# THEN 'O'
			         ELSE ''
			       END AS JEBO_YN
			  FROM TBCSPDCP819L D1,
			       TBCSPDCP811M D2
			 WHERE D1.STTM_DVSN_CD = D2.STTM_DVSN_CD
			   AND D1.ACP_YR = D2.ACP_YR
			   AND D1.STTM_ACP_NO = D2.STTM_ACP_NO
			   AND ((D1.STTM_DVSN_CD = #strSTTM_DVSN_CD# 
			                   AND D1.ACP_YR = #strACP_YR#
			                   AND D1.STTM_ACP_NO = #strSTTM_ACP_NO#)
			            OR (D1.SUC_STTM_DVSN_CD = #strSTTM_DVSN_CD# 
			                   AND D1.SUC_ACP_YR = #strACP_YR#
			                   AND D1.SUC_STTM_ACP_NO = #strSTTM_ACP_NO#))
			 UNION
			SELECT DISTINCT 
                   F_CODE_NM('1000758',D3.STTM_KND_CD) AS STTM_KND_NM,
                   F_CODE_NM('1000759',D3.STTM_KND_DTL_CD) AS STTM_KND_DTL_NM,
			       TO_CHAR(D3.ACP_DH, 'YYYY.MM.DD HH:MM') AS ACP_DH ,
			       D3.ACP_YR||'-청금-'||D3.RM_STTM_ACP_NO AS ACP_YR_NO ,
			       D3.TIT_NM ,
			       D3.NAM ,
			       '' AS MAIN_YN ,
			       CASE
			         WHEN D2.SUC_STTM_DVSN_CD = #strSTTM_DVSN_CD# 
			   AND D2.SUC_ACP_YR = #strACP_YR#
			   AND D2.SUC_STTM_ACP_NO = #strSTTM_ACP_NO# THEN 'O'
			         ELSE ''
			       END AS JEBO_YN
			  FROM TBCSPDCP819L D1,
			       TBCSPDCP819L D2,
			       TBCSPDCP811M D3
			 WHERE D1.STTM_DVSN_CD = D2.STTM_DVSN_CD
			   AND D1.ACP_YR = D2.ACP_YR
			   AND D1.STTM_ACP_NO = D2.STTM_ACP_NO
			   AND D2.SUC_STTM_DVSN_CD = D3.STTM_DVSN_CD
			   AND D2.SUC_ACP_YR = D3.ACP_YR
			   AND D2.SUC_STTM_ACP_NO = D3.STTM_ACP_NO
			   AND ((D1.STTM_DVSN_CD =#strSTTM_DVSN_CD# 
			                   AND D1.ACP_YR = #strACP_YR#
			                   AND D1.STTM_ACP_NO = #strSTTM_ACP_NO#)
			            OR (D1.SUC_STTM_DVSN_CD =#strSTTM_DVSN_CD# 
			                   AND D1.SUC_ACP_YR = #strACP_YR#
			                   AND D1.SUC_STTM_ACP_NO = #strSTTM_ACP_NO#))
			ORDER BY MAIN_YN, ACP_DH DESC
   		]]>
   	</select>
</sqlMap> 

