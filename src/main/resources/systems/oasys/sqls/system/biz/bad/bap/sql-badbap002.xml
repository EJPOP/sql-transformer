<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/bap/002">
	
	<!--위탁 및 대행감사관리 조회-->
	<select id="BADBAP002EMainselect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
               SELECT D1.ORG_CD                                               /* 기관코드           */
                     ,F_ORG_INFO(D1.ORG_CD,'1')        AS ORG_NM              /* 기관명             */
                     ,D1.YR                                                   /* 연도               */
                     ,D1.DLG_CSM_NO                                           /* 위임위탁번호       */
                     ,D1.NTF_DT                                               /* 통보일             */
                     ,D1.NTF_ORG_CD                                           /* 통보기관코드       */
                     ,D1.NTF_PEN_ID                                           /* 통보자ID         */
                     ,D1.NTF_DPT_NM                                           /* 통보부서명         */
                     ,D1.ACP_STA_CD                                           /* 접수상태코드       */
                     ,D1.ACP_DT                                               /* 접수일             */
                     ,D1.RCEP_ID                                              /* 접수자ID         */
                     ,D1.DLG_CSM_DVSN_CD                                      /* 위임위탁구분코드   */
                     ,F_CODE_NM('1000207',D1.DLG_CSM_DVSN_CD) 
                                                       AS DLG_CSM_DVSN_NM     /* 위임위탁구분명     */
                     ,D1.AUD_EXEC_DVSN_CD                                     /* 감사실시구분코드   */
                     ,D1.AUD_SBJ_NM                                           /* 감사사항명         */
                     ,D1.AUD_EPS_SBJ                                          /* 감사중점사항       */
                     ,D1.AUD_EXEC_RN_TXT                                      /* 감사실시범위내용   */
                     ,D1.ETC_SBJ                                              /* 기타사항           */
                     ,D1.HNDL_DDLN_DT                                         /* 처리기한일         */
                     ,D1.AUD_TG_TSK_CD                                        /* 감사대상업무코드   */
                     ,D1.DOC_ID                                               /* 문서ID           */
                     ,D1.DOC_TYP_CD                                           /* 문서유형코드       */
                     ,D1.ORGCHF_PST_NM                                        /* 기관장직위명       */
                     ,D1.PCR_RQ_CSM_TXT                                       /* 대행요구위탁내용   */
                     ,D1.AUD_RSLT_ACP_TXT                                     /* 감사결과접수내용   */
                     ,D1.AUD_DCN_TXT                                          /* 감사일수기간내용   */
                     ,D1.DRTR_SBJ                                             /* 책임자사항         */
                     ,D1.INDC_NOC_TXT                                         /* 지적건수내용       */
                     ,D1.FRT_USR_ID                                           /* 최초사용자ID      */
                     ,D1.FNL_USR_ID                                           /* 최종사용자ID      */
                     ,D1.FNL_DEAL_DPT_CD                                      /* 최종거래부서코드   */
                     ,D1.FNL_MNU_ID                                           /* 최종메뉴ID       */
                     ,D1.FRT_REGI_DH                                          /* 최초등록일시       */
                     ,D1.FNL_MDF_DH                                           /* 최종수정일시       */
                FROM TBBADBAP001M D1                                          /* 위탁및대행감사기본 */
               WHERE 1=1
                 AND D1.YR BETWEEN #strYrStr# AND #strYrEnd# 
		]]>
		<isNotEqual property="strDlgCsmDvsnCd" compareValue="0">	 
                 AND D1.DLG_CSM_DVSN_CD  = #strDlgCsmDvsnCd#                            /* 위탁대행구분(위임위탁구분코드) */
		</isNotEqual>
		<isNotEmpty property="strOrgCd">	 
                 AND D1.ORG_CD           = #strOrgCd#                                   /* 실시기관(기관코드) */
		</isNotEmpty>
		<isNotEmpty property="strAudSbjNm">	 
                 AND D1.AUD_SBJ_NM       LIKE '%'|| #strAudSbjNm# || '%'                /* 감사사항명 */
		</isNotEmpty>	
        <![CDATA[       
			  ORDER BY D1.ORG_CD, D1.YR, D1.DLG_CSM_NO
        ]]>
	</select>
	
	
	<!--위탁 및 대행감사기본 delete-->
	<update id="BADBAP002EMaindelete" parameterClass="paramMap">
          DELETE 
            FROM TBBADBAP001M
           WHERE ORG_CD     = #ORG_CD#
             AND YR         = #YR# 
             AND DLG_CSM_NO = #DLG_CSM_NO# 
	</update>

	<!--감사대상기관내역 delete-->
	<update id="BADBAP002ETgdelete" parameterClass="paramMap">
          DELETE 
            FROM TBBADBAP001L
           WHERE ORG_CD     = #ORG_CD#
             AND YR         = #YR# 
             AND DLG_CSM_NO = #DLG_CSM_NO#
             
         <isNotEmpty property="strTgOrgCd">	 
             AND TG_ORG_CD  = #TG_ORG_CD#
         </isNotEmpty>
	</update>
	
</sqlMap> 
