<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/cm/001">
	
	<select id="CSPCM001MmsSeqSelect" parameterClass="paramMap" resultClass="Integer">
		<![CDATA[
			SELECT 	MMS_CONTENTS_INFO_SEQ.NEXTVAL AS CONT_SEQ 
			FROM  	DUAL
		]]>
	</select>
	
	<insert id="CSPCM001MmsMsgInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MMS_CONTENTS_INFO 
				 	(	CONT_SEQ
				 		, FILE_CNT
				 		, MMS_BODY
				 		, MMS_SUBJECT
				 	) 
			VALUES (	#CONT_SEQ#
						, 1
						, #SMS_CONTENT#
						, #MMS_SUBJECT#
					)
		]]>
	</insert>
	
	<insert id="CSPCM001MsgInsert" parameterClass ="paramMap">
		<![CDATA[
			INSERT INTO MSG_DATA
				 	(	MSG_SEQ
				 		, CUR_STATE
				 		, REQ_DATE
				 		, CALL_TO
				 		, CALL_FROM
		]]>
			<isEqual property="MSG_TYPE" compareValue="4">
				 		, SMS_TXT
			</isEqual>
		<![CDATA[
				 		, MSG_TYPE
				 		, CONT_SEQ
				 	) 
			VALUES (	MSG_DATA_SEQ.NEXTVAL
						, 0
						, SYSDATE
						, REPLACE(#CALLTONUM#,'-','')
						, REPLACE(#CALLFROMNUM#,'-','')
		]]>
			<isEqual property="MSG_TYPE" compareValue="4">
						, #SMS_CONTENT#		
			</isEqual>
		<![CDATA[
						, #MSG_TYPE#
						, #CONT_SEQ#
					)
		]]>
	</insert>
	
	<insert id="CSPCM001InsertMSGSend" parameterClass="paramMap">
		<![CDATA[
			CALL NURI2_MESSAGE_SEND(#CALLFROMNUM#, #CALLTONUM#, #MMS_SUBJECT#, #SMS_CONTENT#)
		]]>
	</insert>	
</sqlMap> 
