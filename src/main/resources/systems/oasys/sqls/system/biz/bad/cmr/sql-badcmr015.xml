<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/cmr/015">
	

     <select id="badcmr015ComboYear" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[ 
        	SELECT TO_CHAR(1999+LEVEL) CD
			     , TO_CHAR(1999+LEVEL) CD_NM
			  FROM DUAL
			  CONNECT BY LEVEL < 31  
			  ]]>
          </select>
          
          
      <select id="badcmr015QBankselect" parameterClass="paramMap"
		resultClass="java.util.HashMap">
        <![CDATA[ 
			 SELECT 
          A.YE
         ,A.SALL_CAT_SNO
         ,A.LAG_CAT_SNO
         ,A.MID_CAT_SNO
         ,A.SALL_CAT_TIT_NM
         ,A.SALL_CAT_TXT
         ,A.CHR_DPT_CD
         , F_DPT_INFO(A.CHR_DPT_CD,'1') AS CHR_DPT_NM
         ,A.CHGR_ID
         ,A.CMPT_YN
         ,A.REGI_DT
         ,A.REGN_ID
         ,A.MDF_DT
         ,A.MDF_PEN_ID
         ,A.DEL_YN
         ,A.YE||'-'||A.LAG_CAT_SNO||'-'||MID_CAT_SNO||'-'||SALL_CAT_SNO AS SNO
        
 
        ,(select max(REGI_DT) from TBBADCMR004D where YE = A.YE and SALL_CAT_SNO = A.SALL_CAT_SNO and REGI_DT BETWEEN #strYear#||'0101' AND #strYear#||'0401' ) QT1_PLCY_MDF_DH  
        ,(select max(REGI_DT) from TBBADCMR004D where YE = A.YE and SALL_CAT_SNO = A.SALL_CAT_SNO and REGI_DT BETWEEN #strYear#||'0402' AND #strYear#||'1001' ) QT2_PLCY_MDF_DH  

        ,(SELECT SUBSTR(MAX(PLCY_MDF_DH), 0, 8) 
            FROM TBBADCMR004D 
           WHERE YE           = A.YE 
             AND SALL_CAT_SNO = A.SALL_CAT_SNO 
             AND REGI_DT      BETWEEN #strYear# ||'0101' AND #strYear# ||'0401' )   AS FIRST_HALF_MDF_DH   /*상반기 - 2015.06.03 yyh*/
		,(SELECT SUBSTR(MAX(PLCY_MDF_DH), 0, 8) 
		    FROM TBBADCMR004D 
		   WHERE YE           = A.YE 
		     AND SALL_CAT_SNO = A.SALL_CAT_SNO 
		     AND REGI_DT      BETWEEN #strYear# ||'0402' AND #strYear# ||'1001' )   AS SECOND_HALF_MDF_DH  /*하반기 - 2015.06.03 yyh*/
		
        ,D.USR_NAM AS CHRG_PSON_NM
        , A.CPR_CHGR_ID
			     , F_USR_INFO(A.CPR_CHGR_ID,'2')AS CPR_CHGR_NM
					, A.CPR_DPT_CD
					, F_DPT_INFO(A.CPR_DPT_CD,'1') AS CPR_DPT_NM
					, A.STD_CHGR_ID
					, F_USR_INFO(A.STD_CHGR_ID,'2')AS STD_CHGR_NM
					, A.STD_DPT_CD
					, F_DPT_INFO(A.STD_DPT_CD,'1') AS STD_DPT_NM
					, NVL(EPS_MNG_YN,'N') AS EPS_MNG_YN
        FROM TBBADCMR003M A 
           , TBDCMACM001M D 
        WHERE 
            D.BAI_USR_YN = 'Y' 
        AND A.CHGR_ID = D.CNB(+)
        	     
			  ]]>
		<isNotEmpty prepend="AND" property="strYear">
			A.YE =#strYear#
		</isNotEmpty>	
		<isNotEmpty prepend="AND" property="strHrkDptCd">
			((A.CHR_DPT_CD LIKE #strHrkDptCd#||'%')
			<isNotEmpty   property="strDptCd">
				OR A.CPR_DPT_CD = #strDptCd# OR A.STD_DPT_CD = #strDptCd#
			</isNotEmpty>	  
			)
		</isNotEmpty>		
		
		<isNotEmpty prepend="AND" property="strEPS_MNG_YN">
			NVL(A.EPS_MNG_YN,'N') = #strEPS_MNG_YN#
		</isNotEmpty>	
		
		<![CDATA[
         ORDER BY A.YE, CASE WHEN A.YE ='2017' AND A.SALL_CAT_SNO < 187 THEN 1 ELSE 0 END, A.SALL_CAT_SNO 
       ]]>
			  
      </select>
    
     
	
</sqlMap> 
