<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/hpm/001">
	<resultMap class="java.util.HashMap" id="csphpm001qMap">
		<result property="NUM" column="NUM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TOT_CNT" column="TOT_CNT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NTT_ID" column="NTT_ID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NTT_SJ" column="NTT_SJ" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="FRST_REGISTER_ID" column="FRST_REGISTER_ID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="FRST_REGISTER_NM" column="FRST_REGISTER_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="FRST_REGIST_PNTTM" column="FRST_REGIST_PNTTM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="EMAIL" column="EMAIL" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="TEL" column="TEL" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="JUSO" column="JUSO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NTT_CN" column="NTT_CN" jdbcType="CLOB" javaType="java.lang.String" />
		<result property="RDCNT" column="RDCNT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="CATEGORY" column="CATEGORY" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="PARNTSCTT_NO" column="PARNTSCTT_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ANSWER_AT" column="ANSWER_AT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ANSWER_LC" column="ANSWER_LC" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="USE_AT" column="USE_AT" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="DOC_ID" column="DOC_ID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="BBS_ID" column="BBS_ID" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NTCE_BGNDE" column="NTCE_BGNDE" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NTCE_ENDDE" column="NTCE_ENDDE" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NTCR_NM" column="NTCR_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REL_ORG_CD" column="REL_ORG_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="REL_ORG_NM" column="REL_ORG_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="ORG_REGI_YN" column="ORG_REGI_YN" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="INSTITUTION" column="INSTITUTION" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="APV_STA_CD" column="APV_STA_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="APV_DOC_NO" column="APV_DOC_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="HNDL_DVSN_CD" column="HNDL_DVSN_CD" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="QNA_STATE" column="QNA_STATE" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="QNA_STATE_NM" column="QNA_STATE_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="HNDL_DVSN_NM" column="HNDL_DVSN_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="QNA_ANSWER" column="QNA_ANSWER" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	
	<resultMap class="java.util.HashMap" id="csphpm001qMap1">
		<result property="CVPT_ACP_NO" column="CVPT_ACP_NO" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>	

	<resultMap class="java.util.HashMap" id="csphpm001qMap2">
		<result property="NTCR_NM" column="NTCR_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="FRST_REGIST_PNTTM" column="FRST_REGIST_PNTTM" jdbcType="VARCHAR2" javaType="java.lang.String" />
		<result property="NTT_SJ" column="NTT_SJ" jdbcType="VARCHAR2"   javaType="java.lang.String" />
		<result property="NTT_CN" column="NTT_CN" jdbcType="CLOB"       javaType="java.lang.String" />
		<result property="DOC_ID" column="DOC_ID" jdbcType="VARCHAR2"   javaType="java.lang.String" />
		<result property="REL_ORG_NM" column="REL_ORG_NM" jdbcType="VARCHAR2" javaType="java.lang.String" />
	</resultMap>
	
	<!--국민감사제안 정보를 조회한다.-->
	<select id="CSPHPM001Qmainselect" parameterClass="paramMap" resultMap="csphpm001qMap">
	<include refid = "include.pageSelct"/><!-- 페이징 -->
        <![CDATA[
			SELECT
				a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, NVL(b.USR_NAM, a.NTCR_NM) AS FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') AS FRST_REGIST_PNTTM, a.EMAIL, a.TEL, a.JUSO, 
				CASE WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NOT NULL THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.NTT_CN) || CHR(13)||CHR(10) ||TO_CLOB(a.SUB2)
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NULL     THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.NTT_CN)
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NOT NULL     THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.SUB2)
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NOT NULL     THEN TO_CLOB(a.NTT_CN) || CHR(13)||CHR(10) || TO_CLOB(a.SUB2)
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NULL         THEN TO_CLOB(a.SUB1)
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NULL         THEN TO_CLOB(a.NTT_CN)
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NOT NULL         THEN TO_CLOB(a.SUB2)
					 ELSE TO_CLOB('')
					 END NTT_CN,
				a.RDCNT,a.CATEGORY, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.DOC_ID ,
				a.BBS_ID, RTRIM(a.NTCE_BGNDE) NTCE_BGNDE, RTRIM(a.NTCE_ENDDE) NTCE_ENDDE,  a.NTCR_NM, '' AS HNDL_DVSN_NM, 
				a.REL_ORG_CD, F_ORG_INFO(a.REL_ORG_CD,'1') AS REL_ORG_NM , CASE WHEN a.ORG_REGI_YN='Y' THEN '등록' ELSE '미등록' END AS ORG_REGI_YN,
				a.INSTITUTION,
				CASE WHEN a.APV_STA_CD='' OR a.APV_STA_CD IS NULL THEN '1' ELSE a.APV_STA_CD END AS APV_STA_CD,a.APV_DOC_NO,a.HNDL_DVSN_CD,
				A.QNA_STATE,
				CASE WHEN a.QNA_STATE = 'receive' THEN '답변완료'
				     ELSE '답변대기'
				      END AS QNA_STATE_NM
				      , '' QNA_ANSWER
			FROM
				TBCSPTSM002L a
			LEFT OUTER JOIN 
				TBDCMACM001M b
			ON a.FRST_REGISTER_ID = b.USR_ID 
			WHERE BBS_ID='BBSMSTR_100000000032'
			AND a.USE_AT = 'Y' 
		]]>	
		<isNotEmpty property="strSearchBox"><!-- 제목, 내용, 작성자 -->
			AND (a.NTT_SJ  LIKE '%' || #strSearchBox# || '%' OR  a.NTT_CN  LIKE '%' || #strSearchBox# || '%' OR a.NTCR_NM  LIKE '%' || #strSearchBox# || '%')	
		</isNotEmpty>
		
		<isNotEmpty property="strREL_ORG_CD"><!-- 관련기관-->
			AND a.REL_ORG_CD =  #strREL_ORG_CD# 	
		</isNotEmpty>
		
		<isNotEmpty property="strORG_REGI_YN"><!-- 기관정보 등록 여부 -->
			<isEqual property="strORG_REGI_YN" compareValue="A">
			AND (a.ORG_REGI_YN = 'N' OR  a.ORG_REGI_YN = 'Y' OR  a.ORG_REGI_YN IS NULL)
			</isEqual>	
			<isNotEqual property="strORG_REGI_YN" compareValue="A">
			AND a.ORG_REGI_YN =  #strORG_REGI_YN# 
			</isNotEqual>	
			
			<isEqual property="strDPT_TP_CD" compareValue="A">
				AND T2.ENFM_DPT_CD = #strDPT_CD#
			</isEqual>
		</isNotEmpty>
		
	 	<isNotEmpty property="strYr" > <!-- 연도별 -->
			AND SUBSTR(a.FRST_REGIST_PNTTM,1,4) = #strYr#	
		</isNotEmpty>
		
		<isNotEmpty property="strFRST_REGIST_PNTTMS"><!-- 시작 작성일 -->
			AND (TO_CHAR(a.FRST_REGIST_PNTTM,'YYYYMMDD') <![CDATA[ >= ]]> #strFRST_REGIST_PNTTMS# OR  a.FRST_REGIST_PNTTM IS NULL)
		</isNotEmpty>
	
		<isNotEmpty  property="strFRST_REGIST_PNTTME"><!-- 종료 작성일 -->
			AND (TO_CHAR(a.FRST_REGIST_PNTTM,'YYYYMMDD') <![CDATA[ <= ]]> #strFRST_REGIST_PNTTME# OR a.FRST_REGIST_PNTTM IS NULL)
		</isNotEmpty>
		<isNotEmpty  property="strApvStaCd"><!-- 상태 -->
			
			<isEqual property="strApvStaCd" compareValue="1">
			AND (a.APV_STA_CD <![CDATA[ = ]]> #strApvStaCd# OR a.APV_STA_CD IS NULL OR a.APV_STA_CD = '')
			</isEqual>
			<isNotEqual property="strApvStaCd" compareValue="1">
			AND a.APV_STA_CD <![CDATA[ = ]]> #strApvStaCd# 
			</isNotEqual>
			
		</isNotEmpty>
		
		ORDER BY a.PARNTSCTT_NO DESC
		<include refid = "include.pageOrder"/> <!-- 페이징 -->
	</select>	
	
	
	<update id="CSPHPM001QmainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPTSM002L 
			   SET REL_ORG_CD = #strREL_ORG_CD#
			      ,ORG_REGI_YN = #strORG_REGI_YN#
			      ,HNDL_DVSN_CD = #strHNDL_DVSN_CD#
			 WHERE NTT_ID = #strNTT_ID#
			 AND BBS_ID='BBSMSTR_100000000032'
			 AND USE_AT = 'Y' 
		]]>
	</update>
	
	<select id="CSPHPM001APMainApvSelect" parameterClass="paramMap" resultMap="csphpm001qMap">
	
        <![CDATA[
			SELECT
				ROW_NUMBER() OVER(ORDER BY A.FRST_REGIST_PNTTM DESC) AS NUM, '0' AS TOT_CNT, '' AS QNA_STATE, a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, NVL(b.USR_NAM, a.NTCR_NM) AS FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') AS FRST_REGIST_PNTTM, a.EMAIL, a.TEL, a.JUSO,
				CASE WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NOT NULL THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.NTT_CN) || CHR(13)||CHR(10) ||TO_CLOB(a.SUB2)
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NULL     THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.NTT_CN)
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NOT NULL     THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.SUB2)
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NOT NULL     THEN TO_CLOB(a.NTT_CN) || CHR(13)||CHR(10) || TO_CLOB(a.SUB2)
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NULL         THEN TO_CLOB(a.SUB1)
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NULL         THEN TO_CLOB(a.NTT_CN)
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NOT NULL         THEN TO_CLOB(a.SUB2)
					 ELSE TO_CLOB('')
					 END NTT_CN,
				a.RDCNT,a.CATEGORY, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.DOC_ID ,
				a.BBS_ID, RTRIM(a.NTCE_BGNDE) NTCE_BGNDE, RTRIM(a.NTCE_ENDDE) NTCE_ENDDE,  a.NTCR_NM,
				a.REL_ORG_CD, F_ORG_INFO(a.REL_ORG_CD,'1') AS REL_ORG_NM , CASE WHEN a.ORG_REGI_YN='Y' THEN '등록' ELSE '미등록' END AS ORG_REGI_YN,
				a.APV_STA_CD,a.APV_DOC_NO,
				F_CODE_NM('1000920',a.HNDL_DVSN_CD) AS HNDL_DVSN_NM, a.INSTITUTION, a.HNDL_DVSN_CD, '' AS QNA_STATE_NM
				, A.QNA_ANSWER
			FROM
				TBCSPTSM002L a
			LEFT OUTER JOIN 
				TBDCMACM001M b
			ON a.FRST_REGISTER_ID = b.USR_ID 
			WHERE BBS_ID='BBSMSTR_100000000032'
			AND a.USE_AT = 'Y' 
			
		]]>	
		
		
		<isNotEmpty property = "parentKey">
			AND  a.NTT_ID IN
			<iterate property = "parentKey" open="(" close=")" conjunction=",">
				#parentKey[]#
			</iterate>
		</isNotEmpty>
		
		<isNotEmpty property="strApvDocNo"><!-- 결쟂문서번호 -->
		AND a.APV_DOC_NO =  #strApvDocNo#
		</isNotEmpty>
		
	</select>
	
	<select id="CSPHPM001QSelectApvDocNoList" parameterClass="paramMap" 	resultClass="resultMap">
	
        <![CDATA[
			SELECT a.NTT_ID,a.APV_DOC_NO
			FROM
				TBCSPTSM002L a
			LEFT OUTER JOIN 
				TBDCMACM001M b
			ON a.FRST_REGISTER_ID = b.USR_ID 
			WHERE BBS_ID='BBSMSTR_100000000032'
			AND a.USE_AT = 'Y' 
			
		]]>	
		
		<isNotEmpty property="strDocNo"><!-- 결재문서번호 -->
		AND a.APV_DOC_NO =  #strDocNo#
		</isNotEmpty>		
	</select>
	
	<!-- 결재처리정보를 수정한다 -->
	<update id="CSPHPM001APApvInfoupdate" parameterClass="paramMap">
           UPDATE TBCSPTSM002L                    		
              SET APV_DOC_NO        = #APV_DOC_NO#,		/* 결재문서번호 */
                  APV_STA_CD    	= #APV_STA_CD#
                  <isNotEmpty property = "APV_DOC_HTML_TXT_CONTENT">
                   , QNA_ANSWER = #APV_DOC_HTML_TXT_CONTENT#
                  </isNotEmpty>
           WHERE BBS_ID='BBSMSTR_100000000032'    		/* 게시판구분코드 */ 
           	 AND USE_AT = 'Y' 
          	<isNotEmpty property = "parentKey">
			 AND NTT_ID IN
			<iterate property = "parentKey" open="(" close=")" conjunction=",">
				#parentKey[]#
			</iterate>
			</isNotEmpty>
			
	</update>
	
	
	<!-- 결재처리정보를 수정한다 -->
	<update id="CSPHPM001APApvInfoupdate2" parameterClass="paramMap">
           UPDATE TBCSPTSM002L                    		
              SET APV_DOC_NO        = #APV_DOC_NO#,		/* 결재문서번호 */
                  APV_STA_CD    	= #APV_STA_CD#
                  <isNotEmpty property = "APV_DOC_HTML_TXT_CONTENT">
                   , QNA_ANSWER = #APV_DOC_HTML_TXT_CONTENT#
                  </isNotEmpty>
           WHERE BBS_ID='BBSMSTR_100000000032'    		/* 게시판구분코드 */ 
           	 AND USE_AT = 'Y' 
			<isNotEmpty property="strApvDocNo"><!-- 결재문서번호 -->
			AND APV_DOC_NO =  #strApvDocNo#
			</isNotEmpty>
	</update>
	<!-- 결재처리정보를 수정한다 -->
	<update id="CSPHPM001APApvDocInfoupdate" parameterClass="paramMap">
           UPDATE TBCSPTSM002L                    		
              SET APV_DOC_NO        = #APV_DOC_NO#,		/* 결재문서번호 */
                  APV_STA_CD    	= #APV_STA_CD#
                  <isNotEmpty property = "APV_DOC_HTML_TXT_CONTENT">
                   , QNA_ANSWER = #APV_DOC_HTML_TXT_CONTENT#
                  </isNotEmpty>
           WHERE BBS_ID='BBSMSTR_100000000032'    		/* 게시판구분코드 */ 
           	 AND USE_AT = 'Y'
			 AND APV_DOC_NO = #strApvDocNo#
			
			
	</update>
	
	<!-- 처리구분을 수정한다 -->
	<update id="CSPHPM001QHndlUpdate" parameterClass="paramMap">
           UPDATE TBCSPTSM002L                    		
              SET HNDL_DVSN_CD = #HNDL_DVSN_CD#		/* 처리구분코드 */
           WHERE BBS_ID ='BBSMSTR_100000000032'    	/* 게시판구분코드 */ 
			 AND NTT_ID = #NTT_ID#
	</update>	
	
	<!-- 문서정보로 감사주제생각나눔 데이터를 가져온다  -->
	<select id="CSPHPM001APSelect" parameterClass="paramMap" 	resultClass="resultMap" resultMap="csphpm001qMap">
	SELECT ROW_NUMBER() OVER(
	         ORDER BY A.FRST_REGIST_PNTTM DESC) AS NUM,
		       '0' AS TOT_CNT,
		       '' AS QNA_STATE,
		       a.NTT_ID,
		       a.NTT_SJ,
		       a.FRST_REGISTER_ID,
		       NVL(b.USR_NAM, a.NTCR_NM) AS FRST_REGISTER_NM,
		       TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') AS FRST_REGIST_PNTTM,
		       a.EMAIL,
		       a.TEL,
		       a.JUSO,
		       CASE
		         WHEN a.SUB1 IS NOT NULL
		   AND a.NTT_CN IS NOT NULL
		   AND a.SUB2 IS NOT NULL THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.NTT_CN) || CHR(13)||CHR(10) ||TO_CLOB(a.SUB2)
		         WHEN a.SUB1 IS NOT NULL
		   AND a.NTT_CN IS NOT NULL
		   AND a.SUB2 IS NULL THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.NTT_CN)
		         WHEN a.SUB1 IS NOT NULL
		   AND a.NTT_CN IS NULL
		   AND a.SUB2 IS NOT NULL THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.SUB2)
		         WHEN a.SUB1 IS NULL
		   AND a.NTT_CN IS NOT NULL
		   AND a.SUB2 IS NOT NULL THEN TO_CLOB(a.NTT_CN) || CHR(13)||CHR(10) || TO_CLOB(a.SUB2)
		         WHEN a.SUB1 IS NOT NULL
		   AND a.NTT_CN IS NULL
		   AND a.SUB2 IS NULL THEN TO_CLOB(a.SUB1)
		         WHEN a.SUB1 IS NULL
		   AND a.NTT_CN IS NOT NULL
		   AND a.SUB2 IS NULL THEN TO_CLOB(a.NTT_CN)
		         WHEN a.SUB1 IS NULL
		   AND a.NTT_CN IS NULL
		   AND a.SUB2 IS NOT NULL THEN TO_CLOB(a.SUB2)
		         ELSE TO_CLOB('')
		       END NTT_CN,
		       a.RDCNT,
		       a.CATEGORY,
		       a.PARNTSCTT_NO,
		       a.ANSWER_AT,
		       a.ANSWER_LC,
		       a.USE_AT,
		       a.DOC_ID ,
		       a.BBS_ID,
		       RTRIM(a.NTCE_BGNDE) NTCE_BGNDE,
		       RTRIM(a.NTCE_ENDDE) NTCE_ENDDE,
		       a.NTCR_NM,
		       a.REL_ORG_CD,
		       F_ORG_INFO(a.REL_ORG_CD, '1') AS REL_ORG_NM ,
		       a.ORG_REGI_YN,
		       a.APV_STA_CD,
		       a.APV_DOC_NO,
		       F_CODE_NM('1000920', a.HNDL_DVSN_CD) AS HNDL_DVSN_NM,
		       a.INSTITUTION,
		       a.HNDL_DVSN_CD,
		       '' AS QNA_STATE_NM,
		       A.QNA_ANSWER
		  FROM TBCSPTSM002L a LEFT OUTER JOIN TBDCMACM001M b ON a.FRST_REGISTER_ID = b.USR_ID
		 WHERE BBS_ID='BBSMSTR_100000000032'
		   AND a.USE_AT = 'Y'
		   AND a.APV_DOC_NO = #strApvDocNo#
        	
	</select>
	
	<select id="CSPHPM001APSelect1" parameterClass="paramMap" resultMap="csphpm001qMap1">
		SELECT LPAD(TO_CHAR(NVL(MAX(TO_NUMBER(CVPT_ACP_NO)),0)+1),5,0) AS CVPT_ACP_NO
			  FROM TBCSPDCP101M
			 WHERE 1=1
		       AND REQ_DVSN_CD = '1'
		       AND ACP_YR = #acpYr#
        	
	</select>
	
	<insert id="TBCSPDCP101MInsert" parameterClass="java.util.Map">
		INSERT
		  INTO TBCSPDCP101M (CVPTR_NM,  FNL_USR_ID, FNL_DEAL_DPT_CD, FNL_MNU_ID , FNL_MDF_DH, RSLT_NTF_WAY_CD, CVPT_HNDL_STA_CD, ACP_RUT_CD, REQR_KND_CD, REQ_DVSN_CD, ACP_YR, CVPT_ACP_NO, TIT_NM, FRT_USR_ID , FRT_REGI_DH , EML_ID , EML_DMI_NM , TNB, DTL_AD , DOC_ID, INNER_YN ,INNER_ORG_NM  )
		VALUES ( 
			   #FRST_REGISTER_NM#,
			   #FNL_USR_ID#,
			   #FNL_DEAL_DPT_CD#,
			   #FNL_MNU_ID#,
			   SYSDATE,
			   '003',
			   '10',
		       '9' ,
		       '1' ,
		       '1' ,
               #acpYr# ,
               #cvptAcpNo# ,
               #NTT_SJ# ,
               #FRT_USR_ID# ,
               SYSDATE,
               SUBSTR(#EMAIL#, '0', INSTR(#EMAIL#, '@')-1) ,
               SUBSTR(#EMAIL#, INSTR(#EMAIL#, '@')+1),
               #TEL# ,
               #JUSO# ,
               #DOC_ID# ,
               #ORG_REGI_YN# ,
               #INSTITUTION# )
	</insert>
	
	<insert id="TBCSPDCP102MInsert" parameterClass="java.util.Map">
		INSERT
 		 INTO TBCSPDCP102M ( REQ_DVSN_CD , ACP_YR , CVPT_ACP_NO , CVPT_TXT ,  FRT_USR_ID , FNL_USR_ID , FNL_DEAL_DPT_CD , FNL_MNU_ID , FRT_REGI_DH , FNL_MDF_DH )
		VALUES ( 	   '1' ,
		               #acpYr# ,
		               #cvptAcpNo# ,
		               #NTT_CN# ,
		               #FRT_USR_ID# ,
		               #FNL_USR_ID# ,
		               #FNL_DEAL_DPT_CD# ,
		               #FNL_MNU_ID# ,
		               SYSDATE ,
		               SYSDATE )
	</insert>
	
	<insert id="TBCSPDCP104MInsert" parameterClass="java.util.Map">
		INSERT
		  INTO TBCSPDCP104L ( REQ_DVSN_CD , ACP_YR , CVPT_ACP_NO , AUD_TG_ORG_CD , FRT_USR_ID , FNL_USR_ID , FNL_DEAL_DPT_CD , FNL_MNU_ID , FRT_REGI_DH , FNL_MDF_DH )
		VALUES ( '1' ,
		               #acpYr# ,
		               #cvptAcpNo# ,
		               #REL_ORG_CD# ,
		               #FRT_USR_ID# ,
		               #FNL_USR_ID# ,
		               #FNL_DEAL_DPT_CD# ,
		               #FNL_MNU_ID# ,
		               SYSDATE ,
		               SYSDATE )
	</insert>
    <select id="CSPHPM001QmainSubSelect" parameterClass="paramMap" resultMap="csphpm001qMap2">  
        	SELECT  
				NTCR_NM             /* 게시자명 */
				,FRST_REGIST_PNTTM  /* 최초등록시점 */
				,NTT_SJ				/* 게시물제목 */ 
				,CASE WHEN SUB1 IS NOT NULL AND NTT_CN IS NOT NULL AND SUB2 IS NOT NULL THEN TO_CLOB(SUB1)   || CHR(13) || CHR(10) || TO_CLOB(NTT_CN) || CHR(13) || CHR(10) || TO_CLOB(SUB2)
					  WHEN SUB1 IS NOT NULL AND NTT_CN IS NOT NULL AND SUB2 IS NULL     THEN TO_CLOB(SUB1)   || CHR(13) || CHR(10) || TO_CLOB(NTT_CN)
					  WHEN SUB1 IS NOT NULL AND NTT_CN IS NULL     AND SUB2 IS NOT NULL THEN TO_CLOB(SUB1)   || CHR(13) || CHR(10) || TO_CLOB(SUB2)
					  WHEN SUB1 IS NULL     AND NTT_CN IS NOT NULL AND SUB2 IS NOT NULL THEN TO_CLOB(NTT_CN) || CHR(13) || CHR(10) || TO_CLOB(SUB2)
					  WHEN SUB1 IS NOT NULL AND NTT_CN IS NULL     AND SUB2 IS NULL     THEN TO_CLOB(SUB1)
					  WHEN SUB1 IS NULL     AND NTT_CN IS NOT NULL AND SUB2 IS NULL     THEN TO_CLOB(NTT_CN)
					  WHEN SUB1 IS NULL     AND NTT_CN IS NULL     AND SUB2 IS NOT NULL THEN TO_CLOB(SUB2)
				 ELSE TO_CLOB('')
				 END NTT_CN  /* 게시물내용 */
				,DOC_ID				/* 첨부파일ID */ 
				,F_ORG_INFO(REL_ORG_CD,'1') AS REL_ORG_NM  /* 관련기관명 */
			FROM TBCSPTSM002L
			WHERE 1=1
			  AND BBS_ID='BBSMSTR_100000000032'
			  AND USE_AT = 'Y' 
			<isNotEmpty property="strNttId"><!-- 게시물ID -->
				AND NTT_ID  =  #strNttId#
			</isNotEmpty>
		
	</select>
	
	<update id="CSPHPM001QmainAnsUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPTSM002L 
			   SET QNA_ANSWER = #QNA_ANSWER#
			 WHERE NTT_ID = #strNTT_ID#
			 AND BBS_ID='BBSMSTR_100000000032'
			 AND USE_AT = 'Y' 
		]]>
	</update>
	
	
	<select id="CSPHPM001QmainselectDetail" parameterClass="paramMap" resultMap="csphpm001qMap">
        <![CDATA[
			SELECT
			'1' AS NUM, '0' AS TOT_CNT, 
				a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, NVL(b.USR_NAM, a.NTCR_NM) AS FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') AS FRST_REGIST_PNTTM, a.EMAIL, a.TEL, a.JUSO, 
				CASE WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NOT NULL THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.NTT_CN) || CHR(13)||CHR(10) ||TO_CLOB(a.SUB2)
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NULL     THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.NTT_CN)
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NOT NULL     THEN TO_CLOB(a.SUB1) || CHR(13)||CHR(10) || TO_CLOB(a.SUB2)
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NOT NULL     THEN TO_CLOB(a.NTT_CN) || CHR(13)||CHR(10) || TO_CLOB(a.SUB2)
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NULL         THEN TO_CLOB(a.SUB1)
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NULL         THEN TO_CLOB(a.NTT_CN)
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NOT NULL         THEN TO_CLOB(a.SUB2)
					 ELSE TO_CLOB('')
					 END NTT_CN,
				a.RDCNT,a.CATEGORY, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.DOC_ID ,
				a.BBS_ID, RTRIM(a.NTCE_BGNDE) NTCE_BGNDE, RTRIM(a.NTCE_ENDDE) NTCE_ENDDE,  a.NTCR_NM, '' AS HNDL_DVSN_NM, 
				a.REL_ORG_CD, F_ORG_INFO(a.REL_ORG_CD,'1') AS REL_ORG_NM , NVL(A.ORG_REGI_YN,'N') AS ORG_REGI_YN,
				a.INSTITUTION,
				CASE WHEN a.APV_STA_CD='' OR a.APV_STA_CD IS NULL THEN '1' ELSE a.APV_STA_CD END AS APV_STA_CD,a.APV_DOC_NO,a.HNDL_DVSN_CD,
				A.QNA_STATE,
				CASE WHEN a.QNA_STATE = 'receive' THEN '답변완료'
				     ELSE '답변대기'
				      END AS QNA_STATE_NM
				      , A.QNA_ANSWER
			FROM
				TBCSPTSM002L a
			LEFT OUTER JOIN 
				TBDCMACM001M b
			ON a.FRST_REGISTER_ID = b.USR_ID 
			WHERE BBS_ID='BBSMSTR_100000000032'
			AND a.USE_AT = 'Y' 
			AND A.NTT_ID = #strNTT_ID#
		]]>	
			
		
	</select>
	
	
	<update id="CSPHPM001QmainAnsSendUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPTSM002L 
			   SET QNA_ANSWER = #QNA_ANSWER#
			      ,QNA_STATE = 'receive'
			 WHERE NTT_ID = #strNTT_ID#
			 AND BBS_ID='BBSMSTR_100000000032'
			 AND USE_AT = 'Y' 
		]]>
	</update>
	
	<!-- 전산개선 및 자료요청 엑셀다운로드 -->
	<select id="CSPHPM001QExcelExportSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[
			SELECT
				ROW_NUMBER() OVER(
         		ORDER BY A.FRST_REGIST_PNTTM DESC) AS NUM,
				a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, NVL(b.USR_NAM, a.NTCR_NM) AS FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') AS FRST_REGIST_PNTTM, a.EMAIL, a.TEL, a.JUSO, 
				CASE WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NOT NULL THEN a.SUB1 || CHR(13)||CHR(10) || a.NTT_CN || CHR(13)||CHR(10) || a.SUB2
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NULL     THEN a.SUB1 || CHR(13)||CHR(10) || a.NTT_CN
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NOT NULL     THEN a.SUB1 || CHR(13)||CHR(10) || a.SUB2
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NOT NULL     THEN a.NTT_CN || CHR(13)||CHR(10) || a.SUB2
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NULL         THEN a.SUB1
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NULL         THEN a.NTT_CN
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NOT NULL         THEN a.SUB2
					 ELSE ''
					 END NTT_CN,
				a.RDCNT,a.CATEGORY, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.DOC_ID ,
				a.BBS_ID, RTRIM(a.NTCE_BGNDE) NTCE_BGNDE, RTRIM(a.NTCE_ENDDE) NTCE_ENDDE,  a.NTCR_NM, '' AS HNDL_DVSN_NM, 
				a.REL_ORG_CD, F_ORG_INFO(a.REL_ORG_CD,'1') AS REL_ORG_NM , CASE WHEN a.ORG_REGI_YN='Y' THEN '등록' ELSE '미등록' END AS ORG_REGI_YN,
				a.INSTITUTION,
				A.APV_STA_CD,
                               CASE WHEN a.APV_STA_CD='' OR a.APV_STA_CD IS NULL
                                    THEN '상신전'
                                    WHEN a.APV_STA_CD='1'
                                    THEN '상신전'
                                    WHEN a.APV_STA_CD='2'
                                    THEN '결재중'
                                    WHEN a.APV_STA_CD='3'
                                    THEN '결재완료'
                               END AS APV_STA_NM,
				a.APV_DOC_NO,
							   CASE WHEN a.HNDL_DVSN_CD = '01'
                                    THEN '활용'
                                    WHEN a.HNDL_DVSN_CD = '02'
                                    THEN '이송'
                                    WHEN a.HNDL_DVSN_CD = '03'
                                    THEN '종결'
                               END AS HNDL_DVSN_CD,
				A.QNA_STATE,
				CASE WHEN a.QNA_STATE = 'receive' THEN '답변완료'
				     ELSE '답변대기'
				      END AS QNA_STATE_NM
				      , '' QNA_ANSWER
			FROM
				TBCSPTSM002L a
			LEFT OUTER JOIN 
				TBDCMACM001M b
			ON a.FRST_REGISTER_ID = b.USR_ID 
			WHERE BBS_ID='BBSMSTR_100000000032'
			AND a.USE_AT = 'Y' 
		]]>	
		<isNotEmpty property="strSearchBox"><!-- 제목, 내용, 작성자 -->
			AND (a.NTT_SJ  LIKE '%' || #strSearchBox# || '%' OR  a.NTT_CN  LIKE '%' || #strSearchBox# || '%' OR a.NTCR_NM  LIKE '%' || #strSearchBox# || '%')	
		</isNotEmpty>
		
		<isNotEmpty property="strREL_ORG_CD"><!-- 관련기관-->
			AND a.REL_ORG_CD =  #strREL_ORG_CD# 	
		</isNotEmpty>
		
		<isNotEmpty property="strORG_REGI_YN"><!-- 기관정보 등록 여부 -->
			<isEqual property="strORG_REGI_YN" compareValue="A">
			AND (a.ORG_REGI_YN = 'N' OR  a.ORG_REGI_YN = 'Y' OR  a.ORG_REGI_YN IS NULL)
			</isEqual>	
			<isNotEqual property="strORG_REGI_YN" compareValue="A">
			AND a.ORG_REGI_YN =  #strORG_REGI_YN# 
			</isNotEqual>	
			
			<isEqual property="strDPT_TP_CD" compareValue="A">
				AND T2.ENFM_DPT_CD = #strDPT_CD#
			</isEqual>
		</isNotEmpty>
		
	 	<isNotEmpty property="strYr" > <!-- 연도별 -->
			AND SUBSTR(a.FRST_REGIST_PNTTM,1,4) = #strYr#	
		</isNotEmpty>
		
		<isNotEmpty property="strFRST_REGIST_PNTTMS"><!-- 시작 작성일 -->
			AND (TO_CHAR(a.FRST_REGIST_PNTTM,'YYYYMMDD') <![CDATA[ >= ]]> #strFRST_REGIST_PNTTMS# OR  a.FRST_REGIST_PNTTM IS NULL)
		</isNotEmpty>
	
		<isNotEmpty  property="strFRST_REGIST_PNTTME"><!-- 종료 작성일 -->
			AND (TO_CHAR(a.FRST_REGIST_PNTTM,'YYYYMMDD') <![CDATA[ <= ]]> #strFRST_REGIST_PNTTME# OR a.FRST_REGIST_PNTTM IS NULL)
		</isNotEmpty>
		<isNotEmpty  property="strApvStaCd"><!-- 상태 -->
			
			<isEqual property="strApvStaCd" compareValue="1">
			AND (a.APV_STA_CD <![CDATA[ = ]]> #strApvStaCd# OR a.APV_STA_CD IS NULL OR a.APV_STA_CD = '')
			</isEqual>
			<isNotEqual property="strApvStaCd" compareValue="1">
			AND a.APV_STA_CD <![CDATA[ = ]]> #strApvStaCd# 
			</isNotEqual>
			
		</isNotEmpty>
	</select>
	
	<!-- 목록출력 리스트 조회-->
	<select id="CSPHPM001QReportListselect" parameterClass="paramMap" resultClass="resultMap">
			SELECT
			'1' AS NUM, '0' AS TOT_CNT, 
				a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, NVL(b.USR_NAM, a.NTCR_NM) AS FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') AS FRST_REGIST_PNTTM, a.EMAIL, a.TEL, a.JUSO, 
				CASE WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NOT NULL THEN a.SUB1 || CHR(13)||CHR(10) || a.NTT_CN || CHR(13)||CHR(10) || a.SUB2
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NULL     THEN a.SUB1 || CHR(13)||CHR(10) || a.NTT_CN
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NOT NULL     THEN a.SUB1 || CHR(13)||CHR(10) || a.SUB2
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NOT NULL     THEN a.NTT_CN || CHR(13)||CHR(10) || a.SUB2
					 WHEN a.SUB1 IS NOT NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NULL         THEN a.SUB1
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NOT NULL AND a.SUB2 IS NULL         THEN a.NTT_CN
					 WHEN a.SUB1 IS NULL AND a.NTT_CN IS NULL AND a.SUB2 IS NOT NULL         THEN a.SUB2
					 ELSE ''
					 END NTT_CN,
				a.RDCNT,
				CASE WHEN A.CATEGORY = 'Y' THEN '해당'
                     WHEN NVL(A.CATEGORY,'N') = 'N' THEN '미해당'
                     END AS CATEGORY,
				a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.DOC_ID ,
				a.BBS_ID, RTRIM(a.NTCE_BGNDE) NTCE_BGNDE, RTRIM(a.NTCE_ENDDE) NTCE_ENDDE,  a.NTCR_NM, '' AS HNDL_DVSN_NM, 
				a.REL_ORG_CD, F_ORG_INFO(a.REL_ORG_CD,'1') AS REL_ORG_NM ,
				CASE WHEN NVL(A.ORG_REGI_YN,'N') = 'N' THEN '미등록'
                     WHEN A.ORG_REGI_YN = 'Y' THEN '등록'
                     END AS ORG_REGI_YN,
				a.INSTITUTION,
				CASE WHEN a.APV_STA_CD='' OR a.APV_STA_CD IS NULL THEN '1' ELSE a.APV_STA_CD END AS APV_STA_CD,a.APV_DOC_NO,
				CASE WHEN A.HNDL_DVSN_CD = '01' THEN '활용'
                     WHEN A.HNDL_DVSN_CD = '02' THEN '이송'
                     WHEN A.HNDL_DVSN_CD = '03' THEN '종결'
                     END AS HNDL_DVSN_CD,
				A.QNA_STATE,
				CASE WHEN a.QNA_STATE = 'receive' THEN '답변완료'
				     ELSE '답변대기'
				      END AS QNA_STATE_NM
				      , A.QNA_ANSWER
			FROM
				TBCSPTSM002L a
			LEFT OUTER JOIN 
				TBDCMACM001M b
			ON a.FRST_REGISTER_ID = b.USR_ID 
			WHERE BBS_ID='BBSMSTR_100000000032'
			AND a.USE_AT = 'Y'
			AND A.NTT_ID = #strNttId#
	</select>
	
</sqlMap>