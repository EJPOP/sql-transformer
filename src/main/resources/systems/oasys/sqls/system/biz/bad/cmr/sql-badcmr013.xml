<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/cmr/013">
	<resultMap class="java.util.HashMap" id="hwpDocMap">
	
	
	<result property="RPRT_SNO" column="RPRT_SNO" jdbcType="VARCHAR2"	javaType="java.lang.String" />
		<result property="OGWD_ENTX" column="OGWD_ENTX" jdbcType="CLOB"	javaType="java.lang.String" />
			
	
			
    </resultMap>

     <select id="badcmrComboYear" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[ 
        	SELECT TO_CHAR(2010+LEVEL) CD
			     , TO_CHAR(2010+LEVEL) CD_NM
			  FROM DUAL
			  CONNECT BY LEVEL < 20   
			  ]]>
          </select>
          
         
      <select id="badcmr013EGenRptselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[ 
        	SELECT YE
        	     , RPRT_SNO
        	     , CHR_DPT_CD
        	     , PLCY_RPRT_KND_CD
        	     , TIT_NM
     
        	     , OGWD_TXT
        	     , DOC_ID
        	     , DOC_TYP_CD
        	     , SAV_DH
        	     , PLCY_MDF_DH
        	     , REGN_ID
        	     , F_USR_INFO(REGN_ID,'2') AS REGN_NM
              FROM TBBADCMR009M
             WHERE 1=1
               AND YE = #strYear#  
               AND PLCY_RPRT_KND_CD =#strRprtKnd#

			  ]]>
          </select>
          
        <select id="badcmr013EHwpselect" parameterClass="paramMap"
		resultMap="hwpDocMap">
        <![CDATA[ 
        	SELECT 
        	  		RPRT_SNO,OGWD_ENTX
              FROM TBBADCMR009M
             WHERE 1=1
               AND YE = #strYear#  
               AND PLCY_RPRT_KND_CD =#strRprtKnd#   
               AND CHR_DPT_CD =#strChrDpt#
               AND RPRT_SNO = #strRprtSno#       
        	        
        	     
			  ]]>
          </select>
          
      <update id="badcmr013EGenRptdelete" parameterClass="paramMap">    
          
                  DELETE
		        FROM TBBADCMR009M
		        WHERE 1=1
		        AND YE=#YE#
		        AND RPRT_SNO =#RPRT_SNO#
		        AND CHR_DPT_CD = #CHR_DPT_CD#
		        AND PLCY_RPRT_KND_CD = #PLCY_RPRT_KND_CD#
	 </update>

		<insert id="badcmr013EGenRptinsert" parameterClass="paramMap">
		INSERT INTO
		TBBADCMR009M
		(
		YE                         /*연도*/
		, RPRT_SNO              /*보고서순번*/
		, CHR_DPT_CD              /*담당부서코드*/
		, PLCY_RPRT_KND_CD
		, TIT_NM
		, OGWD_ENTX
		, OGWD_TXT
		, DOC_ID
		, DOC_TYP_CD
		, SAV_DH
		, PLCY_MDF_DH
		, REGN_ID
		, REGN_DPT_CD
		                            
		, FNL_MNU_ID               
		, FRT_USR_ID               
		, FNL_USR_ID              
		, FNL_DEAL_DPT_CD          
		, FRT_REGI_DH               
		, FNL_MDF_DH                
		)                          
		VALUES                      
		(                           
			#YE#                         /*연도*/
		, #RPRT_SNO#               /*보고서순번*/
		, #CHR_DPT_CD#              /*담당부서코드*/
		, #PLCY_RPRT_KND_CD#
		, #TIT_NM#
		, #OGWD_ENTX#
		, #OGWD_TXT#
		, #DOC_ID#
		, #DOC_TYP_CD#
		, TO_CHAR(SYSDATE,'yyyymmddhh24miss')
		, TO_CHAR(SYSDATE,'yyyymmddhh24miss')
		, #REGN_ID#
		, #FNL_DEAL_DPT_CD#          
	

		
		, #FNL_MNU_ID#
		, #FRT_USR_ID#
		, #FNL_USR_ID#
		, #FNL_DEAL_DPT_CD#
		, SYSDATE
		, SYSDATE
		)
	</insert>
	
          
        <!--모니터링 총괄보고서 업데이트 -->
	<update id="badcmr013EGenRptupdate" parameterClass="paramMap">
		UPDATE TBBADCMR009M
		SET YE = #YE#
		, RPRT_SNO =#RPRT_SNO#
		, CHR_DPT_CD =#CHR_DPT_CD#
		, PLCY_RPRT_KND_CD = #PLCY_RPRT_KND_CD#
		
		<isNotNull prepend="," property="TIT_NM">
			TIT_NM = #TIT_NM#
		</isNotNull>
				<isNotNull prepend="," property="OGWD_ENTX">
			OGWD_ENTX = #OGWD_ENTX#
		</isNotNull>
		<isNotNull prepend="," property="OGWD_TXT">
			OGWD_TXT = #OGWD_TXT#
		</isNotNull>
		<isNotNull prepend="," property="DOC_ID">
			DOC_ID = #DOC_ID#
		</isNotNull>
        , PLCY_MDF_DH = TO_CHAR(SYSDATE,'yyyymmddhh24miss')
		
		, FNL_MDF_DH = SYSDATE
		, FNL_USR_ID = #FNL_USR_ID#
		, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		, FNL_MNU_ID = #FNL_MNU_ID#

		WHERE 1 = 1
		AND YE = #YE#
		AND RPRT_SNO =#RPRT_SNO#
		AND CHR_DPT_CD =#CHR_DPT_CD#
		AND PLCY_RPRT_KND_CD= #PLCY_RPRT_KND_CD#

	</update>
  <select id="badcmr013EGenRptMaxselect" parameterClass="paramMap"
	resultClass="java.lang.String">
        <![CDATA[    
			 SELECT LPAD(NVL(MAX(RPRT_SNO), 0) + 1, 3, 0) AS RPRT_SNO
			  FROM TBBADCMR009M
			 WHERE 1=1
			   AND YE = #YE#
			    AND CHR_DPT_CD = #CHR_DPT_CD#
			     AND PLCY_RPRT_KND_CD=#PLCY_RPRT_KND_CD#
			  ]]>
          </select>
     
	
</sqlMap> 
