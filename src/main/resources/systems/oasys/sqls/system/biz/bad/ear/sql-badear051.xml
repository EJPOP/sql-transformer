<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ear/051">

	<!-- 감사사항 조회-->
	<select id="BADEAR051EMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT	D1.RPST_ORG_CD		/*대표기관코드*/
					,D1.RPST_ORG_NM		/*대표기관명*/
					,D1.RGN_CD			/*지역*/
					,D1.ORG_DVSN_CD		/*기관구분*/
					,D1.NAT_ORG_CAT_CD	/*국가기관분류*/
					,D1.NAT_ORG_SRT_SEQ
					,D1.PUB_TYP_CD		/*공공기관유형*/
					,(	SELECT	COUNT(*) 
						FROM	TBBADEAR032M S1
						WHERE	S1.RPST_ORG_CD = D1.RPST_ORG_CD
					) AS CNT			/*매핑기관수*/
			FROM	TBBADEAR033M D1
			WHERE	1=1
		]]>	
		
		<isNotEmpty property="strRPST_ORG_CD">		             
			AND	D1.RPST_ORG_CD     = #strRPST_ORG_CD#
        </isNotEmpty>

		<isNotEmpty property="strRPST_ORG_NM">	
			AND	D1.RPST_ORG_NM LIKE '%'||#strRPST_ORG_NM#||'%'
		</isNotEmpty>
		
		<isNotEmpty property="strORG_DVSN_CD">		             
			AND	D1.ORG_DVSN_CD     = #strORG_DVSN_CD#
        </isNotEmpty>
        
        <![CDATA[
        	ORDER BY D1.RPST_ORG_CD DESC
		]]>
	</select>
	
	
	<select id="BADEAR051ESubSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	D1.RPST_ORG_CD		/*대표기관코드*/
					, D1.RPST_ORG_NM	/*대표기관명*/
					, D2.ORG_CD			/*기관코드*/
					, D3.ORG_NM			/*기관명*/
					, D3.ORG_DVSN_CD	/*기관구분*/
			FROM	TBBADEAR033M D1
					,TBBADEAR032M D2
					,TBDCMACM015M D3
			WHERE	D1.RPST_ORG_CD = #strRPST_ORG_CD#
			AND		D1.RPST_ORG_CD = D2.RPST_ORG_CD
			AND		D2.ORG_CD = D3.ORG_CD
		]]>
	</select>
	
	<select id="BADEAR051EKeySelect" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT 	LPAD(NVL(MAX(TO_NUMBER(RPST_ORG_CD)),0)+1,10,0) AS RPST_ORG_CD
			FROM 	TBBADEAR033M
		]]>
	</select>
	
	<update id="BADEAR051EMainInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	TBBADEAR033M
					(	RPST_ORG_CD
						,RPST_ORG_NM
						,RGN_CD
						,ORG_DVSN_CD
						,RPST_ORG_USE_YN
						,NAT_ORG_CAT_CD
						,NAT_ORG_SRT_SEQ
						,PUB_TYP_CD
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
					)
			VALUES	(	(SELECT LPAD(NVL(MAX(TO_NUMBER(RPST_ORG_CD)),0)+1,10,0) FROM TBBADEAR033M)
						,#RPST_ORG_NM#
						,#RGN_CD#
						,#ORG_DVSN_CD#
						,'Y'
						,#NAT_ORG_CAT_CD#
						,#NAT_ORG_SRT_SEQ#
						,#PUB_TYP_CD#
						,#FRT_USR_ID#
						,#FNL_USR_ID#
						,#FNL_DEAL_DPT_CD#
						,#FNL_MNU_ID#
						,SYSDATE
						,SYSDATE
					)
		]]>
	</update>
	
	<insert id="BADEAR051SENDDELInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	EH_INF_GR_DA_002
					(	IF_SEQ
						,IF_TYPE
						,RPST_ORG_CD
						,RPST_ORG_NM
						,RGN_CD
						,ORG_DVSN_CD
						,NAT_ORG_CAT_CD
						,NAT_ORG_SRT_SEQ
						,PUB_COPT_GD_CD
						,PUB_TYP_CD
						,RPST_ORG_USE_YN
						,FRT_USR_ID
					)
			VALUES	(	#IF_SEQ#
						,'SND'
						,#RPST_ORG_CD#
						,#RPST_ORG_NM#
						,#RGN_CD#
						,#ORG_DVSN_CD#
						,#NAT_ORG_CAT_CD#
						,#NAT_ORG_SRT_SEQ#
						,#PUB_COPT_GD_CD#
						,#PUB_TYP_CD#
						,'Y'
						,#FRT_USR_ID#
					)
		]]>
	</insert>
	
	<update id="BADEAR051EMainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBBADEAR033M
			SET		RPST_ORG_NM = #RPST_ORG_NM#
					,RGN_CD = #RGN_CD#
					,ORG_DVSN_CD = #ORG_DVSN_CD#
					,NAT_ORG_CAT_CD = #NAT_ORG_CAT_CD#
					,NAT_ORG_SRT_SEQ = #NAT_ORG_SRT_SEQ#
					,PUB_TYP_CD = #PUB_TYP_CD#
					,FNL_USR_ID = #FNL_USR_ID#
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID = #FNL_MNU_ID#
					,FNL_MDF_DH = SYSDATE
			WHERE	RPST_ORG_CD = #RPST_ORG_CD#
		]]>
	</update>
	
	<insert id="BADEAR051ESubInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO	TBBADEAR032M
					(	RPST_ORG_CD
						,ORG_CD
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
					)
			VALUES	(	#RPST_ORG_CD#
						,#ORG_CD#
						,#FRT_USR_ID#
						,#FNL_USR_ID#
						,#FNL_DEAL_DPT_CD#
						,#FNL_MNU_ID#
						,SYSDATE
						,SYSDATE
					)
		]]>
	</insert>
	
	<!-- 매핑기관삭제 -->
	<delete id="BADEAR051ESubDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE	
			FROM	TBBADEAR032M
			WHERE	RPST_ORG_CD = #RPST_ORG_CD#
			AND		ORG_CD = #ORG_CD#
		]]>
	</delete>
</sqlMap> 
