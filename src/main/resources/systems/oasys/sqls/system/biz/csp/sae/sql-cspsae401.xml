<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/sae/401">

	<select id="CSPSAE401ECbbEduDvsn" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.EDU_DVSN_CD
			     , A.EDU_DVSN_NM
			 FROM TBCSPSAE101C A
        ]]>
         <![CDATA[
         	ORDER BY A.EDU_DVSN_CD ASC
         ]]>
	</select>
	
	<select id="CSPSAE401ECbbEduCat" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.EDU_CAT_CD
			      ,A.EDU_CAT_NM
			 FROM TBCSPSAE102C A
			WHERE A.EDU_DVSN_CD = #strEDU_DVSN_CD# 
        ]]>
         <![CDATA[
         	ORDER BY A.EDU_DVSN_CD ASC
         ]]>
	</select>

	<select id="CSPSAE401EEduDvsnList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.EDU_DVSN_CD
			     , A.EDU_DVSN_NM
			     , A.USE_YN
			 FROM TBCSPSAE101C A
			WHERE 1=1
        ]]>
        <dynamic>
        	<isNotEmpty property="strEDU_DVSN_CD">
        		AND	A.EDU_DVSN_CD = #strEDU_DVSN_CD#
        	</isNotEmpty>
        </dynamic>
         <![CDATA[
         	ORDER BY A.EDU_DVSN_CD ASC
         ]]>
	</select>
	
	<select id="CSPSAE401EselectEduCatList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.EDU_DVSN_CD
			      ,A.EDU_CAT_CD
			      ,EDU_CAT_NM
			      ,USE_YN
			 FROM TBCSPSAE102C A
			WHERE 1=1
			AND	A.EDU_DVSN_CD = #strGrxEDU_DVSN_CD#
        ]]>
        <dynamic>
        	<isNotEmpty property="strEDU_CAT_CD">
        		AND	A.EDU_CAT_CD = #strEDU_CAT_CD#
        	</isNotEmpty>
        </dynamic>
         <![CDATA[
         	ORDER BY A.EDU_DVSN_CD ASC, A.EDU_CAT_CD ASC
         ]]>
	</select>
	
	<!-- 교육과정 목록 조회 -->
	<select id="CSPSAE401EEduCrsList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.EDU_DVSN_CD
			     , A.EDU_DVSN_NM
			     , A.EDU_CAT_CD
			     , A.EDU_CAT_NM
			     , A.CRS_CD
			     , A.CRS_NM
			     , A.USE_YN
			     , A.NEED_YN
			  FROM (
					SELECT A.EDU_DVSN_CD
					     , A.EDU_DVSN_NM
					     , B.EDU_CAT_CD
					     , B.EDU_CAT_NM
					     , C.CRS_CD
					     , C.CRS_NM
					     , C.USE_YN
					     , C.NEED_YN
					 FROM TBCSPSAE101C A
				        , TBCSPSAE102C B
				        , TBCSPSAE103C C
					WHERE 1=1
				      AND B.EDU_DVSN_CD = A.EDU_DVSN_CD
				      AND C.EDU_DVSN_CD = A.EDU_DVSN_CD
				      AND C.EDU_CAT_CD = B.EDU_CAT_CD
                UNION
		           SELECT A.EDU_DVSN_CD
				        , A.EDU_DVSN_NM
				        , B.EDU_CAT_CD
				        , B.EDU_CAT_NM
					    , '' AS CRS_CD
					    , '' AS CRS_NM
					    , 'N' AS USE_YN
					    , 'N' AS NEED_YN
					 FROM TBCSPSAE101C A
				        , TBCSPSAE102C B
					WHERE 1=1
				      AND B.EDU_DVSN_CD = A.EDU_DVSN_CD
				      AND B.EDU_CAT_CD NOT IN (SELECT C.EDU_CAT_CD FROM TBCSPSAE103C C WHERE C.EDU_DVSN_CD = A.EDU_DVSN_CD AND C.EDU_CAT_CD = B.EDU_CAT_CD)) A
		     WHERE 1=1
        	]]>
        <dynamic>
        	<isNotEmpty property="strEDU_DVSN_CD">
			  	AND A.EDU_DVSN_CD = #strEDU_DVSN_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strEDU_CAT_CD">
			  	AND A.EDU_CAT_CD = #strEDU_CAT_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strCRS_CD">
			  	AND A.CRS_NM LIKE '%' || #strCRS_CD# || '%'
        	</isNotEmpty>
        </dynamic>
         <![CDATA[
		  	ORDER BY A.EDU_DVSN_CD, A.EDU_CAT_CD, A.CRS_CD
         ]]>
	</select>

	<select id="CSPSAE401EExistEduDvsnCnt" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(TO_CHAR(SUM(CNT)), '0', '0', (SELECT EDU_DVSN_NM FROM TBCSPSAE101C WHERE EDU_DVSN_CD = #EDU_DVSN_CD#)) AS EXIST_NM
			  FROM (
			  		SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE102C A
					 WHERE A.EDU_DVSN_CD = #EDU_DVSN_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE103C A
					 WHERE A.EDU_DVSN_CD = #EDU_DVSN_CD#
					)
        ]]>
	</select>

	<delete id="CSPSAE401EEduDvsnDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE101C A
			 WHERE 1=1
			   AND A.EDU_DVSN_CD = #EDU_DVSN_CD#
		]]>  
	</delete>
	
	
	<select id="CSPSAE401EExistEduCatCnt" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(TO_CHAR(SUM(CNT)), '0', '0', (SELECT EDU_CAT_NM FROM TBCSPSAE102C WHERE EDU_DVSN_CD = #EDU_DVSN_CD# AND EDU_CAT_CD =  #EDU_CAT_CD#)) AS EXIST_NM
			  FROM (
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE103C A
					 WHERE A.EDU_DVSN_CD = #EDU_DVSN_CD#
					   AND A.EDU_CAT_CD =  #EDU_CAT_CD#
					)
        ]]>
	</select>
	
	<delete id="CSPSAE401EEduCatDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE102C A
			 WHERE A.EDU_DVSN_CD = #EDU_DVSN_CD#
			   AND A.EDU_CAT_CD = #EDU_CAT_CD#
		]]>  
	</delete>

	<select id="CSPSAE401EExistCrsCdCnt" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(TO_CHAR(SUM(CNT)), '0', '0', (SELECT CRS_NM FROM TBCSPSAE103C WHERE CRS_CD = #CRS_CD#)) AS EXIST_NM
			  FROM (
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE101D
					 WHERE CRS_CD = #CRS_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE201M
					 WHERE CRS_CD = #CRS_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE201D
					 WHERE CRS_CD = #CRS_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE202D
					 WHERE CRS_CD = #CRS_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE203D
					 WHERE CRS_CD = #CRS_CD#
					UNION  
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE301D
					 WHERE CRS_CD = #CRS_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE302D
					 WHERE CRS_CD = #CRS_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE303D
					 WHERE CRS_CD = #CRS_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE304D
					 WHERE CRS_CD = #CRS_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE305D
					 WHERE CRS_CD = #CRS_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE401D
					 WHERE CRS_CD = #CRS_CD#
					 )
        ]]>
	</select>

	<delete id="CSPSAE401EEduCrsDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE103C A
			 WHERE A.EDU_DVSN_CD = #EDU_DVSN_CD#
			   AND A.EDU_CAT_CD = #EDU_CAT_CD#
			   AND A.CRS_CD = #CRS_CD#
		]]>  
	</delete>
	
	
	<select id="CSPSAE401ESelectDvsnCd" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT LPAD(TO_CHAR(NVL(MAX(EDU_DVSN_CD), 0)+1), 3, '0')
			  FROM TBCSPSAE101C
        ]]>
	</select>
	
	<select id="CSPSAE401ESelectCatCd" parameterClass="String" resultClass="String">
        <![CDATA[
			SELECT LPAD(TO_CHAR(NVL(MAX(EDU_CAT_CD), 0)+1), 3, '0')
			  FROM TBCSPSAE102C
			 WHERE EDU_DVSN_CD = #EDU_DVSN_CD#
        ]]>
	</select>
	
	<select id="CSPSAE401ESelectCrsCd" parameterClass="String" resultClass="String">
        <![CDATA[
			SELECT LPAD(TO_CHAR(NVL(MAX(CRS_CD), 0)+1), 3, '0')
			  FROM TBCSPSAE103C
        ]]>
	</select>
	
	
	<insert id="CSPSAE401EEduDvnsInsert" parameterClass="paramMap">
        <![CDATA[
        	INSERT INTO TBCSPSAE101C
			(
			      EDU_DVSN_CD
			    , EDU_DVSN_NM
			    , USE_YN
			    , FRT_USR_ID
			    , FNL_USR_ID
			    , FNL_DEAL_DPT_CD
			    , FNL_MNU_ID
			    , FRT_REGI_DH
			    , FNL_MDF_DH
			) VALUES (
			      #EDU_DVSN_CD#
			    , #EDU_DVSN_NM#
			    , #USE_YN#
			    , #FRT_USR_ID#
			    , #FNL_USR_ID#
			    , #FNL_DEAL_DPT_CD#
			    , #FNL_MNU_ID#
			    , SYSDATE
			    , SYSDATE
			);
        ]]>
	</insert>

	<insert id="CSPSAE401EEduCatInsert" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPSAE102C
			(
			      EDU_DVSN_CD
			    , EDU_CAT_CD
			    , EDU_CAT_NM
			    , USE_YN
			    , FRT_USR_ID
			    , FNL_USR_ID
			    , FNL_DEAL_DPT_CD
			    , FNL_MNU_ID
			    , FRT_REGI_DH
			    , FNL_MDF_DH
			) VALUES (
			      #EDU_DVSN_CD#
			    , (SELECT LPAD(TO_CHAR(NVL(MAX(EDU_CAT_CD), 0)+1), 3, '0') FROM TBCSPSAE102C WHERE EDU_DVSN_CD = #EDU_DVSN_CD#)
			    , #EDU_CAT_NM#
			    , #USE_YN#
			    , #FRT_USR_ID#
			    , #FNL_USR_ID#
			    , #FNL_DEAL_DPT_CD#
			    , #FNL_MNU_ID#
			    , SYSDATE
			    , SYSDATE
			);
        ]]>
	</insert>
	
	<!-- 교육과정 저장 -->
	<insert id="CSPSAE401EEduCrsInsert" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPSAE103C
			(
			      EDU_DVSN_CD
			    , EDU_CAT_CD
			    , CRS_CD
			    , CRS_NM
			    , USE_YN
			    , FRT_USR_ID
			    , FNL_USR_ID
			    , FNL_DEAL_DPT_CD
			    , FNL_MNU_ID
			    , FRT_REGI_DH
			    , FNL_MDF_DH
			    , NEED_YN
			) VALUES (
			      #EDU_DVSN_CD#
			    , #EDU_CAT_CD#
			    , #CRS_CD#
			    , #CRS_NM#
			    , #USE_YN#
			    , #FRT_USR_ID#
			    , #FNL_USR_ID#
			    , #FNL_DEAL_DPT_CD#
			    , #FNL_MNU_ID#
			    , SYSDATE
			    , SYSDATE
			    , #NEED_YN#
			);
        ]]>
	</insert>
	
	<update id="CSPSAE401EEduDvnsUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE101C
			SET		EDU_DVSN_NM = #EDU_DVSN_NM#,
					USE_YN = #USE_YN#,
					FNL_USR_ID = #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID = #FNL_MNU_ID#,
					FNL_MDF_DH = SYSDATE
			WHERE	EDU_DVSN_CD = #EDU_DVSN_CD#
		]]>
	</update>
	
	<update id="CSPSAE401EEduCatUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE102C
			SET		EDU_CAT_NM = #EDU_CAT_NM#,
					USE_YN = #USE_YN#,
					FNL_USR_ID = #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID = #FNL_MNU_ID#,
					FNL_MDF_DH = SYSDATE
			WHERE	EDU_DVSN_CD = #EDU_DVSN_CD#
			  AND   EDU_CAT_CD = #EDU_CAT_CD#
		]]>
	</update>
	
	<!-- 교육과정 수정 -->
	<update id="CSPSAE401EEduCrsUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE103C
			   SET	CRS_NM 			= #CRS_NM#,
					USE_YN 			= #USE_YN#,
					NEED_YN 		= #NEED_YN#,
					FNL_USR_ID 		= #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID 		= #FNL_MNU_ID#,
					FNL_MDF_DH 		= SYSDATE
			WHERE	1=1
			  AND   EDU_DVSN_CD 	= #EDU_DVSN_CD#
			  AND   EDU_CAT_CD 		= #EDU_CAT_CD#
			  AND   CRS_CD 			= #CRS_CD#
		]]>
	</update>
	
	<select id="CSPSAE402ESelectSubjList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.SUBJ_CD
			     , A.SUBJ_NM
			     , B.PFSR_ID
			     , B.NAM
			     , B.PFSR_DVSN_CD
			     , B.PFSR_RK_CD
			     , A.BSC_OP_SUBJ_YN
			     , A.USE_YN
			  FROM TBCSPSAE101M A
			     ,(SELECT SUBJ_CD
				     , SUBSTR(MAX(SYS_CONNECT_BY_PATH(PFSR_ID, '/')), 2) PFSR_ID
				     , SUBSTR(MAX(SYS_CONNECT_BY_PATH(NAM, '/')), 2) NAM
				     , MAX(PFSR_DVSN_CD) AS PFSR_DVSN_CD
				     , MAX(PFSR_RK_CD) AS PFSR_RK_CD
				     , MAX(USE_YN) AS USE_YN
				  FROM (SELECT ROW_NUMBER() OVER(PARTITION BY A.SUBJ_CD ORDER BY A.PFSR_ID) RNUM
						     , A.PFSR_ID
				             , A.SUBJ_CD
				             , B.NAM
				             , B.PFSR_DVSN_CD
			                 , B.PFSR_RK_CD
				             , A.USE_YN
				          FROM TBCSPSAE101L A
				             , TBCSPSAE109M B
				         WHERE 1=1
				           AND B.PFSR_ID = A.PFSR_ID
				           AND A.PFSR_ID IN (SELECT A.PFSR_ID
				                             FROM TBCSPSAE101L))
				         START WITH RNUM = 1
				         CONNECT BY PRIOR RNUM = RNUM-1
				         AND PRIOR SUBJ_CD = SUBJ_CD
				         GROUP BY SUBJ_CD) B
			 WHERE 1=1
			   AND B.SUBJ_CD(+) = A.SUBJ_CD
        ]]>
        <dynamic>
        	<isNotEmpty property="strSUBJ_NM">
        		AND UPPER(A.SUBJ_NM) LIKE '%' || UPPER(#strSUBJ_NM#) || '%'
        	</isNotEmpty>
        	<isNotEmpty property="strNAM">
        		AND B.NAM LIKE '%' || #strNAM# || '%'
        	</isNotEmpty>
        	<isNotEmpty property="strBSC_OP_SUBJ_YN">
   				AND A.BSC_OP_SUBJ_YN = #strBSC_OP_SUBJ_YN#
        	</isNotEmpty>
        </dynamic>
        
         <![CDATA[
 			ORDER BY A.SUBJ_NM
         ]]>
	</select>

	<select id="CSPSAE402EExistSubjCdCnt" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(TO_CHAR(SUM(CNT)), '0', '0', (SELECT SUBJ_NM FROM TBCSPSAE101M WHERE SUBJ_CD = #SUBJ_CD#)) AS EXIST_NM
			  FROM (
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE101D
					 WHERE SUBJ_CD = #SUBJ_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE202D
					 WHERE SUBJ_CD = #SUBJ_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE305D
					 WHERE SUBJ_CD = #SUBJ_CD#
					UNION
					SELECT COUNT(*) AS CNT
					  FROM TBCSPSAE304D
					 WHERE SUBJ_CD = #SUBJ_CD#
					 )
        ]]>
	</select>

	<delete id="CSPSAE402EDeleteMast" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE101M A
 			 WHERE 1=1
               AND A.SUBJ_CD  = #SUBJ_CD#
		]]>  
	</delete>
	
	
	<delete id="CSPSAE402EDeleteSubj" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE101L
			 WHERE SUBJ_CD = #SUBJ_CD#
		]]>  
	</delete>

	<select id="CSPSAE402ESelectFnlSubj" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT CASE
	            WHEN MAX(SUBJ_CD) = '999999' THEN 'A00001'
	            WHEN SUBSTRING(MAX(LPAD(SUBJ_CD, 6, 0)), 2, 5) < '99999' THEN SUBSTRING(MAX(LPAD(SUBJ_CD, 6, 0)), 1, 1) ||  LPAD(LTRIM(TO_CHAR(CAST(SUBSTRING(MAX(LPAD(SUBJ_CD, 6, 0)), 2, 6) AS INT) + 1)), 5, 0)
	            WHEN SUBSTRING(MAX(LPAD(SUBJ_CD, 6, 0)), 2, 5) = '99999' THEN CHR(ASCII(SUBSTRING(MAX(LPAD(SUBJ_CD, 6, 0)), 1, 1)) + 1) || '00001'
		    END
		    FROM TBCSPSAE101M
        ]]>
	</select>

	<insert id="CSPSAE402EInsertMast" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPSAE101M
			     (
			        SUBJ_CD
			      , SUBJ_NM
			      , BSC_OP_SUBJ_YN
			      , USE_YN
			      , FRT_USR_ID
			      , FNL_USR_ID
			      , FNL_DEAL_DPT_CD
			      , FNL_MNU_ID
			      , FRT_REGI_DH
			      , FNL_MDF_DH
			     ) VALUES (
			         #SUBJ_CD#
				   , #SUBJ_NM#
				   , NVL(#BSC_OP_SUBJ_YN#, 'N')
				   , #USE_YN#
			       , #FRT_USR_ID#
			       , #FNL_USR_ID#
			       , #FNL_DEAL_DPT_CD#
			       , #FNL_MNU_ID#
			       , SYSDATE
			       , SYSDATE
			   );
        ]]>
	</insert>
	
	<insert id="CSPSAE402EInsertSub" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPSAE101L 
			(
				SUBJ_CD
			  , PFSR_ID
			  , USE_YN
			  , FRT_USR_ID
			  , FNL_USR_ID
			  , FNL_DEAL_DPT_CD
			  , FNL_MNU_ID
			  , FRT_REGI_DH
			  , FNL_MDF_DH
			)
			VALUES(
			    #SUBJ_CD#
			  , #PFSR_ID#
			  , #USE_YN#
			  , #FNL_USR_ID#
			  , #FNL_USR_ID#
			  , #FNL_DEAL_DPT_CD#
			  , #FNL_MNU_ID#
			  , SYSDATE
			  , SYSDATE
			  );
        ]]>
	</insert>
	
	<update id="CSPSAE402EUpdateMast" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE101M
			SET		SUBJ_NM = #SUBJ_NM#,
					BSC_OP_SUBJ_YN = #BSC_OP_SUBJ_YN#,
					USE_YN = #USE_YN#,
					FNL_USR_ID = #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID = #FNL_MNU_ID#,
					FNL_MDF_DH = SYSDATE
			WHERE	SUBJ_CD = #SUBJ_CD#
		]]>
	</update>
	
	<select id="CSPSAE403PSelectPfsrList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			 SELECT DISTINCT( A.PFSR_ID)
			      , A.NAM
			      , (SELECT B.CD_NM FROM TBDCMACM013C B WHERE B.CMM_CD_DVSN_CD = '1000312' AND B.CD = A.PFSR_DVSN_CD) AS PFSR_DVSN_NM
			      , (SELECT B.CD_NM FROM TBDCMACM013C B WHERE B.CMM_CD_DVSN_CD = '1000141' AND B.CD = A.PFSR_RK_CD) AS PFSR_RK_NM
			      , (SELECT B.CD_NM FROM TBDCMACM013C B WHERE B.CMM_CD_DVSN_CD = '1000136' AND B.CD = A.PFSR_SPH_CD) AS PFSR_SPH_NM
			      , A.PFSR_RANK_NM
			      , A.PFSR_BLT_NM
			      , (SELECT MAX(B.LCT_DT) FROM TBCSPSAE202D B WHERE B.PFSR_ID = A.PFSR_ID) AS LCT_DT
			      , (SELECT B.CD_NM FROM TBDCMACM013C B WHERE B.CMM_CD_DVSN_CD = '1000313' AND B.CD = A.VLD_DVSN_CD) AS VLD_DVSN_NM
			   FROM TBCSPSAE109M A
			  WHERE 1=1
        ]]>
        <dynamic>
        	<isNotEmpty property="strNAM">
			    AND REGEXP_LIKE (A.NAM, #strNAM#)	
        	</isNotEmpty>
        	<isNotEmpty property="strPFSR_DVSN_CD">
        		AND	A.PFSR_DVSN_CD = #strPFSR_DVSN_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strPFSR_RK_CD">
        		AND	A.PFSR_RK_CD = #strPFSR_RK_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strVLD_DVSN_CD">
        		AND	A.VLD_DVSN_CD = #strVLD_DVSN_CD#
        	</isNotEmpty>
        	<isNotEmpty property="strRange">
    			AND FLOOR(MOD(MONTHS_BETWEEN(TO_CHAR(SYSDATE, 'yyyyMMdd'), (SELECT MAX(B.LCT_DT) FROM TBCSPSAE202D B WHERE B.PFSR_ID = A.PFSR_ID)),0)*30.5) &lt;= #strRange#
        	</isNotEmpty>
        </dynamic>
         <![CDATA[
			ORDER BY A.NAM
         ]]>
	</select>
	
	<select id="CSPSAE403PFindPfsrList" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			 SELECT COUNT( A.PFSR_ID) AS CNT
			   FROM TBCSPSAE109M A
			  WHERE 1=1
			  AND REGEXP_LIKE (A.NAM, #strPNAM#)
        ]]>
	</select>
	
	<select id="CSPSAE404ESelectMainList" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[
			SELECT A.SRT_SNO
			     , A.HUC_TXT
			     , A.HUC_STR_HM
			     , A.HUC_END_HM
			FROM TBCSPSAE111B A
        ]]>
         <![CDATA[
			ORDER BY A.SRT_SNO
         ]]>
	</select>
	
	<select id="CSPSAE404ESelectSrtSno" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT NVL(MAX(SRT_SNO), 0)+1 FROM TBCSPSAE111B
        ]]>
	</select>

	<insert id="CSPSAE404EInsertMain" parameterClass="paramMap">
        <![CDATA[
			INSERT INTO TBCSPSAE111B
			(
			       SRT_SNO
			     , HUC_TXT
			     , HUC_STR_HM
			     , HUC_END_HM
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH
			) VALUES (
			       #SRT_SNO#
			     , #HUC_TXT#
			     , #HUC_STR_HM#
			     , #HUC_END_HM#
			     , #FRT_USR_ID#
			     , #FNL_USR_ID#
			     , #FNL_DEAL_DPT_CD#
			     , #FNL_MNU_ID#
			     , SYSDATE
			     , SYSDATE
			)
        ]]>
	</insert>
	
	<select id="CSPSAE404EExistHuc" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(TO_CHAR(COUNT(*)), '0', '0', #SRT_SNO#) AS EXIST_NM
			  FROM TBCSPSAE202D
			 WHERE HUC_TXT = #SRT_SNO#
         ]]>
	</select>

	<delete id="CSPSAE404EDeleteMain" parameterClass="paramMap">
		<![CDATA[
			DELETE FROM TBCSPSAE111B A
 			 WHERE 1=1
               AND A.SRT_SNO  = #SRT_SNO#
		]]>  
	</delete>
	
	<update id="CSPSAE404EUpdateMain" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPSAE111B
			SET		SRT_SNO = #SRT_SNO#,		
			        HUC_TXT = #HUC_TXT#,
					HUC_STR_HM = #HUC_STR_HM#,
					HUC_END_HM = #HUC_END_HM#,
					FNL_USR_ID = #FNL_USR_ID#,
					FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID = #FNL_MNU_ID#,
					FNL_MDF_DH = SYSDATE
			WHERE	SRT_SNO = #SRT_SNO#
		]]>
	</update>
	
	<select id="CSPSAE401EselectCatCount" parameterClass="paramMap" resultClass="String">
        <![CDATA[
			SELECT DECODE(COUNT(A.EDU_DVSN_CD), 0, 'N', 'Y')
			 FROM TBCSPSAE102C A
			WHERE 1=1
			AND	A.EDU_DVSN_CD = #EDU_DVSN_CD#
         ]]>
	</select>
</sqlMap> 
