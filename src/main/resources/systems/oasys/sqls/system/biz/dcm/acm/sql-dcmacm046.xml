<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="dcm/acm/046">

	<select id="dcmacm046UsrMgSelect" parameterClass="paramMap"
		resultClass="resultMap">
	<![CDATA[
	/*2025.06.19. 결재자지정 직원정보를 조직도 정렬방식으로 표시되도록 수정*/
	 SELECT USR_DVSN_CD  
            , USR_DVSN_NM          
            , ORG_CD
            , ORG_NM
            , CNB
            , DPT_CD
            , DPT_NM
            , USR_ID 
            , USR_NAM
            , RQS_STA_CD       
            , RLS_DT     
            , TNB
            , RANK_CD
            , RANK_NM
            , PST_CD
            , PST_NM          
            , EIN            
            , EML_AD
            , BAI_USR_YN
            , APM_DVSN_CD          
            , HOM_TNB            
            , RQS_TXT
            , LOGIN_WAY_CD
            , DOC_ID
            , DOC_TYP_CD
            , INN_RANK_CD
            , RAL_BLT_DIV_CD
            , RAL_BLT_DIV_NM
            , FAN
            , CAR_NO
            , SUB_DPT_CD
            , SUB_DPT_NM
            , SUB_INN_RANK_CD
            , WRK_STR_DT
            , WRK_END_DT
            , ONR_PST_NM
            , SGN_DOC_ID
            , STMP_DOC_ID
            , SGN_FILE_NAME
            , STMP_FILE_NAME
            , BZT_TREXP_RCIT_BNK_CD
            , BZT_TREXP_RCIT_BNK_NM
            , BZT_TREXP_RCIT_EAN
            , PBSVT_NO
         FROM (
               SELECT USR_DVSN_CD  
                    , F_CODE_NM('1000338',USR_DVSN_CD) AS USR_DVSN_NM          
                    , ORG_CD
                    , F_ORG_INFO(ORG_CD,'1') AS ORG_NM
                    , CNB
                    , DPT_CD
                    , F_DPT_INFO(DPT_CD,'1') AS DPT_NM
                    , USR_ID 
                    , USR_NAM
                    , RQS_STA_CD       
                    , RLS_DT     
                    , TNB
                    , RANK_CD
                    , F_CODE_NM('1000173',RANK_CD) AS RANK_NM
                    , PST_CD
                    , F_CODE_NM('1000176',PST_CD)  AS PST_NM          
                    , EIN            
                    , EML_AD
                    
                    , BAI_USR_YN
                    /*, ZCD 2016.06.30 최승규 수석님 요청*/
                    , APM_DVSN_CD          
                    , HOM_TNB            
                    , RQS_TXT
                    , LOGIN_WAY_CD
                    , DOC_ID
                    , DOC_TYP_CD
                    
                    , INN_RANK_CD
                     
                    /*2015.01.27 박재운 감사관 요청-실소속부서 수정가능하도록.*/
                    , RAL_BLT_DIV_CD                                            /*실소속코드*/
                    , F_CODE_NM('1000144', RAL_BLT_DIV_CD) AS RAL_BLT_DIV_NM    /*실소속명*/
                    
                    , FAN
                    , CAR_NO
                    , T1.SUB_DPT_CD
                    , F_DPT_INFO(T1.SUB_DPT_CD,'1') AS SUB_DPT_NM
                    , SUB_INN_RANK_CD
                    , T1.WRK_STR_DT
                    , T1.WRK_END_DT
                    , T1.ONR_PST_NM
                    , T1.SGN_DOC_ID
                    , T1.STMP_DOC_ID
                    ,(SELECT FILE_NAME FROM ECM_FILE_LIST_VIEW2 S1 WHERE T1.SGN_DOC_ID = S1.DOC_ID ) AS SGN_FILE_NAME
                    ,(SELECT FILE_NAME FROM ECM_FILE_LIST_VIEW2 S1 WHERE T1.STMP_DOC_ID = S1.DOC_ID ) AS STMP_FILE_NAME
                    
                     /* 출장여비계좌관리 정보 추가 - 2017.04.06 yyh */
                    , T1.BZT_TREXP_RCIT_BNK_CD                       AS BZT_TREXP_RCIT_BNK_CD /* 출장여비수령은행코드 */
                    , F_CODE_NM('1000166', T1.BZT_TREXP_RCIT_BNK_CD) AS BZT_TREXP_RCIT_BNK_NM /* 출장여비수령은행명 */
                    , T1.BZT_TREXP_RCIT_EAN                          AS BZT_TREXP_RCIT_EAN    /* 출장여비수령암호화계좌번호 */
                    , PBSVT_NO           
                    
                    , (SELECT USR_DFN_TXT_1
                         FROM TBDCMACM013C
                        WHERE CMM_CD_DVSN_CD = '1000338'
                          AND CD = T1.USR_DVSN_CD) AS OCP_CD
                    , RANK_CD_2
                    , RANK_SRT_SEQ_NM 
                    , CRNT_RANK_APM_DT
                    , SRT_KY_NO
                    , CRNT_DPT_APM_DT
                 FROM TBDCMACM001M T1
                WHERE 1=1

       ]]>

		       <isNotEmpty property="strUsrNam">
		       	  AND USR_NAM LIKE '%'||#strUsrNam#||'%'
		       </isNotEmpty>
		       <isNotEmpty property="strUsrId">
		       	  AND USR_ID LIKE #strUsrId#||'%'
		       </isNotEmpty>
		       <isNotEmpty property="strDptCd">
		       	  AND DPT_CD = #strDptCd#
		       </isNotEmpty>
		       <isNotEmpty property="strHirkDptCd">
		       	  AND SUBSTR(DPT_CD, 0, 3) = SUBSTR(#strHirkDptCd#, 0, 3)
		       </isNotEmpty>
		       <isNotEmpty property="strRqsStaCd">
		       	  AND RQS_STA_CD = #strRqsStaCd#
		       </isNotEmpty>
               
		       <isNotEmpty property="strUsrDvsn">
		       	  AND USR_DVSN_CD = #strUsrDvsn#
		       </isNotEmpty>
               
		       <isNotEmpty property="strUsrCnb">
		       	  AND CNB LIKE #strUsrCnb#||'%'
		       </isNotEmpty>
		       <isNotEmpty property="strLoginWayCd">
		       	  AND LOGIN_WAY_CD = #strLoginWayCd#
		       </isNotEmpty>
		       <isEqual property="strWrkYn" compareValue="Y">
		       	  AND (T1.WRK_END_DT IS NOT NULL AND TO_CHAR(SYSDATE,'YYYYMMDD') <![CDATA[>]]> T1.WRK_END_DT)
		       </isEqual>
		       <isEqual property="strWrkYn" compareValue="N">
		       	  AND	(T1.WRK_END_DT IS NULL OR TO_CHAR(SYSDATE,'YYYYMMDD') <![CDATA[<=]]> T1.WRK_END_DT)
		       </isEqual>
		       <isNotEmpty property="strOrder">
		       	ORDER BY RANK_CD, CNB
		       </isNotEmpty>
		
		
		<![CDATA[
		       UNION ALL
		       SELECT USR_DVSN_CD  
                    , F_CODE_NM('1000338',USR_DVSN_CD) AS USR_DVSN_NM          
                    , ORG_CD
                    , F_ORG_INFO(ORG_CD,'1') AS ORG_NM
                    , CNB
                    , SUB_DPT_CD AS DPT_CD
                    , F_DPT_INFO(SUB_DPT_CD,'1') AS DPT_NM
                    , USR_ID 
                    , USR_NAM
                    , RQS_STA_CD       
                    , RLS_DT     
                    , TNB
                    , RANK_CD
                    , F_CODE_NM('1000173',RANK_CD) AS RANK_NM
                    , (SELECT S1.USR_DFN_TXT_2
                         FROM TBDCMACM013C S1
                        WHERE S1.CMM_CD_DVSN_CD ='1000161'
                          AND S1.CD = T1.SUB_INN_RANK_CD
                      ) AS PST_CD
                    , (SELECT F_CODE_NM('1000176',S1.USR_DFN_TXT_2) 
                         FROM TBDCMACM013C S1
                        WHERE S1.CMM_CD_DVSN_CD ='1000161'
                          AND S1.CD = T1.SUB_INN_RANK_CD
                      )|| CASE WHEN SUB_INN_RANK_CD  = '11' THEN ' 권한대행'
                               WHEN SUB_INN_RANK_CD <= '30' THEN ' 직무대리' ELSE '' END  AS PST_NM          
                    , EIN            
                    , EML_AD
                    
                    , BAI_USR_YN
                    /*, ZCD 2016.06.30 최승규 수석님 요청*/
                    , APM_DVSN_CD          
                    , HOM_TNB            
                    , RQS_TXT
                    , LOGIN_WAY_CD
                    , DOC_ID
                    , DOC_TYP_CD
                    
                    , INN_RANK_CD
                     
                    /*2015.01.27 박재운 감사관 요청-실소속부서 수정가능하도록.*/
                    , RAL_BLT_DIV_CD                                            /*실소속코드*/
                    , F_CODE_NM('1000144', RAL_BLT_DIV_CD) AS RAL_BLT_DIV_NM    /*실소속명*/
                    
                    , FAN
                    , CAR_NO
                    , T1.SUB_DPT_CD
                    , F_DPT_INFO(T1.SUB_DPT_CD,'1') AS SUB_DPT_NM
                    , SUB_INN_RANK_CD
                    , T1.WRK_STR_DT
                    , T1.WRK_END_DT
                    ,case when SUB_DPT_CD < '880880' and USR_DVSN_CD in ('1','3') and RQS_STA_CD ='3' and NVL(SUB_INN_RANK_CD,'50') > '30'
                               THEN NVL(RANK_NM_2,F_DPT_INFO(SUB_DPT_CD,'1'))
                          WHEN SUB_DPT_CD < '880880' and USR_DVSN_CD in ('1','3') and RQS_STA_CD ='3' and SUB_INN_RANK_CD <= '30'
                               AND exists (select DPT_NM from TBDCMACM002M 
		                                    where DPT_CD = T1.SUB_DPT_CD
		                                      and DPT_NM not like '%감사원' and DPT_NM not like '%감사위원'
		                                      and (DPT_NM like '%원' or DPT_NM like '%실' or DPT_NM like '%국' or DPT_NM like '%단' or DPT_NM like '%부' or DPT_NM like '%과' or DPT_NM like '%소' or DPT_NM like '%팀'))
                               THEN 
                                    (select DPT_NM||'장'||CHR(10)||CHR(13)||'직무대리' from TBDCMACM002M where DPT_CD = T1.SUB_DPT_CD)
                  
                          WHEN SUB_DPT_CD < '880880' and USR_DVSN_CD in ('1','3') and RQS_STA_CD ='3' and SUB_INN_RANK_CD = '11'
                               and not exists (select DPT_NM from TBDCMACM002M 
                                                where DPT_CD = T1.SUB_DPT_CD
                                                  and DPT_NM not like '%감사원' and DPT_NM not like '%감사위원'
                                                  and (DPT_NM like '%원' or DPT_NM like '%실' or DPT_NM like '%국' or DPT_NM like '%단' or DPT_NM like '%부' or DPT_NM like '%과' or DPT_NM like '%소' or DPT_NM like '%팀'))
                               THEN (select DPT_NM from TBDCMACM002M where DPT_CD = T1.SUB_DPT_CD)||CHR(10)||CHR(13)||'권한대행'
                 
                          WHEN SUB_DPT_CD < '880880' and USR_DVSN_CD in ('1','3') and RQS_STA_CD ='3' and SUB_INN_RANK_CD <= '30'
                               and not exists (select DPT_NM from TBDCMACM002M 
                                                where DPT_CD = T1.SUB_DPT_CD
                                                  and DPT_NM not like '%감사원' and DPT_NM not like '%감사위원'
                                                  and (DPT_NM like '%원' or DPT_NM like '%실' or DPT_NM like '%국' or DPT_NM like '%단' or DPT_NM like '%부' or DPT_NM like '%과' or DPT_NM like '%소' or DPT_NM like '%팀'))
                               THEN (select DPT_NM from TBDCMACM002M where DPT_CD = T1.SUB_DPT_CD)||CHR(10)||CHR(13)||'직무대리'
                          WHEN SUB_DPT_CD < '880880' and USR_DVSN_CD in ('2') and RQS_STA_CD ='3' THEN '수견'
                          WHEN SUB_DPT_CD < '880880' and USR_DVSN_CD in ('4') and RQS_STA_CD ='3' THEN  (select DPT_NM from TBDCMACM002M where DPT_CD = T1.SUB_DPT_CD)
                          ELSE '' END  ONR_PST_NM
                    , T1.SGN_DOC_ID
                    , T1.STMP_DOC_ID
                    , (SELECT FILE_NAME FROM ECM_FILE_LIST_VIEW2 S1 WHERE T1.SGN_DOC_ID = S1.DOC_ID ) AS SGN_FILE_NAME
                    , (SELECT FILE_NAME FROM ECM_FILE_LIST_VIEW2 S1 WHERE T1.STMP_DOC_ID = S1.DOC_ID ) AS STMP_FILE_NAME
                    
                     /* 출장여비계좌관리 정보 추가 - 2017.04.06 yyh */
                    , T1.BZT_TREXP_RCIT_BNK_CD                       AS BZT_TREXP_RCIT_BNK_CD /* 출장여비수령은행코드 */
                    , F_CODE_NM('1000166', T1.BZT_TREXP_RCIT_BNK_CD) AS BZT_TREXP_RCIT_BNK_NM /* 출장여비수령은행명 */
                    , T1.BZT_TREXP_RCIT_EAN                          AS BZT_TREXP_RCIT_EAN    /* 출장여비수령암호화계좌번호 */
                    , PBSVT_NO           
                    
                    , (SELECT USR_DFN_TXT_1
                         FROM TBDCMACM013C
                        WHERE CMM_CD_DVSN_CD = '1000338'
                          AND CD = T1.USR_DVSN_CD) AS OCP_CD
                    , RANK_CD_2
                    , RANK_SRT_SEQ_NM 
                    , CRNT_RANK_APM_DT
                    , SRT_KY_NO
                    , CRNT_DPT_APM_DT
                 FROM TBDCMACM001M T1
                WHERE 1=1
                  AND T1.SUB_DPT_CD IS NOT NULL
		]]>
		       <isNotEmpty property="strUsrNam">
		       	  AND USR_NAM LIKE '%'||#strUsrNam#||'%'
		       </isNotEmpty>
		       <isNotEmpty property="strUsrId">
		       	  AND USR_ID LIKE #strUsrId#||'%'
		       </isNotEmpty>
		       <isNotEmpty property="strDptCd">
		       	  AND SUB_DPT_CD = #strDptCd#
		       </isNotEmpty>
		       <isNotEmpty property="strHirkDptCd">
		       	  AND	SUBSTR(SUB_DPT_CD, 0, 3) = SUBSTR(#strHirkDptCd#, 0, 3)
		       </isNotEmpty>
		       <isNotEmpty property="strRqsStaCd">
		       	  AND RQS_STA_CD = #strRqsStaCd#
		       </isNotEmpty>
               
		       <isNotEmpty property="strUsrDvsn">
		       	  AND USR_DVSN_CD = #strUsrDvsn#
		       </isNotEmpty>
               
		       <isNotEmpty property="strUsrCnb">
		       	  AND CNB LIKE #strUsrCnb#||'%'
		       </isNotEmpty>
		       <isNotEmpty property="strLoginWayCd">
		       	  AND LOGIN_WAY_CD = #strLoginWayCd#
		       </isNotEmpty>
		       <isEqual property="strWrkYn" compareValue="Y">
		       	  AND	(T1.WRK_END_DT IS NOT NULL AND TO_CHAR(SYSDATE,'YYYYMMDD') <![CDATA[>]]> T1.WRK_END_DT)
		       </isEqual>
		       <isEqual property="strWrkYn" compareValue="N">
		       	  AND	(T1.WRK_END_DT IS NULL OR TO_CHAR(SYSDATE,'YYYYMMDD') <![CDATA[<=]]> T1.WRK_END_DT)
		       </isEqual>
		       <isNotEmpty property="strOrder">
		       	ORDER BY RANK_CD, CNB
		       </isNotEmpty>
		       <isEmpty property="strOrder">
		        ORDER BY USR_NAM
		       </isEmpty>
		       
		<![CDATA[
              ) A
        ORDER BY RAL_BLT_DIV_CD
               , OCP_CD
               , (SELECT TO_NUMBER(C.USR_DFN_TXT_8)
                    FROM TBDCMACM013C C
                   WHERE C.CMM_CD_DVSN_CD = '1000175'
                     AND C.CD = RANK_CD_2)
               , CASE
                      WHEN CNB = '2702' THEN '49'
                      ELSE NVL(INN_RANK_CD, '50')
                 END ASC
               , RANK_SRT_SEQ_NM
               , CRNT_RANK_APM_DT
               , SRT_KY_NO
               , CRNT_DPT_APM_DT
               , EIN
               , DECODE(RAL_BLT_DIV_CD, '062500', '', CNB)
		]]>
	</select>
</sqlMap> 