<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="res/rcm/001">

	<!--처분요구목록 조회-->
	<select id="RESRCM001PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT 	 T1.EVL_YR				/* 평가년도  */
					,T1.HLYR_DVSN_CD		/* 반기구분코드 */
					,T1.EVL_DGE				/* 평가차수 */
					,T1.EVL_TG_DPT_CD		/* 평가요청부서코드 */
					,(SELECT DPT_NM
					    FROM TBRESRCM005M S1
					   WHERE S1.EVL_YR = T1.EVL_YR
					     AND S1.HLYR_DVSN_CD = T1.HLYR_DVSN_CD
					     AND S1.EVL_DGE = T1.EVL_DGE
					     AND S1.DPT_CD = T1.EVL_TG_DPT_CD
					 ) AS EVL_TG_DPT_NM
					,T1.EVL_TIT				/* 평가제목 */
					,T1.SPE_ADP_SNO			/* 특별가산점순번 */
					,T1.CLU_CD				/* 특별가산점 항목 코드 */
					,(SELECT CD_NM
					    FROM TBRESRCM006C S1
					   WHERE S1.EVL_YR = T1.EVL_YR
					     AND S1.HLYR_DVSN_CD = T1.HLYR_DVSN_CD
					     AND S1.EVL_DGE = T1.EVL_DGE
					     AND S1.CD_DVSN_CD = 'R000'
					     AND S1.CD = T1.CLU_CD
					 ) AS CLU_NM
			  FROM TBRESRAD016M T1
			 WHERE 1=1 
		]]>			             
           		
		<isNotEmpty property="EVL_YR">	
			   AND T1.EVL_YR = #EVL_YR#
		</isNotEmpty>

		<isNotEmpty property="HLYR_DVSN_CD">	
			   AND T1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
		</isNotEmpty>
		
		<isNotEmpty property="EVL_DGE">	
			   AND T1.EVL_DGE = #EVL_DGE#
		</isNotEmpty>

		<isNotEmpty property="SPE_ADP_SNO">
			   AND T1.SPE_ADP_SNO IN
					<iterate property="SPE_ADP_SNO" open="(" close=")" conjunction=",">
						#SPE_ADP_SNO[]#
					</iterate>
		</isNotEmpty>
	     
		<isNotEmpty property="APV_DOC_NO">	
			   AND T1.APV_DOC_NO = #APV_DOC_NO#
		</isNotEmpty>	     
	     
	     ORDER BY T1.EVL_YR
	             ,T1.HLYR_DVSN_CD
	             ,T1.EVL_DGE
	             ,T1.SPE_ADP_SNO
	</select>
			
	<select id="RESRCM001PDtlSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT T1.EVL_YR
			      ,T1.HLYR_DVSN_CD
			      ,T1.EVL_DGE
			      ,T1.EVL_TG_DPT_CD
			      ,T1.SPE_ADP_SNO
			      ,T2.CNB
			      ,(SELECT USR_NAM
					    FROM TBRESRCM004M S1
					   WHERE S1.EVL_YR = T1.EVL_YR
					     AND S1.HLYR_DVSN_CD = T1.HLYR_DVSN_CD
					     AND S1.EVL_DGE = T1.EVL_DGE
					     AND S1.CNB = T2.CNB
					 ) AS USR_NAM
			      ,T2.CTB_RTE
			 FROM TBRESRAD016M T1, TBRESRAD015D T2
			WHERE T1.EVL_YR = #strEVL_YR#
			  AND T1.HLYR_DVSN_CD = #strHLYR_DVSN_CD#
			  AND T1.EVL_DGE = #strEVL_DGE#
			  AND T1.SPE_ADP_SNO = #strSPE_ADP_SNO#
			  AND T1.EVL_YR = T2.EVL_YR
			  AND T1.HLYR_DVSN_CD = T2.HLYR_DVSN_CD
			  AND T1.EVL_DGE = T2.EVL_DGE
			  AND T1.SPE_ADP_SNO = T2.SPE_ADP_SNO
		]]>
	</select>
	
	<update id="RESRCM001PApvSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBRESRAD016M T1
			   SET APV_DOC_NO = #APV_DOC_NO#
			      ,APV_STA_CD = #APV_STA_CD#
			 WHERE 1=1
		]]>
		
		<isNotEmpty property="SPE_ADP_SNO">
			AND T1.EVL_YR = #EVL_YR#
			AND T1.HLYR_DVSN_CD = #HLYR_DVSN_CD#
			AND T1.EVL_DGE = #EVL_DGE#
		   	AND T1.SPE_ADP_SNO IN
				<iterate property="SPE_ADP_SNO" open="(" close=")" conjunction=",">
					#SPE_ADP_SNO[]#
				</iterate>
		</isNotEmpty>
		
		<isEmpty property="SPE_ADP_SNO">
			AND APV_DOC_NO = #APV_DOC_NO#
		</isEmpty>
	</update>
</sqlMap> 
