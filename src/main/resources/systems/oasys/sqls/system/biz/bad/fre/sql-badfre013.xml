<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/fre/013">
	
	<!-- 특수관리사항 목록조회-->
	<select id="BADFRE013EMainselect" parameterClass="paramMap" resultClass="resultMap">
	      SELECT 
                 D1.AUD_YR                                                            /* 감사년도                   */
                ,D1.AUD_NO                                                            /* 감사번호                   */
                ,D4.AUD_GRN_NO                                                        /* 감사부여번호 - 2016.06.02 yyh */
                ,D1.DSP_RQ_SNO                                                        /* 처분요구순번               */
                ,D1.RLTN_ORG_CD                                                       /* 관계기관코드               */
                ,F_ORG_INFO(D1.RLTN_ORG_CD,'1')                    AS RLTN_ORG_NM     /* 관계기관명               */
                ,D1.MNG_SNO                                                           /* 관리순번                   */
                ,D1.SPV_BRDV_CD                                                       /* 주관국과코드               */
                ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')                    AS SPV_BRDV_NM     /* 주관국과명               */
                ,D1.DTM_YN                                                            /* 확정여부        */
                ,D1.MNG_ORG_CD                                                        /* 관리기관코드    */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1')                     AS MNG_ORG_NM      /* 관리기관명        */
                ,D1.ASG_DT                                                            /* 지정일                     */
                ,D1.ASG_AM                                                            /* 지정금액                   */
                ,D1.CPS_DRTR_NM                                                       /* 변상책임자명               */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1') || '(' ||
                 D1.CPS_DRTR_NM || ')'                             AS ORG_DRTR_NM     /* 관리기관(책임자) */                     
                ,D1.CPS_DRTR_AD                                                       /* 변상책임자주소             */
                ,D1.RLS_DT                                                            /* 해제일                     */
                ,D1.RLS_RSN                                                           /* 해제사유                   */
                ,D1.RQR_ID                                                            /* 요청자ID      */
                ,F_USR_INFO(D1.RQR_ID,'2')                         AS RQR_NM          /* 요청자명      */
                ,D1.RQS_DT                                                            /* 요청일                     */
                ,D1.RQS_RSN                                                           /* 요청사유                   */
                ,D1.APV_DOC_NO                                                        /* 결재문서번호     */
                ,D1.APV_STA_CD                                                        /* 결재상태코드               */
                ,CASE WHEN D1.APV_STA_CD IS NULL THEN '미상신'
                      ELSE F_CODE_NM('1000603', D1.APV_STA_CD)
                  END                                              AS APV_STA_NM      /* 결재상태명               */
                ,D1.APV_STA_DT                                                        /* 결재상태일                 */
                ,D1.MNG_YR                                                            /* 관리년도                   */
                ,D1.MNG_NO                                                            /* 관리번호                   */
                ,D1.SLF_PRSS_STA_CD                                                   /* 자체진행상태코드           */
                ,D1.SLF_APV_DT                                                        /* 자체결재일                 */
                ,D1.SLF_SEN_DT                                                        /* 자체발송일                 */
                ,D1.SPCN_MNG_STA_CD                                                   /* 특수관리상태코드           */
                ,D1.ASG_RSN                                                           /* 지정사유                   */
                ,D1.EXAM_RPT_FRM_ENFM_HIS                                             /* 검토보고서식집행내역       */
                ,D1.EXAM_RPT_FRM_ASG_RSN                                              /* 검토보고서식지정사유       */
                ,D1.EXAM_RPT_FRM_EXAM_OPIN                                            /* 검토보고서식검토의견       */
                ,D1.EXAM_RPT_FRM_APV_STA_CD                                           /* 검토보고서식결재상태코드   */
                ,D1.EXAM_RPT_FRM_APV_STA_DT                                           /* 검토보고서식결재상태일     */
            	,D1.EXAM_RPT_FRM_APV_DOC_NO                                           /* 검토보고서식결재문서번호 */
                ,D1.DOC_ID                                                            /* 문서ID      */
                ,D1.DOC_TYP_CD                                                        /* 문서유형코드               */
                ,D1.FRT_USR_ID                                                        /* 최초사용자ID    */
                ,D1.FNL_USR_ID                                                        /* 최종사용자ID   */
                ,D1.FNL_DEAL_DPT_CD                                                   /* 최종거래부서코드           */
                ,D1.FNL_MNU_ID                                                        /* 최종메뉴ID    */
                ,D1.FRT_REGI_DH                                                       /* 최초등록일시               */
                ,D1.FNL_MDF_DH                                                        /* 최종수정일시       */
                ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D4.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO      
                                                                   AS DSP_RQ_NO       /* 처분요구번호                   */
 		     	, CASE WHEN D2.AUD_YR >= '2016' 
			                THEN SUBSTR(D4.AUD_KND_CD,3,1)
			           ELSE '' 
			       END                                             AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.24 yyh*/	                                                                   
                ,D2.TIT_TXT                                        AS TIT_TXT         /* 제목내용                   */
                ,CASE WHEN NVL(D1.DTM_YN,'N')   != 'Y' 
                           AND D1.ASG_DT        IS NOT NULL                 
        	               AND D1.RLS_DT        IS NULL     THEN '지정X'
        	          WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
        	               AND D1.ASG_DT        IS NOT NULL                  
    	                   AND D1.RLS_DT        IS NULL     THEN '지정O'
    	              WHEN NVL(D1.DTM_YN,'N')  != 'Y'                 
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제X'
    	              WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제O'
    	             END                                           AS DVSN                 /* 구분                   */
                
                ,D3.ENF_BRDV_CD                                    AS ENF_BRDV_CD          /* 시행국과명 */
                ,F_DPT_INFO(D3.ENF_BRDV_CD,'1')                    AS ENF_BRDV_NM          /* 시행국과명 */                
                ,D2.DSP_RQ_KND_CD                                  AS DSP_RQ_KND_CD        /* 처분요구종류코드 */
                ,F_CODE_NM('1000002', D2.DSP_RQ_KND_CD)            AS DSP_RQ_KND_NM        /* 처분요구종류명 */
                ,D3.PNL_DRIN_PSVT_AM                               AS PNL_DRIN_PSVT_AM     /* 추징회수보전금액 */ 
                ,D3.ENF_DT                                         AS ENF_DT               /* 시행일 */
                ,D4.AUD_SBJ_NM                                     AS AUD_SBJ_NM           /* 감사사항명 */
                ,D3.EXAM_RPRT_DSP_RQ_SBT                           AS EXAM_RPRT_DSP_RQ_SBT /* 검토보고서 처분요구요지 */
                ,(SELECT SUM(AM)
                    FROM TBBADEAR007M /* 관계자 기본 */
                   WHERE 1=1
                     AND AUD_YR     = D1.AUD_YR    
        	         AND AUD_NO     = D1.AUD_NO     
        	         AND DSP_RQ_SNO = D1.DSP_RQ_SNO)               AS DSP_RQ_TAM           /* 처분요구 전체 금액 */
        	         
           FROM TBBADFRE011M D1  /* 특수관리기본 */
               ,TBBADEAR001M D2  /* 처분요구사항기본 */
               ,TBBADEAR002D D3  /* 처분요구사항 상세 */
               ,TBBADDED001M D4  /* 감사사항기본 */               
          WHERE 1=1
            AND D1.AUD_YR        = D2.AUD_YR    
        	AND D1.AUD_NO        = D2.AUD_NO     
        	AND D1.DSP_RQ_SNO    = D2.DSP_RQ_SNO
            AND D2.AUD_YR        = D3.AUD_YR    
        	AND D2.AUD_NO        = D3.AUD_NO     
        	AND D2.DSP_RQ_SNO    = D3.DSP_RQ_SNO 
        	AND D3.AUD_YR        = D4.AUD_YR    
        	AND D3.AUD_NO        = D4.AUD_NO        	
            AND D1.SLF_PRSS_STA_CD  &gt;= '71'
            
            	AND D1.SPV_BRDV_CD   IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
			            
            <!-- 주관국과코드 -->    
			<isNotEmpty property="strDptCd2">
                AND D1.SPV_BRDV_CD = #strDptCd2#
            </isNotEmpty> 
            
            <!-- 기관에서 지정요청할 사항 -->
            <isEqual property="strAsgDvsn" compareValue="1">
               AND D1.ASG_DT IS NULL
               AND D1.RLS_DT IS NULL 
	        </isEqual>     
            <!-- 지정한 사항 -->
            <isEqual property="strAsgDvsn" compareValue="2">
               AND D1.ASG_DT IS NOT NULL
               AND D1.RLS_DT IS NULL 
	        </isEqual>                 
            <!-- 해제한 사항 -->
            <isEqual property="strAsgDvsn" compareValue="3">
               AND D1.RLS_DT IS NOT NULL   
	        </isEqual>               
  
			<!-- 검색어 -->
            <isNotEmpty property="strSchTxt">
                AND ( (SELECT ORG_NM 
                         FROM TBDCMACM015M                                
        		        WHERE ORG_CD = D1.MNG_ORG_CD) LIKE  '%' || #strSchTxt# || '%'
        		     OR D1.CPS_DRTR_NM  LIKE  '%' || #strSchTxt# || '%'
        		     OR D2.TIT_TXT      LIKE  '%' || #strSchTxt# || '%'
        		    )
            </isNotEmpty>
           
            <!-- 결재확정  -->
            <isNotEqual property="strApvDtm" compareValue="0"> 
                AND NVL(D1.APV_STA_CD,'1') = #strApvDtm#
            </isNotEqual>
            
            <!-- 감사연번 -->
            <isNotEmpty property="strInqAudYr">
                AND D1.AUD_YR = #strInqAudYr#
            </isNotEmpty>
            <!-- 감사부여번호 추가 - 2016.06.02 yyh -->
            <isNotEmpty property="strInqAudGrnNo">
                AND D4.AUD_GRN_NO = #strInqAudGrnNo#
            </isNotEmpty>            
			<isNotNull property="strAudYrNoKndCd">
				<isNotEmpty property="strAudYrNoKndCd">	 	
		              /* 감사연번종류코드 - 2015.12.24 yyh */
					  AND SUBSTR(D4.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
				</isNotEmpty>		
			</isNotNull>            
            
        ORDER BY D1.AUD_YR DESC 
               , D1.AUD_NO DESC
               , D1.DSP_RQ_SNO DESC
               , D1.RLTN_ORG_CD DESC
               , D1.MNG_SNO DESC
	</select>
	<select id="BADFRE013EPopselect" parameterClass="paramMap" resultClass="resultMap">
	      SELECT 
                 D1.AUD_YR                                                            /* 감사년도                   */
                ,D1.AUD_NO                                                            /* 감사번호                   */
                ,D4.AUD_GRN_NO                                                        /* 감사부여번호 - 2016.06.02 yyh */
                ,D1.DSP_RQ_SNO                                                        /* 처분요구순번               */
                ,D1.RLTN_ORG_CD                                                       /* 관계기관코드               */
                ,F_ORG_INFO(D1.RLTN_ORG_CD,'1')                    AS RLTN_ORG_NM     /* 관계기관명               */
                ,D1.MNG_SNO                                                           /* 관리순번                   */
                ,D1.SPV_BRDV_CD                                                       /* 주관국과코드               */
                ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')                    AS SPV_BRDV_NM     /* 주관국과명               */
                ,D1.DTM_YN                                                            /* 확정여부        */
                ,D1.MNG_ORG_CD                                                        /* 관리기관코드    */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1')                     AS MNG_ORG_NM      /* 관리기관명        */
                ,D1.ASG_DT                                                            /* 지정일                     */
                ,D1.ASG_AM                                                            /* 지정금액                   */
                ,D1.CPS_DRTR_NM                                                       /* 변상책임자명               */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1') || '(' ||
                 D1.CPS_DRTR_NM || ')'                             AS ORG_DRTR_NM     /* 관리기관(책임자) */                     
                ,D1.CPS_DRTR_AD                                                       /* 변상책임자주소             */
                ,D1.RLS_DT                                                            /* 해제일                     */
                ,D1.RLS_RSN                                                           /* 해제사유                   */
                ,D1.RQR_ID                                                            /* 요청자ID      */
                ,F_USR_INFO(D1.RQR_ID,'2')                         AS RQR_NM          /* 요청자명      */
                ,D1.RQS_DT                                                            /* 요청일                     */
                ,D1.RQS_RSN                                                           /* 요청사유                   */
                ,D1.APV_DOC_NO                                                        /* 결재문서번호     */
                ,D1.APV_STA_CD                                                        /* 결재상태코드               */
                ,CASE WHEN D1.APV_STA_CD IS NULL THEN '미상신'
                      ELSE F_CODE_NM('1000603', D1.APV_STA_CD)
                  END                                              AS APV_STA_NM      /* 결재상태명               */
                ,D1.APV_STA_DT                                                        /* 결재상태일                 */
                ,D1.MNG_YR                                                            /* 관리년도                   */
                ,D1.MNG_NO                                                            /* 관리번호                   */
                ,D1.SLF_PRSS_STA_CD                                                   /* 자체진행상태코드           */
                ,D1.SLF_APV_DT                                                        /* 자체결재일                 */
                ,D1.SLF_SEN_DT                                                        /* 자체발송일                 */
                ,D1.SPCN_MNG_STA_CD                                                   /* 특수관리상태코드           */
                ,D1.ASG_RSN                                                           /* 지정사유                   */
                ,D1.EXAM_RPT_FRM_ENFM_HIS                                             /* 검토보고서식집행내역       */
                ,D1.EXAM_RPT_FRM_ASG_RSN                                              /* 검토보고서식지정사유       */
                ,D1.EXAM_RPT_FRM_EXAM_OPIN                                            /* 검토보고서식검토의견       */
                ,D1.EXAM_RPT_FRM_APV_STA_CD                                           /* 검토보고서식결재상태코드   */
                ,D1.EXAM_RPT_FRM_APV_STA_DT                                           /* 검토보고서식결재상태일     */
            	,D1.EXAM_RPT_FRM_APV_DOC_NO                                           /* 검토보고서식결재문서번호 */
                ,D1.DOC_ID                                                            /* 문서ID      */
                ,D1.DOC_TYP_CD                                                        /* 문서유형코드               */
                ,D1.FRT_USR_ID                                                        /* 최초사용자ID    */
                ,D1.FNL_USR_ID                                                        /* 최종사용자ID   */
                ,D1.FNL_DEAL_DPT_CD                                                   /* 최종거래부서코드           */
                ,D1.FNL_MNU_ID                                                        /* 최종메뉴ID    */
                ,D1.FRT_REGI_DH                                                       /* 최초등록일시               */
                ,D1.FNL_MDF_DH                                                        /* 최종수정일시       */
                ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D4.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO      
                                                                   AS DSP_RQ_NO       /* 처분요구번호                   */
 		     	, CASE WHEN D2.AUD_YR >= '2016' 
			                THEN SUBSTR(D4.AUD_KND_CD,3,1)
			           ELSE '' 
			       END                                             AS AUD_YR_NO_KND_CD /*감사연번호종류코드 추가 - 2015.12.24 yyh*/	                                                                     
                ,D2.TIT_TXT                                        AS TIT_TXT         /* 제목내용                   */
                ,CASE WHEN NVL(D1.DTM_YN,'N')   != 'Y' 
                           AND D1.ASG_DT        IS NOT NULL                 
        	               AND D1.RLS_DT        IS NULL     THEN '지정X'
        	          WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
        	               AND D1.ASG_DT        IS NOT NULL                  
    	                   AND D1.RLS_DT        IS NULL     THEN '지정O'
    	              WHEN NVL(D1.DTM_YN,'N')  != 'Y'                 
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제X'
    	              WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제O'
    	             END                                           AS DVSN                 /* 구분                   */
                
                ,D3.ENF_BRDV_CD                                    AS ENF_BRDV_CD          /* 시행국과명 */
                ,F_DPT_INFO(D3.ENF_BRDV_CD,'1')                    AS ENF_BRDV_NM          /* 시행국과명 */                
                ,D2.DSP_RQ_KND_CD                                  AS DSP_RQ_KND_CD        /* 처분요구종류코드 */
                ,F_CODE_NM('1000002', D2.DSP_RQ_KND_CD)            AS DSP_RQ_KND_NM        /* 처분요구종류명 */
                ,D3.PNL_DRIN_PSVT_AM                               AS PNL_DRIN_PSVT_AM     /* 추징회수보전금액 */ 
                ,D3.ENF_DT                                         AS ENF_DT               /* 시행일 */
                ,D4.AUD_SBJ_NM                                     AS AUD_SBJ_NM           /* 감사사항명 */
                ,D3.EXAM_RPRT_DSP_RQ_SBT                           AS EXAM_RPRT_DSP_RQ_SBT /* 검토보고서 처분요구요지 */
                ,(SELECT SUM(AM)
                    FROM TBBADEAR007M /* 관계자 기본 */
                   WHERE 1=1
                     AND AUD_YR     = D1.AUD_YR    
        	         AND AUD_NO     = D1.AUD_NO     
        	         AND DSP_RQ_SNO = D1.DSP_RQ_SNO)               AS DSP_RQ_TAM           /* 처분요구 전체 금액 */
        	         
           FROM TBBADFRE011M D1  /* 특수관리기본 */
               ,TBBADEAR001M D2  /* 처분요구사항기본 */
               ,TBBADEAR002D D3  /* 처분요구사항 상세 */
               ,TBBADDED001M D4  /* 감사사항기본 */               
          WHERE 1=1
            AND D1.AUD_YR        = D2.AUD_YR    
        	AND D1.AUD_NO        = D2.AUD_NO     
        	AND D1.DSP_RQ_SNO    = D2.DSP_RQ_SNO
            AND D2.AUD_YR        = D3.AUD_YR    
        	AND D2.AUD_NO        = D3.AUD_NO     
        	AND D2.DSP_RQ_SNO    = D3.DSP_RQ_SNO 
        	AND D3.AUD_YR        = D4.AUD_YR    
        	AND D3.AUD_NO        = D4.AUD_NO        	
            AND D1.SLF_PRSS_STA_CD  &gt;= '71'
            AND D1.AUD_YR        = #AUD_YR#
            AND D1.AUD_NO        = #AUD_NO#
            AND D1.DSP_RQ_SNO    = #DSP_RQ_SNO#
            AND D1.RLTN_ORG_CD   = #RLTN_ORG_CD#
            AND D1.MNG_SNO       = #MNG_SNO#
        ORDER BY D1.AUD_YR DESC 
               , D1.AUD_NO DESC
               , D1.DSP_RQ_SNO DESC
               , D1.RLTN_ORG_CD DESC
               , D1.MNG_SNO DESC
	</select>

	<!-- 특수관리사항 상세조회-->
	<select id="BADFRE013EMainDtlselect" parameterClass="paramMap" resultClass="resultMap">
	      SELECT 
                 D1.AUD_YR                                                      /* 감사년도                   */
                ,D1.AUD_NO                                                      /* 감사번호                   */
                ,D4.AUD_GRN_NO                                                  /* 감사부여번호 - 2016.06.02 yyh */                
                ,D1.DSP_RQ_SNO                                                  /* 처분요구순번               */
                ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D4.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO 
                                                            AS AUD_YR_NO        /* 감사연번호 - 2016.06.09 yyh */
                ,D1.RLTN_ORG_CD                                                 /* 관계기관코드               */
                ,F_ORG_INFO(D1.RLTN_ORG_CD,'1')             AS RLTN_ORG_NM      /* 관계기관명               */
                ,D1.MNG_SNO                                                     /* 관리순번                   */
                ,D1.SPV_BRDV_CD                                                 /* 주관국과코드               */
                ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')             AS SPV_BRDV_NM      /* 주관국과명               */
                ,D1.DTM_YN                                                      /* 확정여부                  */
                ,D1.MNG_ORG_CD                                                  /* 관리기관코드               */
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1')              AS MNG_ORG_NM       /* 관리기관명        */
                ,D1.ASG_DT                                                      /* 지정일                     */
                ,D1.ASG_AM                                                      /* 지정금액                   */
                ,D1.CPS_DRTR_NM                                                 /* 변상책임자명               */                   
                ,D1.CPS_DRTR_AD                                                 /* 변상책임자주소             */
                ,D1.RLS_DT                                                      /* 해제일                     */
                ,D1.RLS_RSN                                                     /* 해제사유                   */
                ,D1.RQR_ID                                                      /* 요청자ID      */
                ,F_USR_INFO(D1.RQR_ID,'2')                  AS RQR_NM           /* 요청자명      */
                ,D1.RQS_DT                                                      /* 요청일                     */
                ,D1.RQS_RSN                                                     /* 요청사유                   */
                ,D1.APV_DOC_NO                                                  /* 결재문서번호     */
                ,D1.APV_STA_CD                                                  /* 결재상태코드               */
                ,D1.APV_STA_DT                                                  /* 결재상태일                 */
                ,D1.MNG_YR                                                      /* 관리년도                   */
                ,D1.MNG_NO                                                      /* 관리번호                   */
                ,D1.SLF_PRSS_STA_CD                                             /* 자체진행상태코드           */
                ,D1.SLF_APV_DT                                                  /* 자체결재일                 */
                ,D1.SLF_SEN_DT                                                  /* 자체발송일                 */
                ,D1.SPCN_MNG_STA_CD                                             /* 특수관리상태코드           */
                ,D1.ASG_RSN                                                     /* 지정사유                   */
                ,D1.EXAM_RPT_FRM_ENFM_HIS                                       /* 검토보고서식집행내역       */
                ,D1.EXAM_RPT_FRM_ASG_RSN                                        /* 검토보고서식지정사유       */
                ,D1.EXAM_RPT_FRM_EXAM_OPIN                                      /* 검토보고서식검토의견       */
                ,D1.EXAM_RPT_FRM_APV_STA_CD                                     /* 검토보고서식결재상태코드   */
                ,D1.EXAM_RPT_FRM_APV_STA_DT                                     /* 검토보고서식결재상태일     */
                ,D1.EXAM_RPT_FRM_APV_DOC_NO                                     /* 검토보고서식결재문서번호 */
                ,D1.DOC_ID                                                      /* 문서ID      */
                ,D1.DOC_TYP_CD                                                  /* 문서유형코드               */ 
                
                ,D3.ENF_BRDV_CD                             AS ENF_BRDV_CD      /* 시행국과명 */
                ,F_DPT_INFO(D3.ENF_BRDV_CD,'1')             AS ENF_BRDV_NM      /* 시행국과명 */
                ,D2.DSP_RQ_KND_CD                           AS DSP_RQ_KND_CD    /* 처분요구종류코드 */
                ,F_CODE_NM('1000002', D2.DSP_RQ_KND_CD)     AS DSP_RQ_KND_NM    /* 처분요구종류명 */
                ,D2.TIT_TXT                                 AS TIT_TXT          /* 제목내용 */ 
                ,D3.PNL_DRIN_PSVT_AM                        AS PNL_DRIN_PSVT_AM /* 추징회수보전금액 */ 
                ,D3.ENF_DT                                  AS ENF_DT           /* 시행일 */
                ,D4.AUD_SBJ_NM                              AS AUD_SBJ_NM       /* 감사사항명 */
                ,D3.EXAM_RPRT_DSP_RQ_SBT                    AS EXAM_RPRT_DSP_RQ_SBT /* 검토보고서 처분요구요지 */
                ,(SELECT SUM(AM)
                    FROM TBBADEAR007M /* 관계자 기본 */
                   WHERE 1=1
                     AND AUD_YR     = D1.AUD_YR    
        	         AND AUD_NO     = D1.AUD_NO     
        	         AND DSP_RQ_SNO = D1.DSP_RQ_SNO)        AS DSP_RQ_TAM           /* 처분요구 전체 금액 */                
                           
           FROM TBBADFRE011M D1  /* 특수관리기본 */
               ,TBBADEAR001M D2  /* 처분요구사항 기본*/
               ,TBBADEAR002D D3  /* 처분요구사항 상세 */
               ,TBBADDED001M D4  /* 감사사항기본 */
          WHERE 1=1
            AND D1.AUD_YR        = D2.AUD_YR    
        	AND D1.AUD_NO        = D2.AUD_NO     
        	AND D1.DSP_RQ_SNO    = D2.DSP_RQ_SNO   
            AND D2.AUD_YR        = D3.AUD_YR    
        	AND D2.AUD_NO        = D3.AUD_NO     
        	AND D2.DSP_RQ_SNO    = D3.DSP_RQ_SNO 
        	AND D3.AUD_YR        = D4.AUD_YR    
        	AND D3.AUD_NO        = D4.AUD_NO
            AND D1.AUD_YR        = #strAudYr#      /* 감사년도 */
            AND D1.AUD_NO        = #strAudNo#      /* 감사번호 */
            AND D1.DSP_RQ_SNO    = #strDspRqSno#   /* 처분요구순번 */
            AND D1.RLTN_ORG_CD   = #strRltnOrgCd#  /* 관계기관코드 */
            AND D1.MNG_SNO       = #strMngSno#     /* 관리순번 */           
	</select>


	<!-- 특수관리 집행내역 조회 -->
	<select id="BADFRE013EHisselect" parameterClass="paramMap" resultClass="resultMap">
	      SELECT 
                 AUD_YR                                     /* 감사년도 */
                ,AUD_NO                                     /* 감사번호 */   
                ,DSP_RQ_SNO                                 /* 처분요구순번 */
                ,RLTN_ORG_CD                                /* 관계기관코드 */
                ,F_ORG_INFO(RLTN_ORG_CD,'1') AS RLTN_ORG_NM /* 관계기관명 */
                ,MNG_SNO                                    /* 관리순번 */
                ,SLN                                        /* 연번 */     
                ,ENFM_DT                                    /* 집행일 */             
                ,ENFM_AM                                    /* 집행금액 */           
                ,ENFM_TXT                                   /* 집행내용 */           
                ,DTM_YN                                     /* 확정여부 */           
	       FROM TBBADFRE011L
	      WHERE 1=1
	        AND AUD_YR        = #strAudYr#      /* 감사년도 */
            AND AUD_NO        = #strAudNo#      /* 감사번호 */
            AND DSP_RQ_SNO    = #strDspRqSno#   /* 처분요구순번 */
            AND RLTN_ORG_CD   = #strRltnOrgCd#  /* 관계기관코드 */
            AND MNG_SNO       = #strMngSno#     /* 관리순번 */  
	      ORDER BY SLN DESC 
	</select>
	
	<!-- 특수관리 기본 입력 -->
	<insert id="BADFRE013EMaininsert" parameterClass="paramMap">
         INSERT INTO TBBADFRE011M          /* 특수관리 기본 */
         (
              AUD_YR                            
             ,AUD_NO
             ,DSP_RQ_SNO
             ,RLTN_ORG_CD
             ,MNG_SNO
             ,SPV_BRDV_CD
             ,MNG_ORG_CD
             ,ASG_DT
             ,ASG_AM
             ,CPS_DRTR_NM
             ,CPS_DRTR_AD
             ,RLS_DT
             ,RLS_RSN
             ,RQR_ID
             ,RQS_DT
             ,RQS_RSN
             ,APV_DOC_NO
             ,APV_STA_CD
             ,APV_STA_DT
             ,MNG_YR
             ,MNG_NO
             ,SLF_PRSS_STA_CD
             ,SLF_APV_DT
             ,SLF_SEN_DT
             ,SPCN_MNG_STA_CD
             ,ASG_RSN
             ,EXAM_RPT_FRM_ENFM_HIS
             ,EXAM_RPT_FRM_ASG_RSN
             ,EXAM_RPT_FRM_EXAM_OPIN
             ,EXAM_RPT_FRM_APV_STA_CD
             ,EXAM_RPT_FRM_APV_STA_DT
             ,EXAM_RPT_FRM_APV_DOC_NO
             ,DOC_ID
             ,DOC_TYP_CD
             ,FRT_USR_ID
             ,FNL_USR_ID
             ,FNL_DEAL_DPT_CD
             ,FNL_MNU_ID
             ,FRT_REGI_DH
             ,FNL_MDF_DH
         ) VALUES (
              #AUD_YR#                          /* 감사년도           - */                
             ,#AUD_NO#                          /* 감사번호            - */
             ,#DSP_RQ_SNO#                      /* 처분요구순번      - */
             ,#RLTN_ORG_CD#                     /* 관계기관코드    - */
             ,#MNG_SNO#                         /* 관리순번       - */
             ,#SPV_BRDV_CD#                     /* 주관국과코드          - */
             ,#MNG_ORG_CD#                      /* 관리기관코드         - */
             ,#ASG_DT#                          /* 지정일           - */
             ,#ASG_AM#                          /* 지정금액         - */
             ,#CPS_DRTR_NM#                     /* 변상책임자명     - */
             ,#CPS_DRTR_AD#                     /* 변상책임자주소    */
             ,#RLS_DT#                          /* 해제일             - */
             ,#RLS_RSN#                         /* 해제사유         - */
             ,#RQR_ID#                          /* 요청자ID */
             ,#RQS_DT#                          /* 요청일            - */
             ,#RQS_RSN#                         /* 요청사유          - */
             ,#APV_DOC_NO#                      /* 결재문서번호   */
             ,#APV_STA_CD#                      /* 결재상태코드     - */
             ,#APV_STA_DT#                      /* 결재상태일      -  */
             ,#MNG_YR#                          /* 관리년도        -  */
             ,#MNG_NO#                          /* 관리번호        -  */
             ,#SLF_PRSS_STA_CD#                 /* 자체진행상태코드          */
             ,#SLF_APV_DT#                      /* 자체결재일                */
             ,#SLF_SEN_DT#                      /* 자체발송일                */
             ,'1'                               /* 특수관리상태코드(1:지정접수) */
             ,#ASG_RSN#                         /* 지정사유                  */
             ,#EXAM_RPT_FRM_ENFM_HIS#           /* 검토보고서식집행내역      */
             ,#EXAM_RPT_FRM_ASG_RSN#            /* 검토보고서식지정사유      */
             ,#EXAM_RPT_FRM_EXAM_OPIN#          /* 검토보고서식검토의견      */
             ,#EXAM_RPT_FRM_APV_STA_CD#         /* 검토보고서식결재상태코드  */
             ,#EXAM_RPT_FRM_APV_STA_DT#         /* 검토보고서식결재상태일    */
             ,#EXAM_RPT_FRM_APV_DOC_NO#         /* 검토보고서식결재문서번호  */
             ,#DOC_ID#                          /* 문서ID          */
             ,#DOC_TYP_CD#                      /* 문서유형코드              */
             ,#FRT_USR_ID#                      /* 최초사용자ID      */
             ,#FNL_USR_ID#                      /* 최종사용자ID      */
             ,#FNL_DEAL_DPT_CD#                 /* 최종거래부서코드          */
             ,#FNL_MNU_ID#                      /* 최종메뉴ID       */
             ,SYSDATE                           /* 최초등록일시              */
             ,SYSDATE                           /* 최종수정일시              */
         ) 
	</insert>	
	
	<!-- 특수관리기본 수정 -->
	<update id="BADFRE013EMainupdate" parameterClass="paramMap">
        UPDATE TBBADFRE011M                                      /* 특수관리 기본 */ 
		  SET ASG_DT                 = #ASG_DT#                  /* 지정일 */          
		     ,ASG_AM                 = #ASG_AM#                  /* 지정금액 */
             ,ASG_RSN                = #ASG_RSN#                 /* 지정사유 */
             ,CPS_DRTR_NM            = #CPS_DRTR_NM#             /* 변상책임자명 */          
             ,CPS_DRTR_AD            = #CPS_DRTR_AD#             /* 변상책임자주소 */
             ,RLS_DT                 = #RLS_DT#                  /* 해제일 */
             ,RLS_RSN                = #RLS_RSN#                 /* 해제사유 */
			 ,RQR_ID                 = #RQR_ID#                  /* 요청자ID */
			 ,RQS_DT                 = #RQS_DT#                  /* 요청일 */
			 ,RQS_RSN                = #RQS_RSN#                 /* 요청사유 */
			 ,SPCN_MNG_STA_CD        = '1'                       /* 특수관리상태코드(1:지정접수) */
             ,EXAM_RPT_FRM_ENFM_HIS  = #EXAM_RPT_FRM_ENFM_HIS#   /* 검토보고서식집행내역 */ 
             ,EXAM_RPT_FRM_ASG_RSN   = #EXAM_RPT_FRM_ASG_RSN#    /* 검토보고서식지정사유 */
             ,EXAM_RPT_FRM_EXAM_OPIN = #EXAM_RPT_FRM_EXAM_OPIN#  /* 검토보고서식검토의견 */			 
             ,FNL_MDF_DH             = SYSDATE                   /* 최종수정일시 */ 
             ,FNL_USR_ID             = #FNL_USR_ID#              /* 최종사용자ID */       
             ,FNL_DEAL_DPT_CD        = #FNL_DEAL_DPT_CD#         /* 최종거래부서코드 */
             ,FNL_MNU_ID             = #FNL_MNU_ID#              /* 최종메뉴ID */			 
        WHERE AUD_YR                 = #AUD_YR#                  /* 감사년도 */
		  AND AUD_NO                 = #AUD_NO#                  /* 감사번호 */
          AND DSP_RQ_SNO             = #DSP_RQ_SNO#              /* 처분요구순번 */
          AND RLTN_ORG_CD            = #RLTN_ORG_CD#             /* 관계기관코드 */
          AND MNG_SNO                = #MNG_SNO#                 /* 관리순번 */
	</update>		
	
	<!-- 특수관리기본 삭제 -->
	<update id="BADFRE013EMaindelete" parameterClass="paramMap">
          DELETE 
            FROM TBBADFRE011M                   /* 특수관리 기본 */ 
           WHERE AUD_YR      = #AUD_YR#         /* 감사년도 */
		     AND AUD_NO      = #AUD_NO#         /* 감사번호 */
             AND DSP_RQ_SNO  = #DSP_RQ_SNO#     /* 처분요구순번 */
             AND RLTN_ORG_CD = #RLTN_ORG_CD#    /* 관계기관코드 */
             AND MNG_SNO     = #MNG_SNO#        /* 관리순번 */
	</update>	
	
	<!-- 특수관리기본 해제 -->
	<update id="BADFRE013EMainRlsupdate" parameterClass="paramMap">
        UPDATE TBBADFRE011M                            /* 특수관리 기본 */ 
		  SET ASG_DT            = ''                   /* 지정일자 */ 
		     ,ASG_AM            = 0                    /* 지정금액 */ 
		     ,ASG_RSN           = ''                   /* 지정사유 */
		     ,RLS_DT            = #RLS_DT#             /* 해제일 */
             ,RLS_RSN           = #RLS_RSN#            /* 해제사유 */
             ,SPCN_MNG_STA_CD   = '3'                  /* 특수관리상태코드(3:해제접수) */
             ,FNL_MDF_DH        = SYSDATE              /* 최종수정일시 */ 
             ,FNL_USR_ID        = #FNL_USR_ID#         /* 최종사용자ID */       
             ,FNL_DEAL_DPT_CD   = #FNL_DEAL_DPT_CD#    /* 최종거래부서코드 */
             ,FNL_MNU_ID        = #FNL_MNU_ID#         /* 최종메뉴ID */			 
        WHERE AUD_YR            = #AUD_YR#             /* 감사년도 */
		  AND AUD_NO            = #AUD_NO#             /* 감사번호 */
          AND DSP_RQ_SNO        = #DSP_RQ_SNO#         /* 처분요구순번 */
          AND RLTN_ORG_CD       = #RLTN_ORG_CD#        /* 관계기관코드 */
          AND MNG_SNO           = #MNG_SNO#            /* 관리순번 */
	</update>		
	
	<!-- 특수관리기본의 max관리번호를 조회한다. -->
	<select id="BADFRE013EMaxMngNoselect" parameterClass="paramMap" resultClass="resultMap">
        SELECT NVL(MAX(MNG_NO),0) + 1 AS MNG_NO
          FROM TBBADFRE011M /* 특수관리기본 */
         WHERE MNG_YR = #MNG_YR#	
	</select>
	
	<!-- 특수관리기본의 max관리순번을 조회한다. -->
	<select id="BADFRE013EMaxMngSnoselect" parameterClass="paramMap" resultClass="resultMap">	
	    SELECT NVL(MAX(MNG_SNO),0) + 1 AS MNG_SNO
          FROM TBBADFRE011M
         WHERE AUD_YR      = #AUD_YR#
           AND AUD_NO      = #AUD_NO#
           AND DSP_RQ_SNO  = #DSP_RQ_SNO#
           AND RLTN_ORG_CD = #RLTN_ORG_CD#
	</select>
	
	<!-- 결재문서번호로 조회-->
	<select id="BADFRE013EKeyApvDocNoselect" parameterClass="paramMap" resultClass="resultMap">
	    SELECT                  
	           D1.AUD_YR          /* 감사년도 */   
	          ,D1.AUD_NO          /* 감사번호 */  
	          ,D1.DSP_RQ_SNO      /* 처분요구순번 */         
	          ,D1.RLTN_ORG_CD     /* 관계기관코드 */
	          ,D1.MNG_SNO         /* 관리순번 */      
	     FROM TBBADFRE011M  D1    /* 특수관리기본 */
	    WHERE D1.APV_DOC_NO = #APV_DOC_NO#
	</select>	
	
	<!-- 결재처리정보를 수정한다 -->
	<update id="BADFRE013EApvInfoupdate" parameterClass="paramMap">
           UPDATE TBBADFRE011M                                          /* 특수관리 기본 */ 
              SET APV_DOC_NO              = #APV_DOC_NO#                /* 결재문서번호 */
                 ,APV_STA_CD              = #APV_STA_CD#                /* 결재상태코드 */
                 
			<isNotNull property="APV_STA_DT">
                 ,APV_STA_DT              = #APV_STA_DT#                /* 결재상태일 */
            </isNotNull>     
			<isNull property="APV_STA_DT">
				 ,APV_STA_DT              = TO_CHAR(SYSDATE,'YYYYMMDD') /* 결재상태일 */
			</isNull>
			
				 ,EXAM_RPT_FRM_APV_DOC_NO = #APV_DOC_NO#                /* 검토보고서식결재문서번호 */
                 ,EXAM_RPT_FRM_APV_STA_CD = #APV_STA_CD#                /* 검토보고서식결재상태코드 */

			<isNotNull property="APV_STA_DT">
                 ,EXAM_RPT_FRM_APV_STA_DT = #APV_STA_DT#                /* 검토보고서식결재상태일 */
            </isNotNull>     
			<isNull property="APV_STA_DT">
				 ,EXAM_RPT_FRM_APV_STA_DT = TO_CHAR(SYSDATE,'YYYYMMDD') /* 검토보고서식결재상태일 */
			</isNull>

            WHERE AUD_YR       = #AUD_YR#         /* 감사년도 */ 
              AND AUD_NO       = #AUD_NO#         /* 감사번호 */
              AND DSP_RQ_SNO   = #DSP_RQ_SNO#     /* 처분요구순번 */
              AND RLTN_ORG_CD  = #RLTN_ORG_CD#    /* 관계기관코드 */
              AND MNG_SNO      = #MNG_SNO#        /* 관리순번 */ 
	</update>	
	
	<!-- 특수관리 집행내역 delete-->
	<update id="BADFRE013EHisdelete" parameterClass="paramMap">
          DELETE 
            FROM TBBADFRE011L
           WHERE AUD_YR      = #AUD_YR#       /* 감사년도 */
             AND AUD_NO      = #AUD_NO#       /* 감사번호 */
             AND DSP_RQ_SNO  = #DSP_RQ_SNO#   /* 처분요구순번 */
             AND RLTN_ORG_CD = #RLTN_ORG_CD#  /* 관계기관코드 */
             AND MNG_SNO     = #MNG_SNO#      /* 관리순번 */
	</update>
	
    <!-- 특수관리 집행내역 insert-->
	<insert id="BADFRE013EHisinsert" parameterClass="paramMap">
        INSERT INTO TBBADFRE011L
            (
                 AUD_YR               /* 감사년도          */
                ,AUD_NO               /* 감사번호          */
                ,DSP_RQ_SNO           /* 처분요구순번      */
                ,RLTN_ORG_CD          /* 관계기관코드      */
                ,MNG_SNO              /* 관리순번          */
                ,SLN                  /* 연번              */
                ,ENFM_DT              /* 집행일            */
                ,ENFM_AM              /* 집행금액          */
                ,ENFM_TXT             /* 집행내용          */
                ,DTM_YN               /* 확정여부          */
                ,FRT_USR_ID           /* 최초사용자ID      */
                ,FNL_USR_ID           /* 최종사용자ID      */
                ,FNL_DEAL_DPT_CD      /* 최종거래부서코드  */
                ,FNL_MNU_ID           /* 최종메뉴ID        */
                ,FRT_REGI_DH          /* 최초등록일시      */
                ,FNL_MDF_DH           /* 최종수정일시      */
            ) VALUES (
                 #AUD_YR#             /* 감사년도          */ 
                ,#AUD_NO#             /* 감사번호          */ 
                ,#DSP_RQ_SNO#         /* 처분요구순번      */ 
                ,#RLTN_ORG_CD#        /* 관계기관코드      */ 
                ,#MNG_SNO#            /* 관리순번          */ 
                ,#SLN#                /* 연번              */ 
                ,#ENFM_DT#            /* 집행일            */ 
                ,#ENFM_AM#            /* 집행금액          */ 
                ,#ENFM_TXT#           /* 집행내용          */ 
                ,#DTM_YN#             /* 확정여부          */ 
                ,#FRT_USR_ID#         /* 최초사용자ID      */ 
                ,#FNL_USR_ID#         /* 최종사용자ID      */ 
                ,#FNL_DEAL_DPT_CD#    /* 최종거래부서코드  */ 
                ,#FNL_MNU_ID#         /* 최종메뉴ID        */ 
                ,SYSDATE              /* 최초등록일시      */ 
                ,SYSDATE              /* 최종수정일시      */ 
            )
	</insert>
	
	<!-- 특수관리집행내역의 max연번을 조회한다. -->
	<select id="BADFRE013EMaxSlnselect" parameterClass="paramMap" resultClass="resultMap">	
        SELECT NVL(MAX(SLN),0) + 1 AS SLN
          FROM TBBADFRE011L
         WHERE AUD_YR      = #AUD_YR#
           AND AUD_NO      = #AUD_NO#
           AND DSP_RQ_SNO  = #DSP_RQ_SNO#
           AND RLTN_ORG_CD = #RLTN_ORG_CD#
           AND MNG_SNO     = #MNG_SNO#
	</select>	
	
	<!-- 특수관리집행내역변경이력 입력 -->
	<insert id="BADFRE013EEnfmChgHstinsert" parameterClass="paramMap">
            INSERT INTO TBBADFRE028H /* 특수관리집행내역변경이력 */
            (
                 CON_NO                  /* 연계번호          */     
                ,AUD_YR                  /* 감사년도          */
                ,AUD_NO                  /* 감사번호          */
                ,DSP_RQ_SNO              /* 처분요구순번      */
                ,RLTN_ORG_CD             /* 관계기관코드      */
                ,MNG_SNO                 /* 관리순번          */
                ,SLN                     /* 연번              */
                ,ENFM_DT                 /* 집행일            */
                ,ENFM_AM                 /* 집행금액          */
                ,ENFM_TXT                /* 집행내용          */
                ,DTM_YN                  /* 확정여부          */
                ,USE_YN                  /* 사용여부          */
                ,CON_RTRN_CD             /* 연계반환코드      */
                ,FRT_USR_ID              /* 최초사용자ID      */
                ,FNL_USR_ID              /* 최종사용자ID      */
                ,FNL_DEAL_DPT_CD         /* 최종거래부서코드  */
                ,FNL_MNU_ID              /* 최종메뉴ID        */
                ,FRT_REGI_DH             /* 최초등록일시      */
                ,FNL_MDF_DH              /* 최종수정일시      */
            ) 
            SELECT 
               (SELECT NVL(MAX(CON_NO),0) + 1                
                  FROM TBBADFRE028H)     /* CON_NO            */              
               ,AUD_YR                   /* AUD_YR            */
               ,AUD_NO                   /* AUD_NO            */
               ,DSP_RQ_SNO               /* DSP_RQ_SNO        */
               ,RLTN_ORG_CD              /* RLTN_ORG_CD       */
               ,MNG_SNO                  /* MNG_SNO           */
               ,SLN                      /* SLN               */
               ,ENFM_DT                  /* ENFM_DT           */
               ,ENFM_AM                  /* ENFM_AM           */
               ,ENFM_TXT                 /* ENFM_TXT          */
               ,DTM_YN                   /* DTM_YN            */
               ,'N' AS USE_YN            /* USE_YN            */
               ,''  AS CON_RTRN_CD       /* CON_RTRN_CD       */
               ,#FRT_USR_ID#             /* FRT_USR_ID        */
               ,#FNL_USR_ID#             /* FNL_USR_ID        */
               ,#FNL_DEAL_DPT_CD#        /* FNL_DEAL_DPT_CD   */
               ,#FNL_MNU_ID#             /* FNL_MNU_ID        */
               ,SYSDATE                  /* FRT_REGI_DH       */
               ,SYSDATE                  /* FNL_MDF_DH        */
            FROM TBBADFRE011L
           WHERE 1=1
             AND AUD_YR       = #AUD_YR#                
             AND AUD_NO       = #AUD_NO#                
             AND DSP_RQ_SNO   = #DSP_RQ_SNO#
             AND RLTN_ORG_CD  = #RLTN_ORG_CD#
             AND MNG_SNO      = #MNG_SNO#
             AND SLN          = #SLN#
	</insert>	

	<!-- 특수관리집행내역변경이력  delete-->
	<update id="BADFRE013EEnfmChgHstdelete" parameterClass="paramMap">
          DELETE 
            FROM TBBADFRE028H                 /* 특수관리집행내역변경이력 */
           WHERE AUD_YR      = #AUD_YR#       /* 감사년도 */
             AND AUD_NO      = #AUD_NO#       /* 감사번호 */
             AND DSP_RQ_SNO  = #DSP_RQ_SNO#   /* 처분요구순번 */
             AND RLTN_ORG_CD = #RLTN_ORG_CD#  /* 관계기관코드 */
             AND MNG_SNO     = #MNG_SNO#      /* 관리순번 */
	</update>
		
	
	<!-- (출력물)특수관리사항 목록조회-->
	<select id="BADFRE013EReportListselect" parameterClass="paramMap" resultClass="resultMap">
	      SELECT
	            <!-- 조회조건 -->
	             CASE WHEN #strAsgDvsn# = '1' THEN '기관에서 지정요청할 사항' 
	                  WHEN #strAsgDvsn# = '2' THEN '지정한 사항'
	                  WHEN #strAsgDvsn# = '3' THEN '해제한 사항' 
	                  ELSE                         '전체'
	              END                                            AS CND_ASG_DVSN      /* 지정구분 */
	            ,CASE WHEN #strDptCd# = '' THEN '전체' 
	                  ELSE F_DPT_INFO(#strDptCd#,'1')  
	              END                                            AS CND_SPV_BRDV_NM   /* 주관국과 */
	            ,#strSchTxt#                                     AS CND_SCH_TXT       /* 검색어 */
	      
                <!-- 목록 -->
                ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D3.AUD_KND_CD, '-') || '-' || D1.DSP_RQ_SNO      
                                                                 AS DSP_RQ_NO    /* 처분요구번호(관리번호) */	    
                ,F_ORG_INFO(D1.MNG_ORG_CD,'1') || '(' ||
                 D1.CPS_DRTR_NM || ')'                           AS ORG_DRTR_NM  /* 관리기관(책임자) */   	      
                ,D2.TIT_TXT                                      AS TIT_TXT      /* 제목내용 */
                ,F_DPT_INFO(D1.SPV_BRDV_CD,'1')                  AS SPV_BRDV_NM  /* 주관국과명 */                
                ,D1.ASG_AM                                       AS ASG_AM       /* 지정금액 */                
                ,D1.RQS_DT                                       AS RQS_DT       /* 요청일 */
                ,D1.ASG_DT                                       AS ASG_DT       /* 지정일 */                
                ,D1.RLS_DT                                       AS RLS_DT       /* 해제일 */                
                ,CASE WHEN D1.APV_STA_CD IS NULL THEN '미상신'
                      ELSE F_CODE_NM('1000603', D1.APV_STA_CD)
                  END                                            AS APV_STA_NM  /* 결재상태명               */                
                ,CASE WHEN NVL(D1.DTM_YN,'N')   != 'Y' 
                           AND D1.ASG_DT        IS NOT NULL                 
        	               AND D1.RLS_DT        IS NULL     THEN '지정X'
        	          WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
        	               AND D1.ASG_DT        IS NOT NULL                  
    	                   AND D1.RLS_DT        IS NULL     THEN '지정O'
    	              WHEN NVL(D1.DTM_YN,'N')  != 'Y'                 
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제X'
    	              WHEN NVL(D1.DTM_YN,'N')   = 'Y'                  
    	                   AND D1.RLS_DT        IS NOT NULL THEN '해제O'
    	             END                                         AS DVSN         /* 확정 */
           FROM TBBADFRE011M D1                   /* 특수관리기본 */
               ,TBBADEAR001M D2                   /* 처분요구사항기본 */
               ,TBBADDED001M D3
          WHERE 1=1
            AND D1.AUD_YR               = D2.AUD_YR    
        	AND D1.AUD_NO               = D2.AUD_NO     
        	AND D1.DSP_RQ_SNO           = D2.DSP_RQ_SNO    
            AND D1.AUD_YR               = D3.AUD_YR    
        	AND D1.AUD_NO               = D3.AUD_NO             	          
            AND D1.SLF_PRSS_STA_CD  &gt;= '71'
           	AND D1.SPV_BRDV_CD   IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
           	
            <!-- 주관국과코드 -->    
			<isNotEmpty property="strDptCd2">
                AND D1.SPV_BRDV_CD = #strDptCd2#
            </isNotEmpty> 
          
            
            <!-- 기관에서 지정요청할 사항 -->
            <isEqual property="strAsgDvsn" compareValue="1">
               AND D1.ASG_DT IS NULL
               AND D1.RLS_DT IS NULL 
	        </isEqual>     
            <!-- 지정한 사항 -->
            <isEqual property="strAsgDvsn" compareValue="2">
               AND D1.ASG_DT IS NOT NULL
               AND D1.RLS_DT IS NULL 
	        </isEqual>                 
            <!-- 해제한 사항 -->
            <isEqual property="strAsgDvsn" compareValue="3">
               AND D1.RLS_DT IS NOT NULL   
	        </isEqual>               
  
			<!-- 검색어 -->
            <isNotEmpty property="strSchTxt">
                AND ( (SELECT ORG_NM 
                         FROM TBDCMACM015M                                
        		        WHERE ORG_CD = D1.MNG_ORG_CD) LIKE  '%' || #strSchTxt# || '%'
        		     OR D1.CPS_DRTR_NM  LIKE  '%' || #strSchTxt# || '%'
        		     OR D2.TIT_TXT      LIKE  '%' || #strSchTxt# || '%'
        		    )
            </isNotEmpty>
           
            <!-- 결재확정  -->
            <isNotEqual property="strApvDtm" compareValue="0"> 
                AND NVL(D1.APV_STA_CD,'1') = #strApvDtm#
            </isNotEqual>
            
            <!-- 감사연번 -->
            <isNotEmpty property="strInqAudYr">
                AND D1.AUD_YR = #strInqAudYr#
            </isNotEmpty>
            <!-- 감사부여번호 추가 - 2016.06.02 yyh -->            
            <isNotEmpty property="strInqAudGrnNo">
                AND D3.AUD_GRN_NO = #strInqAudGrnNo#
            </isNotEmpty>      
			<isNotNull property="strAudYrNoKndCd">
				<isNotEmpty property="strAudYrNoKndCd">	 	
		              /* 감사연번종류코드 - 2015.12.24 yyh */
					  AND SUBSTR(D3.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
				</isNotEmpty>		
			</isNotNull>                     
            
        ORDER BY D1.AUD_YR DESC 
               , D1.AUD_NO DESC
               , D1.DSP_RQ_SNO DESC
               , D1.RLTN_ORG_CD DESC
               , D1.MNG_SNO DESC                   
            
	</select>
	
	<!-- 특수관리기본변경이력 입력 -->
	<insert id="BADFRE013EChgHstinsert" parameterClass="paramMap">
            INSERT INTO TBBADFRE027H           /* 특수관리기본변경이력           */
            (
                     CON_NO                    /* 연계번호                       */
                    ,AUD_YR                    /* 감사년도                       */
                    ,AUD_NO                    /* 감사번호                       */
                    ,DSP_RQ_SNO                /* 처분요구순번                   */
                    ,RLTN_ORG_CD               /* 관계기관코드                   */
                    ,MNG_SNO                   /* 관리순번                       */
                    ,SPV_BRDV_CD               /* 주관국과코드                   */
                    ,DTM_YN                    /* 확정여부                       */
                    ,MNG_ORG_CD                /* 관리기관코드                   */
                    ,ASG_DT                    /* 지정일                         */
                    ,ASG_AM                    /* 지정금액                       */
                    ,CPS_DRTR_NM               /* 변상책임자명                   */
                    ,CPS_DRTR_AD               /* 변상책임자주소                 */
                    ,RLS_DT                    /* 해제일                         */
                    ,RLS_RSN                   /* 해제사유                       */
                    ,RQR_ID                    /* 요청자ID                       */
                    ,RQS_DT                    /* 요청일                         */
                    ,RQS_RSN                   /* 요청사유                       */
                    ,APV_DOC_NO                /* 결재문서번호                   */
                    ,APV_STA_CD                /* 결재상태코드                   */
                    ,APV_STA_DT                /* 결재상태일                     */
                    ,MNG_YR                    /* 관리년도                       */
                    ,MNG_NO                    /* 관리번호                       */
                    ,SLF_PRSS_STA_CD           /* 자체진행상태코드               */
                    ,SLF_APV_DT                /* 자체결재일                     */
                    ,SLF_SEN_DT                /* 자체발송일                     */
                    ,SPCN_MNG_STA_CD           /* 특수관리상태코드               */
                    ,ASG_RSN                   /* 지정사유                       */
                    ,EXAM_RPT_FRM_ENFM_HIS     /* 검토보고서식집행내역           */
                    ,EXAM_RPT_FRM_ASG_RSN      /* 검토보고서식지정사유           */
                    ,EXAM_RPT_FRM_EXAM_OPIN    /* 검토보고서식검토의견           */
                    ,EXAM_RPT_FRM_APV_STA_CD   /* 검토보고서식결재상태코드       */
                    ,EXAM_RPT_FRM_APV_STA_DT   /* 검토보고서식결재상태일         */
                    ,EXAM_RPT_FRM_APV_DOC_NO   /* 검토보고서식결재문서번호       */
                    ,DOC_ID                    /* 문서ID                         */
                    ,DOC_TYP_CD                /* 문서유형코드                   */
                    ,USE_YN                    /* 사용여부                       */
                    ,CON_RTRN_CD               /* 연계반환코드                   */
                    ,FRT_USR_ID                /* 최초사용자ID                   */
                    ,FNL_USR_ID                /* 최종사용자ID                   */
                    ,FNL_DEAL_DPT_CD           /* 최종거래부서코드               */
                    ,FNL_MNU_ID                /* 최종메뉴ID                     */
                    ,FRT_REGI_DH               /* 최초등록일시                   */
                    ,FNL_MDF_DH                /* 최종수정일시                   */
            ) 
              SELECT                     
                     (SELECT NVL(MAX(CON_NO),0) + 1
                        FROM TBBADFRE027H)                                 
                    ,AUD_YR           
                    ,AUD_NO             
                    ,DSP_RQ_SNO       
                    ,RLTN_ORG_CD       
                    ,MNG_SNO           
                    ,SPV_BRDV_CD            
                    ,DTM_YN                 
                    ,MNG_ORG_CD             
                    ,ASG_DT                 
                    ,ASG_AM                 
                    ,CPS_DRTR_NM            
                    ,CPS_DRTR_AD            
                    ,RLS_DT                 
                    ,RLS_RSN                
                    ,RQR_ID                 
                    ,RQS_DT                 
                    ,RQS_RSN                
                    ,APV_DOC_NO             
                    ,APV_STA_CD             
                    ,APV_STA_DT             
                    ,MNG_YR                 
                    ,MNG_NO                 
                    ,SLF_PRSS_STA_CD        
                    ,SLF_APV_DT             
                    ,SLF_SEN_DT             
                    ,SPCN_MNG_STA_CD        
                    ,ASG_RSN                
                    ,EXAM_RPT_FRM_ENFM_HIS  
                    ,EXAM_RPT_FRM_ASG_RSN   
                    ,EXAM_RPT_FRM_EXAM_OPIN 
                    ,EXAM_RPT_FRM_APV_STA_CD
                    ,EXAM_RPT_FRM_APV_STA_DT
                    ,EXAM_RPT_FRM_APV_DOC_NO
                    ,DOC_ID                 
                    ,DOC_TYP_CD             
                    ,'N'           AS USE_YN            
                    ,''            AS CON_RTRN_CD  
                    ,#FRT_USR_ID#       
                    ,#FNL_USR_ID#       
                    ,#FNL_DEAL_DPT_CD#  
                    ,#FNL_MNU_ID#       
                    ,SYSDATE            
                    ,SYSDATE            
                FROM TBBADFRE011M     /* 특수관리기본 */
               WHERE 1=1
                 AND AUD_YR         = #AUD_YR#
                 AND AUD_NO         = #AUD_NO#
                 AND DSP_RQ_SNO     = #DSP_RQ_SNO# 
                 AND RLTN_ORG_CD    = #RLTN_ORG_CD#
                 AND MNG_SNO        = #MNG_SNO#
	</insert>	

	<!-- 처분요구사항상세 수정 -->
	<update id="BADFRE013EDspRqSbjDtlupdate" parameterClass="paramMap">
        UPDATE TBBADEAR002D                                       /* 처분요구사항 상세 */ 
		  SET FNL_MDF_DH           = SYSDATE                      /* 최종수정일시 */ 
             ,FNL_USR_ID           = #FNL_USR_ID#                 /* 최종사용자ID */       
             ,FNL_DEAL_DPT_CD      = #FNL_DEAL_DPT_CD#            /* 최종거래부서코드 */
             ,FNL_MNU_ID           = #FNL_MNU_ID#                 /* 최종메뉴ID */
             ,APV_DOC_NO           = #APV_DOC_NO#                 /* 결재문서번호 */             
             ,CPLT_DT              = TO_CHAR(SYSDATE,'YYYYMMDD')  /* 완결일 */
             ,CPLT_PEN_ID          = #CPLT_PEN_ID#                /* 완결자ID */
		     ,ENFM_CPLT_IPT_DT     = TO_CHAR(SYSDATE,'YYYYMMDD')
		     ,ENFM_CPLT_IPT_PEN_ID = #CPLT_PEN_ID#             
             ,ENFM_WHLS_APV_KND_CD = #ENFM_WHLS_APV_KND_CD#       /* 집행전말결재종류코드 */
             ,DTM_STA_CD           = #DTM_STA_CD#
             ,DSP_RQ_APV_STA_CD    = #DSP_RQ_APV_STA_CD#  
             ,DTM_YN               = 'Y'           
        WHERE AUD_YR               = #AUD_YR#                     /* 감사년도 */
		  AND AUD_NO               = #AUD_NO#                     /* 감사번호 */
          AND DSP_RQ_SNO           = #DSP_RQ_SNO#                 /* 처분요구순번 */
	</update>		
</sqlMap> 
