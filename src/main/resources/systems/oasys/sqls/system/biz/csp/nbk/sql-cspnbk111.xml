<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="csp/nbk/111">
	
	<select id="CSPNBK111ECshAcctCdListSelect" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT	/* CSPNBK111ECshAcctCdListSelect */
				D1.CSH_ACCT_CD
				, D1.MOUI_NO
				, D2.CNB
				, D3.USR_NAM
				, D1.USE_YN
				, D1.RMK
		FROM	TBCSPNBK002M D1
				, TBCSPNBK001M D2
				, TBDCMACM001M D3
		WHERE	D1.MOUI_NO = D2.MOUI_NO
		AND		D2.CNB = D3.CNB
	]]>
		<isNotEmpty property="mouiNo" prepend="AND">
				D2.MOUI_NO = #mouiNo#
		</isNotEmpty>
		<isNotEmpty property="cnb" prepend="AND">
				D2.CNB = #cnb#
		</isNotEmpty>
		<isNotEmpty property="mouiNm" prepend="AND">
				D3.USR_NAM LIKE '%' || #mouiNm# || '%'
		</isNotEmpty>
		<isNotEmpty property="scsYn" prepend="AND">
				D2.SCS_YN = #scsYn#
		</isNotEmpty>
	<![CDATA[
		ORDER BY CSH_ACCT_CD
	]]>
	</select>
	
	<insert id="CSPNBK111ECshAcctCdInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* CSPNBK111ECshAcctCdInsert */ TBCSPNBK002M
		(
			CSH_ACCT_CD
			, MOUI_NO
			, USE_YN
			, RMK
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		VALUES
		(
			#CSH_ACCT_CD#
			, #MOUI_NO#
			, #USE_YN#
			, #RMK#
			, #FRT_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
		)
	]]>
	</insert>
	
	<update id="CSPNBK111ECshAcctCdUpdate" parameterClass="paramMap">
	<![CDATA[
		UPDATE	/* CSPNBK111ECshAcctCdUpdate */ TBCSPNBK002M D1
		SET		MOUI_NO = #MOUI_NO#
				, USE_YN = #USE_YN#
				, RMK = #RMK#
				, FNL_USR_ID = #FNL_USR_ID#
				, FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
				, FNL_MNU_ID = #FNL_MNU_ID#
				, FNL_MDF_DH = SYSDATE
		WHERE	D1.CSH_ACCT_CD = #CSH_ACCT_CD#
	]]>
	</update>
	
	<delete id="CSPNBK111ECshAcctCdDelete" parameterClass="paramMap">
	<![CDATA[
		DELETE	/* CSPNBK111ECshAcctCdDelete */
		FROM	TBCSPNBK002M
		WHERE	CSH_ACCT_CD = #CSH_ACCT_CD#
	]]>
	</delete>
	
	<select id="CSPNBK111EMouiNoCheckSelect" parameterClass="paramMap" resultClass="int">
	<![CDATA[
		SELECT	/* CSPNBK111EMouiNoCheckSelect */
				COUNT(D1.CSH_ACCT_CD) AS CNT
		FROM	TBCSPNBK002M D1
		WHERE	D1.MOUI_NO = #MOUI_NO#
	]]>
		<isNotEmpty property="CSH_ACCT_CD" prepend="AND">
				D1.CSH_ACCT_CD != #CSH_ACCT_CD#
		</isNotEmpty>
	</select>
	
	<select id="CSPNBK111ECshAcctCdCheckSelect" parameterClass="paramMap" resultClass="int">
	<![CDATA[
		SELECT	/* CSPNBK111ECshAcctCdCheckSelect */
				COUNT(D1.CSH_ACCT_CD) AS CNT
		FROM	TBCSPNBK002M D1
		WHERE	D1.CSH_ACCT_CD = #CSH_ACCT_CD#
	]]>
	</select>
	
	<select id="CSPNBK111ECshAcctCdDeleteCheckSelect" parameterClass="paramMap" resultClass="int">
	<![CDATA[
		SELECT	/* CSPNBK111ECshAcctCdCheckSelect */
				SUM(CNT) AS CNT
		FROM	(
					SELECT	COUNT(MOUI_NO) AS CNT
					FROM	TBCSPNBK101M D1
					WHERE	D1.INV_OAA_OPT_MOUI_NO = #MOUI_NO#
					
					UNION ALL
					
					SELECT	COUNT(MOUI_NO) AS CNT
					FROM	TBCSPNBK202M D1
					WHERE	D1.LEND_OAA_OPT_MOUI_NO = #MOUI_NO#
				)
	]]>
	</select>
	
	<select id="CSPNBK111ECshAcctCdComboListSelect" parameterClass="paramMap" resultClass="resultMap">
	<![CDATA[
		SELECT	/* CSPNBK111ECshAcctCdComboListSelect */
				MNST_CLU_CD || TAX_SITM_CD AS CSH_ACCT_CD
				, ACCT_NM
				, NVL2( D2.CSH_ACCT_CD, 'Y', 'N' ) AS EXIST_YN
		FROM	TBCSPNBK501M D1
				, TBCSPNBK002M D2
		WHERE	D1.MNST_CLU_CD || D1.TAX_SITM_CD = D2.CSH_ACCT_CD(+)
		AND		D1.MNST_CLU_CD = '110102'
		AND		D1.SMB_YN = 'Y'
		ORDER BY CSH_ACCT_CD
	]]>
	</select>
</sqlMap>