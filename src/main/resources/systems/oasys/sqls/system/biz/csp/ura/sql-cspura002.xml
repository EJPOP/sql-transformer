<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/ura/002">

	<select id="CSPURA006EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT    C.EXTL_EPRT_REGI_YE
			        , C.EXTL_EPRT_REGI_SLN
			        , C.EXTL_EPRT_DVSN_NM
			        ,D1.EXTL_EPRT_NAM
					,D1.DPT_NM
			        ,D1.PST_NM
			        ,D1.MAJ_SPH_NM
			        ,D1.COM_TNB
			        ,D1.HOM_TNB
			        ,D1.HPN
			        ,D1.FAN
			        ,D1.EML_AD
			        ,D1.ZCD AS ZCD
			        ,D1.ROAD_NM_AD
			        ,D1.AD
			        ,D1.ROAD_NM_DTL_AD
			        ,D1.DTL_AD
			        ,D1.REGN_CNB
			        ,D1.USE_YN
			        ,D1.EXTL_EPRT_RMK
			        ,TO_CHAR(D1.FRT_REGI_DH,'YYYYMMDD') AS FRT_REGI_DH
			        ,C.EXTL_EPRT_DVSN_CD
			FROM    (
			            SELECT  EXTL_EPRT_REGI_YE,
			                    EXTL_EPRT_REGI_SLN,
			                    AGGR_CONCAT( B.CD_NM, '/') AS EXTL_EPRT_DVSN_NM,
			                    AGGR_CONCAT( A.EXTL_EPRT_DVSN_CD, '/') AS EXTL_EPRT_DVSN_CD
			            FROM     TBCSPURA004D A
			                    , TBDCMACM013C B
			            WHERE    A.EXTL_EPRT_DVSN_CD = B.CD
			            AND        B.CMM_CD_DVSN_CD = '1000265'
		]]>	
			<dynamic>
				<isNotEmpty property="strEXTL_EPRT_REGI_YE">
				  AND A.EXTL_EPRT_REGI_YE = #strEXTL_EPRT_REGI_YE#
				</isNotEmpty>
				<isNotEmpty property="EXTL_EPRT_DVSN_CD">
					AND (A.EXTL_EPRT_REGI_YE, A.EXTL_EPRT_REGI_SLN) IN (SELECT 	EXTL_EPRT_REGI_YE, EXTL_EPRT_REGI_SLN
																		FROM	TBCSPURA004D Z 
																		WHERE	Z.EXTL_EPRT_DVSN_CD = #EXTL_EPRT_DVSN_CD#) 
				</isNotEmpty>
			</dynamic>
		<![CDATA[
			            GROUP BY EXTL_EPRT_REGI_YE,
			                    EXTL_EPRT_REGI_SLN
			        ) C,
			        TBCSPURA003M D1
			WHERE 1=1
			AND	C.EXTL_EPRT_REGI_YE = D1.EXTL_EPRT_REGI_YE
			AND C.EXTL_EPRT_REGI_SLN = D1.EXTL_EPRT_REGI_SLN 
		]]>	
			<dynamic>
				<isNotEmpty property="EXTL_EPRT_NAM">
					AND D1.EXTL_EPRT_NAM like '%'||#EXTL_EPRT_NAM#||'%'
				</isNotEmpty>				
				<isNotEmpty property="EXTL_EPRT_RMK">
					AND D1.EXTL_EPRT_RMK LIKE '%'||#EXTL_EPRT_RMK#||'%'
				</isNotEmpty>
				<isNotEmpty property="strEXTL_EPRT_REGI_YE">
				  AND D1.EXTL_EPRT_REGI_YE = #strEXTL_EPRT_REGI_YE#
				</isNotEmpty>
				<isNotEmpty property="DPT_NM">
					AND D1.DPT_NM LIKE '%'||#DPT_NM#||'%'
				</isNotEmpty>
			</dynamic>
		<![CDATA[
			ORDER BY C.EXTL_EPRT_REGI_YE DESC, TO_NUMBER(C.EXTL_EPRT_REGI_SLN) DESC
		]]>
	</select>
	
	<select id="CSPURA006ESubSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT  B.EXTL_EPRT_DVSN_CD,
						B.EXTL_EPRT_REGI_YE,
						B.EXTL_EPRT_REGI_SLN,
						B.EXTL_EPRT_DVSN_SNO
				  FROM  TBCSPURA003M A,
				        TBCSPURA004D B
				 WHERE 1=1
				   AND  A.EXTL_EPRT_REGI_YE  = B.EXTL_EPRT_REGI_YE
				   AND	A.EXTL_EPRT_REGI_SLN = B.EXTL_EPRT_REGI_SLN
				   AND  A.EXTL_EPRT_REGI_YE  = #EXTL_EPRT_REGI_YE#
				   AND	A.EXTL_EPRT_REGI_SLN = #EXTL_EPRT_REGI_SLN#
				 ORDER BY B.EXTL_EPRT_REGI_YE DESC, TO_NUMBER(B.EXTL_EPRT_REGI_SLN) DESC, EXTL_EPRT_DVSN_CD DESC
		]]>
	</select>
	
	<!--  삭제시 디테일 조회 -->
	<select id="CSPURA006EsubCntselect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT COUNT(EXTL_EPRT_REGI_YE) as CNT 
				  FROM TBCSPURA004D 
				 WHERE EXTL_EPRT_REGI_YE = #EXTL_EPRT_REGI_YE# 
				   AND EXTL_EPRT_REGI_SLN = #EXTL_EPRT_REGI_SLN#
		]]>
	</select>
	
	<!--  외부전문가 관리 마스터 인서트(신규 시) -->
	<insert id="CSPURA006EMasterInsert" parameterClass="paramMap">
        <![CDATA[       
				INSERT INTO TBCSPURA003M 
				(
					EXTL_EPRT_REGI_YE,
					EXTL_EPRT_REGI_SLN,
					EXTL_EPRT_NAM,
					DPT_NM,
					PST_NM,
					MAJ_SPH_NM,
					COM_TNB,
					HOM_TNB,
					HPN,
					FAN,
					EML_AD,
					ZCD,
					ROAD_NM_AD,
					AD,
					ROAD_NM_DTL_AD,
					DTL_AD,
					REGN_CNB,
					USE_YN,
					EXTL_EPRT_RMK,
					FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
				)
				VALUES
					(
					#EXTL_EPRT_REGI_YE#,
					#EXTL_EPRT_REGI_SLN#,
					#EXTL_EPRT_NAM#,
					#DPT_NM#,
					#PST_NM#,
					#MAJ_SPH_NM#,
					#COM_TNB#,
					#HOM_TNB#,
					#HPN#,
					#FAN#,
					#EML_AD#,
					#ZCD#,
					#ROAD_NM_AD#,
					#AD#,
					#ROAD_NM_DTL_AD#,
					#DTL_AD#,
					#REGN_CNB#,
					'Y',
					#EXTL_EPRT_RMK#,
					#FRT_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE
				)
        ]]>
	</insert>
	
	<!--  외부전문가 관리 디테일 인서트(신규 시) -->	
	<insert id="CSPURA006EDetailInsert" parameterClass="paramMap">
        <![CDATA[       
		INSERT INTO TBCSPURA004D
				(
					EXTL_EPRT_REGI_YE,
					EXTL_EPRT_REGI_SLN,
					EXTL_EPRT_DVSN_SNO,
					EXTL_EPRT_DVSN_CD,
					FRT_USR_ID,
					FNL_USR_ID,
					FNL_DEAL_DPT_CD,
					FNL_MNU_ID,
					FRT_REGI_DH,
					FNL_MDF_DH
				)
				VALUES
				(
					#EXTL_EPRT_REGI_YE#,
					#EXTL_EPRT_REGI_SLN#,
				    (SELECT NVL(MAX(TO_NUMBER(EXTL_EPRT_DVSN_SNO)+1), 1) 
	        		   FROM TBCSPURA004D
					  WHERE EXTL_EPRT_REGI_YE = #EXTL_EPRT_REGI_YE#
						AND	EXTL_EPRT_REGI_SLN = #EXTL_EPRT_REGI_SLN#),   /*순번 */
					#EXTL_EPRT_DVSN_CD2#,
					#FNL_USR_ID#,
					#FNL_USR_ID#,
					#FNL_DEAL_DPT_CD#,
					#FNL_MNU_ID#,
					SYSDATE,
					SYSDATE
				)
        ]]>
	</insert>
	
	<!--  마스터 삭제  -->
	<delete id="CSPURA006EDelete" parameterClass="paramMap">
			DELETE FROM TBCSPURA003M
			 WHERE EXTL_EPRT_REGI_YE = #EXTL_EPRT_REGI_YE#
			   AND EXTL_EPRT_REGI_SLN = #EXTL_EPRT_REGI_SLN#
	</delete>
	
	<!--  마스터 삭제  -->
	<delete id="CSPURA006EDetailAllDelete" parameterClass="paramMap">
			DELETE FROM TBCSPURA004D
			 WHERE EXTL_EPRT_REGI_YE = #EXTL_EPRT_REGI_YE#
			   AND EXTL_EPRT_REGI_SLN = #EXTL_EPRT_REGI_SLN#
	</delete>
	
	<!--  디테일 삭제  -->
	<delete id="CSPURA006EDetailDelete" parameterClass="paramMap">
			DELETE FROM TBCSPURA004D
			 WHERE EXTL_EPRT_REGI_YE = #EXTL_EPRT_REGI_YE#
			   AND EXTL_EPRT_REGI_SLN = #EXTL_EPRT_REGI_SLN#
			   AND EXTL_EPRT_DVSN_SNO = #EXTL_EPRT_DVSN_SNO#
	</delete>
	
	
	<!-- 마스터 업데이트 -->
	<update id="CSPURA006EUpdate" parameterClass="paramMap">
			UPDATE TBCSPURA003M
			SET FNL_MDF_DH = SYSDATE
			<isNotNull prepend="," property="EXTL_EPRT_NAM">
				EXTL_EPRT_NAM = #EXTL_EPRT_NAM#
			</isNotNull>
			<isNotNull prepend="," property="DPT_NM">
				DPT_NM = #DPT_NM# 
			</isNotNull>
			<isNotNull prepend="," property="PST_NM">
				PST_NM = #PST_NM#
			</isNotNull>
			<isNotNull prepend="," property="MAJ_SPH_NM">
				MAJ_SPH_NM = #MAJ_SPH_NM#
			</isNotNull>
			<isNotNull prepend="," property="COM_TNB">
				COM_TNB = #COM_TNB# 
			</isNotNull>
			<isNotNull prepend="," property="HOM_TNB">
				HOM_TNB = #HOM_TNB# 
			</isNotNull>
			<isNotNull prepend="," property="HPN">
				HPN = #HPN# 
			</isNotNull>
			<isNotNull prepend="," property="FAN">
				FAN = #FAN# 
			</isNotNull>
			<isNotNull prepend="," property="EML_AD">
				EML_AD = #EML_AD#
			</isNotNull>
			<isNotNull prepend="," property="ZCD">
				ZCD = #ZCD#
			</isNotNull>
			<isNotNull prepend="," property="ROAD_NM_AD">
				ROAD_NM_AD = #ROAD_NM_AD#
			</isNotNull>
			<isNotNull prepend="," property="ROAD_NM_DTL_AD">
				ROAD_NM_DTL_AD = #ROAD_NM_DTL_AD# 
			</isNotNull>
			<isNotNull prepend="," property="AD">
				AD = #AD# 
			</isNotNull>
			<isNotNull prepend="," property="DTL_AD">
				DTL_AD = #DTL_AD# 
			</isNotNull>			
			<isNotNull prepend="," property="EXTL_EPRT_RMK">
				EXTL_EPRT_RMK = #EXTL_EPRT_RMK# 
			</isNotNull>
			<isNotNull prepend="," property="FNL_USR_ID">
				FNL_USR_ID = #FNL_USR_ID#
			</isNotNull>
			<isNotNull prepend="," property="FNL_DEAL_DPT_CD">
				FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			</isNotNull>
			<isNotNull prepend="," property="FNL_MNU_ID">
				FNL_MNU_ID =#FNL_MNU_ID#
			</isNotNull>
			WHERE EXTL_EPRT_REGI_YE = #EXTL_EPRT_REGI_YE#
			  AND EXTL_EPRT_REGI_SLN = #EXTL_EPRT_REGI_SLN#
	</update>
	
	<!-- 디테일 업데이트 -->
	<update id="CSPURA006EDetailUpdate" parameterClass="paramMap">
			UPDATE TBCSPURA004D
			SET FNL_MDF_DH = SYSDATE
			<isNotNull prepend="," property="EXTL_EPRT_DVSN_CD">
				EXTL_EPRT_DVSN_CD = #EXTL_EPRT_DVSN_CD#
			</isNotNull>
			<isNotNull prepend="," property="FNL_USR_ID">
				FNL_USR_ID = #FNL_USR_ID#
			</isNotNull>
			<isNotNull prepend="," property="FNL_DEAL_DPT_CD">
				FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
			</isNotNull>
			<isNotNull prepend="," property="FNL_MNU_ID">
				FNL_MNU_ID =#FNL_MNU_ID#
			</isNotNull>
			WHERE EXTL_EPRT_REGI_YE = #EXTL_EPRT_REGI_YE#
			  AND EXTL_EPRT_REGI_SLN = #EXTL_EPRT_REGI_SLN#
			  AND EXTL_EPRT_DVSN_SNO = #EXTL_EPRT_DVSN_SNO#
	</update>
	
	<select id="CSPURA006EKeySelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT
				(SELECT TO_CHAR(SYSDATE, 'YYYY') FROM DUAL) AS YYYY, 			/* 연도 */
				(SELECT TO_CHAR(NVL(MAX(TO_NUMBER(EXTL_EPRT_REGI_SLN)+1), 1) ) 	/* 연번 */
				   FROM TBCSPURA003M   									
				 WHERE EXTL_EPRT_REGI_YE = TO_CHAR(SYSDATE, 'YYYY') ) AS SLN 
			 FROM DUAL
		]]>
	</select>
	
	<select id="CSPURA007EMainExtlSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT 	EXTL_EPRT_NAM,
						DPT_NM,
						PST_NM,
						MAJ_SPH_NM
				  FROM  TBCSPURA003M
				 WHERE EXTL_EPRT_NAM LIKE '%'||#NAM#||'%'
		]]>
	</select>
	
	<select id="CSPURA007EMainCslSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT 	CSL_CMTR_NAM AS EXTL_EPRT_NAM,
						DPT_NM,
						PST_NM,
						MAJ_SPH_NM
				  FROM  TBCSPURA005M
				 WHERE CSL_CMTR_NAM LIKE '%'||#NAM#||'%'
		]]>
	</select>
	
</sqlMap> 
