<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/hin/001">
	
	<select id="CSPHIN001EMainSelect" parameterClass="paramMap" 	resultClass="resultMap">
        <![CDATA[
			SELECT	/*+ INDEX(B KBDCMDCMACM001001) */F_DPT_INFO(B.DPT_CD, '1') AS DPT_NM,		
					A.TRN_PEN_CNB,	
					B.USR_NAM AS USR_NAME,	
					F_CODE_NM('1000173', B.RANK_CD) AS RANK_NM, /* 현직급 */	
					A.TRN_STR_DT,	
					A.TRN_END_DT,	
					TO_CHAR(TO_DATE(A.TRN_STR_DT), 'YYYY-MM-DD') || ' ~ ' ||	
					TO_CHAR(TO_DATE(A.TRN_END_DT), 'YYYY-MM-DD') || '  (' ||	
					CASE WHEN TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD') < 60 THEN TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD') ||'일)'	
					ELSE CEIL(MONTHS_BETWEEN(TO_DATE(A.TRN_END_DT, 'YYYYMMDD'), TO_DATE(A.TRN_STR_DT, 'YYYYMMDD')  ))  || '개월)'  END AS  TRN_MONTH,	
					A.GEN_MNG_TRN_DVSN_CD,  /* 훈련구분 */	
					A.TRN_BR_CD_1,	
					A.TRN_BR_CD_2,	
					A.TRN_BR_CD_3,	
					F_CODE_NM('1000181', A.TRN_BR_CD_1) || 	
					DECODE(A.TRN_BR_CD_2, NULL, '', ', ') || 	
					F_CODE_NM('1000181', A.TRN_BR_CD_2) ||	
					DECODE(A.TRN_BR_CD_3, NULL, '', ', ') || 	
					F_CODE_NM('1000181', A.TRN_BR_CD_3) || 	
					DECODE(A.TRN_ORG_NM, NULL, '', '/') || 	
					A.TRN_ORG_NM AS TRN_BR_ORG,	
					A.TRN_ORG_NM,	
					A.TRN_TASK_TXT,	
					A.TRN_TXT,	
					A.THN_RANK_CD,	
					A.SPT_TNB,	
					A.SPT_EML_AD,	
					A.SPT_AD,
					TO_CHAR(A.FRT_REGI_DH, 'YYYY-MM-DD') AS REDI_DH
			  FROM	TBCSPHIN001M A,		
			  		TBDCMACM001M B,
			  		TBCSPHIN002M C
			 WHERE	1=1
			   AND 	A.TRN_PEN_CNB = B.CNB
			   AND  A.TRN_PEN_CNB = C.TRN_PEN_CNB
			   AND  A.TRN_STR_DT  = C.TRN_STR_DT
		]]>
			<isNotEmpty property="stdDt">
				AND	#stdDt# BETWEEN A.TRN_STR_DT AND A.TRN_END_DT
			</isNotEmpty>
			
			<isNotEmpty property="strDt">
				<isEqual property="strDtDvsn" compareValue="be">
					AND	A.TRN_STR_DT &lt;= #strDt#
				</isEqual>
				<isEqual property="strDtDvsn" compareValue="af">
					AND	A.TRN_STR_DT &gt;= #strDt#
				</isEqual>
			</isNotEmpty>
			
			<isNotEmpty property="endDt">
				<isEqual property="endDtDvsn" compareValue="be">
					AND	A.TRN_END_DT &lt;= #endDt#
				</isEqual>
				<isEqual property="endDtDvsn" compareValue="af">
					AND	A.TRN_END_DT &gt;= #endDt#
				</isEqual>
			</isNotEmpty>
			
			<isNotEmpty property="trnDvsnCd">
			   AND 	A.GEN_MNG_TRN_DVSN_CD = #trnDvsnCd#		/*	훈련구분	*/
			</isNotEmpty>
			<isNotEmpty property="fromYmd">
			   AND	A.TRN_STR_DT &gt;= #fromYmd#
			</isNotEmpty>
			<isNotEmpty property="toYmd">
			   AND	A.TRN_END_DT &lt;= #toYmd#
			</isNotEmpty>
			<isNotEmpty property="fromTrnDay">
			   AND 	#fromTrnDay# &lt; TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD')	/*	훈련일수FROM	  */
			</isNotEmpty>
			<isNotEmpty property="toTrnDay">
			   AND 	#toTrnDay# &gt; TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD')	/*	훈련일수TO	  */
			</isNotEmpty>
			<isNotEmpty property="searchBox">
			   AND  (A.TRN_TXT LIKE '%' || #searchBox# || '%' OR  F_CODE_NM('1000181', A.TRN_BR_CD_1) LIKE '%' || #searchBox# || '%' OR  
			         F_CODE_NM('1000181', A.TRN_BR_CD_2) LIKE '%' || #searchBox# || '%' OR  F_CODE_NM('1000181', A.TRN_BR_CD_3) LIKE '%' || #searchBox# || '%' OR 
			         B.USR_NAM LIKE '%' || #searchBox# || '%')
			</isNotEmpty>
		<![CDATA[
				ORDER BY A.TRN_END_DT DESC
        ]]>
	</select>   
	
	<insert id="CSPHIN001EInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPHIN001M
			(
				TRN_PEN_CNB,
				TRN_STR_DT,
				TRN_END_DT,
				GEN_MNG_TRN_DVSN_CD,
				TRN_BR_CD_1,
				TRN_BR_CD_2,
				TRN_BR_CD_3,
				TRN_ORG_NM,
				TRN_TASK_TXT,
				TRN_TXT,
				THN_RANK_CD,
				SPT_TNB,
				SPT_EML_AD,
				SPT_AD,
				FRT_USR_ID,
				FNL_USR_ID,
				FNL_DEAL_DPT_CD,
				FNL_MNU_ID,
				FRT_REGI_DH,
				FNL_MDF_DH
			)
			VALUES
			(
				#TRN_PEN_CNB#,
				#TRN_STR_DT#,
				#TRN_END_DT#,
				#GEN_MNG_TRN_DVSN_CD#,
				#TRN_BR_CD_1#,
				#TRN_BR_CD_2#,
				#TRN_BR_CD_3#,
				#TRN_ORG_NM#,
				#TRN_TASK_TXT#,
				#TRN_TXT#,
				#THN_RANK_CD#,
				#SPT_TNB#,
				#SPT_EML_AD#,
				#SPT_AD#,
				#FRT_USR_ID#,
				#FNL_USR_ID#,
				#FNL_DEAL_DPT_CD#,
				#FNL_MNU_ID#,
				SYSDATE,
				SYSDATE
			)
		]]>
	</insert>
	
	<insert id="CSPHIN003QInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPHIN002M
			(
				TRN_PEN_CNB,
				TRN_STR_DT,
				FRT_USR_ID,
				FNL_USR_ID,
				FNL_DEAL_DPT_CD,
				FNL_MNU_ID,
				FRT_REGI_DH,
				FNL_MDF_DH
			)
			VALUES
			(
				#TRN_PEN_CNB#,
				#TRN_STR_DT#,
				#FRT_USR_ID#,
				#FNL_USR_ID#,
				#FNL_DEAL_DPT_CD#,
				#FNL_MNU_ID#,
				SYSDATE,
				SYSDATE
			)
		]]>
	</insert>
	
	<update id="CSPHIN001EUpdate" parameterClass="paramMap" >
		<![CDATA[
			UPDATE TBCSPHIN001M
			SET TRN_END_DT          =   #TRN_END_DT#,
				GEN_MNG_TRN_DVSN_CD =   #GEN_MNG_TRN_DVSN_CD#,
				TRN_BR_CD_1         =   #TRN_BR_CD_1#,
				TRN_BR_CD_2         =   #TRN_BR_CD_2#,
				TRN_BR_CD_3         =   #TRN_BR_CD_3#,
				TRN_ORG_NM          =   #TRN_ORG_NM#,
				TRN_TASK_TXT        =   #TRN_TASK_TXT#,
				TRN_TXT             =   #TRN_TXT#,
				THN_RANK_CD         =   #THN_RANK_CD#,
				SPT_TNB             =   #SPT_TNB#,
				SPT_EML_AD          =   #SPT_EML_AD#,
				SPT_AD              =   #SPT_AD#,
				FNL_USR_ID          =   FNL_USR_ID,
				FNL_DEAL_DPT_CD     =   FNL_DEAL_DPT_CD,
				FNL_MNU_ID          =   FNL_MNU_ID,
				FNL_MDF_DH          =	SYSDATE
			WHERE	TRN_PEN_CNB     =   #TRN_PEN_CNB#
			  AND	TRN_STR_DT      =   #TRN_STR_DT#	
		]]>
	</update>
	
	<delete id="CSPHIN001EDelete" parameterClass="paramMap" >
		<![CDATA[
			DELETE FROM TBCSPHIN001M
			WHERE	TRN_PEN_CNB     =   #TRN_PEN_CNB#
			  AND	TRN_STR_DT      =   #TRN_STR_DT#	
		]]>
	</delete>
	
	<!-- 국외훈련보고서 시작 -->
	<select id="CSPHIN003QMainSelect" parameterClass="paramMap" 	resultClass="resultMap">
        <![CDATA[
			SELECT	F_DPT_INFO(F_USR_INFO(A.TRN_PEN_CNB, '5'), '1') AS DPT_NM,		/* 부서명 */
					A.TRN_PEN_CNB,	/* 전산번호 */
					B.USR_NAM AS USR_NAME,	/* 이름*/
					F_CODE_NM('1000173', F_USR_INFO(A.TRN_PEN_CNB, '3')) AS RANK_NM, /* 현직급 */	
					A.TRN_STR_DT,	/* 시작기간 */
					A.TRN_END_DT,	/* 종료기간*/
					TO_CHAR(TO_DATE(A.TRN_STR_DT), 'YYYY-MM-DD') || ' ~ ' ||	
					TO_CHAR(TO_DATE(A.TRN_END_DT), 'YYYY-MM-DD') || '  (' ||	
					CASE WHEN TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD') < 60 THEN TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD') ||'일)'	
					ELSE CEIL(MONTHS_BETWEEN(TO_DATE(A.TRN_END_DT, 'YYYYMMDD'), TO_DATE(A.TRN_STR_DT, 'YYYYMMDD')  ))  || '개월)'  END AS  TRN_MONTH,	/* 기간 합친거 */
					A.GEN_MNG_TRN_DVSN_CD,  /* 훈련구분 */	
					A.TRN_BR_CD_1,	/* 훈련국1 */
					A.TRN_BR_CD_2,	/* 훈련국2 */
					A.TRN_BR_CD_3,	/* 훈련국3 */
					F_CODE_NM('1000181', A.TRN_BR_CD_1) || 	
					DECODE(A.TRN_BR_CD_2, NULL, '', ', ') || 	
					F_CODE_NM('1000181', A.TRN_BR_CD_2) ||	
					DECODE(A.TRN_BR_CD_3, NULL, '', ', ') || 	
					F_CODE_NM('1000181', A.TRN_BR_CD_3) || 	
					DECODE(A.TRN_ORG_NM, NULL, '', '/') || 	
					A.TRN_ORG_NM AS TRN_BR_ORG,	/* 훈련국/기관 */	
					A.TRN_ORG_NM,	/* 훈련기관 */
					A.TRN_TASK_TXT,	/* 과제 */
					A.TRN_TXT,	/* 내용 */
					A.THN_RANK_CD,		/* 당시 직급 */
					C.TRN_PEN_RPT_DVSN_CD,	/* 보고구분 */
					C.RPT_TIT_NM,		/* 보고제목 */
					C.RPT_TXT,		/* 보고내용 */
					C.DOC_ID,
					C.DOC_TYP_CD,
					C.RPT_DT,		/*	보고일자	 */
					C.FRT_USR_ID
			  FROM	TBCSPHIN001M A,		
			  		TBDCMACM001M B,
			  		TBCSPHIN002M C	
			 WHERE	1=1		
			   AND 	A.TRN_PEN_CNB = B.CNB
			   AND  A.TRN_PEN_CNB = C.TRN_PEN_CNB
			   AND  A.TRN_STR_DT  = C.TRN_STR_DT
		]]>	   
			<isNotEmpty property="stdDt">
				AND	#stdDt# BETWEEN A.TRN_STR_DT AND A.TRN_END_DT
			</isNotEmpty>
			
			<isNotEmpty property="strDt">
				<isEqual property="strDtDvsn" compareValue="be">
					AND	A.TRN_STR_DT &lt;= #strDt#
				</isEqual>
				<isEqual property="strDtDvsn" compareValue="af">
					AND	A.TRN_STR_DT &gt;= #strDt#
				</isEqual>
			</isNotEmpty>
			
			<isNotEmpty property="endDt">
				<isEqual property="endDtDvsn" compareValue="be">
					AND	A.TRN_END_DT &lt;= #endDt#
				</isEqual>
				<isEqual property="endDtDvsn" compareValue="af">
					AND	A.TRN_END_DT &gt;= #endDt#
				</isEqual>
			</isNotEmpty>
			
			<isEqual property="dvsn" compareValue="2">
			   AND 	A.TRN_END_DT &gt; TO_CHAR(SYSDATE,'YYYYMMDD')  /*	훈련중	*/
			</isEqual>
			<isEqual property="dvsn" compareValue="3">
			   AND 	A.TRN_END_DT &lt; TO_CHAR(SYSDATE,'YYYYMMDD')	/*	훈련종료	*/
			</isEqual>
			
			<isEqual property="rptDvsn" compareValue="2">
			   AND 	C.RPT_DT IS NOT NULL  					/*	작성	*/
			</isEqual>
			<isEqual property="rptDvsn" compareValue="3">
			   AND 	C.RPT_DT IS NULL						/*	미작성	*/
			</isEqual>
			
			<isNotEmpty property="trnDvsnCd">
			   AND 	A.GEN_MNG_TRN_DVSN_CD = #trnDvsnCd#	/*	훈련구분	  */
			</isNotEmpty>
			<isNotEmpty property="fromYmd">
			   AND	A.TRN_STR_DT &gt;= #fromYmd#
			</isNotEmpty>
			<isNotEmpty property="toYmd">
			   AND	A.TRN_END_DT &lt;= #toYmd#
			</isNotEmpty>
			<isNotEmpty property="fromRptDt">
			   AND	C.RPT_DT &gt;= #fromRptDt#
			</isNotEmpty>
			<isNotEmpty property="toRptDt">
			   AND	C.RPT_DT &lt;= #toRptDt#
			</isNotEmpty>
			<isNotEmpty property="fromTrnDay">
			   AND 	#fromTrnDay# &lt; TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD')	/*	훈련일수FROM	  */
			</isNotEmpty>
			<isNotEmpty property="toTrnDay">
			   AND 	#toTrnDay# &gt; TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD')	/*	훈련일수TO	  */
			</isNotEmpty>
			<isNotEmpty property="searchBox">
			   AND  (A.TRN_TXT LIKE '%' || #searchBox# || '%' OR  F_CODE_NM('1000181', A.TRN_BR_CD_1) LIKE '%' || #searchBox# || '%' OR  
			         F_CODE_NM('1000181', A.TRN_BR_CD_2) LIKE '%' || #searchBox# || '%' OR  F_CODE_NM('1000181', A.TRN_BR_CD_3) LIKE '%' || #searchBox# || '%' OR 
			         B.USR_NAM LIKE '%' || #searchBox# || '%')
			</isNotEmpty>
		<![CDATA[
				ORDER BY A.TRN_END_DT DESC
        ]]>
	</select>
	
	<delete id="CSPHIN003QDelete" parameterClass="paramMap" >
		<![CDATA[
			DELETE FROM TBCSPHIN002M
			WHERE	TRN_PEN_CNB     =   #TRN_PEN_CNB#
			  AND	TRN_STR_DT      =   #TRN_STR_DT#	
		]]>
	</delete>
	
	<update id="CSPHIN003QUpdate" parameterClass="paramMap" >
		<![CDATA[
			UPDATE 	TBCSPHIN002M
		      SET	RPT_DT               =  #RPT_DT#,
					TRN_PEN_RPT_DVSN_CD  =  #TRN_PEN_RPT_DVSN_CD#,
					RPT_TIT_NM           =  #RPT_TIT_NM#,
					RPT_TXT              =  #RPT_TXT#,
					DOC_ID               =  #DOC_ID#,
					DOC_TYP_CD           =  #DOC_TYP_CD#,
					FNL_USR_ID           =  #FNL_USR_ID#,
					FNL_DEAL_DPT_CD      =  #FNL_DEAL_DPT_CD#,
					FNL_MNU_ID           =  #FNL_MNU_ID#,
					FNL_MDF_DH           =  SYSDATE
			WHERE 	TRN_PEN_CNB     	 =  #TRN_PEN_CNB#
			  AND	TRN_STR_DT       	 =  #TRN_STR_DT#
		]]>
	</update>
	
	<!-- 국외훈련보고서 종료  -->
	
	<select id="CSPHIN001EReportSelect" parameterClass="paramMap" 	resultClass="resultMap">
        <![CDATA[
			SELECT	F_DPT_INFO(F_USR_INFO(A.TRN_PEN_CNB, '5'), '1') AS DPT_NM,		
					B.USR_NAM AS USR_NAME,	
					F_CODE_NM('1000173', F_USR_INFO(A.TRN_PEN_CNB, '3')) AS RANK_NM, /* 현직급 */	
					TO_CHAR(TO_DATE(A.TRN_STR_DT), 'YYYY-MM-DD') || ' ~ ' ||	
					TO_CHAR(TO_DATE(A.TRN_END_DT), 'YYYY-MM-DD') || '  (' ||	
					CASE WHEN TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD') < 60 THEN TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD') ||'일)'	
					ELSE CEIL(MONTHS_BETWEEN(TO_DATE(A.TRN_END_DT, 'YYYYMMDD'), TO_DATE(A.TRN_STR_DT, 'YYYYMMDD')  ))  || '개월)'  END AS  TRN_MONTH,	
					F_CODE_NM('1000147',A.GEN_MNG_TRN_DVSN_CD) AS GEN_MNG_TRN_DVSN_CD,  /* 훈련구분 */	
					F_CODE_NM('1000181', A.TRN_BR_CD_1) || 	
					DECODE(A.TRN_BR_CD_2, NULL, '', ', ') || 	
					F_CODE_NM('1000181', A.TRN_BR_CD_2) ||	
					DECODE(A.TRN_BR_CD_3, NULL, '', ', ') || 	
					F_CODE_NM('1000181', A.TRN_BR_CD_3) AS TRN_BR_CD,	
					A.TRN_ORG_NM
			  FROM	TBCSPHIN001M A,		
			  		TBDCMACM001M B
			 WHERE	1=1
			   AND 	A.TRN_PEN_CNB = B.CNB
		]]>	   
			<isEqual property="dvsn" compareValue="2">
			   AND 	A.TRN_END_DT &gt; TO_CHAR(SYSDATE,'YYYYMMDD')  /*	훈련중	*/
			</isEqual>
			<isEqual property="dvsn" compareValue="3">
			   AND 	A.TRN_END_DT &lt; TO_CHAR(SYSDATE,'YYYYMMDD')	/*	훈련종료	*/
			</isEqual>
			<isNotEmpty property="trnDvsnCd">
			   AND 	A.GEN_MNG_TRN_DVSN_CD = #trnDvsnCd#	/*	훈련구분	  */
			</isNotEmpty>
			<isNotEmpty property="fromYmd">
			   AND	A.TRN_STR_DT &gt;= #fromYmd#
			</isNotEmpty>
			<isNotEmpty property="toYmd">
			   AND	A.TRN_END_DT &lt;= #toYmd#
			</isNotEmpty>
			<isNotEmpty property="fromTrnDay">
			   AND 	#fromTrnDay# &lt; TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD')	/*	훈련일수FROM	  */
			</isNotEmpty>
			<isNotEmpty property="toTrnDay">
			   AND 	#toTrnDay# &gt; TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD')	/*	훈련일수TO	  */
			</isNotEmpty>
			<isNotEmpty property="searchBox">
			   AND  (A.TRN_TXT LIKE '%' || #searchBox# || '%' OR  F_CODE_NM('1000181', A.TRN_BR_CD_1) LIKE '%' || #searchBox# || '%' OR  
			         F_CODE_NM('1000181', A.TRN_BR_CD_2) LIKE '%' || #searchBox# || '%' OR  F_CODE_NM('1000181', A.TRN_BR_CD_3) LIKE '%' || #searchBox# || '%' OR 
			         B.USR_NAM LIKE '%' || #searchBox# || '%')
			</isNotEmpty>
		<![CDATA[
				ORDER BY A.TRN_END_DT DESC
        ]]>
	</select>   
	
	<select id="CSPHIN001EReportSelect2" parameterClass="paramMap" 	resultClass="resultMap">
        <![CDATA[
			SELECT	TO_CHAR(TO_DATE(#fromYmd#),'YYYY-MM-DD') AS fromYmd
					,TO_CHAR(TO_DATE(#toYmd#),'YYYY-MM-DD') AS toYmd
					,THN_RANK_NM, CNT1,CNT2,CNT3,CNT4,CNT5,CNT6,CNT7,CNT8,CNT9,CNT10,CNT11,CNT12,CNT13,CNT14,CNT15,CNT99
					,(CNT1+CNT2+CNT3+CNT4+CNT5+CNT6+CNT7+CNT8+CNT9+CNT10+CNT11+CNT12+CNT13+CNT14+CNT15+CNT99) AS TOTAL_CNT
			FROM	(
						SELECT	NVL2(THN_RANK_CD,F_CODE_NM('1000173',A.THN_RANK_CD),'합계') AS THN_RANK_NM
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '01' THEN 1 ELSE 0 END) AS CNT1
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '02' THEN 1 ELSE 0 END) AS CNT2
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '03' THEN 1 ELSE 0 END) AS CNT3
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '04' THEN 1 ELSE 0 END) AS CNT4
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '05' THEN 1 ELSE 0 END) AS CNT5
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '06' THEN 1 ELSE 0 END) AS CNT6
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '07' THEN 1 ELSE 0 END) AS CNT7
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '08' THEN 1 ELSE 0 END) AS CNT8
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '09' THEN 1 ELSE 0 END) AS CNT9
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '10' THEN 1 ELSE 0 END) AS CNT10
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '11' THEN 1 ELSE 0 END) AS CNT11
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '12' THEN 1 ELSE 0 END) AS CNT12
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '13' THEN 1 ELSE 0 END) AS CNT13
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '14' THEN 1 ELSE 0 END) AS CNT14
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '15' THEN 1 ELSE 0 END) AS CNT15
								,SUM(CASE WHEN A.GEN_MNG_TRN_DVSN_CD = '99' THEN 1 ELSE 0 END) AS CNT99
						FROM	TBCSPHIN001M A
						WHERE	1=1
		 ]]>
						 <isNotEmpty property="fromYmd">
			   				AND	A.TRN_STR_DT &gt;= #fromYmd#
						</isNotEmpty>
						<isNotEmpty property="toYmd">
			   				AND	A.TRN_END_DT &lt;= #toYmd#
						</isNotEmpty>
		 <![CDATA[
						GROUP BY ROLLUP(A.THN_RANK_CD)
					)
		
			
			ORDER BY THN_RANK_NM
		]]>
       
	</select>
	
	<select id="CSPHIN003QReportSelect" parameterClass="paramMap" 	resultClass="resultMap">
        <![CDATA[
			SELECT	B.USR_NAM AS USR_NAME,	/* 이름*/
					F_CODE_NM('1000173', F_USR_INFO(A.TRN_PEN_CNB, '3')) AS RANK_NM, /* 현직급 */	
					A.TRN_STR_DT,	/* 시작기간 */
					A.TRN_END_DT,	/* 종료기간*/
					TO_CHAR(TO_DATE(A.TRN_STR_DT), 'YYYY-MM-DD') || ' ~ ' ||	
					TO_CHAR(TO_DATE(A.TRN_END_DT), 'YYYY-MM-DD') || '  (' ||	
					CASE WHEN TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD') < 60 THEN TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD') ||'일)'	
					ELSE CEIL(MONTHS_BETWEEN(TO_DATE(A.TRN_END_DT, 'YYYYMMDD'), TO_DATE(A.TRN_STR_DT, 'YYYYMMDD')  ))  || '개월)'  END AS  TRN_MONTH,	/* 기간 합친거 */
					A.TRN_BR_CD_1,	/* 훈련국1 */
					A.TRN_BR_CD_2,	/* 훈련국2 */
					A.TRN_BR_CD_3,	/* 훈련국3 */
					F_CODE_NM('1000181', A.TRN_BR_CD_1) || 	
					DECODE(A.TRN_BR_CD_2, NULL, '', ', ') || 	
					F_CODE_NM('1000181', A.TRN_BR_CD_2) ||	
					DECODE(A.TRN_BR_CD_3, NULL, '', ', ') || 	
					F_CODE_NM('1000181', A.TRN_BR_CD_3) || 	
					DECODE(A.TRN_ORG_NM, NULL, '', '/') || 	
					A.TRN_ORG_NM AS TRN_BR_ORG,	/* 훈련국/기관 */	
					A.TRN_ORG_NM,	/* 훈련기관 */
					F_CODE_NM('1000173', A.THN_RANK_CD) AS THN_RANK_CD,		/* 당시 직급 */
					F_CODE_NM('1000160', C.TRN_PEN_RPT_DVSN_CD) AS TRN_PEN_RPT_DVSN_CD,	/* 보고구분 */
					C.RPT_TIT_NM,		/* 보고제목 */
					C.RPT_DT
			  FROM	TBCSPHIN001M A,		
			  		TBDCMACM001M B,
			  		TBCSPHIN002M C	
			 WHERE	1=1		
			   AND 	A.TRN_PEN_CNB = B.CNB
			   AND  A.TRN_PEN_CNB = C.TRN_PEN_CNB
			   AND  A.TRN_STR_DT  = C.TRN_STR_DT
		]]>	   
			<isNotEmpty property="stdDt">
				AND	#stdDt# BETWEEN A.TRN_STR_DT AND A.TRN_END_DT
			</isNotEmpty>
			
			<isNotEmpty property="strDt">
				<isEqual property="strDtDvsn" compareValue="be">
					AND	A.TRN_STR_DT &lt;= #strDt#
				</isEqual>
				<isEqual property="strDtDvsn" compareValue="af">
					AND	A.TRN_STR_DT &gt;= #strDt#
				</isEqual>
			</isNotEmpty>
			
			<isNotEmpty property="endDt">
				<isEqual property="endDtDvsn" compareValue="be">
					AND	A.TRN_END_DT &lt;= #endDt#
				</isEqual>
				<isEqual property="endDtDvsn" compareValue="af">
					AND	A.TRN_END_DT &gt;= #endDt#
				</isEqual>
			</isNotEmpty>
			
			<isEqual property="dvsn" compareValue="2">
			   AND 	A.TRN_END_DT &gt; TO_CHAR(SYSDATE,'YYYYMMDD')  /*	훈련중	*/
			</isEqual>
			<isEqual property="dvsn" compareValue="3">
			   AND 	A.TRN_END_DT &lt; TO_CHAR(SYSDATE,'YYYYMMDD')	/*	훈련종료	*/
			</isEqual>
			
			<isEqual property="rptDvsn" compareValue="2">
			   AND 	C.RPT_DT IS NOT NULL  					/*	작성	*/
			</isEqual>
			<isEqual property="rptDvsn" compareValue="3">
			   AND 	C.RPT_DT IS NULL						/*	미작성	*/
			</isEqual>
			
			<isNotEmpty property="trnDvsnCd">
			   AND 	A.GEN_MNG_TRN_DVSN_CD = #trnDvsnCd#	/*	훈련구분	  */
			</isNotEmpty>
			<isNotEmpty property="fromYmd">
			   AND	A.TRN_STR_DT &gt;= #fromYmd#
			</isNotEmpty>
			<isNotEmpty property="toYmd">
			   AND	A.TRN_END_DT &lt;= #toYmd#
			</isNotEmpty>
			<isNotEmpty property="fromRptDt">
			   AND	C.RPT_DT &gt;= #fromRptDt#
			</isNotEmpty>
			<isNotEmpty property="toRptDt">
			   AND	C.RPT_DT &lt;= #toRptDt#
			</isNotEmpty>
			<isNotEmpty property="fromTrnDay">
			   AND 	#fromTrnDay# &lt; TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD')	/*	훈련일수FROM	  */
			</isNotEmpty>
			<isNotEmpty property="toTrnDay">
			   AND 	#toTrnDay# &gt; TO_DATE(A.TRN_END_DT,'YYYYMMDD') - TO_DATE(A.TRN_STR_DT,'YYYYMMDD')	/*	훈련일수TO	  */
			</isNotEmpty>
			<isNotEmpty property="searchBox">
			   AND  (A.TRN_TXT LIKE '%' || #searchBox# || '%' OR  F_CODE_NM('1000181', A.TRN_BR_CD_1) LIKE '%' || #searchBox# || '%' OR  
			         F_CODE_NM('1000181', A.TRN_BR_CD_2) LIKE '%' || #searchBox# || '%' OR  F_CODE_NM('1000181', A.TRN_BR_CD_3) LIKE '%' || #searchBox# || '%' OR 
			         B.USR_NAM LIKE '%' || #searchBox# || '%')
			</isNotEmpty>
		<![CDATA[
				ORDER BY A.TRN_END_DT DESC
        ]]>
	</select>   
	
	
</sqlMap> 
