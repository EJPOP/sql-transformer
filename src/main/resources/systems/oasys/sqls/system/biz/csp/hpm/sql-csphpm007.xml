<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/hpm/007">
	
	<!--감사원결정례 정보를 조회한다.-->
	<select id="CSPHPM007Qmainselect" parameterClass="paramMap" 	resultClass="resultMap">
		<include refid = "include.pageSelct"/><!-- 페이징 -->
        <![CDATA[
				SELECT
						A.NTT_ID
					  , A.BBS_ID
					  , A.NTT_SJ
					  , A.DOC_YEAR
					  , A.DOC_ID
					  , A.CNN_CON2
				  FROM TBCSPTSM002L A
				 WHERE A.BBS_ID='BBSMSTR_100000000011'
				   AND A.USE_AT = 'Y' 
		]]>				
		 <isNotEmpty property="strYr" > <!-- 연도별 -->
			AND A.DOC_YEAR = #strYr#	
		</isNotEmpty>
		 <isNotEmpty property="strCnnCon2" > <!-- 구분 -->
			AND A.CNN_CON2 = #strCnnCon2#	
		</isNotEmpty>
		 <isNotEmpty property="strSearchBox" > <!-- 제목 -->
			AND UPPER(A.NTT_SJ) LIKE UPPER('%' || #strSearchBox# || '%')
		</isNotEmpty>
		
		<include refid = "include.pageOrder"/> <!-- 페이징 -->
	</select>
	
		
	<!-- 수정한 내용 저장하기 -->
	<update id="CSPHPM007QUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPTSM002L
			   SET 	NTT_SJ           = #NTT_SJ#
					,DOC_YEAR        = #DOC_YEAR#
					,DOC_ID          = #DOC_ID#
					,CNN_CON2        = #CNN_CON2#
					,LAST_UPDUSR_ID  = #LAST_UPDUSR_ID#
					,LAST_UPDT_PNTTM = SYSDATE
			 WHERE NTT_ID = #NTT_ID#
			   AND BBS_ID = 'BBSMSTR_100000000011'
		]]>
	</update>
	     
	<!-- 신규등록 -->
	<update id="CSPHPM007QInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPTSM002L
				(
					NTT_ID, BBS_ID, NTT_SJ, NTT_CN, SORT_ORDR, 
					NTCR_ID, NTCR_NM, PASSWORD, RDCNT, 
					NTCE_BGNDE, NTCE_ENDDE, ANSWER_AT,  			   
					PARNTSCTT_NO, NTT_NO, ANSWER_LC, DOC_ID,
					FRST_REGISTER_ID, FRST_REGIST_PNTTM, USE_AT,
					KEYWORD, MAIN_IMG_ID, QNA_STATE, QNA_ANSWER, DOC_YEAR, HTML_YN, LIST_IMG_ID, PUBLIC_YN,
					NOTICE_YN, SECRET_YN, URL_LINK, CATEGORY, THUMB_IMG_ID, LIST_TOP_IMG_YN, FAQ_DSJ, FAQ_ANSWER,
					SUB1, SUB2, CATEGORY_SUB, BUSEO, EMAIL, TEL, JUSO, INSTITUTION, DATE_SUB, QNA_ANSWER_NM, QNA_REG_DATE, 
					CNN_CNT1, CNN_CON2, CNN_CON1, CNN_CON3, CLIENT_IP, BOGO_DATE, BIZ_KEY1, BIZ_KEY2
				)
			VALUES
				(
				    #NTT_ID#,'BBSMSTR_100000000011',#NTT_SJ#,#NTT_CN#,#SORT_ORDR#
					,#NTCR_ID#,#NTCR_NM#,#PASSWORD#,#RDCNT#
					,#NTCE_BGNDE#,#NTCE_ENDDE#,#ANSWER_AT#
					,#PARNTSCTT_NO#,#NTT_NO#,#ANSWER_LC#,#DOC_ID#
					,#FRST_REGISTER_ID#,SYSDATE,'Y'
					,#KEYWORD#,#MAIN_IMG_ID#,#QNA_STATE#,#QNA_ANSWER#,#DOC_YEAR#,#HTML_YN#,#LIST_IMG_ID#,#PUBLIC_YN#
					,'N',#SECRET_YN#,#URL_LINK#,#CATEGORY#,#THUMB_IMG_ID#,#LIST_TOP_IMG_YN#,#FAQ_DSJ#,#FAQ_ANSWER#
					,#SUB1#,#SUB2#,#CATEGORY_SUB#,#BUSEO#,#EMAIL#,#TEL#,#JUSO#,#INSTITUTION#,#DATE_SUB#,#QNA_ANSWER_NM#,#QNA_REG_DATE#
					,#CNN_CNT1#,#CNN_CON2#,#CNN_CON1#,#CNN_CON3#,#CLIENT_IP#,#BOGO_DATE#,#BIZ_KEY1#,#BIZ_KEY2#
				)
		]]>
	</update>
	     
    <!-- 삭제 -->
	<delete id="CSPHPM007QDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE
			  FROM TBCSPTSM002L 				
			 WHERE NTT_ID = #NTT_ID#
			   AND BBS_ID = 'BBSMSTR_100000000011'
		]]>
	</delete>
	
    <!-- 홈페이지용 select :: 홈페이지 연계 -->
    <select id="CSPHPM007QSendHomepageselect" parameterClass="paramMap"	resultClass="resultMap">
    	<![CDATA[
			SELECT
					NTT_ID, BBS_ID, NTT_NO, NTT_SJ, NTT_CN, ANSWER_AT, 
			       PARNTSCTT_NO, ANSWER_LC, SORT_ORDR, RDCNT, USE_AT, 
			       NTCE_BGNDE, NTCE_ENDDE, NTCR_ID, NTCR_NM, PASSWORD, 
			       DOC_ID, FRST_REGIST_PNTTM, FRST_REGISTER_ID, 
			       LAST_UPDT_PNTTM, LAST_UPDUSR_ID, THUMB_IMG_ID, CATEGORY, 
			       HEADER, KEYWORD, MAIN_IMG_ID, QNA_STATE, QNA_ANSWER, DOC_YEAR,
			       HTML_YN, LIST_IMG_ID, PUBLIC_YN, NOTICE_YN, SECRET_YN, URL_LINK, 
			       LIST_TOP_IMG_YN, MAIN_YN, FAQ_ANSWER, FAQ_DSJ, SUB1, SUB2, CATEGORY_SUB, 
			       BUSEO, EMAIL, TEL, JUSO, INSTITUTION, DATE_SUB, CNN_STATE1, CNN_STATE2, 
			       CNN_STATE3, CNN_STATE4, CNN_CON1, CNN_CON2, CNN_CON3, CNN_CON4, CNN_CNT1, QNA_ANSWER_NM, 
			       QNA_REG_DATE, PARENT_NO, LEVEL_NO, CNN_ACCT_DATE, CNN_PROP_DATE, 
			       CLIENT_IP, BOGO_DATE, #FLAG# AS FLAG
			 FROM TBCSPTSM002L 
			WHERE NTT_ID = #NTT_ID#
    	]]>
    </select>
    
    <!--  연계 테이블 안에 데이터 insert -->
    <insert id="CSPHPM007QSEND001Insert" parameterClass="paramMap">
    	<![CDATA[
    		INSERT INTO EH_INF_SP_HP_001 
			       (
			           IF_SEQ,IF_TYPE,IF_SIID, 
			           NTT_ID, BBS_ID, NTT_NO, NTT_SJ, NTT_CN, ANSWER_AT, 
			           PARNTSCTT_NO, ANSWER_LC, SORT_ORDR, RDCNT, USE_AT, 
			           NTCE_BGNDE, NTCE_ENDDE, NTCR_ID, NTCR_NM, PASSWORD, 
			           ATCH_FILE_ID, FRST_REGIST_PNTTM, FRST_REGISTER_ID, 
			           LAST_UPDT_PNTTM, LAST_UPDUSR_ID, THUMB_IMG_ID, CATEGORY, 
			           HEADER, KEYWORD, MAIN_IMG_ID, QNA_STATE, QNA_ANSWER, DOC_YEAR,
			           HTML_YN, LIST_IMG_ID, PUBLIC_YN, NOTICE_YN, SECRET_YN, URL_LINK, 
			           LIST_TOP_IMG_YN, MAIN_YN, FAQ_ANSWER, FAQ_DSJ, SUB1, SUB2, CATEGORY_SUB, 
			           BUSEO, EMAIL, TEL, JUSO, INSTITUTION, DATE_SUB, CNN_STATE1, CNN_STATE2, 
			           CNN_STATE3, CNN_STATE4, CNN_CON1, CNN_CON2, CNN_CON3, CNN_CON4, CNN_CNT1, QNA_ANSWER_NM, 
			           QNA_REG_DATE, PARENT_NO, LEVEL_NO, CNN_ACCT_DATE, CNN_PROP_DATE, 
			           CLIENT_IP, BOGO_DATE, FLAG,ETC1,ETC2,ETC3,ETC4,ETC5
			       ) 
			  VALUES
			       (
			           #IF_SEQ#,'SND',#IF_SIID#
			          ,#NTT_ID#,#BBS_ID#,#NTT_NO#,#NTT_SJ#,#NTT_CN#,#ANSWER_AT#
			          ,#PARNTSCTT_NO#,#ANSWER_LC#,#SORT_ORDR#,#RDCNT#,#USE_AT#
			          ,#NTCE_BGNDE#,#NTCE_ENDDE#,#NTCR_ID#,#NTCR_NM#,#PASSWORD#
			          ,#DOC_ID#,#FRST_REGIST_PNTTM#,#FRST_REGISTER_ID#
			          ,#LAST_UPDT_PNTTM#,#LAST_UPDUSR_ID#,#THUMB_IMG_ID#,#CATEGORY#
			          ,#HEADER#,#KEYWORD#,#MAIN_IMG_ID#,#QNA_STATE#,#QNA_ANSWER#,#DOC_YEAR#
			          ,#HTML_YN#,#LIST_IMG_ID#,#PUBLIC_YN#,#NOTICE_YN#,#SECRET_YN#,#URL_LINK#
			          ,#LIST_TOP_IMG_YN#,#MAIN_YN#,#FAQ_ANSWER#,#FAQ_DSJ#,#SUB1#,#SUB2#,#CATEGORY_SUB#
			          ,#BUSEO#,#EMAIL#,#TEL#,#JUSO#,#INSTITUTION#,#DATE_SUB#,#CNN_STATE1#,#CNN_STATE2#
			          ,#CNN_STATE3#,#CNN_STATE4#,#CNN_CON1#,#CNN_CON2#,#CNN_CON3#,#CNN_CON4#,#CNN_CNT1#,#QNA_ANSWER_NM#
			          ,#QNA_REG_DATE#,#PARENT_NO#,#LEVEL_NO#,#CNN_ACCT_DATE#,#CNN_PROP_DATE#
			          ,#CLIENT_IP#,#BOGO_DATE#,#FLAG#,#ETC1#,#ETC2#,#ETC3#,#ETC4#,#ETC5#
			       )
    	]]>
    </insert>
	
	<select id="CSPHPM007QGetMaxFmdxIdx" parameterClass="paramMap" resultClass="Integer">
		<![CDATA[
			SELECT NVL(MAX(NTT_ID),0)+1 AS NTT_ID 
			  FROM TBCSPTSM002L
		]]>
	</select>
	
	<select id="CSPHPM007QGetFmdxIdxByBizKey" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT NTT_ID 
			  FROM TBCSPTSM002L
			 WHERE BIZ_KEY1 = #DCSEXP_YR#
			   AND BIZ_KEY2 = #DCSEXP_NO#  
		]]>
	</select>
	
	<select id="CSPHPM007QGetDspRqDndCd" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT T3.USR_DFN_TXT_4 AS USR_DFN_TXT_4
			  FROM TBBADEAR034M T1 
			      ,TBBADEAR001M T2
			      ,TBDCMACM013C T3
			 WHERE T1.AUD_YR     = T2.AUD_YR
			   AND T1.AUD_NO     = T2.AUD_NO
			   AND T1.DSP_RQ_SNO = T2.DSP_RQ_SNO
			   AND T2.DSP_RQ_KND_CD = T3.CD
			   AND T3.CMM_CD_DVSN_CD = '1000002'
			   AND T1.DCSEXP_YR = #DCSEXP_YR#
			   AND T1.DCSEXP_NO = #DCSEXP_NO# 
			   AND T1.AUD_YR = #AUD_YR#
			   AND T1.AUD_NO = #AUD_NO#
		]]>
	</select>
</sqlMap> 
