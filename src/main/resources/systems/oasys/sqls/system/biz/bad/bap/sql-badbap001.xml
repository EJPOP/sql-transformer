<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/bap/001">
	
	<!--감사사항관리 조회-->
	<select id="BADBAP001EMainselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			SELECT	D1.YR                                              /* 연도*/
				   ,D1.DOC_SNO                                         /* 문서순번 */
				   ,D1.TIT_NM                                          /* 제목명 */
				   ,D1.AUD_PLN_DOC_KND_CD                              /* 감사계획문서종류코드 */
				   ,D1.DPT_CD                                          /* 부서코드 */
				   ,F_DPT_INFO(D1.DPT_CD,'1')    AS DPT_NM             /* 부서명 */
				   ,D1.DOC_ID                                          /* 문서ID */
				   ,D1.DOC_TYP_CD                                      /* 문서유형코드 */
				   ,D1.FRT_USR_ID                                      /* 최초사용자ID */
				   ,D1.FNL_USR_ID                                      /* 최종사용자ID */
				   ,D1.FNL_DEAL_DPT_CD                                 /* 최종거래부서코드 */
				   ,D1.FNL_MNU_ID                                      /* 최종메뉴ID */
				   ,TO_CHAR(D1.FRT_REGI_DH,'YYYYMMDD') AS FRT_REGI_DH  /* 최초등록일시 */
				   ,TO_CHAR(D1.FNL_MDF_DH,'YYYYMMDD')  AS FRT_REGI_DH  /* 최종수정일시 */
				   ,D1.YR                              AS KEY_YR       /* 연도(수정/삭제용) */
				   ,D1.DOC_SNO                         AS KEY_DOC_SNO  /* 문서순번(수정/삭제용) */
			  FROM TBBADBAP002M D1  /* 감사계획문서기본 */
			 WHERE 1 = 1
		]]>
		
		<isNotEmpty property="strYr">
			AND D1.YR = #strYr#
		</isNotEmpty>
		
    	<isNotEqual property="strAudPlnDocKndCd" compareValue="0">
    		<isEqual property="strAudPlnDocKndCd" compareValue="1">
    			AND D1.AUD_PLN_DOC_KND_CD IN ('2','3','4')
    		</isEqual>
    		<isNotEqual property="strAudPlnDocKndCd" compareValue="1">
    			AND D1.AUD_PLN_DOC_KND_CD    = #strAudPlnDocKndCd#
    		</isNotEqual>
    	</isNotEqual>
		
			   AND D1.DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #strDptAuth#, '', #strDptCd#)))
		
		<isNotEmpty property="strDptCd2">
               AND D1.DPT_CD = #strDptCd2#
		</isNotEmpty> 		
		 
        <![CDATA[       
		     ORDER BY D1.YR DESC, D1.DOC_SNO DESC
        ]]>
	</select>
	
	<!--감사사항관리 insert-->
	<insert id="BADBAP001EMaininsert" parameterClass="paramMap">
		INSERT INTO TBBADBAP002M
		 (
			YR
			,DOC_SNO
			,TIT_NM
			,AUD_PLN_DOC_KND_CD
			,DPT_CD
			,DOC_ID
			,DOC_TYP_CD
			,FRT_USR_ID
			,FNL_USR_ID
			,FNL_DEAL_DPT_CD
			,FNL_MNU_ID
			,FRT_REGI_DH
			,FNL_MDF_DH 
		 ) VALUES
		 (
			#YR#
			,#DOC_SNO#
			,#TIT_NM#
			,#AUD_PLN_DOC_KND_CD#
			,#DPT_CD#
			,#DOC_ID#
			,#DOC_TYP_CD#
			,#FRT_USR_ID#
			,#FNL_USR_ID#
			,#FNL_DEAL_DPT_CD#
			,#FNL_MNU_ID#
			,SYSDATE
			,SYSDATE
		 ) 
	</insert>
	
	<!--감사사항관리 update-->
	<update id="BADBAP001EMainupdate" parameterClass="paramMap">

		<![CDATA[
		     UPDATE TBBADBAP002M
		     SET
		         YR=#YR#
		        ,DOC_SNO = #DOC_SNO#
		        ,FNL_MDF_DH = SYSDATE 
		]]>
		<isNotNull prepend="," property="TIT_NM">
		     TIT_NM=#TIT_NM#
		</isNotNull>
		<isNotNull prepend="," property="AUD_PLN_DOC_KND_CD">
		     AUD_PLN_DOC_KND_CD=#AUD_PLN_DOC_KND_CD#
		</isNotNull>
		<isNotNull prepend="," property="DPT_CD">
		     DPT_CD=#DPT_CD#
		</isNotNull>
		<isNotNull prepend="," property="DOC_ID">
		     DOC_ID=#DOC_ID#
		</isNotNull>
		<isNotNull prepend="," property="DOC_TYP_CD">
		     DOC_TYP_CD=#DOC_TYP_CD#
		</isNotNull>
		<isNotNull prepend="," property="FNL_USR_ID">
		     FNL_USR_ID=#FNL_USR_ID#
		</isNotNull>
		<isNotNull prepend="," property="FNL_DEAL_DPT_CD">
		     FNL_DEAL_DPT_CD=#FNL_DEAL_DPT_CD#
		</isNotNull>
		<isNotNull prepend="," property="FNL_MNU_ID">
		     FNL_MNU_ID=#FNL_MNU_ID#
		</isNotNull>
		     WHERE 1=1
		     AND YR               = #KEY_YR# 
		     AND DOC_SNO          = #KEY_DOC_SNO# 		    
	</update>
	
	<!--감사사항관리 delete-->
	<update id="BADBAP001EMaindelete" parameterClass="paramMap">
			DELETE 
			FROM 	TBBADBAP002M
			WHERE 1=1
			AND YR               = #KEY_YR# 
			AND DOC_SNO          = #KEY_DOC_SNO# 
	</update>
	
	<!-- 연번 Max값 찾기 -->
	<select id="BADBAP001EMainMaxSnoselect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[     	
			    SELECT NVL(MAX(TO_NUMBER(DOC_SNO)),0)+1 AS MAX_SEQ
				  FROM TBBADBAP002M
				 WHERE 1=1
				   AND YR = #YR# 
		]]>
	</select>
	
</sqlMap> 
