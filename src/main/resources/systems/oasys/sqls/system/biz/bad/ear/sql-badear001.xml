<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/ear/001">

	<!--감사결과보고서 업로드를 위한 감사사항관리 조회-->
	<select id="BADEAR001EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[       
			    SELECT D1.AUD_YR                                    AS AUD_YR                   /*감사년도*/
			         , D1.AUD_NO                                    AS AUD_NO                   /*감사번호*/
			         ,F_MNG_KND_AUDYRNO(D1.AUD_YR, D1.AUD_NO, D1.AUD_KND_CD, '-')  
			                                                        AS AUD_YR_N0                /*감사년번호*/
			         , D1.AUD_KND_CD                                AS AUD_KND_CD               /*감사종류코드*/
			         , F_CODE_NM_YEAR('1000007', D1.AUD_KND_CD, D1.AUD_YR) AUD_KND_NM
			         , D1.SPV_BRDV_CD                               AS SPV_BRDV_CD              /*주관국과코드*/
			         , F_DPT_INFO(D1.SPV_BRDV_CD,'1')               AS SPV_BRDV_NM
                     , F_DPT_INFO(D1.MNG_DPT_CD,'1')                AS MNG_DPT_NM               /*관리국과명 - 2016.07.05 yyh*/			         
			         , D1.AUD_RPST_ORG_CD                           AS AUD_RPST_ORG_CD          /*감사대표기관코드*/
			         , F_ORG_INFO(D1.AUD_RPST_ORG_CD,'1')           AS AUD_RPST_ORG_NM  
			         , D1.AUD_SBJ_NM                                AS AUD_SBJ_NM               /*감사사항명*/
			         , D2.TYPE1_DOC_ID                              AS TYPE1_DOC_ID             /*실지감사계획서 DOC_ID*/    
			         , D2.TYPE1_FILE_NAME                           AS TYPE1_FILE_NAME          /*실지감사계획서 파일명*/
			         , D2.TYPE1_CSD_CHG_ID                          AS TYPE1_CSD_CHG_ID         /*실지감사계획서 CSD변환요청ID*/
			         , CASE WHEN D2.TYPE1_CSD_CHG_CMPT_YN = 'Y' THEN '성공'
			                WHEN D2.TYPE1_CSD_CHG_CMPT_YN = 'N' THEN '실패'
			            END                                         AS TYPE1_CSD_CHG_CMPT_YN    /*실지감사계획서 CSD변환성공여부*/    
			         , D2.TYPE2_DOC_ID                              AS TYPE2_DOC_ID             /*CSD실지감사계획서 DOC_ID*/    
			         , D2.TYPE2_FILE_NAME                           AS TYPE2_FILE_NAME          /*CSD실지감사계획서 파일명*/
			         , D2.TYPE2_CSD_CHG_ID                          AS TYPE2_CSD_CHG_ID         /*CSD실지감사계획서 CSD변환요청ID*/
			         , CASE WHEN D2.TYPE2_CSD_CHG_CMPT_YN = 'Y' THEN '성공'
			                WHEN D2.TYPE2_CSD_CHG_CMPT_YN = 'N' THEN '실패'
			            END                                         AS TYPE2_CSD_CHG_CMPT_YN    /*귀청보고서 CSD변환성공여부*/ 
			         , D2.TYPE3_DOC_ID                              AS TYPE3_DOC_ID             /*귀청보고서 DOC_ID*/    
			         , D2.TYPE3_FILE_NAME                           AS TYPE3_FILE_NAME          /*귀청보고서 파일명*/
			         , D2.TYPE3_CSD_CHG_ID                          AS TYPE3_CSD_CHG_ID         /*귀청보고서 CSD변환요청ID*/  
			         , CASE WHEN D2.TYPE3_CSD_CHG_CMPT_YN = 'Y' THEN '성공'
			                WHEN D2.TYPE3_CSD_CHG_CMPT_YN = 'N' THEN '실패'
			            END                                         AS TYPE3_CSD_CHG_CMPT_YN    /*CSD귀청보고서 CSD변환성공여부*/          
			         , D2.TYPE4_DOC_ID                              AS TYPE4_DOC_ID             /*CSD귀청보고서 DOC_ID*/    
			         , D2.TYPE4_FILE_NAME                           AS TYPE4_FILE_NAME          /*CSD귀청보고서 파일명*/
			         , D2.TYPE4_CSD_CHG_ID                          AS TYPE4_CSD_CHG_ID         /*CSD귀청보고서 CSD변환요청ID*/   
			         , CASE WHEN D2.TYPE4_CSD_CHG_CMPT_YN = 'Y' THEN '성공'
			                WHEN D2.TYPE4_CSD_CHG_CMPT_YN = 'N' THEN '실패'
			            END                                         AS TYPE4_CSD_CHG_CMPT_YN    /*감사결과보고서 CSD변환성공여부*/            
			         , D2.TYPE5_DOC_ID                              AS TYPE5_DOC_ID             /*감사결과보고서 DOC_ID*/    
			         , D2.TYPE5_FILE_NAME                           AS TYPE5_FILE_NAME          /*감사결과보고서 파일명*/
			         , D2.TYPE5_CSD_CHG_ID                          AS TYPE5_CSD_CHG_ID         /*감사결과보고서 CSD변환요청ID*/   
			         , CASE WHEN D2.TYPE5_CSD_CHG_CMPT_YN = 'Y' THEN '성공'
			                WHEN D2.TYPE5_CSD_CHG_CMPT_YN = 'N' THEN '실패'
			            END                                         AS TYPE5_CSD_CHG_CMPT_YN    /*CSD감사결과보고서 CSD변환성공여부*/     
			         , D2.TYPE6_DOC_ID                              AS TYPE6_DOC_ID             /*CSD감사결과보고서 DOC_ID*/    
			         , D2.TYPE6_FILE_NAME                           AS TYPE6_FILE_NAME          /*CSD감사결과보고서 파일명*/
			         , D2.TYPE6_CSD_CHG_ID                          AS TYPE6_CSD_CHG_ID         /*CSD감사결과보고서 CSD변환요청ID*/   
			         , CASE WHEN D2.TYPE6_CSD_CHG_CMPT_YN = 'Y' THEN '성공'
			                WHEN D2.TYPE6_CSD_CHG_CMPT_YN = 'N' THEN '실패'
			            END                                         AS TYPE6_CSD_CHG_CMPT_YN    /*공개문1차변환 CSD변환성공여부*/         
			         , D2.TYPE7_DOC_ID                              AS TYPE7_DOC_ID             /*공개문1차변환 DOC_ID*/    
			         , D2.TYPE7_FILE_NAME                           AS TYPE7_FILE_NAME          /*공개문1차변환 파일명*/
			         , D2.TYPE7_CSD_CHG_ID                          AS TYPE7_CSD_CHG_ID         /*공개문1차변환 CSD변환요청ID*/   
			         , CASE WHEN D2.TYPE7_CSD_CHG_CMPT_YN = 'Y' THEN '성공'
			                WHEN D2.TYPE7_CSD_CHG_CMPT_YN = 'N' THEN '실패'
			            END                                         AS TYPE7_CSD_CHG_CMPT_YN    /*CSD공개문1차변환 CSD변환성공여부*/         
			         , D2.TYPE8_DOC_ID                              AS TYPE8_DOC_ID             /*CSD공개문1차변환 DOC_ID*/    
			         , D2.TYPE8_FILE_NAME                           AS TYPE8_FILE_NAME          /*CSD공개문1차변환 파일명*/
			         , D2.TYPE8_CSD_CHG_ID                          AS TYPE8_CSD_CHG_ID         /*CSD공개문1차변환 CSD변환요청ID*/  
			         , CASE WHEN D2.TYPE8_CSD_CHG_CMPT_YN = 'Y' THEN '성공'
			                WHEN D2.TYPE8_CSD_CHG_CMPT_YN = 'N' THEN '실패'
			            END                                         AS TYPE8_CSD_CHG_CMPT_YN    /*홍페이지용공개문 CSD변환성공여부*/  
			         , D2.TYPE9_DOC_ID                              AS TYPE9_DOC_ID             /*홍페이지용공개문 DOC_ID*/    
			         , D2.TYPE9_FILE_NAME                           AS TYPE9_FILE_NAME          /*홍페이지용공개문 파일명*/
			         , D2.TYPE9_CSD_CHG_ID                          AS TYPE9_CSD_CHG_ID         /*홍페이지용공개문 CSD변환요청ID*/   
			         , CASE WHEN D2.TYPE9_CSD_CHG_CMPT_YN = 'Y' THEN '성공'
			                WHEN D2.TYPE9_CSD_CHG_CMPT_YN = 'N' THEN '실패'
			            END                                         AS TYPE9_CSD_CHG_CMPT_YN    /*홍페이지용공개문 CSD변환성공여부*/  
			         , DECODE(D2.TYPE1_DOC_ID,NULL,'N','Y')         AS TYPE1_YN                 /*실지감사계획서 입력여부*/    
			         , DECODE(D2.TYPE3_DOC_ID,NULL,'N','Y')         AS TYPE3_YN                 /*귀청보고서  입력여부*/  
			         , DECODE(D2.TYPE5_DOC_ID,NULL,'N','Y')         AS TYPE5_YN                 /*감사결과보고서 입력여부*/
			         , DECODE(D2.TYPE7_DOC_ID,NULL,'N','Y')         AS TYPE7_YN                 /*공개문1차변환 입력여부*/    
			        /* , DECODE(D2.TYPE9_DOC_ID,NULL,'N','Y')         AS TYPE9_YN                 홈페이지공개문 입력여부*/
			         , CASE WHEN (	SELECT 	COUNT(*)
						         	FROM	TBBADEAR028M S1
						         	WHERE	D1.AUD_YR||D1.AUD_NO  = S1.AUD_SLN) > 0 THEN 'Y' ELSE 'N' END AS  TYPE9_YN
				     , D2.TYPE1_FILE_ID    /*파일ID*/
				     , D2.TYPE2_FILE_ID    /*파일ID*/ 
				     , D2.TYPE3_FILE_ID	/*파일ID*/
				     , D2.TYPE4_FILE_ID 	/*파일ID*/
				     , D2.TYPE5_FILE_ID 	/*파일ID*/
				     , D2.TYPE6_FILE_ID 	/*파일ID*/
				     , D2.TYPE7_FILE_ID 	/*파일ID*/
				     , D2.TYPE8_FILE_ID 	/*파일ID*/
				     , D2.TYPE9_FILE_ID 	/*파일ID*/		 	
                     , CASE WHEN PRL_SMT_DT IS NOT NULL THEN TO_DATE(PRL_SMT_DT) - (SELECT TO_DATE(MAX(ENF_DT)) 
                     																  FROM TBBADEAR002D S1 
                     																 WHERE S1.AUD_YR = D1.AUD_YR AND S1.AUD_NO = D1.AUD_NO)
       						ELSE TO_DATE(SYSDATE) - (SELECT TO_DATE(MAX(ENF_DT)) 
       						                           FROM TBBADEAR002D S1 
       						                          WHERE S1.AUD_YR = D1.AUD_YR AND S1.AUD_NO = D1.AUD_NO) END AS DAY_CNT /*시행일 이후 경과일수*/
       				 , TO_CHAR(TO_DATE(D1.PRL_SMT_DT),'YYYY-MM-DD') AS PRL_SMT_DT   /*호보제출일*/  
       				 , D1.APV_DOC_NO 
       				  , (SELECT COUNT(1) FROM TBBADEAR002D S1 WHERE S1.AUD_YR = D1.AUD_YR AND S1.AUD_NO = D1.AUD_NO AND NVL(S1.HMP_OPEN_YN,'N') = 'N') AS DSP_CNT   
			      FROM TBBADDED001M D1  
			         , (
                           SELECT D1.AUD_YR 
			                    , D1.AUD_NO
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-002',D1.DOC_ID))                    AS TYPE1_DOC_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-002',D2.FILE_NAME))                 AS TYPE1_FILE_NAME
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-002',D1.CSD_CHG_ID))                AS TYPE1_CSD_CHG_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-002',D1.CSD_CHG_CMPT_YN))           AS TYPE1_CSD_CHG_CMPT_YN
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-007',D1.DOC_ID))                    AS TYPE2_DOC_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-007',D2.FILE_NAME))                 AS TYPE2_FILE_NAME
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-007',D1.CSD_CHG_ID))                AS TYPE2_CSD_CHG_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-007',D1.CSD_CHG_CMPT_YN))           AS TYPE2_CSD_CHG_CMPT_YN
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-003',D1.DOC_ID))                    AS TYPE3_DOC_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-003',D2.FILE_NAME))                 AS TYPE3_FILE_NAME
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-003',D1.CSD_CHG_ID))                AS TYPE3_CSD_CHG_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-003',D1.CSD_CHG_CMPT_YN))           AS TYPE3_CSD_CHG_CMPT_YN
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-008',D1.DOC_ID))                    AS TYPE4_DOC_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-008',D2.FILE_NAME))                 AS TYPE4_FILE_NAME
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-008',D1.CSD_CHG_ID))                AS TYPE4_CSD_CHG_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-008',D1.CSD_CHG_CMPT_YN))           AS TYPE4_CSD_CHG_CMPT_YN
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-001',D1.DOC_ID))                    AS TYPE5_DOC_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-001',D2.FILE_NAME))                 AS TYPE5_FILE_NAME
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-001',D1.CSD_CHG_ID))                AS TYPE5_CSD_CHG_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-001',D1.CSD_CHG_CMPT_YN))           AS TYPE5_CSD_CHG_CMPT_YN
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-006',D1.DOC_ID))                    AS TYPE6_DOC_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-006',D2.FILE_NAME))                 AS TYPE6_FILE_NAME
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-006',D1.CSD_CHG_ID))                AS TYPE6_CSD_CHG_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-006',D1.CSD_CHG_CMPT_YN))           AS TYPE6_CSD_CHG_CMPT_YN
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-004',D1.DOC_ID))                    AS TYPE7_DOC_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-004',D2.FILE_NAME))                 AS TYPE7_FILE_NAME
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-004',D1.CSD_CHG_ID))                AS TYPE7_CSD_CHG_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-004',D1.CSD_CHG_CMPT_YN))           AS TYPE7_CSD_CHG_CMPT_YN
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-009',D1.DOC_ID))                    AS TYPE8_DOC_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-009',D2.FILE_NAME))                 AS TYPE8_FILE_NAME
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-009',D1.CSD_CHG_ID))                AS TYPE8_CSD_CHG_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-009',D1.CSD_CHG_CMPT_YN))           AS TYPE8_CSD_CHG_CMPT_YN
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-005',D1.DOC_ID))                    AS TYPE9_DOC_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-005',D2.FILE_NAME))                 AS TYPE9_FILE_NAME
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-005',D1.CSD_CHG_ID))                AS TYPE9_CSD_CHG_ID
			                    , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-005',D1.CSD_CHG_CMPT_YN))           AS TYPE9_CSD_CHG_CMPT_YN      
					            , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-002',D2.FILE_ID)) AS TYPE1_FILE_ID 
					            , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-007',D2.FILE_ID)) AS TYPE2_FILE_ID 
					            , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-003',D2.FILE_ID)) AS TYPE3_FILE_ID 
					            , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-008',D2.FILE_ID)) AS TYPE4_FILE_ID 
					            , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-001',D2.FILE_ID)) AS TYPE5_FILE_ID 
					            , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-006',D2.FILE_ID)) AS TYPE6_FILE_ID 
					            , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-004',D2.FILE_ID)) AS TYPE7_FILE_ID 
					            , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-009',D2.FILE_ID)) AS TYPE8_FILE_ID 
					            , MAX(DECODE(D1.DOC_TYP_CD,'AD-AR-005',D2.FILE_ID)) AS TYPE9_FILE_ID    			                                  
			                 FROM TBBADDED021M D1
                                , ECM_FILE_LIST_VIEW2 D2 /* 뷰변경 - 2017.04.12 yyh */
			                WHERE 1=1
                              AND D1.DOC_ID = D2.DOC_ID
			                  AND D1.AUD_YR = #strAudYr#
			                GROUP BY D1.AUD_YR 
			                       , D1.AUD_NO
			         ) D2
			     WHERE 1=1
			       AND D1.AUD_YR = D2.AUD_YR(+)
			       AND D1.AUD_NO = D2.AUD_NO(+)
			       
			       /* 주석처리 - 2017.02.27 yyh */
			       /* AND D1.AUD_NO NOT LIKE '9%' */ /*서면모니터링을 걸러내야하므로*/
			       
                   AND D1.MNG_DPT_CD IN (SELECT DPT_CD FROM TABLE(F_AUTH_DEPT(#strCnb#, #dptAuth#, '', #strUpSpvBrdvCd#)))   /*직급이 원장일 경우 'ALL' 그외는 'DEPTLW'로 셋팅*/			       
			       
				   /* 주석처리 - 2015.03.05(유영호)  
				   AND SUBSTR(D1.AUD_KND_CD,3,1) NOT IN ('5','7','8') */  /*확인출장, 민원/손망실, 기타 제외*/
				   AND D1.BZT_BGT_DVSN_CD = '1' /*원배정인 자료만 나오도록 수정 2016.07.18 JSC*/
				   
		]]>
		<isNotEmpty property="strAudYr">	 
			   	   AND D1.AUD_YR      = #strAudYr#
		</isNotEmpty>
		<isNotEmpty property="strAudGrnNo">	 	
			       AND D1.AUD_GRN_NO  = #strAudGrnNo#
		</isNotEmpty>
		
		<isNotNull property="strAudYrNoKndCd">
			<isNotEmpty property="strAudYrNoKndCd">	 	
	              /* 감사연번종류코드 - 2015.12.22 yyh */
				  AND SUBSTR(D1.AUD_KND_CD,3,1) = #strAudYrNoKndCd# 
			</isNotEmpty>		
		</isNotNull>		
		
		<isNotEmpty property="strAudSbjNm">	 	   
			   	   AND D1.AUD_SBJ_NM LIKE '%'||#strAudSbjNm#||'%'
		</isNotEmpty>
		<isNotEmpty property="strPrssStepCd">	 
			       AND D1.PRSS_STEP_CD     = #strPrssStepCd#
		</isNotEmpty>
		<isNotEmpty property="strAudKndCd">	 
			       AND D1.AUD_KND_CD  = #strAudKndCd#
		</isNotEmpty>
		<isNotEmpty property="strSpvBrdvCd">	
				   /* 주관국과에서 관리국과로 변경 - 2016.07.05 yyh */ 
			       AND D1.MNG_DPT_CD = #strSpvBrdvCd#
		</isNotEmpty>   
		<isNotEmpty property="strReqDvsnCd">	 
			       AND D1.REQ_DVSN_CD = #strReqDvsnCd#
		</isNotEmpty>   
		<isEqual property="strYn" compareValue="01">
				   AND ((D2.TYPE1_DOC_ID IS NOT NULL) OR (D2.TYPE3_DOC_ID IS NOT NULL) OR (D2.TYPE5_DOC_ID IS NOT NULL) OR (D2.TYPE7_DOC_ID IS NOT NULL) OR ((D1.AUD_YR||D1.AUD_NO) IN (SELECT AUD_SLN FROM TBBADEAR028M) )) /*전체, HWP수록*/
		</isEqual>
		<isEqual property="strYn" compareValue="02">
				   AND ((D2.TYPE1_DOC_ID IS NOT NULL AND D2.TYPE2_DOC_ID IS NULL) OR (D2.TYPE3_DOC_ID IS NOT NULL AND D2.TYPE4_DOC_ID IS NULL) OR (D2.TYPE5_DOC_ID IS NOT NULL AND D2.TYPE6_DOC_ID IS NULL))  /*전체, CSD미수록*/
		</isEqual>
		<isEqual property="strYn" compareValue="03">
				   AND (((D2.TYPE1_DOC_ID IS NOT NULL) AND (D2.TYPE2_DOC_ID IS NOT NULL)) OR ((D2.TYPE3_DOC_ID IS NOT NULL) AND (D2.TYPE4_DOC_ID IS NOT NULL)) OR ((D2.TYPE5_DOC_ID IS NOT NULL) AND (D2.TYPE6_DOC_ID IS NOT NULL)) OR ((D2.TYPE7_DOC_ID IS NOT NULL) AND (D2.TYPE8_DOC_ID IS NOT NULL))) /*전체, HWP+CSD*/
		</isEqual>
		<isEqual property="strYn" compareValue="04">
				   AND ((D2.TYPE1_DOC_ID IS NULL) AND (D2.TYPE2_DOC_ID IS NULL) AND (D2.TYPE3_DOC_ID IS NULL) AND (D2.TYPE4_DOC_ID IS NULL) AND (D2.TYPE5_DOC_ID IS NULL) AND (D2.TYPE6_DOC_ID IS NULL) AND (D2.TYPE7_DOC_ID IS NULL) AND (D2.TYPE8_DOC_ID IS NULL) AND ((D1.AUD_YR||D1.AUD_NO) NOT IN (SELECT AUD_SLN FROM TBBADEAR028M) )) /*전체, 미수록*/
		</isEqual>
		<isEqual property="strYn" compareValue="10">
					AND ((D2.TYPE1_DOC_ID IS NOT NULL) OR (D2.TYPE3_DOC_ID IS NOT NULL))/*실지감사계획서 , 전체*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="11">
					AND (D2.TYPE1_DOC_ID IS NOT NULL) /*실지감사계획서 , HWP*/
		</isEqual>
		<isEqual property="strYn" compareValue="12">
					AND (D2.TYPE1_DOC_ID IS NOT NULL AND D2.TYPE2_DOC_ID IS NULL) /*실지감사계획서 , CSD미수록*/
		</isEqual>
		<isEqual property="strYn" compareValue="13">
					AND ((D2.TYPE1_DOC_ID IS NOT NULL) AND (D2.TYPE2_DOC_ID IS NOT NULL))/*실지감사계획서 , HWP+CSD*/
		</isEqual>
		<isEqual property="strYn" compareValue="14">
					AND ((D2.TYPE1_DOC_ID IS NULL) AND (D2.TYPE2_DOC_ID IS NULL))/*실지감사계획서 , 미수록*/
		</isEqual>
		<isEqual property="strYn" compareValue="20">
					AND ((D2.TYPE3_DOC_ID IS NOT NULL) OR (D2.TYPE4_DOC_ID IS NOT NULL))/*귀청보고서 , 전체*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="21">
					AND (D2.TYPE3_DOC_ID IS NOT NULL) /*귀청보고서 , HWP*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="22">
					AND (D2.TYPE3_DOC_ID IS NOT NULL AND D2.TYPE4_DOC_ID IS NULL) /*귀청보고서 , CSD*/
		</isEqual>
		<isEqual property="strYn" compareValue="23">
					AND ((D2.TYPE3_DOC_ID IS NOT NULL) AND (D2.TYPE4_DOC_ID IS NOT NULL))/*귀청보고서 , HWP+CSD*/
		</isEqual>
		<isEqual property="strYn" compareValue="24">
					AND ((D2.TYPE3_DOC_ID IS NULL) AND (D2.TYPE4_DOC_ID IS NULL))/*귀청보고서 , 미수록*/
		</isEqual>
		<isEqual property="strYn" compareValue="30">
					AND ((D2.TYPE5_DOC_ID IS NOT NULL) OR (D2.TYPE6_DOC_ID IS NOT NULL))/*감사결과보고서 , 전체*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="31">
					AND (D2.TYPE5_DOC_ID IS NOT NULL) /*감사결과보고서 , HWP*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="32">
					AND (D2.TYPE5_DOC_ID IS NOT NULL AND D2.TYPE6_DOC_ID IS NULL) /*감사결과보고서 , CSD*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="33">
					AND ((D2.TYPE5_DOC_ID IS NOT NULL) AND (D2.TYPE6_DOC_ID IS NOT NULL))/*감사결과보고서 , HWP+CSD*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="34">
					AND ((D2.TYPE5_DOC_ID IS NULL) AND (D2.TYPE6_DOC_ID IS NULL))/*감사결과보고서 , 미수록*/  
		</isEqual>
		<isEqual property="strYn" compareValue="40">
					AND ((D2.TYPE7_DOC_ID IS NOT NULL) OR (D2.TYPE8_DOC_ID IS NOT NULL))/*공개문1차변환 , 전체*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="41">
					AND (D2.TYPE7_DOC_ID IS NOT NULL) /*공개문1차변환 , HWP*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="42">
					AND (D2.TYPE8_DOC_ID IS NULL) /*공개문1차변환 , CSD*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="43">
					AND ((D2.TYPE7_DOC_ID IS NOT NULL) AND (D2.TYPE8_DOC_ID IS NOT NULL))/*공개문1차변환 , HWP+CSD*/
		</isEqual>
		<isEqual property="strYn" compareValue="44">
					AND ((D2.TYPE7_DOC_ID IS NULL) AND (D2.TYPE8_DOC_ID IS NULL))/*공개문1차변환 , 미수록*/  
		</isEqual>
		<isEqual property="strYn" compareValue="50">
					AND 1=1 /*홈페이지공개문 , 전체*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="51">
					AND (D1.AUD_YR||D1.AUD_NO) IN (SELECT AUD_SLN FROM TBBADEAR028M) /*홈페이지공개문 , HWP*/ 
		</isEqual>
		<isEqual property="strYn" compareValue="54">
					AND (D1.AUD_YR||D1.AUD_NO) NOT IN (SELECT AUD_SLN FROM TBBADEAR028M) /*홈페이지공개문 , 미수록*/   
		</isEqual>
					
        <![CDATA[       
			  ORDER BY D1.AUD_NO DESC
        ]]>
	</select>
	
	<!--파일업로드 insert-->
	<insert id="BADEAR001EFileUploadInsert" parameterClass="paramMap">
		<![CDATA[  
			INSERT
			  INTO TBBADDED021M( 
			       AUD_YR
			     , AUD_NO
			     , DOC_ID
			     , DOC_TYP_CD
			     , CSD_CHG_ID
			     , CSD_CHG_CMPT_YN
			     , FRT_USR_ID
			     , FNL_USR_ID
			     , FNL_DEAL_DPT_CD
			     , FNL_MNU_ID
			     , FRT_REGI_DH
			     , FNL_MDF_DH  
			)
			VALUES( #AUD_YR#
			     , #AUD_NO#
			     , #DOC_ID#
			     , #DOC_TYP_CD#
			     , #CSD_CHG_ID#
			     , #CSD_CHG_CMPT_YN#
			     , #FRT_USR_ID#
			     , #FNL_USR_ID#
			     , #FNL_DEAL_DPT_CD#
			     , #FNL_MNU_ID#
			     , SYSDATE
			     , SYSDATE 
			) 	
		]]>
	</insert>
	
	<!--파일업로드 update-->
	<update id="BADEAR001EFileUploadUpdate" parameterClass="paramMap">
		<![CDATA[ 	
			UPDATE TBBADDED021M
			   SET AUD_YR        = #AUD_YR# 
			     , AUD_NO        = #AUD_NO# 		
			     , DOC_ID        = #DOC_ID#
		]]>	 
		<isNotEmpty property="DOC_TYP_CD">	 	
			     , DOC_TYP_CD      = #DOC_TYP_CD#
		</isNotEmpty>		
		<isNotEmpty property="CSD_CHG_ID">	 	
			     , CSD_CHG_ID      = #CSD_CHG_ID#
			     , CSD_CHG_CMPT_YN = #CSD_CHG_CMPT_YN#  /*변환요청이 다시 일어나면 null로 업데이트 되어야 한다. */ 
		</isNotEmpty>				     
		<isNotEmpty property="CSD_CHG_CMPT_YN">	 	
			     , CSD_CHG_CMPT_YN      = #CSD_CHG_CMPT_YN#
		</isNotEmpty>
		<isNotNull  property="FNL_USR_ID">	       
			     , FNL_USR_ID      = #FNL_USR_ID#
		</isNotNull>	
		<isNotNull  property="FNL_DEAL_DPT_CD">	       
			     , FNL_DEAL_DPT_CD  = #FNL_DEAL_DPT_CD#
		</isNotNull>		
		<isNotNull  property="FNL_MNU_ID">	       
			     , FNL_MNU_ID        = #FNL_MNU_ID#
		</isNotNull>
		<![CDATA[ 	
				 , FNL_MDF_DH        = SYSDATE			
			  WHERE 1=1
			    AND AUD_YR = #AUD_YR# 
			    AND AUD_NO = #AUD_NO# 	
			    AND DOC_ID = #DOC_ID#
		]]>			    					        
	</update>	

	<!--파일업로드 delete-->
	<update id="BADEAR001EFileUploadDelete" parameterClass="paramMap">
		   DELETE 
			 FROM TBBADDED021M
			WHERE 1=1
			  AND AUD_YR = #AUD_YR# 
			  AND AUD_NO = #AUD_NO# 		
			  AND DOC_ID = #DOC_ID#
	</update>



	<select id="BADEAR001EFileInfoSelect" parameterClass="paramMap"
		resultClass="resultMap">
        <![CDATA[      
			SELECT AUD_YR
			     , AUD_NO
			     , DOC_ID
			     , DOC_TYP_CD
			     , CSD_CHG_ID
			     , CSD_CHG_CMPT_YN
			  FROM TBBADDED021M
			 WHERE 1=1
		]]>
		<isNotNull  property="AUD_YR">	
			   AND AUD_YR     = #AUD_YR#
		</isNotNull>
		<isNotNull  property="AUD_NO">
			   AND AUD_NO     = #AUD_NO#
		</isNotNull>
		<isNotNull  property="DOC_ID">			   
			   AND DOC_ID     = #DOC_ID#
		</isNotNull>
		<isNotNull  property="DOC_TYP_CD">	   
			   AND DOC_TYP_CD = #DOC_TYP_CD#
		</isNotNull>
		<isNotNull  property="CSD_CHG_ID">	   
			   AND CSD_CHG_ID = #CSD_CHG_ID#
		</isNotNull>	   
	</select>		   


	<update id="BADEAR001EExamApvSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBBADEAR028M
			SET		APV_DOC_NO = #APV_DOC_NO#
					,PRSS_STA_CD = '20'
					,WRIT_PEN_CNB = #S_CNB#
			WHERE	TSK_CAT_CD = #TSK_CAT_CD#
			AND		TSK_SNO = #TSK_SNO#
		]]>
	</update>
	
	<update id="BADEAR001EApvSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBBADEAR028M
			SET		PRL_SMT_DT = TO_CHAR(SYSDATE,'YYYYMMDD')		
					,PRL_SMT_YN = 'Y'
					,PRSS_STA_CD = '30'
			WHERE	APV_DOC_NO = #APV_DOC_NO#
		]]>
	</update>	
	
	<update id="BADEAR001EApvCancleUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBBADEAR028M
			SET		PRL_SMT_YN = 'N'
					,PRSS_STA_CD = '10'
			WHERE	APV_DOC_NO = #APV_DOC_NO#
		]]>
	</update>
	
	
	<select id="BADEAR001ETBBADEAR028MCheckSelect" parameterClass="paramMap" resultClass="Integer">
		<![CDATA[
			SELECT	COUNT(*)
			FROM	TBBADEAR028M
			WHERE	AUD_SLN = (	SELECT	AUD_YR||AUD_NO
								FROM	TBBADDED001M
								WHERE	APV_DOC_NO = #APV_DOC_NO#)
		]]>
	
	</select>
	
	<select id="BADEAR001ESelectDocId" parameterClass="paramMap" resultClass="String">
		<![CDATA[
			SELECT	DOC_ID
			FROM	TBBADDED021M
			WHERE	(AUD_YR,AUD_NO) IN (	SELECT	AUD_YR, AUD_NO
											FROM	TBBADDED001M
											WHERE	APV_DOC_NO = #APV_DOC_NO#)
			AND		DOC_TYP_CD = 'AD-AR-005'
		]]>
	</select>
	
	<insert id="BADEAR001EBADEAR047Insert" parameterClass="paramMap">
	<![CDATA[
	INSERT INTO TBBADEAR028M(
            TSK_CAT_CD 
            ,TSK_SNO
            ,REGI_DT
            ,REGI_HMS
            ,HNDL_DPT_CD
            ,AUD_SBJ_NM 
            ,AUD_SBJ_TXT
            ,DOC_TYP_CD_1 
            ,DOC_ID_1 
            ,DOC_TYP_CD_2 
            ,DOC_ID_2 
            ,OPEN_YN 
            ,AUD_SLN 
            ,AUD_SPH_CD 
            ,REL_ORG_CD 
            ,FRT_USR_ID 
            ,FNL_USR_ID 
            ,FNL_DEAL_DPT_CD 
            ,FNL_MNU_ID 
            ,FRT_REGI_DH
            ,FNL_MDF_DH
            )
            SELECT
                'KP1'
               ,#TSK_SNO#
               ,TO_CHAR(SYSDATE, 'YYYYMMDD')
               ,TO_CHAR(SYSDATE, 'HH24MISS')
               ,NULL
               ,AUD_SBJ_NM
               ,NULL
               ,'AD-AR-010'
               ,#DOC_ID_1# 
               ,NULL
               ,NULL 
               ,'N'
               ,AUD_YR||AUD_NO
               ,NULL
               ,NULL
               ,#FNL_USR_ID#
               ,#FNL_USR_ID# 
               ,#FNL_DEAL_DPT_CD#
               ,#FNL_MNU_ID# 
               ,SYSDATE
               ,SYSDATE
            FROM	TBBADDED001M
            WHERE  	APV_DOC_NO = #APV_DOC_NO#
	]]>
	</insert>
	
	<select id="BADEAR001ESubSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT 	D1.TSK_CAT_CD
			      	,D1.TSK_SNO
			      	,D1.AUD_SBJ_NM
			      	,D1.DOC_ID_1 AS DOC_ID
			      	,D1.OPEN_YN
			      	,D1.AUD_SLN
			      	,F_MNG_KND_AUDYRNO(D2.AUD_YR, D2.AUD_NO, D2.AUD_KND_CD, '-')  
			                                                        AS AUD_YR_N0   
					,D1.DGE
					,DECODE(D1.DGE,NULL,NULL,'홈페이지 공개문 '||D1.DGE||'차') AS DGE_NM					
					,(SELECT TO_CHAR(TO_DATE(MAX(ENF_DT)),'YYYY-MM-DD') 
                       FROM TBBADEAR002D S1 
                      WHERE S1.AUD_YR = D2.AUD_YR AND S1.AUD_NO = D2.AUD_NO) AS ENF_DT
                    ,TO_CHAR(TO_DATE(D1.PRL_SMT_DT),'YYYY-MM-DD') AS PRL_SMT_DT
                    , CASE WHEN D1.PRL_SMT_DT IS NOT NULL THEN TO_DATE(D1.PRL_SMT_DT) - (SELECT TO_DATE(MAX(ENF_DT)) 
                     																  FROM TBBADEAR002D S1 
                 																 WHERE S1.AUD_YR = D2.AUD_YR AND S1.AUD_NO = D2.AUD_NO)
   						ELSE TO_DATE(SYSDATE) - (SELECT TO_DATE(MAX(ENF_DT)) 
   						                           FROM TBBADEAR002D S1 
   						                          WHERE S1.AUD_YR = D2.AUD_YR AND S1.AUD_NO = D2.AUD_NO) END AS DAY_CNT /*시행일 이후 경과일수*/
					,TO_CHAR(TO_DATE(REGI_DT),'YYYY-MM-DD') AS REGI_DT
					,D1.APV_DOC_NO
					,NVL(D1.PRL_SMT_YN,'N') AS PRL_SMT_YN
					,D1.PRSS_STA_CD
					,F_CODE_NM('1000756',D1.PRSS_STA_CD) AS PRSS_STA_NM
			FROM	TBBADEAR028M D1
					,TBBADDED001M D2
			WHERE	AUD_SLN = #AUD_YR#||#AUD_NO#
			AND		D2.AUD_YR = SUBSTR(D1.AUD_SLN, 0, 4)
			AND		D2.AUD_NO = SUBSTR(D1.AUD_SLN, 5, 3)
		]]>
	</select>
	
	<insert id="BADEAR001E028Insert" parameterClass="paramMap">
	<![CDATA[
	INSERT INTO TBBADEAR028M(
            TSK_CAT_CD 
            ,TSK_SNO
            ,REGI_DT
            ,REGI_HMS
            ,HNDL_DPT_CD
            ,AUD_SBJ_NM 
            ,AUD_SBJ_TXT
            ,DOC_TYP_CD_1 
            ,DOC_ID_1 
            ,DOC_TYP_CD_2 
            ,DOC_ID_2 
            ,OPEN_YN 
            ,AUD_SLN 
            ,AUD_SPH_CD 
            ,REL_ORG_CD 
            ,FRT_USR_ID 
            ,FNL_USR_ID 
            ,FNL_DEAL_DPT_CD 
            ,FNL_MNU_ID 
            ,FRT_REGI_DH
            ,FNL_MDF_DH
            ,DGE
            ,PRL_SMT_YN
            ,PRSS_STA_CD
            )
            SELECT
                'KP1'
               ,(SELECT NVL(MAX(TO_NUMBER(TSK_SNO)),0)+1 FROM TBBADEAR028M)
               ,NULL
               ,NULL
               ,NULL
               ,AUD_SBJ_NM
               ,NULL
               ,'AD-AR-005'
               ,#DOC_ID# 
               ,NULL
               ,NULL 
               ,'N'
               ,AUD_YR||AUD_NO
               ,NULL
               ,NULL
               ,#FNL_USR_ID#
               ,#FNL_USR_ID# 
               ,#FNL_DEAL_DPT_CD#
               ,#FNL_MNU_ID# 
               ,SYSDATE
               ,SYSDATE
               ,(SELECT NVL(MAX(TO_NUMBER(DGE)),0)+1 FROM TBBADEAR028M WHERE AUD_SLN = #AUD_SLN#)
               ,'N'
               ,'10'
            FROM	TBBADDED001M
            WHERE  	AUD_YR||AUD_NO = #AUD_SLN#
	]]>
	</insert>
	
	<update id="BADEAR001E028Update" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBBADEAR028M
			SET		DOC_ID_1 = #DOC_ID#
					, FNL_USR_ID      = #FNL_USR_ID#
					, FNL_DEAL_DPT_CD  = #FNL_DEAL_DPT_CD#
					, FNL_MNU_ID        = #FNL_MNU_ID#
					, FNL_MDF_DH        = SYSDATE	
			WHERE	TSK_CAT_CD = #TSK_CAT_CD#
			AND		TSK_SNO = #TSK_SNO#
		]]>
	</update>
	
	<delete id="BADEAR001E028Delete" parameterClass="paramMap">
		<![CDATA[
			DELETE	
			FROM	TBBADEAR028M
			WHERE	TSK_CAT_CD = #TSK_CAT_CD#
			AND		TSK_SNO = #TSK_SNO#
		]]>
	</delete>
	
	<select id="BADEAR001PMainSelect2" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	DOC_ID_1 AS DOC_ID
					,F_MNG_KND_AUDYRNO(D2.AUD_YR, D2.AUD_NO, D2.AUD_KND_CD, '-')  
			                                                        AS AUD_YR_NO   
					,D1.AUD_SBJ_NM
			FROM	TBBADEAR028M D1
					,TBBADDED001M D2
			WHERE	1=1
		]]>
		<isNotEmpty property="strDOC_NO">
			AND D1.APV_DOC_NO = #strDOC_NO#
		</isNotEmpty>
		<isNotEmpty property="strTSK_CAT_CD">
			AND		D1.TSK_CAT_CD = #strTSK_CAT_CD#
			AND		D1.TSK_SNO = #strTSK_SNO#
		</isNotEmpty>
		<![CDATA[
			AND		D2.AUD_YR = SUBSTR(D1.AUD_SLN, 0, 4)
			AND		D2.AUD_NO = SUBSTR(D1.AUD_SLN, 5, 3)
		]]>
	</select>	
	
	<select id="selectAudInfoForMsg" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[	
			SELECT F_DPT_INFO(B.MNG_DPT_CD, '1') AS MNG_DPT_NM,
			       A.AUD_SBJ_NM,
			       (SELECT USR_DFN_TXT_2 FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000976' AND CD = '10' AND USE_YN = 'Y') AS RCPT_USR_CNB,
			       (SELECT USR_DFN_TXT_3 FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD = '1000976' AND CD = '10' AND USE_YN = 'Y') AS RCPT_USR_CNT
			FROM TBBADEAR028M A 
			INNER JOIN TBBADDED001M B ON (A.AUD_SLN = B.AUD_YR || B.AUD_NO)
			WHERE A.APV_DOC_NO = #APV_DOC_NO#
		]]>
	</select>
	
	
	<insert id="sendMessengerMsg" parameterClass="java.util.Map">
		<![CDATA[
 			INSERT INTO
	            TBDCMACM026L
	            (
	              MSG_SNO
	            , TSK_CAT_CD
	            , FUNC_CAT_CD
	            , SEND_ID
	            , MSG_TP_YN
	            , MSG_TXT_2
	            , RCNT_CNT
	            , RCNT_HIS
	            , MSG_REGI_DH
	            , FRT_USR_ID
	            , FNL_USR_ID
	            , FNL_DEAL_DPT_CD
	            , FNL_MNU_ID
	            , FRT_REGI_DH
	            , FNL_MDF_DH    
	            )
	            VALUES
	            (
	              (SELECT NVL(MAX(MSG_SNO),'0')+1 AS MSG_SNO FROM TBDCMACM026L)
	            , 'CM'
	            , 'CM'
	            , #SEND_ID#
	            , '0'
	            , #SEND_MSG#
	            , #RCPT_USR_CNT#
	            , #RCPT_USR_CNB#
	            , SYSDATE 
	            , #FNL_USR_ID#
	            , #FNL_USR_ID#
	            , #FNL_DEAL_DPT_CD#
	            , #FNL_MNU_ID#
	            , SYSDATE
	            , SYSDATE 
	            )
          ]]>
	</insert>
	
	
</sqlMap> 
