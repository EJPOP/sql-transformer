<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/qbo/161">
 
 	<select id="CSPQBO161EMainSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.WSH_BOO_SLN
					,A.BOO_TIT_NM
					,A.PBC_PLAC_NM
					,A.PBC_YR
					,A.ATR_NM
					,A.BOO_PUR_PR
					,A.PUR_COT
					,A.WSH_BOO_RMK
					,A.WSH_BOO_HNDL_STA_CD
					,F_CODE_NM('1000164',A.WSH_BOO_HNDL_STA_CD) AS WSH_BOO_HNDL_STA_NM
					,A.PUR_IPSB_RSN
					,A.APL_DT
					,A.APN_CNB
					,F_USR_INFO(A.APN_CNB,'2') AS APN_NAM
					,F_USR_INFO(A.APN_CNB,'1') AS APN_ID
					,F_USR_INFO(A.APN_CNB,'5') AS APN_DPT_CD
					,F_DPT_INFO(F_USR_INFO(A.APN_CNB,'5'),'1') AS APN_DPT_NM
					,NVL(A.WHS_NOTC_YN,'N') WHS_NOTC_YN
					,COPT_CAT_CD
			FROM	TBCSPQBO004M A		/*도서자료기본*/
			WHERE	1=1
			
		]]> 
		<dynamic>
			<isNotEmpty property="strCOPT_CAT_CD">
				AND		A.COPT_CAT_CD = #strCOPT_CAT_CD#
			</isNotEmpty>
			<isNotEmpty property="strWSH_BOO_HNDL_STA_CD">
				AND	A.WSH_BOO_HNDL_STA_CD = #strWSH_BOO_HNDL_STA_CD# 
			</isNotEmpty>
			<isNotEmpty property="strAPL_DTS">
				AND	A.APL_DT &gt;= #strAPL_DTS#
			</isNotEmpty>
			<isNotEmpty property="strAPL_DTE">
				AND	A.APL_DT &lt;= #strAPL_DTE#
			</isNotEmpty>
			<isNotEmpty property="strAPN_NAM">
				AND	A.APN_CNB IN (SELECT CNB FROM TBDCMACM001M WHERE USR_NAM LIKE '%'||#strAPN_NAM#||'%')
			</isNotEmpty>
			<isNotEmpty property="strPBC_PLAC_NM">
				AND	A.PBC_PLAC_NM LIKE '%'||#strPBC_PLAC_NM#||'%'
			</isNotEmpty>
			<isNotEmpty property="strATR_NM">
				AND	A.ATR_NM LIKE '%'||#strATR_NM#||'%'
			</isNotEmpty>
			<isNotEmpty property="strBOO_TIT_NM">
				AND	A.BOO_TIT_NM LIKE '%'||#strBOO_TIT_NM#||'%'
			</isNotEmpty>
			<isNotEmpty property="strAPN_CNB">
				AND	A.APN_CNB  = #strAPN_CNB#
			</isNotEmpty>
		</dynamic>
		<![CDATA[ 
			ORDER BY TO_NUMBER(A.WSH_BOO_SLN) DESC
		]]> 
	</select>
	
	<select id="CSPQBO161EKeySelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT 	TO_CHAR(NVL(MAX(TO_NUMBER(WSH_BOO_SLN))+1,1)) AS WSH_BOO_SLN
			FROM	TBCSPQBO004M
			WHERE	COPT_CAT_CD = #COPT_CAT_CD#
		]]> 
	</select>
	
	<insert id="CSPQBO161EMainInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO TBCSPQBO004M
					(	
						WSH_BOO_SLN
						,BOO_TIT_NM
						,PBC_PLAC_NM
						,PBC_YR
						,ATR_NM
						,BOO_PUR_PR
						,PUR_COT
						,WSH_BOO_RMK
						,WSH_BOO_HNDL_STA_CD
						,APL_DT
						,APN_CNB
						,WHS_NOTC_YN
						,FRT_USR_ID
						,FNL_USR_ID
						,FNL_DEAL_DPT_CD
						,FNL_MNU_ID
						,FRT_REGI_DH
						,FNL_MDF_DH
						,COPT_CAT_CD
					)
				VALUES 	(
							#WSH_BOO_SLN#
							,#BOO_TIT_NM#
							,#PBC_PLAC_NM#
							,#PBC_YR#
							,#ATR_NM#
							,#BOO_PUR_PR#
							,#PUR_COT#
							,#WSH_BOO_RMK#
							,'0'
							,#APL_DT#
							,#APN_CNB#
							,'N'
							,#FRT_USR_ID#
							,#FNL_USR_ID#
							,#FNL_DEAL_DPT_CD#
							,#FNL_MNU_ID#
							,SYSDATE
							,SYSDATE
							,#COPT_CAT_CD#
						)
		]]> 
	</insert>
	
	<update id="CSPQBO161EMainUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPQBO004M
			SET		BOO_TIT_NM = #BOO_TIT_NM#
					,PBC_PLAC_NM = #PBC_PLAC_NM#
					,PBC_YR = #PBC_YR#
					,ATR_NM = #ATR_NM#
					,BOO_PUR_PR = #BOO_PUR_PR#
					,PUR_COT = #PUR_COT#
					,WSH_BOO_RMK = #WSH_BOO_RMK#
					,APL_DT = #APL_DT#
					,APN_CNB = #APN_CNB#
					,FNL_USR_ID = #FNL_USR_ID#
					,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
					,FNL_MNU_ID = #FNL_MNU_ID#
					,FNL_MDF_DH = SYSDATE
					,WSH_BOO_HNDL_STA_CD = #WSH_BOO_HNDL_STA_CD#
					,PUR_IPSB_RSN = #PUR_IPSB_RSN#
			WHERE	WSH_BOO_SLN = #WSH_BOO_SLN#
			AND		COPT_CAT_CD = #COPT_CAT_CD#
		]]> 
	</update>
	
	<delete id="CSPQBO161EMainDelete" parameterClass="paramMap">
		DELETE 
		FROM	TBCSPQBO004M
		WHERE	WSH_BOO_SLN = #WSH_BOO_SLN#
		AND		COPT_CAT_CD = #COPT_CAT_CD#
	</delete>
	
	<select id="CSPQBO161EReportSelect" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT	A.WSH_BOO_SLN
					,A.BOO_TIT_NM
					,A.PBC_PLAC_NM
					,A.ATR_NM
					,NVL(A.BOO_PUR_PR,0) AS BOO_PUR_PR
					,A.PUR_COT
					,F_CODE_NM('1000164',A.WSH_BOO_HNDL_STA_CD) AS WSH_BOO_HNDL_STA_NM
					,TO_CHAR(TO_DATE(A.APL_DT),'YYYY-MM-DD') AS APL_DT
					,F_USR_INFO(A.APN_CNB,'2') AS APN_NAM
					,F_DPT_INFO(F_USR_INFO(A.APN_CNB,'5'),'1') AS APN_DPT_NM
			FROM	TBCSPQBO004M A		/*도서자료기본*/
			WHERE	1=1
			AND		A.COPT_CAT_CD = #strCOPT_CAT_CD#
		]]> 
		<dynamic>
			<isNotEmpty property="strWSH_BOO_HNDL_STA_CD">
				AND	A.WSH_BOO_HNDL_STA_CD = #strWSH_BOO_HNDL_STA_CD# 
			</isNotEmpty>
			<isNotEmpty property="strAPL_DTS">
				AND	A.APL_DT &gt;= #strAPL_DTS#
			</isNotEmpty>
			<isNotEmpty property="strAPL_DTE">
				AND	A.APL_DT &lt;= #strAPL_DTE#
			</isNotEmpty>
			<isNotEmpty property="strAPN_NAM">
				AND	A.APN_CNB IN (SELECT CNB FROM TBDCMACM001M WHERE USR_NAM LIKE '%'||#strAPN_NAM#||'%')
			</isNotEmpty>
			<isNotEmpty property="strPBC_PLAC_NM">
				AND	A.PBC_PLAC_NM LIKE '%'||#strPBC_PLAC_NM#||'%'
			</isNotEmpty>
			<isNotEmpty property="strATR_NM">
				AND	A.ATR_NM LIKE '%'||#strATR_NM#||'%'
			</isNotEmpty>
			<isNotEmpty property="strBOO_TIT_NM">
				AND	A.BOO_TIT_NM LIKE '%'||#strBOO_TIT_NM#||'%'
			</isNotEmpty>
		</dynamic>
		<![CDATA[ 
			ORDER BY TO_NUMBER(A.WSH_BOO_SLN) DESC
		]]> 
	</select>
	
	<select id="CSPQBO161EReportSelect2" parameterClass="paramMap"
		resultClass="resultMap">
		<![CDATA[
			SELECT 	TO_CHAR(TO_DATE(#strAPL_DTS#),'YYYY-MM-DD') AS strAPL_DTS 
					, TO_CHAR(TO_DATE(#strAPL_DTE#),'YYYY-MM-DD') AS strAPL_DTE
					, #strAPN_NAM# AS strAPN_NAM
					, #strBOO_TIT_NM# AS strBOO_TIT_NM
					, #strPBC_PLAC_NM# AS strPBC_PLAC_NM
					, #strATR_NM# AS strATR_NM
					, NVL(F_CODE_NM('1000164',#strWSH_BOO_HNDL_STA_CD#),'전체') AS strWSH_BOO_HNDL_STA_CD
			FROM	DUAL  
			WHERE	1=1
		]]> 
	</select>
	
	<update id="CSPQBO162PMsgSendOkUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE	TBCSPQBO004M
			SET		WHS_NOTC_YN = 'Y'
			WHERE	WSH_BOO_SLN = #WSH_BOO_SLN#
			AND		COPT_CAT_CD = #COPT_CAT_CD#
		]]>
	</update>
</sqlMap> 
