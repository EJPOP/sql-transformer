<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="bad/cmr/027">

	<!-- 모니터링 전담자 조회한다. -->
	<select id="BADCMR027Emainselect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[   
			SELECT F_DPT_INFO(CHGR_BLT_BRDV_CD, '1') AS CHGR_BLT_BRDV_NM /*담당자소속국과코드*/
			     , F_DPT_INFO(DPT_CD, '1')           AS DPT_NM  /*현소속*/
			     , USR_NAM                           AS USR_NAM /*담당자 명*/
			     , CHGR_BLT_BRDV_CD 
			     , CHGR_CNB
			     , ''                                AS CHANGE_CNB
			  FROM (
			    SELECT CHGR_BLT_BRDV_CD
			         , CHGR_CNB
			         , F_USR_INFO(CHGR_CNB, '2') AS USR_NAM
			         , F_USR_INFO(CHGR_CNB, '5') AS DPT_CD
			      FROM TBBADCMR015M
			    )
			WHERE 1 = 1
		]]>
		<isNotEmpty property="strDptCd">
			AND CHGR_BLT_BRDV_CD LIKE SUBSTR(#strDptCd#, 0, 2) || '%' 
		</isNotEmpty>
		<isNotEmpty property="strDiffDptCd">
			AND CHGR_BLT_BRDV_CD != DPT_CD
		</isNotEmpty>
		<![CDATA[  
			ORDER BY CHGR_BLT_BRDV_CD
		]]> 
	</select>

	<!-- 전담자 변경한다 -->
	<update id="BADCMR027Emainupdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBBADCMR015M
			   SET FNL_MDF_DH        = SYSDATE
			     , CHGR_CNB          = #CHANGE_CNB#
		]]>
		<isNotEmpty prepend="," property="FNL_USR_ID">
			FNL_USR_ID = #FNL_USR_ID#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_DEAL_DPT_CD">
			FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		</isNotEmpty>
		<isNotEmpty prepend="," property="FNL_MNU_ID">
			FNL_MNU_ID = #FNL_MNU_ID#
		</isNotEmpty>
		<![CDATA[		
			 WHERE CHGR_BLT_BRDV_CD = #CHGR_BLT_BRDV_CD#
		]]>
	</update>
        
</sqlMap> 
