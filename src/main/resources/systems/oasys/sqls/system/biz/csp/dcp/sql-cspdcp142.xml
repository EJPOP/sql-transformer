<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/dcp/142">
 	
 	<select id="CSPDCP142QSelectReport1" parameterClass="paramMap"  resultClass="resultMap">
 		<![CDATA[
			SELECT 	DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS NM,
					AD || DECODE(AD, NULL, '', ',') ||DTL_AD AS AD, 
					DECODE(ZCD , NULL, '-', SUBSTR(ZCD, 0, 3) || ' - ' || SUBSTR(ZCD, 4, 6) ) AS ZCD
			FROM	TBCSPDCP101M A,
					TBCSPDCP301M B,
					TBCSPDCP201M C
			WHERE	1=1
			AND 	A.REQ_DVSN_CD = B.REQ_DVSN_CD
			AND		A.ACP_YR  = B.ACP_YR
			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
			AND 	A.REQ_DVSN_CD = C.REQ_DVSN_CD
			AND		A.ACP_YR  = C.ACP_YR
			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
			AND		A.REQ_DVSN_CD = '1'
			AND		B.CVPT_IFM_DVSN_CD IN ('A','B','F')
			AND		B.CVPT_OPM_APV_HNDL_STA_CD = '30'
		]]>
			<dynamic>
				<isNotEmpty property="WRIT_STA_CD">
					AND		A.CVPT_KND_CD = #WRIT_STA_CD#	
				</isNotEmpty>
				
				<isNotEmpty property="STARTDT">
					<isNotEmpty property="ENDDT">
						AND		TO_CHAR(B.ONR_APV_CMPT_DH,'YYYYMMDD') BETWEEN #STARTDT# AND #ENDDT#
					</isNotEmpty>
				</isNotEmpty>
				
				<isNotEmpty property="dptCd1">
					AND		A.ACP_DPT_CD = #dptCd1#
				</isNotEmpty>
				
				<isNotEmpty property="dptCd2">
					AND		C.HNDL_DPT_CD = #dptCd2#
				</isNotEmpty>
			</dynamic>
		<![CDATA[
			ORDER BY A.REQ_DVSN_CD, A.ACP_YR, A.CVPT_ACP_NO
		]]>
	</select>
	
 	<select id="CSPDCP142QSelectReport2" parameterClass="paramMap"  resultClass="resultMap">
 		<![CDATA[
			SELECT 	 NVL(B.ONR_OPM_NO, ' ') AS SRNO
					, D.TIT_NM AS TITLE
					,TO_CHAR(B.ONR_APV_CMPT_DH, 'YYYY.MM.DD') AS DD
					,DECODE(A.REQR_KND_CD,'1',A.CVPTR_NM,'2',A.RPST_PEN_NM,'3',A.RPST_PEN_NM,'4',A.CVPTR_NM) AS NM
					,'우편' AS REQR_KND_CD
					,F_CODE_NM('1000056', A.ACP_RUT_CD) AS WAY
					,F_CODE_NM('1000051',(SELECT CVPT_HNDL_DVSN_CD 
										  FROM TBCSPDCP205L 
										  WHERE REQ_DVSN_CD = A.REQ_DVSN_CD
										  AND ACP_YR = A.ACP_YR
										  AND CVPT_ACP_NO = A.CVPT_ACP_NO
										  AND SRNO = (	SELECT  MIN(SRNO)
														FROM 	TBCSPDCP205L X 
														WHERE	X.REQ_DVSN_CD = A.REQ_DVSN_CD
														AND		X.ACP_YR = A.ACP_YR
														AND		X.CVPT_ACP_NO = A.CVPT_ACP_NO
													  )
			                              )) AS ETC1
					,B.ACP_YR || '-민원-' || A.RM_CVPT_ACP_NO AS ETC2
			FROM	TBCSPDCP101M A,
					TBCSPDCP301M B,
					TBCSPDCP201M C,
					TBDCMACM101M D
			WHERE	1=1
			AND 	A.REQ_DVSN_CD = B.REQ_DVSN_CD
			AND		A.ACP_YR  = B.ACP_YR
			AND		A.CVPT_ACP_NO = B.CVPT_ACP_NO
			AND 	A.REQ_DVSN_CD = C.REQ_DVSN_CD
			AND		A.ACP_YR  = C.ACP_YR
			AND		A.CVPT_ACP_NO = C.CVPT_ACP_NO
			AND		B.ONR_DOC_MNG_CRD_ID = D.ONR_DOC_MNG_CRD_ID
			AND		A.REQ_DVSN_CD = '1'
			AND		B.CVPT_IFM_DVSN_CD IN ('A','B','F')
			AND		B.CVPT_OPM_APV_HNDL_STA_CD = '30'
		]]>
		
			<dynamic>
				<isNotEmpty property="WRIT_STA_CD">
					AND		A.CVPT_KND_CD = #WRIT_STA_CD#	
				</isNotEmpty>
				
				<isNotEmpty property="STARTDT">
					<isNotEmpty property="ENDDT">
					AND		TO_CHAR(B.ONR_APV_CMPT_DH,'YYYYMMDD') BETWEEN #STARTDT# AND #ENDDT#
					</isNotEmpty>
				</isNotEmpty>
				<isNotEmpty property="dptCd1">
					AND		A.ACP_DPT_CD = #dptCd1#
				</isNotEmpty>
				
				<isNotEmpty property="dptCd2">
					AND		C.HNDL_DPT_CD = #dptCd2#
				</isNotEmpty>
			</dynamic>
		<![CDATA[
			ORDER BY A.REQ_DVSN_CD, A.ACP_YR, A.RM_CVPT_ACP_NO
		]]>
	</select>
</sqlMap> 
