<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="dcm/acm/101">
	
	<insert id="DCMACM101OnnaraReceiveHistInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* DCMACM101OnnaraReceiveHistInsert */ TBDCMACM111H
		(
			RCPT_DT
			, RCPT_ID
			, TRNM_SYS_ID
			, TRNM_PEN_ID
			, TRNM_PEN_EML_AD
			, RCPT_SYS_ID
			, RCNT_ID
			, RCNT_EML_AD
			, TIT_NM
			, DOC_CRE_DH
			, ATT_FL_CNT
			, ADMN_INF_HNDL_NO
			, ONR_APV_DOC_NO
			, ONR_APV_HNDL_STA_CD
			, ATT_DOC_MDF_YN
			, ATT_DOC_MDF_DH
			, DRFT_TBD_MDF_YN
			, DRFT_TBD_MDF_DH
			, DRFT_TBD_TXT
			, DRFT_TBD_SYS_FL_NM
			, DRFT_TBD_FL_NM
			, DRFT_TBD_FL_DES
			, ADMN_INF_XML_SYS_FL_NM
			, ADMN_INF_XML_FL_NM
			, ADMN_INF_XML_FL_DES
			, ADMN_INF_XSL_SYS_FL_NM
			, ADMN_INF_XSL_FL_NM
			, ADMN_INF_XSL_FL_DES
			, ONR_DOC_MNG_CRD_ID
			, ONR_APV_CON_HNDL_STA_CD
			, ONR_APV_CON_ERR_TXT
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		VALUES
		(
			TO_CHAR(SYSDATE, 'YYYYMMDD')
			, #RCPT_ID#
			, #TRNM_SYS_ID#
			, #TRNM_PEN_ID#
			, #TRNM_PEN_EML_AD#
			, #RCPT_SYS_ID#
			, #RCNT_ID#
			, #RCNT_EML_AD#
			, #TIT_NM#
			, TO_DATE(#DOC_CRE_DH#, 'YYYY-MM-DD HH24:MI:SS')
			, #ATT_FL_CNT#
			, #ADMN_INF_HNDL_NO#
			, #ONR_APV_DOC_NO#
			, #ONR_APV_HNDL_STA_CD#
			, #ATT_DOC_MDF_YN#
			, TO_DATE(#ATT_DOC_MDF_DH#, 'YYYY-MM-DD HH24:MI:SS')
			, #DRFT_TBD_MDF_YN#
			, TO_DATE(#DRFT_TBD_MDF_DH#, 'YYYY-MM-DD HH24:MI:SS')
			, #DRFT_TBD_TXT#
			, #DRFT_TBD_SYS_FL_NM#
			, #DRFT_TBD_FL_NM#
			, #DRFT_TBD_FL_DES#
			, #ADMN_INF_XML_SYS_FL_NM#
			, #ADMN_INF_XML_FL_NM#
			, #ADMN_INF_XML_FL_DES#
			, #ADMN_INF_XSL_SYS_FL_NM#
			, #ADMN_INF_XSL_FL_NM#
			, #ADMN_INF_XSL_FL_DES#
			, #ONR_DOC_MNG_CRD_ID#
			, '0000'
			, NULL
			, 'BATCH'
			, 'BATCH'
			, 'BATCH'
			, 'BATCH'
			, SYSDATE
			, SYSDATE
		)
	]]>
	</insert>
	
	<insert id="OnnaraReceiveLineHistInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* OnnaraReceiveLineHistInsert */ TBDCMACM112H
		(
			RCPT_DT
			, RCPT_ID
			, APV_SRNO
			, APV_SEQ_NO
			, ONR_APV_DVSN_CD
			, ONR_APV_RSLT_CD
			, APVR_ID
			, APVR_NM
			, PST_NM
			, SU_SGN
			, ORG_NM
			, APV_OPIN
			, APV_DH
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		VALUES
		(
			TO_CHAR(SYSDATE, 'YYYYMMDD')
			, #RCPT_ID#
			, #APV_SRNO#
			, #APV_SEQ_NO#
			, #ONR_APV_DVSN_CD#
			, #ONR_APV_RSLT_CD#
			, #APVR_ID#
			, #APVR_NM#
			, #PST_NM#
			, #SU_SGN#
			, #ORG_NM#
			, #APV_OPIN#
			, TO_DATE(#APV_DH#, 'YYYY-MM-DD HH24:MI:SS')
			, 'BATCH'
			, 'BATCH'
			, 'BATCH'
			, 'BATCH'
			, SYSDATE
			, SYSDATE
		)
	]]>
	</insert>
	
	<insert id="OnnaraReceiveAttachFileHistInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* OnnaraReceiveAttachFileHistInsert */ TBDCMACM113H
		(
			RCPT_DT
			, RCPT_ID
			, ATT_DOC_SRNO
			, FL_RUT_NM
			, SYS_FL_NM
			, FL_NM
			, FL_DES
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		VALUES
		(
			TO_CHAR(SYSDATE, 'YYYYMMDD')
			, #RCPT_ID#
			, #ATT_DOC_SRNO#
			, #FL_RUT_NM#
			, #SYS_FL_NM#
			, #FL_NM#
			, #FL_DES#
			, 'BATCH'
			, 'BATCH'
			, 'BATCH'
			, 'BATCH'
			, SYSDATE
			, SYSDATE
		)
	]]>
	</insert>
	
	<select id="OnnaraReceiveChkDocId" parameterClass="paramMap" resultClass="int">
	<![CDATA[
		SELECT	/* OnnaraReceiveChkDocId */ COUNT(ONR_DOC_MNG_CRD_ID)
		FROM	TBDCMACM101M D1 
		WHERE	D1.ONR_DOC_MNG_CRD_ID = #ONR_DOC_MNG_CRD_ID#
	]]>
	</select>
	
	<update id="OnnaraActDocUpdateByDocId" parameterClass="paramMap">
	<![CDATA[
		UPDATE	/* OnnaraActDocUpdate */ TBDCMACM101M D1
		SET		D1.TIT_NM = #TIT_NM#
				, D1.DOC_CRE_DH = TO_DATE(#DOC_CRE_DH#, 'YYYY-MM-DD HH24:MI:SS')
				, D1.ATT_FL_CNT = #ATT_FL_CNT#
				, D1.ADMN_INF_HNDL_NO = #ADMN_INF_HNDL_NO#
				, D1.ONR_APV_DOC_NO = #ONR_APV_DOC_NO#
				, D1.ONR_APV_HNDL_STA_CD = #ONR_APV_HNDL_STA_CD#
				, D1.DRFT_DH = TO_DATE( (
						SELECT	D2.APV_DH
						FROM	TBDCMACM112H D2
						WHERE	D2.RCPT_DT = #RCPT_DT# 
						AND 	D2.RCPT_ID = #RCPT_ID#
						AND		D2.APV_SEQ_NO = (
									SELECT	MIN( D3.APV_SEQ_NO )
									FROM	TBDCMACM112H D3
									WHERE	D3.RCPT_DT = #RCPT_DT# 
									AND 	D3.RCPT_ID = #RCPT_ID#
								)
					), 'YYYY-MM-DD HH24:MI:SS')
				, D1.DRFT_TBD_TXT = #DRFT_TBD_TXT#
				, D1.FNL_APV_DH = TO_DATE( (
						SELECT	D2.APV_DH
						FROM	TBDCMACM112H D2
						WHERE	D2.RCPT_DT = #RCPT_DT# 
						AND 	D2.RCPT_ID = #RCPT_ID#
						AND		D2.APV_SEQ_NO = (
									SELECT	MAX( D3.APV_SEQ_NO )
									FROM	TBDCMACM112H D3
									WHERE	D3.RCPT_DT = #RCPT_DT# 
									AND 	D3.RCPT_ID = #RCPT_ID#
								)
					), 'YYYY-MM-DD HH24:MI:SS')
				, D1.FNL_USR_ID = 'BATCH'
				, D1.FNL_DEAL_DPT_CD = 'BATCH'
				, D1.FNL_MNU_ID = 'BATCH'
				, D1.FRT_REGI_DH = SYSDATE
				, D1.FNL_MDF_DH = SYSDATE
		WHERE	D1.ONR_DOC_MNG_CRD_ID = #ONR_DOC_MNG_CRD_ID#
	]]>
	</update>
	
	<delete id="OnnaraActLinesDeleteByDocId" parameterClass="paramMap">
	<![CDATA[
		DELETE FROM /* OnnaraActLinesDeleteByDocId */ TBDCMACM102L D1
		WHERE D1.ONR_DOC_MNG_CRD_ID = #ONR_DOC_MNG_CRD_ID#
	]]>
	</delete>
	
	<delete id="OnnaraActAttachDeleteByDocId" parameterClass="paramMap">
	<![CDATA[
		DELETE FROM /* OnnaraActAttachDeleteByDocId */ TBDCMACM103L D1
		WHERE D1.ONR_DOC_MNG_CRD_ID = #ONR_DOC_MNG_CRD_ID#
	]]>
	</delete>
	
	<insert id="OnnaraActInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* OnnaraActInsert */ TBDCMACM101M
		(
			ONR_DOC_MNG_CRD_ID
			, TIT_NM
			, DOC_CRE_DH
			, ATT_FL_CNT
			, ADMN_INF_HNDL_NO
			, ONR_APV_DOC_NO
			, ONR_APV_HNDL_STA_CD
			, DRFT_DH
			, DRFT_TBD_TXT
			, FNL_APV_DH
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT	ONR_DOC_MNG_CRD_ID
				, TIT_NM
				, DOC_CRE_DH
				, ATT_FL_CNT
				, ADMN_INF_HNDL_NO
				, ONR_APV_DOC_NO
				, ONR_APV_HNDL_STA_CD
				, TO_DATE( (
						SELECT	D2.APV_DH
						FROM	TBDCMACM112H D2
						WHERE	D2.RCPT_DT = #RCPT_DT# 
						AND 	D2.RCPT_ID = #RCPT_ID#
						AND		D2.APV_SEQ_NO = (
									SELECT	MIN( D3.APV_SEQ_NO )
									FROM	TBDCMACM112H D3
									WHERE	D3.RCPT_DT = #RCPT_DT# 
									AND 	D3.RCPT_ID = #RCPT_ID#
								)
					), 'YYYY-MM-DD HH24:MI:SS')
				, DRFT_TBD_TXT
				, TO_DATE( (
						SELECT	D2.APV_DH
						FROM	TBDCMACM112H D2
						WHERE	D2.RCPT_DT = #RCPT_DT# 
						AND 	D2.RCPT_ID = #RCPT_ID#
						AND		D2.APV_SEQ_NO = (
									SELECT	MAX( D3.APV_SEQ_NO )
									FROM	TBDCMACM112H D3
									WHERE	D3.RCPT_DT = #RCPT_DT# 
									AND 	D3.RCPT_ID = #RCPT_ID#
								)
					), 'YYYY-MM-DD HH24:MI:SS')
				, 'BATCH' AS FRT_USR_ID
				, 'BATCH' AS FNL_USR_ID
				, 'BATCH' AS FNL_DEAL_DPT_CD
				, 'BATCH' AS FNL_MNU_ID
				, SYSDATE AS FRT_REGI_DH
				, SYSDATE AS FNL_MDF_DH
		FROM	TBDCMACM111H D1 
		WHERE	D1.RCPT_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
		AND		D1.RCPT_ID = #RCPT_ID#
		AND		D1.ONR_DOC_MNG_CRD_ID = #ONR_DOC_MNG_CRD_ID#
	]]>
	</insert>
	
	<insert id="OnnaraActLineInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* OnnaraActLineInsert */ TBDCMACM102L
		(
			ONR_DOC_MNG_CRD_ID
			, APV_HIS_SRNO
			, APV_SEQ_NO
			, ONR_APV_DVSN_CD
			, ONR_APV_RSLT_CD
			, APVR_ID
			, APVR_NM
			, APV_OPIN
			, APV_DH
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT	#ONR_DOC_MNG_CRD_ID#
				, APV_SRNO
				, APV_SEQ_NO
				, ONR_APV_DVSN_CD
				, ONR_APV_RSLT_CD
				, APVR_ID
				, APVR_NM
				, APV_OPIN
				, APV_DH
				, 'BATCH' AS FRT_USR_ID
				, 'BATCH' AS FNL_USR_ID
				, 'BATCH' AS FNL_DEAL_DPT_CD
				, 'BATCH' AS FNL_MNU_ID
				, SYSDATE AS FRT_REGI_DH
				, SYSDATE AS FNL_MDF_DH
		FROM	TBDCMACM112H D1
		WHERE	D1.RCPT_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
		AND		D1.RCPT_ID = #RCPT_ID#
	]]>
	</insert>
	
	<insert id="OnnaraActAttachBodyInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* OnnaraActAttachBodyInsert */ TBDCMACM103L
		(
			ONR_DOC_MNG_CRD_ID
			, ONR_APV_FL_DVSN_CD
			, SRNO
			, FL_RUT_NM
			, SYS_FL_NM
			, FL_NM
			, FL_DES
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT	#ONR_DOC_MNG_CRD_ID#
				, 'A' AS ONR_APV_FL_DVSN_CD
				, 1
				, #FL_RUT_NM# AS FL_RUT_NM
				, DRFT_TBD_SYS_FL_NM AS SYS_FL_NM
				, DRFT_TBD_FL_NM AS FL_NM
				, DRFT_TBD_FL_DES AS FL_DES
				, 'BATCH' AS FRT_USR_ID
				, 'BATCH' AS FNL_USR_ID
				, 'BATCH' AS FNL_DEAL_DPT_CD
				, 'BATCH' AS FNL_MNU_ID
				, SYSDATE AS FRT_REGI_DH
				, SYSDATE AS FNL_MDF_DH
		FROM	TBDCMACM111H D1
		WHERE	D1.RCPT_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
		AND		D1.RCPT_ID = #RCPT_ID#
	]]>
	</insert>
	
	<insert id="OnnaraActAttachXMLInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* OnnaraActAttachXMLInsert */ TBDCMACM103L
		(
			ONR_DOC_MNG_CRD_ID
			, ONR_APV_FL_DVSN_CD
			, SRNO
			, FL_RUT_NM
			, SYS_FL_NM
			, FL_NM
			, FL_DES
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT	#ONR_DOC_MNG_CRD_ID#
				, 'C' AS ONR_APV_FL_DVSN_CD
				, 1 AS SRNO
				, #FL_RUT_NM# AS FL_RUT_NM
				, ADMN_INF_XML_SYS_FL_NM AS SYS_FL_NM
				, ADMN_INF_XML_FL_NM AS FL_NM
				, ADMN_INF_XML_FL_DES AS FL_DES
				, 'BATCH' AS FRT_USR_ID
				, 'BATCH' AS FNL_USR_ID
				, 'BATCH' AS FNL_DEAL_DPT_CD
				, 'BATCH' AS FNL_MNU_ID
				, SYSDATE AS FRT_REGI_DH
				, SYSDATE AS FNL_MDF_DH
		FROM	TBDCMACM111H D1
		WHERE	D1.RCPT_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
		AND		D1.RCPT_ID = #RCPT_ID#
		AND		D1.ADMN_INF_XML_SYS_FL_NM IS NOT NULL
	]]>
	</insert>
	
	<insert id="OnnaraActAttachXSLInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* OnnaraActAttachXSLInsert */ TBDCMACM103L
		(
			ONR_DOC_MNG_CRD_ID
			, ONR_APV_FL_DVSN_CD
			, SRNO
			, FL_RUT_NM
			, SYS_FL_NM
			, FL_NM
			, FL_DES
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT	#ONR_DOC_MNG_CRD_ID#
				, 'D' AS ONR_APV_FL_DVSN_CD
				, 1 AS SRNO
				, #FL_RUT_NM# AS FL_RUT_NM
				, ADMN_INF_XSL_SYS_FL_NM AS SYS_FL_NM
				, ADMN_INF_XSL_FL_NM AS FL_NM
				, ADMN_INF_XSL_FL_DES AS FL_DES
				, 'BATCH' AS FRT_USR_ID
				, 'BATCH' AS FNL_USR_ID
				, 'BATCH' AS FNL_DEAL_DPT_CD
				, 'BATCH' AS FNL_MNU_ID
				, SYSDATE AS FRT_REGI_DH
				, SYSDATE AS FNL_MDF_DH
		FROM	TBDCMACM111H D1
		WHERE	D1.RCPT_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
		AND		D1.RCPT_ID = #RCPT_ID#
		AND		D1.ADMN_INF_XSL_SYS_FL_NM IS NOT NULL 
	]]>
	</insert>
	
	<insert id="OnnaraActAttachInsert" parameterClass="paramMap">
	<![CDATA[
		INSERT INTO /* OnnaraActAttachInsert */ TBDCMACM103L
		(
			ONR_DOC_MNG_CRD_ID
			, ONR_APV_FL_DVSN_CD
			, SRNO
			, FL_RUT_NM
			, SYS_FL_NM
			, FL_NM
			, FL_DES
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			, FNL_MDF_DH
		)
		SELECT	#ONR_DOC_MNG_CRD_ID#
				, 'B' AS ONR_APV_FL_DVSN_CD
				, ATT_DOC_SRNO AS SRNO
				, FL_RUT_NM
				, SYS_FL_NM
				, FL_NM
				, FL_DES
				, 'BATCH' AS FRT_USR_ID
				, 'BATCH' AS FNL_USR_ID
				, 'BATCH' AS FNL_DEAL_DPT_CD
				, 'BATCH' AS FNL_MNU_ID
				, SYSDATE AS FRT_REGI_DH
				, SYSDATE AS FNL_MDF_DH
		FROM	TBDCMACM113H D1
		WHERE	D1.RCPT_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
		AND		D1.RCPT_ID = #RCPT_ID#
		AND		D1.FL_RUT_NM IS NOT NULL
	]]>
	</insert>
	
	<update id="OnnaraReveiveHistStatusUpdate" parameterClass="paramMap">
	<![CDATA[
		UPDATE	/* OnnaraReveiveHistStatusUpdate */ TBDCMACM111H D1
		SET		D1.ONR_APV_CON_HNDL_STA_CD = '9999'
				, FNL_USR_ID = 'BATCH'
				, FNL_DEAL_DPT_CD = 'BATCH'
				, FNL_MNU_ID = 'BATCH'
				, FRT_REGI_DH = SYSDATE
				, FNL_MDF_DH = SYSDATE
		WHERE	D1.RCPT_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
		AND		D1.RCPT_ID = #RCPT_ID#
		AND		D1.ONR_APV_CON_HNDL_STA_CD = '0000'
	]]>
	</update>
	
	<select id="OnnaraCSPDCP101CheckSelectByDocId" parameterClass="paramMap" resultClass="int">
	<![CDATA[
		SELECT	COUNT(*)
		FROM	TBCSPDCP301M D1
		WHERE	D1.ONR_DOC_MNG_CRD_ID = #ONR_DOC_MNG_CRD_ID#
	]]>
	</select>
	
	<update id="OnnaraCSPDCP101StatByDocIdUpdate" parameterClass="paramMap">
	<![CDATA[
		UPDATE	TBCSPDCP101M D1
		SET		D1.CVPT_HNDL_STA_CD = (	SELECT 	CASE WHEN D1.CVPT_WDW_DH IS NOT NULL THEN '70'
													WHEN  D2.CVPT_KND_DVSN_CD = '1' AND (	SELECT 	Z.CVPT_HNDL_DVSN_CD
																							FROM	TBCSPDCP205L Z
																							WHERE	D1.REQ_DVSN_CD = Z.REQ_DVSN_CD
																							AND		D1.ACP_YR = Z.ACP_YR
																							AND		D1.CVPT_ACP_NO = Z.CVPT_ACP_NO
																							AND		Z.SRNO = (	SELECT	MIN(SRNO)
																												FROM	TBCSPDCP205L X
																												WHERE	X.REQ_DVSN_CD = Z.REQ_DVSN_CD
																												AND		X.ACP_YR = Z.ACP_YR
																												AND		X.CVPT_ACP_NO = Z.CVPT_ACP_NO
																											)
																						) IN ('10','20','30') THEN '50'
													WHEN  D2.CVPT_KND_DVSN_CD = '2' THEN '60' 
													ELSE '60' END 
										FROM 	TBCSPDCP201M D2 
										WHERE	D1.REQ_DVSN_CD = D2.REQ_DVSN_CD
										AND		D1.ACP_YR = D2.ACP_YR
										AND		D1.CVPT_ACP_NO = D2.CVPT_ACP_NO )
				, D1.FNL_USR_ID = 'BATCH'
				, D1.FNL_DEAL_DPT_CD = 'BATCH'
				, D1.FNL_MNU_ID = 'BATCH'
				, D1.FNL_MDF_DH = SYSDATE
		WHERE	( D1.REQ_DVSN_CD, D1.ACP_YR, D1.CVPT_ACP_NO ) = (
							SELECT	D2.REQ_DVSN_CD, D2.ACP_YR, D2.CVPT_ACP_NO
							FROM	TBCSPDCP301M D2
							WHERE	D2.ONR_DOC_MNG_CRD_ID = #ONR_DOC_MNG_CRD_ID#
						)
	]]>
	</update>
</sqlMap>