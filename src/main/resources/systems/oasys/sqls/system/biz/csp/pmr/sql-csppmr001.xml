<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/pmr/001">

	<select id="CSPPMR003EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT A.CFR_RM_INSPC_RM_ID,
			       A.CFR_RM_INSPC_RM_SRCH_SEQ,
			       A.CFR_RM_INSPC_RNM,
			       TO_CHAR(NVL(A.RCV_NOP_CNT,0) ) || '명' AS RCV_NOP_CNT,
			       A.DES_TXT,
			       A.MNG_DPT_CD,
			       B.DPT_NM,
			       ( SELECT USR_NAM FROM TBDCMACM001M WHERE USR_ID = ADM_ID_1) AS NAM1,
			       DECODE(A.ADM_TNB_1, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1), A.ADM_TNB_1) AS TNB1,
			       ( SELECT USR_NAM FROM TBDCMACM001M WHERE USR_ID = ADM_ID_2) AS NAM2,
			       DECODE(A.ADM_TNB_2, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2), A.ADM_TNB_2) AS TNB2
			  FROM TBCSPPMR001M A, 
			       TBDCMACM002M B
			 WHERE 1=1
			   AND A.MNG_DPT_CD = B.DPT_CD(+)
               AND A.CFR_RM_INSPC_RM_DVSN_CD IN ('1','2')
			  ORDER BY A.CFR_RM_INSPC_RM_SRCH_SEQ
		]]>
	</select>
	
	<select id="CSPPMR003EDeleteCheck" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT COUNT(BOKG_APL_DH) AS CNT
			  FROM TBCSPPMR002M 
			 WHERE BOKG_DT >= (SELECT TO_CHAR(SYSDATE, 'YYYYMMDD') FROM DUAL)
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID# 
		]]>
	</select>
	
	<delete id="CSPPMR003EDelete" parameterClass="paramMap">
		<![CDATA[
			DELETE TBCSPPMR001M
			 WHERE 1 = 1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
		]]>
	</delete>
	
	<delete id="CSPPMR003E002Delete" parameterClass="paramMap">
		<![CDATA[
			DELETE TBCSPPMR002M
			 WHERE 1 = 1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
		]]>
	</delete>
	
	<update id="CSPPMR003EUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBCSPPMR001M
			   SET CFR_RM_INSPC_RM_SRCH_SEQ = #CFR_RM_INSPC_RM_SRCH_SEQ#,
			  	   CFR_RM_INSPC_RNM = #CFR_RM_INSPC_RNM#,
			       FNL_USR_ID = #FNL_USR_ID#,
			       FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			       FNL_MNU_ID = #FNL_MNU_ID#,
			       FNL_MDF_DH = SYSDATE
			 WHERE 1 = 1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
		]]>
	</update>
	
	
	<select id="CSPPMR001EinitSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT YYYY AS CD, 
				       YYYY AS CDNM 
				  FROM (
				        SELECT TO_CHAR(SYSDATE,'YYYY') - LEVEL + 2 YYYY 
				          FROM DUAL 
				        CONNECT BY TO_CHAR(SYSDATE,'YYYY') - LEVEL + 2 >= 1980
				       )
		]]>
        
	</select>
	<select id="CSPPMR001EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[   	
SELECT C.CFR_RM_INSPC_RM_ID
     , C.CFR_RM_INSPC_RM_SRCH_SEQ
     , C.CFR_RM_INSPC_RNM
     , (CASE WHEN C.DAY1_TIME >='900' THEN '●' WHEN  C.DAY1_TIME < '900' THEN '△' ELSE '' END) DAY1 
     , (CASE WHEN C.DAY2_TIME >= '900' THEN '●' WHEN  C.DAY2_TIME < '900' THEN '△' ELSE '' END) DAY2 
     , (CASE WHEN C.DAY3_TIME >= '900' THEN '●' WHEN  C.DAY3_TIME < '900' THEN '△' ELSE '' END) DAY3
     , (CASE WHEN C.DAY4_TIME >= '900' THEN '●' WHEN  C.DAY4_TIME < '900' THEN '△' ELSE '' END) DAY4
     , (CASE WHEN C.DAY5_TIME >= '900' THEN '●' WHEN  C.DAY5_TIME < '900' THEN '△' ELSE '' END) DAY5 
     , (CASE WHEN C.DAY6_TIME >= '900' THEN '●' WHEN  C.DAY6_TIME < '900' THEN '△' ELSE '' END) DAY6 
     , (CASE WHEN C.DAY7_TIME >= '900' THEN '●' WHEN  C.DAY7_TIME < '900' THEN '△' ELSE '' END) DAY7 
     , (CASE WHEN C.DAY8_TIME >= '900' THEN '●' WHEN  C.DAY8_TIME < '900' THEN '△' ELSE '' END) DAY8 
     , (CASE WHEN C.DAY9_TIME >= '900' THEN '●' WHEN  C.DAY9_TIME < '900' THEN '△' ELSE '' END) DAY9 
     , (CASE WHEN C.DAY10_TIME >= '900' THEN '●' WHEN  C.DAY10_TIME < '900' THEN '△' ELSE '' END) DAY10 
     , (CASE WHEN C.DAY11_TIME >= '900' THEN '●' WHEN  C.DAY11_TIME < '900' THEN '△' ELSE '' END) DAY11 
     , (CASE WHEN C.DAY12_TIME >= '900' THEN '●' WHEN  C.DAY12_TIME < '900' THEN '△' ELSE '' END) DAY12 
     , (CASE WHEN C.DAY13_TIME >= '900' THEN '●' WHEN  C.DAY13_TIME < '900' THEN '△' ELSE '' END) DAY13 
     , (CASE WHEN C.DAY14_TIME >= '900' THEN '●' WHEN  C.DAY14_TIME < '900' THEN '△' ELSE '' END) DAY14 
     , (CASE WHEN C.DAY15_TIME >= '900' THEN '●' WHEN  C.DAY15_TIME < '900' THEN '△' ELSE '' END) DAY15 
     , (CASE WHEN C.DAY16_TIME >= '900' THEN '●' WHEN  C.DAY16_TIME < '900' THEN '△' ELSE '' END) DAY16 
     , (CASE WHEN C.DAY17_TIME >= '900' THEN '●' WHEN  C.DAY17_TIME < '900' THEN '△' ELSE '' END) DAY17 
     , (CASE WHEN C.DAY18_TIME >= '900' THEN '●' WHEN  C.DAY18_TIME < '900' THEN '△' ELSE '' END) DAY18 
     , (CASE WHEN C.DAY19_TIME >= '900' THEN '●' WHEN  C.DAY19_TIME < '900' THEN '△' ELSE '' END) DAY19
     , (CASE WHEN C.DAY20_TIME >= '900' THEN '●' WHEN  C.DAY20_TIME < '900' THEN '△' ELSE '' END) DAY20 
     , (CASE WHEN C.DAY21_TIME >= '900' THEN '●' WHEN  C.DAY21_TIME < '900' THEN '△' ELSE '' END) DAY21 
     , (CASE WHEN C.DAY22_TIME >= '900' THEN '●' WHEN  C.DAY22_TIME < '900' THEN '△' ELSE '' END) DAY22 
     , (CASE WHEN C.DAY23_TIME >= '900' THEN '●' WHEN  C.DAY23_TIME < '900' THEN '△' ELSE '' END) DAY23 
     , (CASE WHEN C.DAY24_TIME >= '900' THEN '●' WHEN  C.DAY24_TIME < '900' THEN '△' ELSE '' END) DAY24 
     , (CASE WHEN C.DAY25_TIME >= '900' THEN '●' WHEN  C.DAY25_TIME < '900' THEN '△' ELSE '' END) DAY25 
     , (CASE WHEN C.DAY26_TIME >= '900' THEN '●' WHEN  C.DAY26_TIME < '900' THEN '△' ELSE '' END) DAY26 
     , (CASE WHEN C.DAY27_TIME >= '900' THEN '●' WHEN  C.DAY27_TIME < '900' THEN '△' ELSE '' END) DAY27 
     , (CASE WHEN C.DAY28_TIME >= '900' THEN '●' WHEN  C.DAY28_TIME < '900' THEN '△' ELSE '' END) DAY28 
     , (CASE WHEN C.DAY29_TIME >= '900' THEN '●' WHEN  C.DAY29_TIME < '900' THEN '△' ELSE '' END) DAY29 
     , (CASE WHEN C.DAY30_TIME >= '900' THEN '●' WHEN  C.DAY30_TIME < '900' THEN '△' ELSE '' END) DAY30 
	  
	 , C.DAY1_1    
     , C.DAY2_1      
     , C.DAY3_1        
     , C.DAY4_1    
     , C.DAY5_1
     , C.DAY6_1
     , C.DAY7_1  
     , C.DAY8_1     
     , C.DAY9_1    
     , C.DAY10_1    
     , C.DAY11_1     
     , C.DAY12_1    
     , C.DAY13_1     
     , C.DAY14_1    
     , C.DAY15_1    
     , C.DAY16_1    
     , C.DAY17_1    
     , C.DAY18_1    
     , C.DAY19_1    
     , C.DAY20_1    
     , C.DAY21_1    
     , C.DAY22_1    
     , C.DAY23_1    
     , C.DAY24_1    
     , C.DAY25_1    
     , C.DAY26_1    
     , C.DAY27_1    
     , C.DAY28_1    
     , C.DAY29_1    
     , C.DAY30_1 
	 , C.RESERVE_USER_ID 
     
  FROM
(               SELECT   A.CFR_RM_INSPC_RM_ID
			            ,A.CFR_RM_INSPC_RM_SRCH_SEQ
					    ,A.CFR_RM_INSPC_RNM
					    ,B.RESERVE_USER_ID
					    ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT=#SELECTED_DAY# 
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY1_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#),'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY1_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +1,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY2_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +1,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY2_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +2,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY3_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +2,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY3_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +3,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A. CFR_RM_INSPC_RM_ID ) DAY4_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +3,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY4_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +4,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY5_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +4,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY5_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +5,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY6_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +5,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY6_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +6,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY7_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +6,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY7_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +7,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY8_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +7,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY8_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +8,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY9_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +8,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY9_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +9,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY10_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +9,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY10_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +10,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY11_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +10,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY11_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +11,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY12_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +11,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY12_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +12,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY13_TIME
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +12,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY13_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY14_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY14_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +14,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY15_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +14,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY15_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +15,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY16_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +15,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY16_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +16,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY17_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +16,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY17_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +17,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY18_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +17,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY18_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +18,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY19_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +18,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY19_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +19,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY20_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +19,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY20_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +20,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY21_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +20,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY21_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +21,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY22_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +21,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY22_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +22,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY23_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +22,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY23_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +23,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY24_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +23,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY24_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +24,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY25_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +24,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY25_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +25,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY26_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +25,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY26_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +26,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY27_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +26,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY27_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +27,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY28_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +27,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY28_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +28,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY29_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +28,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY29_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +29,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY30_TIME 
                        ,(SELECT COUNT(BOKG_PEN_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +29,'YYYYMMDD') AND BOKG_PEN_ID = #USER_ID#   AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY30_1
					    
			  FROM     TBCSPPMR001M A	/*회의실/조사실 관리 기본*/
				      ,TBCSPPMR002M B	/*회의실/조사실 예약 기본*/
			 WHERE   A.CFR_RM_INSPC_RM_ID = B.CFR_RM_INSPC_RM_ID(+) AND  A.CFR_RM_INSPC_RM_DVSN_CD IN ('1','2') AND B.RESERVE_USER_ID(+) =  #USER_ID# 
		]]>
			<dynamic>
				<isNotEmpty property="DVSN_CD">
			   AND   A.CFR_RM_INSPC_RM_DVSN_CD = #DVSN_CD#
				</isNotEmpty>
			</dynamic>
		<![CDATA[  
		 	 GROUP BY A.CFR_RM_INSPC_RM_ID ,A.CFR_RM_INSPC_RM_SRCH_SEQ ,A.CFR_RM_INSPC_RNM,B.RESERVE_USER_ID 
             ORDER BY A.CFR_RM_INSPC_RM_SRCH_SEQ
) C
 		]]>
        
	</select>
	
	
	
	<select id="CSPPMR001EMainHeaderSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT 
			CC.YYYYMMDD
			,CC.TOTALDAY
			,(CASE WHEN CC.TOTALDAY = (SELECT YE || MD FROM TBBADDED013B WHERE YE || MD = CC.TOTALDAY) THEN '1' ELSE '0' END) HOLIDAY
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#SELECTED_DAY#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#SELECTED_DAY#) +30,'YYYYMMDD')
					)
			)CC
		]]>
        
	</select>
	
	
		<select id="CSPPMR001EMainHeaderSelect2" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
		SELECT 
			CC.YYYYMMDD
			,CC.TOTALDAY
			,(CASE WHEN CC.TOTALDAY = (SELECT YE || MD FROM TBBADDED013B WHERE YE || MD = CC.TOTALDAY) THEN '1' ELSE '0' END) HOLIDAY
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#SELECTED_DAY#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#SELECTED_DAY#) +14,'YYYYMMDD')
					)
			)CC
		]]>
        
	</select>
	
	
	<select id="CSPPMR001EResvSubListSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT A.BOKG_APL_DH,
				       A.CFR_RM_INSPC_RM_ID,
				   	   B.CFR_RM_INSPC_RNM,
				   	   A.BOKG_PEN_ID AS USR_ID,
					   C.USR_NAM,
					   D.DPT_NM,
					   TO_CHAR(TO_DATE(A.BOKG_DT), 'YYYY-MM-DD') AS BOKG_DT,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24MI') AS STR_HM,
					   TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24MI') AS END_HM,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS HM,
					   A.TIT_NM,
					   A.DES_TXT,
					   A.RQS_SBJ_TXT,
					   A.TNB,
					   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_NM,
					   A.COFM_CD
				  FROM TBCSPPMR002M A,
				       TBCSPPMR001M B,
				       TBDCMACM001M C,
				       TBDCMACM002M D
				 WHERE 1=1
				   AND A.CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
				   AND A.CFR_RM_INSPC_RM_ID = B.CFR_RM_INSPC_RM_ID
				   AND A.BOKG_PEN_ID = C.USR_ID
				   AND C.DPT_CD = D.DPT_CD
				   AND BOKG_DT = #YYYYMMDD#  /* 예약일 */
				 ORDER BY  BOKG_APL_DH
		]]>
        
	</select>
	
		<select id="CSPPMR001EResvDuplicationCheckSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
				SELECT COUNT(A.CFR_RM_INSPC_RM_ID) AS CNT
				  FROM
				       (SELECT CFR_RM_INSPC_RM_ID FROM TBCSPPMR002M 
						 WHERE 1=1
						   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
						   AND BOKG_DT = REPLACE(#BOKG_DT#, '-', '')
						  /* AND COFM_CD = '1' */
				   		   AND (
		       					(STR_HM > #STR_HM# AND STR_HM < #END_HM#) OR 
		       					(STR_HM <= #STR_HM# AND END_HM >= #END_HM#) OR
		       					(END_HM > #STR_HM# AND END_HM < #END_HM#) OR 
		       					(STR_HM = #STR_HM# AND END_HM = #END_HM#)
		       				   )
						)A
		]]>
	</select>
	
	<select id="CSPPMR001EValidate" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(SYSDATE, 'YYYYMMDDHH24MI') AS VALIDATION
			  FROM DUAL
		]]>
	</select>
	
	
	<update id="CSPPMR001EUpdate" parameterClass="paramMap">
		UPDATE TBCSPPMR002M 
		   SET FNL_USR_ID = #FNL_USR_ID#
		    <isNotNull prepend="," property="FNL_DEAL_DPT_CD">
		       FNL_DEAL_DPT_CD      = #FNL_DEAL_DPT_CD#
		    </isNotNull>
		    <isNotNull prepend="," property="FNL_MNU_ID">
		       FNL_MNU_ID      = #FNL_MNU_ID#
		    </isNotNull>
		    <isNotNull prepend="," property="TNB">
		       TNB      = #TNB#
		    </isNotNull>
			<isNotNull prepend="," property="STR_HM">
		       STR_HM   = #STR_HM#
		    </isNotNull>
			<isNotNull prepend="," property="END_HM">
		       END_HM   = #END_HM#
		    </isNotNull>
			<isNotNull prepend="," property="TIT_NM">
		       TIT_NM   = #TIT_NM#
		    </isNotNull>
			<isNotNull prepend="," property="DES_TXT">
		       DES_TXT  = #DES_TXT#
		    </isNotNull>
			<isNotNull prepend="," property="RQS_SBJ_TXT">
		       RQS_SBJ_TXT = #RQS_SBJ_TXT#
		    </isNotNull>
		       ,FNL_MDF_DH      = SYSDATE
		 WHERE 1=1
		   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
		   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>
	
	<delete id="CSPPMR001EDelete" parameterClass="paramMap">
			DELETE FROM TBCSPPMR002M
			 WHERE 1 = 1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</delete>
	
	<insert id="CSPPMR001EResvInsert" parameterClass="paramMap">
        <![CDATA[       
				INSERT INTO TBCSPPMR002M
				(BOKG_APL_DH, 
				 CFR_RM_INSPC_RM_ID, 
				 BOKG_PEN_ID, TNB, 
				 BOKG_DT, 
				 STR_HM, END_HM, 
				 TIT_NM, DES_TXT,  
				 RQS_SBJ_TXT, 
				 COFM_CD,
				 FRT_REGI_DH,
				 FRT_USR_ID,
				 FNL_USR_ID,
				 FNL_DEAL_DPT_CD,
				 FNL_MNU_ID,
				 FNL_MDF_DH )
				VALUES
				(
				(SELECT 'RE'|| TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHHMMSSFF4') FROM DUAL),
				 #CFR_RM_INSPC_RM_ID#, 
				 #FRT_USR_ID#, #TNB#, 
				 #BOKG_DT#, 
				 #STR_HM#, #END_HM#, 
				 #TIT_NM#, #DES_TXT#, 
				 #RQS_SBJ_TXT#, 
				 '2',
				 SYSDATE,
				 #FRT_USR_ID#,
				 #FNL_USR_ID#,
				 #FNL_DEAL_DPT_CD#,
				 #FNL_MNU_ID#,
				 SYSDATE
				)
        ]]>
	</insert>
	
	<select id="CSPPMR002EinitSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT CD, CD_NM 
				  FROM
				      (select * from TBDCMACM013C where CMM_CD_DVSN_CD ='1000291' AND CD IN ('1', '2') )
				 ORDER BY CD
				 
		]]>
        
	</select>
	
	
	<select id="CSPPMR002EMainListSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT A.BOKG_APL_DH,
				       A.CFR_RM_INSPC_RM_ID,
				   	   B.CFR_RM_INSPC_RNM,
					   C.USR_NAM,
					   D.DPT_NM,
					   TO_CHAR(TO_DATE(A.BOKG_DT), 'YYYY-MM-DD') AS BOKG_DT,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') AS STR_HM,
					   TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS END_HM,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS HM,
					   TO_CHAR(TO_DATE(A.BOKG_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') || '  ' ||TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS YYYYMMDDHHMI,
					   A.TIT_NM,
					   A.DES_TXT,
					   A.RQS_SBJ_TXT,
					   A.TNB,
				   	   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_CD_NM,
				  	   (SELECT CD FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_CD
				  FROM TBCSPPMR002M A,
				       TBCSPPMR001M B,
				       TBDCMACM001M C,
				       TBDCMACM002M D
				 WHERE 1=1
				   AND A.CFR_RM_INSPC_RM_ID = B.CFR_RM_INSPC_RM_ID
				   AND A.BOKG_PEN_ID = C.USR_ID
				   AND C.DPT_CD = D.DPT_CD
				   AND B.CFR_RM_INSPC_RM_DVSN_CD IN ('1','2')
		]]>
			<dynamic>
				<isNotEmpty property="cbbDvsn">
			   		AND B.CFR_RM_INSPC_RM_DVSN_CD =#cbbDvsn# /*회의실조사실 구분*/
				</isNotEmpty>
			</dynamic>  		   
			<dynamic>
				<isNotEmpty property="rdbState">
			   		 AND A.COFM_CD = #rdbState# 	/* 상태값*/
				</isNotEmpty>
			</dynamic>  		   
			<dynamic>
				<isNotEmpty property="fromYmd">
			   		  AND A.BOKG_DT &gt;= #fromYmd#  
				</isNotEmpty>
			</dynamic>  		   
			<dynamic>
				<isNotEmpty property="toYmd">
			   		  AND A.BOKG_DT &lt;= #toYmd#  
				</isNotEmpty>			
			</dynamic>
		<![CDATA[
				 ORDER BY  BOKG_DT
		]]>
        
	</select>
	
	<delete id="CSPPMR002EDelete" parameterClass="paramMap">
			DELETE FROM TBCSPPMR002M
			 WHERE 1 = 1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</delete>

	<update id="CSPPMR002EApproveUpdate" parameterClass="paramMap">
		UPDATE TBCSPPMR002M 
			   SET COFM_CD = '1',
				   FNL_USR_ID = #FNL_USR_ID#,
			       FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			       FNL_MNU_ID = #FNL_MNU_ID#,
			       FNL_MDF_DH = SYSDATE
			 WHERE 1=1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>

	<update id="CSPPMR002ERejectUpdate" parameterClass="paramMap">
			UPDATE TBCSPPMR002M 
			   SET COFM_CD = '3',
			       FNL_USR_ID = #FNL_USR_ID#,
			       FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			       FNL_MNU_ID = #FNL_MNU_ID#,
			       FNL_MDF_DH = SYSDATE
			 WHERE 1=1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>
	
	<insert id="CSPPMR004PInsert" parameterClass="paramMap">
        <![CDATA[       
				INSERT INTO TBCSPPMR001M
				(
				CFR_RM_INSPC_RM_ID,
				CFR_RM_INSPC_RM_DVSN_CD,
				CFR_RM_INSPC_RNM,
				CFR_RM_INSPC_RM_SRCH_SEQ,
				RCV_NOP_CNT,
				DES_TXT,
				MNG_DPT_CD,
				ADM_ID_1,
				ADM_TNB_1,
				ADM_ID_2,
				ADM_TNB_2,
				DOC_ID,
				DOC_TYP_CD,
				USE_YN,
				FRT_USR_ID,
				FNL_USR_ID,
				FNL_DEAL_DPT_CD,
				FNL_MNU_ID,
				FRT_REGI_DH,
				FNL_MDF_DH
				)
				VALUES
				(
				 #CFR_RM_INSPC_RM_ID#,
				 #CFR_RM_INSPC_RM_DVSN_CD#,
				 #CFR_RM_INSPC_RNM#,
				 (SELECT NVL(MAX(CFR_RM_INSPC_RM_SRCH_SEQ), 0) + 1 FROM TBCSPPMR001M),
				 #RCV_NOP_CNT#,
				 #DES_TXT#,
				 #MNG_DPT_CD#,
				 #ADM_ID_1#,
				 #ADM_TNB_1#,
				 #ADM_ID_2#,
				 #ADM_TNB_2#,
				 #DOC_ID#,
				 #DOC_TYP_CD#,
				 'Y',
				 #FRT_USR_ID#,
				 #FNL_USR_ID#,
				 #FNL_DEAL_DPT_CD#,
				 #FNL_MNU_ID#,
				 SYSDATE,
				 SYSDATE
				 )
        ]]>
	</insert>
	
	
	<select id="CSPPMR004PSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT  A.CFR_RM_INSPC_RM_ID, 
						A.CFR_RM_INSPC_RM_DVSN_CD, 
						A.CFR_RM_INSPC_RNM, 
						A.CFR_RM_INSPC_RM_SRCH_SEQ, 
						A.RCV_NOP_CNT, 
						A.DES_TXT, 
						A.MNG_DPT_CD,
						(SELECT  DPT_NM FROM TBDCMACM002M WHERE DPT_CD = A.MNG_DPT_CD) AS MNG_DPT_NM, 
						A.ADM_ID_1,
						(SELECT USR_NAM FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1) AS ADM_NAM1,
						(SELECT CNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1) AS ADM_CNB1,
						DECODE(A.ADM_TNB_1, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1), A.ADM_TNB_1) AS ADM_TNB_1,
						A.ADM_ID_2, 
						(SELECT USR_NAM FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2) AS ADM_NAM2,
						(SELECT CNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2) AS ADM_CNB2,
						DECODE(A.ADM_TNB_2, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2), A.ADM_TNB_2) AS ADM_TNB_2,
						A.DOC_ID, 
						A.DOC_TYP_CD, 
						A.USE_YN, 
						A.FRT_USR_ID, 
						A.FNL_USR_ID, 
						A.FNL_DEAL_DPT_CD, 
						A.FNL_MNU_ID, 
						A.FRT_REGI_DH, 
						A.FNL_MDF_DH
				   FROM TBCSPPMR001M A
				  WHERE CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
		]]>
	</select>
	
	<update id="CSPPMR004PUpdate" parameterClass="paramMap">
		UPDATE TBCSPPMR001M 
		   SET CFR_RM_INSPC_RM_DVSN_CD = #CFR_RM_INSPC_RM_DVSN_CD#
		       ,CFR_RM_INSPC_RNM      = #CFR_RM_INSPC_RNM#
		       ,RCV_NOP_CNT   = #RCV_NOP_CNT#
		       ,DES_TXT   = #DES_TXT#
		       ,MNG_DPT_CD   = #MNG_DPT_CD#
		       ,ADM_ID_1  = #ADM_ID_1#
		       ,ADM_TNB_1 = #ADM_TNB_1# 
		       ,ADM_ID_2 = #ADM_ID_2#
		       ,ADM_TNB_2 = #ADM_TNB_2#
			   ,DOC_ID = #DOC_ID# 
			   ,DOC_TYP_CD = #DOC_TYP_CD#
		       ,FNL_USR_ID = #FNL_USR_ID#
		       ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		       ,FNL_MNU_ID = #FNL_MNU_ID#
		       ,FNL_MDF_DH = SYSDATE
		 WHERE 1=1
		   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
	</update>
	
	<select id="CSPPMR003SelectId" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT  A.DOC_ID
				   FROM TBCSPPMR001M A
				  WHERE CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
		]]>
	</select>
	
	<select id="CSPPMR004PSelectInit" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT 'RS'|| TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHHMMSSFF4') AS CFR_RM_INSPC_RM_ID FROM DUAL
		]]>
	</select>
	
	<insert id="CSPPMR002EMsg206Insert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO
			TBDCMACM026L
			(
			  MSG_SNO
			, TSK_CAT_CD
			, FUNC_CAT_CD
			, SEND_ID
	        , MSG_TP_YN
	  
	        , MSG_TXT_2
	        , RCNT_CNT
	        , RCNT_HIS
	        , MSG_REGI_DH
	
			, FRT_USR_ID
			, FNL_USR_ID
			, FNL_DEAL_DPT_CD
			, FNL_MNU_ID
			, FRT_REGI_DH
			,
			FNL_MDF_DH
	
			)
			VALUES
			(
			  (SELECT NVL(MAX(MSG_SNO),0)+1 FROM TBDCMACM026L)
			, 'SP'
			, 'MR'
			, #FNL_USR_ID#
	        , '0'
	     
	        , #MSG#
	        , 1
	        , #MSG_CNB#
	        , SYSDATE
	        
	        
			, #FNL_USR_ID#
			, #FNL_USR_ID#
			, #FNL_DEAL_DPT_CD#
			, #FNL_MNU_ID#
			, SYSDATE
			, SYSDATE
	
			);
			
		]]>
	</insert>
	
	<select id="CSPPMR002ESelectCnb" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT B.CNB
			  FROM TBCSPPMR002M A,
			  	   TBDCMACM001M B
			 WHERE A.BOKG_APL_DH = #BOKG_APL_DH#
			   AND A.CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   AND A.BOKG_PEN_ID = B.USR_ID  
		]]>
	</select>
	
	<select id="CSPPMR002EExcelExportSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[
			SELECT	B.CFR_RM_INSPC_RNM,
					D.DPT_NM,
					COUNT(*) AS CNT
			FROM	TBCSPPMR002M A,
					TBCSPPMR001M B,
					TBDCMACM001M C,
					TBDCMACM002M D
			WHERE	1=1
			AND		A.CFR_RM_INSPC_RM_ID = B.CFR_RM_INSPC_RM_ID
			AND		A.BOKG_PEN_ID = C.USR_ID
			AND		C.DPT_CD = D.DPT_CD
			AND		A.COFM_CD = '1'
            AND     B.CFR_RM_INSPC_RM_DVSN_CD IN ('1','2')
			AND		A.BOKG_DT BETWEEN #fromYmd# AND #toYmd#
			GROUP BY B.CFR_RM_INSPC_RNM, D.DPT_NM
			ORDER BY B.CFR_RM_INSPC_RNM, D.DPT_NM
		]]>
	</select>
	
	<select id="CSPPMR006EinitSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT YYYY AS CD, 
				       YYYY AS CDNM 
				  FROM (
				        SELECT TO_CHAR(SYSDATE,'YYYY') - LEVEL + 2 YYYY 
				          FROM DUAL 
				        CONNECT BY TO_CHAR(SYSDATE,'YYYY') - LEVEL + 2 >= 1980
				       )
		]]>
        
	</select>

	
	<select id="CSPPMR006EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[   	
SELECT C.CFR_RM_INSPC_RM_ID
     , C.CFR_RM_INSPC_RM_SRCH_SEQ
     , C.CFR_RM_INSPC_RNM
     , C.CFR_RM_INSPC_RM_DVSN_CD
     , (CASE WHEN C.DAY1_TIME >='900' THEN '●' || TO_CHAR(DAY1_COUNT) WHEN  C.DAY1_TIME < '900' THEN '△' || TO_CHAR(DAY1_COUNT)   ELSE CASE WHEN DAY1_COUNT > 0 THEN TO_CHAR(DAY1_COUNT) ELSE '' END END) DAY1 
     , (CASE WHEN C.DAY2_TIME >= '900' THEN '●' || TO_CHAR(DAY2_COUNT) WHEN  C.DAY2_TIME < '900' THEN '△' || TO_CHAR(DAY2_COUNT)   ELSE CASE WHEN DAY2_COUNT > 0 THEN TO_CHAR(DAY2_COUNT) ELSE '' END END) DAY2 
     , (CASE WHEN C.DAY3_TIME >= '900' THEN '●' || TO_CHAR(DAY3_COUNT) WHEN  C.DAY3_TIME < '900' THEN '△' || TO_CHAR(DAY3_COUNT)   ELSE CASE WHEN DAY3_COUNT > 0 THEN TO_CHAR(DAY3_COUNT) ELSE '' END END) DAY3
     , (CASE WHEN C.DAY4_TIME >= '900' THEN '●' || TO_CHAR(DAY4_COUNT) WHEN  C.DAY4_TIME < '900' THEN '△' || TO_CHAR(DAY4_COUNT)   ELSE CASE WHEN DAY4_COUNT > 0 THEN TO_CHAR(DAY4_COUNT) ELSE '' END END) DAY4
     , (CASE WHEN C.DAY5_TIME >= '900' THEN '●' || TO_CHAR(DAY5_COUNT) WHEN  C.DAY5_TIME < '900' THEN '△' || TO_CHAR(DAY5_COUNT)   ELSE CASE WHEN DAY5_COUNT > 0 THEN TO_CHAR(DAY5_COUNT) ELSE '' END END) DAY5 
     , (CASE WHEN C.DAY6_TIME >= '900' THEN '●' || TO_CHAR(DAY6_COUNT) WHEN  C.DAY6_TIME < '900' THEN '△' || TO_CHAR(DAY6_COUNT)   ELSE CASE WHEN DAY6_COUNT > 0 THEN TO_CHAR(DAY6_COUNT) ELSE '' END END) DAY6 
     , (CASE WHEN C.DAY7_TIME >= '900' THEN '●' || TO_CHAR(DAY7_COUNT) WHEN  C.DAY7_TIME < '900' THEN '△' || TO_CHAR(DAY7_COUNT)   ELSE CASE WHEN DAY7_COUNT > 0 THEN TO_CHAR(DAY7_COUNT) ELSE '' END END) DAY7 
     , (CASE WHEN C.DAY8_TIME >= '900' THEN '●' || TO_CHAR(DAY8_COUNT) WHEN  C.DAY8_TIME < '900' THEN '△' || TO_CHAR(DAY8_COUNT)   ELSE CASE WHEN DAY8_COUNT > 0 THEN TO_CHAR(DAY8_COUNT) ELSE '' END END) DAY8 
     , (CASE WHEN C.DAY9_TIME >= '900' THEN '●' || TO_CHAR(DAY9_COUNT) WHEN  C.DAY9_TIME < '900' THEN '△' || TO_CHAR(DAY9_COUNT)   ELSE CASE WHEN DAY9_COUNT > 0 THEN TO_CHAR(DAY9_COUNT) ELSE '' END END) DAY9 
     , (CASE WHEN C.DAY10_TIME >= '900' THEN '●' || TO_CHAR(DAY10_COUNT) WHEN  C.DAY10_TIME < '900' THEN '△'|| TO_CHAR(DAY10_COUNT)   ELSE CASE WHEN DAY10_COUNT > 0 THEN TO_CHAR(DAY10_COUNT) ELSE '' END END) DAY10 
     , (CASE WHEN C.DAY11_TIME >= '900' THEN '●' || TO_CHAR(DAY11_COUNT) WHEN  C.DAY11_TIME < '900' THEN '△'|| TO_CHAR(DAY11_COUNT)   ELSE CASE WHEN DAY11_COUNT > 0 THEN TO_CHAR(DAY11_COUNT) ELSE '' END END) DAY11 
     , (CASE WHEN C.DAY12_TIME >= '900' THEN '●' || TO_CHAR(DAY12_COUNT) WHEN  C.DAY12_TIME < '900' THEN '△'|| TO_CHAR(DAY12_COUNT)   ELSE CASE WHEN DAY12_COUNT > 0 THEN TO_CHAR(DAY12_COUNT) ELSE '' END END) DAY12 
     , (CASE WHEN C.DAY13_TIME >= '900' THEN '●' || TO_CHAR(DAY13_COUNT) WHEN  C.DAY13_TIME < '900' THEN '△'|| TO_CHAR(DAY13_COUNT)   ELSE CASE WHEN DAY13_COUNT > 0 THEN TO_CHAR(DAY13_COUNT) ELSE '' END END) DAY13 
     , (CASE WHEN C.DAY14_TIME >= '900' THEN '●' || TO_CHAR(DAY14_COUNT) WHEN  C.DAY14_TIME < '900' THEN '△'|| TO_CHAR(DAY14_COUNT)   ELSE CASE WHEN DAY14_COUNT > 0 THEN TO_CHAR(DAY14_COUNT) ELSE '' END END) DAY14 
	 
	 
	 , C.DAY1_1    
     , C.DAY2_1      
     , C.DAY3_1        
     , C.DAY4_1    
     , C.DAY5_1
     , C.DAY6_1
     , C.DAY7_1  
     , C.DAY8_1     
     , C.DAY9_1    
     , C.DAY10_1    
     , C.DAY11_1     
     , C.DAY12_1    
     , C.DAY13_1     
     , C.DAY14_1 
	 , C.RESERVE_USER_ID 
     
  FROM
(               SELECT   A.CFR_RM_INSPC_RM_ID
			            ,A.CFR_RM_INSPC_RM_SRCH_SEQ
					    ,A.CFR_RM_INSPC_RNM
					    ,A.CFR_RM_INSPC_RM_DVSN_CD
					    ,B.RESERVE_USER_ID
					    ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT=#SELECTED_DAY# 
                            AND (STR_HM >= '0900' OR END_HM >= '1800') AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY1_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT=#SELECTED_DAY# 
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY1_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#),'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY1_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +1,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY2_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +1,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY2_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +1,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY2_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +2,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY3_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +2,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY3_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +2,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY3_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +3,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A. CFR_RM_INSPC_RM_ID ) DAY4_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +3,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY4_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +3,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY4_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +4,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY5_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +4,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY5_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +4,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY5_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +5,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY6_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +5,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY6_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +5,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY6_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +6,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY7_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +6,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY7_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +6,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY7_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +7,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY8_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +7,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY8_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +7,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY8_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +8,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY9_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +8,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY9_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +8,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY9_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +9,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY10_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +9,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY10_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +9,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY10_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +10,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY11_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +10,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY11_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +10,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY11_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +11,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY12_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +11,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY12_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +11,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY12_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +12,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY13_TIME
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +12,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY13_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +12,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID# AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID  ) DAY13_1
                       ,(SELECT SUM(END_HM - STR_HM) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD')
                            AND (STR_HM >= '0900' OR END_HM >= '1800' ) AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY14_TIME 
					    ,(SELECT COUNT(*) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD')
                            AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY14_COUNT
                        ,(SELECT COUNT(RESERVE_USER_ID) FROM  TBCSPPMR002M 
                            WHERE 
                            BOKG_DT= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD') AND RESERVE_USER_ID = #USER_ID#  AND CFR_RM_INSPC_RM_ID = A.CFR_RM_INSPC_RM_ID ) DAY14_1
					    
			  FROM     TBCSPPMR001M A	/*회의실/조사실 관리 기본*/
				      ,TBCSPPMR002M B	/*회의실/조사실 예약 기본*/
			 WHERE   A.CFR_RM_INSPC_RM_ID = B.CFR_RM_INSPC_RM_ID(+) AND  A.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') AND B.RESERVE_USER_ID(+) =  #USER_ID#
		]]>
			<dynamic>
				<isNotEmpty property="DVSN_CD">
			   AND  A.CFR_RM_INSPC_RM_DVSN_CD = #DVSN_CD#
				</isNotEmpty>
			</dynamic>
		<![CDATA[  
			 GROUP BY A.CFR_RM_INSPC_RM_ID ,A.CFR_RM_INSPC_RM_SRCH_SEQ ,A.CFR_RM_INSPC_RNM,B.RESERVE_USER_ID ,A.CFR_RM_INSPC_RM_DVSN_CD
             ORDER BY A.CFR_RM_INSPC_RM_DVSN_CD, A.CFR_RM_INSPC_RM_SRCH_SEQ
) C
 		]]>
        
	</select>
	

		<select id="CSPPMR006EMainHeaderSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
		SELECT 
			CC.YYYYMMDD
			,CC.TOTALDAY
			,(CASE WHEN CC.TOTALDAY = (SELECT YE || MD FROM TBBADDED013B WHERE YE || MD = CC.TOTALDAY) THEN '1' ELSE '0' END) HOLIDAY
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)', 'NLS_DATE_LANGUAGE=korean') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#SELECTED_DAY#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#SELECTED_DAY#) +13,'YYYYMMDD')
					)
			)CC
		]]>
        
	</select>	



	<select id="CSPPMR006EResvSubListSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT A.BOKG_APL_DH,
				       A.CFR_RM_INSPC_RM_ID,
				   	   B.CFR_RM_INSPC_RNM,
				   	   A.BOKG_PEN_ID AS USR_ID,
					   C.USR_NAM,
					   D.DPT_NM,
					   TO_CHAR(TO_DATE(A.BOKG_DT), 'YYYY-MM-DD') AS BOKG_DT,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24MI') AS STR_HM,
					   TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24MI') AS END_HM,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS HM,
					   A.TIT_NM,
					   A.DES_TXT,
					   A.RQS_SBJ_TXT,
					   A.TNB,
					   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_NM,
					   A.COFM_CD, 
					   (CASE WHEN A.CHACUL_KBN ='Y' THEN A.USE_NM ELSE (SELECT USR_NAM FROM TBDCMACM001M  WHERE USR_ID = A.RESERVE_USER_ID)  END) AS USE_NM,
					   (SELECT CNB FROM TBDCMACM001M  WHERE USR_ID = A.RESERVE_USER_ID) AS RESERVE_CNB,					   
					   A.CHACUL_KBN
				  FROM TBCSPPMR002M A,
				       TBCSPPMR001M B,
				       TBDCMACM001M C,
				       TBDCMACM002M D
				 WHERE 1=1
				   AND A.CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
				   AND A.CFR_RM_INSPC_RM_ID = B.CFR_RM_INSPC_RM_ID
				   AND A.BOKG_PEN_ID = C.USR_ID
				   AND C.DPT_CD = D.DPT_CD
				   AND BOKG_DT = #YYYYMMDD#  /* 예약일 */
				 ORDER BY  BOKG_APL_DH
		]]>
        
	</select>
	
	<select id="CSPPMR006EValidate" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
			SELECT TO_CHAR(SYSDATE, 'YYYYMMDDHH24MI') AS VALIDATION
			  FROM DUAL
		]]>
	</select>
	
	<select id="CSPPMR006EValidate2" parameterClass="String"	resultClass="resultMap">
		<![CDATA[
			SELECT   TO_CHAR(TO_DATE(SYSDATE) + #valDayCnt#,'YYYYMMDD') AS VALIDATION
			  FROM DUAL
		]]>
	</select>
	<select id="CSPPMR006EValidate3" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
		SELECT COUNT(*) AS VALIDATION 
		FROM TBCSPPMR002M B ,
			( SELECT CFR_RM_INSPC_RM_ID,BOKG_DT,RESERVE_USER_ID 
				FROM TBCSPPMR002M A
			  WHERE BOKG_DT=#RESERVE_DAY#
			  AND RESERVE_USER_ID=#USER_ID# 
			  GROUP BY CFR_RM_INSPC_RM_ID, BOKG_DT, RESERVE_USER_ID ) A
        WHERE  B.BOKG_DT=A.BOKG_DT 
        AND B.RESERVE_USER_ID= A.RESERVE_USER_ID
        AND A.CFR_RM_INSPC_RM_ID <> #CFR_RM_INSPC_RM_ID# 
		]]>
		
	</select>
	<update id="CSPPMR006EUpdate" parameterClass="paramMap">
		UPDATE TBCSPPMR002M 
		   SET FNL_USR_ID = #FNL_USR_ID#
		    <isNotNull prepend="," property="FNL_DEAL_DPT_CD">
		       FNL_DEAL_DPT_CD      = #FNL_DEAL_DPT_CD#
		    </isNotNull>
		    <isNotNull prepend="," property="FNL_MNU_ID">
		       FNL_MNU_ID      = #FNL_MNU_ID#
		    </isNotNull>
			<isNotNull prepend="," property="STR_HM">
		       STR_HM   = #STR_HM#
		    </isNotNull>
			<isNotNull prepend="," property="END_HM">
		       END_HM   = #END_HM#
		    </isNotNull>
			<isNotNull prepend="," property="TIT_NM">
		       TIT_NM   = #TIT_NM#
		    </isNotNull>
			<isNotNull prepend="," property="DES_TXT">
		       DES_TXT  = #DES_TXT#
		    </isNotNull>
			<isNotNull prepend="," property="RQS_SBJ_TXT">
		       RQS_SBJ_TXT = #RQS_SBJ_TXT#
		    </isNotNull>
			<isNotNull prepend="," property="CHACUL_KBN">
		       CHACUL_KBN = #CHACUL_KBN#
		    </isNotNull>
			<isNotNull prepend="," property="USE_NM">
		       USE_NM = #USE_NM#
		    </isNotNull>
		    
		    <isNotNull prepend="," property="RESERVE_CNB">
		       RESERVE_USER_ID = (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = #RESERVE_CNB#)
		    </isNotNull>
		       ,FNL_MDF_DH      = SYSDATE
		       ,TNB      = (SELECT HOM_TNB FROM TBDCMACM001M WHERE CNB = #RESERVE_CNB#)
		 WHERE 1=1
		   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
		   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>
	
	<delete id="CSPPMR006EDelete" parameterClass="paramMap">
			DELETE FROM TBCSPPMR002M
			 WHERE 1 = 1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</delete>
	
	<insert id="CSPPMR006EResvInsert" parameterClass="paramMap">
        <![CDATA[       
				INSERT INTO TBCSPPMR002M
				(BOKG_APL_DH, 
				 CFR_RM_INSPC_RM_ID, 
				 BOKG_PEN_ID, TNB, 
				 BOKG_DT, 
				 STR_HM, END_HM, 
				 TIT_NM, DES_TXT,  
				 RQS_SBJ_TXT, 
				 COFM_CD,
				 DTM_DVSN_CD,
				 USE_NM,
				 CHACUL_KBN,
				 FRT_REGI_DH,
				 FRT_USR_ID,
				 FNL_USR_ID,
				 FNL_DEAL_DPT_CD,
				 FNL_MNU_ID,
				 FNL_MDF_DH,
				 RESERVE_USER_ID )
				VALUES
				(
				(SELECT 'RE'|| TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHHMMSSFF4') FROM DUAL),
				 #CFR_RM_INSPC_RM_ID#, 
				 CASE WHEN #CHACUL_KBN# = 'Y' THEN #FRT_USR_ID# ELSE (SELECT USR_ID FROM TBDCMACM001M  WHERE CNB = #RESERVE_CNB#) END
				, (SELECT HOM_TNB FROM TBDCMACM001M WHERE CNB = #RESERVE_CNB#), 
				 #BOKG_DT#, 
				 #STR_HM#, #END_HM#, 
				 #TIT_NM#, #DES_TXT#, 
				 #RQS_SBJ_TXT#, 
				 '1',
				 #COFM_CD#,
				 #USE_NM#,
				 #CHACUL_KBN#,
				 SYSDATE,
				 #FRT_USR_ID#,
				 #FNL_USR_ID#,
				 #FNL_DEAL_DPT_CD#,
				 #FNL_MNU_ID#,
				 SYSDATE,
				 (SELECT USR_ID FROM TBDCMACM001M  WHERE CNB = #RESERVE_CNB#)
				)
        ]]>
	</insert>
	
	<select id="CSPPMR006EResvDuplicationCheckSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
				SELECT COUNT(*) AS CNT
				  FROM
				       (SELECT CFR_RM_INSPC_RM_ID FROM TBCSPPMR002M 
						 WHERE 1=1
						   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
						   AND BOKG_DT = REPLACE(#BOKG_DT#, '-', '')
						   AND COFM_CD = '1'
				   		   AND (
		       					(STR_HM > #STR_HM# AND STR_HM < #END_HM#) OR 
		       					(STR_HM <= #STR_HM# AND END_HM >= #END_HM#) OR
		       					(END_HM > #STR_HM# AND END_HM < #END_HM#) OR 
		       					(STR_HM = #STR_HM# AND END_HM = #END_HM#)
		       				   )
						)A
		]]>
	</select>
	
	<select id="CSPPMR008EMainSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
			SELECT A.CFR_RM_INSPC_RM_ID,
			       A.CFR_RM_INSPC_RM_SRCH_SEQ,
			       SUBSTR(A.CFR_RM_INSPC_RNM,0,2) AS OFFICE_NM,
			       A.CFR_RM_INSPC_RNM,
			       TO_CHAR(NVL(A.RCV_NOP_CNT,0) ) || '명' AS RCV_NOP_CNT,
			       A.DES_TXT,
			       A.MNG_DPT_CD,
			       B.DPT_NM,
			       ( SELECT USR_NAM FROM TBDCMACM001M WHERE USR_ID = ADM_ID_1) AS NAM1,
			       DECODE(A.ADM_TNB_1, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1), A.ADM_TNB_1) AS TNB1,
			       ( SELECT USR_NAM FROM TBDCMACM001M WHERE USR_ID = ADM_ID_2) AS NAM2,
			       DECODE(A.ADM_TNB_2, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2), A.ADM_TNB_2) AS TNB2
			  FROM TBCSPPMR001M A, 
			       TBDCMACM002M B
			 WHERE 1=1
			   AND A.MNG_DPT_CD = B.DPT_CD(+)
               AND A.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2')
			  ORDER BY A.CFR_RM_INSPC_RM_DVSN_CD,A.CFR_RM_INSPC_RM_SRCH_SEQ
		]]>
	</select>
	
	
	<select id="CSPPMR007EExcelExportSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[  
		SELECT   A.BOKG_DT,
		 		 B.CFR_RM_INSPC_RNM,
		 		    (SELECT   COUNT(BOKG_DT)      FROM          
                        TBCSPPMR002M T1, TBCSPPMR001M T2
							WHERE	1=1
							AND		T1.CFR_RM_INSPC_RM_ID = T2.CFR_RM_INSPC_RM_ID 
				            AND     T2.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') AND T1.BOKG_DT= A.BOKG_DT) AS RESERV_CNT, /*예약자수*/
				     (SELECT   COUNT(BOKG_DT)      FROM          
                        TBCSPPMR002M T1, TBCSPPMR001M T2
							WHERE	1=1
							AND		T1.CFR_RM_INSPC_RM_ID = T2.CFR_RM_INSPC_RM_ID 
				            AND     T2.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') AND T1.BOKG_DT= A.BOKG_DT AND T1.CHECKIN_DH IS NOT NULL) AS USE_CNT, /*이용자수*/
            
					D.DPT_NM,                   
			        F_CODE_NM('1000173', C.RANK_CD) AS RANK_NAM,
					C.USR_NAM,
                    A.TIT_NM,
                    (CASE WHEN A.CHECKIN_DH  IS NULL THEN '이용 안함'  ELSE '' END) CHECKIN_DH 
			FROM	TBCSPPMR002M A,
					TBCSPPMR001M B,
					TBDCMACM001M C,
					TBDCMACM002M D
			WHERE	1=1
			AND		A.CFR_RM_INSPC_RM_ID = B.CFR_RM_INSPC_RM_ID
			AND		A.RESERVE_USER_ID  = C.USR_ID
			AND		C.DPT_CD = D.DPT_CD
            AND     B.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2')
           ]]> 
            <dynamic>
				<isNotEmpty property="cbbDvsn">
			   		   AND     B.CFR_RM_INSPC_RM_DVSN_CD = #cbbDvsn#
				</isNotEmpty>
			</dynamic>	
		<![CDATA[  
			AND		A.BOKG_DT BETWEEN  #toYmd# AND  #fromYmd#
			GROUP BY A.BOKG_DT, D.DPT_NM, C.USR_NAM, C.RANK_CD,A.TIT_NM,CHECKIN_DH,B.CFR_RM_INSPC_RNM
			ORDER BY A.BOKG_DT, D.DPT_NM
		]]>
	</select>
	
	<select id="CSPPMR007EMainListSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT A.BOKG_APL_DH,
				       A.CFR_RM_INSPC_RM_ID,
				   	   B.CFR_RM_INSPC_RNM,
					   C.USR_NAM,
					   D.DPT_NM,
					   TO_CHAR(TO_DATE(A.BOKG_DT), 'YYYY-MM-DD') AS BOKG_DT,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') AS STR_HM,
					   TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS END_HM,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS HM,
					   TO_CHAR(TO_DATE(A.BOKG_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') || '  ' ||TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS YYYYMMDDHHMI,
					   A.TIT_NM,
					   A.DES_TXT,
					   A.RQS_SBJ_TXT,
					   A.TNB,
				   	   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_CD_NM,
				  	   (SELECT CD FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_CD,
				  	   TO_CHAR(A.CHECKIN_DH,'HH24:MI') || ' ~ ' || TO_CHAR(A.CHECKOUT_DH,'HH24:MI') AS USING_HM,
					   A.USER_IP
				  FROM TBCSPPMR002M A,
				       TBCSPPMR001M B,
				       TBDCMACM001M C,
				       TBDCMACM002M D
				 WHERE 1=1
				   AND A.CFR_RM_INSPC_RM_ID = B.CFR_RM_INSPC_RM_ID
				   AND A.BOKG_PEN_ID = C.USR_ID
				   AND C.DPT_CD = D.DPT_CD
				   AND B.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') /*연락사무소 좌석조회 (회의실 조사실 제외)*/
		]]>
			<dynamic>
				<isNotEmpty property="cbbDvsn">
			   		AND B.CFR_RM_INSPC_RM_DVSN_CD =#cbbDvsn# /*좌석구분 구분*/
				</isNotEmpty>
			</dynamic>
			<dynamic>
				<isNotEmpty property="fromYmd">
			   		  AND A.BOKG_DT &gt;= #fromYmd#  
				</isNotEmpty>
			</dynamic>  		   
			<dynamic>
				<isNotEmpty property="toYmd">
			   		  AND A.BOKG_DT &lt;= #toYmd#  
				</isNotEmpty>
			</dynamic>
		<![CDATA[
				 ORDER BY  BOKG_DT DESC
		]]>
        
	</select>
	
	
	
	<delete id="CSPPMR007EDelete" parameterClass="paramMap">
			DELETE FROM TBCSPPMR002M
			 WHERE 1 = 1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</delete>

	<update id="CSPPMR007EApproveUpdate" parameterClass="paramMap">
		UPDATE TBCSPPMR002M 
			   SET COFM_CD = '1',
				   FNL_USR_ID = #FNL_USR_ID#,
			       FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			       FNL_MNU_ID = #FNL_MNU_ID#,
			       FNL_MDF_DH = SYSDATE
			 WHERE 1=1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>

	<update id="CSPPMR007ERejectUpdate" parameterClass="paramMap">
			UPDATE TBCSPPMR002M 
			   SET COFM_CD = '3',
			       FNL_USR_ID = #FNL_USR_ID#,
			       FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#,
			       FNL_MNU_ID = #FNL_MNU_ID#,
			       FNL_MDF_DH = SYSDATE
			 WHERE 1=1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>
	
	
	
	<select id="CSPPMR009EMainListSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT A.BOKG_APL_DH,
				       A.CFR_RM_INSPC_RM_ID,
				   	   B.CFR_RM_INSPC_RNM,
					   TO_CHAR(TO_DATE(A.BOKG_DT), 'YYYY-MM-DD') AS BOKG_DT,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') AS STR_HM,
					   TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS END_HM,
					   TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS HM,
					   TO_CHAR(TO_DATE(A.BOKG_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') || '  ' ||TO_CHAR(TO_DATE(A.STR_HM,'HH24MI'),'HH24:MI') || ' ~ ' || TO_CHAR(TO_DATE(A.END_HM,'HH24MI'),'HH24:MI') AS YYYYMMDDHHMI,
					   A.TIT_NM,
					   A.DES_TXT,
					   A.RQS_SBJ_TXT,
					   A.TNB,
				   	   (SELECT CD_NM FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_CD_NM,
				  	   (SELECT CD FROM TBDCMACM013C WHERE CMM_CD_DVSN_CD ='1000291' AND CD = A.COFM_CD) AS COFM_CD,
				  	   TO_CHAR(A.CHECKIN_DH,'HH24:MI') || ' ~ ' || TO_CHAR(A.CHECKOUT_DH,'HH24:MI') AS USING_HM,
					   A.USER_IP
				  FROM TBCSPPMR002M A,
				       TBCSPPMR001M B
				 WHERE 1=1
				   AND A.CFR_RM_INSPC_RM_ID = B.CFR_RM_INSPC_RM_ID
				   AND A.RESERVE_USER_ID  = (SELECT USR_ID FROM TBDCMACM001M WHERE CNB = #CNB# AND USR_NAM = #USR_NAM#)
				   AND B.CFR_RM_INSPC_RM_DVSN_CD NOT IN ('1','2') /*연락사무소 좌석조회 (회의실 조사실 제외)*/
				   AND TO_CHAR(TO_DATE(A.BOKG_DT, 'YYYY-MM-DD'), 'YYYY-MM-DD') >=  TO_CHAR(TO_DATE(SYSDATE, 'YYYY-MM-DD'), 'YYYY-MM-DD')
				 ORDER BY  BOKG_DT,STR_HM
		]]>
			
		
	</select>
	
	<select id="CSPPMR009EUsingUpdatePre" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT NVL(TO_CHAR(CHECKIN_DH,'HH24:MI'),0) AS CHECKIN_DH
				  FROM TBCSPPMR002M
				 WHERE 1=1
				   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   	   AND BOKG_APL_DH = #BOKG_APL_DH#
		]]>
			
		
	</select>
	
	<update id="CSPPMR009EUsingUpdate" parameterClass="paramMap">
			UPDATE TBCSPPMR002M 
			   SET 
			       USER_IP = #USER_IP#,
					<isEqual property="strTimeChk" compareValue="0">
					  	CHECKIN_DH = SYSDATE,
					</isEqual>
					<isEqual property="strTimeChk" compareValue="1">
						CHECKOUT_DH = SYSDATE,
					</isEqual>
			       FNL_MDF_DH = SYSDATE
					
			 WHERE 1=1
			   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
			   AND BOKG_APL_DH = #BOKG_APL_DH#
	</update>
	
	
	
	<insert id="CSPPMR010PInsert" parameterClass="paramMap">
        <![CDATA[       
				INSERT INTO TBCSPPMR001M
				(
				CFR_RM_INSPC_RM_ID,
				CFR_RM_INSPC_RM_DVSN_CD,
				CFR_RM_INSPC_RNM,
				CFR_RM_INSPC_RM_SRCH_SEQ,
				RCV_NOP_CNT,
				DES_TXT,
				MNG_DPT_CD,
				ADM_ID_1,
				ADM_TNB_1,
				ADM_ID_2,
				ADM_TNB_2,
				DOC_ID,
				DOC_TYP_CD,
				USE_YN,
				FRT_USR_ID,
				FNL_USR_ID,
				FNL_DEAL_DPT_CD,
				FNL_MNU_ID,
				FRT_REGI_DH,
				FNL_MDF_DH
				)
				VALUES
				(
				 #CFR_RM_INSPC_RM_ID#,
				 #CFR_RM_INSPC_RM_DVSN_CD#,
				 #CFR_RM_INSPC_RNM#,
				 (SELECT NVL(MAX(CFR_RM_INSPC_RM_SRCH_SEQ), 0) + 1 FROM TBCSPPMR001M),
				 1,
				 ' ',
				 #MNG_DPT_CD#,
				 #ADM_ID_1#,
				 #ADM_TNB_1#,
				 #ADM_ID_2#,
				 #ADM_TNB_2#,
				 #DOC_ID#,
				 #DOC_TYP_CD#,
				 'Y',
				 #FRT_USR_ID#,
				 #FNL_USR_ID#,
				 #FNL_DEAL_DPT_CD#,
				 #FNL_MNU_ID#,
				 SYSDATE,
				 SYSDATE
				 )
        ]]>
	</insert>
	
	
	<select id="CSPPMR010PSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[       
				SELECT  A.CFR_RM_INSPC_RM_ID, 
						A.CFR_RM_INSPC_RM_DVSN_CD, 
						A.CFR_RM_INSPC_RNM, 
						A.CFR_RM_INSPC_RM_SRCH_SEQ, 
						A.RCV_NOP_CNT, 
						A.DES_TXT, 
						A.MNG_DPT_CD,
						(SELECT  DPT_NM FROM TBDCMACM002M WHERE DPT_CD = A.MNG_DPT_CD) AS MNG_DPT_NM, 
						A.ADM_ID_1,
						(SELECT USR_NAM FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1) AS ADM_NAM1,
						(SELECT CNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1) AS ADM_CNB1,
						DECODE(A.ADM_TNB_1, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_1), A.ADM_TNB_1) AS ADM_TNB_1,
						A.ADM_ID_2, 
						(SELECT USR_NAM FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2) AS ADM_NAM2,
						(SELECT CNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2) AS ADM_CNB2,
						DECODE(A.ADM_TNB_2, NULL, (SELECT TNB FROM  TBDCMACM001M WHERE USR_ID = A.ADM_ID_2), A.ADM_TNB_2) AS ADM_TNB_2,
						A.DOC_ID, 
						A.DOC_TYP_CD, 
						A.USE_YN, 
						A.FRT_USR_ID, 
						A.FNL_USR_ID, 
						A.FNL_DEAL_DPT_CD, 
						A.FNL_MNU_ID, 
						A.FRT_REGI_DH, 
						A.FNL_MDF_DH
				   FROM TBCSPPMR001M A
				  WHERE CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
		]]>
	</select>
	
	<update id="CSPPMR010PUpdate" parameterClass="paramMap">
		UPDATE TBCSPPMR001M 
		   SET CFR_RM_INSPC_RM_DVSN_CD = #CFR_RM_INSPC_RM_DVSN_CD#
		       ,CFR_RM_INSPC_RNM      = #CFR_RM_INSPC_RNM#
		       ,RCV_NOP_CNT   = #RCV_NOP_CNT#
		       ,DES_TXT   = #DES_TXT#
		       ,MNG_DPT_CD   = #MNG_DPT_CD#
		       ,ADM_ID_1  = #ADM_ID_1#
		       ,ADM_TNB_1 = #ADM_TNB_1# 
		       ,ADM_ID_2 = #ADM_ID_2#
		       ,ADM_TNB_2 = #ADM_TNB_2#
			   ,DOC_ID = #DOC_ID# 
			   ,DOC_TYP_CD = #DOC_TYP_CD#
		       ,FNL_USR_ID = #FNL_USR_ID#
		       ,FNL_DEAL_DPT_CD = #FNL_DEAL_DPT_CD#
		       ,FNL_MNU_ID = #FNL_MNU_ID#
		       ,FNL_MDF_DH = SYSDATE
		 WHERE 1=1
		   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
	</update>
	
	
	<select id="CSPPMR006EAllDaySelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
		SELECT 
			CC.YYYYMMDD
			,CC.TOTALDAY
			,(CASE WHEN CC.TOTALDAY = (SELECT YE || MD FROM TBBADDED013B WHERE YE || MD = CC.TOTALDAY) THEN '1' ELSE '0' END) HOLIDAY
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)', 'NLS_DATE_LANGUAGE=korean') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#BOKG_DT#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#RESERVE_END_DAY#),'YYYYMMDD')
					)
			)CC
		]]>
        
	</select>	
	
	<insert id="CSPPMR006EResvInsertAll" parameterClass="paramMap">
        <![CDATA[       
				INSERT INTO TBCSPPMR002M
				(BOKG_APL_DH, 
				 CFR_RM_INSPC_RM_ID, 
				 BOKG_PEN_ID, TNB, 
				 BOKG_DT, 
				 STR_HM, END_HM, 
				 TIT_NM, DES_TXT,  
				 RQS_SBJ_TXT, 
				 COFM_CD,
				 DTM_DVSN_CD,
				 USE_NM,
				 CHACUL_KBN,
				 FRT_REGI_DH,
				 FRT_USR_ID,
				 FNL_USR_ID,
				 FNL_DEAL_DPT_CD,
				 FNL_MNU_ID,
				 FNL_MDF_DH,
				 RESERVE_USER_ID )
				VALUES
				(
				(SELECT 'RE'|| TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDHHMMSSFF4') FROM DUAL),
				 #CFR_RM_INSPC_RM_ID#, 
				 CASE WHEN #CHACUL_KBN#  ='Y' THEN #FRT_USR_ID# ELSE (SELECT USR_ID FROM TBDCMACM001M  WHERE CNB = #RESERVE_CNB#) END
				 , (SELECT HOM_TNB FROM TBDCMACM001M WHERE CNB = #RESERVE_CNB#), 
				 #BOKG_DT#, 
				 #STR_HM#, #END_HM#, 
				 #TIT_NM#, #DES_TXT#, 
				 #RQS_SBJ_TXT#, 
				 '1',
				 #COFM_CD#,
				 #USE_NM#,
				 #CHACUL_KBN#,
				 SYSDATE,
				 #FRT_USR_ID#,
				 #FNL_USR_ID#,
				 #FNL_DEAL_DPT_CD#,
				 #FNL_MNU_ID#,
				 SYSDATE,
				 (SELECT USR_ID FROM TBDCMACM001M  WHERE CNB = #RESERVE_CNB#)
				)
        ]]>
	</insert>
	
	<select id="CSPPMR006EResvDuplicationCheckAllSelect" parameterClass="paramMap"	resultClass="resultMap">
		<![CDATA[
				SELECT COUNT(*) AS CNT
				  FROM
				       (SELECT CFR_RM_INSPC_RM_ID FROM TBCSPPMR002M 
						 WHERE 1=1
						   AND CFR_RM_INSPC_RM_ID = #CFR_RM_INSPC_RM_ID#
						   AND BOKG_DT = REPLACE(#BOKG_DT#, '-', '')
						   AND COFM_CD = '1'
				   		   AND (
		       					(STR_HM > #STR_HM# AND STR_HM < #END_HM#) OR 
		       					(STR_HM <= #STR_HM# AND END_HM >= #END_HM#) OR
		       					(END_HM > #STR_HM# AND END_HM < #END_HM#) OR 
		       					(STR_HM = #STR_HM# AND END_HM = #END_HM#)
		       				   )
						)A
		]]>
	</select>
	<select id="CSPPMR006ESelectMaxDay" parameterClass="String"	resultClass="resultMap">
		<![CDATA[
		SELECT MAX(TOTALDAY) AS MAX_DAY FROM (
		SELECT 
			CC.TOTALDAY			
			 FROM
			(     
				SELECT TO_CHAR(DAYS, 'DD(DY)') AS YYYYMMDD
				,TO_CHAR(DAYS, 'YYYYMMDD') AS TOTALDAY
				  FROM(
					SELECT START_DAY + LEVEL -1 DAYS 
						FROM(
							SELECT TO_DATE(#SELECTED_DAY#,'YYYYMMDD') START_DAY
							FROM DUAL
							)
					CONNECT BY START_DAY + LEVEL - 1 <= TO_CHAR(TO_DATE(#SELECTED_DAY#) + 6,'YYYYMMDD')
					)
			)CC )
		]]>
        
	</select>	
	
</sqlMap> 
