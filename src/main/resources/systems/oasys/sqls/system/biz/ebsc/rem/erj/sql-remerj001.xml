<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="rem/erj/001">

	<!--처분요구목록 조회-->
	<select id="RESRCM002PMainSelect" parameterClass="paramMap" resultClass="resultMap">
        <![CDATA[       
			SELECT T1.RWD_YR
			      ,T1.DGE
			      ,T2.RWD_DVSN_CD
			      ,F_EBSC_CODE_NM('10000009',T2.RWD_DVSN_CD) AS RWD_DVSN_NM
			      ,T2.RWD_KND_CD
			      ,F_EBSC_CODE_NM('10000010',T2.RWD_KND_CD) AS RWD_KND_NM
			      ,T2.RWD_KND_DTL_CD
			      ,F_EBSC_CODE_NM('10000019',T2.RWD_KND_DTL_CD) AS RWD_KND_DTL_NM
			      ,T2.DPT_CD
			      ,T2.RANK_CD
			      ,F_DPT_INFO(T2.DPT_CD,'1') AS DPT_NM
			      ,T2.CNB
			      ,F_USR_INFO(T2.CNB,'2') AS USR_NAM
			      ,T2.RCMD_RNK
			      ,TO_CHAR(TO_DATE(NVL(T2.CRNT_PST_APM_DT,T2.CRNT_RANK_APM_DT)),'YYYY-MM-DD') AS CRNT_PST_APM_DT
			      ,T2.BAI_APM_DT
			      ,T2.PBSVT_APM_DT
			  FROM TBREMERJ001M T1
			      ,TBREMERJ003M T2
			 WHERE T1.RWD_YR = T2.RWD_YR
			   AND T1.DGE = T2.DGE
		]]>			             
           		
		<isNotEmpty property="RWD_YR">	
			   AND T1.RWD_YR = #RWD_YR#
		</isNotEmpty>

		<isNotEmpty property="DGE">	
			   AND T1.DGE = #DGE#
		</isNotEmpty>

		<isNotEmpty property="CNB_LIST">
			   AND T2.CNB IN
					<iterate property="CNB_LIST" open="(" close=")" conjunction=",">
						#CNB_LIST[]#
					</iterate>
		</isNotEmpty>
	     
		<isNotEmpty property="APV_DOC_NO">	
			   AND T2.APV_DOC_NO = #APV_DOC_NO#
		</isNotEmpty>	     
	</select>
	
	<update id="REMERJ001PApvSave" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBREMERJ003M T1
			   SET APV_DOC_NO = #APV_DOC_NO#
			      ,APV_STA_CD = #APV_STA_CD#
			      ,PRSS_STA_CD = CASE WHEN #APV_STA_CD# = '3' THEN '40' ELSE PRSS_STA_CD END
			 WHERE 1=1
		]]>
		
		<isNotEmpty property="CNB_LIST">
			AND T1.RWD_YR = #RWD_YR#
			AND T1.DGE = #DGE#
		   	AND T1.CNB  IN
				<iterate property="CNB_LIST" open="(" close=")" conjunction=",">
					#CNB_LIST[]#
				</iterate>
		</isNotEmpty>
		
		<isEmpty property="CNB_LIST">
			AND APV_DOC_NO = #APV_DOC_NO#
		</isEmpty>
	</update>
</sqlMap> 
