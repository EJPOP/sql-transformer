<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<!-- 
- 인자값 가져오기
컬럼명 = #파라미터명#

- SQLMAP.xml 기본 골격
<sqlMap namespace="">
	<select id="" parameterClass="" resultClass="">
	</select>
	<insert id="" parameterClass="">
	</insert>
	<update id="" parameterClass="">
	</update>
	<delete id="" parameterClass="">
	</delete>
</sqlMap>

- SQLMAP.xml 세부 골격
<isNotNull property="속성명" prepend="AND, OR">
</isNotNull>
<isNotEmpty property="" prepend="" removeFirstPrepend="">
</isNotEmpty>
<isNull property="">
	<isEqual property="" compareValue="">
   	</isEqual>
</isNull>
-->

<sqlMap namespace="aep/gkm/007">
	<select id="AEPGKM007ESelect" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		<include refid="include.pageSelct" />
				SELECT	
						A.KNB AS KNB,
						A.KLD_NM AS KLD_NM,
						C.TG_CAT_NM AS CAT_NM,
						B.CNB,
						B.FNL_MDF_DH 
				FROM	TBAEPGKM001M AS A,
						TBAEPGKM002L AS B,
						TBAEPGKM017M AS C
				WHERE	1=1
				AND		A.KNB = B.KNB
				AND		A.KLD_CAT_CD = C.TG_CAT_ID
				AND		B.CNB = #strUserCnb#
			<isNotEmpty prepend="AND" property="strKldNm">
				A.KLD_NM LIKE '%'||#strKldNm# ||'%'
		</isNotEmpty>
		<include refid="include.pageOrder" />
		 ORDER BY FNL_MDF_DH DESC 

	</select>
	
	<delete id="AEPGKM007EDelete" parameterClass="java.util.HashMap">
		DELETE FROM TBAEPGKM002L
		WHERE	KNB = #KNB#
		AND		CNB = #CNB#
	</delete>
	
	<insert id="AEPGKM007EInsert" parameterClass="java.util.Map">
		MERGE INTO TBAEPGKM002L AS A
		USING (
			SELECT	 #KNB# AS KNB
					,#CNB# AS CNB
			FROM	DUAL	  ) AS B
		ON (A.KNB = B.KNB 
		AND A.CNB = B.CNB ) 
		WHEN NOT MATCHED THEN
		INSERT
		(KNB				/* 지식번호 */
		,CNB				/* 전산번호 */
		,FRT_USR_ID			/* 최초사용자ID */
		,FNL_USR_ID			/* 최종사용자ID */
		,FNL_DEAL_DPT_CD	/* 최종거래부서코드 */
		,FNL_MNU_ID			/* 최종메뉴ID */
		,FRT_REGI_DH		/* 최초등록일시 */
		,FNL_MDF_DH			/* 최종수정일시 */)
		VALUES
		(#KNB#
		,#CNB#
		,#FRT_USR_ID#
		,#FNL_USR_ID#
		,#FNL_DEAL_DPT_CD#
		,#FNL_MNU_ID#
		,SYSDATE
		,SYSDATE)
	</insert>
</sqlMap>