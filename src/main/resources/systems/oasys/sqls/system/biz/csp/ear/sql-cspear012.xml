<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/ear/012">
 	<select id="CSPEAR012PMainSelect" parameterClass="paramMap" resultClass="resultMap">
 		<include refid="include.pageSelct" />
 	
		<![CDATA[
		SELECT T1.DVSN_CD
		      ,T1.SRNO
		      ,T1.KEY1
		      ,T1.KEY2
		      ,T1.KEY3
		      ,T1.KEY4
		      ,T1.TITLE
		  FROM (
		  
			    SELECT A.REQ_DVSN_CD                                                             AS DVSN_CD
					  ,A.ACP_YR||'-'||F_CODE_NM('1000740',A.REQ_DVSN_CD)||'-'||A.RM_CVPT_ACP_NO  AS SRNO
					  ,A.ACP_YR                                                                  AS KEY1
					  ,A.REQ_DVSN_CD                                                             AS KEY2
	   				  ,A.CVPT_ACP_NO                                                             AS KEY3
	   				  ,''                                                                        AS KEY4
	   				  ,A.TIT_NM                                                                  AS TITLE
	   			  FROM TBCSPDCP101M A
	   			 WHERE 1 = 1
	   			   AND A.CVPT_HNDL_STA_CD NOT IN ('10')
	   			   AND A.RM_CVPT_ACP_NO IS NOT NULL
	   			   AND TO_CHAR(A.ACP_DH,'YYYYMMDD') BETWEEN NVL(#strACP_DHS#,'19000101') AND NVL(#strACP_DHE#,'99991231')
			]]>
			<isNotEmpty property="strREQ_DVSN_CD">
	               AND 1 = CASE WHEN #strREQ_DVSN_CD# IN ('1','2','3') THEN 1
	   			                ELSE 0
	   			            END 		
				   AND A.REQ_DVSN_CD = #strREQ_DVSN_CD# 
			</isNotEmpty>		
	
			<dynamic>
				<isNotEmpty property="strYr">
					AND A.ACP_YR = #strYr#
				</isNotEmpty>
			</dynamic>
	
				<isNotEmpty property="strCVPT_ACP_NO">
					AND A.RM_CVPT_ACP_NO = #strCVPT_ACP_NO#
				</isNotEmpty>
						
				<isNotEmpty property="strCVPTR_NM">
				    AND A.CVPTR_NM LIKE '%' || #strCVPTR_NM# || '%'	
				</isNotEmpty>
					
				<isNotEmpty property="strTIT_NM">
					AND A.TIT_NM LIKE '%' || #strTIT_NM# || '%'
				</isNotEmpty>
				
				UNION ALL
			
			<![CDATA[
				SELECT A.REQ_DVSN_CD                              AS DVSN_CD
					  ,A.ACP_YR||'-국회-'||A.CVPT_ACP_NO          AS SRNO
					  ,A.ACP_YR                                   AS KEY1
					  ,A.REQ_DVSN_CD                              AS KEY2
	   				  ,A.CVPT_ACP_NO                              AS KEY3
	   				  ,''                                         AS KEY4
	   				  ,A.AUD_REQ_TIT_NM                           AS TITLE
				  FROM TBCSPEAR007M A
				 WHERE 1=1
				  AND A.REQ_DT BETWEEN NVL(#strACP_DHS#,'19000101') AND NVL(#strACP_DHE#,'99991231')
			]]>
			<isNotEmpty property="strREQ_DVSN_CD">
	              AND A.REQ_DVSN_CD = #strREQ_DVSN_CD# 
			</isNotEmpty>			
			<dynamic>
				<isNotEmpty property="strYr">
				  AND A.ACP_YR = #strYr#
				</isNotEmpty>
			</dynamic>		
			
			<isNotEmpty property="strCVPT_ACP_NO">
				 AND A.CVPT_ACP_NO = #strCVPT_ACP_NO#
			</isNotEmpty>		
			
			<isNotEmpty property="strCVPTR_NM">
			     AND A.CHGR_NM LIKE '%' || #strCVPTR_NM# || '%'	
			</isNotEmpty>		
			
			<isNotEmpty property="strTIT_NM">
				 AND A.AUD_REQ_TIT_NM LIKE '%' || #strTIT_NM# || '%'
			</isNotEmpty>
						
			UNION ALL
			
			<!-- 정보추가 - 2016.04.21 yyh -->
			<![CDATA[
				SELECT '0'                                        AS DVSN_CD
					  ,A.YE||'-정보-'||A.SRNO                      AS SRNO
					  ,A.YE                                       AS KEY1
					  ,TO_CHAR(A.SRNO)                            AS KEY2
	   				  ,''                                         AS KEY3
	   				  ,''                                         AS KEY4
	   				  ,A.TIT_TXT                                  AS TITLE
				  FROM TBCSPBII100M A
				 WHERE 1=1
				  AND A.ACP_DT BETWEEN NVL(#strACP_DHS#,'19000101') AND NVL(#strACP_DHE#,'99991231')
			]]>
			<isNotEmpty property="strREQ_DVSN_CD">
	              AND '0' = #strREQ_DVSN_CD# 
			</isNotEmpty>			
			<dynamic>
				<isNotEmpty property="strYr">
				  AND A.YE = #strYr#
				</isNotEmpty>
			</dynamic>		
			
			<isNotEmpty property="strCVPT_ACP_NO">
				 AND A.SRNO = #strCVPT_ACP_NO#
			</isNotEmpty>		
			
			<isNotEmpty property="strTIT_NM">
				 AND A.TIT_TXT LIKE '%' || #strTIT_NM# || '%'
			</isNotEmpty>				
			
			UNION ALL
			
			<![CDATA[		
			    SELECT CASE WHEN ACP_DVSN_CD = '1' THEN '5'
	                        WHEN ACP_DVSN_CD = '2' THEN '6'
	                        WHEN ACP_DVSN_CD = '3' THEN '7'
	                    END                                                                      AS DVSN_CD
	                  ,CASE WHEN ACP_YR >= '2016' 
	                             THEN ACP_YR || '-' || DECODE(ACP_DVSN_CD,'1','심사','2','재심','3','재심판정') || '-' || ACP_SRNO
	                        ELSE 
	                                  ACP_YR || '-' || ACP_DVSN_CD || '-' || ACP_SRNO
	                    END                                                                                                       
	                                                                                             AS SRNO
					  ,ACP_YR                                                                    AS KEY1
					  ,ACP_DVSN_CD                                                               AS KEY2
	   				  ,TO_CHAR(ACP_SRNO)                                                         AS KEY3
	   				  ,DPT_CD                                                                    AS KEY4
	   	              ,TIT_NM                                                                    AS TITLE
	             FROM TBBADFRE012M
	            WHERE 1 = 1
	   			  AND ACP_DT BETWEEN NVL(#strACP_DHS#,'19000101') AND NVL(#strACP_DHE#,'99991231')
			]]>
			
			<isNotEmpty property="strREQ_DVSN_CD">
	               AND 1 = CASE WHEN #strREQ_DVSN_CD# IN ('5','6','7') THEN 1
	   			                ELSE 0
	   			            END 		
				   AND ACP_DVSN_CD = CASE WHEN #strREQ_DVSN_CD# = '5' THEN '1'
	                                      WHEN #strREQ_DVSN_CD# = '6' THEN '2'
	                                      WHEN #strREQ_DVSN_CD# = '7' THEN '3'
	                                  END 
			</isNotEmpty>	
					
			<isNotEmpty property="strYr">
				  AND ACP_YR = #strYr#
			</isNotEmpty>
			
			<isNotEmpty property="strCVPT_ACP_NO">
				  AND ACP_SRNO = #strCVPT_ACP_NO#
			</isNotEmpty>
						
			<isNotEmpty property="strCVPTR_NM">
				  AND REQR_NM LIKE '%' || #strCVPTR_NM# || '%'	
			</isNotEmpty>
			
			<isNotEmpty property="strTIT_NM">
				  AND TIT_NM LIKE '%' || #strTIT_NM# || '%'
			</isNotEmpty>
	
			UNION ALL
			
			<![CDATA[
				SELECT '8'                                 AS DVSN_CD
					  ,T1.YR||'-손망-'||T1.ACP_NO          AS SRNO
					  ,T1.ORG_CD                           AS KEY1
					  ,T1.NTF_DVSN_CD                      AS KEY2
	   				  ,T1.NNB                              AS KEY3
	   				  ,''                                  AS KEY4
	   				  ,T1.TIT_NM                           AS TITLE
				  FROM TBBADGDA001M T1
				 WHERE 1=1
				  AND T1.ACP_DT BETWEEN NVL(#strACP_DHS#,'19000101') AND NVL(#strACP_DHE#,'99991231')
	              AND T1.NTF_DVSN_CD = '2'           
	              AND T1.OGN_DVSN_CD IN ('3','4','5')			  
			]]>
			<isNotEmpty property="strREQ_DVSN_CD">
	              AND '8' = #strREQ_DVSN_CD# 
			</isNotEmpty>			
			<dynamic>
				<isNotEmpty property="strYr">
				  AND T1.YR = #strYr#
				</isNotEmpty>
			</dynamic>		
			
			<isNotEmpty property="strCVPT_ACP_NO">
				 AND T1.ACP_NO = #strCVPT_ACP_NO#
			</isNotEmpty>		
			
			<isNotEmpty property="strCVPTR_NM">
			     AND EXISTS (SELECT 1
			                   FROM TBBADGDA001L
			                  WHERE ORG_CD      = T1.ORG_CD
			                    AND NTF_DVSN_CD = T1.NTF_DVSN_CD
			                    AND NNB         = T1.NNB
			                    AND DFNT_NM LIKE '%' || #strCVPTR_NM# || '%')
			</isNotEmpty>		
			
			<isNotEmpty property="strTIT_NM">
				 AND T1.TIT_NM LIKE '%' || #strTIT_NM# || '%'
			</isNotEmpty>
			
			
			UNION ALL
			
			<![CDATA[
				SELECT '9'                                 AS DVSN_CD
					  ,T1.YR||'-판청-'||T1.ACP_NO          AS SRNO
					  ,T1.ORG_CD                           AS KEY1
					  ,T1.NTF_DVSN_CD                      AS KEY2
	   				  ,T1.NNB                              AS KEY3
	   				  ,''                                  AS KEY4
	   				  ,T1.TIT_NM                           AS TITLE
				  FROM TBBADGDA001M T1
				 WHERE 1=1
				  AND T1.ACP_DT BETWEEN NVL(#strACP_DHS#,'19000101') AND NVL(#strACP_DHE#,'99991231')
	              AND T1.NTF_DVSN_CD = '2'           
	              AND T1.OGN_DVSN_CD = '6'	  
			]]>
			<isNotEmpty property="strREQ_DVSN_CD">
	              AND '9' = #strREQ_DVSN_CD# 
			</isNotEmpty>			
			<dynamic>
				<isNotEmpty property="strYr">
				  AND T1.YR = #strYr#
				</isNotEmpty>
			</dynamic>		
			
			<isNotEmpty property="strCVPT_ACP_NO">
				 AND T1.ACP_NO = #strCVPT_ACP_NO#
			</isNotEmpty>		
			
			<isNotEmpty property="strCVPTR_NM">
			     AND EXISTS (SELECT 1
			                   FROM TBBADGDA001L
			                  WHERE ORG_CD      = T1.ORG_CD
			                    AND NTF_DVSN_CD = T1.NTF_DVSN_CD
			                    AND NNB         = T1.NNB
			                    AND DFNT_NM LIKE '%' || #strCVPTR_NM# || '%')
			</isNotEmpty>		
			
			<isNotEmpty property="strTIT_NM">
				 AND T1.TIT_NM LIKE '%' || #strTIT_NM# || '%'
			</isNotEmpty>		
				
			UNION ALL
			
			<!-- 특수관리추가 - 2016.04.21 yyh -->
			<![CDATA[
				SELECT 'A'                                        AS DVSN_CD
					  ,F_MNG_KND_AUDYRNO(A.AUD_YR, A.AUD_NO, C.AUD_KND_CD, '-') ||'-'|| A.DSP_RQ_SNO ||'-'|| F_ORG_INFO(B.RLTN_ORG_CD,'1') 
					                                              AS SRNO
					  ,A.AUD_YR                                   AS KEY1
					  ,A.AUD_NO                                   AS KEY2
	   				  ,TO_CHAR(A.DSP_RQ_SNO)                      AS KEY3
	   				  ,B.RLTN_ORG_CD                              AS KEY4
	   				  ,A.TIT_TXT                                  AS TITLE
				  FROM  TBBADEAR001M A
				       ,TBBADFRE011M B
				       ,TBBADDED001M C
				 WHERE 1=1
				  AND A.AUD_YR     = B.AUD_YR 
				  AND A.AUD_NO     = B.AUD_NO
				  AND A.DSP_RQ_SNO = B.DSP_RQ_SNO
				  AND B.MNG_SNO    = (SELECT MIN(MNG_SNO)
				                        FROM TBBADFRE011M
				                       WHERE AUD_YR      = B.AUD_YR 
				                         AND AUD_NO      = B.AUD_NO
				                         AND DSP_RQ_SNO  = B.DSP_RQ_SNO
				                         AND RLTN_ORG_CD = B.RLTN_ORG_CD)			  
				  AND A.AUD_YR     = C.AUD_YR
				  AND A.AUD_NO     = C.AUD_NO 
				  
				  AND NVL(B.ASG_DT,'19000101') BETWEEN NVL(#strACP_DHS#,'19000101') AND NVL(#strACP_DHE#,'99991231')
			]]>
			<isNotEmpty property="strREQ_DVSN_CD">
	              AND 'A' = #strREQ_DVSN_CD# 
			</isNotEmpty>			
			<dynamic>
				<isNotEmpty property="strYr">
				  AND A.AUD_YR = #strYr#
				</isNotEmpty>
			</dynamic>		
			
			<isNotEmpty property="strCVPT_ACP_NO">
				 AND A.DSP_RQ_SNO = #strCVPT_ACP_NO#
			</isNotEmpty>		
			
			<isNotEmpty property="strTIT_NM">
				 AND A.TIT_TXT LIKE '%' || #strTIT_NM# || '%'
			</isNotEmpty>
			
			UNION ALL			
			
			<!-- 청금 추가 - 2016.10.31 yyh -->
			<![CDATA[
				SELECT 'C'                                        AS DVSN_CD
					  ,ACP_YR || '-청금-' || RM_STTM_ACP_NO       AS SRNO
					  ,STTM_DVSN_CD                               AS KEY1
					  ,ACP_YR                                     AS KEY2
	   				  ,STTM_ACP_NO                                AS KEY3
	   				  ,''                                         AS KEY4
	   				  ,TIT_NM                                     AS TITLE
				  FROM TBCSPDCP811M 
				 WHERE 1=1
				  AND STTM_DVSN_CD   = '1' /* 청금 */
				  AND RM_STTM_ACP_NO IS NOT NULL
				  AND DELETE_DH      IS NULL
				  AND TO_CHAR(ACP_DH, 'YYYYMMDD') BETWEEN NVL(#strACP_DHS#,'19000101') AND NVL(#strACP_DHE#,'99991231')
			]]>
			<isNotEmpty property="strREQ_DVSN_CD">
	              AND 'C' = #strREQ_DVSN_CD# 
			</isNotEmpty>			
			<dynamic>
				<isNotEmpty property="strYr">
				  AND ACP_YR = #strYr#
				</isNotEmpty>
			</dynamic>		
			
			<isNotEmpty property="strCVPT_ACP_NO">
				 AND RM_STTM_ACP_NO = #strCVPT_ACP_NO#
			</isNotEmpty>		
			
			<isNotEmpty property="strCVPTR_NM">
				 AND NAM LIKE '%' || #strCVPTR_NM# || '%'
			</isNotEmpty>	
						
			<isNotEmpty property="strTIT_NM">
				 AND TIT_NM LIKE '%' || #strTIT_NM# || '%'
			</isNotEmpty>			
				
			) T1
			 ,TBDCMACM013C T2
	    WHERE T2.CMM_CD_DVSN_CD = '1000742'
	      AND T2.CD            != '000000000'
	      AND T1.DVSN_CD        = T2.CD
	      
	    <isEqual property="strTSK_DVSN_CD" compareValue="1">
	      AND T2.USR_DFN_TXT_3 IN ('10','11')  
	    </isEqual>
	    <isEqual property="strTSK_DVSN_CD" compareValue="2">
	      AND T2.USR_DFN_TXT_3 IN ('01','11')  
	    </isEqual>	      

		<include refid="include.pageOrder" />
	</select>
</sqlMap> 
