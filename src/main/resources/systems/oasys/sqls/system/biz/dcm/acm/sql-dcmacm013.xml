<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="dcm/acm/013">

	<select id="DCMACM013POrgCdCheck" parameterClass="paramMap" resultClass="Integer">
		<![CDATA[
			SELECT COUNT(*)
			  FROM TBDCMACM015M
			 WHERE ORG_CD = #NEW_ORG_CD#
		]]>
	</select>
	
	<update id="DCMACM013POrgCdUpdate" parameterClass="paramMap">
		<![CDATA[
			UPDATE TBDCMACM015M
			   SET USE_DVSN_NO = 'N' , ABLT_DT = TO_CHAR(SYSDATE,'YYYYMMDD')
			 WHERE ORG_CD = #ORG_CD#
		]]>
	</update>
	
	<insert id="DCMACM013PNewOrgCdInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT
			  INTO TBDCMACM015M
			       (  ORG_CD
					, ORG_NM
					, RGN_CD
					, ORG_DVSN_CD
					, ORG_DGE_CD
					, COPT_SG_CD
					, TNB
					, ZCD
					, AD
					, DTL_AD
					, ROAD_NM_AD
					, ROAD_NM_DTL_AD
					, USE_DVSN_NO
					, CRE_DT
					, RMK
					, ENFM_DPT_CD
					, ORG_CAT_CD
					, CVPT_TON_ORG_YN
					, CHG_DT
					, BZN
					, ABLT_DT
					, PUB_DVSN_CD
					, SRCH_CNT
					, PASA_USE_YN_CD
					, FRT_USR_ID
					, FNL_USR_ID
					, FNL_DEAL_DPT_CD
					, FNL_MNU_ID
					, FRT_REGI_DH
					, FNL_MDF_DH
					, COPT_SG_2_CD
					, ADMN_ORG_DVSN_CD
				   )
			SELECT #NEW_ORG_CD#
				 , ORG_NM
				 , RGN_CD
				 , ORG_DVSN_CD
				 , #NEW_ORG_DGE_CD#
				 , COPT_SG_CD
				 , TNB
				 , ZCD
				 , AD
				 , DTL_AD
				 , ROAD_NM_AD
				 , ROAD_NM_DTL_AD
				 , 'Y'
				 , TO_CHAR(SYSDATE,'YYYYMMDD')
				 , RMK
				 , ENFM_DPT_CD
				 , ORG_CAT_CD
				 , CVPT_TON_ORG_YN
				 , TO_CHAR(SYSDATE,'YYYYMMDD')
				 , BZN
				 , NULL
				 , PUB_DVSN_CD
				 , SRCH_CNT
				 , PASA_USE_YN_CD
				 , #FRT_USR_ID#
				 , #FNL_USR_ID#
				 , #FNL_DEAL_DPT_CD#
				 , #FNL_MNU_ID#
				 , SYSDATE
				 , SYSDATE
				 , COPT_SG_2_CD
				 , ADMN_ORG_DVSN_CD
			  FROM TBDCMACM015M 
			 WHERE ORG_CD = #ORG_CD# 
			       
		
		]]>
	</insert>
	
	
	<insert id="DCMACM013PDCMACM034HInsert" parameterClass="paramMap">
		<![CDATA[
			INSERT INTO 
			TBDCMACM034H(
			   CON_NO
			 , CON_USE_YN
			 , ORG_CD
			 , ORG_NM
			 , ORG_DVSN_CD
			 , ORG_DGE_CD
			 , COPT_SG_CD
			 , TNB
			 , ZCD
			 , AD
			 , DTL_AD
			 , ROAD_NM_AD
			 , ROAD_NM_DTL_AD
			 , USE_DVSN_NO
			 , CRE_DT
			 , RMK
			 , ENFM_DPT_CD
			 , ORG_CAT_CD
			 , CVPT_TON_ORG_YN
			 , CHG_DT
			 , BZN
			 , ABLT_DT
			 , PUB_DVSN_CD
			 , SRCH_CNT
			 , PASA_USE_YN_CD
			 , COPT_SG_2_CD
			 , FRT_USR_ID
			 , FNL_USR_ID
			 , FNL_DEAL_DPT_CD
			 , FNL_MNU_ID
			 , FRT_REGI_DH
			 , FNL_MDF_DH
			 , RGN_CD    /* 추가 - 2015.05.26 yyh */
			 , ADMN_ORG_DVSN_CD
			) 
			SELECT (SELECT NVL(MAX(CON_NO),'0')+1 FROM TBDCMACM034H) AS CON_NO
			     , 'N' AS CON_USE_YN
				 , ORG_CD
				 , ORG_NM
				 , ORG_DVSN_CD
				 , ORG_DGE_CD
				 , COPT_SG_CD
				 , TNB
				 , ZCD
				 , AD
				 , DTL_AD
				 , ROAD_NM_AD
				 , ROAD_NM_DTL_AD
				 , USE_DVSN_NO
				 , CRE_DT
				 , RMK
				 , ENFM_DPT_CD
				 , ORG_CAT_CD
				 , CVPT_TON_ORG_YN
				 , CHG_DT
				 , BZN
				 , ABLT_DT
				 , PUB_DVSN_CD
				 , NULL SRCH_CNT
				 , PASA_USE_YN_CD
				 , COPT_SG_2_CD /* 소관부호2코드 추가 - 2017.03.20 yyh */				 
				 , #FNL_USR_ID# AS FRT_USR_ID
				 , #FNL_USR_ID# AS FNL_USR_ID
				 , #FNL_DEAL_DPT_CD# AS FNL_DEAL_DPT_CD
				 , #FNL_MNU_ID# AS FNL_MNU_ID
				 , SYSDATE AS FRT_REGI_DH
				 , SYSDATE AS FNL_MDF_DH
				 , RGN_CD
				 , NVL(ADMN_ORG_DVSN_CD,'N') AS ADMN_ORG_DVSN_CD
			 FROM TBDCMACM015M 
			 WHERE ORG_CD = #ORG_CD#
		]]>
		
	</insert>
	
	<insert id="DCMACM013PDCMACM035HInsert" parameterClass="paramMap">
		<![CDATA[
	INSERT
				INTO
				TBDCMACM035H
				(
				  ORG_CD
				, CON_NO 
				, CON_HNDL_DVSN_CD
				, USE_YN
				
				, FRT_USR_ID		
				, FRT_REGI_DH
				, FNL_MNU_ID
				, FNL_USR_ID
				, FNL_DEAL_DPT_CD
				, FNL_MDF_DH
				) VALUES
				(
				  #NEW_ORG_CD#
				, (	SELECT NVL(MAX(CON_NO),0)+1  AS CON_NO
					  FROM TBDCMACM035H
			       ) 
			    , 'C'
				, 'N'
				
				, #FRT_USR_ID#			
				, SYSDATE
				, #FNL_MNU_ID#
				, #FNL_USR_ID#
				, #FNL_DEAL_DPT_CD#
				, SYSDATE
				);
	]]>
		
	</insert>
</sqlMap> 