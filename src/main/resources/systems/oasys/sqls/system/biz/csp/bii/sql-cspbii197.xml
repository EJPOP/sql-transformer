<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="csp/bii/197">
	<!-- 감사정보기본 상세조회 맵 -->
	<resultMap class="java.util.HashMap" id="CSPBII197PMainSelectMap">
		<result property="TIT_TXT"			column="TIT_TXT" 			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="CLC_DVSN_CD"		column="CLC_DVSN_CD" 		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="CLC_DVSN_NM"		column="CLC_DVSN_NM" 		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="SRC_DVSN_CD"		column="SRC_DVSN_CD"		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="SRC_DVSN_NM"		column="SRC_DVSN_NM"		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="INF_DVSN_CD"		column="INF_DVSN_CD"		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="INF_DVSN_NM"		column="INF_DVSN_NM"		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="REL_ORG_CD"		column="REL_ORG_CD"			jdbcType="VARCHAR2" javaType="java.lang.String"/>	
		<result property="REL_ORG_NM"		column="REL_ORG_NM" 		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="REL_ORG_CD_1"		column="REL_ORG_CD_1" 		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="REL_ORG_NM_1"		column="REL_ORG_NM_1"		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="REL_ORG_CD_2"		column="REL_ORG_CD_2"		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="REL_ORG_NM_2"		column="REL_ORG_NM_2"		jdbcType="VARCHAR2" javaType="java.lang.String"/>	
		<result property="HNDL_DPT_CD"		column="HNDL_DPT_CD" 		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="HNDL_DPT_NM"		column="HNDL_DPT_NM" 		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="OPEN_YN"			column="OPEN_YN"			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="INF_NO"			column="INF_NO"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		
		<result property="REGI_DT"			column="REGI_DT"			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="SMT_DT"			column="SMT_DT"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="SMT_DT2"			column="SMT_DT2"			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="ACP_DT"			column="ACP_DT"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="DTB_DT"			column="DTB_DT"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="TRNF_DT"			column="TRNF_DT"			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="AUD_DT"			column="AUD_DT"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="TRNF_ACP_DT"		column="TRNF_ACP_DT"		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="HNDL_DT"			column="HNDL_DT"			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="CMPT_DT"			column="CMPT_DT"			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		
		<result property="TOT_SC"			column="TOT_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
				
		<result property="HNDL_ORD_CD"					column="HNDL_ORD_CD"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="HNDL_ORD_NM"					column="HNDL_ORD_NM"				jdbcType="VARCHAR2" javaType="java.lang.String"/>	
		<result property="HNDL_RSLT_CD"					column="HNDL_RSLT_CD"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="HNDL_RSLT_NM"					column="HNDL_RSLT_NM"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="AUD_INF_TXT"					column="AUD_INF_TXT" 				jdbcType="CLOB" 	javaType="java.lang.String"/>
		<result property="AUD_INF_ETC_TXT"				column="AUD_INF_ETC_TXT"			jdbcType="CLOB" 	javaType="java.lang.String"/>
		<result property="AUD_INF_SMM_TXT"				column="AUD_INF_SMM_TXT"			jdbcType="CLOB" 	javaType="java.lang.String"/>
		<result property="PRSR_DPT_CD"					column="PRSR_DPT_CD"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="PRSR_DPT_NM"					column="PRSR_DPT_NM"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="PRSR_ABR_DPT_NM"				column="PRSR_ABR_DPT_NM"			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="RAL_BLT_DIV_NM"				column="RAL_BLT_DIV_NM"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="PRSR_RANK_CD"					column="PRSR_RANK_CD"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="PRSR_RANK_NM"					column="PRSR_RANK_NM"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="PRSR_CNB"						column="PRSR_CNB"					jdbcType="VARCHAR2" javaType="java.lang.String"/>	
		
		<result property="PRSS_STT_NM"					column="PRSS_STT_NM"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="PRSS_DTL_NM"					column="PRSS_DTL_NM"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="SC_SITU_NM"					column="SC_SITU_NM"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
			
		<result property="HNDL_RSLT_SMM_TXT"			column="HNDL_RSLT_SMM_TXT"			jdbcType="CLOB" 	javaType="java.lang.String"/>
		<result property="AUD_DPT_CD"					column="AUD_DPT_CD"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="AUD_DPT_NM"					column="AUD_DPT_NM"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="AUD_PEN_NAM"					column="AUD_PEN_NAM"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="AUD_SBJ_NM"					column="AUD_SBJ_NM"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="REL_DOC_ID"					column="REL_DOC_ID"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="HNDL_DOC_ID"					column="HNDL_DOC_ID"				jdbcType="VARCHAR2" javaType="java.lang.String"/>		
		<result property="AUD_INF_PRSS_STA_CD"			column="AUD_INF_PRSS_STA_CD"		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="AUD_INF_PRSS_STA_NM"			column="AUD_INF_PRSS_STA_NM"		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="AUD_POP_CNT"					column="AUD_POP_CNT"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="DPT_TP_CD"					column="DPT_TP_CD"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="DPT_TP_CD2"					column="DPT_TP_CD2"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="ACP_YR"						column="ACP_YR"						jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="CVPT_ACP_NO"					column="CVPT_ACP_NO"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="REQ_DVSN_CD"					column="REQ_DVSN_CD"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="CVPT_TIT_NM"					column="CVPT_TIT_NM"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="YE"							column="YE"							jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="SRNO"							column="SRNO"						jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="HNDL_PEN_NAM_CNB"				column="HNDL_PEN_NAM_CNB"			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="BK_HNDL_ORD_CD"				column="BK_HNDL_ORD_CD"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="HOM_TNB"						column="HOM_TNB"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="PRE_EVL_CD"					column="PRE_EVL_CD"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="PRE_EVL_FDLTY"				column="PRE_EVL_FDLTY"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="PRE_EVL_IFENE"				column="PRE_EVL_IFENE"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="PRE_EVL_WRDO"					column="PRE_EVL_WRDO"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="AUD_INF_ANL_OPIN_TXT"			column="AUD_INF_ANL_OPIN_TXT"		jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="AUD_INF_BLE_ANL_OPIN_TXT"		column="AUD_INF_BLE_ANL_OPIN_TXT"	jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="GEN_ADMN_DVSN_NM"				column="GEN_ADMN_DVSN_NM"			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="BLE_CHGR_CNB"					column="BLE_CHGR_CNB"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="BLE_CHGR_NAM"					column="BLE_CHGR_NAM"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="BK_TRNF_DT"					column="BK_TRNF_DT"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="APV_OPIN"						column="APV_OPIN"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		
		<result property="UTL_SC"						column="UTL_SC"						jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="FDLTY_SC"						column="FDLTY_SC"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="RIBLY_SC"						column="RIBLY_SC"					jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="FRT_REGI_DT"					column="FRT_REGI_DT"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="TRNF_APV_DOC_NO"				column="TRNF_APV_DOC_NO"			jdbcType="VARCHAR2" javaType="java.lang.String"/>
		
		<result property="FDLTY_MNAG_SC"				column="FDLTY_MNAG_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="FDLTY_TIME_SC"				column="FDLTY_TIME_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="FDLTY_TG_SC"					column="FDLTY_TG_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="FDLTY_TXT_SC"					column="FDLTY_TXT_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="FDLTY_BAS_SC"					column="FDLTY_BAS_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="RIBLY_EVI_SC"					column="RIBLY_EVI_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="RIBLY_IVTG_SC"				column="RIBLY_IVTG_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="UTL_INSP_SC"					column="UTL_INSP_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>
		<result property="UTL_SPCF_SC"					column="UTL_SPCF_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>		
		
		<result property="FDLTY_TOT_SC"					column="FDLTY_TOT_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>	
		<result property="RIBLY_TOT_SC"					column="RIBLY_TOT_SC"				jdbcType="VARCHAR2" javaType="java.lang.String"/>	
		<result property="UTL_TOT_SC"					column="UTL_TOT_SC"					jdbcType="VARCHAR2" javaType="java.lang.String"/>	
		
		<result property="FNL_TOT_SC"					column="FNL_TOT_SC"					jdbcType="VARCHAR2" javaType="java.lang.String"/>		
		
	</resultMap>	

	<!-- 감사정보기본 상세조회 -->   
	<select id="CSPBII197PMainSelect" parameterClass="paramMap" resultMap="CSPBII197PMainSelectMap">
		<![CDATA[       		
			SELECT /* 감사정보 상세조회 영역 */
			       '상신(' || TO_CHAR(TO_DATE(A.SBM_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')⇒'
			    || '제출(' || TO_CHAR(TO_DATE(A.SMT_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')⇒'
			    || '접수(' || TO_CHAR(TO_DATE(A.ACP_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')⇒'
			    || '이송(' || TO_CHAR(TO_DATE(A.TRNF_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')⇒'
			    || '이송접수(' || TO_CHAR(TO_DATE(A.TRNF_ACP_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')⇒'
			    || '감사중(' || TO_CHAR(TO_DATE(A.AUD_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')⇒'
			    || '처리중(' || TO_CHAR(TO_DATE(A.HNDL_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ','||(SELECT E.USR_NAM
			          FROM TBDCMACM001M E
			         WHERE E.CNB = A.HNDL_PEN_CNB)||')⇒'
			    || '완료(' || TO_CHAR(TO_DATE(A.CMPT_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')'                                              AS PRSS_STT_NM /* 진행상황명 */			    
			     , F_CODE_NM('1000085', A.AUD_INF_PRSS_STA_CD)
			    || CASE WHEN A.AUD_INF_PRSS_STA_CD = '05' THEN '(' || TO_CHAR(TO_DATE(A.SMT_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')'
			            WHEN A.AUD_INF_PRSS_STA_CD = '10' THEN '(' || TO_CHAR(TO_DATE(A.ACP_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')'
			            WHEN A.AUD_INF_PRSS_STA_CD = '15' THEN '(' || TO_CHAR(TO_DATE(A.TRNF_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')'
			            WHEN A.AUD_INF_PRSS_STA_CD = '20' THEN '(' || TO_CHAR(TO_DATE(A.TRNF_ACP_DT, 'YYYYMMDD'), 'YYYY.MM.DD') || ')'
			            WHEN A.AUD_INF_PRSS_STA_CD IN ('31', '32') THEN '(' || (SELECT E.DPT_NM || ', '
			                                                                      FROM TBDCMACM002M E
			                                                                     WHERE E.DPT_CD = A.AUD_DPT_CD) || A.AUD_SBJ_NM || ')'
			            WHEN A.AUD_INF_PRSS_STA_CD IN ('21', '22', '23', '24', '99') THEN '(' || (SELECT E.DPT_NM || ', '
			                                                                                        FROM TBDCMACM002M E
			                                                                                       WHERE E.DPT_CD = A.AUD_DPT_CD) || F_CODE_NM('1000042', A.HNDL_RSLT_CD) || ')'
			       END                                                                                                                 AS PRSS_DTL_NM /* 진행세부명 */
			     , '충실성 : ' || TO_CHAR(nvl(A.FDLTY_SC,0)) || '점, '
			     || '신뢰성 : ' || TO_CHAR(nvl(A.RIBLY_SC,0)) || '점, '
			     || '활용가능성 : ' || TO_CHAR(nvl(A.UTL_SC,0)) || '점' AS SC_SITU_NM  /* 점수현황명 */
			     , B.HNDL_RSLT_SMM_TXT                                                                                                                /* 처리결과요약내용(처리전) */
			     , A.AUD_DPT_CD                                                                                                                       /* 감사부서코드 */
			     , (SELECT E.DPT_NM
			          FROM TBDCMACM002M E
			         WHERE E.DPT_CD = A.AUD_DPT_CD)                                                                                    AS AUD_DPT_NM  /* 감사부서명 */
			     , (SELECT E.USR_NAM
			          FROM TBDCMACM001M E
			         WHERE E.CNB = A.AUD_PEN_CNB)                                                                                      AS AUD_PEN_NAM /* 감사자명 */
			     , A.AUD_SBJ_NM
			       /* 감사정보기본 등록/수정 및 상세조회 공통 영역 */
			     , A.TIT_TXT                                                                                /* 제목내용 */
			     , A.CLC_DVSN_CD                                                                            /* 수집구분코드 */
			     , (SELECT E.SPCF_AUD_SBJ
			          FROM TBCSPBII140M E
			         WHERE E.SPCF_INF_CLC_NO = A.CLC_DVSN_CD)                       AS CLC_DVSN_NM          /* 수집구분명 */
			     , A.SRC_DVSN_CD                                                                            /* 출처구분코드 */
			     , F_CODE_NM('1000040', A.SRC_DVSN_CD)                              AS SRC_DVSN_NM          /* 출처구분명 */
			     , A.INF_DVSN_CD                                                                            /* 정보구분코드 */
			     , F_CODE_NM('1000097', A.INF_DVSN_CD)                              AS INF_DVSN_NM          /* 정보구분명 */
			     , A.REL_ORG_CD                                                     AS REL_ORG_CD           /* 관련기관코드1 */
			     , (SELECT B.ORG_NM
			          FROM TBDCMACM015M B
			         WHERE B.ORG_CD = A.REL_ORG_CD)                                 AS REL_ORG_NM           /* 관련기관명1 */
			     , A.REL_ORG_CD_1                                                   AS REL_ORG_CD_1         /* 관련기관코드2 */
			     , (SELECT B.ORG_NM
			          FROM TBDCMACM015M B
			         WHERE B.ORG_CD = A.REL_ORG_CD_1)                               AS REL_ORG_NM_1         /* 관련기관명2 */
			     , A.REL_ORG_CD_2                                                   AS REL_ORG_CD_2         /* 관련기관코드3 */
			     , (SELECT B.ORG_NM
			          FROM TBDCMACM015M B
			         WHERE B.ORG_CD = A.REL_ORG_CD_2)                               AS REL_ORG_NM_2         /* 관련기관명3 */       
			     , A.HNDL_DPT_CD                                                                            /* 처리(소관)부서코드 */
			     , (SELECT B.DPT_NM
			          FROM TBDCMACM002M B
			         WHERE B.DPT_CD = A.HNDL_DPT_CD)                                AS HNDL_DPT_NM          /* 처리(소관)부서명 */
			     , A.OPEN_YN                                                                                /* 공개여부 */
			     , A.YE || '-' || A.SRNO                                            AS INF_NO               /* 정보번호 */
			     , TO_CHAR(TO_DATE(A.REGI_DT, 'YYYYMMDD'), 'YYYY.MM.DD')            AS REGI_DT              /* 등록일 */
			     , TO_CHAR(TO_DATE(A.SMT_DT, 'YYYYMMDD'), 'YYYY.MM.DD')             AS SMT_DT               /* 제출일 */
			     , A.SMT_DT AS SMT_DT2
			     , TO_CHAR(TO_DATE(A.ACP_DT, 'YYYYMMDD'), 'YYYY.MM.DD')             AS ACP_DT               /* 접수일 */
			     , TO_CHAR(TO_DATE(A.DTB_DT), 'YYYY.MM.DD')             AS DTB_DT               /* 배부일 */
			     , TO_CHAR(TO_DATE(A.TRNF_DT, 'YYYYMMDD'), 'YYYY.MM.DD')            AS TRNF_DT              /* 이송일 */
			     , TO_CHAR(TO_DATE(A.TRNF_ACP_DT, 'YYYYMMDD'), 'YYYY.MM.DD')        AS TRNF_ACP_DT          /* 이송접수일 */
			     , TO_CHAR(TO_DATE(A.AUD_DT, 'YYYYMMDD'), 'YYYY.MM.DD')             AS AUD_DT               /* 감사일 */
			     , TO_CHAR(TO_DATE(A.HNDL_DT, 'YYYYMMDD'), 'YYYY.MM.DD')            AS HNDL_DT              /* 처리일 */
			     , TO_CHAR(TO_DATE(A.CMPT_DT, 'YYYYMMDD'), 'YYYY.MM.DD')            AS CMPT_DT              /* 완료일 */			    
			     , A.HNDL_ORD_CD                                                                            /* 처리지시코드 */
			     , F_CODE_NM('1000039', A.HNDL_ORD_CD) AS HNDL_ORD_NM                                       /* 처리지시명 */
			     , A.HNDL_RSLT_CD                                                                           /* 처리결과코드 */
			     , F_CODE_NM('1000042', A.HNDL_RSLT_CD)                             AS HNDL_RSLT_NM         /* 처리결과명 */
			     , B.AUD_INF_TXT                                                                            /* 감사정보내용 */
			     , B.AUD_INF_ETC_TXT                                                                        /* 감사정보기타내용 */
			     , B.AUD_INF_SMM_TXT                                                                        /* 감사정보요약내용 */
			     , A.PRSR_DPT_CD                                                                            /* 제출부서코드 */
			     , (SELECT E.DPT_NM
			          FROM TBDCMACM002M E
			         WHERE E.DPT_CD = A.PRSR_DPT_CD)                                AS PRSR_DPT_NM          /* 제출자부서명 */
			     , (SELECT E.ABR_DPT_NM_1
			          FROM TBDCMACM002M E
			         WHERE E.DPT_CD = A.PRSR_DPT_CD)                                AS PRSR_ABR_DPT_NM      /* 제출자약칭부서명 */
			     , (SELECT S2.CD_NM
			     	  FROM TBDCMACM001M S1, TBDCMACM013C S2
			     	 WHERE S1.RAL_BLT_DIV_CD = S2.CD
			     	   AND S2.CMM_CD_DVSN_CD = '1000144'
			     	   AND S1.CNB = A.PRSR_CNB
			       ) AS RAL_BLT_DIV_NM
			     , F_CODE_NM('1000173', A.PRSR_RANK_CD)                             AS PRSR_RANK_NM         /* 제출자직급명 */
			     , A.PRSR_RANK_CD                                                                           /* 제출자직급명 */
			     , A.PRSR_CNB                                                                               /* 제출자전산번호 */
			     , A.HNDL_PEN_CNB                                                                           /* 처리자전산번호 */
			     , (SELECT E.USR_NAM
			          FROM TBDCMACM001M E
			         WHERE E.CNB = A.HNDL_PEN_CNB)                                  AS HNDL_PEN_NAM         /* 처리자성명 */			     
			     , (SELECT E.DOC_ID
			          FROM TBCSPBII102L E /*감사정보첨부파일내역 */
			         WHERE E.YE                     = A.YE
			           AND E.SRNO                   = A.SRNO
			           AND E.DOC_TYP_CD = 'SP-II-001')                              AS REL_DOC_ID           /* 관련첨부파일문서ID */
			     , (SELECT E.DOC_ID
			          FROM TBCSPBII102L E /*감사정보첨부파일내역 */
			         WHERE E.YE                     = A.YE
			           AND E.SRNO                   = A.SRNO
			           AND E.DOC_TYP_CD = 'SP-II-002')                              AS HNDL_DOC_ID          /* 처리첨부파일문서ID */      	
			     , A.AUD_INF_PRSS_STA_CD                                                                    /* 감사정보진행상태코드 */		
			     , F_CODE_NM('1000085', A.AUD_INF_PRSS_STA_CD)                      AS AUD_INF_PRSS_STA_NM  /* 감사정보진행상태명 */
			     , (SELECT COUNT(*)
			          FROM TBCSPBII150L E
			         WHERE E.YE = A.YE
			           AND E.SRNO = A.SRNO			            
			           AND E.AUD_POP_DT IS NOT NULL
			           AND E.AUD_POP_RLS_DT IS NULL
			           AND ( E.AUD_POP_DPT_CD = #strDptCd#  OR E.SRCH_PEN_CNB = #S_CNB#))                           AS AUD_POP_CNT          /* 감사찜건수 */
			     , A.PRSR_DPT_TP_CD AS DPT_TP_CD
			     , CASE WHEN (SELECT  GEN_ADMN_DVSN_CD
			     	FROM	TBDCMACM001M S1
			     	WHERE	A.PRSR_CNB = S1.CNB
			     	) = '2' THEN '행정' 
			     	WHEN (SELECT  GEN_ADMN_DVSN_CD
			     	FROM	TBDCMACM001M S1
			     	WHERE	A.PRSR_CNB = S1.CNB
			     	) = '3' THEN '파견'
			     	ELSE '일반'  END AS DPT_TP_CD2
			     , A.ACP_YR                                                                                 /* 접수년도 */
			     , A.CVPT_ACP_NO                                                                            /* 민원접수번호 */
			     , A.REQ_DVSN_CD	                                                                        /* 요구구분코드 */
			     , CASE WHEN A.REQ_DVSN_CD = '1' THEN 
														(SELECT '('||E.ACP_YR||DECODE(E.RM_ACP_KND_CD,'','-','2','-민원-','1','-제보-')||E.RM_CVPT_ACP_NO||')'||E.TIT_NM
														   FROM TBCSPDCP101M E
														  WHERE E.ACP_YR      = A.ACP_YR
														    AND E.CVPT_ACP_NO = A.CVPT_ACP_NO
														    AND E.REQ_DVSN_CD = A.REQ_DVSN_CD)
						WHEN A.REQ_DVSN_CD = '2' THEN 
														(SELECT '('||E.ACP_YR||'-국민-'||E.RM_CVPT_ACP_NO||')'||E.TIT_NM
														   FROM TBCSPDCP101M E
														  WHERE E.ACP_YR      = A.ACP_YR
														    AND E.CVPT_ACP_NO = A.CVPT_ACP_NO
														    AND E.REQ_DVSN_CD = A.REQ_DVSN_CD)
						WHEN A.REQ_DVSN_CD = '3' THEN 
														(SELECT '('||E.ACP_YR||'-공익-'||E.RM_CVPT_ACP_NO||')'||E.TIT_NM
														   FROM TBCSPDCP101M E
														  WHERE E.ACP_YR      = A.ACP_YR
														    AND E.CVPT_ACP_NO = A.CVPT_ACP_NO
														    AND E.REQ_DVSN_CD = A.REQ_DVSN_CD)
						WHEN A.REQ_DVSN_CD = '5' THEN 
														(SELECT '('||E.ACP_YR||'-부감-'||E.RM_CVPT_ACP_NO||')'||E.TIT_NM
														   FROM TBCORCOR101M E
														  WHERE E.ACP_YR      = A.ACP_YR
														    AND E.CVPT_ACP_NO = A.CVPT_ACP_NO
														    AND E.REQ_DVSN_CD = A.REQ_DVSN_CD)	
						WHEN A.REQ_DVSN_CD = '6' THEN 
														(SELECT '('||E.ACP_YR||'-청금-'||E.RM_CVPT_ACP_NO||')'||E.TIT_NM
													       FROM TBDCPDCP101M E
														  WHERE E.ACP_YR      = A.ACP_YR
														    AND E.CVPT_ACP_NO = A.CVPT_ACP_NO
													        AND E.REQ_DVSN_CD = A.REQ_DVSN_CD)
						ELSE 	(SELECT '('||E.ACP_YR||DECODE(E.RM_ACP_KND_CD,'','-','2','-민원-','1','-제보-')||E.RM_CVPT_ACP_NO||')'||E.TIT_NM
																			          FROM TBCSPDCP101M E
																			         WHERE E.ACP_YR      = A.ACP_YR
																			           AND E.CVPT_ACP_NO = A.CVPT_ACP_NO
																			           AND E.REQ_DVSN_CD = A.REQ_DVSN_CD)	
				   END AS CVPT_TIT_NM           /* 민원, 부패행위, 청탁신고 제목명 */
			     , A.YE                                                                                     /* 연도 */
			     , A.SRNO                                                                                   /* 일련번호 */
			     , (SELECT E.USR_NAM
			          FROM TBDCMACM001M E
			         WHERE E.CNB = A.HNDL_PEN_CNB) ||'('||A.HNDL_PEN_CNB||')'                             AS HNDL_PEN_NAM_CNB         /* 처리자성명 */
			         ,a.HNDL_ORD_CD AS BK_HNDL_ORD_CD 	
			     , (SELECT	B.HOM_TNB
			     	FROM	TBDCMACM001M B
			     	WHERE A.PRSR_CNB = B.CNB ) AS HOM_TNB
			     , DECODE(A.PRE_EVL_CD, '10','상','20','중','30','하','점수') AS PRE_EVL_CD
			     , DECODE(A.PRE_EVL_FDLTY, '10','상','20','중','30','하','점수') AS PRE_EVL_FDLTY
			     , DECODE(A.PRE_EVL_IFENE, '10','상','20','중','30','하','점수') AS PRE_EVL_IFENE
			     , DECODE(A.PRE_EVL_WRDO, '10','상','20','중','30','하','점수') AS PRE_EVL_WRDO
			     , nvl(A.UTL_SC,0) AS UTL_SC /* 활용가능성 */
			     , nvl(A.FDLTY_SC,0) AS FDLTY_SC /* 충실성 */
			     , nvl(A.RIBLY_SC,0) AS RIBLY_SC /* 신뢰성 */
			     , nvl(A.UTL_SC,0) + nvl(A.FDLTY_SC,0) + nvl(A.RIBLY_SC,0) AS TOT_SC /* 총점수 */
			     , B.AUD_INF_ANL_OPIN_TXT /*제출자 분석의견*/
			     , B.AUD_INF_BLE_ANL_OPIN_TXT /*총괄부서분석의견*/
			     , (SELECT F_CODE_NM('1000852',GEN_ADMN_DVSN_CD)
			     	FROM	TBDCMACM001M  S1
			     	WHERE	A.PRSR_CNB = S1.CNB 
			     	)
			      AS GEN_ADMN_DVSN_NM
			     , A.BLE_CHGR_CNB
			     , F_USR_INFO (A.BLE_CHGR_CNB,'2') AS BLE_CHGR_NAM
			     , TRNF_DT            AS BK_TRNF_DT              /* 이송일 */
			     , (SELECT S1.APV_OPIN
			     	  FROM TBDCMACM023L S1
			     	 WHERE A.APV_DOC_NO = S1.APV_DOC_NO
			     	   AND S1.APV_DVSN_CD ='AudInfoSend' 
			     	   AND S1.APVR_KND_CD = '3'
			     ) AS  APV_OPIN
			     , TO_CHAR(A.FRT_REGI_DH,'YYYYMMDD') AS FRT_REGI_DT
			     , A.TRNF_APV_DOC_NO
			     , nvl(A.FDLTY_MNAG_SC,0) AS FDLTY_MNAG_SC    /* 충실성행위주체점수 */
			     , nvl(A.FDLTY_TIME_SC,0) AS FDLTY_TIME_SC    /* 충실성행위시기점수 */
			     , nvl(A.FDLTY_TG_SC,0)   AS FDLTY_TG_SC      /* 충실성행위대상점수 */
			     , nvl(A.FDLTY_TXT_SC,0)  AS FDLTY_TXT_SC     /* 충실성행위대상점수 */
			     , nvl(A.FDLTY_BAS_SC,0)  AS FDLTY_BAS_SC     /* 충실성법적근거점수 */
			     , nvl(A.RIBLY_EVI_SC,0)  AS RIBLY_EVI_SC     /* 신뢰성증거자료점수 */
			     , nvl(A.RIBLY_IVTG_SC,0) AS RIBLY_IVTG_SC    /* 신뢰성탐문정보점수 */
			     , nvl(A.UTL_INSP_SC,0)   AS UTL_INSP_SC      /* 활용가능성감찰정보점수 */
			     , nvl(A.UTL_SPCF_SC,0)   AS UTL_SPCF_SC      /* 활용가능성특정정보점수 */
			     , DECODE(nvl(A.FDLTY_SC,0),0,(nvl(A.FDLTY_MNAG_SC, 0) + nvl(A.FDLTY_TIME_SC, 0) + nvl(A.FDLTY_TG_SC, 0) + nvl(A.FDLTY_TXT_SC, 0) + nvl(A.FDLTY_BAS_SC, 0)),A.FDLTY_SC) AS FDLTY_TOT_SC
			     , DECODE(nvl(A.RIBLY_SC,0),0,(nvl(A.RIBLY_EVI_SC,0) + nvl(A.RIBLY_IVTG_SC,0)),A.RIBLY_SC) AS RIBLY_TOT_SC
			     , DECODE(nvl(A.UTL_SC,0),0,(nvl(A.UTL_INSP_SC,0) + nvl(A.UTL_SPCF_SC,0)),A.UTL_SC) AS UTL_TOT_SC
			     , DECODE((nvl(A.FDLTY_SC,0)+nvl(A.RIBLY_SC,0)+nvl(A.UTL_SC,0)),0,(nvl(A.FDLTY_MNAG_SC,0) + nvl(A.FDLTY_TIME_SC,0) + nvl(A.FDLTY_TG_SC,0) + nvl(A.FDLTY_TXT_SC,0) + nvl(A.FDLTY_BAS_SC,0)
			     + nvl(A.RIBLY_EVI_SC,0) + nvl(A.RIBLY_IVTG_SC,0)
			     + nvl(A.UTL_INSP_SC,0) + nvl(A.UTL_SPCF_SC,0)),(nvl(A.FDLTY_SC,0)+nvl(A.RIBLY_SC,0)+nvl(A.UTL_SC,0))) AS FNL_TOT_SC
			  FROM TBCSPBII100M A /* 감사정보기본 */
			     , TBCSPBII101L B /* 감사정보내역 */
			 WHERE A.YE            = B.YE
			   AND A.SRNO          = B.SRNO			   
		]]>
		<!-- 연도 -->
		<isNotEmpty property="strYe">
			AND A.YE =  #strYe#
		</isNotEmpty>
		
		<!-- 일련번호 -->
		<isNotEmpty property="strSrno">
			AND A.SRNO =  #strSrno#
		</isNotEmpty>
		
		<!-- 연도/일련번호 리스트(감사정보 출력 팝업화면에서 사용)-->
		<isNotEmpty property="strYeList">
			<!-- 뷰를 사용하지 않을 경우 인덱스를 타지 않는 현상이 발생해서 뷰를 먼저 생성하고 서브쿼리 함 -->
			AND (A.YE, A.SRNO) IN (WITH VW AS (SELECT REGEXP_SUBSTR(#strYeList#, '[^||]+', 1, LEVEL)   AS YE
                                                    , REGEXP_SUBSTR(#strSrnoList#, '[^||]+', 1, LEVEL) AS SRNO
                                                 FROM DUAL
                                               CONNECT BY LEVEL &lt;= REGEXP_COUNT(#strYeList#, '[^|]+'))
                                   SELECT YE
                                        , SRNO
                                     FROM VW            
                                  )
		</isNotEmpty>
		
		<!-- 결재문서번호(결재상신/결재 팝업화면에서 사용) -->
		<isNotEmpty property="strApvDocNo">
			AND A.APV_DOC_NO = #strApvDocNo#
		</isNotEmpty>
		
		<!-- 이송 결재문서번호(결재상신/결재 팝업화면에서 사용) -->
		<isNotEmpty property="strTrnfApvDocNo">
			AND A.TRNF_APV_DOC_NO = #strTrnfApvDocNo#
		</isNotEmpty>		
		
		<!-- 시작접수일/종료접수일(심사분석-결재용 감사정보 내역 팝업화면에서 사용) -->
		<isEqual property="strDVSN_CD" compareValue="1">
			AND A.ACP_DT BETWEEN #strStrAcpDt# AND #strEndAcpDt#
		</isEqual>
		
		<isEqual property="strDVSN_CD" compareValue="1">
			AND A.ACP_DH BETWEEN #strStrAcpDh# AND #strEndAcpDh#
		</isEqual>
		
		<isEqual property="strDVSN_CD" compareValue="2">
			AND A.DTB_DT BETWEEN #strStrAcpDt# AND #strEndAcpDt#
		</isEqual>
		
		<isNotEmpty property="strBLE_CHGR_CNB">
			AND A.BLE_CHGR_CNB = #strBLE_CHGR_CNB#
		</isNotEmpty>
		ORDER BY A.YE
		       , A.SRNO
	</select>

	<!-- 출장상황 목록 조회 -->   
	<select id="CSPBII197PBztSituSelect" parameterClass="paramMap" resultClass="resultMap">
		<![CDATA[       
			SELECT ROW_NUMBER() OVER(PARTITION BY A.YE, A.SRNO ORDER BY A.BZT_STR_DT, A.BZT_END_DT) AS BZT_SITU_NO  
				 , TO_CHAR(TO_DATE(A.BZT_STR_DT, 'YYYYMMDD'), 'MM.DD') || '~' || TO_CHAR(TO_DATE(A.BZT_END_DT, 'YYYYMMDD'), 'MM.DD') || '/'				
				|| A.TIT_TXT || '/'
				|| (SELECT B.ORG_NM
				      FROM TBDCMACM015M B
				     WHERE B.ORG_CD = A.ORG_CD) || CASE WHEN A.ORG_CNT = 0 THEN NULL
				                                        ELSE ' 외 ' || A.ORG_CNT 
				                                   END AS BZT_SITU	
				 , A.YE
				 , A.SRNO
			  FROM (SELECT C.YE
			             , C.SRNO   
			             , A.BZT_STR_DT
			             , A.BZT_END_DT
			             , B.TIT_TXT
			             , (SELECT MIN(D.ORG_CD)
			                  FROM TBBADDED008L D
			                 WHERE D.BZT_YR   = A.BZT_YR
			                   AND D.BZT_SNO  = A.BZT_SNO
			                   AND D.TEAM_SNO = A.TEAM_SNO) AS ORG_CD
			             , (SELECT COUNT(*) - 1
			                  FROM TBBADDED008L D
			                 WHERE D.BZT_YR   = A.BZT_YR
			                   AND D.BZT_SNO  = A.BZT_SNO
			                   AND D.TEAM_SNO = A.TEAM_SNO) AS ORG_CNT
			          FROM TBBADDED005L A
			             , TBBADDED002M B
			             , TBCSPBII100M C
			         WHERE A.BZT_YR  = B.BZT_YR
			           AND A.BZT_SNO = B.BZT_SNO
			           AND A.PCT_CNB = C.PRSR_CNB
			           AND A.BZT_STR_DT >= TO_CHAR(ADD_MONTHS(TO_DATE(C.SMT_DT, 'YYYYMMDD'), -3), 'YYYYMMDD')
			           AND A.BZT_END_DT <= C.SMT_DT
			]]>		
			<isEqual property="strDVSN_CD" compareValue="1">
			           AND C.ACP_DT BETWEEN #strStrAcpDt# AND #strEndAcpDt#
			           AND C.ACP_DH BETWEEN #strStrAcpDh# AND #strEndAcpDh#
			</isEqual>
			<isEqual property="strDVSN_CD" compareValue="2">
			           AND C.DTB_DT BETWEEN #strStrAcpDt# AND #strEndAcpDt#
			</isEqual>
			<isNotEmpty property="strYeList">	
			AND (c.YE, c.SRNO) IN (SELECT REGEXP_SUBSTR(#strYeList#, '[^||]+', 1, LEVEL)
                                        , REGEXP_SUBSTR(#strSrnoList#, '[^||]+', 1, LEVEL)
                                     FROM DUAL
                                   CONNECT BY LEVEL &lt;= REGEXP_COUNT(#strYeList#, '[^|]+'))
			</isNotEmpty>
			<isNotEmpty property="strBLE_CHGR_CNB">
				AND C.BLE_CHGR_CNB = #strBLE_CHGR_CNB#
			</isNotEmpty>
			<isNotEmpty property="strYe">
				AND C.YE =  #strYe#
			</isNotEmpty>
			
			<!-- 이송 결재문서번호(결재상신/결재 팝업화면에서 사용) -->
			<isNotEmpty property="strTrnfApvDocNo">
				AND C.TRNF_APV_DOC_NO = #strTrnfApvDocNo#
			</isNotEmpty>			
			
			<!-- 일련번호 -->
			<isNotEmpty property="strSrno">
				AND C.SRNO =  #strSrno#
			</isNotEmpty>
			           ) A
			ORDER BY BZT_SITU_NO			           		
		
	</select>
</sqlMap> 
