# sql-transformer CLI 실행 가이드 (옵션 케이스별)

이 문서는 **개발 디렉토리(`C:\sql-transformer`)에서 바로 실행**하는 기준으로, `AliasSqlGenerateCli`의 옵션 조합별 실행 예시를 정리한 가이드입니다.  
(Windows PowerShell 기준 예시 포함, CMD 예시도 일부 포함)

---

## 0) 사전 준비

### 0.1 빌드 (fat-jar 생성)
```powershell
cd C:\sql-transformer
.\gradlew clean shadowJar
```

빌드 산출물 확인:
```powershell
dir .\build\libs\
# 예: sql-transformer-0.1.0-SNAPSHOT-all.jar
```

### 0.2 공통 실행 형식

#### (권장) PowerShell
```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --mode TOBE
```

#### CMD (줄바꿈 없이 1줄)
```bat
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" oasys.migration.cli.AliasSqlGenerateCli --system best --mode TOBE
```

---

## 1) 옵션 목록(요약)

> 실제 옵션은 프로젝트 버전에 따라 일부 이름이 변경될 수 있으므로, **항상 `--help`로 최종 확인**하세요.

### 1.1 필수(또는 사실상 필수)
- `--system <best|oasys|...>` : 시스템 식별자

### 1.2 모드
- `--mode <TOBE|ASIS|TOBE_SQL|ASIS_SQL ...>`
    - 기본값(요구사항): **TOBE**

> 최근 리팩토링에서 `TOBE/ASIS` 단순 모드와 내부 enum 명칭이 혼재될 수 있으니, 실행 시 `--help` 출력의 mode 허용값을 따르세요.

### 1.3 입력 경로(선택/기본값 사용 가능)
- `--sqlsDir <dir>` : Mapper XML(또는 sqls) 루트 디렉토리
- `--callchain <fileOrDir>` : callchain CSV/XLSX 파일 또는 해당 파일이 들어있는 디렉토리
    - 디렉토리 입력 시 예: `callchain.csv`, `callchain.xlsx` 자동 탐색
- `--mapping <fileOrDir>` : mapping CSV/XLSX 파일 또는 해당 파일이 들어있는 디렉토리
    - 디렉토리 입력 시 예: `mapping_column.csv`, `mapping_column.xlsx` 자동 탐색

### 1.4 출력 경로(선택/기본값 사용 가능)
- `--out <dir>` : 변환된 `.sql` 출력 루트
- `--result <xlsx>` : 결과 리포트(xlsx) 경로

### 1.5 출력/동작 토글
- `--noSqlOut` : `.sql` 파일 출력 비활성화
- `--noResult` : 결과 xlsx 출력 비활성화
- `--noFallback` : sqlText fallback(예: CSV에만 있을 때 사용) 비활성화
- `--pretty=false` : SQL pretty 출력 비활성화

### 1.6 실행 제어
- `--max <N>` : 최대 처리 건수 (기본 -1/전체)
- `--logEvery <N>` : N건마다 로그
- `--slowMs <N>` : 느린 건 기준 ms
- `--failFast` 또는 `--failFast=true` : 경고를 에러로 승격/즉시 종료 (검증/정책에 따라 의미가 다를 수 있음)

---

## 2) 케이스별 실행 예시

## 케이스 A) 가장 단순 실행 (system만)
> system만 주면 나머지 경로는 **기본 규칙으로 자동 결정**되도록 설계한 방향입니다.

```powershell
cd C:\sql-transformer
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best
```

기본값(예시 정책):
- mode: TOBE
- out: `.\output\<system>\`
- result: `.\output\<system>\tobe-sql-result.xlsx`
- callchain/mapping: `.\systems\<system>\mapping\` 아래에서 자동 탐색
- sqlsDir: `.\systems\<system>\sqls\` 또는 프로젝트 기본 sqlsDir

> ⚠️ 프로젝트 내 기본 경로가 `src/main/resources/systems/<system>/...` 구조라면, 해당 경로를 우선하도록 코드가 구성된 버전도 있습니다.  
> **현재 버전의 기본 경로는 `--help` 출력의 CONF 라인을 기준으로 확정**하세요.

---

## 케이스 B) TOBE 모드 명시 (권장)
```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --mode TOBE
```

---

## 케이스 C) ASIS 모드 실행 (ASIS 결과물 별도 폴더/리포트)
요구사항 기준(예시):
- out: `.\output\best\asis\`
- result: `.\output\best\asis\asis-sql-result.xlsx`

```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --mode ASIS
```

---

## 케이스 D) 경로를 모두 직접 지정(완전 명시형)
사용자 예시 형태(구버전 옵션명 포함):

```powershell
cd C:\sql-transformer

java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system bse `
  --sqlsDir ".\src\main\resources\sqls" `
  --csv ".\src\main\resources\mapping\service_sql_xref.csv" `
  --mapping ".\src\main\resources\mapping\column_mapping.xlsx" `
  --out ".\output\tobe-sql" `
  --result ".\output\tobe-sql-result.xlsx"
```

> ✅ 최신 방향에서는 `--csv` 대신 `--callchain`을, `--mapping`은 디렉토리 입력을 지원합니다.  
> 구버전/신버전 혼재 시에는 아래 케이스 E/F 스타일을 추천합니다.

---

## 케이스 E) callchain/mapping을 “디렉토리만” 지정 (파일명 생략)
- callchain: 디렉토리 내 `callchain.csv` 또는 `callchain.xlsx` 자동 탐색
- mapping: 디렉토리 내 `mapping_column.csv` 또는 `mapping_column.xlsx` 자동 탐색

```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --mode TOBE `
  --sqlsDir ".\systems\best\sqls" `
  --callchain ".\systems\best\mapping" `
  --mapping  ".\systems\best\mapping"
```

---

## 케이스 F) callchain만 외부 파일로 지정 (mapping은 기본값 사용)
```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --callchain ".\input\callchain_best.xlsx"
```

---

## 케이스 G) 결과 xlsx만 만들고 싶음 (sql 파일 출력 끄기)
```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --mode TOBE `
  --noSqlOut
```

---

## 케이스 H) sql 파일만 만들고 싶음 (result xlsx 끄기)
```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --mode TOBE `
  --noResult
```

---

## 케이스 I) fallback 금지(“CSV sql_text가 없으면 실패/경고 강화” 용도)
```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --mode TOBE `
  --noFallback
```

---

## 케이스 J) Pretty 출력 끄기
```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --mode TOBE `
  --pretty=false
```

---

## 케이스 K) N건만 테스트 / 로그 주기 조절
```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --mode TOBE `
  --max 20 `
  --logEvery 1
```

---

## 케이스 L) (검증) AS-IS 잔존 검증을 fail-fast로 강제
> 옵션 이름은 프로젝트 버전에 따라 `--failFast`, `--failFast=true` 등으로 구현될 수 있습니다.

```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --system best `
  --mode TOBE `
  --failFast
```

---

## 3) 실행 점검 체크리스트

- `--system` 값에 대응하는 디렉토리 구조가 존재하는가?
    - 예: `.\systems\best\sqls\`
    - 예: `.\systems\best\mapping\callchain.csv` / `callchain.xlsx`
    - 예: `.\systems\best\mapping\mapping_column.xlsx`
- `--sqlsDir`가 실제 Mapper XML을 포함하는가?
- 생성물:
    - `.\output\<system>\...` 아래 `.sql` 파일 생성 여부
    - `.\output\<system>\...\*-result.xlsx` 생성 여부

---

## 4) 빠른 도움말
```powershell
java -cp ".\build\libs\sql-transformer-0.1.0-SNAPSHOT-all.jar" `
  oasys.migration.cli.AliasSqlGenerateCli `
  --help
```
